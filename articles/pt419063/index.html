<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèæ üõ´ „äóÔ∏è Automa√ß√£o de obten√ß√£o de informa√ß√µes do USRLE usando Freepascal üå∑ üö° ü§ûüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No meu trabalho (jur√≠dico), estou pronto para automatizar tudo o que s√≥ se presta a isso. Mas at√© que os rob√¥s bombeados por redes neurais da utopia d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automa√ß√£o de obten√ß√£o de informa√ß√µes do USRLE usando Freepascal</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419063/"><img src="https://habrastorage.org/webt/xp/n2/lb/xpn2lbf3yf9_ryhoprada0ehl5i.jpeg"><br><br><p>  No meu trabalho (jur√≠dico), estou pronto para automatizar tudo o que s√≥ se presta a isso.  Mas at√© que os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rob√¥s</a> bombeados por redes neurais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">da utopia do Gref alem√£o</a> n√£o apare√ßam e n√£o tirem todo o trabalho de advogados comuns, a rotina continuar√° sendo nossa principal companheira por muito tempo.  A automa√ß√£o dessa rotina √© algo que venho fazendo periodicamente nos √∫ltimos anos, sejam v√°rias tabelas no Excel com v√°rias f√≥rmulas que permitem imprimir rapidamente uma centena do mesmo tipo de documentos de correspond√™ncia em word ou relat√≥rios gerados automaticamente.  Mas h√° coisas que voc√™ n√£o pode fazer com f√≥rmulas e substitui√ß√µes simples.  √â aqui que a programa√ß√£o vem em socorro, da qual gosto desde a inf√¢ncia, e aconteceu que come√ßou com o delphi.  Agora √© mais f√°cil para mim do que em C # ou python, que comecei a aprender recentemente, criar rapidamente algum tipo de projeto no ambiente Lazarus usando o freepascal.  E sim, acredito seriamente que as capacidades desse ambiente s√£o mais que suficientes.  Portanto, automatize o USRLE, voc√™ adivinhou, isso deve ser feito usando pascal. <br><a name="habracut"></a><br></p><p>  Um advogado de uma empresa de consultoria que conduz neg√≥cios de dezenas de entidades legais, um advogado corporativo baseado em p√£o gratuito e qualquer outro advogado que se comprometa a garantir as atividades das organiza√ß√µes - todos sabem como dezenas e centenas de nomes diferentes, n√∫meros TIN, PSRN se misturam em sua cabe√ßa, como √© f√°cil esquecer quem √© o gerente e, quando o prazo de renova√ß√£o √© apropriado, h√° problemas com as a√ß√µes da LLC e com o pagamento de seu capital social.  Bem, a necessidade de criar rapidamente algum tipo de documento, que inclui muitos detalhes em constante mudan√ßa, implica erros e erros de digita√ß√£o peri√≥dicos.  Para automatizar apenas esses processos, eu precisava de uma solu√ß√£o de banco de dados que me permitisse criar documentos usando modelos, manter v√°rios registros, acompanhar altera√ß√µes e n√£o perder prazos.  Bem, uma das simplifica√ß√µes necess√°rias da vida √© o recebimento r√°pido de um novo arquivo com informa√ß√µes do USRLE no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site do Servi√ßo Fiscal Federal</a> .  Obviamente, ningu√©m diz que usar o site diretamente √© longo e dif√≠cil, mas concorda que clicar em um bot√£o sem sair do aplicativo √© muito mais divertido, e voc√™ pode fazer isso sem interromper a liga√ß√£o (ou uma x√≠cara de caf√©). <br><br></p><p>  Ent√£o, para come√ßar, decidiremos o que queremos obter.  O site permite que voc√™ procure no <abbr title="Nesse caso, a oficialidade da fonte de informa√ß√£o √© importante, uma vez que trechos do USRLE recebidos de maneira totalmente gratuita s√£o aceitos at√© mesmo pelos tribunais como prova">registro oficial do</abbr> USRLE um n√∫mero √∫nico OGRN ou TIN e forne√ßa um resultado relevante na forma de uma breve informa√ß√£o sobre a pessoa e um link para baixar o arquivo pdf com um extrato.  Al√©m disso, a pesquisa pode ser confusa por nome, com um filtro adicional por regi√£o (assunto da Federa√ß√£o Russa).  E, nesse caso, o site emite uma tabela com todas as pessoas adequadas e com o mesmo conjunto de dados, incluindo links para pdf. <br><br></p><p>  Portanto, em um caso espec√≠fico, a fun√ß√£o pronta deve retornar pdf na forma de um arquivo (ou, melhor, um fluxo), tendo um OGRN ou TIN na entrada.  Mas para a universaliza√ß√£o e a possibilidade de expans√£o adicional, n√£o negligenciaremos todos os recursos do site e tamb√©m faremos uma fun√ß√£o de pesquisa difusa com o retorno de um conjunto de dados encontrado pelo nome da organiza√ß√£o, levando em considera√ß√£o o filtro por regi√£o ou sem ele.  Vamos tentar descrever as interfaces dessas fun√ß√µes: <br><br></p><pre><code class="delphi hljs">IEGRULstreamer = <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetExtractByOGRN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OGRN: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; ; isLegal: boolean; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Extract: TStream)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLegalsListByName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Name</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Region: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; ; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LegalsList: TCollection)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Para entender o que o misterioso par√¢metro X e a cole√ß√£o da qual a segunda fun√ß√£o retornar√°, veremos como o site executa a solicita√ß√£o. <br><br><p>  1. O site possui um formul√°rio com campos de entrada para identificadores para pesquisar e verificar captcha: <br><br><img src="https://habrastorage.org/webt/ua/vn/gf/uavngfdababogkh8q7yexvfx-nw.jpeg"><br><br></p><p>  2. O Captcha √© gerado usando um campo oculto pr√©-gerado com o nome captchaToken, que usa um script Java para gerar uma imagem captcha para esse token. <br><br></p><p>  3. Depois de clicar no bot√£o "localizar", uma solicita√ß√£o POST √© enviada ao servidor, nos resultados do processamento dos quais o JSON com uma matriz de objetos √© retornado.  Essa resposta JSON usa outro script Java para preencher a tabela que vemos nos resultados da pesquisa. <br><br>  Portanto, o primeiro problema √© a verifica√ß√£o do captcha.  Para n√£o sobrecarregar nossos m√©todos de intera√ß√£o com o site com excesso de funcionalidade, tomaremos a√ß√µes para processar o captcha como uma fun√ß√£o separada.  E no X, teremos um par√¢metro para o m√©todo de retorno de chamada, que possui uma imagem captcha na entrada e uma sequ√™ncia com captcha reconhecido na sa√≠da: <br><br></p><pre> <code class="delphi hljs">TCapthcaRecognizeFunc = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Captha: TStream)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetExtractByOGRN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OGRN: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; CaptchaFunc: TCapthcaRecognizeFunc; isLegal: boolean; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Extract: TStream)</span></span></span><span class="hljs-function">;</span></span></code> </pre><br>  A fun√ß√£o que processa o captcha pode fazer o que voc√™ quiser: deixe o usu√°rio inseri-lo manualmente, envie a imagem para um servidor pago para reconhecimento autom√°tico, reconhe√ßa-o independentemente usando o know-how exclusivo do algoritmo.  Para simplificar a imagem, e como no meu caso n√£o √© esperado nenhum fluxo de captcha em escala industrial, selecionamos a primeira op√ß√£o: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RecognizeFunc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(captcha: TStream)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> CaptchaImg.Picture.LoadFromStream(captcha); Result := InputBox(<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'    '</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><p>  A segunda pergunta √© o conte√∫do da resposta JSON do servidor.  Aqui est√° um exemplo do que vem nele: <br><br></p><div class="spoiler">  <b class="spoiler_title">Resposta formatada em JSON</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"query"</span></span>: {<span class="hljs-attr"><span class="hljs-attr">"captcha"</span></span>:<span class="hljs-string"><span class="hljs-string">"382915"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ogrninnfl"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fam"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"nam"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"otch"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"region"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ogrninnul"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"namul"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"regionul"</span></span>:<span class="hljs-string"><span class="hljs-string">"73"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"kind"</span></span>:<span class="hljs-string"><span class="hljs-string">"ul"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ul"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"searchByOgrn"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"nameEq"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"searchByOgrnip"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>}, <span class="hljs-attr"><span class="hljs-attr">"rows"</span></span>: [ {<span class="hljs-attr"><span class="hljs-attr">"T"</span></span>:<span class="hljs-string"><span class="hljs-string">"ED346E713D4A1AC851F9B589C6D2AECD1D809D5B6B5D1B98E697B6E0FD873E137B828AC59A60D159BB2894F11D00AB5639E2ACEE4E2ED5B7AC7A6EFE28FD987BC288B93C4D3D3EC1008DA0F128BA7E5E"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"INN"</span></span>:<span class="hljs-string"><span class="hljs-string">"7325001144"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NAME"</span></span>:<span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"OGRN"</span></span>:<span class="hljs-string"><span class="hljs-string">"1027301175110"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ADRESTEXT"</span></span>:<span class="hljs-string"><span class="hljs-string">"432017,  ,  ,  , 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"CNT"</span></span>:<span class="hljs-string"><span class="hljs-string">"4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"DTREG"</span></span>:<span class="hljs-string"><span class="hljs-string">"03.12.2002"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"KPP"</span></span>:<span class="hljs-string"><span class="hljs-string">"732501001"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"T"</span></span>:<span class="hljs-string"><span class="hljs-string">"2ECB284C7682E5F1D1129AA3074FABB4B74BB28EA426AF79C091CEDEA0D9E391CA26FF405A7C9742466E19C78FBE5A59BDCBCD21268FFD8AFD3A8509CCA84541"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"INN"</span></span>:<span class="hljs-string"><span class="hljs-string">"7303007375"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"NAME"</span></span>:<span class="hljs-string"><span class="hljs-string">"      \"   \""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"OGRN"</span></span>:<span class="hljs-string"><span class="hljs-string">"1027301173283"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ADRESTEXT"</span></span>:<span class="hljs-string"><span class="hljs-string">"432063,  ,  ,   , 7"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"CNT"</span></span>:<span class="hljs-string"><span class="hljs-string">"4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"DTREG"</span></span>:<span class="hljs-string"><span class="hljs-string">"27.11.2002"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"KPP"</span></span>:<span class="hljs-string"><span class="hljs-string">"732501001"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"DTEND"</span></span>:<span class="hljs-string"><span class="hljs-string">"01.09.2010"</span></span>}, ] }</code> </pre><br></div></div><br>  Como voc√™ pode ver, o resultado retorna um objeto de consulta que cont√©m os par√¢metros de pesquisa inicial (para que eles permane√ßam nos campos do formul√°rio para reutiliza√ß√£o) e uma matriz de linhas.  O link para o arquivo pdf √© combinado com um script java usando a express√£o: <pre>  "https://egrul.nalog.ru/download/" </pre>  e o valor da chave "T" do objeto.  O tempo de vida do arquivo pdf gerado √© de alguns minutos. <br><br><p>  As duas principais dificuldades que encontrei ao criar a solicita√ß√£o http s√£o os valores de cabe√ßalho corretos e a combina√ß√£o da string com os par√¢metros da solicita√ß√£o POST.  Mas uma an√°lise simples da p√°gina usando as ferramentas internas do navegador (no Chrome s√£o chamadas pressionando F12) deu tudo o que voc√™ precisa.  Aqui est√° um exemplo de cabe√ßalhos com os quais o servidor fornece a resposta correta em vez de 400 solicita√ß√µes incorretas: <br><br></p><pre> <code class="hljs powershell">POST / HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Host: egrul.nalog.ru Connection: keep<span class="hljs-literal"><span class="hljs-literal">-alive</span></span> Accept: application/json, text/javascript, */*; q=<span class="hljs-number"><span class="hljs-number">0.01</span></span> Origin: https://egrul.nalog.ru X<span class="hljs-literal"><span class="hljs-literal">-Requested</span></span><span class="hljs-literal"><span class="hljs-literal">-With</span></span>: XMLHttpRequest User<span class="hljs-literal"><span class="hljs-literal">-Agent</span></span>: Chrome/<span class="hljs-number"><span class="hljs-number">67.0</span></span>.<span class="hljs-number"><span class="hljs-number">3396.99</span></span> Safari/<span class="hljs-number"><span class="hljs-number">537.36</span></span> Content<span class="hljs-literal"><span class="hljs-literal">-Type</span></span>: application/x<span class="hljs-literal"><span class="hljs-literal">-www</span></span><span class="hljs-literal"><span class="hljs-literal">-form</span></span><span class="hljs-literal"><span class="hljs-literal">-urlencoded</span></span> Referer: https://egrul.nalog.ru/ Accept<span class="hljs-literal"><span class="hljs-literal">-Encoding</span></span>: gzip, deflate, br Accept<span class="hljs-literal"><span class="hljs-literal">-Language</span></span>: ru<span class="hljs-literal"><span class="hljs-literal">-RU</span></span>,ru;q=<span class="hljs-number"><span class="hljs-number">0.9</span></span>,en<span class="hljs-literal"><span class="hljs-literal">-US</span></span>;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span>,en;q=<span class="hljs-number"><span class="hljs-number">0.7</span></span></code> </pre><br>  E aqui est√° a linha com os par√¢metros: <br><br><pre> <code class="hljs perl">kind=ul&amp;srchUl=name&amp;ogrninnul=<span class="hljs-number"><span class="hljs-number">7716819629</span></span>&amp;namul=%D0%BF%D1%80%D0%B0%D0%B2% D<span class="hljs-number"><span class="hljs-number">0</span></span>%B8%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D1%82%D0%B2%D0%BE&amp;regionul=<span class="hljs-number"><span class="hljs-number">73</span></span> &amp;srchFl=ogrn&amp;ogrninnfl=&amp;fam=&amp;nam=&amp;otch=&amp;region=&amp;captcha=<span class="hljs-number"><span class="hljs-number">449023</span></span>&amp;captchaToken=DAEDA <span class="hljs-number"><span class="hljs-number">7504</span></span>CACAC82CF09E08319B68DF5F9BD62B2F44D33DD679DDE55B5CF58B17FEC84E78CEEB9639 <span class="hljs-number"><span class="hljs-number">84</span></span>D2B2BD8C3AA15</code> </pre> <br><p>  Armado com esses dados iniciais, prosseguimos para a implementa√ß√£o da tarefa.  Usarei as seguintes bibliotecas para o freepascal: <br><br></p><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Synapse</a> √© uma biblioteca muito conveniente, com a fun√ß√£o mais simplificada (para uso) de enviar solicita√ß√µes http para o servidor, tamb√©m funciona com SSL, mas isso requer a <abbr title="Tenho bibliotecas libeay32.dll e ssleay32.dll suficientes na plataforma win32">presen√ßa de bibliotecas openSSL</abbr> na pasta ou sistema do projeto, bem como a conex√£o de um m√≥dulo adicional.  √â suficiente conectar os seguintes m√≥dulos de biblioteca ao nosso projeto: httpsend, ssl_openssl, synautil. <br></p><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A biblioteca</a> interna fcl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">-json</a> - os m√≥dulos necess√°rios: fpjson e fpjsonrtti - para a m√°xima conveni√™ncia do processamento de objetos retornados ao JSON. <br><br></p><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M√≥dulos separados da biblioteca</a> interna fcl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">-xml</a> - para algumas fun√ß√µes, voc√™ precisar√° trabalhar com partes do HTML como objetos DOM, para conectar os m√≥dulos SAX_HTML, DOM_HTML, DOM. <br><br>  Vamos descrever os tipos e classes de objetos que acabaram sendo: <br><br></p><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TEGRULItem</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TCollectionItem) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> fT, fINN, fNAME, fOGRN, fADRESTEXT, fCNT, fDTREG, fDTEND, fKPP: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPdfLink</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">published</span></span> <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> T: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> fT <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> fT; <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> INN: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> fINN <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> fINN; <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> fNAME <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> fNAME; <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> OGRN: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> fOGRN <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> fOGRN; <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> ADRESTEXT: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> fADRESTEXT <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> fADRESTEXT; <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> CNT: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> fCNT <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> fCNT; <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> DTREG: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> fDTREG <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> fDTREG; <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> DTEND: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> fDTEND <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> fDTEND; <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> KPP: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> fKPP <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> fKPP; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><p>  Nesta classe, embalaremos objetos que ser√£o retornados na matriz de linhas na resposta JSON do servidor.  N√≥s os leremos usando JSONToCollection, mas para isso precisamos tornar cada objeto um elemento da cole√ß√£o e declarar todas as propriedades relacionadas conforme publicadas.  As fun√ß√µes RTTI no freepascal (assim como no delphi) obt√™m acesso aos nomes de propriedades somente quando s√£o declarados neste escopo.  E a fun√ß√£o JSONToCollection do m√≥dulo fpjsonrtti √© apenas uma fun√ß√£o RTTI que compara os nomes das chaves do objeto JSON com os nomes das propriedades da classe. <br></p><blockquote>  H√° tamb√©m uma fun√ß√£o GetPdfLink na interface da classe, que retorna um link para baixar um arquivo pdf com informa√ß√µes do USRLE, concatenando o endere√ßo da Web e o valor da propriedade "T". </blockquote><br><br><p>  A classe principal que implementa a interface declarada acima ser√° assim: <br><br></p><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TEGRULStreamer</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TInterfacedObject, IEGRULStreamer) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HTTPSender: THTTPSend; Doc: THTMLDocument; Inputs: TDOMNodeList; captchaURL, captchaToken, captcha, Params: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCaptchaToken</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLegalsList</span></span></span><span class="hljs-function">:</span></span> TCollection; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrepareHeaders</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessCaptcha</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CaptchaFunc: TCapthcaRecognizeFunc)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetExtractByOGRN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OGRN: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; CaptchaFunc: TCapthcaRecognizeFunc; isLegal: boolean; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Extract: TStream)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLegalsListByName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Name</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Region: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; CaptchaFunc: TCapthcaRecognizeFunc; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LegalsList: TCollection)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">destructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Destroy</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br><p>  Como voc√™ pode ver, al√©m da implementa√ß√£o das duas fun√ß√µes principais da interface, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">todas as outras propriedades e m√©todos da classe estar√£o ocultos</a> e necess√°rios apenas para a implementa√ß√£o interna.  Em geral, eles podem ser inclu√≠dos nos m√©todos principais, mas j√° aprendemos as li√ß√µes sobre c√≥digo duplicado, visualiza√ß√£o e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">refatora√ß√£o</a> em geral. <br></p><p>  Dado o encapsulamento de a√ß√µes preparat√≥rias, os m√©todos principais geralmente diferem apenas ao formar uma sequ√™ncia de par√¢metros de solicita√ß√£o de http e o tipo de dados retornado. <br><br></p><div class="spoiler">  <b class="spoiler_title">c√≥digo de m√©todo TEGRULStreamer.GetExtractByOGRN</b> <div class="spoiler_text"><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TEGRULStreamer</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetExtractByOGRN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OGRN: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; CaptchaFunc: TCapthcaRecognizeFunc; isLegal: boolean; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Extract: TStream)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ProcessCaptcha(CaptchaFunc); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isLegal <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Params := <span class="hljs-string"><span class="hljs-string">'kind=ul'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Params := <span class="hljs-string"><span class="hljs-string">'kind=fl'</span></span>; Params += <span class="hljs-string"><span class="hljs-string">'&amp;srchUl=ogrn&amp;srchFl=ogrn&amp;ogrninnul='</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isLegal <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Params += OGRN; Params += <span class="hljs-string"><span class="hljs-string">'&amp;namul=&amp;regionul=&amp;ogrninnfl='</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isLegal <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Params += OGRN; Params += <span class="hljs-string"><span class="hljs-string">'&amp;fam=&amp;nam=&amp;otch=&amp;region&amp;captcha='</span></span> + captcha + <span class="hljs-string"><span class="hljs-string">'&amp;captchaToken='</span></span> + captchaToken; WriteStrToStream(HTTPSender.Document, Params); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> HTTPSender.HTTPMethod(<span class="hljs-string"><span class="hljs-string">'POST'</span></span>, EGRUL_URL) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception.Create(<span class="hljs-string"><span class="hljs-string">'   '</span></span>); HTTPSender.Headers.Clear; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> HTTPSender.HTTPMethod(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, TEGRULItem(GetLegalsList.Items[<span class="hljs-number"><span class="hljs-number">0</span></span>]).GetPdfLink) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Extract := HTTPSender.Document <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Extract := <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>;</code> </pre><br></div></div><br><p>  Aqui, como podemos ver, o m√©todo tamb√©m usa o par√¢metro booleano isLegal e, se n√£o estiver definido como true, a pesquisa passar√° pelo banco de dados de empreendedores, e n√£o de entidades legais. <br><br></p><div class="spoiler">  <b class="spoiler_title">c√≥digo de m√©todo TEGRULStreamer.GetLegalsListByName</b> <div class="spoiler_text"><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TEGRULStreamer</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLegalsListByName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Name</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Region: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; CaptchaFunc: TCapthcaRecognizeFunc; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LegalsList: TCollection)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ProcessCaptcha(CaptchaFunc); Params := <span class="hljs-string"><span class="hljs-string">'kind=ul&amp;srchUl=name&amp;srchFl=ogrn&amp;ogrninnul=&amp;namul='</span></span>; Params += <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> + <span class="hljs-string"><span class="hljs-string">'&amp;regionul='</span></span> + Region + <span class="hljs-string"><span class="hljs-string">'&amp;ogrninnfl=&amp;fam=&amp;nam=&amp;otch=&amp;region'</span></span>; Params += <span class="hljs-string"><span class="hljs-string">'&amp;captcha='</span></span> + captcha + <span class="hljs-string"><span class="hljs-string">'&amp;captchaToken='</span></span> + captchaToken; WriteStrToStream(HTTPSender.Document, Params); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> HTTPSender.HTTPMethod(<span class="hljs-string"><span class="hljs-string">'POST'</span></span>, EGRUL_URL) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception.Create(<span class="hljs-string"><span class="hljs-string">'   '</span></span>); LegalsList := GetLegalsList; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br></div></div><br><p>  O papel dos m√©todos utilit√°rios √© o seguinte: <br><br>  <b>ProcessCaptcha</b> - baixa a p√°gina html inicial do Federal Tax Service, procura um token captcha, baixa uma imagem gerada por esse token e a redireciona para um m√©todo de retorno de chamada para reconhecimento de captcha.  No final, o m√©todo tamb√©m define os cabe√ßalhos corretos para a solicita√ß√£o POST subsequente. <br><br>  <b>GetCaptchaToken</b> - carrega todos os campos de entrada da p√°gina na estrutura do DOM, procura um campo oculto com o identificador capthcaToken e retorna seu valor. <br><br>  <b>GetLegalsList</b> - usando a fun√ß√£o RTTI JSONToCollection retorna uma cole√ß√£o de objetos do tipo TEGRULItem descritos acima. <br><br>  <s><b><abbr title="fun√ß√£o transferida para a implementa√ß√£o da classe TEGRULItem">GetPdfLink</abbr></b></s> - para pesquisar por OGRN ou TIN, no caso correto, sempre ser√° retornado apenas um resultado; portanto, em GetExtractByOGRN, a fun√ß√£o √© chamada para o primeiro elemento da cole√ß√£o. <br><br></p><p>  Como esta √© minha primeira experi√™ncia com uma rede em freepascal, estou muito feliz que tudo tenha sa√≠do exatamente como eu pretendia.  Em uma forma de trabalho, a biblioteca foi criada em menos de um dia (gra√ßas aos usu√°rios do f√≥rum freepascal.ru, que falaram sobre sinapse). <br><br></p><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um arquivo com um teste da biblioteca resultante e seu c√≥digo est√° aqui</a> . <br><br></p><p>  Como sempre, terei prazer em receber cr√≠ticas construtivas, tanto no projeto quanto na implementa√ß√£o.  Entendo que existem muitos fatores que ainda podem ser levados em considera√ß√£o: o atraso na resposta √† solicita√ß√£o de http, como resultado do qual o aplicativo congelar√°;  Respostas http incorretas e outras situa√ß√µes. <br><br></p><p>  No futuro, pretendo conectar uma biblioteca on-line ao banco de dados de endere√ßos FIAS e perceber a capacidade de gerar modelos de aplicativos completos, que geralmente s√£o editados no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Programa de Prepara√ß√£o de Documentos para o registro do estado</a> . <br><br><img src="https://habrastorage.org/webt/pu/a0/qm/pua0qmeomu83os45u7on8e9picm.gif" align="right"><br>  <i>PS Desculpe, Sberbank, pelo papel do coelho experimental e centenas de vezes que o extrato foi baixado.</i>  <i>Tudo em nome da ci√™ncia, √© claro.</i> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt419063/">https://habr.com/ru/post/pt419063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt419049/index.html">GeekBrains lan√ßa maratona educacional on-line gratuita ‚ÄúEncontre-se na Digital‚Äù</a></li>
<li><a href="../pt419051/index.html">Como Flant ajuda iniciantes</a></li>
<li><a href="../pt419053/index.html">Testando a tecnologia de cache Adaptec RAID</a></li>
<li><a href="../pt419055/index.html">Na teoria das cordas, voc√™ pode conviver com significativamente menos universos.</a></li>
<li><a href="../pt419061/index.html">Novidades do GoLand 2018.2</a></li>
<li><a href="../pt419065/index.html">Mundo virtual Intel. Pr√°tica</a></li>
<li><a href="../pt419067/index.html">Como vender dados pessoais ou por que √© dif√≠cil colocar um pre√ßo nas informa√ß√µes</a></li>
<li><a href="../pt419069/index.html">O aquecimento global tornar√° nosso mundo mais verde, mas n√£o se alegrar</a></li>
<li><a href="../pt419071/index.html">Ap√≥s o hack do tp-link</a></li>
<li><a href="../pt419075/index.html">Sobre a forma√ß√£o de sequ√™ncias na hip√≥tese de Collatz (3n + 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>