<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¦„ ğŸ•› ğŸ‘Œ åˆ›å»ºç®€å•çš„å‘¼å«è·Ÿè¸ªæœåŠ¡ï¼Œç¬¬1éƒ¨åˆ† ğŸ¤¾ğŸ¿ ğŸ„ ğŸ’ªğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ¬æ–‡å°†è€ƒè™‘åœ¨ç«™ç‚¹ä¸Šå®æ–½å‘¼å«è·Ÿè¸ªçš„å¯èƒ½é€‰é¡¹ä¹‹ä¸€ã€‚ æœ¬èµ„æ–™çº¯ç²¹å‡ºäºæ•™è‚²ç›®çš„è€Œç¼–å†™ï¼Œå¹¶ä¸å…·æœ‰å–ä»£æä¾›å‘¼å«è·Ÿè¸ªæœåŠ¡çš„ç°æœ‰ä¸“ä¸šæœåŠ¡çš„ç›®çš„ã€‚ 

 åŠŸèƒ½è¦æ±‚ 


1. è¯¥æœåŠ¡åº”æä¾›æŒ‰ç½‘ç«™è½¬æ¢æºï¼ˆä»æœç´¢å¼•æ“è½¬æ¢ï¼Œå¹¿å‘Šè½¬æ¢ï¼Œå¸¦æœ‰utmæ ‡ç­¾çš„ç‚¹å‡»é“¾æ¥ï¼‰æ›¿æ¢æ•°å­—ï¼ˆæ•°å­—ï¼‰çš„åŠŸèƒ½ã€‚ 
2. æœåŠ¡åº”å°†æ˜¾ç¤ºçš„å·ç å›ºå®šç»™ç«™ç‚¹è®¿...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åˆ›å»ºç®€å•çš„å‘¼å«è·Ÿè¸ªæœåŠ¡ï¼Œç¬¬1éƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473372/"> æœ¬æ–‡å°†è€ƒè™‘åœ¨ç«™ç‚¹ä¸Šå®æ–½å‘¼å«è·Ÿè¸ªçš„å¯èƒ½é€‰é¡¹ä¹‹ä¸€ã€‚ æœ¬èµ„æ–™çº¯ç²¹å‡ºäºæ•™è‚²ç›®çš„è€Œç¼–å†™ï¼Œå¹¶ä¸å…·æœ‰å–ä»£æä¾›å‘¼å«è·Ÿè¸ªæœåŠ¡çš„ç°æœ‰ä¸“ä¸šæœåŠ¡çš„ç›®çš„ã€‚ <br><br><h3> åŠŸèƒ½è¦æ±‚ </h3><br><ol><li> è¯¥æœåŠ¡åº”æä¾›æŒ‰ç½‘ç«™è½¬æ¢æºï¼ˆä»æœç´¢å¼•æ“è½¬æ¢ï¼Œå¹¿å‘Šè½¬æ¢ï¼Œå¸¦æœ‰utmæ ‡ç­¾çš„ç‚¹å‡»é“¾æ¥ï¼‰æ›¿æ¢æ•°å­—ï¼ˆæ•°å­—ï¼‰çš„åŠŸèƒ½ã€‚ </li><li> æœåŠ¡åº”å°†æ˜¾ç¤ºçš„å·ç å›ºå®šç»™ç«™ç‚¹è®¿é—®è€…ï¼Œå¹¶åœ¨ä¸‹æ¬¡è®¿é—®æ—¶æ˜¾ç¤ºè¯¥å·ç ã€‚ </li><li> æ‹¨æ‰“æ˜¾ç¤ºå·ç çš„ç”µè¯æ—¶ï¼ŒæœåŠ¡å¿…é¡»å¯åŠ¨Google Analyticsï¼ˆåˆ†æï¼‰ä¸­çš„äº‹ä»¶åˆ›å»ºã€‚ </li></ol><a name="habracut"></a><br><h3> é€šç”¨åŠ›å­¦ </h3><br> å½“æ‚¨è®¿é—®è¯¥ç«™ç‚¹æ—¶ï¼Œæˆ‘ä»¬å°†ç¡®å®šè½¬æ¢çš„æ¥æºï¼Œç„¶åæ£€æŸ¥æ˜¯å¦å·²å°†æ•°å­—åˆ†é…ç»™è¯¥è®¿é—®è€…ã€‚ å¦‚æœè®¿å®¢é¦–å…ˆè®¿é—®äº†è¯¥ç«™ç‚¹ï¼Œåˆ™æˆ‘ä»¬ä¸ºä»–åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œç„¶åæˆ‘ä»¬ä»ä¸è¯¥å¼•èæ¥æºç›¸å…³çš„æ•°å­—æ± ä¸­ä¸ºä»–åˆ†é…ä¸€ä¸ªæ•°å­—ã€‚ å°†æ¥ï¼Œå½“è®¿å®¢è¿”å›è¯¥ç«™ç‚¹æ—¶ï¼Œæˆ‘ä»¬ä¼šæ›´æ—©æ˜¾ç¤ºåˆ†é…ç»™ä»–çš„å·ç ã€‚ <br><br> æˆ‘æƒ³ä¸“æ³¨äºé€šè¯è®°å½•ã€‚ æ›¿æ¢å·ç ï¼Œå°†å…¶åˆ†é…ç»™ç”¨æˆ·æ˜¯ä¸€ä¸ªæŠ€æœ¯é—®é¢˜ï¼Œä¸»è¦çš„äº‹æƒ…æ˜¯èƒ½å¤Ÿæ¯”è¾ƒç‰¹å®šçš„å‘¼å«å’Œå½“å‰åˆ†é…ç»™ç”¨æˆ·çš„å·ç ã€‚ å¦‚æœæ‰€ä½¿ç”¨çš„ç”µè¯å…è®¸æ‚¨è¿ç»­æ¥æ”¶æ­£åœ¨è¿›è¡Œçš„å‘¼å«çš„è¯¦ç»†ä¿¡æ¯ï¼Œç„¶åçŸ¥é“æ‹¨æ‰“ç‰¹å®šå·ç çš„æ—¶åˆ»ï¼Œå¹¶ä¸”çŸ¥é“é‚£ä¸ªæ—¶åˆ»åœ¨å“ªä¸ªç”¨æˆ·çš„ç«™ç‚¹ä¸Šæ˜¾ç¤ºäº†å“ªä¸ªå·ç çš„ä¿¡æ¯ï¼Œåˆ™å¯ä»¥åœ¨Google Analyticsï¼ˆåˆ†æï¼‰ä¸­å¯åŠ¨äº‹ä»¶çš„åˆ›å»ºå¹¶å°†å…¶ä¸ROKå…³è”ã€‚ <br><br><h3> ç»“æ„å½¢å¼ </h3><br><ol><li>  ct-server.ru-å¯æ‰§è¡Œçš„WebæœåŠ¡è„šæœ¬å°†æ”¾ç½®åœ¨æ­¤å¤„ï¼Œè¯¥æ•°æ®åº“æ˜¯ç”¨äºå­˜å‚¨æˆ¿é—´è®¾ç½®å’Œè®°å½•è®¿å®¢çš„æ•°æ®åº“ï¼› </li><li>  Refer-to-site-with-ct-code.ru-åœ¨æ­¤ç«™ç‚¹ä¸Šï¼Œæˆ‘ä»¬å°†æ¨¡æ‹Ÿä»æœç´¢ç½‘ç»œçš„è¿‡æ¸¡ï¼› </li><li>  site-with-ct-code.ru-å°†æ”¾ç½®æ•°å­—æ›¿æ¢è„šæœ¬çš„ç½‘ç«™ã€‚ </li></ol><br><h3> è®©æˆ‘ä»¬å¼€å§‹å§ </h3><br> ä¸‹é¢çš„ç¤ºä¾‹å°†åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šå®ç°ã€‚ <br><br> åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿä¸»æœº<b>site-with-ct-code.ru</b> ï¼Œåœ¨å…¶ä¸­æ”¾ç½®ä»¥ä¸‹å†…å®¹çš„<b>index.html</b>æ–‡ä»¶ã€‚ <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'utf-8'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>CT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://ct-server.ru/script.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//  google id document.cookie = '_ga=GA1.2.1212121212.1212121212; expires=Thu, 18 Dec 2077 12:00:00 UTC; path=/'; </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'calltracking'</span></span></span><span class="hljs-tag">&gt;</span></span>79000000000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br> ä»ç¤ºä¾‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿æ¥äº†ä¸€ä¸ªå¤–éƒ¨è„šæœ¬<b><a href="">ct-server.ru/script.js</a></b> ï¼Œå®ƒå°†åœ¨<b>site-with-ct-code.ru</b>å’Œ<b>ct-server.ru</b>ä¹‹é—´â€œé€šä¿¡â€ï¼Œå¹¶ä¸ç«™ç‚¹çš„DOMæ ‘è¿›è¡Œäº¤äº’<b>site-with-ct-code.ru</b> ã€‚ è¯¥æ•°å­—å°†æ›¿æ¢ä¸ºå…ƒç´ çš„ID-â€œ calltrackingâ€ã€‚ <br><br> ç°åœ¨åˆ›å»ºä¸€ä¸ª<b>Refer-to-site-with-ct-code.ru</b> ï¼Œå®ƒå°†åŒ…å«ä¸€ä¸ªæŒ‡å‘site-with-ct-code.ruçš„é“¾æ¥ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ£€æŸ¥ä»å¼•èæ¥æºç½‘å€è½¬æ¢æ—¶çš„ç®¡è„šç¼–å·ã€‚ <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'utf-8'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>CT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://site-with-ct-code.ru"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br> ä¹‹åï¼Œæˆ‘ä»¬å°†å¯åŠ¨ä¸»æœº<b>ct-server.ru</b> ï¼Œå®ƒå°†å…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š <br><br>  index.php-å¯æ‰§è¡Œè„šæœ¬æ–‡ä»¶ï¼Œå°†æ¥å—æ¥è‡ªsite-with-ct-code.ruçš„Postè¯·æ±‚å¹¶ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼› <br><br>  script.js-å°†åœ¨å°†æ‰§è¡Œæ•°å­—æ›¿æ¢çš„ç«™ç‚¹ä¸Šè¿æ¥çš„è„šæœ¬æ–‡ä»¶ã€‚ <br><br><h3> èµ„æ–™åº“ </h3><br> æˆ‘ä»¬å°†éœ€è¦åˆ›å»ºä¸¤ä¸ªæ¿ã€‚ åœ¨<b>ct</b>è¡¨ä¸­ï¼Œæˆ‘ä»¬å°†å­˜å‚¨æ•°å­—å’Œå®ƒä»¬çš„æ˜¾ç¤ºè®¾ç½®ï¼Œåœ¨<b>æ•°å­—</b>è¡¨ä¸­ï¼Œæˆ‘ä»¬å°†è®°å½•æ•°å­—çš„æ˜¾ç¤ºã€‚ <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`refer`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`utm`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`host`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`ga`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`login`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br> å¯¹æ·»åŠ çš„å­—æ®µçš„ç®€çŸ­è¯´æ˜ï¼š <br><br> ç”µè¯-æ›¿æ¢çš„ç”µè¯å·ç ï¼› <br> å‚è€ƒ-è½¬æ¢çš„æ¥æºï¼› <br>  utm-é“¾æ¥åˆ°åº”è¯¥è¿›è¡Œæ•°å­—æ›¿æ¢çš„é¡µé¢ï¼› <br> ä¸»æœº-æ•°å­—æ›¿æ¢è„šæœ¬æ‰€åœ¨çš„ç½‘ç«™ï¼› <br>  ga-Google Analyticsï¼ˆåˆ†æï¼‰è®¡æ•°å™¨çš„IDï¼› <br>  login-å·ç æ‰€æœ‰è€…çš„ç™»å½•åã€‚ <br><br> ç”¨æ•°æ®å¡«å……æ¿ã€‚ <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span>, <span class="hljs-string"><span class="hljs-string">`refer`</span></span>, <span class="hljs-string"><span class="hljs-string">`utm`</span></span>, <span class="hljs-string"><span class="hljs-string">`host`</span></span>, <span class="hljs-string"><span class="hljs-string">`ga`</span></span>, <span class="hljs-string"><span class="hljs-string">`login`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000001'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/?utm_medium=cpc'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000002'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://refer-to-site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000003'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://refer-to-site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000004'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://refer-to-site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000005'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>);</code> </pre><br><img src="https://i.ibb.co/WxKt63X/screen4.png" alt="å›¾ç‰‡"><br><br> ç°åœ¨åˆ›å»ºè½¦ç‰Œã€‚ <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`numbers`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`ct_user`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`refer`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`gid`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`page`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`time`</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`numbers`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`numbers`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT;<span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br> åœ¨æ­¤é¢æ¿ä¸­ï¼Œæˆ‘ä»¬å°†è®°å½•è¯¥ç«™ç‚¹ä¸Šæ˜¾ç¤ºå“ªä¸ªè®¿å®¢ï¼Œå“ªä¸ªå·ç ä»¥åŠä»€ä¹ˆæ—¶é—´ã€‚ å°†æ¥ï¼Œå¯ä»¥å°†è¿™äº›æ•°æ®ä¸é€šè¯è®°å½•è¿›è¡Œæ¯”è¾ƒä»¥å¯åŠ¨ç›®æ ‡æ“ä½œ-å‘Google Analyticsï¼ˆåˆ†æï¼‰å‘é€äº‹ä»¶ï¼Œåœ¨CRMä¸­åˆ›å»ºé”€å”®çº¿ç´¢ï¼Œå‘é€ç”µå­é‚®ä»¶ç­‰ã€‚ <br><br> ç”µè¯-ç”µè¯å·ç ï¼› <br>  ct_user-è®¿é—®è€…IDï¼› <br> å‚è€ƒ-è½¬æ¢çš„æ¥æºï¼› <br>  gid-Google Analyticsï¼ˆåˆ†æï¼‰cookie <br>  page-æ˜¾ç¤ºå·ç çš„é¡µé¢ï¼› <br> æ—¶é—´-æ•°å­—æ˜¾ç¤ºæ—¶é—´ã€‚ <br><br><h3> åˆ›å»ºä¸€ä¸ªè¯·æ±‚å¤„ç†ç¨‹åº </h3><br>  ct-server.ru WebæœåŠ¡ä¸æ‰˜ç®¡è„šæœ¬çš„ç«™ç‚¹ä¹‹é—´çš„äº¤äº’å°†é€šè¿‡è·¨åŸŸXHRï¼ˆXMLHttpRequestï¼‰POSTè¯·æ±‚å®Œæˆã€‚ <br><br>  <b>è®©æˆ‘ä»¬</b>æ‰“å¼€<b>ä¹‹å‰</b>åˆ›å»ºçš„æ–‡ä»¶<b>ct-server.ru/index.phpï¼Œ</b>å¹¶æ·»åŠ æ£€æŸ¥ä»¥ä»å…è®¸çš„ä¸»æœºæ¥æ”¶æ•°æ®ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">site-with-ct-code.ru</a></b> ï¼Œ <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">site-with-ct-code2.ru</a></b>å’Œ<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">site-with -ct-code3.ru</a></b> ã€‚ <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">"HTTP_ORIGIN"</span></span>]) === <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { $host = $_SERVER[<span class="hljs-string"><span class="hljs-string">"HTTP_ORIGIN"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//   $allowHosts = array("http://site-with-ct-code.ru", "http://site-with-ct-code2.ru", "http://site-with-ct-code3.ru"); if (in_array($host, $allowHosts, true) === true) { header('Access-Control-Allow-Origin: ' . $host); header('Access-Control-Allow-Credentials: true'); header('Access-Control-Allow-Methods: POST'); header('Access-Control-Allow-Headers: Content-Type'); //    post-      } if ($_SERVER["REQUEST_METHOD"] === "OPTIONS") { exit; } } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br> æˆ‘ä»¬å†™å…¥æ¥è‡ªsite-with-ct-code.ruçš„POSTè¯·æ±‚çš„å˜é‡å€¼ <br><br><pre> <code class="php hljs">$phone = $_POST[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>]; $ct_user = $_POST[<span class="hljs-string"><span class="hljs-string">"ct_user"</span></span>]; $gid = $_POST[<span class="hljs-string"><span class="hljs-string">"gid"</span></span>]; $refer = $_POST[<span class="hljs-string"><span class="hljs-string">"ref"</span></span>]; $page = $_POST[<span class="hljs-string"><span class="hljs-string">"page"</span></span>];</code> </pre><br>  Cook _gaçš„æ ¼å¼ä¸º_ga = GA1.2.1212121212.12.1212121212ï¼Œæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºâ€œ 1212121212.121212121121212â€ã€‚ <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($gid) { $pos = strpos($gid, <span class="hljs-string"><span class="hljs-string">'.'</span></span>, strpos($gid, <span class="hljs-string"><span class="hljs-string">'.'</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>); $gid = substr($gid, $pos + <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre><br> æˆ‘ä»¬å°†å»ºç«‹åˆ°å…ˆå‰åˆ›å»ºè¡¨çš„æ•°æ®åº“çš„è¿æ¥ã€‚ <br><br><pre> <code class="php hljs">$conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mysqli(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, <span class="hljs-string"><span class="hljs-string">"root"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"calltracking"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($conn-&gt;connect_error) { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">"Connection failed: "</span></span> . $conn-&gt;connect_error); }</code> </pre><br> ä¸WebæœåŠ¡çš„äº¤äº’å°†é€šè¿‡ä¸¤ç§æ–¹æ³•<b>-get_num_first</b>å’Œ<b>get_num</b> ã€‚ <br><br> å½“è®¿é—®è€…é¦–æ¬¡ä¸ç«™ç‚¹è¿›è¡Œäº¤äº’ä»¥é€šè¿‡æ ¹æ®æ¡ä»¶ï¼ˆé‚®ä»¶ï¼Œå¼•èæ¥æºç½‘å€ï¼Œutmï¼Œä¸»æœºï¼‰ä»æ•°æ®åº“ä¸­é€‰æ‹©ä¸€ä¸ªå·ç æ—¶ï¼Œå°†è°ƒç”¨<b>get_num_first</b>æ–¹æ³•ã€‚ å¦‚æœé€‰æ‹©ç»“æœè¿”å›ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†æ˜¾ç¤ºç”µè¯å·ç ã€‚ <br><br> æ­¤å¤–ï¼Œæˆ‘ä»¬é€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google Measurement Protocol</a>å°†äº‹ä»¶å‘é€åˆ°Google Analyticsï¼ˆåˆ†æï¼‰ã€‚ ç›¸åŒçš„æ–¹æ³•é€‚ç”¨äºè·Ÿè¸ªè„±æœºæ“ä½œï¼Œå°†æ¥å¯ä»¥åœ¨æ¯”è¾ƒå·ç è¡¨ä¸­çš„å‘¼å«æ—¥å¿—å’Œå·ç æ—¥å¿—æ—¶ä½¿ç”¨ã€‚ <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_POST[<span class="hljs-string"><span class="hljs-string">'method'</span></span>] == <span class="hljs-string"><span class="hljs-string">'get_num_first'</span></span>) { $sql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM `ct` where `host` = '"</span></span> . $host . <span class="hljs-string"><span class="hljs-string">"' and `refer` = '"</span></span> . $refer . <span class="hljs-string"><span class="hljs-string">"' and `utm` = '"</span></span> . $page . <span class="hljs-string"><span class="hljs-string">"' ORDER BY RAND() LIMIT 1 "</span></span>; $result = $conn-&gt;query($sql); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result-&gt;num_rows &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($row = $result-&gt;fetch_assoc()) { print_r($row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>]); $event = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://www.google-analytics.com/collect?v=1&amp;tid=UA-12345678-1&amp;cid='</span></span> . $gid . <span class="hljs-string"><span class="hljs-string">'&amp;t=event&amp;ec=GetNumber&amp;ea=number&amp;z='</span></span> . $row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>] . <span class="hljs-string"><span class="hljs-string">''</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//echo "0"; $sql = "SELECT * FROM `ct` where `host` = '" . $host . "' and `refer` = '" . $refer . "' ORDER BY RAND() LIMIT 1 "; $result = $conn-&gt;query($sql); print_r($row["phone"]); $event = file_get_contents('https://www.google-analytics.com/collect?v=1&amp;tid=UA-12345678-1&amp;cid=' . $gid . '&amp;t=event&amp;ec=GetNumber&amp;ea=number&amp;z=' . $row["phone"] . ''); } }</span></span></code> </pre><br> å¿…é¡»ä½¿ç”¨<b>get_num</b>æ–¹æ³•æ‰èƒ½åœ¨numbersè¡¨ä¸­<b>è®°å½•</b>æ¡ç›®ã€‚ <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_POST[<span class="hljs-string"><span class="hljs-string">'method'</span></span>] == <span class="hljs-string"><span class="hljs-string">'get_num'</span></span>) { $sql = <span class="hljs-string"><span class="hljs-string">"INSERT INTO `numbers` (`phone`, `ct_user`, `gid`, `refer`,`page`) VALUES ( '"</span></span> . $phone . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $ct_user . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $gid . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $refer . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $page . <span class="hljs-string"><span class="hljs-string">"');"</span></span>; $result = $conn-&gt;query($sql); $sql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM `numbers` where `ct_user` = '"</span></span> . $ct_user . <span class="hljs-string"><span class="hljs-string">"' ORDER BY `id` DESC LIMIT 1 "</span></span>; $result = $conn-&gt;query($sql); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result-&gt;num_rows &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($row = $result-&gt;fetch_assoc()) { print_r($row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>]); $event = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://www.google-analytics.com/collect?v=1&amp;tid=UA-12345678-1&amp;cid='</span></span> . $gid . <span class="hljs-string"><span class="hljs-string">'&amp;t=event&amp;ec=ShowNumber&amp;ea=number&amp;z='</span></span> . $row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>] . <span class="hljs-string"><span class="hljs-string">''</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//echo "0"; } } $conn-&gt;close();</span></span></code> </pre><br><h3> æ•°å­—æ›¿æ¢è„šæœ¬ </h3><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è½¬åˆ°<b>ct-server.ru/script.js</b>è„šæœ¬ï¼Œæˆ‘ä»¬å°†å…¶è¿æ¥åˆ°site-with-ct-code.ru <br><br> é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªå‡½æ•°-ç”¨äºåˆ›å»ºçš„<b>setcookie</b>å’Œç”¨äºè¯»å–cookieçš„<b>getcookie</b> ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨å®ƒä»¬æ¥è®°å½•å¹¶è·å–ç”¨æˆ·çš„cookie IDå’Œç”µè¯å·ç ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  function setcookie(phone, value, expires, path, domain, secure) { document.cookie = phone + "=" + escape(value) + (expires ? "; expires=" + new Date(expires) : "") + (path ? "; path=" + path : "") + (domain ? "; domain=" + domain : "") + (secure ? "; secure" : ""); } //  function getcookie(phone) { var cookie = " " + document.cookie; var search = " " + phone + "="; var setStr = null; var offset = 0; var end = 0; if (cookie.length &gt; 0) { offset = cookie.indexOf(search); if (offset != -1) { offset += search.length; end = cookie.indexOf(";", offset); if (end == -1) { end = cookie.length; } setStr = unescape(cookie.substring(offset, end)); } } return setStr; }</span></span></code> </pre><br> ä¹‹åï¼Œæ·»åŠ <b>makeid</b>å‡½æ•°ä»¥ä¸ºç”¨æˆ·ç”ŸæˆIDã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// id  function makeid(length) { var result = ""; var user_id = "abcdefghijklmnopqrstuvwxyz0123456789"; var user_idLength = user_id.length; for (var i = 0; i &lt; length; i++) { result += user_id.charAt(Math.floor(Math.random() * user_idLength)); } return result; }</span></span></code> </pre><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥ç”ŸæˆåŒ…å«33ä½ç”¨æˆ·IDçš„cookieã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// id  function generateuser_id() { var ct_user_id = makeid(33); setcookie("ct_user", ct_user_id, new Date().getTime() + 60 * 60 * 1000); //  }</span></span></code> </pre><br> ç”Ÿæˆçš„<b>ct_user</b> cookieå­˜å‚¨1å°æ—¶ã€‚ <br><br> æˆ‘ä»¬ç»§ç»­é€šè¿‡<b>get_num_first</b>æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ•°å­—è¯·æ±‚ã€‚  ct-server.ruäº§ç”Ÿçš„æ•°å­—å°†è¢«å†™å…¥Cookie 1å°æ—¶ï¼Œç„¶åæˆ‘ä»¬ç”¨å…ƒç´ çš„IDè¿›è¡Œé¡µé¢ä¸Šæ•°å­—çš„ç¬¬ä¸€æ¬¡æ›¿æ¢ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    ,  ,       id  function getNumberFirstTime() { var method = "get_num_first"; var ct_user = getcookie("ct_user"); var gid = getcookie("_ga"); var ref = document.referrer; var host = window.location.origin; var page = document.location.href; var xhr = new XMLHttpRequest(); var body = "&amp;method=" + encodeURIComponent(method) + "&amp;page=" + encodeURIComponent(page) + "&amp;ct_user=" + encodeURIComponent(ct_user) + "&amp;ref=" + encodeURIComponent(ref) + "&amp;host=" + encodeURIComponent(host) + "&amp;gid=" + encodeURIComponent(gid); xhr.open("POST", "http://ct-server.ru", true); xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"); xhr.withCredentials = true; xhr.send(body); xhr.onreadystatechange = function() { //console.log(xhr.responseText); var t = xhr.responseText; document.getElementById("calltracking").innerHTML = t; setcookie("phone", t, new Date().getTime() + 60 * 60 * 1000); //  }; }</span></span></code> </pre><br> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šå®šæœŸå°†æ˜¾ç¤ºçš„æ•°å­—ï¼Œç”¨æˆ·IDï¼Œé¡µé¢åœ°å€ï¼ŒGoogle Analyticsï¼ˆåˆ†æï¼‰Cookieå€¼ï¼Œå¼•èæ¥æºå‘é€åˆ°ct-server.ruã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNumberPeriodically</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> method = <span class="hljs-string"><span class="hljs-string">"get_num"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ct_user = getcookie(<span class="hljs-string"><span class="hljs-string">"ct_user"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phone = getcookie(<span class="hljs-string"><span class="hljs-string">"phone"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gid = getcookie(<span class="hljs-string"><span class="hljs-string">"_ga"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ref = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.referrer; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> page = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location.href; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> host = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.origin; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = <span class="hljs-string"><span class="hljs-string">"&amp;method="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(method) + <span class="hljs-string"><span class="hljs-string">"&amp;page="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(page) + <span class="hljs-string"><span class="hljs-string">"&amp;ct_user="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(ct_user) + <span class="hljs-string"><span class="hljs-string">"&amp;ref="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(ref) + <span class="hljs-string"><span class="hljs-string">"&amp;host="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(host) + <span class="hljs-string"><span class="hljs-string">"&amp;phone="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(phone) + <span class="hljs-string"><span class="hljs-string">"&amp;gid="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(gid); xhr.open(<span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-string"><span class="hljs-string">"http://ct-server.ru"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.setRequestHeader(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); xhr.withCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.send(body); xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//console.log(xhr.responseText); var t = xhr.responseText; //document.getElementById('calltracking').innerHTML = t; }; }</span></span></code> </pre><br> æœ€åï¼Œæˆ‘ä»¬æ·»åŠ äº†sendToCalltrackingå‡½æ•°ï¼Œè¯¥å‡½æ•°æ£€æŸ¥cookieï¼Œç”µè¯å·ç å’Œç”¨æˆ·IDçš„å­˜åœ¨ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendToCalltracking</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ggg = getcookie(<span class="hljs-string"><span class="hljs-string">"ct_user"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ccc = getcookie(<span class="hljs-string"><span class="hljs-string">"phone"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gac = getcookie(<span class="hljs-string"><span class="hljs-string">"_ga"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> ggg === <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> || ggg === <span class="hljs-literal"><span class="hljs-literal">null</span></span> || ccc === <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> || ccc === <span class="hljs-literal"><span class="hljs-literal">null</span></span> || ccc.length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || ggg.length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || ccc === <span class="hljs-string"><span class="hljs-string">""</span></span> || ggg === <span class="hljs-string"><span class="hljs-string">""</span></span> ) { <span class="hljs-comment"><span class="hljs-comment">//console.log('false'); generateuser_id(); getNumberFirstTime(); } else { //console.log('true'); document.getElementById("calltracking").innerHTML = ccc; getNumberPeriodically(); } }</span></span></code> </pre><br> åœ¨è„šæœ¬çš„æœ€å¼€å§‹ï¼Œæˆ‘ä»¬ç§°ä¸ºå‡½æ•°è®¡æ—¶å™¨ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myTimer = setTimeout(sendToCalltracking, <span class="hljs-number"><span class="hljs-number">500</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        setInterval(sendToCalltracking, 1 * 60 * 1000);</span></span></code> </pre><br><img src="https://i.ibb.co/MDhmBRn/screen1.png" alt="å›¾ç‰‡"><br><br> å¦‚æœåœ¨ä¸‹ä¸€ä¸ªæ“ä½œæœŸé—´åˆ é™¤äº†cookieï¼Œè¯¥åŠŸèƒ½å°†æ ¹æ®ä¸»æœºå’Œæ¥æºæ”¶åˆ°çš„é€‰æ‹©ä¸ºè®¿é—®è€…åˆ†é…ä¸€ä¸ªæ–°çš„cookieã€‚ å¦å¤–ï¼Œå¯ä»¥å°†æ¥æ”¶åˆ°çš„å€¼å†™å…¥localStorageæµè§ˆå™¨ã€‚ <br><br><img src="https://i.ibb.co/4KfXYVD/screen2.png" alt="å›¾ç‰‡"><br><br> æ¯åˆ†é’Ÿä¸€åˆ†é’Ÿï¼Œè„šæœ¬å°†å‘é€cookieå·çš„å€¼å’Œç”¨æˆ·IDï¼Œä»¥æŒ‡ç¤ºåº”ç”¨äº†è¯¥cookieçš„é¡µé¢ï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½å®ƒã€‚ å¯ä»¥ç†è§£ï¼Œè„šæœ¬å°†æ”¾ç½®åœ¨åŸŸçš„æ‰€æœ‰é¡µé¢ä¸Šã€‚ <br><br><img src="https://i.ibb.co/q0wGMG3/screen3.png" alt="å›¾ç‰‡"><br><br> åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºç”¨äºæ·»åŠ å’Œé…ç½®æ•°å­—çš„ç®€å•ç•Œé¢çš„å¼€å‘ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN473372/">https://habr.com/ru/post/zh-CN473372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN473358/index.html">ä½¿ç”¨åŸºç¡€æ¶æ„ä½œä¸ºä»£ç æ–¹æ³•å®‰è£…å’Œé…ç½®Nexus Sonatype</a></li>
<li><a href="../zh-CN473362/index.html">GSoCç»éªŒï¼šä¸¤ï¼ˆä¸‰ï¼‰åå­¦ç”Ÿå¦‚ä½•çœŸæ­£æ”¹å–„CRIUä»£ç </a></li>
<li><a href="../zh-CN473364/index.html">æœ‰ä¸€ä¸ªè™¾è™é±¼åœ¨æ‘‡æ‘†ï¼šé”€å”®å­£èŠ‚ä¸­çš„ç”µå­å•†åŠ¡æ¸…å•</a></li>
<li><a href="../zh-CN473366/index.html">æˆ‘çš„æ™ºèƒ½ç”µè§†ä¸ºæ‚¨å‡†å¤‡äº†ä»€ä¹ˆï¼Ÿ è¿˜æ˜¯ç”µè§†é‡Œå¡æ»¡äº†ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN473368/index.html">MIROæ˜¯ä¸€ä¸ªå¼€æ”¾çš„å®¤å†…æœºå™¨äººå¹³å°ã€‚ ç¬¬3éƒ¨åˆ†-è½¯ä»¶ç»„ä»¶ï¼šESP8266</a></li>
<li><a href="../zh-CN473374/index.html">æˆ‘ä»¬å¦‚ä½•å°†YouTube Liveä¸Zoomé›†æˆåœ¨ä¸€èµ·</a></li>
<li><a href="../zh-CN473376/index.html">Windows 10Xä¸Šçš„æ–‡æ¡£æ³„æ¼åˆ°ç½‘ç»œä¸Š-å…·æœ‰ä¸¤ä¸ªå±å¹•çš„è®¾å¤‡çš„æ–°ç‰ˆOS</a></li>
<li><a href="../zh-CN473378/index.html">æ¶æ„è½¯ä»¶è®¸å¯åè®®</a></li>
<li><a href="../zh-CN473380/index.html">4.è´Ÿè½½æµ‹è¯•Check Point Maestro</a></li>
<li><a href="../zh-CN473384/index.html">3DToday Festï¼šè¿‡å»ï¼ˆå°†ä¼šï¼‰ã€‚ ä¼šå‘˜å°è±¡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>