<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🤝‍👨🏽 💪🏾 👿 Mengetik DSL dalam TypeScript dari JSX 👵🏾 🏢 👩‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TypeScript memiliki dukungan bawaan untuk sintaks JSX dan kompiler TypeScript menyediakan alat yang berguna untuk mengatur proses kompilasi JSX. Pada ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengetik DSL dalam TypeScript dari JSX</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433348/"><p><img src="https://habrastorage.org/webt/3r/du/6y/3rdu6yaetgj9r_vrlzdnsrdk3ci.png"></p><br><p>  TypeScript memiliki dukungan bawaan untuk sintaks JSX dan kompiler TypeScript menyediakan alat yang berguna untuk mengatur proses kompilasi JSX.  Pada dasarnya, ini memungkinkan untuk menulis DSL yang diketik menggunakan JSX.  Artikel ini akan membahas persis ini - cara menulis DSL <del>  dari r </del>  menggunakan JSX.  Tertarik, saya minta kucing. </p><a name="habracut"></a><br><p>  <strong>→</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Repositori dengan contoh yang sudah jadi.</a> </p><br><p>  Dalam artikel ini, saya tidak akan menunjukkan kemungkinan dengan contoh yang terkait dengan web, Bereaksi, dan sejenisnya.  Contoh tidak dari web akan menunjukkan bahwa kemampuan JSX tidak terbatas pada Bereaksi, komponennya dan generasi html dalam kasus umum.  Pada artikel ini, saya akan menunjukkan bagaimana menerapkan DSL untuk menghasilkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">objek pesan untuk Slack</a> . </p><br><p>  Berikut adalah kode yang kami ambil sebagai dasar.  Ini adalah pabrik pesan kecil dengan jenis yang sama: </p><br><pre><code class="javascript hljs">interface Story { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: string link: string publishedAt: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> author: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: string, <span class="hljs-attr"><span class="hljs-attr">avatarURL</span></span>: string } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> template = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">username: string, stories: Story[]</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">`:wave:  </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${username}</span></span></span><span class="hljs-string">,    .`</span></span>, <span class="hljs-attr"><span class="hljs-attr">attachments</span></span>: stories.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ title, <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'#000000'</span></span>, <span class="hljs-attr"><span class="hljs-attr">title_link</span></span>: s.link, <span class="hljs-attr"><span class="hljs-attr">author_name</span></span>: s.author.name, <span class="hljs-attr"><span class="hljs-attr">author_icon</span></span>: s.author.avatarURL, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">`  _</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${s.publishedAt}</span></span></span><span class="hljs-string">_.`</span></span> }) })</code> </pre> <br><p>  Tampaknya terlihat bagus, tetapi ada satu hal yang dapat ditingkatkan secara signifikan - <strong>keterbacaan</strong> .  Misalnya, perhatikan properti <code>color</code> tidak dapat dipahami, dua bidang untuk judul ( <code>title</code> dan <code>title_link</code> ), atau garis bawah dalam <code>text</code> (teks di dalam <code>_</code> akan <em>dicetak miring</em> ).  Semua ini mencegah kita untuk memisahkan konten dari detail gaya, sehingga sulit untuk menemukan apa yang penting.  Dan dengan masalah seperti itu, DSL seharusnya membantu. </p><br><p>  Berikut adalah contoh yang sama yang baru saja ditulis dalam JSX: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> template = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">username: string, stories: Story[]</span></span></span><span class="hljs-function">) =&gt;</span></span> &lt;message&gt; :wave:  ${username},    . {stories.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s</span></span></span><span class="hljs-function"> =&gt;</span></span> &lt;attachment color=<span class="hljs-string"><span class="hljs-string">'#000000'</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">author</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">icon</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{s.author.avatarURL}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{s.author.name}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">author</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;title link={s.link}&gt;{s.title}&lt;<span class="hljs-regexp"><span class="hljs-regexp">/title&gt;   &lt;i&gt;{s.publishedAt}&lt;/i</span></span>&gt;. &lt;<span class="hljs-regexp"><span class="hljs-regexp">/attachment&gt; )} &lt;/m</span></span>essage&gt;</code> </pre> <br><p>  Jauh lebih baik!  Segala sesuatu yang harus hidup bersama telah bersatu, detail gaya dan konten jelas dipisahkan - keindahan dalam satu kata. </p><br><h3 id="pishem-dsl">  Menulis DSL </h3><br><h4 id="nastraivaem-proekt">  Sesuaikan proyek </h4><br><p>  Pertama, Anda perlu mengaktifkan JSX dalam proyek dan memberi tahu kompiler bahwa kami tidak menggunakan Bereaksi, bahwa JSX kami perlu dikompilasi secara berbeda. </p><br><pre> <code class="json hljs">// tsconfig.json { <span class="hljs-attr"><span class="hljs-attr">"compilerOptions"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"jsx"</span></span>: <span class="hljs-string"><span class="hljs-string">"react"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"jsxFactory"</span></span>: <span class="hljs-string"><span class="hljs-string">"Template.create"</span></span> } }</code> </pre> <br><p>  <code>"jsx": "react"</code> termasuk dukungan JSX dalam proyek dan kompiler mengkompilasi semua elemen JSX ke dalam panggilan <code>React.createElement</code> .  Dan opsi <code>"jsxFactory"</code> mengkonfigurasi kompiler untuk menggunakan elemen JSX dari pabrik kami. </p><br><p>  Setelah pengaturan sederhana ini, kode formulir: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Template <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./template'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> JSX = <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">message</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Text with </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">i</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">italic</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">i</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">.</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">message</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>  akan dikompilasi </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Template = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./template'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> JSX = Template.create(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">'Text with '</span></span>, Template.create(<span class="hljs-string"><span class="hljs-string">'i'</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>), <span class="hljs-string"><span class="hljs-string">'.'</span></span>);</code> </pre> <br><h4 id="opishem-jsx-tegi">  Jelaskan Tag JSX </h4><br><p>  Sekarang setelah kompiler tahu apa yang harus dikompilasi dengan JSX, kita perlu mendeklarasikan tag itu sendiri.  Untuk melakukan ini, kami menggunakan salah satu fitur keren TypeScript - yaitu, deklarasi namespace lokal.  Untuk kasus dengan JSX, TypeScript mengharapkan bahwa proyek memiliki namespace <code>JSX</code> (lokasi spesifik file tidak masalah) dengan antarmuka <code>IntrinsicElements</code> di mana tag dijelaskan.  Compiler menangkap mereka dan menggunakannya untuk memeriksa tipe dan untuk petunjuk. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// jsx.d.ts declare namespace JSX { interface IntrinsicElements { i: {} message: {} author: { icon: string } title: { link?: string } attachment: { color?: string } } }</span></span></code> </pre> <br><p>  Di sini kami mendeklarasikan semua tag JSX untuk DSL kami dan semua atributnya.  Bahkan, nama kunci di antarmuka adalah nama dari tag itu sendiri, yang akan tersedia dalam kode.  Nilai adalah deskripsi atribut yang tersedia.  Beberapa tag (dalam kasus kami) mungkin tidak memiliki atribut, yang lain mungkin opsional atau bahkan perlu. </p><br><h4 id="sobstvenno-fabrika--templatecreate">  Pabrik itu sendiri - <code>Template.create</code> </h4><br><p>  Pabrik kami dari <code>tsconfig.json</code> adalah topik pembicaraan.  Ini akan digunakan dalam runtime untuk membuat objek. </p><br><p>  Dalam kasus paling sederhana, mungkin terlihat seperti ini: </p><br><pre> <code class="javascript hljs">type Kinds = keyof JSX.IntrinsicElements <span class="hljs-comment"><span class="hljs-comment">//    type Attrubute&lt;K extends Kinds&gt; = JSX.IntrinsicElements[K] //    export const create = &lt;K extends Kinds&gt;(kind: K, attributes: Attrubute&lt;K&gt;, ...children) =&gt; { switch (kind) { case 'i': return `_${chidlren.join('')}_` default: // ... } }</span></span></code> </pre> <br><p>  Tag yang hanya menambah gaya pada teks di dalamnya mudah untuk ditulis (dalam kasus kami): pabrik kami hanya membungkus isi tag dalam string dengan <code>_</code> di kedua sisi.  Masalah dimulai dengan tag kompleks.  Sebagian besar waktu saya habiskan bersama mereka, mencari solusi yang lebih bersih.  Apa masalah sebenarnya? </p><br><p>  Dan kompiler mencetak tipe <code>&lt;message&gt;Text&lt;/message&gt;</code> ke <code>any</code> .  Yang tidak mendekati DSL yang diketik, yah, oke, bagian kedua dari masalahnya adalah bahwa jenis semua tag akan menjadi satu setelah melewati pabrik - ini adalah batasan JSX itu sendiri (dalam Bereaksi, semua tag dikonversi ke ReactElement). </p><br><p>  Generik pergi untuk menyelamatkan! </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// jsx.d.ts declare namespace JSX { interface Element { toMessage(): { text?: string attachments?: { text?: string author_name?: string author_icon?: string title_link?: string color?: string }[] } } interface IntrinsicElements { i: {} message: {} author: { icon: string } title: { link?: string } attachment: { color?: string } } }</span></span></code> </pre> <br><p>  Hanya <code>Element</code> ditambahkan dan sekarang kompiler akan menampilkan semua tag JSX ke tipe <code>Element</code> .  Ini juga perilaku kompiler standar - gunakan <code>JSX.Element</code> sebagai jenis untuk semua tag. </p><br><p>  <code>Element</code> kami hanya memiliki satu metode umum - casting ke tipe objek pesan.  Sayangnya, ini tidak selalu berfungsi, hanya pada <code>&lt;message/&gt;</code> tingkat atas dan ini akan habis. </p><br><p>  Dan di bawah spoiler adalah versi lengkap dari pabrik kami. </p><br><div class="spoiler">  <b class="spoiler_title">Kode pabrik itu sendiri</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { flatten } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span> type Kinds = keyof JSX.IntrinsicElements <span class="hljs-comment"><span class="hljs-comment">//    type Attrubute&lt;K extends Kinds&gt; = JSX.IntrinsicElements[K] //    const isElement = (e: any): e is Element&lt;any&gt; =&gt; e &amp;&amp; e.kind const is = &lt;K extends Kinds&gt;(k: K, e: string | Element&lt;any&gt;): e is Element&lt;K&gt; =&gt; isElement(e) &amp;&amp; e.kind === k /*         () */ const buildText = (e: Element&lt;any&gt;) =&gt; e.children.filter(i =&gt; !isElement(i)).join('') const buildTitle = (e: Element&lt;'title'&gt;) =&gt; ({ title: buildText(e), title_link: e.attributes.link }) const buildAuthor = (e: Element&lt;'author'&gt;) =&gt; ({ author_name: buildText(e), author_icon: e.attributes.icon }) const buildAttachment = (e: Element&lt;'attachment'&gt;) =&gt; { const authorNode = e.children.find(i =&gt; is('author', i)) const author = authorNode ? buildAuthor(&lt;Element&lt;'author'&gt;&gt;authorNode) : {} const titleNode = e.children.find(i =&gt; is('title', i)) const title = titleNode ? buildTitle(&lt;Element&lt;'title'&gt;&gt;titleNode) : {} return { text: buildText(e), ...title, ...author, ...e.attributes } } class Element&lt;K extends Kinds&gt; { children: Array&lt;string | Element&lt;any&gt;&gt; constructor( public kind: K, public attributes: Attrubute&lt;K&gt;, children: Array&lt;string | Element&lt;any&gt;&gt; ) { this.children = flatten(children) } /* *          `&lt;message/&gt;` */ toMessage() { if (!is('message', this)) return {} const attachments = this.children.filter(i =&gt; is('attachment', i)).map(buildAttachment) return { attachments, text: buildText(this) } } } export const create = &lt;K extends Kinds&gt;(kind: K, attributes: Attrubute&lt;K&gt;, ...children) =&gt; { switch (kind) { case 'i': return `_${children.join('')}_` default: return new Element(kind, attributes, children) } }</span></span></code> </pre> </div></div><br><p>  <strong>→</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Repositori dengan contoh yang sudah jadi.</a> </p><br><h3 id="vmesto-zaklyucheniya">  Alih-alih sebuah kesimpulan </h3><br><p>  Ketika saya melakukan percobaan ini, tim TypeScript hanya memiliki pemahaman tentang kekuatan dan keterbatasan apa yang mereka lakukan dengan JSX.  Sekarang kemampuannya bahkan lebih besar dan pabrik dapat ditulis bersih.  Jika Anda ingin mencari-cari dan memperbaiki repositori dengan contoh - Selamat datang dengan permintaan tarik. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id433348/">https://habr.com/ru/post/id433348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id433338/index.html">Ikhtisar Produsen Printer 3D Creality</a></li>
<li><a href="../id433340/index.html">Perangkat nirkabel Xiaomi di rumah pintar ioBroker</a></li>
<li><a href="../id433342/index.html">Prosesor Verilog sederhana lainnya</a></li>
<li><a href="../id433344/index.html">Dua keberhasilan ruang pribadi</a></li>
<li><a href="../id433346/index.html">Beralih dari Redshift ke ClickHouse</a></li>
<li><a href="../id433350/index.html">Acara digital di Moskow dari 17 Desember hingga 23 Desember</a></li>
<li><a href="../id433352/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 343 (10 - 16 Desember 2018)</a></li>
<li><a href="../id433354/index.html">Berita dari dunia OpenStreetMap No. 438 (12/04/2018 - 12/10/2018)</a></li>
<li><a href="../id433356/index.html">Penyerang belajar untuk mem-bypass otentikasi dua faktor Yahoo Mail dan Gmail</a></li>
<li><a href="../id433358/index.html">Keakraban dengan pengujian dalam Python. Bagian 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>