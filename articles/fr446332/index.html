<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüíª üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üåßÔ∏è IBM System i (alias AS / 400) - Comment nous avons effectu√© les tests automatiques des applications sur √©cran vert ‚è∫Ô∏è üé∂ üë®üèø‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut Je m'appelle Anton Vorobyov, je suis responsable chez Alfa Bank du d√©veloppement d'applications pour un syst√®me bancaire centralis√©. 

 Dans cet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IBM System i (alias AS / 400) - Comment nous avons effectu√© les tests automatiques des applications sur √©cran vert</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfa/blog/446332/"> Salut  Je m'appelle Anton Vorobyov, je suis responsable chez Alfa Bank du d√©veloppement d'applications pour un syst√®me bancaire centralis√©. <br><br>  Dans cet article, je vais vous expliquer ce que sont les applications d'√©cran vert, pourquoi elles sont n√©cessaires et comment nous leur avons fait des autotests en √©crivant notre propre solution pour cela, ce qui nous a permis d'acc√©l√©rer 11 fois les autotests. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ui/j8/z2/uij8z2alj0kcdqv2wtd_uo4yghq.jpeg"></a> <br><br>  La plateforme AS / 400 (Application System / 400) est n√©e en 1988.  Le premier OS de cette plate-forme est OS / 400, renomm√© plus tard en i5 / OS et encore plus tard en IBM i.  Il n'y a pas si longtemps, elle a f√™t√© son trenti√®me anniversaire. <br><br>  En plongeant dans le monde du d√©veloppement sous le syst√®me d'exploitation IBM i, vous comprenez qu'il ne s'agit en fait pas d '¬´h√©ritage¬ª au sens classique du terme.  Il s'agit d'un environnement diff√©rent, compl√®tement diff√©rent, qui est peu similaire aux syst√®mes Windows ou Unix habituels.  La t√¢che principale de ce syst√®me d'exploitation est d'√™tre aussi productif que possible sur l'√©quipement avec lequel il fonctionne et de ne pas √™tre pratique pour l'utilisateur. <br><br>  √Ä mon humble avis, ce syst√®me d'exploitation peut vous rendre fou de l'inefficacit√© des approches habituelles d'√©criture de code C ++ (jusqu'√† des dizaines de fois la perte de processeur), que certains anti-mod√®les d√©montr√©s dans les manuels sont la meilleure pratique d'un code efficace et la source avec la date d'√©criture pour 1978 non seulement assembler sans probl√®me, mais aussi travailler comme pr√©vu!  Tout cela nous fait jeter un regard neuf sur les approches modernes du d√©veloppement logiciel. <br><a name="habracut"></a><br><h2>  Pr√©sentation </h2><br>  La question de l'am√©lioration de la qualit√© des logiciels en d√©veloppement excite l'esprit de chaque √©quipe de d√©veloppement.  Une de nos √©quipes de cr√©dit, dont la t√¢che est de d√©velopper et d√©velopper la partie Back du module du syst√®me bancaire automatis√© Misys Equation, n'a pas non plus ignor√© ce moment.  La particularit√© de cet ABS est que: <br><br><ul><li>  les premi√®res versions de l'ABS fonctionnaient sous le pr√©d√©cesseur AS / 400 - la plate-forme IBM System / 38 (apparue en 1978) sous le syst√®me d'exploitation CPF - ¬´Control Program Facility¬ª; </li><li>  Il a √©t√© d√©velopp√© depuis les ann√©es 70 du XXe si√®cle, et vous pouvez rencontrer du code √©crit avant votre naissance (beaucoup d'ancien code); </li><li>  les caract√©ristiques du travail avec ABS sont dues √† une int√©gration √©troite avec IBM i, et en raison de la compatibilit√© ascendante colossale de ce dernier, il semble que vous travaillez comme arch√©ologue dans les fouilles de la Grande Pyramide. </li></ul><br><br><img src="https://habrastorage.org/webt/wu/va/gc/wuvagcwh4kmqi-fgc1sz_faezp0.jpeg"><br>  <i>IBM i (logo)</i> <br><br>  Le d√©veloppement d'applications pour cet ABS (options ABS) est effectu√© conform√©ment √† la norme du package technique de l'int√©grateur Misys ITP, qui stipule que l'option doit consister en un programme interactif pour l'interaction du terminal avec l'utilisateur final et impl√©menter l'API en utilisant l'interface install√©e pour l'ex√©cution en arri√®re-plan . <br><br>  Ces programmes interactifs d√©velopp√©s sous le syst√®me d'exploitation IBM i sont historiquement appel√©s applications d'√©cran vert et sont la seule interface utilisateur avec laquelle l'utilisateur de cet ABS interagit. <br><br><h2>  Qu'est-ce qu'une application √©cran vert? </h2><br>  La r√©ponse simple est une application qui ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/6m/gq/gy/6mgqgy4eklp7fvboyyeunnnazgy.jpeg"><br><br>  Ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">alors</a> : <br><br><img src="https://habrastorage.org/webt/cu/d2/km/cud2kmgmxlpe_9eqgxyymmqp9iy.png"><br><br><h2>  Pourquoi des applications d'√©cran vert? </h2><br>  Historiquement, les seules applications interactives fonctionnant sur les syst√®mes bas et milieu de gamme de la famille AS / 400 et d'autres ordinateurs centraux IBM qui vous permettaient de demander une entr√©e utilisateur sont les applications d'√©cran vert.  L'installation, l'administration, la configuration et le d√©veloppement sur le syst√®me d'exploitation IBM i (et ses pr√©d√©cesseurs i5 / OS et AS400) ont √©t√© effectu√©s (et sont toujours en cours quelque part) exclusivement √† l'aide d'applications d'√©cran vert. <br><br>  L'image d'application de l'√©cran vert a deux tailles - 24x80 et 27x132 caract√®res et 16 couleurs possibles.  Dans cette √©chelle, la plupart du travail des d√©veloppeurs et des utilisateurs de ce syst√®me d'exploitation est effectu√©. <br><br>  De telles tailles d'√©cran sont le r√©sultat de l'√©volution des ¬´postes de travail¬ª qui √©taient connect√©s aux prog√©niteurs AS400 des segments bas de gamme et milieu de gamme des ordinateurs professionnels IBM System / 32, System / 34, System / 36 et System / 38.  Ces postes de travail √©taient appel√©s terminaux et constituaient un √©cran dans un bo√Ætier m√©tallique avec un clavier et un √©quipement suppl√©mentaire sous la forme d'un stylo lumineux.  Initialement, seules deux couleurs d'√©cran √©taient prises en charge - le vert et le vert vif, c'est pourquoi la phrase √©tablie ¬´application d'√©cran vert¬ª (application d'√©cran vert dans la litt√©rature anglaise) a disparu.  Dans les ann√©es 1970, le nombre de couleurs prises en charge est pass√© √† 16. <br><br><img src="https://habrastorage.org/webt/i-/is/u6/i-isu68vczilipq75gx8jnq8xzs.png"><br>  <i>Station d'affichage 5251 mod√®le 11</i> <br><br>  Les options de terminal les plus courantes √©taient le 5251 Display Station mod√®le 1 (960 caract√®res √† l'√©cran) et le mod√®le 11 (1920 caract√®res √† l'√©cran) avec des dimensions Largeur / Profondeur / Hauteur √©gales √† 530/400/400 mm, respectivement, et pesant 34 kg.  La r√©solution d'√©cran du mod√®le 1 √©tait de 12x80, mod√®le 11 - 24x80.  Le terminal √©tait connect√© directement au syst√®me h√¥te. <br><br>  Les terminaux 5251 Display Station mod√®le 2 (960 caract√®res √† l'√©cran) et mod√®le 12 (1920 caract√®res √† l'√©cran) avec de grandes dimensions et un poids de 45 kg √©taient √©galement assez courants.  Ils se distinguent du mod√®le 1 et du mod√®le 11 par la possibilit√© de transmettre la connexion en amont par eux-m√™mes √† la machine h√¥te √† partir de clients moins chers sous la forme de terminaux mod√®le 1 (ou 11) avec des imprimantes de bureau ou une imprimante au sol s√©par√©e.  Ainsi, les mod√®les 2 et 12 agissaient comme un concentrateur, procurant la connexion √† l'h√¥te √† partir de p√©riph√©riques n√©cessitant une connexion directe √† la machine h√¥te, et co√ªtaient beaucoup plus cher. <br><br>  Les terminaux de la s√©rie 5252 Dual Display Station sembleront √©galement inhabituels au profane moderne. <br><br><img src="https://habrastorage.org/webt/qq/nf/qx/qqnfqxfkc_sddfyxg1nq6i-v154.png"><br>  <i>Image promotionnelle de la brochure IBM System / 38 Equipment and Programs (5252 Dual Display Station)</i> <br><br>  Le prix d'un kit terminal avec une imprimante connect√©e pourrait atteindre plusieurs milliers de dollars am√©ricains. <br><br>  Les terminaux ont √©t√© connect√©s via un c√¢ble <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">twinax</a> √† la machine h√¥te avec une topologie de bus en mode semi-duplex avec une vitesse de transmission allant jusqu'√† 1 Mbps.  Le nombre maximum de terminaux pris en charge par twinaxial est jusqu'√† 6 terminaux, et le terminal le plus √©loign√© de l'h√¥te doit √™tre situ√© √† une distance maximale de 1500 m√®tres. <br><br>  Le nombre de chaque terminal est d√©fini lors de l'installation par trois commutateurs, de sorte qu'une adresse unique est d√©termin√©e dans le bus.  En pr√©sence d'un r√©seau coaxial existant, il est possible d'utiliser des adaptateurs d'un c√¢ble twinax √† un c√¢ble coaxial et un ensemble appropri√© de terminaisons de c√¢ble pour le sertissage.  Avec ce sch√©ma, il √©tait possible de connecter seulement deux appareils sur le bus avec une longueur de segment maximale allant jusqu'√† 30 m√®tres.  Le nombre total d'appareils connect√©s variait d'une dizaine √† plusieurs dizaines, selon les mod√®les. <br><br>  Avec le d√©veloppement des syst√®mes de bureau et des r√©seaux d'acc√®s, les terminaux encombrants ont √©t√© remplac√©s par des postes de travail, o√π diverses cartes d'extension de soci√©t√©s tierces ont √©t√© utilis√©es comme moyen d'acc√®s √† la machine h√¥te, prenant en charge la connexion directe via twinax.  Apr√®s le d√©veloppement de la technologie Token Ring par IBM en 1984, des solutions logicielles pour acc√©der √† la machine, y compris via cette interface, sont apparues. <br><br><img src="https://habrastorage.org/webt/5d/ek/m2/5dekm2mgcz43rgjiaxyjje3lyas.jpeg"><br>  <i>Adaptateur 5250 vers bus ISA (fabricant inconnu)</i> <br><br><img src="https://habrastorage.org/webt/mm/sr/0a/mmsr0av497ergmgdj4hjtd4a-84.png"><br>  <i>Cartes d'adaptateur Blackbox 5250 (PC470C, PC471C, PC472C, PC473C, PC478C)</i> <br><br>  Les √©mulateurs pour MS-DOS et MS Windows apparaissent √† la fois d'IBM et de fabricants tiers, y compris les impl√©mentations OpenSource (par exemple, tn5250j.sourceforge.net). Au milieu des ann√©es 90, la pile TCP / IP arrive dans le milieu du monde -machines professionnelles bas de gamme.  Pour prendre en charge l'acc√®s √† l'h√¥te via le nouveau protocole, IBM d√©veloppe des √©mulateurs de terminaux de la s√©rie 5250. <br><br>  Afin de cr√©er un protocole h√¥te, IBM d√©veloppe <br>  Extensions de protocole Telnet (RFC 854, RFC 855, RFC 856, RFC 860, RFC 885, RFC 1091, RFC 1205, RFC 1572, RFC 2877), collectivement appel√©es Telnet5250 (TN5250), qui d√©crit le processus de r√©ception et de transmission de flux 5250 flux de donn√©es (5250 flux de donn√©es) via le protocole Telnet standard. <br><br><img src="https://habrastorage.org/webt/8w/gg/_i/8wgg_idu8zojbdf5_1u-gweewkm.gif"><br>  <i>Programme d'installation IBM Client Access / 400 pour Windows 3.1</i> <br><br><h2>  Quelle est la particularit√© de l'IBM 5250? </h2><br>  Une caract√©ristique des terminaux IBM 5250 (et, par cons√©quent, du protocole TN5250) est son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">orientation de bloc,</a> contrairement aux terminaux * nix habituels, qui sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">orient√©s symboles</a> .  Cela signifie que les flux de donn√©es 5250 par lesquels l'h√¥te communique avec le terminal sont transmis par des blocs de donn√©es, et un symbole distinct sans le contexte du bloc transmis n'a pas de sens. <br><br>  Par exemple, la machine h√¥te transmet au terminal un bloc de donn√©es contenant les informations statiques affich√©es √† l'√©cran ainsi que les attributs et coordonn√©es des champs de saisie et une indication du d√©calage dans ce bloc, o√π √©crire le r√©sultat de la saisie de l'utilisateur dans les champs.  Apr√®s cela, la machine h√¥te attend des messages du terminal et ne participe pas au processus d'entr√©e utilisateur. <br><br><img src="https://habrastorage.org/webt/kg/ld/ha/kgldha8aef46matytdr3ugjm7ce.png"><br>  <i>√âcran de connexion pour l'h√¥te IBM i RZKH.de (pub400.com)</i> <br><br>  En outre, la t√¢che de l'√©mulateur de terminal est d'interpr√©ter le bloc de donn√©es de la machine et de former l'√©cran de saisie pour l'utilisateur, o√π il a la possibilit√© d'entrer n'importe quelle information dans les champs autoris√©s.  De plus, les t√¢ches de l'√©mulateur de terminal incluent une r√©action aux actions de l'utilisateur.  Les touches F1-F24 (les touches F13-F24 sont simul√©es via SHIFT + Fx), Enter, Home, End, PageUp, PageDn et certaines autres touches sp√©ciales qui ne sont pas disponibles sur les claviers modernes sont consid√©r√©es comme des cl√©s h√¥tes.  Cela signifie qu'en appuyant sur cette touche, un tampon de flux contenant les informations des champs de saisie et la position du curseur √† l'√©cran, pr√©alablement rempli avec l'√©mulateur de terminal, sera envoy√© √† l'h√¥te pour traitement. <br><br><img src="https://habrastorage.org/webt/nf/oe/vx/nfoevxx5yvr-kbzcnejytv9hk4q.png"><br>  <i>Vidage de tentative de connexion au flux de donn√©es WIreshark 5250 sur pub400.com</i> <br><br>  L‚Äôh√¥te re√ßoit le tampon, l‚Äôanalyse et le r√©sultat saisi est transmis au programme qui a demand√© la r√©action de l‚Äôutilisateur pour une validation suppl√©mentaire des donn√©es et l‚Äôapplication continue de fonctionner, tandis que l‚Äôapplication re√ßoit le code de la touche h√¥te enfonc√©e. <br><br><h2>  Pourquoi l'autotest ici </h2><br>  Nous avons pens√© √† automatiser le test manuel des applications d'√©cran vert lorsque nous avons √©t√© confront√©s √† la n√©cessit√© de tester des centaines d'√©crans d'un module d√©velopp√©, o√π jusqu'√† quatre-vingt contr√¥les commerciaux diff√©rents (validations) pouvaient se produire sur un √©cran. <br><br>  La douleur particuli√®re de l'√©quipe a √©t√© l'absence presque compl√®te pour 2017 d'outils d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">auto-test d'</a> √©cran vert, √† l'exception de la solution propri√©taire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">UIPath</a> .  M√™me aujourd'hui, il n'y a pas beaucoup de solutions similaires, l'auteur conna√Æt Automate from HelpSystems et l'extension <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JMeter</a> pour BlazeMeter (je serai heureux de conna√Ætre d'autres produits similaires). <br><br><h2>  Les premi√®res recherches sur le probl√®me </h2><br>  L'√©mulateur standard du terminal TN5250 install√© sur les lieux de travail de la banque est IBM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Personal Communications</a> for Windows 6.0 (PCOMM 6.0).  Des coll√®gues ont constat√© que ce produit dispose de moyens d'automatisation r√©guliers de sa gestion sous la forme d'une API diversifi√©e, √† savoir: <br><br><ol><li>  Interface de programme d'application linguistique de haut niveau (HLLAPI); </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HLLAPI am√©lior√©;</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Windows HLLAPI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Biblioth√®que du client d'acc√®s √† l'h√¥te (HACL).</a> </li></ol><br>  Les trois premi√®res interfaces sont les plus anciennes et sont prises en charge depuis les versions DOS et 16 bits de Windows.  Le travail sur l'interface EHLLAPI est impl√©ment√© en appelant une seule fonction selon le prototype suivant: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hllapi</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LPWORD, LPSTR, LPWORD, LPWORD)</span></span></span></span>;</code> </pre> <br>  o√π le premier param√®tre est un pointeur sur le num√©ro num√©rique de la fonction en cours d'ex√©cution, les deux autres sont ses arguments contextuels √† la fonction appel√©e et le dernier est le r√©sultat de la fonction.  Autrement dit, pour demander l'√©tat de connexion 'A' (les sessions dans l'√©mulateur sont num√©rot√©es avec une lettre latine de la plage de 'A' √† 'Z'), vous devez ex√©cuter le code suivant (tir√© de la documentation IBM): <br><br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"hapi_c.h"</span></span></span><span class="hljs-meta"> struct HLDQuerySessionStatus QueryData; int Func, Len, Rc; long Rc; memset(QueryData, 0, sizeof(QueryData)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Init buffer QueryData.qsst_shortname = 'A'; // Session to query Func = HA_QUERY_SESSION_STATUS; // Function number Len = sizeof(QueryData); // Len of buffer Rc = 0; // Unused on input hllapi(&amp;Func, (char *)&amp;QueryData, &amp;Len, &amp;Rc); // Call EHLLAPI if (Rc != 0) { // Check return code // ...Error handling }</span></span></span></span></code> </pre><br>  Le nombre de fonctions disponibles pour appeler de cette mani√®re est d'environ 60. <br><br>  L'interface WinHLLAPI √©tend l√©g√®rement cette fonctionnalit√© avec plusieurs fonctions suppl√©mentaires qui permettent d'enregistrer des fonctions de rappel pour les appels asynchrones afin de notifier les √©v√©nements d'√©tablissement d'une connexion avec l'h√¥te, de d√©connexion de l'h√¥te, de modification des donn√©es sur l'√©cran du terminal, etc. <br><br>  L'interface HACL (Host Access Client Library) semblait √™tre plus conviviale, car, contrairement √† l'appel de la "fonction du m√™me nom", une variante de la hi√©rarchie orient√©e objet des classes a √©t√© fournie, qui imitait compl√®tement toute action de l'utilisateur. <br><br><img src="https://habrastorage.org/webt/bv/km/nx/bvkmnxfp3dcskk9uiw9kzbtyffo.gif"><br>  <i>Hi√©rarchie des classes de la biblioth√®que de classes de l'√©mulateur HACL (C ++)</i> <br><br>  Il existe des impl√©mentations HACL pour C ++, Java, LotusScript et un serveur d'automatisation COM pour Windows (pratique pour Visual Basic et .NET). <br><br><h2>  Premier prototype </h2><br>  En raison de l'√©norme complexit√© du protocole de flux de donn√©es 5250 et des informations extr√™mement rares sur son appareil interne avec des liens vers des publications payantes ferm√©es d'IBM, il est devenu √©vident que d√©velopper votre propre √©mulateur est extr√™mement simple et chronophage.  √Ä cet √©gard, l'id√©e est venue d'utiliser une couche de middleware qui vous permettra de contr√¥ler l'√©mulateur de terminal dans les fonctionnalit√©s minimales requises, en particulier ¬´entrez une valeur dans le champ¬ª, ¬´comparez une partie de l'√©cran avec la norme¬ª ou ¬´appuyez sur la touche d'h√¥te F22¬ª. <br><br>  Des coll√®gues qui utilisaient auparavant des interfaces HACL ont affirm√© (et une recherche sur StackOverflow a confirm√©) que l'objet COM avait des probl√®mes de stabilit√© et pouvait se bloquer apr√®s l'ex√©cution d'un certain nombre de commandes.  Seul le red√©marrage du processus du serveur d'automatisation a aid√©.  Une analyse rapide de la version Java a montr√© que Wrapper est utilis√© sur l'interface C ++ via JNI.  Par cons√©quent, le choix s'est port√© sur l'interface C ++.  Les fichiers d'en-t√™te et les fichiers .lib correspondants √©taient disponibles dans le r√©pertoire d'installation de Personal Communications For Windows lui-m√™me. <br><br>  Le premier prototype √©tait bas√© sur Qt5, o√π il √©tait possible d'ex√©cuter du code JavaScript via QtScript.  Dans l'environnement du script ex√©cutable, un objet a √©t√© enregistr√© avec un petit nombre de m√©thodes qui permettaient d'ex√©cuter des commandes dans l'√©mulateur de terminal comme si elles √©taient ex√©cut√©es par une personne (entrer dans un champ, appuyer sur les touches h√¥tes, attendre qu'une ligne apparaisse √† l'√©cran).  Nous avons fait une d√©monstration en direct, o√π nous avons sc√©naris√© un cas d'utilisation pour le lancement d'une application d'√©cran vert √† partir d'ABS Equation avec un test de la r√©action de l'application √† une entr√©e incorrecte dans les champs.  La d√©monstration a montr√© que le prototype a r√©ussi et que nous pouvons avancer. <br><br><h2>  L'apparition d'un voisin </h2><br>  Parall√®lement √† la d√©monstration du premier prototype, des coll√®gues d'un autre d√©partement ont assembl√© un tas de modules Ruby + Cucumber + <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quick3270</a> + Ruby ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cheeze / te3270</a> ).  L'option propos√©e utilise un module Ruby qui interagit avec l'√©mulateur de terminal DN32 Computing Quick3270 via ses objets COM sp√©cialis√©s (incompatible avec les interfaces HACL).  C'√©tait une solution compl√®te pour les applications de test automatique d'√©cran vert de style BDD, avec quelques √©tapes pr√©-d√©crites.  Cependant, dans la solution propos√©e, nous avons √©t√© alarm√©s par ce qui suit: <br><br><ol><li>  Nous avons utilis√© un √©mulateur tiers pay√© non d'IBM (tous les √©mulateurs fonctionnent un peu diff√©remment, mais nous devons v√©rifier le travail sur les √©mulateurs standard utilis√©s dans la banque, le prix de l'erreur est incroyablement √©lev√©); </li><li>  Les impl√©mentations des √©tapes de Cucumber pour Quick3270 utilisaient un grand nombre de p√©riodes d'attente pour attendre une r√©ponse de la machine; </li><li>  Tr√®s mauvaises performances de Quick3270 via l'interface d'automatisation (travailler avec HACL dans le prototype via l'interface C ++ semblait beaucoup plus dynamique). </li></ol><br><img src="https://habrastorage.org/webt/wy/j3/2u/wyj32ub0tvoxzbh-va3yxajiqfs.jpeg"><br>  <i>√âmulateur de terminal Quick3270</i> <br><br>  Sur la base du prototype, nous avons d√©cid√© d'essayer d'impl√©menter notre propre serveur d'automatisation afin de connecter Cucumber √† Personal Communications for Windows et de concevoir les √©tapes afin que le temps d'arr√™t entre les actions sur l'√©cran de l'√©mulateur soit minimal. <br><br>  <i><b>Digression lyrique</b> .</i>  <i>Malgr√© le fait qu'il existe un grand nombre de probl√®mes techniques autour d'IBM soi-disant ¬´h√©rit√©s¬ª, qui, semble-t-il, auraient d√©j√† d√ª √™tre r√©solus pour les syst√®mes de niveau moyen et d'entreprise, la pertinence d'adapter et de transf√©rer des solutions techniques existantes est tr√®s √©lev√©e simplement en raison de leur absence sur la plateforme.</i>  <i>Souvent, l'absence est li√©e aux caract√©ristiques m√™mes de cet OS, qui est fondamentalement diff√©rent des modernes * nix, Windows ou MacOS X, qui n√©cessitent une optimisation significative du logiciel pour cette pile.</i> <br><br><h2>  Propre d√©cision </h2><br>  Comme notre propre solution, nous avons cr√©√© un serveur d'automatisation en tant que d√©veloppement du prototype pr√©c√©demment d√©montr√©.  Ce serveur ex√©cute des commandes pour automatiser l'interaction des consommateurs via un serveur RPC (Qt5 WebSocket).  Il interagit avec Personal Communications for Windows, qui fait partie de l'image du syst√®me d'exploitation Windows d'entreprise, et vous permet de: <br><br><ul><li>  d√©marrer / arr√™ter les sessions d'√©mulation de terminal; </li><li>  Effectuer l'√©cran vert de grattage d'√©cran; </li><li>  rechercher des champs de saisie √† l'√©cran; </li><li>  contr√¥ler le curseur et simuler les frappes (y compris l'h√¥te); </li><li>  et autres </li></ul><br><img src="https://habrastorage.org/webt/ub/qf/xp/ubqfxpqwu5q9pz3ievcpkfb0_sm.png"><br>  <i>D√©marrez Automation Server</i> <br><br>  Cependant, pour tous les avantages de l'API HACL, elle pr√©sente un inconv√©nient: elle ne sait pas comment travailler avec le SGBD DB2 for i int√©gr√© au syst√®me d'exploitation et ne permet pas d'ex√©cuter des commandes essentielles √† la cr√©ation d'un environnement simul√© dans lequel un script de test serait ex√©cut√©.  Si le client DB2 pour Ruby existe depuis IBM, alors le client pour le serveur de commandes distantes et d'appels de programme distribu√© est uniquement pour Java sous la forme de la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JTOpen</a> : la version Open Source d'IBM Toolbox for Java (√©galement appel√©e jt400 )  Nous avons ¬´aper√ßu¬ª la solution √† ce probl√®me chez IBM lui-m√™me en analysant le comportement de ses produits avec des fonctionnalit√©s similaires (en particulier, Personal Communications for Windows Data Transfer, iSeries to PC / PC to iSeries Transfer, etc.).  Il s'est av√©r√© que ces produits, par leur impl√©mentation, ex√©cutent IBM JRE 6 ou 8, selon la version de l'application, et utilisent la biblioth√®que jt400. <br><br>  Pour le serveur d'automatisation, nous avons d√©cid√© de faire de m√™me.  Le JNI lance IBM JVM, fourni avec Personal Communications for Windows.  √Ä l'aide de m√©thodes d'encapsulation sp√©ciales, les commandes du serveur RPC provenant de l'ext√©rieur sont ex√©cut√©es en les procurant par proxy des appels √† la fonctionnalit√© jt400 n√©cessaire.  Comme ce dernier contient √©galement un pilote JDBC pour DB2, il a √©t√© d√©cid√© de l'utiliser pour acc√©der au SGBD sur IBM i. <br><br>  Il est important de noter que vous ne pouvez pas utiliser Oracle JVM lorsque vous utilisez HACL.  Si vous ex√©cutez une session d'√©mulateur de terminal, la tentative de cr√©ation d'une instance de la machine virtuelle se bloquera.  De m√™me, si vous ex√©cutez la JVM Oracle dans l'espace d'adressage d'un processus interagissant avec la HACL, cette derni√®re se bloque sans explication. <br><br>  Au fil du temps, la solution a √©t√© mise en ≈ìuvre sur un nombre croissant d'emplois.  Cela a fonctionn√© plus rapidement que la solution avec Quick3270.  La popularit√© a augment√©, tout comme le nombre d'autotests.  Cependant, pendant le fonctionnement, des difficult√©s suppl√©mentaires sont apparues: <br><br><ol><li>  Le terminal se bloque occasionnellement; </li><li>  Impossibilit√© de travailler sur un stand de r√©gression en raison du refus de l'√©mulateur de terminal de d√©marrer si le bureau de l'utilisateur sous lequel l'√©mulateur d√©marre est bloqu√© ou que sa session RDP est bloqu√©e; </li><li>  Windows uniquement; </li><li>  Une proc√©dure complexe pour l'installation, la configuration et la mise √† jour des outils (via un package msi); </li><li>  Notre cycle de r√©gression pour 130 autotests (environ 4000 √©tapes) a commenc√© √† prendre 7 √† 8 heures. </li></ol><br><h2>  Il faut faire quelque chose ... </h2><br>  En analysant les journaux de trace de nombreux lancements d'autotests, en d√©couvrant des goulots d'√©tranglement dans les performances des √©tapes fr√©quemment utilis√©es, le temps total d'ex√©cution de la r√©gression a √©t√© r√©duit √† 4-5 heures.  Mais il √©tait clair que l'utilisation de la couche middleware sous la forme d'un serveur RPC d'automatisation en conjonction avec l'interface HACL, qui a √©galement des erreurs ¬´flottantes¬ª qui s'accumulent sur la dur√©e de l'ensemble du syst√®me, n'aidera pas √† am√©liorer les performances de la solution. <br><br>  D'autre part, comme alternative √† IBM Personal Communications pour Windows, le fournisseur fournit une solution multiplateforme appel√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IBM i Access - Client Solutions.</a> <br><br><img src="https://habrastorage.org/webt/et/8d/kr/et8dkrlouhhuuqe3ew3krvyjq6u.png"><br>  <i>IBM i Access - Solutions client</i> <br><br>  L'analyse de sa structure interne le samedi et le dimanche matin autour de tasses de caf√© a montr√© que sa base de code est bas√©e sur un autre produit IBM appel√© IBM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Host on-Demand</a> (IBM HOD).  Il s'agit d'une solution √† part enti√®re pour acc√©der √† IBM i, d√©velopp√©e en Java 6, qui a non seulement la mise en ≈ìuvre compl√®te des diff√©rents protocoles de communication utilis√©s dans les machines IBM (TN3270, TN5250, VTxxx, etc.), mais aussi des composants d'interface utilisateur Java-swing de haut niveau, utilis√© pour construire leurs propres √©mulateurs de terminaux sous la forme d'un constructeur, qui peut √™tre assembl√© √† partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> IBM limit√©e.  Une √©tude plus d√©taill√©e du IBM HOD a montr√© que les composants de l'interface utilisateur sont bas√©s sur l'impl√©mentation Java de l'interface HACL, dont la documentation est ouverte.  Leur comportement co√Øncide avec seulement de l√©g√®res diff√©rences par rapport √† la documentation C ++ HACL. <br><br><img src="https://habrastorage.org/webt/8u/fx/7-/8ufx7-3eikew1kjwcr0h-3uuw40.png"><br>  <i>IBM Host On-Demand (logo)</i> <br><br>  Ensuite, nous avons cr√©√© une biblioth√®que Java √† usage interne, qui impl√©mente la m√™me interface que le serveur d'automatisation C ++ RPC, mais utilise en interne IBM HOD.  Pour r√©duire la surcharge lors de l'ex√©cution des √©tapes d'autotest, nous avons migr√© de Ruby Cucumber vers cucumber-jvm avec la r√©impl√©mentation de toutes les √©tapes similaires aux options Ruby.  En pr√©sence d'une interface logicielle similaire au serveur RPC, ce n'√©tait pas un gros probl√®me, d'autant plus que nous avons essay√© de freiner la croissance incontr√¥l√©e du nombre d'√©tapes elles-m√™mes et que nous avions cette valeur aux alentours de 30 unit√©s. <br><br><h2>  Quel est le r√©sultat </h2><br>  En cons√©quence, nous avons atteint l'op√©rabilit√© de tous les autotests sans les modifier, et la vitesse de travail est devenue si √©lev√©e que nous avons d√ª introduire un d√©lai artificiel entre les √©tapes afin que lors du d√©veloppement d'un autotest, vous puissiez observer son travail, sinon l'interface utilisateur n'a pas eu le temps de tirer l'√©cran jusqu'√† la fin. <br><br>  D√©j√† 180 autotests existants avec plus de 16 000 √©tapes avec un d√©lai d√©fini de 60 ms entre les √©tapes ont commenc√© √† s'ex√©cuter environ 30 minutes contre 5 heures 30 minutes, ce qui correspond √† une augmentation de onze fois des performances du stand de r√©gression. <br><br>  Les r√©sultats ont d√©pass√© toutes les attentes.  Nous sommes proches des limites physiques du protocole TN5250. <br><br>  √Ä ce jour, la d√©cision a √©t√© publi√©e dans toute la banque et des coll√®gues d'autres villes se sont joints √† l'am√©lioration.  Parmi les changements r√©cents, les coll√®gues int√®grent la solution avec Jenkins, dans la version de test, le test du lancement sur un serveur Linux avec Xvfb a √©t√© achev√© et la phase d'op√©ration pilote d'ex√©cution des autotests a commenc√©. <br><br>  Merci d'avoir lu jusqu'au bout! <br>  Tout succ√®s! <br><br>  PS En d√©cembre 2018, la prochaine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conf√©rence des d√©veloppeurs IBMi a eu lieu,</a> au cours de laquelle un rapport a √©t√© r√©dig√© sur le sujet de cet article. <br><br>  Jusqu'√† pr√©sent, nous avons organis√© la conf√©rence chaque ann√©e uniquement pour les employ√©s de la Banque.  √Ä partir de 2019, nous inviterons des participants d'autres entreprises.  Il est tr√®s int√©ressant d'√©largir le cercle de la communication professionnelle et personnelle, de partager les √©motions, les connaissances et l'exp√©rience. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr446332/">https://habr.com/ru/post/fr446332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr446322/index.html">Cryptographie en Java. Utilitaire Keytool</a></li>
<li><a href="../fr446324/index.html">Navigation dans DataGrip avec Yandex.Navigator</a></li>
<li><a href="../fr446326/index.html">R√©solution des probl√®mes de trafic</a></li>
<li><a href="../fr446328/index.html">Pourquoi avons-nous besoin de services de r√©ception de SMS et avec quoi mangent-ils?</a></li>
<li><a href="../fr446330/index.html">Machines automatiques contre le code de spaghetti</a></li>
<li><a href="../fr446334/index.html">R√©flexions sur une carri√®re en informatique et conseils pour les d√©butants</a></li>
<li><a href="../fr446336/index.html">Comment interdire les mots de passe standard et faire en sorte que tout le monde vous d√©teste</a></li>
<li><a href="../fr446338/index.html">SVG 3D: cr√©er, faire pivoter et animer</a></li>
<li><a href="../fr446340/index.html">Syst√®mes d'exploitation: trois pi√®ces faciles. Partie 1: Intro (traduction)</a></li>
<li><a href="../fr446342/index.html">L'impact des pages volumineuses transparentes sur les performances du syst√®me</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>