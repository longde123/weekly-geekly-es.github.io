<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😎 🌵 📘 我们修改了蓝牙堆栈，以改善没有编解码器AAC，aptX和LDAC的耳机上的声音 🏽 🛥️ 💾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在阅读本文之前，建议您阅读上一篇文章： 通过蓝牙进行音频：尽可能多地了解配置文件，编解码器和设备 / 英文 

 使用无线耳机的一些用户注意到，使用支持所有音频设备的标准SBC蓝牙编解码器时，音频质量较差且缺少高频。 改善声音的常见建议是购买支持aptX和LDAC编解码器的设备和耳机。 这些编解码器...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我们修改了蓝牙堆栈，以改善没有编解码器AAC，aptX和LDAC的耳机上的声音</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455316/"> <i>在阅读本文之前，建议您阅读上一篇文章： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">通过蓝牙进行音频：尽可能多地了解配置文件，编解码器和设备</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">英文</a></i> <br><br> 使用无线耳机的一些用户注意到，使用支持所有音频设备的标准SBC蓝牙编解码器时，音频质量较差且缺少高频。 改善声音的常见建议是购买支持aptX和LDAC编解码器的设备和耳机。 这些编解码器需要支付许可费用，因此带有其支持的设备会更昂贵。 <br><br> 事实证明，SBC的质量低是由于蓝牙协议栈和耳机设置的人为限制所致，可以通过对智能手机或计算机进行软件更改来在任何现有设备上规避此限制。 <a name="habracut"></a><br><br><h2>  SBC编解码器 </h2>  SBC编解码器具有许多不同的参数，这些参数在连接建立阶段保持一致。 其中包括： <br><br><ul><li> 声道数量和类型：联合立体声，立体声，双声道，单声道； </li><li> 频带数：4或8； </li><li> 包装中的块数：4、8、12、16； </li><li> 量化比特分配算法：响度，SNR； </li><li> 量化（位池）中使用的位池的最大值和最小值：通常为2到53。 </li></ul><br><br> 解码设备必须支持这些参数的任何组合。 编码器可能无法全部实现。 <br> 通常，现有的蓝牙堆栈在以下配置文件中达成共识：联合立体声，8频段，16块，响度，比特池2..53。 此配置文件以328 kbps的比特率编码44.1 kHz音频。 <br>  bitpool参数直接影响单个配置文件中的比特率：它越高，比特率越高，因此质量也越高。 <br> 但是，bitpool参数未绑定到特定配置文件。 其他参数也会影响比特率：信道类型，频带数，块数。 您可以通过协商非标准配置文件来间接提高比特率，而无需更改比特池。 <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>b</mi><mi>i</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>8</mn><mtext mathcolor=&quot;red&quot;>\&amp;#x6B21;</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5E27;</mo></mrow><msub><mtext>&amp;#xA0;</mtext><mi>l</mi></msub><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mtext mathcolor=&quot;red&quot;>\&amp;#x6B21;</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x91C7;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x6837;</mo></mrow><msub><mtext>&amp;#xA0;</mtext><mi>r</mi></msub><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5B50;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5E26;</mo></mrow><mtext mathcolor=&quot;red&quot;>\&amp;#x6B21;</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5757;</mo></mrow></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="48.867ex" height="2.66ex" viewBox="0 -832 21039.7 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-62" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-69" x="429" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-74" x="775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-72" x="1136" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-61" x="1588" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-74" x="2117" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-65" x="2479" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMAIN-3D" x="3223" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-66" x="4529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-72" x="5080" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-61" x="5531" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-63" x="6061" y="0"></use><g transform="translate(6494,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMAIN-38" x="0" y="0"></use><g fill="red" stroke="red" transform="translate(500,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">次</text></g></g><g transform="translate(1830,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">帧</text></g><g transform="translate(2660,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-6C" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-65" x="3222" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-6E" x="3688" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-67" x="4289" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-74" x="4769" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-68" x="5131" y="0"></use><g fill="red" stroke="red" transform="translate(5707,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">次</text></g></g><g transform="translate(7038,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">采</text></g><g transform="translate(7868,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">样</text></g><g transform="translate(8697,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-72" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-61" x="9367" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-74" x="9896" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMATHI-65" x="10258" y="0"></use></g><g transform="translate(17219,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">子</text><g transform="translate(829,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">带</text></g><g fill="red" stroke="red" transform="translate(1659,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/455316/&amp;usg=ALkJrhhZc9mHECNgrSek_NPSis4KZsfpAg#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">次</text></g></g><g transform="translate(2990,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">块</text></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>b</mi><mi>i</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mn>8</mn><mtext mathcolor="red">\次</mtext><mrow class="MJX-TeXAtom-ORD"><mo>帧</mo></mrow><msub><mtext>&nbsp;</mtext><mi>l</mi></msub><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mtext mathcolor="red">\次</mtext><mrow class="MJX-TeXAtom-ORD"><mo>采</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>样</mo></mrow><msub><mtext>&nbsp;</mtext><mi>r</mi></msub><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mo>子</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>带</mo></mrow><mtext mathcolor="red">\次</mtext><mrow class="MJX-TeXAtom-ORD"><mo>块</mo></mrow></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> bitrate = \ frac {8 \次帧\ _length \次采样\ _rate} {子带\次块} </script></p><br>  <i><font color="#666666">SBC比特率公式</font></i> <br><br><br> 例如，双通道模式使用每个通道的整个位池分别对通道进行编码。 通过强制设备使用双通道而不是联合立体声，我们获得了几乎相同的最大比特池值：617 kbps的双比特率。 <br> 我认为，在批准阶段使用非配置文件的位池值是A2DP标准的缺陷，这导致了SBC质量的人为限制。 同意比特率而不是比特池是比较明智​​的。 <br><br> 这些固定值Bitpool和Bitrate源自具有高质量音频建议值的表。 但是，建议并非仅限于这些值的理由。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc5/5bf/c7d/cc55bfc7d4e0a7e9ca4aee331f6c9992.png" alt="蓝牙SBC配置文件表"><br><br> 从2007年到2015年有效的A2DP v1.2规范要求所有解码设备以最高512 kbps的比特率正常工作： <br><br><blockquote>  SNK的解码器应支持所有不会超过最大比特率的可能的比特池值。 此配置文件将可用最大比特率限制为单声道为320kb / s，双通道模式为512kb / s。 </blockquote><br><br> 新版本的规范中没有比特率限制。 假定2015年之后发布并支持EDR的现代耳机可以支持高达≈730 kbps的比特率。 <br><br> 由于某些原因，我测试过的Linux蓝牙堆栈（PulseAudio），Android，Blackberry和macOS对bitpool参数的最大值有人为的限制，这直接影响了最大比特率。 但这不是最大的问题，几乎所有耳机都将最大位池值限制为53。 <br> 正如我已经设法确保的那样，大多数设备在经过修改的蓝牙协议栈上都可以正常工作，其比特率为551 kbit / s，不会出现中断和裂纹。 但是在正常条件下，在普通的蓝牙协议栈上，这种比特率将永远无法协商。 <br><br><h2> 修改蓝牙堆栈 </h2> 任何与A2DP标准兼容的蓝牙协议栈都支持双通道模式，但无法从界面激活它。 <br><br> 让我们在界面上添加一个开关！ 我为Android 8.1和Android 9制作了补丁，这些补丁将对双通道的完全支持添加到了堆栈中，在开发人员工具的模式切换菜单中添加了模式，并处理了具有双通道支持的SBC，就好像它是像aptX，AAC或LDAC这样的附加编解码器（ Android通过在蓝牙设备的设置中添加对勾标记来将其称为“高清音频”。 看起来是这样的： <br><br><img src="https://habrastorage.org/webt/xd/k_/nn/xdk_nnwukcz446jxexaes4pdscw.png" alt="图片"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">适用于Android 9的补丁</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">适用于Android 8.1的补丁</a> <br><br> 选中此复选框后，如果耳机支持3 Mbps的连接，则开始以<b>551 kbps</b>的比特率传输蓝牙音频；如果耳机仅支持2 Mbps，则以<b>452 kbps</b>的速率传输蓝牙音频。 <br><br> 该修补程序包含在以下备用固件中： <br><ul><li>  <b>LineageOS</b> </li><li>  <b>复活混音</b> </li><li>  <b>机器人</b> </li></ul><br><br><h2>  551和452 kbit / s来自何处？ </h2> 蓝牙空气分离技术旨在有效地传输大型固定大小的数据包。 数据是按时隙传输的，一次传输中发送的时隙数最多为5。还有一些传输模式使用1或3个时隙，但不使用2或4。在5个时隙中，您可以以2 Mbps的连接速度传输多达679个字节，最高可达1021字节，速度为3 Mbps，分别为3-367和552字节。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b86/6c9/653/b866c9653eeb255db44e7fd94a409a90.png" alt="图片"><br><br> 如果我们要传输的数据少于679或1021字节，但少于367或552字节，则传输仍将占用5个时隙，并且数据将在同一时间传输，从而降低了传输效率。 <br><br><img src="https://habrastorage.org/webt/u_/9e/at/u_9eati7dqlaegfvhdkpmwxsnxq.png" alt="图片"><br><br> 双通道模式下的SBC，在具有Bitpool 38参数的44100 Hz音频上，每帧16个块，8个频率范围，将音频编码为164字节大小的帧，比特率为452 kbps。 <br> 音频必须封装在L2CAP和AVDTP传输协议中，这些协议从音频有效载荷中占用16个字节。 <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\&amp;#x5F00;&amp;#x59CB;{align&amp;#xA0;*}&amp;#x5E27;&amp;#x957F;&amp;#xFF06;=&amp;#xA0;4&amp;#xA0;+&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{&amp;#x5B50;&amp;#x5E26;\&amp;#x6B21;&amp;#x901A;&amp;#x9053;}&amp;#xA0;{2}&amp;#xA0;+&amp;#xA0;\\&amp;#xFF06;\&amp;#x5F00;&amp;#x59CB;{cases}&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{&amp;#x5757;\&amp;#x6B21;&amp;#x901A;&amp;#x9053;\&amp;#x6B21;&amp;#x4F4D;&amp;#x6C60;}&amp;#xA0;{8}&amp;#xFF06;\&amp;#xA0;text&amp;#xA0;{&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x5355;&amp;#x901A;&amp;#x9053;&amp;#x6216;&amp;#x53CC;&amp;#x901A;&amp;#x9053;&amp;#x6A21;&amp;#x5F0F;&amp;#xFF0C;&amp;#x5219;\\&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{&amp;#x5B50;&amp;#x5E26;+&amp;#x5757;\&amp;#x6B21;&amp;#x6BD4;&amp;#x7279;&amp;#x6C60;}&amp;#xA0;{8}&amp;#xFF06;\&amp;#x6587;&amp;#x672C;{&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x8054;&amp;#x5408;&amp;#x7ACB;&amp;#x4F53;&amp;#x58F0;&amp;#x6A21;&amp;#x5F0F;}&amp;#xA0;\\&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{&amp;#x5757;\&amp;#x6B21;&amp;#x6BD4;&amp;#x7279;&amp;#x6C60;}&amp;#xA0;{8}&amp;#xFF06;\&amp;#x6587;&amp;#x672C;{&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x7ACB;&amp;#x4F53;&amp;#x58F0;&amp;#x6A21;&amp;#x5F0F;}&amp;#xA0;\\&amp;#xA0;\&amp;#x7ED3;&amp;#x675F;{cases}&amp;#xA0;\&amp;#x7ED3;&amp;#x675F;{align&amp;#xA0;*}</mtext></merror></math>" role="presentation"><span class="noError" style="display: inline-block;" aria-hidden="true">\开始{align&nbsp;*}帧长＆=&nbsp;4&nbsp;+&nbsp;\&nbsp;frac&nbsp;{子带\次通道}&nbsp;{2}&nbsp;+&nbsp;\\＆\开始{cases}&nbsp;\&nbsp;frac&nbsp;{块\次通道\次位池}&nbsp;{8}＆\&nbsp;text&nbsp;{如果是单通道或双通道模式，则\\&nbsp;\&nbsp;frac&nbsp;{子带+块\次比特池}&nbsp;{8}＆\文本{如果是联合立体声模式}&nbsp;\\&nbsp;\&nbsp;frac&nbsp;{块\次比特池}&nbsp;{8}＆\文本{如果是立体声模式}&nbsp;\\&nbsp;\结束{cases}&nbsp;\结束{align&nbsp;*}</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>\开始{align&nbsp;*}帧长＆=&nbsp;4&nbsp;+&nbsp;\&nbsp;frac&nbsp;{子带\次通道}&nbsp;{2}&nbsp;+&nbsp;\\＆\开始{cases}&nbsp;\&nbsp;frac&nbsp;{块\次通道\次位池}&nbsp;{8}＆\&nbsp;text&nbsp;{如果是单通道或双通道模式，则\\&nbsp;\&nbsp;frac&nbsp;{子带+块\次比特池}&nbsp;{8}＆\文本{如果是联合立体声模式}&nbsp;\\&nbsp;\&nbsp;frac&nbsp;{块\次比特池}&nbsp;{8}＆\文本{如果是立体声模式}&nbsp;\\&nbsp;\结束{cases}&nbsp;\结束{align&nbsp;*}</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> \开始{align *}帧长＆= 4 + \ frac {子带\次通道} {2} + \\＆\开始{cases} \ frac {块\次通道\次位池} {8}＆\ text {如果是单通道或双通道模式，则\\ \ frac {子带+块\次比特池} {8}＆\文本{如果是联合立体声模式} \\ \ frac {块\次比特池} {8}＆\文本{如果是立体声模式} \\ \结束{cases} \结束{align *} </script></p><br><br><br><br> 因此，在具有5个插槽的蓝牙传输中，可以容纳4个音频帧： <br><pre><code class="plaintext hljs">679 (EDR 2 mbit/s DH5) - 4 (L2CAP) - 12 (AVDTP/RTP) - 1 ( SBC) - (164*4) = 6</code> </pre> <br> 我们将11.7毫秒的音频数据放入发送数据包中，该数据包将在3.75毫秒内发送，并且程序包中有6个未使用的字节。 <br> 如果稍微提高比特池，则无法再将4个音频帧打包在一个包中。 您将必须一次发送3帧，这会降低传输效率，减少每个数据包传输的音频量，并会迅速导致在恶劣的无线电条件下出现音频卡顿现象。 <br><br> 同样，为3 Mbps的EDR选择了551 kbit / s的比特率：对于Bitpool 47，一个帧中有16个块，在8个频率范围内，帧大小为200字节，比特率为551 kbit / s。  5个帧或14.6毫秒的音乐适合一个包装。 <br><br> 计算所有SBC参数的算法非常复杂，如果您手动进行计数，您很容易感到困惑，因此我制作了一个交互式计算器来帮助那些有兴趣的人： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">btcodecs.valdikss.org.ru/sbc-bitrate-calculator</a> <br><br><h2> 为什么这一切都是必要的？ </h2> 与aptX编解码器的声音质量的普遍看法相反，在某些文件上，它可能比标准比特率为328 kbps的SBC产生更差的结果。 <br><br>  SBC为频段动态分配量化位，以“从下到上”的方式运行。 如果整个比特率都用于低频和中频，则较高的频率将被“切断”（取而代之的是静音）。 <br>  aptX连续地量化具有相同位数的频带，这就是为什么它具有恒定比特率的原因：44.1 kHz为352 kbit / s，48 kHz为384 kbit / s，并且它无法“将比特”“传输”到那些频率最需要他们。 与SBC不同，aptX不会“削减”频率，但会向其添加量化噪声，从而减小音频的动态范围，有时还会引入特征性的裂纹。 另一方面，SBC“吞噬细节”-丢弃最安静的区域。 <br> 平均而言，与SBC 328k相比，aptX可以在较宽的频率范围内为音乐带来更少的失真，但是有时它在较窄的频率范围和较宽的动态范围内的音乐中获胜。 <br><br> 考虑一种特殊情况。 记录钢琴的频谱图： <br> <a href=""><img src="https://habrastorage.org/webt/i9/uh/z1/i9uhz1ewchvoprxywldrtfknlom.jpeg" alt="图片"></a> <br><br> 主要能量位于0到4 kHz的频率中，并持续高达10 kHz。 <br>  aptX中压缩的文件的频谱图如下： <br> <a href=""><img src="https://habrastorage.org/webt/sx/3i/lw/sx3ilwm6riwrjelw-ofmljdd54m.jpeg" alt="图片"></a> <br><br> 看起来SBC 328k。 <br> <a href=""><img src="https://habrastorage.org/webt/ah/ob/br/ahobbramaxjmsr0htxagkiflomk.jpeg" alt="图片"></a> <br><br> 可以看出，SBC 328k定期完全关闭16 kHz以上的范围，并消耗了低于此值的范围的所有可用比特率。 但是，aptX在人耳听到的频谱中引入了更多的失真，这可以从aptX频谱图减去原始频谱图中看到（越亮，失真越大）： <br> <a href=""><img src="https://habrastorage.org/webt/_e/vj/gv/_evjgvlrkbymm5ptv5ymkn2orya.jpeg" alt="图片"></a> <br><br> 尽管SBC 328k在0至10 kHz范围内干扰信号的程度较小，但其余部分却被削减了- <br> <a href=""><img src="https://habrastorage.org/webt/-a/m6/23/-am623wsmq09jfcr80kmkjubp0u.jpeg" alt="图片"></a> <br><br>  485k SBC比特率足以保存整个频率范围，而无需断开频带。 <br> <a href=""><img src="https://habrastorage.org/webt/xx/a0/pa/xxa0patcvltugsfjwxzmh_na_rm.jpeg" alt="图片"></a> <br><br> 在此组成上，SBC 485k在0-15 kHz的范围内明显领先于aptX，并且具有较小但仍然明显的差异-15-22 kHz（较暗，失真较小）： <br> <a href=""><img src="https://habrastorage.org/webt/yv/mi/7v/yvmi7vfj5-ot3ztrfv-gvx43yxy.jpeg" alt="图片"></a> <br><br>  <a href="">原始音频，SBC和aptX的存档</a> 。 <br><br> 切换到高位SBC，您将在任何耳机上获得声音，通常优于aptX。 在支持3 Mbps EDR连接的耳机上，551 Kbps的比特率可产生与aptX HD相当的声音。 <br><br><h2> 我可以再吃点吗？ </h2>  Android补丁也可以选择进一步将EDR设备的比特率提高2 Mbps。 您可以将比特率从452 kbps增加到595 kbps，以降低复杂无线电条件下的传输稳定性为代价。 <br> 只需将变量persist.bluetooth.sbc_hd_higher_bitrate设置为1： <br><pre> <code class="plaintext hljs"># setprop persist.bluetooth.sbc_hd_higher_bitrate 1</code> </pre> <br> 迄今为止，极限比特率补丁仅在LineageOS 15.1中接受，但在16.0中尚未接受。 <br><br><h2> 设备兼容性 </h2> 几乎所有耳机，扬声器和车载音响系统都支持SBC双通道。 这不足为奇-该标准规定了其在任何解码设备中的支持。 在这种模式下会导致问题的设备很少，但这只是单个实例。 <br> 有关兼容设备的更多详细信息，请访问<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">w3bsit3-dns.com</a>或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">xda-developers</a> 。 <br><br><h2> 声音差异比较 </h2> 我制作了一个Web服务，就在浏览器中实时编码SBC（以及aptX和aptX HD）中的音频。 借助它，您可以比较各种SBC配置文件和其他编解码器的声音，而无需通过蓝牙在任何有线耳机，扬声器和您喜欢的音乐上实际传输音频，并且可以在音频播放期间直接更改编码设置。 <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">btcodecs.valdikss.org.ru/sbc-encoder</a> <br><br><h2> 与Android开发人员联系 </h2> 我写信给许多Google蓝牙堆栈开发人员，要求考虑在主要的Android分支AOSP中包含补丁，但没有得到一个答案。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">有关Android的Gerrit补丁系统</a>中<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的补丁</a>也没有留下任何评论。 <br> 如果能与Google的开发人员以及Android中的SBC HD的实现得到帮助，我将感到非常高兴。  gerrit补丁已经过时了（这是早期的版本之一），如果开发人员对我的更改感兴趣（我不容易更新，因为我没有Android Q兼容设备），我将对其进行更新。 <br><br><h2> 结论 </h2> 使用LineageOS，Resurrection Remix和crDroid固件的智能手机用户现在可以满足于提高音质的需求，只需激活蓝牙设备设置中的选项即可。  Linux用户还可以通过安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PaliRohár</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">补丁来</a>提高SBC比特率，该<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">补丁</a>除其他外还增加了对<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">aptX</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">aptX</a> HD和FastStream编解码器的支持。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN455316/">https://habr.com/ru/post/zh-CN455316/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN455302/index.html">Golang API框架</a></li>
<li><a href="../zh-CN455306/index.html">关于您为什么需要出版商出版书籍的问题的答案</a></li>
<li><a href="../zh-CN455308/index.html">有前途的地方</a></li>
<li><a href="../zh-CN455310/index.html">对旁路通道的攻击：现在，不仅PC受到攻击，而且智能手机也受到攻击（分析审查）</a></li>
<li><a href="../zh-CN455314/index.html">什么是服务网络</a></li>
<li><a href="../zh-CN455318/index.html">3D打印的应用领域是什么？</a></li>
<li><a href="../zh-CN455319/index.html">工作流程3D艺术家。 如何不淹没大量信息。 第一部分</a></li>
<li><a href="../zh-CN455321/index.html">自己动手做家庭自动化</a></li>
<li><a href="../zh-CN455325/index.html">将桌面应用程序移植到.NET Core</a></li>
<li><a href="../zh-CN455329/index.html">Azure IoT Edge工具扩展（预览）公告</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>