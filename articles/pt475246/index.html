<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòè ‚òëÔ∏è üßìüèæ Programa√ß√£o ass√≠ncrona em Python: uma breve vis√£o geral ‚§µÔ∏è üÜí üöµüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quando eles falam sobre a execu√ß√£o do programa, ‚Äúexecu√ß√£o ass√≠ncrona‚Äù significa uma situa√ß√£o em que o programa n√£o espera a conclus√£o de um determinad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Programa√ß√£o ass√≠ncrona em Python: uma breve vis√£o geral</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/475246/">  Quando eles falam sobre a execu√ß√£o do programa, ‚Äúexecu√ß√£o ass√≠ncrona‚Äù significa uma situa√ß√£o em que o programa n√£o espera a conclus√£o de um determinado processo, mas continua a trabalhar independentemente dele.  Um exemplo de programa√ß√£o ass√≠ncrona √© um utilit√°rio que, trabalhando de forma ass√≠ncrona, grava em um arquivo de log.  Embora esse utilit√°rio possa falhar (por exemplo, devido √† falta de espa√ßo livre em disco), na maioria dos casos ele funcionar√° corretamente e pode ser usado em v√°rios programas.  Eles poder√£o ligar para ela, passando os dados para a grava√ß√£o e, depois disso, poder√£o continuar fazendo suas pr√≥prias coisas. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ep/bw/pt/epbwpti391hcs-adu7jr0hcpqrm.jpeg"></a> <br><br>  O uso de mecanismos ass√≠ncronos ao escrever um determinado programa significa que esse programa ser√° executado mais rapidamente do que sem o uso de tais mecanismos.  Ao mesmo tempo, o que est√° planejado para ser lan√ßado de forma ass√≠ncrona, como um utilit√°rio para log, deve ser escrito levando em considera√ß√£o emerg√™ncias.  Por exemplo, um utilit√°rio para registro, se o espa√ßo em disco acabar, pode simplesmente parar o registro e n√£o "travar" o programa principal com um erro. <br><br>  A execu√ß√£o ass√≠ncrona de c√≥digo geralmente envolve a opera√ß√£o desse c√≥digo em um thread separado.  Isto √© - se estamos falando de um sistema com um processador de n√∫cleo √∫nico.  Em sistemas com processadores com v√°rios n√∫cleos, esse c√≥digo pode muito bem ser executado por um processo usando um n√∫cleo separado.  Um processador de n√∫cleo √∫nico em um determinado momento pode ler e executar apenas uma instru√ß√£o.  √â como ler livros.  Voc√™ n√£o pode ler dois livros ao mesmo tempo. <br><br>  Se voc√™ est√° lendo um livro e outra pessoa est√° lhe dando outro livro, voc√™ pode pegar este segundo livro e come√ßar a l√™-lo.  Mas o primeiro ter√° que ser adiado.  A execu√ß√£o de c√≥digo multithread √© organizada com o mesmo princ√≠pio.  E se v√°rias de suas c√≥pias lessem v√°rios livros ao mesmo tempo, seria semelhante √† forma como os sistemas multiprocessadores funcionam. <br><a name="habracut"></a><br>  Se em um processador de n√∫cleo √∫nico √© muito r√°pido alternar entre tarefas que requerem poder de computa√ß√£o diferente (por exemplo, entre determinados c√°lculos e leitura de dados de um disco), voc√™ pode sentir que um √∫nico n√∫cleo de processador faz v√°rias coisas ao mesmo tempo.  Ou, digamos, isso acontece se voc√™ tentar abrir v√°rios sites em um navegador ao mesmo tempo.  Se o navegador usar um fluxo separado para carregar cada uma das p√°ginas, tudo ser√° feito muito mais r√°pido do que se essas p√°ginas carregassem uma de cada vez.  Carregar uma p√°gina n√£o √© uma tarefa t√£o dif√≠cil, ele n√£o utiliza os recursos do sistema ao m√°ximo, como resultado, o lan√ßamento simult√¢neo de v√°rias dessas tarefas √© uma a√ß√£o muito eficaz. <br><br><h2>  <font color="#3AC1EF">Programa√ß√£o ass√≠ncrona em Python</font> </h2><br>  Inicialmente, o Python usou corotinas baseadas em gerador para resolver tarefas de programa√ß√£o ass√≠ncronas.  Ent√£o, no Python 3.4, o m√≥dulo <code>asyncio</code> (√†s vezes, seu nome √© escrito como <code>async IO</code> / <code>async IO</code> ), que implementa mecanismos de programa√ß√£o ass√≠ncrona.  O Python 3.5 introduziu a constru√ß√£o ass√≠ncrona / aguardada. <br><br>  Para fazer desenvolvimento ass√≠ncrono em Python, voc√™ precisa lidar com alguns conceitos.  Estes s√£o a rotina e a tarefa. <br><br><h2>  <font color="#3AC1EF">Coroutines</font> </h2><br>  Normalmente, a corotina √© uma fun√ß√£o ass√≠ncrona.  A corotina tamb√©m pode ser um objeto retornado de uma fun√ß√£o de corotina. <br><br>  Se, ao declarar uma fun√ß√£o, for indicado que √© ass√≠ncrono, voc√™ poder√° cham√°-la usando a palavra-chave <code>await</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> say_after(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'hello'</span></span>)</code> </pre> <br>  Tal constru√ß√£o significa que o programa ser√° executado at√© encontrar uma express√£o de espera, ap√≥s o que chamar√° a fun√ß√£o e pausar√° sua execu√ß√£o at√© que o trabalho da fun√ß√£o chamada seja conclu√≠do.  Depois disso, outras corotinas tamb√©m poder√£o iniciar. <br><br>  Pausar um programa significa que o controle retorna ao loop de eventos.  Ao usar o m√≥dulo <code>asyncio</code> , o loop de eventos executa todas as tarefas ass√≠ncronas, executa E / S e executa subprocessos.  Na maioria dos casos, as tarefas s√£o usadas para executar o corutin. <br><br><h2>  <font color="#3AC1EF">As tarefas</font> </h2><br>  As tarefas permitem executar corotinas em um loop de eventos.  Isso simplifica o controle de execu√ß√£o de v√°rias corotinas.  Aqui est√° um exemplo que usa corotinas e tarefas.  Observe que as entidades declaradas usando a constru√ß√£o ass <code>async def</code> s√£o corotinas.  Este exemplo √© retirado da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o oficial do</a> Python. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">say_after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(delay, what)</span></span></span><span class="hljs-function">:</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(delay)    print(what) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>    task1 = asyncio.create_task(        say_after(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'hello'</span></span>))    task2 = asyncio.create_task(        say_after(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'world'</span></span>))    print(<span class="hljs-string"><span class="hljs-string">f"started at </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{time.strftime(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'%X'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">"</span></span>)    <span class="hljs-comment"><span class="hljs-comment">#     (      #  2 .)    await task1    await task2    print(f"finished at {time.strftime('%X')}") asyncio.run(main())</span></span></code> </pre> <br>  A fun√ß√£o <code>say_after()</code> possui o prefixo <code>async</code> ; como resultado, temos uma rotina.  Se desviarmos um pouco desse exemplo, podemos dizer que essa fun√ß√£o pode ser chamada assim: <br><br><pre> <code class="python hljs">    <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> say_after(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'hello'</span></span>)    <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> say_after(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'world'</span></span>)</code> </pre> <br>  Com essa abordagem, no entanto, as corotinas s√£o chamadas seq√ºencialmente e levam cerca de 3 segundos para serem conclu√≠das.  No nosso exemplo, eles s√£o lan√ßados competitivamente.  Para cada um deles √© usada uma tarefa.  Como resultado, o tempo de execu√ß√£o de todo o programa √© de aproximadamente 2 segundos.  Observe que, para que um programa funcione, n√£o basta declarar a fun√ß√£o <code>main()</code> com a <code>async</code> .  Em tais situa√ß√µes, voc√™ precisa usar o m√≥dulo <code>asyncio</code> . <br><br>  Se voc√™ executar o c√≥digo de exemplo, um texto semelhante ao seguinte ser√° exibido na tela: <br><br><pre> <code class="python hljs">started at <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> hello world finished at <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span></code> </pre> <br>  Observe que os carimbos de data e hora na primeira e na √∫ltima linhas diferem em 2 segundos.  Se voc√™ executar este exemplo com uma chamada seq√ºencial de corutin, a diferen√ßa entre os carimbos de data e hora ser√° de 3 segundos. <br><br><h2>  <font color="#3AC1EF">Exemplo</font> </h2><br>  Neste exemplo, o n√∫mero de opera√ß√µes necess√°rias para calcular a soma de dez elementos de uma sequ√™ncia de n√∫meros √© determinado.  Os c√°lculos s√£o realizados a partir do final da sequ√™ncia.  Uma fun√ß√£o recursiva come√ßa obtendo o n√∫mero 10 e depois se chama com os n√∫meros 9 e 8, somando o que ser√° retornado.  Isso continua at√© que os c√°lculos sejam conclu√≠dos.  Como resultado, verifica-se, por exemplo, que a soma de uma sequ√™ncia de n√∫meros de 1 a 10 √© 55. Ao mesmo tempo, nossa fun√ß√£o √© muito ineficiente, a constru√ß√£o <code>time.sleep(0.1)</code> √© usada aqui. <br><br>  Aqui est√° o c√≥digo da fun√ß√£o: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> count    count=count+<span class="hljs-number"><span class="hljs-number">1</span></span>    time.sleep(<span class="hljs-number"><span class="hljs-number">0.1</span></span>)    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>:        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fib(n<span class="hljs-number"><span class="hljs-number">-1</span></span>) + fib(n<span class="hljs-number"><span class="hljs-number">-2</span></span>)    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n start=time.time() <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> count count = <span class="hljs-number"><span class="hljs-number">0</span></span> result = fib(<span class="hljs-number"><span class="hljs-number">10</span></span>) print(result,count) print(time.time()-start)</code> </pre> <br>  O que acontece se voc√™ reescrever esse c√≥digo usando mecanismos ass√≠ncronos e aplicar a constru√ß√£o <code>asyncio.gather</code> , respons√°vel por executar duas tarefas e esperar pela conclus√£o? <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio,time <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> count    count=count+<span class="hljs-number"><span class="hljs-number">1</span></span>    time.sleep(<span class="hljs-number"><span class="hljs-number">0.1</span></span>)    event_loop = asyncio.get_event_loop()    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>:        task1 = asyncio.create_task(fib(n<span class="hljs-number"><span class="hljs-number">-1</span></span>))        task2 = asyncio.create_task(fib(n<span class="hljs-number"><span class="hljs-number">-2</span></span>))        <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.gather(task1,task2)        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task1.result()+task2.result()    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n</code> </pre> <br>  De fato, este exemplo funciona ainda um pouco mais devagar que o anterior, pois tudo √© executado em um encadeamento e chama <code>create_task</code> , <code>gather</code> e outros como esse, criando carga adicional no sistema.  No entanto, o objetivo deste exemplo √© demonstrar a capacidade de competir em v√°rias tarefas e esperar que elas sejam conclu√≠das. <br><br><h2>  <font color="#3AC1EF">Sum√°rio</font> </h2><br>  H√° situa√ß√µes em que o uso de tarefas e corutin √© muito √∫til, por exemplo, se um programa cont√©m uma mistura de entradas e sa√≠das e c√°lculos, ou se c√°lculos diferentes s√£o executados no mesmo programa, voc√™ pode resolver esses problemas executando o c√≥digo de uma maneira competitiva em vez de no modo seq√ºencial.  Isso ajuda a reduzir o tempo necess√°rio para o programa executar determinadas a√ß√µes.  No entanto, isso n√£o permite, por exemplo, executar c√°lculos simultaneamente.  O multiprocessamento √© usado para organizar esses c√°lculos.  Este √© um grande t√≥pico separado. <br><br>  <b>Caros leitores!</b>  Como voc√™ escreve c√≥digo Python ass√≠ncrono? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt475246/">https://habr.com/ru/post/pt475246/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt475236/index.html">Nunca ignore o treinamento de refor√ßo novamente.</a></li>
<li><a href="../pt475238/index.html">Linha do tempo do Blade Runner - novembro de 2019. A previs√£o se tornou realidade?</a></li>
<li><a href="../pt475240/index.html">Usando m√≥dulos rigorosos em projetos Python em larga escala: experi√™ncia no Instagram. Parte 1</a></li>
<li><a href="../pt475242/index.html">Usando m√≥dulos rigorosos em projetos Python em larga escala: experi√™ncia no Instagram. Parte 2</a></li>
<li><a href="../pt475244/index.html">Novos recursos esperados de JavaScript que voc√™ deve conhecer</a></li>
<li><a href="../pt475248/index.html">O uso de polyfills ao escrever aplicativos entre navegadores</a></li>
<li><a href="../pt475250/index.html">Como Redash notou e corrigiu um problema que causava degrada√ß√£o do desempenho do c√≥digo Python</a></li>
<li><a href="../pt475252/index.html">Como criticar a Microsoft</a></li>
<li><a href="../pt475258/index.html">Uma representa√ß√£o visual das elei√ß√µes em S√£o Petersburgo - a m√°gica do envolvimento de voz</a></li>
<li><a href="../pt475260/index.html">A diferen√ßa entre uma fun√ß√£o ass√≠ncrona e uma fun√ß√£o que retorna uma promessa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>