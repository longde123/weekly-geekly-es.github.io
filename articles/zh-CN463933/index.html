<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑 💨 ⛷️ 20行Python脚本，每天通过WhatsApp祝父母早安 🍶 🎏 🍰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="该材料的作者（我们今天出版的译文）说，生活充斥着工作的现代人常常忘记给亲朋好友写信。 他看着他的父母每天早上如何向WhatsApp发送鼓舞人心的报价和有用的健康提示，因此决定该该回报了。 

 在本指南中，我们将编写一个简单的Python脚本，用于发送WhatsApp消息。 在工作过程中，我们将使用...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>20行Python脚本，每天通过WhatsApp祝父母早安</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/463933/"> 该材料的作者（我们今天出版的译文）说，生活充斥着工作的现代人常常忘记给亲朋好友写信。 他看着他的父母每天早上如何向WhatsApp发送鼓舞人心的报价和有用的健康提示，因此决定该该回报了。 <br><br> 在本指南中，我们将编写一个简单的Python脚本，用于发送WhatsApp消息。 在工作过程中，我们将使用Twilio Python软件包。 为了在给定的时间组织脚本的每日启动，我们将把代码放在云中。 <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/a_/70/fb/a_70fblkos4swj4j61aziurh0vw.jpeg"></a> <br><br> 解决此问题的一种方法是使用Selenium Python软件包和WhatsApp Web版本而不是Twilio服务，在用尽了免费服务后，需要付费。 但是，由于使用WhatsApp网络版本需要定期使用手机扫描QR码，因此使用这种方法无法自动发送消息。 <br><a name="habracut"></a><br> 该项目的工作将包括三个步骤： <br><br><ol><li>  Twilio设置。 </li><li> 学习和修改代码。 </li><li> 在云中部署项目并设置触发器。 </li></ol><br><h2>  <font color="#3AC1EF">步骤1. Twilio设置</font> </h2><br> 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Twilio</a>网站上创建一个免费帐户，确认您的电子邮件地址和电话号码。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bed/f6e/8e8/bedf6e8e8c06064bd59d0cceaba9d833.png"></div><br>  <i><font color="#999999">Twilio帐户注册</font></i> <br><br> 此外，作为Twilio免费提供的一部分，您必须使用WhatsApp沙箱（WhatsApp沙箱）。 这意味着您不能使用自己的电话号码，并且必须完成发布许可以接收WhatsApp消息的过程。 <br><br> 在WhatsApp允许Twilio使用您的号码之后，您可以使用自己的消息号码。 为了获得许可，您需要填写表格。 您可以从Twilio技术支持中了解到，尽管Twilio直接与WhatsApp合作，但可能需要一些时间才能获得许可。 此外，它还讨论了发放许可证的有限范围。 结果，许多人不得不使用Twilio WhatsApp沙箱。 <br><br> 所有这些并不会带来太大的欢乐，但是作为Twilio免费提供的一部分，向我们提供的东西使我们能够解决问题。 此外，事实证明，WhatsApp沙箱仍然是唯一可广泛使用的选项。 <br><br> 现在，您需要将消息收件人的电话连接到沙箱，然后您可以将消息发送到此电话。 为了了解如何执行此操作，您需要转到Twilio控制台的专用于WhatsApp的部分。 特别地，在此建议将具有指定文本的WhatsApp消息发送到特定号码。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/854/868/e52/854868e521e259a77f2c437bf84b2bde.png"></div><br>  <i><font color="#999999">Twilio控制台页面，其中包含有关将手机连接至的消息的说明</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/89f/205/d51/89f205d5162bb9aa6d668aecbc1add6e.jpg"></div><br>  <i><font color="#999999">手机发送的连接请求</font></i> <br><br> 保存发给您的联系人中的WhatsApp号码。 可以为他分配任何名称。 为了不使我的生活复杂化，我给该联系人Twilio Sandbox打电话，然后通过父亲的电话向他发送了一条消息（在上图中可以看到）。 此过程仅执行一次。 <br><br> 现在，您需要转到Twilio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">控制台，</a>并获取您帐户的SID和身份验证令牌。 当您以编程方式使用服务时，此数据将帮助Twilio识别您。 <br><br><h2>  <font color="#3AC1EF">步骤2.学习和修改代码</font> </h2><br> 下载<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此</a> GitHub存储库并解压缩存档。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b35/b54/b39/b35b54b392e270f7790c1605c68e6c35.png"></div><br>  <i><font color="#999999">压缩文件内容</font></i> <br><br> 在这里，您将找到源文件（ <code>whatsapp_messaging.py</code> ）和项目部署包（ <code>aws_lambda_deploy.zip</code> ）。 <br><br> 这是脚本代码： <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> twilio.rest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Client <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">msg_mom_and_dad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event=None, context=None)</span></span></span><span class="hljs-function">:</span></span>    <span class="hljs-comment"><span class="hljs-comment">#    SID   ,     Twilio    twilio_sid = 'AC84c9f1602d7fb6af4eda5b0c39a03b37'    auth_token = '4a2021b28f1aa606d9c6945d3c248ebd'    whatsapp_client = Client(twilio_sid, auth_token)    #        ,    #         contact_directory = {'daddy':'+919624666836'}    for key, value in contact_directory.items():        msg_loved_ones = whatsapp_client.messages.create(                body = 'good morning {} !'.format(key),                from_= 'whatsapp:+14155238886',                to='whatsapp:' + value,            )        print(msg_loved_ones.sid)</span></span></code> </pre> <br> 现在我们将解析此代码。 在这里，为方便起见，使用带编号的行的屏幕截图。 <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c47/5d6/5b2/c475d65b2964f33f07d67b17fd590a27.png"></div><br>  <i><font color="#999999">带编号行的Whatsapp_messaging.py文件代码</font></i> <br><br><ul><li> 第1行。导入客户端以使用Twilio REST-API。 </li><li> 第3行。创建<code>msg_mom_and_dad</code>函数。 我们会将这个功能传递给AWS。 它将在设定的时间每天调用一次。 </li><li> 第6-7行。 在这里，您需要用自己的代码替换代码中现有的<code>sid</code>和<code>auth_token</code> （我们在上一节的最后讨论了接收它们）。 </li><li> 第9行。使用凭证创建Twilio客户端对象。 </li><li> 第13行。创建字典。 在此，将邮件收件人的姓名用作密钥，并将其电话号码用作值。 您可以在此词典中添加其他联系信息。 </li><li> 第15行。for循环，在其中遍历字典（到目前为止，其中只有一个条目）。 在<code>body</code>您需要指定消息文本。 我创建了一条简单的消息，文本为“早安”，后跟一个值，该值取自当前词典项目的键。 以我为例，这导致形成“早上好，爸爸！”的信息。  <code>from_</code>表示我们之前收到的WhatsApp编号。 记下邮件收件人的号码-先前他们是从该收件人那里发送请求以连接到Twilio WhatsApp沙箱的。 </li><li> 第23行。在这里，为了检查消息的状态，我们显示其SID。 我们不会使用此信息。 </li></ul><br> 要使用此代码发送消息，您需要在其中进行以下更改： <br><br><ul><li> <code>twilio_sid</code> <br>  auth_token <br>  contact_directory <br>  from_ <br> 主体（这是可选的） </li></ul><br> 更改代码后，保存文件。 然后解压缩<code>aws_lambda_deploy.zip</code>档案，用您的同名文件替换<code>whatsapp_messaging.py</code>文件，然后将所有内容打包回.zip档案。 这些操作的含义是在代码中包括您的凭据和有关您要向其发送消息的人员的信息。 该软件包中用于部署在AWS上的所有其他内容均保持不变。 现在，让我们使用AWS。 <br><br><h2>  <font color="#3AC1EF">步骤3.在AWS上部署项目并配置触发器</font> </h2><br> 该代码已准备就绪，可以运行并发送WhatsApp消息。 如果您对<code>aws_lambda_deploy.zip</code>归档文件中的其他文件在项目中扮演什么角色感兴趣，请注意，在这些文件中有Twilio软件包和所有其他项目依赖项。 我们需要所有这些，因为我们计划在没有Twilio软件包的Python环境中使用AWS Lambda函数。 为什么不通过简单地运行<code>pip install twilio</code>命令来安装正确的软件包来解决此问题？ 事实是，这里我们没有服务器。 <br><br> 为此，我们使用AWS Lambda-一个无服务器的计算环境，您可以在其中放置代码片段，根据用户的需求，代码片段的调用由各种事件和触发器触发。 我们的代码计划每天仅运行一次，因此在AWS上全天候运行的EC2服务器之类的东西将浪费计算资源和金钱。 我们的Lambda函数将根据触发器的请求在每天的特定时间被调用，并且其实现将花费很少的时间。 <br><br> 开始创建Lambda函数 <br><br> 登录到您的AWS账户。 之后，转到<code>Services → Compute → Lambda → Create a function</code> 。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b53/854/450/b53854450d8b353675f9c9b93e768117.png"></div><br>  <i><font color="#999999">Lambda函数创建屏幕</font></i> <br><br> 让我们给函数起一个名字。 <br><br> 作为执行函数的环境，我们将选择Python 3.6。 我们不需要连接到其他AWS服务。 因此，我们对<code>Create a new role with basic Lambda permissions</code>选项指定的权限级别感到满意。 <br><br> 完成设置后，只需单击<code>Create function</code>按钮。 现在我们将在主控制面板上。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29c/394/75f/29c39475fbe00dfc74c8e8bae97c92f1.png"></div><br>  <i><font color="#999999">控制面板</font></i> <br><br> 在这里，在“ <code>Function code</code>部分，您需要指定一个<code>Handler</code> ，系统可以使用该<code>Handler</code>程序来运行我们的代码。 在我们的例子中，在<code>Handler</code>字段中，编写<code>whatsapp_messaging. msg_mom_and_dad</code>  <code>whatsapp_messaging. msg_mom_and_dad</code> ，使用我们要调用的代码和函数指定文件名。 <br><br> 在“ <code>Function package</code>字段中，您需要加载.zip文件，即我们在上一步中创建的文件。 <br><br> 现在，代码可以运行了。 您可以通过单击“ <code>Test</code>按钮来检查该功能是否有效并发送消息。 <br><br> 我们工作的最后一步将是设置一个触发器，该触发器每天将在给定时间调用该函数。 遵循<code>Add trigger → CloudWatch Events</code>的路径。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be7/5d5/ab0/be75d5ab0f6712d2a843ce7340f50bde.png"></div><br>  <i><font color="#999999">触发设定</font></i> <br><br> 我们需要创建一个新规则（ <code>Rule</code> ）。 他需要分配一个名称（ <code>Rule name</code> ）。 如果需要，可以在其中添加描述（ <code>Rule description</code> ）。 <br><br> 将规则类型（ <code>Rule type</code> ）指定为<code>Schedule expression</code> 。 <br><br> 使用<code>cron(30 1 * * ? *)</code>构造<code>cron(30 1 * * ? *)</code>设置函数调用时间。 让我们分析一下这种构造： <br><br><ul><li>  <code>30 1</code>表示UTC时间是上午1:30。 我的IST时间是早上7点。 </li><li> 以下两个字符<code>* *</code>表示月份和月份。 </li><li> 接下来的两个字符<code>? *</code>  <code>? *</code> ，允许您指定星期几和年份。 这种设计意味着该函数将每天被调用，而不受年份和月份的限制。 </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在这里，</a>您可以了解如何设置自己的Cron作业。 <br><br> 触发器设置完成后，请检查是否<code>Enable trigger</code>了“ <code>Enable trigger</code>复选框，从而启用了触发器。 现在仅需单击“ <code>Add</code>按钮，便会创建触发器。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a0/9b9/1d2/0a09b91d2e1cbaeecdf36d4587591d18.png"></div><br>  <i><font color="#999999">触发信息</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a9/08d/55b/6a908d55b748a059844e673b4b4241d2.png"></div><br>  <i><font color="#999999">Lambda函数详细信息</font></i> <br><br> 在Lambda函数的控制面板上，您可以看到<code>CloudWatch Events</code>实体已附加到该函数，并且在触发相应的触发器时可以调用该函数。 <br><br><h2>  <font color="#3AC1EF">总结</font> </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/555/4d8/e8f/5554d8e8f5ef19b5c2ebf0f2ca427f88.jpg"></div><br>  <i><font color="#999999">Python脚本发送的消息</font></i> <br><br> 我们已经完成了该项目的工作。 现在，您可以在WhatsApp联系人中的邮件收件人的电话上将Twilio Sandbox联系人名称更改为您自己的名称（我将其更改为Son）。 我们的系统还允许您与Twilio控制面板中的邮件收件人进行通信。 <br><br>  <b>亲爱的读者们！</b> 您在项目中使用Twilio吗？ <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN463933/">https://habr.com/ru/post/zh-CN463933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN463923/index.html">不再需要.container</a></li>
<li><a href="../zh-CN463925/index.html">Vivaldi：我们如何计算用户数量？</a></li>
<li><a href="../zh-CN463927/index.html">安全和审查制度：5种适用于Google Chrome的VPN和代理</a></li>
<li><a href="../zh-CN463929/index.html">探索Python中类型注释的深度。 第一部分</a></li>
<li><a href="../zh-CN463931/index.html">探索Python中类型注释的深度。 第二部分</a></li>
<li><a href="../zh-CN463937/index.html">我没什么好隐瞒的</a></li>
<li><a href="../zh-CN463939/index.html">SimbirSoft为保险公司发布了移动解决方案</a></li>
<li><a href="../zh-CN463943/index.html">黑色独角兽的不幸经历</a></li>
<li><a href="../zh-CN463951/index.html">c.tech：Cassandra聚会＃2</a></li>
<li><a href="../zh-CN463953/index.html">在Unity中实现命令设计模式</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>