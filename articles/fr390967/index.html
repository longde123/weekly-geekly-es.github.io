<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏺 👉🏼 🕙 Arduino: définition de la batterie et sortie d'informations vers la console 🖐🏻 ✋🏽 👩🏿‍⚕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probablement, tout le monde, créant son propre robot autonome, voulait déterminer le niveau de la batterie et les afficher sur l'écran ou dans la cons...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arduino: définition de la batterie et sortie d'informations vers la console</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/390967/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probablement, tout le monde, créant son propre robot autonome, voulait déterminer le niveau de la batterie et les afficher sur l'écran ou dans la console. Cette fonction est principalement nécessaire pour le débogage, mais dans certains cas, la détermination de la charge est une partie importante des fonctionnalités du robot. La difficulté de réaliser cette tâche est la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">limitation de la tension d'entrée maximale</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au convertisseur analogique-numérique ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ainsi que les énormes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sauts de la</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valeur obtenue. Dans cet article, je voudrais montrer ma façon de lire la tension des batteries et de déterminer la charge.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, il est nécessaire de souder deux résistances de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 kΩ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à la fiche d'alimentation de </font><font style="vertical-align: inherit;">ce circuit diviseur de tension: </font></font><br>
<br>
<img src="http://toe5.ru/theory/voltage/001.gif" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, si la tension de sortie des batteries complètement chargées ne dépasse pas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la tension après le diviseur sera inférieure à 5 V, ce qui signifie qu'elle sera correctement reconnue par un convertisseur analogique-numérique. . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez maintenant connecter la sortie du diviseur à n'importe quelle entrée analogique de l'Arduino. </font><font style="vertical-align: inherit;">Dans mon cas, c'est la jambe A5. </font><font style="vertical-align: inherit;">Essayez ensuite de lire la tension des batteries:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  pinMode(A5, INPUT);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> k = <span class="hljs-number"><span class="hljs-number">2</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> voltage = k*analogRead(A5);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'avère que ce n'est pas clair, puisque nous avons oublié de convertir la valeur en un système de nombres décimaux. </font><font style="vertical-align: inherit;">Pour ce faire, divisez tout par 1024:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> k = <span class="hljs-number"><span class="hljs-number">2</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> voltage = k*analogRead(A5);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous sélectionnons avec un voltmètre un coefficient auquel la tension sera approximativement égale à la tension réelle:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> k = <span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-number"><span class="hljs-number">1.12</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> voltage = k*<span class="hljs-number"><span class="hljs-number">4.5f</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>*analogRead(A5);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons eu une forte tension de montée et de descente, souvent pas similaire à ce qui était nécessaire. </font><font style="vertical-align: inherit;">Pour corriger cette erreur, ajoutez un filtrage passe-bas avec le facteur de lissage le plus approprié pour votre projet:</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> k = <span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-number"><span class="hljs-number">1.12</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> voltage = k*<span class="hljs-number"><span class="hljs-number">4.5f</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>*analogRead(A5);
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> chargeLevel_procents;
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> chargeLevel;
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y;
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z;<font></font>
<font></font>
  <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> A_v = voltage; <span class="hljs-comment"><span class="hljs-comment">//</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> A_K = <span class="hljs-number"><span class="hljs-number">0.3</span></span>; <span class="hljs-comment"><span class="hljs-comment">// </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> A_y; <span class="hljs-comment"><span class="hljs-comment">// </span></span><font></font>
  <font></font>
  A_y = A_y - A_K * (A_y - A_v);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reste maintenant à mesurer la tension sur des batteries complètement chargées et complètement déchargées. </font><font style="vertical-align: inherit;">Dans mon cas, la différence est exactement de 1V. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, vous devez trouver la charge de la batterie en pourcentage:</font></font><br>
<br>
<pre><code class="cpp hljs">  y = A_y / <span class="hljs-number"><span class="hljs-number">8.4</span></span> * <span class="hljs-number"><span class="hljs-number">100</span></span>;<font></font>
  <font></font>
  chargeLevel_procents = y;<font></font>
  chargeLevel = z;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il suffit de traduire cela dans l'icône de la batterie (ou dans les carrés, comme le mien) et de le restituer à la console:</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(chargeLevel_procents &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; chargeLevel_procents &lt; <span class="hljs-number"><span class="hljs-number">33</span></span>) {<font></font>
    z = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">// 1/3 </span></span><font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(chargeLevel_procents &gt;= <span class="hljs-number"><span class="hljs-number">33</span></span> &amp;&amp; chargeLevel_procents &lt; <span class="hljs-number"><span class="hljs-number">66</span></span>) {<font></font>
    z = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">// 2/3 </span></span><font></font>
  }<font></font>
<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(chargeLevel_procents &gt;= <span class="hljs-number"><span class="hljs-number">66</span></span> &amp;&amp; chargeLevel_procents &lt;= <span class="hljs-number"><span class="hljs-number">100</span></span>) {<font></font>
    z = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
  }<font></font>
</code></pre><br>
<pre><code class="cpp hljs">Serial.print(<span class="hljs-string"><span class="hljs-string">"\t Voltage: "</span></span>);<font></font>
    Serial.print(A_y);<font></font>
    Serial.print(<span class="hljs-string"><span class="hljs-string">" V "</span></span>);<font></font>
    Serial.print(<span class="hljs-string"><span class="hljs-string">"\t Charge: "</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(z == <span class="hljs-number"><span class="hljs-number">1</span></span>) {<font></font>
      Serial.print(<span class="hljs-string"><span class="hljs-string">"■"</span></span>);<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(z == <span class="hljs-number"><span class="hljs-number">2</span></span>) {<font></font>
      Serial.print(<span class="hljs-string"><span class="hljs-string">"■■"</span></span>);<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(z == <span class="hljs-number"><span class="hljs-number">3</span></span>) {<font></font>
      Serial.print(<span class="hljs-string"><span class="hljs-string">"■■■"</span></span>);<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
      Serial.print(<span class="hljs-string"><span class="hljs-string">"ERROR"</span></span>);<font></font>
    }<font></font>
    Serial.print(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>);  
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour voir le résultat, je recommande d'utiliser PuTTY, car il prend en charge n'importe quel encodage, contrairement au «moniteur de port» habituel dans l'IDE Arduino.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr390967/">https://habr.com/ru/post/fr390967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr390951/index.html">Disquette 128 Go: modification originale d'un ordinateur personnel</a></li>
<li><a href="../fr390953/index.html">La consommation de café a été associée à un risque réduit de cirrhose du foie.</a></li>
<li><a href="../fr390955/index.html">[Test] Disque SSD pour 512 Gigabyte Kingston KC400 Enterprise Segment</a></li>
<li><a href="../fr390957/index.html">Ardumower: tondeuse à gazon automatique</a></li>
<li><a href="../fr390963/index.html">Le robot bipède Atlas. Nouvelle génération</a></li>
<li><a href="../fr390969/index.html">Laboratoire de micro-ondes. À propos des fiches techniques des amplificateurs de puissance contrôlés par Hittite et de ce qu'ils n'ont pas</a></li>
<li><a href="../fr390971/index.html">Donner vie au DEC canonique VT100</a></li>
<li><a href="../fr390973/index.html">IBM Watson Health achète Truven Health Analytics pour 2,6 milliards de dollars, devenant ainsi un acteur majeur de la santé</a></li>
<li><a href="../fr390975/index.html">Prévisions pour 2016: trois tendances majeures dans l'industrie des semi-conducteurs</a></li>
<li><a href="../fr390977/index.html">Sony News au MWC 2016: Xperia X, Xperia X Performance et Xperia XA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>