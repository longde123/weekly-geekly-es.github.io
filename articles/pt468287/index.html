<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ùáÔ∏è üõÄüèΩ üòï Atributos C #: sobre todos os aspectos üöù üåê üë©üèª‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° leitor. Este artigo descreve atributos de todos os lados - come√ßando pela especifica√ß√£o, significado e defini√ß√£o de atributos, criando os seus pr√≥...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Atributos C #: sobre todos os aspectos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468287/">  Ol√° leitor.  Este artigo descreve atributos de todos os lados - come√ßando pela especifica√ß√£o, significado e defini√ß√£o de atributos, criando os seus pr√≥prios e trabalhando com eles, terminando com a adi√ß√£o de atributos em tempo de execu√ß√£o e os atributos existentes mais √∫teis e interessantes.  Se voc√™ estiver interessado no t√≥pico de atributos em C #, seja bem-vindo ao gato. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u4/uk/ee/u4ukeefozvzkxjtgw9i8zbap6ly.jpeg"></div><a name="habracut"></a><br><h2>  Conte√∫do </h2><br><ol><li>  1. Introdu√ß√£o  Definindo e atribuindo atributos </li><li>  Atributos interessantes com suporte a tempo de execu√ß√£o.  Aqui, ser√£o fornecidas informa√ß√µes breves sobre v√°rios atributos, cuja exist√™ncia poucas pessoas sabem e muito menos quem as usa.  Como essa √© uma informa√ß√£o absolutamente impratic√°vel, n√£o haver√° muita reclama√ß√£o (ao contr√°rio da minha paix√£o pelo conhecimento inaplic√°vel) </li><li> Alguns dos atributos pouco conhecidos que s√£o √∫teis para conhecer. </li><li>  Definindo seu atributo e processando-o.  Adicionando atributos no tempo de execu√ß√£o </li></ol><br><h2>  1. Introdu√ß√£o </h2><br>  Como sempre, comece com defini√ß√µes e especifica√ß√µes.  Isso ajudar√° a entender e perceber os atributos em todos os n√≠veis, o que, por sua vez, √© muito √∫til para encontrar os aplicativos certos para eles. <br><br>  Comece definindo metadados.  <b>Metadados</b> s√£o dados que descrevem e se referem aos tipos definidos pelo <abbr title="Sistema de tipo comum">CTS</abbr> .  Os metadados s√£o armazenados de maneira independente de qualquer linguagem de programa√ß√£o espec√≠fica.  Assim, os metadados fornecem um mecanismo geral para a troca de informa√ß√µes sobre um programa para uso entre as ferramentas que o exigem (compiladores e depuradores, bem como o pr√≥prio programa), bem como entre o <abbr title="Sistema de execu√ß√£o virtual">VES</abbr> .  Os metadados est√£o inclu√≠dos no manifesto do assembly.  Eles podem ser armazenados em um arquivo <abbr title="Execut√°vel port√°til">PE</abbr> junto com o c√≥digo <abbr title="Linguagem intermedi√°ria">IL</abbr> ou em um arquivo PE separado, onde haver√° apenas um manifesto de assembly. <br>  <b>Um atributo</b> √© uma caracter√≠stica de um tipo ou de seus membros (ou outras constru√ß√µes de linguagem) que cont√©m informa√ß√µes descritivas.  Embora os atributos mais comuns sejam predefinidos e tenham um formato espec√≠fico nos metadados, os atributos personalizados tamb√©m podem ser adicionados aos metadados.  Os atributos s√£o comutativos, ou seja,  a ordem de sua declara√ß√£o sobre o elemento n√£o √© importante <br><br>  <b>Do ponto de vista sint√°tico (em metadados), existem os seguintes atributos</b> <br><br><ol><li>  Usando sintaxe especial em IL.  Por exemplo, palavras-chave s√£o atributos.  E para eles existe uma sintaxe especial em IL.  Existem muitos deles; listar tudo n√£o faz sentido </li><li>  Usando sintaxe generalizada.  Isso inclui atributos de usu√°rio e biblioteca. </li><li>  Atributos de seguran√ßa.  Isso inclui atributos que herdam de SecurityAttribute (direta ou indiretamente).  Eles s√£o processados ‚Äã‚Äãde uma maneira especial.  Existe uma sintaxe especial para eles na IL, que permite criar xml que descreve esses atributos diretamente </li></ol><br><h4>  Exemplo </h4><br><div class="spoiler">  <b class="spoiler_title">C√≥digo C # que cont√©m todos os tipos de atributos acima</b> <div class="spoiler_text"><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">StructLayout(LayoutKind.Explicit)</span></span>] [Serializable] [Obsolete] [SecurityPermission(SecurityAction.Assert)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Sample</span></span> { }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">IL resultante</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">.class public EXPLICIT ansi SERIALIZABLE beforefieldinit AttributeSamples.Sample extends [System.Runtime]System.Object { .custom instance void [System.Runtime]System.ObsoleteAttribute::.ctor() = (01 00 00 00 ) .permissionset assert = { class 'System.Security.Permissions.SecurityPermissionAttribute, System.Runtime.Extensions, Version=4.2.1.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' = {}} .method public hidebysig specialname rtspecialname instance void .ctor() cil managed {/*constructor body*/} }</code> </pre><br></div></div><br>  Como voc√™ pode ver, o StructLayoutAttribute possui uma sintaxe especial, pois em IL √© representado como "expl√≠cito".  ObsoleteAttribute usa uma sintaxe comum - em IL come√ßa com ".custom".  SecurityPermissionAttribute como um atributo de seguran√ßa se transformou em ".permissionset assert". <br><br>  Os atributos do usu√°rio adicionam informa√ß√µes do usu√°rio aos metadados.  Esse mecanismo pode ser usado para armazenar informa√ß√µes espec√≠ficas de aplicativos em tempo de compila√ß√£o e para acess√°-las em tempo de execu√ß√£o ou para leitura e an√°lise por outra ferramenta.  Embora qualquer tipo definido pelo usu√°rio possa ser usado como um atributo, a conformidade com o <abbr title="Especifica√ß√£o de linguagem comum">CLS</abbr> exige que os atributos sejam herdados de System.Attribute.  <abbr title="Infraestrutura de linguagem comum">A CLI</abbr> pr√©- <abbr title="Infraestrutura de linguagem comum">define</abbr> alguns atributos e os utiliza para controlar o comportamento do tempo de execu√ß√£o.  Alguns idiomas definem atributos para representar recursos de idioma n√£o representados diretamente no CTS. <br><br>  Como j√° mencionado, os atributos s√£o armazenados em metadados, que, por sua vez, s√£o gerados no est√°gio de compila√ß√£o, ou seja,  inserido no arquivo PE (geralmente * .dll).  Portanto, voc√™ pode adicionar um atributo no tempo de execu√ß√£o apenas modificando o arquivo execut√°vel no tempo de execu√ß√£o (mas os tempos dos programas de altera√ß√£o autom√°tica se esgotaram h√° muito tempo).  Segue-se que eles n√£o podem ser adicionados no est√°gio de execu√ß√£o, mas isso n√£o √© totalmente exato.  Se formarmos nossa montagem, definirmos tipos nela, poderemos criar um novo tipo no est√°gio de execu√ß√£o e travar atributos nele.  Ent√£o, formalmente, ainda podemos adicionar atributos em tempo de execu√ß√£o (o exemplo estar√° na parte inferior). <br><br><h4>  Agora um pouco sobre as limita√ß√µes </h4><br>  Se, por algum motivo, houver 2 atributos no mesmo assembly com os nomes Name e NameAtribute, torna-se imposs√≠vel colocar o primeiro deles.  Ao usar [Nome] (ou seja, sem sufixo), o compilador diz que v√™ incerteza.  Ao usar [NameAttribute], colocaremos NameAttribute, o que √© l√≥gico.  Existe uma sintaxe especial para uma situa√ß√£o t√£o m√≠stica com falta de imagina√ß√£o ao nomear.  Para colocar a primeira vers√£o sem sufixo, voc√™ pode especificar o sinal do cachorro (ou seja, [Nome] √© uma piada, n√£o √© necess√°rio) antes do nome do atributo [@Name]. <br><br>  Atributos personalizados podem ser adicionados a qualquer coisa, exceto atributos personalizados.  Refere-se a metadados, ou seja,  se colocarmos um atributo em C # acima da classe de atributo, nos metadados ele se referir√° √† classe.  Mas voc√™ n√£o pode adicionar um atributo a "public".  Mas voc√™ pode fazer com montagens, m√≥dulos, classes, tipos de valor, enumera√ß√µes, construtores, m√©todos, propriedades, campos, eventos, interfaces, par√¢metros, delegados, valores de retorno ou par√¢metros generalizados.  O exemplo abaixo mostra exemplos √≥bvios e n√£o muito claros de como voc√™ pode colocar um atributo em uma constru√ß√£o espec√≠fica. <br><br><div class="spoiler">  <b class="spoiler_title">Sintaxe da Declara√ß√£o de Atributo</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Runtime.InteropServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Security.Permissions; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> AttributeSamples; [assembly:All] [module:All] <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AttributeSamples</span></span> { [AttributeUsage(AttributeTargets.All)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AllAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">Attribute</span></span> { } [All] <span class="hljs-comment"><span class="hljs-comment">//   public class Usage { [All] //   [return:All] //     public int GiveMeInt&lt;[All]T&gt;([All]int param) { return 5 + param; } [All] //   [field:All] //        public event Action Event; [All] //   [field: All] //       public int Action { get; set; } } }</span></span></code> </pre><br></div></div><br>  Os atributos t√™m 2 tipos de par√¢metros - nomeados e posicionais.  Par√¢metros posicionais incluem par√¢metros do construtor.  Para nomeado - propriedades p√∫blicas com um configurador acess√≠vel.  Al√©m disso, esses n√£o s√£o apenas nomes formais; todos os par√¢metros podem ser indicados ao declarar um atributo entre colchetes ap√≥s seu nome.  Os nomeados s√£o opcionais. <br><br><div class="spoiler">  <b class="spoiler_title">Tipos de Par√¢metros</b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">AttributeUsage(AttributeTargets.All, AllowMultiple = true)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AttrParamsAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">Attribute</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AttrParamsAttribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> positional</span></span></span><span class="hljs-function">) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//  { } public int Named { get; set; } //  } [AttrParams(1)] [AttrParams(1, Named = 2)] public class AttrParams { }</span></span></span></span></code> </pre><br></div></div><br>  Os par√¢metros v√°lidos (de ambos os tipos) para o atributo devem ser um dos seguintes tipos: <br><br><ol><li>  bool, byte, char, double, float, int, long, short, string e mais no primitivo, exceto decimal </li><li>  objeto </li><li>  System.Type </li><li>  enum </li><li>  Uma matriz unidimensional de qualquer um dos tipos acima </li></ol><br>  Isso se deve em grande parte ao fato de que deve ser uma constante em tempo de compila√ß√£o, e os tipos acima podem aceitar essa constante (aceitando um objeto que podemos passar int).  Mas, por alguma raz√£o, o argumento n√£o pode ser do tipo ValueType, embora isso seja poss√≠vel do ponto de vista l√≥gico. <br><br>  Existem dois tipos de atributos do usu√°rio: atributos customizados genu√≠nos e <b>pseudo-customizados</b> . <br>  No c√≥digo, eles t√™m a mesma apar√™ncia (s√£o indicados acima da estrutura do idioma entre colchetes), mas s√£o processados ‚Äã‚Äãde maneira diferente: <br><br><ol><li>  O atributo do usu√°rio original √© armazenado diretamente nos metadados;  par√¢metros de atributo s√£o armazenados como est√£o.  Eles est√£o dispon√≠veis em tempo de execu√ß√£o e s√£o salvos como um conjunto de bytes (eu me apresso para lembr√°-lo de que eles s√£o conhecidos em tempo de compila√ß√£o) </li><li>  Um atributo de pseudo-usu√°rio √© reconhecido porque seu nome faz parte de uma lista especial.  Em vez de armazenar seus dados diretamente nos metadados, eles s√£o analisados ‚Äã‚Äãe usados ‚Äã‚Äãpara definir bits ou campos nas tabelas de metadados, e os dados s√£o descartados e n√£o podem mais ser recebidos.  As tabelas de metadados s√£o verificadas em tempo de execu√ß√£o mais rapidamente que os atributos genu√≠nos do usu√°rio e √© necess√°rio menos armazenamento para armazenar informa√ß√µes. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Atributos de pseudo-usu√°rio n√£o s√£o reflexo vis√≠vel</b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Serializable</span></span>] [StructLayout(LayoutKind.Explicit)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomPseudoCustom</span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> onlyCustom = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(CustomPseudoCustom).GetCustomAttributes(); <span class="hljs-comment"><span class="hljs-comment">// SerializableAttribute } }</span></span></code> </pre><br></div></div><br>  A maioria dos atributos do usu√°rio s√£o introduzidos no n√≠vel do idioma.  Eles s√£o armazenados e retornados pelo tempo de execu√ß√£o, enquanto o tempo de execu√ß√£o n√£o sabe nada sobre o significado desses atributos.  Mas todos os atributos de pseudo-usu√°rio mais alguns atributos de usu√°rio s√£o de particular interesse para os compiladores e para a CLI.  Ent√£o, vamos para a pr√≥xima se√ß√£o. <br><br><h2>  Atributos ativados por tempo de execu√ß√£o </h2><br>  Esta se√ß√£o √© meramente informativa; se n√£o houver interesse em usar o tempo de execu√ß√£o, voc√™ poder√° rolar para a pr√≥xima se√ß√£o. <br><br>  A tabela abaixo lista atributos de pseudo-usu√°rio e atributos especiais de usu√°rio (CLIs ou compiladores os tratam de uma maneira especial). <br><br>  Atributos de pseudo-usu√°rio (eles n√£o podem ser obtidos atrav√©s da reflex√£o). <br>  Atributos da CLI: <br><div class="scrollable-table"><table><tbody><tr><th>  Atributo </th><th>  Descri√ß√£o do produto </th></tr><tr><td>  AssemblyAlgorithmIDAttribute </td><td>  Grava o identificador do algoritmo de hash usado.  Define o campo Assembly.HashAlgId </td></tr><tr><td>  AssemblyFlagsAttribute </td><td>  Grava sinalizadores para a montagem correspondente.  Define o campo Assembly.Flags </td></tr><tr><td>  DllImportAttribute </td><td>  Fornece informa√ß√µes sobre o c√≥digo implementado em uma biblioteca n√£o gerenciada.  Define o bit Method.Flags.PinvokeImpl do m√©todo correspondente;  adiciona uma nova entrada ao ImplMap (configurando os valores de MappingFlags, MemberForwarded, ImportName e ImportScope) </td></tr><tr><td>  StructLayoutAttribute </td><td>  Permite definir explicitamente o m√©todo para colocar campos de refer√™ncia ou tipo significativo.  Define o campo TypeDef.Flags.LayoutMask para o tipo.  Tamb√©m pode definir os campos TypeDef.Flags.StringFormatMask, ClassLayout.PackingSize e ClassLayout.ClassSize </td></tr><tr><td>  FieldOffsetAttribute </td><td>  Define o deslocamento de byte dos campos em uma refer√™ncia ou tipo significativo.  Define o valor de FieldLayout.OffSet para o m√©todo correspondente. </td></tr><tr><td>  Atribuir </td><td>  Indica que o par√¢metro √© passado como um argumento [in].  Define o bit Param.Flags.In para o par√¢metro correspondente. </td></tr><tr><td>  Atribuir </td><td>  Indica que o par√¢metro √© passado como um argumento [out].  Define o bit Param.Flags.Out para o par√¢metro correspondente. </td></tr><tr><td>  Marshalasattribute </td><td>  Define como os dados s√£o empacotados entre c√≥digo gerenciado e n√£o gerenciado.  Define o bit Field.Flags.HasFieldMarshal para o campo (ou o bit Param.Flags.HasFieldMarshal para o par√¢metro);  Adiciona uma entrada √† tabela FieldMarshal (configurando os valores de Parent e NativeType) </td></tr><tr><td>  MethodImplAttribute </td><td>  Define detalhes de implementa√ß√£o para um m√©todo.  Define o valor de Method.ImplFlags para o m√©todo correspondente </td></tr></tbody></table></div><br><br>  Atributos do CLS - Os idiomas devem suport√°-los: <br><div class="scrollable-table"><table><tbody><tr><th>  Atributo </th><th>  Descri√ß√£o do produto </th></tr><tr><td>  AttributeUsageAttribute </td><td>  Usado para indicar como um atributo pode ser usado. </td></tr><tr><td>  ObsoleteAttribute </td><td>  Indica que o item n√£o deve ser usado. </td></tr><tr><td>  CLSCompliantAttribute </td><td>  Indica se um item √© declarado como compat√≠vel com CLS. </td></tr></tbody></table></div><br>  Diversos interessantes <br><div class="scrollable-table"><table><tbody><tr><th>  Atributo </th><th>  Descri√ß√£o do produto </th></tr><tr><td>  ThreadStaticAttribute </td><td>  Fornece campos de tipo relacionados ao fluxo </td></tr><tr><td>  ConditionalAttribute </td><td>  Marca o m√©todo como chamado com base em uma condi√ß√£o de compila√ß√£o (especificada em / define).  Se a condi√ß√£o n√£o for atendida, o m√©todo n√£o ser√° chamado (e n√£o ser√° compilado no IL).  Somente o m√©todo nulo pode ser marcado.  Caso contr√°rio, ocorrer√° um erro de compila√ß√£o. </td></tr><tr><td>  DecimalConstantAttribute </td><td>  Armazena o valor constante decimal em metadados </td></tr><tr><td>  DefaultMemberAttribute </td><td>  Define o membro da classe a ser usado por padr√£o com o m√©todo InvokeMember. </td></tr><tr><td>  CompilationRelaxationsAttribute </td><td>  Indica se as exce√ß√µes √†s verifica√ß√µes de instru√ß√µes s√£o rigorosas ou relaxadas.  Atualmente, voc√™ s√≥ pode passar o par√¢metro NoStringInterning, que marca o assembly como n√£o exigindo interna√ß√£o literal de cadeia de caracteres.  Mas esse mecanismo ainda pode ser usado. </td></tr><tr><td>  FlagsAttribute </td><td>  Atributo que indica se a enumera√ß√£o deve ser tratada como sinalizadores de bit </td></tr><tr><td>  IndexerNameAttribute </td><td>  Especifica o nome pelo qual o indexador ser√° conhecido nas linguagens de programa√ß√£o que n√£o suportam diretamente esse recurso. </td></tr><tr><td>  ParamArrayAttribute </td><td>  Indica que o m√©todo aceita um n√∫mero vari√°vel de par√¢metros. </td></tr></tbody></table></div><br><h2>  Atributos √∫teis </h2><br>  Uma parte integrante do desenvolvimento de produtos de software √© a depura√ß√£o.  E geralmente em um sistema grande e complexo, s√£o necess√°rias dezenas e centenas de vezes para executar o mesmo m√©todo e monitorar o estado dos objetos.  Ao mesmo tempo, aos 20 anos, ele j√° come√ßa a enfurecer especificamente a necessidade de expandir um objeto profundamente 400 vezes para ver o valor de uma vari√°vel e reiniciar o m√©todo novamente. <br>  Para uma depura√ß√£o mais silenciosa e r√°pida, voc√™ pode usar atributos que modificam o comportamento do depurador. <br><br>  <b>DebuggerDisplayAttribute</b> indica como o tipo ou seu membro √© exibido na janela de vari√°veis ‚Äã‚Äãdo depurador (e n√£o apenas). <br><br>  O √∫nico argumento para o construtor √© uma sequ√™ncia com um formato de exibi√ß√£o.  O que ser√° entre as chaves ser√° calculado.  O formato √© como uma sequ√™ncia interpolada, apenas sem um d√≥lar.  Voc√™ n√£o pode usar ponteiros em um valor calculado.  A prop√≥sito, se voc√™ tiver um ToString substitu√≠do, seu valor ser√° mostrado como se estivesse neste atributo.  Se houver um ToString e um atributo, o valor ser√° obtido do atributo. <br><img src="https://habrastorage.org/webt/eg/l9/mp/egl9mpyoppftcevpckbs4qznh-c.png"><br><br>  <b>DebuggerBrowsableAttribute</b> define como um campo ou propriedade √© exibido na janela de vari√°veis ‚Äã‚Äãdo depurador.  Aceita um DebuggerBrowsableState, que possui 3 op√ß√µes: <br><br><ul><li>  Nunca - o campo n√£o √© exibido durante a depura√ß√£o.  Ao expandir a hierarquia de objetos, este campo n√£o ser√° exibido </li><li>  Recolhido - o campo n√£o foi resolvido, mas pode ser expandido.  Esse √© o comportamento padr√£o. </li><li>  RootHidden - o pr√≥prio campo n√£o √© mostrado, mas os objetos dos quais consiste s√£o mostrados (para matrizes e cole√ß√µes) </li></ul><br><img src="https://habrastorage.org/webt/6m/a5/gf/6ma5gf06sqj0eryekzparfrzq0i.png"><br><br>  <b>DebuggerTypeProxy</b> - se o objeto for exibido no depurador centenas de vezes por dia, voc√™ poder√° ficar confuso e gastar 3 minutos criando um objeto proxy que exibe o objeto original como deveria.  Normalmente, o objeto proxy a ser exibido √© a classe interna.  Na verdade, ele ser√° exibido em vez do objeto de destino. <br><br><img src="https://habrastorage.org/webt/np/bg/zd/npbgzdwf_ontlgkwcr3adapeink.png"><br><br>  Outros atributos √∫teis <br><br>  <b>ThreadStatic</b> - um atributo que permite criar uma vari√°vel est√°tica pr√≥pria para cada thread.  Para fazer isso, coloque o atributo acima do campo est√°tico.  Vale lembrar uma importante nuance - a inicializa√ß√£o por um construtor est√°tico ser√° executada apenas uma vez e a vari√°vel ser√° alterada no encadeamento que o construtor est√°tico executar√°.  No restante, ele permanecer√° no padr√£o.  (PS. Se voc√™ precisar desse comportamento, aconselho a procurar a classe ThreadLocal). <br><br>  Um pouco sobre as nuances do compartimento do motor.  No Linux e no Windows, h√° uma √°rea de mem√≥ria local para o fluxo ( <abbr title="Encadear armazenamento local">TLS</abbr> e <abbr title="Dados espec√≠ficos do encadeamento">TSD,</abbr> respectivamente).  No entanto, essas √°reas s√£o muito pequenas.  Portanto, uma estrutura ThreadLocalInfo √© criada, um ponteiro para o qual √© colocado no TLS.  Por conseguinte, apenas um slot √© usado.  A estrutura em si cont√©m 3 campos - Thread, AppDomain, ClrTlsInfo.  Estamos interessados ‚Äã‚Äãno primeiro.  √â isso que organiza o armazenamento de est√°tica de fluxo na mem√≥ria, usando ThreadLocalBlock e ThreadLocalModule para isso. <br><br>  Desta forma: <br><br><ul><li>  Tipos de refer√™ncia - localizados no heap, ThreadStaticHandleTable, suportado pela classe ThreadLocalBlock, mant√©m links para eles. </li><li>  Estruturas - Empacotadas e armazenadas em um heap gerenciado, bem como tipos de refer√™ncia </li><li>  Tipos significativos primitivos s√£o armazenados em √°reas de mem√≥ria n√£o gerenciada que fazem parte do ThreadLocalModule </li></ul><br>  Bem, j√° que estamos falando sobre isso, vale a pena mencionar sobre m√©todos ass√≠ncronos.  Como um leitor atento pode perceber, se usarmos assincronia, a continua√ß√£o n√£o ser√° necessariamente executada no mesmo encadeamento (podemos influenciar o contexto de execu√ß√£o, mas n√£o o encadeamento).  Conseq√ºentemente, temos uma porcaria se usarmos o ThreadLocal.  Nesse caso, √© recomend√°vel usar o AsyncLocal.  Mas o artigo n√£o √© sobre isso, ent√£o fomos mais longe. <br><br>  <b>InternalsVisibleTo</b> - permite especificar a montagem, que ficar√° vis√≠vel para os elementos marcados como <i>internos</i> .  Pode parecer que, se alguma assembl√©ia precisar de certos tipos e de seus membros, voc√™ pode simplesmente marc√°-los em <i>p√∫blico</i> e n√£o em vapor.  Mas uma boa arquitetura implica ocultar detalhes de implementa√ß√£o.  No entanto, eles podem ser necess√°rios para algumas coisas de infraestrutura, por exemplo, projetos de teste.  Usando esse atributo, voc√™ pode suportar o encapsulamento e a porcentagem necess√°ria de cobertura de teste. <br><br>  <b>HandleProcessCorruptedStateExceptions</b> - permite assustar programadores t√≠midos e capturar exce√ß√µes de um estado danificado.  Por padr√£o, para essas exce√ß√µes, o CLR n√£o intercepta.  Em geral, a melhor solu√ß√£o seria deixar o aplicativo travar.  Essas s√£o exce√ß√µes perigosas que indicam que a mem√≥ria do processo est√° corrompida, portanto, usar esse atributo √© uma p√©ssima id√©ia.  Mas √© poss√≠vel em alguns casos, para o desenvolvimento local, ser√° √∫til definir esse atributo por um tempo.  Para capturar a exce√ß√£o de um estado danificado, basta colocar esse atributo acima do m√©todo.  E se ele j√° alcan√ßou o uso desse atributo, √© recomend√°vel (no entanto, como sempre) capturar alguma exce√ß√£o espec√≠fica. <br><br>  <b>DisablePrivateReflection</b> - torna todos os membros privados da montagem inating√≠veis para reflex√£o.  O atributo √© colocado na montagem. <br><br><h2>  Definindo seu atributo </h2><br>  N√£o apenas porque esta se√ß√£o √© a √∫ltima.  Afinal, a melhor maneira de entender em quais casos ser√° ben√©fico usar o atributo √© examinar os j√° usados.  √â dif√≠cil dizer uma regra formalizada quando voc√™ deve pensar em seu pr√≥prio atributo.  Geralmente, eles s√£o usados ‚Äã‚Äãcomo informa√ß√µes adicionais sobre um tipo / seu membro ou outra constru√ß√£o de idioma comum a entidades completamente diferentes.  Como exemplo, todos os atributos usados ‚Äã‚Äãpara serializa√ß√£o / ORM / formata√ß√£o etc.  Devido √† aplica√ß√£o extensiva desses mecanismos a tipos completamente diferentes, geralmente desconhecidos pelos desenvolvedores do mecanismo correspondente, o uso de atributos √© uma √≥tima maneira de permitir que o usu√°rio forne√ßa informa√ß√µes declarativas para esse mecanismo. <br><br>  O uso de seus atributos pode ser dividido em 2 partes: <br><br><ol><li>  Criando um atributo e usando-o </li><li>  Obtendo um atributo e processando-o </li></ol><br><h4>  Criando um atributo e usando-o </h4><br>  Para criar seu atributo, basta herdar de <i>System.Attribute</i> .  Nesse caso, √© aconselh√°vel aderir ao estilo de nomea√ß√£o mencionado - encerre o nome da classe em Atributo.  No entanto, n√£o haver√° erro se voc√™ omitir esse sufixo.  Como mencionado anteriormente, os atributos podem ter 2 tipos de par√¢metros - posicional e nomeado.  A l√≥gica de sua aplica√ß√£o √© a mesma das propriedades e par√¢metros do construtor da classe - os valores necess√°rios para criar o objeto para o qual n√£o existe um "padr√£o" razo√°vel s√£o colocados em posi√ß√£o (construtor).  O que pode ser razoavelmente padr√£o, que geralmente ser√° usado, √© melhor distinguido em um nomeado (ou seja, uma propriedade). <br><br>  De pouca import√¢ncia na cria√ß√£o de um atributo √© a limita√ß√£o de seus locais de aplica√ß√£o.  AttributeUsageAttribute √© usado para isso.  O par√¢metro necess√°rio (posicional) √© o AttributeTarget, que determina onde o atributo √© usado (m√©todo, montagem etc.).  Par√¢metros opcionais (nomeados) s√£o: <br><br><ol><li>  AllowMultiple - indica se √© poss√≠vel colocar mais de um atributo sobre o local de seu aplicativo ou n√£o.  Falso por padr√£o </li><li>  Herdado - determina se esse atributo pertencer√° a herdeiros de classes (no caso de posicionamento sobre a classe base) e m√©todos substitu√≠dos (no caso de posicionamento sobre o m√©todo).  O padr√£o √© verdadeiro. </li></ol><br>  Depois disso, voc√™ pode carregar os atributos com uma carga √∫til.  Um atributo √© uma informa√ß√£o declarativa, o que significa que tudo o que est√° definido nela deve descrever a constru√ß√£o √† qual se relaciona.  O atributo n√£o deve conter nenhuma l√≥gica profunda.  Pelo processamento dos atributos que voc√™ define, os servi√ßos especiais devem ser respons√°veis, que apenas os processar√£o.  Mas o fato de o atributo n√£o ter l√≥gica n√£o significa que ele n√£o deva ter m√©todos. <br><br>  Um m√©todo (fun√ß√£o) tamb√©m √© uma informa√ß√£o e tamb√©m pode descrever um design.  E usando o polimorfismo em atributos, voc√™ pode fornecer uma ferramenta muito poderosa e conveniente, na qual o usu√°rio pode influenciar as informa√ß√µes usadas por sua ferramenta e certos est√°gios de execu√ß√£o e processamento.        ,  ,     ,     .     -,        ,    . ,  ,   ¬´¬ª    . <br><br><h4>     </h4><br>             -.        . <br><br>         .         . <br><br>       <a href="">ICustomAttributeProvider</a> .      Assembly, MemberInfo, Module, ParameterInfo.     MemberInfo  Type, EventInfo, FieldInfo, MethodBase, PropertyInfo. <br><br>    3 ,     .     (   ,      )     ( object).          (  ,      ).      <a href="">CustomAttributeExtensions</a> ,         ,      ,      ,       .         Attribute      inherit ( ). <br><br>     .  ,     ,  .  ,    <i>bool inherit</i>     (    <i>true</i> ).   ,             (    ).  ,    <i>inherit = flase</i> ,      true       <br><div class="scrollable-table"><table><tbody><tr><th>   </th><th>  </th></tr><tr><td> GetCustomAttributes&lt;LogAttribute&gt;(bool inherit) </td><td>     .   ,    1  </td></tr><tr><td> GetCustomAttribute&lt;LogAttribute&gt;(bool inherit) </td><td>     .   ,   <i>System.Reflection.AmbiguousMatchException: Multiple custom attributes of the same type found</i> </td></tr><tr><td> GetCustomAttributes() </td><td>      </td></tr><tr><td> GetCustomAttributesData() </td><td>   CustomAttributeData,       ,  (  ),   </td></tr><tr><td> IsDefined(Type attrType, bool inherit) </td><td>  true,     , false   </td></tr></tbody></table></div><br>           . <br><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">AttributeUsage(AttributeTargets.All, AllowMultiple = true)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">Attribute</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LogName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } [AttributeUsage(AttributeTargets.All, AllowMultiple = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, Inherited = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SerializeAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">Attribute</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SerializeName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } [Log(LogName = <span class="hljs-string"><span class="hljs-string">"LogBase1"</span></span>)] [Log(LogName = <span class="hljs-string"><span class="hljs-string">"LogBase2"</span></span>)] [Serialize(SerializeName = <span class="hljs-string"><span class="hljs-string">"SerializeBase1"</span></span>)] [Serialize(SerializeName = <span class="hljs-string"><span class="hljs-string">"SerializeBase2"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RandomDomainEntityBase</span></span> { [Log(LogName = <span class="hljs-string"><span class="hljs-string">"LogMethod1"</span></span>)] [Log(LogName = <span class="hljs-string"><span class="hljs-string">"LogMethod2"</span></span>)] [Serialize(SerializeName = <span class="hljs-string"><span class="hljs-string">"SerializeMethod1"</span></span>)] [Serialize(SerializeName = <span class="hljs-string"><span class="hljs-string">"SerializeMethod2"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VirtualMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } } [Log(LogName = <span class="hljs-string"><span class="hljs-string">"LogDerived1"</span></span>)] [Log(LogName = <span class="hljs-string"><span class="hljs-string">"LogDerived2"</span></span>)] [Serialize(SerializeName = <span class="hljs-string"><span class="hljs-string">"SerializeDerived1"</span></span>)] [Serialize(SerializeName = <span class="hljs-string"><span class="hljs-string">"SerializeDerived2"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RandomDomainEntityDerived</span></span> : <span class="hljs-title"><span class="hljs-title">RandomDomainEntityBase</span></span> { [Log(LogName = <span class="hljs-string"><span class="hljs-string">"LogOverride1"</span></span>)] [Log(LogName = <span class="hljs-string"><span class="hljs-string">"LogOverride2"</span></span>)] [Serialize(SerializeName = <span class="hljs-string"><span class="hljs-string">"SerializeOverride1"</span></span>)] [Serialize(SerializeName = <span class="hljs-string"><span class="hljs-string">"SerializeOverride2"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VirtualMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Type derivedType = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(RandomDomainEntityDerived); MemberInfo overrideMethod = derivedType.GetMethod(<span class="hljs-string"><span class="hljs-string">"VirtualMethod"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// overrideMethod.GetCustomAttribute(typeof(LogAttribute)); //System.Reflection.AmbiguousMatchException: Multiple custom attributes of the same type found. // overrideMethod.GetCustomAttribute&lt;LogAttribute&gt;(false); // System.Reflection.AmbiguousMatchException: Multiple custom attributes of the same type found. // Attribute.GetCustomAttribute(derivedType, typeof(SerializeAttribute)); // System.Reflection.AmbiguousMatchException: Multiple custom attributes of the same type found. IEnumerable&lt;Attribute&gt; allCustom = overrideMethod.GetCustomAttributes(); //LogOverride1 LogOverride2 SerializeOverride1 SerializeOverride2 LogMethod1 LogMethod2 IList&lt;CustomAttributeData&gt; allCustomInfo = overrideMethod.GetCustomAttributesData(); //  ,     IEnumerable&lt;LogAttribute&gt; typedCustom1 = overrideMethod.GetCustomAttributes&lt;LogAttribute&gt;(inherit:false); //LogOverride1 LogOverride2 IEnumerable&lt;LogAttribute&gt; typedInheritedCustom1 = overrideMethod.GetCustomAttributes&lt;LogAttribute&gt;(inherit:true); //LogOverride1 LogOverride2 LogMethod1 LogMethod2 IEnumerable&lt;SerializeAttribute&gt; typedCustom2 = overrideMethod.GetCustomAttributes&lt;SerializeAttribute&gt;(inherit:false); //SerializeOverride1 SerializeOverride2 IEnumerable&lt;SerializeAttribute&gt; typedInheritedCustom2 = overrideMethod.GetCustomAttributes&lt;SerializeAttribute&gt;(inherit:true); //SerializeOverride1 SerializeOverride2 Attribute[] customFromStaticClass = Attribute.GetCustomAttributes(overrideMethod, typeof(SerializeAttribute), inherit:true); //SerializeOverride1 SerializeOverride2 IEnumerable&lt;Attribute&gt; classCustom = derivedType.GetCustomAttributes(); //LogDerived1 LogDerived2 SerializeDerived1 SerializeDerived2 LogBase1 LogBase2 IList&lt;CustomAttributeData&gt; classCustomInfo = derivedType.GetCustomAttributesData(); //  ,     IEnumerable&lt;LogAttribute&gt; typedClassCustom1 = derivedType.GetCustomAttributes&lt;LogAttribute&gt;(false); //LogDerived1 LogDerived2 IEnumerable&lt;LogAttribute&gt; typedInheritedClassCustom1 = derivedType.GetCustomAttributes&lt;LogAttribute&gt;(true); //LogDerived1 LogDerived2 LogBase1 LogBase2 IEnumerable&lt;SerializeAttribute&gt; typedClassCustom2 = derivedType.GetCustomAttributes&lt;SerializeAttribute&gt;(false); //SerializeDerived1 SerializeDerived2 IEnumerable&lt;SerializeAttribute&gt; typedInheritedClassCustom2 = derivedType.GetCustomAttributes&lt;SerializeAttribute&gt;(true); //SerializeDerived1 SerializeDerived2 } }</span></span></code> </pre><br></div></div><br>            .          . <br><br><div class="spoiler"> <b class="spoiler_title"></b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TypeCreator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> TypeSignature = <span class="hljs-string"><span class="hljs-string">"DynamicType"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ModuleName = <span class="hljs-string"><span class="hljs-string">"DynamicModule"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AssemblyName = <span class="hljs-string"><span class="hljs-string">"DynamicModule"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> TypeBuilder _typeBuilder = GetTypeBuilder(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateTypeInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _typeBuilder.DefineNestedType(<span class="hljs-string"><span class="hljs-string">"ClassName"</span></span>); CreatePropertyWithAttribute&lt;SerializeAttribute&gt;(<span class="hljs-string"><span class="hljs-string">"PropWithAttr"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Type[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>]); Type newType = _typeBuilder.CreateType(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Activator.CreateInstance(newType); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CreatePropertyWithAttribute&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> propertyName, Type propertyType, Type[] ctorTypes, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] ctorArgs) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Attribute { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> attributeCtor = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T).GetConstructor(ctorTypes); CustomAttributeBuilder caBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomAttributeBuilder(attributeCtor, ctorArgs); PropertyBuilder newProperty = CreateProperty(propertyName, propertyType); newProperty.SetCustomAttribute(caBuilder); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> PropertyBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateProperty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propertyName, Type propertyType</span></span></span><span class="hljs-function">)</span></span> { FieldBuilder fieldBuilder = _typeBuilder.DefineField(propertyName, propertyType, FieldAttributes.Private); PropertyBuilder propertyBuilder = _typeBuilder.DefineProperty(propertyName, PropertyAttributes.HasDefault, propertyType, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); MethodAttributes getSetAttr = MethodAttributes.Public | MethodAttributes.SpecialName | MethodAttributes.HideBySig; MethodBuilder getter = GenerateGetter(); MethodBuilder setter = GenerateSetter(); propertyBuilder.SetGetMethod(getter); propertyBuilder.SetSetMethod(setter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> propertyBuilder; <span class="hljs-function"><span class="hljs-function">MethodBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateGetter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { MethodBuilder getMethodBuilder = _typeBuilder.DefineMethod(<span class="hljs-string"><span class="hljs-string">$"get_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{propertyName}</span></span></span><span class="hljs-string">"</span></span>, getSetAttr, propertyType, Type.EmptyTypes); ILGenerator getterIl = getMethodBuilder.GetILGenerator(); getterIl.Emit(OpCodes.Ldarg_0); getterIl.Emit(OpCodes.Ldfld, fieldBuilder); getterIl.Emit(OpCodes.Ret); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getMethodBuilder; } <span class="hljs-function"><span class="hljs-function">MethodBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateSetter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { MethodBuilder setMethodBuilder = _typeBuilder.DefineMethod(<span class="hljs-string"><span class="hljs-string">$"set_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{propertyName}</span></span></span><span class="hljs-string">"</span></span>, getSetAttr, <span class="hljs-literal"><span class="hljs-literal">null</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> [] { propertyType }); ILGenerator setterIl = setMethodBuilder.GetILGenerator(); setterIl.Emit(OpCodes.Ldarg_0); setterIl.Emit(OpCodes.Ldarg_1); setterIl.Emit(OpCodes.Stfld, fieldBuilder); setterIl.Emit(OpCodes.Ret); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> setMethodBuilder; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> TypeBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTypeBuilder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> assemblyBuilder = AssemblyBuilder.DefineDynamicAssembly(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AssemblyName(AssemblyName), AssemblyBuilderAccess.Run); ModuleBuilder moduleBuilder = assemblyBuilder.DefineDynamicModule(ModuleName); TypeBuilder typeBuilder = moduleBuilder.DefineType(TypeSignature, TypeAttributes.Public | TypeAttributes.Class | TypeAttributes.AutoClass | TypeAttributes.AnsiClass | TypeAttributes.BeforeFieldInit | TypeAttributes.AutoLayout,<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> typeBuilder; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TypeCreator().CreateTypeInstance(); IEnumerable&lt;Attribute&gt; attrs = instance.GetType().GetProperty(<span class="hljs-string"><span class="hljs-string">"PropWithAttr"</span></span>).GetCustomAttributes(); <span class="hljs-comment"><span class="hljs-comment">// Serializable } }</span></span></code> </pre><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt468287/">https://habr.com/ru/post/pt468287/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt468265/index.html">Fazendo doces com o Vim</a></li>
<li><a href="../pt468267/index.html">Fortalecendo a metodologia UseCase apresentada no livro de Alistair Coburn</a></li>
<li><a href="../pt468271/index.html">Testes vs. Tipos - Vers√£o ferrugem</a></li>
<li><a href="../pt468277/index.html">O trabalho do programador √© dif√≠cil - uma vis√£o do ponto de vista da psicofisiologia</a></li>
<li><a href="../pt468285/index.html">Principais empresas de desenvolvimento de software para empresas e startups</a></li>
<li><a href="../pt468289/index.html">AM</a></li>
<li><a href="../pt468291/index.html">Sinopse do livro de Mark Gaulston, "Eu posso ouvi-lo atrav√©s"</a></li>
<li><a href="../pt468293/index.html">Vive Cosmos - revis√£o do novo conjunto VR da HTC</a></li>
<li><a href="../pt468295/index.html">50 tons de matplotlib - os gr√°ficos principais (com c√≥digo Python completo)</a></li>
<li><a href="../pt468299/index.html">O que desenvolver Oracle para um desenvolvedor em 2019 (e depois)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>