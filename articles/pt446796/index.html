<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî° üìß üî† Circuitos n√£o padronizados: indicador de sete segmentos no ATtiny13 üëâüèª üõåüèø üöñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="N√£o estamos procurando maneiras simples. 



 Anteriormente, √© minha primeira publica√ß√£o que causou resson√¢ncia entre os usu√°rios do Habr. Decidiu n√£o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Circuitos n√£o padronizados: indicador de sete segmentos no ATtiny13</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446796/"><blockquote>  <i>N√£o estamos procurando maneiras simples.</i> </blockquote><br><br><img src="https://habrastorage.org/webt/gl/vh/go/glvhgoheu-u5slanwr-7y9azjlg.jpeg" alt="imagem"><br><br>  Anteriormente, √© minha primeira <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">publica√ß√£o que</a> causou resson√¢ncia entre os usu√°rios do Habr.  Decidiu n√£o parar.  Continuamos a extrair o imposs√≠vel do ATtiny13.  Eu o aviso imediatamente, as solu√ß√µes descritas n√£o s√£o padr√£o novamente e algu√©m pode causar indigna√ß√£o e disson√¢ncia cognitiva ("E qual √© o sentido do artigo ent√£o? Mostrar quais elementos podem ser conectados?").  Al√©m disso, essa solu√ß√£o tamb√©m √© realmente impratic√°vel, que vou escrever com mais detalhes abaixo.  Mas aconteceu que as solu√ß√µes padr√£o s√£o conhecidas h√° muito tempo, e ler sobre elas nem sempre √© interessante, mas escrever √© ingrato. <br><a name="habracut"></a><br>  Eu realmente gosto desse garoto ATtiny13.  Ele tem c√©rebro suficiente para resolver muitos problemas do dia a dia (acenda as luzes, ventila√ß√£o, <s>corra at√© a loja para beber cerveja</s> ).  E o pre√ßo √© simplesmente rid√≠culo.  Aqui est√£o apenas algumas pernas e n√£o h√° al√ßas.  Portanto, voc√™ deve recorrer a todo tipo de truque para resolver o problema da falta de pernas. <br><br>  No processo de estudar a programa√ß√£o de microcontroladores (no ambiente do Arduino, n√£o conte a ningu√©m), como muitos, passei pela etapa de conectar um sensor de dist√¢ncia ultrass√¥nico, algo como isto: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a2/c6c/0c1/2a2c6c0c19d10932dbcffa732d0482d7.jpg" alt="imagem"><br><br>  Como o m√©todo de transmiss√£o de informa√ß√µes do sensor para o controlador √© simples de desonrar, o ATtiny13 lida com isso facilmente.  Em seguida, foi necess√°rio exibir informa√ß√µes em um indicador de sete segmentos usando registros de turno.  Ou seja, o esquema da parte da tela era v√°rias vezes maior que o pr√≥prio controlador.  Naquele momento, eu brinquei e segui em frente. <br><br>  Recentemente, pensei, o que mais seria uma tarefa esmagadora para atribuir a Tinka?  O que ela ainda n√£o conseguiu lidar nos exemplos descritos.  A primeira coisa que lembrei da indica√ß√£o.  H√° algum tempo, eu j√° estava procurando informa√ß√µes sobre um t√≥pico semelhante.  Ent√£o eu achei uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">op√ß√£o</a> t√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">interessante</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">.</a> <br><br><div class="spoiler">  <b class="spoiler_title">Imagem</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/e08/0b6/2fb/e080b62fbc0864cbe0ba6f8dd6682132.gif" alt="imagem"><br></div></div><br>  21 segmentos de 5 p√©s do controlador.  Uau!  Eu nem preciso de muito, dois sinais s√£o suficientes, mais um ponto, um total de 15 segmentos.  E se com quatro pernas?  Em seguida, obtenha no m√°ximo 13 segmentos, n√£o o suficiente.  √Ä vista do circuito, surgiu imediatamente um desejo de montar e experimentar, embora n√£o seja f√°cil elaborar um algoritmo de opera√ß√£o.  Mas, com uma an√°lise mais detalhada, voc√™ entende que n√£o funcionar√° na coleta, pois esses animais de sete segmentos n√£o existem na natureza (provavelmente).  Voc√™ pode fazer, √© claro, mas este √© um n√≠vel diferente.  Ent√£o a id√©ia foi adiada para tempos melhores. <br><br>  Offtopic: Por que n√£o existem indicadores de sete segmentos com l√≥gica integrada?  Onde os desenvolvedores est√£o olhando?  Qu√£o conveniente √© a instala√ß√£o e o controle - duas pernas de for√ßa e 3 (1, 2) pernas de dados.  E, afinal, eles estavam na URSS: 490IP1, 490IP2.  Dentro do indicador mais comum para 2 ... 4 d√≠gitos, h√° muito espa√ßo para colocar o microcircuito do chip, e o pre√ßo do registro de turno √© de 0,064 cu junto com o estojo.  Oh bem. <br><br>  E ent√£o eu pensei novamente, como reduzir o n√∫mero de pernas para trabalhar com o indicador de sete segmentos?  As sa√≠das do controlador podem assumir tr√™s estados (na verdade 4, mas agora n√£o importa).  Existe alguma maneira de usar isso?  Se dois estados em rela√ß√£o ao LED puderem ser interpretados apenas como brilhantes, n√£o brilhantes, ent√£o com tr√™s ser√° um pouco mais interessante.  Ainda n√£o descobri como us√°-lo, mas me ocorreu o seguinte esquema: <br><br><img src="https://habrastorage.org/webt/cw/f8/32/cwf832ajr1kedukuv_tyigpuzwk.jpeg" alt="imagem"><br><br>  Se a sa√≠da do controlador estiver no estado zero, os LEDs n√£o acendem (o que √© √≥bvio). <br><br>  Se a sa√≠da estiver no estado da unidade, os LEDs acender√£o, o que tamb√©m √© compreens√≠vel. <br><br>  Mas se a sa√≠da n√£o √© a sa√≠da, mas est√° conectada √† entrada, uma corrente flui atrav√©s do circuito de dois resistores e o LED HL1, criando uma queda de tens√£o no ponto de conex√£o dos resistores de aproximadamente (5-1,7) / (2,2 + 1,5) * 1,5 + 1,7 = 3,0 V. Isso n√£o √© suficiente para a corrente fluir atrav√©s do circuito VD1_R3_HL2 (s√£o necess√°rios aproximadamente 3,4 V).  O VD1 √© um LED adicional usado como diodo zener (o estabilizador est√° mais correto); portanto, n√£o o consideraremos um LED, para n√£o confundir.  N√£o importa se o resistor de pull-up est√° ligado dentro do microcontrolador, sua resist√™ncia (20 kOhm) praticamente n√£o afeta a situa√ß√£o.  N√£o cheguei a essas classifica√ß√µes imediatamente, antes disso, tentei com um diodo regular como o VD1, ele tamb√©m funciona muito bem com os mesmos resistores R1 e R2.  Mas √© melhor que o R2 seja cerca de uma vez e meia maior que o R1.  E quase esqueci a coisa mais importante: tudo o que √© descrito √© poss√≠vel apenas com o uso de LEDs <i>vermelhos</i> tanto no indicador quanto nos adicionais.  Em casos extremos, <i>o</i> indicador <i>ou</i> os LEDs adicionais podem ser aplicados em verde.  E com uma tens√£o de alimenta√ß√£o de 4,5 V a 5 V. <br><br>  O que temos no final?  Tr√™s estados: nenhum LED (0) brilha, HL1 (1) brilha ou HL1 e HL2 (2) brilham.  Muito parecido com o sistema tern√°rio.  Mas n√£o podemos acender o HL2 sem o HL1, isso deve ser lembrado.  Mas agora, com a ajuda das quatro pernas do microcontrolador, podemos controlar oito LEDs (eu acho que sim). <br><br>  Depois, tentei dividir os segmentos indicadores em pares (como em um jardim de inf√¢ncia: uma menina).  A principal condi√ß√£o √© que em cada par um dos segmentos n√£o possa brilhar por si pr√≥prio, tal discrimina√ß√£o.  Aqui est√° o que eu tenho: <br><br><img src="https://habrastorage.org/webt/rj/oa/dr/rjoadrat5-jro2zaaj6oe4dxrno.jpeg" alt="imagem"><br><br>  Quatro pares de segmentos, em cada letra mai√∫scula, √© indicado o segmento dominante, que pode funcionar por si s√≥, o segundo somente com ele.  Voc√™ pode notar que o segmento "a" se agita com dois de uma vez e ningu√©m chegou ao ponto ruim.  Como parece a vida! <br><br>  Mas com esses pares voc√™ pode exibir (quase) todos os n√∫meros: <br><br><div class="spoiler">  <b class="spoiler_title">Imagem</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ux/vb/tv/uxvbtvxvpp1rlhvkqg23uld0oou.jpeg" alt="imagem"><br></div></div><br>  Cada par √© pintado em sua pr√≥pria cor.  Um espectador atento percebeu que algo estava errado com o empate.  Por enquanto, n√£o vamos nos concentrar nisso.  Tentei mais algumas op√ß√µes para agrupar segmentos, √© melhor n√£o aparecer.  Talvez algu√©m sugira.  Talvez a rede neural possa lidar com isso. <br><br>  Na segunda etapa dos experimentos, tive que usar um indicador com um √¢nodo comum.  Portanto, o esquema final √© o seguinte: <br><br><div class="spoiler">  <b class="spoiler_title">Esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/cq/nd/jo/cqndjod7jj6ofopx2fcwmuvqums.jpeg" alt="imagem"><br></div></div><br>  Algu√©m pode perguntar: para onde foram os resistores de 100 ohm?  H√° muito se sabe (e √© usado ativamente) que, com indica√ß√µes din√¢micas feitas corretamente, os resistores limitadores de corrente podem ser dispensados.  Mesmo que a tens√£o seja constantemente aplicada a partir da sa√≠da do controlador para os dois LEDs conectados em s√©rie por engano, o microcontrolador e os LEDs normalmente suportam isso, a corrente √© limitada pela resist√™ncia de transi√ß√£o dentro do MC.  E mais sobre resistores.  A corrente m√°xima atrav√©s do HL1, de acordo com o esquema anterior, √© de cerca de 2 mA e, atrav√©s do HL2, atinge 25 ... 40 mA (presumivelmente, mais tarde vou lhe dizer de onde esses n√∫meros vieram).  Isso significa que a sa√≠da de luz de diferentes segmentos ser√° diferente.  Por√©m, como a indica√ß√£o din√¢mica ser√° usada, isso pode ser facilmente resolvido devido ao tempo de exibi√ß√£o diferente dos segmentos. <br><br>  Todas as experi√™ncias que realizei no Arduino Nano no Arduino IDE.  Uma excelente placa de prototipagem, fica boa na placa de ensaio, √© exibida via USB sem problemas.  Algo falhou?  Corrigi o esbo√ßo e em um minuto fiz o upload de um novo firmware.  E quando voc√™ depurou o c√≥digo, pode ir para o firmware no ATtiny13, ainda s√£o necess√°rios mais alguns gestos. <br><br>  A prop√≥sito, tamb√©m estou piscando com o Arduino no ambiente do Arduino, isso praticamente elimina a possibilidade de travar o MK com os fus√≠veis errados e muito mais f√°cil. <br><br>  Aqui est√° um exemplo de exibi√ß√£o do n√∫mero 4 no c√≥digo: <br><br><pre><code class="cpp hljs">pinMode(f_a, INPUT); <span class="hljs-comment"><span class="hljs-comment">//    f_a   digitalWrite(f_a, 1); //   F pinMode(d_e, OUTPUT); //    d_e   digitalWrite(d_e, 1); //     1,     D  E pinMode(b_a, INPUT); //    b_a   digitalWrite(b_a, 1); //   B pinMode(c_g, OUTPUT); //    c_g   digitalWrite(c_g, 0); //     0,   C,  G delayMicroseconds (150); // F, B, C, G c  150  pinMode(c_g, INPUT); //    c_g   digitalWrite(c_g, 1); //   G ,     delay (time_2); // F, B, C c  2 </span></span></code> </pre> <br>  Em princ√≠pio, tudo deve ficar claro, mesmo para quem n√£o conhece o Arduino, mas entende um pouco sobre os controladores.  Figuras de 150 microssegundos e 2 milissegundos s√£o selecionadas experimentalmente pelo brilho dos segmentos.  No c√≥digo final, voc√™ precisa coloc√°-los em vari√°veis ‚Äã‚Äãseparadas para poder alter√°-los durante a depura√ß√£o.  A partir dessas figuras, √© poss√≠vel determinar aproximadamente a ordem das diferen√ßas de correntes em dois segmentos em um par.  Como o segmento G brilha cerca de 13 vezes menos que os outros e fornece o mesmo brilho, pode-se supor que a corrente nesse segmento √© 13 vezes mais que nos outros.  De fato, a depend√™ncia do brilho da corrente √© n√£o linear; portanto, a corrente pode ser 25 vezes maior, ou seja, 50 mA.  Que, com esse ciclo de trabalho, seja bastante seguro para a sa√≠da do MK.  A prop√≥sito, essa diferen√ßa de correntes foi jogada nas m√£os ao resolver o problema da figura 2. Como escrevi acima, o segmento G s√≥ pode ser iluminado junto com o segmento C. Mas se voc√™ passar 0 para a perna MK, respons√°vel por C e G, em 150 Œºs e depois 2 ms para manter 1 nele, o segmento G ‚Äúfuncionar√°‚Äù com brilho total e o segmento C ter√° apenas um pouco de tempo para acender pelos mesmos 150 microssegundos.  Temos dois quase cheios.  Assim, consegui quebrar a regra que eu mesmo estabeleci.  O que n√£o pode ser feito por desesperan√ßa. <br><br>  Ent√£o, iluminamos a figura com as quatro pernas do MK.  Na verdade, eu perdi esse est√°gio para mim, imediatamente exibi dois personagens.  Para fazer isso, desconecte a sa√≠da do √¢nodo comum de um dos bits indicadores da power plus e conecte-a a outra sa√≠da MK, e o √¢nodo da outra descarga na pr√≥xima sa√≠da (6 pernas j√°).  Agora, por sua vez, defina 1 no √¢nodo do d√≠gito menos significativo, exiba o d√≠gito do d√≠gito menos significante, depois 1 no √¢nodo do d√≠gito menos significativo e exiba o d√≠gito do d√≠gito mais alto e assim por diante em um c√≠rculo.  Eu conduzi esse experimento com o Arduino Nano, ela tem pernas suficientes.  Todo o c√≥digo foi depurado nele, n√£o na primeira vez.  E assim funcionou, como deveria. <br><br><div class="spoiler">  <b class="spoiler_title">Esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m6/5t/jp/m65tjptj6-dkubdfrmwlxup9olm.jpeg" alt="imagem"><br></div></div><br>  Como os √¢nodos s√£o conectados por sua vez, com a ajuda de um refinamento simples, mais uma sa√≠da do MK pode ser liberada.  Aqui est√° o diagrama de resumo: <br><br><div class="spoiler">  <b class="spoiler_title">Esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8e/xe/zc/8exezcoas6flcayfpbvdeenevdm.jpeg" alt="imagem"><br></div></div><br>  Total use 5 pernas MK para exibir um n√∫mero de dois d√≠gitos.  Nesta fase, voc√™ j√° pode tentar com o beb√™ ATtiny.  O que eu fiz.  Mas n√£o imediatamente.  Um esbo√ßo compilado em um ambiente Arduino para ATtiny13 ocupava aproximadamente 1,7 kB de mem√≥ria com 1 kB dispon√≠vel.  Para reduzir o tamanho, tive que recorrer diretamente √†s portas, o que faria mais tarde.  A prop√≥sito, no Arduino eu usei as mesmas portas que eu usaria no ATtiny, √© muito conveniente.  Eles j√° est√£o indicados no √∫ltimo diagrama.  Ap√≥s o processamento, o c√≥digo perdeu um kilobyte. <br><br>  Aqui est√° o c√≥digo resultante para ATtiny13: <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> time_2 2 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    ,  #define time_3 150 //    ,  byte in1_; byte in2_; int disp_; int d_ = 0; void setup() { } void loop() { d_ = d_ + 1; if (d_ &gt; 150) { //    150     1 d_ = 0; disp_ = disp_ + 1; if (disp_ &gt; 99)(disp_ = 0); //   0  99 } in2_ = disp_ / 10; //     -    10 in1_ = disp_ % 10; //          10 } switch (in1_) { case 0: DDRB = B00001111; PORTB = B00010000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000110; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000010; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010010; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000110; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001110; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001100; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001000; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010110; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000100; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } switch (in2_) { case 0: DDRB = B00001111; PORTB = B00010001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000111; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000011; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010011; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000111; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001111; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001101; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001001; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010111; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000101; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } DDRB = B00011111;//   PORTB = B00011110; delay (5); }</span></span></span></span></code> </pre><br></div></div><br>  O c√≥digo acima permitir√° que o seu ATtiny13 leia de 0 a 99. Seria mais correto prever a possibilidade de reatribuir as pernas do MK.  Os gurus da programa√ß√£o podem reduzir o c√≥digo v√°rias vezes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">onde est√° o limite m√≠nimo do Hello World no AVR?</a> ). <br><br>  Voc√™ pode adicionar a fun√ß√£o necess√°ria ao c√≥digo para que o MK exiba algo consciente.  √â verdade que Tinki j√° tem todas as pernas ocupadas.  H√° tamb√©m uma perna de redefini√ß√£o que pode ser usada como uma porta de entrada / sa√≠da.  Mas us√°-lo foi mais dif√≠cil do que eu pensava.  Portanto, por mim mesmo deixo "para depois".  Mas h√° um recurso interessante que nem todo mundo conhece.  A entrada anal√≥gica ADC0 √© enviada para a mesma perna e funciona!  √â verdade que quando a tens√£o √© menor que 1/4 da tens√£o de alimenta√ß√£o, o MK entra no modo de redefini√ß√£o.  Mas de 1/4 √† tens√£o de alimenta√ß√£o, √© bem poss√≠vel medir a tens√£o de entrada.  Eu aproveitei isso: <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> time_2 2 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    ,  #define time_3 150 //    ,  byte in1_; byte in2_; int disp_; int d_ = 0; void setup() { } void loop() { d_ = d_ + 1; if (d_ &gt; 50) { //   50 ... d_ = 0; disp_ = analogRead(A0) / 10; // ...   ,   10,    . if (disp_ &gt; 99)(disp_ = 99); in2_ = disp_ / 10; //     -    10 in1_ = disp_ % 10; //          10 } switch (in1_) { case 0: DDRB = B00001111; PORTB = B00010000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000110; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000010; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010010; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000110; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001110; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001100; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001000; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010110; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000000; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000100; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } switch (in2_) { case 0: DDRB = B00001111; PORTB = B00010001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 1: DDRB = B00000111; PORTB = B00000111; delay (time_2); break; case 2: DDRB = B00011111; PORTB = B00000011; delayMicroseconds (time_3); DDRB = B00010011; PORTB = B00010011; delay (time_2); break; case 3: DDRB = B00011011; PORTB = B00000111; delayMicroseconds (time_3); DDRB = B00000011; delay (time_2); break; case 4: DDRB = B00010101; PORTB = B00001111; delayMicroseconds (time_3); DDRB = B00000101; delay (time_2); break; case 5: DDRB = B00011011; PORTB = B00001101; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 6: DDRB = B00011111; PORTB = B00001001; delayMicroseconds (time_3); DDRB = B00001001; delay (time_2); break; case 7: DDRB = B00001111; PORTB = B00010111; delayMicroseconds (time_3); DDRB = B00000111; delay (time_2); break; case 8: DDRB = B00011111; PORTB = B00000001; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; case 9: DDRB = B00011011; PORTB = B00000101; delayMicroseconds (time_3); DDRB = B00000001; delay (time_2); break; } DDRB = B00011111;//   PORTB = B00011110; delay (5); }</span></span></span></span></code> </pre><br></div></div><br>  A experi√™ncia mostra que o indicador pode ser reduzido para at√© 21; somente ent√£o o MK entra no modo de redefini√ß√£o e come√ßa a trabalhar quando volta para cerca de 25 anos ou mais.  Portanto, √© poss√≠vel criar um "indicador" muito errado para indicar tens√£o de 25 a 99 volts, √© claro, com um divisor na entrada de medi√ß√£o. <br><br>  Agora sobre a aplica√ß√£o pr√°tica.  A id√©ia original de exibir dados de um sensor de dist√¢ncia foi adiada para tempos melhores devido √† falta de uma entrada digital.  Por que mais voc√™ pode aplicar o esquema at√© que as id√©ias cheguem?  Outra ressalva: n√£o h√° d√∫vida de rentabilidade.  Mesmo que voc√™ pague todos os segmentos, uma corrente de 2,5 mA fluir√° atrav√©s do resistor R2 (de acordo com o primeiro esquema), no total 10 mA para o indicador, mais o controle do transistor adicionar√° cerca de 5 mais.  Eu n√£o mencionei, o transistor de quase qualquer pnp √© moderno. <br><br>  Sobre conveni√™ncia.  A op√ß√£o mais barata de sa√≠da para os sete segmentos √© ATtiny13 mais 74HC595.  Dois casos de SMD me custar√£o aproximadamente 0,50 cu  O mais simples √© o ATmega8 (e √© isso, sem resistores, nada mais), √© 0,68 cu  E a op√ß√£o descrita acima √© o custo do ATtiny, 9 resistores, 4 LEDs, um transistor (todos os SMDs) - isso √© cerca de 0,46 cu, embora seja pe√ßa por pe√ßa, tudo fica mais caro √†s vezes.  Al√©m disso, juntar tudo √© mais complicado do que nas vers√µes anteriores. <br><br>  Na verdade, a √∫nica op√ß√£o que posso ver √© se voc√™ possui um ATtiny13 completo, mas ainda precisa ir √† loja do ATmega.  Bem, se um indicador de sete segmentos √© a decora√ß√£o principal do seu dispositivo, eu n√£o recomendaria esse esquema, a exibi√ß√£o n√£o √© perfeita, em algumas combina√ß√µes os segmentos desnecess√°rios s√£o destacados levemente.  Ocorre que a indica√ß√£o √© ocasionalmente necess√°ria durante a instala√ß√£o e depois no pr√≥prio local. <br><br>  Em geral, passei alguns dias em v√£o. <br><br>  Al√©m das cr√≠ticas, estou aguardando sugest√µes para melhorar o c√≥digo e simplificar o esquema.  Ou funcionalidade melhorada sem complica√ß√µes.  O que mais me interessa √© como esclarecer um ponto, isso ampliaria o escopo.  Mas se tamb√©m pud√©ssemos liberar uma conclus√£o dos 5 envolvidos, seria poss√≠vel vagar. <br><br>  Ficaria feliz se minha solu√ß√£o fora do padr√£o beneficiaria algu√©m, agora n√£o, algum dia. <br><br><blockquote>  UPD: Eu sei sobre Charliplexing!  O esquema de terceiros que citei no in√≠cio deste artigo √© Charliplexing.  E l√° escrevi por que Charliplexing n√£o √© adequado. <br>  Por favor, n√£o escreva coment√°rios se voc√™ ler o artigo na diagonal. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt446796/">https://habr.com/ru/post/pt446796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt446782/index.html">Yo-ho-ho e uma garrafa de rum</a></li>
<li><a href="../pt446786/index.html">Por que eu recusei o Disqus e voc√™ deveria ir tamb√©m</a></li>
<li><a href="../pt446788/index.html">Dicas e truques do Kubernetes: sobre desenvolvimento local e telepresen√ßa</a></li>
<li><a href="../pt446790/index.html">Como descobri um ovo de p√°scoa na seguran√ßa do Android e n√£o consegui um emprego no Google</a></li>
<li><a href="../pt446794/index.html">Trabalhamos com o Wordstat corretamente. Guia completo</a></li>
<li><a href="../pt446798/index.html">A sa√≠da de um engenheiro eletr√¥nico da Apple causou alvoro√ßo entre os especuladores de a√ß√µes. Como se tornar como ele?</a></li>
<li><a href="../pt446802/index.html">Cartuchos de recarga - √â interessante</a></li>
<li><a href="../pt446806/index.html">Antecedentes: "Runet Aut√¥nomo" - o que √© e quem precisa</a></li>
<li><a href="../pt446808/index.html">Meu compilador para Lisp</a></li>
<li><a href="../pt446810/index.html">Se voc√™ tem um ma√ßo de cigarros no bolso ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>