<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤷🏾 🍖 👩🏿‍🤝‍👨🏻 为游戏平台创建逻辑游戏 🙇 🌟 👼🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="你好 

 我想分享一下我与Gameduino 3游戏平台的相识故事，以及与该平台最简单的逻辑游戏（与Arduino Uno结合使用）的编程讨论。 

 什么是Gameduino 3？ Gameduino 3是一块扩展板，可让您将Arduino变成现代的手持式（即尺寸）游戏机。 令我惊讶的是，我在集...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>为游戏平台创建逻辑游戏</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423577/"> 你好 <br><br> 我想分享一下我与Gameduino 3游戏平台的相识故事，以及与该平台最简单的逻辑游戏（与Arduino Uno结合使用）的编程讨论。 <br><br> 什么是Gameduino 3？  Gameduino 3是一块扩展板，可让您将Arduino变成现代的手持式（即尺寸）游戏机。 令我惊讶的是，我在集线器上的此板上找不到任何详细信息。 我想填补这一空白，特别是因为我认为董事会值得关注。 <br><br><h3> 一点历史 </h3><br> 名为Gameduino的项目的作者是詹姆斯·鲍曼（James Bowman），他在2011年创建了第一个版本的董事会。 然后将其定位为Arduino的VGA模块。 该板名为Gameduino，基于Xilinx Spartan-3A可编程逻辑FPGA系列。 板上安装了用于连接VGA监视器和立体声扬声器的连接器。 <img src="https://habrastorage.org/webt/as/6q/1-/as6q1-hlbbmoyubblbcs6hehog0.jpeg" alt="图片"><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Gameduino功能（1）：</b> <div class="spoiler_text"><ul><li>  VGA视频输出，分辨率为400x300像素，512色； </li><li> 所有色域均在FPGA中以15位精度进行处理； </li></ul><br> 背景图形： <br><br><ul><li> 符号背景图形区域512x512像素； </li><li>  256个字符，每个字符具有独立的4色调色板； </li><li> 通过像素平滑实现了包裹文本字符串的效果； </li></ul><br> 前台图形： <br><br><ul><li> 每个精灵的分辨率为16x16像素； </li><li> 每个精灵可以具有256、16或4色调色板； </li><li> 支持四向旋转和水平旋转算法； </li><li> 每条栅格线96个精灵，每条栅格线1536个纹理元素； </li><li> 用于检测精灵可能相交的机制； </li></ul><br> 音频输出： <br><br><ul><li>  12位双通道频率合成器； </li><li> 在10-8000 Hz频率范围内的64声音复音。 </li></ul><br> 图像显示在标准VGA监视器的屏幕上，分辨率为400x300像素， <br> 保持与任何分辨率为800x600像素的标准VGA显示器的兼容性。 <br></div></div><br>  2013年，发布了该板的第二个版本-Gameduino 2，与之前的版本不同，Gameduino 2已经有一个4.3英寸的电阻式触摸屏，分辨率为480x272，一个3轴加速度计，一个microSD存储卡插槽以及一个耳机的音频输出。 <br><br><img src="https://habrastorage.org/webt/rv/e-/vg/rve-vggbftjqtpadk4ftr7xtfq4.jpeg" alt="图片"><br><br> 板的“心脏”是图形控制器EVE（嵌入式视频引擎-俄语可以翻译为“嵌入式视频模块”）FT800，它具有强大的计算能力，同时结合了多种功能：图像形成及其输出到TFT显示屏的屏幕，触摸屏处理，声音产生。 <br><br><div class="spoiler">  <b class="spoiler_title">FT800图形控制器的功能图</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/lj/7_/dd/lj7_ddvshsrqz9f1mhfs_xhzvja.jpeg" alt="图片"><br><br> 微电路结构中包含以下功能块：图形控制器，音频控制器，电阻式触摸屏控制器。  FT800芯片旨在控制分辨率高达512 x 512像素的显示器。  FT800还支持LCD WQVGA（480 x 272）和QVGA（320 x 240）。  EVE（嵌入式视频引擎）FT800是用于创建图形用户界面的交钥匙解决方案。 微电路生成显示控制信号，具有内置的图形功能，用于显示点，线，位图图像，体积按钮，文本等。 </div></div><br><br><div class="spoiler">  <b class="spoiler_title">基于FT800图形控制器的系统结构</b> <div class="spoiler_text"> 图像的形成基于一组命令（显示列表），该命令由控制微控制器通过I2C或SPI接口传输到FT800（在Gameduino 2中，Arduino和FT800之间的通信是通过SPI接口进行的）。  FT800的功能极大地减轻了系统的主机控制器的负担。 <br><br><img src="https://habrastorage.org/webt/br/2b/2u/br2b2ueemryzlv-qxkor6whrft4.jpeg" alt="图片"><br><br> 例如，要显示多个按钮，只需将一个命令传送到图形控制器（四个32位字），FT800就会在TFT显示屏的屏幕上独立形成这些按钮的图像。  FTDI图形控制器命令集包括50多种功能，可用于以各种效果在显示屏上显示各种图像。 <br><br> 可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">FTDI</a>网站上的“应用笔记”中找到详细的控制器编程手册和使用各种设计环境的示例。 <br><br> 俄语中对功能，一般原理和工作示例进行了很好的描述。 <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Gameduino 2的功能</b> <div class="spoiler_text"><ul><li> 屏幕分辨率为480x272像素（24位彩色）； </li><li> 一组OpenGL风格的命令； </li><li> 多达2000个任何大小的精灵； </li><li>  256 KB视频内存； </li><li> 通过双线性滤波使子画面旋转和缩放平滑； </li><li> 硬件中的平滑圆形和线性图案-16倍平滑； </li><li>  JPEG硬件解码； </li><li> 渐变，文本，转盘和按钮的内置渲染。 </li></ul><br> 声音通过加强型耳机插孔输出。 <br> 该系统支持选择内置样本和工具。 <br><br> 控制器ROM已连接： <br><br><ul><li> 高质量字体（6种尺寸）； </li><li>  MIDI音符演奏的8种乐器的样本； </li><li>  10种打击乐器声音的样本。 </li></ul><br> 而且，当然，您可以将自己的字体和声音片段加载到256 KB RAM中。 <br><br> 并非必须使用Arduino平台：Gameduino 2板可通过SPI接口连接至任何微控制器或微控制器板。 </div></div><br>  2017年，发布了该板的第三个版本-Gameduino 3，其外观几乎与Gameduino 2相同。使用了新的FT810图形控制器而不是FT800，该控制器与FT800具有向后的软件兼容性（即Gameduino2的所有代码均可在Gameduino3上使用）。但同时它具有4倍的计算能力，例如更快的硬件JPEG解码，视频解码，高达1 MB的RAM等。 <br><br><div class="spoiler">  <b class="spoiler_title">特色Gameduino 3：</b> <div class="spoiler_text"><ul><li> 用于全屏30 fps视频的视频解码器； </li><li>  1 MB内部RAM； </li><li> 用于microSD卡和音频输出的连接器； </li><li>  4.3英寸480x272高对比度LCD面板，带电阻触摸屏； </li><li> 支持使用“平铺地图”编辑器创建的地图； </li><li> 从microSD下载PNG图片； </li><li> 加速JPEG解码； </li><li> 硬件肖像/风景切换； </li><li> 支持Arduino，ESP8266和Teensy 3.2; </li><li> 用于准备图形，音频，字体和视频的在线工具； </li></ul><br></div></div><br> 詹姆斯·鲍曼（James Bowman）为他的项目发布了一个库，其中包含许多开箱即用的示例。 我设法找到的当前库<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在这里</a> 。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">编程指南</a> （英语），其中详细介绍了所有内容。 有关安装IDE等的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">许多有用信息</a> 。 <br><br><h3> 程式设计 </h3><br> 不知何故，我在<s>莫斯科大剧院</s>的广阔空间中徘徊，遇到了一个有趣的Arduino项目- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">逻辑游戏“ Columns”</a> ，它以通常廉价的128x160像素中文彩色显示屏编写。 我想重复这个游戏，但是在我的主板上，我将其命名为FT810（以GPU的名称命名），那时该功能已经在我手中。 我已经设法从库中学习了编程手册和示例，因此我的双手只是“渴望”自己编写自己的东西。 我立即开始。 <br><br> 我要做的第一件事是在屏幕上显示文本。 <br><br> 由于内置字体的存在，将文本输出到屏幕非常容易。 这是库中的演示草图（带有我的评论）： <br><br><div class="spoiler">  <b class="spoiler_title">素描helloworld.ino</b> <div class="spoiler_text"><pre><code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> void setup() { Serial.begin(1000000); //   ,    1000000  GD.begin(0); //  ,   . } void loop() { GD.ClearColorRGB(0x103000); //    . GD.Clear(); //   (   ) GD.cmd_text( //  ,  GD.w / 2, //     2 GD.h / 2, //     2 31, //   OPT_CENTER, // ,         . </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello world"</span></span></span><span class="hljs-meta">); //   GD.swap(); //         (   ). }</span></span></code> </pre> 结果，我们在这里得到了这么漂亮的文字： <br><img src="https://habrastorage.org/webt/em/jq/xi/emjqxiynb2wjckhowwkvltpta9c.png" alt="图片"><br></div></div><br> 接下来，必须绘制几何形状，例如：线条。 <br> 要绘制线条，必须使用“开始”（LINES）或“开始”（LINE_STRIP）。 <br>  LINES连接每对顶点，而LINE_STRIP将所有顶点连接在一起。 <br><br> 我将从库中给出以下演示草图（并附上我的评论）： <br><br><div class="spoiler">  <b class="spoiler_title">素描lines.ino</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> void setup() { Serial.begin(1000000); //   ,    1000000 . GD.begin(); //  ,   . } static void zigzag(int x) { GD.Vertex2ii(x - 10, 10); //     GD.Vertex2ii(x + 10, 60); //     () GD.Vertex2ii(x - 10, 110); GD.Vertex2ii(x + 10, 160); GD.Vertex2ii(x - 10, 210); GD.Vertex2ii(x + 10, 260); //     () } void loop() { GD.Clear(); //   (    - 0000000) GD.Begin(LINES); //     zigzag(140); //   zigzag   -   GD.Begin(LINE_STRIP); //     zigzag(240); GD.LineWidth(16 * 10); //        1/16 , .. 1/16 * 16 * 10 = 10  GD.Begin(LINE_STRIP); zigzag(340); GD.swap(); //         (   ). }</span></span></code> </pre> <br> 屏幕上的线： <br><br><img src="https://habrastorage.org/webt/zr/bp/_w/zrbp_ws6saudfdakxpv8tf2tvwc.png" alt="图片"></div></div><br> 从线条图开始，让我们继续绘制矩形。 <br><br> 要绘制矩形，请使用Begin（RECTS）并设置矩形的相对角。 两个角度的顺序无关紧要。 使用当前线的宽度作为拐角的半径，以圆角绘制矩形。 圆角超出了矩形的边界，因此增加角度的半径将增加像素的数量。 本示例绘制三个420×20的矩形，并增加拐角半径。 <br><br><div class="spoiler">  <b class="spoiler_title">素描长方体</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> void setup() { Serial.begin(1000000); //   ,    1000000 . GD.begin(); //  ,   . } void loop() { GD.Clear(); //   (    - 0000000) GD.Begin(RECTS); //     GD.Vertex2ii(30, 30); //       GD.Vertex2ii(450, 50); //       GD.LineWidth(16 * 10); //         1/16 , .. 1/16 * 16 * 10 = 10  GD.Vertex2ii(30, 120); //       GD.Vertex2ii(450, 140); //       GD.LineWidth(16 * 20); //         1/16 , .. 1/16 * 16 * 20 = 20  GD.Vertex2ii(30, 220); //       GD.Vertex2ii(450, 230); //       GD.swap(); //         (   ) }</span></span></code> </pre> <br> 结果： <br><img src="https://habrastorage.org/webt/vg/qi/mc/vgqimcuhwc-jsiwqizewxsxlgf8.png" alt="图片"><br></div></div><br> 让我们继续画一个圆圈-将来的触摸按钮的基础。 让我们回到第一个带有文本的示例，并在loop（）中添加几行。 <br><br><div class="spoiler">  <b class="spoiler_title">用绘图彩色圆圈素描</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> void setup() { Serial.begin(1000000); //   ,    1000000  GD.begin(0); //  ,   . } void loop() { GD.ClearColorRGB(0x103000); //    . GD.Clear(); //   (   ) GD.cmd_text( //  ,  GD.w / 2, //     2 GD.h / 2, //     2 31, //   OPT_CENTER, // ,          </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello world"</span></span></span><span class="hljs-meta">); //   GD.PointSize(16 * 30); //    ()    1/16 , .. 1/16 * 16 * 30 = 30  GD.Begin(POINTS); //     () GD.ColorRGB(0xff8000); //   orange GD.Vertex2ii(220, 100); //   ()   220,100 GD.ColorRGB(0x0080ff); //   teal GD.Vertex2ii(260, 170); //   ()   260,170 GD.swap(); //         (   ) }</span></span></code> </pre> <br> 结果： <br><br><img src="https://habrastorage.org/webt/gw/rz/ja/gwrzjak3bp7sqsywwd89rwj0-5w.png"><br></div></div><br> 要使用触摸按钮，必须组织按下触摸屏的过程。 这样做如下。 我将简要解释该原理。 屏幕上的每个像素（点）都有一种颜色。 它还具有一个不可见的标记值，可以将其分配给一个点（或整个对象，例如线，圆，矩形等），并进一步用于检测该对象的触摸。 下图显示了将彩色圆圈的标记值设置为100和101的示例。 <br><br><div class="spoiler">  <b class="spoiler_title">触摸屏素描</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> void setup() { Serial.begin(1000000); //   ,    1000000  GD.begin(0); //  ,   . } void loop() { GD.ClearColorRGB(0x103000); //    . GD.Clear(); //   (   ) GD.cmd_text( //  ,  GD.w / 2, //     2 GD.h / 2, //     2 31, //   OPT_CENTER, // ,          </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello world"</span></span></span><span class="hljs-meta">); //   GD.PointSize(16 * 30); //    ()    1/16 , .. 1/16 * 16 * 30 = 30  GD.Begin(POINTS); //     () GD.ColorRGB(0xff8000); //   orange GD.Tag(100); //       () GD.Vertex2ii(220, 100); //   ()   220,100 GD.ColorRGB(0x0080ff); //   teal GD.Tag(101); //       () GD.Vertex2ii(260, 170); //   ()   260,170 GD.swap(); //         (   ) GD.get_inputs(); //     if(GD.inputs.tag &gt; 0) //      Serial.println(GD.inputs.tag); //       “”  }</span></span></code> </pre> <br> 现在，当系统检测到触摸任何圆圈时，它将报告其传感器代码，在这种情况下为100或101。在串行端口窗口的屏幕上单击对象（彩色圆圈）时，将显示与所按下对象相对应的标签的值： <br><br><img src="https://habrastorage.org/webt/lh/q3/u_/lhq3u_jn8obrrcjy_kwke8m6gdw.png"><br></div></div><br> 我举了一些基本操作的例子，已经可以安全地进行游戏的创建了。 当然，游戏并不是从头开始创建的，而是以现成的工作代码为基础，并对其进行了改编（同时保留了图形），因此游戏的原始版本与原始版本非常相似。 <br><br> 游戏的第一个版本： <br><br><img src="https://habrastorage.org/webt/3f/no/xg/3fnoxgf8auqkkotrp1lgtjqk6kq.jpeg"><br><br> 玩了几天后，我想更改设计中的某些内容，例如添加其他一些不寻常的背景，而不是白色背景。 然后我想起了图书馆的一个例子，其中星空在背景中闪烁： <br><br><div class="spoiler">  <b class="spoiler_title">插槽素描slotgag.ino</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"slotgag_assets.h"</span></span></span><span class="hljs-meta"> //      void setup() { Serial.begin(1000000); GD.begin(); LOAD_ASSETS(); //     } void loop() { GD.Clear(); //   ( ,     ) GD.ColorMask(1, 1, 1, 0); //        R, G, B,   GD.Begin(BITMAPS); //      GD.BitmapHandle(BACKGROUND_HANDLE); //   - GD.BitmapSize(NEAREST, REPEAT, REPEAT, 480, 272); //        GD.Vertex2ii(0, 0, BACKGROUND_HANDLE); //      0,0 GD.ColorMask(1, 1, 1, 1); GD.ColorRGB(0xa0a0a0); GD.Vertex2ii(240 - GAMEDUINO_WIDTH / 2, 136 - GAMEDUINO_HEIGHT / 2, GAMEDUINO_HANDLE); static int x = 0; GD.LineWidth(20 * 16); GD.BlendFunc(DST_ALPHA, ONE); GD.Begin(LINES); GD.Vertex2ii(x, 0); GD.Vertex2ii(x + 100, 272); x = (x + 20) % 480; //' }a GD.swap(); }</span></span></code> </pre> <br> 查看： <br><br><img src="https://habrastorage.org/webt/x-/es/y4/x-esy4aropwlyqh0bvl75jf1qpg.png"><br><br> 为了不致于无所适从，我没有评论整个代码，而只是评论了复制到工作草图中的必要代码行。 </div></div><br> 要将星空的图片添加为背景，我必须执行以下操作：首先，将线条和文本的黑色更改为白色（以便它们在黑色背景上可见），将文件slotgag.gd2写入用于存储图像的micro SD卡，将slotgag_assets.h添加到项目文件夹，并将必要的8行代码添加到草图。 <br><br> 结果，游戏获得了以下形式： <br><br><img src="https://habrastorage.org/webt/2t/hh/qo/2thhqo_apc-nidsqbcuudt98bwe.jpeg"><br><br> 当然，没有声音设计的游戏是什么？ 仍然需要增加声音效果，特别是因为它们以高质量和多样化呈现。 <br><br>  Gameduino 2/3具有两个声音系统。 第一个是合成器，可以生成一组固定的声音和音符。 合成器对于将声音快速添加到项目很有用，但是由于声音的集合是固定的，因此不是很灵活。 第二是样品复制。 它以各种格式从主存储器中再现采样的声音。 该系统更加灵活，但是您需要准备样本并将其加载到RAM中。 <br><br> 我使用了固定的声音合成器。 合成器提供了几种简短的“打击乐”声音，主要用于用户界面。 要播放声音，必须使用声音标识符调用GD.play（）。 可用声音的完整列表： <br><br> 请点击 <br> 拨动开关 <br> 牛铃 <br> 缺口 <br>  hat <br> 踢鼓 <br> 流行音乐 <br>  lack <br>  ACK <br><br><h3> 总结 </h3><br> 结果是这样的草图： <br><br><div class="spoiler">  <b class="spoiler_title">素描Columns.ino</b> <div class="spoiler_text"><pre> <code class="hljs lua">#include &lt;SPI.h&gt; #include &lt;GD2.h&gt; #include &lt;avr/eeprom.h&gt; #include <span class="hljs-string"><span class="hljs-string">"slotgag_assets.h"</span></span> #define TAG_BUTTON_LEFT <span class="hljs-number"><span class="hljs-number">201</span></span> #define TAG_BUTTON_RIGHT <span class="hljs-number"><span class="hljs-number">202</span></span> #define TAG_BUTTON_ROT <span class="hljs-number"><span class="hljs-number">203</span></span> #define TAG_BUTTON_DROP <span class="hljs-number"><span class="hljs-number">204</span></span> #define X_BUTTON_LEFT <span class="hljs-number"><span class="hljs-number">50</span></span> #define Y_BUTTON_LEFT <span class="hljs-number"><span class="hljs-number">222</span></span> #define X_BUTTON_RIGHT <span class="hljs-number"><span class="hljs-number">430</span></span> #define Y_BUTTON_RIGHT <span class="hljs-number"><span class="hljs-number">222</span></span> #define X_BUTTON_ROT <span class="hljs-number"><span class="hljs-number">430</span></span> #define Y_BUTTON_ROT <span class="hljs-number"><span class="hljs-number">50</span></span> #define X_BUTTON_DROP <span class="hljs-number"><span class="hljs-number">50</span></span> #define Y_BUTTON_DROP <span class="hljs-number"><span class="hljs-number">50</span></span> // Color definitions #define BLACK <span class="hljs-number"><span class="hljs-number">0x000000</span></span> #define RED <span class="hljs-number"><span class="hljs-number">0xFF0000</span></span> #define GREEN <span class="hljs-number"><span class="hljs-number">0x00FF00</span></span> #define BLUE <span class="hljs-number"><span class="hljs-number">0x0000FF</span></span> #define YELLOW <span class="hljs-number"><span class="hljs-number">0xFFFF00</span></span> #define MAGENTA <span class="hljs-number"><span class="hljs-number">0xFF00FF</span></span> #define CYAN <span class="hljs-number"><span class="hljs-number">0x00FFFF</span></span> #define WHITE <span class="hljs-number"><span class="hljs-number">0xFFFFFF</span></span> #define DISPLAY_MAX_X <span class="hljs-number"><span class="hljs-number">480</span></span> #define DISPLAY_MAX_Y <span class="hljs-number"><span class="hljs-number">272</span></span> #define MaxX <span class="hljs-number"><span class="hljs-number">8</span></span> #define MaxY <span class="hljs-number"><span class="hljs-number">17</span></span> #define SmeX <span class="hljs-number"><span class="hljs-number">3</span></span> #define SmeY <span class="hljs-number"><span class="hljs-number">3</span></span> #define razmer <span class="hljs-number"><span class="hljs-number">18</span></span> #define NumCol <span class="hljs-number"><span class="hljs-number">6</span></span> #define MaxLevel <span class="hljs-number"><span class="hljs-number">8</span></span> #define NextLevel <span class="hljs-number"><span class="hljs-number">80</span></span> #define DISP_LEFT ((DISPLAY_MAX_X - MaxX*razmer)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>) #define DISP_RIGHT ((DISPLAY_MAX_X + MaxX*razmer)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>) #define DISP_TOP ((DISPLAY_MAX_Y - (MaxY<span class="hljs-number"><span class="hljs-number">-4</span></span>)*razmer)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>) #define DISP_BOT ((DISPLAY_MAX_Y + (MaxY<span class="hljs-number"><span class="hljs-number">-4</span></span>)*razmer)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>) uint8_t MasSt[MaxX][MaxY], MasTmp[MaxX][MaxY], fignext[<span class="hljs-number"><span class="hljs-number">3</span></span>]; uint8_t Level=<span class="hljs-number"><span class="hljs-number">1</span></span>, dx, dy, tr, flfirst=<span class="hljs-number"><span class="hljs-number">1</span></span>; uint32_t MasCol[]={WHITE, BLACK, RED, BLUE, GREEN, YELLOW, MAGENTA, CYAN}; unsigned long Counter, Score=<span class="hljs-number"><span class="hljs-number">0</span></span>, TScore=<span class="hljs-number"><span class="hljs-number">0</span></span>, Record=<span class="hljs-number"><span class="hljs-number">0</span></span>, myrecord; uint16_t tempspeed = <span class="hljs-number"><span class="hljs-number">1000</span></span>; bool fl, Demo=<span class="hljs-literal"><span class="hljs-literal">true</span></span>, Arbeiten=<span class="hljs-literal"><span class="hljs-literal">false</span></span>, FlZ=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; int8_t x,y; int8_t mmm [<span class="hljs-number"><span class="hljs-number">4</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>]={{<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>},{<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>},{<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>},{<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}}; uint16_t MasSpeed[MaxLevel]={<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">450</span></span>,<span class="hljs-number"><span class="hljs-number">400</span></span>,<span class="hljs-number"><span class="hljs-number">350</span></span>,<span class="hljs-number"><span class="hljs-number">300</span></span>,<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">200</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>}; uint8_t state_game = <span class="hljs-number"><span class="hljs-number">0</span></span>; unsigned long time_count; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> prevkey; uint32_t btn_color = <span class="hljs-number"><span class="hljs-number">0xff0000</span></span>; /****************************************************************************************************************/ void setup(void) { Serial.begin(<span class="hljs-number"><span class="hljs-number">1000000</span></span>); Serial.println(<span class="hljs-string"><span class="hljs-string">"Columns"</span></span>); GD.begin(); LOAD_ASSETS(); GD.BitmapHandle(BACKGROUND_HANDLE); GD.BitmapSize(NEAREST, REPEAT, REPEAT, <span class="hljs-number"><span class="hljs-number">480</span></span>, <span class="hljs-number"><span class="hljs-number">272</span></span>); randomSeed(analogRead(<span class="hljs-number"><span class="hljs-number">5</span></span>)); myrecord = eeprom_read_byte((unsigned <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> *)<span class="hljs-number"><span class="hljs-number">1</span></span>); time_count = millis() + <span class="hljs-number"><span class="hljs-number">1000</span></span>; } static struct { <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> t, note; } pacman[] = { { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">71</span></span> }, { <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span> }, { <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span> }, { <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span> }, { <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span> }, { <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span> }, { <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span> }, { <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">72</span></span> }, { <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">84</span></span> }, { <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">79</span></span> }, { <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">76</span></span> }, { <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">84</span></span> }, { <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">79</span></span> }, { <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">76</span></span> }, { <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">71</span></span> }, { <span class="hljs-number"><span class="hljs-number">34</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span> }, { <span class="hljs-number"><span class="hljs-number">36</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span> }, { <span class="hljs-number"><span class="hljs-number">38</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span> }, { <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span> }, { <span class="hljs-number"><span class="hljs-number">41</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span> }, { <span class="hljs-number"><span class="hljs-number">44</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span> }, { <span class="hljs-number"><span class="hljs-number">48</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span> }, { <span class="hljs-number"><span class="hljs-number">49</span></span>, <span class="hljs-number"><span class="hljs-number">76</span></span> }, { <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">77</span></span> }, { <span class="hljs-number"><span class="hljs-number">52</span></span>, <span class="hljs-number"><span class="hljs-number">77</span></span> }, { <span class="hljs-number"><span class="hljs-number">53</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span> }, { <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">79</span></span> }, { <span class="hljs-number"><span class="hljs-number">56</span></span>, <span class="hljs-number"><span class="hljs-number">79</span></span> }, { <span class="hljs-number"><span class="hljs-number">57</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span> }, { <span class="hljs-number"><span class="hljs-number">58</span></span>, <span class="hljs-number"><span class="hljs-number">81</span></span> }, { <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span> }, { <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span> } }; //================================================== void loop(void) { GD.get_inputs(); <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> key = GD.inputs.tag; int8_t VAL = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevkey == <span class="hljs-number"><span class="hljs-number">0x00</span></span>) { switch (key) { case TAG_BUTTON_LEFT: VAL = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case TAG_BUTTON_RIGHT: VAL = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case TAG_BUTTON_ROT: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!FlZ) { GD.play(HIHAT); <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> aa=MasSt[x][y]; MasSt[x][y]=MasSt[x][y+<span class="hljs-number"><span class="hljs-number">2</span></span>]; MasSt[x][y+<span class="hljs-number"><span class="hljs-number">2</span></span>]=MasSt[x][y+<span class="hljs-number"><span class="hljs-number">1</span></span>]; MasSt[x][y+<span class="hljs-number"><span class="hljs-number">1</span></span>]=aa; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case TAG_BUTTON_DROP: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Arbeiten) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!FlZ) { tempspeed=<span class="hljs-number"><span class="hljs-number">50</span></span>; GD.play(NOTCH); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { GD.play(CLICK); Demo=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; NewGame(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } prevkey = key; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VAL!=<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; fig_shift(VAL) &amp;&amp; !FlZ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) { MasSt[x+VAL][y+i]=MasSt[x][y+i]; MasSt[x][y+i]=<span class="hljs-number"><span class="hljs-number">0</span></span>; } x=x+VAL; } ProcGame(); ViewStacan(); GD.swap(); } //================================================== // redraw one square void ViewQuad(<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i,<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> j,<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> mycolor) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; uint16_t wy=DISP_TOP + SmeY+(j<span class="hljs-number"><span class="hljs-number">-3</span></span>)*razmer-j; uint16_t wx=DISP_LEFT + SmeX+i*razmer-i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mycolor!=<span class="hljs-number"><span class="hljs-number">0</span></span>) { GD.LineWidth(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.ColorRGB(WHITE); GD.Begin(LINE_STRIP); GD.Vertex2ii(wx,wy); GD.Vertex2ii(wx + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>,wy); GD.Vertex2ii(wx + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>,wy + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>); GD.Vertex2ii(wx,wy + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>); GD.Vertex2ii(wx,wy); GD.Begin(RECTS); GD.ColorRGB(MasCol[mycolor]); GD.Vertex2ii(wx+<span class="hljs-number"><span class="hljs-number">1</span></span>, wy+<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.Vertex2ii(wx+<span class="hljs-number"><span class="hljs-number">1</span></span> + razmer<span class="hljs-number"><span class="hljs-number">-2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>, wy+<span class="hljs-number"><span class="hljs-number">1</span></span> + razmer<span class="hljs-number"><span class="hljs-number">-2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { } } //================================================== void ViewStacan(void) { <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> myStr2[<span class="hljs-number"><span class="hljs-number">5</span></span>]; // Draw background fone GD.Clear(); GD.ColorMask(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); GD.Begin(BITMAPS); GD.BitmapHandle(BACKGROUND_HANDLE); GD.BitmapSize(NEAREST, REPEAT, REPEAT, <span class="hljs-number"><span class="hljs-number">480</span></span>, <span class="hljs-number"><span class="hljs-number">272</span></span>); GD.Vertex2ii(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, BACKGROUND_HANDLE); // Print text GD.ColorRGB(WHITE); GD.cmd_text(DISP_LEFT - <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"LEVEL"</span></span>); GD.cmd_text(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"NEXT"</span></span>); GD.cmd_text(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"SCORE"</span></span>); GD.cmd_text(DISP_LEFT - <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"TOP"</span></span>); // Print digit Score GD.ColorRGB(RED); sprintf(myStr2,<span class="hljs-string"><span class="hljs-string">"%05d"</span></span>,Score ); GD.cmd_text(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, myStr2); // Print digit Top sprintf(myStr2,<span class="hljs-string"><span class="hljs-string">"%05d"</span></span>,myrecord ); GD.cmd_text(DISP_LEFT - <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, myStr2); // Print digit Level sprintf(myStr2,<span class="hljs-string"><span class="hljs-string">"%02d"</span></span>,Level ); GD.cmd_text(DISP_LEFT - <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, OPT_CENTER, myStr2); // Draw color squares <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) ViewQuad(i,j,MasSt[i][j]); // Draw Next Figure <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) { GD.ColorRGB(WHITE); GD.Begin(LINE_STRIP); GD.LineWidth(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.Vertex2ii(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">15</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">20</span></span> + razmer*ii); GD.Vertex2ii(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">15</span></span> + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">20</span></span> + razmer*ii); GD.Vertex2ii(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">15</span></span> + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">20</span></span> + razmer*ii + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>); GD.Vertex2ii(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">15</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">20</span></span> + razmer*ii + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>); GD.Vertex2ii(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">15</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">20</span></span> + razmer*ii); GD.Begin(RECTS); GD.ColorRGB(MasCol[fignext[i]]); GD.Vertex2ii(DISP_RIGHT+<span class="hljs-number"><span class="hljs-number">15</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_TOP+<span class="hljs-number"><span class="hljs-number">20</span></span>+razmer*i-i+<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.Vertex2ii(DISP_RIGHT+<span class="hljs-number"><span class="hljs-number">15</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>+razmer<span class="hljs-number"><span class="hljs-number">-2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>, DISP_TOP+<span class="hljs-number"><span class="hljs-number">20</span></span>+razmer*i-i+<span class="hljs-number"><span class="hljs-number">1</span></span>+razmer<span class="hljs-number"><span class="hljs-number">-2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>); } // Draw <span class="hljs-string"><span class="hljs-string">"stacan"</span></span> GD.ColorRGB(WHITE); GD.Begin(LINE_STRIP); GD.LineWidth(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_TOP); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_BOT); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">1</span></span> + razmer*MaxX+<span class="hljs-number"><span class="hljs-number">5</span></span>-MaxX - <span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_BOT); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">1</span></span> + razmer*MaxX+<span class="hljs-number"><span class="hljs-number">5</span></span>-MaxX - <span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_TOP); // Draw <span class="hljs-number"><span class="hljs-number">9</span></span> vertical <span class="hljs-built_in"><span class="hljs-built_in">lines</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">9</span></span>; i++) { GD.ColorRGB(WHITE); GD.Begin(LINE_STRIP); GD.LineWidth(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">3</span></span> + razmer*ii, DISP_TOP); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">3</span></span> + razmer*ii, DISP_BOT - <span class="hljs-number"><span class="hljs-number">2</span></span>); } // Draw <span class="hljs-number"><span class="hljs-number">1</span></span> horizontal line GD.ColorRGB(WHITE); GD.Begin(LINE_STRIP); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">3</span></span>, DISP_BOT - <span class="hljs-number"><span class="hljs-number">2</span></span>); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">3</span></span> + razmer*MaxX-MaxX - <span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_BOT - <span class="hljs-number"><span class="hljs-number">2</span></span>); // Draw <span class="hljs-string"><span class="hljs-string">"Game Over"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Demo &amp;&amp; !Arbeiten) { GD.Begin(RECTS); GD.ColorRGB(WHITE); GD.Vertex2ii((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">60</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">60</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.ColorRGB(BLACK); GD.Vertex2ii((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">58</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">38</span></span>); GD.Vertex2ii((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">58</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">38</span></span>); GD.ColorRGB(RED); GD.cmd_text((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"GAME"</span></span>); GD.cmd_text((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"OVER"</span></span>); } // Draw Buttons GD.Begin(POINTS); GD.PointSize(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">50</span></span>); // Set size of buttons (<span class="hljs-number"><span class="hljs-number">50</span></span> pix) GD.ColorRGB(btn_color); // Set fone color of buttons GD.Tag(TAG_BUTTON_LEFT); // Set TAG <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> BUTTON_LEFT GD.Vertex2ii( X_BUTTON_LEFT, Y_BUTTON_LEFT); // Place BUTTON1 GD.Tag(TAG_BUTTON_RIGHT); // Set TAG <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> BUTTON_RIGHT GD.Vertex2ii(X_BUTTON_RIGHT, Y_BUTTON_RIGHT); // Place BUTTON2 GD.Tag(TAG_BUTTON_ROT); // Set TAG <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> BUTTON_ROT GD.Vertex2ii( X_BUTTON_ROT, Y_BUTTON_ROT); // Place BUTTON3 GD.Tag(TAG_BUTTON_DROP); // Set TAG <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> BUTTON_DROP GD.Vertex2ii(X_BUTTON_DROP, Y_BUTTON_DROP); // Place BUTTON4 // Draw figures <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> buttons circles GD.Tag(<span class="hljs-number"><span class="hljs-number">255</span></span>); GD.ColorRGB(<span class="hljs-number"><span class="hljs-number">0xffff00</span></span>); GD.LineWidth(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">2</span></span>); GD.Begin(LINE_STRIP); GD.Vertex2ii(X_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_LEFT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_LEFT, Y_BUTTON_LEFT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_LEFT, Y_BUTTON_LEFT - <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_LEFT - <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_LEFT); GD.Vertex2ii(X_BUTTON_LEFT, Y_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_LEFT, Y_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_LEFT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Begin(LINE_STRIP); GD.Vertex2ii(X_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT, Y_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT, Y_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT + <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_RIGHT); GD.Vertex2ii(X_BUTTON_RIGHT, Y_BUTTON_RIGHT + <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT, Y_BUTTON_RIGHT + <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_RIGHT + <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Begin(LINE_STRIP); GD.Vertex2ii(X_BUTTON_ROT - <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_ROT); GD.Vertex2ii(X_BUTTON_ROT, Y_BUTTON_ROT - <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_ROT + <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_ROT); GD.Vertex2ii(X_BUTTON_ROT, Y_BUTTON_ROT + <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_ROT - <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_ROT); GD.Begin(LINE_STRIP); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Arbeiten) { GD.Vertex2ii(X_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>); GD.Vertex2ii(X_BUTTON_DROP + <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>); GD.Vertex2ii(X_BUTTON_DROP, Y_BUTTON_DROP + <span class="hljs-number"><span class="hljs-number">30</span></span>); GD.Vertex2ii(X_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { GD.Vertex2ii(X_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>, Y_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_DROP + <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_DROP); GD.Vertex2ii(X_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>, Y_BUTTON_DROP + <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>, Y_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">40</span></span>); } } //================================================== void ClearMas(<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> MasStx[MaxX][MaxY]) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> j=<span class="hljs-number"><span class="hljs-number">0</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) MasStx[i][j]=<span class="hljs-number"><span class="hljs-number">0</span></span>; } //================================================== void Sosed(int i,int j,int dx,int dy, <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> mode) { int nx=i+dx; int ny=j+dy; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nx&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; ny&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; nx&lt;MaxX &amp;&amp; ny&lt;MaxY &amp;&amp; MasSt[nx][ny]==MasSt[i][j]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mode==<span class="hljs-number"><span class="hljs-number">1</span></span>) MasTmp[i][j]++; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mode==<span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; (MasTmp[nx][ny]&gt;<span class="hljs-number"><span class="hljs-number">1</span></span> || MasTmp[i][j]&gt;<span class="hljs-number"><span class="hljs-number">2</span></span> )) { MasTmp[nx][ny]=<span class="hljs-number"><span class="hljs-number">3</span></span>; MasTmp[i][j]=<span class="hljs-number"><span class="hljs-number">3</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mode==<span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; MasTmp[nx][ny]==<span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasTmp[i][j]!=<span class="hljs-number"><span class="hljs-number">3</span></span>) { MasTmp[i][j]=<span class="hljs-number"><span class="hljs-number">3</span></span>; fl=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } } } } //================================================== void Sos(int i,int j, <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> mode) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> k=<span class="hljs-number"><span class="hljs-number">0</span></span>;k&lt;<span class="hljs-number"><span class="hljs-number">4</span></span>;k++) Sosed(i,j,mmm[k][<span class="hljs-number"><span class="hljs-number">0</span></span>],mmm[k][<span class="hljs-number"><span class="hljs-number">1</span></span>],mode); } //================================================== // <span class="hljs-built_in"><span class="hljs-built_in">create</span></span> <span class="hljs-built_in"><span class="hljs-built_in">next</span></span> figure void GetNext(void) { x=<span class="hljs-number"><span class="hljs-number">3</span></span>; y=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Demo) MasSt[x][i]=fignext[i]; fignext[i]=<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(NumCol)+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Demo) { Counter++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Counter==NextLevel) { Counter=<span class="hljs-number"><span class="hljs-number">0</span></span>; Level++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Level&gt;MaxLevel) Level=MaxLevel; } tempspeed=MasSpeed[Level<span class="hljs-number"><span class="hljs-number">-1</span></span>]; } } //================================================== // <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> onecolor elements bool FindFull(void) { <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i,j,k; bool res; res=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> k=<span class="hljs-number"><span class="hljs-number">2</span></span>;k&lt;<span class="hljs-number"><span class="hljs-number">8</span></span>;k++) { // by every color ClearMas(MasTmp); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasSt[i][j]==k) Sos(i,j,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasTmp[i][j]&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>) Sos(i,j,<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { fl=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasTmp[i][j]&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) Sos(i,j,<span class="hljs-number"><span class="hljs-number">3</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (fl); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasTmp[i][j]==<span class="hljs-number"><span class="hljs-number">3</span></span>) { MasSt[i][j]=<span class="hljs-number"><span class="hljs-number">1</span></span>; TScore++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(res); } //================================================ // move figure down bool fig_drop(int dy) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dy&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; !FlZ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (y+dy+<span class="hljs-number"><span class="hljs-number">2</span></span>&gt;MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span> || MasSt[x+dx][y+dy+<span class="hljs-number"><span class="hljs-number">2</span></span>]&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (y&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>) { gameover(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (y+dy+dy+<span class="hljs-number"><span class="hljs-number">2</span></span>&gt;MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span> || MasSt[x+dx][y+dy+dy+<span class="hljs-number"><span class="hljs-number">2</span></span>]&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { GD.play(COWBELL); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) MasSt[x][y+<span class="hljs-number"><span class="hljs-number">2</span></span>-i+dy]=MasSt[x][y+<span class="hljs-number"><span class="hljs-number">2</span></span>-i]; MasSt[x][y]=<span class="hljs-number"><span class="hljs-number">0</span></span>; y=y+dy; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } //================================================ // move figure left/right (shift) bool fig_shift(int dx) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x+dx&lt;<span class="hljs-number"><span class="hljs-number">0</span></span> || x+dx&gt;MaxX<span class="hljs-number"><span class="hljs-number">-1</span></span>) { GD.play(COWBELL); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dx!=<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasSt[x+dx][y+dy+<span class="hljs-number"><span class="hljs-number">2</span></span>]==<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x+dx+dx&lt;<span class="hljs-number"><span class="hljs-number">0</span></span> || x+dx+dx&gt;MaxX<span class="hljs-number"><span class="hljs-number">-1</span></span>) GD.play(COWBELL); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> GD.play(CHACK); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { GD.play(COWBELL); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } //================================================== // State-machine void ProcGame(void) { <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i,j,k; bool res = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (time_count &lt; millis()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Arbeiten) time_count = millis() + tempspeed; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> time_count = millis() + <span class="hljs-number"><span class="hljs-number">1000</span></span>; switch (state_game) { // Demo case <span class="hljs-number"><span class="hljs-number">0</span></span>: Score=<span class="hljs-number"><span class="hljs-number">0</span></span>; GetNext(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) MasSt[i][j]=<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>)+<span class="hljs-number"><span class="hljs-number">2</span></span>; state_game = <span class="hljs-number"><span class="hljs-number">1</span></span>; TScore=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">1</span></span>: FindFull(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TScore&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { FlZ=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; time_count = millis() + <span class="hljs-number"><span class="hljs-number">500</span></span>; } state_game = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">0</span></span>;j&lt;MaxY;j++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span>-j]==<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (k=<span class="hljs-number"><span class="hljs-number">0</span></span>;k&lt;MaxY<span class="hljs-number"><span class="hljs-number">-2</span></span>-j;k++) MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span>-kj] = MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-2</span></span>-kj]; res=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(res) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TScore&gt;<span class="hljs-number"><span class="hljs-number">7</span></span>) Score=Score+TScore+(TScore<span class="hljs-number"><span class="hljs-number">-8</span></span>)*<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Score=Score+TScore; state_game = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { state_game = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; // Arbeiten case <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fig_drop(<span class="hljs-number"><span class="hljs-number">1</span></span>)) { tempspeed=MasSpeed[Level<span class="hljs-number"><span class="hljs-number">-1</span></span>]; TScore=<span class="hljs-number"><span class="hljs-number">0</span></span>; FindFull(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TScore&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { GD.play(KICKDRUM); FlZ=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; state_game = <span class="hljs-number"><span class="hljs-number">4</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { FlZ=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; GetNext(); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">0</span></span>;j&lt;MaxY;j++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span>-j]==<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (k=<span class="hljs-number"><span class="hljs-number">0</span></span>;k&lt;MaxY<span class="hljs-number"><span class="hljs-number">-2</span></span>-j;k++) MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span>-kj] = MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-2</span></span>-kj]; res=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(res) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TScore&gt;<span class="hljs-number"><span class="hljs-number">7</span></span>) Score=Score+TScore+(TScore<span class="hljs-number"><span class="hljs-number">-8</span></span>)*<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Score=Score+TScore; state_game = <span class="hljs-number"><span class="hljs-number">5</span></span>; FlZ=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; GD.play(CLACK); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { state_game = <span class="hljs-number"><span class="hljs-number">3</span></span>; FlZ=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; time_count = millis() + <span class="hljs-number"><span class="hljs-number">100</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">5</span></span>: state_game = <span class="hljs-number"><span class="hljs-number">3</span></span>; FlZ=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; default: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } //================================================ // start new game void NewGame() { Score = <span class="hljs-number"><span class="hljs-number">0</span></span>; FlZ = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; ClearMas(MasSt); Arbeiten = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; GetNext(); Counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; Level = <span class="hljs-number"><span class="hljs-number">1</span></span>; tempspeed = MasSpeed[<span class="hljs-number"><span class="hljs-number">0</span></span>]; Record = myrecord; state_game = <span class="hljs-number"><span class="hljs-number">3</span></span>; } //================================================ // draw <span class="hljs-string"><span class="hljs-string">"GAME OVER"</span></span> void gameover() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Arbeiten==<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { GD.play(SWITCH); Arbeiten=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Score&gt;myrecord) { myrecord=Score; eeprom_write_byte((unsigned <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> *) <span class="hljs-number"><span class="hljs-number">1</span></span>, myrecord); } } }</code> </pre> </div></div><div class="spoiler">  <b class="spoiler_title">slotgag_assets.h</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOAD_ASSETS() GD.safeload(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"slotgag.gd2"</span></span></span><span class="hljs-meta">); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BACKGROUND_HANDLE 0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BACKGROUND_WIDTH 256 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BACKGROUND_HEIGHT 256 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BACKGROUND_CELLS 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GAMEDUINO_HANDLE 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GAMEDUINO_WIDTH 395 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GAMEDUINO_HEIGHT 113 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GAMEDUINO_CELLS 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ASSETS_END 220342UL static const shape_t BACKGROUND_SHAPE = {0, 256, 256, 0}; static const shape_t GAMEDUINO_SHAPE = {1, 395, 113, 0};</span></span></code> </pre></div></div><br> 我相信我已经完成了为该电路板创建第一个工作草图的任务。 我希望至少有人对阅读我的故事感兴趣。 欢迎批评和评论。 这些计划不会停止，继续前进，当然也不会共享经验和知识。 <br><br> 为了演示该板的操作，我发布了一个有声<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">视频</a> （警告！声音大！）。 <br> 谢谢您的关注。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN423577/">https://habr.com/ru/post/zh-CN423577/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN423567/index.html">再谈人工智能</a></li>
<li><a href="../zh-CN423569/index.html">我们简单准确地定义消息的语言</a></li>
<li><a href="../zh-CN423571/index.html">MetaPost中的各种事情</a></li>
<li><a href="../zh-CN423573/index.html">同步性是一个神话</a></li>
<li><a href="../zh-CN423575/index.html">微电子学的设计标准：7纳米技术中真正有7纳米在哪里？</a></li>
<li><a href="../zh-CN423579/index.html">WebGL的云服务？ 不用了</a></li>
<li><a href="../zh-CN423583/index.html">通过OSS中的NotificationIRP处理事故</a></li>
<li><a href="../zh-CN423585/index.html">实时：iOS和Android上的CI / CD</a></li>
<li><a href="../zh-CN423587/index.html">在centos 7上从mysql 5.7构建InnoDB集群</a></li>
<li><a href="../zh-CN423589/index.html">我们如何选择TTS作为字典中的声音示例</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>