<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤛🏾 🙌🏾 👩🏽‍🤝‍👨🏾 Stasiun cuaca otonom pada pengontrol ATMEGA328P dan bertenaga baterai dengan sensor jarak jauh nirkabel 🆗 🚥 💝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Memperbaiki termostat kamar saya , yang saya tulis sebelumnya , saya berangkat untuk menambahkannya dengan sensor suhu nirkabel untuk mengukur suhu ud...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Stasiun cuaca otonom pada pengontrol ATMEGA328P dan bertenaga baterai dengan sensor jarak jauh nirkabel</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470381/"><p>  Memperbaiki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">termostat kamar</a> saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">, yang saya tulis sebelumnya</a> , saya berangkat untuk menambahkannya dengan sensor suhu nirkabel untuk mengukur suhu udara luar ruangan, memasang termostat bertenaga baterai dan mengganti modul penerima-penerima RF 433MHz dengan sepasang modul radio lainnya dengan jangkauan modul radio yang lebih panjang dengan jangkauan komunikasi yang lebih panjang pada tegangan suplai yang tidak lebih dari 3V.  Dalam penyelesaian masalah ini, sebuah stasiun cuaca otonom muncul, yang akan dibahas di bawah ini. </p><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dd/vj/6r/ddvj6rih_mxyi4izpiz4iplozik.gif"></div><br><p>  Stasiun cuaca terdiri dari dua node, sebut saja mereka penganalisa dan termometer untuk kesederhanaan.  Komunikasi antar node - nirkabel, melalui udara. </p><br><p>  Alat analisis ini didasarkan pada pengontrol ATMEGA328P dan mengukur suhu dan kelembaban di dalam ruangan (sensor suhu dan kelembaban DHT22) dan tegangan suplai alat analisis, yang disediakan oleh dua baterai AA 1.5V.  Pengontrol menerima sinyal dari penerima LoRa, yang menerima informasi dari termometer (sensor jarak jauh) melalui udara.  Informasi dari pengontrol ditampilkan pada LCD NOKIA 5110. </p><br><p>  Termometer, yang juga dipasang pada pengontrol ATMEGA328P, mengukur suhu luar-ruang (sensor suhu DS18B20) dan tegangan suplai dari unit jarak jauh, yang diatur pada dua baterai AA 1,5 V. Pemancar LoRa dari unit ini mentransfer suhu dan tegangan suplai ke alat analisis. </p><br><p>  Kontroler ATMEGA328P dan pemancar LoRa dari termometer dimasukkan ke mode tidur untuk menghemat daya baterai setelah pengukuran dan mengirim informasi.  Tegangan catu daya ke sensor DS18B20 diterapkan secara terprogram hanya selama durasi pengukuran suhu.  Mengukur dan mengirim data dari termometer dilakukan dengan periode sekitar satu menit. </p><br><p>  Dalam mode kerja-tidur yang sama, alat analisa juga bekerja.  Durasi pengontrol dan penerima analisis selama beberapa detik lebih dari satu menit.  Ini dilakukan untuk menerima sinyal dari termometer dengan percaya diri - bagaimanapun juga, operasi termometer dan alat analisa tidak disinkronkan.  Kemudian ATMEGA328P dan penerima LoRa diatur ke mode tidur selama 14 menit sebelum bangun dan memulai siklus berikutnya.  DHT22 hanya menyediakan daya selama pengukuran. </p><br><p>  Untuk memprogram mode tidur pengendali ATMEGA328P, perpustakaan LowPower.h digunakan. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dengan keluarnya baterai, nilai tegangan berkurang pada mereka.</a> </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ob/hi/6z/obhi6ztutl3wckifbjzbg0p-pcs.png"></div><br><p>  Batas bawah tegangan operasi untuk pengontrol ATMEGA328P adalah 1.8V.  Pada saat yang sama, instalasi pabrik sekering ATMEGA328P dilakukan untuk memantau ambang tegangan suplai 2,7V, sehingga perlu untuk mengubah pengaturan pabrik sekring ke ambang pemantauan 1,8V untuk menjamin pengoperasian pengontrol ketika ditenagai oleh baterai yang terkuras. </p><br><p>  Generator pengontrol internal mungkin tidak mulai pada frekuensi 16 MHz dengan tegangan suplai 3 V atau sedikit lebih rendah.  Kedua pengendali bekerja dengan kuarsa 16 MHz pada tegangan suplai yang berkurang 2,7 ... 2,8 V, jadi saya tidak mengubah kuarsa 16 MHz menjadi 8 MHz. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/or/kl/rf/orklrfdoalqoh5d3gsqxde-9x_c.jpeg"></div><br><p>  Untuk merakit perangkat, Anda akan memerlukan komponen, daftar yang dan biayanya diperkirakan pada harga situs web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AliExpress</a> ditunjukkan pada tabel. </p><br><table border="1"><tbody><tr><td>  <strong>Komponen</strong> </td><td>  <strong>Harga, $</strong> </td></tr><tr><td colspan="2">  <em>penganalisa</em> </td></tr><tr><td>  ATMEGA328P-PU Controller </td><td>  1,59 </td></tr><tr><td>  Sensor suhu dan kelembaban DHT22 </td><td>  2,34 </td></tr><tr><td>  Pemancar LoRa Ra-01 </td><td>  3,95 </td></tr><tr><td>  LCD NOKIA 5110 </td><td>  1.91 </td></tr><tr><td>  Papan tempat memotong roti (pemasangan), kabel pemasangan, baterai AA, resonator kuarsa 16 MHz, resistor, dll. </td><td>  4,00 </td></tr><tr><td colspan="2">  <em>termometer</em> </td></tr><tr><td>  ATMEGA328P-PU Controller </td><td>  1,59 </td></tr><tr><td>  Sensor suhu DS18B20 </td><td>  0,63 </td></tr><tr><td>  Pemancar LoRa Ra-01 </td><td>  3,95 </td></tr><tr><td>  Papan pengembangan (fiberglass), kabel pemasangan, baterai AA, resonator kuarsa 16 MHz, resistor, dll. </td><td>  4,00 </td></tr><tr><td>  <strong>Total (kurang-lebih):</strong> </td><td>  <strong>24</strong> </td></tr></tbody></table><br><p></p><h4>  Penganalisa </h4><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/of/fu/xd/offuxdrjbzlmia_xnnsfqeliisc.jpeg"></div><br><p>  Otak penganalisa adalah pengontrol ATMEGA328P.  Ini menerima sinyal dari sensor DHT22 dan, melalui protokol SPI, berkomunikasi dengan penerima LoRa dan layar NOKIA 5110. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/b3/wl/9b/b3wl9b2zijmxgg8yso3xxt1faxq.png"></div><br><p></p><p>  Ada banyak keluhan di Internet tentang rendahnya akurasi DHT22.  Hari ini ada alternatif: sensor suhu dan kelembaban yang lebih modern <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">HTU21 (GY21)</a> , (Vcc = 3 ... 5 V), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Si7021</a> , (Vcc = 1.9 ... 3.6 V), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SHT21</a> , (Vcc = 2.1 .... 3,6 V). </p><br><p>  Saya menggunakan DHT22, karena perbedaan antara pembacaan kelembaban spesimen saya dari sensor ini dan thermo-hygrometer LaCrosse WS-9024IT yang tersedia secara komersial tidak lebih dari 8 unit, yang cukup dapat diterima untuk keperluan rumah tangga.  Perbedaan antara pembacaan kelembaban meningkat sangat jika tegangan suplai DHT22 lebih rendah dari 3V.  Ini bisa dimengerti, karena tegangan suplai DHT22 harus dalam 3 ... 5V.  Kesimpulannya - idealnya dalam kondisi ini, sensor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Si7021</a> cocok dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">rangkaian</a> penganalisa. </p><br><p>  Pada gambar di bawah ini - pinout dari elemen stasiun cuaca. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/ut/go/gqutgob1fbq1hd85xtnovdvphfw.png"></div><br><p></p><p>  Fusion dan lebih banyak lagi dari berbagai pengontrol, termasuk ATMEGA328P, dapat dibaca dan diedit dengan utilitas SinaProg.  Jika ini adalah pertama kalinya Anda menemukan program ini, maka meskipun memiliki antarmuka yang intuitif, jangan mencoba untuk mulai bekerja dengannya setelah menginstal aplikasi.  Pertama baca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel ini</a> di mana <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">HWman</a> memberikan add-on SinaProg yang diperlukan saat menggunakan papan Arduino UNO sebagai bootloader. </p><br><p>  Saya menyarankan Anda untuk terlebih dahulu membaca pengaturan pabrik dari ATMEGA328P fusi dan menyimpan nilai-nilai mereka untuk kembali kepada mereka jika terjadi kegagalan.  Pada pengontrol saya, pengaturan pabrik untuk bit sekering adalah: <strong>RENDAH: 0xFF, TINGGI: 0xDE, DIPERPANJANG: 0x05</strong> (Vcc = 2.7V, BODLEVEL = 101).  Sekering baru untuk memantau ambang 1,8V yang ingin Anda atur: <strong>LOW: 0xFF, HIGH: 0xDE, EXTENDED: 0x06</strong> (Vcc = 1.8V, BODLEVEL = 110). </p><br><p>  Sketsa analisa untuk memuat di ATMEGA328P berada di bawah spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">sketsa analisa</b> <div class="spoiler_text">  `` `cpp <br>  / * <br>  Stasiun cuaca otonom pada pengontrol ATMEGA328P dan bertenaga baterai dengan sensor jarak jauh nirkabel, penganalisa <br>  https://habr.com/en/post/470381/ <br>  * / <br><br>  #termasuk &lt;SPI.h&gt; <br>  #termasuk &lt;LoRa.h&gt; <br><br>  #termasuk &lt;DHT.h&gt; <br>  #define DHTPIN 3 // pin digital apa yang terhubung dengan kami <br>  #define DHTTYPE DHT22 // DHT 22 (AM2302), AM2321 <br>  DHT dht (DHTPIN, DHTTYPE); <br><br>  timah apung = 0; <br>  int Hin = 0; <br>  mengapung BatteryInLevel;  // tegangan baterai dasar <br>  String LoRaData, Tout_str, BatteryInLevel_str, BatteryOutLevel_str; <br><br>  // tidur <br>  #termasuk &lt;LowPower.h&gt; <br>  #define PowerDHT (4) // pin daya DHT22 <br>  sleepCounter int unsigned; <br><br>  // Nokia 5110 <br>  #termasuk &lt;SPI.h&gt; <br>  #include &lt;Adafruit_GFX.h&gt; //https://esp8266.ru/forum/threads/esp8266-5110-nokia-lcd.1143/#post-16942 <br>  #include &lt;Adafruit_PCD8544.h&gt; //https://esp8266.ru/forum/threads/esp8266-5110-nokia-lcd.1143/#post-16942 <br><br>  // pengatur waktu <br>  #termasuk &lt;SimpleTimer.h&gt; <br>  Timer SimpleTimer; <br><br>  Adafruit_PCD8544 display = Adafruit_PCD8544 (5, 7, 6); <br><br>  batal sendSensor () { <br>  digitalWrite (PowerDHT, 1); <br>  delay (2000); <br>  Hin = dht.readHumidity (); <br>  Timah = dht.readTemperature (); <br><br>  / * if (isnan (Hin) || isnan (Tin)) { <br>  // Serial.println ("Gagal membaca dari sensor DHT!"); <br>  kembali <br>  } * / <br><br>  digitalWrite (PowerDHT, 0); <br><br>  // pengukuran tegangan baterai: <br>  analogReference (INTERNAL); <br>  int sensorValue = analogRead (A4); <br>  BatteryInLevel = (sensorValue * 3.2 / 1024); <br>  } <br><br>  batal draw () { <br>  display.clearDisplay (); <br>  // Timah <br>  { <br>  display.setTextSize (2); <br>  display.setCursor (8, 0); <br>  display.println (Tin, 1);  // satu tempat desimal <br>  display.setCursor (68, 0); <br>  display.println ("C"); <br>  } <br>  // hin <br>  { <br>  display.setTextSize (2); <br>  display.setCursor (8, 16); <br>  display.println (String (Hin) + "%"); <br>  } <br>  // Tout <br>  { <br>  char chr_Tout [12]; <br><br>  Tout_str.toCharArray (chr_Tout, 5); <br>  display.setTextSize (1); <br>  display.setCursor (50, 16); <br>  display.println (String (chr_Tout) + "C"); <br>  } <br>  // Level Baterai Habis <br>  { <br>  char chr_BatteryOutLevel [12]; <br><br>  BatteryOutLevel_str.toCharArray (chr_BatteryOutLevel, 4); <br>  display.setTextSize (1); <br>  display.setCursor (2, 32); <br>  display.println ("BAT Out:" + String (chr_BatteryOutLevel) + "V"); <br>  } <br>  // Level Baterai <br>  { <br>  display.setTextSize (1); <br>  display.setCursor (2, 40); <br>  display.println ("BAT In:„); <br>  display.setCursor (56, 40); <br>  display.println (BatteryInLevel, 1);  // satu tempat desimal <br>  display.setCursor (74, 40); <br>  display.println ("V"); <br>  } <br><br>  display.display (); <br>  / * <br>  Serial.println ("Tin:" + String (Tin) + "* C"); <br>  Serial.println ("Hin:" + String (Hin) + "%"); <br>  Serial.println ("Tout:" + String (Tout_str) + "* C"); <br>  Serial.println ("BAT_In:" + String (BatteryInLevel) + "V"); <br>  Serial.println ("BAT_Out:" + String (BatteryOutLevel_str) + "V"); <br>  Serial.println ("......"); <br>  * / <br>  } <br><br>  membatalkan sleepDevice () { <br>  // sleepCounter = 65 - 10 mnt <br>  // sleepCounter = 91 - 14 mnt <br>  untuk (sleepCounter = 91; sleepCounter&gt; 0; sleepCounter--) // 91 !!! <br>  { <br>  LoRa.sleep (); <br>  LowPower.powerDown (SLEEP_8S, ADC_OFF, BOD_OFF); <br>  } <br>  LoRa.sleep (); <br>  } <br><br>  membatalkan SignalReception () { <br>  // coba parsing paket <br>  int packetSize = LoRa.parsePacket (); <br>  if (packetSize) { <br>  // baca paket <br>  while (LoRa.available ()) { <br>  LoRaData = LoRa.readString (); <br>  // Serial.println ("Diterima:" + (LoRaData)); <br>  } <br>  int pos1 = LoRaData.indexOf ('#'); <br>  Tout_str = LoRaData.substring (0, pos1); <br>  BatteryOutLevel_str = LoRaData.substring (pos1 +1, LoRaData.length ()); <br>  } <br>  } <br><br>  pengaturan batal () { <br>  //Serial.begin(9600); <br>  pinMode (PowerDHT, OUTPUT); <br><br>  // inisialisasi dan hapus tampilan <br>  display.begin (); <br>  display.clearDisplay (); <br>  display.display (); <br>  display.setContrast (60);  // atur kontrasnya <br><br>  display.clearDisplay (); <br>  display.setTextSize (2); <br>  display.setCursor (12, 16); <br>  display.println ("&gt;&gt;&gt;&gt;&gt;");  // indikasi mulai bekerja ketika dihidupkan <br>  display.display (); <br><br>  dht.begin (); <br>  sendSensor (); <br>  menggambar (); <br><br>  while (! LoRa.begin (433E6)) { <br>  //Serial.println ("."); <br>  keterlambatan (500); <br>  } <br>  // Rentang untuk kata sinkronisasi adalah antara "0 - 0xFF". <br>  LoRa.setSyncWord (0xF3); <br>  //Serial.println (wonLoRa Inisialisasi "); <br>  timer.setInterval (20000, sendSensor); <br>  timer.setInterval (5000, draw); <br>  timer.setInterval (65000, sleepDevice); <br>  } <br><br>  void loop () { <br>  SignalReception (); <br>  timer.run (); <br>  } <br>  `` `` </div></div><br><br><p>  Untuk bekerja dengan pengontrol ATMEGA328P, saya menggunakan papan Arduino UNO sebagai programmer.  Ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">video</a> bagus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di</a> Youtube <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tentang cara menginstal bootloader</a> dan mengunduh sketsa ke pengontrol ATMEGA328 menggunakan papan Arduino UNO. </p><br><p>  Sketsa tersebut mengomentari perintah untuk keluaran ke monitor port serial (Serial).  Batalkan komentar jika perlu. </p><br><p>  Siklus dimulai dengan mendengarkan siaran dan menerima informasi oleh penerima LoRa.  Timer mengatur waktu mendengarkan - 65 detik.  Pada saat ini, dengan periode 5 detik, informasi pada layar NOKIA diperbarui dan, dengan periode 20 detik (3 kali), sensor DHT22 mengukur suhu, kelembaban, dan juga level tegangan baterai melalui salah satu input analog controller.  Tegangan suplai ke DHT22 diterapkan hanya selama pengukuran dengan penundaan minimal 2 detik, di mana sensor masih bekerja.  Output ADC dalam sketsa diskalakan ke tegangan baterai baru, yaitu 3,2V (1,6V x 2).  Waktu mendengarkan udara dipilih sedikit lebih dari 1 menit untuk dengan percaya diri menerima satu paket dari termometer yang bekerja pada transmisi dengan periode 1 menit, tetapi lebih pada yang di bawah.  Kemudian, pada detik ke-62, controller dan receiver dimasukkan ke mode sleep, yang berlangsung sekitar 14 menit, yaitu  periode siklus "bekerja / tidur" dari penganalisa adalah sekitar 15 menit.  Saya perhatikan bahwa mode tidur pada alat analisis adalah tindakan paksa yang dirancang untuk secara signifikan mengurangi konsumsi. </p><br><p>  Sebagai perbandingan, tabel di bawah ini menunjukkan karakteristik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">termohygrometer LaCrosse WS-9024IT</a> dan penganalisa dari proyek ini. </p><br><p></p><table border="1"><tbody><tr><td>  <strong>Parameter</strong> </td><td>  <strong>LaCrosse WS-9024IT</strong> </td><td>  <strong>SadilTM</strong> </td></tr><tr><td>  Nutrisi </td><td>  2xAA, 3B, Durasell </td><td>  2xAA, 3V, GP Ultra +, 1800 mAh </td></tr><tr><td>  Konsumsi tidur </td><td></td><td>  350 μA (10 μA) </td></tr><tr><td>  Durasi tidur </td><td></td><td>  14 mnt </td></tr><tr><td>  Konsumsi operasional </td><td>  &lt;200 μA </td><td>  12-18 mA </td></tr><tr><td>  Durasi kerja </td><td></td><td>  sekitar 1 mnt </td></tr><tr><td>  Periode Siklus Kerja / Tidur </td><td></td><td>  15 mnt </td></tr><tr><td>  Waktu operasi </td><td>  sekitar 2 tahun </td><td>  sekitar 2,5 bulan </td></tr></tbody></table><br><p>  Konsumsi LaCrosse saat ini sangat banyak menari.  Dalam tabel tersebut saya memberikan nilai terukur puncak untuk menunjukkan urutan konsumsi: tidak lebih dari dua ratus mikroamp. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tg/h0/ke/tgh0kev0vv-b_tmlefcjddxmqlg.gif"></div><br><p>  Saya ingin melengkapi tabel dengan hasil perkembangan amatir yang serupa, tetapi saya tidak menemukan apa pun.  Mungkin karena sebagian besar amatir menghasilkan informasi dari sensor ke komputer, tablet, ponsel cerdas atau dalam perjalanan ke salah satu layanan di jaringan di mana masalah menghemat masa pakai baterai sama sekali tidak ada. </p><br><p>  Kontributor utama untuk analyzer sleep (350 μA) adalah LCD.  Jika Anda mematikannya, maka konsumsinya akan turun menjadi 10 μA.  Konsumsi puncak 18 mA terjadi ketika penerima LoRa menerima sinyal dari pemancar, tetapi sinyal membutuhkan beberapa mikrodetik.  Waktu ini sangat singkat dibandingkan dengan menit penerima dalam mode mendengarkan dan konsumsi 10 mA, jadi saya tidak memperhitungkan puncak jangka pendek ini ketika menghitung waktu pengoperasian pada satu set baterai. </p><br><p>  Perhitungan jam kerja. <br>  Konsumsi rata-rata saat ini: 10 mA / 15 + 0,35 mA = 1,0 mA, di mana 15 adalah siklus kerja.  Waktu pengoperasian: 1800 mA * jam / 1,0 mA = 1800 jam (2,5 bulan). <br>  Saya akan mengklarifikasi: <br>  - Perhitungannya sangat perkiraan. <br>  - Jam operasional LaCrosse didasarkan pada pengalaman saya sendiri.  Saya sudah lama menggunakan perangkat ini. <br></p><br><h4>  Termometer </h4><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rp/tb/nx/rptbnxv-nlwql3ap7i1rcjdf_wk.jpeg"></div><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kapasitas dan tegangan baterai dalam cuaca dingin sangat berkurang</a> .  Oleh karena itu, agar tidak mengekspos baterai dan perangkat secara keseluruhan pada pengujian sekuat itu, saya hanya mengeluarkan sensor suhu DS18B20 di luar ruangan, dan unit serta baterai ada di dalam ruangan.  DS18B20 terhubung ke papan host dengan kabel tiga kawat tipis.  Saya melihat solusi ini di stasiun cuaca serial saya - pengembang yakin bahwa akan selalu ada celah di apartemen untuk meletakkan kabel dengan diameter beberapa milimeter. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ic/vq/me/icvqmeepxsfgd9ut_hhcais3xle.jpeg"></div><br><p>  Sekering untuk termometer ATMEGA328P sama dengan untuk alat analisa. </p><br><p>  Perakitan termometer juga dibangun di atas pengontrol ATMEGA328P.  Ini menerima sinyal dari sensor DS18B20, mengukur tegangan suplai dan mengontrol pemancar LoRa. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/0d/ie/ww/0diewwzov4r4gwbrojlrvbyzbrq.png"></div><br><p></p><p>  Sketsa termometer berada di bawah spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">sketsa termometer</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*     ATMEGA328P        ,  https://habr.com/ru/post/470381/ */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;OneWire.h&gt; OneWire ds(7); //pin 13, Atmega328P #include &lt;SPI.h&gt; #include &lt;LoRa.h&gt; #include &lt;LowPower.h&gt; #define PowerDS18B20 (6) //pin 12 (Atmega328P), e DS18B20 unsigned int sleepCounter; // ,    float Tout; // int i; //         (20   1 ) String messageTout; // LoRa- float batteryLevel; //   const int batteryPin = A0; // pin 23 (Atmega328P),        void Measurement () { //  byte data[2]; digitalWrite(PowerDS18B20, 1); ds.reset(); ds.write(0xCC); //     (1 ) ds.write(0x44); //    delay(700); ds.reset(); ds.write(0xCC); ds.write(0xBE); //      data[0] = ds.read(); data[1] = ds.read(); Tout = ((data[1] &lt;&lt; 8) | data[0]) * 0.0625; // Serial.println("Tout= "+ String(Tout)); digitalWrite(PowerDS18B20, 0); //   : analogReference(INTERNAL); int sensorValue = analogRead(A0); batteryLevel = (sensorValue * 3.2 / 1024); // Serial.println("BAT= "+ String(batteryLevel)); } void SetSynchLoRa () { int counter = 0; while (!LoRa.begin(433E6) &amp;&amp; counter &lt; 10) { // Serial.print("."); counter++; delay(500); } LoRa.setTxPower(4); //  2-20  /* if (counter == 10) { // Serial.println("Failed to initialize ..."); }*/ LoRa.setSyncWord(0xF3); } void SendMessage () { //   (,  ) messageTout = String(Tout) + "#" + String(batteryLevel); // Serial.println(messageTout); delay(250); LoRa.beginPacket(); LoRa.print(messageTout); LoRa.endPacket(); } void setup() { //Serial.begin(9600); // Serial.println("Initializing ..."); pinMode(PowerDS18B20, OUTPUT); SetSynchLoRa (); } void loop() { //Serial.println(""); //Serial.println("i = " + String(i)); if (i &gt;= 30) { // i &gt;= 30 (1 ) —   (,  — 1 /1 ) for (sleepCounter = 5; sleepCounter &gt; 0; sleepCounter--) { LoRa.sleep (); LowPower.powerDown(SLEEP_8S, ADC_OFF, BOD_OFF); } Measurement (); SendMessage (); LoRa.sleep (); } else { //   1 ,  — 1 /2  Measurement (); SendMessage (); delay (1000); } i++; if (i &gt;= 30) i = 30; //    }</span></span></span></span></code> </pre> </div></div><br><p>  Sepasang pemancar-penerima LoRa menyediakan komunikasi yang stabil pada jarak 1,5 km dengan visibilitas langsung dan hingga 300 m di daerah perkotaan, tentu saja, maksimum atau mendekati daya pemancar maksimum: 17-20 dB.  Untuk koneksi yang stabil di dalam apartemen, 4 dB sudah cukup. </p><br><p>  Pada awalnya, ketika daya terhubung, termometer beroperasi dalam mode intensif selama satu menit.  Ini mengukur suhu, tegangan baterai dan mengirimkan nilainya di udara setiap 2 detik.  Ini untuk kenyamanan.  Misalkan Anda tidak perlu menunggu sebentar saat mengganti baterai atau debugging.  Informasi dari sensor akan muncul pada layar penganalisa pada detik pertama setelah menghubungkan baterai termometer dan penganalisis.  Secara alami, Anda harus bergegas dan tidak membuat jarak waktu selama lebih dari satu menit antara menghubungkan baterai pada kedua node. </p><br><p>  Kemudian sensor jarak jauh masuk ke mode normal.  Setelah mengukur dan mengirim informasi yang berlangsung sedikit lebih dari detik pertama, pengontrol dan pemancar dimasukkan ke mode tidur perangkat lunak selama sekitar 1 menit. </p><br><p>  Perhitungan jam kerja. <br>  Konsumsi rata-rata saat ini: 14 mA / 60 + 0,005 mA = 0,24 mA, di mana 60 adalah siklus kerja.  Waktu pengoperasian: 1800 mA * jam / 0,24 mA = 7500 jam (10 bulan). <br>  Klarifikasi sebelumnya mengenai akurasi waktu operasi yang dihitung dari satu set baterai tetap valid. <br></p><br><p>  Dan tabel perbandingan.  Ini berisi hasil dari beberapa proyek serupa dari Internet. </p><br><table border="1"><tbody><tr><td>  <strong>Parameter</strong> </td><td>  <strong>LaCrosse WS-9024IT</strong> </td><td>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">maniak</a></strong> </td><td>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">avs24rus</a></strong> </td><td>  <strong>SadilTM</strong> </td></tr><tr><td>  Nutrisi </td><td>  2xAAA, 3B, Durasell </td><td>  3V, CR2450 Renata, 540 mAh </td><td>  3V, CR2450, 550-610 mAh </td><td>  2xAA, 3V, GP Ultra +, 1800 mAh </td></tr><tr><td>  Konsumsi tidur </td><td></td><td>  0,14 mA (?) </td><td>  14 μA </td><td>  5 μA </td></tr><tr><td>  Durasi tidur </td><td></td><td></td><td></td><td>  1 mnt </td></tr><tr><td>  Konsumsi operasional </td><td>  &lt;700 μA </td><td>  13,57 mA </td><td>  16 - 18 mA </td><td>  14 mA </td></tr><tr><td>  Durasi kerja </td><td></td><td>  0,027 dtk </td><td></td><td>  1 detik </td></tr><tr><td>  Periode Siklus Kerja / Tidur </td><td></td><td>  1 mnt </td><td>  10 mnt </td><td>  1 mnt </td></tr><tr><td>  Waktu operasi </td><td>  sekitar 2 tahun </td><td></td><td>  lebih dari 0,5 tahun </td><td>  sekitar 10 bulan </td></tr></tbody></table><br><p>  Jika node dirakit tanpa kesalahan, maka pada layar kita akan melihat gambar berikut: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/vm/ry/-9/vmry-9owzy-rtsulc5mz5ghzh2g.png"></div><br><p>  Dari tabel perbandingan dapat dilihat bahwa konsumsi puncak perangkat amatir adalah urutan besarnya lebih tinggi daripada dalam fungsi analog dari industri LaCrosse.  Misalnya, 14 mA berbanding 700 μA untuk sensor jarak jauh dan 10 ... 18 mA berbanding 200 μA untuk alat analisis.  Perbedaan mencolok dalam konsumsi maksimum dijelaskan, menurut pendapat saya, oleh fakta bahwa pengendali di sirkuit amatir diprogram menggunakan platform Arduino IDE, fungsi berat dan perpustakaan, dan dalam produk industri - kemungkinan besar dalam salah satu bahasa tingkat rendah atau, misalnya, di C ++ (omong-omong, bahasa dasar Arduino) atau C (C).  Jika Anda menggunakan bahasa ini, maka saya yakin Anda dapat mencapai konsumsi yang sebanding dengan desain industri.  Namun, ini secara eksperimental sangat meyakinkan ditunjukkan oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">HWman</a> dalam publikasi “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mengapa Banyak Orang Tidak Suka Arduino</a> ”.  Melakukan sketsa paling sederhana hingga selusin baris (Blink), dilakukan di Arduino IDE dalam satu kasus dan dalam kasus lain - “simple C”, seperti yang dikatakan penulis dalam video, menyebabkan hilangnya kinerja 26 kali.  Singkatnya, peningkatan konsumsi sumber daya adalah biaya untuk kenyamanan dan usaha kecil dari pihak programmer - sisanya akan dilakukan oleh fungsi "rakus" dari lingkungan pengembangan untuknya di Arduino.  Saya mengantisipasi bahwa Anda harus berusaha keras dan menguasai setidaknya dasar-dasar C / C ++, yang fungsinya dikompilasi oleh Arduino IDE. </p><br><h4>  Kesimpulan </h4><br><p>  • Penganalisis dan termometer rakitan memiliki konsumsi arus terlalu banyak dibandingkan dengan desain industri. </p><br><p>  • Yang ketiga menyarankan dirinya untuk dua baterai di sirkuit, maka masalah berikut ini secara otomatis diselesaikan: tidak perlu menginstal ulang sekering, controller beroperasi pada frekuensi 16 MHz, sensor DHT22, DS18B20 jauh dari ambang batas bawah tegangan suplai mereka.  Yang terakhir ini penting, karena tegangan suplai tidak langsung disuplai ke sensor, tetapi secara terprogram melalui kunci dari pin pengontrol, yang turun sekitar 1V. </p><br><p>  • Penggunaan modul radio LoRa, dengan daya pemancar yang dapat diprogram sebesar 4 dB, memungkinkan untuk membuat koneksi yang stabil di dalam apartemen dengan catu daya modul dari dua baterai AA. </p><br><h4>  Tautan Terkait </h4><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Unit Sensor Nirkabel Nirkabel Energi Rendah</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sensor Penerangan Nirkabel CR2450</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Suhu nirkabel, kelembaban dan sensor tekanan atmosfer pada nRF52832</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Termometer Nirkabel</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ubah Arduino menjadi pemrogram AVRISP yang lengkap</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lora dan tidur</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pelajari tentang bit konfigurasi ATmega328P dan cara menggunakannya dengan kristal kuarsa eksternal</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kalkulator Fusion AVR</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mengapa banyak orang tidak suka Arduino</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Uji baterai hebat</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Baterai dalam dingin</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id470381/">https://habr.com/ru/post/id470381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id470361/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 383 (1 - 6 Oktober 2019)</a></li>
<li><a href="../id470363/index.html">Siapa yang akan Anda panggil: buat panggilan di perancang bot dan belajar untuk tidak membuat marah orang</a></li>
<li><a href="../id470365/index.html">Bekerja dengan USB Custom HID di Android</a></li>
<li><a href="../id470367/index.html">Intisari Desain Makanan, September 2019</a></li>
<li><a href="../id470373/index.html">PHP Digest No. 165 (23 September - 7 Oktober 2019)</a></li>
<li><a href="../id470385/index.html">Rasio Emas dalam Ekonomi - 2</a></li>
<li><a href="../id470387/index.html">Maaf pengguna macOS, tapi Apple sudah keterlaluan</a></li>
<li><a href="../id470389/index.html">Mozilla telah berjanji untuk tidak memasukkan enkripsi DoH di Inggris. Apa artinya ini bagi Rusia?</a></li>
<li><a href="../id470393/index.html">Kacamata kepintaran - tayangan dari Pegasi Dream Glasses</a></li>
<li><a href="../id470395/index.html">OWASP API Security Top 10 RC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>