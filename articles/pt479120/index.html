<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõ ü§° üë£ A participa√ß√£o falhou: levamos o AgentTesla √† √°gua limpa. Parte 2 üßùüèø üßìüèΩ üï°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuamos uma s√©rie de artigos sobre an√°lise de malware. Na primeira parte, falamos sobre como Ilya Pomerantsev, especialista em an√°lise de c√≥digo m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>A participa√ß√£o falhou: levamos o AgentTesla √† √°gua limpa. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/479120/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/vz/an/r5/vzanr5kxitvhd3zqrcdh1qhctjm.png"></div><br>  Continuamos uma s√©rie de artigos sobre an√°lise de malware.  Na <a href="https://habr.com/ru/company/group-ib/blog/478176/">primeira</a> parte, falamos sobre como Ilya Pomerantsev, especialista em an√°lise de c√≥digo mal-intencionado do CERT Group-IB, fez uma an√°lise detalhada de um arquivo recebido por correio de uma empresa europ√©ia e encontrou o <b>spyware AgentTesla l√°</b> .  Neste artigo, Ilya apresenta os resultados de uma an√°lise em fases do m√≥dulo principal <b>AgentTesla</b> . <br><a name="habracut"></a><br><blockquote> O Agent Tesla √© um software de espionagem modular distribu√≠do como malware como servi√ßo sob o disfarce de um produto legal de keylogger.  O Agent Tesla pode extrair e transmitir credenciais do usu√°rio de navegadores, clientes de email e FTP para o servidor para atacantes, registrar dados da √°rea de transfer√™ncia e capturar a tela do dispositivo.  No momento da an√°lise, o site oficial dos desenvolvedores n√£o estava dispon√≠vel. <br></blockquote><br><h2>  Arquivo de configura√ß√£o </h2><br>  A tabela abaixo lista quais recursos s√£o usados ‚Äã‚Äãna amostra usada: <br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Descri√ß√£o do produto</strong> <br></td><td>  <strong>Valor</strong> <br></td></tr><tr><td>  Sinalizador de uso do KeyLogger <br></td><td>  verdade <br></td></tr><tr><td>  Sinalizador para usar o ScreenLogger <br></td><td>  falsa <br></td></tr><tr><td>  Intervalo de envio de logs do KeyLogger em minutos <br></td><td>  20 <br></td></tr><tr><td>  Intervalo de envio de log do ScreenLogger em minutos <br></td><td>  20 <br></td></tr><tr><td>  Sinalizador para processar a chave Backspace.  Falso - somente log.  Verdadeiro - apague a chave anterior <br></td><td>  falsa <br></td></tr><tr><td>  Digite CnC.  Op√ß√µes: smtp, webpanel, ftp <br></td><td>  smtp <br></td></tr><tr><td>  Sinalizador de ativa√ß√£o do encadeamento para finalizar processos da lista "% filter_list%" <br></td><td>  falsa <br></td></tr><tr><td>  Sinalizador de desativa√ß√£o do UAC <br></td><td>  falsa <br></td></tr><tr><td>  Desativar sinalizador do gerenciador de tarefas <br></td><td>  falsa <br></td></tr><tr><td>  Sinalizador de desativa√ß√£o do CMD <br></td><td>  falsa <br></td></tr><tr><td>  Sinalizador de desativa√ß√£o da janela Executar <br></td><td>  falsa <br></td></tr><tr><td>  Desativar sinalizador do visualizador do registro <br></td><td>  falsa <br></td></tr><tr><td>  Desativar pontos de restaura√ß√£o do sistema <br></td><td>  verdade <br></td></tr><tr><td>  Sinalizador de desativa√ß√£o do painel de controle <br></td><td>  falsa <br></td></tr><tr><td>  Sinalizador de desativa√ß√£o do MSCONFIG <br></td><td>  falsa <br></td></tr><tr><td>  Sinalizador de desativa√ß√£o do menu de contexto do Explorer <br></td><td>  falsa <br></td></tr><tr><td>  Sinalizador de pino do sistema <br></td><td>  falsa <br></td></tr><tr><td>  Caminho para copiar o m√≥dulo principal ao encaixar no sistema <br></td><td>  % startupfolder% \\% insfolder% \\% insname% <br></td></tr><tr><td>  Sinalizador para definir os atributos "Sistema" e "Secreto" para o m√≥dulo principal fixo no sistema <br></td><td>  falsa <br></td></tr><tr><td>  Reinicie o sinalizador de execu√ß√£o ao fixar no sistema <br></td><td>  falsa <br></td></tr><tr><td>  Sinalizador para mover o m√≥dulo principal para uma pasta tempor√°ria <br></td><td>  falsa <br></td></tr><tr><td>  Sinalizador de execu√ß√£o de desvio do UAC <br></td><td>  falsa <br></td></tr><tr><td>  Formato de data e hora para registro <br></td><td>  aaaa-MM-dd HH: mm: ss <br></td></tr><tr><td>  Sinalizador para usar o filtro de programa do KeyLogger <br></td><td>  verdade <br></td></tr><tr><td>  Tipo de filtragem de programa. <br>  1 - o nome do programa √© pesquisado nos cabe√ßalhos da janela <br>  2 - o nome do programa √© pesquisado no nome do processo da janela <br></td><td>  1 <br></td></tr><tr><td>  Filtro de programa <br></td><td>  Facebook <br>  Twitter <br>  Gmail <br>  Instagram <br>  "Filme", <br>  Skype <br>  "Porn√¥", <br>  Hack <br>  Whatsapp <br>  Discord <br></td></tr></tbody></table></div><br><h2>  Corrigindo o m√≥dulo principal no sistema </h2><br>  Se o sinalizador correspondente for definido, o m√≥dulo principal ser√° copiado ao longo do caminho especificado na configura√ß√£o como o caminho para fixa√ß√£o no sistema. <br><br>  Dependendo do valor da configura√ß√£o, o arquivo recebe os atributos "Oculto" e "Sistema". <br>  A inicializa√ß√£o autom√°tica √© fornecida por dois ramos do registro: <br><br><ul><li>  <b>HKCU \ Software \ Microsoft \ Windows \ CurrentVersion \ Run \% insregname%</b> </li><li>  <b>HKCU \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Explorer \ StartupApproved \ Run \% insregname%</b> </li></ul><br>  Como o carregador de inicializa√ß√£o √© injetado no processo <b>RegAsm</b> , a configura√ß√£o do sinalizador persistente para o m√≥dulo principal leva a consequ√™ncias bastante interessantes.  Em vez de se copiar, o malware protegeu o arquivo <b>RegAsm.exe</b> original no sistema, durante o qual a inje√ß√£o foi realizada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/a8/mx/in/a8mxinpopuoixolt4r7tiwulc70.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9p/-f/ui/9p-fui42mv7y06i5ivacsyh2zqm.png"></div><br><h2>  Intera√ß√£o com C&amp;C </h2><br>  Independentemente do m√©todo utilizado, a intera√ß√£o na rede come√ßa com a obten√ß√£o do IP externo da v√≠tima usando a <b><a href="http://checkip/">marca de sele√ß√£o</a> [.] Amazonaws [.] Com /</b> resource. <br>  A seguir, s√£o descritos os m√©todos de rede apresentados no malware. <br><br><h3>  webpanel </h3><br>  A intera√ß√£o √© via protocolo HTTP.  O malware executa uma solicita√ß√£o POST com os seguintes cabe√ßalhos: <br><br><ul><li>  <b>Agente do usu√°rio: Mozilla / 5.0 (Windows U Windows NT 6.1, vers√£o 1.9.2.3) Gecko / 20100401 Firefox / 4.0 (.NET CLR 3.5.30729)</b> </li><li>  <b>Conex√£o: Keep-Alive</b> </li><li>  <b>Tipo de conte√∫do: application / x-www-form-urlencoded</b> </li></ul><br>  O endere√ßo do servidor est√° definido como <b>% PostURL%</b> .  A mensagem criptografada √© passada no par√¢metro <b>"p"</b> .  O mecanismo de criptografia √© descrito na se√ß√£o <b>"Algoritmos de criptografia" (m√©todo 2)</b> . <br><br>  A mensagem transmitida √© a seguinte: <br><br>  <b>type = {0} \ nhwid = {1} \ ntime = {2} \ npcname = {3} \ nlogdata = {4} \ nscreen = {5} \ nipadd = {6} \ nwebcam_link = {7} \ ncliente = {8} \ nlink = {9} \ nusername = {10} \ npassword = {11} \ nscreen_link = {12}</b> <br><br>  O par√¢metro <b>type</b> indica o tipo de mensagem: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lc/5l/yr/lc5lyrzbeie0jr9z-6dpzpylaze.jpeg"></div><br>  <b>hwid</b> - um hash MD5 √© gravado a partir dos valores do n√∫mero de s√©rie da placa-m√£e e do ID do processador.  Provavelmente usado como um ID do usu√°rio. <br>  <b>hora</b> - serve para transmitir a hora e a data atuais. <br>  <b>pcname</b> - definido como <b>&lt;Username&gt; / &lt;Computer Name&gt;</b> . <br>  <b>logdata</b> - dados do log. <br><br>  Ao transmitir senhas, a mensagem se parece com: <br><br>  <b>type = {0} \ nhwid = {1} \ ntime = {2} \ npcname = {3} \ nlogdata = {4} \ nscreen = {5} \ nipadd = {6} \ nwebcam_link = {7} \ nscreen_link = {8} \ n [senhas]</b> <br><br>  A seguir, s√£o apresentadas descri√ß√µes dos dados roubados no formato <b>\ nclient [] = {0} \ nlink [] = {1} \ nusername [] = {2} \ npassword [] = {3}</b> . <br><br><h3>  smtp </h3><br>  A intera√ß√£o √© via protocolo SMTP.  A mensagem transmitida est√° no formato HTML.  O par√¢metro <b>BODY</b> √©: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gh/vg/np/ghvgnpycvdbcsyyakmwjvfppnw4.png"></div><br>  O t√≠tulo da carta tem a forma geral: <b>&lt;NOME DO USU√ÅRIO&gt; / &lt;NOME DO COMPUTADOR&gt; &lt;TIPO DE CONTE√öDO&gt;</b> .  O conte√∫do da carta, bem como seus anexos, n√£o s√£o criptografados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x5/7c/5o/x57c5ojnqhgfpnec0jnsqix931c.jpeg"></div><br>  A intera√ß√£o √© via protocolo ftp.  Um arquivo com o nome <b>&lt;TIPO DE CONTE√öDO&gt; _ &lt;NOME DO USU√ÅRIO&gt; - &lt;NOME DO COMPUTADOR&gt; _ &lt;DATA E HORA&gt; .html</b> √© transferido para o servidor especificado.  O conte√∫do do arquivo n√£o √© criptografado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/r-/2n/wr/r-2nwryzwnv7voneopya8y5aazq.jpeg"></div><br><h2>  Algoritmos de criptografia </h2><br>  Os seguintes m√©todos de criptografia s√£o usados ‚Äã‚Äãneste caso: <br><br><h3>  M√©todo 1 </h3><br>  Este m√©todo √© usado para criptografar seq√º√™ncias de caracteres no m√≥dulo principal.  Para criptografia, o algoritmo <b>AES</b> √© <b>usado</b> . <br><br>  A entrada √© um n√∫mero decimal de seis d√≠gitos.  A transforma√ß√£o a seguir √© executada nele: <br><br>  <b>Qual √© o valor de f (x) = (- (x ^ 2 - 31059) ^ 6380) - 1363)</b> <br><br>  O valor resultante √© o √≠ndice para a matriz de dados incorporada. <br><br>  Cada elemento da matriz √© uma sequ√™ncia <b>DWORD</b> .  Ao combinar <b>DWORD,</b> √© obtida uma matriz de bytes: os primeiros 32 bytes s√£o a chave de criptografia, seguidos por 16 bytes do vetor de inicializa√ß√£o e os bytes restantes s√£o os dados criptografados. <br><br><h3>  M√©todo 2 </h3><br>  O algoritmo <b>3DES</b> √© usado no <b>modo ECB</b> com preenchimento em bytes inteiros ( <b>PKCS7</b> ). <br><br>  A chave √© especificada pelo par√¢metro <b>% urlkey%</b> , mas seu hash MD5 √© usado para criptografia. <br><br><h2>  Funcionalidade maliciosa </h2><br>  A amostra em estudo usa os seguintes programas para implementar sua fun√ß√£o maliciosa: <br><br><h3>  Keylogger </h3><br>  Se houver um sinalizador VPO correspondente usando a fun√ß√£o WinAPI, <b>SetWindowsHookEx</b> atribuir√° seu pr√≥prio manipulador para eventos de pressionamento de tecla do teclado.  A fun√ß√£o do manipulador come√ßa obtendo o t√≠tulo da janela ativa. <br><br>  Se o sinalizador para executar a filtragem de aplicativos estiver definido, a filtragem ser√° executada dependendo do tipo especificado: <br><br><ol><li>  o nome do programa √© pesquisado nos cabe√ßalhos da janela </li><li>  o nome do programa √© pesquisado no nome do processo da janela </li></ol><br>  Em seguida, um registro √© adicionado ao log com informa√ß√µes sobre a janela ativa no formato: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bx/r0/cj/bxr0cj1srz9us2a4il4rwjfpoqo.png"></div><br>  Em seguida, as informa√ß√µes sobre a tecla pressionada s√£o registradas: <br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Key</strong> <br></td><td>  <strong>Record</strong> <br></td></tr><tr><td>  Backspace <br></td><td>  Dependendo do sinalizador de processamento da tecla Backspace: False - <font color="#008000">{BACK}</font> <br>  Verdadeiro - apague a chave anterior <br></td></tr><tr><td>  CAPSLOCK <br></td><td>  <font color="#008000">{CAPSLOCK}</font> <br></td></tr><tr><td>  Esc <br></td><td>  <font color="#008000">{ESC}</font> <br></td></tr><tr><td>  PageUp <br></td><td>  <font color="#008000">{PageUp}</font> <br></td></tr><tr><td>  Para baixo <br></td><td>  <font color="#008000">? darr;</font> <br></td></tr><tr><td>  DELETE <br></td><td>  <font color="#008000">{DEL}</font> <br></td></tr><tr><td>  " <br></td><td>  ? <br></td></tr><tr><td>  F5 <br></td><td>  <font color="#008000">{F5}</font> <br></td></tr><tr><td>  &amp; <br></td><td>  &amp; amp; <br></td></tr><tr><td>  F10 <br></td><td>  <font color="#008000">{F10}</font> <br></td></tr><tr><td>  Separador <br></td><td>  <font color="#008000">{TAB}</font> <br></td></tr><tr><td>  &lt; <br></td><td>  &amp; lt; <br></td></tr><tr><td>  &gt; <br></td><td>  &amp; gt; <br></td></tr><tr><td>  Barra de espa√ßo <br></td><td></td></tr><tr><td>  F8 <br></td><td>  <font color="#008000">{F8}</font> <br></td></tr><tr><td>  F12 <br></td><td>  <font color="#008000">{F12}</font> <br></td></tr><tr><td>  F9 <br></td><td>  <font color="#008000">{F9}</font> <br></td></tr><tr><td>  ALT + TAB <br></td><td>  <font color="#008000">{ALT + TAB}</font> <br></td></tr><tr><td>  Fim <br></td><td>  <font color="#008000">{END}</font> <br></td></tr><tr><td>  F4 <br></td><td>  <font color="#008000">{F4}</font> <br></td></tr><tr><td>  F2 <br></td><td>  <font color="#008000">{F2}</font> <br></td></tr><tr><td>  CTRL <br></td><td>  <font color="#008000">{CTRL}</font> <br></td></tr><tr><td>  F6 <br></td><td>  <font color="#008000">{F6}</font> <br></td></tr><tr><td>  Direito <br></td><td>  <font color="#008000">? rarr;</font> <br></td></tr><tr><td>  Para cima <br></td><td>  <font color="#008000">&amp; uarr;</font> <br></td></tr><tr><td>  F1 <br></td><td>  <font color="#008000">{F1}</font> <br></td></tr><tr><td>  Esquerda <br></td><td>  <font color="#008000">&amp; larr;</font> <br></td></tr><tr><td>  Pagedown <br></td><td>  <font color="#008000">{PageDown}</font> <br></td></tr><tr><td>  Inserir <br></td><td>  <font color="#008000">{Inserir}</font> <br></td></tr><tr><td>  Win <br></td><td>  <font color="#008000">{Win}</font> <br></td></tr><tr><td>  Numlock <br></td><td>  <font color="#008000">{NumLock}</font> <br></td></tr><tr><td>  F11 <br></td><td>  <font color="#008000">{F11}</font> <br></td></tr><tr><td>  F3 <br></td><td>  <font color="#008000">{F3}</font> <br></td></tr><tr><td>  P√°gina inicial <br></td><td>  <font color="#008000">{HOME}</font> <br></td></tr><tr><td>  ENTER <br></td><td>  <font color="#008000">{ENTER}</font> <br></td></tr><tr><td>  ALT + F4 <br></td><td>  <font color="#008000">{ALT + F4}</font> <br></td></tr><tr><td>  F7 <br></td><td>  <font color="#008000">{F7}</font> <br></td></tr><tr><td>  Outra chave <br></td><td>  Caractere mai√∫sculo ou min√∫sculo, dependendo da posi√ß√£o das teclas CapsLock e Shift <br></td></tr></tbody></table></div><br>  Com uma determinada frequ√™ncia, o log coletado √© enviado ao servidor.  Se a transfer√™ncia <b>falhar</b> , o log ser√° salvo no arquivo <b>% TEMP% \\ log.tmp</b> no formato: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xn/pz/eb/xnpzeba3_y7ulwz0wesksvlspkg.png"></div><br>  Quando o cron√¥metro dispara, o arquivo ser√° transferido para o servidor. <br><br><h3>  Screenlogger </h3><br>  Com a frequ√™ncia especificada, o malware cria uma captura de tela no formato <b>JPEG</b> com um valor de <b>Qualidade</b> de 50 e a salva no arquivo <b>% APPDATA% \\ &lt;sequ√™ncia aleat√≥ria de 10 caracteres&gt; .jpg</b> .  Ap√≥s a transfer√™ncia, o arquivo √© exclu√≠do. <br><br><h3>  Clipboardlogger </h3><br>  Se o sinalizador correspondente estiver definido, as substitui√ß√µes ser√£o feitas no texto interceptado, de acordo com a tabela abaixo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xh/wc/y7/xhwcy7r4g5duormggz-texkxemi.jpeg"></div><br>  Depois disso, o texto √© inserido no log: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ft/6l/2p/ft6l2pmpzecwtkh0hhgbblet30q.png"></div><br><h3>  PasswordStealer </h3><br>  O malware pode baixar senhas dos seguintes aplicativos: <br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Navegadores</strong> <br></td><td>  <strong>Clientes de e-mail</strong> <br></td><td>  <strong>Clientes FTP</strong> <br></td></tr><tr><td>  Chrome <br></td><td>  Outlook <br></td><td>  Filezilla <br></td></tr><tr><td>  Firefox <br></td><td>  Thunderbird <br></td><td>  WS_FTP <br></td></tr><tr><td>  IE / Edge <br></td><td>  Foxmail <br></td><td>  Winscp <br></td></tr><tr><td>  Safari <br></td><td>  Opera Mail <br></td><td>  Coreftp <br></td></tr><tr><td>  Navegador Opera <br></td><td>  IncrediMail <br></td><td>  Navegador FTP <br></td></tr><tr><td>  Yandex <br></td><td>  Pocomail <br></td><td>  Flashfxp <br></td></tr><tr><td>  Comodo <br></td><td>  Eudora <br></td><td>  Smartftp <br></td></tr><tr><td>  Chromeplus <br></td><td>  Thebat <br></td><td>  FTPCommander <br></td></tr><tr><td>  Cr√≥mio <br></td><td>  Caixa postal <br></td><td></td></tr><tr><td>  Tocha <br></td><td>  Clawsmail <br></td><td></td></tr><tr><td>  7Star <br></td><td></td><td></td></tr><tr><td>  Amigo <br></td><td></td><td></td></tr><tr><td>  Bravesoftware <br></td><td>  <strong>Clientes Jabber</strong> <br></td><td>  <strong>Clientes VPN</strong> <br></td></tr><tr><td>  Centbrowser <br></td><td>  Psi / psi + <br></td><td>  VPN aberta <br></td></tr><tr><td>  Chedot <br></td><td></td><td></td></tr><tr><td>  Coccoc <br></td><td></td><td></td></tr><tr><td>  Navegador de elementos <br></td><td>  <strong>Gerenciadores de download</strong> <br></td><td></td></tr><tr><td>  Navegador √©pico de privacidade <br></td><td>  Gerenciador de download da Internet <br></td><td></td></tr><tr><td>  Kometa <br></td><td>  Jdownloader <br></td><td></td></tr><tr><td>  Orbitum <br></td><td></td><td></td></tr><tr><td>  Sputnik <br></td><td></td><td></td></tr><tr><td>  uCozMedia <br></td><td></td><td></td></tr><tr><td>  Vivaldi <br></td><td></td><td></td></tr><tr><td>  Seamonkey <br></td><td></td><td></td></tr><tr><td>  Navegador flock <br></td><td></td><td></td></tr><tr><td>  Navegador uc <br></td><td></td><td></td></tr><tr><td>  Blackhawk <br></td><td></td><td></td></tr><tr><td>  Cyberfox <br></td><td></td><td></td></tr><tr><td>  K-meleon <br></td><td></td><td></td></tr><tr><td>  Icecat <br></td><td></td><td></td></tr><tr><td>  Icedragon <br></td><td></td><td></td></tr><tr><td>  Palemoon <br></td><td></td><td></td></tr><tr><td>  Waterfox <br></td><td></td><td></td></tr><tr><td>  Navegador Falkon <br></td><td></td><td></td></tr></tbody></table></div><br><br><h2>  Anula√ß√£o da an√°lise din√¢mica <br></h2><br><ul><li>  Usando a fun√ß√£o <b>Sleep</b> .  Permite ignorar algumas caixas de prote√ß√£o por tempo limite </li><li>  Destruindo o fluxo <b>Zone.Identifier</b> .  Permite ocultar o fato de baixar um arquivo da Internet </li><li>  O par√¢metro <b>% filter_list%</b> define a lista de processos que o malware concluir√° com um intervalo de um segundo </li><li>  Desabilitando o <b>UAC</b> </li><li>  Desativando o Gerenciador de tarefas </li><li>  Desativando o <b>CMD</b> </li><li>  Desativando a janela <b>Executar</b> </li><li>  Desativando o painel de controle </li><li>  Desabilitando a <b>ferramenta RegEdit</b> </li><li>  Desativando pontos de restaura√ß√£o do sistema </li><li>  Desativando o menu de contexto no Explorer </li><li>  Desabilitando o <b>msconfig</b> </li><li>  Bypass do <b>UAC</b> : <br></li></ul><br><h2>  Recursos inativos do m√≥dulo principal </h2><br>  Durante a an√°lise do m√≥dulo principal, foram identificadas as fun√ß√µes respons√°veis ‚Äã‚Äãpor se espalhar pela rede e rastrear a posi√ß√£o do mouse. <br><br><h3>  Verme </h3><br>  Em um fluxo separado, os eventos de conex√£o de m√≠dia remov√≠vel s√£o monitorados.  Quando conectado √† raiz do sistema de arquivos, o <b>malware √©</b> copiado com o nome <b>scr.exe</b> , ap√≥s o qual procura por arquivos com a extens√£o <b>lnk</b> .  Cada <b>comando lnk</b> muda para <b>cmd.exe / c start scr.exe e inicia &lt;comando original&gt; e sai</b> . <br><br>  Cada diret√≥rio na raiz da m√≠dia recebe o atributo <b>Oculto</b> e um arquivo com a extens√£o <b>lnk</b> √© <b>criado</b> com o nome do diret√≥rio oculto e o comando <b>cmd.exe / c start scr.exe &amp; explorer / root, \ "% CD% &lt;NOME DO DIRET√ìRIO&gt; \" e sair</b> . <br><br><h3>  Mousetracker </h3><br>  O m√©todo de intercepta√ß√£o √© semelhante ao usado para o teclado.  Essa funcionalidade ainda est√° em desenvolvimento. <br><br><h2>  Atividade de arquivo </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>O caminho</strong> <br></td><td>  <strong>Descri√ß√£o do produto</strong> <br></td></tr><tr><td>  % Temp% \ temp.tmp <br></td><td>  Cont√©m contador de tentativas de ignorar o UAC <br></td></tr><tr><td>  % startupfolder% \% insfolder% \% insname% <br></td><td>  Maneira de consolidar no sistema HPE <br></td></tr><tr><td>  % Temp% \ tmpG \ {Hora atual em milissegundos} .tmp <br></td><td>  O caminho para o backup do m√≥dulo principal <br></td></tr><tr><td>  % Temp% \ log.tmp <br></td><td>  Arquivo de log <br></td></tr><tr><td>  % AppData% \ {Sequ√™ncia arbitr√°ria de 10 caracteres} .jpeg <br></td><td>  Screenshots <br></td></tr><tr><td>  C: \ Users \ Public \ {Sequ√™ncia arbitr√°ria de 10 caracteres} .vbs <br></td><td>  O caminho para o arquivo vbs que o gerenciador de inicializa√ß√£o pode usar para fechar o sistema <br></td></tr><tr><td>  % Temp% \ {Nome da pasta arbitr√°ria} \ {Nome do arquivo} <br></td><td>  O caminho usado pelo carregador de inicializa√ß√£o para encaixar no sistema <br></td></tr></tbody></table></div><br><h2>  Perfil do intruso </h2><br>  Gra√ßas aos dados de autentica√ß√£o "com fio", pudemos obter acesso ao centro de comando. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nq/q0/eb/nqq0ebtlfljriwj4m-97hm7-aww.png"></div><br>  Isso nos permitiu identificar o correio final dos atacantes: <br><br>  <b>junaid [.] em *** @ gmail [.] com</b> . <br><br>  O nome do dom√≠nio do centro de comando est√° registrado em <b>sg *** @ gmail [.] Com</b> . <br><br><h2>  Conclus√£o </h2><br>  No decorrer de uma an√°lise detalhada do malware usado no ataque, pudemos estabelecer sua funcionalidade e obter a lista mais abrangente de indicadores de comprometimento relevantes para este caso.  A compreens√£o dos mecanismos de intera√ß√£o de rede da malvari tornou poss√≠vel dar recomenda√ß√µes sobre o ajuste da opera√ß√£o das ferramentas de prote√ß√£o de informa√ß√µes, bem como escrever regras est√°veis ‚Äã‚Äãde IDS. <br><br>  O principal perigo do <b>AgentTesla</b> como DataStealer √© que, para executar suas tarefas, ele n√£o precisa fazer uma fixa√ß√£o no sistema ou aguardar um comando de controle.  Uma vez na m√°quina, ele imediatamente come√ßa a coletar informa√ß√µes privadas e as transmite ao CnC.  Esse comportamento agressivo √© um pouco semelhante ao comportamento dos criptografadores, com a √∫nica diferen√ßa: os √∫ltimos nem sequer exigem uma conex√£o de rede.  No caso de uma colis√£o com essa fam√≠lia ap√≥s a limpeza do sistema infectado do malware, √© obrigat√≥rio alterar todas as senhas que poderiam, pelo menos teoricamente, ser armazenadas em um dos aplicativos acima. <br><br>  Olhando para o futuro, digamos que os invasores que enviam o <b>AgentTesla</b> frequentemente alteram o carregador de inicializa√ß√£o inicial.  Isso permite que voc√™ passe despercebido por scanners est√°ticos e analisadores heur√≠sticos no momento do ataque.  E a tend√™ncia dessa fam√≠lia de iniciar imediatamente sua atividade torna os monitores do sistema in√∫teis.  A melhor maneira de lidar com o AgentTesla √© uma an√°lise preliminar na sandbox. <br><br>  No terceiro artigo desta s√©rie, examinaremos outros gerenciadores de inicializa√ß√£o usados ‚Äã‚Äãpelo <b>AgentTesla</b> e tamb√©m aprenderemos sobre o processo de descompacta√ß√£o semiautom√°tica.  N√£o perca! <br><br><h2>  Hash </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>SHA1</strong> <br></td></tr><tr><td>  A8C2765B3D655BA23886D663D22BDD8EF6E8E894 <br></td></tr><tr><td>  8010CC2AF398F9F951555F7D481CE13DF60BBECF <br></td></tr><tr><td>  79B445DE923C92BF378B19D12A309C0E9C5851BF <br></td></tr><tr><td>  15839B7AB0417FA35F2858722F0BD47BDF840D62 <br></td></tr><tr><td>  1C981EF3EEA8548A30E8D7BF8D0D61F9224288DD <br></td></tr></tbody></table></div><br><h2>  C&amp;C </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>URL</strong> <br></td></tr><tr><td>  sina-c0m [.] icu <br></td></tr><tr><td>  smtp [.] sina-c0m [.] icu <br></td></tr></tbody></table></div><br><br><h2>  Regkey </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Registo</strong> <br></td></tr><tr><td>  HKCU \ Software \ Microsoft \ Windows \ CurrentVersion \ Run \ {Nome do Script} <br></td></tr><tr><td>  HKCU \ Software \ Microsoft \ Windows \ CurrentVersion \ Run \% insregname% <br></td></tr><tr><td>  HKCU \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Explorer \ StartupApproved \ Run \% insregname% <br></td></tr></tbody></table></div><br><h3>  Mutex </h3><br>  Sem indicadores. <br><br><h3>  Arquivos </h3><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Atividade de arquivo</strong> <br></td></tr><tr><td>  % Temp% \ temp.tmp <br></td></tr><tr><td>  % startupfolder% \% insfolder% \% insname% <br></td></tr><tr><td>  % Temp% \ tmpG \ {Hora atual em milissegundos} .tmp <br></td></tr><tr><td>  % Temp% \ log.tmp <br></td></tr><tr><td>  % AppData% \ {Sequ√™ncia arbitr√°ria de 10 caracteres} .jpeg <br></td></tr><tr><td>  C: \ Users \ Public \ {Sequ√™ncia arbitr√°ria de 10 caracteres} .vbs <br></td></tr><tr><td>  % Temp% \ {Nome da pasta arbitr√°ria} \ {Nome do arquivo} <br></td></tr></tbody></table></div><br><h2>  Informa√ß√µes de amostras </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Nome</strong> <br></td><td>  Desconhecido <br></td></tr><tr><td>  <strong>MD5</strong> <br></td><td>  F7722DD8660B261EA13B710062B59C43 <br></td></tr><tr><td>  <strong>SHA1</strong> <br></td><td>  15839B7AB0417FA35F2858722F0BD47BDF840D62 <br></td></tr><tr><td>  <strong>SHA256</strong> <br></td><td>  41DC0D5459F25E2FDCF8797948A7B315D3CB0753 <br>  98D808D1772CACCC726AF6E9 <br></td></tr><tr><td>  <strong>Tipo</strong> <br></td><td>  PE (.NET) <br></td></tr><tr><td>  <strong>Tamanho</strong> <br></td><td>  327680 <br></td></tr><tr><td>  <strong>Nome original</strong> <br></td><td>  AZZRIDKGGSLTYFUBCCRRCUMRKTOXFVPDKGAGPUZI_20190701133545943.exe <br></td></tr><tr><td>  <strong>Datestamp</strong> <br></td><td>  01/01/2019 <br></td></tr><tr><td>  <strong>Compilador</strong> <br></td><td>  Vb.net <br></td></tr></tbody></table></div><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Nome</strong> <br></td><td>  IELibrary.dll <br></td></tr><tr><td>  <strong>MD5</strong> <br></td><td>  BFB160A89F4A607A60464631ED3ED9FD <br></td></tr><tr><td>  <strong>SHA1</strong> <br></td><td>  1C981EF3EEA8548A30E8D7BF8D0D61F9224288DD <br></td></tr><tr><td>  <strong>SHA256</strong> <br></td><td>  D55800A825792F55999ABDAD199DFA54F3184417 <br>  215A298910F2C12CD9CC31EE <br></td></tr><tr><td>  <strong>Tipo</strong> <br></td><td>  PE (DLL do .NET) <br></td></tr><tr><td>  <strong>Tamanho</strong> <br></td><td>  16896 <br></td></tr><tr><td>  <strong>Nome original</strong> <br></td><td>  IELibrary.dll <br></td></tr><tr><td>  <strong>Datestamp</strong> <br></td><td>  11/11/2016 <br></td></tr><tr><td>  <strong>Compilador</strong> <br></td><td>  Microsoft Linker (48,0 *) <br></td></tr></tbody></table></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt479120/">https://habr.com/ru/post/pt479120/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt479100/index.html">Dojo front-end: projetos para treinamento de habilidades de desenvolvedor (5 novos + 43 antigos)</a></li>
<li><a href="../pt479102/index.html">Familiaridade com Yandex.Maps ou Quanto Adoro Documenta√ß√£o</a></li>
<li><a href="../pt479106/index.html">Quanto custam os truques de m√°gica</a></li>
<li><a href="../pt479108/index.html">A vida de Knight - Arena online com elementos de RPG</a></li>
<li><a href="../pt479116/index.html">Impress√µes na pesquisa Y. Direto: por que voc√™ paga 1,5 vezes mais por clique</a></li>
<li><a href="../pt479122/index.html">Como iniciar um projeto de estima√ß√£o e n√£o obter benef√≠cios</a></li>
<li><a href="../pt479124/index.html">[Infogr√°fico] Intelig√™ncia Artificial em Fic√ß√£o Cient√≠fica</a></li>
<li><a href="../pt479126/index.html">Python no desenvolvimento m√≥vel</a></li>
<li><a href="../pt479128/index.html">Como funciona o servi√ßo m√©dico do aeroporto</a></li>
<li><a href="../pt479132/index.html">Componente externo para a plataforma m√≥vel 1C (BroadcastReceiver)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>