<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèº üç£ üëéüèª Paling penting. Integrasi dengan layanan eksternal üôÇ ü¶ï üçû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Memilih pengganti yang digunakan oleh sistem pesan kami, saya menemukan deskripsi Mattermost, dan memutuskan untuk mencobanya. Salah satu keuntungan d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Paling penting. Integrasi dengan layanan eksternal</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442402/"><p>  Memilih pengganti yang digunakan oleh sistem pesan kami, saya menemukan deskripsi Mattermost, dan memutuskan untuk mencobanya.  Salah satu keuntungan dari sistem yang dijelaskan adalah integrasi sederhana dengan layanan pihak ketiga, yang disebut "kait" (kait keluar dan masuk).  Itu tentang mengatur interaksi melalui kait dengan sistem eksternal dan artikel ini akan (dalam kasus khusus kami, ini adalah zabbix dan glpi). </p><a name="habracut"></a><br><h3 id="chast-pervaya-integraciya-s-glpi">  Bagian Satu  Integrasi dengan GLPI </h3><br><p>  Karena kami, dalam pekerjaan kami, menggunakan GLPI untuk menghitung peralatan, perangkat lunak, koneksi, pendaftaran panggilan dukungan teknis, akan logis untuk mengatur kemungkinan bagi pengguna untuk mengirim aplikasi ke TP dari yang paling penting. </p><br><h4 id="api">  API </h4><br><p>  GLPI memiliki http rest api untuk integrasi dengan layanan eksternal.  Dokumentasi untuk itu tersedia di sistem yang diinstal di tautan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http: //glpi/apirest.php/#glossary</a> (di mana "glpi" adalah alamat server Anda). </p><br><p>  Setelah berpikir sedikit tentang tugas, diputuskan untuk mengimplementasikan algoritma pertukaran pada php, mendukung solusi ini adalah fakta bahwa php sudah diinstal dalam sistem dan skrip secara organik dimasukkan ke dalam glpi dan tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http: //glpi/mm.php</a> .  Hasilnya adalah semacam "proxy" yang menerima permintaan dari mattermost, mengonversi ke format yang diinginkan dan mengirimkan GLPI.  Semua permintaan http dikirim dalam format JSON. </p><br><p>  Prosedur kerja terdiri dari 5 bagian: </p><br><ol><li>  Menerima permintaan dari yang paling penting </li><li>  Inisialisasi sesi di glpi </li><li>  Mengambil data dari permintaan </li><li>  Mengirim data ke glpi </li><li>  Sesi penutup </li></ol><br><p>  Sebelum melanjutkan dengan uraian kode skrip, kami akan melakukan pekerjaan persiapan baik dalam hal paling penting maupun di gpi. </p><br><h4 id="glpi">  GLPI </h4><br><ol><li>  Mari kita buat pengguna helpdesk, atas permintaan yang akan dibuat, dan masuk ke pengaturan pengguna ini, kami akan menghasilkan token: <br><img src="https://habrastorage.org/getpro/habr/post_images/64f/869/851/64f869851cfffa8daaddff55592580ba.png" alt="gambar"><br>  Yang dilingkari merah akan menjadi user_token. </li><li>  Di pengaturan sistem, Anda perlu menambahkan klien untuk berinteraksi dengan API.  Untuk melakukan ini, buka "Pengaturan" -&gt; "Umum" -&gt; "API" dan klik tombol "Tambah Klien", tambahkan catatan dan hasilkan token (app_token) </li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a8e/f8c/914/a8ef8c9147eb0d21189f2b3424f3e4bf.png" alt="gambar"></p><br><ol><li>  Untuk mengidentifikasi sumber permintaan dalam sistem, tambahkan entri ke direktori "Sumber permintaan" dan masuk ke entri yang baru saja ditambahkan, ingat idnya (dilingkari merah) <br><img src="https://habrastorage.org/getpro/habr/post_images/645/ee3/e1f/645ee3e1f0378e16c22494e5267a39b2.png" alt="gambar"></li></ol><br><p>  Ini menyelesaikan pengaturan API di GLPI. </p><br><h4 id="mattermost">  Paling penting </h4><br><p>  Di menu klien Mattermost, buka "Inegration" -&gt; "Outhooks Webshooks" klik "Tambah" dan tambahkan entri.  Di layar, saya menekankan bidang yang signifikan.  Di sini kita harus melakukan penyimpangan: pada intinya, "pemicu" untuk memulai prosedur pengiriman permintaan adalah kata atau frasa, yang, yang ditunjukkan pada awal pesan, sebenarnya memulai proses.  Dalam kasus kami, kata pemicunya adalah "112" (di sini ada hubungan langsung dengan Kementerian Keadaan Darurat). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/437/10a/7f6/43710a7f6049679081589ff9574c14a3.png" alt="gambar"></p><br><p>  Nama pengguna default dan tautan ke avatar dapat ditambahkan (atau Anda tidak dapat menambahkannya), karena parameter ini akan ditransfer dalam permintaan.  Tetapi agar hal terpenting untuk dapat memproses parameter ini, dalam pengaturan server Anda perlu mengubah beberapa opsi dalam file <em>/opt/mattermost/config/config.json</em> </p><br><pre><code class="plaintext hljs">"EnablePostUsernameOverride": true, "EnablePostIconOverride": true,</code> </pre> <br><p>  Ini menyelesaikan pengaturan.  Saatnya beralih ke menulis kode.  Script disalin ke direktori root dengan file glpi, dalam kasus saya ini adalah <em>/var/www/html/glpi/mm.php</em> </p><br><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment"># GLPI     $app_token = '7uizyyildM71x84j1UxeABXTuCHdPoLRW45Tx2wG'; $user_app_token ='dZdCqc10Xhb1TxCT4OsXp8qqDSEqILASf2wZot0w'; #    (  ,    ) $requesttypes_id = '7'; #    GLPI (1 - , 2 - ) $type = '1'; #      $postData = file_get_contents('php://input'); $data = json_decode($postData, true); #  json  MatterMost.       #         #$message_text = $data["text"]; #$user_name = $data["user_name"]; #$user_id = $data["user_id"]; #$channel_name = $data["channel_name"]; #$channel_id = $data["channel_id"]; #$team_domain = $data["team_domain"]; #$team_id = $data["team_id"]; #$post_id = $data["post_id"]; #  "112"  ,    4 . $message_text = substr($data["text"],4); #   POST ,      mattermost #HTTP/1.1 200 OK header('Content-Type: application/json'); $reply = array( 'response_type' =&gt; 'comment', 'text'=&gt; '      ' ); echo json_encode($reply); #     glpi #        #         if( $curl = curl_init() ) { curl_setopt($curl, CURLOPT_HTTPHEADER, array('Content-Type: application/json', 'Authorization: user_token '.$user_app_token, 'App-Token: '.$app_token)); curl_setopt($curl, CURLOPT_URL, 'http://glpi/apirest.php/initSession'); curl_setopt($curl, CURLOPT_POST, true); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); $out = curl_exec($curl); $session = json_decode($out, true); $session_token = $session["session_token"]; #echo $session_token; curl_close($curl); } #       $json = array( 'input'=&gt; array( 'name'=&gt;'  '.$data["user_name"], 'requesttypes_id'=&gt;$requesttypes_id, 'content'=&gt;$message_text, 'type'=&gt;$type ) ); #   if( $curl = curl_init() ) { curl_setopt($curl, CURLOPT_HTTPHEADER, array('Content-Type: application/json', 'App-Token: '.$app_token, 'Session-token: '.$session_token)); curl_setopt($curl, CURLOPT_URL, 'http://glpi/apirest.php/Ticket'); curl_setopt($curl, CURLOPT_POST, true); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); curl_setopt($curl, CURLOPT_POSTFIELDS, json_encode($json)); $out = curl_exec($curl); curl_close($curl); } #   if( $curl = curl_init() ) { curl_setopt($curl, CURLOPT_HTTPHEADER, array('Content-Type: application/json', 'App-Token: '.$app_token, 'Session-token: '.$session_token)); curl_setopt($curl, CURLOPT_URL, 'http://glpi/apirest.php/killSession'); curl_setopt($curl, CURLOPT_POST, false); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); $out = curl_exec($curl); curl_close($curl); } ?&gt;</span></span></code> </pre> <br><p>  Hasil skrip ini akan menjadi permintaan tambahan dalam sistem pendaftaran insiden di GLPI.  Dalam gambar, terlihat seperti ini: </p><br><p>  Kami menulis pesan paling penting: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c17/8f1/539/c178f1539ad3d37673927530edcf2797.png" alt="gambar"></p><br><p>  Kami pergi ke GLPI "Dukungan" -&gt; "Aplikasi" dan pesan baru akan muncul dalam daftar: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5e4/adc/41c/5e4adc41cb07c63e45dda24efb603f68.png" alt="gambar"></p><br><p>  Dengan mengklik tajuk pesan, informasi yang lebih detail akan terbuka (bidang yang nilainya ditransmisikan dalam skrip dilingkari merah) </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1ea/ea4/90f/1eaea490fb1b3ca94282eba05f86e5d5.png" alt="gambar"></p><br><p>  Pada pengaturan ini, mengirim pesan ke GLPI dari Mattermost dapat dianggap selesai.  Setelah bekerja sedikit pada kode, tidak ada yang akan mencegah Anda menerapkan perubahan dalam jenis permintaan (insiden atau permintaan). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id442402/">https://habr.com/ru/post/id442402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id442380/index.html">Semacam Kekacauan</a></li>
<li><a href="../id442384/index.html">Memperluas fungsi sistem audio standar</a></li>
<li><a href="../id442386/index.html">Thymeleaf: Tata Letak Dialek + Spring Boot 2</a></li>
<li><a href="../id442392/index.html">Log NodeJS dibuat benar</a></li>
<li><a href="../id442396/index.html">Acara digital di Moskow dari 04 Maret hingga 10 Maret</a></li>
<li><a href="../id442404/index.html">Paling penting. Integrasi dengan layanan eksternal (bagian 2)</a></li>
<li><a href="../id442406/index.html">Intisari Fintech: transfer gratis dalam sistem SBP, kerentanan bank terhadap serangan dan berita lainnya</a></li>
<li><a href="../id442408/index.html">Mesin universal untuk melakukan tes DIY, Bagian 1</a></li>
<li><a href="../id442414/index.html">Belajar di universitas asing sebagai orang pertama</a></li>
<li><a href="../id442416/index.html">Intisari Penelitian dan Pengembangan Universitas ITMO: membahas tren dan pencapaian baru ilmuwan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>