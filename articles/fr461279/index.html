<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🚒 🧕 🥀 Comment créer un microservice simple sur Golang et gRPC et le conteneuriser à l'aide de Docker 👨🏽‍🎤 🍁 🙎🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Je vous présente la traduction de l'article «Go, gRPC et Docker» de Mat Evans. 

 Il existe de nombreux articles sur le partage de Go e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment créer un microservice simple sur Golang et gRPC et le conteneuriser à l'aide de Docker</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461279/">  Bonjour, Habr!  Je vous présente la traduction de l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Go, gRPC et Docker»</a> de Mat Evans. <br><br>  Il existe de nombreux articles sur le partage de Go et Docker.  La création de conteneurs pouvant interagir avec les clients et entre eux est très simple.  Ce qui suit est un petit exemple de la façon dont cela est fait au niveau de base. <br><a name="habracut"></a><br><h3>  Que créons-nous? </h3><br>  Nous allons créer un client et un serveur très simples, interagissant les uns avec les autres à l'aide de <b>gRPC</b> .  Le serveur sera situé à l'intérieur du conteneur <b>Docker</b> afin de pouvoir être facilement déployé. <br><br>  Supposons que nous ayons besoin d'un service qui reçoit une chaîne d'un client et renvoie une chaîne avec un ordre de caractères inversé.  Par exemple, envoyez un «chat» et obtenez un «courant» en réponse. <br><br><h3>  fichier .proto </h3><br>  <b>Le</b> fichier <b>.proto</b> décrit les opérations que notre service effectuera et les données qu'il échangera.  Créez le dossier <b><i>proto</i></b> dans le projet et le fichier <b><i>reverse.proto</i></b> dedans <br><br><pre><code class="plaintext hljs">syntax = "proto3"; package reverse; service Reverse { rpc Do(Request) returns (Response) {} } message Request { string message = 1; } message Response { string message = 1; }</code> </pre> <br>  Une fonction qui est appelée à distance sur le serveur et renvoie des données au client est marquée comme <i><b>rpc</b></i> .  Les structures de données utilisées pour échanger des informations entre des nœuds en interaction sont marquées comme <i><b>message</b></i> .  Chaque champ de message doit recevoir un numéro de séquence.  Dans ce cas, notre fonction reçoit des messages de type <b><i>Request</i></b> du client et retourne des messages de type <b><i>Response</i></b> . <br>  Une fois que nous avons créé un fichier <b>.proto</b> , il est nécessaire d'obtenir le fichier <b>.go</b> de notre service.  Pour ce faire, exécutez la commande de console suivante dans le dossier <b><i>proto</i></b> : <br><br><pre> <code class="bash hljs">$ protoc -I . reverse.proto --go_out=plugins=grpc:.</code> </pre><br>  Bien sûr, vous devez d'abord <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">construire gRPC</a> . <br>  L'exécution de la commande ci-dessus créera un nouveau fichier <b>.go</b> contenant les méthodes de création du client, du serveur et des messages qu'ils échangent.  Si nous appelons <b>godoc</b> , nous verrons ce qui suit: <br><br><pre> <code class="bash hljs">$ godoc . PACKAGE DOCUMENTATION package reverse import <span class="hljs-string"><span class="hljs-string">"."</span></span> Package reverse is a generated protocol buffer package. It is generated from these files: reverse.proto It has these top-level messages: Request Response ....</code> </pre><br><h3>  Client </h3><br>  Ce serait bien si notre client travaillait comme ceci: <br><br><pre> <code class="bash hljs">reverse <span class="hljs-string"><span class="hljs-string">"this is a test"</span></span> tset a si siht</code> </pre><br>  Voici le code qui crée le client <b>gRPC à</b> l'aide de structures de données générées à partir du fichier <b>.proto</b> : <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"context"</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"os"</span></span> pb <span class="hljs-string"><span class="hljs-string">"github.com/matzhouse/go-grpc/proto"</span></span> <span class="hljs-string"><span class="hljs-string">"google.golang.org/grpc"</span></span> <span class="hljs-string"><span class="hljs-string">"google.golang.org/grpc/grpclog"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { opts := []grpc.DialOption{ grpc.WithInsecure(), } args := os.Args conn, err := grpc.Dial(<span class="hljs-string"><span class="hljs-string">"127.0.0.1:5300"</span></span>, opts...) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { grpclog.Fatalf(<span class="hljs-string"><span class="hljs-string">"fail to dial: %v"</span></span>, err) } <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> conn.Close() client := pb.NewReverseClient(conn) request := &amp;pb.Request{ Message: args[<span class="hljs-number"><span class="hljs-number">1</span></span>], } response, err := client.Do(context.Background(), request) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { grpclog.Fatalf(<span class="hljs-string"><span class="hljs-string">"fail to dial: %v"</span></span>, err) } fmt.Println(response.Message) }</code> </pre><br><br><h3>  Serveur </h3><br>  Le serveur utilisera le même fichier <b>.go</b> généré.  Cependant, il ne définit que l'interface du serveur, mais nous devons implémenter la logique par nous-mêmes: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"net"</span></span> pb <span class="hljs-string"><span class="hljs-string">"github.com/matzhouse/go-grpc/proto"</span></span> <span class="hljs-string"><span class="hljs-string">"golang.org/x/net/context"</span></span> <span class="hljs-string"><span class="hljs-string">"google.golang.org/grpc"</span></span> <span class="hljs-string"><span class="hljs-string">"google.golang.org/grpc/grpclog"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { listener, err := net.Listen(<span class="hljs-string"><span class="hljs-string">"tcp"</span></span>, <span class="hljs-string"><span class="hljs-string">":5300"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { grpclog.Fatalf(<span class="hljs-string"><span class="hljs-string">"failed to listen: %v"</span></span>, err) } opts := []grpc.ServerOption{} grpcServer := grpc.NewServer(opts...) pb.RegisterReverseServer(grpcServer, &amp;server{}) grpcServer.Serve(listener) } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> server <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s *server)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Do</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c context.Context, request *pb.Request)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(response *pb.Response, err error)</span></span></span></span> { n := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">// reate an array of runes to safely reverse a string. rune := make([]rune, len(request.Message)) for _, r := range request.Message { rune[n] = r n++ } // Reverse using runes. rune = rune[0:n] for i := 0; i &lt; n/2; i++ { rune[i], rune[n-1-i] = rune[n-1-i], rune[i] } output := string(rune) response = &amp;pb.Response{ Message: output, } return response, nil }</span></span></code> </pre><br><br><h3>  Docker </h3><br>  Je suppose que vous savez ce qu'est <b>Docker</b> et à quoi il sert.  Voici notre <b>Dockerfile</b> : <br><br><pre> <code class="plaintext hljs">FROM golang:1.12 ADD . /go/src/github.com/matzhouse/go-grpc/server RUN go install github.com/matzhouse/go-grpc/server ENTRYPOINT ["/go/bin/server"] EXPOSE 5300</code> </pre><br>  Le code d'assemblage de l'image <b>Docker</b> est écrit ici.  Nous allons l'analyser ligne par ligne. <br><br><pre> <code class="plaintext hljs">FROM golang:1.12</code> </pre><br>  Cette commande signifie que nous voulons créer une image de notre application sur la base d'une image précédemment créée, à savoir <b><i>golang</i></b> .  Il s'agit d'une image <b>Docker</b> avec un environnement déjà configuré pour créer et exécuter des programmes écrits en <b>Go</b> . <br><br><pre> <code class="plaintext hljs">ADD . /go/src/github.com/matzhouse/go-grpc/server</code> </pre><br>  Cette commande copie le code source de notre application dans le <b>conteneur GOPATH / src</b> . <br><br><pre> <code class="plaintext hljs">RUN go install github.com/matzhouse/go-grpc/server</code> </pre><br>  Cette commande collecte notre application à partir des sources copiées dans le conteneur et l'installe dans le <i><b>dossier du</b></i> conteneur <i><b>GOPATH / bin</b></i> . <br><br><pre> <code class="plaintext hljs">ENTRYPOINT ["/go/bin/server"]</code> </pre><br>  Cette commande configure le conteneur pour fonctionner comme un programme exécutable.  Nous y indiquons le chemin vers l'exécutable de l'application et, si nécessaire, les arguments de la ligne de commande. <br><br><pre> <code class="plaintext hljs">EXPOSE 5300</code> </pre><br>  Avec cette commande, nous indiquons au conteneur quels ports doivent être accessibles de l'extérieur. <br><br><h3>  Démarrage du serveur </h3><br>  Nous devons exécuter le conteneur avec notre application serveur. <br>  Vous devez d'abord créer l'image en fonction des instructions du <b>Dockerfile</b> : <br><br><pre> <code class="bash hljs">$ sudo docker build -t matzhouse/grpc-server . Sending build context to Docker daemon 31.76 MB Step 1/5 : FROM golang ---&gt; a0c61f0b0796 Step 2/5 : ADD . /go/src/github.com/matzhouse/go-grpc ---&gt; 9508be6501c1 Removing intermediate container 94dc6e3a9a20 Step 3/5 : RUN go install github.com/matzhouse/go-grpc/server ---&gt; Running <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> f3e0b993a420 ---&gt; f7a0370b7f7d Removing intermediate container f3e0b993a420 Step 4/5 : ENTRYPOINT /go/bin/server ---&gt; Running <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 9c9619e45df4 ---&gt; fb34dfe1c0ea Removing intermediate container 9c9619e45df4 Step 5/5 : EXPOSE 5300 ---&gt; Running <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0403390af135 ---&gt; 008e09b9aebd Removing intermediate container 0403390af135 Successfully built 008e09b9aebd</code> </pre><br>  Maintenant, nous pouvons voir cette image dans la liste: <br><br><pre> <code class="bash hljs">$ docker images REPOSITORY TAG IMAGE ID ... matzhouse/grpc-server latest 008e09b9aebd ...</code> </pre><br>  Super!  Nous avons une image de notre application serveur, avec laquelle vous pouvez lancer son conteneur en utilisant la commande suivante: <br><br><pre> <code class="bash hljs">$ docker run -it -p 5300:5300 matzhouse/grpc-server</code> </pre><br>  Dans ce cas, le soi-disant  <i>redirection de port</i> .  Notez que pour cela, nous avons besoin à la fois de l'instruction <b><i>EXPOSE</i></b> et de l'argument <i><b>-p</b></i> . <br><br><h3>  Lancement client </h3><br>  La conteneurisation du client ne donnera pas de gros avantages, alors commençons comme d'habitude: <br><br><pre> <code class="bash hljs">$ go build -o reverse $ ./reverse <span class="hljs-string"><span class="hljs-string">"this is a test"</span></span> tset a si siht</code> </pre><br>  Merci d'avoir lu! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461279/">https://habr.com/ru/post/fr461279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461267/index.html">Nouvelles technologies Intel pour le conditionnement des puces</a></li>
<li><a href="../fr461269/index.html">La solution de travail avec pwnable.kr 08 est leg et 10 est shellshock. Assembleur ARM. Vulnérabilité Bash</a></li>
<li><a href="../fr461271/index.html">Comment promouvoir une application mobile en 2019: 4 façons pratiques + outils utiles</a></li>
<li><a href="../fr461273/index.html">Approche gourmande et machines à sous. Analyse des tâches de la piste ML du championnat de programmation</a></li>
<li><a href="../fr461277/index.html">Présentation de l'outil gratuit SQLIndexManager</a></li>
<li><a href="../fr461281/index.html">Procédure pas à pas pour configurer un serveur DNS BIND dans un environnement chroot pour Red Hat (RHEL / CentOS) 7</a></li>
<li><a href="../fr461283/index.html">Architecture logicielle et conception de systèmes: guide général et ressources</a></li>
<li><a href="../fr461285/index.html">5 algorithmes d'échantillonnage principaux</a></li>
<li><a href="../fr461287/index.html">Développer une IA astucieuse dans un jeu tactique basé sur l'heuristique et les mutations</a></li>
<li><a href="../fr461289/index.html">Sortie de CLion 2019.2: support de développement intégré, débogueur pour MSVC, recherche de fichiers d'en-tête inutilisés</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>