<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêΩ üßìüèª ‚úäüèª CI / CD mit AWS und Bambus üìº üñ≤Ô∏è ‚èèÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unser Team besteht aus einem Entwickler und einem DevOps-Ingenieur. Ich bin f√ºr die Bereitstellung der Anwendung im Amazon ECS-Cluster verantwortlich....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CI / CD mit AWS und Bambus</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/icl_services/blog/458648/">  Unser Team besteht aus einem Entwickler und einem DevOps-Ingenieur.  Ich bin f√ºr die Bereitstellung der Anwendung im Amazon ECS-Cluster verantwortlich.  Als CI / CD-Server verwende ich Bamboo.  In diesem Artikel werde ich detailliert beschreiben, wie ich eine Anwendung in einer Entwicklungsumgebung bereitstelle. <br><br><img src="https://habrastorage.org/webt/cn/bu/3w/cnbu3wmmjkhiqhwgxpuhk3pu2fc.png"><br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/ev/oz/rs/evozrsbpwhmgd0zodgrz4pukurm.png"><br><br><h4>  Erstellen Sie ein Docker-Image </h4><br>  Hier folge ich diesen Schritten: <br><br><ul><li>  Schritt 1: Installieren und konfigurieren Sie Docker. </li><li>  Schritt 2: Konfigurieren Sie Artefakte in Bambus. </li><li>  Schritt 3: Konfigurieren Sie das Amazon ECR-Repository. </li><li>  Schritt 4: Erstellen Sie das Docker-Image in Bamboo. </li></ul><br><h1>  Schritt 1: Installieren und konfigurieren Sie Docker </h1><br>  Zuerst aktualisiere ich den Server, auf dem Bamboo installiert ist, installiere die erforderlichen Pakete und richte das Docker-Repository ein.  Es ist zu beachten, dass ich Bamboo auf dem CentOS 7-Betriebssystem installiert habe. Informationen zur Installation von Docker auf anderen Betriebssystemen finden Sie unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.docker.com</a> . <br><br><pre><code class="plaintext hljs">$ sudo yum update $ sudo yum install -y yum-utils device-mapper-persistent-data lvm2 $ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</code> </pre> <br>  Dann installiere ich die Docker-Anwendung und starte den Dienst: <br><br><pre> <code class="plaintext hljs">$ sudo yum install docker-ce docker-ce-cli containerd.io $ sudo systemctl enable docker $ sudo systemctl start docker</code> </pre><br>  Dann f√ºge ich den Bambusbenutzer der Docker-Gruppe hinzu: <br><br><pre> <code class="plaintext hljs">$ sudo usermod -aG docker bamboo $ sudo su - bamboo $ docker run hello-world</code> </pre><br>  Wenn Docker nach dem Ausf√ºhren dieser Befehle mit der Meldung ‚ÄûHallo von Docker!‚Äú Antwortet, bedeutet dies, dass meine Installation ordnungsgem√§√ü funktioniert. <br><br><h1>  Schritt 2. Konfigurieren Sie Artefakte in Bamboo </h1><br>  Die Anwendungsentwicklung bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Grails</a> ist im Gange.  Beim Kompilieren der Anwendung wird eine Datei mit der Erweiterung war erstellt.  Diese Datei ist in der Bambus-Terminologie ein Artefakt.  Konfigurieren Sie Bamboo so, dass diese Datei f√ºr nachfolgende Aufgaben verwendet wird.  Dazu gehe ich zur Registerkarte <b>Aufgaben</b> : <br><br><img src="https://habrastorage.org/webt/l2/xf/rh/l2xfrhlwvte_3enperkvbqadtey.png"><br><br>  Und ich habe die Grails-Aufgabe wie folgt eingerichtet: <br><br><img src="https://habrastorage.org/webt/ba/6l/s7/ba6ls73snayld5eazip7mcc0eg4.png"><br><br>  Wir sehen, dass Grails zuerst den Build-Ordner l√∂scht, dann die Tests ausf√ºhrt und schlie√ülich eine War-Datei f√ºr die Entwicklungsumgebung erstellt. <br><br>  Danach klicke ich auf die Registerkarte <b>Artefakte</b> und die Schaltfl√§che <b>Artefakt erstellen</b> : <br><br><img src="https://habrastorage.org/webt/2a/sj/am/2asjam033lqmwc9txcj_slq_5jc.png"><br><br>  Ich definiere ein Artefakt wie folgt: <br><br><img src="https://habrastorage.org/webt/jw/_b/wb/jw_bwbdddrwx1pa1gh7etxonvys.png"><br><br>  Grails legt die Kriegsdatei im Verzeichnis <b>build / libs ab</b> .  Ich werde den <b>Shared-</b> Parameter √ºberpr√ºfen, da ich dieses Artefakt sp√§ter ben√∂tige. <br><br>  Jetzt erstelle ich ein Bereitstellungsprojekt und gebe ein Artefakt an, das in meinem Erstellungsplan verwendet werden soll: <br><br><img src="https://habrastorage.org/webt/y7/fs/uf/y7fsufkg7rsi-6d3i-hfk8o6rlc.png"><br><br><img src="https://habrastorage.org/webt/s7/nf/tu/s7nftu9r8vwudgjzi1qdtlaljpw.png"><br><br>  Ich habe auch die <b>Artefakt-Download-</b> Aufgabe im Bereitstellungsprojekt eingerichtet: <br><br><img src="https://habrastorage.org/webt/ie/vv/uv/ievvuvkegkneya15tqd9xlcayhu.png"><br><br>  Somit ist Bamboo jetzt f√ºr die Verwendung einer Kriegsdatei konfiguriert. <br><br><h1>  Schritt 3. Konfigurieren Sie das Amazon ECR-Repository </h1><br>  Amazon ECR ist ein Docker-Speicher- und Verwaltungsdienst f√ºr Bilder.  √ñffnen Sie zum Konfigurieren die AWS-Konsole und w√§hlen Sie ECR: <br><br><img src="https://habrastorage.org/webt/ys/fd/1i/ysfd1ijutkdnzcugeldnemvywl4.png"><br><br>  Nachdem ich das Repository erstellt habe, erhalte ich die folgende Adresse: <br><br><pre> <code class="plaintext hljs">aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard</code> </pre><br>  Nach Abschluss der Konfiguration finden Sie hier auch Anweisungen zum Anmelden, Herunterladen eines Bilds aus dem Repository und Hochladen des Bildes in das Repository. <br><br><h1>  Schritt 4: Erstellen Sie das Docker-Image in Bambus </h1><br>  Jetzt muss ich den Trigger konfigurieren, um mit dem Erstellen des Docker-Images zu beginnen.  Dazu gehe ich zur Registerkarte <b>Trigger</b> und klicke auf die Schaltfl√§che <b>Trigger</b> hinzuf√ºgen: <br><br><img src="https://habrastorage.org/webt/ev/gq/nu/evgqnu95-my1ralvlnxrw6tx3fe.png"><br><br>  Hier w√§hle <b>ich die</b> Option <b>Nach erfolgreichem Erstellen des Plans erstellen,</b> damit das Docker-Image nach dem Kompilieren des Projekts erstellt wird. <br><br>  Jetzt m√ºssen wir die Docker-Image-Build-Aufgabe hinzuf√ºgen.  Wechseln Sie dazu zur Registerkarte <b>Aufgaben</b> , klicken <b>Sie auf Aufgabe hinzuf√ºgen</b> und w√§hlen Sie den <b>Docker-</b> Typ aus.  Geben Sie eine Beschreibung ein und w√§hlen Sie im Dropdown-Men√º die <b>Option Docker-Image</b> erstellen.  <b>Geben Sie im</b> Feld <b>Repository</b> ein <br><br><pre> <code class="plaintext hljs"> aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest.</code> </pre><br>  Die Docker-Datei kann wie folgt aussehen: <br><br><pre> <code class="plaintext hljs">FROM openjdk:8-jre COPY *.war /usr/src/onboard.war WORKDIR /usr/src CMD ["/bin/bash", "-c", "java -DdataSource.url=$DATASOURCE_URL -DdataSource.username=$DATASOURCE_USERNAME -DdataSource.password=$DATASOURCE_PASSWORD -jar onboard.war"]</code> </pre><br>  Wenn Sie die Anwendung starten, m√ºssen Sie die Datenbank angeben.  Umgebungsvariablen DATASOURCE_URL, DATASOURCE_USERNAME, DATASOURCE_PASSWORD werden verwendet, um diese Informationen an die Anwendung zu √ºbertragen, ihre Werte werden jedoch beim Starten des Containers festgelegt. <br><br>  Damit ist der Einrichtungsprozess f√ºr das Zusammenstellen des Docker-Images mit der Anwendung abgeschlossen.  Der n√§chste Schritt besteht darin, den Download dieses Bildes in das Amazon ECR-Repository zu konfigurieren. <br><br><img src="https://habrastorage.org/webt/yx/n_/3t/yxn_3t_bqhvr2azfbyaywzadhpe.png"><br><br><h4>  Laden Sie das Bild in die Elastic Container Registry hoch </h4><br>  Sie k√∂nnen die Elastic Container Registry verwenden, um mit Bamboo gesammelte Bilder zu speichern.  Um dies zu erreichen, gehe ich folgenderma√üen vor: <br><br><ul><li>  Schritt 1. Installieren Sie Amazon ECR Docker Credential Helper </li><li>  Schritt 2. Verbinden Sie die IAM-Rolle mit dem Bamboo-Server </li><li>  Schritt 3: Konfigurieren Sie den Docker-Image-Startjob </li></ul><br><h1>  Schritt 1. Installieren Sie Amazon ECR Docker Credential Helper </h1><br>  Um Docker-Images auf Amazon ECR herunterzuladen, m√ºssen Sie √ºber Anmeldeinformationen verf√ºgen.  Diese Anmeldeinformationen k√∂nnen durch Ausf√ºhren des Befehls abgerufen werden <br><br><pre> <code class="plaintext hljs">aws ecr get-login</code> </pre><br>  Diese Anmeldeinformationen sind jedoch nur 12 Stunden g√ºltig.  Daher k√∂nnen Sie entweder den obigen Befehl jedes Mal ausf√ºhren, bevor Sie das Image in die ECR hochladen, oder den ECR Docker Credential Helper installieren, der die tempor√§ren Anmeldeinformationen auf dem neuesten Stand h√§lt und sich bei der ECR anmeldet.  F√ºhren Sie die folgenden Schritte aus, um den ECR Docker Credential Helper zu installieren. <br><br>  Zuerst m√ºssen Sie <i>git</i> installieren und dann das Github-Repository klonen: <br><br><pre> <code class="plaintext hljs">$ sudo yum install git $ sudo su - bamboo $ git clone https://github.com/awslabs/amazon-ecr-credential-helper.git $ make docker</code> </pre><br>  Dann m√ºssen Sie die folgenden Zeilen in die Datei <i>/home/bamboo/.docker/config.json einf√ºgen</i> : <br><br><pre> <code class="plaintext hljs">{ "credsStore": "ecr-login" }</code> </pre><br>  Und kopieren Sie die kompilierte Anwendung in das <i>Verzeichnis / usr / bin</i> : <br><br><pre> <code class="plaintext hljs">$ exit $ sudo cp /home/bamboo/docker-credential-ecr-login /usr/bin/</code> </pre><br><h1>  Schritt 2. Verbinden Sie die IAM-Rolle mit dem Bamboo-Server </h1><br>  Damit der Bamboo-Server ECR verwenden kann, m√ºssen Sie eine Rolle erstellen, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AmazonEC2ContainerRegistryPowerUser-</a> Richtlinie zu dieser Rolle hinzuf√ºgen und diese Rolle dann an die EC2-Bamboo-Instanz anh√§ngen.  √ñffnen Sie die AWS-Konsole und w√§hlen Sie IAM.  Klicken <b>Sie anschlie√üend auf die</b> Schaltfl√§che <b>Rolle erstellen</b> , w√§hlen Sie <b>AWS-Service</b> und <b>EC2 aus</b> , wie unten gezeigt: <br><br><img src="https://habrastorage.org/webt/1o/vs/jf/1ovsjfchxa3p-bgv4y-6unnz8sk.png"><br><br>  Dann klicken wir auf die Schaltfl√§che <b>Weiter: Berechtigungen.</b> Im n√§chsten Bildschirm finden wir die <b>AmazonEC2ContainerRegistryPowerUser-</b> Richtlinie und w√§hlen <b>sie aus</b> .  Danach erstellen wir die Rolle fertig und h√§ngen sie an unseren Bamboo-Server an. <br><br><h1>  Schritt 3: Konfigurieren Sie den Docker-Image-Startjob </h1><br>  Die Anwendung, die wir erstellt und ein Docker-Image mit einer Kriegsdatei zusammengestellt haben.  Jetzt m√ºssen Sie dieses Bild in das Repository hochladen.  Dazu f√ºge ich eine weitere Docker-Aufgabe hinzu, diesmal um das Bild in das ECR-Repository hochzuladen.  Ich gehe zur Registerkarte <b>Aufgaben</b> , <b>klicke auf Aufgabe hinzuf√ºgen</b> und w√§hle den <b>Docker-</b> Typ aus.  Ich gebe eine Beschreibung ein und w√§hle im Dropdown-Men√º die <b>Option Docker-Image in eine Docker-Registrierung √ºbertragen</b> .  Ich w√§hle <b>Benutzerdefinierte Registrierung</b> und gebe die Repository-Adresse in das Feld <b>Repository</b> ein.  F√ºr den <b>Authentifizierungstyp</b> w√§hle ich <b>Die nativen Anmeldeinformationen des Agenten verwenden</b> . <br><br>  Damit ist der Setup-Vorgang zum Laden des Docker-Images in das Amazon ECR-Repository abgeschlossen.  In den folgenden Schritten wird das Konfigurieren eines Clusters und eines Dienstes zum Starten einer Containeranwendung beschrieben.  Zuvor m√ºssen Sie jedoch die Startoptionen f√ºr den Container konfigurieren.  Das werden wir jetzt tun. <br><br><img src="https://habrastorage.org/webt/f7/ku/os/f7kuosux7wvkojanpgoy8zd7wya.png"><br><br><h4>  Erstellen Sie eine Amazon ECS-Aufgabendefinition </h4><br>  Aufgabendefinition - Hier werden Containerausf√ºhrungsparameter geschrieben.  Unsere Anwendung verwendet eine Datenbank, deren Parameter beim Start des Containers angegeben werden. In diesem Abschnitt erstellen wir daher auch eine Datenbank.  Ich verwende <b>Amazon RDS</b> als Datenbank und speichere das Kennwort f√ºr den Zugriff auf die Datenbank in verschl√ºsselter Form im <b>AWS Systems Manager-Parameterspeicher</b> .  Die folgenden Schritte befolge ich, um eine Aufgabendefinition zu erstellen: <br><br><ul><li>  Schritt 1. Erstellen einer Datenbank auf einer Amazon RDS-Instanz; </li><li>  Schritt 2. Konfigurieren des AWS Systems Manager-Parameterspeichers; </li><li>  Schritt 3. Erstellen Sie eine Aufgabendefinition. </li></ul><br><h1>  Schritt 1. Erstellen Sie eine Datenbank auf einer Amazon RDS-Instanz </h1><br>  Unsere Anwendung verwendet die PostgreSQL-Datenbank.  √ñffnen Sie zum Erstellen einer Datenbank die AWS-Konsole, w√§hlen Sie den Amazon RDS-Dienst aus, klicken <b>Sie auf die</b> Schaltfl√§che <b>Datenbank erstellen</b> und w√§hlen Sie dann <b>PostgreSQL</b> als Datenbankmodul aus.  Auf der n√§chsten Seite w√§hle ich <b>Dev / Test</b> als Arbeitsumgebung aus und klicke auf <b>Weiter</b> .  Dann bezeichne ich die <b>DB-</b> <b>Instanzkennung</b> <b>als onboard-dev-db</b> und den <b>Master-Benutzernamen</b> als <b>devdbadmin</b> .  Dann gehe ich zur n√§chsten Seite, um die VPC, die Subnetzgruppe und die Sicherheitsgruppe zu konfigurieren.  Diese Datenbank wird in einem privaten Netzwerk verwendet, daher w√§hle ich <b>Nein</b> f√ºr den Parameter <b>√ñffentliche Barrierefreiheit</b> .  Ich <b>gebe devdb</b> in das <b>Feld</b> <b>Datenbankname</b> <b>ein</b> und <b>klicke</b> auf die Schaltfl√§che <b>Datenbank erstellen</b> . <br><br><h1>  Schritt 2. Konfigurieren des AWS Systems Manager-Parameterspeichers </h1><br>  Ich speichere das Datenbankkennwort in verschl√ºsselter Form.  √ñffnen Sie dazu die AWS-Konsole und gehen Sie zu AWS Systems Manager ‚Üí Freigegebene Ressourcen ‚Üí Parameterspeicher ‚Üí Parameter erstellen.  Ich <b>gebe devdbpassword</b> als Parameternamen ein und w√§hle <b>SecureString</b> als Parametertyp aus. Dann <b>gebe</b> ich das Datenbankkennwort in das Feld <b>Wert</b> ein. <br><br><h1>  Schritt 3. Erstellen Sie eine Aufgabendefinition </h1><br>  Amazon ECS ist der Cluster, in dem Containeranwendungen ausgef√ºhrt werden.  Mithilfe der Aufgabendefinition werden Ausf√ºhrungsparameter f√ºr eine Containeranwendung angegeben.  Klicken Sie zum <b>Festlegen</b> solcher Parameter auf die Schaltfl√§che <b>Neue Aufgabendefinition erstellen</b> .  Dann w√§hle ich <b>Fargate</b> als Starttyp und gehe zum n√§chsten Schritt √ºber.  Hier habe ich den Namen als <b>onboard-dev-taskdef gesetzt</b> .  W√§hlen <b>Sie</b> f√ºr den <b>Feldparameter IAM-Rollenfeld</b> f√ºr die <b>Aufgabenausf√ºhrung</b> die <b>Option Neue Rolle erstellen aus</b> .  F√ºr die f√ºr diese Anwendung zugewiesenen Ressourcen bezeichne ich 2 GB Speicher und 1 vCPU.  Jetzt m√ºssen Sie Container-Startoptionen hinzuf√ºgen.  Ich werde den Container <b>onboard-dev-container</b> benennen.  Ich werde den Bildnamen so benennen: <br><br>  <i>aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest</i> .  Amazon ECR Docker Credential Helper k√ºmmert sich um die ECR-Authentifizierung, daher lasse ich die <b>Authentifizierungsoption f√ºr</b> das <b>private Repository</b> deaktiviert.  In der Entwicklungsumgebung ist die Anwendung auf Port 8080 verf√ºgbar. F√ºr den Parameter Port Mappings schreibe ich <b>8080</b> und w√§hle das <b>TCP-</b> Protokoll aus.  Datenbank-URL-Parameter, Benutzername und Kennwort werden mithilfe von Umgebungsvariablen an den Container √ºbergeben.  Ich habe diese Parameter im Abschnitt Umgebungsvariablen eingestellt.  Um den Wert des Parameters <b>devdbpassword</b> aus dem Parameterspeicher <b>abzurufen, gebe</b> ich den Typ <b>ValueFrom an</b> .  Das letzte, was ich konfiguriere, ist die <b>Protokollkonfiguration</b> . Hier w√§hle ich <b>CloudWatch-Protokolle automatisch konfigurieren</b> .  Jetzt ist die Erstellung der Aufgabendefinition abgeschlossen. <br><br>  Die Rolle ecsTaskExecutionRole ben√∂tigt jedoch eine Richtlinie, um devdbpassword aus dem Parameterspeicher abzurufen.  Gehen Sie dazu zu IAM-Rollen und w√§hlen Sie ecsTaskExecutionRole aus. Klicken <b>Sie auf Inline-Richtlinie</b> hinzuf√ºgen.  In diesem Fall f√ºge ich mit einem visuellen Editor hinzu.  Daher <b>gebe</b> ich im Feld Service den <b>Systemmanager ein</b> , im Feld Aktionen - <b>GetParameters</b> .  Dann <b>klicke</b> ich f√ºr das Feld Ressourcen auf <b>ARN hinzuf√ºgen</b> und gebe meine Werte ein: <br><br><img src="https://habrastorage.org/webt/2j/wd/6r/2jwd6r5dpp41jbjj4g7gctfeafw.png"><br><br>  Am Ende schaue ich mir die Werte der Parameter an, die durch Klicken auf √úberpr√ºfungsrichtlinie festgelegt werden, gebe ihr einen Namen und beende die Arbeit mit der ecsTaskExecutionRole-Konfiguration. <br><br>  Damit ist die Konfiguration der Einstellungen f√ºr die Startcontaineranwendung abgeschlossen.  Jetzt m√ºssen Sie einen ECS-Cluster und -Dienst erstellen. <br><br><img src="https://habrastorage.org/webt/0k/u7/xn/0ku7xnp7bctypewbbcwyzdda_-y.png"><br><br><h4>  Erstellen Sie den Amazon ECS-Dienst </h4><br>  Unsere Containeranwendung wird als Service in einem ECS-Cluster ausgef√ºhrt.  Zum Konfigurieren m√ºssen Sie die folgenden Schritte ausf√ºhren: <br><br><ul><li>  Schritt 1. Erstellen Sie einen Amazon ECS-Cluster. </li><li>  Schritt 2: Erstellen eines Dienstes </li></ul><br><h1>  Schritt 1. Erstellen Sie einen Amazon ECS-Cluster </h1><br>  Um einen ECS-Cluster zu erstellen, rufen Sie die AWS-Konsole auf und w√§hlen Sie den ECS-Dienst aus.  Klicken <b>Sie dann auf Cluster erstellen</b> und w√§hlen Sie die Vorlage <b>Nur Netzwerkcluster aus</b> .  Auf der n√§chsten Seite <b>benenne</b> ich den Cluster als <b>Onboard-Dev-Cluster</b> und vervollst√§ndige den Cluster.  Jetzt habe ich einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fargate-</a> basierten ECS-Cluster. <br><br><h1>  Schritt 2: Erstellen eines Dienstes </h1><br>  Um einen Dienst zu erstellen, klicke ich auf den Link <b>Onboard-Dev-Cluster</b> , gehe dann zur Registerkarte <b>Dienste</b> und klicke auf die Schaltfl√§che <b>Erstellen</b> .  F√ºr den Starttyp w√§hle <b>ich</b> Fargate, f√ºr die <b>Aufgabendefinition</b> w√§hle <b>ich</b> onboard-dev-taskdef.  Au√üerdem w√§hle ich im Feld Cluster den Onboard-Dev-Cluster aus.  In das Feld Dienstname schreibe ich onboard-dev.  Ich habe den Parameter <b>Anzahl der Aufgaben</b> auf Null gesetzt, da ich die Anwendung jetzt nicht starten m√∂chte.  Ich lasse die Parameter <b>Minimum Healthous</b> Percent gleich 100 und <b>Maximum</b> <b>Percent</b> gleich 200. W√§hlen Sie f√ºr den Parameter <b>Deployment Type die</b> Option <b>Rolling Update aus</b> und fahren Sie mit dem n√§chsten Schritt fort. <br><br>  Auf der Seite <b>Netzwerk konfigurieren</b> <b>w√§hle</b> ich f√ºr den Parameter <b>Cluster-VPC</b> eine zuvor erstellte VPC mit dem Namen <b>Entwicklungs-VPC aus</b> .  Die in der Entwicklung befindliche Anwendung ist nur im privaten Netzwerk verf√ºgbar, daher w√§hle ich zwei private Subnetze.  Um Sicherheitsgruppen zu konfigurieren, klicke ich auf die Schaltfl√§che <b>Bearbeiten</b> , w√§hle dann <b>Vorhandene Sicherheitsgruppe</b> ausw√§hlen, dann die <b>Standardsicherheitsgruppe</b> und klicke auf die Schaltfl√§che <b>Speichern</b> .  F√ºr den Parameter <b>√ñffentliche IP automatisch zuweisen</b> w√§hle ich <b>Deaktiviert</b> .  Als N√§chstes w√§hle ich f√ºr den Parameter <b>Load Balancer-Typ</b> <b>None aus</b> und lasse die Option <b>Service Discovery-Integration</b> aktivieren <b>deaktiviert</b> .  Dann klicke ich auf <b>Weiter, Weiter</b> und <b>Dienst erstellen</b> . <br><br>  Jetzt habe ich einen Dienst, bei dem die Anzahl der ausgef√ºhrten Jobs Null ist.  Wir werden den Anwendungsstart im n√§chsten Schritt konfigurieren. <br><br><img src="https://habrastorage.org/webt/dg/_9/er/dg_9er1txnjnjbhpkrcmn5af4lk.png"><br><br><h4>  Service-Update </h4><br>  Sobald der Entwickler den Anwendungscode aktualisiert, erstellt unsere Bereitstellung ein Docker-Image, l√§dt es in die Elastic Container Registry hoch und startet schlie√ülich die Containeranwendung als Dienst im ECS Fargate-Cluster.  Derzeit ist die Anzahl der im Cluster ausgef√ºhrten Jobs Null.  Damit die Anwendung gestartet werden kann, m√ºssen Sie den Dienst aktualisieren und die Menge gleich eins angeben.  Ich folge diesen Schritten, um dies zu erreichen: <br><br><ul><li>  Schritt 1. Installieren des Tasks for AWS Bamboo-Plugins; </li><li>  Schritt 2. Aktualisieren des ECS-Dienstes </li></ul><br><h1>  Schritt 1. Installieren des Plugins Tasks for AWS Bamboo </h1><br>  <b>Aufgaben f√ºr AWS Bamboo</b> ist ein Plugin, das die Vorbereitung und den Betrieb von AWS-Ressourcen aus Bamboo-Build- und Bereitstellungsprojekten vereinfacht.  Um dieses Plugin zu installieren, gehe ich zum Bereitstellungsprojekt, <b>klicke auf Aufgabe hinzuf√ºgen</b> , gehe zum Atlassian Marketplace und installiere <b>Aufgaben f√ºr AWS (Bamboo)</b> . <br><br><h1>  Schritt 2. Aktualisieren des ECS-Dienstes </h1><br>  Jetzt im Bereitstellungsprojekt f√ºge ich den <b>Amazon ECS Service-</b> Job hinzu.  Dann schreibe ich in das <b>Jobbeschreibungsfeld Update Service f√ºr onBoard-dev</b> .  W√§hlen Sie im Feld Aktion die <b>Option Dienst aktualisieren</b> und <b>Neue Bereitstellung erzwingen aus</b> .  Dann w√§hle ich US East (Ohio) als Startregion.  Dann schreibe ich in die entsprechenden Felder ARN (Amazon Resource Name) f√ºr Task Definition, Cluster und Service.  In dieser Aufgabe aktualisiere ich die gew√ºnschte Anzahl laufender Aufgaben auf eins.  Als N√§chstes f√ºlle ich das Textfeld f√ºr die Bereitstellungskonfiguration mit den folgenden Werten aus: <br><br><pre> <code class="plaintext hljs">{ "maximumPercent": 200, "minimumHealthyPercent": 100 }</code> </pre><br>  Ich richte ein Netzwerk ohne √∂ffentliche IP wie folgt ein: <br><br><pre> <code class="plaintext hljs">{ "awsvpcConfiguration": { "assignPublicIp": "DISABLED", "subnets": ["subnet-ID1", "subnet-ID2"], "securityGroups": ["sg-ID"] } }</code> </pre><br>  Im Abschnitt <b>Quelle</b> f√ºr <b>AWS-Sicherheitsanmeldeinformationen</b> w√§hle ich <b>IAM-Rolle f√ºr EC2 aus</b> . <br><br>  Ich muss in der Lage sein, ECS zu aktualisieren, daher <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">h√§nge</a> ich die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AmazonECS_FullAccess-</a> Richtlinie an meine Bamboo EC2-Instanz an.  √ñffnen Sie dazu die AWS-Konsole und w√§hlen Sie IAM.  Dann w√§hle ich die Rolle aus, die ich f√ºr meinen Bamboo-Server verwende.  Ich klicke auf die Schaltfl√§che Richtlinien anh√§ngen, finde die AmazonECS_FullAccess-Richtlinie, aktiviere das Kontrollk√§stchen links und beende das Anh√§ngen der Richtlinie. <br><br>  Damit ist das CI / CD-Setup mit AWS und Bamboo abgeschlossen.  Wenn der Entwickler den Anwendungscode aktualisiert, diesen Code in das Repository hochl√§dt, werden das Testen und Zusammenstellen der Anwendung gestartet.  Anschlie√üend wird das Docker-Image mit der War-Datei der Anwendung erstellt und dieses Image in das Amazon ECR-Repository kopiert.  Als N√§chstes wird im Amazon ECS-Cluster eine Containeranwendung als Dienst gestartet, die die aktuelle Anwendung aktualisiert, wenn sie nicht gestoppt wurde.  Wenn die Anwendung gestoppt wurde, um Ressourcen zu sparen, wird die Anwendung einfach gestartet.  Nachdem Sie die Anwendung in der Entwicklungsumgebung √ºberpr√ºft haben, k√∂nnen Sie die Anwendung stoppen, indem Sie die Anzahl der im Cluster ausgef√ºhrten Jobs auf Null setzen. <br><br>  Wenn Ihnen der Artikel gefallen hat und Sie Verbesserungsvorschl√§ge haben, schreiben Sie in die Kommentare. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458648/">https://habr.com/ru/post/de458648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458636/index.html">Videob√§nder von mitap DevLeads aus dem B√ºro von Tutu.ru.</a></li>
<li><a href="../de458638/index.html">Intel oneAPI Project: viele Architekturen, eine API</a></li>
<li><a href="../de458640/index.html">Einen langen Strich finden</a></li>
<li><a href="../de458642/index.html">Theorie statt Heuristik: Als Frontend-Entwickler besser werden</a></li>
<li><a href="../de458646/index.html">Atomic Swaps auf den Punkt gebracht</a></li>
<li><a href="../de458650/index.html">Cyber ‚Äã‚ÄãChallenge. Ein neues Level. Online-Wettbewerb von Rostelecom Solar</a></li>
<li><a href="../de458652/index.html">RamblerFront & Meetup # 7</a></li>
<li><a href="../de458654/index.html">Das Lurk-Virus hat Banken gehackt, w√§hrend es von gew√∂hnlichen Angestellten geschrieben wurde</a></li>
<li><a href="../de458658/index.html">Wechsel von virtuellen Maschinen zu LXC-Containern: Gr√ºnde, Vorteile und gebrauchsfertige Anweisungen</a></li>
<li><a href="../de458660/index.html">Nicht erfolgreiche Softwarebereitstellung st√ºrzt Cloudflare-Dienst ab</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>