<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äç‚öñÔ∏è üö¨ üë®üèº‚Äçüöí Toda la verdad sobre RTOS de Colin Walls. Art√≠culo # 4. Tareas, cambio de contexto e interrupciones üë©üèΩ‚Äç‚öñÔ∏è üë©üèæ‚Äçüé§ ‚úÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Identificadores de tareas 
 Debe poder identificar cada tarea en el sistema. Este requisito es importante para otros objetos del n√∫cleo, pero hay algu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toda la verdad sobre RTOS de Colin Walls. Art√≠culo # 4. Tareas, cambio de contexto e interrupciones</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415427/"><h3>  Identificadores de tareas </h3><br>  Debe poder identificar cada tarea en el sistema.  Este requisito es importante para otros objetos del n√∫cleo, pero hay algunos matices en las tareas que corresponden al tema de este art√≠culo. <br><br><img src="https://habrastorage.org/webt/6z/dy/vz/6zdyvzfbp4usza-socgerc4y5se.jpeg"><br><br>  Los desarrolladores de RTOS utilizan diferentes enfoques para identificar tareas, pero se pueden distinguir cuatro estrategias generales: <br><br><ul><li> La tarea se identifica utilizando un puntero a su "bloque de control".  Los punteros son siempre √∫nicos y tambi√©n convenientes de usar, ya que se requiere acceso a la unidad de control para muchas llamadas API.  Esto implica que todos los datos de la tarea se almacenan en la memoria de acceso aleatorio (RAM), lo que puede ser ineficiente.  Un puntero normalmente ocupa unos 32 bits de memoria. </li><li>  Se puede definir una tarea utilizando un "n√∫mero de √≠ndice" arbitrario.  Este valor puede ser √∫til cuando se otorga acceso a registros en ciertas tablas.  Tal identificador puede ocupar ocho o menos bits de memoria, dependiendo de las limitaciones en el n√∫mero de tareas que admite el RTOS. </li><li>  Algunos RTOS permiten solo una tarea por nivel de prioridad y, por lo tanto, utilizan la prioridad para identificar de forma exclusiva una tarea.  Esto significa que la prioridad de la tarea no se puede cambiar.  Este enfoque es una variaci√≥n del enfoque anterior. </li><li>  Las tareas pueden tener nombres que son cadenas de caracteres.  Esto puede ser √∫til para la depuraci√≥n, pero es poco probable que sea un medio efectivo para identificar una tarea de manera √∫nica.  Los RTOS que admiten la asignaci√≥n de nombres de tareas generalmente tienen un identificador adicional (como un puntero) que usan las llamadas API, etc.  un buen depurador le permite llamarlos localmente en el host. </li></ul><a name="habracut"></a><br>  Art√≠culos anteriores de la serie: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tareas y planificaci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RTOS: estructura y modo en tiempo real</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RTOS: introducci√≥n.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><br></a> <br><h3>  <b>Cambio de contexto</b> </h3><br>  El cambio de contexto es el proceso de transferir el control de una tarea a otra.  Vale la pena explorar este tema m√°s de cerca, ya que el funcionamiento del cambio de contexto es un principio fundamental del RTOS. <br><br><h3>  <b>¬øQu√© es una tarea?</b> </h3><br>  Sabemos que una tarea es un programa casi independiente que comparte el tiempo del procesador con otras tareas bajo el control de RTOS.  Pero debes pensar en lo que realmente caracteriza la tarea. <br><br><h3>  <b>Conjunto de registro</b> </h3><br>  Una tarea es, en √∫ltima instancia, un conjunto √∫nico de valores de registro del procesador.  Se cargan en los registros del procesador (es decir, la tarea es actual) o se almacenan en alg√∫n lugar hasta el tiempo de ejecuci√≥n programado.  En un mundo ideal, un procesador central tendr√≠a varios conjuntos de registros, y cada uno podr√≠a asignarse a una tarea separada.  Esto se ha implementado para ocasiones especiales.  Hace muchos a√±os, la serie TI 9900 de Texas Instruments ten√≠a muchos conjuntos de registros para cada trabajo, pero se implementaron en la memoria principal, lo que limit√≥ el rendimiento.  La arquitectura SPARC (utilizada anteriormente en los sistemas de escritorio Unix) admite muchos conjuntos de registros en la "estructura de anillo", pero el n√∫mero de conjuntos sigue siendo limitado. <br><br><h3>  <b>Datos internos</b> </h3><br>  La tarea probablemente tendr√° su propia pila, cuyo tama√±o se puede establecer por separado para cada tarea o puede ser un par√°metro global para todas las tareas en el sistema.  Esto, junto con los registros, proporciona almacenamiento de datos para tareas espec√≠ficas.  Puede haber otras √°reas de memoria para almacenar datos para una tarea espec√≠fica. <br><br><h3>  <b>Recursos compartidos</b> </h3><br>  Pr√°cticamente cualquier recurso se puede compartir entre tareas.  El c√≥digo puede ser general: ciertas funciones o el c√≥digo completo de la tarea.  Es necesario asegurarse de que el c√≥digo sea reentrante, en primer lugar, no se deben usar variables est√°ticas (especificadas como est√°ticas o simplemente fuera de la funci√≥n).  Tenga cuidado con los m√≥dulos de biblioteca est√°ndar que no est√°n destinados para uso incorporado;  Por lo general, tienen muchas funciones poco confiables. <br><br>  Tambi√©n es posible compartir datos, pero es necesario un control de acceso cuidadoso.  Idealmente, solo una tarea es el "propietario" de los datos en un momento dado. <br><br><h3>  <b>C√≥mo mantener el contexto</b> </h3><br>  Cuando se reprograma una tarea (es decir, deja de ser actual), su conjunto de registros debe guardarse en alg√∫n lugar.  Hay al menos dos posibilidades: <br><br><ul><li>  Los registros se pueden almacenar en una tabla especial para tareas.  Puede ser parte de un bloque de control de tareas (TCB).  El tama√±o es un valor predecible y constante (para una arquitectura de CPU espec√≠fica). </li><li>  Los registros se pueden insertar en la pila de tareas.  Esto requiere la asignaci√≥n de suficiente espacio de pila adicional y el almacenamiento del puntero (posiblemente en el TCB). </li></ul><br>  La elecci√≥n del mecanismo depende de las caracter√≠sticas de un RTOS particular y del procesador de destino.  Algunos dispositivos (generalmente de 32 bits) pueden acceder a la pila de manera eficiente;  el resto (por ejemplo, 8 bits) puede ser m√°s √≥ptimo cuando se trabaja con tablas. <br><br><h3>  <b>Creaci√≥n din√°mica de tareas</b> </h3><br>  El aspecto principal de la arquitectura RTOS es que el RTOS es "est√°tico" o "din√°mico". <br><br>  Cuando se utiliza un RTOS est√°tico, todo se determina durante la compilaci√≥n de la aplicaci√≥n, en particular, el n√∫mero de tareas en el sistema.  Esta es una soluci√≥n l√≥gica para aplicaciones integradas, que generalmente tienen una funcionalidad limitada. <br><br>  Dynamic RTOS lanza una tarea (que puede ser una tarea "principal" especializada), y tambi√©n crea y elimina otras tareas seg√∫n sea necesario.  Esto permite que el sistema se adapte a los requisitos cambiantes y es un an√°logo m√°s cercano del sistema de escritorio, que se comporta de esta manera.  La vista est√°tica / din√°mica tambi√©n se aplica a otros objetos del n√∫cleo. <br><br><h3>  <b>Requisito de creaci√≥n din√°mica de tareas</b> </h3><br>  Esta caracter√≠stica est√° incluida en la mayor√≠a de los RTOS comerciales.  Sin embargo, solo una peque√±a parte de las aplicaciones realmente necesita un modo din√°mico de operaci√≥n.  Muy a menudo, el sistema se inicia, crea todas las tareas necesarias (y otros objetos) y luego nunca crea y destruye el c√≥digo de la aplicaci√≥n.  La capacidad de crear tareas din√°micas se ha convertido en una formalidad.  Un proveedor lo present√≥, todos los dem√°s hicieron lo mismo. <br><br>  Cabe destacar que el est√°ndar OSEK / VDX requiere una arquitectura est√°tica, aunque esto puede aplicarse a aplicaciones bastante complejas.  El resultado de estos requisitos es la incapacidad de implementar OSEK / VDX con un envoltorio, una capa intermedia sobre un RTOS regular (din√°mico). <br><br><h3>  <b>Errores de la creaci√≥n din√°mica de tareas</b> </h3><br>  Hay varios problemas con el modo din√°mico de operaci√≥n que pueden ser problem√°ticos. <br><br>  Primero, el sistema se vuelve m√°s complejo, lo que significa que para las estructuras de datos que describen tareas (TCB), se necesita informaci√≥n adicional.  Como regla general, se implementan en forma de listas bidireccionales, lo que genera costos asociados con la cantidad de memoria. <br>  Todos los datos que describen la tarea deben almacenarse en la RAM.  Esto es ineficiente, ya que la mayor√≠a de ellos pueden ser simplemente elementos de datos persistentes copiados de la ROM.  Adem√°s, en los procesadores de un nivel inferior (microcontroladores) puede que no obtenga RAM. <br><br>  Probablemente lo m√°s preocupante es la posibilidad de una escasez impredecible de recursos, que puede conducir a la incapacidad de crear nuevos objetos.  Dado que la esencia de un sistema en tiempo real es su previsibilidad, esto es inaceptable.  Por lo tanto, se debe tener cuidado al usar la creaci√≥n de tareas din√°micas (y otros objetos). <br><br><h3>  <b>Interrupciones</b> </h3><br>  Es posible que se pueda implementar un sistema embebido en tiempo real sin el uso de interrupciones, pero esto no es t√≠pico. <br><br><h3>  <b>Interrupciones y Kernel</b> </h3><br>  Cuando se usa RTOS, un controlador de interrupciones (ISR) se hace lo m√°s f√°cil posible para "robar" la cantidad m√≠nima de tiempo de procesador de las tareas programadas.  A menudo, un dispositivo puede ser simplemente reparado, y cualquier tarea requerida ser√° puesta en cola para su procesamiento.  Adem√°s, es dif√≠cil hablar en general sobre las interrupciones y su interacci√≥n con los n√∫cleos, simplemente porque var√≠an mucho.  Por un lado, el desarrollador de RTOS puede garantizar que las interrupciones no se relacionen con el n√∫cleo, y el programador tendr√° que asegurarse de que el programador de tareas no est√© sobrecargado, utilizando mucho tiempo de procesador en el ISR.  Por otro lado, el RTOS puede controlar completamente todo el subsistema de interrupci√≥n.  Ninguno de los enfoques descritos es correcto o incorrecto, simplemente son diferentes. <br><br><h3>  <b>Guardar contexto</b> </h3><br>  Los ISR siempre necesitan mantener un "contexto" para que el c√≥digo interrumpible no se vea afectado por los c√°lculos de ISR.  En un sistema implementado sin un RTOS, es simplemente una cuesti√≥n de guardar los registros utilizados por el ISR (generalmente en la pila) y restaurarlos antes de regresar.  Algunos procesadores tienen una pila ISR dedicada, mientras que otros simplemente usan la misma pila que el c√≥digo de la aplicaci√≥n. <br><br>  Cuando se usa RTOS, el enfoque puede ser exactamente el mismo.  Del mismo modo, la pila utilizada por el ISR puede ser "prestada" de la tarea actual, o puede ser otra pila asignada para interrupciones.  Algunos n√∫cleos implementan esta caracter√≠stica, incluso si el procesador en s√≠ no admite la pila de interrupciones.  La situaci√≥n se complica si el ISR realiza una llamada a la API que afecta al programador de tareas.  Esto puede hacer que la interrupci√≥n regrese a otra tarea desde la que se inici√≥ cuando ocurri√≥ la interrupci√≥n. <br><br><h3>  <b>Interrupciones y Programador</b> </h3><br>  Hay varias circunstancias en las que el c√≥digo de ejecuci√≥n ISR puede volver a otra tarea: <br><br><ul><li>  ISR puede asignar una prioridad m√°s alta a una tarea ya completada, en lugar de la actual, si se utiliza el programador de tareas prioritarias. </li><li>  ISR puede pausar la tarea actual. </li><li>  Usando el Programador de intervalos de tiempo (TS), el controlador de interrupci√≥n del temporizador del sistema controlar√° los intervalos de tiempo y puede llamar al programador si es necesario. </li></ul><br><h3>  <b>Temporizador de reloj (Tick Clock)</b> </h3><br>  En los sistemas embebidos, a menudo se encuentra el uso de un "temporizador de reloj" peri√≥dico (intervalo de tiempo).  En algunos RTOS, es un componente requerido.  Por lo general, la presencia de un temporizador de reloj es opcional, y su ausencia simplemente impide la disponibilidad de ciertos servicios.  El controlador de interrupci√≥n del temporizador generalmente proporciona cuatro funciones: <br><br><ul><li>  Si se utiliza un programador de intervalos de tiempo, el controlador de interrupci√≥n del temporizador controlar√° el contador de tiempo y programar√° una nueva tarea cada vez que se agote el tiempo. </li><li>  Proporciona soporte de tiempo del sistema.  Esta es principalmente una variable de 32 bits que se incrementa con un temporizador y puede ser predefinida o solicitada por tareas. </li><li>  Si el RTOS proporciona aplicaciones con temporizadores, entonces ser√° compatible con un controlador de interrupci√≥n de temporizador que ser√° responsable de la caducidad y la reprogramaci√≥n. </li><li>  Si el RTOS admite tiempos de espera en el bloqueo de llamadas a la API o las tareas pueden estar en estado de suspensi√≥n, el controlador de interrupci√≥n del temporizador admitir√° estos intervalos de tiempo. </li></ul><br>  <i>Cuando trabajamos en nuestro propio sistema operativo OSRV MAX en tiempo real (art√≠culos publicados anteriormente sobre √©l), nuestro equipo "encontr√≥" el blog de Colin Walls, un experto en microelectr√≥nica y firmware en Mentor Graphics.</i>  <i>Los art√≠culos parec√≠an interesantes, los tradujeron por s√≠ mismos, pero para no "escribir en la mesa" decidieron publicar.</i>  <i>Espero que tambi√©n te sean √∫tiles.</i>  <i>Si es as√≠, entonces planeamos publicar todos los art√≠culos traducidos en la serie.</i> <i><br><br></i>  <i>Sobre el autor: Colin Walls ha trabajado en la industria electr√≥nica durante m√°s de treinta a√±os, dedicando la mayor parte de su tiempo al firmware.</i>  <i>Ahora es ingeniero de firmware en Mentor Embedded (una divisi√≥n de Mentor Graphics).</i>  <i>Colin Walls a menudo habla en conferencias y seminarios, autor de numerosos art√≠culos t√©cnicos y dos libros sobre firmware.</i>  <i>Vive en el Reino Unido.</i>  <i>Blog profesional de Colin: blogs.mentor.com/colinwalls, correo electr√≥nico: colin_walls@mentor.com</i> <i><br></i> <br>  Lea los art√≠culos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primero, segundo</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tercero</a> de la serie publicada anteriormente. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es415427/">https://habr.com/ru/post/es415427/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es415413/index.html">Funcionalidad cruzada, administrador de dependencias, monitoreo en iOS y pruebas de IU. ¬øC√≥mo fue la edici√≥n de verano de Avito iOS?</a></li>
<li><a href="../es415415/index.html">Anuncio de una conferencia de hackathon sobre el desarrollo de juegos en la cadena de bloques GameNode</a></li>
<li><a href="../es415417/index.html">Revisi√≥n de tel√©fono inteligente ASUS ZenFone Max Pro (M1) ZB602KL</a></li>
<li><a href="../es415421/index.html">Te invitamos a Gravity Co-working Space para el √∫ltimo Torneo de Contrataci√≥n de la temporada.</a></li>
<li><a href="../es415423/index.html">Infraestructura de clave p√∫blica: Autoridad de certificaci√≥n basada en OpenSSL y SQLite3 Utility (Postcryptum)</a></li>
<li><a href="../es415429/index.html">Toda la verdad sobre RTOS de Colin Walls. Art√≠culo # 5. Interacci√≥n de tareas y sincronizaci√≥n</a></li>
<li><a href="../es415431/index.html">Anuncio de Hackathon SmartMail Hack 2: Llamada de datos</a></li>
<li><a href="../es415433/index.html">Gesti√≥n de lanzamientos de viviendas y servicios comunitarios de SIG: compartimos experiencia y luchamos con intuici√≥n</a></li>
<li><a href="../es415435/index.html">Desarrollo de tarjetas de interfaz en Soil Xilinx Zynq 7000 para grabaci√≥n de voz en formato anal√≥gico y digital</a></li>
<li><a href="../es415437/index.html">C√≥mo lanzar ML en prod: seis rastrillos que pisamos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>