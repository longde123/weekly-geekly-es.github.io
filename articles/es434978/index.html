<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëç ü§† üêØ Introduciendo HealthKit üî• üè´ üëí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo de HealthKit, aprender√° a solicitar permiso para acceder a los datos de HealthKit, as√≠ como a leer y escribir datos en el repositorio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Introduciendo HealthKit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434978/"> En este art√≠culo de HealthKit, aprender√° a solicitar permiso para acceder a los datos de HealthKit, as√≠ como a leer y escribir datos en el repositorio central de HealthKit.  El art√≠culo utiliza Swift 4, iOS 11, versi√≥n Xcode 9. <br><br>  <b>HealthKit</b> es una API que se introdujo en iOS 8. <i>HealthKit</i> sirve como el dep√≥sito central de todos los datos relacionados con la salud, lo que permite a los usuarios crear un perfil biol√≥gico y almacenar datos de entrenamiento. <br><br>  A medida que lea el art√≠culo de HealthKit, crear√° la aplicaci√≥n de seguimiento de capacitaci√≥n m√°s simple y aprender√°: <br><br><ul><li>  C√≥mo solicitar permiso y acceder a los datos de HealthKit </li><li>  C√≥mo leer datos de HealthKit y mostrarlos en un UITableView </li><li>  C√≥mo escribir datos en el repositorio central de HealthKit </li></ul><br>  ¬øListo para comenzar con HealthKit?  Sigue leyendo! <br><a name="habracut"></a><br>  <b>Nota:</b> <i>Para trabajar en este tutorial, necesitar√° una cuenta de desarrollador de iOS activa.</i>  <i>Sin esto, no puede habilitar la capacidad de HealthKit y obtener acceso al repositorio de HealthKit.</i> <br><br><h3>  Inicio </h3><br>  La aplicaci√≥n de inicio rastrea la quema de calor√≠as durante un programa de entrenamiento.  Para los conocedores de Hollywood y los socialites, deber√≠a ser obvio que estoy hablando de <b>Prancercise</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sp/rk/if/sprkif8aw8ng01gh-y4vrroags8.png" alt="Prancercise" width="764" height="430"></div><br>  <a href="">Descargue el proyecto de inicio y √°bralo en Xcode</a> . <br><br>  Compila y ejecuta la aplicaci√≥n.  Ver√° el "esqueleto" de la interfaz de usuario.  En los pr√≥ximos dos art√≠culos, agregar√° gradualmente funcionalidad para esta aplicaci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8f/68a/4a5/c8f68a4a5bea9dfc34c426606e443458.png" alt="imagen" width="281" height="500"></div><br><h3>  Asignando un equipo </h3><br>  <b>HealthKit</b> es un marco especial.  La aplicaci√≥n no podr√° usarla si no tiene una cuenta de desarrollador activa.  Despu√©s de tener una cuenta de desarrollador, puede asignar su equipo. <br><br>  Seleccione <b>PrancerciseTracker</b> en el Navegador de proyectos y luego seleccione el <b>objetivo PrancerciseTracker</b> .  Vaya a la pesta√±a <b>General</b> y haga clic en el campo <b>Equipo</b> . <br><br>  Seleccione el comando asociado con su cuenta de desarrollador: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/809/a3e/af2/809a3eaf2aa966919ed95ad1f8a4be38.png" alt="imagen" width="2020" height="752"></div><br><h3>  Permisos / Derechos </h3><br>  HealthKit tambi√©n tiene su propio conjunto de derechos, y deber√° habilitarlos para crear aplicaciones que usen el marco. <br><br>  Abra la pesta√±a <b>Capacidades</b> en el editor de destino y habilite <b>HealthKit</b> , como se muestra en la siguiente captura de pantalla: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dce/374/42e/dce37442eebca83d0e6e480113dcd3fc.png" alt="imagen"><br><br>  Espere a que Xcode configure HealthKit por usted.  Como regla, no hay problemas aqu√≠, pero a√∫n puede encontrar algunos si olvida especificar correctamente el Identificador de equipo y de paquete. <br><br>  Ahora todo est√° listo.  Solo necesita pedirle al usuario permiso para usar HealthKit. <br><br><h3>  Permisos </h3><br>  HealthKit trabaja con datos confidenciales y confidenciales.  No todos se sienten tan c√≥modos como para permitir que las aplicaciones instaladas accedan a esta informaci√≥n. <br><br>  Es por eso que HealthKit tiene un fuerte sistema de privacidad.  HealthKit solo tiene acceso a los datos que los usuarios aceptan compartir.  Para crear un perfil para los usuarios de su Prancercise Tracker, primero debe obtener permiso para acceder a cada tipo de datos. <br><br><h3>  Uso Descripci√≥n Actualizaci√≥n </h3><br>  Primero, debe describir por qu√© est√° solicitando indicadores de salud a sus usuarios.  <b>Xcode</b> le permite especificar esto en el archivo <b>Info.plist de</b> su aplicaci√≥n. <br><br>  Abrir <b>Info.plist</b> .  Luego agregue las siguientes claves: <br>  <b>Privacidad</b> - <b>Descripci√≥n del uso de Health Share</b> <br>  <b>Privacidad</b> : <b>descripci√≥n del uso de la actualizaci√≥n de estado</b> <br><br>  Estas teclas almacenan el texto que se mostrar√° cuando aparezca la pantalla de inicio de sesi√≥n de HeathKit.  <b>La Descripci√≥n del uso de Health Share se</b> refiere a la secci√≥n de datos que debe leerse de HealthKit.  <b>La Descripci√≥n del uso de la actualizaci√≥n de estado</b> corresponde a los datos que se escriben en HealthKit. <br><br>  Puedes "agregar" todo lo que quieras all√≠.  Esta suele ser una descripci√≥n: "Utilizaremos su informaci√≥n de salud para realizar un mejor seguimiento de sus entrenamientos". <br><br>  Tenga en cuenta que si estas claves no est√°n instaladas, la aplicaci√≥n se bloquear√° cuando intente iniciar sesi√≥n en HealthKit. <br><br><h3>  Autorizaci√≥n de HealthKit </h3><br>  Abra el archivo <i>HealthKitSetupAssistant.swift</i> dentro del cual se encuentra el m√©todo de clase que utilizar√° para autorizar en HealthKit. <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">authorizeHealthKit</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completion</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">escaping</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bool</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class">?) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Swift</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">) </span></span>{ }</code> </pre> <br>  El m√©todo authorizeHealthKit (finalizaci√≥n :) no toma par√°metros y tiene un <b>complemento</b> que devuelve un valor booleano ( <b>√©xito</b> o <b>error</b> ) y un error opcional en caso de que algo salga mal.  Si se devuelven errores, los pasar√° a completar en dos casos: <br><br><ol><li>  HealthKit puede no estar disponible en su dispositivo.  Por ejemplo, si la aplicaci√≥n se ejecuta en un iPad. </li><li>  Es posible que algunos tipos de datos no est√©n disponibles en la versi√≥n actual de HealthKit. </li></ol><br>  Rompamos este proceso.  Para autorizar HealthKit, el m√©todo <i>authorizeHealthKit (complete :)</i> debe completar los siguientes cuatro pasos: <br><br><ol><li>  Compruebe si Healthkit est√° disponible en este dispositivo.  Si este no es el caso, devuelva una falla y un error para completar. </li><li>  Preparar tipos de datos de salud.  Prancercise Tracker leer√° y escribir√° en HealthKit. </li><li>  Organice estos datos en una lista de tipos para leer y tipos para escribir. </li><li>  Solicitar autorizaci√≥n.  Si esta acci√≥n es exitosa, entonces todas las actividades fueron correctas y se completaron correctamente. </li></ol><br><h3>  Comprobaci√≥n de disponibilidad de HealthKit </h3><br>  En primer lugar, debe verificar la disponibilidad de HealthKit en el dispositivo. <br>  Pegue el siguiente c√≥digo al comienzo del m√©todo <i>authorizeHealthKit (finalizaci√≥n :)</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//1. ,      HealthKit guard HKHealthStore.isHealthDataAvailable() else { completion(false, HealthkitSetupError.notAvailableOnDevice) return }</span></span></code> </pre><br>  Interactuar√° con <b>HKHealthStore</b> muy a menudo.  Es un repositorio central que almacena datos de salud del usuario.  El m√©todo <i>isHealthDataAvailable ()</i> lo ayudar√° a comprender si el dispositivo de usuario actual admite datos de Heathkit. <br><br>  La declaraci√≥n de protecci√≥n evita que la aplicaci√≥n ejecute el resto del m√©todo <i>authorizeHealthKit (finalizaci√≥n :)</i> si HealthKit no est√° disponible en el dispositivo.  Cuando esto sucede, se <b>llama al</b> bloque de finalizaci√≥n con el error <b>notAvailableOnDevice</b> .  Simplemente puede enviar esto a la consola o al controlador principal para procesar pasos adicionales en caso de tal error. <br><br><h3>  Preparaci√≥n de datos </h3><br>  Una vez que sepa que HealthKit est√° disponible en el dispositivo del usuario, es hora de preparar los tipos de datos que se leer√°n y escribir√°n en HealthKit. <br>  HealthKit funciona con el tipo <b>HKObjectType</b> .  Cada tipo que ingresa o regresa al repositorio central de HealthKit es un tipo de <b>HKObjectType</b> .  Tambi√©n ver√° HKSampleType y <b>HKWorkoutType</b> .  Ambos heredan de <b>HKObjectType</b> , as√≠ que b√°sicamente esto es lo mismo. <br><br>  Pegue el siguiente fragmento de c√≥digo inmediatamente despu√©s del primer fragmento de c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//2.   ,     HealthKit guard let dateOfBirth = HKObjectType.characteristicType(forIdentifier: .dateOfBirth), let bloodType = HKObjectType.characteristicType(forIdentifier: .bloodType), let biologicalSex = HKObjectType.characteristicType(forIdentifier: .biologicalSex), let bodyMassIndex = HKObjectType.quantityType(forIdentifier: .bodyMassIndex), let height = HKObjectType.quantityType(forIdentifier: .height), let bodyMass = HKObjectType.quantityType(forIdentifier: .bodyMass), let activeEnergy = HKObjectType.quantityType(forIdentifier: .activeEnergyBurned) else { completion(false, HealthkitSetupError.dataTypeNotAvailable) return }</span></span></code> </pre><br>  Wow, esta es una gran <b>guardia</b> !  Este tambi√©n es un gran ejemplo del uso de un solo protector para recuperar m√∫ltiples opciones. <br><br>  Para crear un <b>HKObjectType</b> para estas caracter√≠sticas, debe usar <i>HKObjectType.characteristicType (forIdentifier :)</i> o <i>HKObjectType.quantityType (forIdentifier :)</i> <br>  Los tipos de caracter√≠sticas y los tipos de cantidad son enumeraciones definidas por el marco.  HealthKit arranca con ellos. <br><br>  Tambi√©n notar√° que si una caracter√≠stica o tipo de selecci√≥n no est√° disponible, el m√©todo fallar√°.  Esto es intencional  Su aplicaci√≥n siempre debe saber exactamente con qu√© tipos de HealthKit puede funcionar, si corresponde. <br><br><h3>  Preparar una lista de tipos de datos para leer y escribir </h3><br>  Ahora es el momento de preparar una lista de tipos de datos para leer y escribir. <br>  Pegue este tercer c√≥digo en el m√©todo <i>authorizeHealthKit (finalizaci√≥n :)</i> inmediatamente despu√©s de la segunda parte: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//3.   ,  HealthKit     let healthKitTypesToWrite: Set&lt;HKSampleType&gt; = [bodyMassIndex, activeEnergy, HKObjectType.workoutType()] let healthKitTypesToRead: Set&lt;HKObjectType&gt; = [dateOfBirth, bloodType, biologicalSex, bodyMassIndex, height, bodyMass, HKObjectType.workoutType()]</span></span></code> </pre><br>  HealthKit espera un conjunto de objetos <b>HKSampleType</b> que representan los tipos de datos que su usuario puede escribir, y tambi√©n espera que se muestre un conjunto de objetos HKObjectType para su aplicaci√≥n. <br><br>  <b>HKObjectType.workoutType ()</b> es un tipo especial de <b>HKObjectType</b> .  Es cualquier entrenamiento. <br><br><h3>  Autorizaci√≥n de HealthKit </h3><br>  La √∫ltima parte es la m√°s f√°cil.  Solo necesita solicitar autorizaci√≥n de HealthKit.  Pegue este √∫ltimo c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//4.    HKHealthStore().requestAuthorization(toShare: healthKitTypesToWrite, read: healthKitTypesToRead) { (success, error) in completion(success, error) }</span></span></code> </pre><br>  Este c√≥digo solicita autorizaci√≥n de HealthKit y luego llama a la finalizaci√≥n.  Utilizan variables para operaciones exitosas y errores pasados ‚Äã‚Äãdel m√©todo <i>requestAuthorization (toShare: read: complete :) de HKHealthStore</i> . <br><br>  Puedes pensarlo como una redirecci√≥n.  En lugar de manejar la finalizaci√≥n dentro de HealthKitSetupAssistant, pasa el paquete al controlador principal, que puede mostrar una advertencia o tomar alguna otra medida. <br><br>  El proyecto ya tiene un bot√≥n Authorize HealthKit y llama al m√©todo <i>authorizeHealthKit ()</i> en MasterViewController.  Este es el lugar perfecto para llamar al m√©todo de autorizaci√≥n que acabamos de escribir. <br><br>  Abra <b>MasterViewController.swift</b> , busque el m√©todo <i>authorizeHealthKit (</i> ) y pegue este c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">HealthKitSetupAssistant</span></span>.authorizeHealthKit { (authorized, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> authorized <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> baseMessage = <span class="hljs-string"><span class="hljs-string">"HealthKit Authorization Failed"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(baseMessage). Reason: \(error.localizedDescription)"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(baseMessage) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"HealthKit Successfully Authorized."</span></span>) }</code> </pre><br>  Este c√≥digo utiliza el m√©todo <i>authorizeHealthKit (finalizaci√≥n :)</i> que acaba de implementar.  Cuando se complete, mostrar√° un mensaje en la consola para indicar si la autorizaci√≥n se realiz√≥ correctamente en HealthKit. <br><br>  Inicia la aplicaci√≥n.  Haga clic en Autorizar HealthKit en la ventana principal y ver√° una pantalla de autorizaci√≥n emergente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ef/2bc/500/4ef2bc50015fda69b7d916b9231a5f1a.png" alt="imagen" width="281" height="500"></div><br>  Active todos los interruptores, despl√°cese para verlos todos y presione <b>Permitir</b> .  En la consola, deber√≠a ver un mensaje como este: <br><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">HealthKit</span></span> <span class="hljs-type"><span class="hljs-type">Successfully</span></span> <span class="hljs-type"><span class="hljs-type">Authorized</span></span>.</code> </pre><br>  <b>Genial</b>  La aplicaci√≥n tiene acceso al repositorio central de HealthKit.  Ahora es el momento de comenzar a rastrear elementos. <br><br><h3>  Caracter√≠sticas y muestras </h3><br>  En esta secci√≥n aprender√°s: <br><br><ul><li>  C√≥mo leer las caracter√≠sticas biol√≥gicas de tu usuario. </li><li>  C√≥mo leer y escribir diferentes tipos de muestras (peso, altura, etc.) </li></ul><br>  Las caracter√≠sticas biol√≥gicas, como regla, son tipos de elementos que no cambian, al igual que su tipo de sangre.  Las muestras son elementos que cambian con frecuencia, como el peso. <br><br>  Para realizar un seguimiento adecuado de la efectividad del <b>modo de</b> entrenamiento <b>Prancercise</b> , la aplicaci√≥n <b>Prancercise Tracker</b> debe recibir una muestra del peso y la altura del usuario.  Juntas, estas muestras se pueden usar para calcular el √≠ndice de masa corporal (IMC). <br><br>  <b>Nota:</b> <i>El √≠ndice de masa corporal (IMC) es un indicador ampliamente utilizado de la grasa corporal y se calcula en funci√≥n del peso y la altura de una persona.</i>  <i>Obtenga m√°s informaci√≥n al respecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .</i> <br><br><h3>  Especificaciones de lectura </h3><br>  Prancercise Tracker no registra caracter√≠sticas biol√≥gicas.  Los obtiene de HealthKit.  Esto significa que estas caracter√≠sticas deben almacenarse primero en el repositorio central de HeathKit. <br><br>  Si a√∫n no lo ha hecho, es hora de contarle a <b>HeathKit un</b> poco m√°s sobre usted. <br><br>  Abra la aplicaci√≥n Health en su dispositivo o simulador.  Seleccione la pesta√±a Datos de salud.  Luego haga clic en el icono de perfil en la esquina superior derecha para ver su perfil de salud.  Haga clic en <b>Editar</b> e ingrese la fecha de nacimiento, g√©nero, tipo de sangre: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/324/285/ea4/324285ea449bb8049ff166c1e83ec76f.png" alt="imagen" width="1732" height="1540"></div><br>  Ahora que <b>HealthKit</b> conoce su fecha de nacimiento, sexo y tipo de sangre, es hora de leer estas caracter√≠sticas en <b>Prancercise Tracker</b> . <br><br>  Regrese a <b>Xcode</b> y abra <i>ProfileDataStore.swift</i> .  La clase <b>ProfileDataStore</b> representa su punto de acceso a todos los datos relacionados con la salud de sus usuarios. <br><br>  Pegue el siguiente m√©todo en <b>ProfileDataStore</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getAgeSexAndBloodType</span></span></span><span class="hljs-class">() </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">throws</span></span></span><span class="hljs-class"> -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">age</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">biologicalSex</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKBiologicalSex</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bloodType</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKBloodType</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> healthKitStore = <span class="hljs-type"><span class="hljs-type">HKHealthStore</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-comment"><span class="hljs-comment">//1. This method throws an error if these data are not available. let birthdayComponents = try healthKitStore.dateOfBirthComponents() let biologicalSex = try healthKitStore.biologicalSex() let bloodType = try healthKitStore.bloodType() //2. Use Calendar to calculate age. let today = Date() let calendar = Calendar.current let todayDateComponents = calendar.dateComponents([.year], from: today) let thisYear = todayDateComponents.year! let age = thisYear - birthdayComponents.year! //3. Unwrap the wrappers to get the underlying enum values. let unwrappedBiologicalSex = biologicalSex.biologicalSex let unwrappedBloodType = bloodType.bloodType return (age, unwrappedBiologicalSex, unwrappedBloodType) } }</span></span></code> </pre><br>  El m√©todo <i>getAgeSexAndBloodType ()</i> llama a <b>HKHealthStore</b> , solicitando la fecha de nacimiento, el g√©nero y el tipo de sangre del usuario.  Tambi√©n calcula la edad del usuario utilizando la fecha de nacimiento. <br><br><ol><li>  Es posible que haya notado que este m√©todo puede causar un error.  Esto sucede cuando una fecha de nacimiento, sexo o tipo de sangre no se ha almacenado en el repositorio central de HealthKit.  Como acaba de ingresar esta informaci√≥n en su aplicaci√≥n, no debe causar errores. </li><li>  Usando la clase <b>Calendario</b> , puede convertir cualquier fecha en un conjunto de <b>Componentes</b> de <b>fecha</b> .  Esto es realmente conveniente cuando desea obtener un a√±o para una cita.  Este c√≥digo solo obtiene su a√±o de nacimiento, el a√±o actual y luego calcula la diferencia. </li><li>  Las variables "expandidas" se nombran de tal manera que est√° claro que necesita acceder a la enumeraci√≥n base desde la clase contenedora ( <b>HKBiologicalSexObject</b> y <b>HKBloodTypeObject</b> ). </li></ol><br><h3>  Actualizaci√≥n de la interfaz de usuario </h3><br>  Si ahora compila y ejecuta la aplicaci√≥n, no ver√° ning√∫n cambio en la interfaz de usuario, porque todav√≠a no le ha conectado esta l√≥gica. <br>  Abra <b>ProfileViewController.swif</b> t y busque el m√©todo <i>loadAndDisplayAgeSexAndBloodType (</i> ) <br><br>  Este m√©todo usar√° su <b>ProfileDataStore</b> para cargar caracter√≠sticas biol√≥gicas en la interfaz de usuario. <br><br>  Pegue el siguiente c√≥digo en el m√©todo <i>loadAndDisplayAgeSexAndBloodType ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> userAgeSexAndBloodType = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.getAgeSexAndBloodType() userHealthProfile.age = userAgeSexAndBloodType.age userHealthProfile.biologicalSex = userAgeSexAndBloodType.biologicalSex userHealthProfile.bloodType = userAgeSexAndBloodType.bloodType updateLabels() } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: error) }</code> </pre><br>  Este bloque de c√≥digo carga la edad, el g√©nero y el tipo de sangre como una tupla.  Luego establece estos campos en la instancia local del modelo UserHealthProfile.  Finalmente, actualiza la interfaz de usuario con los nuevos campos en <b>UserHealthProfile</b> llamando al m√©todo <i>updateLabels ()</i> . <br><br>  Dado que el <i>m√©todo</i> <b>ProfileDataStore</b> <i>getAgeSexAndBloodType ()</i> puede arrojar un error, <b>ProfileViewController</b> debe manejarlo.  En este caso, simplemente toma el error y lo presenta como una advertencia. <br><br>  Todo esto es genial, pero hay una trampa.  El m√©todo <i>updateLabels () no hace</i> nada todav√≠a.  Esto es solo un anuncio en blanco.  Esta vez, pasemos a la interfaz de usuario. <br><br>  Encuentre el m√©todo <i>updateLabels ()</i> y pegue este c√≥digo en √©l: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> age = userHealthProfile.age { ageLabel.text = <span class="hljs-string"><span class="hljs-string">"\(age)"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> biologicalSex = userHealthProfile.biologicalSex { biologicalSexLabel.text = biologicalSex.stringRepresentation } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bloodType = userHealthProfile.bloodType { bloodTypeLabel.text = bloodType.stringRepresentation }</code> </pre><br>  El c√≥digo es bastante simple.  Si el usuario ha establecido la edad, se formatear√° en una etiqueta.  Lo mismo ocurre con el sexo biol√≥gico y el tipo de sangre.  La variable stringRepresentation convierte la enumeraci√≥n en una cadena para fines de visualizaci√≥n. <br><br>  Compila y ejecuta la aplicaci√≥n.  Vaya a la pantalla Perfil e IMC.  Haga clic en el bot√≥n Leer datos de HealthKit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e13/3a5/ed1/e133a5ed1cd1d13016f28cc1a3452af9.png" alt="imagen" width="281" height="500"></div><br>  Si ya ingres√≥ su informaci√≥n en la aplicaci√≥n, deber√≠a aparecer en los accesos directos en esta pantalla.  Si no lo ha hecho, aparecer√° un mensaje de error. <br><br>  Wow!  Usted lee y muestra datos directamente desde <b>HealthKit</b> . <br><br><h3>  Consultar muestras </h3><br>  Ahora es el momento de leer el peso y la altura del usuario.  Se utilizar√°n para calcular y mostrar el IMC en la vista de perfil. <br><br>  Las caracter√≠sticas biol√≥gicas est√°n disponibles porque casi nunca cambian.  Las muestras requieren un enfoque mucho m√°s complejo.  Usan <b>HKQuery</b> , m√°s precisamente <b>HKSampleQuery</b> . <br><br>  Para solicitar muestras de HealthKit, necesitar√°: <br><br><ol><li>  Especifique el tipo de muestra que desea solicitar (peso, altura, etc.), </li><li>  Algunas opciones adicionales que ayudan a filtrar y ordenar datos.  Para hacer esto, puede pasar un <b>NSPredicate</b> opcional o una matriz de <b>NSSortDescriptors</b> . </li></ol><br>  <b>Nota:</b> <i>Si est√° familiarizado con CoreData, probablemente haya notado algunas similitudes.</i>  <i><b>HKSampleQuery es</b> muy similar a <b>NSFetchedRequest</b> para un tipo de objeto, donde especifica el predicado y los descriptores de clasificaci√≥n, y luego establece el contexto del objeto para ejecutar la consulta para obtener los resultados.</i> <br><br>  Una vez que su consulta est√° configurada, simplemente llame al <b>m√©todo HKHealthStore</b> <i>ExecuteQuery ()</i> para obtener los resultados. <br><br>  Para <b>Prancercise Tracker,</b> crear√° una funci√≥n √∫nica y universal que descarga las √∫ltimas muestras de cualquier tipo.  Por lo tanto, puede usarlo tanto para peso como para altura. <br><br>  Abra <b>ProfileDataStore.swift</b> y pegue el siguiente m√©todo en la clase, justo debajo del m√©todo <i>getAgeSexAndBloodType ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getMostRecentSample</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sampleType</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKSampleType</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completion</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">escaping</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKQuantitySample</span></span></span><span class="hljs-class">?, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class">?) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Swift</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1.  HKQuery    . let mostRecentPredicate = HKQuery.predicateForSamples(withStart: Date.distantPast, end: Date(), options: .strictEndDate) let sortDescriptor = NSSortDescriptor(key: HKSampleSortIdentifierStartDate, ascending: false) let limit = 1 let sampleQuery = HKSampleQuery(sampleType: sampleType, predicate: mostRecentPredicate, limit: limit, sortDescriptors: [sortDescriptor]) { (query, samples, error) in //2.       . DispatchQueue.main.async { guard let samples = samples, let mostRecentSample = samples.first as? HKQuantitySample else { completion(nil, error) return } completion(mostRecentSample, nil) } } HKHealthStore().execute(sampleQuery) }</span></span></code> </pre><br>  Este m√©todo usa el tipo de muestra (altura, peso, IMC, etc.).  Luego crea una consulta para recuperar la √∫ltima muestra para este tipo.  Si revisa el tipo de muestra de crecimiento, volver√° a su √∫ltimo registro de crecimiento. <br><br>  Est√°n pasando muchas cosas aqu√≠.  Me detendr√© para explicar algunas cosas. <br><br><ol><li>  Hay varios m√©todos en <b>HKQuery</b> que pueden ayudarlo a filtrar los ejemplos de consultas de HealthKit.  En este caso, usamos el predicado de fecha incorporado. </li><li>  Solicitar muestras de HealthKit es un proceso asincr√≥nico.  Es por eso que el c√≥digo en el controlador de finalizaci√≥n se produce dentro del bloque Dispatch.  Se requiere cumplimiento en el hilo principal.  Si no lo hace, la aplicaci√≥n fallar√°. </li></ol><br>  Si todo va bien, su solicitud se ejecutar√° y obtendr√° una muestra ordenada devuelta en el hilo <b>principal</b> , donde <b>ProfileViewController</b> puede poner su contenido en la etiqueta.  Hagamos esta parte ahora. <br><br><h3>  Mostrar muestras en la interfaz de usuario </h3><br>  En la secci√≥n anterior, descarg√≥ datos de <b>HealthKit</b> .  <b>Gu√°rdelos</b> como modelo en <b>ProfileViewController</b> y luego actualice el contenido en filas con el <b>m√©todo ProfileViewController</b> <i>updateLabels ()</i> <br><br>  Todo lo que tiene que hacer es expandir este proceso agregando una funci√≥n que carga las muestras, las procesa para la interfaz de usuario y luego llama a <i>updateLabels ()</i> para llenar las etiquetas con texto. <br><br>  Abra el archivo <b>ProfileViewController.swift</b> , busque el m√©todo <i>loadAndDisplayMostRecentHeight (</i> ) y pegue el siguiente c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//1.  HealthKit      guard let heightSampleType = HKSampleType.quantityType(forIdentifier: .height) else { print("Height Sample Type is no longer available in HealthKit") return } ProfileDataStore.getMostRecentSample(for: heightSampleType) { (sample, error) in guard let sample = sample else { if let error = error { self.displayAlert(for: error) } return } //2.     ,   , //    . let heightInMeters = sample.quantity.doubleValue(for: HKUnit.meter()) self.userHealthProfile.heightInMeters = heightInMeters self.updateLabels() }</span></span></code> </pre><br><ol><li>  Este m√©todo comienza creando un tipo de muestra de crecimiento.  Luego pasa este tipo de muestra al m√©todo que acaba de escribir, que devolver√° la muestra de crecimiento de usuarios m√°s reciente registrada en HealthKit. </li><li>  Tan pronto como la muestra regrese, el crecimiento se convierte a metros y se almacena en el modelo de Perfil de usuario de salud.  Entonces la <b>IU</b> se actualizar√°. </li></ol><br>  <b>Nota:</b> <i>Por lo general, desea convertir una muestra de cantidad en una unidad est√°ndar.</i>  <i>Para hacer esto, el c√≥digo anterior usa el <i>m√©todo doubleValue (for :)</i> , que le permite <b>pasar los</b> datos relevantes que necesita (en este caso, metros) a <b>HKUnit</b> .</i> <i><br><br></i>  <i>Puede crear varios tipos de <b>HKUnits</b> utilizando algunos de los m√©todos de clase comunes disponibles a trav√©s de <b>HealthKit</b> .</i>  <i>Para obtener contadores, simplemente puede usar el m√©todo meter () en <b>HKUnit</b> , y eso ser√° lo que necesita.</i> <br><br>  Con el crecimiento resuelto.  ¬øQu√© tal el peso?  Todo es bastante similar, pero deber√° <i>completar el</i> m√©todo <i>loadAndDisplayMostRecentWeight ()</i> en <b>ProfileViewController</b> . <br><br>  Pegue el siguiente c√≥digo en el m√©todo <i>loadAndDisplayMostRecentWeight ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightSampleType = <span class="hljs-type"><span class="hljs-type">HKSampleType</span></span>.quantityType(forIdentifier: .bodyMass) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Body Mass Sample Type is no longer available in HealthKit"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.getMostRecentSample(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: weightSampleType) { (sample, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sample = sample <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: error) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightInKilograms = sample.quantity.doubleValue(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">HKUnit</span></span>.gramUnit(with: .kilo)) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.userHealthProfile.weightInKilograms = weightInKilograms <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updateLabels() }</code> </pre><br>  Cree el tipo de muestra que desea recibir, solicite <b>HealthKit</b> , realice algunas conversiones de unidades, gu√°rdelo en su modelo y actualice la interfaz de usuario. <br><br>  Por el momento, puede mostrar que el trabajo est√° hecho, pero hay algo m√°s.  La funci√≥n <i>updateLabels ()</i> no tiene conocimiento de los nuevos datos que ha puesto a su disposici√≥n. <br><br>  Vamos a arreglarlo <br><br>  Agregue las siguientes l√≠neas a la funci√≥n <i>updateLabels ()</i> , justo debajo de la parte donde expande el grupo sangu√≠neo para mostrarlo en la interfaz de usuario: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weight = userHealthProfile.weightInKilograms { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightFormatter = <span class="hljs-type"><span class="hljs-type">MassFormatter</span></span>() weightFormatter.isForPersonMassUse = <span class="hljs-literal"><span class="hljs-literal">true</span></span> weightLabel.text = weightFormatter.string(fromKilograms: weight) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height = userHealthProfile.heightInMeters { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> heightFormatter = <span class="hljs-type"><span class="hljs-type">LengthFormatter</span></span>() heightFormatter.isForPersonHeightUse = <span class="hljs-literal"><span class="hljs-literal">true</span></span> heightLabel.text = heightFormatter.string(fromMeters: height) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bodyMassIndex = userHealthProfile.bodyMassIndex { bodyMassIndexLabel.text = <span class="hljs-type"><span class="hljs-type">String</span></span>(format: <span class="hljs-string"><span class="hljs-string">"%.02f"</span></span>, bodyMassIndex) }</code> </pre><br>  Siguiendo la plantilla original en la funci√≥n <i>updateLabels ()</i> , expande la altura, el peso y el √≠ndice de masa corporal en su modelo <b>UserHealthProfile</b> .  Si est√°n disponibles, generan las l√≠neas apropiadas y las asignan a etiquetas en la pantalla del usuario. <br><br>  <b>MassFormatter</b> y <b>LengthFormatter</b> hacen el trabajo de convertir sus valores en cadenas. <br><br>  El √≠ndice de masa corporal no se almacena realmente en el modelo de <b>perfil de usuario de salud</b> .  Esta es una propiedad calculada que hace el c√°lculo por usted. <br><br>  Haga clic en la propiedad <b>bodyMassIndex</b> y ver√° lo que quiero decir: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bodyMassIndex: <span class="hljs-type"><span class="hljs-type">Double?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightInKilograms = weightInKilograms, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> heightInMeters = heightInMeters, heightInMeters &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (weightInKilograms/(heightInMeters*heightInMeters)) }</code> </pre><br>  El √≠ndice de masa corporal es una propiedad opcional, es decir, puede devolver nulo si no especific√≥ altura o peso (o si se establecen en alg√∫n n√∫mero que no tiene sentido).  El c√°lculo real es simplemente el peso dividido por la altura al cuadrado. <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pronto se sumergir√° en todo esto si no ha agregado datos a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para que la aplicaci√≥n los lea. Si a√∫n no lo ha hecho, debe crear muestras de altura y peso, al menos. </font></font></i> <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra la aplicaci√≥n Salud y vaya a la pesta√±a Datos de salud. All√≠, seleccione el par√°metro Mediciones del cuerpo, luego seleccione Peso y luego Agregar punto de datos para agregar una nueva muestra de peso. Repita el proceso para el crecimiento.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En este punto, el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prancercise Tracker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deber√≠a poder leer una muestra reciente del peso y la altura de su usuario, y luego mostrarla en el texto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compila y ejecuta las aplicaciones. Vaya a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfil e IMC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Luego haga clic en el bot√≥n </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leer datos de HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/d4d/35d/841d4d35d54528b5578fe32a3b163c0a.png" alt="imagen" width="281" height="500"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impresionante! </font><font style="vertical-align: inherit;">Acabas de leer tus primeras muestras del repositorio de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font><font style="vertical-align: inherit;">las </font><b><font style="vertical-align: inherit;">usaste</font></b><font style="vertical-align: inherit;"> para calcular el IMC.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Guardar muestras </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prancercise rastreador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ya tiene un √≠ndice de masa corporal calculadora a mano. </font><font style="vertical-align: inherit;">Us√©moslo para registrar la muestra de IMC de su usuario. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProfileDataStore.swift</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y agregue el siguiente m√©todo:</font></font><br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">saveBodyMassIndexSample</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bodyMassIndex</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Double</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1. ,      guard let bodyMassIndexType = HKQuantityType.quantityType(forIdentifier: .bodyMassIndex) else { fatalError("Body Mass Index Type is no longer available in HealthKit") } //2.   HKUnit     let bodyMassQuantity = HKQuantity(unit: HKUnit.count(), doubleValue: bodyMassIndex) let bodyMassIndexSample = HKQuantitySample(type: bodyMassIndexType, quantity: bodyMassQuantity, start: date, end: date) //3.      HealthKit HKHealthStore().save(bodyMassIndexSample) { (success, error) in if let error = error { print("Error Saving BMI Sample: \(error.localizedDescription)") } else { print("Successfully saved BMI Sample") } } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al igual que con otros tipos de muestra, primero debe asegurarse de que el tipo de muestra est√© disponible en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este caso, el c√≥digo verifica si existe un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipo de cantidad</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para el √≠ndice de masa corporal. </font><font style="vertical-align: inherit;">Si es as√≠, se usa para crear una muestra de cantidad. </font><font style="vertical-align: inherit;">Si no, la aplicaci√≥n deja de funcionar.</font></font></li><li>  <i>count()</i>  <b>HKUnit</b>    ,       ,   .  -      ,    ,           . </li><li> <b>HKHealthStore</b>     ,        .      ,        . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Casi terminado Para resumir la interfaz de usuario. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProfileViewController.swif</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , busque el m√©todo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saveBodyMassIndexToHealthKit (</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Se llama a este m√©todo cuando el usuario hace clic en el bot√≥n Guardar IMC en la tabla. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pegue el siguiente c√≥digo en el m√©todo:</font></font><br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bodyMassIndex = userHealthProfile.bodyMassIndex <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">ProfileDataError</span></span>.missingBodyMassIndex) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.saveBodyMassIndexSample(bodyMassIndex: bodyMassIndex, date: <span class="hljs-type"><span class="hljs-type">Date</span></span>())</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recuerde que el √≠ndice de masa corporal es una propiedad calculada que devuelve un valor cuando las muestras de altura y peso se cargan desde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este c√≥digo est√° tratando de calcular esta propiedad y, si es posible, se pasar√° al </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todo saveBodyMassIndexSample (bodyMassIndex: date :)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que acaba de escribir. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n muestra una alerta conveniente si el √≠ndice de masa corporal no puede calcularse por alg√∫n motivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compila y ejecuta la aplicaci√≥n. Vaya a la pantalla </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfil e IMC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Descargue datos de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HeathKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , luego haga clic en el bot√≥n Guardar IMC. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mira la consola Lo ves</font></font><br><br><pre> <code class="swift hljs">   <span class="hljs-type"><span class="hljs-type">BMI</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si es as√≠, ¬°felicidades! </font><font style="vertical-align: inherit;">Su muestra de IMC ahora est√° almacenada en el repositorio central de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A ver si podemos encontrarlo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra la aplicaci√≥n Salud, toque la pesta√±a Datos de salud, haga clic en Mediciones corporales en la vista de tabla y luego haga clic en √çndice de masa corporal.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/953/802/724/953802724c0ccad14b5184bd8b01b17f.png" alt="imagen" width="281" height="500"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es434978/">https://habr.com/ru/post/es434978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es434968/index.html">Algo sobre el espacio de nombres</a></li>
<li><a href="../es434970/index.html">Sobre negocios de TI y m√°s</a></li>
<li><a href="../es434972/index.html">C√≥mo escribir pruebas unitarias si no tienes ganas</a></li>
<li><a href="../es434974/index.html">Trabajar con un formato de configuraciones 1C: Enterprise</a></li>
<li><a href="../es434976/index.html">ITMO University Fablab: DIY-coworking para personas creativas: muestra lo que hay dentro</a></li>
<li><a href="../es434982/index.html">Perspectiva: MultiClet S1</a></li>
<li><a href="../es434984/index.html">¬øPor qu√© odio el ORM elocuente?</a></li>
<li><a href="../es434986/index.html">Conceptos b√°sicos de la biblioteca est√°ndar de C ++</a></li>
<li><a href="../es434992/index.html">Actualizaci√≥n de IDA Pro. Depurador para Sega Mega Drive (parte 1)</a></li>
<li><a href="../es434994/index.html">Android: Crear sabores din√°micos de productos y firmar configuraciones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>