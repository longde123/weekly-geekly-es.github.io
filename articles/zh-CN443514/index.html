<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘©ğŸ¾ ğŸ¦ ğŸ¤¶ğŸ½ åœ¨Swiftä¸­ç¼–å†™ç½‘ç»œå±‚ï¼šé¢å‘åè®®çš„æ–¹æ³• ğŸµï¸ ğŸ“¡ ğŸ™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç°åœ¨ï¼Œå‡ ä¹100ï¼…çš„åº”ç”¨ç¨‹åºéƒ½ä½¿ç”¨ç½‘ç»œï¼Œå› æ­¤æ¯ä¸ªäººéƒ½é¢å¯¹ç½‘ç»œå±‚çš„ç»„ç»‡å’Œä½¿ç”¨ã€‚ è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼Œè¦ä¹ˆä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œè¦ä¹ˆä½¿ç”¨æ‚¨è‡ªå·±çš„ç½‘ç»œå±‚å®ç°ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ç¬¬äºŒä¸ªé€‰é¡¹ï¼Œå¹¶å°è¯•ä½¿ç”¨è¯¥è¯­è¨€çš„æ‰€æœ‰æœ€æ–°åŠŸèƒ½ï¼Œä½¿ç”¨åè®®å’Œæšä¸¾æ¥å®ç°ç½‘ç»œå±‚ã€‚ è¿™å°†ä»¥å…¶ä»–åº“çš„å½¢å¼ä¿å­˜é¡¹ç›®ï¼Œé¿å…ä¸å¿…è¦çš„ä¾èµ–ã€‚ æ›¾ç»...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Swiftä¸­ç¼–å†™ç½‘ç»œå±‚ï¼šé¢å‘åè®®çš„æ–¹æ³•</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443514/"><img src="https://habrastorage.org/webt/gg/rb/pk/ggrbpkas55pf0eigg33hin46i0g.png"><br><br> ç°åœ¨ï¼Œå‡ ä¹100ï¼…çš„åº”ç”¨ç¨‹åºéƒ½ä½¿ç”¨ç½‘ç»œï¼Œå› æ­¤æ¯ä¸ªäººéƒ½é¢å¯¹ç½‘ç»œå±‚çš„ç»„ç»‡å’Œä½¿ç”¨ã€‚ è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼Œè¦ä¹ˆä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œè¦ä¹ˆä½¿ç”¨æ‚¨è‡ªå·±çš„ç½‘ç»œå±‚å®ç°ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ç¬¬äºŒä¸ªé€‰é¡¹ï¼Œå¹¶å°è¯•ä½¿ç”¨è¯¥è¯­è¨€çš„æ‰€æœ‰æœ€æ–°åŠŸèƒ½ï¼Œä½¿ç”¨åè®®å’Œæšä¸¾æ¥å®ç°ç½‘ç»œå±‚ã€‚ è¿™å°†ä»¥å…¶ä»–åº“çš„å½¢å¼ä¿å­˜é¡¹ç›®ï¼Œé¿å…ä¸å¿…è¦çš„ä¾èµ–ã€‚ æ›¾ç»çœ‹è¿‡Moyaçš„äººä¼šç«‹å³æ„è¯†åˆ°å®ç°å’Œä½¿ç”¨è¿‡ç¨‹ä¸­çš„è®¸å¤šç±»ä¼¼ç»†èŠ‚ï¼Œåªæ˜¯è¿™æ¬¡ï¼Œæˆ‘ä»¬å°†è‡ªå·±åŠ¨æ‰‹åšï¼Œè€Œæ— éœ€æ¥è§¦Moyaå’ŒAlamofireã€‚ <br><a name="habracut"></a><br><br> åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å¦‚ä½•åœ¨ä¸ä½¿ç”¨ä»»ä½•ç¬¬ä¸‰æ–¹åº“çš„æƒ…å†µä¸‹åœ¨çº¯Swiftä¸Šå®ç°ç½‘ç»œå±‚ã€‚ é˜…è¯»æœ¬æ–‡åï¼Œæ‚¨çš„ä»£ç å°†å˜ä¸º <br><br><ul><li> é¢å‘åè®® </li><li> ä½¿ç”¨æ–¹ä¾¿ </li><li> ä½¿ç”¨æ–¹ä¾¿ </li><li> è¾“å…¥å®‰å…¨ </li><li> å¯¹äºç«¯ç‚¹ï¼Œå°†ä½¿ç”¨æšä¸¾ </li></ul><br><br> ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†ç½‘ç»œå±‚å®ç°åçš„ä½¿ç”¨æƒ…å†µï¼š <br><br><img src="https://habrastorage.org/webt/zg/f5/jy/zgf5jybl_jika5ljlt-h3pcdg1e.png"><br><br> é€šè¿‡ç®€å•åœ°ç¼–å†™<i><b>router.requestï¼ˆã€‚</b></i>å¹¶ä½¿ç”¨æšä¸¾çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æ‰€æœ‰å¯èƒ½çš„æŸ¥è¯¢é€‰é¡¹åŠå…¶å‚æ•°ã€‚ <br><br>  <b>é¦–å…ˆï¼Œå…³äºé¡¹ç›®çš„ç»“æ„</b> <br><br> æ¯å½“æ‚¨åˆ›å»ºæ–°å†…å®¹æ—¶ï¼Œä¸ºäº†å°†æ¥èƒ½å¤Ÿè½»æ¾ç†è§£æ‰€æœ‰å†…å®¹ï¼Œæ­£ç¡®ç»„ç»‡å’Œç»„ç»‡æ‰€æœ‰å†…å®¹éå¸¸é‡è¦ã€‚ æˆ‘ç›¸ä¿¡æ­£ç¡®ç»„ç»‡çš„æ–‡ä»¶å¤¹ç»“æ„æ˜¯æ„å»ºåº”ç”¨ç¨‹åºä½“ç³»ç»“æ„æ—¶çš„é‡è¦ç»†èŠ‚ã€‚ ä¸ºäº†ä½¿æ‰€æœ‰å†…å®¹æ­£ç¡®åœ°æ’åˆ—åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œè®©æˆ‘ä»¬æå‰åˆ›å»ºå®ƒä»¬ã€‚ è¿™çœ‹èµ·æ¥åƒé¡¹ç›®ä¸­çš„å¸¸è§„æ–‡ä»¶å¤¹ç»“æ„ï¼š <br><br><img src="https://habrastorage.org/webt/vw/fz/y0/vwfzy0nlpqmg6mccy85s2q6iqrg.png"><br><br>  <b>ç«¯ç‚¹ç±»å‹åè®®</b> <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰<i><b>EndPointType</b></i>åè®®ã€‚ è¯¥åè®®å°†åŒ…å«é…ç½®è¯·æ±‚çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯ã€‚ ä»€ä¹ˆæ˜¯è¯·æ±‚ï¼ˆç«¯ç‚¹ï¼‰ï¼Ÿ æœ¬è´¨ä¸Šï¼Œå®ƒæ˜¯å…·æœ‰æ‰€æœ‰ç›¸å…³ç»„ä»¶ï¼ˆä¾‹å¦‚æ ‡å¤´ï¼Œè¯·æ±‚å‚æ•°ï¼Œè¯·æ±‚ä¸»ä½“ï¼‰çš„URLRequestã€‚  <i><b>EndPointType</b></i>åè®®æ˜¯æˆ‘ä»¬ç½‘ç»œå±‚å®ç°ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ã€‚ è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¹¶å°†å…¶å‘½åä¸º<i><b>EndPointType</b></i> ã€‚ å°†æ­¤æ–‡ä»¶æ”¾åœ¨Serviceæ–‡ä»¶å¤¹ä¸­ï¼ˆè€Œä¸æ˜¯EndPointæ–‡ä»¶å¤¹ä¸­ï¼Œä¸ºä»€ä¹ˆ-ç¨åä¼šæ¸…é™¤ï¼‰ <br><br><img src="https://habrastorage.org/webt/-9/j0/ul/-9j0ulvgk-w_hftxxyqwolmbujy.png"><br><br>  <b>HTTPåè®®</b> <br><br> æˆ‘ä»¬çš„<i><b>EndPointType</b></i>åŒ…å«åˆ›å»ºè¯·æ±‚æ‰€éœ€çš„å‡ ç§åè®®ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è¿™äº›åè®®æ˜¯ä»€ä¹ˆã€‚ <br><br>  <b>HTTPæ–¹æ³•</b> <br><br> åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°†å…¶å‘½åä¸º<i><b>HTTPMethod</b></i>å¹¶å°†å…¶æ”¾åœ¨Serviceæ–‡ä»¶å¤¹ä¸­ã€‚ æ­¤æ¸…å•å°†ç”¨äºè®¾ç½®æˆ‘ä»¬è¯·æ±‚çš„HTTPæ–¹æ³•ã€‚ <br><br><img src="https://habrastorage.org/webt/j2/3x/nr/j23xnrcovqknw9dzxhf-xva898q.png"><br><br>  <b>HTTPä»»åŠ¡</b> <br> åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°†å…¶å‘½åä¸º<i><b>HTTPTask</b></i>å¹¶å°†å…¶æ”¾åœ¨Serviceæ–‡ä»¶å¤¹ä¸­ã€‚  HTTPTaskè´Ÿè´£é…ç½®ç‰¹å®šè¯·æ±‚çš„å‚æ•°ã€‚ æ‚¨å¯ä»¥æ ¹æ®éœ€è¦å‘å…¶æ·»åŠ å°½å¯èƒ½å¤šçš„ä¸åŒæŸ¥è¯¢é€‰é¡¹ï¼Œä½†æ˜¯æˆ‘å°†ä¾æ¬¡è¿›è¡Œå¸¸è§„æŸ¥è¯¢ï¼Œå¸¦å‚æ•°çš„æŸ¥è¯¢ï¼Œå¸¦å‚æ•°å’Œæ ‡å¤´çš„æŸ¥è¯¢ï¼Œå› æ­¤ï¼Œæˆ‘å°†ä»…æ‰§è¡Œè¿™ä¸‰ç§ç±»å‹çš„æŸ¥è¯¢ã€‚ <br><br><img src="https://habrastorage.org/webt/v5/4m/j6/v54mj6yxsvdwuiossyq3em2biia.png"><br><br> åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®º<i><b>å‚æ•°</b></i>ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ <br><br>  <b>HTTPå¤´</b> <br><br>  <i><b>HTTPHeaders</b></i>åªæ˜¯å­—å…¸çš„åˆ«åã€‚ æ‚¨å¯ä»¥åœ¨<i><b>HTTPTask</b></i>æ–‡ä»¶çš„é¡¶éƒ¨åˆ›å»ºå®ƒã€‚ <br><br><pre><code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">HTTPHeaders</span></span> = [<span class="hljs-type"><span class="hljs-type">String</span></span>:<span class="hljs-type"><span class="hljs-type">String</span></span>]</code> </pre> <br><br>  <b>å‚æ•°ä¸ç¼–ç </b> <br><br> åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°†å…¶å‘½åä¸º<i><b>ParameterEncoding</b></i>å¹¶å°†å…¶æ”¾åœ¨Encodingæ–‡ä»¶å¤¹ä¸­ã€‚ ä¸º<i><b>Parameters</b></i>åˆ›å»ºtypealiasï¼Œå®ƒå°†å†æ¬¡æˆä¸ºå¸¸è§„è¯å…¸ã€‚ æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†ä½¿ä»£ç çœ‹èµ·æ¥æ›´æ˜“äºç†è§£å’Œå¯è¯»ã€‚ <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">Parameters</span></span> = [<span class="hljs-type"><span class="hljs-type">String</span></span>:<span class="hljs-type"><span class="hljs-type">Any</span></span>]</code> </pre> <br><br> æ¥ä¸‹æ¥ï¼Œä½¿ç”¨å•ä¸ªç¼–ç åŠŸèƒ½å®šä¹‰<i><b>ParameterEncoder</b></i>åè®®ã€‚  encodeæ–¹æ³•å…·æœ‰ä¸¤ä¸ªå‚æ•°ï¼š <i><b>inout URLRequest</b></i>å’Œ<i><b>Parameters</b></i> ã€‚  <b>INOUT</b>æ˜¯ä¸€ä¸ªSwiftå…³é”®å­—ï¼Œå®ƒå°†åŠŸèƒ½å‚æ•°å®šä¹‰ä¸ºå¼•ç”¨ã€‚ é€šå¸¸ï¼Œå‚æ•°ä½œä¸ºå€¼ä¼ é€’ç»™å‡½æ•°ã€‚ åœ¨è°ƒç”¨ä¸­çš„å‡½æ•°å‚æ•°ä¹‹å‰å†™å‡º<i><b>inoutæ—¶</b></i> ï¼Œå¯ä»¥å°†æ­¤å‚æ•°å®šä¹‰ä¸ºå¼•ç”¨ç±»å‹ã€‚ è¦äº†è§£æœ‰å…³inoutå‚æ•°çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å•å‡»æ­¤é“¾æ¥ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œ <i><b>inout</b></i>å…è®¸æ‚¨æ›´æ”¹ä¼ é€’ç»™å‡½æ•°çš„å˜é‡æœ¬èº«çš„å€¼ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨å‚æ•°ä¸­è·å–å…¶å€¼å¹¶åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨å®ƒã€‚  <i><b>ParameterEncoder</b></i>åè®®å°†åœ¨<i><b>JSONParameterEncoder</b></i>å’Œ<i><b>URLPameterEncoderä¸­å®ç°</b></i> ã€‚ <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParameterEncoder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(urlRequest: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> URLRequest, with parameters: Parameters)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> }</code> </pre> <br><br>  <i><b>ParameterEncoder</b></i>åŒ…å«ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åŠŸèƒ½æ˜¯å¯¹å‚æ•°è¿›è¡Œç¼–ç ã€‚ æ­¤æ–¹æ³•å¯èƒ½ä¼šæŠ›å‡ºéœ€è¦å¤„ç†çš„é”™è¯¯ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨throwã€‚ <br><br> äº§ç”Ÿæ ‡å‡†é”™è¯¯è€Œä¸æ˜¯å®šåˆ¶é”™è¯¯ä¹Ÿå¯èƒ½å¾ˆæœ‰ç”¨ã€‚ è§£å¯†Xcodeç»™æ‚¨çš„ä¸œè¥¿æ€»æ˜¯å¾ˆå›°éš¾ã€‚ å½“æ‚¨å¯¹æ‰€æœ‰é”™è¯¯è¿›è¡Œäº†è‡ªå®šä¹‰å’Œæè¿°åï¼Œæ‚¨å§‹ç»ˆä¼šç¡®åˆ‡çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆã€‚ ä¸ºæ­¤ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ª<i><b>Error</b></i>çš„æšä¸¾ã€‚ <br><br><img src="https://habrastorage.org/webt/tl/bj/dd/tlbjddm7l48ho1alexej8rrj15q.png"><br><br> åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°†å…¶å‘½åä¸º<i><b>URLParameterEncoder</b></i>å¹¶å°†å…¶æ”¾åœ¨<i><b>Encoding</b></i>æ–‡ä»¶å¤¹ä¸­ã€‚ <br><br><img src="https://habrastorage.org/webt/s-/eh/tg/s-ehtgdznm1pcdjyrhn3r4fibjs.png"><br><br> æ­¤ä»£ç è·å–å‚æ•°åˆ—è¡¨ï¼Œå¯¹å…¶è¿›è¡Œè½¬æ¢å’Œæ ¼å¼åŒ–ä»¥ç”¨ä½œURLå‚æ•°ã€‚ å¦‚æ‚¨æ‰€çŸ¥ï¼ŒURLä¸­ä¸å…è®¸ä½¿ç”¨æŸäº›å­—ç¬¦ã€‚ å‚æ•°ä¹Ÿç”±â€œï¼†â€ç¬¦å·åˆ†éš”ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æ³¨æ„è¿™ä¸€ç‚¹ã€‚ å¦‚æœæ²¡æœ‰åœ¨è¯·æ±‚ä¸­è®¾ç½®æ ‡å¤´ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»è®¾ç½®æ ‡å¤´çš„é»˜è®¤å€¼ã€‚ <br><br> è¿™æ˜¯å•å…ƒæµ‹è¯•åº”è¯¥æ¶µç›–çš„ä»£ç éƒ¨åˆ†ã€‚ æ„å»ºURLè¯·æ±‚æ˜¯å…³é”®ï¼Œå¦åˆ™æˆ‘ä»¬ä¼šå¼•å‘è®¸å¤šä¸å¿…è¦çš„é”™è¯¯ã€‚ å¦‚æœæ‚¨ä½¿ç”¨å¼€æ”¾å¼APIï¼Œåˆ™æ˜¾ç„¶æ‚¨ä¸å¸Œæœ›å°†å…¨éƒ¨è¯·æ±‚é‡ç”¨äºå¤±è´¥çš„æµ‹è¯•ã€‚ å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³å•å…ƒæµ‹è¯•çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥ä»æœ¬æ–‡å¼€å§‹ã€‚ <br><br>  <b>JSONParameterEncoder</b> <br><br> åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°†å…¶å‘½åä¸º<i><b>JSONParameterEncoder</b></i>å¹¶å°†å…¶æ”¾åœ¨Encodingæ–‡ä»¶å¤¹ä¸­ã€‚ <br><br><img src="https://habrastorage.org/webt/qf/nc/gp/qfncgpv0juhwx6xnvn4llxqv0eu.png"><br><br> ä¸€åˆ‡éƒ½ä¸<i><b>URLParameter</b></i>çš„æƒ…å†µ<i><b>ç›¸åŒ</b></i> ï¼Œåªæ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è½¬æ¢JSONçš„å‚æ•°ï¼Œç„¶åå†æ¬¡å°†å®šä¹‰ç¼–ç â€œ application / jsonâ€çš„å‚æ•°æ·»åŠ åˆ°æ ‡å¤´ä¸­ã€‚ <br><br>  <b>ç½‘ç»œè·¯ç”±å™¨</b> <br><br> åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°†å…¶å‘½åä¸º<i><b>NetworkRouter</b></i>å¹¶å°†å…¶æ”¾åœ¨Serviceæ–‡ä»¶å¤¹ä¸­ã€‚ è®©æˆ‘ä»¬å¼€å§‹å®šä¹‰é—­åŒ…çš„ç±»å‹åˆ«åã€‚ <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">NetworkRouterCompletion</span></span> = (<span class="hljs-number"><span class="hljs-number">_</span></span> data: <span class="hljs-type"><span class="hljs-type">Data?</span></span>,<span class="hljs-number"><span class="hljs-number">_</span></span> response: <span class="hljs-type"><span class="hljs-type">URLResponse?</span></span>,<span class="hljs-number"><span class="hljs-number">_</span></span> error: <span class="hljs-type"><span class="hljs-type">Error?</span></span>)-&gt;()</code> </pre><br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰<i><b>NetworkRouter</b></i>åè®®ã€‚ <br><br><img src="https://habrastorage.org/webt/uf/zd/s0/ufzds0f3ci0fvx9mr0hingvxjtc.png"><br><br>  <i><b>NetworkRouter</b></i>æœ‰ä¸€ä¸ªç”¨äºè¯·æ±‚çš„<i><b>ç«¯ç‚¹</b></i> ï¼Œå¹¶ä¸”åœ¨è¯·æ±‚å®Œæˆåï¼Œæ­¤è¯·æ±‚çš„ç»“æœå°†ä¼ é€’åˆ°<i><b>NetworkRouterCompletion</b></i>é—­åŒ…ã€‚ è¯¥åè®®è¿˜å…·æœ‰<i><b>å–æ¶ˆ</b></i>åŠŸèƒ½ï¼Œå¯ç”¨äºä¸­æ–­é•¿æœŸåŠ è½½å’Œå¸è½½è¯·æ±‚ã€‚ æˆ‘ä»¬åœ¨è¿™é‡Œä¹Ÿä½¿ç”¨äº†<i><b>associatedtype</b></i> ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›<i><b>è·¯ç”±å™¨</b></i>æ”¯æŒä»»ä½•ç±»å‹çš„<i><b>EndPointType</b></i> ã€‚ å¦‚æœä¸ä½¿ç”¨associatedtypeï¼Œåˆ™è·¯ç”±å™¨å¿…é¡»å…·æœ‰å®ç°<i><b>EndPointTypeçš„</b></i>æŸäº›ç‰¹å®šç±»å‹ã€‚ å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³associatedtypeçš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬æ–‡</a> ã€‚ <br><br>  <b>è·¯ç”±å™¨</b> <br><br> åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°†å…¶å‘½åä¸º<i><b>Router</b></i>å¹¶å°†å…¶æ”¾åœ¨Serviceæ–‡ä»¶å¤¹ä¸­ã€‚ æˆ‘ä»¬å£°æ˜ä¸€ä¸ª<i><b>URLSessionTask</b></i>ç±»å‹çš„ç§æœ‰å˜é‡ã€‚ æ‰€æœ‰å·¥ä½œéƒ½åœ¨ä¸Šé¢ã€‚ æˆ‘ä»¬å°†å…¶è®¾ä¸ºç§æœ‰ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›å¤–éƒ¨ä»»ä½•äººéƒ½å¯ä»¥å¯¹å…¶è¿›è¡Œæ›´æ”¹ã€‚ <br><br><img src="https://habrastorage.org/webt/gb/wk/cx/gbwkcxouam1y86i-sruvzyhub_c.png"><br><br>  <b>ç´¢å–</b> <br><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨<i><b>URLSession.shared</b></i>åˆ›å»º<i><b>URLSession</b></i> ï¼Œè¿™æ˜¯æœ€ç®€å•çš„åˆ›å»ºæ–¹æ³•ã€‚ ä½†æ˜¯è¯·è®°ä½ï¼Œè¿™ç§æ–¹æ³•å¹¶éå”¯ä¸€ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨å¯ä»¥æ›´æ”¹å…¶è¡Œä¸ºçš„æ›´å¤æ‚çš„<i><b>URLSession</b></i>é…ç½®ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬æ–‡å°†</a>å¯¹æ­¤è¿›è¡Œæ›´å¤š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»‹ç»</a> ã€‚ <br><br> è¯¥è¯·æ±‚æ˜¯é€šè¿‡è°ƒç”¨<i>buildRequest</i>å‡½æ•°åˆ›å»ºçš„ï¼Œè¯¥å‡½æ•°è°ƒç”¨åŒ…è£…åœ¨do-try-catchä¸­ï¼Œå› ä¸º<i>buildRequestä¸­</i>çš„ç¼–ç å‡½æ•°å¯èƒ½ä¼šå¼•å‘å¼‚å¸¸ã€‚  <i>Response</i> ï¼Œ <i>data</i>å’Œ<i>error</i>ä¼ é€’åˆ°å®Œæˆã€‚ <br><br><img src="https://habrastorage.org/webt/oi/3c/jl/oi3cjllxhvs7n_m39kmy9r7q29k.png"><br><br>  <b>å»ºç«‹è¦æ±‚</b> <br><br> æˆ‘ä»¬ä½¿ç”¨<i>buildRequest</i>å‡½æ•°åˆ›å»ºè¯·æ±‚ã€‚ æ­¤åŠŸèƒ½è´Ÿè´£æˆ‘ä»¬ç½‘ç»œå±‚ä¸­çš„æ‰€æœ‰é‡è¦å·¥ä½œã€‚ æœ¬è´¨<i><b>ä¸Šå°†EndPointType</b></i>è½¬æ¢ä¸º<i><b>URLRequest</b></i> ã€‚ å½“<i><b>EndPoint</b></i>å˜æˆä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¼ é€’ç»™<i><b>session</b></i> ã€‚ è¿™é‡Œå‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™äº›æ–¹æ³•ã€‚ é¦–å…ˆï¼Œ <i>è®©æˆ‘ä»¬</i>æ£€æŸ¥<i>buildRequest</i>æ–¹æ³•ï¼š <br><br>  1.æˆ‘ä»¬åˆå§‹åŒ–<i><b>URLRequest</b></i>è¯·æ±‚å˜é‡ã€‚ æˆ‘ä»¬åœ¨å…¶ä¸­è®¾ç½®åŸºæœ¬URLï¼Œå¹¶æ·»åŠ å°†ç”¨äºå®ƒçš„ç‰¹å®šè¯·æ±‚çš„è·¯å¾„ã€‚ <br><br>  2.ä»æˆ‘ä»¬çš„<i><b>EndPoint</b></i>åˆ†é…<i>request.httpMethod</i> httpæ–¹æ³•ã€‚ <br><br>  3.æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªdo-try-catchå—ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç¼–ç å™¨å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯ã€‚ é€šè¿‡åˆ›å»ºä¸€ä¸ªå¤§å‹çš„do-try-catchå—ï¼Œæˆ‘ä»¬æ— éœ€ä¸ºæ¯æ¬¡å°è¯•åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å—ã€‚ <br><br>  4.åœ¨switchä¸­ï¼Œæ£€æŸ¥<i><b>route.task</b></i> ã€‚ <br><br>  5.æ ¹æ®ä»»åŠ¡çš„ç±»å‹ï¼Œæˆ‘ä»¬ç§°ä¸ºç›¸åº”çš„ç¼–ç å™¨ã€‚ <br><br><img src="https://habrastorage.org/webt/pt/ij/58/ptij58jibcjvvawtyb44axo5mq4.png"><br><br>  <b>é…ç½®å‚æ•°</b> <br><br> åœ¨è·¯ç”±å™¨ä¸­åˆ›å»º<i><b>configureParameters</b></i>å‡½æ•°ã€‚ <br><br><img src="https://habrastorage.org/webt/fb/gf/fy/fbgffycewgssxqrnxglvsvftl0w.png"><br><br> è¯¥å‡½æ•°è´Ÿè´£è½¬æ¢æˆ‘ä»¬çš„æŸ¥è¯¢å‚æ•°ã€‚ ç”±äºæˆ‘ä»¬çš„APIå‡å®šä½¿ç”¨JSONå½¢å¼çš„<i><b>bodyParameters</b></i>å’Œå°†<i><b>URLParameters</b></i>è½¬æ¢ä¸ºURLæ ¼å¼ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€å°†é€‚å½“çš„å‚æ•°ä¼ é€’ç»™ç›¸åº”çš„è½¬æ¢å‡½æ•°ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬æ–‡å¼€å¤´è¿›è¡Œä»‹ç»ã€‚ å¦‚æœä½¿ç”¨åŒ…å«å„ç§ç¼–ç ç±»å‹çš„APIï¼Œé‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å»ºè®®æ·»åŠ <i><b>HTTPTaskä»¥åŠ</b></i>ç¼–ç ç±»å‹çš„å…¶ä»–æšä¸¾ã€‚ æ­¤æ¸…å•åº”åŒ…å«æ‰€æœ‰å¯èƒ½çš„ç¼–ç ç±»å‹ã€‚ ä¹‹åï¼Œåœ¨configureParametersä¸­å†æ·»åŠ ä¸€ä¸ªå¸¦æœ‰æ­¤æšä¸¾çš„å‚æ•°ã€‚ æ ¹æ®å…¶å€¼ï¼Œä½¿ç”¨switchè¿›è¡Œåˆ‡æ¢å¹¶è¿›è¡Œæ‰€éœ€çš„ç¼–ç ã€‚ <br><br>  <b>æ·»åŠ å…¶ä»–æ ‡é¢˜</b> <br><br> åœ¨è·¯ç”±å™¨ä¸­åˆ›å»º<i>addAdditionalHeaders</i>å‡½æ•°ã€‚ <br><br><img src="https://habrastorage.org/webt/ow/07/8a/ow078aeoow6qlavpxiobwl6nbh0.png"><br><br> åªéœ€å°†æ‰€æœ‰å¿…è¦çš„æ ‡å¤´æ·»åŠ åˆ°è¯·æ±‚ä¸­å³å¯ã€‚ <br><br>  <b>å–æ¶ˆ</b> <br><br>  <i>å–æ¶ˆ</i>åŠŸèƒ½çœ‹èµ·æ¥éå¸¸ç®€å•ï¼š <br><br><img src="https://habrastorage.org/webt/v4/3t/mm/v43tmm1dlso_cwstw6sy444vyu4.png"><br><br>  <b>ä½¿ç”¨èŒƒä¾‹</b> <br><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•åœ¨ä¸€ä¸ªçœŸå®ç¤ºä¾‹ä¸­ä½¿ç”¨æˆ‘ä»¬çš„ç½‘ç»œå±‚ã€‚ æˆ‘ä»¬å°†è¿æ¥åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TheMovieDB</a>ä»¥æ¥æ”¶åº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚ <br><br>  <b>ç”µå½±ç»ˆç‚¹</b> <br><br> åˆ›å»ºä¸€ä¸ª<i><b>MovieEndPoint</b></i>æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ”¾ç½®åœ¨EndPointæ–‡ä»¶å¤¹ä¸­ã€‚  MovieEndPointä¸ <br> å’ŒMoyaä¸­çš„TargetTypeã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ”¹ä¸ºå®ç°è‡ªå·±çš„EndPointTypeã€‚ åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤é“¾æ¥ä¸­</a>å¯ä»¥æ‰¾åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨Moyaä½œä¸ºç±»ä¼¼ç¤ºä¾‹ã€‚ <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Foundation enum NetworkEnvironment { case qa case production case staging } public enum MovieApi { case recommended(id:Int) case popular(page:Int) case newMovies(page:Int) case video(id:Int) } extension MovieApi: EndPointType { var environmentBaseURL : String { switch NetworkManager.environment { case .production: return "https:<span class="hljs-comment"><span class="hljs-comment">//api.themoviedb.org/3/movie/" case .qa: return "https://qa.themoviedb.org/3/movie/" case .staging: return "https://staging.themoviedb.org/3/movie/" } } var baseURL: URL { guard let url = URL(string: environmentBaseURL) else { fatalError("baseURL could not be configured.")} return url } var path: String { switch self { case .recommended(let id): return "\(id)/recommendations" case .popular: return "popular" case .newMovies: return "now_playing" case .video(let id): return "\(id)/videos" } } var httpMethod: HTTPMethod { return .get } var task: HTTPTask { switch self { case .newMovies(let page): return .requestParameters(bodyParameters: nil, urlParameters: ["page":page, "api_key":NetworkManager.MovieAPIKey]) default: return .request } } var headers: HTTPHeaders? { return nil } }</span></span></code> </pre><br><br>  <b>ç”µå½±æ¨¡ç‰¹</b> <br><br> è¦å°†<i><b>MovieModel</b></i>å’ŒJSONæ•°æ®æ¨¡å‹è§£æä¸ºæ¨¡å‹ï¼Œä½¿ç”¨äº†Decodableåè®®ã€‚ å°†æ­¤æ–‡ä»¶æ”¾åœ¨<i><b>æ¨¡å‹</b></i>æ–‡ä»¶å¤¹ä¸­ã€‚ <br><br>  <i>æ³¨æ„</i> ï¼šè¦æ›´è¯¦å°½åœ°äº†è§£Codableï¼ŒDecodableå’ŒEncodableåè®®ï¼Œå¯ä»¥é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« </a> ï¼Œå…¶ä¸­è¯¦ç»†ä»‹ç»äº†ä½¿ç”¨å®ƒä»¬çš„æ‰€æœ‰åŠŸèƒ½ã€‚ <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Foundation struct MovieApiResponse { let page: Int let numberOfResults: Int let numberOfPages: Int let movies: [Movie] } extension MovieApiResponse: Decodable { private enum MovieApiResponseCodingKeys: String, CodingKey { case page case numberOfResults = "total_results" case numberOfPages = "total_pages" case movies = "results" } init(from decoder: Decoder) throws { let container = try decoder.container(keyedBy: MovieApiResponseCodingKeys.self) page = try container.decode(Int.self, forKey: .page) numberOfResults = try container.decode(Int.self, forKey: .numberOfResults) numberOfPages = try container.decode(Int.self, forKey: .numberOfPages) movies = try container.decode([Movie].self, forKey: .movies) } } struct Movie { let id: Int let posterPath: String let backdrop: String let title: String let releaseDate: String let rating: Double let overview: String } extension Movie: Decodable { enum MovieCodingKeys: String, CodingKey { case id case posterPath = "poster_path" case backdrop = "backdrop_path" case title case releaseDate = "release_date" case rating = "vote_average" case overview } init(from decoder: Decoder) throws { let movieContainer = try decoder.container(keyedBy: MovieCodingKeys.self) id = try movieContainer.decode(Int.self, forKey: .id) posterPath = try movieContainer.decode(String.self, forKey: .posterPath) backdrop = try movieContainer.decode(String.self, forKey: .backdrop) title = try movieContainer.decode(String.self, forKey: .title) releaseDate = try movieContainer.decode(String.self, forKey: .releaseDate) rating = try movieContainer.decode(Double.self, forKey: .rating) overview = try movieContainer.decode(String.self, forKey: .overview) } }</code> </pre><br><br>  <b>ç½‘ç»œç»ç†</b> <br><br> åœ¨ç®¡ç†å™¨æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª<i><b>NetworkManager</b></i>æ–‡ä»¶ã€‚ ç›®å‰ï¼ŒNetworkManagerä»…åŒ…å«ä¸¤ä¸ªé™æ€å±æ€§ï¼šAPIå¯†é’¥å’Œæè¿°è¦è¿æ¥åˆ°çš„æœåŠ¡å™¨ç±»å‹çš„æšä¸¾ã€‚  <i><b>NetworkManager</b></i>è¿˜åŒ…å«ç±»å‹ä¸º<i><b>MovieApi</b></i>çš„<i><b>è·¯ç”±å™¨</b></i> ã€‚ <br><br><img src="https://habrastorage.org/webt/yj/it/-b/yjit-b1afnahwsvjkkjnaezgpdu.png"><br><br>  <b>ç½‘ç»œå“åº”</b> <br><br> åœ¨NetworkManagerä¸­åˆ›å»º<i><b>NetworkResponse</b></i>æšä¸¾ã€‚ <br><br><img src="https://habrastorage.org/webt/vv/fv/7s/vvfv7sl-q-dmnz289jdcntmhs0k.png"><br><br> åœ¨å¤„ç†å¯¹è¯·æ±‚çš„å“åº”æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ­¤æšä¸¾ï¼Œå¹¶æ˜¾ç¤ºç›¸åº”çš„æ¶ˆæ¯ã€‚ <br><br>  <b>ç»“æœ</b> <br><br> åœ¨NetworkManagerä¸­åˆ›å»ºä¸€ä¸ª<i><b>ç»“æœ</b></i>æšä¸¾ã€‚ <br><br><img src="https://habrastorage.org/webt/en/oj/ad/enojad3e4jxk2jgkntgblqftivu.png"><br><br> æˆ‘ä»¬ä½¿ç”¨<i><b>Result</b></i>æ¥ç¡®å®šè¯·æ±‚æ˜¯å¦æˆåŠŸã€‚ å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†è¿”å›ä¸€æ¡é”™è¯¯æ¶ˆæ¯å¹¶è¯´æ˜åŸå› ã€‚ <br><br>  <b>è¯·æ±‚å“åº”å¤„ç†</b> <br><br> åˆ›å»º<i><b>handleNetworkResponse</b></i>å‡½æ•°ã€‚ æ­¤å‡½æ•°é‡‡ç”¨ä¸€ä¸ªå‚æ•°ï¼ˆä¾‹å¦‚<i><b>HTTPResponseï¼‰ï¼Œ</b></i>å¹¶è¿”å›Resultã€‚ <br><br><img src="https://habrastorage.org/webt/wt/uv/5f/wtuv5f7cptiudu69o8mn16psbsy.png"><br><br> åœ¨æ­¤å‡½æ•°ä¸­ï¼Œæ ¹æ®ä»HTTPResponseæ¥æ”¶åˆ°çš„statusCodeï¼Œæˆ‘ä»¬è¿”å›é”™è¯¯æ¶ˆæ¯æˆ–è¯·æ±‚æˆåŠŸçš„æ ‡å¿—ã€‚ é€šå¸¸ï¼ŒèŒƒå›´ä¸º200..299çš„ä»£ç è¡¨ç¤ºæˆåŠŸã€‚ <br><br>  <b>å‘å‡ºç½‘ç»œè¯·æ±‚</b> <br><br> å› æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€åˆ‡å·¥ä½œï¼Œå¼€å§‹ä½¿ç”¨æˆ‘ä»¬çš„ç½‘ç»œå±‚ï¼Œè®©æˆ‘ä»¬å°è¯•å‘å‡ºä¸€ä¸ªè¯·æ±‚ã€‚ <br><br> æˆ‘ä»¬å°†ç´¢å–æ–°ç”µå½±çš„æ¸…å•ã€‚ åˆ›å»ºä¸€ä¸ªå‡½æ•°å¹¶å°†å…¶å‘½åä¸º<i><b>getNewMovies</b></i> ã€‚ <br><br><img src="https://habrastorage.org/webt/ei/yn/fn/eiynfnoketqomcziq5nzv6ulaao.png"><br><br> è®©æˆ‘ä»¬é€æ­¥è¿›è¡Œï¼š <br><br>  1.æˆ‘ä»¬ç”¨ä¸¤ä¸ªå‚æ•°å®šä¹‰<i><b>getNewMovies</b></i>æ–¹æ³•ï¼šåˆ†é¡µé¡µç å’Œå®Œæˆå¤„ç†ç¨‹åºï¼Œå®ƒè¿”å›ä¸€ä¸ªå¯é€‰çš„<i><b>Movie</b></i>æ¨¡å‹æ•°ç»„ï¼Œæˆ–è€…ä¸€ä¸ªå¯é€‰çš„é”™è¯¯ã€‚ <br><br>  2.å‘¼å«<i><b>è·¯ç”±å™¨</b></i> ã€‚ æˆ‘ä»¬åœ¨å…³é—­å¤„ä¼ é€’é¡µç å’Œå¤„ç†<i>å®Œæˆ</i> ã€‚ <br><br>  3.å¦‚æœæ²¡æœ‰ç½‘ç»œæˆ–ç”±äºä»»ä½•åŸå› æ— æ³•å‘å‡ºè¯·æ±‚ï¼Œ <i><b>URLSession</b></i>å°†è¿”å›é”™è¯¯ã€‚ è¯·æ³¨æ„ï¼Œè¿™ä¸æ˜¯APIé”™è¯¯ï¼Œæ­¤ç±»é”™è¯¯åœ¨å®¢æˆ·ç«¯ä¸Šå‘ç”Ÿï¼Œé€šå¸¸æ˜¯ç”±äºInternetè¿æ¥è´¨é‡å·®è€Œå‘ç”Ÿçš„ã€‚ <br><br>  4.æˆ‘ä»¬éœ€è¦å°†<i><b>å“åº”</b></i> <i><b>å¼ºåˆ¶è½¬æ¢</b></i>ä¸º<i><b>HTTPURLResponse</b></i> ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è®¿é—®<i>statusCode</i>å±æ€§ã€‚ <br><br>  5.å£°æ˜<i><b>ç»“æœ</b></i>å¹¶ä½¿ç”¨<i><b>handleNetworkResponse</b></i>æ–¹æ³•å¯¹å…¶è¿›è¡Œåˆå§‹åŒ– <br><br>  6. <i><b>æˆåŠŸ</b></i>è¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼Œæˆ‘ä»¬æ”¶åˆ°äº†é¢„æœŸçš„ç­”å¤ã€‚ ç„¶åï¼Œæˆ‘ä»¬æ£€æŸ¥æ•°æ®æ˜¯å¦å¸¦æœ‰ç­”æ¡ˆï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™åªéœ€é€šè¿‡returnç»“æŸæ–¹æ³•å³å¯ã€‚ <br><br>  7.å¦‚æœç­”æ¡ˆä¸æ•°æ®ä¸€èµ·å‡ºç°ï¼Œåˆ™æœ‰å¿…è¦å°†æ¥æ”¶åˆ°çš„æ•°æ®è§£æåˆ°æ¨¡å‹ä¸­ã€‚ ä¹‹åï¼Œæˆ‘ä»¬å°†ç”Ÿæˆçš„æ¨¡å‹æ•°ç»„ä¼ é€’ç»™å®Œæˆã€‚ <br><br>  8.å‘ç”Ÿé”™è¯¯æ—¶ï¼Œåªéœ€å°†é”™è¯¯ä¼ é€’ç»™<i>å®Œæˆå³å¯</i> ã€‚ <br><br> å°±æ˜¯è¿™æ ·ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„ç½‘ç»œå±‚åœ¨çº¯Swiftä¸Šå·¥ä½œçš„æ–¹å¼ï¼Œè€Œæ— éœ€ä½¿ç”¨ä»»ä½•ç¬¬ä¸‰æ–¹Podå’Œåº“å½¢å¼çš„ä¾èµ–é¡¹ã€‚ ä¸ºäº†è¿›è¡Œæµ‹è¯•apiè¯·æ±‚ä»¥è·å–ç”µå½±åˆ—è¡¨ï¼Œè¯·åˆ›å»ºå…·æœ‰<i><b>NetworkManager</b></i>å±æ€§çš„MainViewControllerå¹¶é€šè¿‡å®ƒè°ƒç”¨<i><b>getNewMovies</b></i>æ–¹æ³•ã€‚ <br><br><pre> <code class="swift hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> networkManager: <span class="hljs-type"><span class="hljs-type">NetworkManager!</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(networkManager: <span class="hljs-type"><span class="hljs-type">NetworkManager</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(nibName: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.networkManager = networkManager } <span class="hljs-keyword"><span class="hljs-keyword">required</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>?(coder aDecoder: <span class="hljs-type"><span class="hljs-type">NSCoder</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"init(coder:) has not been implemented"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() view.backgroundColor = .green networkManager.getNewMovies(page: <span class="hljs-number"><span class="hljs-number">1</span></span>) { movies, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> movies = movies { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(movies) } } } }</code> </pre> <br><br>  <b>å°å¥–é‡‘</b> <br><br> å½“æ‚¨ä¸äº†è§£åœ¨ç‰¹å®šä½ç½®ä½¿ç”¨å“ªç§å ä½ç¬¦æ—¶ï¼Œæ‚¨åœ¨Xcodeä¸­é‡åˆ°äº†ä¸€äº›æƒ…å†µï¼Ÿ ä¾‹å¦‚ï¼ŒæŸ¥çœ‹æˆ‘ä»¬åˆšåˆšä¸º<i><b>Router</b></i>ç¼–å†™çš„ä»£ç ã€‚ <br><br><img src="https://habrastorage.org/webt/sd/cb/ga/sdcbgacxit9y-j4zk8w32slxqm8.png"><br><br> æˆ‘ä»¬è‡ªå·±ç¡®å®šäº†<i><b>NetworkRouterCompletion</b></i> ï¼Œä½†æ˜¯å³ä½¿åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¹Ÿå¾ˆå®¹æ˜“å¿˜è®°å®ƒæ˜¯ä»€ä¹ˆç±»å‹ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬é’Ÿçˆ±çš„Xcodeä¼šå¤„ç†æ‰€æœ‰äº‹æƒ…ï¼Œåªéœ€åŒå‡»å ä½ç¬¦å°±è¶³å¤Ÿäº†ï¼ŒXcodeå°†æ›¿æ¢æ‰€éœ€çš„ç±»å‹ã€‚ <br><br><img src="https://habrastorage.org/webt/la/wo/oj/lawoojq5qsvsdzzvfzarqc-wnsk.png"><br><br>  <b>ç»“è®º</b> <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†é¢å‘åè®®çš„ç½‘ç»œå±‚ï¼Œè¯¥å±‚éå¸¸æ˜“äºä½¿ç”¨ï¼Œæ‚¨å¯ä»¥éšæ—¶å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ã€‚ æˆ‘ä»¬äº†è§£äº†å®ƒçš„åŠŸèƒ½ä»¥åŠæ‰€æœ‰æœºåˆ¶çš„å·¥ä½œåŸç†ã€‚ <br><br> æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å­˜å‚¨åº“ä¸­</a>æ‰¾åˆ°æºä»£ç ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN443514/">https://habr.com/ru/post/zh-CN443514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN443502/index.html">ä¸ºä»€ä¹ˆæ­£å¥½4å¹´å‰ï¼ŒNASAç”¨Atlas Vç«ç®­æ‹æ‘„äº†å¡çº³ç»´æ‹‰å°”è§’çš„å¤œç©ºï¼Ÿ</a></li>
<li><a href="../zh-CN443504/index.html">ä¸‡ç»´ç½‘å·²æœ‰ä¸‰åå¹´å†å²äº†-æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN443506/index.html">Googleè¡¨æ ¼ä¸­YouTubeçš„ç®€å•è§£æå™¨</a></li>
<li><a href="../zh-CN443510/index.html">Compaq Armada 7700ç¬”è®°æœ¬ç”µè„‘-Compaq LTEäº§å“çº¿çš„å‘å±•</a></li>
<li><a href="../zh-CN443512/index.html">ä¸‹è¯ºå¤«å“¥ç½—å¾·çš„æ•°æ®åˆ†æé»‘å®¢é©¬æ‹‰æ¾</a></li>
<li><a href="../zh-CN443516/index.html">é»‘å®¢Geohotå†³å®šå°†äººä»¬ä»AIæ¨¡æ‹Ÿä¸­è§£æ”¾å‡ºæ¥</a></li>
<li><a href="../zh-CN443518/index.html">æ·±å…¥äº†è§£RBKmoneyä»˜æ¬¾-å¾®æœåŠ¡ï¼Œåè®®å’Œå¹³å°é…ç½®</a></li>
<li><a href="../zh-CN443520/index.html">ä¸ºITä¸“å®¶é€‰æ‹©æ±½è½¦ï¼Œæˆ–ä»èŒ¶å£¶ä¸­è·å–èŒ¶å£¶çš„æç¤º</a></li>
<li><a href="../zh-CN443522/index.html">æ‰˜ç®¡ï¼šé€‰é¡¹ï¼Œæ¯”è¾ƒï¼Œç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯</a></li>
<li><a href="../zh-CN443524/index.html">åœ¨Unity3Dä¸­è‡ªå·±åŠ¨æ‰‹åˆ¶ä½œFlashåŠ¨ç”»ã€‚ ç¬¬ä¸€éƒ¨åˆ†ï¼ŒæŠ’æƒ…</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>