<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💃🏽 🐤 🎶 JunOS: empêcher les sessions de réinitialisation MP-BGP 🐤 👨🏽‍🚀 🧖🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lors de la configuration de MP-BGP, sur le matériel Juniper, une situation de rétablissement de quartier (non) évidente peut se produire. La raison es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JunOS: empêcher les sessions de réinitialisation MP-BGP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429486/"><p>  Lors de la configuration de MP-BGP, sur le matériel Juniper, une situation de rétablissement de quartier (non) évidente peut se produire.  La raison est décrite en détail dans la base de connaissances <strong>Junuper KB20870</strong> , voici une brève relecture avec mes commentaires. <a name="habracut"></a></p><br><p>  Comme vous le savez, lorsque vous travaillez avec des VPN, plusieurs tables de routage sont utilisées.  Nous serons intéressés par 2 principaux: <em>vrf.inet.0</em> et <em>bgp.l3vpn.0</em> (ci-après, la situation avec L3VPN est décrite, mais cela est également vrai pour d'autres services où BGP est un protocole de signalisation). </p><br><p>  La table <em>bgp.l3vpn.0</em> contient toutes les routes reçues des voisins BGP. </p><br><p>  Les routes directes / statiques d'un routeur PE spécifique sont placées dans la table <em>vrf.inet.0</em> , ainsi que les routes entrantes provenant des voisins de la table <em>bgp.l3vpn.0</em> qui satisfont à la politique d'importation (si elle est configurée) sont importées. <br>  Dans le même temps, l'exportation de <em>vrf.inet.0</em> vers <em>bgp.l3vpn.0</em> ne se produit pas et les itinéraires sont directement annoncés aux voisins. </p><br><p> Si le routeur agit comme un réflecteur de route, ou s'il y a des voisins MP eBGP, les routes sont placées à la fois dans la table <em>vrf.inet.0</em> et dans <em>bgp.l3vpn</em> .  Dans ce cas, une comparaison est effectuée avec les itinéraires locaux et (si nécessaire) le meilleur chemin est sélectionné. </p><br><p>  Ainsi, le routeur peut fonctionner dans l'un des deux modes définis: </p><br><ul><li>  aucun réflecteur de routeur n'est configuré sur le routeur et il n'y a pas de voisins eBGP; </li><li>  le routeur est un réflecteur de route et / ou il y a des voisins eBGP dessus. </li></ul><br><p>  Le changement de mode implique le redémarrage des sessions MP-BGP.  De toute évidence, cela peut être vu dans la topologie suivante: </p><br><p><img src="https://habrastorage.org/webt/-r/mb/q8/-rmbq8refiwmktfmgwpqs8dgtcg.png"></p><br><p>  Dans la première version (Fig. 1), le schéma iBGP maillé classique est présenté.  Imaginez maintenant que nous devons ajouter le routeur R4.  Pour une raison ou une autre, nous avons décidé de le faire en définissant R1 comme réflecteur de route pour R4 (Fig. 2).  La configuration des paramètres du réflecteur d'itinéraire sur R1 entraînera la réinstallation de toutes les sessions MP-BGP (avec les routeurs R2 et R3), ce qui entraînera des temps d'arrêt dans la fourniture des services. </p><br><p>  Pour éviter cela, il est proposé de transférer fermement le routeur dans le 2ème mode de fonctionnement.  Une façon consiste à créer un groupe eBGP factice.  Par exemple: </p><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">group</span></span> fake-vpn { <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">external</span></span>; description "## Preventing mpbgp sessions flap ##"; passive; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span>-vpn { <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> iso-vpn { unicast; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> l2vpn { signaling; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> evpn { signaling; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span>-mvpn { signaling; <span class="hljs-keyword"><span class="hljs-keyword">family</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span>-mdt { signaling; neighbor <span class="hljs-number"><span class="hljs-number">192.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> { peer-<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-number"><span class="hljs-number">65536</span></span>; }</code> </pre> <br><p>  AS: 65536 et IP: 192.0.2.1 peuvent être absolument n'importe quoi, et le mode passif vous permet d'éviter les tentatives inutiles pour établir une session inexistante à partir du routeur. </p><br><p>  Quand cela peut être utile: </p><br><ul><li>  il n'y a pas de réflecteurs de route dédiés sur le réseau.  Le rôle de RR sont les routeurs principaux du réseau.  En même temps, il y a une possibilité de changement de leur rôle (par exemple, d'un routeur P à un P / RR ou vice versa); </li><li>  il est possible qu'une interface eBGP apparaisse avec la famille MP-BGP, par exemple Inter-AS. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429486/">https://habr.com/ru/post/fr429486/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429472/index.html">Docker Compose + Consul + Spring Boot + FeignClient</a></li>
<li><a href="../fr429474/index.html">Le condensé de matériaux intéressants pour le développeur mobile # 274 (5 - 11 novembre)</a></li>
<li><a href="../fr429478/index.html">Game Design: une nouvelle approche des niveaux de difficulté</a></li>
<li><a href="../fr429482/index.html">Problèmes d'accès aux données personnelles au nom de tous les participants au processus</a></li>
<li><a href="../fr429484/index.html">Encore une fois sur les interviews, mais dans les pays d'outre-mer</a></li>
<li><a href="../fr429488/index.html">NanoPi Fire3 Supercalculateur monocarte à 96 cœurs</a></li>
<li><a href="../fr429490/index.html">Gestion du temps sans horaires stricts, expérience dans le développement d'une application mobile</a></li>
<li><a href="../fr429494/index.html">Dagaz: Détails</a></li>
<li><a href="../fr429496/index.html">Laser au sabre laser fait maison: comment c'était. 2e partie</a></li>
<li><a href="../fr429498/index.html">4 raisons de tergiverser (texte)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>