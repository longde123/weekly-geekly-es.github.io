<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçÄ üíñ üîª Um artigo sobre como o CommVault faz backup do PostgreSQL üë©üèΩ‚Äçüåæ ‚ô®Ô∏è üëéüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, revisaremos nossa experi√™ncia usando os backups do CommVault for PostgreSQL. Para isso, analisaremos uma pequena parte de um de nossos p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Um artigo sobre como o CommVault faz backup do PostgreSQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/softline/blog/442760/">  Neste artigo, revisaremos nossa experi√™ncia usando os backups do CommVault for PostgreSQL.  Para isso, analisaremos uma pequena parte de um de nossos projetos anteriores, onde configuramos um backup do banco de dados PostgreSQL a partir do cliente. <br><br><img src="https://habrastorage.org/webt/zl/io/gr/zliogravp0udjmycafd9nm6yrow.jpeg"><a name="habracut"></a><br><br><h4>  <font color="#2e74b5">Sobre o CommVault</font> </h4><br>  O CommVault √© uma plataforma escal√°vel √∫nica que fornece prote√ß√£o integrada de dados e gerenciamento de conte√∫do.  A plataforma suporta m√≥dulos de software com fun√ß√µes para fazer backup e restaurar dados, arquivamento, desduplica√ß√£o, replica√ß√£o, distribui√ß√£o hier√°rquica de m√≠dia e criptografia.  Os m√≥dulos da plataforma trabalham com conte√∫do corporativo de v√°rias fontes e fornecem recupera√ß√£o de informa√ß√µes de ponta a ponta no ambiente corporativo e sua disponibilidade constante mesmo de arquivos, gra√ßas a uma √∫nica indexa√ß√£o inteligente de documentos em um reposit√≥rio virtual.  A plataforma tamb√©m √© equipada com ferramentas avan√ßadas de an√°lise que geram relat√≥rios sobre as a√ß√µes de usu√°rios e aplicativos e sobre o funcionamento da infraestrutura. <br><br>  O CommVault protege, restaura e gerencia dados e acesso a eles em ambientes f√≠sicos e virtuais. <br><br><h4>  <font color="#2e74b5">Sobre o backup do PostgreSQL</font> </h4><br>  Para executar um backup do banco de dados PostgreSQL, √© utilizado um agente (iDataAgent), instalado no servidor em que o banco de dados est√° em execu√ß√£o.  O agente foi projetado para gerenciar e proteger efetivamente dados comerciais importantes nos bancos de dados PostgreSQL.  Voc√™ pode usar esse agente para fazer backup e restaurar todo o servidor PostgreSQL ou bancos de dados individuais.  Se necess√°rio, voc√™ tamb√©m pode restaurar tabelas individuais. <br><br><h4>  <font color="#2e74b5">Principais recursos:</font> </h4><br>  O PostgreSQL iDataAgent oferece a flexibilidade de fazer backup de bancos de dados em v√°rios modos e restaur√°-los em um tempo m√≠nimo.  Voc√™ pode fazer backup ou fazer backup de todo o servidor PostgreSQL, bancos de dados individuais ou logs arquivados a qualquer momento. <br><br>  Os recursos de backup e recupera√ß√£o que podem ser executados em diferentes modos: <br><br><ul><li>  O iDataAgent fornece a capacidade de restaurar todo o servidor PostgreSQL.  Todos os bancos de dados localizados no servidor de origem podem ser restaurados no servidor de destino. </li><li>  Defina um √∫nico banco de dados ou grupo de bancos de dados como dados do subcliente e fa√ßa backup e restaura√ß√£o. </li><li>  Fa√ßa backup apenas dos logs no servidor PostgreSQL.  Esses arquivos de log podem ser usados ‚Äã‚Äãpara recuperar transa√ß√µes do banco de dados perdidas devido a uma falha no sistema operacional ou no disco. </li><li>  Restaure todo o servidor PostgreSQL em um momento espec√≠fico para o backup baseado em sistema de arquivos. </li><li>  Visualize e verifique o status das opera√ß√µes de backup e recupera√ß√£o do Job Controller e Event Viewer no console do CommCell.  Acompanhe o status do seu trabalho com relat√≥rios que voc√™ pode salvar e distribuir. </li><li>  Use backups em n√≠vel de bloco como uma maneira mais r√°pida de fazer backup de dados, porque os backups s√£o apenas para extens√µes (ou partes modificadas do banco de dados), e n√£o para todo o banco de dados PostgreSQL. </li><li>  Desduplica√ß√£o em n√≠vel de bloco  A desduplica√ß√£o fornece uma maneira mais inteligente de armazenar dados, identificando e removendo duplicatas nas opera√ß√µes de prote√ß√£o de dados. </li></ul><br>
<h4>  <font color="#2e74b5">Arquitetura</font> </h4><br>  <font color="#2e74b5"><b>Esquema</b></font> <br><br><img src="https://habrastorage.org/webt/ys/ji/ct/ysjict_mkf-7kcsciptlw7du77y.png"><br><br>  <font color="#2e74b5"><b>Como funciona:</b></font> <br><br>  A plataforma CommVault √© implantada na rede como parte do servidor de gerenciamento CommServe e um servidor MediaAgent separado (√© recomend√°vel usar um servidor f√≠sico). <br><br>  Um agente (iDataAgent) √© instalado no servidor com o banco de dados PostgreSQL e suas pol√≠ticas de backup s√£o configuradas de acordo com os requisitos.  O iDataAgent coleta os dados necess√°rios, compacta, desduplica, se necess√°rio, criptografa e os transfere para o MediaAgent. <br><br>  Al√©m disso, os dados s√£o colocados no sistema de armazenamento, em uma biblioteca de fitas ou no armazenamento em nuvem. <br>  Para recupera√ß√£o, os dados s√£o extra√≠dos do armazenamento e copiados para o servidor com o PostgreSQL. <br><br>  <font color="#2e74b5"><b>Configura√ß√£o no console do CommVault</b></font> <br><br>  Agora vamos ver como fazer isso no console de gerenciamento. <br><br>  1. Para iniciar o backup do banco de dados no momento, selecione no console do CommCell Browser: <br><br>  Computadores cliente |  |  PostgreSQL |  |  DumpBasedBackupSet. <br><br>  Clique com o bot√£o direito do mouse na pasta <b>padr√£o</b> no <b>subcliente</b> e selecione <b>Backup</b> . <br><br><img src="https://habrastorage.org/webt/q5/nm/uj/q5nmujdizcusqcmygdyfz_5xdtq.png"><br><br>  2. Selecione <b>Completo</b> como o tipo de backup e selecione <b>Imediato</b> . <br><br>  3. Clique em <b>OK</b> .  <b>O</b> backup do <b>PostgreSQL √© iniciado</b> . <br><br><img src="https://habrastorage.org/webt/zi/cn/ea/zicneazi3vlxtzvxq0nlth7whda.png"><br><br>  4. Durante a execu√ß√£o da tarefa, seu status pode ser monitorado pela janela <b>Tarefa do</b> console do <b>CommCell</b> . <br><br><img src="https://habrastorage.org/webt/dp/wm/cl/dpwmcly1yjwuwkdthl5fdg8kom4.png"><br><br>  5. Depois que a tarefa estiver conclu√≠da, voc√™ poder√° ver os detalhes da tarefa conclu√≠da na janela <b>Hist√≥rico de backup</b> .  Selecione a pasta <b>padr√£o</b> no <b>subcliente</b> e selecione <b>Hist√≥rico de backup</b> . <br><br><img src="https://habrastorage.org/webt/f8/ye/ju/f8yeju8l0lihgvro3kowl5ntgza.png"><br><br>  6. Na janela <b>Hist√≥rico de backup</b> , voc√™ pode ver os seguintes dados sobre as tarefas conclu√≠das: <br><br>  - Erros de backup ao concluir uma tarefa; <br>  - Itens que foram copiados com sucesso; <br>  - Detalhes da tarefa; <br>  - eventos; <br>  - arquivos de log; <br>  - M√≠dia na qual os dados est√£o armazenados. <br><br>  <font color="#2e74b5"><b>Por que voc√™ pode fazer backup</b></font> <br><br>  Backup baseado em despejo: <br><br><ul><li>  Bancos de dados do sistema PostgreSQL; </li><li>  Bancos de dados do usu√°rio PostgreSQL </li><li>  Fazendo backup de um sistema de arquivos (Backup Baseado em Sistema de Arquivos). </li></ul><br>  Bancos de dados PostgreSQL (dados e logs) (dados e logs): <br><br><ul><li>  Arquivos de log. </li></ul><br>  O que n√£o √© copiado: <br><br><ul><li>  Arquivos de aplicativos PostgreSQL (arquivos de aplicativos); </li><li>  Dados do sistema operacional. </li></ul><br>  Use o sistema de arquivos iDataAgent para fazer backup dos componentes acima. <br><br><h4>  <font color="#2e74b5">Desafio</font> </h4><br>  O cliente precisava implantar a plataforma CommVault para fazer backup de seus servi√ßos.  Um dos servi√ßos foi o banco de dados PostgreSQL, que foi implantado em uma configura√ß√£o de cluster de 2 n√≥s: Master e Standby.  Ambos trabalhavam em servidores f√≠sicos. <br><br>  <font color="#2e74b5"><b>Recursos de configura√ß√£o do PostgreSQL do cliente</b></font> <br><br>  A configura√ß√£o do cluster do PostgreSQL foi escolhida para garantir a toler√¢ncia a falhas do servidor de banco de dados. <br><br>  O cliente fez o backup do banco de dados PostgreSQL usando pg_dump. <br><br>  O esquema de trabalho √© apresentado na figura abaixo: <br><br><img src="https://habrastorage.org/webt/2q/cw/li/2qcwlitdhowursvmsnpc4jak7ec.png"><br><br><h4>  <font color="#2e74b5">Configurar backup com o CommVault</font> </h4><br>  Para unificar a plataforma de backup e aproveitar o armazenamento de backup, decidimos usar o CommVault para fazer backup do banco de dados PostgreSQL. <br><br>  Porque  o cliente usou a configura√ß√£o de cluster do PostgreSQL; para backup, decidimos usar a op√ß√£o Backup baseado em sistema de arquivos para backup de arquivos.  Ao mesmo tempo, tive que abandonar o uso do backup em bloco (Backup em n√≠vel de bloco), porque  A vers√£o do kernel Linux usada no qual o PostgreSQL √© implantado √© maior que o CommVault oficialmente suportado.  Devido ao fato de o servi√ßo ser cr√≠tico para a organiza√ß√£o, eles decidiram fazer um agendamento de backup de acordo com a tabela: <br><table><tbody><tr><th><br></th><th>  C√≥pia completa <br></th><th>  Logs de transa√ß√£o <br></th></tr><tr><td>  Graph <br></td><td>  Uma vez por dia, √†s 23 horas <br></td><td>  A cada hora por 24 horas </td></tr><tr><td>  Per√≠odo de armazenamento de c√≥pias <br></td><td>  7 dias <br></td><td>  1 dia <br></td></tr></tbody></table><br>  O volume total do banco de dados foi superior a 1,5 TB e, para manter o RTO e o RPO necess√°rios, uma rede LAN separada foi usada para backup a uma velocidade de 10 Gb / s. <br><br>  O backup foi realizado de acordo com o diagrama abaixo: <br><br><img src="https://habrastorage.org/webt/b4/j-/mv/b4j-mvywwwqd0c8_1qpr9rg6-hq.png"><br><br>  Os backups foram feitos em um servidor PostgreSQL Standby e armazenados em um servidor com o MediaAgent instalado.  Em seguida, uma vez por m√™s, c√≥pias completas eram carregadas na nuvem da Amazon para um prazo de validade de um ano. <br><br>  Todas as configura√ß√µes necess√°rias foram feitas e o backup foi bem-sucedido. <br><br>  <font color="#2e74b5"><b>Recursos de configura√ß√£o de backup do PostgreSQL</b></font> <br><br>  Ao instalar e configurar o backup, encontramos algumas dificuldades, listadas abaixo.  Eu acho que ser√° √∫til levar esses recursos em considera√ß√£o ao executar projetos semelhantes e ao configurar os administradores de banco de dados PostgreSQL. <br><br><ol><li>  Verifique se os n√≥s mestre e de espera t√™m as mesmas configura√ß√µes de servi√ßo do PostgreSQL definidas de acordo com a documenta√ß√£o do CommVault: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21491.htm</a> </li><li>  Verifique se os par√¢metros especificados na Solu√ß√£o de problemas de backup s√£o consistentes com os especificados pelos links: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21723.htm</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21518.htm</a> </li><li>  Verifique se os direitos de acesso ao servidor e aos bancos de dados foram definidos de acordo com os seguintes requisitos: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21523.htm</a> </li></ol><br>  <font color="#2e74b5"><b>Recupera√ß√£o</b></font> <br><br>  Fazer backup √© bom.  Naturalmente, estamos interessados ‚Äã‚Äãn√£o apenas no processo de sua cria√ß√£o, mas tamb√©m na restaura√ß√£o.  Pelo que est√° tudo feito. <br><br>  Nessa situa√ß√£o, a restaura√ß√£o, com base em nossa experi√™ncia, pode ser necess√°ria para o cliente em 2 casos: <br><br><ol><li>  Restaurar o banco de dados em um determinado momento, para acessar dados que, por exemplo, poderiam ser exclu√≠dos do banco de dados; </li><li>  Em caso de perda de todo o cluster do banco de dados PostgreSQL. </li></ol><br>  Para restaurar o banco de dados, basta ler a documenta√ß√£o neste link: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21502.htm</a> <br><br>  Tamb√©m focar√≠amos sua aten√ß√£o nos seguintes recursos e etapas durante a recupera√ß√£o: <br><br><ol><li>  SEMPRE siga o procedimento de recupera√ß√£o com o DBA do PostgreSQL.  Isso ajudar√° a evitar a√ß√µes erradas e a resolver rapidamente os problemas que surgem durante o processo de recupera√ß√£o; </li><li>  A recupera√ß√£o deve ser realizada em um n√≥ com a fun√ß√£o de Mestre; </li><li>  Ao restaurar, verifique se os servi√ßos do PostgreSQL n√£o s√£o iniciados ap√≥s a conclus√£o da opera√ß√£o; </li><li>  No n√≥ restaurado, altere as configura√ß√µes para a fun√ß√£o Mestre, porque  no nosso caso, fizemos backup de n√≥s em espera; </li><li>  Desative os servi√ßos no n√≥ em espera, ative-os no n√≥ mestre, ative o n√≥ em espera e configure a replica√ß√£o novamente. </li></ol><br><h4>  <font color="#2e74b5">Conclus√£o</font> </h4><br>  Neste artigo, n√£o levamos em considera√ß√£o o backup do pr√≥prio sistema operacional Linux e de outros sistemas.  Isso deve ser feito separadamente.  A documenta√ß√£o do CommVault descreve isso em detalhes.  Se nosso artigo despertar interesse e houver muitos desejos, descreveremos definitivamente como fazer backup de outros sistemas.  Escreva nos coment√°rios quais sistemas seriam do seu interesse. <br><br>  Esperamos que nossa experi√™ncia o ajude a configurar um backup pelo DBA do PostgreSQL. <br><br>  Autores: <br>  Sergey Alexandrov, Chefe do Grupo de Backup, Softline <br>  Artyom Khmelenko, Engenheiro L√≠der, Softline </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt442760/">https://habr.com/ru/post/pt442760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt442746/index.html">Aplicativo tolo para a Windows Store</a></li>
<li><a href="../pt442748/index.html">A coisa do chap√©u: os 10 principais relat√≥rios do Heisenbug 2018 em Moscou</a></li>
<li><a href="../pt442750/index.html">Djinn virtual em 8 de mar√ßo - ou como surpreender seus funcion√°rios em um dia de primavera</a></li>
<li><a href="../pt442754/index.html">Bancos de dados operacionais e anal√≠ticos: armazenamento de coluna x linha</a></li>
<li><a href="../pt442758/index.html">5 hacks vital√≠cios para otimizar consultas SQL no Greenplum</a></li>
<li><a href="../pt442762/index.html">O estagi√°rio Vasya e suas hist√≥rias sobre a API de idempot√™ncia</a></li>
<li><a href="../pt442764/index.html">Resumo do Gerenciamento de Produto. O que excita produtos e profissionais de marketing em 2019</a></li>
<li><a href="../pt442770/index.html">Vis√£o geral dos scanners de c√≥digo de barras JavaScript</a></li>
<li><a href="../pt442772/index.html">Matem√°tica para cientista de dados: se√ß√µes necess√°rias</a></li>
<li><a href="../pt442776/index.html">√çndices no PostgreSQL - 3 (Hash)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>