<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍕 🗝️ 🕍 ShIoTiny: Nassraumlüftung (Beispielprojekt) 🤟 🙋🏽 📘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wichtige Punkte oder worum es in diesem Artikel geht 
 Wir setzen die Artikelserie über ShIoTiny fort - eine visuell programmierbare Steuerung, die au...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ShIoTiny: Nassraumlüftung (Beispielprojekt)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464485/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/so/ox/uesoox7zwrguyei6o5m_ndp2ufw.jpeg"></div><br><h4>  Wichtige Punkte oder worum es in diesem Artikel geht </h4><br>  Wir setzen die Artikelserie über <b>ShIoTiny fort</b> - eine visuell programmierbare Steuerung, die auf dem <b>ESP8266-</b> Chip basiert. <br><br>  Dieser Artikel beschreibt ein Beispiel für ein Lüftungssteuerungsprojekt in einem Badezimmer oder einem anderen feuchten Raum zum Erstellen eines Programms für <b>ShIoTiny</b> . <br><br><h4>  Frühere Artikel in der Reihe. </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ShIoTiny: kleine Automatisierung, das Internet der Dinge oder „sechs Monate vor den Ferien“</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ShIoTiny: Knoten, Links und Ereignisse oder Funktionen von Zeichenprogrammen</a> <br><br><h4>  Referenzen </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>ShIoTiny-</b> Projektseite</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Binäre Firmware, Controller-Schaltung und Dokumentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen und Beschreibung der Knoten</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einrichten des MQTT-Brokers cloudmqtt.com</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MQTT Dashboard Control Panel für Android</a> <br><a name="habracut"></a><br><h4>  Einführung </h4><br>  Es gibt kein Verständnis außerhalb der Erfahrung.  Dies ist die Wahrheit, die von Zeit und Generationen geprüft wurde.  Daher gibt es nichts Besseres, um praktische Fähigkeiten zu erlernen, als zu versuchen, etwas selbst zu tun.  Beispiele, die zeigen, was getan werden kann und was es nicht wert ist, ausprobiert zu werden, sind hier hilfreich.  Die Fehler anderer Menschen können natürlich das Auftreten eigener Fehler nicht verhindern, können aber dazu beitragen, deren Anzahl zu verringern. <br><br>  Fragen und Briefe von Lesern früherer Artikel haben mich dazu inspiriert, ein kleines Projekt zu erstellen, ein Beispiel für die Lüftungssteuerung, um zu zeigen, wie die ShIoTiny-Knoten funktionieren. <br><br>  Die ursprüngliche Idee, auf deren Grundlage der <b>ShIoTiny-</b> Controller <b>erschien</b> - eine <b>Pump-</b> und Bewässerungsstation - ist <b>alles andere als</b> geeignet und wird interessant sein.  Daher habe ich für alle ein verständliches und viele nützliche Lüftungssteuerungssystem als Beispiel genommen. <br><br>  Ich werde sagen, dass die Idee des Projekts nicht meine ist, aber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ich habe sie von hier erhalten</a> und sie dann an <b>ShIoTiny</b> angepasst. <br><br><h4>  Verstehe zuerst, was du willst </h4><br>  Der Kultivierungsprozess ist endlos.  Und es war dieses Anwesen, das viele gute Ideen und Projekte ruinierte.  Der Entwickler hat es weiter verbessert, anstatt es zu veröffentlichen, wenn auch nicht als Ideal, sondern als funktionierende Sache.  Und er perfektionierte es, bis seine Konkurrenten es umgingen und eine ideale, wenn auch nicht funktionierende (und oft offen elende), aber funktionierende Lösung herausbrachten. <br><br>  Daher ist es sehr wichtig zu wissen, wo das Projekt beendet werden kann.  Mit anderen Worten, es ist notwendig zu bestimmen, was wir am Ende des Projekts von dem bekommen wollen, was wir am Anfang haben.  Auf Russisch gibt es für ein Dokument, das nur erstellt wurde, um die Art und Weise zu beschreiben, wie etwas erstellt werden soll, ein schönes kurzes und umfangreiches Wort „Plan“, das geistig zurückgebliebene Übersetzer und fehlerhafte Manager kürzlich aus irgendeinem Grund als „Road Map“ bezeichnet haben.  Nun, Gott segne sie. <br><br>  Unser Plan wird so sein.  Angenommen, es gibt einen Raum, in dem die Luftfeuchtigkeit manchmal dramatisch ansteigen kann.  Zum Beispiel wie ein Badezimmer oder eine Küche.  Feuchtigkeit ist eine unangenehme Sache und der Umgang damit ist so alt wie die Welt: Belüften Sie den Raum.  Es gibt einige Lüftungsmethoden.  Aber wir werden vielleicht exotische und altmodische Wege wie Schwarze mit Netzen ablehnen und beim üblichen Fan Halt machen.  Fans sind billiger und es ist einfacher, sie in unserer Gegend zu finden. <br><br>  Kurz gesagt, wir möchten den Lüfter steuern: Schalten Sie ihn ein bzw. aus.  Genauer gesagt möchten wir, dass es bei Bedarf ein- und ausgeschaltet wird. <br><br>  Es bleibt zu bestimmen: Unter welchen Bedingungen sollte sich der Lüfter einschalten und unter welchen Bedingungen - ausschalten. <br><br>  Hier ist alles klar: Wenn die Luftfeuchtigkeit über einem vorgegebenen Grenzwert liegt, schaltet sich der Lüfter ein und saugt Luft an.  Die Luftfeuchtigkeit hat sich wieder normalisiert - der Lüfter schaltet sich aus. <br><br>  Der aufmerksame Leser wird sofort auf das Wort "gegeben" aufmerksam.  Wer ist gegeben?  Wie voreingestellt? <br><br>  Es gibt verschiedene Möglichkeiten, die Schwellenfeuchtigkeit einzustellen.  Wir werden zwei davon betrachten: die erste - mit Hilfe des variablen Widerstands und die zweite - über das Netzwerk über das MQTT-Protokoll.  Jedes dieser Verfahren hat Vor- und Nachteile, auf die später eingegangen wird. <br><br>  Für diejenigen, die nicht verstehen, werde ich erklären, dass die „Schwellenfeuchtigkeit“ ein Feuchtigkeitsniveau ist, dessen Überschreitung die Einbeziehung eines Lüfters erfordert. <br><br>  Die nächste Frage ist, ob dem Benutzer das Recht eingeräumt werden soll, den Lüfter direkt einzuschalten.  Das heißt, unabhängig von der Luftfeuchtigkeit, auf Knopfdruck?  Wir werden für eine solche Gelegenheit sorgen.  Schließlich kann ein Ventilator nicht nur bei hoher Luftfeuchtigkeit benötigt werden, sondern auch, um beispielsweise einen unangenehmen Geruch, der im Volksmund als „Gestank“ bezeichnet wird, aus dem Raum zu entfernen. <br><br>  Also haben wir verstanden, was wir wollen und sogar ein wenig, wie es funktionieren wird.  Wir listen kurz alle Funktionen unseres Lüftungssteuerungssystems auf: <br><br><ul><li>  Einstellen eines Feuchtigkeitsschwellenwerts (zwei Optionen); </li><li>  Feuchtemessung; </li><li>  automatische Einbeziehung des Lüfters; </li><li>  automatische Abschaltung des Lüfters; </li><li>  manuelle Aufnahme des Lüfters (auf Knopfdruck). </li></ul><br>  Der Plan ist also klar.  Es ist notwendig, alle oben genannten Funktionen in unserem Programm zu implementieren.  Auf der Grundlage dieses „Plans“ werden wir handeln.  Zeichnen Sie zunächst ein Blockdiagramm des Geräts. <br><br><h4>  Geräteblockdiagramm </h4><br>  Im Allgemeinen werden wir zwei solche Schemata haben.  Die erste betrifft die Option, bei der der Feuchtigkeitsschwellenwert durch einen variablen Widerstand eingestellt wird.  Das zweite Schema betrifft die Option, bei der der Feuchtigkeitsschwellenwert über das Netzwerk über das MQTT-Protokoll eingestellt wird. <br><br>  Da sich diese Schaltkreise jedoch nur durch ein Element unterscheiden - den variablen Widerstand "Einstellen des Feuchtigkeitsschwellenwerts" - werden wir nur ein Strukturdiagramm zeichnen.  Natürlich sieht das Strukturschema nach GOST anders aus.  Wir konzentrieren uns jedoch nicht auf Bisoningenieure, sondern auf die jüngere Generation.  Daher ist die Sichtbarkeit wichtiger. <br><br><img src="https://habrastorage.org/webt/ut/qh/db/utqhdblfgdlmsv0rkcgqxaztvo8.jpeg"><br><br>  Was sehen wir auf dem Bild?  Der Lüfter ist mit dem <b>Relais</b> Relais 1 des <b>ShIoTiny-</b> Controllers verbunden.  Ich mache Sie darauf aufmerksam, dass der Lüfter ein Gerät ist, das unter Hochspannung lebt.  Deshalb, wenn jemand dies selbst tun wird - seien Sie vorsichtig.  Zumindest bevor Sie Ihre Finger oder Messinstrumente in den Stromkreis stecken - trennen Sie mindestens den Lüfter.  Und der zweite Punkt.  Wenn Ihr Lüfter stärker als <b>250 W ist</b> , <b>sollten</b> Sie <b>ihn</b> nicht direkt an <b>ShIoTiny anschließen</b> - nur über den Anlasser. <br><br>  Wir haben den Ventilator herausgefunden.  Nun die Taste "Manuell ein" des Lüfters.  Es ist mit dem Eingang <b>Input1 verbunden</b> .  Es gibt nichts mehr zu erklären. <br><br>  Temperatur- und Feuchtigkeitssensor <b>DHT-11</b> (oder <b>DHT-22</b> oder deren Analoga).  Zum Anschließen wird am <b>ShIoTiny-</b> Controller ein spezieller Eingang bereitgestellt.  Wie Sie in der Abbildung sehen können, ist der Anschluss eines solchen Sensors ebenfalls kein Problem. <br><br>  Und schließlich ein variabler Widerstand, der den Feuchtigkeitsschwellenwert festlegt.  Genauer gesagt, ein Teiler, der aus variablen und konstanten Widerständen besteht.  Es gibt keine Probleme mit der Verbindung, aber ich werde erklären, dass der eingebaute ADC am <b>ESP8266</b> für maximal 1 Volt ausgelegt ist.  Daher wird ein Spannungsteiler etwa fünfmal benötigt. <br><br>  Und noch einmal, ich erinnere Sie daran, dass dieser Teiler nicht benötigt wird, wenn der Schwellenwert für die Luftfeuchtigkeit über das Netzwerk mithilfe des MQTT-Protokolls eingestellt wird. <br><br>  Wir werden beginnen, den Algorithmus des Geräts im ElDraw ShIoTiny-Editor zu erstellen.  Wie Sie dorthin gelangen, können Sie in diesem Editor in den Artikeln früher oder in den Anweisungen lesen, auf die am Anfang des Artikels verwiesen wird. <br><br><h4>  Option eins, die einfachste </h4><br>  Beginnen wir mit einem einfachen: <b>Schalten Sie</b> das <b>Relais1-</b> Relais ein, <b>wenn</b> der Schwellenwert für die Luftfeuchtigkeit für eine bestimmte Zeit überschritten wird. <br><br><img src="https://habrastorage.org/webt/un/8e/kd/un8ekdrb8cy8zvbc6e_ae2ygwyw.png"><br><br>  Wie Sie sehen, nichts Kompliziertes: nur vier Knoten, ohne die Kommentarknoten.  <b>DHT11</b> ist eigentlich ein Temperatur- und Feuchtigkeitssensor (kann in <b>DHT22</b> geändert <b>werden</b> ). <br><br>  Die <b>CONST-Konstante</b> ist der Schwellenfeuchtigkeitsgehalt in Prozent. <br><br>  Komparator - Ein Knoten, der zwei Zahlen vergleicht und Ausgang 1 setzt, wenn die angegebene Bedingung erfüllt ist, und 0, wenn die Bedingung nicht erfüllt ist. <br><br>  In unserem Fall ist diese Bedingung <b>A&gt; B</b> , wobei <b>A</b> das vom Sensor gemessene Feuchtigkeitsniveau und <b>B</b> das Schwellenniveau derselben Luftfeuchtigkeit ist. <br><br>  Sobald die gemessene Luftfeuchtigkeit ( <b>A</b> ) die Luftfeuchtigkeitsschwelle ( <b>B</b> ) überschreitet, erscheint sofort 1 am Ausgang des Komparators <b>A&gt; B</b> und das Relais schaltet sich ein.  Umgekehrt erscheint unmittelbar am Ausgang des Komparators <b>A&gt; B</b> 0 und das Relais schaltet sich aus, sobald der Feuchtigkeitsgehalt wieder normal ist (dh <b>A &lt;= B</b> ). <br><br>  Alles klar?  Wem es nicht so ist - lesen Sie noch einmal oder sehen Sie sich die Beschreibung der Funktionsweise der Knoten in der Anleitung an. <br><br>  Ich <b>stelle</b> fest, dass die Daten vom <b>DHT11-</b> Sensor ungefähr alle 10 Sekunden aktualisiert werden.  Daher kann das Relais nicht öfter als einmal alle 10 Sekunden ein- und ausgeschaltet werden. <br><br>  Alles wäre in Ordnung, aber wir möchten den Feuchtigkeitsschwellenwert mit einem variablen Widerstand einstellen.  Nichts ist einfacher! <br><br><img src="https://habrastorage.org/webt/ez/qe/oi/ezqeoioucwwf0nm90o2sibwizj0.png"><br><br>  Ersetzen Sie einfach den konstanten Knoten durch den ADC-Knoten.  Schließlich haben wir den Spannungsteiler an den ADC mit einem variablen Widerstand angeschlossen. <br><br>  Die Spannung am ADC-Eingang variiert zwischen 0 und 1 Volt.  Die Luftfeuchtigkeit am Ausgang des Sensors variiert jedoch zwischen 0 und 100%.  Wie vergleichen wir sie?  Alles ist einfach.  Der ADC-Knoten in <b>ShIoTiny</b> misst nicht nur die Eingangsspannung, sondern weiß auch, wie sie <i><b>skaliert und verschoben wird</b></i> . <br><br>  Das heißt, am Ausgang des ADC1-Knotens (ADC) befindet sich ein <b>X-</b> Wert, der durch die Formel berechnet wird <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.014ex" height="2.419ex" viewBox="0 -780.1 7755.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-58" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMAIN-3D" x="1130" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-6B" x="2186" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-63" x="2958" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-64" x="3391" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-6F" x="3915" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-74" x="4400" y="0"></use><g transform="translate(4762,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-6E" x="345" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMAIN-2B" x="6325" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-62" x="7326" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> X = k \ cdot u_ {in} + b </script></p>  wo <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> u_ {in} </script>  - Spannung am ADC-Eingang (von 0 bis 1 V);  <b>k</b> - Bereich (ADC-Bereich) und <b>b-</b> Offset (ADC-Offset).  Wenn Sie also <b>k = 100</b> und <b>b = 0 setzen</b> , dann beim Ändern <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjqrAn-PnY3N9PYTcim1-9qBOX-YA#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> u_ {in} </script>  im Bereich von 0 bis 1 variiert der Wert von <b>X</b> am Ausgang der ADC-Einheit im Bereich von 0 bis 100. Das heißt, numerisch gleich dem Bereich der Feuchtigkeitsänderungen von 0 bis 100%. <br><br>  Oder Sie können einfach durch Drehen des Motors mit variablem Widerstand den Luftfeuchtigkeitsschwellenwert von 0 bis 100 einstellen. Der einzige Nachteil ist, dass keine Anzeigegeräte vorhanden sind.  In der Praxis reicht dies jedoch aus, um den Schwellenwert für die Luftfeuchtigkeit festzulegen, wenn der Motor mit variablem Widerstand 6 Unterteilungen (0%, 20%, 40%, 60%, 80%, 100%) vornimmt. <br><br>  Wie stellen wir die Koeffizienten <b>k</b> - Bereich (ADC-Bereich) und <b>b -</b> Versatz (ADC-Versatz) ein?  Ja, es ist einfacher als gedämpfte Rüben!  Klicken Sie mit dem Mauszeiger in den <b>ADC1-</b> Knoten und Sie sehen sofort das Einstellungsfenster.  Darin können Sie alles einstellen, was Sie brauchen.  In unserem Fall handelt es sich um ein solches Fenster wie in der Abbildung. <br><br><img src="https://habrastorage.org/webt/cn/so/ub/cnsoubc9q_rhu-2p6hlffcd_1ig.png"><br><br>  Wir haben also die einfachste Arbeitslösung.  Beginnen wir damit, es zu verbessern. <br>  Die einfachste Lösung hat übrigens einen Vorteil: Sie benötigt kein Internet.  Es ist völlig autonom. <br><br><h4>  Option zwei, verbinden Sie die Taste </h4><br>  Alles funktioniert und jeder ist glücklich.  Aber Pech, wir können die Belüftung nicht mit Gewalt einschalten.  Wir haben bereits vereinbart, dass eine Taste an den Eingang <b>Input1 angeschlossen wird</b> , wodurch der Lüfter gewaltsam <b>ein-</b> und ausgeschaltet wird, ohne auf den Feuchtigkeitssensor zu achten. <br>  Es ist Zeit, diese Schaltfläche in unserem Schaltungsprogramm zu verarbeiten. <br><br><img src="https://habrastorage.org/webt/rn/9h/p8/rn9hp8-41uqwkms65uqiwynd_-k.png"><br><br>  Die Schaltflächenklick-Verarbeitungseinheit ist in einer orangefarbenen Linie hervorgehoben.  Es handelt sich um einen Schaltflächenzähler, der auf Null zurückgesetzt wird, wenn der Wert an seinem Ausgang eins überschreitet (grüne Linie, <b>CT-</b> Knotenausgang). <br><br>  Hier funktioniert alles so einfach wie zuvor: Der <b>CT-</b> Zähler zählt die Klicks der mit <b>Input1</b> verbundenen <b>Taste</b> .  Das heißt, der Wert am Ausgang dieses Zählers erhöht sich mit jedem Klick auf die Schaltfläche um 1. <br><br>  Sobald dieser Wert gleich zwei wird (dh mehr als 1), erscheint unmittelbar am Ausgang des Komparators <b>A&gt; B</b> 1. Und diese 1 setzt den Zähler <b>CT</b> auf Null zurück.  Dies bedeutet den Komparator, den unteren nach dem Schema! <br><br>  Daher hat unsere Schaltfläche zwei Zustände - 0 und 1. Wenn wir mehr Zustände benötigen (3 oder 4 oder sogar mehr), würde es ausreichen, die <b>CONST-</b> Konstante von einem auf einen anderen Wert zu ändern. <br><br>  Wir haben also zwei Bedingungen, um den Lüfter einzuschalten: Überschreiten der eingestellten Luftfeuchtigkeit und einmaliges Drücken der Taste.  Wenn eine der Bedingungen erfüllt ist, schaltet sich der Lüfter ein.  Und es funktioniert, bis die Taste erneut gedrückt wird <b>UND</b> die Luftfeuchtigkeit wieder normal ist. <br><br>  Sie können den Algorithmus natürlich noch komplizierter machen, aber wir werden dies nicht tun - wir werden denjenigen, die es wünschen, Raum für Kreativität lassen. <br><br><h4>  Option Drei: Stellen Sie eine Verbindung zum Internet her </h4><br>  Alles, was wir beschrieben haben, ist ziemlich funktional.  Aber was ist mit der Show?  Schließlich lacht jeder pickelige Hipster-Hacker-Cracker über jemanden, der einen Stift dreht und einen Knopf drückt und ihn nicht von einem Smartphone aus steuert!  Das Drehen des Griffs ist „nicht in Mode“.  Aber um Ihren Finger auf dem Smartphone zu kriechen und diesen Finger ins Blut zu löschen - hier ist der Höhepunkt der Wünsche des Hipster-Hacker-Crackers (ich konnte nie alle unterscheiden - also, wenn ich einen Fehler gemacht habe, tut es mir leid). <br><br>  Aber wir werden uns diesen Individuen herablassen.  Internet Governance hat echte Vorteile.  Erstens ist es visuell.  Es gibt viele Anwendungen für alle Plattformen, mit denen ein paar Stöße ein vollständig verwendbares Bedienfeld für unseren Carlson-Controller erstellen können.  Zweitens ist es eine Möglichkeit, den Feuchtigkeitszustand im Raum aus der Ferne zu überwachen.  Und drittens können Sie nicht nur sehen, was der Lüfter tut - ob er sich dreht oder nicht, sondern auch, welche Feuchtigkeitsschwelle eingestellt ist.  Und dann - der Lüfter wird automatisch oder manuell eingeschaltet.  Im Allgemeinen was auch immer Sie wollen. <br><br>  Natürlich gibt es für einige Fans viel Ehre - so viel Aufmerksamkeit.  Dies ist jedoch nur ein Beispiel. <br><br>  Für die Verbindung zum Internet verwenden wir die <b>MQTT-</b> Technologie und das gleichnamige Protokoll. <br>  Um diese Technologie nutzen zu können, benötigen wir einen <b>MQTT-Broker</b> .  Dies ist ein solcher spezieller Server, der <b>MQTT-Clients bedient</b> , z. B. <b>ShIoTIny</b> und Ihr Smartphone. <br><br>  Das Wesentliche der <b>MQTT-</b> Technologie ist, dass jeder Client beliebige Daten unter einem bestimmten Namen (in der <b>MQTT-</b> Terminologie als <b>Thema bezeichnet</b> ) auf einem MQTT-Broker (Server) veröffentlicht.  Andere Kunden können beliebige Daten mit ihrem Namen ( <b>Thema</b> ) abonnieren und neu veröffentlichte Daten erhalten.  Das heißt, der gesamte Datenaustausch erfolgt nach dem Prinzip Client-Broker-Client. <br><br>  Ich <i><b>werde</b></i> mich <i><b>nicht</b></i> auf die Details konzentrieren.  Im Internet gibt es unzählige Artikel und Tutorials darüber, wie <b>MQTT</b> funktioniert und welche Programme es zum Erstellen von Control Panels gibt.  Ich zeige Ihnen nur, wie Sie Daten mit <b>ShIoTiny</b> empfangen und veröffentlichen. <br><br>  Als Broker habe ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.cloudmqtt.com verwendet</a> , aber das Prinzip ist überall dasselbe. <br><br>  Wir gehen also davon aus, dass Sie sich beim <b>MQTT-Broker</b> registriert haben.  Im Allgemeinen gibt Ihnen der Broker einen Benutzernamen und ein Passwort (zur Autorisierung) sowie einen Port für die Verbindung (oder muss diese erfinden).  <b>Es</b> gibt zwei Möglichkeiten, <b>ShIoTiny</b> mit dem <b>MQTT-Broker</b> zu verbinden <b>:</b> reguläre Verbindung und <b>TLS</b> ( <b>SSL</b> ). <br><br>  Alle diese Parameter in <b>ShIoTiny</b> werden auf der Registerkarte <b>Netzwerk</b> im Abschnitt <b>MQTT-Verbindung zum Server</b> eingegeben. <br><br><img src="https://habrastorage.org/webt/97/6j/kb/976jkbemm294uso3-pjdcb4wx_4.png"><br><br>  Wenn Ihr <b>MQTT-Broker</b> keine Autorisierung benötigt, geben Sie Ihr Login und Passwort nicht ein (lassen Sie diese Felder leer). <br><br>  Der <b>MQTT-Themenpräfixparameter</b> erfordert eine separate Erläuterung. <br><br>  Das Präfix der MQTT-Parameter ist eine Zeile, die dem Titel des Themas hinzugefügt wird, wenn der MQTT-Broker veröffentlicht und abonniert wird.  Um das <b>MQTT-Präfix</b> für Ihren Controller <b>festzulegen</b> , müssen Sie es nur in das Eingabefeld " <b>MQTT-Themenpräfix</b> " (" <b>MQTT-Themenpräfix</b> ") eingeben.  Das Präfix beginnt immer mit einem Schrägstrich ( <b>"/"</b> )!  Wenn Sie im Eingabefeld keinen Schrägstrich eingeben, wird dieser automatisch hinzugefügt.  Die Zeichen <b>"#"</b> und <b>"+"</b> können im Präfix nicht verwendet werden.  Es gibt keine weiteren Einschränkungen. <br><br>  Wenn Sie beispielsweise den Parameter " <b>status</b> " veröffentlichen (oder abonnieren) und Ihr Präfix auf " <b>/ shiotiny /</b> " gesetzt ist, wird dieser Parameter auf dem Broker unter dem Namen " <b>/ shiotiny / status</b> " veröffentlicht.  Wenn Sie ein leeres Präfix festgelegt haben, beginnen alle Parameter auf dem Broker mit einem Schrägstrich ( <b>"/"</b> ): " <b>status</b> " wird als " <b>/ status</b> " veröffentlicht. <br><br>  Wir glauben, dass Sie sich beim <b>MQTT-Broker</b> registriert und Ihr Login, Passwort und Ihren Port erhalten haben.  Anschließend legen Sie diese Parameter auf der Registerkarte <b>Netzwerk</b> im <b>Abschnitt</b> <b>MQTT-Verbindung zum Server</b> <b>des ShIoTiny-</b> Controllers fest. <br><br>  Wir glauben, dass das Präfix auf " <b>/ room /</b> " gesetzt ist. <br><br>  Zunächst veröffentlichen wir den Status aller wichtigen Parameter: <b>Realay1-</b> Relais, manueller <b>Einschaltzustand</b> , automatischer <b>Einschaltzustand</b> und schließlich Schwellenwert und aktuelle Luftfeuchtigkeit.  Gut und ein Bonus - die Temperatur im Raum.  Wie das geht, siehe Abbildung. <br><br><img src="https://habrastorage.org/webt/tq/xj/la/tqxjla44g3klhb_apkinf7yudka.png"><br><br>  Wie Sie sehen können, besteht der Unterschied zur vorherigen Version nur in den <b>MQTT-Veröffentlichungsknoten</b> .  Mit dem Präfix werden folgende Parameter veröffentlicht: <br><img src="https://habrastorage.org/webt/hr/9c/wd/hr9cwdccjlb3tnpkgm2g7grdyhe.jpeg"><br><br>  Wie Sie sehen können, ist der gesamte Status des Systems in voller Sicht! <br><br>  Wir wollen aber nicht nur sehen, sondern auch kontrollieren.  Wie man ist  Sehr einfach.  Wir werden es ablehnen, den Schwellenwert für die Luftfeuchtigkeit mithilfe des <b>ADC</b> und eines variablen Widerstands einzustellen, und wir werden diesen Schwellenwert für die Luftfeuchtigkeit per <b>MQTT</b> direkt vom Smartphone aus einstellen! <br><br><img src="https://habrastorage.org/webt/dr/e3/yw/dre3ywd0uyw_cjtw8tnzr-doicq.png"><br><br>  Wir entfernen den ADC-Knoten aus der Schaltung und fügen dort drei neue Knoten hinzu: <b>FLASH-Speicher</b> , <b>FLASH-Wiederherstellung</b> und <b>MQTT-Beschreibung</b> . <br><br>  Die Funktion des <b>MQTT-Beschreibungsknotens</b> liegt auf der Hand: Er empfängt den <b>Parameter / room / trigHset</b> (Schwellenfeuchtigkeitsstufe) vom <b>MQTT-Broker</b> .  Aber was macht er als nächstes mit den Daten?  Es gibt sie einfach an den <b>FLASH-Speicherknoten weiter</b> , der diese Daten wiederum im nichtflüchtigen Speicher unter dem Namen <b>trigH speichert</b> .  Danach liest der <b>FLASH-Wiederherstellungsknoten</b> Daten unter dem Namen <b>trigH</b> aus dem nichtflüchtigen Speicher und wir wissen bereits, was als nächstes passiert. <br><br>  Warum solche Schwierigkeiten?  Warum kann ich die empfangenen Daten nicht sofort an den Eingang des Komparators senden? <br><br>  Wie Genosse S. Holmes sagte, ist <i>dies elementar</i> !  Niemand garantiert, dass Ihr Gerät nach dem Einschalten dem <b>MQTT-Broker beitritt</b> .  Und die Luftfeuchtigkeit muss gemessen werden.  Und der Lüfter muss eingeschaltet sein.  Ohne Angaben zum Luftfeuchtigkeitsschwellenwert ist dies jedoch nicht möglich!  Daher extrahiert unser Gerät beim Einschalten einen zuvor gespeicherten Schwellenfeuchtigkeitsgehalt aus dem nichtflüchtigen Speicher und verwendet ihn zur Entscheidungsfindung.  Wenn die Verbindung zum <b>MQTT-Broker hergestellt ist</b> und jemand einen neuen Wert <b>/ room / trigHset veröffentlicht</b> , wird dieser neue Wert verwendet. <br><br>  Dann können Sie alles erfinden, was Sie wollen.  Geben Sie beispielsweise neben der Luftfeuchtigkeit auch einen Temperaturrekord ein.  Oder fügen Sie eine „intelligente“ Lichtsteuerung hinzu (wir haben noch zwei Relais und zwei Eingänge ungenutzt gelassen).  Alles liegt in Ihren Händen! <br><br><h4>  Fazit </h4><br>  Daher haben wir uns einige Beispiele für die Implementierung des einfachsten Controllers angesehen, der auf ShIoTiny basiert.  Vielleicht ist es für jemanden nützlich. <br><br>  Wie immer Vorschläge, Wünsche, Fragen, Tippfehler usw. per E-Mail: <b>shiotiny@yandex.ru</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464485/">https://habr.com/ru/post/de464485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464465/index.html">Wie und warum haben wir Preply nach Kubernetes migriert?</a></li>
<li><a href="../de464467/index.html">Lernen Sie Webanalysen von Grund auf neu. Große Auswahl</a></li>
<li><a href="../de464471/index.html">SNMP-Druckerüberwachung in The Dude</a></li>
<li><a href="../de464479/index.html">"Manifest von Programmieranfängern aus verwandten Fachgebieten" oder wie ich zu einem solchen Leben kam</a></li>
<li><a href="../de464481/index.html">Wie wir im Studio ein Trainings- und Motivationssystem aufgebaut haben</a></li>
<li><a href="../de464487/index.html">Wir bauen eine Schnittstelle für die Eingabe von Dokumenten durch Auswahl</a></li>
<li><a href="../de464489/index.html">Buildbot in Beispielen</a></li>
<li><a href="../de464491/index.html">Vivaldi 2.7 - Intensives Leben in der Stille</a></li>
<li><a href="../de464495/index.html">Teamentwicklung und Reflexion als Managementkommunikation des Teamleiters</a></li>
<li><a href="../de464497/index.html">JIRA als Heilmittel gegen Schlaflosigkeit und Nervenzusammenbrüche</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>