<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§±üèæ ‚û°Ô∏è üí∏ Autenticaci√≥n de hardware del dispositivo Linux en sistemas de nivel superior üí™ üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® üöµüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Industrial IoT es monitoreo, programaci√≥n y automatizaci√≥n de sistemas de ingenier√≠a de instalaciones industriales, edificios, instalaciones comercial...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Autenticaci√≥n de hardware del dispositivo Linux en sistemas de nivel superior</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/476304/">  Industrial IoT es monitoreo, programaci√≥n y automatizaci√≥n de sistemas de ingenier√≠a de instalaciones industriales, edificios, instalaciones comerciales.  Los sensores de varios par√°metros, medidores y controladores recopilan datos de estos objetos, por ejemplo, temperatura y humedad en la sala de servidores, medidores de agua en edificios de apartamentos, el nivel de di√≥xido de carbono en las habitaciones.  Los controladores procesan esta informaci√≥n y env√≠an todo a la "nube". <br><br>  Wiren Board fabrica controladores de Linux para IoT industrial.  Los dispositivos recopilan datos de pozos petroleros y sucursales bancarias, monitorean el microclima en servidores y supermercados.  Los controladores se integran con los sistemas de nivel superior de los socios de la compa√±√≠a.  Los sistemas autentican dispositivos: entienden que est√°n hablando con su sensor y no con el de otra persona, y luego lo autorizan.  En esta etapa, surge un problema: hay miles de controladores, cientos de clientes, pero no hay un √∫nico sistema de integraci√≥n.  Los m√©todos tradicionales simples, como los pares de inicio de sesi√≥n / contrase√±a, son vulnerables a los ataques e inc√≥modos de implementar. <br><br><img src="https://habrastorage.org/webt/sk/xm/mt/skxmmtcf6uhcrlm0xkcqilqwjuo.jpeg"><br><br>  Por lo tanto, la compa√±√≠a desarroll√≥ la autenticaci√≥n en sistemas de nivel superior utilizando claves de hardware, basadas en criptograf√≠a asim√©trica est√°ndar utilizando un elemento protegido por hardware para almacenar claves.  Ahora no se necesita un sistema de integraci√≥n unificado: la autenticaci√≥n y la autorizaci√≥n est√°n protegidas y funcionan de inmediato.  <b>Evgeny Boger</b> le dir√° c√≥mo hacer esto: c√≥mo eligieron el "chip de cifrado", c√≥mo lo atornillaron al hardware y Linux, c√≥mo se hicieron las bibliotecas y el software comunes para ser amigos de √©l.  Especial √©nfasis en la implementaci√≥n: la introducci√≥n de la inicializaci√≥n del dispositivo en producci√≥n, la introducci√≥n de soporte para varios software de nivel superior, incluso en el de otra persona y cerrado. <br><a name="habracut"></a><br>  <b>Sobre el orador:</b> <b>Eugene Boger</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">evgeny_boger</a> ) - CTO y cofundador de Wiren Board.  Comprometido en sistemas embebidos y, especialmente, Linux embebido. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/tbXmNAs5IrM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Los problemas </h2><br>  Para empezar, qu√© estamos haciendo y de d√≥nde vino este problema.  En Wiren Board dise√±amos y fabricamos equipos en Rusia.  Sol√≠a ‚Äã‚Äãllamarse M2M, pero ahora - IoT industrial.  Esta es la automatizaci√≥n de sistemas de ingenier√≠a de edificios, monitoreo y programaci√≥n.  Brevemente, todo el trabajo se ve as√≠: los sensores de varios par√°metros, actuadores, contadores y controladores (edge-computing o IoT-gateway) recopilan diferentes datos de los objetos, los procesan, ejecutan la l√≥gica local y luego los re√∫nen en un gran sistema de despacho, monitoreo o control . <br><br><img src="https://habrastorage.org/webt/ns/fh/xa/nsfhxa9qezcmcuuc9y8kijenyhw.jpeg"><br><br>  No tenemos un ecosistema completo, a diferencia de algunos competidores.  Fabricamos equipos que se integran con varios sistemas de alto nivel de nuestros socios.  Hay muchas empresas asociadas y comparten la responsabilidad.  Sin buenos medios t√©cnicos, la integraci√≥n no funcionar√°, simplemente no se puede negociar. <br><br>  Hay dos soluciones simples para resolver estos problemas.  El primero es <b>dar el nombre de usuario / contrase√±a al cliente</b> , como todos lo hacen, y el segundo es <b>generar y coser el "secreto" en el lugar de trabajo</b> .  Ambas opciones no nos conven√≠an. Te dir√© por qu√©. <br><br><h2>  Soluciones simples </h2><br>  <b>La primera soluci√≥n es emitir un nombre de usuario y contrase√±a para el cliente</b> .  Todos lo hacemos hasta hace poco. <br><br>  Para autenticar un dispositivo que env√≠a datos a alg√∫n sistema, puede crear una clave secreta: inicio de sesi√≥n / contrase√±a condicional ("secreto").  Ser√° com√∫n en los controladores y en un sistema de nivel superior que recopila datos de varios controladores. <br><br>  Un par de nombre de usuario / contrase√±a (un "secreto" com√∫n) debe de alguna manera ser entregado al cliente, la empresa o la persona.  Alguien debe generar un par secreto, enviarlo por correo electr√≥nico, autenticar al cliente por n√∫mero de cuenta.  Este es el procedimiento est√°ndar: baja tecnolog√≠a. <br><br>  <b>Problema</b>  Es que tenemos muchos de esos sistemas.  Nuestro cliente, y √©l puede enviar datos al sistema de nuestro socio.  Esta es una interacci√≥n compleja entre todas las partes involucradas. <br><br>  Adem√°s del problema de muchos sistemas, hay otros. <br><br><ul><li>  <b>Mala entrega y entrega al cliente</b> . <br></li><li>  <b>Los inicios de sesi√≥n y las contrase√±as se almacenan en el servidor</b> .  Si tambi√©n almacenamos hashes, esto nos proteger√° un poco de las fugas.  Pero aun as√≠, surge una sensaci√≥n desagradable cuando las claves secretas para todos los controladores de clientes se almacenan en el servidor.  Algunos de ellos pueden ocuparse de tareas cr√≠ticas: iluminaci√≥n exterior, monitoreo de plataformas petroleras. <br></li><li>  <b>Sincronizaci√≥n entre servicios</b> . <br></li><li>  <b>Recuperaci√≥n de p√©rdidas</b> .  No est√° claro qu√© hacer en caso de p√©rdida, cuando el cliente borr√≥ la memoria del controlador, ¬øen qu√© memoria debo escribir?  Tienes que repetirlo de nuevo. <br></li><li>  <b>Protecci√≥n contra copia de detalles</b> .  Existen sistemas de monitoreo pagados que brindan al cliente un servicio y cobran tarifas de suscripci√≥n.  No quiero que el cliente final pueda evitar el sistema de alguna manera: pague una vez, pero use dos. <br></li></ul><br>  <b>La segunda soluci√≥n es generar y coser un "secreto" en la producci√≥n</b> .  Esta es una mejora con respecto a la soluci√≥n anterior. <br><br>  El esquema es este: nosotros, como fabricante de controladores, pregeneramos nombres de usuario y contrase√±as para todos, los cosemos en nuestro sistema y los ingresamos en el equipo.  Los inicios de sesi√≥n y las contrase√±as del equipo no se pueden leer ni modificar.  Esto es mejor que la opci√≥n anterior, ya que no requiere interacci√≥n entre las personas. <br><br>  <b>Los problemas</b>  Todos los problemas persisten, excepto el primero, pero el principal es la <b>sincronizaci√≥n entre los servicios y la intranet</b> .  Hay muchos servicios y no est√° claro c√≥mo sincronizarlos; debido a esto, no pudimos implementar la segunda soluci√≥n.  Tenemos clientes que usan equipos en sus redes cerradas.  Lanzamos un nuevo controlador, lo vendimos a un cliente y su sistema est√° cerrado.  Est√° configurado, funciona una vez y es dif√≠cil transmitir a√∫n m√°s los "secretos".  ¬øInformar en lotes?  Todo es complicado en las organizaciones, aunque t√©cnicamente simple. <br><br>  Ambas soluciones no nos conven√≠an.  Por lo tanto, decidimos tomar un camino diferente.  Pero antes de eso decidieron esbozar metas y objetivos comunes. <br><br><h2>  Tareas y objetivos </h2><br>  Primeras tareas comunes. <br><br>  <b>Autenticaci√≥n</b>  Esta es una forma de entender qui√©n est√° hablando con el sistema de nivel superior, qui√©n se conecta exactamente al sistema de despacho. <br><br><blockquote>  La autenticaci√≥n no es otorgar o delimitar los derechos de acceso, sino una forma de entender qui√©n nos est√° hablando. </blockquote><br>  <b>La tarea de enviar datos</b> .  Nuestros controladores son computadoras Linux dise√±adas para una tarea especial.  Los necesitamos para enviar datos a sistemas de nivel superior, conectarse a trav√©s de VPN.  Al mismo tiempo, queremos que el env√≠o funcione de forma inmediata, sin la configuraci√≥n ni la interacci√≥n de nuestros clientes y usuarios finales del sistema con nosotros y con los clientes. <br><br>  <b>Otras tareas</b>  Esta es una conexi√≥n confiable, encriptaci√≥n del canal de datos, pero un problema separado es la <b>autorizaci√≥n</b> .  La tarea de autorizaci√≥n est√° asociada con servicios externos y se divide en tres partes. <br><br><ul><li>  <b>Servicio de fabricante gratuito</b> .  Proporcionar acceso por n√∫mero de serie del dispositivo. <br></li><li>  <b>Listas blancas de n√∫meros de serie</b> para el servicio de nuestros socios: enlace de compras y accesos a la cuenta del cliente. <br></li><li>  <b>Licencias</b>  Permitir o denegar el acceso seg√∫n las opciones especificadas en el certificado. <br></li></ul><br>  Los objetivos son lo que queremos lograr cuando resolvemos problemas. <br><br>  <b>Emisi√≥n y entrega al cliente</b> .  Sin la participaci√≥n de las personas: los robots cosen la informaci√≥n en la producci√≥n. <br><br>  <b>Recuperaci√≥n de p√©rdidas</b> .  Queremos que no haya p√©rdida de detalles secretos en absoluto. <br><br>  <b>Entrega de producci√≥n a servicios</b> .  Queremos prescindir de √©l, para que no necesite entregar nada a los servicios.  Al lanzar nuevos equipos, no queremos actualizar las bases de datos de todos los servicios que deber√≠an autenticar estos dispositivos. <br><br>  <b>Almacenamiento en el servidor</b> .  Es aconsejable no almacenar nada all√≠ en absoluto. <br><br>  <b>Sincronizaci√≥n entre servicios e intranet</b> .  Tambi√©n es aconsejable no sincronizar nada, porque no almacenaremos nada. <br><br>  <b>Protecci√≥n contra copia de detalles</b> .  Queremos algo secreto, por el cual se toma el dinero, fue imposible copiar y recibir de forma gratuita. <br><br><h2>  Firma digital se apresura al rescate </h2><br><blockquote>  La firma digital electr√≥nica (EDS) es una tecnolog√≠a en torno a la cual todo funciona para nosotros. </blockquote><br>  Es como una firma ordinaria, solo digital.  EDS es f√°cil de verificar, pero dif√≠cil de falsificar.  Las verdades familiares de la criptograf√≠a, que tienen d√©cadas de antig√ºedad. <br><br>  Una firma electr√≥nica es algo que un mensaje puede contar si conoce la clave privada secreta (clave privada).  Si conoce la clave p√∫blica (clave p√∫blica), es f√°cil verificar que la firma electr√≥nica del mensaje sea correcta.  El nombre es claro: el p√∫blico est√° acostumbrado a informar a todos, y el secreto es solo para quien firma. <br><br><blockquote>  Todas las firmas y claves son solo n√∫meros. </blockquote><br>  En nuestro caso, se trata de 32 bytes de datos, que funciona en "magia" matem√°tica.  Math garantiza que la firma sea f√°cil de verificar, pero dif√≠cil de falsificar. <br><br>  Utilizamos la firma ECDSA-256 + SHA-256: <br><br><ul><li> <code>e = HASH(m)</code> : la funci√≥n hash criptogr√°fica convierte irreversiblemente el mensaje m en el n√∫mero e; <br></li><li>  <code>private key (dA)</code> - n√∫mero aleatorio; <br></li><li>  <code>public key (QA)</code> : generada a partir de una clave privada, pero no viceversa; <br></li><li>  <code>signature (r,s) = sign(private key, e)</code> - firma; <br></li><li>  <code>verify(public key, signature, e)</code> - verificaci√≥n de la firma. <br></li></ul><br><h3>  Autenticaci√≥n EDS.  Primer intento </h3><br>  ¬øQu√© se puede hacer para nuestra tarea utilizando este mecanismo complicado, que funciona en una direcci√≥n simple y en la otra dif√≠cil? <br><br>  <b>Emisi√≥n y entrega al cliente</b> .  Generamos una clave privada aleatoria para cada dispositivo en la producci√≥n.  No se lo decimos a nadie, porque ni siquiera lo conocemos, y escribimos en el dispositivo. <br><br>  <b>Entrega de producci√≥n a servicios</b> .  A continuaci√≥n, usamos solo la clave p√∫blica de este dispositivo para la autenticaci√≥n en los servicios.  En los servicios, solo almacenamos una lista de claves p√∫blicas en lugar de contrase√±as. <br><br>  Algoritmo de comprobaci√≥n de estado est√°ndar: <br><br><ul><li>  el servicio env√≠a un mensaje aleatorio <code>m</code> al controlador; <br></li><li>  controlador: <code>sign(private key, m)</code> ; <br></li><li>  el controlador env√≠a una firma al servicio; <br></li><li>  servicio: <code>verify(public key, signature, m)</code> . <br></li></ul><br>  Lo √∫nico que decidimos de esta manera es que <b>ya no almacenamos "secretos" comunes en nuestros servicios</b> en forma abierta o en cach√©.  Esto no es lo que queremos. <br><br><h3>  Autenticaci√≥n EDS.  Segundo intento </h3><br>  No queremos almacenar algo en los servicios.  Para lograr esto, podemos obligar a nuestros dispositivos a enviar sus claves p√∫blicas al servicio. <br><br>  En la √∫ltima etapa, resolvimos dos problemas.  El primero: <b>comprobamos que dieron la clave del servicio</b> .  Tenemos una clave p√∫blica, lo que significa que tambi√©n creamos una clave privada.  El segundo: nos aseguramos de que el <b>dispositivo posee una clave privada</b> , que se encuentra en alg√∫n lugar de la unidad flash USB.  Si el dispositivo puede firmar algo, entonces tiene una clave privada. <br><br>  Ahora el dispositivo tambi√©n enviar√° la clave p√∫blica al servicio.  ¬øC√≥mo comprobar que nadie lo intercept√≥, que no lo fingi√≥ y que todo funciona? <br><br>  <b>Comprobando la clave p√∫blica</b> .  Nos creamos otra clave p√∫blica.  Ser√° nuestra clave como fabricante.  Esta es la clave ra√≠z "clave privada ra√≠z + clave p√∫blica".  Con esta clave secreta ra√≠z en producci√≥n, firmaremos la clave p√∫blica del dispositivo y almacenaremos esta firma en el dispositivo.  El dispositivo debe enviar su clave p√∫blica y la firma de su clave p√∫blica al servicio.  Ahora el servicio puede verificar la clave p√∫blica del dispositivo.  Si est√° firmado con la clave privada ra√≠z, emitimos esta clave. <br><br><blockquote>  Solo el fabricante: podemos crear y almacenar una firma en el dispositivo, pero verificamos todo. </blockquote>  Publicamos la clave p√∫blica en el sitio en la secci√≥n "Contactos".  Cualquiera puede tomarlo y verificar la clave p√∫blica del dispositivo que envi√≥ el dispositivo al servicio.  Luego puede verificar que el dispositivo tenga su propia clave privada. <br><br>  El algoritmo general se ve as√≠. <br><br><ul><li>  <code>(once) random root private key</code> ; <br></li><li>  <code>factory: random device private key</code> ; <br></li><li>  <code>factory: sign(root private key, device public key) = signature_1</code> ; <br></li><li>  <code>device-&gt;service:  device public key + signature_1</code> ; <br></li><li> <code>service: verify(root public key, signature_1, device public key)?</code> <br> </li></ul><br><h3>  Resultado del segundo intento </h3><br>  Resolvimos el problema con la <b>entrega</b> al cliente: la informaci√≥n se cose en el sitio de producci√≥n y <b>no es necesario restaurar nada</b> . <br><br>  Es importante que resolvamos el problema de <b>entregar "secretos" a los servicios de nivel superior</b> , porque todo lo que se necesita almacenar en el servicio es la clave p√∫blica del fabricante.  La clave completa es de 33 bytes.  Con su ayuda y magia matem√°tica, puede continuar haciendo una conexi√≥n de protocolo de enlace y verificar que el dispositivo tenga la clave privada correspondiente. <br><br>  <b>En el servidor</b> solo almacenamos la clave del fabricante (clave p√∫blica ra√≠z). <br><br>  No tenemos <b>sincronizaci√≥n entre los servicios y la intranet</b> , de la que ya hemos hablado.  Adem√°s, no tenemos <b>protecci√≥n contra la copia de detalles</b> . <br><br>  Lo √∫nico que olvidamos es la <b>autenticaci√≥n</b> .  El dispositivo envi√≥ una clave privada, y verificamos que lo hicimos y lo emitimos, y verificamos que el dispositivo lo posee.  Pero no sabemos qu√© tipo de dispositivo es este, y producimos miles de ellos. <br><br>  Por lo tanto, aplicamos un truco llamado "Certificado". <br><br><h2>  Autenticaci√≥n y Certificados </h2><br>  En este paso, en toda la magia matem√°tica con firmas y sus cheques, agregamos <b>informaci√≥n adicional: un certificado</b> .  Para hacer esto, firmamos en la f√°brica no solo la clave p√∫blica (clave p√∫blica del dispositivo), sino tambi√©n la clave con informaci√≥n adicional. <br><br>  Informaci√≥n adicional en nuestro caso. <br><br><ul><li>  Fecha de fabricaci√≥n y fabricante. <br></li><li>  Modelo y configuraci√≥n de hardware. <br></li><li>  El n√∫mero de serie mediante el cual se puede autenticar el dispositivo. <br></li><li>  Opciones: hardware y software.  Las diferentes configuraciones pueden no diferir f√≠sicamente entre s√≠, pero el certificado contendr√° informaci√≥n sobre lo que pag√≥ el cliente. <br></li><li>  Nombre del cliente y n√∫mero de cuenta. <br></li></ul><br>  Firmaremos toda esta informaci√≥n junto con la clave p√∫blica con nuestra clave de productor: clave p√∫blica ra√≠z.  Despu√©s de eso, la informaci√≥n ir√° a los servicios y podr√°n asegurarse de que sea correcta.  Dado que estos son nuestros servicios y los de nuestros socios, conf√≠an en nosotros. <br><br><h3>  Estado del objetivo </h3><br>  La informaci√≥n tambi√©n se cose en la f√°brica y no es necesaria la <b>entrega</b> a los servicios.  <b>En el servidor</b> almacenamos solo la clave del fabricante. <br><br>  <b>Recuperaci√≥n de p√©rdidas</b> .  Cosemos toda la informaci√≥n de los certificados en la memoria flash del dispositivo.  Te√≥ricamente, se puede eliminar accidental o intencionalmente, pero no hay nada secreto en esta informaci√≥n en el certificado.  Incluso la firma en s√≠ no es secreta: hay una clave p√∫blica y la firma con nuestra clave.  El √∫nico secreto en el certificado son los vol√∫menes de ventas de dispositivos con diferentes opciones. <br><br>  El certificado puede almacenarse en la f√°brica y enviarse al cliente si lo pierde.  Los clientes rara vez borran espec√≠ficamente el √°rea de servicio de la memoria.  Por lo general, hacemos esto durante el procedimiento de recuperaci√≥n del dispositivo: el dispositivo lleg√≥ del cliente, se pas√≥ por completo a trav√©s de la inicializaci√≥n, todo se borra, se descarga nuevamente y el certificado se copia de la base de datos de f√°brica. <br><br>  No tenemos <b>recuperaci√≥n de</b> p√©rdidas, protecci√≥n de copia y <b>sincronizaci√≥n entre servicios</b> . <br><br>  <b>En la etapa de autenticaci√≥n,</b> recibimos y verificamos el certificado.  Entendemos qu√© tipo de dispositivo es: conocemos el fabricante, el modelo y el n√∫mero de serie, qu√© puede y qu√© no puede hacer. <br><br><h3>  Iniciar sesi√≥n </h3><br>  El certificado le permite almacenar informaci√≥n para su autorizaci√≥n. <br><br>  <b>Servicio de fabricante gratuito</b> .  Conociendo el n√∫mero de serie del dispositivo, puede dar acceso a todos.  En nuestros servicios damos acceso a todos nuestros clientes base. <br><br>  <b>Listas blancas de n√∫meros de serie</b> .  Para el servicio de nuestros socios, puede crear una tabla con una lista blanca de n√∫meros de serie: "El cliente Vasily nos compr√≥ dos controladores con dichos n√∫meros de serie asociados con su cuenta" <br><br>  <b>Licencias</b>  Puede vender algo por adelantado y luego permitir o denegar el acceso <b>seg√∫n las opciones</b> especificadas en el certificado: un controlador con licencia para el sistema X. <br><br>  No existe una base com√∫n entre servicios, fabricante o fabricante de sistemas.  Todo funciona exclusivamente con la informaci√≥n del controlador que firmamos nosotros, como fabricante, cuando se autentica en el sistema. <br><br><h2>  Certificado Intermedio </h2><br>  Otro problema t√©cnico que resolvimos en el camino.  En el esquema del que acabo de hablar, hay un certificado ra√≠z del fabricante: clave privada ra√≠z.  Se necesita f√≠sicamente cada vez que crea un dispositivo.  Pero si hay muchos dispositivos, entonces esta clave necesita acceso constante para un c√≠rculo limitado de personas.  Esto es malo, porque si lo pierde, tendr√° que actualizar las claves p√∫blicas en todos los servicios, y no deber√≠a llegar a los atacantes.  Estos son grandes problemas de organizaci√≥n.  Pero hay una soluci√≥n. <br><br><blockquote>  Introducimos claves intermedias para un lote de dispositivos que no dan tanto miedo de perder. </blockquote><br>  Hicimos lo mismo, solo que la cadena es m√°s larga. <br><br><img src="https://habrastorage.org/webt/x-/mb/s3/x-mbs3xfmihxr-qjdmpm7f5buey.jpeg"><br><br>  Con un certificado de fabricante, firmamos la clave intermedia.  F√≠sicamente, esta es una "unidad flash", que se entrega al capataz en la f√°brica por un d√≠a.  El hardware limita la cantidad de dispositivos que una clave puede firmar.  En el medio del esquema, agregamos un certificado intermedio, de lo contrario, nada cambi√≥. <br><br><h2>  Almac√©n de claves seguro </h2><br>  En todo esto, no tenemos suficiente <b>protecci√≥n para la clave privada del dispositivo</b> ; este sigue siendo un archivo que se encuentra en una unidad flash USB.  Un atacante puede copiarlo, pero lo m√°s probable es que lo pierda o abra accidentalmente el acceso. <br><br>  En el caso ideal, ser√≠a bueno proteger la copia de la clave privada del dispositivo; p√≥ngala en un cuadro negro. <br><br>  La caja negra realiza 4 operaciones: <br><br><ul><li>  dentro de s√≠ mismo genera una clave a pedido, pero no da; <br></li><li>  da la clave p√∫blica; <br></li><li>  Firma un mensaje <br></li><li>  Verifica la firma. <br></li></ul><br><img src="https://habrastorage.org/webt/by/ck/zf/byckzfred-odhrigx-ayq2gkytk.jpeg"><br>  <i>Para verificar la firma, solo necesita una clave p√∫blica, por lo que tres operaciones son suficientes.</i> <br><br>  En mi opini√≥n, esta deber√≠a ser una soluci√≥n de hardware, preferiblemente separada del procesador.  Hay varias opciones, la mejor de las cuales es un <b>procesador criptogr√°fico especial dentro del SoC</b> o como un chip separado. <br><br>  La primera opci√≥n de recuadro negro que revisamos es el <b>m√≥dulo CAAM</b> en los procesadores NXP i.mx 6, 7, 8 que utilizamos.  El problema es que se implementa mediante programaci√≥n en la ROM de arranque del procesador. <br><br>  Puede contener errores que se pueden encontrar e incluso explotar a trav√©s de otras funciones del procesador.  Hace un par de a√±os, se encontr√≥ un agujero en este m√≥dulo que hizo posible omitir la verificaci√≥n de firma al descargar el firmware.  Esta no es la funcionalidad que necesitamos, pero el sedimento permanece.  Otro problema es que es dif√≠cil importar procesadores con este m√≥dulo a Rusia; requieren completar el papeleo. <br><br>  Por lo tanto, tomamos un chip por separado.  Admito honestamente, cont√© con el hecho de que si no podemos traerlo a Rusia, se nos ocurrir√° algo: el chip es peque√±o, cuesta $ 1.  Pero todo sali√≥ bien: encontraron el chip <b>Microchip ATECC</b> , que ya tiene todos los documentos. <br><br><h2>  Microchip ATECC608A </h2><br>  Este es un chip peque√±o separado que cuesta un centavo.  El chip est√° conectado a trav√©s de I2C, dos "patas" del procesador, que tambi√©n puede compartir con otros perif√©ricos.  El chip tiene un pinout est√°ndar.  Usamos el chip en las primeras versiones del equipo y simplemente lo soldamos encima de otro chip con el mismo protocolo y pinout, porque es est√°ndar. <br><br>  El chip puede hacer lo que necesitamos de dicho chip: leer firmas, almacenar claves y mucho m√°s. <br><br><img src="https://habrastorage.org/webt/_h/sb/jb/_hsbjbw9dyvjo2ta5emvp_wuqk4.jpeg"><br><br>  Caracteristicas <br><br><ul><li>  16 ranuras para teclas; <br></li><li>  puede leer firmas ECSDSA, hashes, MAC y cifrar AES, puede DH; <br></li><li>  tiene un generador de n√∫meros aleatorios y contadores criptogr√°ficos; <br></li><li>  Cajas: SOIC-8, DFN6; <br></li><li>  protocolos: I2C, cable simple; <br></li><li>  ~0.7$@1000pcs. <br></li></ul><br><h3>  C√≥mo trabajar con un microcircuito </h3><br>  Hay <b>documentaci√≥n</b> decente <b>para ello</b> , pero bajo la NDA.  Si escribe inmediatamente a gamma.spb.ru, se lo dar√°n en 2 semanas.  Si est√° en otra empresa, despu√©s de 3 meses.  Escribimos a dos compa√±√≠as, y cuando lo hicimos todo, otro distribuidor de Microchip nos respondi√≥. <br><br>  <b>Hay pocas notas</b> y son peores que el promedio.  Hay <b>software</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en GitHub</a> , una biblioteca con HAL.  Es divertido: la documentaci√≥n est√° bajo el NDA, y el software que est√° escrito est√° en GitHub.  El software no es compatible con Linux, pero es compatible con Raspberry Pi y Atmel MK, esto es un poco diferente.  Los desarrolladores creen que en todos los equipos solo hay un bus I2C, por ejemplo, las patas se llaman como en la Raspberry Pi. <br><br>  Hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">integraci√≥n</a> con <b>OpenSSL</b> , no funciona bien, pero lo hace.  <b>No hay ejemplos en Linux</b> ni trabajo con <b>personalizaci√≥n</b> . <br><br><h3>  Personalizaci√≥n de chip </h3><br><blockquote>  La personalizaci√≥n es el mayor dolor de cabeza con el chip. </blockquote><br>  El problema es que el chip puede hacer muchas cosas.  Tiene 16 ranuras en las que se almacenan 16 claves: datos de usuario o claves p√∫blicas, o almacenamiento temporal para otras ranuras: hay muchas opciones. <br><br>  Debe restringir de alguna manera el acceso a las ranuras, y tambi√©n hay muchas opciones de configuraci√≥n: restringir por contrase√±a, por autenticaci√≥n en otra ranura, en el momento del acceso a las f√°bricas. <br><br><img src="https://habrastorage.org/webt/-a/du/mm/-adumml8w8ijipo3nbep8jz5nry.jpeg"><br>  <i>En la tabla, el tipo de clave, acceso de lectura y escritura, la relaci√≥n entre las ranuras: SlotConfig, KeyConfig.</i> <br><br>  En la m√°scara de bits (16 bits) de cada clave que usamos, hay diferentes n√∫meros en todas partes. <br><br>  Lo m√°s triste es que la zona de configuraci√≥n es √∫nica, lo que establece las funciones de las ranuras.  Arruinamos 50 fichas antes de hacer todo bien.  El chip solo funciona <b>despu√©s de bloquear la configuraci√≥n</b> .  Por separado, hay un <b>bloqueo para ranuras individuales</b> <br><br>  No hay documentaci√≥n en los ejemplos o en el software.  Hay documentaci√≥n para bits individuales, pero todo es complicado all√≠.  En todos los ejemplos de Microchip est√° escrito: "Descargue ese bloque, y de alguna manera funcionar√° para usted, como en el ejemplo del env√≠o de datos a Amazon". <br><br>  Tom√≥ mucho tiempo, pero en el proceso hicieron una gran utilidad. <br><br><h3>  Utilidad Atecc-util </h3><br>  Esta es una utilidad de consola que puede realizar la mayor√≠a de las funciones del chip y le permite trabajar un poco m√°s f√°cilmente.  Est√° disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en GitHub</a> bajo una licencia MIT. <br><br>  La utilidad usa CryptoAuthLib.  Ella sabe c√≥mo trabajar de manera m√°s amigable con la zona de configuraci√≥n, sabe c√≥mo trabajar con SHA, MAC, ECDSA, DH.  La interfaz es f√°cil de usar porque, en primer lugar, creamos la utilidad para usar en scripts.  El hecho de que una persona pueda causarlo es una caracter√≠stica secundaria.  La utilidad puede hacer una lista, un plan de comandos: "Primero, personalice esta zona, luego escriba dicha clave". <br><br>  Un ejemplo de llamar a una utilidad es bastante legible para los humanos. <br><br><pre> <code class="plaintext hljs">atecc - b 10 - c 'serial' - c 'read-config /tmp/config.dump'</code> </pre> <br>  La utilidad est√° construida bajo Linux, bajo AMD64, est√° en el paquete Debian. <br><br><img src="https://habrastorage.org/webt/lc/yr/bs/lcyrbsjcuggnfwuzetwwjy3auxg.jpeg"><br><br><h3>  Otras herramientas de personalizaci√≥n </h3><br>  Tenemos una placa Excel para leer los bits.  Si nos muestra un escaneo NDA con Microchip, se lo daremos. <br><br><img src="https://habrastorage.org/webt/gs/j5/r9/gsj5r9tr6ngrcascp8tqxdq6dla.jpeg"><br><br>  Cubrimos todo con pruebas, ya que hay muchas opciones cuando puede olvidar un bit y alg√∫n comando de servicio leer√° su clave privada.  Las pruebas prueban el dispositivo real.  Se dirigen al microcircuito y verifican la configuraci√≥n correcta en el dispositivo: ¬øse puede leer esta ranura, se puede hacer tal firma? <br><br>  Paralelamente a los bits, creamos una lista de garant√≠as que este dispositivo deber√≠a satisfacer y verificamos c√≥mo funciona todo.  Usamos el <b>marco de murci√©lagos</b> , algo muy interesante.  Se ve as√≠. <br><br><img src="https://habrastorage.org/webt/wr/kd/op/wrkdopidmf6zn2ko70ue36p7fxc.jpeg"><br>  <i>Lista de pruebas para un ejemplo.</i>  <i>Los superiores se pasan, pero los inferiores no.</i> <br><br><h3>  Configuraciones en dispositivos </h3><br>  <b>Para nosotros, usamos solo dos espacios</b> para la tarea de la que estoy hablando.  En ambos almacenamos la clave privada del dispositivo.  La diferencia es que el primero est√° asociado con un <b>certificado permanente</b> , que se emiti√≥ en 1970 por 200 a√±os. <br><br>  Esto se debe al hecho de que en IoT el tiempo no siempre est√° sincronizado.  La infraestructura del certificado implica verificar la validez de un certificado.  Si se interrumpe la sincronizaci√≥n en los dispositivos, puede fallar alg√∫n servicio vital, por ejemplo, VPN. <br><br>  Por lo tanto, <b>una ranura es infinita, permanente</b> .  Se genera una vez y no cambia durante la vida √∫til del dispositivo.  Para esta clave, se genera un certificado por 200 a√±os, para redes cerradas. <br><br>  Se est√° actualizando otra ranura.  La vida √∫til m√°xima del certificado es de un a√±o.  Esto se hace en caso de que algo se vea comprometido.  Se genera una clave privada de dispositivo actualizable a medida que expira el per√≠odo de validez del certificado del dispositivo.  Se utiliza para la autenticaci√≥n en redes abiertas, se actualiza una vez al mes o menos, junto con un certificado. <br><br>  <b>Para los usuarios, generamos varias combinaciones</b> , incluidas varias ranuras para claves privadas ECDSA.  Los usuarios pueden generar su clave en una ranura separada si no conf√≠an en nuestra clave privada.  Para esto solo necesita confiar en Microchip.  Los usuarios pueden leer firmas, encriptar; dimos todo lo que el chip puede hacer. <br><br>  Hasta ahora, desafortunadamente, nadie lo ha usado, pero esperamos que s√≠. <br><br><h3>  Infraestructura: claves intermedias </h3><br>  Ya dije que en alg√∫n momento implementamos certificados intermedios para no brillar con un certificado ra√≠z que no deber√≠a perderse.  Nunca aparece en una f√°brica. <br><br><img src="https://habrastorage.org/webt/uh/m0/dl/uhm0dl6mdkegvzwl2avlsqpe7kc.jpeg"><br><br>  Los certificados f√≠sicamente intermedios son un chip ATECC508A.  Difiere ligeramente de 608, pero en 508 hay una funcionalidad √∫til para las teclas, pero en 608 ya no est√° all√≠. <br><br>  El chip est√° conectado a trav√©s de un adaptador USB-I2C.  Este es USBISP con firmware tiny-usb-i2c, un programador que se puede instalar en un puente USB-I2C.  Los certificados intermedios firman certificados de dispositivo con su clave privada. <br><br>  Dos caracter√≠sticas del microcircuito nos resultaron √∫tiles. <br><br>  <b>Ranura de protecci√≥n de contrase√±a de hardware</b> .  El chip se puede programar para leer la firma solo si se cumplen dos condiciones: <br><br><ul><li>  cuando el dispositivo est√° atascado en una computadora; <br></li><li>  contrase√±a ingresada <br></li></ul><br>  Le damos al capataz de producci√≥n una clave y contrase√±a intermedias para varios controladores.  En consecuencia, debe robar tanto la clave como la contrase√±a para obtener acceso.  Tenemos esta oportunidad de forma gratuita, pero mejora la seguridad del sistema. <br><br>  <b>L√≠mite de hardware en la cantidad de usos</b> .  El contador criptogr√°fico en el interior solo puede aumentar.  Cuando alcanza un l√≠mite predeterminado una vez, el microcircuito no firma nada m√°s. <br><br><img src="https://habrastorage.org/webt/tm/qv/4-/tmqv4-eakpcudfupub3oy6nt9bw.jpeg"><br><br><h2>  OpenSSL en el cliente </h2><br>  Consideremos c√≥mo funciona todo en el cliente.  Tenemos OpenSSL en el controlador.  No inventamos nada: esto es TLS ordinario, PKI ordinario.  Adem√°s, necesit√°bamos una biblioteca cliente.  En la gran mayor√≠a del software de Linux, se usa para una conexi√≥n segura. <br><br>  Tomamos el c√≥digo de Microchip, lo agregamos un poco, admitimos el nuevo OpenSSL <br>  1.1.  Como resultado, √©l sabe c√≥mo trabajar con una clave de hardware: el hardware admite contrase√±as para claves privadas. <br><br>  Se ve algo como esto. <br><br><pre> <code class="plaintext hljs">openssl req -new -engine ateccx08 -keyform engine -key ATECCx08:00:04:C0:00 -subj "/CN=wirenboard-AP6V5MDG" -out device AP6V5MDG.csr</code> </pre> <br>  Esta es una llamada a OpenSSL regular y una instrucci√≥n para usar el m√≥dulo de motor apropiado.  La clave se establece aqu√≠: direcci√≥n, modelo y los dos √∫ltimos bytes es el n√∫mero de la ranura que se utiliza.  Todo se transmite como si fuera un archivo clave, pero no es un archivo: debe ingresar al dispositivo. <br><br><h2>  SSL en el servidor </h2><br>  Cualquier SSL funciona en el servidor, incluido OpenSSL.  No se necesitan modificaciones ni compilaciones personalizadas en el lado del servidor.  Todo lo que se necesita en el servidor es <b>poder verificar la cadena del paquete de certificados</b> (dispositivo cert + <b>certificado</b> intermedio) y <b>almacenar nuestra clave p√∫blica</b> , que publicamos en el sitio - Wiren Board ROOT CA. <br><br>  El TLS est√°ndar dice que ambas partes deben autenticarse mutuamente.    ‚Äî   ‚Äî   .    ‚Äî    handshake. <br><br>         :    .    ,         .   letsencrypt    SSL,   ,      . <br><br>       ,    ‚Äî MQTT. <br><br><h2> MQTT: mosquitto   </h2><br>          IBM.               . <br><br> Mosquitto ‚Äî       ,   ,  Linux.    ,   OpenSSL engine (  )    ¬´keyfile¬ª,     . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>   ,  20 . <br><br>     bundle. <br><br><img src="https://habrastorage.org/webt/ea/ju/ge/eajugei4pidm4h7ramzyhh-vpkq.jpeg"><br><br>             . <br><br><pre> <code class="plaintext hljs">mosquitto_sub -h mqtt.wirenboard.com -p 8884 -cert /etc/ssl/device/device_bundle.crt.pem --key 'engine:ateccx08:ATECCx08:00:04:C0:00' --capath /etc/ssl/certs/ -t /# -v</code> </pre> <br>     .     ‚Äî    <code>-cert</code> .   bundle- ‚Äî .      <code>--key</code> .       . <br><br>  ,    <code>--capath</code> ,    .       SSL-,     letsencrypt. <br><br>   <b> </b> . <br><br><pre> <code class="plaintext hljs">root@wirenboard-AXXVJI62:~# cat /etc/mosquitto/conf.d/bridge-hw.conf connection wb_devices_cloud.wirenboard-AXXVJI62 address contactless.ru:8884 bridge_capath /etc/ssl/certs/ bridge_certfile /etc/ssl/device/device_bundle.crt.pem bridge_keyfile engine:ateccx08:ATECCx08:00:04:C0:00 notifications true notification_topic /client/wirenboard-AXXVJI62/bridge_status topic/# both 1 ""/dient/wirenboard-AXXVJI62</code> </pre> <br> Mosquito-     . <br><br> <b>   Mosquitto</b> ‚Äî    . <br><br><pre> <code class="plaintext hljs">per _listener_settings true listener 8884 0.0.0.0 cafile/etc/mosquitto/certs/WirenBoard_Root_CA.crt certfile /etc/letsencrypt/live/contactless.ru/fullchain.pem keyfile/etc/letsencrypt/live/contactless.ru/privkey.pem require.certificate true use_identity_as_username true password_file /etc/mosquitto/passwd.conf allow_anonymous false acl_file /etc/mosquitto/ad.conf :~$ cat /etc/mosquitto/acl.conf pattern write /client/%u/# pattern read /client/%u/#</code> </pre> <br>   ‚Äî  . <br><br><ul><li>  Root CA  letsencrypt-   ‚Äî   .     . <br></li><li>    Mosquitto.           <code>username</code>      MQTT. <br></li><li>  ,     , ,   (CN) wirenboard-AXXVJI62,   ,      . <br></li><li> <code>per_listener_settings:</code>   ,      / (&gt;1.5.5). <br></li></ul><br>    MQTT-  Wiren Board IoT Cloud Platform. <br><br><h2>  Openvpn </h2><br> OpenVPN  ,      ,     .   ,                . <br><br>  OpenVPN <b> </b>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> ,   .       ,   : bundle,  , engine. <br><br><pre> <code class="plaintext hljs">openvpn --capath /etc/ssl/certs/ --cert /etc/ssl/device/device_bundle.crt.pem --key engine:ateccx08:ATECCx08:00:04:C0:00</code> </pre> <br> <b> </b>    letsencrypt. <br><br><pre> <code class="plaintext hljs">ca /etc/openvpn/WirenBoard_Root_CA.crt cert /etc/letsencrypt/live/vpn1.wirenboard.com/fullchain.pem key /etc/letsencrypt/live/vpn1.wirenboard.com/privkey.pem</code> </pre> <br>     ‚Äî       .      -  . <br><br><h2> Nginx </h2><br>   . Nginx   ,    ,        , SSL.      nginx     web-,  reverse-proxy.   ‚Äî      nginx. <br><br> nginx   ,  HTTP-,       .   ,       : Common Name,      ,        .   ,   400. <br><br><pre> <code class="plaintext hljs">ssl_client_certificate WirenBoard_Root_CA.crt; ssl_verify_client on;</code> </pre> <br> <b>nginx  </b> .     ‚Äî ,     HTTP.  Linux-   nginx  ,        SSL,   ,   OpenSSL. <br><br>    wget  , bash    ,   HTTP-  TLS   .    10 . <br><br><pre> <code class="plaintext hljs">server { listen 8080; location / { proxy_pass https://example.com; proxy_ssl_name example.com; proxy_ssl_server_name on; proxy_ssl_certificate/etc/ssl/device/device_bundle.crt.pem; proxy_ssl_certificate_key engine:ateccx08;ATECCx08:00:04:C0:00; } }</code> </pre> <br><h2>   </h2><br>      <b>Wiren Board 6</b> ,     .     ,       . <br><br>         web-   cloud.wirenboard.com  OpenVPN  .     Grafana  InfluxDB,      MQTT.     saymon.info ‚Äî    (MQTT)  . <br><br>      ,  -  ,     , Grafana, MQTT-,   ,  , .   ‚Äî . <br><br>  ,    ,   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> ‚Äî  OpenSSL    ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> ‚Äî  .  ! <br><br><blockquote>           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">InoThings Conf 2019</a> .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">YouTube-</a>       2019 .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  Telegram.     ,  ,       IoT. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/476304/">https://habr.com/ru/post/476304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../476292/index.html">SVG o lienzo?</a></li>
<li><a href="../476294/index.html">Red de juegos distribuidos como alternativa a GFN: c√≥mo y por qu√© puede despegar, donde ya funciona en la Federaci√≥n Rusa</a></li>
<li><a href="../476296/index.html">21 de noviembre, Product Engineering MeetUp: ¬øQui√©n es un ingeniero de producto?</a></li>
<li><a href="../476298/index.html">Repase las espinas para bicicletas, primera parte: aprenda los conceptos b√°sicos de la personalizaci√≥n del depurador de Visual Studio usando complementos</a></li>
<li><a href="../476300/index.html">La revista Tram es una estrella de la vanguardia de los ni√±os rusos que brilla intensamente y se desvaneci√≥ r√°pidamente</a></li>
<li><a href="../476306/index.html">Instrucciones de TelegramBot para crear funcionalidades b√°sicas para el bot. (Parte 1)</a></li>
<li><a href="../476308/index.html">Las 5 mejores pr√°cticas de desarrollo de software a seguir en 2020</a></li>
<li><a href="../476310/index.html">CRM de rostro humano</a></li>
<li><a href="../476312/index.html">React o Angular o Vue.js: ¬øqu√© elegir?</a></li>
<li><a href="../476316/index.html">Vue Storefront: Rellene datos en ES</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>