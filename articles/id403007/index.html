<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏇🏽 👁️ 👵🏿 Unduh firmware ke STM32 melalui USB 🕵🏽 🕍 ✴️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam proyek saya, saya menggunakan mikrokontroler STM32F103C8 dan kerangka stm32duino . Klon Arduino ini menawarkan bootloader khusus yang memungkink...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unduh firmware ke STM32 melalui USB</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403007/"><img src="https://habrastorage.org/getpro/geektimes/post_images/50c/046/5e3/50c0465e38ec8d772f985a4cc26288a6.png" alt="gambar"><br><br>  Dalam proyek saya, saya menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mikrokontroler STM32F103C8</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kerangka stm32duino</a> .  Klon Arduino ini menawarkan bootloader khusus yang memungkinkan Anda untuk mengunggah firmware melalui USB, tanpa menggunakan komponen eksternal seperti ST-Link atau adaptor USB-UART. <br><br>  Hari ini saya perlu bekerja dengan controller kosong dari bawah CooCox dan tanpa stm32duino.  Tapi ini masalahnya.  Bahkan bola lampu tanda bahaya sederhana yang dituangkan melalui bootloader ini tidak berfungsi. <br><br>  Mari kita perbaiki.  Mungkin kalkulasi saya bagi sebagian orang tampak biasa.  Tapi saya baru mulai mempelajari pengontrol STM32 dan membunuh setidaknya setengah hari untuk menemukan masalah.  Tiba-tiba artikel ini akan mempersingkat waktu pengembangan untuk seseorang. <br><a name="habracut"></a><br>  Saya tidak menentang ST-Link dan para penentang lainnya.  Tetapi di perangkat saya yang sudah jadi tidak akan, tetapi pasti akan ada USB.  Mengapa tidak segera meletakkan kemampuan untuk memperbarui firmware melalui USB?  Secara pribadi, saya menemukan metode ini nyaman.  terlebih lagi, saya sudah memiliki kabel yang terhubung dengan yang ada daya dan USB Serial. <br><br>  Mari kita lihat bagaimana bootloader bekerja.  Untuk memulai dengan contoh pengontrol AVR.  Mengapa saya mengingatnya?  Saya beralih dari Arduino dan secara tidak sadar mengharapkan perilaku yang sama.  Tetapi dalam STM32 semuanya ternyata berbeda.  Oleh karena itu, saya ingin berbicara tentang perbedaan antara kedua mikrokontroler ini. <br><br>  Jadi  Dalam mikrokontroler AVeg ATMega, sejumlah memori dapat dicadangkan untuk bootloader di dekat akhir flash.  Menggunakan bit sekering Anda dapat mengontrol dari mana alamat program akan dimulai.  Jika tidak ada bootloader, program dimulai dari alamat 0x0000.  Jika ada bootloader, itu dimulai dari beberapa alamat lain (misalnya, di ATMega32 dengan 0x3C00, jika ukuran bootloader adalah 2k). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/32a/c00/3a7/32ac003a7b0509cd8b322ba9b3ffc359.png" alt="gambar"></div><br>  Ketika bootloader telah melakukan tugasnya, ia mentransfer kontrol ke program utama dari alamat 0x0000.  Yaitu  program selalu dimulai pada 0x0000.  Compiler dan linker bekerja dengan fakta bahwa kode tersebut akan ditempatkan di awal ruang alamat. <br><br>  Dalam mikrokontroler STM32, ini tidak benar.  Semua program dimulai dari alamat 0x0800000.  Bootloader tidak terlalu istimewa.  Ini adalah program yang sama yang dimulai dari alamat awal yang sama.  Dalam prosesnya, bootloader dapat menerima firmware (melalui USB atau UART, membaca dari USB flash drive, menerima dari satelit, mendapatkannya dari subruang, apa pun ...) dan menulisnya ke alamat yang lebih tinggi dari bootloader itu sendiri.  Dan, tentu saja, di akhir pekerjaannya, transfer kontrol ke program utama. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/82d/bdf/a0a/82dbdfa0ac179f37a3f8ee67cb4d4c44.png" alt="gambar"></div><br>  Jadi ketika mengkompilasi firmware Anda perlu tahu di mana bootloader akan menulis firmware dan menyesuaikan alamatnya. <br><br>  Itu semua dengan teori.  Mari kita lanjutkan berlatih.  Di bawah ini adalah petunjuk langkah demi langkah tentang cara mengencangkan bootloader USB ke mikrokontroler seri STM32F1xx, dan mungkin juga ke beberapa yang lain. <br><br>  Namun, ada beberapa batasan pada sirkuit.  Di sini, sayangnya, saya tidak kuat.  ITP membutuhkan resistor pull-up 1,5k untuk port PA12 (alias USB D +).  Ini memungkinkan bootloader untuk terhubung dan memutuskan koneksi dari USB pada waktu yang tepat. <br><br>  Instruksi: <br><br><ul><li>  Unduh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/rogerclarkmelbourne/STM32duino-bootloader</a> .  Dalam direktori STM32F1 \ binari sudah ada paket bootloader yang dikompilasi untuk papan yang berbeda.  Indeks di akhir nama file menunjukkan di mana LED terhubung.  Dalam kasus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">board saya di</a> mana LED terhubung ke pin C13, saya menggunakan file generic_boot20_pc13.bin. <br><br></li><li>  Kami flash <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sesuai dengan instruksi</a> .  Ya, di sini Anda akan memerlukan adaptor USB-UART, tetapi Anda <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">juga</a> dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menggunakan debugger</a> . <br><br></li><li>  Sekarang mikrokontroler siap untuk mem-flash bootloader USB.  Tetapi Anda masih harus memperbaiki firmware itu sendiri.  Dan Anda perlu melakukan 2 hal: <br><br><ul><li>  Berikan tautan ke alamat awal.  Dalam CooCox, ini dilakukan dalam pengaturan proyek, tab Tautan, bagian Area Memori, Alamat Awal IROM1.  Bootloader mengambil 8 kilobyte pertama, yang berarti alamat awal firmware adalah 0x0800000 + 0x2000 = 0x08002000.  Kolom Ukuran, mungkin, juga harus dikurangi sebesar 8k. <br><br></li><li>  Di suatu tempat di awal program, sebelum menginisialisasi pinggiran, lakukan panggilan <br><br><pre><code class="cpp hljs">NVIC_SetVectorTable(NVIC_VectTab_FLASH, <span class="hljs-number"><span class="hljs-number">0x2000</span></span>);</code> </pre> <br><br>  UPDATE 05/17/2018: Tidak ada fungsi NVIC_SetVectorTable () dalam versi modern STM32Cube.  Sebagai gantinya, Anda dapat memperbaiki definisi VECT_TAB_OFFSET di file system_stm32f1xx.c (atau serupa dengan mikrokontroler lain) <br></li></ul><br></li><li>  Isi firmware dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">diambil dari proyek stm32duino</a> .  Di direktori alat, cari skrip yang disebut maple_upload.  Saya hanya menggunakan versi Windows - maple_upload.bat. <br><br></li><li>  Jalankan seperti ini: <br><br><pre> <code class="hljs css">"<span class="hljs-selector-tag"><span class="hljs-selector-tag">maple_upload</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bat</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">COM20</span></span> 2 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">EAF</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0003</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">Path</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">To</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Firmware</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bin</span></span>"</code> </pre> <br>  Alih-alih COM20, Anda harus mengganti porta tempat mikrokontroler terpasang. <br><br>  Tuang adalah hal yang sangat lembut, tidak suka jalur relatif.  jadi jalur ke firmware harus ditentukan sepenuhnya. <br><br>  1EAF: 0003 adalah VID dan PID <br><br>  2 - ini adalah parameter AltID, yang menunjukkan bahwa firmware harus diunggah pada 0x08002000 (baca di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> ). <br></li></ul><br>  Sedikit nuansa.  Sebelum mengunggah firmware, Anda harus menjalankan bootloader.  Cara termudah adalah dengan menekan tombol reset.  Setelah itu, bootloader akan mulai dan akan menunggu beberapa detik untuk firmware.  Jika tidak ada yang memulai maple_upload saat ini, bootloader akan mentransfer kontrol ke firmware utama. <br><br>  Agar tidak menekan reset setiap kali, papan berbasis libmaple / stm32duino menggunakan trik.  Mereka mendengarkan port serial usb.  Jika sinyal DTR muncul di sana dan urutan kunci byte ditransmisikan, maka mikrokontroler dimuat kembali ke dalam bootloader.  Lihat <a href="">ke dalam fungsi rxHook ()</a> . <br><br>  Ini dapat menyebabkan ketidaknyamanan.  Jika mikrokontroler dimatikan dan hang, maka ia tidak lagi mendengarkan port.  Karena itu, ia tidak dapat mendengar urutan tombol dan reboot ke bootloader.  Kemudian hanya mengatur ulang untuk membantu. <br><br>  Itu saja.  Saya harap artikel saya akan menjelaskan bagaimana bootloader bekerja di STM32 dan cara mengunduh firmware melalui port USB.  Sayangnya, ambang entri masih tinggi, tetapi tiba-tiba artikel saya akan membantu seseorang mengatasinya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id403007/">https://habr.com/ru/post/id403007/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id402995/index.html">Malware BrickerBot mengubah gadget IoT menjadi bata</a></li>
<li><a href="../id402997/index.html">Pertama Kali: Tinjauan Film Pendek</a></li>
<li><a href="../id402999/index.html">Tidur Polyphase - kisah pengalaman yang baik</a></li>
<li><a href="../id403003/index.html">Para ilmuwan telah mengembangkan bakteri yang dapat mendeteksi kolitis pada tikus</a></li>
<li><a href="../id403005/index.html">Pengecekan fakta: siapa yang memutuskan apa yang harus dipercaya?</a></li>
<li><a href="../id403009/index.html">Alizar mencetak 5.000 publikasi di Geektimes</a></li>
<li><a href="../id403011/index.html">Dari ujung rambut sampai ujung kaki: beberapa contoh pakaian dan aksesoris yang pintar</a></li>
<li><a href="../id403013/index.html">Penelitian: Domestikasi Serigala Modern Mungkin</a></li>
<li><a href="../id403015/index.html">Apakah StarShot Hawking-Milner mungkin?</a></li>
<li><a href="../id403017/index.html">Realitas maya kosmik: pilihan untuk Hari Kosmonotika untuk anak-anak</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>