<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è™ üöµ üåé Grafikoptimierung. Interessanter konkaver Rumpf ü§∞üèº üë¥üèª ‚õ∏Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="W√§hrend der Entwicklung des Spiels war ich einmal mit dem Problem der Leistung auf modernen PCs konfrontiert. Unser Modellbauer hat einen ziemlich lei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Grafikoptimierung. Interessanter konkaver Rumpf</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436040/">  W√§hrend der Entwicklung des Spiels war ich einmal mit dem Problem der Leistung auf modernen PCs konfrontiert.  Unser Modellbauer hat einen ziemlich leistungsstarken modernen roten Montagecomputer.  Aber er hatte unser Projekt furchtbar langsam und lud einen Prozessorkern. <br><br>  Der Grund ist einfach: Die neuen Prozessoren haben viele Kerne, sind jedoch in Single-Thread-Anwendungen weniger effizient.  Zu dieser Zeit hatte ich ein Rendering in einem Stream.  Tats√§chlich waren die Gr√ºnde daf√ºr nicht so sehr.  Um das Problem zu finden, habe ich mich entschlossen zu berechnen, wie viele Polygone in der Szene vorhanden sind: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen006.jpg"><br><br>  Auf der durchschnittlichen Spielkarte, mit der maximalen Entfernung und mit einer gro√üen Gruppe von Palmen - <b>15 824 756 Dreiecke!</b>  Fast 16 Millionen!  Eine riesige Anzahl. <br><a name="habracut"></a><br>  Nachdem ich ein wenig mit dem Kartengenerator gespielt hatte, gelang es mir, einen Platz mit 16,75 Millionen zu finden: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen007.jpg"><br><br>  Obwohl hier ein √§hnlicher Ort mit Weihnachtsb√§umen nur 8,5 Millionen Dreiecke gab: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen008.jpg"><br><br>  Die durchschnittliche Szene bestand aus ~ 4 Millionen: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen009.jpg"><br><br>  Im Allgemeinen war ich froh, dass mein Render mit einer so gro√üen Anzahl von Dreiecken fertig wurde, aber ihre Anzahl war zu hoch.  Die L√∂sung war an der Oberfl√§che: <br><br><ol><li>  Optimieren Sie die Anzahl der Polygone in Modellen. </li><li>  Optimieren Sie das polygonale Netz der Landschaft. </li><li>  Die Implementierung von Multithread-Rendering. </li></ol><br>  F√ºr diejenigen, die m√∂glicherweise nicht am ersten Absatz unseres Optimierungsprogramms interessiert sind, z. B. unerfahrene Spezialisten, empfehle ich, sicher zum zweiten Teil √ºberzugehen. <br><br><h2>  1. Optimierung der Anzahl der Polygone in Modellen </h2><br>  In unserem Motor wird die Vegetation in ‚ÄûPackungen‚Äú gezeichnet, die gesamte Landschaft ist in Kacheln und Unterkacheln unterteilt, die Mindestpackung besteht aus einer Unterkachel. <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen001.jpg"><br><br>  Ein Pack ist ein Mesh, da durch die Reduzierung der Anzahl der Meshes die Anzahl der CPU-&gt; GPU-Aufrufe erheblich reduziert wird. <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen002.jpg"><br><br>  Anfangs bestanden unsere B√§ume aus Kegelst√ºmpfen, die sich zu vollen Kegeln bewegten. Es gelang uns, ein paar zus√§tzliche Dreiecke zu entfernen: <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen003.jpg"><br><br>  Die Kirsche auf dem Kuchen war die Entscheidung, die St√§mme von den B√§umen zu entfernen, weil sie mit unserem Kamerawinkel einfach nicht sichtbar waren. <br><br>  Infolgedessen konnten wir die Anzahl der Polygone auf einer Packung Weihnachtsb√§ume um durchschnittlich 40% reduzieren.  Die Unterschiede sind fast unsichtbar: <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen004.jpg"><br><br>  Bei Palmen war es schwieriger, aber Packungen mit 5000 - 6000 Polygonen mussten repariert werden.  Wie erreicht man Massivit√§t und Dichte des Dschungels?  Aufgrund der gro√üen Anzahl von Palmen wurde eine hohe Dichte des Dschungels erreicht: <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen005.jpg"><br><br>  Wir beschlossen, die Palmen zu vereinfachen und eine zweite Vegetationsstufe einzuf√ºhren, die es uns erm√∂glichte, die sichtbare Dichte beizubehalten und die gew√ºnschten 600 - 700 Polygone pro Packung zu erreichen. <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen006.jpg"><br><br>  Die 10-fache Reduzierung der Anzahl der Polygone ist ein hervorragendes Ergebnis. <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen007.jpg"><br><br><h2>  2. Optimierung der polygonalen Netzlandschaft </h2><br><br>  Urspr√ºnglich war das Landschaftsraster: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen010.jpg"><br><br>  Der Screenshot zeigt einfache Teile der Landschaft, dies sind Fliesen von Wiesen, Ebenen, wenn auch anderen glatten Oberfl√§chen.  Ich beschloss, kleine Unregelm√§√üigkeiten in der Landschaft zu beseitigen.  So vergr√∂√üerte er die Fl√§che der gleich hohen Fliesen.  Ich konnte dieses Ergebnis nicht erzielen, indem ich alle Eckpunkte der Kacheln und Unterkacheln geschickt auf H√∂hengleichheit √ºberpr√ºfte: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen012.jpg"><br><br>  Es gab immer noch flache Stellen, die optimiert werden konnten, und ich begann, Polygone aus diesen Dreiecken mit derselben H√∂he zu bauen.  Eine Kachel wurde genommen und alle ihre Dreiecke wurden in eine Anordnung von Dreiecken mit ungleicher H√∂he und eine Liste von Anordnungen sortiert, die aus gleich hohen und benachbarten Dreiecken bestehen. <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen008.jpg"><br><br>  Im angegebenen Beispiel stellte sich heraus: 1 Array von Dreiecken, die sich nicht √§ndern konnten, da sie alle unterschiedliche H√∂hen hatten (rote Dreiecke) und eine Liste bestehend aus zwei Arrays von Dreiecken mit derselben H√∂he (die Arrays sind mit Farbe gef√ºllt). <br><br>  Nun bestand die Aufgabe darin, aus der Anordnung der Dreiecke ihre konvex-konkave Kontur (konkave H√ºlle) zu finden, und viele Dreiecke konnten L√∂cher haben.  Fr√ºher bin ich bei meiner Arbeit auf Convex Hull gesto√üen, es gab keine Probleme mit ihnen, ich habe bereits den Graham-Algorithmus verwendet.  Aber es gab Probleme mit dem Bau von Concave Hull ... Es stellte sich als ziemlich schwierig heraus, Informationen zu diesem Thema im Internet zu finden.  Ich musste eine Implementierung von Algorithmen von Grund auf neu schreiben.  Ich werde nicht l√ºgen, wenn ich sage, dass ich ungef√§hr zehn verschiedene Dissertationen zu diesem Thema gelesen habe.  Alle vorgeschlagenen Algorithmen ergaben jedoch ein ungef√§hres Ergebnis mit einigen Fehlern.  Nach einer Woche voller Qualen und Schmerzen kam mir die Idee meines Algorithmus. <br><br>  Ich habe versucht, eine Kontur aus der Menge der Eckpunkte der Dreiecke zu erstellen, d. H.  Ich habe das Array von Dreiecken in ein Array von Eckpunkten √ºbersetzt und bereits eine Shell darauf aufgebaut.  F√ºr meine Aufgabe war dies jedoch nicht erforderlich.  Nach meinen Schlussfolgerungen war es einfacher, eine Schale direkt aus Dreiecken zu bauen, und die Genauigkeit des konkaven Rumpfes betrug 100%. <br><br>  Anfangs wollte ich hier ein Patchwork des Quellcodes des Algorithmus einf√ºgen, aber es scheint einfacher zu sein, es auf den Punkt zu bringen: Basis ist die Regel: Wenn der Scheitelpunkt eines Dreiecks in vier oder weniger Dreiecken enthalten ist, liegt eine der Kanten, die den Scheitelpunkt bilden, am Rand.  Als n√§chstes wird eine Liste solcher Kanten gebildet, wobei das Entfernen identischer Kanten ber√ºcksichtigt wird.  Wir finden die Kante mit dem kleinsten X und Y und beginnen damit die Passage / Sortierung der Kanten mit dem Hinzuf√ºgen eindeutiger Eckpunkte zur Liste.  Diese Liste wird die H√ºlle vieler Dreiecke sein.  Das einzige, was im Finale passiert, ist, kollineare Punkte aus der Liste zu entfernen. <br><br>  Infolgedessen konnte ich Concave Hull von nahezu beliebiger Komplexit√§t bauen.  Dieser Algorithmus passte nicht in einen Lochsatz, aber ich habe dies umgangen, indem ich diesen Satz einfach in zwei H√§lften in einem Loch geteilt habe.  Dann habe ich die Schaltung bekommen und sie trianguliert: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen014.jpg"><br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen015.jpg"><br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen016.jpg"><br><br>  Alles hat gut geklappt: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen017.jpg"><br><br>  Aber am Ende war ich √ºber das Ergebnis ver√§rgert.  Der von mir entwickelte Algorithmus f√ºhrte zu einer sp√ºrbaren Leistungssteigerung beim Rendern einer Szene, da die Anzahl der Polygone im Durchschnitt um 60 bis 70% reduziert wurde.  Gleichzeitig begann die Kartengenerierung zehnmal langsamer.  Der Algorithmus erwies sich als sehr zeitaufw√§ndig. <br><br>  Es dauerte drei Tage, um eine leichtgewichtige Version des Algorithmus zur Optimierung des polygonalen Netzes der Landschaft in Betracht zu ziehen, die folgende Ergebnisse lieferte: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen027.jpg"><br><br>  Jetzt sind die Datenberechnungen zur Optimierung vor dem Hintergrund der Kartengenerierung nicht mehr erkennbar, und die Anzahl der Polygone ist im Durchschnitt um 40-50% gesunken. <br><br>  Dieser Artikel ist versuchsweise und oberfl√§chlich.  Wenn sich jemand f√ºr das Thema Spieleentwicklung interessiert, bin ich bereit, den Artikel mit dem Geist spezifischer Schritte, L√∂sungen und zuk√ºnftiger Pl√§ne fortzusetzen und zu erweitern.  Ich denke auch, dass Sie sich f√ºr das Thema des Erstellens einer in Java entwickelten Open GL-Multithread-Anwendung interessieren werden, √ºber das ich im n√§chsten Artikel sprechen werde. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de436040/">https://habr.com/ru/post/de436040/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de436026/index.html">Info Desk: ‚ÄûInternet Archive‚Äú - Geschichte, Mission und Nebenprojekte</a></li>
<li><a href="../de436028/index.html">Eine Einf√ºhrung in Kubernetes f√ºr VMware-Benutzer. Teil 1. Theorie</a></li>
<li><a href="../de436032/index.html">React Tutorial Teil 9: Komponenteneigenschaften</a></li>
<li><a href="../de436036/index.html">K√∂nnen Forscher der k√ºnstlichen Intelligenz ihm einen Test ihrer Arbeit anvertrauen?</a></li>
<li><a href="../de436038/index.html">Der Klang der Stille: Wie viele verr√ºckte Ger√§te sind erforderlich, um eine Umgebung zu erreichen, die f√ºr den Schlaf optimal ist?</a></li>
<li><a href="../de436042/index.html">Panel mit zus√§tzlichen Tools f√ºr den Entwickler von InterSystems IRIS</a></li>
<li><a href="../de436044/index.html">VDS-Server in Amsterdam f√ºr 150 Rubel / Monat</a></li>
<li><a href="../de436048/index.html">Arbeiten Sie an Wi-Fi-Hotspots zusammen</a></li>
<li><a href="../de436050/index.html">So verbinden Sie Raspberry PI mit Azure IoT: Schritt-f√ºr-Schritt-Anleitung</a></li>
<li><a href="../de436052/index.html">So erstellen Sie eine Data Science-Abteilung und vermasseln sie nicht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>