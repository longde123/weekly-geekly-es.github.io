<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ∑Ô∏è üñïüèº üéë Nous d√©ployons l'automatisation en quelques heures: TypeScript, Protractor, Jasmine üë©üèæ‚Äçüéì üë©üèø‚Äçü§ù‚Äçüë®üèæ üì¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! 

 Je m'appelle Vitaliy Kotov, je fais beaucoup de tests d'automatisation et j'aime √ßa. J'ai r√©cemment particip√© √† un projet de configu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous d√©ployons l'automatisation en quelques heures: TypeScript, Protractor, Jasmine</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451522/"> Bonjour, Habr! <br><br>  Je m'appelle Vitaliy Kotov, je fais beaucoup de tests d'automatisation et j'aime √ßa.  J'ai r√©cemment particip√© √† un projet de configuration de l'automatisation √† partir de z√©ro sur la pile TypeScript + Protractor + Jasmine.  Pour moi, cette pile √©tait nouvelle et j'ai cherch√© les informations n√©cessaires sur Internet. <br><br>  J'ai r√©ussi √† trouver les manuels les plus utiles et les plus sens√©s uniquement en anglais.  J'ai d√©cid√© qu'en russe, je devais √©galement le faire.  Je vais seulement vous dire les bases: pourquoi une telle pile, ce que vous devez configurer et √† quoi ressemble le test le plus simple. <br><br>  Je dois dire tout de suite que je travaille rarement avec NodeJS, npm et avec JavaScript c√¥t√© serveur en g√©n√©ral (en particulier avec TypeScript).  Si vous trouvez une erreur dans la terminologie quelque part ou si certaines de mes d√©cisions peuvent √™tre am√©lior√©es, je serai heureux de le savoir dans les commentaires de gars plus exp√©riment√©s. <br><br>  Au fait, j'avais d√©j√† un article similaire: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Nous d√©ployons l'automatisation en quelques heures: PHPUnit, Selenium, Composer¬ª</a> . <br><br><img src="https://habrastorage.org/webt/mn/rc/5t/mnrc5tzbyn3hmecryv5sj-1nuae.png"><br><a name="habracut"></a><br><h3>  D√©fi </h3><br>  Tout d'abord, voyons quel probl√®me nous r√©solvons.  Nous avons une application web √©crite en utilisant AngularJS.  Il s'agit d'un framework JavaScript bas√© sur lequel les projets Web sont souvent √©crits. <br><br>  Dans cet article, nous ne consid√©rerons pas les avantages et les inconv√©nients des projets AngularJS.  Quelques mots sur les caract√©ristiques de ces projets en termes de r√©daction de tests e2e pour eux. <br><br>  Un aspect assez important du test de l'automatisation est de travailler avec des √©l√©ments de page, ce qui se produit √† l'aide de localisateurs.  Un localisateur est une ligne compos√©e selon certaines r√®gles et identifiant un √©l√©ment d'interface utilisateur: un ou plusieurs. <br><br>  Pour le Web, CSS et Xpath sont les plus couramment utilis√©s.  Parfois, s'il y a un √©l√©ment avec un ID unique sur la page, vous pouvez le rechercher.  Cependant, il me semble que WebDriver transforme toujours cet ID en un localisateur CSS √† la fin et travaille d√©j√† avec lui. <br><br>  Si nous regardons le code HTML d'un projet AngularJS, nous verrons que les √©l√©ments ont beaucoup d'attributs qui ne sont pas en HTML classique: <br><br><img src="https://habrastorage.org/webt/zg/r3/et/zgr3etoo6q7qeycuobh1tl9g1f4.png"><br><br>  Le code est extrait de la page de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©monstration</a> du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapporteur</a> . <br><br>  Tous les attributs commen√ßant par ng- * sont utilis√©s par AngularJS pour travailler avec l'interface utilisateur.  Une situation assez typique est lorsque les √©l√©ments n'ont pas d'autres attributs que ces attributs de contr√¥le, ce qui complique quelque peu le processus de compilation des localisateurs de qualit√©. <br><br>  Ceux qui ont fait beaucoup d'automatisation connaissent la valeur de telles interfaces utilisateur pour lesquelles les localisateurs peuvent √™tre facilement construits.  Apr√®s tout, cela est rare pour les grands projets.  :) <br><br>  En fait, pour un tel projet, nous devons √©galement configurer l'automatisation des tests.  C'est parti! <br><br><h3>  C'est quoi </h3><br>  Tout d'abord, d√©couvrons pourquoi chaque composant de notre pile est n√©cessaire. <br><br>  <b>Protractor</b> est un framework de test bas√© sur WebDriverJS.  Ce sera lui qui lancera nos navigateurs, leur fera ouvrir les pages n√©cessaires et interagira avec les √©l√©ments n√©cessaires. <br><br>  Ce cadre est sp√©cialement con√ßu pour les projets AngularJS.  Il fournit des moyens suppl√©mentaires pour sp√©cifier les localisateurs: <br><br><pre><code class="javascript hljs">element(by.model(<span class="hljs-string"><span class="hljs-string">'first'</span></span>)); element(by.binding(<span class="hljs-string"><span class="hljs-string">'latest'</span></span>)); element(by.repeater(<span class="hljs-string"><span class="hljs-string">'some'</span></span>));</code> </pre> <br>  Une liste compl√®te se trouve sur la page de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">manuel</a> . <br><br>  Ces m√©thodes simplifient la cr√©ation et la prise en charge de localisateurs sur un projet.  Cependant, vous devez comprendre que "sous le capot" tout cela est en tout cas converti en css.  Le fait est que le protocole W3C, sur la base duquel l'interaction dans WebDriver a lieu, ne peut fonctionner qu'avec un ensemble fini de localisateurs.  Cette liste peut √™tre consult√©e sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">w3.org</a> . <br><br>  <b>TypeScript</b> est un langage de programmation cr√©√© par Microsoft.  TypeScript diff√®re de JavaScript par sa capacit√© √† taper des variables, la prise en charge de l'utilisation de classes √† part enti√®re et la possibilit√© de connecter des modules. <br><br>  √âcrit en code TS pour fonctionner avec le moteur V8 est traduit en code JS, qui est d√©j√† en cours d'ex√©cution.  Lors de cette transformation, la conformit√© du code est v√©rifi√©e.  Par exemple, il ne ¬´compile¬ª pas si, au lieu de int, une cha√Æne est explicitement pass√©e quelque part √† la fonction. <br><br>  <b>Jasmine</b> est un framework pour tester le code JavaScript.  En fait, c'est gr√¢ce √† lui que notre code JS se transforme en ce que nous appelions un test.  Il g√®re ces tests. <br><br>  Ci-dessous, nous examinons ses capacit√©s. <br><br><h3>  Montage et configuration du projet </h3><br>  Eh bien, nous avons d√©cid√© d'un ensemble de cadres, maintenant, mettons tout cela ensemble. <br><br>  Pour travailler avec le code, j'ai choisi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Visual Studio Code</a> de Microsoft.  Bien que beaucoup √©crivent dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WebStorm</a> ou m√™me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Intellij Idea</a> de JetBrains. <br><br>  J'ai d√©j√† install√© NodeJS (v11.6.0) et NPM (6.9.0).  Si vous ne l'avez pas, ce n'est pas un probl√®me, leur installation n'est pas difficile.  Tout est d√©crit suffisamment en d√©tail sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> . <br><br>  Le fil peut √™tre utilis√© √† la place du NPM, bien que cela ne soit pas important pour un petit projet. <br><br>  Dans notre IDE, nous cr√©ons un nouveau projet.  Nous cr√©ons package.json √† la racine du projet - c'est l√† que nous d√©crirons tous les packages dont nous avons besoin pour le projet. <br><br>  Vous pouvez le cr√©er √† l'aide de la commande <i>npm init</i> .  Ou vous pouvez simplement copier le contenu dans un fichier. <br><br>  Initialement, <b>package.json</b> ressemble √† ceci: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"@types/node"</span></span>: <span class="hljs-string"><span class="hljs-string">"^10.5.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"@types/jasmine"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.3.12"</span></span>, <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>: <span class="hljs-string"><span class="hljs-string">"^5.4.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"typescript"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.4.1"</span></span> } }</code> </pre><br>  Apr√®s cela, nous <i>ex√©cutons la</i> commande <i>npm install</i> pour installer tous les modules n√©cessaires et leurs d√©pendances (enfin, vous vous souvenez de l'image m√™me de quelque chose de plus lourd qu'un trou noir ...) <br><br>  En cons√©quence, nous devrions avoir un r√©pertoire node_modules.  Si elle est apparue, alors tout se passe comme pr√©vu.  Sinon, il vaut la peine d'examiner le r√©sultat de l'ex√©cution de la commande, g√©n√©ralement tout y est d√©crit en d√©tail. <br><br><h3>  TypeScript et sa configuration </h3><br>  Pour installer TypeScript, nous avons besoin de npm: <br><br><pre> <code class="plaintext hljs">npm install -g typescript</code> </pre><br>  Assurez-vous qu'il est install√©: <br><br><pre> <code class="plaintext hljs">$ tsc -v Version 3.4.1</code> </pre><br>  Tout semble √™tre en ordre. <br><br>  Maintenant, nous devons cr√©er une configuration pour travailler avec TS.  Il doit √©galement √™tre √† la racine du projet et s'appeler <b>tsconfig.json</b> <br><br>  Son contenu sera comme ceci: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"compilerOptions"</span></span>: { <span class="hljs-string"><span class="hljs-string">"lib"</span></span>: [<span class="hljs-string"><span class="hljs-string">"es6"</span></span>], <span class="hljs-string"><span class="hljs-string">"strict"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"outDir"</span></span> : <span class="hljs-string"><span class="hljs-string">"output_js"</span></span>, <span class="hljs-string"><span class="hljs-string">"types"</span></span> : [<span class="hljs-string"><span class="hljs-string">"jasmine"</span></span>, <span class="hljs-string"><span class="hljs-string">"node"</span></span>] }, <span class="hljs-string"><span class="hljs-string">"exclude"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"node_modules/*"</span></span> ] }</code> </pre><br>  En bref, nous avons sp√©cifi√© ce qui suit dans cette configuration: <br><br><ul><li>  Dans quel r√©pertoire placer le code JS final (dans notre cas, c'est output_js) </li><li>  Activer le mode strict </li><li>  Indiqu√© avec quels cadres nous travaillons </li><li>  Exclusion de node_modules de la compilation </li></ul><br>  TS a une grande vari√©t√© de param√®tres.  C'est suffisant pour notre projet.  Vous pouvez en savoir plus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur typescriptlang.org</a> . <br><br>  Voyons maintenant comment fonctionne la commande <i>tsc</i> , qui transformera notre code TS en code JS.  Pour ce faire, cr√©ez un simple fichier check_tsc.ts avec le contenu suivant: <br><br><pre> <code class="javascript hljs">saySomething(<span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saySomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message: string</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(message); }</code> </pre><br>  Ensuite, ex√©cutez la commande <i>tsc</i> (pour cela, vous devez √™tre dans le r√©pertoire du projet). <br><br>  Nous verrons que nous avons le r√©pertoire output_js et un fichier js similaire avec le contenu suivant est apparu √† l'int√©rieur: <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">"use strict"</span></span>; saySomething(<span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saySomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(message); }</code> </pre><br>  Ce fichier peut d√©j√† √™tre lanc√© √† l'aide de la commande node: <br><br><pre> <code class="plaintext hljs">$ node output_js/check_tsc.js Hello, world!</code> </pre><br>  Nous avons donc √©crit notre premier programme TypeScipt, f√©licitations.  √âcrivons des tests maintenant.  :) <br><br><h3>  Configuration du rapporteur </h3><br>  Pour Protractor, nous avons √©galement besoin d'une configuration.  Mais ce ne sera plus sous forme de json, mais sous forme de fichier ts.  Appelons-le config.ts et √©crivons-y le code suivant: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Config } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config: Config = { <span class="hljs-attr"><span class="hljs-attr">seleniumAddress</span></span>: <span class="hljs-string"><span class="hljs-string">"http://127.0.0.1:4444/wd/hub"</span></span>, <span class="hljs-attr"><span class="hljs-attr">SELENIUM_PROMISE_MANAGER</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">capabilities</span></span>: { <span class="hljs-attr"><span class="hljs-attr">browserName</span></span>: <span class="hljs-string"><span class="hljs-string">"chrome"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*chromeOptions: { args: [ "--headless", "--window-size=800,600" ] }*/</span></span> }, <span class="hljs-attr"><span class="hljs-attr">specs</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Tests/*Test.js"</span></span>, ] };</code> </pre><br>  Dans ce fichier, nous avons sp√©cifi√© les √©l√©ments suivants: <br><br>  Tout d'abord, le chemin d'acc√®s au serveur Selenium en cours d'ex√©cution.  Il est assez simple √† ex√©cuter, il vous suffit de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©charger le fichier jar du serveur autonome</a> et les pilotes n√©cessaires (par exemple, le pilote chrome <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pour le navigateur Chrome</a> ).  Ensuite, √©crivez la commande suivante: <br><br><pre> <code class="plaintext hljs">java -jar -Dwebdriver.chrome.driver=/path/to/chromedriver /path/to/selenium-server-standalone.jar</code> </pre><br>  En cons√©quence, nous devrions voir la conclusion suivante: <br><br><pre> <code class="plaintext hljs">23:52:41.691 INFO [GridLauncherV3.launch] - Selenium build info: version: '3.11.0', revision: 'e59cfb3' 23:52:41.693 INFO [GridLauncherV3$1.launch] - Launching a standalone Selenium Server on port 4444 2019-05-02 23:52:41.860:INFO::main: Logging initialized @555ms to org.seleniumhq.jetty9.util.log.StdErrLog 23:52:42.149 INFO [SeleniumServer.boot] - Welcome to Selenium for Workgroups.... 23:52:42.149 INFO [SeleniumServer.boot] - Selenium Server is up and running on port 4444</code> </pre><br>  Le port 4444 est par d√©faut.  Il peut √™tre d√©fini √† l'aide du param√®tre -port ou via le param√®tre de configuration "seleniumArgs" =&gt; "-port". <br><br>  Si vous voulez plus simple et plus rapide: vous pouvez t√©l√©charger le package npm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">webdriver-manager</a> . <br><br>  Ensuite, g√©rez le serveur √† l'aide des commandes de d√©marrage, d'arr√™t, etc.  Il n'y a pas beaucoup de diff√©rence, c'est juste que je suis plus habitu√© √† travailler avec un fichier jar.  :) <br><br>  <b>Deuxi√®mement</b> , nous avons indiqu√© que nous ne voulions pas utiliser le gestionnaire Promise.  Plus d'informations √† ce sujet plus tard. <br><br>  <b>Troisi√®mement</b> , nous avons sp√©cifi√© des capacit√©s pour notre navigateur.  J'ai comment√© une partie, par exemple, que nous pouvons assez facilement lancer le navigateur en mode sans t√™te.  C'est une fonctionnalit√© int√©ressante, mais elle ne vous permettra pas d'observer visuellement nos tests.  En attendant, nous apprenons juste - je voudrais.  :) <br><br>  <b>Quatri√®mement</b> , nous avons sp√©cifi√© un masque pour les sp√©cifications (tests).  Tout ce qui se trouve dans le dossier Tests et se termine par Test.js.  Pourquoi sur js, pas ts?  En effet, en fin de compte, Node fonctionnera sp√©cifiquement avec les fichiers JS et non avec les fichiers TS.  Il est important de ne pas se confondre, surtout au d√©but du travail. <br><br>  Cr√©ez maintenant le dossier Tests et √©crivez le premier test.  Il fera ce qui suit: <br><br><ul><li>  D√©sactive la v√©rification qu'il s'agit d'une page angulaire.  Sans cela, nous obtenons ce message d'erreur: Erreur lors de l'ex√©cution de testForAngular.  Bien s√ªr, pour les pages angulaires, cette v√©rification n'est pas n√©cessaire pour d√©sactiver. </li><li>  Acc√®de √† la page Google. </li><li>  V√©rifiez qu'il existe un champ de saisie de texte. </li><li>  Entrez le texte ¬´rapporteur¬ª. </li><li>  Cliquez sur le bouton soumettre (il a un localisateur assez compliqu√©, car il y a deux boutons et le premier est invisible). </li><li>  On s'attendra √† ce que l'URL contienne le mot ¬´rapporteur¬ª - cela signifie que nous avons tout fait correctement et que la recherche a commenc√©. </li></ul><br>  Voici le code que j'ai obtenu: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { browser, by, element, protractor } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'Search'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'Open google and find a text'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-comment"><span class="hljs-comment">//       let EC = protractor.ExpectedConditions; //    AngularJS await browser.waitForAngularEnabled(false); //   Google await browser.get('https://www.google.com/'); //    css = input[role='combobox'] let input_button = element(by.css("input[role='combobox']")); //     ( presenceOf) await browser.wait(EC.presenceOf(input_button), 5000); //     ‚Äúprotractor‚Äù await input_button.sendKeys("protractor"); //      css let submit_button = element(by.css(".FPdoLc input[type='submit'][name='btnK']")); //      ( ,     input-,   ) await browser.wait(EC.presenceOf(submit_button), 5000); //     await submit_button.click(); // ,  URL    'protractor' await browser.wait(EC.urlContains('protractor'), 5000); }); });</span></span></code> </pre><br>  Dans le code, nous voyons que tout commence par la fonction describe ().  Elle nous est venue du framework Jasmine.  Ceci est un wrapper pour notre script.  √Ä l'int√©rieur, il peut y avoir des fonctions beforeAll () et beforeEach () pour effectuer des manipulations avant tous les tests et avant chaque test.  Autant de fonctions qu'il () sont, en fait, nos tests.  En fin de compte, s'ils sont d√©finis, afterAll () et afterEach () seront ex√©cut√©s pour les manipulations apr√®s chaque test et tous les tests. <br><br>  Je ne parlerai pas de toutes les fonctionnalit√©s de Jasmine, vous pouvez les lire sur le site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jasmine.github.io</a> <br><br>  Pour ex√©cuter notre test, vous devez d'abord transformer le code TS en code JS, puis l'ex√©cuter: <br><br><pre> <code class="plaintext hljs">$ tsc $ protractor output_js/config.js</code> </pre><br>  Notre test a commenc√© - nous sommes super.  :) <br><br><img src="https://habrastorage.org/webt/0f/vu/wc/0fvuwcmgrgf-pspd7vngaweq2dy.png"><br><br>  Si le test n'a pas commenc√©, il convient de v√©rifier: <br><br><ul><li>  Que le code est √©crit correctement.  En g√©n√©ral, s'il y a des erreurs critiques dans le code, nous les rattraperons lors de la commande tsc. </li><li>  Ce serveur Selenium est en cours d'ex√©cution.  Pour ce faire, vous pouvez ouvrir l'URL http: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">//127.0.0.1-00-00444/wd/hub</a> - il devrait y avoir une interface pour les sessions Selenium. </li><li>  Que Chrome d√©marre normalement avec la version t√©l√©charg√©e de chrome-driver.  Pour ce faire, sur la page wd / hub /, cliquez sur Cr√©er une session et s√©lectionnez Chrome.  S'il ne d√©marre pas, vous devez soit mettre √† jour Chrome, soit t√©l√©charger une autre version de chrome-driver. </li><li>  Si tout cela √©choue, vous pouvez v√©rifier que la commande npm install s'est termin√©e avec succ√®s. </li><li>  Si tout est √©crit correctement, mais que rien ne d√©marre toujours - essayez de rechercher l'erreur sur google.  Cela aide le plus souvent.  :) </li></ul><br><h3>  Scripts NPM </h3><br>  Pour vous simplifier la vie, vous pouvez cr√©er une partie des commandes npm alias.  Par exemple, je voudrais supprimer le r√©pertoire avec les fichiers JS pr√©c√©dents et le recr√©er avec de nouveaux avant chaque test. <br><br>  Pour ce faire, ajoutez l'√©l√©ment de scripts √† package.json: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>, <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"rm -rf output_js/; tsc; protractor output_js/config.js"</span></span> }, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"@types/node"</span></span>: <span class="hljs-string"><span class="hljs-string">"^10.5.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"@types/jasmine"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.3.12"</span></span>, <span class="hljs-string"><span class="hljs-string">"protractor"</span></span>: <span class="hljs-string"><span class="hljs-string">"^5.4.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"typescript"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.4.1"</span></span> } }</code> </pre><br>  Maintenant, en entrant la commande de <i>test npm,</i> les √©v√©nements suivants se produiront: le r√©pertoire output_js avec l'ancien code sera supprim√©, il sera recr√©√© et un nouveau code JS y sera √©crit.  Apr√®s quoi, les tests commenceront imm√©diatement. <br><br>  Au lieu de cet ensemble de commandes, vous pouvez sp√©cifier toute autre dont vous avez personnellement besoin pour travailler.  Par exemple, vous pouvez d√©marrer et √©teindre un serveur au s√©l√©nium entre les tests.  Bien que cela, bien s√ªr, est plus facile √† contr√¥ler √† l'int√©rieur du code de test lui-m√™me. <br><br><h3>  Un peu sur Promise </h3><br>  Au final, je vais parler un peu de Promise, async / wait et en quoi l‚Äô√©criture des tests dans NodeJS diff√®re du m√™me Java ou Python. <br><br>  JavaScript est un langage asynchrone.  Cela signifie que le code n'est pas toujours ex√©cut√© dans l'ordre dans lequel il est √©crit.  Cela inclut les requ√™tes HTTP, et nous nous souvenons que le code communique avec Selenium Server via HTTP. <br><br>  Promise (g√©n√©ralement appel√© ¬´promesses¬ª) fournit un moyen pratique d'organiser le code asynchrone.  Vous pouvez en savoir plus √† leur sujet sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">learn.javascript.ru</a> . <br><br>  En fait, ce sont des objets qui rendent un code d√©pendant de l'ex√©cution d'un autre, garantissant ainsi un certain ordre.  Le rapporteur travaille tr√®s activement avec ces objets. <br><br>  Regardons un exemple.  Supposons que nous ex√©cutons le code suivant: <br><br><pre> <code class="java hljs">driver.findElement().getText();</code> </pre><br>  En Java, nous nous attendons √† ce que nous renvoyions un objet de type String.  Dans Protractor, ce n'est pas tout √† fait le cas, nous retournerons un objet Promise.  Et juste comme √ßa, l'imprimer avec un objectif de d√©bogage ne fonctionnera pas. <br><br>  Habituellement, nous n'avons pas besoin d'imprimer la valeur r√©sultante.  Nous devons le passer √† une autre m√©thode qui fonctionnera d√©j√† avec cette valeur.  Par exemple, il v√©rifiera la conformit√© du texte avec l'attendu. <br><br>  Des m√©thodes similaires dans Protractor acceptent √©galement les objets Promise en entr√©e, il n'y a donc aucun probl√®me.  Mais, si vous voulez toujours voir la valeur, () vous sera utile. <br><br>  C'est ainsi que nous pouvons imprimer le texte du bouton sur une page Google (notez que puisqu'il s'agit d'un bouton, le texte est √† l'int√©rieur de l'attribut value): <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   let submit_button = element(by.css(".FPdoLc input[type='submit'][name='btnK']")); //    await browser.wait(EC.presenceOf(submit_button), 5000); //   then()   await submit_button.getAttribute("value").then((text) =&gt; { console.log(text); });</span></span></code> </pre><br>  En ce qui concerne les mots cl√©s asynchrones / attendent, il s'agit d'une approche l√©g√®rement plus r√©cente pour travailler avec du code asynchrone.  Il vous permet d'√©viter l'enfer des promesses, qui √©tait auparavant form√© dans le code en raison du grand nombre d'imbrication.  N√©anmoins, vous ne pourrez pas vous d√©barrasser compl√®tement de Promise et vous devez pouvoir travailler avec eux.  Ceci est compr√©hensible et d√©taill√© peut √™tre trouv√© dans l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conception asynchrone / attendre en JavaScript: forces, pi√®ges et caract√©ristiques d'utilisation</a> . <br><br><h3>  Devoirs </h3><br>  En guise de devoirs, je sugg√®re d'√©crire des tests pour une page √©crite en AngularJS: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">protractor-demo</a> . <br><br>  N'oubliez pas de supprimer la ligne du code concernant la d√©sactivation de la v√©rification des pages sur AngularJS.  Et assurez-vous de travailler avec des localisateurs sp√©cialement con√ßus pour AngularJS.  Il n'y a pas de magie particuli√®re √† cela, mais c'est assez pratique. <br><br><h3>  R√©sum√© </h3><br>  Faisons le point.  Nous avons r√©ussi √† √©crire des tests qui fonctionnent sur un tas de TypeScript + Protractor + Jasmine.  Nous avons appris √† construire un tel projet, √† cr√©er les configurations n√©cessaires et √† √©crire le premier test. <br><br>  En cours de route, nous avons discut√© un peu de l'utilisation des tests automatiques JavaScript.  Cela semble bon pour quelques heures.  :) <br><br><h3>  Que lire, o√π chercher </h3><br>  <b>Protractor</b> a un tr√®s bon manuel avec des exemples JavaScript: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.protractortest.org/#/tutorial</a> <br>  <b>Jasmine</b> a un manuel: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://jasmine.github.io/pages/docs_home.html</a> <br>  <b>TypeScipt</b> a un bon d√©but: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html</a> <br><br>  Sur le support, il y a un bon article en anglais sur TypeScript + Protractor + Cucumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://medium.com/@igniteram/e2e-testing-with-protractor-cucumber-using-typescript-564575814e4a</a> <br><br>  Et dans mon r√©f√©rentiel, j'ai publi√© le code final de ce dont nous avons discut√© dans cet article: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/KotovVitaliy/HarbProtractorJasmineJasmine</a> . <br><br>  Sur Internet, vous pouvez trouver des exemples de projets plus complexes et plus importants sur cette pile. <br><br>  Merci de votre attention!  :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr451522/">https://habr.com/ru/post/fr451522/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr451512/index.html">Comment analyser le protocole r√©seau MMORPG mobile</a></li>
<li><a href="../fr451514/index.html">Nouvelles des sous-grilles CSS</a></li>
<li><a href="../fr451516/index.html">Mod√®les de conception utilis√©s dans le framework Spring</a></li>
<li><a href="../fr451518/index.html">Nos sites Web mobiles d√©pouill√©s</a></li>
<li><a href="../fr451520/index.html">VDI: pas cher et gai</a></li>
<li><a href="../fr451524/index.html">L'histoire de la rupture de la bouilloire Autoplay Media Studio 8.5.3.0</a></li>
<li><a href="../fr451528/index.html">¬´Et c'est ainsi¬ª: que les fournisseurs de cloud ne s'entendent pas sur les donn√©es personnelles</a></li>
<li><a href="../fr451532/index.html">Nouvelles du monde d'OpenStreetMap n ¬∞ 459 (30/04/2019 - 06/05/2019)</a></li>
<li><a href="../fr451534/index.html">12 principes d'animation dans le d√©veloppement de jeux vid√©o</a></li>
<li><a href="../fr451538/index.html">Guide de mise √† l'√©chelle parall√®le d'Amazon Redshift et r√©sultats des tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>