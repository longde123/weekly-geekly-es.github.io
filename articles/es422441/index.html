<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïú üë®‚Äçüî¨ üîì Encontr√© una f√≥rmula para una transici√≥n indolora a .Net Core üëê ü§ù ‚ö°Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="50 tazas de caf√© son suficientes para todo. 


 Adem√°s de la regla general descrita anteriormente, publicamos una breve nota sobre los puntos que debe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Encontr√© una f√≥rmula para una transici√≥n indolora a .Net Core</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/422441/"><p>  50 tazas de caf√© son suficientes para todo. </p><br><p>  Adem√°s de la regla general descrita anteriormente, publicamos una breve nota sobre los puntos que deben prestarse mucha atenci√≥n para que nada se rompa en la batalla y en los procesos.  La nota se hizo en la b√∫squeda del lanzamiento de un servicio m√≥vil que migr√≥ completamente a .Net Core (el comienzo se estableci√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> ).  Logramos realizar esta operaci√≥n sin ser notada por el cliente, casi sin detener el proceso de desarrollo principal. </p><br><p>  A continuaci√≥n se muestra un plan de acci√≥n listo, habr√° una lista de pruebas muy amplia, esta imagen estar√° aqu√≠ para el estado de √°nimo: </p><br><p><img src="https://habrastorage.org/webt/pt/yp/6s/ptyp6szarkzymkgf34tz0ide3r8.jpeg"></p><a name="habracut"></a><br><h3 id="itak-po-shagam">  Entonces, en pasos: </h3><br><h4 id="1-zaplanirovat-dlinnyy-sprint-s-bolshimi-fichami-iili-regressom">  1. Planifique un sprint largo con grandes caracter√≠sticas y / o regresi√≥n </h4><br><p>  Con la reescritura de c√≥digo fundamental, el servicio necesitar√° tiempo para insistir el mayor tiempo posible para tener tiempo de corregir todas las fallas en el entorno de prueba. </p><br><h4 id="2-v-akkurat-k-sprintu-perepisat-kod-na-net-core">  2. En el sprint exacto para reescribir el c√≥digo en .Net Core </h4><br><p>  ¬øPor qu√© es importante no comenzar este negocio antes de tiempo?  Debido a que debe extraer dos ramas de c√≥digo con el .net nuevo y antiguo, porque en cualquier momento puede volar un p√°jaro de urgencia o deber√° realizar una demostraci√≥n de las nuevas caracter√≠sticas, y luego deber√° realizar cambios en la rama estable anterior.  Para experimentar una preocupaci√≥n m√≠nima sobre esto, es mejor acortar el momento del estado de transici√≥n. </p><br><p>  Por cierto, cuando trabajamos con el c√≥digo, llegamos r√°pidamente a la conclusi√≥n de que es m√°s conveniente mantener dos copias del repositorio localmente.  Es m√°s f√°cil y m√°s conveniente que cambiar dos ramas masivas. </p><br><ul><li>  Si es posible, reescriba las interfaces WCF en webapi en los servicios utilizados </li></ul><br><p>  La implementaci√≥n de .Net Core del cliente WCF a√∫n est√° lejos de ser ideal.  A pesar del hecho de que las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">llagas</a> viejas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">est√°n</a> de alguna manera arregladas, en las nuevas versiones todav√≠a tiene que usar la soluci√≥n ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2</a> ). </p><br><blockquote>  Para la historia: en .Net Core 2.0, la versi√≥n de trabajo estable de WCF es 4.4.2 del repositorio myget.  Ella, por ejemplo, no tiene problemas con un tiempo de espera temprano </blockquote><p>  Al comienzo de la migraci√≥n, utilizamos la versi√≥n de .Net Core 2.0.  Mientras tanto, Microsoft lanz√≥ .Net Core 2.1.  ¬øQui√©n est√° interesado en admirar los √©xitos de los chicos de Redmond en la optimizaci√≥n de la plataforma? Lea el progreso que hizo el motor de b√∫squeda <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bing</a> al actualizar a la nueva versi√≥n (spoiler: ¬°latensi cay√≥ un 34%!) </p><br><p>  Tambi√©n actualizamos a .Net Core 2.1 y WCF 4.5.3.  Y no nos olvidamos de especificar en el Dockerfile una nueva imagen base de microsoft / dotnet: 2.1-aspnetcore-runtime.  Cu√°l fue la sorpresa cuando, en lugar de 1,4 GB, vieron un tama√±o de imagen de 0,5 GB (estamos hablando de una imagen de Windows, si de repente). </p><br><h4 id="3-zadeploit-na-test-i-demo">  3. Ensillarse para una prueba y demostraci√≥n </h4><br><p>  Tenemos dos ambientes a nuestra disposici√≥n.  Dejamos la demo con la versi√≥n anterior como referencia.  Se implement√≥ un nuevo servicio en el entorno de prueba: una ejecuci√≥n en desarrolladores y probadores. </p><br><p> Hubo cierta confusi√≥n debido al hecho de que los desarrolladores generalmente trabajan con la prueba, y los probadores principalmente con una demostraci√≥n.  Si era necesario actualizar el antiguo servicio, la situaci√≥n era exactamente lo contrario de lo normal.  Por lo tanto, una discusi√≥n y una hoja de trucos sobre d√≥nde y qu√© buscar fue √∫til. </p><br><ul><li>  Configurar IIS </li></ul><br><p>  Para ejecutar el servicio .Net Core en IIS, debe instalar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√≥dulo</a> que viene con el tiempo de ejecuci√≥n. </p><br><p>  AppPool cambia a CLR Runtime = Sin c√≥digo administrado. </p><br><p>  En la soluci√≥n en el est√°ndar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">web.config,</a> es importante no olvidar establecer el requestTimeout deseado y deshabilitar el m√≥dulo WebDAV, si hay m√©todos DELETE. </p><br><p>  Adem√°s, hay dos opciones para publicar un servicio en IIS: </p><br><ul><li>  realiza la sincronizaci√≥n de MSDeploy, lo que significa que adem√°s necesita <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el</a> conmutador -enableRule: AppOffline </li><li>  publica el archivo: significa exactamente antes de la publicaci√≥n, debe colocar el archivo app_offline.htm en el directorio de servicios y, despu√©s de la publicaci√≥n, eliminarlo </li></ul><br><p>  Tanto eso como otro permiten detener un proceso de trabajo y abrir archivos ejecutables.  De lo contrario, se producir√° un error de que los archivos no est√°n disponibles para sobrescribirse. </p><br><blockquote>  Rechazamos el registro a trav√©s de Nlog a favor de Serilog, y perdimos la compresi√≥n autom√°tica de registros; en Serilog simplemente no existe tal caracter√≠stica.  En este caso, puede guardarlo utilizando herramientas normales de Windows e instalar la compresi√≥n NTFS en las propiedades del directorio. </blockquote><br><h4 id="4-protestirovat">  4. Prueba </h4><br><p>  Aqu√≠ est√° la lista de verificaci√≥n m√°s reducida para los lugares m√°s fr√°giles: </p><br><ul><li>  verifique la devoluci√≥n de los c√≥digos de estado Solicitud incorrecta, no autorizada, no modificada, no encontrada: todo lo que la API puede brindar </li><li>  verificar el registro de solicitudes para todos los c√≥digos de estado </li><li>  hacer un diagrama de dependencias externas;  como regla general, toda la informaci√≥n necesaria se encuentra en las configuraciones <br><ul><li>  desterrar los m√©todos que afectan su trabajo </li><li>  verificar el registro de solicitudes externas </li></ul></li><li>  comprobar el funcionamiento de la configuraci√≥n de los par√°metros de configuraci√≥n de la aplicaci√≥n;  intenta cambiarlos por calor </li><li>  compruebe el almacenamiento en cach√© http para c√≥digos de estado positivo y negativo <br><ul><li>  Encabezado ETag </li><li>  encabezado de control de cach√© </li></ul></li><li>  comprobar solicitudes largas y tiempos de espera </li><li>  verificar solicitudes con una respuesta vac√≠a </li><li>  verifique los m√©todos DELETE (WebDAV est√° deshabilitado o no) </li><li>  verificar el trabajo con contenido sin procesar <br><ul><li>  cargar y descargar uno / varios archivos </li><li>  subir archivos con un tama√±o superior al l√≠mite </li><li>  dise√±o de encabezado Content-Disposition </li></ul></li><li>  verifique todos los otros encabezados;  ponerlos todos juntos en c√≥digo es bastante f√°cil </li><li> comprobar la ejecuci√≥n de c√≥digo condicional al cambiar de entorno <code>if (env.IsDevelopment())</code> </li><li>  comprobar desconexi√≥n del cliente y el servidor </li><li>  comparar con el est√°ndar swagger.json: ayudar√° a detectar la diferencia en los campos transmitidos <br><blockquote>  Nuestra aplicaci√≥n m√≥vil utiliza un generador de c√≥digo para trabajar con la API basada en la descripci√≥n de swagger.json, por lo que era importante que la diferencia con la descripci√≥n original fuera m√≠nima.  En la √∫ltima versi√≥n de Swashbuckle.AspNetCore, la interfaz y el swagger.json generado han cambiado mucho.  Tuve que volver a la versi√≥n lamentable de Swashbuckle.AspNetCore 1.2.0 y agregar un par de filtros. <br></blockquote></li></ul><br><h4 id="5-zadeploit-na-boy-popivaya-kofeek">  5. Prep√°rate para una pelea mientras tomas caf√© </h4><br><p>  En nuestro caso, el entorno de combate consta de dos nodos: activo y pasivo. <br>  Para que el cambio al nuevo servicio pase desapercibido, duplicamos el grupo y el sitio en cada nodo, y escribimos un script para cambiar el enlace entre el sitio antiguo y el nuevo. </p><br><p>  Por lo tanto, en caso de emergencia, pudimos cambiar r√°pidamente a la versi√≥n anterior. </p><br><p>  Adem√°s, despu√©s del despliegue en la batalla, en una semana nos convencimos de la viabilidad del servicio y encendimos una luz verde para el lanzamiento de la aplicaci√≥n m√≥vil.  La vida en el proyecto regres√≥ de manera segura a su curso anterior. </p><br><h3 id="promezhutochnyy-itog">  Subtotal </h3><br><p>  Ahora nuestro servicio est√° completamente listo para hacer crecer un contenedor acoplable para su entrega al cl√∫ster.  Estamos listos para la implementaci√≥n tanto en Kubernetes como en Service Fabric. </p><br><p>  Ahora se est√°n realizando preparativos para la presentaci√≥n de la nueva infraestructura al cliente.  Le informaremos sobre nuestros logros en la pr√≥xima serie, mantenga su dedo en el pulso;) </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es422441/">https://habr.com/ru/post/es422441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es422431/index.html">Hadas japonesas muestran gatillo maestro-esclavo en nuevo manga en electr√≥nica digital</a></li>
<li><a href="../es422433/index.html">Paneles solares y carreteras de asfalto. Simbiosis de tecnolog√≠a</a></li>
<li><a href="../es422435/index.html">Temporizador - Inicio</a></li>
<li><a href="../es422437/index.html">Juegos de experiencia del usuario y velocidad del sitio web y de la aplicaci√≥n</a></li>
<li><a href="../es422439/index.html">La pelea con Yandex: c√≥mo pas√© m√°s de un a√±o para llevar el sitio a la cima</a></li>
<li><a href="../es422443/index.html">Temporizador preciso Corona SDK</a></li>
<li><a href="../es422445/index.html">Implementaci√≥n de BottomAppBar. Parte 3: Comportamiento para Android</a></li>
<li><a href="../es422447/index.html">bytes.Buffer en Go: optimizaciones que no funcionan</a></li>
<li><a href="../es422449/index.html">Senadores versus Amazon: lo que ha hecho una tienda en l√≠nea</a></li>
<li><a href="../es422451/index.html">Para escuchar sobre el marketing de juegos y sobre el lugar de un guionista en la industria del juego el 26 de septiembre en VShBI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>