<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>#‚É£ üò± üõ•Ô∏è Escribir una serpiente para Android en Kivy, Python üî∂ üöö üñäÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola 

 A muchas personas les gustar√≠a comenzar a programar en Android, pero Android Studio y Java los ahuyentan. Por qu√© Porque en cierto sentido es ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Escribir una serpiente para Android en Kivy, Python</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466249/">  Hola <br><br>  A muchas personas les gustar√≠a comenzar a programar en Android, pero Android Studio y Java los ahuyentan.  Por qu√©  Porque en cierto sentido es de un ca√±√≥n en gorriones.  "Solo quiero hacer una serpiente, ¬°eso es todo!" <br><br><img src="https://habrastorage.org/webt/gb/yu/vz/gbyuvzpeftcwxbxi9gwa2xz5axe.png"><br><br>  ¬°Empecemos!  (bonificaci√≥n al final) <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">¬øPor qu√© crear otro tutorial de serpiente en Kivy?</b>  <b class="spoiler_title">(opcional para leer)</b> <div class="spoiler_text">  Si eres un pitonista y quieres comenzar a desarrollar juegos simples para Android, ya deber√≠as buscar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en</a> Google "serpiente en Android" y encontrarlo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">(Eng)</a> o su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">traducci√≥n (Rus)</a> .  Y yo tambi√©n lo hice.  Desafortunadamente, el art√≠culo me pareci√≥ in√∫til por varias razones: <br><br><h5>  C√≥digo malo </h5><br>  Defectos menores: <br><br><ol><li>  El uso de la "cola" y la "cabeza" por separado.  Esto no es necesario, ya que en la serpiente la cabeza es la primera parte de la cola.  No debe dividir la serpiente completa en dos partes, para las cuales el c√≥digo se escribe por separado. </li><li>  Clock.schedule from self.update se llama desde ... self.update. </li><li>  La clase de segundo nivel (condicionalmente el punto de entrada de la primera clase) Playground se declara al principio, pero la clase de primer nivel SnakeApp se declara al final del archivo. </li><li>  Nombres para direcciones ("arriba", "abajo", ...) en lugar de vectores ((0, 1), (1, 0) ...). </li></ol><br><br>  Graves desventajas: <br><ol><li>  Los objetos din√°micos (como la fruta) se adjuntan al archivo kv, por lo que no puede crear m√°s de una manzana sin reescribir la mitad del c√≥digo </li><li>  La maravillosa l√≥gica de mover una serpiente en lugar de celda por celda. </li><li>  350 l√≠neas: el c√≥digo es demasiado largo. </li></ol><br><h5>  El art√≠culo no es obvio para los principiantes. </h5><br>  Esta es mi opini√≥n personal.  Adem√°s, no puedo garantizar que mi art√≠culo sea m√°s interesante y comprensible.  Pero lo intentar√© y garantizo: <br><br><ol><li>  El c√≥digo ser√° corto </li><li>  Hermosa serpiente (relativamente) </li><li>  El tutorial tendr√° un desarrollo por fases. </li></ol><br><h5>  El resultado no es comme il faut </h5><br><img src="https://habrastorage.org/webt/n6/q-/li/n6q-lieen74-rcs-tzwrr1yguwa.png"><br>  No hay distancia entre las celdas, un tri√°ngulo maravilloso, una serpiente sacudida. <br></div></div><br><h1>  Conocido </h1><br><h3>  Primera aplicaci√≥n </h3><br>  Aseg√∫rese de instalar Kivy ya (si no, siga las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones</a> ) y ejecute <br>  <code>buildozer init</code> en la carpeta del proyecto. <br><br>  Ejecute el primer programa: <br><br>  main.py <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Widget() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br><img src="https://habrastorage.org/webt/ms/he/ud/msheudwu1tc3wcvjj8z2x9oswgi.png"><br><br>  Hemos creado un widget.  Del mismo modo, podemos crear un bot√≥n o cualquier otro elemento de la interfaz gr√°fica: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.button <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Button <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.but = Button() self.but.pos = (<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) self.but.size = (<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>) self.but.text = <span class="hljs-string"><span class="hljs-string">"Hello, cruel world"</span></span> self.form = Widget() self.form.add_widget(self.but) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br><img src="https://habrastorage.org/webt/gp/k1/cn/gpk1cngh7ns5z9wdtjuua5d1ogg.png"><br><br>  ¬°Hurra!  Felicidades  ¬°Has creado un bot√≥n! <br><br><h3>  Archivos .Kv </h3><br>  Sin embargo, hay otra forma de crear tales elementos.  Primero, declara nuestro formulario: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.button <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Button <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.but1 = Button() self.but1.pos = (<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) self.add_widget(self.but1) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form = Form() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br>  Luego cree el archivo "worm.kv". <br><br>  worm.kv <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: but2: but_id Button: id: but_id pos: (200, 200)</code> </pre><br>  Que paso  Creamos otro bot√≥n y asignamos id but_id.  Ahora but_id est√° asociado con las formas but2.  Esto significa que podemos acceder al bot√≥n usando but2: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.but1 = Button() self.but1.pos = (<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) self.add_widget(self.but1) <span class="hljs-comment"><span class="hljs-comment"># self.but2.text = "OH MY"</span></span></code> </pre><br><img src="https://habrastorage.org/webt/ug/a6/88/uga688dhltpl2klklqbigyodu40.png"><br><br><h3>  Gr√°ficos </h3><br>  Luego, crea un elemento gr√°fico.  Primero, declare en worm.kv: <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: &lt;Cell&gt;: canvas: Rectangle: size: self.size pos: self.pos</code> </pre><br>  Vinculamos la posici√≥n del rect√°ngulo con self.pos y su tama√±o con self.size.  Entonces, estas propiedades est√°n disponibles en Cell, por ejemplo, tan pronto como creamos una celda, podemos cambiar su tama√±o y posici√≥n: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.size = (size, size) <span class="hljs-comment"><span class="hljs-comment">#   ,    self.size    "size"  self.pos = (x, y) class Form(Widget): def __init__(self): super().__init__() self.cell = Cell(100, 100, 30) self.add_widget(self.cell)</span></span></code> </pre><br><img src="https://habrastorage.org/webt/we/j4/dn/wej4dnu0jojperjlmnlflu5dxi8.png"><br><br>  Bien, creamos una jaula. <br><br><h3>  M√©todos necesarios </h3><br>  Intentemos mover la serpiente.  Para hacer esto, podemos agregar la funci√≥n Form.update y vincular a la programaci√≥n usando Clock.schedule. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.size = (size, size) self.pos = (x, y) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cell = Cell(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.add_widget(self.cell) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> Clock.schedule_interval(self.update, <span class="hljs-number"><span class="hljs-number">0.01</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> self.cell.pos = (self.cell.pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-number"><span class="hljs-number">2</span></span>, self.cell.pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form = Form() self.form.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br>  La celda se mover√° en forma.  Como puede ver, podemos configurar un temporizador para cualquier funci√≥n usando Clock. <br><br>  A continuaci√≥n, cree un evento t√°ctil.  Reescribir formulario: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cells = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> Clock.schedule_interval(self.update, <span class="hljs-number"><span class="hljs-number">0.01</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.cells: cell.pos = (cell.pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-number"><span class="hljs-number">2</span></span>, cell.pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> cell = Cell(touch.x, touch.y, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.add_widget(cell) self.cells.append(cell)</code> </pre><br>  Cada touch_down crea una celda con coordenadas = (touch.x, touch.y) y tama√±o = 30. Luego, la agregaremos como un widget de formulario AND a nuestra propia matriz (para acceder a ella m√°s adelante). <br><br>  Ahora cada clic en el formulario genera una celda. <br><br><img src="https://habrastorage.org/webt/sf/rt/of/sfrtofg5ylwk8pxm3mowelxw1by.png"><br><br><h3>  Buena configuraci√≥n </h3><br>  Como queremos hacer una hermosa serpiente, debemos separar l√≥gicamente las posiciones gr√°ficas y reales. <br><br><div class="spoiler">  <b class="spoiler_title">Por qu√©</b> <div class="spoiler_text">  Hay muchas razones para hacer esto.  Toda l√≥gica debe estar conectada con la llamada posici√≥n real, pero la gr√°fica es el resultado de la real.  Por ejemplo, si queremos sangrar, la posici√≥n actual ser√° (100, 100) mientras que la posici√≥n gr√°fica es (102, 102). <br><br>  PD: No nos tomar√≠amos un ba√±o de vapor si estuvi√©ramos lidiando con on_draw.  Pero ahora no tenemos que volver a dibujar la forma con las patas. <br></div></div><br>  Cambiemos el archivo worm.kv: <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: &lt;Cell&gt;: canvas: Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br>  y main.py: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">... </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> graphical_size = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) graphical_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size, margin=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.actual_size = (size, size) self.graphical_size = (size - margin, size - margin) self.margin = margin self.actual_pos = (x, y) self.graphical_pos_attach() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.graphical_pos = (self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cell1 = Cell(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.cell2 = Cell(<span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.add_widget(self.cell1) self.add_widget(self.cell2) ...</code> </pre><br><img src="https://habrastorage.org/webt/sa/0m/yi/sa0myibds8nzaymucynrard6ixk.png"><br><br>  Ha aparecido una sangr√≠a, por lo que se ve mejor a pesar del hecho de que creamos una segunda celda con X = 130 en lugar de 132. M√°s adelante haremos un movimiento suave basado en la distancia entre actual_pos y graphical_pos. <br><br><h1>  Programaci√≥n de gusanos </h1><br><h3>  Anuncio </h3><br>  Inicializar configuraci√≥n en main.py <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">:</span></span> DEFAULT_LENGTH = <span class="hljs-number"><span class="hljs-number">20</span></span> CELL_SIZE = <span class="hljs-number"><span class="hljs-number">25</span></span> APPLE_SIZE = <span class="hljs-number"><span class="hljs-number">35</span></span> MARGIN = <span class="hljs-number"><span class="hljs-number">4</span></span> INTERVAL = <span class="hljs-number"><span class="hljs-number">0.2</span></span> DEAD_CELL = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) APPLE_COLOR = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre><br>  (¬°Cr√©eme, te encantar√°!) <br><br>  Luego asigne config a la aplicaci√≥n: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = Config() self.form = Form(self.config) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form</code> </pre><br>  Reescribe init y comienza: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) Clock.schedule_interval(self.update, self.config.INTERVAL)</code> </pre><br>  Entonces, celular: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> graphical_size = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) graphical_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size, margin=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.actual_size = (size, size) self.graphical_size = (size - margin, size - margin) self.margin = margin self.actual_pos = (x, y) self.graphical_pos_attach() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.graphical_pos = (self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) self.graphical_pos_attach() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y, **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.actual_pos <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_by(self.actual_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.actual_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">1</span></span>], **kwargs)</code> </pre><br>  Espero que esto haya sido m√°s o menos claro. <br><br>  Y finalmente Gusano: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cells = [] self.config = config self.cell_size = config.CELL_SIZE self.head_init((<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(config.DEFAULT_LENGTH): self.lengthen() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells)): self.remove_widget(self.cells[i]) self.cells = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lengthen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos=None, direction=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#   ,    ,  -      if pos is None: px = self.cells[-1].get_pos()[0] + direction[0] * self.cell_size py = self.cells[-1].get_pos()[1] + direction[1] * self.cell_size pos = (px, py) self.cells.append(Cell(*pos, self.cell_size, margin=self.config.MARGIN)) self.add_widget(self.cells[-1]) def head_init(self, pos): self.lengthen(pos=pos)</span></span></code> </pre><br>  Creemos nuestro gusano. <br><br><img src="https://habrastorage.org/webt/x8/89/ve/x889vemqslo2x8rxvp54jgbwgpi.png"><br><br><h3>  Movimiento </h3><br>  Ahora lo movemos. <br><br>  Es simple: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): self.cells[i].move_to(*self.cells[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].get_pos()) self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].step_by(direction)</code> </pre><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) self.cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> self.worm.move(self.cur_dir)</code> </pre><br><img src="https://habrastorage.org/webt/jx/8v/jw/jx8vjwv5zpnnhfprs7peo1o_gfm.png"><br><br>  Esta vivo!  Esta vivo! <br><br><h3>  Gesti√≥n </h3><br>  Como puedes juzgar desde la primera imagen, el control de la serpiente ser√° as√≠: <br><br><img src="https://habrastorage.org/webt/va/u0/ad/vau0adepnd4fsjgcjxe0lp6jkqk.png"><br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> ws = touch.x / self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] hs = touch.y / self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] aws = <span class="hljs-number"><span class="hljs-number">1</span></span> - ws <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ws &gt; hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &gt; hs: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  elif ws &gt; hs &gt;= aws: cur_dir = (1, 0) #  elif ws &lt;= hs &lt; aws: cur_dir = (-1, 0) #  else: cur_dir = (0, 1) #  self.cur_dir = cur_dir</span></span></code> </pre><br><img src="https://habrastorage.org/webt/ff/8k/c2/ff8kc2ur1rct6cjmkt-ozc9xch4.png"><br><br>  Wow <br><br><h3>  Hacer fruta </h3><br>  Primero declara. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_cell_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row = self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] // self.config.CELL_SIZE x_col = self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] // self.config.CELL_SIZE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row, x_col = self.random_cell_location(offset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y) ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.fruit = Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, self.config.APPLE_SIZE, self.config.MARGIN) self.worm = Worm(self.config) self.fruit_dislocate() self.add_widget(self.worm) self.add_widget(self.fruit) self.cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL)</code> </pre><br>  Resultado actual: <br><br><img src="https://habrastorage.org/webt/bb/t0/wh/bbt0whhowgmfdhnyjawtmnbv0ny.png"><br><br>  Ahora tenemos que declarar varios m√©todos de gusanos: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-comment"><span class="hljs-comment">#      def gather_positions(self): return [cell.get_pos() for cell in self.cells] #        def head_intersect(self, cell): return self.cells[0].get_pos() == cell.get_pos()</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Otros bonos de la funci√≥n collect_positions</b> <div class="spoiler_text">  Por cierto, despu√©s de declarar recolectar_posiciones, podemos mejorar fruit_dislocate: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x, y) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.gather_positions(): x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y)</code> </pre><br>  En este punto, la posici√≥n de la manzana no puede coincidir con la posici√≥n de la cola. <br></div></div><br>  ... y agregue la marca de verificaci√≥n para actualizar () <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> self.worm.move(self.cur_dir) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate()</code> </pre><br><h3>  Determinaci√≥n de la intersecci√≥n de la cabeza y la cola. </h3><br>  Queremos averiguar si la posici√≥n de la cabeza es la misma que en una celda de cola. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.worm.move(self.cur_dir) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm_bite_self(): self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worm_bite_self</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.cells[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(cell): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre><br><img src="https://habrastorage.org/webt/fu/yt/m4/fuytm4is8yrdbrlym0c5yj8bta8.png"><br><br><h3>  Colorear, decorar, refactorizar c√≥digos </h3><br>  Comencemos con la refactorizaci√≥n. <br><br>  Reescribe y agrega <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.fruit <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.remove_widget(self.fruit) self.fruit = Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, self.config.APPLE_SIZE) self.fruit_dislocate() self.add_widget(self.fruit) Clock.schedule_interval(self.update, self.config.INTERVAL) self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop() ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: self.worm.destroy() self.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ...</code> </pre><br>  Ahora, si el gusano est√° muerto (congelado), si hace clic en la pantalla, el juego se reiniciar√°. <br><br>  Ahora pasemos a decorar y colorear. <br><br>  worm.kv <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: popup_label: popup_label score_label: score_label canvas: Color: rgba: (.5, .5, .5, 1.0) Line: width: 1.5 points: (0, 0), self.size Line: width: 1.5 points: (self.size[0], 0), (0, self.size[1]) Label: id: score_label text: "Score: " + str(self.parent.worm_len) width: self.width Label: id: popup_label width: self.width &lt;Worm&gt;: &lt;Cell&gt;: canvas: Color: rgba: self.color Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br>  Reescribimos WormApp: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.config = Config() self.form = Form(self.config) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form.start()</code> </pre><br><img src="https://habrastorage.org/webt/fk/cq/6v/fkcq6vobxfathjjvs3pg3aak7oo.png"><br><br>  Colorear  Reescribir Celda en .kv: <br><br><pre> <code class="plaintext hljs">&lt;Cell&gt;: canvas: Color: rgba: self.color Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br><br>  Agregue esto a la celda .__ init__: <br><pre> <code class="python hljs">self.color = (<span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) <span class="hljs-comment"><span class="hljs-comment">#</span></span></code> </pre><br>  y esto es para Form.start <br><br><pre> <code class="python hljs">self.fruit.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>)</code> </pre><br>  Excelente, disfruta de la serpiente <br><br><img src="https://habrastorage.org/webt/1e/nh/6f/1enh6fainu28aqcei-9fg0of8iq.png"><br><br>  Finalmente, crearemos la inscripci√≥n "juego terminado" <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> ... self.popup_label.text = <span class="hljs-string"><span class="hljs-string">""</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.popup_label.text = text Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop(<span class="hljs-string"><span class="hljs-string">"GAME OVER"</span></span> + <span class="hljs-string"><span class="hljs-string">" "</span></span> * <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-string"><span class="hljs-string">"\ntap to reset"</span></span>)</code> </pre><br>  Y configure la celda "herida" en rojo: <br><br>  en lugar de <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm_bite_self(): self.game_over() ...</code> </pre><br><br>  escribir <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cell = self.worm_bite_self() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell: cell.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) self.game_over()</code> </pre><br><img src="https://habrastorage.org/webt/lw/mr/na/lwmrnagdbvjt79qacs0kt9jg_2k.png"><br><br>  ¬øSigues aqu√≠?  ¬°La parte m√°s interesante est√° por delante! <br><br><h3>  Bonus - movimiento suave </h3><br>  Dado que el paso de gusano es igual a cell_size, no se ve muy suave.  Pero nos gustar√≠a avanzar lo m√°s a menudo posible sin tener que reescribir completamente la l√≥gica del juego.  Por lo tanto, necesitamos un mecanismo que mueva nuestras posiciones gr√°ficas (graphical_pos) pero que no afecte a las reales (actual_pos).  Escrib√≠ el siguiente c√≥digo: <br><br>  smooth.py <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timing</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">linear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Smooth</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, interval=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">/</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">60.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.objs = [] self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.interval = interval <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> Clock.schedule_interval(self.update, self.interval) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr, value)</span></span></span><span class="hljs-function">:</span></span> exec(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr + <span class="hljs-string"><span class="hljs-string">" = "</span></span> + str(value)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(eval(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cur_time = time.time() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.objs: obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line time_gone = cur_time - start_time <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> time_gone &gt;= period: self.setattr(obj, prop_name_x, to_x) self.setattr(obj, prop_name_y, to_y) self.objs.remove(line) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: share = time_gone / period acs = timing(share) self.setattr(obj, prop_name_x, from_x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_x * acs) self.setattr(obj, prop_name_y, from_y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_y * acs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.objs) == <span class="hljs-number"><span class="hljs-number">0</span></span>: self.stop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear)</span></span></span><span class="hljs-function">:</span></span> self.objs.append((obj, prop_name_x, prop_name_y, self.getattr(obj, prop_name_x), self.getattr(obj, prop_name_y), to_x, to_y, time.time(), t, timing)) self.run() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSmooth</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Smooth)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, props, timing=Timing.linear, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(*args, **kwargs) self.props = props self.timing = timing <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, to_x, to_y, t)</span></span></span><span class="hljs-function">:</span></span> super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Los que no les gust√≥ este c√≥digo</b> <div class="spoiler_text">  Este m√≥dulo no es lo mejor de la elegancia.  Reconozco esta decisi√≥n como mala.  Pero esta es solo una soluci√≥n de hello-world. <br></div></div><br>  Por lo tanto, simplemente cree smooth.py y copie el c√≥digo en un archivo. <br>  Finalmente, ¬°haga que funcione! <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> ... self.smooth = smooth.XSmooth([<span class="hljs-string"><span class="hljs-string">"graphical_pos[0]"</span></span>, <span class="hljs-string"><span class="hljs-string">"graphical_pos[1]"</span></span>])</code> </pre><br>  Reemplace self.worm.move () con <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> ... self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL))</code> </pre><br>  Y as√≠ es como deber√≠an verse los m√©todos de Cell <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, smooth_motion=None)</span></span></span><span class="hljs-function">:</span></span> to_x, to_y = self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smooth_motion <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.graphical_pos = to_x, to_y <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: smoother, t = smooth_motion smoother.move_to(self, to_x, to_y, t) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) self.graphical_pos_attach(**kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y, **kwargs)</code> </pre><br>  Bueno, eso es todo, ¬°gracias por su atenci√≥n!  El c√≥digo est√° abajo. <br><br>  Video de demostraci√≥n sobre c√≥mo funciona el resultado: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/0clOAucqRDE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><div class="spoiler">  <b class="spoiler_title">C√≥digo final</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">main.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> smooth <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> graphical_size = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) graphical_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) color = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size, margin=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.actual_size = (size, size) self.graphical_size = (size - margin, size - margin) self.margin = margin self.actual_pos = (x, y) self.graphical_pos_attach() self.color = (<span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, smooth_motion=None)</span></span></span><span class="hljs-function">:</span></span> to_x, to_y = self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smooth_motion <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.graphical_pos = to_x, to_y <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: smoother, t = smooth_motion smoother.move_to(self, to_x, to_y, t) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) self.graphical_pos_attach(**kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y, **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.actual_pos <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_by(self.actual_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.actual_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">1</span></span>], **kwargs) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cells = [] self.config = config self.cell_size = config.CELL_SIZE self.head_init((<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(config.DEFAULT_LENGTH): self.lengthen() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells)): self.remove_widget(self.cells[i]) self.cells = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lengthen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos=None, direction=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pos <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: px = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">0</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">0</span></span>] * self.cell_size py = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">1</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">1</span></span>] * self.cell_size pos = (px, py) self.cells.append(Cell(*pos, self.cell_size, margin=self.config.MARGIN)) self.add_widget(self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> self.lengthen(pos=pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): self.cells[i].move_to(*self.cells[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].get_pos(), **kwargs) self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].step_by(direction, **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gather_positions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [cell.get_pos() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.cells] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_intersect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, cell)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos() == cell.get_pos() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> worm_len = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.smooth = smooth.XSmooth([<span class="hljs-string"><span class="hljs-string">"graphical_pos[0]"</span></span>, <span class="hljs-string"><span class="hljs-string">"graphical_pos[1]"</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_cell_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row = self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] // self.config.CELL_SIZE x_col = self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] // self.config.CELL_SIZE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row, x_col = self.random_cell_location(offset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x, y) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.gather_positions(): x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.fruit <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.remove_widget(self.fruit) self.fruit = Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, self.config.APPLE_SIZE) self.fruit.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) self.fruit_dislocate() self.add_widget(self.fruit) self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL) self.popup_label.text = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.popup_label.text = text Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop(<span class="hljs-string"><span class="hljs-string">"GAME OVER"</span></span> + <span class="hljs-string"><span class="hljs-string">" "</span></span> * <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-string"><span class="hljs-string">"\ntap to reset"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align_labels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: self.popup_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.popup_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) self.score_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.score_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] - <span class="hljs-number"><span class="hljs-number">80</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(self.__dict__) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate() cell = self.worm_bite_self() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell: cell.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) self.game_over() self.worm_len = len(self.worm.cells) self.align_labels() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: self.worm.destroy() self.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ws = touch.x / self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] hs = touch.y / self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] aws = <span class="hljs-number"><span class="hljs-number">1</span></span> - ws <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ws &gt; hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &gt; hs: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &gt; hs &gt;= aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &lt;= hs &lt; aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) self.cur_dir = cur_dir <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worm_bite_self</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.cells[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(cell): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">:</span></span> DEFAULT_LENGTH = <span class="hljs-number"><span class="hljs-number">20</span></span> CELL_SIZE = <span class="hljs-number"><span class="hljs-number">25</span></span> APPLE_SIZE = <span class="hljs-number"><span class="hljs-number">35</span></span> MARGIN = <span class="hljs-number"><span class="hljs-number">4</span></span> INTERVAL = <span class="hljs-number"><span class="hljs-number">0.3</span></span> DEAD_CELL = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) APPLE_COLOR = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.config = Config() self.form = Form(self.config) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form.start() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">smooth.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timing</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">linear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Smooth</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, interval=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">/</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">60.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.objs = [] self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.interval = interval <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> Clock.schedule_interval(self.update, self.interval) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr, value)</span></span></span><span class="hljs-function">:</span></span> exec(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr + <span class="hljs-string"><span class="hljs-string">" = "</span></span> + str(value)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(eval(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cur_time = time.time() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.objs: obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line time_gone = cur_time - start_time <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> time_gone &gt;= period: self.setattr(obj, prop_name_x, to_x) self.setattr(obj, prop_name_y, to_y) self.objs.remove(line) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: share = time_gone / period acs = timing(share) self.setattr(obj, prop_name_x, from_x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_x * acs) self.setattr(obj, prop_name_y, from_y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_y * acs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.objs) == <span class="hljs-number"><span class="hljs-number">0</span></span>: self.stop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear)</span></span></span><span class="hljs-function">:</span></span> self.objs.append((obj, prop_name_x, prop_name_y, self.getattr(obj, prop_name_x), self.getattr(obj, prop_name_y), to_x, to_y, time.time(), t, timing)) self.run() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSmooth</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Smooth)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, props, timing=Timing.linear, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(*args, **kwargs) self.props = props self.timing = timing <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, to_x, to_y, t)</span></span></span><span class="hljs-function">:</span></span> super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">worm.kv</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;Form&gt;: popup_label: popup_label score_label: score_label canvas: Color: rgba: (.5, .5, .5, 1.0) Line: width: 1.5 points: (0, 0), self.size Line: width: 1.5 points: (self.size[0], 0), (0, self.size[1]) Label: id: score_label text: "Score: " + str(self.parent.worm_len) width: self.width Label: id: popup_label width: self.width &lt;Worm&gt;: &lt;Cell&gt;: canvas: Color: rgba: self.color Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br></div></div><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo ligeramente modificado por @tshirtman</b> <div class="spoiler_text">  Tshirtman, uno de los contribuyentes de Kivy, verific√≥ mi c√≥digo y me sugiri√≥ que usara la instrucci√≥n Point en lugar de crear un widget para cada celda.  Sin embargo, este c√≥digo no me parece m√°s f√°cil de entender que el m√≠o, aunque definitivamente es mejor para comprender el desarrollo de UI y gamedev.  En general, aqu√≠ est√° el c√≥digo: <br><div class="spoiler">  <b class="spoiler_title">main.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> smooth <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.actual_pos <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fruit</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Cell)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> super().__init__(x, y) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> margin = NumericProperty(<span class="hljs-number"><span class="hljs-number">4</span></span>) graphical_poses = ListProperty() inj_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">-1000</span></span>, <span class="hljs-number"><span class="hljs-number">-1000</span></span>]) graphical_size = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(**kwargs) self.cells = [] self.config = config self.cell_size = config.CELL_SIZE self.head_init((self.config.CELL_SIZE * random.randint(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), self.config.CELL_SIZE * random.randint(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>))) self.margin = config.MARGIN self.graphical_size = self.cell_size - self.margin <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(config.DEFAULT_LENGTH): self.lengthen() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.cells = [] self.graphical_poses = [] self.inj_pos = [<span class="hljs-number"><span class="hljs-number">-1000</span></span>, <span class="hljs-number"><span class="hljs-number">-1000</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cell_append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> self.cells.append(Cell(*pos)) self.graphical_poses.extend([<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]) self.cell_move_to(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lengthen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos=None, direction=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pos <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: px = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">0</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">0</span></span>] * self.cell_size py = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">1</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">1</span></span>] * self.cell_size pos = (px, py) self.cell_append(pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> self.lengthen(pos=pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cell_move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, i, pos, smooth_motion=None)</span></span></span><span class="hljs-function">:</span></span> self.cells[i].move_to(*pos) to_x, to_y = pos[<span class="hljs-number"><span class="hljs-number">0</span></span>], pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smooth_motion <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.graphical_poses[i * <span class="hljs-number"><span class="hljs-number">2</span></span>], self.graphical_poses[i * <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>] = to_x, to_y <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: smoother, t = smooth_motion smoother.move_to(self, <span class="hljs-string"><span class="hljs-string">"graphical_poses["</span></span> + str(i * <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-string"><span class="hljs-string">"]"</span></span>, <span class="hljs-string"><span class="hljs-string">"graphical_poses["</span></span> + str(i * <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-string"><span class="hljs-string">"]"</span></span>, to_x, to_y, t) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): self.cell_move_to(i, self.cells[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].get_pos(), **kwargs) self.cell_move_to(<span class="hljs-number"><span class="hljs-number">0</span></span>, (self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">0</span></span>] + self.cell_size * direction[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">1</span></span>] + self.cell_size * direction[<span class="hljs-number"><span class="hljs-number">1</span></span>]), **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gather_positions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [cell.get_pos() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.cells] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_intersect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, cell)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos() == cell.get_pos() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> worm_len = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) fruit_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]) fruit_size = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(**kwargs) self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.smooth = smooth.Smooth() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_cell_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row = self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] // self.config.CELL_SIZE x_col = self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] // self.config.CELL_SIZE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row, x_col = self.random_cell_location(offset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, xy=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> xy <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: x, y = xy <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x, y) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.gather_positions(): x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y) self.fruit_pos = (x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) self.fruit = Fruit(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit_size = self.config.APPLE_SIZE self.fruit_dislocate() self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL) self.popup_label.text = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.popup_label.text = text Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop(<span class="hljs-string"><span class="hljs-string">"GAME OVER"</span></span> + <span class="hljs-string"><span class="hljs-string">" "</span></span> * <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-string"><span class="hljs-string">"\ntap to reset"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align_labels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.popup_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.popup_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) self.score_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.score_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] - <span class="hljs-number"><span class="hljs-number">80</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate() cell = self.worm_bite_self() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.worm.inj_pos = cell.get_pos() self.game_over() self.worm_len = len(self.worm.cells) self.align_labels() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: self.worm.destroy() self.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ws = touch.x / self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] hs = touch.y / self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] aws = <span class="hljs-number"><span class="hljs-number">1</span></span> - ws <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ws &gt; hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &gt; hs: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &gt; hs &gt;= aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &lt;= hs &lt; aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) self.cur_dir = cur_dir <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worm_bite_self</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.cells[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(cell): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">:</span></span> DEFAULT_LENGTH = <span class="hljs-number"><span class="hljs-number">20</span></span> CELL_SIZE = <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-comment"><span class="hljs-comment">#  ,  CELL_SIZE - MARGIN    4 APPLE_SIZE = 36 MARGIN = 2 INTERVAL = 0.3 DEAD_CELL = (1, 0, 0, 1) APPLE_COLOR = (1, 1, 0, 1) class WormApp(App): def __init__(self, **kwargs): super().__init__(**kwargs) self.form = None def build(self, **kwargs): self.config = Config() self.form = Form(self.config, **kwargs) return self.form def on_start(self): self.form.start() if __name__ == '__main__': WormApp().run()</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">smooth.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timing</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">linear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Smooth</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, interval=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">/</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">60.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.objs = [] self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.interval = interval <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> Clock.schedule_interval(self.update, self.interval) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr, value)</span></span></span><span class="hljs-function">:</span></span> exec(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr + <span class="hljs-string"><span class="hljs-string">" = "</span></span> + str(value)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(eval(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cur_time = time.time() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.objs: obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line time_gone = cur_time - start_time <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> time_gone &gt;= period: self.set_attr(obj, prop_name_x, to_x) self.set_attr(obj, prop_name_y, to_y) self.objs.remove(line) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: share = time_gone / period acs = timing(share) self.set_attr(obj, prop_name_x, from_x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_x * acs) self.set_attr(obj, prop_name_y, from_y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_y * acs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.objs) == <span class="hljs-number"><span class="hljs-number">0</span></span>: self.stop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear)</span></span></span><span class="hljs-function">:</span></span> self.objs.append((obj, prop_name_x, prop_name_y, self.get_attr(obj, prop_name_x), self.get_attr(obj, prop_name_y), to_x, to_y, time.time(), t, timing)) self.run() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSmooth</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Smooth)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, props, timing=Timing.linear, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(*args, **kwargs) self.props = props self.timing = timing <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, to_x, to_y, t)</span></span></span><span class="hljs-function">:</span></span> super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worm.kv</font></font></b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;Form&gt;: popup_label: popup_label score_label: score_label canvas: Color: rgba: (.5, .5, .5, 1.0) Line: width: 1.5 points: (0, 0), self.size Line: width: 1.5 points: (self.size[0], 0), (0, self.size[1]) Color: rgba: (1.0, 0.2, 0.2, 1.0) Point: points: self.fruit_pos pointsize: self.fruit_size / 2 Label: id: score_label text: "Score: " + str(self.parent.worm_len) width: self.width Label: id: popup_label width: self.width &lt;Worm&gt;: canvas: Color: rgba: (0.2, 1.0, 0.2, 1.0) Point: points: self.graphical_poses pointsize: self.graphical_size / 2 Color: rgba: (1.0, 0.2, 0.2, 1.0) Point: points: self.inj_pos pointsize: self.graphical_size / 2</code> </pre><br></div></div></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Haz cualquier pregunta </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/466249/">https://habr.com/ru/post/466249/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../466229/index.html">C√≥mo comprar diez cajas de algod√≥n y no equivocarse</a></li>
<li><a href="../466231/index.html">ShIoTiny y el mundo circundante: conectar sensores a entradas binarias, rebote de contactos y otros problemas</a></li>
<li><a href="../466235/index.html">Munch en una exploraci√≥n equidistante y Meyerhold, que destruy√≥ la Plaza Roja - Denis Semenov sobre arte VR</a></li>
<li><a href="../466237/index.html">C√≥mo el joven verde escribi√≥ su recarga caliente</a></li>
<li><a href="../466247/index.html">Entrevista introvertida</a></li>
<li><a href="../466251/index.html">Impulsando el proyecto de Soft Launch a $ 1 mill√≥n en ingresos por mes</a></li>
<li><a href="../466253/index.html">C√≥mo reconstru√≠ los sitios de aterrizaje de ALS Luna-9 y Luna-13</a></li>
<li><a href="../466257/index.html">Conquistando los mares: almacenes de datos flotantes</a></li>
<li><a href="../466263/index.html">Sistemas RPC de referencia (y Json invertido)</a></li>
<li><a href="../466267/index.html">¬øPor qu√© muchos subestiman sus juegos?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>