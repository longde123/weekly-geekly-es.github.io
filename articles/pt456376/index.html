<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñêÔ∏è üò± üéñÔ∏è N√£o √© uma bota primavera: uma vis√£o geral das alternativas ‚úãüèæ üë© üëÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Atualmente, n√£o h√° escassez de estruturas para a cria√ß√£o de microsservi√ßos em Java e Kotlin. O artigo discute o seguinte: 
 T√≠tulo  Vers√£o  Ano do pri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>N√£o √© uma bota primavera: uma vis√£o geral das alternativas</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/456376/"><img src="https://habrastorage.org/webt/al/mw/1g/almw1ghoqrvuf2nbw_awcwqvqe4.png"><br><br>  Atualmente, n√£o h√° escassez de estruturas para a cria√ß√£o de microsservi√ßos em Java e Kotlin.  O artigo discute o seguinte: <br><div class="scrollable-table"><table><tbody><tr><th>  T√≠tulo </th><th>  Vers√£o </th><th>  Ano do primeiro lan√ßamento </th><th>  Desenvolvedor </th></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Helidon se</a> </td><td>  1.1.1 </td><td>  2019 </td><td>  Oracle </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ktor</a> </td><td>  1.2.1 </td><td>  2018 </td><td>  Jetbrains </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Micronaut</a> </td><td>  1.1.3 </td><td>  2018 </td><td>  Computa√ß√£o de objetos </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bota de mola</a> </td><td>  2.1.5 </td><td>  2014 </td><td>  Pivotal </td></tr></tbody></table></div><a name="habracut"></a><br>  Com base neles, foram criados quatro servi√ßos que podem interagir entre si por meio da API HTTP usando o padr√£o Service Discovery implementado usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Consul</a> .  Assim, eles formam uma arquitetura heterog√™nea de microsservi√ßo (no n√≠vel da estrutura) (a seguir denominada ISA): <br><br><img src="https://habrastorage.org/webt/tv/mv/kp/tvmvkpurtljgpl3yhxhtpmse4_g.png"><br><br>  Defina um conjunto de requisitos para cada servi√ßo: <br><br><ul><li>  pilha de tecnologia: <br><ul><li>  JDK 12; </li><li>  Kotlin </li><li>  Gradle (Kotlin DSL); </li><li>  JUnit 5. </li></ul><br></li><li>  funcionalidade (API HTTP): <br><ul><li><code>GET /application-info{?request-to=some-service-name}</code> <br>  Retorna algumas informa√ß√µes b√°sicas sobre o microsservi√ßo (nome, estrutura, ano de lan√ßamento da estrutura);  ao especificar o nome de um dos quatro microsservi√ßos no par√¢metro <code>request-to</code> √† sua API HTTP, uma solicita√ß√£o semelhante √© executada que retorna informa√ß√µes b√°sicas; </li><li> <code>GET /application-info/logo</code> <br>  Retorna a imagem. </li></ul><br></li><li>  implementa√ß√£o: <br><ul><li>  configura√ß√£o usando o arquivo de configura√ß√£o; </li><li>  Usando inje√ß√£o de depend√™ncia </li><li>  testes que verificam a funcionalidade da API HTTP. </li></ul><br></li><li>  ISA: <br><ul><li>  usando o padr√£o Service Discovery (registrando-se no Consul, acessando a API HTTP de outro microsservi√ßo por seu nome usando o balanceamento de carga do cliente); </li><li>  forma√ß√£o de artefato uber-jar. </li></ul><br></li></ul><br>  A seguir, consideramos a implementa√ß√£o de um microsservi√ßo em cada uma das estruturas e comparamos os par√¢metros dos aplicativos recebidos. <br><br><h1>  Servi√ßo Helidon </h1><br>  A estrutura de desenvolvimento foi criada na Oracle para uso interno, tornando-se posteriormente de c√≥digo aberto.  Existem dois modelos de desenvolvimento baseados nessa estrutura: Standard Edition (SE) e MicroProfile (MP).  Nos dois casos, o servi√ßo ser√° um programa Java SE regular.  Saiba mais sobre as diferen√ßas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nesta</a> p√°gina. <br><br>  Em resumo, o Helidon MP √© uma das implementa√ß√µes do Eclipse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MicroProfile</a> , que possibilita o uso de v√°rias APIs, conhecidas anteriormente pelos desenvolvedores Java EE (por exemplo, JAX-RS, CDI) e as mais recentes (Health Check, Metrics, Fault Tolerance) etc.)  Na variante Helidon SE, os desenvolvedores foram guiados pelo princ√≠pio de ‚ÄúNo magic‚Äù, expresso em particular em menos ou nenhuma anota√ß√£o necess√°ria para criar o aplicativo. <br><br>  Helidon SE foi selecionado para o desenvolvimento de microsservi√ßos.  Entre outras coisas, falta ferramentas para implementar a Inje√ß√£o de Depend√™ncias, portanto, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Koin √©</a> usado para implementar depend√™ncias.  A seguir est√° uma classe que cont√©m o m√©todo principal.  Para implementar a inje√ß√£o de depend√™ncia, a classe herda de <i>KoinComponent</i> .  O Koin inicia primeiro, depois as depend√™ncias necess√°rias s√£o inicializadas e o m√©todo <code>startServer()</code> √© chamado, onde um objeto do tipo <i>WebServer</i> √© criado, para o qual as configura√ß√µes e as configura√ß√µes de roteamento do aplicativo foram transferidas anteriormente;  ap√≥s o in√≠cio, o aplicativo √© registrado no Consul: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> HelidonServiceApplication : KoinComponent { <span class="hljs-meta"><span class="hljs-meta">@JvmStatic</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> startTime = System.currentTimeMillis() startKoin { modules(koinModule) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> applicationInfoService: ApplicationInfoService <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> inject() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> consulClient: Consul <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> inject() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> applicationInfoProperties: ApplicationInfoProperties <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> inject() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> serviceName = applicationInfoProperties.name startServer(applicationInfoService, consulClient, serviceName, startTime) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startServer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( applicationInfoService: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ApplicationInfoService</span></span></span></span><span class="hljs-function"><span class="hljs-params">, consulClient: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Consul</span></span></span></span><span class="hljs-function"><span class="hljs-params">, serviceName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, startTime: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>: WebServer { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> serverConfig = ServerConfiguration.create(Config.create().<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">"webserver"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> server: WebServer = WebServer .builder(createRouting(applicationInfoService)) .config(serverConfig) .build() server.start().thenAccept { ws -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> durationInMillis = System.currentTimeMillis() - startTime log.info(<span class="hljs-string"><span class="hljs-string">"Startup completed in </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$durationInMillis</span></span></span><span class="hljs-string"> ms. Service running at: http://localhost:"</span></span> + ws.port()) <span class="hljs-comment"><span class="hljs-comment">// register in Consul consulClient.agentClient().register(createConsulRegistration(serviceName, ws.port())) } return server }</span></span></code> </pre> <br>  O roteamento est√° configurado da seguinte maneira: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRouting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(applicationInfoService: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ApplicationInfoService</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Routing.builder() .register(JacksonSupport.create()) .<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">"/application-info"</span></span>, Handler { req, res -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> requestTo: String? = req.queryParams() .first(<span class="hljs-string"><span class="hljs-string">"request-to"</span></span>) .orElse(<span class="hljs-literal"><span class="hljs-literal">null</span></span>) res .status(Http.ResponseStatus.create(<span class="hljs-number"><span class="hljs-number">200</span></span>)) .send(applicationInfoService.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(requestTo)) }) .<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">"/application-info/logo"</span></span>, Handler { req, res -&gt; res.headers().contentType(MediaType.create(<span class="hljs-string"><span class="hljs-string">"image"</span></span>, <span class="hljs-string"><span class="hljs-string">"png"</span></span>)) res .status(Http.ResponseStatus.create(<span class="hljs-number"><span class="hljs-number">200</span></span>)) .send(applicationInfoService.getLogo()) }) .error(Exception::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span></span>{ req, res, ex -&gt; log.error(<span class="hljs-string"><span class="hljs-string">"Exception:"</span></span>, ex) res.status(Http.Status.INTERNAL_SERVER_ERROR_500).send() } .build()</code> </pre> <br>  O aplicativo usa a configura√ß√£o no formato <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><u>HOCON</u></a> : <br><br><pre> <code class="json hljs">webserver { port: <span class="hljs-number"><span class="hljs-number">8081</span></span> } application-info { name: <span class="hljs-string"><span class="hljs-string">"helidon-service"</span></span> framework { name: <span class="hljs-string"><span class="hljs-string">"Helidon SE"</span></span> release-year: <span class="hljs-number"><span class="hljs-number">2019</span></span> } }</code> </pre> <br>  Tamb√©m √© poss√≠vel usar arquivos nos formatos JSON, YAML e propriedades para configura√ß√£o (mais detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ). <br><br><h1>  Servi√ßo Ktor </h1><br>  A estrutura est√° escrita em Kotlin.  Um novo projeto pode ser criado de v√°rias maneiras: usando o sistema de constru√ß√£o, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">start.ktor.io</a> ou o plug-in para o IntelliJ IDEA (mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ). <br><br>  Como o Helidon SE, o Ktor n√£o possui uma DI pronta para uso, portanto, as depend√™ncias s√£o implementadas usando o Koin antes de iniciar o servidor: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> koinModule = module { single { ApplicationInfoService(<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>()) } single { ApplicationInfoProperties() } single { ServiceClient(<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>()) } single { Consul.builder().withUrl(<span class="hljs-string"><span class="hljs-string">"http://localhost:8500"</span></span>).build() } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { startKoin { modules(koinModule) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> server = embeddedServer(Netty, commandLineEnvironment(args)) server.start(wait = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) }</code> </pre> <br>  Os m√≥dulos exigidos pelo aplicativo s√£o especificados no arquivo de configura√ß√£o (somente o formato HOCON pode ser usado; mais sobre a configura√ß√£o do servidor Ktor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ), cujo conte√∫do √© apresentado abaixo: <br><br><pre> <code class="kotlin hljs">ktor { deployment { host = localhost port = <span class="hljs-number"><span class="hljs-number">8082</span></span> watch = [io.heterogeneousmicroservices.ktorservice] } application { modules = [io.heterogeneousmicroservices.ktorservice.module.KtorServiceApplicationModuleKt.module] } } application-info { name: <span class="hljs-string"><span class="hljs-string">"ktor-service"</span></span> framework { name: <span class="hljs-string"><span class="hljs-string">"Ktor"</span></span> release-year: <span class="hljs-number"><span class="hljs-number">2018</span></span> }</code> </pre> <br>  Ktor e Koin usam o termo "m√≥dulo", que tem significados diferentes.  Em Koin, um m√≥dulo √© an√°logo ao contexto do aplicativo no Spring Framework.  O m√≥dulo Ktor √© uma fun√ß√£o definida pelo usu√°rio que aceita um objeto do tipo <i>Aplicativo</i> e pode configurar um pipeline, definir recursos, registrar rotas, processar <br>  pedidos, etc .: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Application.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">module</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> applicationInfoService: ApplicationInfoService <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> inject() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isTest()) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> consulClient: Consul <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> inject() registerInConsul(applicationInfoService.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-literal"><span class="hljs-literal">null</span></span>).name, consulClient) } install(DefaultHeaders) install(Compression) install(CallLogging) install(ContentNegotiation) { jackson {} } routing { route(<span class="hljs-string"><span class="hljs-string">"application-info"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> requestTo: String? = call.parameters[<span class="hljs-string"><span class="hljs-string">"request-to"</span></span>] call.respond(applicationInfoService.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(requestTo)) } static { resource(<span class="hljs-string"><span class="hljs-string">"/logo"</span></span>, <span class="hljs-string"><span class="hljs-string">"logo.png"</span></span>) } } } }</code> </pre> <br>  Nesse trecho de c√≥digo, o roteamento de solicita√ß√µes √© configurado, em particular, o recurso est√°tico <code>logo.png</code> . <br><br>  O servi√ßo Ktor pode conter recursos.  Um recurso √© uma funcionalidade incorporada em um <i>pipeline de</i> solicita√ß√£o-resposta ( <i>DefaultHeaders, Compression</i> e outros no exemplo de c√≥digo acima).  √â poss√≠vel implementar seus pr√≥prios recursos, por exemplo, o c√≥digo abaixo implementa o padr√£o Service Discovery em combina√ß√£o com o balanceamento de carga do cliente com base no algoritmo Round-robin: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsulFeature</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> consulClient: Consul) { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> consulClient: Consul } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Feature : HttpClientFeature&lt;Config, ConsulFeature&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serviceInstanceIndex: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key = AttributeKey&lt;ConsulFeature&gt;(<span class="hljs-string"><span class="hljs-string">"ConsulFeature"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Config</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) = ConsulFeature(Config().apply(block).consulClient) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">install</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(feature: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ConsulFeature</span></span></span></span><span class="hljs-function"><span class="hljs-params">, scope: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HttpClient</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { scope.requestPipeline.intercept(HttpRequestPipeline.Render) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> serviceName = context.url.host <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> serviceInstances = feature.consulClient.healthClient().getHealthyServiceInstances(serviceName).response <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> selectedInstance = serviceInstances[serviceInstanceIndex] context.url.apply { host = selectedInstance.service.address port = selectedInstance.service.port } serviceInstanceIndex = (serviceInstanceIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) % serviceInstances.size } } } }</code> </pre> <br>  A l√≥gica principal est√° no m√©todo de <code>install</code> : durante a fase de solicita√ß√£o de <i>renderiza√ß√£o</i> (que √© executada antes da fase de <i>envio</i> ), o nome do servi√ßo chamado √© determinado primeiro e, em seguida, uma lista de inst√¢ncias desse servi√ßo √© solicitada ao <code>consulClient</code> , ap√≥s o qual a inst√¢ncia √© determinada usando o algoritmo Round-robin.  Assim, a seguinte chamada se torna poss√≠vel: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getApplicationInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(serviceName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ApplicationInfo = runBlocking { httpClient.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>&lt;ApplicationInfo&gt;(<span class="hljs-string"><span class="hljs-string">"http://</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$serviceName</span></span></span><span class="hljs-string">/application-info"</span></span>) }</code> </pre> <br><br><h1>  Servi√ßo Micronaut </h1><br>  O Micronaut √© desenvolvido pelos criadores da estrutura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grails</a> e √© inspirado na experi√™ncia de criar servi√ßos usando Spring, Spring Boot e Grails.  A estrutura √© uma poliglota que suporta Java, Kotlin e Groovy;  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">talvez haja</a> suporte para o Scala.  A inje√ß√£o de depend√™ncia √© realizada no est√°gio de compila√ß√£o, o que leva a menos consumo de mem√≥ria e inicializa√ß√£o mais r√°pida do aplicativo em compara√ß√£o com o Spring Boot. <br><br>  A classe principal tem o seguinte formato: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> MicronautServiceApplication { <span class="hljs-meta"><span class="hljs-meta">@JvmStatic</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { Micronaut.build() .packages(<span class="hljs-string"><span class="hljs-string">"io.heterogeneousmicroservices.micronautservice"</span></span>) .mainClass(MicronautServiceApplication.javaClass) .start() } }</code> </pre> <br>  Alguns componentes de um aplicativo baseado em Micronaut s√£o semelhantes aos de um aplicativo Spring Boot, por exemplo, o c√≥digo do controlador √© o seguinte: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller( value = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/application-info"</span></span></span><span class="hljs-meta">, consumes = [MediaType.APPLICATION_JSON], produces = [MediaType.APPLICATION_JSON] )</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationInfoController</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> applicationInfoService: ApplicationInfoService ) { <span class="hljs-meta"><span class="hljs-meta">@Get</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(requestTo: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: ApplicationInfo = applicationInfoService.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(requestTo) <span class="hljs-meta"><span class="hljs-meta">@Get(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/logo"</span></span></span><span class="hljs-meta">, produces = [MediaType.IMAGE_PNG])</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLogo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: ByteArray = applicationInfoService.getLogo() }</code> </pre> <br>  O suporte ao Kotlin no Micronaut √© baseado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plug-in do</a> compilador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">kapt</a> (mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">informa√ß√µes</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ).  O script de montagem est√° configurado da seguinte maneira: <br><br><pre> <code class="kotlin hljs">plugins { ... kotlin(<span class="hljs-string"><span class="hljs-string">"kapt"</span></span>) ... } dependencies { kapt(<span class="hljs-string"><span class="hljs-string">"io.micronaut:micronaut-inject-java"</span></span>) ... kaptTest(<span class="hljs-string"><span class="hljs-string">"io.micronaut:micronaut-inject-java"</span></span>) ... }</code> </pre> <br>  A seguir est√° o conte√∫do do arquivo de configura√ß√£o: <br><br><pre> <code class="json hljs">micronaut: application: name: micronaut-service server: port: <span class="hljs-number"><span class="hljs-number">8083</span></span> consul: client: registration: enabled: <span class="hljs-literal"><span class="hljs-literal">true</span></span> application-info: name: ${micronaut.application.name} framework: name: Micronaut release-year: <span class="hljs-number"><span class="hljs-number">2018</span></span></code> </pre> <br>  A configura√ß√£o do microsservi√ßo tamb√©m √© poss√≠vel com JSON, propriedades e formatos de arquivo Groovy (mais detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ). <br><br><h1>  Servi√ßo de inicializa√ß√£o do Spring </h1><br>  A estrutura foi criada para simplificar o desenvolvimento de aplicativos usando o ecossistema Spring Framework.  Isso √© alcan√ßado atrav√©s de mecanismos de configura√ß√£o autom√°tica ao conectar bibliotecas.  A seguir est√° o c√≥digo do controlador: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping(path = [</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"application-info"</span></span></span><span class="hljs-meta">], produces = [MediaType.APPLICATION_JSON_UTF8_VALUE])</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationInfoController</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> applicationInfoService: ApplicationInfoService ) { <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@RequestParam(</span></span></span><span class="hljs-meta-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-meta-string">"request-to"</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> requestTo: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: ApplicationInfo = applicationInfoService.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(requestTo) <span class="hljs-meta"><span class="hljs-meta">@GetMapping(path = [</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/logo"</span></span></span><span class="hljs-meta">], produces = [MediaType.IMAGE_PNG_VALUE])</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLogo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: ByteArray = applicationInfoService.getLogo() }</code> </pre> <br>  O microsservi√ßo est√° configurado com um arquivo YAML: <br><br><pre> <code class="json hljs">spring: application: name: spring-boot-service server: port: <span class="hljs-number"><span class="hljs-number">8084</span></span> application-info: name: ${spring.application.name} framework: name: Spring Boot release-year: <span class="hljs-number"><span class="hljs-number">2014</span></span></code> </pre> <br>  Tamb√©m √© poss√≠vel usar arquivos de formato de propriedades para configura√ß√£o (mais detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ). <br><br><h1>  Lan√ßamento </h1><br>  O projeto funciona no JDK 12, embora provavelmente tamb√©m esteja na vers√£o 11, voc√™ s√≥ precisa alterar o par√¢metro <code>jvmTarget</code> nos scripts de montagem de <code>jvmTarget</code> : <br><br><pre> <code class="kotlin hljs">withType&lt;KotlinCompile&gt; { kotlinOptions { jvmTarget = <span class="hljs-string"><span class="hljs-string">"12"</span></span> ... } }</code> </pre> <br>  Antes de iniciar os microsservi√ßos, voc√™ precisa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instalar o</a> Consul e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">iniciar o</a> agente - por exemplo, como este: <code>consul agent -dev</code> . <br><br>  √â poss√≠vel iniciar microsservi√ßos em: <br><br><ul><li>  IDE <br>  Os usu√°rios do IntelliJ IDEA podem ver algo como o seguinte: <br><img src="https://habrastorage.org/webt/n3/u_/hy/n3u_hy7_z5ut65ryaetvsw2znci.png"><br></li><li>  o console <br>  Para fazer isso, v√° para a pasta do projeto e execute sequencialmente: <br><br><pre> <code class="plaintext hljs">java -jar helidon-service/build/libs/helidon-service-all.jar java -jar ktor-service/build/libs/ktor-service-all.jar java -jar micronaut-service/build/libs/micronaut-service-all.jar java -jar spring-boot-service/build/libs/spring-boot-service.jar</code> </pre> <br></li></ul><br>  Ap√≥s iniciar todos os microsservi√ßos em <code>http://localhost:8500/ui/dc1/services</code> voc√™ ver√°: <br><br><img src="https://habrastorage.org/webt/qi/lm/bv/qilmbv1op4a6xgy6b31tnsfjpmm.png"><br><br><h1>  Teste de API </h1><br>  Os resultados do teste da API de servi√ßo Helidon s√£o dados como exemplo: <br><br><ol><li> <code>GET http://localhost:8081/application-info</code> <br> <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"helidon-service"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"framework"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Helidon SE"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"releaseYear"</span></span>: <span class="hljs-number"><span class="hljs-number">2019</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"requestedService"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre> </li><li> <code>GET http://localhost:8081/application-info?request-to=ktor-service</code> <br> <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"helidon-service"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"framework"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Helidon SE"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"releaseYear"</span></span>: <span class="hljs-number"><span class="hljs-number">2019</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"requestedService"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"ktor-service"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"framework"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Ktor"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"releaseYear"</span></span>: <span class="hljs-number"><span class="hljs-number">2018</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"requestedService"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> } }</code> </pre> </li><li> <code>GET http://localhost:8081/application-info/logo</code> <br> <br>  Retorna a imagem. </li></ol><br>  √â poss√≠vel testar uma API arbitr√°ria de microsservi√ßo usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Postman</a> (uma <a href="">cole√ß√£o de</a> solicita√ß√µes), o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.jetbrains.com/help/idea/">cliente HTTP do</a> IntelliJ IDEA (uma <a href="https://github.com/rkudryashov/heterogeneous-microservices/blob/master/_misc/api_testing/idea_http_client/http-request.">cole√ß√£o de</a> solicita√ß√µes), um navegador ou outra ferramenta.  Se voc√™ usar os dois primeiros clientes, precisar√° especificar a porta do microsservi√ßo chamado na vari√°vel correspondente (no Postman, ele est√° no <i>menu de cole√ß√£o -&gt; Editar -&gt; Vari√°veis</i> , e no HTTP Client, ele est√° na vari√°vel de ambiente especificada <a href="https://github.com/rkudryashov/heterogeneous-microservices/blob/master/_misc/api_testing/idea_http_client/">neste</a> arquivo) e ao testar o m√©todo 2) A API tamb√©m precisa especificar o nome do microsservi√ßo "sob o cap√¥" solicitado.  As respostas ser√£o semelhantes √†s fornecidas acima. <br><br><h1>  Compara√ß√£o de configura√ß√µes de aplicativos </h1><br><br><h3>  Tamanho do Artefato </h3><br>  Para preservar a simplicidade de configurar e executar aplicativos nos scripts de montagem, nenhuma depend√™ncia transitiva foi exclu√≠da; portanto, o tamanho do servi√ßo uber-JAR no Spring Boot excede significativamente o tamanho dos an√°logos em outras estruturas (porque, ao usar os iniciantes, n√£o s√£o importadas apenas as depend√™ncias necess√°rias; se desejado, o tamanho pode ser reduzido significativamente): <br><div class="scrollable-table"><table><tbody><tr><th>  Microservi√ßo </th><th>  Tamanho do Artefato, MB </th></tr><tr><td>  Servi√ßo Helidon </td><td align="right">  16,6 </td></tr><tr><td>  Servi√ßo Ktor </td><td align="right">  20,9 </td></tr><tr><td>  Servi√ßo Micronaut </td><td align="right">  16,5 </td></tr><tr><td>  Servi√ßo de inicializa√ß√£o do Spring </td><td align="right">  42,7 </td></tr></tbody></table></div><br><br><h3>  Hora de lan√ßamento </h3><br>  O tempo de inicializa√ß√£o de cada aplicativo √© inconsistente e cai em alguma "janela";  a tabela abaixo mostra o tempo de ativa√ß√£o do artefato sem especificar nenhum par√¢metro adicional: <br><div class="scrollable-table"><table><tbody><tr><th>  Microservi√ßo </th><th>  Hora de in√≠cio, segundos </th></tr><tr><td>  Servi√ßo Helidon </td><td align="right">  2.2 </td></tr><tr><td>  Servi√ßo Ktor </td><td align="right">  1.4 </td></tr><tr><td>  Servi√ßo Micronaut </td><td align="right">  4.0 </td></tr><tr><td>  Servi√ßo de inicializa√ß√£o do Spring </td><td align="right">  10,2 </td></tr></tbody></table></div><br>  √â importante notar que, se voc√™ "limpar" o aplicativo Spring Boot de depend√™ncias desnecess√°rias e prestar aten√ß√£o na configura√ß√£o do aplicativo para iniciar (por exemplo, verificar apenas os pacotes necess√°rios e usar a inicializa√ß√£o lenta do compartimento), poder√° reduzir significativamente o tempo de inicializa√ß√£o. <br><br><h3>  Teste de carga </h3><br>  Para o teste, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gatling</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um script</a> Scala foram usados.  O gerador de carga e o servi√ßo em teste foram executados na mesma m√°quina (Windows 10, um processador quad-core de 3,2 GHz, 24 GB de RAM, SSD).  A porta deste servi√ßo √© indicada no script Scala. <br><br>  Para cada microsservi√ßo √© determinado: <br><br><ul><li>  a quantidade m√≠nima de mem√≥ria heap ( <code>-Xmx</code> ) necess√°ria para executar um microsservi√ßo em funcionamento (respondendo a solicita√ß√µes) </li><li>  mem√≥ria heap m√≠nima necess√°ria para passar no teste de carga 50 usu√°rios * 1000 solicita√ß√µes </li><li>  mem√≥ria heap m√≠nima necess√°ria para passar no teste de carga 500 usu√°rios * 1000 solicita√ß√µes </li></ul><br>  Passar em um teste de carga significa que o microsservi√ßo respondeu a todas as solicita√ß√µes a qualquer momento. <br><div class="scrollable-table"><table><tbody><tr><th rowspan="2">  Microservi√ßo </th><th colspan="3">  A quantidade m√≠nima de mem√≥ria heap, MB </th></tr><tr><th>  Para iniciar o servi√ßo </th><th>  Para carga 50 * 1000 </th><th>  Para carga 500 * 1000 </th></tr><tr><td>  Servi√ßo Helidon </td><td align="right">  9 </td><td align="right">  9 </td><td align="right">  11 </td></tr><tr><td>  Servi√ßo Ktor </td><td align="right">  11 </td><td align="right">  11 </td><td align="right">  13 </td></tr><tr><td>  Servi√ßo Micronaut </td><td align="right">  13 </td><td align="right">  13 </td><td align="right">  17 </td></tr><tr><td>  Servi√ßo de inicializa√ß√£o do Spring </td><td align="right">  22 </td><td align="right">  23 </td><td align="right">  25 </td></tr></tbody></table></div><br>  Vale ressaltar que todos os microsservi√ßos usam o servidor HTTP Netty. <br><br><h1>  Conclus√£o </h1><br>  A tarefa - a cria√ß√£o de um servi√ßo simples com API HTTP e a capacidade de funcionar no ISA - p√¥de ser conclu√≠da em todas as estruturas em quest√£o.  √â hora de fazer um balan√ßo e considerar seus pr√≥s e contras. <br><br>  <i><b>Helidon</b></i> <br><br>  <font color="#808080">Edi√ß√£o Standard</font> <br><ul><li>  vantagens <br><ul><li>  configura√ß√µes do aplicativo <br>  Em todos os aspectos, apresentou bons resultados; </li><li>  "Sem m√°gica" <br>  A estrutura justificou o princ√≠pio declarado pelos desenvolvedores: foram necess√°rias apenas uma anota√ß√£o para criar o aplicativo ( <code>@JvmStatic</code> - para o interope Java-Kotlin). </li></ul></li><li>  contras <br><ul><li>  microframework <br>  Alguns componentes necess√°rios para o desenvolvimento industrial est√£o ausentes, por exemplo, inje√ß√£o de depend√™ncia e implementa√ß√£o do Service Discovery. </li></ul></li></ul><br>  <font color="#808080">Microprofile</font> <br>  O microsservi√ßo n√£o foi implementado nessa estrutura; portanto, observarei apenas alguns pontos: <br><br><ul><li>  vantagens <br><ul><li>  Implementa√ß√£o do Eclipse MicroProfile <br>  Em ess√™ncia, o MicroProfile √© o Java EE otimizado para ISA.  Assim, em primeiro lugar, voc√™ obt√©m acesso a toda a variedade de APIs Java EE, incluindo aquelas projetadas especificamente para o ISA, e em segundo lugar, pode alterar a implementa√ß√£o do MicroProfile para qualquer outro (Open Liberty, WildFly Swarm, etc.) . </li></ul></li><li>  adicionalmente <br><ul><li>  No <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MicroProfile Starter,</a> voc√™ pode criar um projeto do zero com os par√¢metros necess√°rios, por analogia com ferramentas semelhantes para outras estruturas (por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spring Initializr</a> ).  No momento da publica√ß√£o do artigo, Helidon implementa o MicroProfile 1.2, enquanto a vers√£o mais recente da especifica√ß√£o √© 3.0. </li></ul></li></ul><br><br>  <i><b>Ktor</b></i> <br><br><ul><li>  vantagens <br><ul><li>  leveza <br>  Permite conectar apenas as fun√ß√µes diretamente necess√°rias para concluir a tarefa; </li><li>  configura√ß√µes do aplicativo <br>  Bons resultados em todos os aspectos. </li></ul></li><li>  contras <br><ul><li>  "Afiado" no Kotlin, ou seja, √© poss√≠vel, mas n√£o necess√°rio, desenvolver em Java; </li><li>  microframework (consulte o item semelhante para Helidon SE). </li></ul></li><li>  adicionalmente <br>  Por um lado, o conceito de desenvolvimento de estrutura n√£o est√° inclu√≠do nos dois modelos de desenvolvimento Java mais populares (Spring-like (Spring Boot / Micronaut) e Java EE / MicroProfile), o que pode levar a: <br><br><ul><li>  um problema em encontrar especialistas; </li><li>  mais tempo para concluir as tarefas em compara√ß√£o com o Spring Boot devido √† necessidade de configurar explicitamente a funcionalidade necess√°ria. </li></ul><br>  Por outro lado, a diferen√ßa entre o Spring e Java EE ‚Äúcl√°ssico‚Äù permite que voc√™ observe o processo de desenvolvimento de um √¢ngulo diferente, talvez mais conscientemente. </li></ul><br><br>  <i><b>Micronaut</b></i> <br><br><ul><li>  vantagens <br><ul><li>  Aot <br>  Como observado anteriormente, o AOT permite reduzir o tempo de in√≠cio e a mem√≥ria consumidos pelo aplicativo em compara√ß√£o com o seu equivalente no Spring Boot; </li><li>  Modelo de desenvolvimento semelhante a uma mola <br>  Programadores com experi√™ncia em desenvolvimento no Spring n√£o levar√£o muito tempo para dominar essa estrutura; </li><li>  configura√ß√µes do aplicativo <br>  Bons resultados em todos os aspectos; </li><li>  poliglota <br>  Suporte cidad√£o de primeira classe para Java, Kotlin, Groovy;  talvez haja suporte para o Scala.  Na minha opini√£o, isso pode afetar positivamente o crescimento da comunidade.  A prop√≥sito, em junho de 2019 Groovy no ranking da popularidade das linguagens de programa√ß√£o, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">TIOBE</a> ocupa o 14¬∫ lugar, decolando do 60¬∫ ano anterior, ficando em um segundo lugar honroso entre as linguagens da JVM; </li><li>  O projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Micronaut for Spring tamb√©m</a> permite alterar o tempo de execu√ß√£o do aplicativo Spring Boot existente para Micronaut (com restri√ß√µes). </li></ul></li></ul><br><br>  <i><b>Bota de mola</b></i> <br><br><ul><li>  vantagens <br><ul><li>  maturidade da plataforma e ecossistema <br>  A estrutura "todos os dias".  Para a maioria das tarefas cotidianas, j√° existe uma solu√ß√£o no paradigma de programa√ß√£o Spring, isto √©, de uma maneira familiar para muitos programadores.  O desenvolvimento √© simplificado pelos conceitos de entradas e configura√ß√µes autom√°ticas; </li><li>  a presen√ßa de um grande n√∫mero de especialistas no mercado de trabalho, bem como uma base de conhecimento significativa (incluindo documenta√ß√£o e respostas ao Stack Overflow); </li><li>  perspectiva <br>  Acho que muitos concordar√£o que, no futuro pr√≥ximo, a Primavera continuar√° sendo a principal estrutura de desenvolvimento. </li></ul></li><li>  contras <br><ul><li>  configura√ß√µes do aplicativo <br>  A aplica√ß√£o nessa estrutura n√£o estava entre os l√≠deres, no entanto, alguns par√¢metros, conforme observado anteriormente, podem ser otimizados independentemente.  Tamb√©m vale lembrar a presen√ßa do projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spring Fu</a> , que est√° em desenvolvimento ativo, cuja utiliza√ß√£o permite reduzir esses par√¢metros. </li></ul></li></ul><br>  Voc√™ tamb√©m pode destacar os problemas gerais associados √†s novas estruturas ausentes do Spring Boot: <br><br><ul><li>  ecossistema menos desenvolvido; </li><li>  um pequeno n√∫mero de especialistas com experi√™ncia com essas tecnologias; </li><li>  mais tempo para concluir tarefas; </li><li>  perspectivas obscuras. </li></ul><br>  As estruturas consideradas pertencem a diferentes categorias de peso: Helidon SE e Ktor s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">microframes</a> , Spring Boot √© uma estrutura de pilha cheia, √© mais prov√°vel que o Micronaut tamb√©m seja pilha cheia;  outra categoria √© MicroProfile (por exemplo, Helidon MP).  Nos microframes, a funcionalidade √© limitada, o que pode retardar a execu√ß√£o das tarefas;  Para esclarecer a possibilidade de implementar essa ou aquela funcionalidade com base em qualquer estrutura de desenvolvimento, recomendo que voc√™ se familiarize com a documenta√ß√£o. <br><br>  N√£o me atrevo a julgar se essa ou aquela estrutura "disparar√°" em um futuro pr√≥ximo; portanto, na minha opini√£o, √© melhor continuar monitorando o desenvolvimento de eventos usando a estrutura de desenvolvimento existente para resolver tarefas de trabalho. <br><br>  Ao mesmo tempo, como foi mostrado no artigo, as novas estruturas superam o Spring Boot pelos par√¢metros considerados dos aplicativos recebidos.  Se qualquer um desses par√¢metros for cr√≠tico para qualquer um dos seus microsservi√ßos, talvez seja necess√°rio prestar aten√ß√£o √†s estruturas que apresentaram os melhores resultados.  No entanto, n√£o esque√ßa que o Spring Boot, em primeiro lugar, continua a melhorar e, em segundo lugar, possui um ecossistema enorme e um n√∫mero significativo de programadores Java est√° familiarizado com ele.  Existem outras estruturas que n√£o s√£o abordadas neste artigo: Javalin, Quarkus etc. <br><br>  Voc√™ pode visualizar o c√≥digo do projeto no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> .  Obrigado pela aten√ß√£o! <br><br>  PS: Obrigado ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">artglorin</a> por ajudar com este artigo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt456376/">https://habr.com/ru/post/pt456376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt456366/index.html">Como projetei a caixa LED HEART</a></li>
<li><a href="../pt456368/index.html">Executando transa√ß√µes p√∫blicas e privadas no blockchain JPMorgan Quorum usando Web3</a></li>
<li><a href="../pt456370/index.html">Implementar QoS no armazenamento Qsan</a></li>
<li><a href="../pt456372/index.html">SimbirSoft convida profissionais de TI para o ver√£o intensivo de 2019</a></li>
<li><a href="../pt456374/index.html">Estruturas de dados de estado de blockchain do Plasma Cash</a></li>
<li><a href="../pt456380/index.html">Dia Aberto da Faculdade de Programa√ß√£o em Netologia</a></li>
<li><a href="../pt456382/index.html">Colabora√ß√£o e automa√ß√£o no frontend. O que aprendemos com 13 escolas</a></li>
<li><a href="../pt456384/index.html">Gr√°fico de PVS-Studio de desenvolvimento de habilidades de diagn√≥stico</a></li>
<li><a href="../pt456386/index.html">Bibliotecas abertas para visualiza√ß√£o de conte√∫do de √°udio</a></li>
<li><a href="../pt456388/index.html">Gr√°fico de desenvolvimento de diagn√≥stico no PVS-Studio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>