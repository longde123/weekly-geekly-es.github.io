<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ¡ï¸ ğŸ‘¨ğŸ¼â€ğŸ¨ ğŸ¤µ é€šè¿‡VkBotLongPollåˆ›å»ºVKæœºå™¨äººå¹¶å°†å…¶é›†æˆåˆ°ä¸€ä¸ªç»„ä¸­[Python] ğŸ‘‹ğŸ¾ ğŸ”« ğŸ‘§ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæœºå™¨äººå¹¶å°†å…¶é›†æˆåˆ°Python 3.xä¸­çš„VKç»„ä¸­ã€‚ 

 æœ¬æ–‡é€‚ç”¨äºè°ï¼Ÿ 
 å¯¹äºé‚£äº›æƒ³è¦ä¸ºè‡ªå·±çš„ç¤¾åŒºå†™ä¸€ä¸ªç®€å•çš„æœºå™¨äººçš„äººï¼Œèƒ½å¤Ÿç¡®å®šå›¢é˜Ÿå¹¶æ˜¾ç¤ºé€‚å½“çš„ç­”æ¡ˆ 

 ä¸»è¦é˜¶æ®µ 


- é¦–å…ˆï¼Œåœ¨VKä¸­åˆ›å»ºä¸€ä¸ªæ¼«æ¸¸å™¨ï¼Œé…ç½®APIå¯†é’¥å¹¶å¯ç”¨Long Poll API 
- è®¾ç½®é•¿è½®...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>é€šè¿‡VkBotLongPollåˆ›å»ºVKæœºå™¨äººå¹¶å°†å…¶é›†æˆåˆ°ä¸€ä¸ªç»„ä¸­[Python]</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428680/"> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæœºå™¨äººå¹¶å°†å…¶é›†æˆåˆ°Python 3.xä¸­çš„VKç»„ä¸­ã€‚ <br><br><h3> æœ¬æ–‡é€‚ç”¨äºè°ï¼Ÿ </h3><br> å¯¹äºé‚£äº›æƒ³è¦ä¸ºè‡ªå·±çš„ç¤¾åŒºå†™ä¸€ä¸ªç®€å•çš„æœºå™¨äººçš„äººï¼Œèƒ½å¤Ÿç¡®å®šå›¢é˜Ÿå¹¶æ˜¾ç¤ºé€‚å½“çš„ç­”æ¡ˆ <br><br><h3> ä¸»è¦é˜¶æ®µ </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¦–å…ˆï¼Œåœ¨VKä¸­åˆ›å»ºä¸€ä¸ªæ¼«æ¸¸å™¨ï¼Œé…ç½®APIå¯†é’¥å¹¶å¯ç”¨Long Poll API</a> </li><li> è®¾ç½®é•¿è½®è¯¢ </li><li> æ·»åŠ æœºå™¨äººå°†å¤„ç†çš„å‘½ä»¤çš„å®šä¹‰ </li><li> åˆ›å»ºå›¢é˜Ÿåä¼š </li><li> æ–°å¢é”®ç›˜ </li></ul><a name="habracut"></a><br><h3> åˆ›å»ºä¸€ä¸ªæœºå™¨äººç»„ </h3><br> æˆ‘ä»¬å°†ä»åˆ›å»ºä¸€ä¸ªæœºå™¨äººï¼ˆå³VKä¸­çš„ç»„ï¼‰å¼€å§‹ã€‚ <br><br> ä¸ºæ­¤ï¼Œè¯·è½¬åˆ°â€œç»„â€â†’â€œåˆ›å»ºç¤¾åŒºâ€ã€‚ <br><br> é€‰æ‹©ä»»ä½•ç±»å‹çš„ç¤¾åŒºï¼Œç„¶åè¾“å…¥åç§°ï¼Œç»„ä¸»é¢˜ã€‚ <br><br> åœ¨æ‰“å¼€çš„è®¾ç½®é¡µé¢ä¸Šï¼Œé€‰æ‹©â€œä½¿ç”¨APIâ€‹â€‹â€ã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªAPIå¯†é’¥ã€‚ <br><br> ç„¶åé€‰æ‹©éœ€è¦è®¿é—®APIå¯†é’¥çš„å‚æ•°ã€‚ <br><br> æœ€æœ‰å¯èƒ½çš„æ˜¯ï¼Œæ‚¨å°†å¿…é¡»ä½¿ç”¨æ‰‹æœºåœ¨VKä¸­ç¡®è®¤æ“ä½œã€‚ ç„¶åå°†ç”Ÿæˆçš„APIå¯†é’¥å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ã€‚ æˆ‘ä»¬ä»ç„¶éœ€è¦å®ƒã€‚ <br><br> ç„¶åï¼Œæ‚¨éœ€è¦å…è®¸æ¶ˆæ¯ã€‚ ä¸ºæ­¤ï¼Œè¯·è½¬åˆ°â€œæ¶ˆæ¯â€å¹¶æ‰“å¼€å®ƒä»¬ã€‚ åŒæ—¶åœ¨â€œæ¶ˆæ¯â€-&gt;â€œæœºå™¨äººçš„è®¾ç½®â€ä¸­å¯ç”¨â€œå¯åŠ¨åŠŸèƒ½â€ã€‚ <br><br> å¦‚æœæˆ‘ä»¬å¸Œæœ›æ¼«æ¸¸å™¨èƒ½å¤Ÿæ¥æ”¶æ¥è‡ªç¾¤ç»„çš„æ¶ˆæ¯ï¼Œåˆ™å¯ä»¥åœ¨è¯¥ç¾¤ç»„ä¸­æ·»åŠ ç¤¾åŒºã€‚ <br><br><h3> è®¾ç½®é•¿è½®è¯¢ </h3><br> è¦ä½¿ç”¨Long Poll APIï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">vk_api</a>åº“ã€‚ æ‚¨å¯ä»¥é€šè¿‡pipå®‰è£…å®ƒã€‚ <br><br> åœ¨å¼€å§‹å·¥ä½œä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šå°†APIä»¤ç‰Œä¿å­˜åœ¨config.pyæ–‡ä»¶ä¸­ï¼Œç„¶åä»æ­¤å¤„åŠ è½½å¯†é’¥ã€‚ <br><br> è®©æˆ‘ä»¬åˆ›å»ºç¬¬ä¸€ä¸ªè„šæœ¬ã€‚ è®©æˆ‘ä»¬å°†server.pyå‘½åä¸ºä¸»æœåŠ¡å™¨è„šæœ¬ã€‚ <br><br> æˆ‘ä»¬å¯¼å…¥æ‰€éœ€çš„æ¨¡å—ï¼š <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api.vk_api <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vk_api.bot_longpoll <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VkBotLongPoll <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vk_api.bot_longpoll <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VkBotEventType</code> </pre> <br> åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ç±»ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Server</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, api_token, group_id, server_name: str=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Empty"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    self.server_name = server_name #  Long Poll self.vk = vk_api.VkApi(token=api_token) #   Long Poll API self.long_poll = VkBotLongPoll(self.vk, group_id) #    vk_api self.vk_api = self.vk.get_api() def send_msg(self, send_id, message): """     messages.send :param send_id: vk id ,    :param message:    :return: None """ self.vk_api.messages.send(peer_id=send_id, message=message) def test(self): #      ID self.send_msg(255396611, "-!")</span></span></code> </pre> <br> ç°åœ¨åˆ›å»ºserver_manager.pyæ–‡ä»¶ï¼Œå®ƒå°†åœ¨å…¶ä¸­ç®¡ç†ä¸åŒçš„æœåŠ¡å™¨ã€‚ ç›®å‰ï¼Œå¯¹äºæµ‹è¯•ï¼Œæˆ‘ä»¬ä»…ç¼–å†™å¯¹Serverç±»çš„è°ƒç”¨ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     Server from server import Server #   config.py  api-token from config import vk_api_token server1 = Server(vk_api_token, 172998024, "server1") # vk_api_token - API ,     # 172998024 - id - # "server1" -   server1.test()</span></span></code> </pre> <br><blockquote><h4> é‡è¦ï¼ </h4> è¯¥æ¼«æ¸¸å™¨åªèƒ½å°†æ¶ˆæ¯å†™å…¥å…è®¸è¯¥æ¼«æ¸¸å™¨å‘é€æ¶ˆæ¯çš„ç”¨æˆ·ã€‚ æ‚¨å¯ä»¥åœ¨ç¤¾åŒºé¡µé¢ä¸Šæ‰§è¡Œæ­¤æ“ä½œï¼Œä¹Ÿå¯ä»¥å…ˆç¼–å†™æœºå™¨äºº </blockquote><br> å¦‚æœä¸€åˆ‡æ“ä½œæ­£ç¡®ï¼Œè¯¥æœºå™¨äººå°†å‘æˆ‘ä»¬å‘é€ä¸€æ¡ä¸ªäººæ¶ˆæ¯ã€‚ <br><br> ç°åœ¨ï¼Œå°†è¯¥æœºå™¨äººæ·»åŠ åˆ°ç¾¤ç»„ä¸­ï¼Œå¹¶æ•™ä»–å¦‚ä½•å¤„ç†æ¶ˆæ¯ã€‚ <br> è¦å°†æ¼«æ¸¸å™¨æ·»åŠ åˆ°ç»„ä¸­ï¼Œè¯·åœ¨ç¤¾åŒºå³ä¾§èœå•ä¸­å•å‡»â€œé‚€è¯·è¿›è¡Œå¯¹è¯â€ã€‚ <br><br> å°†å¯åŠ¨åŠŸèƒ½æ·»åŠ åˆ°æœºå™¨äººä¸­ï¼Œä¹‹åå®ƒå°†å¼€å§‹é€šè¿‡Long Pollâ€œç›‘å¬â€æ¶ˆæ¯ï¼ˆä¸è¦å¿˜è®°åœ¨â€œä½¿ç”¨APIâ€‹â€‹â€-&gt;â€œ Long Poll APIâ€éƒ¨åˆ†ä¸­ä¸ºäº‹ä»¶ç±»å‹æ·»åŠ æƒé™å¹¶æ”¾å…¥æœ€æ–°ç‰ˆæœ¬ï¼‰ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.long_poll.listen(): print(event)</code> </pre> <br> é€šè¿‡server_manager.pyè¿è¡Œå®ƒï¼š <br><br><pre> <code class="python hljs">server1.start()</code> </pre> <br> ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å‘ç»„å†™ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº‹ä»¶å¯¹è±¡ï¼š <br><blockquote>  &lt;&lt;ç±»'vk_api.bot_longpoll.VkBotMessageEvent'&gt;ï¼ˆ{'type'ï¼š'message_new'ï¼Œ'object'ï¼š{'date'ï¼š1541273151ï¼Œ'from_id'ï¼š25599999999ï¼Œ'id'ï¼š0ï¼Œ'out'ï¼š0ï¼Œ 'peer_id'ï¼š2000000001ï¼Œ'text'ï¼š'[club172998024 |æœºå™¨äººåœ¨è¾¾Vk]è¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬ï¼'ï¼Œ'conversation_message_id'ï¼š187ï¼Œ'fwd_messages'ï¼š[]ï¼Œ'é‡è¦'ï¼šFalseï¼Œ'random_id'ï¼š0 ï¼Œ'attachments'ï¼š[]ï¼Œ'is_hidden'ï¼šFalse}ï¼Œ'group_id'ï¼š172998024}ï¼‰&gt; </blockquote><br> å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç§äººæ¶ˆæ¯ä¸­å†™ï¼š <br><blockquote>  &lt;&lt;ç±»'vk_api.bot_longpoll.VkBotMessageEvent'&gt;ï¼ˆ{'type'ï¼š'message_new'ï¼Œ'object'ï¼š{'date'ï¼š1541273238ï¼Œ'from_id'ï¼š25599999999ï¼Œ'id'ï¼š47ï¼Œ'out'ï¼š0ï¼Œ 'peer_id'ï¼š255396611ï¼Œ'text'ï¼š'è¿™æ˜¯ç§äººæ¶ˆæ¯'ï¼Œ'conversation_message_id'ï¼š47ï¼Œ'fwd_messages'ï¼š[]ï¼Œ'é‡è¦'ï¼šFalseï¼Œ'random_id'ï¼š0ï¼Œ'é™„ä»¶'ï¼š[]ï¼Œ'is_hidden 'ï¼šFalse}ï¼Œ'group_id'ï¼š172998024}ï¼‰&gt; </blockquote><br><br> ä»è¿™äº›æ•°æ®ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥æ³¨æ„<i>ç±»å‹object.from_idï¼Œobject.idï¼Œobject.peer_idï¼Œobject.text</i> ã€‚ ä»æ¶ˆæ¯å’Œä»ç»„æ¥æ”¶çš„æ•°æ®é™¤äº†<i>object.peer_id</i>å’Œ<i>object.id</i>ä¹‹å¤–æ²¡æœ‰å¤ªå¤§<i>åŒºåˆ«</i> ã€‚ <br><br> å¦‚æœä»”ç»†è§‚å¯Ÿï¼Œè¯¥ç»„ä¸­æ‰€æœ‰æ¶ˆæ¯çš„object.idä¸º0ï¼Œä½†ä¸ªäººæ¶ˆæ¯ä¸­æ²¡æœ‰æ¶ˆæ¯ã€‚ å› æ­¤ï¼Œå¯ä»¥å°†ä»ç»„å’Œä¸ªäººæ¶ˆæ¯ä¸­åˆ†ç¦»å‡ºæ¶ˆæ¯ã€‚ <br><br> æˆ‘ä»¬åœ¨Serverç±»ä¸­å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.long_poll.listen(): <span class="hljs-comment"><span class="hljs-comment">#   #    if event.type == VkBotEventType.MESSAGE_NEW: print("Username: " + self.get_user_name(event.object.from_id)) print("From: " + self.get_user_city(event.object.from_id)) print("Text: " + event.object.text) print("Type: ", end="") if event.object.id &gt; 0: print("private message") else: print("group message") print(" --- ") def get_user_name(self, user_id): """   """ return self.vk_api.users.get(user_id=user_id)[0]['first_name'] def get_user_city(self, user_id): """   """ return self.vk_api.users.get(user_id=user_id, fields="city")[0]["city"]['title']</span></span></code> </pre> <br><br> æˆ‘ä»¬å°†å‘æœºå™¨äººå‘é€ä¸¤æ¡æ¶ˆæ¯ï¼šä¸€ç»„æ¶ˆæ¯ï¼Œä¸€ç»„æ¶ˆæ¯åœ¨PMä¸­ã€‚ ç„¶åæˆ‘ä»¬å¾—åˆ°ï¼š <br><blockquote> ç”¨æˆ·åï¼šArthur <br> æ¥è‡ªï¼šåœ£å½¼å¾—å ¡ <br> æ–‡å­—ï¼š[club172998024 | @ club172998024]è¿™æ˜¯æ¥è‡ªç¾¤ç»„çš„æ¶ˆæ¯ <br> ç±»å‹ï¼šç¾¤ç»„è®¯æ¯ <br>  -- <br> ç”¨æˆ·åï¼šArthur <br> æ¥è‡ªï¼šåœ£å½¼å¾—å ¡ <br> æ–‡å­—ï¼šè¿™æ˜¯ç§äººè®¯æ¯ <br> ç±»å‹ï¼šç§äººç•™è¨€ <br>  -- </blockquote><br><blockquote><h4> æ³¨æ„äº‹é¡¹ </h4><br> æ­£å¦‚æ‚¨åœ¨ç»„ä¸­çš„æ¶ˆæ¯ä¹‹å‰çœ‹åˆ°çš„é‚£æ ·ï¼Œæœ‰[club172998024 | @ club172998024]ï¼Œä¸ºäº†ä½¿å›¢é˜Ÿèƒ½å¤Ÿæ­£ç¡®å¤„ç†ï¼Œæ‚¨åº”è¯¥åˆ é™¤æ–¹æ‹¬å·ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œæˆ–è€…è®©æ¼«æ¸¸å™¨è®¿é—®æ‰€æœ‰å¯¹åº”å…³ç³» </blockquote><br> å¦‚æˆ‘ä»¬æ‰€è§ï¼Œvk_apiå…è®¸æˆ‘ä»¬è½»æ¾ä½¿ç”¨VK APIæ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨äº†<i>users.get</i>æ–¹æ³• <br><br> æœ‰å…³æ‰€æœ‰æ–¹æ³•çš„åˆ—è¡¨ï¼Œè¯·è®¿é—®ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">vk.com/dev/methods</a> <br><br> æˆ‘å»ºè®®æ‚¨ç ”ç©¶å’Œå°è¯•æ‚¨æ„Ÿå…´è¶£çš„æ–¹æ³•ã€‚ å¹¸è¿çš„æ˜¯ï¼ŒVKè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¥½çš„ä¿„è¯­æ–‡æ¡£ã€‚ <br><br> ä¸ºäº†å·©å›ºææ–™ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥é€šè¿‡<i>messages.send</i>æ–¹æ³•å‘é€æ¶ˆæ¯ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, peer_id, message)</span></span></span><span class="hljs-function">:</span></span> self.vk_api.messages.send(peer_id=peer_id, message=message)</code> </pre> <br>  &lt;peer_id&gt;æ˜¯ç›®çš„åœ°æ ‡è¯†ç¬¦ã€‚ è¦å›å¤æŸäººçš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬å°†<i>event.object.peer_id</i>æŒ‡å®šä¸ºå‚æ•°<i>peer_id</i> ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¼šå°†æ¶ˆæ¯å‘é€åˆ°è¯·æ±‚çš„æ¥æºã€‚ <br><br> æ›´æ”¹å¯åŠ¨æ–¹æ³•ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.long_poll.listen(): <span class="hljs-comment"><span class="hljs-comment">#   #    if event.type == VkBotEventType.MESSAGE_NEW: username = self.get_user_name(event.object.from_id) print("Username: " + username) print("From: " + self.get_user_city(event.object.from_id)) print("Text: " + event.object.text) print("Type: ", end="") if event.object.id &gt; 0: print("private message") else: print("group message") print(" --- ") self.send_message(event.object.peer_id, f"{username},    !")</span></span></code> </pre> <br> ç°åœ¨ï¼Œå¦‚æœæ¼«æ¸¸å™¨æ”¶åˆ°äº†æ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒå°†ä»¥è¿™ç§æ–¹å¼å›å¤æˆ‘ä»¬ï¼š <br><blockquote> äºšç‘Ÿï¼Œæˆ‘æ˜ç™½äº†ï¼ </blockquote><br><div class="spoiler">  <b class="spoiler_title">æ•´ä¸ªä»£ç </b> <div class="spoiler_text"><h4>  server.py </h4><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api.vk_api <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vk_api.bot_longpoll <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VkBotLongPoll <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vk_api.bot_longpoll <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VkBotEventType <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Server</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, api_token, group_id, server_name: str=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Empty"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    self.server_name = server_name #  Long Poll self.vk = vk_api.VkApi(token=api_token) #   Long Poll API self.long_poll = VkBotLongPoll(self.vk, group_id, wait=20) #    vk_api self.vk_api = self.vk.get_api() def send_msg(self, send_id, message): """     messages.send :param send_id: vk id ,    :param message:    :return: None """ self.vk_api.messages.send(peer_id=send_id, message=message) def test(self): self.send_msg(255396611, "-!") def start(self): for event in self.long_poll.listen(): #   #    if event.type == VkBotEventType.MESSAGE_NEW: username = self.get_user_name(event.object.from_id) print("Username: " + username) print("From: " + self.get_user_city(event.object.from_id)) print("Text: " + event.object.text) print("Type: ", end="") if event.object.id &gt; 0: print("private message") else: print("group message") print(" --- ") self.send_message(event.object.peer_id, f"{username},    !") def get_user_name(self, user_id): """   """ return self.vk_api.users.get(user_id=user_id)[0]['first_name'] def get_user_city(self, user_id): """   """ return self.vk_api.users.get(user_id=user_id, fields="city")[0]["city"]['title'] def send_message(self, peer_id, message): self.vk_api.messages.send(peer_id=peer_id, message=message)</span></span></code> </pre><br><h4>  server_manager.py </h4><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     Server from server import Server #   config.py  api-token from config import vk_api_token server1 = Server(vk_api_token, 172998024, "server1") server1.start()</span></span></code> </pre> <br></div></div><br><h4> å›ºå®šææ–™çš„ä»»åŠ¡ï¼š </h4><br> åˆ›å»ºä¸€ä¸ªä½¿ç”¨peer_idå‚æ•°å¹¶å‘ç”¨æˆ·å‘é€ä¸Šä¼ åˆ°ç¤¾åŒºçš„ç…§ç‰‡çš„å‡½æ•°ã€‚ æœ‰ç”¨çš„Dockï¼š <a href="">vk.com/dev/messages.send</a> <br><br><div class="spoiler">  <b class="spoiler_title">è§£å†³æ–¹æ¡ˆ</b> <div class="spoiler_text"> é¦–å…ˆï¼Œå°†ç…§ç‰‡ä¸Šä¼ åˆ°ç¾¤ç»„å¹¶åœ¨VKä¸­æ‰“å¼€ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹é“¾æ¥ï¼š <br><blockquote>  <s><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">vkcom / club172998024ï¼Ÿz =</a></s> <i><b>photo-172998024_456239017</b></i> <s>ï¼…2Falbum-172998024_256250731</s> </blockquote><br> æˆ‘ä»¬åªå¯¹çªå‡ºæ˜¾ç¤ºçš„éƒ¨åˆ†æ„Ÿå…´è¶£ï¼š <i>photo-172998024_456239017</i> ã€‚ å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™messages.sendæ–¹æ³•ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_img</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, peer_id)</span></span></span><span class="hljs-function">:</span></span> self.vk_api.messages.send(peer_id=peer_id, attachment=<span class="hljs-string"><span class="hljs-string">"photo-172998024_456239017"</span></span>)</code> </pre> <br> å°†å…¶æ·»åŠ åˆ°startæ–¹æ³•å¹¶è·å¾—ï¼š <br><br><img src="https://habrastorage.org/webt/ud/3z/5k/ud3z5kllt4pylfvkslo7nmuxnnw.png"><br></div></div><br> è¿™å°±æ˜¯æ‰€æœ‰çš„åŸºæœ¬çŸ¥è¯†ã€‚ æœ€ä¸»è¦çš„æ˜¯è¦å­¦ä¹ å¦‚ä½•ä½¿ç”¨å„ç§æ–¹æ³•æ¥ä½¿ç”¨vk_apiï¼Œå®ƒä»¬çš„æ•´ä¸ªåˆ—è¡¨æ˜¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">vk.com/dev/methods</a> ã€‚ å¦‚æœæ‚¨å­¦ä¹ å¦‚ä½•ä½¿ç”¨VK APIæ–‡æ¡£ï¼Œåˆ™å¯ä»¥åˆ›å»ºå„ç§å¤æ‚æ€§å’Œç”¨é€”çš„æœºå™¨äººã€‚ æˆ‘çš„æœºå™¨äººç”¨äºç ”ç©¶ç»„çš„ç¤ºä¾‹ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/AppLoidx/GroupAssistant/tree/master</a> <br><br><h3> ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹åˆ›å»ºæœºå™¨äººé€»è¾‘ã€‚ </h3><br> åˆ›å»ºcommander.pyï¼Œå®ƒå°†æ¥å—å‘½ä»¤å¹¶è¿”å›ä¼ é€’ç»™Vkç”¨æˆ·çš„å“åº”ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Commander</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, vk_api, user_id)</span></span></span><span class="hljs-function">:</span></span> self.vk_api = vk_api self.user_id = user_id <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">input</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, msg)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     :param msg:  :return:  ,   """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre><br><h4> è®©æˆ‘ä»¬æ„å»ºç¨‹åºçš„ä½“ç³»ç»“æ„ï¼š </h4><br> æˆ‘ä»¬â€œç›‘å¬â€é•¿è½®è¯¢æœåŠ¡å™¨å¹¶æ”¶åˆ°ç”¨æˆ·æ¶ˆæ¯-&gt; <br> æˆ‘ä»¬å°†æ¶ˆæ¯ä¼ é€’ç»™Commander.inputï¼ˆï¼‰-&gt;å®šä¹‰æ¨¡å¼-&gt;å®šä¹‰å‘½ä»¤-&gt; <br> æˆ‘ä»¬è¿”å›ç­”æ¡ˆ-&gt;æˆ‘ä»¬è½¬ç§»ç»™ç”¨æˆ· <br><br> ä¸ºäº†å®šä¹‰æ¨¡å¼å’Œå‘½ä»¤ï¼Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶command_enum.pyå’Œmode_enum.pyã€‚ ä½¿ç”¨å®ƒä»¬ï¼Œæˆ‘ä»¬å°†é€šè¿‡Enumç±»çš„æ–¹æ³•å®šä¹‰æ¨¡å¼å’Œå‘½ä»¤ï¼š <br><br><h4>  command_enum.pyï¼š </h4><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> enum <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Enum <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Enum)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">""" weather """</span></span> weather = [<span class="hljs-string"><span class="hljs-string">"weather"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>] <span class="hljs-string"><span class="hljs-string">""" myanimelist """</span></span> anime_top = [<span class="hljs-string"><span class="hljs-string">"top anime"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>]</code> </pre> <br><br><h4>  mode_enum.pyï¼š </h4><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> enum <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Enum <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mode</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Enum)</span></span></span><span class="hljs-class">:</span></span> default = [<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"default"</span></span>] translate = [<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"translate"</span></span>] get_ans = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><br> è¦æ›´æ”¹æ¨¡å¼ï¼Œè¯·ä½¿ç”¨[æ–œæ ï¼ˆâ€œ /â€ï¼‰+ &lt;mode_name&gt;]ï¼Œæˆ‘ä»¬å°†æ¥å—æ‰€æœ‰å…¶ä»–å‘½ä»¤ä½œä¸ºå‘½ä»¤ã€‚ <br><br> æˆ‘ä»¬åœ¨Commander.pyä¸­å®ç°ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  ,  from command_enum import Command from mode_enum import Mode #   from translate.yandex_translate import Translator from weather import Weather from myanimelist import Myanimelist # Config from config import yandex_translate_api class Commander: def __init__(self): # ,   self.now_mode = Mode.default self.last_mode = Mode.default self.last_command = None #     self.last_ans = None #    self.translator = Translator(yandex_translate_api) def change_mode(self, to_mode): """     :param to_mode:   """ self.last_mode = self.now_mode self.now_mode = to_mode self.last_ans = None def input(self, msg): """     :param msg:  :return:  ,   """ #      if msg.startswith("/"): for mode in Mode: if msg[1::] in mode.value: self.change_mode(mode) return "   " + self.now_mode.value[0] return "  " + msg[1::] #    if self.now_mode == Mode.get_ans: self.last_ans = msg self.now_mode = self.last_mode return "Ok!" if self.now_mode == Mode.default: #  if msg in Command.weather.value: return Weather.get_weather_today() #   if msg in Command.anime_top.value: res = "" top = Myanimelist.get_top() for anime in top: res += anime + " : " + top[anime] + "\n" return res if self.now_mode == Mode.translate: if self.last_ans is None: #    ,    self.change_mode(Mode.get_ans) self.last_command = msg return "     " elif self.last_ans == "change": #    self.last_ans = None self.change_mode(Mode.default) else: #  return self.translator.translate_to(msg, self.last_ans) return "  !"</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">weather.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bs4 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BeautifulSoup <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Weather</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_weather_today</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(city: str = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"-"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> -&gt; list:</span></span> http = <span class="hljs-string"><span class="hljs-string">"https://sinoptik.com.ru/-"</span></span> + city b = BeautifulSoup(requests.get(http).text, <span class="hljs-string"><span class="hljs-string">"html.parser"</span></span>) p3 = b.select(<span class="hljs-string"><span class="hljs-string">'.temperature .p3'</span></span>) weather1 = p3[<span class="hljs-number"><span class="hljs-number">0</span></span>].getText() p4 = b.select(<span class="hljs-string"><span class="hljs-string">'.temperature .p4'</span></span>) weather2 = p4[<span class="hljs-number"><span class="hljs-number">0</span></span>].getText() p5 = b.select(<span class="hljs-string"><span class="hljs-string">'.temperature .p5'</span></span>) weather3 = p5[<span class="hljs-number"><span class="hljs-number">0</span></span>].getText() p6 = b.select(<span class="hljs-string"><span class="hljs-string">'.temperature .p6'</span></span>) weather4 = p6[<span class="hljs-number"><span class="hljs-number">0</span></span>].getText() result = <span class="hljs-string"><span class="hljs-string">''</span></span> result = result + (<span class="hljs-string"><span class="hljs-string">' :'</span></span> + weather1 + <span class="hljs-string"><span class="hljs-string">' '</span></span> + weather2) + <span class="hljs-string"><span class="hljs-string">'\n'</span></span> result = result + (<span class="hljs-string"><span class="hljs-string">' :'</span></span> + weather3 + <span class="hljs-string"><span class="hljs-string">' '</span></span> + weather4) + <span class="hljs-string"><span class="hljs-string">'\n'</span></span> temp = b.select(<span class="hljs-string"><span class="hljs-string">'.rSide .description'</span></span>) weather = temp[<span class="hljs-number"><span class="hljs-number">0</span></span>].getText() result = result + weather.strip() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">myanimelist.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> bs4 <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Myanimelist</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_top</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(count: int=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">, by: str=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> -&gt; dict:</span></span> types = [<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"airing"</span></span>, <span class="hljs-string"><span class="hljs-string">"upcoming"</span></span>, <span class="hljs-string"><span class="hljs-string">"tv"</span></span>, <span class="hljs-string"><span class="hljs-string">"movie"</span></span>, <span class="hljs-string"><span class="hljs-string">"ova"</span></span>, <span class="hljs-string"><span class="hljs-string">"special"</span></span>, <span class="hljs-string"><span class="hljs-string">"bypopularity"</span></span>, <span class="hljs-string"><span class="hljs-string">"favorite"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> by <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-string"><span class="hljs-string">"error: "</span></span>: <span class="hljs-string"><span class="hljs-string">" !"</span></span>} html = requests.get(<span class="hljs-string"><span class="hljs-string">"https://myanimelist.net/topanime.php?type="</span></span>+by) soup = bs4.BeautifulSoup(html.text, <span class="hljs-string"><span class="hljs-string">"html.parser"</span></span>) res = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> anime <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> soup.select(<span class="hljs-string"><span class="hljs-string">".ranking-list"</span></span>, limit=count): url = anime.select(<span class="hljs-string"><span class="hljs-string">".hoverinfo_trigger"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'href'</span></span>] anime = anime.select(<span class="hljs-string"><span class="hljs-string">".hoverinfo_trigger"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].findAll(<span class="hljs-string"><span class="hljs-string">"img"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] name = anime[<span class="hljs-string"><span class="hljs-string">'alt'</span></span>].split(<span class="hljs-string"><span class="hljs-string">":"</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].strip(<span class="hljs-string"><span class="hljs-string">" "</span></span>) res[name] = url <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">yandex_translate.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> config <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> yandex_translate_api <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Translator</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">""" -  API Yandex Translate : _key --   API Yandex.Translate _yandex_comment --       API Yandex.Translate """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, key, comment=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" :param key:   API Yandex.Translate :param comment:     """</span></span> self._key = key <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> comment <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self._yandex_comment = <span class="hljs-string"><span class="hljs-string">"\n  Â«.Â» http://translate.yandex.ru/"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self._yandex_comment = comment <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text, lang, to_lang=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""         :param text: ,    :param lang:   :param to_lang:   :return:   """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> to_lang <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: lang = <span class="hljs-string"><span class="hljs-string">f"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{lang}</span></span></span><span class="hljs-string">-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{to_lang}</span></span></span><span class="hljs-string">"</span></span> main_url = <span class="hljs-string"><span class="hljs-string">"https://translate.yandex.net/api/v1.5/tr.json/translate"</span></span> response = requests.get(<span class="hljs-string"><span class="hljs-string">f"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{main_url}</span></span></span><span class="hljs-string">?"</span></span> <span class="hljs-string"><span class="hljs-string">f"key=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{self._key}</span></span></span><span class="hljs-string">&amp;"</span></span> <span class="hljs-string"><span class="hljs-string">f"lang=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{lang}</span></span></span><span class="hljs-string">&amp;"</span></span> <span class="hljs-string"><span class="hljs-string">f"text=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{text}</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response.json()[<span class="hljs-string"><span class="hljs-string">'text'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] + self._yandex_comment <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lang_identify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text, hint=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"ru,en"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   :param text:  :param hint:     :return:   """</span></span> main_url = <span class="hljs-string"><span class="hljs-string">"https://translate.yandex.net/api/v1.5/tr.json/detect"</span></span> response = requests.get(<span class="hljs-string"><span class="hljs-string">f"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{main_url}</span></span></span><span class="hljs-string">?"</span></span> <span class="hljs-string"><span class="hljs-string">f"key=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{self._key}</span></span></span><span class="hljs-string">&amp;"</span></span> <span class="hljs-string"><span class="hljs-string">f"hint=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{hint}</span></span></span><span class="hljs-string">&amp;"</span></span> <span class="hljs-string"><span class="hljs-string">f"text=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{text}</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response.json()[<span class="hljs-string"><span class="hljs-string">'lang'</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate_ru_en</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""       :param text: ,    :return:      """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.lang_identify(text) == <span class="hljs-string"><span class="hljs-string">"ru"</span></span>: to_lang = <span class="hljs-string"><span class="hljs-string">"en"</span></span> from_lang = <span class="hljs-string"><span class="hljs-string">"ru"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: to_lang = <span class="hljs-string"><span class="hljs-string">"ru"</span></span> from_lang = <span class="hljs-string"><span class="hljs-string">"en"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.translate(text, from_lang, to_lang) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate_to_ru</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text, hint=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     :param text: ,    :param hint:     :return:      """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hint <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: hint = <span class="hljs-string"><span class="hljs-string">"ru,en"</span></span> from_lang = self.lang_identify(text, hint) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.translate(text, from_lang, <span class="hljs-string"><span class="hljs-string">"ru"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text, to_lang, hint=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      :param text: ,    :param to_lang:    :param hint:     :return:   """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hint <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: hint = <span class="hljs-string"><span class="hljs-string">"ru,en"</span></span> from_lang = self.lang_identify(text, hint) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.translate(text, from_lang, to_lang)</code> </pre><br></div></div><br> æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨githubä¸Šæ‰¾åˆ°ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/AppLoidx/VkLongPollBot</a> <br><br><h4> æ·»åŠ é”®ç›˜ï¼š </h4><br> è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„è¿‡ç¨‹ï¼Œå½“æˆ‘ä»¬å°†é”®ç›˜æ›´æ”¹ä¸ºç‰¹å®šçš„å‘½ä»¤ç­¾åæ—¶ï¼ˆå¯èƒ½å› æ¯ç§æ¨¡å¼è€Œä¸åŒï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤æ‚åŒ–ã€‚ <br><br> è¦å°†é”®ç›˜æ·»åŠ åˆ°å¯¹è¯æ¡†ä¸­ï¼Œå¿…é¡»åœ¨messages.sendæ–¹æ³•ä¸­æŒ‡å®šæ¥å—jsonçš„é”®ç›˜å‚æ•°ã€‚ çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="python hljs">vk_api.messages.send(...,keyboard=keyboard_json,...)</code> </pre> <br> æˆ–è€…ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä».jsonæ–‡ä»¶ä¼ é€’é”®ç›˜ï¼š <br><br><pre> <code class="python hljs">vk_api.messages.send(...,keyboard=open(filename,<span class="hljs-string"><span class="hljs-string">"r"</span></span>,encoding=<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>).read()</code> </pre> <br> æ–‡æ¡£ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">vk.com/dev/bots_docs_3?f=4.%2BKeyboard%2Bfor%2Bworks</a> <br><br> é€šè¿‡æ·»åŠ é”®ç›˜æ¥è€ƒè™‘æˆ‘ä»¬ç¨‹åºçš„ç¤ºä¾‹ã€‚ <br><br> é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªkeyboard.jsonæ–‡ä»¶ï¼š <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"one_time"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"buttons"</span></span>: [ [{ <span class="hljs-attr"><span class="hljs-attr">"action"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"text"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"top anime"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"color"</span></span>: <span class="hljs-string"><span class="hljs-string">"positive"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"action"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"text"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"weather"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"color"</span></span>: <span class="hljs-string"><span class="hljs-string">"positive"</span></span> }], [{ <span class="hljs-attr"><span class="hljs-attr">"action"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"text"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"translate"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"color"</span></span>: <span class="hljs-string"><span class="hljs-string">"default"</span></span> }] ] }</code> </pre> <br> è¦åˆ é™¤é”®ç›˜ï¼Œæ‚¨éœ€è¦ä¼ é€’å¸¦æœ‰ç©ºæŒ‰é’®çš„jsonï¼š <br><br><pre> <code class="hljs json">{<span class="hljs-attr"><span class="hljs-attr">"buttons"</span></span>:[],<span class="hljs-attr"><span class="hljs-attr">"one_time"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>}</code> </pre> <br> è¦†ç›–server.pyä¸­çš„send_messageï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_msg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, send_id, message)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     messages.send :param send_id: vk id ,    :param message:    :return: None """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.vk_api.messages.send(peer_id=send_id, message=message, keyboard=open(<span class="hljs-string"><span class="hljs-string">"keyboards/default.json"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>, encoding=<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>).read())</code> </pre> <br> å¹¶ä¸”åœ¨å¯åŠ¨æ–¹æ³•ä¸­ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.long_poll.listen(): <span class="hljs-comment"><span class="hljs-comment">#   if event.type == VkBotEventType.MESSAGE_NEW: if event.object.from_id not in self.users: self.users[event.object.from_id] = Commander() #    if event.type == VkBotEventType.MESSAGE_NEW: self.send_msg(event.object.peer_id, self.users[event.object.from_id].input(event.object.text))</span></span></code> </pre> <br> ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š <br><br><img src="https://habrastorage.org/webt/ak/ij/v0/akijv0pbveyvhsjf-q_d426pqya.png"><br><br><h3> æœ€åä¸€å¥è¯ </h3><br> æ‚¨ä¸åº”ä½¿ç”¨æ­¤å¤„åˆ—å‡ºçš„æºä»£ç çš„<u>è£¸éœ²</u>æ¸…å•ï¼Œå®ƒä»¬ä»…ç”¨äºä½¿æ‚¨æ›´å¥½åœ°äº†è§£å¹•åå‘ç”Ÿçš„äº‹æƒ…ã€‚ å½“ç„¶ï¼Œå®ƒä»¬éƒ½æ˜¯å¯ç”¨çš„ï¼Œæ‚¨å¯ä»¥åˆ†æ‰¹ä½¿ç”¨å®ƒä»¬ã€‚ <br><br> å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘ä½¿ç”¨è¿™æ ·çš„æœºå™¨äººæ¥æ‹…ä»»å°ç»„åŠ©ç†ï¼Œä»–çŸ¥é“å¦‚ä½•ï¼š <br><br><ul><li> ä»å°ç»„æˆå‘˜åˆ›å»ºé˜Ÿåˆ—ï¼ŒåŒ…æ‹¬è®¸å¤šç¼–è¾‘é˜Ÿåˆ—çš„å›¢é˜Ÿï¼Œä¾‹å¦‚æ·»åŠ ï¼Œåˆ é™¤ï¼Œåˆ›å»ºç­‰ã€‚ </li><li> å‘æ‰€æœ‰å‚ä¸è€…å‘é€æ¶ˆæ¯ </li><li> é—®çš„é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œåœ¨Javaä¸­ï¼‰ </li><li> ä½¿åˆ›å»ºç”¨äºäº¤æ¢ä½ç½®ç­‰çš„åº”ç”¨ç¨‹åºæˆä¸ºå¯èƒ½ã€‚ </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Githubé¡¹ç›®</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„æ˜¾ç¤ºçš„èµ„æº</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN428680/">https://habr.com/ru/post/zh-CN428680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN428666/index.html">æˆ‘å¦‚ä½•ä½¿ç”¨CSSè’™ç‰ˆåˆ›å»ºæ”¹å˜å¿ƒæƒ…çš„åŠ¨ç”»</a></li>
<li><a href="../zh-CN428668/index.html">æš´é›ªå®£å¸ƒå°†äº2019å¹´å‘å¸ƒã€Šé­”å…½äº‰éœ¸IIIã€‹çš„é‡æ–°å‘è¡Œã€‚ å…¬å¼€é¢„è®¢</a></li>
<li><a href="../zh-CN428672/index.html">QuietOnä¸»åŠ¨é™å™ªæ¦‚è¿°</a></li>
<li><a href="../zh-CN428674/index.html">åœ¨Profi.ruä¸Šæ„å»ºå®¢æˆ·ç«¯è·¯ç”±/è¯­ä¹‰æœç´¢</a></li>
<li><a href="../zh-CN428676/index.html">æ‰“ç ´Cï¼ƒçš„åŸºç¡€ï¼šåœ¨å †æ ˆä¸Šä¸ºå¼•ç”¨ç±»å‹åˆ†é…å†…å­˜</a></li>
<li><a href="../zh-CN428682/index.html">è‡ªæ¯Betaè¾å°„76</a></li>
<li><a href="../zh-CN428688/index.html">åœ¨Dockerä¸­ä¸ºyii-frameworkåº”ç”¨ç¨‹åºè®¾ç½®å·¥ä½œç¯å¢ƒ</a></li>
<li><a href="../zh-CN428690/index.html">å¦‚æœæ‚¨ä¸æ˜¯è€å¸ˆï¼Œä½†å¥¹ç›¸ä¿¡æ‚¨ï¼Œé‚£ä¹ˆå¦‚ä½•æ•™æ‚¨çš„å¥³å‹å¦‚ä½•ç¼–ç¨‹</a></li>
<li><a href="../zh-CN428694/index.html">å§‹äº20å¹´å‰çš„å•ä¸€æ¸¸æˆæˆ–4xç­–ç•¥çš„æ•…äº‹è‡³ä»Šä»åœ¨å‘ç”Ÿ</a></li>
<li><a href="../zh-CN428696/index.html">ç”µæŠ¥é¢‘é“è¯„è®º</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>