<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤶🏼 🤹🏾 🧟 Une introduction pratique au gestionnaire de paquets pour Kubernetes - Helm 🍉 🎅🏽 👨🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est la suite logique de notre récente publication sur l'histoire du gestionnaire de paquets pour Kubernetes - Helm . Cette fois, nous abor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une introduction pratique au gestionnaire de paquets pour Kubernetes - Helm</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/420437/"><img src="https://habrastorage.org/webt/ff/1x/js/ff1xjsnvdlnfinirlwb-0p42tlo.png"><br><br>  Cet article est la suite logique de notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">récente publication</a> sur l'histoire du gestionnaire de paquets pour Kubernetes - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Helm</b></a> .  Cette fois, nous aborderons à nouveau les problèmes de l'appareil et du fonctionnement de la <b>version</b> actuelle de Helm ( <b>version 2.x</b> ), ainsi que ses graphiques et référentiels gérés, après quoi nous passerons à la pratique d'installation de Helm dans le cluster Kubernetes et d'utilisation des graphiques. <a name="habracut"></a><br><br><h2>  Entrée </h2><br>  <b>Helm est un outil de gestion des graphiques.</b> <br><br>  <b>Le graphique</b> décrit l'ensemble de données nécessaire pour instancier l'application dans le cluster Kubernetes.  Il peut avoir des graphiques intégrés et peut être utilisé à la fois pour décrire des services à part entière, composés de nombreuses ressources dépendantes, et pour décrire des composants indépendants individuels.  Par exemple, le graphique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stable / gitlab-ce</a> décrit une solution complète <a href="">utilisant les</a> graphiques redis et postgresql indépendants. <br><br>  Un graphique peut être défini un nombre illimité de fois dans le même cluster.  Ainsi, la description de la logique de déploiement de l'application dans différents environnements peut et doit être stockée sur le même graphique. <br><br>  Le côté client de Helm est responsable de la création du graphique et du transfert du composant <b>Tiller</b> vers le cluster Kubernetes avec les paramètres utilisateur.  À son tour, Tiller est responsable du cycle de vie de l'instance du graphique lancé, version.  <i>(Juste au cas où, laissez-moi vous rappeler que la prochaine mise à jour majeure de Helm - version 3 - n'aura plus Tiller.)</i> <br><br>  Et maintenant - tout d'abord. <br><br><h2>  Installation et mise à niveau </h2><br>  Helm nécessite que Kubernetes fonctionne.  Vous pouvez utiliser un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Minikube</a> installé localement <i>(voir également « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mise en route dans Kubernetes avec Minikube</a> »)</i> ou tout autre cluster disponible. <br><br>  Commençons par installer le client: sélectionnez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">version</a> , téléchargez et décompressez l'archive de votre système, transférez le fichier exécutable ... <br><br><pre><code class="bash hljs">$ curl https://storage.googleapis.com/kubernetes-helm/helm-v2.10.0-linux-amd64.tar.gz | tar -zxv $ sudo mv linux-amd64/helm /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/helm</code> </pre> <br>  Ensuite, installez Tiller dans le cluster.  Par défaut, Tiller est installé dans le <b><code>kubectl</code> contexte <code>kubectl</code></b> ( <code>kubectl config current-context</code> ), dans l' <b>espace de noms <code>kube-system</code></b> , mais cela peut être modifié à l'aide des options et variables d'environnement appropriées - elles sont décrites dans l'aide ( <code>helm init --help</code> ).  Terminons l'installation et examinons les ressources créées dans le cluster: <br><br><pre> <code class="bash hljs">$ helm init <span class="hljs-variable"><span class="hljs-variable">$HELM_HOME</span></span> has been configured at /home/habr/.helm. (Use --client-only to suppress this message, or --upgrade to upgrade Tiller to the current version.) Happy Helming! $ kubectl get all --selector=name=tiller --namespace kube-system NAME READY STATUS RESTARTS AGE po/tiller-deploy-df4fdf55d-h5mvh 0/1 Running 0 5s NAME CLUSTER-IP EXTERNAL-IP PORT(S) AGE svc/tiller-deploy 10.107.191.68 &lt;none&gt; 44134/TCP 5s NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE deploy/tiller-deploy 1 1 1 0 5s NAME DESIRED CURRENT READY AGE rs/tiller-deploy-df4fdf55d 1 1 0 5s</code> </pre><br>  Maintenant, Tiller est installé dans le cluster et est prêt pour la gestion des versions, l'interaction avec l'API Kubernetes. <br><br>  <i><b>Remarque</b> : Pendant l'installation et la mise à niveau (option <code>--upgrade</code> ) de Tiller, vous pouvez <b>spécifier une image spécifique</b> au lieu d'utiliser la dernière version stable par défaut.</i>  <i>Le nom d'une image arbitraire est déterminé par l'option <code>--tiller-image</code> , et avec l'option <code>--canary-image</code> , une <code>--canary-image</code> sera utilisée lors du déploiement de Tiller.</i>  <i>L'image canari vous permet d'utiliser Tiller, dont la version de code correspond à la branche maître.</i> <br><br>  Les données de service sont stockées dans un cluster dans des ressources spéciales, <code>ConfigMaps</code> , donc la désinstallation et la réinstallation de Tiller n'entraîne pas la perte de données des versions précédemment installées. <br><br><h2>  Référentiels de graphiques </h2><br>  Chart Repository - Un serveur HTTP pour stocker et distribuer des graphiques.  Les informations sur les graphiques dans le référentiel sont stockées dans le fichier <code>index.yaml</code> .  Il indique également d'où chaque graphique peut être chargé.  Le plus souvent, les graphiques sont stockés avec le fichier <code>index.yaml</code> , mais rien ne les empêche d'être placés sur un autre serveur.  Habituellement, la structure du fichier se résume à une forme plate: <br><br><pre> <code class="bash hljs">. ├── index.yaml ├── artifactory-7.3.0.tgz ├── docker-registry-1.5.2.tgz ... └── wordpress-2.1.10.tgz</code> </pre><br>  Par défaut, Helm utilise le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référentiel de graphiques Kubernetes officiel</a> .  Il contient des graphiques actuels soigneusement conçus pour résoudre de nombreux problèmes appliqués.  Ce référentiel est appelé <b>stable</b> : <br><br><pre> <code class="bash hljs">$ helm repo list NAME URL stable https://kubernetes-charts.storage.googleapis.com</code> </pre><br>  Si nécessaire, la <b>création de</b> votre propre référentiel ne posera aucun problème.  Les exigences du serveur sont minimales, donc, comme la plupart des référentiels de graphiques publics, il peut être hébergé sur des pages GitHub.  Vous pouvez en savoir plus sur les outils et les étapes nécessaires à cet effet dans la <a href="">documentation</a> . <br><br>  Lorsque vous utilisez des référentiels de graphiques, ils peuvent être ajoutés et supprimés.  Afin de maintenir les versions des graphiques à jour, vous devez mettre à jour périodiquement l'index.  Je vais donner un exemple pour le dépôt public <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bitnami</a> , dont la plupart des graphiques sont utilisés dans le dépôt officiel Helm: <br><br><pre> <code class="bash hljs">$ helm repo add bitnami https://charts.bitnami.com/bitnami <span class="hljs-string"><span class="hljs-string">"bitnami"</span></span> has been added to your repositories $ helm repo update Hang tight <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> we grab the latest from your chart repositories... ...Successfully got an update from the <span class="hljs-string"><span class="hljs-string">"bitnami"</span></span> chart repository ...Successfully got an update from the <span class="hljs-string"><span class="hljs-string">"stable"</span></span> chart repository Update Complete. Happy Helming! $ helm repo remove bitnami <span class="hljs-string"><span class="hljs-string">"bitnami"</span></span> has been removed from your repositories</code> </pre><br>  Suivant - <b>recherchez</b> dans les référentiels.  Un appel de <code>helm search</code> sans arguments affiche tous les graphiques disponibles: <br><br><pre> <code class="bash hljs">$ helm search NAME CHART VERSION APP VERSION DESCRIPTION stable/acs-engine-autoscaler 2.2.0 2.1.1 Scales worker nodes within agent pools stable/aerospike 0.1.7 v3.14.1.2 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Aerospike <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Kubernetes stable/anchore-engine 0.2.1 0.2.4 Anchore container analysis and policy evaluation engine s... stable/apm-server 0.1.0 6.2.4 The server receives data from the Elastic APM agents and ... stable/ark 1.2.1 0.9.1 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ark stable/artifactory 7.3.0 6.1.0 Universal Repository Manager supporting all major packagi... ... stable/weave-cloud 0.2.2 0.2.0 Weave Cloud is a add-on to Kubernetes <span class="hljs-built_in"><span class="hljs-built_in">which</span></span> provides Cont... stable/weave-scope 0.9.3 1.6.5 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the Weave Scope cluster visualizer. stable/wordpress 2.1.10 4.9.8 Web publishing platform <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> building blogs and websites. stable/xray 0.4.1 2.3.0 Universal component scan <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> security and license invento... stable/zeppelin 1.0.1 0.7.2 Web-based notebook that enables data-driven, interactive ... stable/zetcd 0.1.9 0.0.3 CoreOS zetcd Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Kubernetes</code> </pre><br>  Dans le champ de <code>keywords</code> facultatif de <code>Chart.yaml</code> développeurs spécifient les balises utilisées pour simplifier la recherche dans les référentiels de graphiques: <br><br><pre> <code class="bash hljs">$ helm search web NAME CHART VERSION APP VERSION DESCRIPTION stable/cerebro 0.3.1 0.8.1 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Cerebro - a web admin tool that replaces... stable/chronograf 0.4.5 1.3 Open-source web application written <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Go and React.js th... stable/jasperreports 2.0.4 7.1.0 The JasperReports server can be used as a stand-alone or ... stable/joomla 2.0.9 3.8.12 PHP content management system (CMS) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> publishing web co... stable/kubernetes-dashboard 0.7.2 1.8.3 General-purpose web UI <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Kubernetes clusters stable/odoo 2.0.7 11.0.20180815 A suite of web based open <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> business apps. stable/phabricator 2.1.9 2018.34.0 Collection of open <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> web applications that <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> soft... stable/redmine 4.1.0 3.4.6 A flexible project management web application. stable/rethinkdb 0.1.4 0.1.0 The open-source database <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the realtime web stable/schema-registry-ui 0.1.0 v0.9.4 This is a web tool <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the confluentinc/schema-registry i... stable/superset 0.1.2 0.24.0 Apache Superset (incubating) is a modern, enterprise-read... stable/testlink 2.0.3 1.9.17 Web-based <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> management system that facilitates softwar... stable/tomcat 0.1.0 7 Deploy a basic tomcat application server with sidecar as ... stable/wordpress 2.1.10 4.9.8 Web publishing platform <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> building blogs and websites. ... $ helm search cms blog NAME CHART VERSION APP VERSION DESCRIPTION stable/drupal 1.1.3 8.5.6 One of the most versatile open <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> content management ... stable/joomla 2.0.9 3.8.12 PHP content management system (CMS) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> publishing web co... stable/wordpress 2.1.10 4.9.8 Web publishing platform <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> building blogs and websites</code> </pre> <br>  <i><b>Remarque:</b> Lorsque vous utilisez la <code>helm search</code> , vous pouvez rencontrer un fonctionnement instable de plusieurs filtres: la disponibilité du résultat dépend de l'ordre d'indication et du nombre de filtres.</i> <br><br>  Une fois le cercle de recherche restreint à plusieurs options, vous pouvez procéder à une analyse plus détaillée des graphiques - à l'aide de la <code>helm inspect</code> .  Il affiche le contenu des fichiers graphiques <code>Chart.yaml</code> , <code>values.yaml</code> et <code>README.md</code> .  Chaque section peut être affichée individuellement avec les arguments correspondants: <code>chart</code> , <code>values</code> et <code>readme</code> - <code>readme</code> . <br><br>  Dans le référentiel officiel, les graphiques sont magnifiquement documentés et contiennent des exemples d'utilisation, et certains graphiques ont même des configurations prêtes à l'emploi pour la <b>production</b> .  Par exemple, un bon <code>readme</code> est fourni par <a href="">stable / wordpress</a> <i>(pour sa sortie dans la console, voir <code>helm inspect readme stable/wordpress</code> )</i> . <br><br>  La recherche est un bon moyen de trouver des forfaits abordables.  Une fois le package trouvé, vous pouvez l'utiliser pour installer l'application dans le cluster. <br><br><h2>  Première application </h2><br>  Par exemple, le graphique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stable / wordpress</a> déjà mentionné est sélectionné. <br><br>  Il utilise les paramètres décrits dans le fichier <code>values.yaml</code> .  Vous pouvez remplacer les paramètres d'un fichier YAML puis transférer ce fichier lors de l'installation (options <code>-f</code> , <code>--values</code> ).  De plus, ils peuvent être remplacés directement sur la ligne de commande (options <code>--set</code> , <code>--set-string</code> et <code>--set-file</code> ).  Toutes les options sont disponibles pour être utilisées un nombre arbitraire de fois;  en même temps, la substitution sur la ligne de commande est prioritaire sur les fichiers avec paramètres. <br><br>  Lorsque vous définissez le graphique, vous pouvez définir le nom de la version avec l'option <code>--name</code> ou utiliser le nom aléatoire généré par Helm. <br><br>  Définissez le tableau de <a href="">configuration pour la production</a> , modifiez le nom du blog, désactivez l'enregistrement des données WordPress dans <code>PersistentVolumeClaim</code> <i>(pour plus d'informations sur le stockage persistant, consultez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation de Kubernetes</a> )</i> : <br><br><pre> <code class="bash hljs">$ curl https://raw.githubusercontent.com/helm/charts/master/stable/wordpress/values-production.yaml --output values-production.yaml $ helm install --name habr --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"wordpressBlogName=Flant's Blog!"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"persistence.enabled=false"</span></span> -f values-production.yaml stable/wordpress NAME: habr LAST DEPLOYED: Fri Aug 31 15:17:57 2018 NAMESPACE: default STATUS: DEPLOYED RESOURCES: ==&gt; v1/Secret NAME TYPE DATA AGE habr-mariadb Opaque 2 0s habr-wordpress Opaque 2 0s ==&gt; v1/ConfigMap NAME DATA AGE habr-mariadb-init-scripts 1 0s habr-mariadb 1 0s habr-mariadb-tests 1 0s ==&gt; v1/Service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE habr-mariadb ClusterIP 10.111.7.232 &lt;none&gt; 3306/TCP 0s habr-wordpress ClusterIP 10.106.129.88 &lt;none&gt; 80/TCP,443/TCP 0s ==&gt; v1beta1/Deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE habr-wordpress 3 3 3 0 0s ==&gt; v1beta1/StatefulSet NAME DESIRED CURRENT AGE habr-mariadb 1 1 0s ==&gt; v1beta1/Ingress NAME HOSTS ADDRESS PORTS AGE wordpress.local-habr wordpress.local 80, 443 0s ==&gt; v1/Pod(related) NAME READY STATUS RESTARTS AGE habr-wordpress-7955b95fd-hh7b9 0/1 ContainerCreating 0 0s habr-wordpress-7955b95fd-tgsxk 0/1 ContainerCreating 0 0s habr-wordpress-7955b95fd-xjz74 0/1 ContainerCreating 0 0s habr-mariadb-0 0/1 ContainerCreating 0 0s NOTES: 1. Get the WordPress URL: You should be able to access your new WordPress installation through https://wordpress.local/admin 2. Login with the following credentials to see your blog <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Username: user <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Password: $(kubectl get secret --namespace default habr-wordpress -o jsonpath=<span class="hljs-string"><span class="hljs-string">"{.data.wordpress-password}"</span></span> | base64 --decode)</code> </pre><br>  Dans le cas de travailler avec un cluster à part entière, vous pouvez suivre les recommandations du bloc <i>NOTES</i> ci-dessus.  Si vous avez Minikube, ouvrez le site dans un navigateur comme suit: <br><br><pre> <code class="bash hljs">$ minikube service habr-wordpress Waiting, endpoint <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> service is not ready yet... Opening kubernetes service default/habr-wordpress <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> default browser...</code> </pre> <br>  Félicitations, l'application est dans un cluster! <br><br><img src="https://habrastorage.org/webt/on/bg/ub/onbgubke7d2hntrso3asemt5teq.png"><br><br>  Un tableau détaillé avec WordPress est apparu dans la liste de toutes les versions de Helm: <br><br><pre> <code class="bash hljs">$ helm list NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE habr 1 Fri Aug 31 15:17:57 2018 DEPLOYED wordpress-2.1.10 4.9.8 default</code> </pre><br>  La prochaine étape consiste à mettre à jour notre version et à changer l'image avec le blog.  Par exemple, une autre balise du même référentiel Docker ( <code>4.9.8-ol-7</code> ) sera utilisée: <br><br><pre> <code class="bash hljs">$ helm upgrade habr --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"image.tag=4.9.8-ol-7"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"wordpressBlogName=Flant's Blog!"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"persistence.enabled=false"</span></span> -f values-production.yaml stable/wordpress Release <span class="hljs-string"><span class="hljs-string">"habr"</span></span> has been upgraded. Happy Helming! LAST DEPLOYED: Fri Aug 31 15:21:08 2018 NAMESPACE: default STATUS: DEPLOYED RESOURCES: ==&gt; v1/Service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE habr-mariadb ClusterIP 10.111.7.232 &lt;none&gt; 3306/TCP 3m habr-wordpress ClusterIP 10.106.129.88 &lt;none&gt; 80/TCP,443/TCP 3m ==&gt; v1beta1/Deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE habr-wordpress 3 4 2 0 3m ==&gt; v1beta1/StatefulSet NAME DESIRED CURRENT AGE habr-mariadb 1 1 3m ==&gt; v1beta1/Ingress NAME HOSTS ADDRESS PORTS AGE wordpress.local-habr wordpress.local 80, 443 3m ==&gt; v1/Pod(related) NAME READY STATUS RESTARTS AGE habr-wordpress-66f4fd6b74-gqwhh 0/1 Pending 0 0s habr-wordpress-66f4fd6b74-mf6vj 0/1 Pending 0 0s habr-wordpress-7955b95fd-hh7b9 1/1 Running 2 3m habr-wordpress-7955b95fd-tgsxk 1/1 Running 2 3m habr-wordpress-7955b95fd-xjz74 0/1 Terminating 2 3m habr-mariadb-0 1/1 Running 0 3m ==&gt; v1/Secret NAME TYPE DATA AGE habr-mariadb Opaque 2 3m habr-wordpress Opaque 2 3m ==&gt; v1/ConfigMap NAME DATA AGE habr-mariadb-init-scripts 1 3m habr-mariadb 1 3m habr-mariadb-tests 1 3m NOTES: 1. Get the WordPress URL: You should be able to access your new WordPress installation through https://wordpress.local/admin 2. Login with the following credentials to see your blog <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Username: user <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Password: $(kubectl get secret --namespace default habr-wordpress -o jsonpath=<span class="hljs-string"><span class="hljs-string">"{.data.wordpress-password}"</span></span> | base64 --decode)</code> </pre><br>  Veuillez noter que <b>lors de la mise à jour</b> Tiller compare le graphique reçu avec les paramètres avec le dernier enregistré et exécute les requêtes correspondantes dans l'API Kubernetes, et l' <b>état actuel des ressources de publication n'est pas pris en compte</b> .  Il est important de comprendre cette fonctionnalité et de ne pas faire d'erreurs: <br><br><ul><li>  La mise à jour n'est pas différente de l'installation: le client Helm envoie le graphique Tiller avec les paramètres, vous devez donc être prudent et n'oubliez pas de spécifier les paramètres et les fichiers avec les paramètres qui ont été définis lors de l'installation (ou lors de la mise à jour précédente) et qui ne doivent pas être ignorés.  Dans l'exemple ci-dessus, il s'agit de <code>--set "wordpressBlogName=Flant's Blog!" --set "persistence.enabled=false" -f values-production.yaml</code>  <code>--set "wordpressBlogName=Flant's Blog!" --set "persistence.enabled=false" -f values-production.yaml</code> . </li><li>  Les applications déployées à l'aide de Helm doivent uniquement être traitées à l'aide de Helm: les modifications manuelles effectuées à l'aide de <code>kubectl</code> ne seront pas prises en compte par Helm et peuvent entraîner des conséquences irréversibles. </li></ul><br>  D'où la conclusion logique: le <b>processus doit être automatisé</b> , et les modifications doivent être effectuées uniquement en validant le référentiel Git, en modifiant les fichiers de graphique et le fichier de configuration CI. <br><br>  L'état des composants de version d'application dans un cluster peut toujours être vérifié comme suit: <br><br><pre> <code class="bash hljs">$ helm status habr LAST DEPLOYED: Fri Aug 31 15:21:08 2018 NAMESPACE: default STATUS: DEPLOYED RESOURCES: ==&gt; v1/Secret NAME TYPE DATA AGE habr-mariadb Opaque 2 4m habr-wordpress Opaque 2 4m ==&gt; v1/ConfigMap NAME DATA AGE habr-mariadb-init-scripts 1 4m habr-mariadb 1 4m habr-mariadb-tests 1 4m ==&gt; v1/Service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE habr-mariadb ClusterIP 10.111.7.232 &lt;none&gt; 3306/TCP 4m habr-wordpress ClusterIP 10.106.129.88 &lt;none&gt; 80/TCP,443/TCP 4m ==&gt; v1beta1/Deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE habr-wordpress 3 4 2 3 4m ==&gt; v1beta1/StatefulSet NAME DESIRED CURRENT AGE habr-mariadb 1 1 4m ==&gt; v1beta1/Ingress NAME HOSTS ADDRESS PORTS AGE wordpress.local-habr wordpress.local 80, 443 4m ==&gt; v1/Pod(related) NAME READY STATUS RESTARTS AGE habr-wordpress-66f4fd6b74-gqwhh 0/1 Pending 0 1m habr-wordpress-66f4fd6b74-mf6vj 1/1 Running 0 1m habr-wordpress-7955b95fd-hh7b9 1/1 Running 3 4m habr-wordpress-7955b95fd-tgsxk 1/1 Running 3 4m habr-mariadb-0 1/1 Running 1 4m NOTES: 1. Get the WordPress URL: You should be able to access your new WordPress installation through https://wordpress.local/admin 2. Login with the following credentials to see your blog <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Username: user <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Password: $(kubectl get secret --namespace default habr-wordpress -o jsonpath=<span class="hljs-string"><span class="hljs-string">"{.data.wordpress-password}"</span></span> | base64 --decode)</code> </pre><br>  Helm vous permet de <b>revenir à une révision de version spécifique</b> .  Il existe actuellement deux révisions: <br><br><pre> <code class="bash hljs">$ helm <span class="hljs-built_in"><span class="hljs-built_in">history</span></span> habr REVISION UPDATED STATUS CHART DESCRIPTION 1 Fri Aug 31 15:17:57 2018 SUPERSEDED wordpress-2.1.10 Install complete 2 Fri Aug 31 15:21:08 2018 DEPLOYED wordpress-2.1.10 Upgrade complete</code> </pre><br>  Restaurez l'application à son état d'origine: <br><br><pre> <code class="bash hljs">$ helm rollback habr 1 Rollback was a success! Happy Helming!</code> </pre><br>  Maintenant, l'historique des révisions a été reconstitué avec un enregistrement: <br><br><pre> <code class="plaintext hljs">$ helm history habr REVISION UPDATED STATUS CHART DESCRIPTION 1 Fri Aug 31 15:17:57 2018 SUPERSEDED wordpress-2.1.10 Install complete 2 Fri Aug 31 15:21:08 2018 SUPERSEDED wordpress-2.1.10 Upgrade complete 3 Fri Aug 31 15:25:06 2018 DEPLOYED wordpress-2.1.10 Rollback to 1</code> </pre><br>  L'article touche à sa fin et la sortie n'est plus nécessaire? <br><br><pre> <code class="bash hljs">$ helm delete habr release <span class="hljs-string"><span class="hljs-string">"habr"</span></span> deleted</code> </pre><br>  Est-il vraiment supprimé? .. <br><br>  <b>La commande supprime les ressources Kubernetes associées à la version, mais pas la version elle-même</b> .  Toutes les informations sur la version restent disponibles, y compris son historique: <br><br><pre> <code class="bash hljs">$ helm list --all NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE habr 3 Fri Aug 31 15:25:06 2018 DELETED wordpress-2.1.10 4.9.8 default</code> </pre><br><pre> <code class="bash hljs">$ helm <span class="hljs-built_in"><span class="hljs-built_in">history</span></span> habr REVISION UPDATED STATUS CHART DESCRIPTION 1 Fri Aug 31 15:17:57 2018 SUPERSEDED wordpress-2.1.10 Install complete 2 Fri Aug 31 15:21:08 2018 SUPERSEDED wordpress-2.1.10 Upgrade complete 3 Fri Aug 31 15:25:06 2018 DELETED wordpress-2.1.10 Deletion complete</code> </pre><br>  <i><b>Remarque</b> : Comme prévu, la version à distance peut être restaurée vers les versions précédentes, mais dans les versions récentes, cette fonctionnalité ne fonctionne pas - voir le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">problème # 3722 pour</a> plus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de</a> détails.</i> <br><br>  Pour supprimer complètement la version, utilisez l'option <code>--purge</code> : <br><br><pre> <code class="bash hljs">$ helm delete --purge habr release <span class="hljs-string"><span class="hljs-string">"habr"</span></span> deleted</code> </pre><br><h2>  Résumer </h2><br>  Cet article décrit l'architecture de base de Helm 2, ses composants et leurs fonctions, ainsi que les primitives de base, les graphiques, les versions et les référentiels de graphiques.  Nous avons installé Helm dans le cluster Kubernetes et acquis une compréhension du cycle de vie des versions et des commandes de base pour travailler avec. <br><br>  Le matériel suivant de cette série sera consacré au sujet de la <b>création de votre propre graphique</b> - j'y parlerai de la structure du graphique, des outils de normalisation et de débogage.  <b>MISE À JOUR</b> : Un nouvel article est disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce lien</a> . <br><br><h2>  PS </h2><br><ul><li>  « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Création de packages pour Kubernetes avec Helm: structure graphique et création de modèles</a> »; </li><li>  « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gestionnaire de packages pour Kubernetes - Helm: Past, Present, Future</a> »; </li><li>  « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pratique avec dapp.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2. Déploiement d'images Docker dans Kubernetes à l'aide de Helm</a> "; </li><li>  « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Créer et installer des applications dans Kubernetes à l'aide de dapp et GitLab CI</a> »; </li><li>  « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Meilleures pratiques CI / CD avec Kubernetes et GitLab</a> » <i>(revue et rapport vidéo)</i> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420437/">https://habr.com/ru/post/fr420437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420425/index.html">Théorie et pratique de l'utilisation de HBase</a></li>
<li><a href="../fr420429/index.html">USE, RED, PgBouncer, ses paramètres et surveillance</a></li>
<li><a href="../fr420431/index.html">Mars Guide pratique de la terraformation pour les femmes au foyer</a></li>
<li><a href="../fr420433/index.html">«Format du vendredi»: routes musicales - qu'est-ce que c'est et pourquoi elles ne sont pas en Russie</a></li>
<li><a href="../fr420435/index.html">Démarrage rapide avec ARM Mbed: développement de microcontrôleurs modernes pour débutants</a></li>
<li><a href="../fr420439/index.html">Fintech digest: les investissements dans les fintech ont atteint 57 milliards de dollars, la vitesse des transactions augmente et les coûts baissent</a></li>
<li><a href="../fr420441/index.html">Les 10 erreurs de sécurité les plus courantes en Python et comment les éviter</a></li>
<li><a href="../fr420443/index.html">Des experts en cybersécurité ont créé un détecteur d'écumoire - SkimReaper</a></li>
<li><a href="../fr420447/index.html">Computer History Museum - l'endroit où l'informatique est enregistrée</a></li>
<li><a href="../fr420451/index.html">Serveur dans les nuages: se préparer au lancement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>