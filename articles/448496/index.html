<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>け  じ .NET Core en Linux, DevOps a caballo  锔 </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Desarrollamos DevOps como pudimos. ramos 8, y Vasya era la mejor de Windows. De repente, Vasya se fue, y tuve la tarea de presentar un nuevo proyecto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>.NET Core en Linux, DevOps a caballo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/448496/">  Desarrollamos DevOps como pudimos.  ramos 8, y Vasya era la mejor de Windows.  De repente, Vasya se fue, y tuve la tarea de presentar un nuevo proyecto que proporciona el desarrollo de Windows.  Cuando vert铆 toda la pila de desarrollo de Windows sobre la mesa, me di cuenta de que la situaci贸n es una molestia ... <br><br>  As铆 comienza la historia de <b>Alexander Sinchinov</b> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DevOpsConf</a> .  Cuando el especialista l铆der en Windows dej贸 la empresa, Alexander se pregunt贸 qu茅 hacer ahora.  隆Cambie a Linux, por supuesto!  Alexander contar谩 c贸mo logr贸 establecer un precedente y transferir parte del desarrollo de Windows a Linux usando el ejemplo de un proyecto completado para 100,000 usuarios finales. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dcd/e76/321/dcde7632138481f5c01f851d9af8e2e2.png"><br><br>  驴C贸mo entregar f谩cilmente y sin esfuerzo un proyecto a RPM usando TFS, Puppet, Linux .NET core?  驴C贸mo mantener el control de versiones de la base de datos del proyecto si el desarrollo primero escucha las palabras Postgres y Flyway, y la fecha l铆mite pasado ma帽ana?  驴C贸mo integrarse con Docker?  驴C贸mo motivar a los desarrolladores de .NET a abandonar Windows y los smoothies en favor de Puppet y Linux?  驴C贸mo resolver los conflictos ideol贸gicos, si no hay fuerzas, ni deseos, ni recursos para servir a Windows en la producci贸n?  Sobre esto, as铆 como sobre Web Deploy, pruebas, CI, sobre las pr谩cticas de uso de TFS en proyectos existentes y, por supuesto, sobre muletas rotas y soluciones de trabajo, en la decodificaci贸n del informe de Alexander. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/tZH9Ro9j9KQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Entonces, Vasya se fue, la tarea es para m铆, los desarrolladores est谩n esperando <s>con una horca</s> .  Cuando finalmente me di cuenta de que Vasya no pod铆a ser devuelta, me puse manos a la obra.  Para empezar, calcul茅 el porcentaje de Win VM en nuestro parque.  El puntaje no estaba a favor de Windows. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa7/3d8/061/fa73d80617e31117f8c2575cc747a17b.png"><br><br>  Dado que estamos desarrollando DevOps activamente, me di cuenta de que hay que cambiar algo en el enfoque de sacar una nueva aplicaci贸n.  La soluci贸n fue una: si es posible, transfiera todo a Linux.  Google me ayud贸: en ese momento .Net ya estaba portado a Linux, 隆y me di cuenta de que esta soluci贸n! <br><br><h2>  驴Por qu茅 se incluye .NET core con Linux? </h2><br>  Hubo varias razones para esto.  Entre "pagar dinero" y "no pagar", la mayor铆a elegir谩 el segundo, como yo.  Una licencia para MSDB cuesta alrededor de $ 1,000; el mantenimiento de una flota de m谩quinas virtuales de Windows cuesta cientos de d贸lares.  Para una gran empresa, este es un gran gasto.  Por lo tanto, el <b>ahorro</b> es la <b>primera raz贸n</b> .  No es el m谩s importante, pero s铆 uno de los m谩s importantes. <br><br>  Las m谩quinas virtuales de Windows ocupan m谩s recursos que sus hermanos Linux: <b>son pesadas</b> .  Dada la escala de una gran empresa, elegimos Linux. <br><br>  <b>El sistema simplemente est谩 integrado en el CI existente</b> .  Nos consideramos DevOps progresivos, utilizamos Bamboo, Jenkins y GitLab CI, por lo que la mayor parte de nuestro trabajo est谩 en Linux. <br><br>  La 煤ltima raz贸n es la <b>escolta conveniente.</b>  Tuvimos que bajar el umbral de entrada para los "acompa帽antes", chicos que entienden la parte t茅cnica, aseguran una operaci贸n ininterrumpida y servicios de servicio desde la segunda l铆nea.  Ya estaban familiarizados con la pila de Linux, por lo que les resulta mucho m谩s f谩cil comprender el nuevo producto, mantenerlo y mantenerlo, que gastar recursos adicionales para lidiar con la funcionalidad similar del software para la plataforma Windows. <br><br><h2>  Requisitos </h2><br>  En primer lugar, la <b>conveniencia de una nueva soluci贸n para desarrolladores</b> .  No todos estaban listos para el cambio, especialmente despu茅s de la palabra hablada Linux.  Los desarrolladores quieren su querido Visual Studio, TFS con pruebas de compilaci贸n y batidos.  C贸mo se realiza la entrega en la producci贸n: no les importa.  Por lo tanto, decidimos no cambiar el proceso habitual y dejar todo sin cambios para el desarrollo de Windows. <br><br>  El nuevo proyecto debe <b>integrarse en el CI existente</b> .  Los rieles ya estaban all铆 y todo el trabajo deb铆a hacerse teniendo en cuenta los par谩metros del sistema de gesti贸n de la configuraci贸n, los est谩ndares de entrega aceptados y los sistemas de monitoreo. <br><br>  <b>Simplicidad en soporte y operaci贸n</b> , como condici贸n para un umbral m铆nimo de entrada para todos los nuevos participantes de diferentes departamentos y departamento de soporte. <br><br>  <b>Plazo - ayer</b> . <br><br><h2>  Gana el grupo de desarrollo </h2><br>  驴Con qu茅 trabaj贸 entonces el equipo de Windows? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/527/4b9/5e9/5274b95e93a6d270259487b5c68ca600.png"><br><br>  Ahora puedo decir con confianza que <b>IdentityServer4</b> es una excelente alternativa gratuita a ADFS con capacidades similares, o que <b>Entity Framework Core</b> es el para铆so de los desarrolladores donde no puede molestarse en escribir scripts SQL, sino describir consultas en la base de datos en t茅rminos OOP.  Pero luego, cuando discut铆 el plan de acci贸n, vi esta pila como una escritura cuneiforme sumeria que reconoce solo PostgreSQL y Git. <br><br>  En ese momento, utilizamos activamente <b>Puppet</b> como un sistema de gesti贸n de configuraci贸n.  En la mayor铆a de nuestros proyectos, utilizamos <b>GitLab CI</b> , <b>Elastic</b> , servicios balanceados altamente cargados usando <b>HAProxy,</b> monitoreamos todo con <b>Zabbix</b> , un mont贸n de <b>Grafana</b> y <b>Prometheus</b> , <b>Jaeger</b> , y todo esto giraba en el hardware de <b>HP</b> con <b>ESXi</b> en <b>VMware</b> .  Todos lo saben: un cl谩sico del g茅nero. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffb/768/38f/ffb76838f0538bd215bc5a54d5e005ad.png"><br><br>  Miremos e intentemos comprender lo que sucedi贸 antes de comenzar todas estas intervenciones. <br><br><h2>  Que fue </h2><br>  TFS es un sistema bastante poderoso que no solo entrega c贸digo del desarrollador a la m谩quina de producci贸n final, sino que tambi茅n tiene un conjunto para una integraci贸n muy flexible con varios servicios, para proporcionar CI a nivel multiplataforma. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b7/9a3/146/9b79a3146abb65be1c4dad29ad50e406.png"><br>  Anteriormente, se trataba de ventanas s贸lidas.  TFS utiliz贸 varios agentes de Build, que reunieron muchos proyectos.  Cada agente tiene de 3 a 4 trabajadores, uno para paralelizar tareas y optimizar el proceso.  Adem谩s, de acuerdo con los planes de lanzamiento, TFS entreg贸 el Build reci茅n horneado al servidor de aplicaciones de Windows. <br><br><h2>  A lo que quer铆amos llegar </h2><br>  Para la entrega y el desarrollo, utilizamos TFS, y lanzamos la aplicaci贸n en el servidor de aplicaciones de Linux, y hay alg煤n tipo de magia entre ellos.  Esta <b>caja m谩gica</b> es la sal del pr贸ximo trabajo.  Antes de desarmarlo en partes, dar茅 un paso al costado y dir茅 dos palabras sobre la aplicaci贸n. <br><br><h2>  Proyecto </h2><br>  La aplicaci贸n proporciona funcionalidad para manejar tarjetas prepagas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4c2/3be/4cc/4c23be4cce98ad3b48de986826817c19.png"><br><br><h3>  Cliente </h3><br>  Hab铆a dos tipos de usuarios.  <b>El primero</b> obtuvo acceso iniciando sesi贸n con el certificado SSL SHA-2.  El <b>segundo</b> tuvo acceso por usuario y contrase帽a. <br><br><h3>  HAProxy </h3><br>  Adem谩s, la solicitud del cliente cay贸 en HAProxy, que resolvi贸 las siguientes tareas: <br><br><ul><li>  autorizaci贸n primaria; <br></li><li>  Terminaci贸n SSL <br></li><li>  ajuste de solicitudes HTTP; <br></li><li>  Difundir solicitudes. <br></li></ul><br>  La verificaci贸n del certificado del cliente pas贸 por la cadena.  Somos <b>autoridad</b> y podemos pagarla, ya que nosotros mismos emitimos certificados para atender a los clientes. <br><br>  Presta atenci贸n al tercer punto, un poco m谩s tarde volveremos a 茅l. <br><br><h3>  Backend </h3><br>  Planearon hacer un backend en Linux.  El backend interact煤a con la base de datos, carga la lista necesaria de privilegios y luego, dependiendo de los privilegios que tenga el usuario autorizado, proporciona acceso para firmar documentos financieros y enviarlos para su ejecuci贸n, o generar alg煤n tipo de informe. <br><br><h2>  Ahorro con HAProxy </h2><br>  Adem谩s de los dos contextos por los que sol铆a pasar cada cliente, tambi茅n hab铆a un contexto de identidad.  <b>IdentityServer4</b> simplemente le permite iniciar sesi贸n, es un an谩logo gratuito y potente para <b>ADFS</b> - <b>Servicios de federaci贸n de Active Directory</b> . <br><br>  La solicitud de identidad se proces贸 en varios pasos.  El primer paso: el <b>cliente</b> <b>cay贸 en el backend</b> , que intercambi贸 datos con este servidor y verific贸 la presencia de un token para el cliente.  Si no lo encontraba, la solicitud regresaba al contexto del que proven铆a, pero con una redirecci贸n y con una redirecci贸n fue a identidad. <br><br>  El segundo paso: la solicitud fue <b>a la p谩gina de autenticaci贸n en IdentityServer,</b> donde estaba registrado el cliente, y el token muy esperado apareci贸 en la base de datos de IdentityServer. <br><br>  El tercer paso: el <b>cliente redirigi贸 de nuevo</b> al contexto del que vino. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ead/cc3/039/eadcc3039f4585956ccf9d25512a4370.png"><br><br>  IdentityServer4 tiene una peculiaridad: <b>devuelve la respuesta a la solicitud de devoluci贸n a trav茅s de HTTP</b> .  No importa c贸mo tuvimos problemas con la configuraci贸n del servidor, no importa c贸mo nos iluminamos con la documentaci贸n, cada vez que recibimos una solicitud inicial del cliente con una URL que vino a trav茅s de HTTPS, e IdentityServer devolvi贸 el mismo contexto, pero con HTTP.  Est谩bamos en estado de shock!  Y todo esto se transfiri贸 a trav茅s del contexto de identidad a HAProxy, y en los encabezados tuvimos que modificar el protocolo HTTP a HTTPS. <br><br>  驴Cu谩l es la mejora y d贸nde ahorraron? <br><br><blockquote>  Ahorramos dinero mediante el uso de una soluci贸n gratuita para autorizar a un grupo de usuarios, recursos, ya que no tomamos IdentityServer4 como una nota separada en un segmento separado, sino que lo usamos junto con un back-end en el mismo servidor donde est谩 girando el backend de la aplicaci贸n. </blockquote><br><h2>  C贸mo deber铆a funcionar </h2><br>  Entonces, como promet铆, Magic Box.  Ya entendemos que estamos garantizados para avanzar hacia Linux.  Formulemos tareas espec铆ficas que requieran soluciones. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/59b/f2c/bde/59bf2cbdeb581a1e53cea2dabfbd4aca.png"><br><br>  <b>T铆teres se manifiesta.</b>  Para entregar y administrar la configuraci贸n del servicio y la aplicaci贸n, ten铆a que escribir recetas geniales.  Un rollo de l谩piz muestra elocuentemente qu茅 tan r谩pido y eficientemente se hizo esto. <br><br>  <b>M茅todo de entrega</b>  El est谩ndar es RPM.  Todos entienden que en Linux no hay forma de hacerlo sin 茅l, pero el proyecto en s铆 mismo despu茅s del ensamblaje era un conjunto de archivos DLL ejecutables.  Hubo alrededor de 150 de ellos, el proyecto es bastante dif铆cil.  La 煤nica soluci贸n armoniosa es empacar estos binarios en RPM e implementar la aplicaci贸n desde all铆. <br><br>  <b>Versionado</b>  Ten铆amos que lanzarlo muy a menudo y ten铆amos que decidir c贸mo formar el nombre del paquete.  Esta es una cuesti贸n de nivel de integraci贸n TFS.  Ten铆amos un agente de compilaci贸n en Linux.  Cuando TFS env铆a la tarea al controlador - trabajador - al agente Build, tambi茅n le env铆a un grupo de variables que caen en el entorno del proceso del controlador.  Estas variables de entorno reciben el nombre Build, el nombre de la versi贸n y otras variables.  Lea m谩s sobre esto en la secci贸n "Ensamblar un paquete RPM". <br><br>  <b>La configuraci贸n de TFS se</b> redujo a la configuraci贸n de Pipeline.  Anteriormente, recopilamos todos los proyectos de Windows en los agentes de Windows, y ahora hay un agente de Linux: un agente de compilaci贸n que debe incluirse en el grupo de ensamblaje, enriquecido con algunos artefactos, indicar qu茅 tipo de proyectos se construir谩n en este agente de compilaci贸n, y de alguna manera modificar Pipeline. <br><br>  <b>IdentityServer.</b>  ADFS no es nuestro camino, nos ahogamos para Open Source. <br><br>  Veamos los componentes. <br><br><h2>  Caja m谩gica </h2><br>  Consta de cuatro partes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/737/6ef/bb5/7376efbb54d21a0dcc88f191b70dfe9f.png"><br><br>  <b>Agente de compilaci贸n de Linux.</b>  Linux, porque lo compilamos, es l贸gico.  Esta parte se llev贸 a cabo en tres pasos. <br><br><ul><li>  <b>Configurar trabajadores</b> y m谩s de uno, ya que se asumi贸 el trabajo distribuido en el proyecto. <br></li><li>  <b>Instale .NET Core 1.x.</b>  驴Por qu茅 1.x cuando 2.0 ya est谩 disponible en el repositorio est谩ndar?  Porque cuando comenzamos el desarrollo, la versi贸n estable era 1.09, y se decidi贸 hacer el proyecto para ello. <br></li><li>  <b>Git 2.x.</b> <br></li></ul><br>  <b>Repositorio RPM.</b>  Los paquetes RPM deb铆an almacenarse en alg煤n lugar.  Se asumi贸 que usar铆amos el mismo repositorio RPM corporativo que est谩 disponible para todos los hosts Linux.  Y as铆 lo hicieron.  Se configura un <b>webhook</b> en el servidor de repositorio que descarg贸 el paquete RPM requerido desde la ubicaci贸n especificada.  El agente de Build inform贸 la versi贸n del paquete al webhook. <br><br>  <b>Gitlab</b>  Atencion  GitLab es utilizado aqu铆 no por desarrolladores, sino por el departamento de operaciones para controlar versiones de aplicaciones, versiones de paquetes, monitorear el estado de todas las m谩quinas Linux y almacena la receta, todos los manifiestos de Puppet. <br><br>  <b>Puppet</b> : resuelve todos los problemas controvertidos y ofrece exactamente la configuraci贸n que queremos de Gitlab. <br><br>  Comenzamos a bucear.  驴C贸mo se entrega DLL en RPM? <br><br><h3>  Entrega DDL a RPM </h3><br>  Digamos que tenemos una estrella de rock para el desarrollo .NET.  Utiliza Visual Studio y crea una rama de lanzamiento.  Despu茅s de eso, lo carga en Git, y Git aqu铆 es una entidad TFS, es decir, es el repositorio de aplicaciones con el que trabaja el desarrollador. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1fd/fcd/8db/1fdfcd8dbe8f5395907ce2e5ec450539.png"><br><br>  Despu茅s de lo cual TFS ve que ha llegado una nueva confirmaci贸n.  Cual aplicaci贸n?  En la configuraci贸n de TFS hay una etiqueta sobre los recursos que tiene un agente de compilaci贸n en particular.  En este caso, ve que estamos creando un proyecto .NET Core y seleccionando un agente de compilaci贸n de Linux del grupo. <br><br>  El agente de compilaci贸n recibe las fuentes, descarga las <b>dependencias</b> necesarias de .NET, el repositorio npm, etc.  y despu茅s de compilar la aplicaci贸n y el empaquetado posterior, env铆a el paquete RPM al repositorio RPM. <br><br>  Por otro lado, ocurre lo siguiente.  El ingeniero de mantenimiento participa directamente en la implementaci贸n del proyecto: cambia la versi贸n de los paquetes en <b>Hiera</b> en el repositorio donde se almacena la receta de la aplicaci贸n, despu茅s de lo cual Puppet activa <b>Yum</b> , recoge el nuevo paquete del repositorio y la nueva versi贸n de la aplicaci贸n est谩 lista para su uso. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/135/3dd/9ae/1353dd9ae0bf83bd4527ceaa8f4db1ee.png"><br><br>  En palabras, todo es simple, pero 驴qu茅 sucede dentro del propio agente de compilaci贸n? <br><br><h3>  Empaquetado RPM DLL </h3><br>  Se recibieron las fuentes del proyecto y la tarea de compilaci贸n de TFS.  El agente de compilaci贸n <b>comienza a</b> compilar <b>el proyecto desde el origen</b> .  El proyecto ensamblado est谩 disponible en forma de muchos <b>archivos DLL</b> que se empaquetan en un archivo zip para reducir la carga en el sistema de archivos. <br><br>  El archivo ZIP se arroja <b>al directorio de compilaci贸n del paquete RPM.</b>  A continuaci贸n, el script Bash inicializa las variables de entorno, encuentra la versi贸n de compilaci贸n, la versi贸n del proyecto, la ruta al directorio de compilaci贸n y lanza la compilaci贸n RPM.  Al final del ensamblaje, el paquete se publica en el <b>repositorio local</b> , que se encuentra en el agente de compilaci贸n. <br><br>  Adem谩s, <b>se env铆a</b> una <b>solicitud JSON</b> desde el agente de compilaci贸n al servidor en el repositorio RPM con el nombre de la versi贸n y la compilaci贸n.  Webhook, sobre el que habl茅 antes, descarga este mismo paquete desde el repositorio local en el agente de compilaci贸n y hace que el nuevo ensamblaje est茅 disponible para la instalaci贸n. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/44c/9a5/b5c/44c9a5b5c05b30293723eec126e0ff24.png"><br><br>  驴Por qu茅 tal esquema para entregar un paquete a un repositorio RPM?  驴Por qu茅 no puedo enviar inmediatamente el paquete ensamblado al repositorio?  El hecho es que esta es una condici贸n para la seguridad.  Este escenario restringe la posibilidad de descargas no autorizadas de paquetes RPM por parte de personas externas a un servidor que sea accesible para todas las m谩quinas Linux. <br><br><h2>  Control de versiones de DB </h2><br>  En la consulta con el desarrollo, result贸 que los chicos est谩n m谩s cerca de MS SQL, pero en la mayor铆a de los proyectos que no son de Windows ya usamos PostgreSQL con might y main.  Como ya decidimos abandonar todo lo pagado, comenzamos a usar PostgreSQL aqu铆. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a9c/e1a/815/a9ce1a81549ee0de97167823755f9b25.png"><br><br>  En esta parte, quiero hablar sobre c贸mo implementamos el control de versiones de la base de datos y c贸mo elegir entre Flyway y Entity Framework Core.  Considere sus pros y sus contras. <br><br><h3>  Contras </h3><br>  Flyway va solo en un sentido, no <b>podemos retroceder</b> , este es un significativo menos.  La comparaci贸n con Entity Framework Core se puede realizar de acuerdo con otros par谩metros, desde el punto de vista de la conveniencia del desarrollador.  Recuerda que pusimos esto a la vanguardia, y el criterio principal era no cambiar nada para el desarrollo de Windows. <br><br>  Para Flyway, <b>necesit谩bamos alg煤n tipo de contenedor</b> para que los chicos no escribieran <b>consultas SQL</b> .  Est谩n mucho m谩s cerca de operar en t茅rminos de POO.  Escribimos instrucciones para trabajar con objetos de base de datos, formamos una consulta SQL y la ejecutamos.  La nueva versi贸n de la base de datos est谩 lista, enrollada: todo est谩 bien, todo funciona. <br><br>  Entity Framework Core tiene un signo negativo: bajo cargas pesadas, no <b>genera consultas SQL 贸ptimas</b> , y la reducci贸n de la base de datos puede ser significativa.  Pero como no tenemos un servicio de alta carga, no calculamos la carga en cientos de RPS, tomamos estos riesgos y delegamos el problema en el futuro. <br><br><h3>  Pros </h3><br>  Entity Framework Core <b>funciona de forma inmediata y es f谩cil de desarrollar</b> , y Flyway se <b>integra a la perfecci贸n en los CI existentes</b> .  Pero lo hacemos convenientemente para desarrolladores :) <br><br><h3>  Procedimiento de enrollado </h3><br>  Puppet ve que hay un cambio en la versi贸n de los paquetes, entre los cuales se encuentra el responsable de la migraci贸n.  Primero, instala un paquete que contiene scripts de migraci贸n y funcionalidad vinculada a la base de datos.  Despu茅s de eso, se reinicia la aplicaci贸n que funciona con la base de datos.  Lo siguiente es la instalaci贸n de los componentes restantes.  El orden en que se instalan los paquetes y se inician las aplicaciones se describe en el manifiesto de Puppet. <br><br>  Las aplicaciones usan datos confidenciales, como tokens, contrase帽as para la base de datos, todo esto se incorpora a la configuraci贸n con el Puppet master, donde se almacenan en forma cifrada. <br><br><h2>  Problemas de TFS </h2><br>  Despu茅s de decidir y darnos cuenta de que todo realmente funciona para nosotros, decid铆 ver qu茅 suced铆a con los ensamblajes en TFS en su conjunto para el departamento de desarrollo de Win para otros proyectos: r谩pidamente o no, 铆bamos a / lanzamiento, y encontramos problemas significativos con la velocidad . <br><br>  Uno de los principales proyectos tomar谩 entre 12 y 15 minutos: es mucho tiempo, no puedes vivir as铆.  Un an谩lisis r谩pido mostr贸 una reducci贸n terrible en E / S, y esto est谩 en los arreglos. <br><br>  Habiendo analizado componentes, identifiqu茅 tres focos.  El primero es el <b>antivirus Kaspersky</b> , que escanea el c贸digo fuente en todos los agentes de Windows Build.  El segundo es el <b>indexador de</b> <b>Windows</b> <b>.</b>  No se desconect贸, y en los agentes de Build en tiempo real todo se index贸 durante el proceso de implementaci贸n. <br><br>  El tercero es la <b>instalaci贸n de Npm.</b>  Result贸 que en la mayor铆a de las tuber铆as usamos este escenario particular.  驴Por qu茅 es malo?  El procedimiento de instalaci贸n de Npm comienza cuando el 谩rbol de dependencias se forma en <b>package-lock.json</b> , donde se <b>arreglan</b> las versiones de los paquetes que se utilizar谩n para construir el proyecto.  La desventaja es que la instalaci贸n de Npm saca las 煤ltimas versiones de paquetes de Internet cada vez, y este es un tiempo considerable en el caso de un proyecto grande. <br><br><blockquote>  Los desarrolladores a veces experimentan en la m谩quina local para probar el funcionamiento de una parte individual o proyecto en su conjunto.  A veces result贸 que a nivel local todo era genial, pero montado, desplegado, nada funcionaba.  Comenzamos a entender cu谩l es el problema: s铆, diferentes versiones de paquetes de dependencia. </blockquote><br><h3>  Soluci贸n </h3><br><ul><li>  Fuentes de excepciones AV. <br></li><li>  Deshabilitar la indexaci贸n. <br></li><li>  Cambiar a <b>npm ci</b> . <br></li></ul><br>  La ventaja de npm ci es que <b>recopilamos el 谩rbol de dependencias una vez</b> y tenemos la oportunidad de proporcionar al desarrollador una <b>lista actualizada de paquetes</b> con los que puede experimentar localmente tanto como sea necesario.  Esto <b>ahorra tiempo a los</b> desarrolladores que escriben c贸digo. <br><br><h3>  Configuracion </h3><br>  Ahora un poco sobre la configuraci贸n del repositorio.  Hist贸ricamente, hemos estado utilizando <b>Nexus</b> para administrar repositorios, incluido <b>REPO interno</b> .  Todos los componentes que utilizamos para fines internos, por ejemplo, la supervisi贸n autoescrita, se entregan a este repositorio interno. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/25d/4d9/204/25d4d920402193190f95e0783f31fc04.png"><br><br>  Tambi茅n usamos <b>NuGet</b> , ya que almacena mejor en cach茅 que otros administradores de paquetes. <br><br><h3>  Resultado </h3><br>  Despu茅s de optimizar los agentes de compilaci贸n, el tiempo de compilaci贸n promedio se redujo de 12 minutos a 7. <br><br><blockquote>  Si contamos todas las m谩quinas que podr铆amos usar para Windows, pero transferidas a Linux en este proyecto, ahorramos alrededor de $ 10,000. Y esto es solo en licencias, y considerando el contenido, m谩s. </blockquote><br><h2>  Planes </h2><br>  El pr贸ximo trimestre, el plan estableci贸 el trabajo para optimizar la entrega del c贸digo. <br><br>  <b>Transici贸n a la imagen de Docker precompilada</b> .  TFS es algo genial con muchos complementos que le permiten integrarse en la canalizaci贸n, incluido el ensamblaje de acuerdo con el disparador, por ejemplo, una imagen de Docker.  Queremos hacer que este disparador est茅 en el mismo <b>paquete-lock.json</b> .  Si de alguna manera cambia la composici贸n de los componentes que se utilizan para construir el proyecto, tendremos una nueva imagen de Docker.  M谩s tarde se utiliza para implementar el contenedor con la aplicaci贸n compilada.  Ahora bien, esto no es as铆, pero planeamos cambiar a una arquitectura de microservicios en Kubernetes, que se est谩 desarrollando activamente en nuestra empresa y ha estado sirviendo soluciones de producci贸n. <br><br><h2>  Resumen </h2><br>  Insto a todos a lanzar Windows, pero esto no se debe a que no s茅 c贸mo cocinarlo.  La raz贸n es que la mayor铆a de las soluciones de Opensource son la <b>pila de Linux</b> .  <b>Ahorrar谩 bien en recursos</b> .  En mi opini贸n, el futuro est谩 en las soluciones Open Source Linux con una comunidad poderosa. <br><br>  <i>Perfil del orador Alexander Sinchinov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en GitHub</a> .</i> <br><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DevOps Conf</a> es una conferencia sobre la integraci贸n de procesos de desarrollo, prueba y operaci贸n para profesionales de profesionales.  驴Por eso el proyecto del que habl贸 Alexander?  implementado y funcionando, y el d铆a de la presentaci贸n se realizaron dos lanzamientos exitosos.  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DevOps Conf en RIT ++</a> el 27 y 28 de mayo habr谩 incluso m谩s casos de este tipo por parte de los profesionales.  Todav铆a puede saltar al 煤ltimo carro y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enviar un informe,</a> o tomarse su tiempo para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reservar un</a> boleto.  Nos vemos en Skolkovo! </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448496/">https://habr.com/ru/post/448496/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448484/index.html">Microbios de la ra铆z</a></li>
<li><a href="../448486/index.html">"En noviembre de 2018, ca铆mos por error en spam en todos los frentes". C贸mo guard茅 correos de una compa帽铆a con una base millon茅sima</a></li>
<li><a href="../448488/index.html">Miedo y asco DevSecOps</a></li>
<li><a href="../448490/index.html">C贸mo comenzar la transformaci贸n de DevOps</a></li>
<li><a href="../448492/index.html">驴Qu茅 es DevOps?</a></li>
<li><a href="../448498/index.html">"Rusia 404": 驴Cu谩nto Internet libre queda para vivir?</a></li>
<li><a href="../448500/index.html">Resolviendo un Crackme simple para Sega Mega Drive</a></li>
<li><a href="../448504/index.html">Recogieron para todos "Habrom" el libro de referencia "Por qui茅n fue emitido ..." para pasaportes. Descargar a la salud</a></li>
<li><a href="../448506/index.html">The Matrix tiene 20 a帽os: c贸mo Wachowski hizo cyberpunk, lo que determin贸 la agenda de toda una generaci贸n</a></li>
<li><a href="../448510/index.html">Acer en 2019: 驴y si eliminas todas las moscas de las computadoras port谩tiles para juegos?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>