<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆎 💓 🗜️ Alte UPnP-Schwachstelle auf neue Weise 👶🏼 ⛲️ 🏖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alles Neue ist ein gut vergessenes altes (oder besser ein sehr gut vergessenes altes). Natürlich ist es richtig, neue Schwachstellen zu überwachen, ab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Alte UPnP-Schwachstelle auf neue Weise</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425203/">  Alles Neue ist ein gut vergessenes altes (oder besser ein sehr gut vergessenes altes).  Natürlich ist es richtig, neue Schwachstellen zu überwachen, aber Sie sollten alte nicht vergessen.  Besonders wenn der Hersteller sich erlaubt, sie zu „vergessen“.  Jemand muss sich erinnern.  Andernfalls werden wir immer wieder auf denselben Rechen treten. <br><br>  Der Artikel wird sich auf einen alten konzentrieren, aber wie sich herausstellte, hat er bis heute nie seine Relevanz verloren, das UPnP-Loch. <br><br><img src="https://habrastorage.org/webt/n8/oe/yl/n8oeyllfk_t6lcecxmgt5jfakuw.jpeg"><br><br>  PS Ich werde den Anbieter nicht anrufen, er ist daran nicht schuld, aber andererseits gibt es eine klare Kontrolle der Sicherheitsrichtlinien, die es in Verbindung mit der Netzwerkarchitektur ermöglicht haben, diese Sicherheitsanfälligkeit auszunutzen.  Wie immer laufen die Sterne zusammen.  Der Anbieter installierte Router in seinem Netzwerk für Clients mit den erforderlichen Chips und verband sie mit einer externen IP-Adresse.  Ja, die meisten Ports wurden gefiltert, aber aus irgendeinem Grund nicht 52869. <br><br>  PPS Alle Ereignisse ereigneten sich Ende 2018.  Helden sind fiktiv und Zufälle mit echten Persönlichkeiten sind zufällig. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Kurzes Bildungsprogramm:</b> <div class="spoiler_text">  Es gibt eine libupnp-Bibliothek für die Entwicklung, die "auf Tausenden von Geräten verwendet wird und als Intel SDK für UPnP-Geräte oder als Portable SDK für UPnP-Geräte bezeichnet wird". <br><br>  Auf Englisch: <br><blockquote>  "Das tragbare SDK für UPnP-Geräte (libupnp) bietet Entwicklern eine API und Open Source-Code zum Erstellen von Kontrollpunkten, Geräten und Bridges, die mit Version 1.0 der Universal Plug &amp; Play-Gerätearchitekturspezifikation kompatibel sind und mehrere Betriebssysteme wie Linux unterstützen , * BSD, Solaris und andere. ” </blockquote><br></div></div><br>  Die erste Erwähnung der Sicherheitsanfälligkeit erfolgte 2014: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">tyk</a> <br>  Versuche, den Hersteller zu kontaktieren, brachten wenig Erfolg und die Sicherheitslücke wurde veröffentlicht.  Die einzige Gegenempfehlung war: <br><blockquote>  "... Einschränkung der Interaktion mit dem Dienst ... Nur Clients und Server, die eine rechtliche Verfahrensbeziehung haben ... sollten in der Lage sein, mit ihm zu kommunizieren." </blockquote>  Im miniigd SOAP-Dienst liegt ein Fehler vor.  Das Problem besteht in der Verarbeitung von NewInternalClient-Anforderungen, da Benutzerdaten vor einem Systemaufruf nicht gelöscht werden können.  Ein Angreifer kann diese Sicherheitsanfälligkeit verwenden, um Code mit Root-Rechten auszuführen. <br><br>  Das heißt,  Auf allen Routern mit UPnP Version 1.0 können Sie beliebigen Remotecode ausführen. <br>  Ohne Genehmigung.  Von der Wurzel.  Großartig, richtig? <br><br>  Jeder kann auf Github ein fertiges Plugin für Metasplit finden, dessen Leistung von den verbrannten Stühlen unserer Dienstingenieure getestet wurde. <br>  Es war unerwartet und machte überhaupt keinen Spaß. <br><br><h3>  Eine kurze Chronologie der Ereignisse dieses Tages: </h3><br>  <b>14:00</b> Im technischen Support erhalten Abonnenten Anrufe ins schlecht funktionierende Internet. <br><br><ul><li>  <u>Symptome auf der Clientseite:</u> "Es funktioniert langsam, nach einem Neustart funktioniert es eine Weile einwandfrei, dann wieder langsam." </li><li>  <u>Symptome seitens des Geräts: Ein</u> kleiner Anstieg des Datenverkehrs und der CPU-Auslastung wurde auf die vom Client generierte Auslastung abgeschrieben. </li></ul><br>  Einzelne Anwendungen werden registriert, um die Leitung auf Administratoren oder die Abreise des Installateurs zu überprüfen.  Es gibt keine gemeinsame Vorlage für Maßnahmen.  Nichts ist klar. <br><br>  <b>15:00 Die</b> Anzahl der Anträge beginnt, die Durchschnittstemperatur im Krankenhaus zu überschreiten, und einzelne Anträge werden zu Anträgen für mehr mit der Art "Unfall".  Anträge werden an leitende Administratoren gesendet, um Netzwerksegmente zu überprüfen. <br><br>  <b>15:20</b> Admins schließen Massenabstürze, weil  Es gibt keine Probleme im Netzwerk, alle Kundenanfragen von verschiedenen Verbindungspunkten sind einzeln.  (Zum Beispiel: Der Switch ist voll mit aktiven Teilnehmern, funktioniert aber für einen nicht gut.)  In diesem Moment fallen die Appelle und alles beruhigt sich.  Jemand macht (endlich) darauf aufmerksam, dass alle Anwendungen für schlechte Arbeit mit demselben Routermodell ausgeführt wurden. Alle zusammen geben vor, dass alles in Ordnung ist. <br><br>  <b>15:30</b> Wieder der Zustrom von Anträgen von Abonnenten, wieder die Registrierung eines Massenunfalls und die Übertragung an die Admins.  In diesem Moment wird klar, dass etwas <b>wirklich nicht</b> stimmt und etwas getan werden muss (wer mit dem Kundendienst zusammengearbeitet hat, wird verstehen, wie schwierig es manchmal ist. Kunden lügen <s>immer</s> , und manchmal liegt die erste Zeile darin, die Aufgabe weiter zu eskalieren). . <br><br>  <b>15:35 Der diensthabende</b> Ingenieur erhält eine Anfrage für ein Problem mit dem Kundendienst.  Ruft eine Liste aller Clients, ihres Verbindungstyps und Gerätemodells ab.  Und dann beginnt ein bisschen Magie. <br><br><img src="https://habrastorage.org/webt/m9/hj/ba/m9hjbaxp9s7onm3ba8nykkcymwe.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text">  Was übrigens nicht funktioniert hat und dann der Hauptmagier gefeuert wurde (aber sie sagen, das ist nicht dafür). <br></div></div><br>  <b>15:40 Der</b> Techniker führt die Client-Liste durch alle Diagnosen, jeder Router wurde gemäß allen Standardmetriken überprüft und ... es wurde nichts gefunden.  Ein Router ist wie ein Router.  Ja, die CPU hat zugenommen, aber die Anzeigen sind nicht kritisch, aber sie leiten irgendwo Verkehr ab, was bedeutet, dass es funktioniert. <br><br>  Ja, der UPnP-Dienst dreht sich auf Port 52869.  Ja, es gibt immer noch eine Menge offener Ports, offen bedeutet, dass sie benötigt werden (Eisenlogik), und es drehte sich immer um und es gab keine Probleme (ein weiteres Argument der Eisenlogik).  Ein direktes SSH zu diesem Routermodell ist nicht möglich (ehrlich gesagt ist dies möglich, aber innerhalb der stark reduzierten Busybox- und Unternehmensrichtlinien wurde von einem solchen Rundgang durch Clientgeräte dringend abgeraten).  Alles stand wieder auf. <br><br>  <b>16:00</b> Erst jetzt stellen wir fest, dass es einige Probleme gibt.  Der diensthabende Ingenieur meldet sich bei seinem Vorgesetzten, und der Vorgesetzte ruft uns wegen seiner Vermutungen zu Port 52869 an und bittet um Hilfe. <br><br>  <b>16:05</b> Dann ging alles sehr schnell.  Das gleiche Routermodell ist auf dem Prüfstand enthalten, die IP-Adresse wird vom Problemclient übernommen und an den Testclient gehängt.  Der Wireshark ist eingeschaltet.  Dies dient zum Abfangen von Anforderungen an das Gerät. <br><br>  Um Anforderungen vom Router abzufangen (zu diesem Zeitpunkt war das allgemeine Schema, wie die Interaktion noch unbekannt war), wird der Client im Testsegment isoliert und der gesamte Datenverkehr auf die nächste Testmaschine gespiegelt, auf der ein anderer Wireshark ausgelöst wird. <br><br>  Wir warten weiter, wir schauen auf den Bildschirm. <br><br>  Hacks wurden bereits auf diese Weise gefangen - recht effizient und beschlossen daher, die Gewohnheiten nicht zu ändern. <br><br>  <b>16:10</b> Während Wireshark raschelt, gibt es in Google eine Sicherheitslücke CVE-2014-8361, über die Ingenieure informiert werden.  Der Ingenieur trifft, ohne zuzuhören, eine Entscheidung (und im Prinzip logisch) - den Filter dieses Ports an der Grenze.  Kaum gesagt als getan. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text">  Das hat nicht funktioniert. <br></div></div><br>  <b>16:25</b> Uns wird gesagt, dass <s>alle Remake-Scheiße Mischa</s> nicht funktioniert hat.  Und wir wussten bereits, dass das nicht funktionieren würde.  Zu diesem Zeitpunkt hatten sie bereits an den Testrouter geklopft, das Reverse ausgelöst und einen <b>anderen</b> Port verwendet und ihn für DDOS-a bis 1900 (!) Port mit einer anderen Sicherheitsanfälligkeit verwendet.  <s>Herr, was für eine undichte Mülltonne</s> <br><br><div class="spoiler">  <b class="spoiler_title">noch Bildungsprogramm</b> <div class="spoiler_text">  Verwendung bei DDoS-Angriffen <br><br>  2014 entdeckten sie unerwartet, dass SSDP bei DDoS-Angriffen wie „SSDP-Reflexionsangriff mit Verstärkung“ verwendet wurde.  Viele Geräte, einschließlich Heimrouter, hatten einen Fehler in der UPnP-Software, der es einem Angreifer ermöglichte, Antworten von Port 1900 an eine beliebige Adresse im Internet zu senden.  Im Fall der Verwendung eines Botnetzes von vielen tausend solcher Geräte könnte der Angreifer einen großen Paketstrom erzeugen, der ausreicht, um die Bandbreite zu belegen und die Datenkanäle der angegriffenen Site zu sättigen, was zu einem Denial-of-Service für normale Benutzer führt. <br></div></div><br>  Das Interessanteste ist, dass die Firewall-Regeln auf dem Gerät geändert wurden und nmap jetzt keine offenen Ports von außen anzeigt.  Nur in einem Verkehrsdump konnten Anforderungen an diesen Ports erkannt werden.  Das heißt,  Ein Angreifer blockierte nach dem Hacken den Zugang zum Rest.  Kein High-Tech-Ansatz, aber trotzdem mutig. <br><br>  <b>16:30</b> Eine Konferenz versammelt sich mit den Fragen "Wer ist schuld und was zu tun?".  Die Ports 1900 und 52869 wurden gesperrt gelassen. Es wird versucht, etwas auf gehackten Geräten zu reparieren.  Neustart - hat nicht geholfen, die Idee des Reflashing wurde sofort abgelehnt.  Ja, es gibt eine solche Funktion, dass es möglich war, Software über TR069 mit einer Taste auf allen Geräten aus der Ferne neu anzuordnen.  Aber seitdem  Das Gerät war nicht die erste Frische, aber die Anzahl der Kunden war groß - ein bestimmter Prozentsatz der gemauerten Geräte würde Probleme verursachen. <br><br>  <b>16:40</b> Zusammenfassend: Die Geräte werden gehackt, nehmen an einem Minimum an ddos ​​teil und übertragen irgendwo auf dem verschlüsselten Kanal etwas.  (Alle an <b>verschiedenen</b> Ports).  Der Zugang ist nicht möglich. Der Anbieter hat den vollständigen Zugriff über ssh auf das Gerät verweigert und festgestellt, was nicht möglich war, um dorthin zu gelangen.  Die Konsole ist passwortgeschützt. <br><br>  <b>Kurz vor 17:00 Uhr</b> wurde beschlossen, das Gerät als schnellsten Weg zu nähen.  Nach dem Flashen und Neustarten wurde alles wieder normal. <br><br><h3>  Anstelle von Summen </h3><br>  Leider konnten wir dieses Problem nicht vollständig lösen. <br><br>  Mit "entscheiden" meine ich, vollständige Hacking-Informationen zu erhalten und unsere Richtlinien zu aktualisieren, um dem in Zukunft entgegenzuwirken.  Ja, nicht alle Aufgaben werden erfolgreich und wie gewünscht gelöst.  Es ist in Ordnung.  Obwohl beleidigend. <br><br>  <i>Wenn es gut ist, nach dem Shodan zu suchen,</i> <i><br></i>  <i>du kannst dir etwas finden</i> <i><br></i>  <i>für Experimente:</i> <i><br></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">so</a> oder so</i> <i><br></i>  <i>aber das habe ich dir nicht gesagt</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de425203/">https://habr.com/ru/post/de425203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de425191/index.html">Fastware</a></li>
<li><a href="../de425195/index.html">Schwarze, weiße und graue Listen schützen die Unternehmenssicherheit</a></li>
<li><a href="../de425197/index.html">Kostenschätzung eines IdM-Implementierungsprojekts - Wie man Überraschungen vorhersieht</a></li>
<li><a href="../de425199/index.html">Was schützt Käufer vor kontaktlosem Zahlungsbetrug?</a></li>
<li><a href="../de425201/index.html">„Ich kämpfe seit drei Jahren gegen das Betrugssyndrom“ - 10 Fragen an einen Programmierer, Ausgabe 7</a></li>
<li><a href="../de425205/index.html">Soft Skills im Projektmanagement: Konzept, Ziele und Tipps für eine erfolgreiche geschäftliche Nutzung</a></li>
<li><a href="../de425207/index.html">Designtests: Top 10 Heisenbug 2018 Piter Talks</a></li>
<li><a href="../de425209/index.html">Sunrise Manually # 2: Laut dem Hardcore für die IDE, Cmake und meiner Enttäuschung bei Tieren</a></li>
<li><a href="../de425211/index.html">286 und Netzwerk</a></li>
<li><a href="../de425213/index.html">Pläne für die nächste Version von Vue.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>