<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçü§ù‚Äçüë®üèª üë©üèΩ‚Äçüöí üôèüèº OceanLotus: backdoor baru, skema lama üëçüèª üò´ ü§™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kelompok OceanLotus (alias APT32 dan APT-C-00) dikenal karena serangannya di Asia Timur. Tahun lalu, sejumlah studi tentang pekerjaan grup diterbitkan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OceanLotus: backdoor baru, skema lama</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/421779/">  Kelompok OceanLotus (alias APT32 dan APT-C-00) dikenal karena serangannya di Asia Timur.  Tahun lalu, sejumlah studi tentang pekerjaan grup diterbitkan, termasuk dokumen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CyberReason</a> , ulasan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">FireEye</a> , dan deskripsi serangan lubang berair <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Volexity</a> .  Seperti yang dapat kita lihat, grup memperbarui vektor backdoor, infrastruktur dan infeksi. <br><br>  OceanLotus terus menargetkan perusahaan dan lembaga pemerintah di Asia Timur.  Menurut telemetri ESET, tujuan prioritas OceanLotus adalah di Vietnam, Laos, Kamboja dan Filipina. <br><br>  Beberapa bulan yang lalu, kami menemukan dan menganalisis salah satu ruang belakang terbaru mereka.  Ini mengimplementasikan beberapa alat yang membuatnya sulit untuk dianalisis dan menghindari deteksi - kami akan membahasnya dalam sebuah pos. <br><br><img src="https://habrastorage.org/webt/4f/mf/dz/4fmfdzgqiqskqku5rz7eeprycti.jpeg"><br><br><a name="habracut"></a><h2>  Distribusi </h2><br>  Penyerang menggunakan metode yang berbeda untuk meyakinkan korban untuk meluncurkan dropper berbahaya. <br><br><h3>  Ekstensi ganda dan ikon aplikasi palsu (Word, PDF, dll.) </h3><br>  Dropper cenderung menyebar melalui lampiran email.  Kami mengamati nama file berikut: <br>  - <code>Mi17 Technical issues - Phonesack Grp.exe</code> (Mi-17 - model helikopter Rusia) <br>  - <code>Chi tiet don khieu nai gui saigontel.exe</code> (diterjemahkan dari bahasa Vietnam - ‚Äúperincian klaim yang dikirim ke Saigontel‚Äù, Saigontel - perusahaan telekomunikasi Vietnam) <br>  - <code>Updated AF MOD contract - Jan 2018.exe</code> <br>  - <code>remove_pw_Reschedule of CISD Regular Meeting.exe</code> <br>  - <code>Sorchornor_with_PM_-_Sep_2017.exe</code> <br>  - <code>20170905-Evaluation Table.xls.exe</code> <br>  - <code>CV_LeHoangThing.doc.exe</code> (resume palsu juga ditemukan di Kanada) <br><br>  Semua file ini memiliki kesamaan - meluncurkan dokumen umpan yang dilindungi kata sandi.  Tidak jelas apakah kata sandi tersebut terkandung di suatu tempat dalam data surat yang dikirimkan, atau apakah dokumen tidak boleh dibuka. <br><br><h3>  Pemasang palsu </h3><br>  Beberapa installer palsu yang menyamar sebagai installer atau pembaruan perangkat lunak telah terlihat dalam kampanye lubang air.  Salah satu contoh adalah penginstal ulang Firefox yang dijelaskan oleh 360 Labs on <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Freebuf</a> (dalam bahasa Cina). <br><br>  Sampel lain yang kami lihat disebut <code>RobototFontUpdate.exe</code> .  Mungkin menyebar melalui situs yang disusupi, tetapi kami tidak memiliki bukti yang cukup tentang ini. <br><br>  Semua file yang dijelaskan, apakah didistribusikan melalui pos atau diunduh ketika mengunjungi situs yang disusupi, mengirimkan komponen backdoor yang sama.  Dalam sebuah posting, kami akan menganalisis sampel <code>RobototFontUpdate.exe</code> dan menunjukkan bagaimana mengelola untuk menjalankan muatan berbahaya pada sistem. <br><br><h2>  Analisis teknis </h2><br>  Proses instalasi dan eksekusi tergantung pada kebingungan multi-layer, yaitu enkripsi komponen, rekonstruksi file PE, pemuatan shellcode dan teknik pemuatan samping.  Yang terakhir ini dijelaskan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">studi Korplug</a> ESET <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sebelumnya</a> . <br><br><h3>  Ulasan Kemajuan </h3><br>  Serangan itu terdiri dari dua bagian: sebuah dropper dan sebuah kendaraan peluncuran.  Setiap langkah dari setiap bagian dari proses akan dijelaskan secara rinci di bagian yang sesuai.  Dua diagram di bawah ini memberikan gambaran singkat tentang perkembangan malware secara keseluruhan. <br><br><img src="https://habrastorage.org/webt/yn/wa/jd/ynwajd8empdclmahz0mzaarmpxk.png"><br>  <i>Gambar 1. Kemajuan pipet</i> <br><br><img src="https://habrastorage.org/webt/gv/ba/jb/gvbajbzaqzd6tmrjpj95nkov-j8.png"><br>  <i>Gambar 2. Progres backdoor</i> <br><br>  Hampir semua komponen ini dikaburkan.  Kebingungan didasarkan pada perintah transisi pasangan kondisional pelengkap.  Untuk masing-masing bentuk: JZ / JNZ, JP / JNP, JO / JNO dan seterusnya, masing-masing pasangan melakukan transisi ke tujuan yang sama.  Urutan diselingi dengan kode sampah yang menggunakan penunjuk tumpukan tetapi tidak mengubah nilai bendera bersyarat.  Ternyata transisi terjadi dalam cabang yang sama.  Hal ini menyebabkan masalah selama proses dekompilasi karena penggunaan nilai-nilai penunjuk tumpukan positif. <br><br><img src="https://habrastorage.org/webt/lh/y6/an/lhy6anvm_1feplhj7depx1udiiu.png"><br>  <i>Gambar 3. Transisi bersyarat pelengkap</i> <br><br>  Selain itu, beberapa elemen dasar program menambahkan satu alamat ke stack, setelah itu mereka berakhir di JMP / CALL, sementara elemen dasar lainnya menambahkan dua alamat dan diakhiri dengan perintah RET.  Penambahan item kedua adalah fungsi yang dipanggil, dan yang pertama adalah alamat elemen program dasar berikutnya di mana transisi akan dilakukan.  Dengan demikian, elemen dasar dari program ini dibuat tanpa objek induk. <br><br><img src="https://habrastorage.org/webt/jc/5j/dw/jc5jdw3rbtwezkp4ylemfursggw.png"><br>  <i>Gambar 4. Teknik PUSH / JMP</i> <br><br>  Sebagai hasil dari kombinasi dua teknik kebingungan, grafik "indah" diperoleh: <br><br><img src="https://habrastorage.org/webt/3l/pe/3x/3lpe3x_ccjdkh9rm0rpxyykztf0.png"><br>  <i>Gambar 5. Mengaburkan urutan run</i> <br><br>  Memperhatikan kode sampah cukup sederhana.  Itu dapat diabaikan dalam analisis sampel, jika Anda tahu skema aplikasi. <br><br><h2>  Pipet </h2><br><h3>  Langkah 1. Umpan Dokumen </h3><br>  Dalam beberapa bulan terakhir, OceanLotus telah menggunakan beberapa umpan.  Salah satunya adalah perangkat lunak palsu untuk memperbarui <code>Roboto Slab regular</code> TrueType <code>Roboto Slab regular</code> .  Memilih font agak aneh, karena tidak mendukung banyak bahasa Asia Timur. <br><br><img src="https://habrastorage.org/webt/2p/p8/sm/2pp8sm8gjt15kzqakmyooah1pk8.jpeg"><br>  <i>Gambar 6. Ikon pembaruan font RobototFontUpdate</i> <br><br>  Ketika dieksekusi, file biner mendekripsi sumber dayanya (XOR, 128 byte, kunci hard-coded) dan mengembalikan data yang didekripsi (LZMA).  File RobotoSlab-Regular.ttf yang sah <br><br>  (SHA1: <code>912895e6bb9e05af3a1e58a1da417e992a71a324</code> ) ditulis ke folder <code>%temp%</code> dan diluncurkan menggunakan fungsi Win32 API <code>ShellExecute</code> . <br><br>  Kode shell yang didekripsi dari sumber dieksekusi.  Setelah eksekusi, pembaruan font palsu mengimplementasikan aplikasi lain yang tujuan utamanya adalah untuk menghapus dropper.  Aplikasi yang dihapus ini <code>%temp%\[0-9].tmp.exe</code> sebagai <code>%temp%\[0-9].tmp.exe</code> . <br><br><h3>  Tahap 2. Kode shell </h3><br>  Pada setiap tahap, shellcode yang sama digunakan. <br><br>  Shellcode adalah pemuat PE khusus.  Ini mengembalikan file yang dapat dieksekusi dalam memori - mendekripsi semua bagian dan menghitung gerakan yang diperlukan dan indentasi lainnya.  <code>RtlMoveMemory</code> menggunakan tiga fungsi Windows API: <code>VirtualAlloc</code> , <code>RtlMoveMemory</code> dan <code>RtlZeroMemory</code> . <br><br>  Fungsi <code>RtlZeroMemory</code> digunakan untuk <code>RtlZeroMemory</code> bidang dalam header PE.  Mengandalkan dump memori otomatis akan gagal, karena header MZ / PE rusak. <br>  Kode shell memanggil fungsi login PE yang didekripsi, dan kemudian <code>DLLEntry</code> ekspor <code>DLLEntry</code> . <br><br><h3>  Tahap 3. Penetes sungguhan </h3><br> <code>{103004A5-829C-418E-ACE9-A7615D30E125}.dll</code> <br>  Sumber dekripsi yang dapat dieksekusi ini menggunakan algoritma AES dalam mode CBC melalui Windows API.  Kunci kode keras berukuran 256 bit.  Setelah dekripsi, data terkompresi didekompresi (algoritma LZMA). <br><br>  Jika proses dimulai dengan hak administrator, malware menyediakan kegigihan dengan menciptakan layanan.  Jika tidak, kunci registri Run klasik digunakan ( <code>HKCU\SOFTWARE\Microsoft\ Windows\CurrentVersion\Run;DeviceAssociationService;rastlsc.exe</code> ). <br><br>  Jika kode dropper dijalankan dengan hak administrator, ia mencoba menulis file yang tercantum di bawah ini ke folder <code>C:\Program Files\Symantec\Symantec Endpoint Protection\12.1.671.4971.104a\DeviceAssociationService\</code> , jika tidak, tuliskan ke folder <code>%APPDATA%\Symantec\Symantec Endpoint Protection\12.1.671.4971.104a\DeviceAssociationService\</code> : <br><br>  - <code>rastlsc.exe</code> (SHA1: <code>2616da1697f7c764ee7fb558887a6a3279861fac</code> , salinan aplikasi yang sah Symantec Network Access Control, <code>dot1xtra.exe</code> ) <br>  - <code>SyLog.bin</code> (SHA1: <code>5689448b4b6260ec9c35f129df8b8f2622c66a45</code> , terenkripsi backdoor) <br>  - <code>rastls.dll</code> (SHA1: <code>82e579bd49d69845133c9aa8585f8bd26736437b</code> , DLL jahat yang <code>rastlsc.exe</code> oleh <code>rastlsc.exe</code> ) <br><br>  Path bervariasi dari sampel ke sampel, tetapi tata letaknya sama.  Bergantung pada haknya, malware membuang file di <code>%ProgramFiles%</code> atau <code>%appdata%</code> .  Kami juga mengamati: <br><br>  - <code>\Symantec\CNG Key Isolation\</code> <br>  - <code>\Symantec\Connected User Experiences and Telemetry\</code> <br>  - <code>\Symantec\DevQuery Background Discovery Broker Tasks\</code> <br><br>  Jalur ini digunakan oleh berbagai produk Symantec. <br><br>  Setelah mencapai kegigihan dan mengimplementasikan file yang dapat dieksekusi, file yang sah, <br>  <code>rastlsc.exe</code> , dijalankan menggunakan <code>CreateProcessW</code> . <br><br>  Kami juga mengamati versi ( <code>{BB7BDEC9-B59D-492E-A4AF-4C7B1C9E646B}.dll</code> ) yang mengeksekusi <code>rastlsc.exe</code> dengan parameter <code>krv</code> .  Kami akan membahas lebih detail di bawah ini. <br><br><h2>  Komponen pintu belakang: isi rastlsc.exe </h2><br>  Tim OceanLotus menggunakan teknik lama dan terkenal di salah satu executable produk Symantec.  Intinya adalah menggunakan proses memuat perpustakaan file .exe yang sah dan ditandatangani dengan menulis perpustakaan jahat ke folder yang sama.  Ini akan membuat perilaku jahat terlihat sah saat tindakan ini dilakukan saat eksekusi tepercaya sedang berjalan. <br><br>  Seperti disebutkan di atas, file <code>rastlsc.exe</code> sah <code>rastlsc.exe</code> ulang dan dieksekusi. <br>  Itu mengimpor file <code>rastls.dll</code> , yang dalam hal ini memiliki konten berbahaya. <br><br><img src="https://habrastorage.org/webt/jy/ga/ax/jygaaxccovxfilcmjrol9rmoklu.jpeg"><br>  <i>Gambar 7. Rastlsc.exe yang ditandatangani secara digital dari Symantec</i> <br><br>  Kami juga melihat isi menggunakan executable yang sah dan ditandatangani lainnya, termasuk <code>mcoemcpy.exe</code> dari McAfee, yang memuat <code>McUtil.dll</code> .  Teknik ini sebelumnya digunakan oleh PlugX, yang menarik perhatian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Vietnam CERT</a> (dalam bahasa Vietnam). <br><br><h3>  Tahap 1. Mengisi perpustakaan, rastls.dll </h3><br>  Nama internal file dll adalah <code>{7032F494-0562-4422-9C39-14230E095C52}.dll</code> , tetapi kami telah melihat versi lain, misalnya, <code>{5248F13C-85F0-42DF-860D-1723EEAA4F90}.dll</code> .  Semua fungsi yang diekspor mengarah ke pelaksanaan fungsi yang sama. <br><br><img src="https://habrastorage.org/webt/hg/1h/qm/hg1hqmssbsek8-kl8e7dkbzsotq.jpeg"><br>  <i>Gambar 8. Semua ekspor rasltls.dll mengarah ke satu fungsi</i> <br><br>  Ekspor mencoba membaca file <code>SyLog.bin</code> terletak di folder yang sama.  Versi lain telah mencoba untuk membuka file <code>OUTLFLTR.DAT</code> .  Jika file ada, itu akan didekripsi menggunakan algoritma AES dalam mode CBC dengan kunci 256-bit yang dikodekan, dan kemudian data terkompresi yang diterima akan didekompresi (kompresi LZMA). <br><br>  Varian <code>McUtil.dll</code> menggunakan teknik yang berbeda.  Pada pandangan pertama, fungsi utama tidak melakukan apa pun yang berbahaya, tetapi sebenarnya ia menggantikan bagian <code>mcoemcpy.exe</code> file <code>mcoemcpy.exe</code> sah, file biner.  Ini menghasilkan shellcode yang tugasnya memanggil fungsi untuk membaca shellcode terenkripsi dari tahap kedua dari file <code>mcscentr.adf</code> . <br><br>  Kode pseudo berikut digunakan untuk membuat kode shell: <br><br> <code>x = False i = 0 <br> buff = genRandom() <br> opc1 = [0x58,0x59,0x5a,0x5b] <br> opc2 = [0x50,0x51,0x52,0x53,0x54,0x55,0x56,0x57] <br> opc3 = [0x90,0x40,0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48, <br> 0x49,0x4a,0x4b] <br> while i &lt; len(buff): <br> currentChar = buff[i] if currentChar &lt; 0xc8: <br> buff[i] = opc1[currentChar % len(opc1)] <br> else: <br> if x: <br> buff[i] = opc2[currentChar % len(opc2)] <br> else: <br> buff[i] = opc3[currentChar % len(opc3)] x = x == False <br> i+=1</code> <br> <br>  Di bawah ini pada gambar Anda dapat melihat daftar hasil assembler: <br><br><img src="https://habrastorage.org/webt/i8/4y/gg/i84yggcraq46pahxx_g5gzha4_y.png"><br>  <i>Gambar 9. Shellcode yang dihasilkan</i> <br><br><h3>  Langkah 2‚Äì4.  Shellcode, launcher dan shellcode lagi </h3><br>  <code>{E1E4CBED-5690-4749-819D-24FB660DF55F}.dll</code> mendekripsi dan mengunduh <code>{E1E4CBED-5690-4749-819D-24FB660DF55F}.dll</code> .  Perpustakaan memuat sumber daya dan mencoba memulai layanan DeviceAssociationService.  Informasi yang didekripsi juga mengandung shellcode.  Yang terakhir mendekripsi tahap terakhir: pintu belakang. <br><br>  Varian <code>{92BA1818-0119-4F79-874E-E3BF79C355B8}.dll</code> memeriksa apakah <code>rastlsc.exe</code> dijalankan dengan <code>krv</code> sebagai parameter pertama.  Jika demikian, tugas dibuat, dan <code>rastlsc.exe</code> dieksekusi lagi, tetapi tanpa parameter ini. <br><br><h3>  Tahap 5. Backdoor </h3><br> <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> <br> <br>  Pertama, malware mencoba mengunduh sumber dayanya dan mendekripsi menggunakan algoritma RC4.  Sumber daya yang dihasilkan berisi data yang digunakan untuk mengonfigurasi backdoor.  Format konfigurasi tidak sulit ditemukan.  Menggunakan kaitai struct dan damper strukturnya, kami mendapatkan yang berikut: <br><br><img src="https://habrastorage.org/webt/wv/sq/7r/wvsq7r5rn67px5msvrjogbnoelk.jpeg"><br>  <i>Gambar 10. Struktur konfigurasi</i> <br><br>  <b>Catatan</b> : dengan pengecualian garis domain_encoding_str dan pustaka httpprov, data berubah dari sampel ke sampel.  Kunci registri hampir sama, tetapi mereka memiliki skema serupa: <code>\HKCU\SOFTWARE\Classes\AppX[a-f0-9]{32}</code> , tidak ada yang luar biasa. <br><br>  Program jahat menerima 10 byte pertama dari nama pengguna (UTF-16), mengkodekannya dengan string tiga huruf <code>mutex_encoding_str</code> di UTF-16 dan mengkodekannya dalam heksadesimal.  Hasilnya digunakan sebagai nama mutex.  Misalnya, untuk pengguna yang namanya dimulai dengan <code>abc</code> dan kunci dalam bentuk <code>vwx</code> , mutex akan menjadi <code>\Sessions\1\BaseNamedObjects\170015001b</code> . <br><br>  Backdoor mencakup pemuat PE yang memuat pustaka <code>HTTPProv.dll</code> ke dalam memori, memanggil titik masuk, dan kemudian memanggil fungsi ekspor <code>CreateInstance</code> . <br><br><h3>  Komunikasi </h3><br>  Backdoor menggunakan protokol komunikasi TCP standar melalui port <code>25123</code> .  Untuk mendapatkan alamat IP server, backdoor terlebih dahulu membuat kueri DNS tertentu. <br><br>  Program jahat memilih salah satu dari tiga domain dari konfigurasi dan menambahkan subdomain khusus yang dihasilkan menggunakan dua nilai.  Nilai pertama adalah nama komputer dalam panjang 16 byte.  Yang kedua adalah ID versi empat byte.  Kode Python 2 di bawah ini adalah algoritma pengkodean: <br><br> <code>letters=domain_encoding_str # ‚Äúghijklmnop‚Äù hex_pc_name=pc_name.encode(‚ÄúUTF-16LE‚Äù).encode(‚Äúhex‚Äù) s='' <br> for c in hex_pc_name: <br> if 0x2f &lt; ord(c) &lt; 0x3a: <br> s+=letters[ord(c) - 0x30] <br> else: <br> s+=c</code> <br> <br>  Misalnya, jika nama komputer adalah <code>random-pc</code> , dan ID versi adalah 0x0a841523, maka domain berikut ini dihasilkan: <br> <code>niggmhggmeggmkggmfggmdggidggngggmjgg.ijhlokga.dwarduong[.]com</code> <br> <br>  Ekspresi reguler berikut dapat digunakan untuk memberi label server C&amp;C dari backdoor ini: <br> <code>[ghijklmnopabcdef]{4-60}\.[ghijklmnopabcdef]{8}\.[az]+\.[az]+</code> <br> <br>  Jika alamat IP milik domain tertentu, malware mencoba membuat koneksi TCP melalui port <code>25123</code> .  Setiap sampel memiliki tiga nama domain berbeda yang digunakan untuk menemukan server C&amp;C. <br><br>  Proses komunikasi dienkripsi melalui RC4 dan dikompresi menggunakan LZMA.  Dimungkinkan untuk mendekripsi lalu lintas, karena kunci ditambahkan ke awal paket.  Formatnya adalah sebagai berikut: <br> <code>[ RC4 (4 )][ ]</code> <br> <br>  Setiap byte kunci dihasilkan oleh fungsi <code>rand</code> .  Setelah mendekripsi dan membongkar paket, data memiliki format berikut: <br> <code>[dw:][dw:][dw: ][dw: ][dw:] [dw:]</code> <br> <br>  Pertama kali klien terhubung ke server, UUID ditransmisikan, yang digunakan sebagai pengidentifikasi sesi.  Yang terakhir disimpan dalam kunci registri sebagai data biner: <code>HKCU\SOFTWARE\Classes\ AppXc52346ec40fb4061ad96be0e6cb7d16a\DefaultIcon</code> <br><br>  Seperti yang kami katakan sebelumnya, pintu belakang juga berisi perpustakaan yang disebut <code>HTTPprov</code> .  Ini digunakan sebagai cara alternatif untuk berkomunikasi dengan server.  File DLL mengirimkan permintaan POST melalui HTTP.  Ini juga mendukung HTTPS dan proksi menggunakan SOCKS5, SOCKS4a dan SOCKS4.  Perpustakaan dihubungkan secara statis dengan <code>libcurl</code> . <br><br>  Setelah inisialisasi, entri registri akan dibuat - perintah untuk pintu belakang untuk lebih lanjut menggunakan HTTP untuk berkomunikasi dengan server perintah: <code>HKCU\SOFTWARE\Classes\ CLSID{E3517E26-8E93-458D-A6DF-8030BC80528B}</code> . <br><br>  Aplikasi klien standar digunakan: <code>Mozilla/4.0 ( ; MSIE 8.0; Windows NT 6.0; Trident/4.0)</code> . <br><br>  Karakteristik utama perpustakaan ini adalah algoritma enkripsi khusus untuk pengidentifikasi sumber daya universal.  Bagian sumber daya dari URI dibuat menggunakan pseudocode berikut: <br><br> <code>buffEnd = ((DWORD)genRand(4) % 20) + 10 + buff; while (buff &lt; buffEnd){ <br> b=genRand(16); <br> if (b[0] - 0x50 &gt; 0x50) <br> t=0; <br> else <br> *buf++= UPPER(vowels[b[1] % 5]); <br> v=consonants[b[1]%21]); if (!t) <br> v=UPPER(v); <br> *buff++= v; <br> if (v!='h' &amp;&amp; b[2] - 0x50 &lt; 0x50) <br> *buff++= 'h'; <br> *buff++= vowels[b[4] % 5]; <br> if (b[5] &lt; 0x60) <br> *buff++= vowels[b[6] % 5]; <br> *buff++= consonants[b[7] % 21]; <br> if (b[8] &lt; 0x50) <br> *buff++= vowels[b[9] % 5]; <br> *buff++= '-'; <br> }; <br> *buff='\0';</code> <br> <br>  <b>Catatan</b> : untuk kejelasan, bagian yang bertanggung jawab untuk memeriksa panjang string telah dihapus dari kode. <br><br>  Untuk mendapatkan pengenal dari string yang dihasilkan, dua angka ditambahkan menggunakan algoritma verifikasi jumlah khusus: <br><br> <code>checksum=crc32(buff) <br> num2=(checksum &gt;&gt; 16) + (checksum &amp; 0xffff) * 2 <br> num1=(num2 ^ 1) &amp; 0xf <br> URL=GENERATED_DOMAIN+ ‚Äú/‚Äù + num1 + ‚Äú/‚Äù + num2 + ‚Äú-‚Äù + buff</code> <br> <br>  Menambahkan generator URI perpustakaan <code>HTTPprov</code> , kami mendapatkan URL berikut: <br> <code>hXXp://niggmhggmeggmkggmfggmdggidggngggmjgg.ijhlokga.aisicoin[.]com/ 13/139756-Ses-Ufali-L</code> <br> <br><h3>  Tim </h3><br>  Setelah menerima pengidentifikasi sesi SESSIONID, pintu belakang membuat sidik jari sistem.  Paket ini dibangun sebagai berikut (inden dalam paket - deskripsi): <br><br>  <i>0x000</i> - byte: nilai berubah di setiap versi <br>  <i>0x001</i> - 0x01: byte kode-keras <br>  <i>0x002</i> - bool: hak istimewa tinggi <br>  <i>0x003</i> - dword: ID versi <br>  <i>0x007</i> - string (UTF-16), nama komputer (maks. 0x20) <br>  <i>0x027</i> - string (UTF-16), nama pengguna <br>  <i>0x079</i> - hasil dari kueri registri di <code>HKLM\SOFTWARE\Microsoft\Windows NT\ CurrentVersion</code> Nilai <code>HKLM\SOFTWARE\Microsoft\Windows NT\ CurrentVersion</code> : <code>ProductName</code> , <code>CSDVersion</code> , <code>CurrentVersion</code> , <code>ReleaseId</code> , <code>CurrentBuildNumber</code> dan hasil dari panggilan <code>IsWow64Process (x86|x64)</code> <br>  <i>0x179</i> - format selanjutnya dari string% s (% s);  digantikan oleh ( <code>GetVolumeInformationW:VolumeNameBuffer</code> ), <code>VolumePathNames</code> <br>  <i>0x279</i> - Disk fisik, kontrol I / O pada perangkat PhysicalDriveIOControl 0x2D1400 (IOCTL_STORAGE_QUERY_ PROPERTY) (VolSerialNumber) <br>  <i>0x379</i> - <i>wmi</i> <code>SELECT SerialNumber FROM Win32_BaseBoard</code> <br>  <i>0x3f9</i> - Dapatkan tanggal dan waktu saat ini GetSystemTimeAsFileTime <br>  <i>0x400</i> - bool: tidak diketahui <br>  <i>0x401</i> - dword: diterima setelah mendekripsi sumber <br><br>  Berikut adalah contoh sidik jari sistem: <br><br><img src="https://habrastorage.org/webt/s5/kg/rj/s5kgrj1nop52oeuj-xgop8c7zsa.jpeg"><br>  <i>Gambar 11. Sidik jari sistem</i> <br><br>  Ini adalah backdoor lengkap yang menyediakan operator dengan sejumlah fitur: memanipulasi file, registri dan proses, mengunduh komponen tambahan, memperoleh sidik jari digital dari sistem.  Di bawah ini adalah angka dan deskripsi dari perintah yang didukung: <br><br>  0 - sidik jari digital <br>  1 - mengatur ID sesi <br>  2 - membuat proses dan mendapatkan hasil (menggunakan saluran program) <br>  3 - mengatur penghitung upaya koneksi <br>  4 - menunda waktu pemungutan suara <br>  5 - membaca file atau kunci registri dan mempertimbangkan MD5 <br>  6 - membuat proses <br>  7 - membuat file, entri registri, atau streaming dalam memori <br>  8 - menulis ke registri <br>  9 - polling registri <br>  10 - mencari file dalam sistem <br>  11 - mentransfer file ke direktori lain <br>  12 - menghapus file dari disk <br>  13 - mendapatkan daftar disk yang ditandai dalam sistem menggunakan fungsi <br> <code>GetLogicalDriveStringW</code> <br>  14 - membuat direktori <br>  15 - menghapus direktori <br>  16 - membaca file dari offset <br>  17 - memanggil loader PE (beralih ke komunikasi melalui <code>HTTPprov</code> ) <br>  18 - [tidak diketahui] <br>  19 - 0: polling nilai dalam registri;  1: implementasi dan implementasi program <br>  20 - mengatur variabel lingkungan <br>  21 - meluncurkan shellcode di utas baru <br>  22 - mengembalikan variabel lingkungan <br>  23 dalam versi baru - restart sendiri jika variabel lingkungan APPL tidak ada <br><br><h2>  Kesimpulan </h2><br>  OceanLotus tetap sangat aktif dan terus memperbarui toolkit. <br>  Kelompok ini berupaya menyembunyikan kegiatannya, untuk ini para penyerang dengan hati-hati memilih para korban, membatasi penyebaran malware, menggunakan beberapa server agar tidak menarik perhatian ke domain atau alamat IP yang sama.  Dekripsi komponen yang diimplementasikan dan teknik pemuatan samping, meskipun popularitasnya luas, memungkinkan untuk menghindari deteksi, karena pekerjaan penyerang dalam kasus ini disamarkan sebagai aplikasi yang sah. <br><br><h2>  Indikator Kompromi (IoC) </h2><br><h3>  Sampel </h3><br><h4>  Tabel 1: pipet </h4><br><img src="https://habrastorage.org/webt/4z/vz/kh/4zvzkhbbyci_fp6w6jyedbpn42i.png"><br><br><h4>  Tabel 2: Perpustakaan </h4><br><img src="https://habrastorage.org/webt/0g/9i/2r/0g9i2rys-bufj_lmi9xqb7orl3g.png"><br><br><h3>  Jaringan </h3><br><h4>  Alamat IP </h4><br> <code>46.183.220.81 <br> 46.183.220.82 <br> 46.183.222.82 <br> 46.183.222.83 <br> 46.183.222.84 <br> 46.183.223.106 <br> 46.183.223.107 <br> 74.121.190.130 <br> 74.121.190.150 <br> 79.143.87.230</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id421779/">https://habr.com/ru/post/id421779/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id421765/index.html">Apa itu aplikasi web dalam produksi?</a></li>
<li><a href="../id421767/index.html">Penambang ditawarkan untuk memberikan status wiraswasta</a></li>
<li><a href="../id421769/index.html">Buku "Deep Learning on R"</a></li>
<li><a href="../id421773/index.html">Saat tim teknisi menciptakan perusahaan mereka, musim 3 (akhirnya terbang!)</a></li>
<li><a href="../id421775/index.html">Jaringan saraf dilatih untuk mengenali depresi dengan cara bicara sewenang-wenang seseorang tanpa konteks</a></li>
<li><a href="../id421783/index.html">Kerangka Huex Manajemen Negara yang Menyenangkan</a></li>
<li><a href="../id421785/index.html">California berada di ambang penolakan lengkap karbon dalam produksi energi</a></li>
<li><a href="../id421787/index.html">Pengembangan arsitektur proyek, kapal dan JavaScript</a></li>
<li><a href="../id421789/index.html">Buat frontend "backend" lagi</a></li>
<li><a href="../id421791/index.html">Masalah Etis Kecerdasan Buatan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>