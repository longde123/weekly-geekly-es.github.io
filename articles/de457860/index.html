<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôãüèø ‚úäüèø üëÇüèº Entwicklung einer Anwendung f√ºr das Streaming mit Node.js und React ü§πüèø üôÜüèæ üëáüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der Autor des Materials, dessen √úbersetzung wir heute ver√∂ffentlichen, sagt, dass er an einer Anwendung arbeitet, mit der Sie Streaming-Broadcasts (St...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entwicklung einer Anwendung f√ºr das Streaming mit Node.js und React</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/457860/">  Der Autor des Materials, dessen √úbersetzung wir heute ver√∂ffentlichen, sagt, dass er an einer Anwendung arbeitet, mit der Sie Streaming-Broadcasts (Streaming) der Vorg√§nge auf dem Desktop des Benutzers organisieren k√∂nnen. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/6d3/aa0/af1/6d3aa0af110dff937f5e88ba5ae02921.png" alt="Bild"></a> <br><br>  Die Anwendung empf√§ngt vom Streamer einen Stream im RTMP-Format und konvertiert ihn in einen HLS-Stream, der in den Browsern der Zuschauer abgespielt werden kann.  In diesem Artikel wird erl√§utert, wie Sie mit Node.js und React Ihre eigene Streaming-Anwendung erstellen k√∂nnen.  Wenn Sie es gewohnt sind, die Idee zu sehen, die Sie interessiert, tauchen Sie sofort in den Code ein. Sie k√∂nnen jetzt in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dieses</a> Repository schauen. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Webserverentwicklung mit Basisauthentifizierungssystem</font> </h2><br>  Erstellen wir einen einfachen Webserver auf Basis von Node.js, auf dem mithilfe der Bibliothek passport.js eine lokale Benutzerauthentifizierungsstrategie implementiert wird.  Wir werden MongoDB als permanente Speicherung von Informationen verwenden.  Wir werden mit der Datenbank unter Verwendung der Mongoose ODM-Bibliothek arbeiten. <br><br>  Initialisieren Sie ein neues Projekt: <br><br><pre><code class="plaintext hljs">$ npm init</code> </pre> <br>  Installieren Sie die Abh√§ngigkeiten: <br><br><pre> <code class="plaintext hljs">$ npm install axios bcrypt-nodejs body-parser bootstrap config connect-ensure-login connect-flash cookie-parser ejs express express-session mongoose passport passport-local request session-file-store --save-dev</code> </pre> <br>  Erstellen Sie im Projektverzeichnis zwei Ordner - <code>client</code> und <code>server</code> .  Der auf React basierende Frontend-Code wird im <code>client</code> Ordner gespeichert, und der Backend-Code wird im <code>server</code> Ordner gespeichert.  Jetzt arbeiten wir im Serverordner.  Wir werden n√§mlich passport.js verwenden, um ein Authentifizierungssystem zu erstellen.  Wir haben bereits die Module passport und passport-local installiert.  Bevor wir die lokale Benutzerauthentifizierungsstrategie beschreiben, erstellen Sie eine <code>app.js</code> Datei und f√ºgen Sie den Code hinzu, der zum Starten eines einfachen Servers erforderlich ist.  Wenn Sie diesen Code selbst ausf√ºhren, stellen Sie sicher, dass das MongoDB-DBMS installiert ist und als Dienst ausgef√ºhrt wird. <br><br>  Hier ist der Code f√ºr die Datei, die sich im Projekt unter <code>server/app.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>),    Session = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express-session'</span></span>),    bodyParse = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'body-parser'</span></span>),    mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongoose'</span></span>),    middleware = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'connect-ensure-login'</span></span>),    FileStore = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'session-file-store'</span></span>)(Session),    config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./config/default'</span></span>),    flash = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'connect-flash'</span></span>),    port = <span class="hljs-number"><span class="hljs-number">3333</span></span>,    app = express(); mongoose.connect(<span class="hljs-string"><span class="hljs-string">'mongodb://127.0.0.1/nodeStream'</span></span> , { <span class="hljs-attr"><span class="hljs-attr">useNewUrlParser</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); app.set(<span class="hljs-string"><span class="hljs-string">'view engine'</span></span>, <span class="hljs-string"><span class="hljs-string">'ejs'</span></span>); app.set(<span class="hljs-string"><span class="hljs-string">'views'</span></span>, path.join(__dirname, <span class="hljs-string"><span class="hljs-string">'./views'</span></span>)); app.use(express.static(<span class="hljs-string"><span class="hljs-string">'public'</span></span>)); app.use(flash()); app.use(<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'cookie-parser'</span></span>)()); app.use(bodyParse.urlencoded({<span class="hljs-attr"><span class="hljs-attr">extended</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>})); app.use(bodyParse.json({<span class="hljs-attr"><span class="hljs-attr">extended</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>})); app.use(Session({    <span class="hljs-attr"><span class="hljs-attr">store</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStore({        <span class="hljs-attr"><span class="hljs-attr">path</span></span> : <span class="hljs-string"><span class="hljs-string">'./server/sessions'</span></span>    }),    <span class="hljs-attr"><span class="hljs-attr">secret</span></span>: config.server.secret,    <span class="hljs-attr"><span class="hljs-attr">maxAge</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().now + <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">60</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1000</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">30</span></span></span></span></span><span class="hljs-function">) })); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">app</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, middleware.ensureLoggedIn(</span></span></span><span class="hljs-function">), (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) =&gt;</span></span> {    res.render(<span class="hljs-string"><span class="hljs-string">'index'</span></span>); }); app.listen(port, () =&gt; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`App listening on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${port}</span></span></span><span class="hljs-string">!`</span></span>));</code> </pre> <br>  Wir haben die gesamte f√ºr die Anwendung erforderliche Middleware heruntergeladen, die mit MongoDB verbunden ist, und die Express-Sitzung f√ºr die Verwendung des Dateispeichers konfiguriert.  Durch das Speichern von Sitzungen k√∂nnen diese nach einem Neustart des Servers wiederhergestellt werden. <br><br>  Jetzt beschreiben wir die Strategien von passport.js zum Organisieren der Benutzerregistrierung und -authentifizierung.  Erstellen Sie einen <code>auth</code> im Serverordner und legen Sie die Datei <code>passport.js</code> darin ab.  Folgendes sollte in der Datei <code>server/auth/passport.js</code> enthalten sein: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> passport = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'passport'</span></span>),    LocalStrategy = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'passport-local'</span></span>).Strategy,    User = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../database/Schema'</span></span>).User,    shortid = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'shortid'</span></span>); passport.serializeUser( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user, cb</span></span></span><span class="hljs-function">) =&gt;</span></span> {    cb(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, user); }); passport.deserializeUser( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj, cb</span></span></span><span class="hljs-function">) =&gt;</span></span> {    cb(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, obj); }); <span class="hljs-comment"><span class="hljs-comment">//  passport,    passport.use('localRegister', new LocalStrategy({        usernameField: 'email',        passwordField: 'password',        passReqToCallback: true    },    (req, email, password, done) =&gt; {        User.findOne({$or: [{email: email}, {username: req.body.username}]}, (err, user) =&gt; {            if (err)                return done(err);            if (user) {                if (user.email === email) {                    req.flash('email', 'Email is already taken');                               if (user.username === req.body.username) {                    req.flash('username', 'Username is already taken');                               return done(null, false);            } else {                let user = new User();                user.email = email;                user.password = user.generateHash(password);                user.username = req.body.username;                user.stream_key = shortid.generate();                user.save( (err) =&gt; {                    if (err)                        throw err;                    return done(null, user);                });                   });    })); //  passport,    passport.use('localLogin', new LocalStrategy({        usernameField: 'email',        passwordField: 'password',        passReqToCallback: true    },    (req, email, password, done) =&gt; {        User.findOne({'email': email}, (err, user) =&gt; {            if (err)                return done(err);            if (!user)                return done(null, false, req.flash('email', 'Email doesn\'t exist.'));            if (!user.validPassword(password))                return done(null, false, req.flash('password', 'Oops! Wrong password.'));            return done(null, user);        });    })); module.exports = passport;</span></span></code> </pre> <br>  Au√üerdem m√ºssen wir das Schema f√ºr das Benutzermodell beschreiben (es hei√üt <code>UserSchema</code> ).  Erstellen Sie den <code>database</code> im <code>UserSchema.js</code> und darin die Datei <code>UserSchema.js</code> . <br><br>  Hier ist der Code f√ºr die Datei <code>server/database.UserSchema.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongoose'</span></span>),    bcrypt  = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'bcrypt-nodejs'</span></span>),    shortid = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'shortid'</span></span>),    Schema = mongoose.Schema; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> UserSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Schema({    <span class="hljs-attr"><span class="hljs-attr">username</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>,    <span class="hljs-attr"><span class="hljs-attr">email</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>,    <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>,    <span class="hljs-attr"><span class="hljs-attr">stream_key</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, }); UserSchema.methods.generateHash = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">password</span></span></span><span class="hljs-function">) =&gt;</span></span> {    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bcrypt.hashSync(password, bcrypt.genSaltSync(<span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-literal"><span class="hljs-literal">null</span></span>); }; UserSchema.methods.validPassword = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">password</span></span></span><span class="hljs-function">)</span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bcrypt.compareSync(password, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password); }; UserSchema.methods.generateStreamKey = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> shortid.generate(); }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = UserSchema;</code> </pre> <br>  <code>UserSchema</code> verf√ºgt √ºber drei Methoden.  Die <code>generateHash</code> Methode dient zum Konvertieren eines Kennworts in Form von Klartext in einen bcrypt-Hash.  Wir verwenden diese Methode in der Passstrategie, um von Benutzern eingegebene Passw√∂rter in bcrypt-Hashes umzuwandeln.  Die empfangenen Passwort-Hashes werden dann in der Datenbank gespeichert.  Die <code>validPassword</code> Methode akzeptiert das vom Benutzer eingegebene Kennwort und √ºberpr√ºft es, indem es seinen Hash mit dem in der Datenbank gespeicherten Hash vergleicht.  Die <code>generateStreamKey</code> Methode <code>generateStreamKey</code> eindeutige Zeichenfolgen, die wir als Streaming-Schl√ºssel (Stream-Schl√ºssel) f√ºr RTMP-Clients an Benutzer √ºbertragen. <br><br>  Hier ist der <code>server/database/Schema.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongoose'</span></span>); exports.User = mongoose.model(<span class="hljs-string"><span class="hljs-string">'User'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./UserSchema'</span></span>));</code> </pre> <br>  <code>UserSchema</code> wir die Passstrategien definiert, das <code>UserSchema</code> Schema beschrieben und ein darauf basierendes Modell erstellt haben, initialisieren wir den Pass in <code>app.js</code> <br><br>  Hier ist der Code, um die Datei <code>server/app.js</code> zu erg√§nzen: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//       ,     const passport = require('./auth/passport'); app.use(passport.initialize()); app.use(passport.session());</span></span></code> </pre> <br>  Au√üerdem m√ºssen neue Routen in <code>app.js</code> registriert <code>app.js</code>  <code>server/app.js</code> Sie dazu den folgenden Code zu <code>server/app.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    app.use('/login', require('./routes/login')); app.use('/register', require('./routes/register'));</span></span></code> </pre> <br>  Erstellen Sie die Dateien <code>login.js</code> und <code>register.js</code> im Ordner <code>login.js</code> im <code>login.js</code> .  In diesen Dateien definieren wir einige der oben genannten Routen und verwenden die Pass-Middleware, um die Registrierung und Benutzerauthentifizierung zu organisieren. <br><br>  Hier ist der Code f√ºr die <code>server/routes/login.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>),    router = express.Router(),    passport = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'passport'</span></span>); router.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>,    <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'connect-ensure-login'</span></span>).ensureLoggedOut(),    (req, res) =&gt; {        res.render(<span class="hljs-string"><span class="hljs-string">'login'</span></span>, {            <span class="hljs-attr"><span class="hljs-attr">user</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>,            <span class="hljs-attr"><span class="hljs-attr">errors</span></span> : {                <span class="hljs-attr"><span class="hljs-attr">email</span></span> : req.flash(<span class="hljs-string"><span class="hljs-string">'email'</span></span>),                <span class="hljs-attr"><span class="hljs-attr">password</span></span> : req.flash(<span class="hljs-string"><span class="hljs-string">'password'</span></span>)                   });    }); router.post(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, passport.authenticate(<span class="hljs-string"><span class="hljs-string">'localLogin'</span></span>, {    <span class="hljs-attr"><span class="hljs-attr">successRedirect</span></span> : <span class="hljs-string"><span class="hljs-string">'/'</span></span>,    <span class="hljs-attr"><span class="hljs-attr">failureRedirect</span></span> : <span class="hljs-string"><span class="hljs-string">'/login'</span></span>,    <span class="hljs-attr"><span class="hljs-attr">failureFlash</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span> })); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = router;</code> </pre> <br>  Hier ist der Code f√ºr die Datei <code>server/routes/register.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>),    router = express.Router(),    passport = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'passport'</span></span>); router.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>,    <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'connect-ensure-login'</span></span>).ensureLoggedOut(),    (req, res) =&gt; {        res.render(<span class="hljs-string"><span class="hljs-string">'register'</span></span>, {            <span class="hljs-attr"><span class="hljs-attr">user</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>,            <span class="hljs-attr"><span class="hljs-attr">errors</span></span> : {                <span class="hljs-attr"><span class="hljs-attr">username</span></span> : req.flash(<span class="hljs-string"><span class="hljs-string">'username'</span></span>),                <span class="hljs-attr"><span class="hljs-attr">email</span></span> : req.flash(<span class="hljs-string"><span class="hljs-string">'email'</span></span>)                   });    }); router.post(<span class="hljs-string"><span class="hljs-string">'/'</span></span>,    <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'connect-ensure-login'</span></span>).ensureLoggedOut(),    passport.authenticate(<span class="hljs-string"><span class="hljs-string">'localRegister'</span></span>, {        <span class="hljs-attr"><span class="hljs-attr">successRedirect</span></span> : <span class="hljs-string"><span class="hljs-string">'/'</span></span>,        <span class="hljs-attr"><span class="hljs-attr">failureRedirect</span></span> : <span class="hljs-string"><span class="hljs-string">'/register'</span></span>,        <span class="hljs-attr"><span class="hljs-attr">failureFlash</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>    }) ); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = router;</code> </pre> <br>  Wir verwenden die ejs Templating Engine.  F√ºgen Sie die Vorlagendateien <code>login.ejs</code> und <code>register.ejs</code> zum Ordner <code>views</code> hinzu, der sich im <code>login.ejs</code> befindet. <br><br>  Hier ist der Inhalt der <code>server/views/login.ejs</code> : <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">header.ejs</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">navbar.ejs</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container app mt-5"</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h4</span></span></span><span class="hljs-tag">&gt;</span></span>Login<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h4</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-4"</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"row"</span></span></span><span class="hljs-tag">&gt;</span></span>        <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/login"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"col-xs-12 col-sm-12 col-md-8 col-lg-6"</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>Email address<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"email"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"email"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Enter email"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">errors.email.length</span></span></span><span class="hljs-tag">) { %&gt;</span></span>                    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-text text-danger"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">errors.email</span></span></span><span class="hljs-tag"> %&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> } %&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>Password<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">errors.password.length</span></span></span><span class="hljs-tag">) { %&gt;</span></span>                    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-text text-danger"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">errors.password</span></span></span><span class="hljs-tag"> %&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> } %&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"leader"</span></span></span><span class="hljs-tag">&gt;</span></span>                    Don't have an account? Register <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/register"</span></span></span><span class="hljs-tag">&gt;</span></span>here<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span>.                <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-dark btn-block"</span></span></span><span class="hljs-tag">&gt;</span></span>Login<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span>        <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">footer.ejs</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Folgendes sollte in der Datei <code>server/views/register.ejs</code> enthalten sein: <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">header.ejs</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">navbar.ejs</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container app mt-5"</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h4</span></span></span><span class="hljs-tag">&gt;</span></span>Register<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h4</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-4"</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"row"</span></span></span><span class="hljs-tag">&gt;</span></span>        <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/register"</span></span></span><span class="hljs-tag">              </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">              </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"col-xs-12 col-sm-12 col-md-8 col-lg-6"</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>Username<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Enter username"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">errors.username.length</span></span></span><span class="hljs-tag">) { %&gt;</span></span>                    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-text text-danger"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">errors.username</span></span></span><span class="hljs-tag"> %&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> } %&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>Email address<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"email"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"email"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Enter email"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">errors.email.length</span></span></span><span class="hljs-tag">) { %&gt;</span></span>                    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-text text-danger"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">errors.email</span></span></span><span class="hljs-tag"> %&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> } %&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>Password<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span>                <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"leader"</span></span></span><span class="hljs-tag">&gt;</span></span>                    Have an account? Login <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/login"</span></span></span><span class="hljs-tag">&gt;</span></span>here<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span>.                <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>            <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-dark btn-block"</span></span></span><span class="hljs-tag">&gt;</span></span>Register<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span>        <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">footer.ejs</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Wir k√∂nnen sagen, dass wir die Arbeit am Authentifizierungssystem abgeschlossen haben.  Jetzt beginnen wir mit der Erstellung des n√§chsten Teils des Projekts und konfigurieren den RTMP-Server. <br><br><h2>  <font color="#3AC1EF">Konfigurieren Sie den RTMP-Server</font> </h2><br>  RTMP (Real-Time Messaging Protocol) ist ein Protokoll, das f√ºr die Hochleistungs√ºbertragung von Video, Audio und verschiedenen Daten zwischen dem Bandlaufwerk und dem Server entwickelt wurde.  Twitch, Facebook, YouTube und viele andere Streaming-Sites akzeptieren RTMP-Streams und codieren sie in HTTP-Streams (HLS-Format), bevor diese Streams auf ihre CDNs √ºbertragen werden, um ihre hohe Verf√ºgbarkeit sicherzustellen. <br><br>  Wir verwenden das Node-Media-Server-Modul - Node.js-Implementierung des RTMP-Medienservers.  Dieser Medienserver akzeptiert RTMP-Streams und konvertiert sie mithilfe des Multimedia-Frameworks ffmpeg in HLS / DASH.  Damit das Projekt erfolgreich funktioniert, muss ffmpeg auf Ihrem System installiert sein.  Wenn Sie unter Linux arbeiten und ffmpeg bereits installiert haben, k√∂nnen Sie den Pfad dazu ermitteln, indem Sie den folgenden Befehl vom Terminal aus ausf√ºhren: <br><br><pre> <code class="plaintext hljs">$ which ffmpeg # /usr/bin/ffmpeg</code> </pre> <br>  F√ºr die Arbeit mit dem Node-Media-Server-Paket wird ffmpeg Version 4.x empfohlen.  Sie k√∂nnen die installierte Version von ffmpeg folgenderma√üen √ºberpr√ºfen: <br><br><pre> <code class="plaintext hljs">$ ffmpeg --version # ffmpeg version 4.1.3-0york1~18.04 Copyright (c) 2000-2019 the # FFmpeg developers built with gcc 7 (Ubuntu 7.3.0-27ubuntu1~18.04)</code> </pre> <br>  Wenn Sie ffmpeg nicht installiert haben und Ubuntu ausf√ºhren, k√∂nnen Sie dieses Framework installieren, indem Sie den folgenden Befehl ausf√ºhren: <br><br><pre> <code class="plaintext hljs">#    PPA-.     PPA,    # ffmpeg  3.x. $ sudo add-apt-repository ppa:jonathonf/ffmpeg-4 $ sudo apt install ffmpeg</code> </pre> <br>  Wenn Sie unter Windows arbeiten, k√∂nnen Sie ffmpeg- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Builds</a> f√ºr Windows herunterladen. <br><br>  F√ºgen Sie dem Projekt die Konfigurationsdatei <code>server/config/default.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = {    <span class="hljs-attr"><span class="hljs-attr">server</span></span>: {        <span class="hljs-attr"><span class="hljs-attr">secret</span></span>: <span class="hljs-string"><span class="hljs-string">'kjVkuti2xAyF3JGCzSZTk0YWM5JhI9mgQW4rytXc'</span></span>    },    <span class="hljs-attr"><span class="hljs-attr">rtmp_server</span></span>: {        <span class="hljs-attr"><span class="hljs-attr">rtmp</span></span>: {            <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-number"><span class="hljs-number">1935</span></span>,            <span class="hljs-attr"><span class="hljs-attr">chunk_size</span></span>: <span class="hljs-number"><span class="hljs-number">60000</span></span>,            <span class="hljs-attr"><span class="hljs-attr">gop_cache</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,            <span class="hljs-attr"><span class="hljs-attr">ping</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>,            <span class="hljs-attr"><span class="hljs-attr">ping_timeout</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span>        },        <span class="hljs-attr"><span class="hljs-attr">http</span></span>: {            <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-number"><span class="hljs-number">8888</span></span>,            <span class="hljs-attr"><span class="hljs-attr">mediaroot</span></span>: <span class="hljs-string"><span class="hljs-string">'./server/media'</span></span>,            <span class="hljs-attr"><span class="hljs-attr">allow_origin</span></span>: <span class="hljs-string"><span class="hljs-string">'*'</span></span>        },        <span class="hljs-attr"><span class="hljs-attr">trans</span></span>: {            <span class="hljs-attr"><span class="hljs-attr">ffmpeg</span></span>: <span class="hljs-string"><span class="hljs-string">'/usr/bin/ffmpeg'</span></span>,            <span class="hljs-attr"><span class="hljs-attr">tasks</span></span>: [                                   app: <span class="hljs-string"><span class="hljs-string">'live'</span></span>,                    <span class="hljs-attr"><span class="hljs-attr">hls</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,                    <span class="hljs-attr"><span class="hljs-attr">hlsFlags</span></span>: <span class="hljs-string"><span class="hljs-string">'[hls_time=2:hls_list_size=3:hls_flags=delete_segments]'</span></span>,                    <span class="hljs-attr"><span class="hljs-attr">dash</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,                    <span class="hljs-attr"><span class="hljs-attr">dashFlags</span></span>: <span class="hljs-string"><span class="hljs-string">'[f=dash:window_size=3:extra_window_size=5]'</span></span>   }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = config;</code> </pre> <br>  Ersetzen Sie den Wert der Eigenschaft <code>ffmpeg</code> durch den Pfad, in dem ffmpeg auf Ihrem System installiert ist.  Wenn Sie unter Windows arbeiten und die Windows-Assembly ffmpeg √ºber den obigen Link heruntergeladen haben, vergessen Sie nicht, dem Dateinamen die Erweiterung <code>.exe</code> hinzuzuf√ºgen.  Dann sieht das entsprechende Fragment des obigen Codes folgenderma√üen aus: <br><br><pre> <code class="plaintext hljs">const config = {        ....        trans: {            ffmpeg: 'D:/ffmpeg/bin/ffmpeg.exe',            ...          };</code> </pre> <br>  Installieren Sie nun Node-Media-Server, indem Sie den folgenden Befehl ausf√ºhren: <br><br><pre> <code class="plaintext hljs">$ npm install node-media-server --save</code> </pre> <br>  Erstellen Sie eine Datei <code>media_server.js</code> im <code>media_server.js</code> . <br><br>  Hier ist der Code, der in <code>server/media_server.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> NodeMediaServer = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'node-media-server'</span></span>),    config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./config/default'</span></span>).rtmp_server; nms = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NodeMediaServer(config); nms.on(<span class="hljs-string"><span class="hljs-string">'prePublish'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (id, StreamPath, args) =&gt; {    <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> stream_key = getStreamKeyFromStreamPath(StreamPath);    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'[NodeEvent on prePublish]'</span></span>, <span class="hljs-string"><span class="hljs-string">`id=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string"> StreamPath=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${StreamPath}</span></span></span><span class="hljs-string"> args=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">JSON</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.stringify(args)}</span></span></span><span class="hljs-string">`</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getStreamKeyFromStreamPath = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">path</span></span></span><span class="hljs-function">) =&gt;</span></span> {    <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> parts = path.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parts[parts.length - <span class="hljs-number"><span class="hljs-number">1</span></span>]; }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = nms;</code> </pre> <br>  Die Verwendung des <code>NodeMediaService</code> Objekts <code>NodeMediaService</code> recht einfach.  Es stellt den RTMP-Server bereit und erm√∂glicht es Ihnen, auf Verbindungen zu warten.  Wenn der Streaming-Schl√ºssel ung√ºltig ist, kann die eingehende Verbindung abgelehnt werden.  Wir werden das Ereignis dieses <code>prePublish</code> Objekts behandeln.  Im n√§chsten Abschnitt f√ºgen wir dem <code>prePublish</code> des <code>prePublish</code> Ereignis-Listeners zus√§tzlichen Code <code>prePublish</code> .  Sie k√∂nnen eingehende Verbindungen mit ung√ºltigen Streaming-Schl√ºsseln ablehnen.  In der Zwischenzeit akzeptieren wir alle eingehenden Verbindungen zum Standard-RTMP-Port (1935).  Wir m√ºssen nur das Objekt <code>app.js</code> in die <code>node_media_server</code> und seine <code>run</code> aufrufen. <br><br>  F√ºgen Sie <code>server/app.js</code> den folgenden Code <code>server/app.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//      app.js, //  ,      const node_media_server = require('./media_server'); //   run()   , // ,    - node_media_server.run();</span></span></code> </pre> <br>  Laden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OBS</a> (Open Broadcaster Software) herunter und installieren Sie es.  √ñffnen Sie das Anwendungseinstellungsfenster und gehen Sie zum Abschnitt <code>Stream</code> .  W√§hlen Sie im Feld <code>Service</code> die <code>rtmp://127.0.0.1:1935/live</code> und geben <code>rtmp://127.0.0.1:1935/live</code> im Feld <code>Server</code> <code>rtmp://127.0.0.1:1935/live</code> .  Das Feld <code>Stream Key</code> kann leer gelassen werden.  Wenn Sie mit dem Programm die Einstellungen nicht speichern k√∂nnen, ohne dieses Feld auszuf√ºllen, k√∂nnen Sie einen beliebigen Zeichensatz eingeben.  Klicken Sie auf die Schaltfl√§che <code>Apply</code> und dann auf die Schaltfl√§che <code>OK</code> .  Klicken Sie auf die Schaltfl√§che <code>Start Streaming</code> starten, um die √úbertragung Ihres RTMP-Streams auf Ihren eigenen lokalen Server zu starten. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/323/b3f/d84/323b3fd845651845971b2b0d7a1e57fe.png"></div><br>  <i><font color="#999999">Konfigurieren Sie OBS</font></i> <br><br>  Gehen Sie zum Terminal und sehen Sie sich an, was der Medienserver dort anzeigt.  Dort sehen Sie Informationen √ºber den eingehenden Stream und die Protokolle mehrerer Ereignis-Listener. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddf/c30/bed/ddfc30bed1ce406a72cecafe2af3a8b2.png"></div><br>  <i><font color="#999999">Daten, die von einem Medienserver basierend auf Node.js an das Terminal ausgegeben werden</font></i> <br><br>  Der Medienserver bietet Zugriff auf die API, mit der Sie eine Liste der verbundenen Clients abrufen k√∂nnen.  Um diese Liste anzuzeigen, k√∂nnen Sie den Browser unter <code>http://127.0.0.1:8888/api/streams</code> .  Sp√§ter werden wir diese API in einer React-Anwendung verwenden, um eine Liste der Broadcast-Benutzer anzuzeigen.  Folgendes k√∂nnen Sie sehen, wenn Sie auf diese API zugreifen: <br><br><pre> <code class="plaintext hljs">{  "live": {    "0wBic-qV4": {      "publisher": {        "app": "live",        "stream": "0wBic-qV4",        "clientId": "WMZTQAEY",        "connectCreated": "2019-05-12T16:13:05.759Z",        "bytes": 33941836,        "ip": "::ffff:127.0.0.1",        "audio": {          "codec": "AAC",          "profile": "LC",          "samplerate": 44100,          "channels": 2        },        "video": {          "codec": "H264",          "width": 1920,          "height": 1080,          "profile": "High",          "level": 4.2,          "fps": 60             },      "subscribers": [                 "app": "live",          "stream": "0wBic-qV4",          "clientId": "GNJ9JYJC",          "connectCreated": "2019-05-12T16:13:05.985Z",          "bytes": 33979083,          "ip": "::ffff:127.0.0.1",          "protocol": "rtmp"       }</code> </pre> <br>  Jetzt ist das Backend fast fertig.  Es ist ein funktionierender Streaming-Server, der HTTP-, RTMP- und HLS-Technologien unterst√ºtzt.  Wir haben jedoch noch kein System zur √úberpr√ºfung eingehender RTMP-Verbindungen erstellt.  Damit sollten wir sicherstellen k√∂nnen, dass der Server nur Streams von authentifizierten Benutzern akzeptiert.  F√ºgen Sie dem <code>prePublish</code> Ereignishandler in der <code>server/media_server.js</code> den folgenden Code <code>server/media_server.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//       const User = require('./database/Schema').User; nms.on('prePublish', async (id, StreamPath, args) =&gt; {    let stream_key = getStreamKeyFromStreamPath(StreamPath);    console.log('[NodeEvent on prePublish]', `id=${id} StreamPath=${StreamPath} args=${JSON.stringify(args)}`);    User.findOne({stream_key: stream_key}, (err, user) =&gt; {        if (!err) {            if (!user) {                let session = nms.getSession(id);                session.reject();            } else {                // -                       }); }); const getStreamKeyFromStreamPath = (path) =&gt; {    let parts = path.split('/');    return parts[parts.length - 1]; };</span></span></code> </pre> <br>  Zum Abschluss fragen wir die Datenbank ab, um den Benutzer mit dem Streaming-Schl√ºssel zu finden.  Wenn der Schl√ºssel dem Benutzer geh√∂rt, erlauben wir dem Benutzer einfach, eine Verbindung zum Server herzustellen und seine Sendung zu ver√∂ffentlichen.  Andernfalls lehnen wir die eingehende RTMP-Verbindung ab. <br><br>  Im n√§chsten Abschnitt erstellen wir eine einfache clientseitige Anwendung, die auf React basiert.  Dies ist erforderlich, damit Zuschauer Streaming-Sendungen ansehen und Streamer ihre Streaming-Schl√ºssel generieren und anzeigen k√∂nnen. <br><br><h2>  <font color="#3AC1EF">Live-Streaming</font> </h2><br>  Gehen Sie nun zum <code>clients</code> Ordner.  Da wir eine React-Anwendung erstellen, ben√∂tigen wir ein Webpack.  Wir ben√∂tigen auch Loader, mit denen JSX-Code in JavaScript-Code √ºbersetzt wird, den Browser verstehen.  Installieren Sie die folgenden Module: <br><br><pre> <code class="plaintext hljs">$ npm install @babel/core @babel/preset-env @babel/preset-react babel-loader css-loader file-loader mini-css-extract-plugin node-sass sass-loader style-loader url-loader webpack webpack-cli react react-dom react-router-dom video.js jquery bootstrap history popper.js</code> </pre> <br>  F√ºgen Sie dem Projekt in seinem Stammverzeichnis die Konfigurationsdatei f√ºr das Webpack ( <code>webpack.config.js</code> ) hinzu: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MiniCssExtractPlugin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"mini-css-extract-plugin"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> devMode = process.env.NODE_ENV !== <span class="hljs-string"><span class="hljs-string">'production'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = {    <span class="hljs-attr"><span class="hljs-attr">entry</span></span> : <span class="hljs-string"><span class="hljs-string">'./client/index.js'</span></span>,    <span class="hljs-attr"><span class="hljs-attr">output</span></span> : {        <span class="hljs-attr"><span class="hljs-attr">filename</span></span> : <span class="hljs-string"><span class="hljs-string">'bundle.js'</span></span>,        <span class="hljs-attr"><span class="hljs-attr">path</span></span> : path.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'public'</span></span>)    },    <span class="hljs-attr"><span class="hljs-attr">module</span></span> : {        <span class="hljs-attr"><span class="hljs-attr">rules</span></span> : [                           test: <span class="hljs-regexp"><span class="hljs-regexp">/\.s?[ac]ss$/</span></span>,                <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [                    MiniCssExtractPlugin.loader,                    { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourceMap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } },                    { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'sass-loader'</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">sourceMap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }                ],            },                           <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.js$/</span></span>,                <span class="hljs-attr"><span class="hljs-attr">exclude</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span>,                <span class="hljs-attr"><span class="hljs-attr">use</span></span>: <span class="hljs-string"><span class="hljs-string">"babel-loader"</span></span>            },                           <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.woff($|\?)|\.woff2($|\?)|\.ttf($|\?)|\.eot($|\?)|\.svg($|\?)/</span></span>,                <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'url-loader'</span></span>            },                           <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.(png|jpg|gif)$/</span></span>,                <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [{                    <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'file-loader'</span></span>,                    <span class="hljs-attr"><span class="hljs-attr">options</span></span>: {                        <span class="hljs-attr"><span class="hljs-attr">outputPath</span></span>: <span class="hljs-string"><span class="hljs-string">'/'</span></span>,                    },                }],            },           },    <span class="hljs-attr"><span class="hljs-attr">devtool</span></span>: <span class="hljs-string"><span class="hljs-string">'source-map'</span></span>,    <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [        <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MiniCssExtractPlugin({            <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">"style.css"</span></span>        }),        <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webpack.ProvidePlugin({            <span class="hljs-attr"><span class="hljs-attr">$</span></span>: <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>,            <span class="hljs-attr"><span class="hljs-attr">jQuery</span></span>: <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>        })    ],    <span class="hljs-attr"><span class="hljs-attr">mode</span></span> : devMode ? <span class="hljs-string"><span class="hljs-string">'development'</span></span> : <span class="hljs-string"><span class="hljs-string">'production'</span></span>,    <span class="hljs-attr"><span class="hljs-attr">watch</span></span> : devMode,    <span class="hljs-attr"><span class="hljs-attr">performance</span></span>: {        <span class="hljs-attr"><span class="hljs-attr">hints</span></span>: process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'production'</span></span> ? <span class="hljs-string"><span class="hljs-string">"warning"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>    }, };</code> </pre> <br>  F√ºgen Sie die Datei <code>client/index.js</code> zum Projekt hinzu: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {BrowserRouter} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'bootstrap'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index.scss'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Root <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Root.js'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'root'</span></span>)){    ReactDOM.render(        <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">BrowserRouter</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">            </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Root</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml">        </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">BrowserRouter</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>,        <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'root'</span></span>)    ); }</code> </pre> <br>  Hier ist der Inhalt der <code>client/index.scss</code> : <br><br><pre> <code class="plaintext hljs">@import '~bootstrap/dist/css/bootstrap.css'; @import '~video.js/dist/video-js.css'; @import url('https://fonts.googleapis.com/css?family=Dosis'); html,body{  font-family: 'Dosis', sans-serif; }</code> </pre> <br>  Der React Router wird f√ºr das Routing verwendet.  Im Frontend verwenden wir auch Bootstrap und f√ºr Broadcasts video.js.  <code>Root.js</code> nun den <code>components</code> zum <code>Root.js</code> und die Datei <code>Root.js</code> .  Hier ist der Inhalt der <code>client/components/Root.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Router, Route} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Navbar <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Navbar'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LiveStreams <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./LiveStreams'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Settings <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Settings'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VideoPlayer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./VideoPlayer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> customHistory = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"history"</span></span>).createBrowserHistory(); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Root</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props){        <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props);       render(){        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">            &lt;Router history={customHistory} &gt;                &lt;div&gt;                    &lt;Navbar</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/&gt;                    &lt;Route exact path="/</span></span></span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">" render={props =&gt; (                        &lt;LiveStreams {...props} /&gt;                    )}/&gt;                    &lt;Route exact path="</span></span></span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/stream/</span></span></span></span><span class="hljs-function"><span class="hljs-params">:username</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">" render={(props) =&gt; (                        &lt;VideoPlayer {...props}/&gt;                    )}/&gt;                    &lt;Route exact path="</span></span></span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/settings" render={props =&gt; (                        &lt;Settings {...props} /</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;                    </span></span></span><span class="hljs-function">)}/&gt;                &lt;/</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">div</span></span></span><span class="hljs-function">&gt;            &lt;/</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Router</span></span></span><span class="hljs-function">&gt;          }</span></span></code> </pre> <br>  Die <code>&lt;Root/&gt;</code> -Komponente rendert eine <code>&lt;Router/&gt;</code> React-Komponente, die drei <code>&lt;Route/&gt;</code> -Unterkomponenten enth√§lt.  Die Komponente <code>&lt;LiveStreams/&gt;</code> zeigt eine Liste der Sendungen an.  Die Komponente <code>&lt;VideoPlayer/&gt;</code> ist f√ºr die Anzeige des Players video.js verantwortlich.  Die Komponente <code>&lt;Settings/&gt;</code> ist f√ºr die Erstellung einer Schnittstelle f√ºr die Arbeit mit Streaming-Schl√ºsseln verantwortlich. <br><br>  Erstellen Sie die <code>client/components/LiveStreams.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'axios'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Link} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./LiveStreams.scss'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> config <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../server/config/default'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Navbar</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) {        <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props);        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = {            <span class="hljs-attr"><span class="hljs-attr">live_streams</span></span>: []              componentDidMount() {        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getLiveStreams();       getLiveStreams() {        axios.get(<span class="hljs-string"><span class="hljs-string">'http://127.0.0.1:'</span></span> + config.rtmp_server.http.port + <span class="hljs-string"><span class="hljs-string">'/api/streams'</span></span>)            .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> {                <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> streams = res.data;                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (streams[<span class="hljs-string"><span class="hljs-string">'live'</span></span>] !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>)) {                    <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getStreamsInfo(streams[<span class="hljs-string"><span class="hljs-string">'live'</span></span>]);                           });       getStreamsInfo(live_streams) {        axios.get(<span class="hljs-string"><span class="hljs-string">'/streams/info'</span></span>, {            <span class="hljs-attr"><span class="hljs-attr">params</span></span>: {                <span class="hljs-attr"><span class="hljs-attr">streams</span></span>: live_streams                   }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> {            <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({                <span class="hljs-attr"><span class="hljs-attr">live_streams</span></span>: res.data            }, () =&gt; {                <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state);            });        });       render() {        <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> streams = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.live_streams.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream, index</span></span></span><span class="hljs-function">) =&gt;</span></span> {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (                &lt;div className="stream col-xs-12 col-sm-12 col-md-3 col-lg-4" key={index}&gt;                    &lt;span className="live-label"&gt;LIVE&lt;/span&gt;                    &lt;Link to={'/stream/' + stream.username}&gt;                        &lt;div className="stream-thumbnail"&gt;                            &lt;img align="center" src={'/thumbnails/' + stream.stream_key + '.png'}/&gt;                        &lt;/div&gt;                    &lt;/Link&gt;                    &lt;span className="username"&gt;                        &lt;Link to={'/stream/' + stream.username}&gt;                            {stream.username}                        &lt;/Link&gt;                    &lt;/span&gt;                &lt;/div&gt;            );        });        return (            &lt;div className="container mt-5"&gt;                &lt;h4&gt;Live Streams&lt;/h4&gt;                &lt;hr className="my-4"/&gt;                &lt;div className="streams row"&gt;                    {streams}                &lt;/div&gt;            &lt;/div&gt;       }</code> </pre> <br>  So sieht die Anwendungsseite aus. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/333/69a/7c9/33369a7c9ecfa8e08ed4c9dee6419356.png"></div><br>  <i><font color="#999999">Frontend-Streaming-Service</font></i> <br><br>  Nach dem Mounten der <code>&lt;LiveStreams/&gt;</code> -Komponente wird die NMS-API aufgerufen, um eine Liste der mit dem System verbundenen Clients abzurufen.  Die NMS-API bietet nicht viele Informationen zu Benutzern.  Insbesondere k√∂nnen wir Informationen √ºber Streaming-Schl√ºssel erhalten, √ºber die Benutzer mit einem RTMP-Server verbunden sind.  Wir werden diese Schl√ºssel verwenden, wenn wir Abfragen an die Datenbank generieren, um Informationen √ºber Benutzerkonten zu erhalten. <br><br>  In der Methode <code>getStreamsInfo</code> wir eine XHR-Anforderung an <code>/streams/info</code> <code>getStreamsInfo</code> <code>/streams/info</code> , haben jedoch noch nichts erstellt, das auf diese Anforderung antworten kann.  Erstellen Sie eine <code>server/routes/streams.js</code> mit den folgenden Inhalten: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>),    router = express.Router(),    User = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../database/Schema'</span></span>).User; router.get(<span class="hljs-string"><span class="hljs-string">'/info'</span></span>,    <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'connect-ensure-login'</span></span>).ensureLoggedIn(),    (req, res) =&gt; {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(req.query.streams){            <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> streams = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(req.query.streams);            <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> query = {<span class="hljs-attr"><span class="hljs-attr">$or</span></span>: []};            <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> stream <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> streams) {                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!streams.hasOwnProperty(stream)) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>;                query.$or.push({<span class="hljs-attr"><span class="hljs-attr">stream_key</span></span> : stream});                       User.find(query,(err, users) =&gt; {                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err)                    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (users) {                    res.json(users);                           });           }); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = router;</code> </pre> <br>  Wir √ºbergeben die von der NMS-API zur√ºckgegebenen Flussinformationen an das Backend, um Informationen √ºber verbundene Clients zu erhalten. <br><br>  Wir f√ºhren eine Datenbankabfrage durch, um eine Liste der Benutzer zu erhalten, deren Streaming-Schl√ºssel mit denen √ºbereinstimmen, die wir von der NMS-API erhalten haben.  Wir geben die Liste im JSON-Format zur√ºck.  Wir registrieren die Route in der <code>server/app.js</code> : <br><br><pre> <code class="plaintext hljs">app.use('/streams', require('./routes/streams'));</code> </pre> <br>  Als Ergebnis zeigen wir eine Liste der aktiven Sendungen an.  Diese Liste enth√§lt den Benutzernamen und die Miniaturansicht.  Wir werden am Ende des Artikels dar√ºber sprechen, wie Miniaturansichten f√ºr Sendungen erstellt werden.  Miniaturansichten sind an bestimmte Seiten gebunden, auf denen HLS-Streams mit video.js abgespielt werden. <br><br>  Erstellen Sie die <code>client/components/VideoPlayer.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> videojs <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'video.js'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'axios'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> config <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../server/config/default'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VideoPlayer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) {        <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props);        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = {            <span class="hljs-attr"><span class="hljs-attr">stream</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>,            <span class="hljs-attr"><span class="hljs-attr">videoJsOptions</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>              componentDidMount() {        axios.get(<span class="hljs-string"><span class="hljs-string">'/user'</span></span>, {            <span class="hljs-attr"><span class="hljs-attr">params</span></span>: {                <span class="hljs-attr"><span class="hljs-attr">username</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.match.params.username                   }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> {            <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({                <span class="hljs-attr"><span class="hljs-attr">stream</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,                <span class="hljs-attr"><span class="hljs-attr">videoJsOptions</span></span>: {                    <span class="hljs-attr"><span class="hljs-attr">autoplay</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>,                    <span class="hljs-attr"><span class="hljs-attr">controls</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,                    <span class="hljs-attr"><span class="hljs-attr">sources</span></span>: [{                        <span class="hljs-attr"><span class="hljs-attr">src</span></span>: <span class="hljs-string"><span class="hljs-string">'http://127.0.0.1:'</span></span> + config.rtmp_server.http.port + <span class="hljs-string"><span class="hljs-string">'/live/'</span></span> + res.data.stream_key + <span class="hljs-string"><span class="hljs-string">'/index.m3u8'</span></span>,                        <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'application/x-mpegURL'</span></span>                    }],                    <span class="hljs-attr"><span class="hljs-attr">fluid</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,                           }, () =&gt; {                <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.player = videojs(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.videoNode, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.videoJsOptions, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPlayerReady</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{                    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'onPlayerReady'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)                });            });        })       componentWillUnmount() {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.player) {            <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.player.dispose()              render() {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (            <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"row"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">                </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"col-xs-12 col-sm-12 col-md-10 col-lg-8 mx-auto mt-5"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">                    {this.state.stream ? (                        </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-vjs-player</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">                            </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">video</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{node</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> this.videoNode = node} className="video-js vjs-big-play-centered"/&gt;                        </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">                    ) : ' Loading ... '}                </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">            </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">       }</span></span></code> </pre> <br>           HLS-   video.js. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/684/b9e/7dc/684b9e7dcb9735092e54ccfc80e01be1.png"></div><br> <i><font color="#999999"></font></i> <br><br><h2> <font color="#3AC1EF">   ,     </font> </h2><br>    <code>client/components/Settings.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'axios'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Navbar</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props){        <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props);        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = {            <span class="hljs-attr"><span class="hljs-attr">stream_key</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>        };        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.generateStreamKey = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.generateStreamKey.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);       componentDidMount() {        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getStreamKey();       generateStreamKey(e){        axios.post(<span class="hljs-string"><span class="hljs-string">'/settings/stream_key'</span></span>)            .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> {                <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({                    <span class="hljs-attr"><span class="hljs-attr">stream_key</span></span> : res.data.stream_key                });            })       getStreamKey(){        axios.get(<span class="hljs-string"><span class="hljs-string">'/settings/stream_key'</span></span>)            .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> {                <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({                    <span class="hljs-attr"><span class="hljs-attr">stream_key</span></span> : res.data.stream_key                });            })       render() {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (            &lt;React.Fragment&gt;                &lt;div className="container mt-5"&gt;                    &lt;h4&gt;Streaming Key&lt;/h4&gt;                    &lt;hr className="my-4"/&gt;                    &lt;div className="col-xs-12 col-sm-12 col-md-8 col-lg-6"&gt;                        &lt;div className="row"&gt;                            &lt;h5&gt;{this.state.stream_key}&lt;/h5&gt;                        &lt;/div&gt;                        &lt;div className="row"&gt;                            &lt;button                                className="btn btn-dark mt-2"                                onClick={this.generateStreamKey}&gt;                                Generate a new key                            &lt;/button&gt;                        &lt;/div&gt;                    &lt;/div&gt;                &lt;/div&gt;                &lt;div className="container mt-5"&gt;                    &lt;h4&gt;How to Stream&lt;/h4&gt;                    &lt;hr className="my-4"/&gt;                    &lt;div className="col-12"&gt;                        &lt;div className="row"&gt;                            &lt;p&gt;                                You can use &lt;a target="_blank" href="https://obsproject.com/"&gt;OBS&lt;/a&gt; or                                &lt;a target="_blank" href="https://www.xsplit.com/"&gt;XSplit&lt;/a&gt; to Live stream. If you're                                using OBS, go to Settings &gt; Stream and select Custom from service dropdown. Enter                                &lt;b&gt;rtmp://127.0.0.1:1935/live&lt;/b&gt; in server input field. Also, add your stream key.                                Click apply to save.                            &lt;/p&gt;                        &lt;/div&gt;                    &lt;/div&gt;                &lt;/div&gt;            &lt;/React.Fragment&gt;       }</code> </pre> <br>      passport.js, ,    ,          .     <code>/settings</code> ‚Äî     .      XHR-              <code>&lt;Settings/&gt;</code> . <br><br>     .       <code>Generate a new key</code> .     XHR-      .  ,   .      .       ‚Äî     <code>GET</code>  <code>POST</code>  <code>/settings/stream_key</code> .   <code>server/routes/settings.js</code>   : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>),    router = express.Router(),    User = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../database/Schema'</span></span>).User,    shortid = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'shortid'</span></span>); router.get(<span class="hljs-string"><span class="hljs-string">'/stream_key'</span></span>,    <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'connect-ensure-login'</span></span>).ensureLoggedIn(),    (req, res) =&gt; {        User.findOne({<span class="hljs-attr"><span class="hljs-attr">email</span></span>: req.user.email}, (err, user) =&gt; {            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!err) {                res.json({                    <span class="hljs-attr"><span class="hljs-attr">stream_key</span></span>: user.stream_key                })                   });    }); router.post(<span class="hljs-string"><span class="hljs-string">'/stream_key'</span></span>,    <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'connect-ensure-login'</span></span>).ensureLoggedIn(),    (req, res) =&gt; {        User.findOneAndUpdate({            <span class="hljs-attr"><span class="hljs-attr">email</span></span>: req.user.email        }, {            <span class="hljs-attr"><span class="hljs-attr">stream_key</span></span>: shortid.generate()        }, {            <span class="hljs-attr"><span class="hljs-attr">upsert</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,            <span class="hljs-attr"><span class="hljs-attr">new</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,        }, (err, user) =&gt; {            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!err) {                res.json({                    <span class="hljs-attr"><span class="hljs-attr">stream_key</span></span>: user.stream_key                })                   });    }); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = router;</code> </pre> <br>        shortid. <br><br>     <code>server/app.js</code> : <br><br><pre> <code class="javascript hljs">app.use(<span class="hljs-string"><span class="hljs-string">'/settings'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./routes/settings'</span></span>));</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/192/f46/66b/192f4666b55c01b6540b8a9169849b77.png"></div><br> <i><font color="#999999">,       </font></i> <br><br><h2> <font color="#3AC1EF">   </font> </h2><br>   <code>&lt;LiveStreams/&gt;</code> ( <code>client/components/LiveStreams.js</code> )       : <br><br><pre> <code class="javascript hljs">render() {    <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> streams = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.live_streams.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream, index</span></span></span><span class="hljs-function">) =&gt;</span></span> {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (            &lt;div className="stream col-xs-12 col-sm-12 col-md-3 col-lg-4" key={index}&gt;                &lt;span className="live-label"&gt;LIVE&lt;/span&gt;                &lt;Link to={'/stream/' + stream.username}&gt;                    &lt;div className="stream-thumbnail"&gt;                        &lt;img align="center" src={'/thumbnails/' + stream.stream_key + '.png'}/&gt;                    &lt;/div&gt;                &lt;/Link&gt;                &lt;span className="username"&gt;                    &lt;Link to={'/stream/' + stream.username}&gt;                        {stream.username}                    &lt;/Link&gt;                &lt;/span&gt;            &lt;/div&gt;        );    });    return (        &lt;div className="container mt-5"&gt;            &lt;h4&gt;Live Streams&lt;/h4&gt;            &lt;hr className="my-4"/&gt;            &lt;div className="streams row"&gt;                {streams}            &lt;/div&gt;        &lt;/div&gt;   }</code> </pre> <br>        .   cron, ,  5 ,      . <br><br>      <code>server/helpers/helpers.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> spawn = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'child_process'</span></span>).spawn,    config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../config/default'</span></span>),    cmd = config.rtmp_server.trans.ffmpeg; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> generateStreamThumbnail = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream_key</span></span></span><span class="hljs-function">) =&gt;</span></span> {    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> args = [        <span class="hljs-string"><span class="hljs-string">'-y'</span></span>,        <span class="hljs-string"><span class="hljs-string">'-i'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://127.0.0.1:8888/live/'</span></span>+stream_key+<span class="hljs-string"><span class="hljs-string">'/index.m3u8'</span></span>,        <span class="hljs-string"><span class="hljs-string">'-ss'</span></span>, <span class="hljs-string"><span class="hljs-string">'00:00:01'</span></span>,        <span class="hljs-string"><span class="hljs-string">'-vframes'</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>,        <span class="hljs-string"><span class="hljs-string">'-vf'</span></span>, <span class="hljs-string"><span class="hljs-string">'scale=-2:300'</span></span>,        <span class="hljs-string"><span class="hljs-string">'server/thumbnails/'</span></span>+stream_key+<span class="hljs-string"><span class="hljs-string">'.png'</span></span>,    ];    spawn(cmd, args, {        <span class="hljs-attr"><span class="hljs-attr">detached</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,        <span class="hljs-attr"><span class="hljs-attr">stdio</span></span>: <span class="hljs-string"><span class="hljs-string">'ignore'</span></span>    }).unref(); }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = {    <span class="hljs-attr"><span class="hljs-attr">generateStreamThumbnail</span></span> : generateStreamThumbnail };</code> </pre> <br>      <code>generateStreamThumbnail</code> . <br><br>    ffmpeg-,      HLS-.        <code>prePublish</code>     ( <code>server/media_server.js</code> ): <br><br><pre> <code class="javascript hljs">nms.on(<span class="hljs-string"><span class="hljs-string">'prePublish'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (id, StreamPath, args) =&gt; {    <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> stream_key = getStreamKeyFromStreamPath(StreamPath);    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'[NodeEvent on prePublish]'</span></span>, <span class="hljs-string"><span class="hljs-string">`id=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string"> StreamPath=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${StreamPath}</span></span></span><span class="hljs-string"> args=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">JSON</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.stringify(args)}</span></span></span><span class="hljs-string">`</span></span>);    User.findOne({<span class="hljs-attr"><span class="hljs-attr">stream_key</span></span>: stream_key}, (err, user) =&gt; {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!err) {            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!user) {                <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> session = nms.getSession(id);                session.reject();            } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {                helpers.generateStreamThumbnail(stream_key);                      }); });</code> </pre> <br>      ,    cron        ( <code>server/cron/thumbnails.js</code> ): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CronJob = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'cron'</span></span>).CronJob,    request = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'request'</span></span>),    helpers = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../helpers/helpers'</span></span>),    config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../config/default'</span></span>),    port = config.rtmp_server.http.port; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> job = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CronJob(<span class="hljs-string"><span class="hljs-string">'*/5 * * * * *'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    request        .get(<span class="hljs-string"><span class="hljs-string">'http://127.0.0.1:'</span></span> + port + <span class="hljs-string"><span class="hljs-string">'/api/streams'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error, response, body</span></span></span><span class="hljs-function">) </span></span>{            <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> streams = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(body);            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (streams[<span class="hljs-string"><span class="hljs-string">'live'</span></span>] !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>)) {                <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> live_streams = streams[<span class="hljs-string"><span class="hljs-string">'live'</span></span>];                <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> stream <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> live_streams) {                    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!live_streams.hasOwnProperty(stream)) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>;                    helpers.generateStreamThumbnail(stream);                                  }); }, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = job;</code> </pre> <br>      5 .        API NMS          .     <code>server/app.js</code>  : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//      app.js, const thumbnail_generator = require('./cron/thumbnails'); //   start()    thumbnail_generator.start();</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Zusammenfassung</font> </h2><br>        ,    . ,          .     -  ‚Äî   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> .      -  ‚Äî        . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>   . <br><br> <b> !</b>       ,  ,       ? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/a09/9e4/5a8/a099e45a81c9dafd3a3673edd5ea415b.jpg"></a> </div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de457860/">https://habr.com/ru/post/de457860/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de457846/index.html">Gesunder Produktmanager</a></li>
<li><a href="../de457848/index.html">Die Zusammenfassung der Ereignisse f√ºr HR-Experten im Bereich IT f√ºr Juli 2019</a></li>
<li><a href="../de457850/index.html">Wohin f√ºhrt ABBYY Road?</a></li>
<li><a href="../de457852/index.html">Analyse: Wie sich Probleme mit den US-Beh√∂rden auf das Huawei- und IT-Gesch√§ft auswirken werden</a></li>
<li><a href="../de457854/index.html">Hallo von den Programmierern der 80er Jahre</a></li>
<li><a href="../de457862/index.html">iOS Digest Nr. 8 (14. - 27. Juni)</a></li>
<li><a href="../de457864/index.html">Mythen und Legenden der Systemanalyse oder was ein Analyst bei einer Bank tut</a></li>
<li><a href="../de457866/index.html">Unit Testing in Laravel</a></li>
<li><a href="../de457870/index.html">Projekterstellungsinfrastruktur mit Docker</a></li>
<li><a href="../de457872/index.html">Wie man Zeit verwaltet und aufh√∂rt zu z√∂gern?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>