<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¥üèæ ‚öìÔ∏è üë∞üèª Comme nous l'avons √©crit, l'interface de notre propre panneau de contr√¥le d'h√©bergement: framework et backdoors ‚ôëÔ∏è üìä üåô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans le dernier article, nous avons expliqu√© comment nous avons eu l'id√©e d'√©crire notre propre panneau de contr√¥le d'h√©bergement et la structure g√©n√©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comme nous l'avons √©crit, l'interface de notre propre panneau de contr√¥le d'h√©bergement: framework et backdoors</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/465285/"><img src="https://habrastorage.org/webt/mt/pj/hx/mtpjhxpebii_0okylhb3xp4zzcc.png"><br>  Dans le dernier article, nous avons expliqu√© comment nous avons eu l'id√©e d'√©crire notre propre panneau de contr√¥le d'h√©bergement et la structure g√©n√©rale du panneau fini. <br><br>  Aujourd'hui, notre d√©veloppeur front-end Artysh dira comment il a √©crit le front-end de ce panneau: quel framework a √©t√© choisi, quel antipattern est consid√©r√© comme une bonne forme, et comment se d√©fendre contre les backdoors si vous utilisez des biblioth√®ques pr√™tes √† l'emploi. <br><a name="habracut"></a><br><h2>  Choix du cadre: pourquoi en cherchiez-vous un nouveau </h2><br>  Le panneau pr√©c√©dent a √©t√© impl√©ment√© sur son propre framework √©crit en jQuery.  Nous √©tions assis sur VMManager, cela n√©cessitait beaucoup d'am√©liorations: en termes d'interface et de fonctionnalit√©, il √©tait difficile de maintenir un tel code.  L'ajout de nouvelles fonctionnalit√©s au panneau depuis l'avant a pris beaucoup de temps.  Il est clair que si vous le souhaitez, vous pouvez impl√©menter un bon framework sur jQuery (j'aime toujours jQuery) ou m√™me un semblant de CMS, mais ce n'√©tait pas la meilleure option: commencer par une documentation limit√©e sur un framework auto-√©crit et finir par l'architecture pas enti√®rement correcte de l'application elle-m√™me. <br><br>  L'ancien panneau a √©t√© impl√©ment√© comme une application de page unique, et c'est l√† que ses bonnes qualit√©s ont pris fin.  Apr√®s avoir r√©solu un autre casse-t√™te pour ajouter un bouton √† la liste, j'ai r√©alis√© que j'avais besoin d'une alternative.  Le choix est tomb√© sur Vue. <br><br><h3>  Pourquoi SPA? </h3><br>  L'application d'une seule page est un choix id√©al pour un panneau de commande.  Le panneau de contr√¥le en termes de rendu est assez simple, ce travail peut √™tre facilement confi√© au navigateur de l'utilisateur.  De plus, l'optimisation SEO n'est pas importante pour le panel, pour cela nous avons un site principal.  Eh bien, les utilisateurs du panneau per√ßoivent le temps requis pour le chargement initial de tous les scripts n√©cessaires en raison des sp√©cificit√©s de ces utilisateurs eux-m√™mes.  Encore une fois, le backend que nous avons obtenu √©tait un service RestAPI classique - pour fournir une API ouverte √† nos clients √† l'avenir. <br><br>  L'application SPA s'est av√©r√©e si l√©g√®re qu'elle fonctionne bien avec le navigateur des t√©l√©phones et des tablettes - nous venons de faire une mise en page adaptative et nous n'avons pas eu √† cr√©er une application distincte. <br><br><h3>  Pourquoi Vue? </h3><br>  Il y a 3 ans, Vue √©tait un framework relativement jeune, mais m√™me √† ce moment-l√†, ils en ont beaucoup parl√© et √©crit, et lorsque la sortie de la version 2.0 est sortie, nous avons d√©cid√© de parier dessus - et nous avions raison.  Au d√©but, ils pr√©voyaient de remplacer progressivement certains composants √©crits en jQuery et Vue le rendait facile √† faire.  Mais ensuite, apr√®s la r√©√©criture des composants plut√¥t volumineux, ils ont d√©cid√© qu'il √©tait pr√©f√©rable de r√©√©crire l'application enti√®re dans Vue. <br>  Ce serait une √©tape risqu√©e et nous avons d√©cid√© de la prendre pour 4 raisons: <br><br><ol><li>  Vue est un cadre d√©claratif simple, m√™me les codeurs peuvent le comprendre.  Si quoi que ce soit, il est facile de trouver un d√©veloppeur pour lui ou simplement d'enseigner √† un ami.  Cela signifie que nous n'aurons aucun probl√®me √† trouver un nouveau d√©veloppeur et √† entrer dans le projet si un tram me traverse (louange aux dieux, ils ne sont pas dans ma ville). </li><li>  Vue est objectivement bon pour √©crire des applications SPA. </li><li>  J'ai eu l'exp√©rience de d√©velopper React sous mes yeux et j'ai sugg√©r√© que la popularit√© de Vue augmenterait √©galement.  Maintenant, le framework est inclus dans le TOP-3 des frameworks JS populaires (c'est facile √† v√©rifier avec une requ√™te de recherche), juste derri√®re React et Angular.  Il a un bon soutien, un √©cosyst√®me d√©velopp√© et une grande communaut√©. </li><li>  Vitesse de d√©veloppement.  Personnellement, j'ai imm√©diatement commenc√© √† percevoir Vue comme une sorte de constructeur et le d√©veloppement se passe assez rapidement: si j'ai besoin, par exemple, d'un s√©lecteur de date, tr√®s probablement sur Vue, il existe d√©j√†, est gratuit √† utiliser et test√© par la communaut√©.  Je viens d'installer le composant dans le projet, d'√©crire une balise et tout fonctionne.  En fait, notre panel est compos√© de 70 √† 80% des biblioth√®ques finies.  Je veux dire l'utilisation du composant, pas la taille de la base de code, qui peut √™tre v√©rifi√©e avec une commande comme: npx <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">intrinsic</a> / loc </li></ol><br>  Lors de la mise en ≈ìuvre d'un projet, vous tenez toujours compte de ses perspectives, notamment des perspectives de d√©veloppement.  Et le fait que les √©cosyst√®mes Vue disposent d√©j√† d'outils tels que Weex, Quasar Framework ou Nuxt √©largit consid√©rablement les horizons de notre d√©veloppement de panneaux. <br><br>  Sur Habr√© il y a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">merveilleux article sur Vue</a> de son cr√©ateur, et je vais vous parler de quelques fonctionnalit√©s de notre application. <br><br><h2>  Vuex Sync avec RestAPI Service </h2><br>  Une partie des donn√©es de stockage global Vuex de notre application est synchronis√©e avec RestAPI au moyen de requ√™tes ordinaires aux adresses correspondantes.  Pourquoi avons-nous fait √ßa?  Eh bien, au moins pour que les principaux param√®tres utilisateur ne soient pas li√©s √† un navigateur sp√©cifique d'un appareil particulier.  Vous pouvez acc√©der √† notre panel depuis l'ordinateur de votre femme ou depuis un club de jeu et en m√™me temps entrer dans le m√™me environnement familier que vous aviez dans votre propre voiture. <br><br>  De plus, lorsque la synchronisation √©tait uniquement avec localStorage, certains navigateurs ont perdu le contenu de localStorage lors des mises √† jour - il a √©t√© compl√®tement supprim√©.  Oui, et r√©cemment, il y a eu une tendance √† resserrer la politique de stockage des donn√©es utilisateur dans les cookies, par exemple, une fonction dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WebKit Intelligent Tracking Prevention</a> - pendant une heure, ils arriveront √† localStorage. <br><br><h2>  Bus d'√©v√©nement </h2><br>  Oui, nous utilisons le bus d'√©v√©nements global.  Comme dans toute autre grande application comportant de nombreux composants, il est t√¥t ou tard n√©cessaire d'√©tablir une interaction entre des composants ind√©pendants.  M√™me gr√¢ce au stockage global.  Il est clair que s'il existe une relation parent-enfant, leur interaction est g√©n√©ralement organis√©e via les propri√©t√©s des accessoires dans un sens et la m√©thode $ emit dans l'autre, ou via le stockage, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme d√©crit dans les recommandations Vue</a> . <br><br>  Mais la documentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©crit</a> √©galement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la possibilit√© d'utiliser le bus d'√©v√©nements global</a> .  Nous avons un tas de formulaires dans le projet avec diff√©rents ensembles de champs et dans certains cas (il n'y en a pas beaucoup, mais ils sont tous fondamentaux), vous devez en quelque sorte r√©agir de mani√®re sp√©ciale pour changer la valeur du champ.  Le stockage des valeurs de tous les champs de chaque formulaire dans le stockage global n'a pas de sens: <br><br><ol><li>  Tout d'abord, en raison du besoin rare </li><li>  Deuxi√®mement, tous nos formulaires sont g√©n√©r√©s dynamiquement et l'ensemble des champs de tout formulaire peut changer consid√©rablement. </li></ol><br>  J'ai donc d√©cid√© d'utiliser le m√©canisme de bus d'√©v√©nements.  En m√™me temps, rien ne vous emp√™che d'utiliser votre √©metteur d'√©v√©nement - l'essentiel est d'utiliser ce m√©canisme avec pr√©caution, uniquement dans des situations exceptionnelles et de tout nettoyer soigneusement par vous-m√™me. <br><br><h2>  Interaction RestAPI avec le panneau </h2><br>  Pour rendre l'interface plus r√©active dans l'ancien framework jQuery, les commentaires de RestAPI vers l'application client ont √©t√© √©mul√©s via un syst√®me de minuterie astucieux: il a ex√©cut√© des sondages RestAPI √† un certain intervalle et redessin√© les n≈ìuds DOM qui ont affect√© les modifications. <br><br>  Ce n'√©tait pas une solution id√©ale: dans tous les navigateurs modernes, les minuteries se bloquent presque compl√®tement lorsque l'onglet devient inactif et obtient une faible priorit√©.  Par cons√©quent, une demande au service RestAPI peut √™tre retard√©e et recevoir des donn√©es d√©j√† non pertinentes. <br><br>  Pour r√©soudre ce probl√®me dans un nouveau panneau, j'ai d√©cid√© d'utiliser le bundle du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">module Nchan</a> pour le serveur Web Nginx et les nouvelles fonctionnalit√©s des interfaces HTML5 - EventSource et WebWorker. <br><br>  Le module Nchan prend en charge l'envoi de messages via Websocket, EventSource et Long-Polling.  J'ai effectu√© plusieurs tests et d√©cid√© d'utiliser EventSource: les messages ne peuvent √™tre que du texte et les messages ne circulent que dans une seule direction (depuis le serveur).  Cela a compl√®tement r√©solu la t√¢che. <br><br>  Maintenant, l'interface EventSource fonctionne dans un thread d'arri√®re-plan WebWorker distinct, quelle que soit l'activit√© de l'onglet.  Dans le m√™me thread, une file d'attente de messages primitive est organis√©e afin que rien ne soit perdu.  La file d'attente est envoy√©e au thread principal de l'application, qui √† son tour produit les redessins n√©cessaires de l'interface quand cela est pratique et permet au navigateur. <br><br><h2>  Backdoors: comment et pourquoi je v√©rifie la s√©curit√© des composants </h2><br>  Avant de connecter la biblioth√®que, il est obligatoire de v√©rifier sa s√©curit√©: il y a eu un cas o√π un composant a sp√©cifiquement introduit une porte d√©rob√©e, qui permettait d'acc√©der au site et de t√©l√©charger des donn√©es. <br><br>  Mais le plus souvent, les failles de s√©curit√© semblent plus probables en raison de la n√©gligence des d√©veloppeurs.  Sur les march√©s des applications, il y a une √©quipe qui v√©rifie la s√©curit√© des composants, mais ce n'est pas trop exigeant et il vaut mieux v√©rifier les biblioth√®ques manuellement. <br><br>  Je v√©rifie toujours les packages pour les crochets de pr√©installation, d'installation et de post-installation dans le champ "scripts" du fichier "package.json".  De plus, j'utilise des analyseurs de packages statiques tels que <a href="">retire</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">snyk</a> et la commande ¬´audit¬ª du gestionnaire de packages npm. <br><br>  Les avertissements de s√©curit√© se pr√©sentent √† diff√©rents niveaux, le plus souvent au cours de l'analyse, des avertissements non critiques apparaissent.  Parfois, pour traiter une biblioth√®que, il suffit de mettre √† niveau - les d√©veloppeurs de biblioth√®que eux-m√™mes surveillent la s√©curit√©. <br><br>  Si une biblioth√®que s'est compromise une fois, il vaut mieux la remplacer - c'est un signe de manque de fiabilit√©, donc avec des avertissements, je choisis de chercher une autre biblioth√®que. <br><br>  Une fois l'analyse termin√©e, je corrigerai d√©finitivement sa version.  Si vous avez besoin d'une version diff√©rente - le package passe √† nouveau l'analyse.  Oui, cela prend du temps, mais √ßa vaut le coup. <br><br>  Jusqu'√† pr√©sent, les portes d√©rob√©es n'ont jamais atteint notre production. <br><br><h2>  Beaucoup de commentaires </h2><br>  Comme je l'ai dit, Vue a √©t√© choisi pour sa simplicit√© et sa d√©clarativit√©.  En plus de cela, j'√©cris beaucoup de commentaires, sur presque toutes les lignes: pour que dans ce cas un nouveau d√©veloppeur puisse facilement entrer dans le projet et pour que je revienne moi-m√™me facilement aux anciens morceaux de code. <br><br><h2>  Pourquoi je suis tomb√© amoureux du nouveau frontend et du panel dans son ensemble </h2><br><h4>  Il est devenu plus facile de maintenir le code </h4><br>  Le d√©veloppement a dur√© six mois.  Maintenant, je suis plus susceptible de participer au support de panneau, mon code n'appuie pas et ne frotte pas. <br><br><h4>  Les clients peuvent obtenir rapidement ce qu'ils ont demand√©. </h4><br><img src="https://habrastorage.org/webt/d9/ko/zg/d9kozgyoj_it6a913dxovniuifk.png"><br><br>  Il est devenu rapide et pratique d'ajouter de nouvelles fonctionnalit√©s qui sont apparues dans le backend: par exemple, j'ai ajout√© le paiement pour les personnes morales en 2 jours, les instantan√©s en 1 jour. <br><br><h2>  Je suis ouvert aux questions </h2><br>  Dans cet article, j'ai r√©v√©l√© certains des secrets li√©s √† l'interface de notre panel.  Si vous avez des questions - bienvenue √† commenter, je vais essayer de r√©pondre. <br><br>  Et, bien s√ªr, je vous invite √† exprimer des suggestions pour am√©liorer le panel. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ud/xv/wf/udxvwfcz80j3nug11rxaguqelww.png"><br></a> <br><h3>  Abonnez-vous √† notre d√©veloppeur Instagram </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/e5/as/-l/e5as-ltfnotkemk2dsqngygimra.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465285/">https://habr.com/ru/post/fr465285/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465275/index.html">Alice obtient des comp√©tences</a></li>
<li><a href="../fr465277/index.html">Analyser et analyser la s√©mantique pour le r√©f√©rencement: 5 mod√®les gratuits de Google Sheets</a></li>
<li><a href="../fr465279/index.html">Reconnaissance faciale √† l'aide de r√©seaux siamois</a></li>
<li><a href="../fr465281/index.html">Surveillance continue du glucose (NMH) avec la pompe Medtronic 640g</a></li>
<li><a href="../fr465283/index.html">¬´Il y a tout ce dont on a besoin, et rien ne rend furieux¬ª - la v√©rit√© parle √† travers les l√®vres du client</a></li>
<li><a href="../fr465289/index.html">Le condens√© des √©v√©nements pour les professionnels des RH dans le domaine des TI pour septembre 2019</a></li>
<li><a href="../fr465291/index.html">Plus pr√®s du sol: comment j'ai chang√© le coworking en maison de village</a></li>
<li><a href="../fr465293/index.html">Comment nous avons abandonn√© le grand hackathon et commenc√© √† faire des voyages pour des √©quipes individuelles</a></li>
<li><a href="../fr465295/index.html">Comment j'ai travaill√© en Turquie et fait connaissance avec le march√© local</a></li>
<li><a href="../fr465297/index.html">"La meilleure chose que j'ai faite dans ma carri√®re est d'envoyer le travail en enfer." Chris Dancy sur la transformation de la vie en donn√©es</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>