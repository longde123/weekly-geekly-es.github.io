<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title> 癸 ㄢ Domar protocolos de confianza: autenticaci贸n OAuth con InterSystems IRIS ぇ  </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="驴C贸mo permitir que las computadoras conf铆en entre s铆 en su ausencia, mientras mantienen la seguridad y la privacidad? 



 - Martini seco. En un gran ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Domar protocolos de confianza: autenticaci贸n OAuth con InterSystems IRIS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/intersystems/blog/466699/">  <b>驴C贸mo permitir que las computadoras conf铆en entre s铆 en su ausencia, mientras mantienen la seguridad y la privacidad?</b> <br><br><img src="https://habrastorage.org/webt/wn/au/eu/wnaueun6knwbjc4anclcexjbfwi.jpeg"><br><br>  - Martini seco.  En un gran vaso. <br>  - Oui, se帽or.  [S铆, se帽or (p.)] <br>  "Solo un segundo, no todos".  Tres dedos de Gordon, uno de vodka, medio dedo de Kina Lyklet.  Batir bien en una coctelera y luego poner una rodaja grande de lim贸n.  驴Te acuerdas? <br><br>  Jan Fleming, Casino Royale, 1953 <br><br><h2>  Parte 1. Historias de OAuth 2.0 y OpenID Connect </h2><br>  Universal y, al parecer, hoy en el siglo XXI, el conjunto favorito de protocolos de autenticaci贸n y delegaci贸n de acceso abierto de todos se llama OAuth + OIDC.  Mejor para el uso masivo hasta ahora no se le ocurri贸 nada.  Son especialmente populares entre los proveedores front-end porque caminan sobre los protocolos HTTP (S) y usan el contenedor JWT ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JSON Web Token</a> ).  OpenID Connect utiliza OAuth para su trabajo o, en otras palabras, OIDC es un contenedor para OAuth. <br><br>  OpenID: un est谩ndar abierto para la autenticaci贸n y la creaci贸n de sistemas de identificaci贸n digital no es nuevo para los desarrolladores.  Este a帽o, cumple 14 a帽os.  En la tercera versi贸n actual, el nombre completo es OpenID Connect o m谩s corto que OIDC.  Es popular tanto en el desarrollo web y m贸vil, como en los sistemas corporativos. <br><a name="habracut"></a><br>  Su socio, el Est谩ndar de Delegaci贸n de Acceso Abierto de OAuth, cumple 12 a帽os.  Y 9 a帽os desde que apareci贸 el est谩ndar RFC 5849 correspondiente. Confiaremos en la versi贸n moderna del protocolo OAuth 2.0 y el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 6749</a> actual.  Recuerde que OAuth 2.0 no es compatible con su predecesor OAuth 1.0. <br><blockquote>  OAuth: un protocolo abierto (esquema, transporte) para delegar el acceso, que permite proporcionar a terceros acceso limitado a los recursos protegidos del usuario sin la necesidad de transferir a ellos (terceros) el nombre de usuario y la contrase帽a de RFC 6749 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">oauth.net</a> es el sitio web l铆der de OAuth alojado por Aaron Parecki <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">oauth.com</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tutorial de</a> OAuth y entorno de prueba <br><br>  Open ID Connect (OIDC) es un est谩ndar abierto para sistemas de identificaci贸n descentralizados que permite al usuario crear una sola cuenta para identificaci贸n en una variedad de recursos de Internet no relacionados que utilizan servicios de terceros, utiliza mensajes OAuth y un contenedor JWT para una comunicaci贸n segura. <br></blockquote>  Estrictamente hablando, OAuth no es un protocolo, sino un conjunto de reglas (esquema) para separar y transferir operaciones de identificaci贸n de usuarios a un servidor de confianza separado al implementar la arquitectura de delimitaci贸n de control de acceso en sistemas de software. <br><br>  Y, atenci贸n, 隆 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OAuth no puede decir nada sobre un usuario espec铆fico</a> !  Ni qui茅n es, ni d贸nde est谩 ahora, ni si trabaja en la computadora ahora o no.  Pero luego permite interactuar con los sistemas sin intervenci贸n del usuario, utilizando tokens de acceso ya emitidos.  Este es un punto importante. <br><blockquote>  Puede ser 煤til: <br><br><ul><li>  OAuth combina perfectamente con el uso del lenguaje de descripci贸n de acceso de atributos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">XACML</a> </li><li>  OAuth tambi茅n se basa en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">acceso administrado por</a> el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">usuario</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UMA</a> ) </li></ul><br>  El uso conjunto de OAuth + OIDC + UMA permite implementar sistemas de identificaci贸n segura y control de acceso (Identity and Access Management - IdM, IAM) en diferentes 谩reas tem谩ticas, por ejemplo: <br><br><ul><li>  utilizando el perfil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HEART</a> (Health Relationship Trust) de los datos personales de un paciente en medicina </li><li>  en las plataformas de identificaci贸n de clientes CIAM (Consumer Identity and Access Management) para empresas manufactureras y comerciales </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">personalizaci贸n de certificados digitales de dispositivos inteligentes</a> en sistemas IoT (Internet of Things) </li></ul></blockquote><img src="https://habrastorage.org/webt/pf/dt/vf/pfdtvf4d6obgfiom0tizekdsjis.png"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Una nueva forma de control de acceso para la econom铆a API</a> <br><br>  Lo m谩s importante, no almacene datos personales en el mismo lugar que el resto del sistema.  Separar f铆sicamente la autenticaci贸n y autorizaci贸n.  Y a煤n mejor: dele toda la identificaci贸n personalmente a la persona y nunca la lleve consigo.  Conf铆a en el propietario del dispositivo. <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apple dijo</a> qu茅 datos personales almacenan los rusos en Rusia.  Este es el nombre, direcci贸n, correo electr贸nico, n煤mero de tel茅fono.  Pero las personas de Mensajes, fotos, etc., conf铆an en la nube de iCloud (que no est谩 en Rusia). <br></blockquote><h2>  Parte 2. Juego corto "Confianza y autenticaci贸n" </h2><br>  Por lo tanto, decidimos que no era fabuloso almacenar los datos personales de nuestros queridos usuarios ni en nuestra aplicaci贸n, ni en un 煤nico almacenamiento junto con una base de datos operativa.  Es decir, han elegido un administrador confiable que nos brindar谩 este servicio.  Y as铆, cuando aparece Su Majestad el Usuario, entonces proporcionamos el siguiente di谩logo. <br><br>  Actores: <br><br><ul><li>  Usuario </li><li>  Solicitud de cliente </li><li>  Servicio de identidad </li><li>  Servidor de recursos </li></ul><br>  La acci贸n tiene lugar en un navegador en la computadora del usuario.  Todos los personajes han estado familiarizados el uno con el otro.  El usuario tiene una cuenta personal en el servicio de identidad.  La Aplicaci贸n del cliente tiene un contrato v谩lido firmado con el Servicio de identificaci贸n y las interfaces mutuas.  El servidor de recursos conf铆a en el servicio de identidad en la cuesti贸n de emitir claves de acceso a cualquier v铆ctima a quien pueda identificar. <br><br>  Usuario (P): (al iniciar una aplicaci贸n cliente basada en la web) Estimado cliente-aplicaci贸n, necesito "este recurso". <br>  Aplicaci贸n de cliente (K): Estimado usuario, primero presente la clave de "este recurso".  Sin una clave, el acceso a "este recurso" est谩 cerrado. <br>  P: No tengo esa clave. <br>  K: Luego lo cambiar茅 temporalmente a un servicio de identificaci贸n con el que tenemos un acuerdo para emitir claves para el servidor de recursos.  (redirige P. al servicio de identificaci贸n) <br>  Servicio de identificaci贸n (I): Estimado usuario, d铆game qui茅n es usted y qu茅 claves necesita. <br>  P: Yo, usuario de Ytsuken User, la contrase帽a es tal y tal, quiero obtener acceso a "este recurso". <br>  Y: gracias, camarada Jtsuken.  La autenticaci贸n se realiz贸 correctamente y se verific贸 su identificaci贸n.  Aqu铆 est谩 la clave de "este recurso" (P. vuelve a dirigir a K.) <br>  P: Cliente, te traje la clave del "recurso" que necesito. <br>  K: Gracias usuario.  La clave es correcta.  Aqu铆 est谩 el "recurso" que solicit贸. <br><br>  El tel贸n  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Se reproduce la sinfon铆a de apertura de Richard Strauss</a> de la pel铆cula "Space Odyssey of 2001" <br><br><h2>  Parte 3. Servicio de autorizaci贸n real </h2><br>  Ahora vamos al grano.  Tenemos tres tareas en la agenda: nombrar a los personajes, preparar el escenario y jugar la obra.  Y todo se decide a la vez en la plataforma InterSystems IRIS.  Pero esto no es necesario, puede armar un dise帽o desde diferentes plataformas a su discreci贸n.  Por ejemplo, en esta combinaci贸n: servidor OAuth Keycloak + cliente OAuth y recurso OAuth en IRIS.  En otras palabras: <br><br><ol><li>  Configure e inicie el servidor OAuth con el registro de nuestro cliente de demostraci贸n. </li><li>  Configure un cliente OAuth de demostraci贸n conect谩ndolo al servidor OAuth y a los recursos web. </li><li>  Desarrolle aplicaciones cliente que puedan usar OAuth.  Puede usar Java, Python, C #, NodeJS.  El siguiente es un c贸digo de aplicaci贸n de muestra en ObjectScript. </li></ol><br><blockquote>  El sitio web de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la comunidad de desarrolladores</a> cuenta con instrucciones detalladas de Daniel Kutak en tres partes con ejemplos de uso de OAuth en IRIS para diferentes aplicaciones basadas en CSP ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 3</a> ). </blockquote>  Hay muchas configuraciones en OAuth.  Por lo tanto, escr铆bete listas de verificaci贸n: esta es la aplicaci贸n m谩s correcta para ellos.  Ejemplos y espacios en blanco a continuaci贸n. <br><blockquote>  驴D贸nde obtener InterSystems IRIS listo para una muestra?  Hay al menos dos opciones disponibles para todos: <br><br>  Obtenga un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">servidor IRIS</a> en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nube preconfigurado listo para</a> usar en la plataforma de capacitaci贸n de InterSystems Learning Services en la secci贸n InterSystems Learning Labs. <br><br>  Instale un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">contenedor acoplado listo para usar</a> .  Lea m谩s en el art铆culo: una instrucci贸n paso a paso para principiantes en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lanzamiento de desarrolladores de IRIS con Docker</a> o, si prefieren un video, una instrucci贸n de screencast de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Desarrollo de soluciones con InterSystems IRIS con Docker y VSCode</a> </blockquote><h3>  1-1 Configuraci贸n del servidor OAuth </h3><br>  Entramos en el portal de gesti贸n de IRIS y seleccionamos la secci贸n: <br><br>  Administraci贸n del sistema &gt;&gt; Seguridad &gt;&gt; OAuth 2.0 &gt;&gt; Servidor <br><br>  A continuaci贸n, en cada p谩rrafo, habr谩 un nombre para la l铆nea de configuraci贸n y, a trav茅s de los dos puntos, un ejemplo o explicaci贸n, si es necesario. <br><br><img src="https://habrastorage.org/webt/9g/k4/by/9gk4bywq0a0dkkkprpu5wbnempo.png"><br><br>  <b>Pesta帽a Configuraci贸n general:</b> <br>  Descripci贸n: opcional, por ejemplo, "Servidor de autorizaci贸n" <br>  El punto final del generador (en adelante CTG) es el nombre de host: nombre DNS de su servidor <br>  Tipos de permisos admitidos (seleccione al menos uno): <br>  C贸digo de autorizaci贸n <br>  Impl铆cito <br>  Credenciales: recurso, propietario, contrase帽a <br>  Credenciales del cliente <br>  Configuraci贸n SSL / TLS: oauthserver <br><br>  <b>Pesta帽a de permisos:</b> <br>  agregar vol煤menes compatibles: por ejemplo, alcance1 y alcance2 <br><br>  <b>Pesta帽a Intervalos:</b> <br>  Intervalo de clave de acceso: 3600 <br>  Intervalo de c贸digo de autorizaci贸n: 60 <br>  Actualizar intervalo de clave: 86400 <br>  Intervalo de interrupci贸n de sesi贸n: 86400 <br>  Per铆odo de validez de la clave del cliente: 0 <br><br>  <b>Pesta帽a de configuraci贸n de JWT:</b> <br>  Algoritmo de entrada: RS512 <br>  Algoritmo de gesti贸n de claves: RSA-OAEP <br>  Algoritmo de cifrado de contenido: A256CBC-HS512 <br><br>  <b>Pesta帽a de personalizaci贸n:</b> <br>  Identificar clase:% OAuth2.Server.Authenticate <br>  Verificar clase de usuario:% OAuth2.Server.Validate <br>  Clase de servicio de sesi贸n: OAuth2.Server.Session <br>  Generar clase de clave:% OAuth2.Server.JWT <br>  Espacio de nombres de personalizaci贸n:% SYS <br>  Roles de personalizaci贸n (seleccione al menos uno):% DB_IRISSYS y% Manager <br><br>  Guardar. <br><br><h3>  1-2 Registre el cliente en el servidor OAuth </h3><br><img src="https://habrastorage.org/webt/ae/gu/pz/aegupzlmpoucnqfa4vu-f2gcgq0.png"><br><br>  Bot贸n Descripci贸n del cliente &gt;&gt; Bot贸n Crear descripci贸n del cliente: <br><br>  <b>Pesta帽a Configuraci贸n general:</b> <br>  Nombre: CLIENTE <br>  Descripci贸n: arbitraria <br>  Tipo de cliente: confidencial <br>  URL de redireccionamiento: la direcci贸n del punto de retorno en nuestra aplicaci贸n despu茅s de la autenticaci贸n <br>  Tipos de permisos admitidos <br>  C贸digo de autorizaci贸n: s铆 <br>  Impl铆cito <br>  Credenciales: recurso, propietario, contrase帽a <br>  Credenciales del cliente <br>  Autorizaci贸n JWT <br>  Tipos de respuestas admitidas <br>  codigo <br>  id_token <br>  clave id_token <br>  ficha <br>  Tipo de autorizaci贸n: simple <br><br>  <b>Pesta帽a Credenciales de cliente:</b> rellenado autom谩ticamente <br><br>  <b>Pesta帽a de informaci贸n del cliente:</b> <br>  URL de lanzamiento: <br>  Pantalla de inicio de sesi贸n <br>  Nombre del cliente <br>  URL del logotipo <br>  URL de la p谩gina de inicio del cliente <br>  URL de pol铆tica <br>  T茅rminos de URL de servicio <br><br><h3>  2-1 Configuraci贸n del enlace en el cliente del servidor OAuth </h3><br>  Administraci贸n del sistema &gt;&gt; Seguridad &gt;&gt; OAuth 2.0 &gt;&gt; Cliente <br><br><img src="https://habrastorage.org/webt/xq/hu/3r/xqhu3rquzsfni1tsfgwtfkhzvew.png"><br><br>  Crear una descripci贸n del servidor: <br>  Punto final del generador: tome de los par谩metros generales del servidor, ver arriba <br>  Configuraci贸n SSL / TLS: seleccione de la lista de preconfigurados <br><br>  El contenido de los campos restantes se descargar谩 autom谩ticamente del servidor, pero tambi茅n puede configurarlos manualmente: <br><br>  Servidor de autorizaciones <br>  Punto final de autorizaci贸n: CTG + / autorizar <br>  Punto final clave: CTG + / token <br>  Punto final de informaci贸n del usuario: CTG + / userinfo <br>  Punto final clave del autodiagn贸stico: CTG + / revocaci贸n <br>  Punto final de revocaci贸n clave: CTG + / introspecci贸n <br>  Configuraci贸n de token web JSON (JWT) <br>  Otra fuente adem谩s del registro din谩mico: seleccione JWKS de URL <br>  URL: CTG + / jwks <br><br><img src="https://habrastorage.org/webt/ic/7e/x4/ic7ex4khfgskgdqf_jpsdivgj_o.png"><br><br>  De esta lista, por ejemplo, se puede ver (scopes_supported y Claim_supported) que el servidor puede proporcionar informaci贸n diferente sobre el usuario al cliente OAuth.  Y vale la pena prestar atenci贸n a que al implementar su aplicaci贸n, deber谩 preguntarle al usuario qu茅 datos est谩 listo para compartir.  Adem谩s, en nuestro ejemplo, solo se nos pedir谩 permiso por alcance1. <br><br>  Guardar. <br><br>  Si hay un error que indica SSL, vaya a la configuraci贸n: <br>  Administraci贸n del sistema &gt;&gt; Seguridad &gt;&gt; Configuraci贸n SSL / TSL <br><br><h3>  2-2 Configuraci贸n del cliente OAuth </h3><br>  Administraci贸n del sistema &gt;&gt; Seguridad &gt;&gt; OAuth 2.0 &gt;&gt; Cliente &gt;&gt; Configuraci贸n del cliente &gt;&gt; Crear configuraci贸n del cliente <br><br><img src="https://habrastorage.org/webt/kd/e_/4w/kde_4wyvqd60yomyyudfzdotu_q.png"><br><br>  <b>Pesta帽a general:</b> <br>  Nombre de la aplicaci贸n: cliente de demostraci贸n <br>  Nombre del cliente: cliente de demostraci贸n <br>  Descripci贸n: opcional <br>  Habilitado: s铆 <br>  Tipo de cliente: confidencial <br>  Configuraci贸n SSL / TCL: oauthclient <br>  URL de redireccionamiento del cliente: nombre DNS de su servidor <br>  Tipos de permisos requeridos <br>  C贸digo de autorizaci贸n: s铆 <br>  Impl铆cito <br>  Credenciales: recurso, propietario, contrase帽a <br>  Credenciales del cliente <br>  Autorizaci贸n JWT <br>  Tipo de autorizaci贸n: simple <br><br>  <b>Pesta帽a de informaci贸n del cliente:</b> <br>  Pantalla de inicio de sesi贸n <br>  URL del logotipo <br>  URL de la p谩gina de inicio del cliente <br>  URL de pol铆tica <br>  T茅rminos de URL de servicio <br>  Volumen predeterminado: tomamos de los especificados anteriormente en el servidor, por ejemplo, scope1 <br>  Direcciones de correo electr贸nico de contacto (separadas por una coma) <br>  Edad m谩xima predeterminada (en segundos) <br><br>  <b>Pesta帽a de configuraci贸n de JWT:</b> <br>  Configuraci贸n de token web JSON (JWT) <br>  Creaci贸n de configuraciones JWT a partir de credenciales X509 <br>  ID Algoritmos Tomados <br>  Firma: RS256 <br>  Cifrado: A256CBC <br>  Clave: RSA-OAEP <br>  Algoritmos de informaci贸n de usuario <br>  Algoritmos de token de acceso <br>  Algoritmos de consulta <br><br>  <b>Pesta帽a Credenciales de cliente:</b> <br>  Id  cliente: del emitido tras el registro del cliente en el servidor (ver arriba) <br>  Identificaci贸n del cliente emitida <br>  Secreto del cliente: del que se emiti贸 al registrar al cliente en el servidor (ver arriba) <br>  El secreto del cliente caduca <br>  URI de registro de cliente <br><br>  Guardar. <br><br><h2>  Parte 4. C贸digo </h2><br>  Creemos una aplicaci贸n web minimalista con autorizaci贸n OAuth y REST. <br><blockquote>  Al trabajar, OAuth se basa en el hecho de que los canales de comunicaci贸n entre los participantes en la interacci贸n (servidor, clientes, aplicaci贸n web, navegador de usuario, servidor de recursos) est谩n de alguna manera protegidos.  La mayor铆a de las veces, SSL / TLS desempe帽a este papel.  Pero OAuth tambi茅n trabajar谩 en canales inseguros.  Por ejemplo, el servidor Keycloak, por defecto, usa el protocolo HTTP y no tiene protecci贸n.  Esto simplifica el desarrollo y la depuraci贸n durante el desarrollo.  Con el uso real de los servicios de OAuth, la protecci贸n del canal debe estar estrictamente habilitada; esto se registra en la documentaci贸n de Keycloak.  Los desarrolladores de IRIS de InterSystems adoptan un enfoque m谩s riguroso para OAuth: se requiere SSL / TSL.  La 煤nica simplificaci贸n es que puede usar certificados autofirmados o el servicio PKI integrado en IRIS (Administraci贸n del sistema &gt;&gt; Seguridad &gt;&gt; Sistema de clave p煤blica). </blockquote>  La autorizaci贸n del usuario se verifica con la indicaci贸n expl铆cita de dos par谩metros: el nombre de su aplicaci贸n y el volumen admitido por el servidor OAuth y en el cliente OAuth (alcance: 驴me pregunto c贸mo nombrarlo correctamente en ruso?): <br><br><pre><code class="plaintext hljs">Parameter OAUTH2APPNAME = "OAuthClient"; set isAuthorized = ##class(%SYS.OAuth2.AccessToken).IsAuthorized( ..#OAUTH2APPNAME, .sessionId, "scope1", .accessToken, .idtoken, .responseProperties, .error)</code> </pre> <br>  En ausencia de autorizaci贸n, estamos preparando un enlace a una solicitud de identificaci贸n de usuario y obteniendo su permiso para trabajar con nuestra aplicaci贸n.  Aqu铆 necesitamos indicar no solo el nombre de la aplicaci贸n y el volumen (alcance) solicitado registrado en el servidor OAuth y en el cliente OAuth, sino tambi茅n un enlace de retroceso al que la aplicaci贸n web deber铆a devolver al usuario. <br><br><pre> <code class="plaintext hljs">Parameter OAUTH2CLIENTREDIRECTURI = "https://52773b-76230063.labs.learning.intersystems.com/oauthclient/" set url = ##class(%SYS.OAuth2.Authorization).GetAuthorizationCodeEndpoint( ..#OAUTH2APPNAME, "scope1", ..#OAUTH2CLIENTREDIRECTURI, .properties, .isAuthorized, .sc)</code> </pre><br>  Utilizamos el servicio de autenticaci贸n IRIS incorporado y, en consecuencia, registramos a los usuarios en el servidor OAuth IRIS.  Por ejemplo, es suficiente establecer al usuario solo un nombre de usuario y contrase帽a, no necesitar谩 realizar otras configuraciones en la cuenta. <br><br>  Al transferir al usuario utilizando el enlace recibido, el servidor llevar谩 a cabo el procedimiento de identificaci贸n del usuario y le solicitar谩 permiso para operar con credenciales en la aplicaci贸n web, y tambi茅n guardar谩 el resultado en su OAuth2.Server.Session global en el 谩rea% SYS: <br><br><img src="https://habrastorage.org/webt/dj/ih/ve/djihveewmoifbr9knths77mq-vi.png"><br><br><img src="https://habrastorage.org/webt/jb/ib/qz/jbibqzzejdf-gzo03bfcxdlkjjg.png"><br><br>  3. Demostrar los datos de un usuario autorizado.  Al completar con 茅xito los procedimientos, tenemos, por ejemplo, un token de acceso.  Vamos a entenderlo: <br><br><pre> <code class="plaintext hljs">set valid = ##class(%SYS.OAuth2.Validation).ValidateJWT( .#OAUTH2APPNAME, accessToken, "scope1", .aud, .JWTJsonObject, .securityParameters, .sc )</code> </pre><br><div class="spoiler">  <b class="spoiler_title">C贸digo de trabajo completo de un ejemplo de trabajo con OAuth:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Class OAuthClient.REST Extends %CSP.REST { Parameter OAUTH2APPNAME = "OAuthClient"; Parameter OAUTH2CLIENTREDIRECTURI = "https://52773b-76230063.labs.learning.intersystems.com/oauthclient/"; // to keep sessionId Parameter UseSession As Integer = 1; XData UrlMap [ XMLNamespace = "http://www.intersystems.com/urlmap" ] { &lt;Routes&gt; &lt;Route Method="GET" Url = "/" Call = "Do" /&gt; &lt;/Routes&gt; } ClassMethod Do() As %Status { // Check for accessToken set isAuthorized = ##class(%SYS.OAuth2.AccessToken).IsAuthorized( ..#OAUTH2APPNAME, .sessionId, "scope1", .accessToken, .idtoken, .responseProperties, .error) // to show accessToken if isAuthorized { set valid = ##class(%SYS.OAuth2.Validation).ValidateJWT( ..#OAUTH2APPNAME, accessToken, "scope1", .aud, .JWTJsonObject, .securityParameters, .sc ) &amp;html&lt; Hello!&lt;br&gt; &gt; w "You access token = ", JWTJsonObject.%ToJSON() &amp;html&lt; &lt;/html&gt; &gt; quit $$$OK } // perform the process of user and client identification and get accessToken set url = ##class(%SYS.OAuth2.Authorization).GetAuthorizationCodeEndpoint( ..#OAUTH2APPNAME, "scope1", ..#OAUTH2CLIENTREDIRECTURI, .properties, .isAuthorized, .sc) if $$$ISERR(sc) { w "error handling here" quit $$$OK } // url magic correction: change slashes in the query parameter to its code set urlBase = $PIECE(url, "?") set urlQuery = $PIECE(url, "?", 2) set urlQuery = $REPLACE(urlQuery, "/", "%2F") set url = urlBase _ "?" _ urlQuery &amp;html&lt; &lt;html&gt; &lt;h1&gt;  IRIS   OAuth2&lt;/h1&gt; &lt;a href = "#(url)#"&gt;  &lt;b&gt;IRIS&lt;/b&gt;&lt;/a&gt; &lt;/html&gt; &gt; quit $$$OK } }</code> </pre><br></div></div><br>  Si es necesario, habilite los mensajes de depuraci贸n extendida en el servidor OAuth y el cliente OAuth.  Los mensajes se escriben en el ISCLOG global en el 谩rea% SYS.  Escriba su terminal IRIS (o instale y use un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">terminal web</a> ): <br><br><pre> <code class="plaintext hljs">set ^%ISCLOG = 5 set ^%ISCLOG("Category", "OAuth2") = 5 set ^%ISCLOG("Category", "OAuth2Server") = 5</code> </pre><br>  Consulte la documentaci贸n de IRIS <a href="">Uso de OAuth 2.0 y OpenID Connect para obtener m谩s informaci贸n</a> . <br><br>  Conclusiones: <br><br><ol><li>  OAuth ayuda a separar f铆sica y geogr谩ficamente los servicios con credenciales de usuario y bases de datos "en funcionamiento".  Y, por lo tanto, fortalecer la protecci贸n de los datos de identificaci贸n y, si es necesario, cumplir con los requisitos de las leyes sobre protecci贸n de datos personales de diferentes pa铆ses. </li><li>  Con OAuth, puede proporcionar al usuario la capacidad de trabajar de manera segura de manera simult谩nea desde m煤ltiples dispositivos y "brillar" m铆nimamente sus datos personales a diversos servicios y aplicaciones.  Adem谩s de no tomar informaci贸n "redundante" sobre los usuarios en sus servicios, es decir, llevar a cabo el procesamiento de datos despersonalizados en sus servicios. </li><li>  Cuando utiliza InterSystems IRIS, tiene un conjunto completo de herramientas listas para probar y desplegar servicios OAuth y OIDC, tanto independientes como en cooperaci贸n con productos de software de terceros. </li></ol><br><blockquote>  驴Qu茅 industrias usan m谩s com煤nmente la plataforma InterSystems IRIS? <br>  Para la automatizaci贸n de la salud, en el sector financiero, para proyectos de gobierno electr贸nico, en log铆stica, comercio minorista y muchas otras industrias. <br><br>  Si est谩 interesado en las tareas de automatizaci贸n de la atenci贸n m茅dica, preste atenci贸n al est谩ndar FHIR.  InterSystems IRIS for Health (una versi贸n especial de la plataforma InterSystems IRIS) tiene soporte para el est谩ndar FHIR para integraci贸n y desarrollo de aplicaciones </blockquote>  Como puede ver arriba, todas las caracter铆sticas de OAuth son f谩cilmente accesibles y est谩n completamente listas para usar.  Si es necesario, puede reemplazar las clases de controlador y las interfaces de usuario con las suyas propias.  El servidor OAuth y la configuraci贸n del cliente pueden realizarse a partir de archivos de configuraci贸n, en lugar de utilizar el portal de administraci贸n. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/466699/">https://habr.com/ru/post/466699/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../466685/index.html">Viendo dinero</a></li>
<li><a href="../466689/index.html">C贸mo crear clases de personajes en la acci贸n MMO m贸vil</a></li>
<li><a href="../466691/index.html">Entonces, 驴todo lo mismo RAML u OAS (Swagger)?</a></li>
<li><a href="../466693/index.html">Si ingresas no en TI</a></li>
<li><a href="../466697/index.html">M贸nadas en Erlang</a></li>
<li><a href="../466701/index.html">Let's Encrypt sirve casi el 30% de los dominios</a></li>
<li><a href="../466705/index.html">Vivaldi Beta para Android - Navegador real</a></li>
<li><a href="../466709/index.html">Desarrollo de un sistema operativo monol铆tico tipo Unix - Biblioteca C (2)</a></li>
<li><a href="../466711/index.html">Vulnerabilidad DaOffice permiti贸 eliminar a cualquier usuario de la red social</a></li>
<li><a href="../466713/index.html">驴Es posible en 1C no observar la tecnolog铆a de los componentes externos? O 驴C贸mo felicitar a los colegas que usan 1C?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>