<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📃 ⏹️ 👨‍🚀 Domar protocolos de confianza: autenticación OAuth con InterSystems IRIS 🤧 💀 🧓🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¿Cómo permitir que las computadoras confíen entre sí en su ausencia, mientras mantienen la seguridad y la privacidad? 



 - Martini seco. En un gran ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Domar protocolos de confianza: autenticación OAuth con InterSystems IRIS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/intersystems/blog/466699/">  <b>¿Cómo permitir que las computadoras confíen entre sí en su ausencia, mientras mantienen la seguridad y la privacidad?</b> <br><br><img src="https://habrastorage.org/webt/wn/au/eu/wnaueun6knwbjc4anclcexjbfwi.jpeg"><br><br>  - Martini seco.  En un gran vaso. <br>  - Oui, señor.  [Sí, señor (p.)] <br>  "Solo un segundo, no todos".  Tres dedos de Gordon, uno de vodka, medio dedo de Kina Lyklet.  Batir bien en una coctelera y luego poner una rodaja grande de limón.  ¿Te acuerdas? <br><br>  Jan Fleming, Casino Royale, 1953 <br><br><h2>  Parte 1. Historias de OAuth 2.0 y OpenID Connect </h2><br>  Universal y, al parecer, hoy en el siglo XXI, el conjunto favorito de protocolos de autenticación y delegación de acceso abierto de todos se llama OAuth + OIDC.  Mejor para el uso masivo hasta ahora no se le ocurrió nada.  Son especialmente populares entre los proveedores front-end porque caminan sobre los protocolos HTTP (S) y usan el contenedor JWT ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JSON Web Token</a> ).  OpenID Connect utiliza OAuth para su trabajo o, en otras palabras, OIDC es un contenedor para OAuth. <br><br>  OpenID: un estándar abierto para la autenticación y la creación de sistemas de identificación digital no es nuevo para los desarrolladores.  Este año, cumple 14 años.  En la tercera versión actual, el nombre completo es OpenID Connect o más corto que OIDC.  Es popular tanto en el desarrollo web y móvil, como en los sistemas corporativos. <br><a name="habracut"></a><br>  Su socio, el Estándar de Delegación de Acceso Abierto de OAuth, cumple 12 años.  Y 9 años desde que apareció el estándar RFC 5849 correspondiente. Confiaremos en la versión moderna del protocolo OAuth 2.0 y el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 6749</a> actual.  Recuerde que OAuth 2.0 no es compatible con su predecesor OAuth 1.0. <br><blockquote>  OAuth: un protocolo abierto (esquema, transporte) para delegar el acceso, que permite proporcionar a terceros acceso limitado a los recursos protegidos del usuario sin la necesidad de transferir a ellos (terceros) el nombre de usuario y la contraseña de RFC 6749 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">oauth.net</a> es el sitio web líder de OAuth alojado por Aaron Parecki <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">oauth.com</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tutorial de</a> OAuth y entorno de prueba <br><br>  Open ID Connect (OIDC) es un estándar abierto para sistemas de identificación descentralizados que permite al usuario crear una sola cuenta para identificación en una variedad de recursos de Internet no relacionados que utilizan servicios de terceros, utiliza mensajes OAuth y un contenedor JWT para una comunicación segura. <br></blockquote>  Estrictamente hablando, OAuth no es un protocolo, sino un conjunto de reglas (esquema) para separar y transferir operaciones de identificación de usuarios a un servidor de confianza separado al implementar la arquitectura de delimitación de control de acceso en sistemas de software. <br><br>  Y, atención, ¡ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OAuth no puede decir nada sobre un usuario específico</a> !  Ni quién es, ni dónde está ahora, ni si trabaja en la computadora ahora o no.  Pero luego permite interactuar con los sistemas sin intervención del usuario, utilizando tokens de acceso ya emitidos.  Este es un punto importante. <br><blockquote>  Puede ser útil: <br><br><ul><li>  OAuth combina perfectamente con el uso del lenguaje de descripción de acceso de atributos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">XACML</a> </li><li>  OAuth también se basa en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">acceso administrado por</a> el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">usuario</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UMA</a> ) </li></ul><br>  El uso conjunto de OAuth + OIDC + UMA permite implementar sistemas de identificación segura y control de acceso (Identity and Access Management - IdM, IAM) en diferentes áreas temáticas, por ejemplo: <br><br><ul><li>  utilizando el perfil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HEART</a> (Health Relationship Trust) de los datos personales de un paciente en medicina </li><li>  en las plataformas de identificación de clientes CIAM (Consumer Identity and Access Management) para empresas manufactureras y comerciales </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">personalización de certificados digitales de dispositivos inteligentes</a> en sistemas IoT (Internet of Things) </li></ul></blockquote><img src="https://habrastorage.org/webt/pf/dt/vf/pfdtvf4d6obgfiom0tizekdsjis.png"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Una nueva forma de control de acceso para la economía API</a> <br><br>  Lo más importante, no almacene datos personales en el mismo lugar que el resto del sistema.  Separar físicamente la autenticación y autorización.  Y aún mejor: dele toda la identificación personalmente a la persona y nunca la lleve consigo.  Confía en el propietario del dispositivo. <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apple dijo</a> qué datos personales almacenan los rusos en Rusia.  Este es el nombre, dirección, correo electrónico, número de teléfono.  Pero las personas de Mensajes, fotos, etc., confían en la nube de iCloud (que no está en Rusia). <br></blockquote><h2>  Parte 2. Juego corto "Confianza y autenticación" </h2><br>  Por lo tanto, decidimos que no era fabuloso almacenar los datos personales de nuestros queridos usuarios ni en nuestra aplicación, ni en un único almacenamiento junto con una base de datos operativa.  Es decir, han elegido un administrador confiable que nos brindará este servicio.  Y así, cuando aparece Su Majestad el Usuario, entonces proporcionamos el siguiente diálogo. <br><br>  Actores: <br><br><ul><li>  Usuario </li><li>  Solicitud de cliente </li><li>  Servicio de identidad </li><li>  Servidor de recursos </li></ul><br>  La acción tiene lugar en un navegador en la computadora del usuario.  Todos los personajes han estado familiarizados el uno con el otro.  El usuario tiene una cuenta personal en el servicio de identidad.  La Aplicación del cliente tiene un contrato válido firmado con el Servicio de identificación y las interfaces mutuas.  El servidor de recursos confía en el servicio de identidad en la cuestión de emitir claves de acceso a cualquier víctima a quien pueda identificar. <br><br>  Usuario (P): (al iniciar una aplicación cliente basada en la web) Estimado cliente-aplicación, necesito "este recurso". <br>  Aplicación de cliente (K): Estimado usuario, primero presente la clave de "este recurso".  Sin una clave, el acceso a "este recurso" está cerrado. <br>  P: No tengo esa clave. <br>  K: Luego lo cambiaré temporalmente a un servicio de identificación con el que tenemos un acuerdo para emitir claves para el servidor de recursos.  (redirige P. al servicio de identificación) <br>  Servicio de identificación (I): Estimado usuario, dígame quién es usted y qué claves necesita. <br>  P: Yo, usuario de Ytsuken User, la contraseña es tal y tal, quiero obtener acceso a "este recurso". <br>  Y: gracias, camarada Jtsuken.  La autenticación se realizó correctamente y se verificó su identificación.  Aquí está la clave de "este recurso" (P. vuelve a dirigir a K.) <br>  P: Cliente, te traje la clave del "recurso" que necesito. <br>  K: Gracias usuario.  La clave es correcta.  Aquí está el "recurso" que solicitó. <br><br>  El telón  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Se reproduce la sinfonía de apertura de Richard Strauss</a> de la película "Space Odyssey of 2001" <br><br><h2>  Parte 3. Servicio de autorización real </h2><br>  Ahora vamos al grano.  Tenemos tres tareas en la agenda: nombrar a los personajes, preparar el escenario y jugar la obra.  Y todo se decide a la vez en la plataforma InterSystems IRIS.  Pero esto no es necesario, puede armar un diseño desde diferentes plataformas a su discreción.  Por ejemplo, en esta combinación: servidor OAuth Keycloak + cliente OAuth y recurso OAuth en IRIS.  En otras palabras: <br><br><ol><li>  Configure e inicie el servidor OAuth con el registro de nuestro cliente de demostración. </li><li>  Configure un cliente OAuth de demostración conectándolo al servidor OAuth y a los recursos web. </li><li>  Desarrolle aplicaciones cliente que puedan usar OAuth.  Puede usar Java, Python, C #, NodeJS.  El siguiente es un código de aplicación de muestra en ObjectScript. </li></ol><br><blockquote>  El sitio web de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la comunidad de desarrolladores</a> cuenta con instrucciones detalladas de Daniel Kutak en tres partes con ejemplos de uso de OAuth en IRIS para diferentes aplicaciones basadas en CSP ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 3</a> ). </blockquote>  Hay muchas configuraciones en OAuth.  Por lo tanto, escríbete listas de verificación: esta es la aplicación más correcta para ellos.  Ejemplos y espacios en blanco a continuación. <br><blockquote>  ¿Dónde obtener InterSystems IRIS listo para una muestra?  Hay al menos dos opciones disponibles para todos: <br><br>  Obtenga un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">servidor IRIS</a> en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nube preconfigurado listo para</a> usar en la plataforma de capacitación de InterSystems Learning Services en la sección InterSystems Learning Labs. <br><br>  Instale un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">contenedor acoplado listo para usar</a> .  Lea más en el artículo: una instrucción paso a paso para principiantes en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lanzamiento de desarrolladores de IRIS con Docker</a> o, si prefieren un video, una instrucción de screencast de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Desarrollo de soluciones con InterSystems IRIS con Docker y VSCode</a> </blockquote><h3>  1-1 Configuración del servidor OAuth </h3><br>  Entramos en el portal de gestión de IRIS y seleccionamos la sección: <br><br>  Administración del sistema &gt;&gt; Seguridad &gt;&gt; OAuth 2.0 &gt;&gt; Servidor <br><br>  A continuación, en cada párrafo, habrá un nombre para la línea de configuración y, a través de los dos puntos, un ejemplo o explicación, si es necesario. <br><br><img src="https://habrastorage.org/webt/9g/k4/by/9gk4bywq0a0dkkkprpu5wbnempo.png"><br><br>  <b>Pestaña Configuración general:</b> <br>  Descripción: opcional, por ejemplo, "Servidor de autorización" <br>  El punto final del generador (en adelante CTG) es el nombre de host: nombre DNS de su servidor <br>  Tipos de permisos admitidos (seleccione al menos uno): <br>  Código de autorización <br>  Implícito <br>  Credenciales: recurso, propietario, contraseña <br>  Credenciales del cliente <br>  Configuración SSL / TLS: oauthserver <br><br>  <b>Pestaña de permisos:</b> <br>  agregar volúmenes compatibles: por ejemplo, alcance1 y alcance2 <br><br>  <b>Pestaña Intervalos:</b> <br>  Intervalo de clave de acceso: 3600 <br>  Intervalo de código de autorización: 60 <br>  Actualizar intervalo de clave: 86400 <br>  Intervalo de interrupción de sesión: 86400 <br>  Período de validez de la clave del cliente: 0 <br><br>  <b>Pestaña de configuración de JWT:</b> <br>  Algoritmo de entrada: RS512 <br>  Algoritmo de gestión de claves: RSA-OAEP <br>  Algoritmo de cifrado de contenido: A256CBC-HS512 <br><br>  <b>Pestaña de personalización:</b> <br>  Identificar clase:% OAuth2.Server.Authenticate <br>  Verificar clase de usuario:% OAuth2.Server.Validate <br>  Clase de servicio de sesión: OAuth2.Server.Session <br>  Generar clase de clave:% OAuth2.Server.JWT <br>  Espacio de nombres de personalización:% SYS <br>  Roles de personalización (seleccione al menos uno):% DB_IRISSYS y% Manager <br><br>  Guardar. <br><br><h3>  1-2 Registre el cliente en el servidor OAuth </h3><br><img src="https://habrastorage.org/webt/ae/gu/pz/aegupzlmpoucnqfa4vu-f2gcgq0.png"><br><br>  Botón Descripción del cliente &gt;&gt; Botón Crear descripción del cliente: <br><br>  <b>Pestaña Configuración general:</b> <br>  Nombre: CLIENTE <br>  Descripción: arbitraria <br>  Tipo de cliente: confidencial <br>  URL de redireccionamiento: la dirección del punto de retorno en nuestra aplicación después de la autenticación <br>  Tipos de permisos admitidos <br>  Código de autorización: sí <br>  Implícito <br>  Credenciales: recurso, propietario, contraseña <br>  Credenciales del cliente <br>  Autorización JWT <br>  Tipos de respuestas admitidas <br>  codigo <br>  id_token <br>  clave id_token <br>  ficha <br>  Tipo de autorización: simple <br><br>  <b>Pestaña Credenciales de cliente:</b> rellenado automáticamente <br><br>  <b>Pestaña de información del cliente:</b> <br>  URL de lanzamiento: <br>  Pantalla de inicio de sesión <br>  Nombre del cliente <br>  URL del logotipo <br>  URL de la página de inicio del cliente <br>  URL de política <br>  Términos de URL de servicio <br><br><h3>  2-1 Configuración del enlace en el cliente del servidor OAuth </h3><br>  Administración del sistema &gt;&gt; Seguridad &gt;&gt; OAuth 2.0 &gt;&gt; Cliente <br><br><img src="https://habrastorage.org/webt/xq/hu/3r/xqhu3rquzsfni1tsfgwtfkhzvew.png"><br><br>  Crear una descripción del servidor: <br>  Punto final del generador: tome de los parámetros generales del servidor, ver arriba <br>  Configuración SSL / TLS: seleccione de la lista de preconfigurados <br><br>  El contenido de los campos restantes se descargará automáticamente del servidor, pero también puede configurarlos manualmente: <br><br>  Servidor de autorizaciones <br>  Punto final de autorización: CTG + / autorizar <br>  Punto final clave: CTG + / token <br>  Punto final de información del usuario: CTG + / userinfo <br>  Punto final clave del autodiagnóstico: CTG + / revocación <br>  Punto final de revocación clave: CTG + / introspección <br>  Configuración de token web JSON (JWT) <br>  Otra fuente además del registro dinámico: seleccione JWKS de URL <br>  URL: CTG + / jwks <br><br><img src="https://habrastorage.org/webt/ic/7e/x4/ic7ex4khfgskgdqf_jpsdivgj_o.png"><br><br>  De esta lista, por ejemplo, se puede ver (scopes_supported y Claim_supported) que el servidor puede proporcionar información diferente sobre el usuario al cliente OAuth.  Y vale la pena prestar atención a que al implementar su aplicación, deberá preguntarle al usuario qué datos está listo para compartir.  Además, en nuestro ejemplo, solo se nos pedirá permiso por alcance1. <br><br>  Guardar. <br><br>  Si hay un error que indica SSL, vaya a la configuración: <br>  Administración del sistema &gt;&gt; Seguridad &gt;&gt; Configuración SSL / TSL <br><br><h3>  2-2 Configuración del cliente OAuth </h3><br>  Administración del sistema &gt;&gt; Seguridad &gt;&gt; OAuth 2.0 &gt;&gt; Cliente &gt;&gt; Configuración del cliente &gt;&gt; Crear configuración del cliente <br><br><img src="https://habrastorage.org/webt/kd/e_/4w/kde_4wyvqd60yomyyudfzdotu_q.png"><br><br>  <b>Pestaña general:</b> <br>  Nombre de la aplicación: cliente de demostración <br>  Nombre del cliente: cliente de demostración <br>  Descripción: opcional <br>  Habilitado: sí <br>  Tipo de cliente: confidencial <br>  Configuración SSL / TCL: oauthclient <br>  URL de redireccionamiento del cliente: nombre DNS de su servidor <br>  Tipos de permisos requeridos <br>  Código de autorización: sí <br>  Implícito <br>  Credenciales: recurso, propietario, contraseña <br>  Credenciales del cliente <br>  Autorización JWT <br>  Tipo de autorización: simple <br><br>  <b>Pestaña de información del cliente:</b> <br>  Pantalla de inicio de sesión <br>  URL del logotipo <br>  URL de la página de inicio del cliente <br>  URL de política <br>  Términos de URL de servicio <br>  Volumen predeterminado: tomamos de los especificados anteriormente en el servidor, por ejemplo, scope1 <br>  Direcciones de correo electrónico de contacto (separadas por una coma) <br>  Edad máxima predeterminada (en segundos) <br><br>  <b>Pestaña de configuración de JWT:</b> <br>  Configuración de token web JSON (JWT) <br>  Creación de configuraciones JWT a partir de credenciales X509 <br>  ID Algoritmos Tomados <br>  Firma: RS256 <br>  Cifrado: A256CBC <br>  Clave: RSA-OAEP <br>  Algoritmos de información de usuario <br>  Algoritmos de token de acceso <br>  Algoritmos de consulta <br><br>  <b>Pestaña Credenciales de cliente:</b> <br>  Id  cliente: del emitido tras el registro del cliente en el servidor (ver arriba) <br>  Identificación del cliente emitida <br>  Secreto del cliente: del que se emitió al registrar al cliente en el servidor (ver arriba) <br>  El secreto del cliente caduca <br>  URI de registro de cliente <br><br>  Guardar. <br><br><h2>  Parte 4. Código </h2><br>  Creemos una aplicación web minimalista con autorización OAuth y REST. <br><blockquote>  Al trabajar, OAuth se basa en el hecho de que los canales de comunicación entre los participantes en la interacción (servidor, clientes, aplicación web, navegador de usuario, servidor de recursos) están de alguna manera protegidos.  La mayoría de las veces, SSL / TLS desempeña este papel.  Pero OAuth también trabajará en canales inseguros.  Por ejemplo, el servidor Keycloak, por defecto, usa el protocolo HTTP y no tiene protección.  Esto simplifica el desarrollo y la depuración durante el desarrollo.  Con el uso real de los servicios de OAuth, la protección del canal debe estar estrictamente habilitada; esto se registra en la documentación de Keycloak.  Los desarrolladores de IRIS de InterSystems adoptan un enfoque más riguroso para OAuth: se requiere SSL / TSL.  La única simplificación es que puede usar certificados autofirmados o el servicio PKI integrado en IRIS (Administración del sistema &gt;&gt; Seguridad &gt;&gt; Sistema de clave pública). </blockquote>  La autorización del usuario se verifica con la indicación explícita de dos parámetros: el nombre de su aplicación y el volumen admitido por el servidor OAuth y en el cliente OAuth (alcance: ¿me pregunto cómo nombrarlo correctamente en ruso?): <br><br><pre><code class="plaintext hljs">Parameter OAUTH2APPNAME = "OAuthClient"; set isAuthorized = ##class(%SYS.OAuth2.AccessToken).IsAuthorized( ..#OAUTH2APPNAME, .sessionId, "scope1", .accessToken, .idtoken, .responseProperties, .error)</code> </pre> <br>  En ausencia de autorización, estamos preparando un enlace a una solicitud de identificación de usuario y obteniendo su permiso para trabajar con nuestra aplicación.  Aquí necesitamos indicar no solo el nombre de la aplicación y el volumen (alcance) solicitado registrado en el servidor OAuth y en el cliente OAuth, sino también un enlace de retroceso al que la aplicación web debería devolver al usuario. <br><br><pre> <code class="plaintext hljs">Parameter OAUTH2CLIENTREDIRECTURI = "https://52773b-76230063.labs.learning.intersystems.com/oauthclient/" set url = ##class(%SYS.OAuth2.Authorization).GetAuthorizationCodeEndpoint( ..#OAUTH2APPNAME, "scope1", ..#OAUTH2CLIENTREDIRECTURI, .properties, .isAuthorized, .sc)</code> </pre><br>  Utilizamos el servicio de autenticación IRIS incorporado y, en consecuencia, registramos a los usuarios en el servidor OAuth IRIS.  Por ejemplo, es suficiente establecer al usuario solo un nombre de usuario y contraseña, no necesitará realizar otras configuraciones en la cuenta. <br><br>  Al transferir al usuario utilizando el enlace recibido, el servidor llevará a cabo el procedimiento de identificación del usuario y le solicitará permiso para operar con credenciales en la aplicación web, y también guardará el resultado en su OAuth2.Server.Session global en el área% SYS: <br><br><img src="https://habrastorage.org/webt/dj/ih/ve/djihveewmoifbr9knths77mq-vi.png"><br><br><img src="https://habrastorage.org/webt/jb/ib/qz/jbibqzzejdf-gzo03bfcxdlkjjg.png"><br><br>  3. Demostrar los datos de un usuario autorizado.  Al completar con éxito los procedimientos, tenemos, por ejemplo, un token de acceso.  Vamos a entenderlo: <br><br><pre> <code class="plaintext hljs">set valid = ##class(%SYS.OAuth2.Validation).ValidateJWT( .#OAUTH2APPNAME, accessToken, "scope1", .aud, .JWTJsonObject, .securityParameters, .sc )</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Código de trabajo completo de un ejemplo de trabajo con OAuth:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Class OAuthClient.REST Extends %CSP.REST { Parameter OAUTH2APPNAME = "OAuthClient"; Parameter OAUTH2CLIENTREDIRECTURI = "https://52773b-76230063.labs.learning.intersystems.com/oauthclient/"; // to keep sessionId Parameter UseSession As Integer = 1; XData UrlMap [ XMLNamespace = "http://www.intersystems.com/urlmap" ] { &lt;Routes&gt; &lt;Route Method="GET" Url = "/" Call = "Do" /&gt; &lt;/Routes&gt; } ClassMethod Do() As %Status { // Check for accessToken set isAuthorized = ##class(%SYS.OAuth2.AccessToken).IsAuthorized( ..#OAUTH2APPNAME, .sessionId, "scope1", .accessToken, .idtoken, .responseProperties, .error) // to show accessToken if isAuthorized { set valid = ##class(%SYS.OAuth2.Validation).ValidateJWT( ..#OAUTH2APPNAME, accessToken, "scope1", .aud, .JWTJsonObject, .securityParameters, .sc ) &amp;html&lt; Hello!&lt;br&gt; &gt; w "You access token = ", JWTJsonObject.%ToJSON() &amp;html&lt; &lt;/html&gt; &gt; quit $$$OK } // perform the process of user and client identification and get accessToken set url = ##class(%SYS.OAuth2.Authorization).GetAuthorizationCodeEndpoint( ..#OAUTH2APPNAME, "scope1", ..#OAUTH2CLIENTREDIRECTURI, .properties, .isAuthorized, .sc) if $$$ISERR(sc) { w "error handling here" quit $$$OK } // url magic correction: change slashes in the query parameter to its code set urlBase = $PIECE(url, "?") set urlQuery = $PIECE(url, "?", 2) set urlQuery = $REPLACE(urlQuery, "/", "%2F") set url = urlBase _ "?" _ urlQuery &amp;html&lt; &lt;html&gt; &lt;h1&gt;  IRIS   OAuth2&lt;/h1&gt; &lt;a href = "#(url)#"&gt;  &lt;b&gt;IRIS&lt;/b&gt;&lt;/a&gt; &lt;/html&gt; &gt; quit $$$OK } }</code> </pre><br></div></div><br>  Si es necesario, habilite los mensajes de depuración extendida en el servidor OAuth y el cliente OAuth.  Los mensajes se escriben en el ISCLOG global en el área% SYS.  Escriba su terminal IRIS (o instale y use un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">terminal web</a> ): <br><br><pre> <code class="plaintext hljs">set ^%ISCLOG = 5 set ^%ISCLOG("Category", "OAuth2") = 5 set ^%ISCLOG("Category", "OAuth2Server") = 5</code> </pre><br>  Consulte la documentación de IRIS <a href="">Uso de OAuth 2.0 y OpenID Connect para obtener más información</a> . <br><br>  Conclusiones: <br><br><ol><li>  OAuth ayuda a separar física y geográficamente los servicios con credenciales de usuario y bases de datos "en funcionamiento".  Y, por lo tanto, fortalecer la protección de los datos de identificación y, si es necesario, cumplir con los requisitos de las leyes sobre protección de datos personales de diferentes países. </li><li>  Con OAuth, puede proporcionar al usuario la capacidad de trabajar de manera segura de manera simultánea desde múltiples dispositivos y "brillar" mínimamente sus datos personales a diversos servicios y aplicaciones.  Además de no tomar información "redundante" sobre los usuarios en sus servicios, es decir, llevar a cabo el procesamiento de datos despersonalizados en sus servicios. </li><li>  Cuando utiliza InterSystems IRIS, tiene un conjunto completo de herramientas listas para probar y desplegar servicios OAuth y OIDC, tanto independientes como en cooperación con productos de software de terceros. </li></ol><br><blockquote>  ¿Qué industrias usan más comúnmente la plataforma InterSystems IRIS? <br>  Para la automatización de la salud, en el sector financiero, para proyectos de gobierno electrónico, en logística, comercio minorista y muchas otras industrias. <br><br>  Si está interesado en las tareas de automatización de la atención médica, preste atención al estándar FHIR.  InterSystems IRIS for Health (una versión especial de la plataforma InterSystems IRIS) tiene soporte para el estándar FHIR para integración y desarrollo de aplicaciones </blockquote>  Como puede ver arriba, todas las características de OAuth son fácilmente accesibles y están completamente listas para usar.  Si es necesario, puede reemplazar las clases de controlador y las interfaces de usuario con las suyas propias.  El servidor OAuth y la configuración del cliente pueden realizarse a partir de archivos de configuración, en lugar de utilizar el portal de administración. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/466699/">https://habr.com/ru/post/466699/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../466685/index.html">Viendo dinero</a></li>
<li><a href="../466689/index.html">Cómo crear clases de personajes en la acción MMO móvil</a></li>
<li><a href="../466691/index.html">Entonces, ¿todo lo mismo RAML u OAS (Swagger)?</a></li>
<li><a href="../466693/index.html">Si ingresas no en TI</a></li>
<li><a href="../466697/index.html">Mónadas en Erlang</a></li>
<li><a href="../466701/index.html">Let's Encrypt sirve casi el 30% de los dominios</a></li>
<li><a href="../466705/index.html">Vivaldi Beta para Android - Navegador real</a></li>
<li><a href="../466709/index.html">Desarrollo de un sistema operativo monolítico tipo Unix - Biblioteca C (2)</a></li>
<li><a href="../466711/index.html">Vulnerabilidad DaOffice permitió eliminar a cualquier usuario de la red social</a></li>
<li><a href="../466713/index.html">¿Es posible en 1C no observar la tecnología de los componentes externos? O ¿Cómo felicitar a los colegas que usan 1C?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>