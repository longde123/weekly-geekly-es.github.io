<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ûó üëåüèø üìê Grundlegendes zu Google Chrome Konvertieren von HTML in PDF-Funktionen üßïüèº üöà üë©üèø‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="K√ºrzlich habe ich in einem Startup das Problem des Generierens von Tickets im PDF-Format gel√∂st. Zu diesem Zeitpunkt war bereits eine Website mit eine...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Grundlegendes zu Google Chrome Konvertieren von HTML in PDF-Funktionen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459112/"><p><img src="https://habrastorage.org/webt/nl/zz/on/nlzzon_ar_4p3nuhes4p4cgq2ey.jpeg"></p><br><p>  K√ºrzlich habe ich in einem Startup das Problem des Generierens von Tickets im PDF-Format gel√∂st.  Zu diesem Zeitpunkt war bereits eine Website mit einem etablierten Stapel von Technologien fertig, daher suchte ich nach einem Ansatz, f√ºr den keine zus√§tzlichen Tools erforderlich sind.  Am Ende schlug ich vor, zuerst Tickets im HTML-Format zu erstellen und dann mit dem Chrome-Browser in PDF zu konvertieren.  Wie sich herausstellte, kann diese Methode nicht nur Tickets generieren, die reich mit CSS dekoriert sind, sondern auch eine Vielzahl von Berichten mit Diagrammen in JavaScript.  In diesem Artikel werde ich erl√§utern, wie Sie Chrome f√ºr diese Zwecke starten, einige Tipps zum Anpassen von CSS geben und die Nachteile dieser L√∂sung erl√§utern. </p><a name="habracut"></a><br><p>  Alternative Optionen werden hier nicht behandelt, da bereits genug dar√ºber geschrieben wurde, sie leicht zu finden sind und es sich um vorgefertigte Tools handelt, deren Informationen in den Prim√§rquellen besser zu finden sind - in der Dokumentation auf offiziellen Websites.  Die vorgeschlagene Methode ist kein eigenst√§ndiges Werkzeug und eher ein Nebenprodukt der Entwicklung mehrerer Technologien.  Im russischsprachigen Segment des Internets werden nur wenige Informationen gesammelt, daher habe ich beschlossen, die L√ºcke zu schlie√üen. </p><br><h2 id="pochemu-vybran-imenno-etot-variant">  Warum wird diese Option gew√§hlt? </h2><br><p>  Der gr√∂√üte Vorteil ist, dass Chrome den Technologie-Stack nicht erweitern muss, um PDFs zu generieren.  Frontend-Entwickler erstellen HTML mit vertrauten Entwicklungstools und sehen sofort die Zwischenergebnisse der Arbeit im Browser.  Gleichzeitig dreht sich Chrome wahrscheinlich in Tests und die √úbertragung auf das Backend ist nicht schwierig.  Es sollte auch beachtet werden, dass der Codierer auf das gesamte Arsenal an CSS-Eigenschaften einschlie√ülich Flexbox und Grid zugreifen kann. <br>  Ich werde im Verlauf des Artikels √ºber die M√§ngel und M√∂glichkeiten sprechen, sie zu umgehen. </p><br><h2 id="reshaem-zadachu-odnoy-strokoy">  Wir l√∂sen das Problem in einer Zeile </h2><br><p>  In der Befehlszeile rufen wir Chrome im Headless-Modus auf und speichern die Seite im PDF-Format: </p><br><pre><code class="bash hljs">chrome --headless --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-gpu --<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>-to-pdf https://google.com</code> </pre> <br><p>  Linux-Benutzer m√ºssen m√∂glicherweise einen <code>chromium-browser</code> anstelle von <code>chrome</code> ausf√ºhren. <br>  MAC-Benutzer finden es m√∂glicherweise hilfreich, Alias ‚Äã‚Äãvorab zu erstellen: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> chrome=<span class="hljs-string"><span class="hljs-string">"/Applications/Google\\ \\Chrome.app/Contents/MacOS/Google\\ \\Chrome"</span></span></code> </pre> <br><p>  UPDATE: In den Kommentaren wurde klargestellt, dass Windows-Benutzer den Namen der PDF-Datei explizit festlegen m√ºssen <code>--print-to-pdf=output.pdf</code> </p><br><p>  Wenn Sie bereits √ºber einen HTML-Dokumentgenerator verf√ºgen, geben Sie anstelle von <code>https://google.com</code> die URL an, unter der dieses Dokument empfangen werden soll. </p><br><p>  √ñffnen Sie die Datei <code>output.pdf</code> im lokalen Verzeichnis und sehen Sie sich das Ergebnis an. <br>  Das erste, was auff√§llt, ist das Vorhandensein einer Kopfzeile mit einem Druckdatum und einer Fu√üzeile mit einer URL und einer Paginierung.  Um sie zu entfernen, m√ºssen Sie einige CSS-Regeln hinzuf√ºgen.  Es ist unwahrscheinlich, dass diese Regeln zu <code>google.com</code> hinzugef√ºgt werden. F√ºr weitere Arbeiten ist es daher besser, ein eigenes HTML-Dokument zu erstellen. </p><br><h2 id="dobavlyaem-css">  CSS hinzuf√ºgen </h2><br><p>  CSS hat eine spezielle Medienabfrage <code>@page</code> , die zum Drucken verwendet wird. Wir werden Einr√ºckungen <code>@page</code> , damit <code>@page</code> und Fu√üzeile einfach nicht passen: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">size</span></span>: A4; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0mm</span></span>; }</code> </pre> <br><p>  Diese Methode funktioniert nur f√ºr einseitige Dokumente. Wenn Sie zwei oder mehr Seiten drucken, bleibt die Fu√üzeile mit der URL und der Seitennummerierung unten unten.  Sie k√∂nnen Chrome explizit <code>displayHeaderFooter = False</code> , die Anzeige von Kopf- und Fu√üzeile zu <code>displayHeaderFooter = False</code> , indem Sie den <code>displayHeaderFooter = False</code> wird er jedoch nicht in die Befehlszeilenschnittstelle verschoben.  Um dorthin zu gelangen, ben√∂tigen Sie Tools, um die Arbeit mit dem Browser zu automatisieren: Selen oder Puppenspieler.  Als n√§chstes werde ich die erste Option in Betracht ziehen, da mein Projekt Python verwendet hat. </p><br><h2 id="zapuskaem-chrome-cherez-selenium">  Starten Sie Chrome √ºber Selen </h2><br><p>  Installieren Sie Selenium mit dem Befehl <code>pip install selenium</code> , laden Sie den Chrome-Treiber herunter, der Ihrer Chrome-Version entspricht, von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://chromedriver.chromium.org/</a> und verwenden Sie die Funktion <code>get_pdf_from_html</code> aus dem folgenden Beispiel: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> webdriver <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium.webdriver.chrome.options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json, base64 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pdf_from_html</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path, chromedriver=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'./chromedriver'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, print_options = {})</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#  Chrome webdriver_options = Options() webdriver_options.add_argument('--headless') webdriver_options.add_argument('--disable-gpu') driver = webdriver.Chrome(chromedriver, options=webdriver_options) #   url driver.get(path) #    calculated_print_options = { 'landscape': False, 'displayHeaderFooter': False, 'printBackground': True, 'preferCSSPageSize': True, } calculated_print_options.update(print_options) #    pdf  result = send_devtools(driver, "Page.printToPDF", calculated_print_options) driver.quit() #    base64 -  return base64.b64decode(result['data']) def send_devtools(driver, cmd, params={}): resource = "/session/%s/chromium/send_command_and_get_result" % driver.session_id url = driver.command_executor._url + resource body = json.dumps({'cmd': cmd, 'params': params}) response = driver.command_executor._request('POST', url, body) if response['status']: raise Exception(response.get('value')) return response.get('value') if __name__ == "__main__": if len(sys.argv) != 3: print ("usage: converter.py &lt;html_page_sourse&gt; &lt;filename_to_save&gt;") exit() result = get_pdf_from_html(sys.argv[1]) with open(sys.argv[2], 'wb') as file: file.write(result)</span></span></code> </pre><br><p>  Um eine PDF-Datei zu erhalten, k√∂nnen Sie dieses Beispiel √ºber die Befehlszeile ausf√ºhren, indem Sie die URL und den Dateinamen <code>get_pdf_from_html</code> , um die PDF-Datei zu speichern, oder die Funktion <code>get_pdf_from_html</code> und drei Argumente √ºbergeben: </p><br><ol><li>  Pfad - URL des HTML-Dokuments; </li><li>  chromedriver - der Pfad auf dem lokalen Computer zum Chrome-Treiber (standardm√§√üig muss er sich im lokalen Verzeichnis befinden); </li><li>  print_options - zus√§tzliche Druckattribute. </li></ol><br><p>  Es ist zu beachten, dass Selenium keine Standardschnittstelle zum Drucken einer Seite in PDF hat und nur Chrome dies kann. Sie m√ºssen daher direkt <code>driver.command_executor._request</code> . </p><br><p>  Lassen Sie uns nun sehen, welche Tools verf√ºgbar sind, um die Platzierung von Inhalten in mehrseitigen Dokumenten zu steuern. </p><br><h2 id="tipografika-v-css">  CSS-Typografie </h2><br><p>  Beim Duplexdruck k√∂nnen Sie f√ºr die rechte und die linke Seite einzeln unterschiedliche R√§nder vom Rand festlegen, wenn Sie sie in Zukunft zusammenf√ºgen m√∂chten: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:left</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">4cm</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">2cm</span></span>; } @<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:right</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">4cm</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">2cm</span></span>; }</code> </pre> <br><p>  F√ºr die erste Seite k√∂nnen Sie Ihr eigenes Design angeben, z. B. einen vergr√∂√üerten Einzug vom oberen Rand: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:first</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">10cm</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Top margin on first page 10cm */</span></span> }</code> </pre> <br><p>  Es ist m√∂glich, den Seitenumbruch vor der √úberschrift der ersten Ebene so festzulegen, dass er auf einer ungeraden Seite beginnt: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h1</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-before </span></span>: right }</code> </pre> <br><p>  Mit der Eigenschaft " <code>page-break-after</code> k√∂nnen Sie einen Seitenumbruch unmittelbar nach einem Element verhindern, z. B. nach einem Header der zweiten Ebene: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h2</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-after </span></span>: avoid }</code> </pre> <br><p>  Die Eigenschaft zum <code>page-break-inside</code> hilft dabei, Seitenumbr√ºche zu vermeiden, wenn dies unerw√ºnscht ist, z. B. in der Mitte einer Tabelle </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-inside </span></span>: avoid }</code> </pre> <br><p>  Die <code>orphans</code> <code>orphans</code> und " <code>orphans</code> verhindern Seitenumbr√ºche am Anfang und Ende eines Absatzes: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">orphans</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">widows</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><h2 id="chto-s-proizvoditelnostyu">  Was ist mit Leistung? </h2><br><p>  Auf einem Core i5-8600K 3600MHz in einen Stream dauert eine einfache Dokumentkonvertierung 0,6 Sekunden.  Auf meiner tragbaren Schreibmaschine Ende 2013 2,4 GHz - 1,5 Sekunden. <br>  Offensichtlich werden die Hauptressourcen f√ºr das Starten des Browsers ausgegeben.  Sie k√∂nnen die Konvertierungszeit f√ºr eine gro√üe Anzahl von Dateien verk√ºrzen, wenn Sie Chrome einmal als Microservice ausf√ºhren und ihm eine URL zur Konvertierung senden.  Die Implementierung dieser Methode w√ºrde den Rahmen dieses Artikels sprengen. </p><br><h2 id="chto-esche-ne-tak">  Was ist sonst noch falsch? </h2><br><p>  Ich sehe zwei Hauptprobleme: </p><br><ol><li>  Die Unm√∂glichkeit, einfach die Position von Elementen in einem Dokument zu bestimmen.  Dies macht es schwierig, ein Inhaltsverzeichnis mit automatischer Anzeige der Seitenzahlen zu erstellen, insbesondere wenn die Gr√∂√üe des Inhalts nicht im Voraus bekannt ist. </li><li>  Die Conversion von Chrome ist das Produkt von Google, das eine Vielzahl von Informationen √ºber Nutzer sammelt.  Wenn Datenlecks aus dem Dokument nicht akzeptabel sind, sollten Sie bei der vorgeschlagenen L√∂sung vorsichtig sein - schlie√üen Sie den Browser mit Zugriff auf externe Ressourcen oder suchen Sie sogar nach einer anderen L√∂sung.  Die Verwendung von Open Source Chromium l√∂st das Problem nicht - es wurden bereits Fehler von Google gefunden. </li></ol><br><h2 id="vyvody">  Schlussfolgerungen </h2><br><p>  Ich schlage vor, Schlussfolgerungen √ºber die Zul√§ssigkeit der alleinigen Anwendung dieses Ansatzes zu ziehen.  Jedes Projekt ist auf seine Weise einzigartig.  Ob diese Methode f√ºr Ihr Projekt geeignet ist, liegt bei Ihnen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de459112/">https://habr.com/ru/post/de459112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de459100/index.html">GitHub Package Registry unterst√ºtzt Swift-Pakete</a></li>
<li><a href="../de459102/index.html">Geschenkplatte oder kostenlose Musik f√ºr Cola-Liebhaber und fertiges Fr√ºhst√ºck</a></li>
<li><a href="../de459104/index.html">C # oder Java? TypeScript oder JavaScript? Die Klassifizierung von Programmiersprachen basierend auf maschinellem Lernen</a></li>
<li><a href="../de459108/index.html">Tesla wird in der zweiten H√§lfte dieses Jahres mehrere √úberraschungen gleichzeitig pr√§sentieren</a></li>
<li><a href="../de459110/index.html">Wir schreiben einen Angelbot im Spiel Albion Online in Python</a></li>
<li><a href="../de459114/index.html">14 besten WordPress SEO Plugins im Jahr 2019</a></li>
<li><a href="../de459116/index.html">Einen Schritt n√§her an der Thymusreparatur</a></li>
<li><a href="../de459118/index.html">Wie wir das neue Netzwerk auf Huawei im Moskauer B√ºro entworfen und implementiert haben, Teil 2</a></li>
<li><a href="../de459120/index.html">Modulare eingebettete Computer der UNO-1000/2000-Serie</a></li>
<li><a href="../de459122/index.html">Aleksey Savvateev: Jean Tyrols Nobelpreis f√ºr die Analyse unvollkommener M√§rkte (2014) und des kollektiven Ansehens</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>