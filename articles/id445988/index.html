<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ–ï¸ ğŸ¦ ğŸš³ Surat sementara sendiri: bot telegram âœŠğŸ¼ ğŸ˜ˆ ğŸ”Œ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seringkali dengan alat dan kemampuan baru, ada keinginan untuk bereksperimen dan mengimplementasikan sesuatu yang tidak biasa, yang belum pernah saya ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Surat sementara sendiri: bot telegram</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445988/"> Seringkali dengan alat dan kemampuan baru, ada keinginan untuk bereksperimen dan mengimplementasikan sesuatu yang tidak biasa, yang belum pernah saya lakukan sebelumnya.  Gagasan untuk membuat layanan surat sementara saya dalam bentuk bot telegram bagi saya cukup menarik. <a name="habracut"></a><br><br><div class="spoiler">  <b class="spoiler_title">Sedikit latar belakang</b> <div class="spoiler_text">  Belum lama ini saya pindah dari hosting biasa ke VPS dan kebetulan setelah sebulan atau lebih, saya kembali harus pindah ke VPS lain.  Dalam kedua kasus tersebut, saya memiliki paket tarif termurah dan Ubuntu 16.04.  Karena terakhir kali pada saat itu saya menemukan terminal di universitas, yang sama saja dengan kurangnya pengalaman, saya menggunakan instruksi langkah-demi-langkah yang sangat baik dari DigitalOcean untuk mengkonfigurasi VPS saya (beberapa dari mereka telah diterjemahkan ke dalam bahasa Rusia untuk mereka yang, seperti saya, tidak cukup tahu bahasa Inggris).  Dan ya, VPS pertama saya adalah pada DO, dan saya harus pindah lagi terutama karena bagian dari alamat IP-nya jatuh di bawah distribusi ILV.  Setelah mengulangi prosedur pengaturan LAMP beberapa kali, saya terbiasa dengan terminal VPS sedikit dan, sebagai bagian dari pengembangan lebih lanjut, memutuskan untuk beralih ke eksperimen yang tidak biasa - untuk membuat layanan surat sementara saya sendiri, misalnya. <br></div></div><br>  Saya sudah memiliki pengalaman di backend, khususnya dalam menciptakan bot telegram di PHP MySQL, tetapi untuk menerima email "sendiri" - sepertinya jauh dan tidak bisa dipahami.  Setelah membuka beberapa tab dengan berbagai artikel tentang topik itu, saya menyadari bahwa saya tidak mengerti apa-apa.  Di mana-mana diusulkan untuk menggunakan banyak alat yang berbeda, yang menurut saya lebih cocok untuk layanan email lengkap daripada untuk tugas menerima pesan email masuk di VPS. <br><br><h3>  Terima Kotak Masuk </h3><br>  Untuk langkah pertama, sebuah artikel dari kotak pasir banyak membantu saya: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/en/post/260429</a> .  Saya menarik peringkat negatifnya, tapi itu menggambarkan apa yang membuat saya tertarik.  Saya ingin mendapatkan hasil yang saya bisa "rasakan" sesegera mungkin, dan dengan pemikiran "di masa depan saya akan melakukannya dengan benar" saya pergi untuk mengkonfigurasi sendmail. <br><br>  Lalu saya mengatur domain.  Catatan DNS: <br><br> <code>example.com IN MX 5 mail.example.com</code> <br>  <code>mail.example.com IN A XXX.XX.XXX.XXX</code> (ip address VPS) <br><br>  Di server, menambahkan baris <code>@example.com vasya</code> <code>/etc/mail/virtusertable</code> , dengan demikian menentukan bahwa semua email yang ditujukan untuk alamat di ****@example.com ditujukan ke Vasya. <br><br>  Untuk memproses surat masuk dengan skrip php, tambahkan baris <code>vasya: "|php -q /home/vasya/mail.php"</code> ke file <code>/etc/aliases</code> <code>vasya: "|php -q /home/vasya/mail.php"</code> . <br><br>  Setelah melakukan beberapa tes dan memastikan bahwa surat masuk diteruskan ke skrip php, saya bisa menangani prosesnya. <br><br>  Menerima surat masuk mentah yang dikirim ke php dengan cara yang dijelaskan di atas diimplementasikan dalam kode dengan sangat sederhana: <br><br><pre> <code class="php hljs">$msg = file_get_contents(<span class="hljs-string"><span class="hljs-string">"php://stdin"</span></span>);</code> </pre> <br>  Masalah yang sama sekali berbeda adalah analisis format surat dan penyajian data dengan cara yang dapat dipahami dan diakses.  Google menawarkan saya beberapa opsi tentang cara mem-parsing format email menggunakan PHP.  Semua perpustakaan yang saya temukan terseret pada pemasangan komponen tambahan, tetapi salah satu dari mereka tampaknya kurang rumit: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/zbateson/mail-mime-parser</a> .  Satu-satunya hal yang saya perlukan untuk menginstal tambahan adalah pengelola paket populer untuk PHP - Composer.  Tentu saja, saya tidak menjumpainya di hosting biasa, tetapi menginstalnya dan lebih lanjut menghubungkan perpustakaan untuk mem-parsing surat sama sekali tidak sulit. <br><br>  Awal skrip php untuk memproses surat masuk menggunakan perpustakaan zbateson / mail-mime-parser terlihat seperti ini: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">"vendor/autoload.php"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">ZBateson</span></span>\<span class="hljs-title"><span class="hljs-title">MailMimeParser</span></span>\<span class="hljs-title"><span class="hljs-title">MailMimeParser</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">ZBateson</span></span>\<span class="hljs-title"><span class="hljs-title">MailMimeParser</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>; $msg = file_get_contents(<span class="hljs-string"><span class="hljs-string">"php://stdin"</span></span>); $parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MailMimeParser(); $message = Message::from($msg);</code> </pre><br>  Karena surat sementara menurut saya tidak melibatkan beberapa penerima, cukup hanya mengambil yang pertama dari yang mungkin: <br><br><pre> <code class="php hljs">$to = $message-&gt;getHeader(<span class="hljs-string"><span class="hljs-string">'To'</span></span>); $email = $to-&gt;getAddresses()[<span class="hljs-number"><span class="hljs-number">0</span></span>]-&gt;getEmail();</code> </pre><br>  Dalam variabel $ email kami memiliki alamat penerima berupa vasyaorpetya@example.com. <br><br>  Untuk menerima konten surat yang masuk di perpustakaan ada metode yang tepat: <br><br><pre> <code class="php hljs">$from = $message-&gt;getHeader(<span class="hljs-string"><span class="hljs-string">'From'</span></span>)-&gt;getEmail(); $subject = $message-&gt;getHeaderValue(<span class="hljs-string"><span class="hljs-string">'Subject'</span></span>); $msg_text = $message-&gt;getTextContent(); $msg_html = $message-&gt;getHtmlContent();</code> </pre> <br><h3>  Bot telegram </h3><br>  Apa yang harus dilakukan bot email sementara telegram dulu? <br><br><ol><li>  Terbitkan alamat email sementara baru berdasarkan permintaan </li><li>  Kirim pesan kotak masuk untuk surel ini sementara alamat surel valid </li><li>  Perbarui Alamat Email </li></ol><br>  Cara yang cukup cocok dalam hal ini dan banyak kasus lain untuk menerima pembaruan dari Telegram adalah dengan menggunakan Webhook.  Hanya alamat skrip dengan https yang diperlukan.  Menggunakan Certbot untuk mengonfigurasi sertifikat domain ssl dijelaskan secara rinci dalam instruksi DO. <br><br>  Untuk berinteraksi dengan API Bot Telegram, saya menggunakan praktik terbaik saya sendiri.  Seseorang lebih suka menggunakan perpustakaan populer.  Mengirim pesan dengan tombol ke telegram telah lama menjadi hal yang biasa, karena banyak artikel telah ditulis. <br><br>  Pembuatan alamat email sementara pada dasarnya adalah output dari alamat berikutnya secara berurutan.  Saya membuat tabel untuk alamat email dalam database, di mana id bertipe int dengan kenaikan otomatis mengidentifikasi secara unik penerima.  Konversi angka numerik menjadi alamat string dilakukan ketika angka diterjemahkan ke dalam sistem angka lain, di mana seluruh alfabet Latin tersedia sebagai "angka".  26 huruf dibandingkan dengan angka memberikan pengurangan panjang pengenal yang baik.  Mungkin, saya juga bisa menggunakan huruf kapital, angka, dan beberapa karakter tanpa masalah untuk lebih jauh mengurangi panjang alamat yang dikeluarkan, tetapi saya hanya meninggalkan huruf Latin kecil. <br><br>  Fungsi untuk menerjemahkan id numerik ke dalam string dan sebaliknya: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// $alphabet = explode(",", "a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z"); //   @grayfolk: $alphabet = range('a', 'z'); function num2str($n, $a) { // $a -  $b = count($a); $r = 0; $x = ""; while ($n) { $r = $n%$b; $n = ($n-$r)/$b; $x .= $a[$r]; } return strrev($x); } function str2num($s, $a) { $n = 0; $b = count($a); $s = strrev($s); for ($i = 0; $i &lt; strlen($s); $i++) { $n += array_search($s[$i], $a) * pow($b, $i); } return $n; }</span></span></code> </pre><br>  Salah satu manfaat utama menggunakan layanan surat sementara adalah tidak adanya spam.  Tetapi jika alamatnya berurutan, Anda bisa membuat daftar alamat terdekat yang akan dikeluarkan dan berhasil melakukan pengiriman.  Untuk mengatasi masalah ini, saya menambahkan beberapa string acak ke ID penerima.  Untuk membedakan antara id dan komponen acak di alamat, saya memutuskan untuk selalu memulai komponen acak dengan angka. <br><br>  Kami menulis garis acak dari alamat email yang dikeluarkan dalam database bersama dengan id penerima, id pengguna dalam telegram dan waktu kotak surat dikeluarkan. <br><br>  Tampaknya Anda bahkan tidak perlu menyimpan surat masuk - mereka mengirimnya ke telegram dan itu saja.  Tapi bagaimana dengan huruf html?  Mereka tidak dapat ditampilkan dalam pesan obrolan.  Tetap merekam pesan html yang masuk dalam database dan menampilkannya di situs, dan mengirimkan tautan kepada pengguna yang menyertakan id pesan dan kata sandi yang dihasilkan berikutnya.  Untuk membersihkan database dengan mahkota, skrip php diluncurkan sesuai dengan jadwal, yang menghapus pesan html masuk yang diterima lebih dari satu jam yang lalu. <br><br>  Kemudian, di telegram bot, saya menambahkan tombol yang memperpanjang validitas kotak surat 10 atau 60 menit, serta tombol yang memungkinkan Anda mengetahui berapa banyak, bagaimanapun, ia harus hidup sebelum penerimaan pesan yang masuk dihentikan. <br><br>  Karena kami berurusan dengan pengguna terdaftar dalam telegram, Anda dapat memberikan kesempatan untuk mengaktifkan kotak surat lama Anda, misalnya, untuk mengembalikan kata sandi yang terlupakan di situs web atau untuk operasi lain yang memerlukan konfirmasi melalui email.  Kotak surat yang dikeluarkan "menerima" pesan masuk hanya ketika pengguna membutuhkannya, dan di lain waktu, kemungkinan spam diabaikan. <br><br><img src="https://habrastorage.org/webt/wg/lo/bj/wglobjdwkrbucatdge9zirxftxg.png"><br><br>  Wishlist untuk masa depan: <br><br><ul><li>  Buat versi web [selesai] </li><li>  Siapkan perubahan cepat domain email dalam beberapa klik / perintah (bagaimana?) </li></ul><br><h3>  Referensi </h3><br>  Bot Telegram: @tmpmailbot <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel yang menjelaskan konfigurasi sendmail</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pustaka PHP untuk parsing email</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id445988/">https://habr.com/ru/post/id445988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id445974/index.html">Cara mempromosikan pemula dan tidak merusak apa pun</a></li>
<li><a href="../id445978/index.html">Menyeberangi landak dengan landak: OpenJDK-11 + GraalVM</a></li>
<li><a href="../id445980/index.html">Kami memprogram kontrol suara copter menggunakan Node.js dan ARDrone</a></li>
<li><a href="../id445984/index.html">Badai Pencuri Pacsafe</a></li>
<li><a href="../id445986/index.html">Pengembangan Pelanggan sebagai Filosofi Kehidupan</a></li>
<li><a href="../id445992/index.html">Nauchpop minimal: ilusi optik</a></li>
<li><a href="../id445998/index.html">Cara berteman Progress OpenEdge dan Oracle DBMS</a></li>
<li><a href="../id446000/index.html">Apa yang salah dengan Yandex.Music? UX / UI parsing</a></li>
<li><a href="../id446006/index.html">Intel - terdengar baru</a></li>
<li><a href="../id446008/index.html">Alat open source untuk validasi kualitas pencarian berbasis niat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>