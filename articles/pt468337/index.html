<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óæÔ∏è ‚õ±Ô∏è üîî Trabalhando com o cron para Android e adicionando um script de shell √† execu√ß√£o autom√°tica quando o dispositivo √© inicializado üè¨ üêß üåè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Devido ao fato de os dispositivos m√≥veis terem longa funcionalidade, as tarefas de automa√ß√£o podem ser facilmente transferidas para eles. E, da melhor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trabalhando com o cron para Android e adicionando um script de shell √† execu√ß√£o autom√°tica quando o dispositivo √© inicializado</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468337/"><img src="https://habrastorage.org/webt/t2/ia/uo/t2iauogb45suwvzulewv9wbktr8.jpeg"><br><br>  Devido ao fato de os dispositivos m√≥veis terem longa funcionalidade, as tarefas de automa√ß√£o podem ser facilmente transferidas para eles.  E, da melhor maneira poss√≠vel, o cron √© t√£o bom para execut√°-los.  Mas se o cron demorar um pouco em sistemas Linux "comuns", um dispositivo Android precisar√° de um trabalho mais complicado para configur√°-lo. <br><br>  Se voc√™ est√° interessado no t√≥pico de automa√ß√£o e deseja que seus scripts de shell sejam executados imediatamente ap√≥s a inicializa√ß√£o do dispositivo, e ainda pode iniciar em um temporizador - bem-vindo ao gato! <br><a name="habracut"></a><br><h2>  Pref√°cio </h2><br>  Estou envolvido na automa√ß√£o de dispositivos m√≥veis para Android.  E durante a execu√ß√£o de scripts autom√°ticos, muitas situa√ß√µes imprevistas ocorrem, mesmo que os mesmos dispositivos sejam usados ‚Äã‚Äãpara teste. <br><br>  Problemas mais populares: <br><br>  0. O script de automa√ß√£o n√£o faz o que voc√™ queria. <br>  1. O aplicativo m√≥vel √© baixado automaticamente <br>  2. Reinicializa√ß√£o autom√°tica do telefone <br>  3. O aplicativo m√≥vel n√£o inicia automaticamente ap√≥s uma reinicializa√ß√£o <br>  4. O m√≥dulo Wi-Fi desliga aleatoriamente, n√£o encontra a rede, n√£o se conecta √† rede <br>  5. A rede m√≥vel desapareceu repentinamente <br>  6. O telefone entrou no modo de suspens√£o <br>  7. O proxy caiu ou o pr√≥prio servidor ou o servidor retornou uma resposta estranha <br><br>  Por esse motivo, √© necess√°rio monitorar constantemente o dispositivo e capturar essas situa√ß√µes imprevistas. <br><br><img src="https://habrastorage.org/webt/93/fb/-1/93fb-1wjpwjs3tcpvv4jzg9b2zw.png"><br><br>  Assim, cheguei √† conclus√£o de que o cron com os scripts "corretos" permitir√° rastrear falhas de software e restaurar o script de automa√ß√£o ou execut√°-lo novamente.  Mas, como se viu, embora o Android contenha o kernel do Linux, h√° nuances especiais com as quais eu tive que lidar.  Ent√£o, vamos come√ßar a configurar! <br><br><h2>  Configura√ß√£o do Cron </h2><br><h3>  Personalize o ambiente </h3><br><ol><li>  Instale o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">adb</a> para acessar o dispositivo atrav√©s do shell usando um fio USB. </li><li>  Abrimos a se√ß√£o <b>Para desenvolvedores</b> .  Para fazer isso, v√° para a se√ß√£o <b>Sobre o telefone</b> e fa√ßa alguns cliques no <b>n√∫mero</b> da <b>vers√£o</b> ou algo semelhante. </li><li>  Vamos para a se√ß√£o <b>Para desenvolvedores</b> e ativamos.  Conectamos o dispositivo ao computador e permitimos acesso neste computador a este dispositivo. </li><li>  Adicione <b>raiz</b> ao seu dispositivo.  As op√ß√µes mais comuns s√£o <b>SuperSu</b> , <b>Magisk</b> e <b>Kingroot</b> .  Acesse w3bsit3-dns.com e encontre a op√ß√£o de raiz para o seu dispositivo.  Infelizmente, n√£o h√° raiz universal. </li><li>  Instalamos o <b>BusyBox</b> (tamb√©m est√° em w3bsit3-dns.com, por exemplo), pois ele cont√©m apenas um programa cron. </li></ol><br><h3>  Configura√ß√£o manual de in√≠cio </h3><br><ol><li>  N√≥s nos conectamos ao telefone usando o <b>shell adb</b> (se o adb n√£o estiver registrado na sua vari√°vel de ambiente, adicione o caminho completo. </li><li>  V√° para o modo raiz com o comando <b>su</b> </li><li>  Verificamos a presen√ßa do programa cron e vemos as configura√ß√µes usando o comando <b>crond -h</b> </li></ol><br><div class="spoiler">  <b class="spoiler_title">resultado de execu√ß√£o</b> <div class="spoiler_text"><pre><code class="bash hljs">crond: invalid option -- h BusyBox v1.29.2-Stericson (2018-08-12 11:19:12 EDT) multi-call binary. Usage: crond -fbS -l N -d N -L LOGFILE -c DIR -f Foreground -b Background (default) -S Log to syslog (default) -l N Set <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> level. Most verbose 0, default 8 -d N Set <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> level, <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> to stderr -L FILE Log to FILE -c DIR Cron dir. Default:/var/spool/cron/crontabs</code> </pre> <br></div></div><br>  Como voc√™ pode ver na √∫ltima linha, as instru√ß√µes padr√£o devem ser armazenadas no diret√≥rio <b>/ var / spool / cron / crontabs</b> , que n√£o √© criado automaticamente e se executarmos o comando <pre> <code class="bash hljs">crond -b</code> </pre>  e verifique se o processo foi iniciado <pre> <code class="bash hljs">ps | grep crond</code> </pre>  , ent√£o pode n√£o estar l√°, porque  ele n√£o conseguiu nenhuma instru√ß√£o.  Ent√£o, vamos executar o comando <pre> <code class="bash hljs">crond -b -fd0</code> </pre>  e veja qual √© o motivo.  Provavelmente voc√™ ter√° um erro semelhante: <br>  <code>crond: can't change directory to '/var/spool/cron/crontabs': No such file or directory</code> .  Nesse caso, isso √© normal, porque  no futuro, n√≥s mesmos indicaremos o caminho para o arquivo execut√°vel crontab. <br><br>  4. Crie um arquivo crontab simples: <br><br><pre> <code class="bash hljs">mkdir /data/crontab <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"*/1 * * * * echo 'text' &gt;&gt; /sdcard/test.txt"</span></span> &gt; /data/crontab/root</code> </pre> <br>  Agora temos uma tarefa que a cada minuto adicionar√° a palavra <i>texto</i> ao arquivo <b>/sdcard/test.txt</b> <br>  Lan√ßamos: <pre> <code class="bash hljs">crond -b -fd0 -c /data/crontab</code> </pre>  e obtenha o seguinte log: <br><br><pre> <code class="bash hljs">crond: crond (busybox 1.29.2-Stericson) started, <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> level 0 crond: ignoring file <span class="hljs-string"><span class="hljs-string">'root'</span></span> (no such user) ...</code> </pre> <br>  Claro, √© um pouco surpreendente, porque se executarmos o <b>comando whoami,</b> ele retornar√° a <b>raiz</b> como resultado. <br><br>  5. Adicione o usu√°rio root, pois o crond pergunta: <br><br><pre> <code class="bash hljs">mount -o remount,rw /system; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"root:x:0:0::/system/etc/crontabs:/system/bin/sh"</span></span> &gt;&gt; /system/etc/passwd; mount -o remount,ro /system;</code> </pre> <br>  Devido √† falta desse arquivo, percebi que no sistema Android ele n√£o est√° envolvido.  Se voc√™ tiver certeza de onde armazenar√° seus arquivos crontab, poder√° substituir a linha <b>/ system / etc / crontabs</b> pela que voc√™ precisa.  Execute o comando novamente <br><br><pre> <code class="bash hljs">crond -b -fd0 -c /data/crontab</code> </pre> <br>  E temos o seguinte: <br><br><pre> <code class="bash hljs">crond: user:root entry:*/1 * * * * <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt 111111111111111111111111111111111111111111111111111111111111 111111111111111111111111 11111111111111111111111111111111 111111111111 1111111 crond: wakeup dt=16 crond: file root: crond: line <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: job: 0 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: can<span class="hljs-string"><span class="hljs-string">'t change directory to '</span></span>/system/etc/crontabs<span class="hljs-string"><span class="hljs-string">' crond: can'</span></span>t change directory to <span class="hljs-string"><span class="hljs-string">'/var/spool/cron'</span></span>: No such file or directory crond: USER root pid 12849 cmd <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt</code> </pre> <br>  Embora, de acordo com o log, a tarefa tenha sido registrada em crond, mas no meu caso o arquivo n√£o foi criado.  O problema pode ser resolvido de maneira muito simples: <br><br><pre> <code class="bash hljs">mkdir -p /system/etc/crontabs</code> </pre> <br>  Bem, ele quer que exista um diret√≥rio l√°, quem somos n√≥s para proibi-lo!  Come√ßamos novamente e vemos: <br><br><pre> <code class="bash hljs">crond: user:root entry:*/1 * * * * <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt 111111111111111111111111111111111111111111111111111111111111 111111111111111111111111 11111111111111111111111111111111 111111111111 1111111 crond: wakeup dt=12 crond: file root: crond: line <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: job: 0 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: child running /system/bin/sh crond: USER root pid 13033 cmd <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt</code> </pre> <br>  Os erros desapareceram e a linha <b>crond: child running / system / bin / sh apareceu</b> .  Finalmente, o cron foi encerrado com √™xito e voc√™ pode passar para a segunda parte! <br><br><h2>  Download autom√°tico de script de shell </h2><br>  O sistema Linux possui um diret√≥rio <b>init.d</b> respons√°vel pela inicializa√ß√£o autom√°tica imediatamente ap√≥s a inicializa√ß√£o do sistema, ent√£o vamos tentar desta maneira! <br><br>  1. Verifique se este diret√≥rio existe no seu dispositivo (este √© <b>/etc/init.d</b> ou <b>/system/etc/init.d</b> - esta √© a mesma parti√ß√£o montada etc).  No meu caso, n√£o √©.  Bem, ent√£o crie: <br><br><pre> <code class="bash hljs">mount -o remount,rw /system mkdir /system/etc/init.d chmod 0755 /system/etc/init.d mount -o remount,ro /system</code> </pre> <br>  Agora adicione algum script simples l√°, por exemplo: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"echo 'Init.d is working !!!' &gt;&gt; /sdcard/init_test.log"</span></span> &gt; /system/etc/init.d/90my_script chmod 777 /system/etc/init.d/90my_script</code> </pre> <br>  Reiniciamos o dispositivo e verificamos se houve um milagre ... Infelizmente, meu arquivo n√£o apareceu. <br><br>  Examinamos o sistema mais detalhadamente e procuramos algum arquivo init que possa executar scripts ap√≥s o lan√ßamento.  Eu tinha um arquivo no <b>/init.rc</b> no meu dispositivo.  Bem, vamos tentar alter√°-lo e reiniciar o dispositivo: <br><br><pre> <code class="bash hljs">mount -o remount,rw / <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"echo 'Init.d is working !!!' &gt;&gt; /sdcard/init_test.log"</span></span> &gt;&gt; /init.rc mount -o remount,ro / reboot</code> </pre> <br>  Mas o arquivo n√£o foi criado novamente.  Vamos examinar o arquivo <b>/init.rc</b> e nosso registro desapareceu e o arquivo n√£o pareceu mudar, porque  a data de cria√ß√£o √© bastante estranha (no meu caso, 1¬∫ de janeiro de 70 05:00:00). <br><br>  Continuamos a entender, e acontece que esse arquivo √© armazenado no <b>boot.img</b> e cada vez que sai dele.  E para alterar a funcionalidade do arquivo <b>init.rc</b> , <b>voc√™</b> precisa fazer tudo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">isso</a> . <br><br>  Mas existe uma maneira mais f√°cil de ajudar a resolver esse problema.  Para este m√©todo, podemos usar o seguinte script de shell (diga obrigado a Ryuinferno): <br><br><div class="spoiler">  <b class="spoiler_title">Script de shell</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/system/bin/sh #Script to enable init.d by Ryuinferno @ XDA error_msg(){ echo "You do not need this mod..." sleep 1 echo "If you are reapplying, please delete these files if present:" echo "/system/bin/sysinit" sleep 1 echo "/system/etc/install-recovery.sh" sleep 1 echo "/system/etc/install-recovery-2.sh" sleep 1 echo "And run again..." sleep 1 echo "If init.d is still not working, read the FAQ part in my thread..." sleep 1 echo "Aborting..." mount -o remount,ro -t auto /system echo "" echo "Ryuinferno @ XDA" exit 1 } echo "Init.d Enabler by Ryuinferno @ XDA" echo "" sleep 1 id=`id`; id=`echo ${id#*=}`; id=`echo ${id%%\(*}`; id=`echo ${id%% *}` if [ "$id" != "0" ] &amp;&amp; [ "$id" != "root" ]; then echo "Script NOT running as root!" sleep 1 echo "Superuser access not granted!" sleep 1 echo "Please type 'su' first before running this script..." exit 1 else echo "Hello Supaa User! :P" echo "" sleep 1 fi if [ ! "'which busybox'" ]; then echo "busybox NOT INSTALLED!" sleep 1 echo "Please install busybox first!" exit 1 else echo "busybox found!" sleep 1 fi bbb=0 if [ ! "`which grep`" ]; then bbb=1 echo "grep applet NOT FOUND!" sleep 1 else echo "Awesome! grep found! :D" sleep 1 fi if [ ! "`which run-parts`" ]; then bbb=1 echo "run-parts applet NOT FOUND!" sleep 1 else echo "Good! run-parts found! :)" echo "" sleep 1 fi if [ $bbb -eq 1 ] ; then echo "" echo "Required applets are NOT FOUND!" echo "" sleep 1 echo "Please reinstall busybox!" exit 1 fi echo "Great! Let's proceed..." echo "" sleep 1 echo "Press enter to continue..." read enterKey clear sleep 1 echo "Mounting system as rewritable..." mount -o remount,rw -t auto /system sleep 1 echo "Removing old sysinit file" rm /system/bin/sysinit sleep 1 echo "" echo "Checking for the presence of sysinit in /system/bin..." sleep 1 if [ -e /system/bin/sysinit ]; then echo "sysinit found..." if [ -z "`cat /system/bin/sysinit | grep "init.d"`" ]; then echo "Adding lines to sysinit..." echo "" &gt;&gt; /system/bin/sysinit echo "# init.d support" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit echo "export PATH=/sbin:/system/sbin:/system/bin:/system/xbin" &gt;&gt; /system/bin/sysinit echo "run-parts /system/etc/init.d" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit else echo "" echo "Your sysinit should already be running the scripts in init.d folder at boot..." error_msg fi else echo "sysinit not found, creating file..." echo "#!/system/bin/sh" &gt; /system/bin/sysinit echo "# init.d support" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit echo "export PATH=/sbin:/system/sbin:/system/bin:/system/xbin" &gt;&gt; /system/bin/sysinit echo "run-parts /system/etc/init.d" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit fi sleep 1 echo "Setting correct permissions and ownership for sysinit..." chmod 755 /system/bin/sysinit chown 0.2000 /system/bin/sysinit sleep 1 echo "" echo "Checking for the presence of install-recovery.sh..." sleep 1 if [ -f /system/etc/install-recovery.sh ] &amp;&amp; [ -z "`cat /system/etc/install-recovery.sh | grep "daemon"`" ]; then if [ ! -z "`cat /system/etc/install-recovery.sh | grep "init.d"`" ];then echo "Your install-recovery.sh seems to be already modified for init.d..." error_msg fi echo "install-recovery.sh found, renaming it as install-recovery-2.sh..." mv /system/etc/install-recovery.sh /system/etc/install-recovery-2.sh echo "Recreating install-recovery.sh..." echo "#!/system/bin/sh" &gt; /system/etc/install-recovery.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh echo "# excecuting extra commands" &gt;&gt; /system/etc/install-recovery.sh echo "/system/etc/install-recovery-2.sh" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh elif [ -f /system/etc/install-recovery.sh ] &amp;&amp; [ ! -z "`cat /system/etc/install-recovery.sh | grep "daemon"`" ]; then if [ -f /system/etc/install-recovery-2.sh ] &amp;&amp; [ ! -z "`cat /system/etc/install-recovery-2.sh | grep "init.d"`" ];then echo "Your install-recovery-2.sh seems to be already modified for init.d..." error_msg fi echo "install-recovery.sh is used for superuser, using install-recovery-2.sh instead..." if [ -f /system/etc/install-recovery-2.sh ]; then echo "" &gt;&gt; /system/etc/install-recovery-2.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery-2.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery-2.sh echo "" &gt;&gt; /system/etc/install-recovery-2.sh else echo "#!/system/bin/sh" &gt; /system/etc/install-recovery-2.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery-2.sh echo "" &gt;&gt; /system/etc/install-recovery-2.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery-2.sh echo "" &gt;&gt; /system/etc/install-recovery-2.sh fi if [ -z "`cat /system/etc/install-recovery.sh | grep "install-recovery-2.sh"`" ]; then echo "" &gt;&gt; /system/etc/install-recovery.sh echo "# extra commands" &gt;&gt; /system/etc/install-recovery.sh echo "/system/etc/install-recovery-2.sh" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh fi else echo "install-recovery.sh not found, creating it..." echo "#!/system/bin/sh" &gt; /system/etc/install-recovery.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh fi sleep 1 echo "Setting the correct permissions and ownership for install-recovery.sh..." echo "Also for install-recovery-2.sh if it exists..." chmod 755 /system/etc/install-recovery.sh chown 0.0 /system/etc/install-recovery.sh if [ -f /system/etc/install-recovery-2.sh ]; then chmod 755 /system/etc/install-recovery-2.sh chown 0.0 /system/etc/install-recovery-2.sh fi sleep 1 echo "" echo "Checking for the presence of the init.d folder..." sleep 1 if [ -d /system/etc/init.d ]; then echo "init.d folder found..." else echo "init.d folder not found, creating the folder..." mkdir /system/etc/init.d fi sleep 1 echo "" echo "Creating basic init.d scripts..." echo "#!/system/bin/sh" &gt; /system/etc/init.d/08setperm echo "#set correct permissions to /system/etc/init.d folder" &gt;&gt; /system/etc/init.d/08setperm echo "" &gt;&gt; /system/etc/init.d/08setperm echo "mount -o remount,rw -t auto /system" &gt;&gt; /system/etc/init.d/08setperm echo "chmod -R 777 /system/etc/init.d" &gt;&gt; /system/etc/init.d/08setperm echo "mount -o remount,ro -t auto /system" &gt;&gt; /system/etc/init.d/08setperm echo "" &gt;&gt; /system/etc/init.d/08setperm echo "#!/system/bin/sh" &gt; /system/etc/init.d/00test echo "#init.d test" &gt;&gt; /system/etc/init.d/00test echo "" &gt;&gt; /system/etc/init.d/00test echo "if [ -f /data/Test.log ]; then" &gt;&gt; /system/etc/init.d/00test echo "rm /data/Test.log" &gt;&gt; /system/etc/init.d/00test echo "fi" &gt;&gt; /system/etc/init.d/00test echo "" &gt;&gt; /system/etc/init.d/00test echo 'echo "Init.d is working !!!" &gt;&gt; /data/Test.log' &gt;&gt; /system/etc/init.d/00test echo 'echo "excecuted on $(date +"%d-%m-%Y %r" )" &gt;&gt; /data/Test.log' &gt;&gt; /system/etc/init.d/00test echo "" &gt;&gt; /system/etc/init.d/00test sleep 1 echo "Creating permissive SELinux script..." sleep 1 echo "#!/system/bin/sh" &gt;&gt; /system/etc/init.d/01permissive echo "#Init.d Permissive SELinux" &gt;&gt; /system/etc/init.d/01permissive echo "" &gt;&gt; /system/etc/init.d/01permissive echo "busybox mount -o remount,rw -t auto /system" &gt;&gt; /system/etc/init.d/01permissive echo "" &gt;&gt; /system/etc/init.d/01permissive echo "setenforce 0" &gt;&gt; /system/etc/init.d/01permissive echo "SELINUX=permissive" &gt;&gt; /system/etc/init.d/01permissive echo "" &gt;&gt; /system/etc/init.d/01permissive sleep 1 echo "Setting correct permissions and ownership for init.d folder and scipts..." chmod 777 /system/etc/init.d chmod 777 /system/etc/init.d/08setperm chmod 777 /system/etc/init.d/00test chmod 777 /system/etc/init.d/01permissive chown 0.0 /system/etc/init.d chown 0.0 /system/etc/init.d/08setperm chown 0.0 /system/etc/init.d/00test chown 0.0 /system/etc/init.d/01permissive sleep 1 echo "" echo "Mounting system as read-only..." mount -o remount,ro -t auto /system sleep 1 echo "" echo "Done!!!" sleep 1 echo "Please reboot at least twice before checking /data..." sleep 1 echo "If init.d is working, you will see a Test.log in /data..." sleep 1 echo "" echo "Enjoy!!! =)" echo "Ryuinferno @ XDA 2013" exit</span></span></code> </pre><br></div></div><br>  Come√ßando com o script!  No meu caso, ser√° chamado init.sh. <br>  1. Fa√ßa o download do arquivo para o sdcard do dispositivo m√≥vel: <br><pre> <code class="bash hljs">adb push /tmp/init.sh /sdcard</code> </pre> <br>  2. Copie para a mem√≥ria do dispositivo m√≥vel e defina os direitos necess√°rios: <br><pre> <code class="bash hljs">adb shell su cp /sdcard/init.sh /data/init.sh chmod 777 /data/init.sh</code> </pre> <br>  3. Execute para execu√ß√£o: <br><pre> <code class="bash hljs">/data/init.sh</code> </pre> <br>  E preste aten√ß√£o ao log que √© exibido.  Aqui est√° o meu log: <br><div class="spoiler">  <b class="spoiler_title">Executar log</b> <div class="spoiler_text"><pre> <code class="bash hljs">Init.d Enabler by Ryuinferno @ XDA Hello Supaa User! :P busybox found! Awesome! grep found! :D Good! run-parts found! :) Great! Let<span class="hljs-string"><span class="hljs-string">'s proceed... Press enter to continue... Mounting system as rewritable... Removing old sysinit file rm: /system/bin/sysinit: No such file or directory Checking for the presence of sysinit in /system/bin... sysinit not found, creating file... Setting correct permissions and ownership for sysinit... Checking for the presence of install-recovery.sh... install-recovery.sh not found, creating it... Setting the correct permissions and ownership for install-recovery.sh... Also for install-recovery-2.sh if it exists... Checking for the presence of the init.d folder... init.d folder found... Creating basic init.d scripts... Creating permissive SELinux script... Setting correct permissions and ownership for init.d folder and scipts... Mounting system as read-only... Done!!! Please reboot at least twice before checking /data... If init.d is working, you will see a Test.log in /data... Enjoy!!! =) Ryuinferno @ XDA 2013</span></span></code> </pre> <br></div></div><br>  Como voc√™ pode ver no log, n√£o h√° erros, portanto, fique √† vontade para reiniciar o dispositivo!  Talvez algu√©m j√° tenha trabalhado e voc√™ possa encontrar o arquivo <b>/data/Test.log</b> , mas eu n√£o o tenho.  Verifique o diret√≥rio <b>/system/etc/init.d</b> usando o <b>comando ls</b> : <br><br><pre> <code class="bash hljs">00test 01permissive 08setperm</code> </pre> <br>  Como voc√™ pode ver, as tarefas foram criadas com sucesso.  Talvez voc√™ ainda precise alterar o <b>arquivo boot.img</b> , mas vamos verificar no in√≠cio, onde est√° o arquivo <b>install-recovery.sh</b> com o comando <br><br><pre> <code class="bash hljs">find / -name <span class="hljs-string"><span class="hljs-string">"install-recovery.sh"</span></span> ... /system/bin/install-recovery.sh /system/etc/install-recovery.sh ...</code> </pre> <br>  Como podemos ver, temos 2 arquivos que est√£o em lugares diferentes.  At√© a data de cria√ß√£o, podemos notar que o script criou o arquivo no diret√≥rio <b>/system/etc/install-recovery.sh</b> , embora, talvez, em alguns casos, ele seja criado em <b>/ system / etc.</b>  Vamos renomear o arquivo para bin e copiar o arquivo de etc: <br><br><pre> <code class="bash hljs">mount -o remount,rw /system mv /install-recovery.sh /system/bin/install-recovery2.sh cp /install-recovery.sh /system/bin/</code> </pre> <br><br>  <b>UPD</b> : Observe que o contexto de seguran√ßa para os dois arquivos deve corresponder.  E se voc√™ se perder repentinamente durante a c√≥pia (embora em teoria isso n√£o deva ser), ser√° necess√°rio restaur√°-lo (por exemplo, atrav√©s do utilit√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chcon</a> ).  Veja as informa√ß√µes completas do arquivo com <b>ls -lZ</b> : <br><pre> <code class="bash hljs">ls -lZ /system/etc/install-recovery.sh <span class="hljs-comment"><span class="hljs-comment"># -rwxr-xr-x root root u:object_r:system_file:s0 install-recovery.sh</span></span></code> </pre><br>  Aqui <b>u: object_r: system_file: s0</b> s√£o contextos de seguran√ßa. <br><br>  E novamente reiniciamos o dispositivo ... E agora, finalmente, o t√£o esperado SUCESSO!  O arquivo <b>/data/Test.log</b> apareceu! <br><br>  Depois que tudo funcionar, v√° para <b>/system/etc/init.d</b> e crie um script de shell.  E nele, basta executar nossa tarefa para executar: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"#!/system/bin/sh crond -b -L /sdcard/error.log -c /data/crontab"</span></span> &gt; /system/etc/init.d/99cronstart chmod 777 /system/etc/init.d/99cronstart reboot</code> </pre> <br>  Ap√≥s o download, verifique se o crond foi iniciado: <br><br><pre> <code class="bash hljs">ps | grep crond root 414 1 9532 236 hrtimer_na 000dcf90 S crond</code> </pre> <br>  E poder√≠amos terminar agora, mas vamos esperar um minuto e ver se havia um registro em nosso arquivo ... Bem, como voc√™ j√° entendeu, novamente, nada funcionou.  O fato √© que esse processo precisa ser executado a partir de um super usu√°rio.  Altere o script no arquivo <b>99cronstart</b> : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"#!/system/bin/sh /su/bin/su -c crond -b -L /sdcard/error.log -c /data/crontab"</span></span> &gt; /system/etc/init.d/99cronstart reboot</code> </pre> <br><br>  <b>UPD</b> : Talvez no seu caso <b>su</b> tenha um caminho diferente, use o comando <b>su</b> e substitua o caminho pelo seu. <br><br>  Agora, o nosso dispositivo Android suporta tarefas cron e pode conter scripts de shell para inicializa√ß√£o autom√°tica! <br><br>  E, finalmente, o script que executar√° nosso aplicativo, se n√£o estiver nos processos e salve informa√ß√µes sobre o que estava na tela principal antes de iniciar nosso aplicativo: <br><br><pre> <code class="bash hljs">proc=$(ps | grep <span class="hljs-string"><span class="hljs-string">"com.test.app"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$proc</span></span></span><span class="hljs-string">"</span></span> == <span class="hljs-string"><span class="hljs-string">""</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> dumpsys window | grep CurrentFocus &gt; /sdcard/current_focus.dump sleep 1 am start -n com.test.app/com.test.app.activities.MainActivity <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt468337/">https://habr.com/ru/post/pt468337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt468323/index.html">Que ru√≠do ajuda a concentrar e relaxar e tamb√©m evita a perda auditiva em acidentes graves</a></li>
<li><a href="../pt468327/index.html">Gap - um futuro brilhante para recuo no Flexbox (como no Grid)</a></li>
<li><a href="../pt468329/index.html">Teste A / B n√£o √© suficiente</a></li>
<li><a href="../pt468331/index.html">Momentos da vida de Stephen Wolfram - criador do Mathematica, Wolfram | Alpha, um novo tipo de ci√™ncia e muito mais</a></li>
<li><a href="../pt468333/index.html">Como depurar e criar um perfil de qualquer arquivo exe usando o Visual Studio</a></li>
<li><a href="../pt468339/index.html">Apresentando o Tema Escuro para o Visual Studio App Center</a></li>
<li><a href="../pt468341/index.html">Shell de nuvem do Azure no terminal do Windows</a></li>
<li><a href="../pt468343/index.html">Jeff Bezos: "Indo para o espa√ßo para o bem da terra"</a></li>
<li><a href="../pt468345/index.html">GitHub lan√ßa seus tent√°culos no gerenciamento de CI / CD e artefatos</a></li>
<li><a href="../pt468347/index.html">MetricKit. An√°lise de desempenho de aplicativos iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>