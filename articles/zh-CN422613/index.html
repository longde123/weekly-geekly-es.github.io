<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧘🏻 👩🏽‍🍳 👋🏼 PowerPool网络组在高级本地过程调用中掌握了零日漏洞 📬 🔏 🙆🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="2018年8月27日，昵称为SandboxEscaper的信息安全专家在Twitter上发布了有关零日漏洞的信息。 该漏洞影响Microsoft Windows版本从7到10，更确切地说，会影响Windows Task Scheduler中的“高级本地过程调用（ALPC）”界面。 它提供了本地特权升...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PowerPool网络组在高级本地过程调用中掌握了零日漏洞</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/422613/"> 2018年8月27日，昵称为SandboxEscaper的信息安全专家在Twitter上发布了有关零日漏洞的信息。 该漏洞影响Microsoft Windows版本从7到10，更确切地说，会影响Windows Task Scheduler中的“高级本地过程调用（ALPC）”界面。 它提供了本地特权升级，这使攻击者可以将恶意代码的权限从用户级别提高到SYSTEM。 我们不是在以协调的方式披露该漏洞-很快删除了SandboxEscaper帐户，没有关闭的补丁程序。 <br><br> 该推文中的链接通向带有概念证明漏洞利用代码<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的GitHub存储库</a> -不仅是编译版本，还包括源代码。 因此，任何人都可以修改和重新编译漏洞利用程序，以进行改进，避免检测或将其纳入自己的代码中。 <br><br> 总的来说，不足为奇的是，仅仅两天后，该漏洞就在PowerPool网络组织的竞选活动中泛滥成灾。 根据ESET遥测，攻击者的目标国家是俄罗斯，乌克兰，波兰，德国，英国，美国，印度，菲律宾，智利。 伤亡人数相对较少，这可能表明目标明确。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mv/j9/jp/mvj9jpgpgqtisu48y3jazkb72ms.jpeg"></div><br><a name="habracut"></a><br><h3>  PowerPool工具包 </h3><br>  ESET相对较新地记录了一个新的小组，但是，PowerPool黑客可以使用的工具相当广泛。 接下来，我们简要地考虑其中的一些。 <br><br><h4>  ALPC中的本地特权升级漏洞 </h4> <br>  PowerPool开发人员没有使用SandboxEscaper发布的二进制文件-他们稍微修改了源代码并重新编译了它。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">安全研究人员</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CERT</a>团队也注意到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">了</a>这一漏洞。 <br><br><img src="https://habrastorage.org/webt/0q/a5/8a/0qa58aieslsijwatki-cc9wbvae.png"><br>  <i>图1.版权利用描述</i> <br><br> 违规发生在<code>SchRpcSetSecurity</code> API <code>SchRpcSetSecurity</code> ，该函数无法正确验证用户权限。 因此，用户可以将任何文件写入<code>C:\Windows\Task</code> ，而不考虑实际的权限-如果有读取权限，则可以替换写保护文件的内容。 <br><br> 任何用户都可以将文件写入<code>C:\Windows\Task</code> ，因此您可以在此文件夹中创建一个文件，该文件是指向任何<i>目标</i>文件的硬链接。 然后，通过调用<code>SchRpcSetSecurity</code>函数，可以访问对该目标文件的写访问。 为了提供本地特权提升，攻击者需要选择将被覆盖的目标文件-重要的是，该文件必须以管理员权限自动执行。 或者，它可以是系统文件或用于更新以前安装的软件的实用程序，该文件可以定期运行。 最后一步是用恶意代码替换目标文件的内容。 因此，在下一次自动执行中，无论原始权限如何，恶意软件都将具有管理员权限。 <br><br>  PowerPool开发人员决定更改文件<code>C:\Program Files (x86)\Google\Update\GoogleUpdate.exe</code> 。 这是Google应用程序的合法更新程序，它通过Microsoft Windows任务定期以管理员权限运行。 <br><br><img src="https://habrastorage.org/webt/qe/ef/as/qeefastmi_y_som113u2cmyutwa.png"><br>  <i>图2.创建到Google Updater的硬链接</i> <br><br><img src="https://habrastorage.org/webt/7d/th/ua/7dthua4tv-1sglb8uq6udcwb6na.png"><br>  <i>图3.使用SchRpcCreateFolder更改Google Updater可执行文件的权限</i> <br><br> 上图中的操作序列使PowerPool操作员可以获得<code>GoogleUpdate.exe</code>可执行文件的写入权限。 然后，他们将其覆盖，用第二阶段恶意软件的副本（我们将在下面描述）替换它们，以在下次调用更新程序时获得管理员权限。 <br><br><h3> 初步妥协 </h3><br>  PowerPool团队使用不同的方法来首先折衷受害者。 其中之一是附件中包含第一阶段恶意软件的垃圾邮件。 得出结论还为时过早，但是到目前为止，我们在遥测数据中只观察到很少的样本，因此我们假设收件人是经过精心选择的，我们并不是在讨论群发邮件。 <br><br> 另一方面，我们知道PowerPool在过去已经实施了垃圾邮件的发送。 根据2018年5月发布<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的SANS博客文章</a> ，他们使用了带有Symbolic Link文件（.slk）的方案来传播恶意软件。  Microsoft Excel可以加载这些文件，这些文件将更新单元并导致Excel执行PowerShell代码。 这些.slk文件似乎也以垃圾邮件的形式分发。 根据SANS帖子中提到的第一个文件（SHA-1：b2dc703d3af1d015f4d53b6dbbeb624f5ade5553），可以在VirusTotal上找到相应的垃圾邮件样本（SHA-1：e0882e234cba94b5cf3df2c05949e2e228beddb） <br><br><img src="https://habrastorage.org/webt/vb/go/yc/vbgoycqhjfhtfptqv-24ob43i-8.png"><br>  <i>图4. PowerPool垃圾邮件</i> <br><br><h3>  Windows后门 </h3><br>  PowerPool组通常使用两个后门：第一阶段的后门是在最初的妥协之后使用的，第二阶段的后门仅在感兴趣的机器上实现。 <br><br><h4> 第一阶段后门 </h4><br> 这是用于情报的基本恶意软件。 由两个Windows可执行文件组成。 <br><br> 其中第一个是主后门，它通过服务提供持久性。 它还会创建一个名为<code>MyDemonMutex%d</code>的互斥<code>MyDemonMutex%d</code> ，其中<code>%d</code>的范围是0到10。后门收集代理信息，C＆C服务器地址被硬编码在二进制文件中。 恶意软件可以在系统中执行命令并执行基本情报，从而将数据传输到C＆C服务器。 <br><br><img src="https://habrastorage.org/webt/ps/km/ca/pskmcackoqhfcx_19gge_ryfvoa.png"><br>  <i>图5.收集代理信息</i> <br><br> 第二个可执行文件具有一个目的。 他获取屏幕截图，并将其写入文件<code>MyScreen.jpg</code> ，然后可以由主后门将其过滤掉。 <br><br><h4> 第二阶段后门 </h4><br> 在第一阶段加载Malvar，大概是如果操作员觉得这台机器很有趣的话。 但是，该程序不像现代ART后门程序。 <br><br>  C＆C服务器地址以二进制格式硬编码，没有更新此重要配置项的机制。 后门从<code>http://[C&amp;C domain]/cmdpool</code>搜索命令，并从<code>http://[C&amp;C domain]/cmdpool</code>下载其他文件。 附加文件主要是用于水平移动的工具，如下所述。 <br><br> 支持的命令： <br>  -执行命令 <br>  -完成流程 <br>  -发送文件 <br>  -下载文件 <br>  -查看文件夹内容 <br><br> 命令以JSON格式发送。 以下示例是执行命令和列出文件夹的请求： <br><br><img src="https://habrastorage.org/webt/au/r1/nc/aur1ncfuer-g6aqayj0n7cjmkhy.png"><br>  <i>图6.后门命令示例</i> <br><br><h3> 水平移动工具 </h3><br> 通过使用第二阶段后门提供对系统的持续访问，PowerPool操作员可以使用几种主要用PowerShell编写的开源工具在网络上进行水平移动。 <br><br>  <a href="">-PowerDump</a> ：可以从安全帐户管理器检索用户名和哈希值的Metasploit模块。 <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-PowerSploit</a> ：PowerShell模块的集合，即Metasploit。 <br>  <a href="">-SMBExec</a> ：用于使用SMB协议执行哈希传递攻击的PowerShell工具。 <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">夸克PwDump</a> ：可以提取凭据的Windows可执行文件。 <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-FireMaster</a> ：Windows可执行文件，可以从Outlook，Web浏览器等提取已保存的密码。 <br><br><h3> 结论 </h3><br> 发布更新之前的漏洞披露使用户面临风险。 在这种情况下，甚至Windows的最新版本也可能受到威胁。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CERT-CC提供了</a>解决该问题<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a>方法，但是，Microsoft尚未正式同意。 <br><br>  PowerPool攻击针对的用户数量有限。 但是，该事件表明攻击者始终处于最新状态，并迅速实施新的攻击。 <br><br>  ESET专家将继续监视新漏洞的利用。 妥协指标也可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在GitHub上获得</a> 。 <br><br><h3> 折衷指标 </h3><br><h4> 散列 </h4><br> 第一阶段后门（Win32 / Agent.SZS）038f75dcf1e5277565c68d57fa1f4f7b3005f3f3 <br> 第一阶段后门（Win32 / Agent.TCH）247b542af23ad9c63697428c7b77348681aadc9a <br> 第二阶段后门（Win32 / Agent.TIA）0423672fe9201c325e33f296595fb70dcd81bcd9 <br> 第二阶段后门（Win32 / Agent.TIA）b4ec4837d07ff64e34947296e73732171d1c1586 <br>  LPPC漏洞利用ALPC（Win64 / Exploit.Agent.H）9dc173d4d4f74765b5fc1e1c9a2d188d5387beea <br><br><h4>  ESET检测 </h4><br>  -Win32 / Agent.SZS <br>  -Win32 / Agent.TCH <br>  -Win32 / Agent.TEL <br>  -Win32 / Agent.THT <br>  -Win32 / Agent.TDK <br>  -Win32 / Agent.TIA <br>  -Win32 / Agent.TID <br><br><h4>  C＆C服务器 </h4><br>  -新闻租借[。]网 <br>  -rosbusiness [。] Eu <br>  -afishaonline [。] Eu <br>  -体育收藏家[。] Com <br>  -27.102.106 [。] 149 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN422613/">https://habr.com/ru/post/zh-CN422613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN422601/index.html">Chrome 69随附随机密码生成器</a></li>
<li><a href="../zh-CN422603/index.html">更加接近完美</a></li>
<li><a href="../zh-CN422605/index.html">从小就开始种植保险箱-Rostelecom和MIPT的教育计划</a></li>
<li><a href="../zh-CN422609/index.html">语言障碍和NLP。 聊天机器人为什么不了解我们？</a></li>
<li><a href="../zh-CN422611/index.html">RxJava2中的标准错误处理程序，或者即使实现了onError，RxJava为何导致应用程序崩溃的原因</a></li>
<li><a href="../zh-CN422615/index.html">关于RTOS的全部真相。 第9条。 调度程序：实施</a></li>
<li><a href="../zh-CN422617/index.html">关于RTOS的全部真相。 第8条 Nucleus SE：内部设计和部署</a></li>
<li><a href="../zh-CN422623/index.html">如何保护C</a></li>
<li><a href="../zh-CN422625/index.html">我们与“神经巫师”的程序员Troy Miles进行了交谈</a></li>
<li><a href="../zh-CN422627/index.html">MongoDB和IT就业市场研究</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>