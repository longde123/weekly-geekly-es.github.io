<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👧‍👦 👹 👨🏼‍🎤 基于PKCS＃11令牌的加密工作站。 获得EGAIS的证书。 第4部分 🦊 🐵 🀄️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="现在，当我几乎将自签名证书的生成添加到基于PKCS＃11 cryptoarmpkcs令牌的加密工作站上并准备开始撰写本文时，我收到了这样的一封信： 我们是UZNIREK CA，我们很难以pkcs＃11格式发布EGAIS的ES，门户网站不了解Znamerek CSP格式的ES，我们请您提供帮助。  我...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>基于PKCS＃11令牌的加密工作站。 获得EGAIS的证书。 第4部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464017/"><img src="https://habrastorage.org/webt/wp/sl/w1/wpslw1m_c55qfxj1sifpmgmge20.png" align="left"> 现在，当我几乎将<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">自签名证书</a>的生成添加到基于PKCS＃11 cryptoarmpkcs令牌的加密工作站上并准备开始撰写本文时，我收到了这样的一封信： <blockquote>我们是UZNIREK CA，我们很难以pkcs＃11格式发布EGAIS的ES，门户网站不了解Znamerek CSP格式的ES，我们请您提供帮助。 </blockquote> 我不知道使用EGAIS的所有复杂性，但是由于它是PKCS＃11，因此我建议使用cryptoarmpkcs实用程序来<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">生成请求，</a>并在从CA收到令牌后为令牌安装证书。 我收到的答案有点让人分心： <a name="habracut"></a><br><blockquote>  las，事实是我们通过CryptoPro CSP在RuToken 2.0上记录了ES，但是在所有适当的设置下，EGIAS门户在关键介质上没有看到ES，客户联系了我们以寻求支持，但我们发现问题不在于此。密钥证书是用这种格式写的，这是手册<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">dev.rutoken.ru/display/KB/RU1051</a> </blockquote>  。 <br> 我（不仅是我）已经写了很多次使用俄语俄罗斯加密技术作为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">普通闪存驱动器的</a>加密令牌。 当密钥和证书没有作为PKCS＃11对象到达令牌时，就是这种情况。 可惜的是他们没有采纳建议，甚至没有尝试创建请求。 但是后来我决定搁置一切，弄清楚如何以及以何种方式签发EGAIS Rosalkogolregulirovanie证书。 而且，我们将仅考虑PKCS＃11加密令牌。 最大的失望是仅通过Windows和IE浏览器访问EGAIS。 另一方面，如果证书请求具有用于相应令牌的驱动程序/库，则也可以在任何OS下执行证书请求的生成和证书安装。 <br><br> 至少PKCS＃11令牌JaCarta，RutokenECP-2.0，LS11SW2016软件令牌，甚至<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云令牌</a>都在MS Windows，Linux和OS X上受支持。不仅限于这些OS。 <br><br> 实际上，我们必须向EGAIS的开发人员致敬。 他们提出了一种有趣的技术，该技术允许访问使用存储在加密令牌上的个人证书（证书加密钥对），并支持俄罗斯密码，并保护RSA证书上的通道。 虽然如果他们说A，那么一个人可以说B，即 使用GOST-ov算法保护频道。 唯一可悲的是，所有这些都仅针对MS Windows（或者我误会了？）或Internet Explorer量身定制。 用于生成EGAIS证书请求的实用程序与特定令牌绑定。 <br><br> 但是cryptoarmpkcs实用程序是多平台的。 而且，它能够与支持俄罗斯密码的任何PKCS＃11密码令牌一起使用。 <br><br> 那么，EGAIS证书请求的特殊性是什么？ 主要功能是必须在证书持有人（DN主题）的专有名称中强制存在一个附加字段unstucturedName（UN）（oid-1.2.840.113549.1.9.2）。 如果证书的所有者是个人企业家，则在此字段中写“ KPP =”行；如果证书的所有者是法人实体，则在此字段中写此行： <br>  PPC = reason_code_of_tax_account_account： <br><br><img src="https://habrastorage.org/webt/p5/ta/ik/p5taik-xzifzowoorpxbgrko-tu.png"><br><br> 在这方面，证书请求选项卡首页上的要求已添加了EGAIS按钮： <br><br><img src="https://habrastorage.org/webt/lu/3y/pe/lu3ypehfo1drl5bffwfzu7bkngc.png"><br><br> 另一个功能是EGAIS证书的持有者可以是FSRAP声明系统的被许可人（oid-1.2.643.3.6.78.4.4）。 创建请求时也需要考虑以下因素： <br><br><img src="https://habrastorage.org/webt/vs/zr/so/vszrso3twrpryl_cudxmggdw2ke.png"><br><br> 填写证书申请的所有字段并确认数据正确之后，将生成密钥对并创建请求： <br><br><img src="https://habrastorage.org/webt/rk/o3/to/rko3to_iuk4iaeq6aqjoxp-uf1o.png"><br><br> 如果查看该请求，则可以在其中看到oid-s（扩展密钥用法），这是EGAIS Rosalkogolregulirovanie所必需的： <br><br><img src="https://habrastorage.org/webt/g4/m-/mh/g4m-mh0xck7omdvymsuyalu_wfi.png"><br><br> 在这里，您应该注意（在上一个屏幕截图中）密钥对标签。 在PKCS＃11术语中，这是公用密钥和专用密钥的CKA_LABEL属性。 通过这样的方案，EGAIS查询生成器从CenterInform FSUE为JaCarta创建标签（键名）： <br><br><img src="https://habrastorage.org/webt/zv/bl/dg/zvbldgbgw9kmcphcz-nzq68pzqa.png"><br><br> 传统上，三重<b>证书x公钥x私钥</b> <b><br></b> 令牌上的令牌通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">属性CKA_ID</a>连接 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><br></a>  ： <br><blockquote> 指定CKA_ID的最常见方法是使用公钥值中的哈希函数值。 这是用于链接NSS（网络安全服务）项目中使用的三个对象的方法。 同时，SHA1算法用作哈希函数。 </blockquote> 不幸的是，CKA_LABEL和CKA_ID都可以在任何时候以任何值进行设置/更改。 因此，证书总是有可能与他人的私钥相关联。 无需解释其后果。 <br><br> 通常，是否有严格的数学算法可让您将三元组CKO_CERTIFICATE x CKO_PRIVATE_KEY x CKO_PUBLIC_KEY连接成一个整体？ <br> 是的，存在基于令牌的密码机制（CKM_）的算法。 <br><br> 不幸的是（尽管可以客观地理解），它考虑了通过上述方法形成的通过CKA_LABEL的三元组束。 此外，对于私钥和公钥，SKA_ID以类似的方式形成。 对于密钥，这只是一场灾难，因为 但是CKA_ID和CKA_LABEL都没有以任何方式绑定到密钥本身。 这也适用于证书安装在令牌上之后。 如果按照传统方式将CKA_ID作为来自公共密钥的哈希来构成，则您始终可以检查两者是否匹配，那么以上述方式设置CKA_ID和CKA_LABEL时，就无法做到这一点。 <br><br> 可能会出现问题，但是如何检查私钥的符合性？ 答案很简单-通过相对于私钥计算公钥的值。 至于证书，其公钥的值自然就在其中。 此外，证书本身包含证书持有者（证书主题密钥标识符）和证书发布者（证书颁发机构密钥标识符）的CKA_ID值： <br><br><img src="https://habrastorage.org/webt/og/vx/9e/ogvx9esfdvq1vlfcy436vkwvqkm.png"><br><br> 最不愉快的是，在安装证书时，不是检查私钥的存在，而仅公钥就足够了。 在这种情况下，将安装证书，但是上面没有私钥。 另一个问题。 这是TIN进行的公钥搜索。 想象一个人有一个TIN和几个用于各种证书的密钥。 属于哪一个？ 之后，很明显，JaCarta要求<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">只有一个证书</a>和一对密钥： <br><blockquote> 此错误可能与证书重复有关。 在管理员模式下的JaCarta Single Client中，在GOST选项卡上，输入PIN码后，应该可见一个公用密钥，一个专用密钥和证书。 在这种情况下，密钥重复是可见的。 您需要删除多余的。 将介质重新插入USB连接器，然后尝试再次安装UTM。 如果错误仍然存​​在，请根据链接1初始化Jacarta，然后再次执行生成过程。 </blockquote> 我们希望可以消除这一缺点。 您可能会询问EGAIS的cryptoarmpkcs实用程序如何安装证书。 为了与JaCarta完全兼容，我们保留了密钥的CKA_ID和CKA_LABEL相同的思想。 但是仅在将证书安装在令牌上并将其绑定在密钥对中之后。 在此之前，密钥对CKA_ID保持等于来自公共密钥的哈希值。 <br> 安装证书后，可以使用它来<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">签署文档</a> 。 <br><br> 您可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处</a>阅读有关自签名证书的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">信息</a> ： <br><br><img src="https://habrastorage.org/webt/df/ir/yw/dfirywymvzgoqq5u46qa4th6tcw.png" alt="图片"><br><br><div class="spoiler">  <b class="spoiler_title">分布在同一位置。</b> <div class="spoiler_text"><ul><li>  <a href="">Linux32</a> </li><li>  <a href="">Linux64</a> </li><li>  <a href="">OS X</a> </li><li>  <a href="">WIN32</a> </li><li>  <a href="">WIN64</a> </li></ul><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN464017/">https://habr.com/ru/post/zh-CN464017/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN464003/index.html">4G路由器作为物联网通用服务器</a></li>
<li><a href="../zh-CN464007/index.html">我如何建立呼叫中心的预测模型，以使他们的电话不会激怒用户</a></li>
<li><a href="../zh-CN464011/index.html">我如何将IT留给心理学</a></li>
<li><a href="../zh-CN464013/index.html">HeadHunter API常见问题解答（职位发布）</a></li>
<li><a href="../zh-CN464015/index.html">在Windows上安装OpenCV + CUDA</a></li>
<li><a href="../zh-CN464019/index.html">开源：图形卡开发人员透露了Linux驱动程序文档</a></li>
<li><a href="../zh-CN464021/index.html">什么是功能切换？如何摆脱繁琐的海象和寿命长的分支？</a></li>
<li><a href="../zh-CN464023/index.html">设置免费课程的“编程基础”，并提供JavaScript示例</a></li>
<li><a href="../zh-CN464027/index.html">信息爆炸时代如何生存内容</a></li>
<li><a href="../zh-CN464031/index.html">“有声人的发现”：声卡可让您跳入陌生城市的氛围</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>