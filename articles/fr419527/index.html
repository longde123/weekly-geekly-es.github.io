<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💋 🧑🏽‍🤝‍🧑🏻 👨‍👨‍👦‍👦 Comment le rythme cardiaque retentit: conversion du cardiogramme papier au format WAV ❄️ 👂🏻 🔐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nombreuses fois ont dû faire face à un examen cardiaque dans des institutions médicales à l'aide d'un cardiographe. Cette unité mesure l'activité b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment le rythme cardiaque retentit: conversion du cardiogramme papier au format WAV</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419527/"><img src="https://habrastorage.org/webt/vd/8i/cs/vd8icsdtkcxv6x3i-djvtgs6hrs.jpeg"><br>  De nombreuses fois ont dû faire face à un examen cardiaque dans des institutions médicales à l'aide d'un cardiographe.  Cette unité mesure l'activité bioélectrique du cœur, enregistrant le résultat sur une bande de papier.  Les cardiographes modernes enregistrent le résultat de la mesure non pas sur papier, mais dans la mémoire numérique.  Cependant, la bande de papier est souvent utilisée comme support final des informations enregistrées.  Visuellement, c'est un papier long millimètre de petite largeur, qui est tordu en rouleau.  Sur le papier, en plus de la grille millimétrique, un certain graphique est dessiné sur toute la longueur, ce qui reflète la loi de la valeur mesurée évoluant dans le temps.  La valeur mesurée, si je comprends bien, est la différence de potentiel entre les fils.  Le plus souvent, plusieurs graphiques sont présentés sur une bande à la fois, car les différences potentielles entre plusieurs pistes sont enregistrées.  Cependant, sans entrer dans les détails de la médecine, nous considérerons à l'avenir l'un des premiers calendriers principaux.  En plus des graphiques, il existe des informations textuelles supplémentaires sur la bande: échelle horizontale (mm / s), verticale (mm / mV), fréquence cardiaque mesurée (bpm) et plus encore. <br><br>  Il y avait une idée pour convertir ce graphique en un format sonore, reproduire le résultat et écouter comment ça sonne. <br><a name="habracut"></a><br>  Selon une analyse préliminaire, nous pouvons conclure que la composition en fréquence d'une telle onde n'est pas très saturée.  En fait, ce sont des basses fréquences, y compris les infrasons, qui sont censés être inaudibles.  Cependant, il sera possible de voir comment le cône du woofer répétera les vibrations similaires aux «vibrations» du cœur.  En effet, du fait de la présence de circuits de différenciation capacitifs sur le chemin de propagation du signal de la carte son PC vers l'amplificateur de basse, les vibrations de la tête dynamique ne reproduiront pas exactement les vibrations présentées sur le cardiogramme.  Et cela à condition que les filtres qui coupent les ultra-basses fréquences ne soient installés nulle part.  De plus, des distorsions non linéaires seront présentes, accompagnées de multiples harmoniques haute fréquence.  Néanmoins, sans tenir compte de l'analyse ci-dessus, nous posons le problème comme suit: convertir le graphique sur papier au format WAV afin que lorsque vous ouvrez ce fichier dans un éditeur de sons, la forme d'onde corresponde à la version papier et, de plus, correspond à l'échelle de temps. <br><br>  Vous devez d'abord estimer la profondeur de quantification (la résolution de l'audio numérique verticalement).  Je considère l'un des standards: 8 ou 16 bits.  La deuxième option (16 bits) est 65536 échantillons verticaux, ce qui correspondra à 65536 pixels de l'image, qui est un scan ou une photo d'un cardiogramme.  C'est beaucoup et cela n'a aucun sens.  Si vous prenez 8 bits - cela représente 256 échantillons, ou 256 pixels de l'image.  Maintenant, c'est une option plus appropriée.  Dans ce cas, la plage dynamique de l'audio sera de 6 * 8 = 48 dB.  Je ne sais pas quelle est la plage dynamique du cardiogramme, mais je ne pense plus.  L'appareil lui-même est naturellement plus grand, mais une erreur est inévitable lors de l'affichage d'un cardiogramme sur papier, en particulier lorsqu'il s'agit de dessiner directement avec un stylo.  Par ailleurs, à propos de ce dernier.  Je ne prendrai pas en compte les anciens motifs dessinés avec un stylo "radial".  Le ruban de papier millimétrique pour ces cardiogrammes est spécifique: des arcs verticaux au lieu de lignes droites sont dessinés.  Quant à l'échelle horizontale - la fréquence d'échantillonnage - sera calculée en fonction de l'échelle du cardiogramme et de la taille de l'image.  La vitesse de lecture dépendra de ce paramètre, et elle devrait correspondre à la «vitesse du cardiogramme» réelle. <br><br>  Le papier cardiogramme doit être numérisé en noir et blanc avec des nuances de gris avec une résolution suffisante.  Ensuite, vous devez redimensionner l'image afin que le cardiogramme souhaité s'insère dans une bande de 256 pixels de large.  J'ai trouvé de nombreuses images avec des cardiogrammes sur Internet.  Par exemple, considérons deux d'entre eux. <br><br><img src="https://habrastorage.org/webt/6a/ao/ve/6aaoveakfnrluqr-m-hybxevcly.jpeg"><br><br>  On pourrait dire que la première image est presque prête.  Hauteur d'image - 431. Largeur - 1023. Une onde sur toute la largeur remplit complètement l'image entière.  Mais vous devez laisser 256 de hauteur, recadrer l'image au-dessus et en dessous pour que l'onde soit située approximativement au centre. <br><br><img src="https://habrastorage.org/webt/1y/pl/9b/1ypl9b8u33wmyo2xa6cdkhbx9n0.png"><br><br>  La deuxième figure montre plusieurs cardiogrammes à la fois.  Prenez le tout premier.  Après le recadrage, nous avons obtenu une image mesurant 508 par 61. <br><br><img src="https://habrastorage.org/webt/od/sr/nc/odsrncybq1ghgyy1tmf-x7rxmh4.png"><br><br>  Sans étirer l'image verticalement, nous ferons une image d'une hauteur de 256, remplissant la zone créée de vide blanc.  L'onde doit également être située approximativement au centre.  Lors de la découpe, j'ai sélectionné la largeur 508 de manière à laisser autant de cellules millimétriques entières que possible, qui sont également visibles sur l'image. <br><br>  Les deux images doivent être converties en une vue dans laquelle seul un graphique noir sera visible sur fond blanc et rien d'autre.  Cela se fait de manière élémentaire.  Étant donné que le graphique est dessiné beaucoup plus gros que la grille millimétrique, dans l'éditeur graphique en utilisant les réglages "luminosité, contraste, saturation", vous pouvez obtenir le résultat souhaité.  Si la conversion parfaite échoue, l'excédent de «déchets» au-dessus du graphique doit être effacé avec l'outil Gomme.  Toutes les images doivent être enregistrées au format BMP monochrome.  Ainsi, seules les couleurs blanches et noires resteront définitivement dans l'image. <br><br>  Avant de commencer à décrire l'algorithme de conversion d'images en WAV, il convient de spécifier certaines des nuances qui simplifient la programmation.  Les images résultantes doivent être pivotées de 90 degrés dans le sens antihoraire (la largeur et la hauteur de l'image changeront de place).  Ceci est nécessaire pour orienter le début du cardiogramme avec le début du fichier BMP.  Il est connu que les données de couleur de chaque pixel d'un fichier BMP sont écrites ligne par ligne dans le fichier, en partant du coin inférieur gauche.  Ensuite, vous devez ouvrir les images dans l'éditeur "MS Paint" (j'ai Windows XP) et enregistrer en BMP 8 bits (256 couleurs).  Bien sûr, il y aura une "redéfinition des informations", mais avec ce format, chaque pixel de l'image correspond à un octet, ce qui est très pratique lors de la programmation.  L'octet «0» est un pixel noir et l'octet «255» est blanc.  Le résultat devrait ressembler à ce qui suit (ici, deux images sont connectées et coupées en deux). <br><br><img src="https://habrastorage.org/webt/vr/cc/nh/vrccnhi1qkyegtfpanecxls5c40.jpeg"><br><br>  Quant au format de sortie, nous le sortirons non pas dans un fichier WAV standard, mais dans un fichier de données RAW (PCM).  Il simplifie également la programmation, car lors de la sortie vers WAV, vous devez toujours prendre soin de l'en-tête de 44 octets.  Dans l'éditeur audio commun Adobe Audition 1.5, le fichier PCM s'ouvre sans problème.  De plus, vous pouvez même sortir des nombres décimaux de données PCM dans une colonne d'un fichier texte, après avoir préalablement formé un en-tête de texte spécifique.  Curieusement, mais ces fichiers Adobe Audition s'ouvre également. <br><br>  Nous décrivons l'algorithme de transformation.  Et l'algorithme est très simple: vous devez analyser chaque ligne du fichier BMP de bas en haut.  L'analyse consistera à compter les pixels blancs de gauche à droite dans une rangée jusqu'à ce que du noir soit rencontré.  Les valeurs entières non négatives obtenues doivent être écrites dans le fichier PCM de sortie sous forme binaire.  La taille du fichier de sortie correspondra exactement à la hauteur de l'image traitée.  La profondeur de quantification de 8 bits du format de données audio PCM implique le codage des échantillons selon le même principe.  La valeur «0» est la valeur négative maximale de l'échantillon audio, la valeur «255» est la valeur positive maximale et «128» est la valeur zéro (au milieu).  Par exemple, un fichier PCM de données audio de silence contiendra les mêmes octets avec une valeur de "128".  Il convient de mentionner qu'une ligne peut contenir plusieurs pixels noirs consécutifs, en fonction de l'épaisseur de la ligne du cardiogramme.  Mais l'algorithme décrit «attrape» l'enveloppe supérieure, ce qui sera suffisant.  De plus, les pics nets du cardiogramme dirigés vers le haut seront ainsi mieux compris. <br><br>  Vous pouvez maintenant commencer à écrire le texte du programme.  Le programme écrit en C est très simple et ne nécessite pas de commentaires détaillés. <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; // ,  ; int main(){ //  ; FILE *in,*out; //   ; unsigned long int h,i; //    ; unsigned char px,s; //     ; in=fopen("1.bmp","rb"); //   ; out=fopen("1.pcm","wb"); //   ; fseek(in,22,SEEK_SET); //    ,     fread(&amp;h,4,1,in); //   (4 ); for(i=0;i&lt;h;i++){ // -   ; fseek(in,0x436+i*256,SEEK_SET); //   i-  s=0; //  ( ); do{ //  ; fread(&amp;px,1,1,in); //  ; s+=1; //   ; }while(px); // ,     ; fwrite(&amp;s,1,1,out); //     ; } fclose(in); //  ; fclose(out); //  ; return 0; //  ; }</span></span></span></span></code> </pre> <br><br>  Une fois le programme exécuté sur le fichier «1.bmp», le fichier «1.pcm» sera créé dans le même répertoire que le programme.  Lorsque vous essayez d'ouvrir un fichier dans Adobe Audition, la fenêtre suivante devrait apparaître. <br><br><img src="https://habrastorage.org/webt/sw/lj/pg/swljpg5dphpocfdbnvsartz0k-8.png"><br><br>  Vous devez sélectionner "Mono", "8 bits" et imprimer la fréquence d'échantillonnage dans le champ de saisie en fonction du calcul: f = h / (s / v), où h est la hauteur de l'image (c'est aussi le nombre d'échantillons dans l'audio), s - la longueur du cardiogramme en millimètres, v est l'échelle du cardiogramme en mm / s.  Le dernier paramètre est inscrit sur le cardiogramme.  Sur le premier cardiogramme, rien n'est écrit, mais l'échelle est généralement de 25 mm / sec.  Le calcul des taux d'échantillonnage dans Excel pour nos exemples est illustré dans la figure ci-dessous. <br><br><img src="https://habrastorage.org/webt/tl/vw/jp/tlvwjpkgjgxsh2z5bwrgkmzjuy8.png"><br><br>  Comme mentionné ci-dessus, nous entrons les valeurs nécessaires des fréquences d'échantillonnage pour chacun des exemples dans le champ correspondant.  Vous pouvez même entrer des décimales, de toute façon, il y aura un arrondi automatique à l'entier le plus proche. <br><br><img src="https://habrastorage.org/webt/ha/tr/jt/hatrjtjokkoinjcox4ed9ushjiw.png"><br><br>  En cliquant sur «OK», nous convenons que nous travaillons avec des échantillons «non signés 8 bits» (il y aura une autre fenêtre), après quoi la forme d'onde de notre fichier se développera dans le champ principal de l'éditeur de sons.  Notez que cette vue sera présentée «à l'envers», et pour une parfaite conformité avec la version papier, vous devez inverser la vague dans le menu correspondant.  En conséquence, cela ressemblera à ceci. <br><br><img src="https://habrastorage.org/webt/ru/pf/zj/rupfzjhna9czkxh3xifzjuzhubu.png"><br><br>  Le deuxième cardiogramme semble "plus silencieux", car il n'était pas très gros à l'origine. <br><br><img src="https://habrastorage.org/webt/-u/fl/vz/-uflvzhf_iswthnmhrwsdd3xvl4.png"><br><br>  Malheureusement, toutes les cartes son ne vous permettent pas de lire l'audio à une fréquence d'échantillonnage arbitraire, plus précisément, la grande majorité ne sait pas comment.  Pour lire correctement le fichier, vous devez exécuter la fonction "Convertir le type d'échantillon".  Nous allons convertir à la valeur standard la plus proche de 8000 Hz, en même temps augmenter la résolution en amplitude à 16 bits.  Cette dernière est nécessaire pour la précision au stade de l'interpolation lors du suréchantillonnage.  Si vous laissez 8 bits, la région restante du spectre sera remplie de bruit de quantification.  Soit dit en passant, cette procédure pourrait être effectuée par programme à l'étape de conversion BMP-PCM, même en utilisant l'interpolation.  Mais l'un des objectifs était la simplicité du code du programme. <br><br>  Après l'opération de suréchantillonnage, vous pouvez écouter et apprécier le résultat.  Vous pouvez enregistrer le résultat dans un fichier wav ou mp3 standard.  Cela ressemble exactement à ce que j'attendais à l'origine. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ce</a> lien vous permet de télécharger l'archive rar, qui contient deux fichiers WAV avec le résultat. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419527/">https://habr.com/ru/post/fr419527/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419513/index.html">Configurer la politique de sécurité des mots de passe dans Zimbra</a></li>
<li><a href="../fr419515/index.html">Comment une startup «sans marque» a obtenu 240 millions de dollars pour vaincre Amazon</a></li>
<li><a href="../fr419519/index.html">Conseils pour les jeux mobiles: Partie 1, lancement en douceur</a></li>
<li><a href="../fr419523/index.html">L'équipe PVS-Studio est impartiale lors de la rédaction d'articles</a></li>
<li><a href="../fr419525/index.html">De l'API d'abord sur Swagger au contrat unique sur RAML</a></li>
<li><a href="../fr419531/index.html">Choisir la paire parfaite pour vos oreilles: dix conseils pratiques</a></li>
<li><a href="../fr419535/index.html">Mise à jour sur le grille-pain</a></li>
<li><a href="../fr419537/index.html">CyberDemons: Intelligence artificielle DOOM 2016</a></li>
<li><a href="../fr419539/index.html">Webinaire ouvert "Programmation asynchrone en Python"</a></li>
<li><a href="../fr419547/index.html">Organiser un résumé de journal régulier avec python et ansible en utilisant un astérisque comme exemple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>