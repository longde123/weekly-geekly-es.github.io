<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’‹ ğŸ§‘ğŸ½â€ğŸ¤â€ğŸ§‘ğŸ» ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦ Comment le rythme cardiaque retentit: conversion du cardiogramme papier au format WAV â„ï¸ ğŸ‘‚ğŸ» ğŸ”</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nombreuses fois ont dÃ» faire face Ã  un examen cardiaque dans des institutions mÃ©dicales Ã  l'aide d'un cardiographe. Cette unitÃ© mesure l'activitÃ© b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment le rythme cardiaque retentit: conversion du cardiogramme papier au format WAV</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419527/"><img src="https://habrastorage.org/webt/vd/8i/cs/vd8icsdtkcxv6x3i-djvtgs6hrs.jpeg"><br>  De nombreuses fois ont dÃ» faire face Ã  un examen cardiaque dans des institutions mÃ©dicales Ã  l'aide d'un cardiographe.  Cette unitÃ© mesure l'activitÃ© bioÃ©lectrique du cÅ“ur, enregistrant le rÃ©sultat sur une bande de papier.  Les cardiographes modernes enregistrent le rÃ©sultat de la mesure non pas sur papier, mais dans la mÃ©moire numÃ©rique.  Cependant, la bande de papier est souvent utilisÃ©e comme support final des informations enregistrÃ©es.  Visuellement, c'est un papier long millimÃ¨tre de petite largeur, qui est tordu en rouleau.  Sur le papier, en plus de la grille millimÃ©trique, un certain graphique est dessinÃ© sur toute la longueur, ce qui reflÃ¨te la loi de la valeur mesurÃ©e Ã©voluant dans le temps.  La valeur mesurÃ©e, si je comprends bien, est la diffÃ©rence de potentiel entre les fils.  Le plus souvent, plusieurs graphiques sont prÃ©sentÃ©s sur une bande Ã  la fois, car les diffÃ©rences potentielles entre plusieurs pistes sont enregistrÃ©es.  Cependant, sans entrer dans les dÃ©tails de la mÃ©decine, nous considÃ©rerons Ã  l'avenir l'un des premiers calendriers principaux.  En plus des graphiques, il existe des informations textuelles supplÃ©mentaires sur la bande: Ã©chelle horizontale (mm / s), verticale (mm / mV), frÃ©quence cardiaque mesurÃ©e (bpm) et plus encore. <br><br>  Il y avait une idÃ©e pour convertir ce graphique en un format sonore, reproduire le rÃ©sultat et Ã©couter comment Ã§a sonne. <br><a name="habracut"></a><br>  Selon une analyse prÃ©liminaire, nous pouvons conclure que la composition en frÃ©quence d'une telle onde n'est pas trÃ¨s saturÃ©e.  En fait, ce sont des basses frÃ©quences, y compris les infrasons, qui sont censÃ©s Ãªtre inaudibles.  Cependant, il sera possible de voir comment le cÃ´ne du woofer rÃ©pÃ©tera les vibrations similaires aux Â«vibrationsÂ» du cÅ“ur.  En effet, du fait de la prÃ©sence de circuits de diffÃ©renciation capacitifs sur le chemin de propagation du signal de la carte son PC vers l'amplificateur de basse, les vibrations de la tÃªte dynamique ne reproduiront pas exactement les vibrations prÃ©sentÃ©es sur le cardiogramme.  Et cela Ã  condition que les filtres qui coupent les ultra-basses frÃ©quences ne soient installÃ©s nulle part.  De plus, des distorsions non linÃ©aires seront prÃ©sentes, accompagnÃ©es de multiples harmoniques haute frÃ©quence.  NÃ©anmoins, sans tenir compte de l'analyse ci-dessus, nous posons le problÃ¨me comme suit: convertir le graphique sur papier au format WAV afin que lorsque vous ouvrez ce fichier dans un Ã©diteur de sons, la forme d'onde corresponde Ã  la version papier et, de plus, correspond Ã  l'Ã©chelle de temps. <br><br>  Vous devez d'abord estimer la profondeur de quantification (la rÃ©solution de l'audio numÃ©rique verticalement).  Je considÃ¨re l'un des standards: 8 ou 16 bits.  La deuxiÃ¨me option (16 bits) est 65536 Ã©chantillons verticaux, ce qui correspondra Ã  65536 pixels de l'image, qui est un scan ou une photo d'un cardiogramme.  C'est beaucoup et cela n'a aucun sens.  Si vous prenez 8 bits - cela reprÃ©sente 256 Ã©chantillons, ou 256 pixels de l'image.  Maintenant, c'est une option plus appropriÃ©e.  Dans ce cas, la plage dynamique de l'audio sera de 6 * 8 = 48 dB.  Je ne sais pas quelle est la plage dynamique du cardiogramme, mais je ne pense plus.  L'appareil lui-mÃªme est naturellement plus grand, mais une erreur est inÃ©vitable lors de l'affichage d'un cardiogramme sur papier, en particulier lorsqu'il s'agit de dessiner directement avec un stylo.  Par ailleurs, Ã  propos de ce dernier.  Je ne prendrai pas en compte les anciens motifs dessinÃ©s avec un stylo "radial".  Le ruban de papier millimÃ©trique pour ces cardiogrammes est spÃ©cifique: des arcs verticaux au lieu de lignes droites sont dessinÃ©s.  Quant Ã  l'Ã©chelle horizontale - la frÃ©quence d'Ã©chantillonnage - sera calculÃ©e en fonction de l'Ã©chelle du cardiogramme et de la taille de l'image.  La vitesse de lecture dÃ©pendra de ce paramÃ¨tre, et elle devrait correspondre Ã  la Â«vitesse du cardiogrammeÂ» rÃ©elle. <br><br>  Le papier cardiogramme doit Ãªtre numÃ©risÃ© en noir et blanc avec des nuances de gris avec une rÃ©solution suffisante.  Ensuite, vous devez redimensionner l'image afin que le cardiogramme souhaitÃ© s'insÃ¨re dans une bande de 256 pixels de large.  J'ai trouvÃ© de nombreuses images avec des cardiogrammes sur Internet.  Par exemple, considÃ©rons deux d'entre eux. <br><br><img src="https://habrastorage.org/webt/6a/ao/ve/6aaoveakfnrluqr-m-hybxevcly.jpeg"><br><br>  On pourrait dire que la premiÃ¨re image est presque prÃªte.  Hauteur d'image - 431. Largeur - 1023. Une onde sur toute la largeur remplit complÃ¨tement l'image entiÃ¨re.  Mais vous devez laisser 256 de hauteur, recadrer l'image au-dessus et en dessous pour que l'onde soit situÃ©e approximativement au centre. <br><br><img src="https://habrastorage.org/webt/1y/pl/9b/1ypl9b8u33wmyo2xa6cdkhbx9n0.png"><br><br>  La deuxiÃ¨me figure montre plusieurs cardiogrammes Ã  la fois.  Prenez le tout premier.  AprÃ¨s le recadrage, nous avons obtenu une image mesurant 508 par 61. <br><br><img src="https://habrastorage.org/webt/od/sr/nc/odsrncybq1ghgyy1tmf-x7rxmh4.png"><br><br>  Sans Ã©tirer l'image verticalement, nous ferons une image d'une hauteur de 256, remplissant la zone crÃ©Ã©e de vide blanc.  L'onde doit Ã©galement Ãªtre situÃ©e approximativement au centre.  Lors de la dÃ©coupe, j'ai sÃ©lectionnÃ© la largeur 508 de maniÃ¨re Ã  laisser autant de cellules millimÃ©triques entiÃ¨res que possible, qui sont Ã©galement visibles sur l'image. <br><br>  Les deux images doivent Ãªtre converties en une vue dans laquelle seul un graphique noir sera visible sur fond blanc et rien d'autre.  Cela se fait de maniÃ¨re Ã©lÃ©mentaire.  Ã‰tant donnÃ© que le graphique est dessinÃ© beaucoup plus gros que la grille millimÃ©trique, dans l'Ã©diteur graphique en utilisant les rÃ©glages "luminositÃ©, contraste, saturation", vous pouvez obtenir le rÃ©sultat souhaitÃ©.  Si la conversion parfaite Ã©choue, l'excÃ©dent de Â«dÃ©chetsÂ» au-dessus du graphique doit Ãªtre effacÃ© avec l'outil Gomme.  Toutes les images doivent Ãªtre enregistrÃ©es au format BMP monochrome.  Ainsi, seules les couleurs blanches et noires resteront dÃ©finitivement dans l'image. <br><br>  Avant de commencer Ã  dÃ©crire l'algorithme de conversion d'images en WAV, il convient de spÃ©cifier certaines des nuances qui simplifient la programmation.  Les images rÃ©sultantes doivent Ãªtre pivotÃ©es de 90 degrÃ©s dans le sens antihoraire (la largeur et la hauteur de l'image changeront de place).  Ceci est nÃ©cessaire pour orienter le dÃ©but du cardiogramme avec le dÃ©but du fichier BMP.  Il est connu que les donnÃ©es de couleur de chaque pixel d'un fichier BMP sont Ã©crites ligne par ligne dans le fichier, en partant du coin infÃ©rieur gauche.  Ensuite, vous devez ouvrir les images dans l'Ã©diteur "MS Paint" (j'ai Windows XP) et enregistrer en BMP 8 bits (256 couleurs).  Bien sÃ»r, il y aura une "redÃ©finition des informations", mais avec ce format, chaque pixel de l'image correspond Ã  un octet, ce qui est trÃ¨s pratique lors de la programmation.  L'octet Â«0Â» est un pixel noir et l'octet Â«255Â» est blanc.  Le rÃ©sultat devrait ressembler Ã  ce qui suit (ici, deux images sont connectÃ©es et coupÃ©es en deux). <br><br><img src="https://habrastorage.org/webt/vr/cc/nh/vrccnhi1qkyegtfpanecxls5c40.jpeg"><br><br>  Quant au format de sortie, nous le sortirons non pas dans un fichier WAV standard, mais dans un fichier de donnÃ©es RAW (PCM).  Il simplifie Ã©galement la programmation, car lors de la sortie vers WAV, vous devez toujours prendre soin de l'en-tÃªte de 44 octets.  Dans l'Ã©diteur audio commun Adobe Audition 1.5, le fichier PCM s'ouvre sans problÃ¨me.  De plus, vous pouvez mÃªme sortir des nombres dÃ©cimaux de donnÃ©es PCM dans une colonne d'un fichier texte, aprÃ¨s avoir prÃ©alablement formÃ© un en-tÃªte de texte spÃ©cifique.  Curieusement, mais ces fichiers Adobe Audition s'ouvre Ã©galement. <br><br>  Nous dÃ©crivons l'algorithme de transformation.  Et l'algorithme est trÃ¨s simple: vous devez analyser chaque ligne du fichier BMP de bas en haut.  L'analyse consistera Ã  compter les pixels blancs de gauche Ã  droite dans une rangÃ©e jusqu'Ã  ce que du noir soit rencontrÃ©.  Les valeurs entiÃ¨res non nÃ©gatives obtenues doivent Ãªtre Ã©crites dans le fichier PCM de sortie sous forme binaire.  La taille du fichier de sortie correspondra exactement Ã  la hauteur de l'image traitÃ©e.  La profondeur de quantification de 8 bits du format de donnÃ©es audio PCM implique le codage des Ã©chantillons selon le mÃªme principe.  La valeur Â«0Â» est la valeur nÃ©gative maximale de l'Ã©chantillon audio, la valeur Â«255Â» est la valeur positive maximale et Â«128Â» est la valeur zÃ©ro (au milieu).  Par exemple, un fichier PCM de donnÃ©es audio de silence contiendra les mÃªmes octets avec une valeur de "128".  Il convient de mentionner qu'une ligne peut contenir plusieurs pixels noirs consÃ©cutifs, en fonction de l'Ã©paisseur de la ligne du cardiogramme.  Mais l'algorithme dÃ©crit Â«attrapeÂ» l'enveloppe supÃ©rieure, ce qui sera suffisant.  De plus, les pics nets du cardiogramme dirigÃ©s vers le haut seront ainsi mieux compris. <br><br>  Vous pouvez maintenant commencer Ã  Ã©crire le texte du programme.  Le programme Ã©crit en C est trÃ¨s simple et ne nÃ©cessite pas de commentaires dÃ©taillÃ©s. <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; // ,  ; int main(){ //  ; FILE *in,*out; //   ; unsigned long int h,i; //    ; unsigned char px,s; //     ; in=fopen("1.bmp","rb"); //   ; out=fopen("1.pcm","wb"); //   ; fseek(in,22,SEEK_SET); //    ,     fread(&amp;h,4,1,in); //   (4 ); for(i=0;i&lt;h;i++){ // -   ; fseek(in,0x436+i*256,SEEK_SET); //   i-  s=0; //  ( ); do{ //  ; fread(&amp;px,1,1,in); //  ; s+=1; //   ; }while(px); // ,     ; fwrite(&amp;s,1,1,out); //     ; } fclose(in); //  ; fclose(out); //  ; return 0; //  ; }</span></span></span></span></code> </pre> <br><br>  Une fois le programme exÃ©cutÃ© sur le fichier Â«1.bmpÂ», le fichier Â«1.pcmÂ» sera crÃ©Ã© dans le mÃªme rÃ©pertoire que le programme.  Lorsque vous essayez d'ouvrir un fichier dans Adobe Audition, la fenÃªtre suivante devrait apparaÃ®tre. <br><br><img src="https://habrastorage.org/webt/sw/lj/pg/swljpg5dphpocfdbnvsartz0k-8.png"><br><br>  Vous devez sÃ©lectionner "Mono", "8 bits" et imprimer la frÃ©quence d'Ã©chantillonnage dans le champ de saisie en fonction du calcul: f = h / (s / v), oÃ¹ h est la hauteur de l'image (c'est aussi le nombre d'Ã©chantillons dans l'audio), s - la longueur du cardiogramme en millimÃ¨tres, v est l'Ã©chelle du cardiogramme en mm / s.  Le dernier paramÃ¨tre est inscrit sur le cardiogramme.  Sur le premier cardiogramme, rien n'est Ã©crit, mais l'Ã©chelle est gÃ©nÃ©ralement de 25 mm / sec.  Le calcul des taux d'Ã©chantillonnage dans Excel pour nos exemples est illustrÃ© dans la figure ci-dessous. <br><br><img src="https://habrastorage.org/webt/tl/vw/jp/tlvwjpkgjgxsh2z5bwrgkmzjuy8.png"><br><br>  Comme mentionnÃ© ci-dessus, nous entrons les valeurs nÃ©cessaires des frÃ©quences d'Ã©chantillonnage pour chacun des exemples dans le champ correspondant.  Vous pouvez mÃªme entrer des dÃ©cimales, de toute faÃ§on, il y aura un arrondi automatique Ã  l'entier le plus proche. <br><br><img src="https://habrastorage.org/webt/ha/tr/jt/hatrjtjokkoinjcox4ed9ushjiw.png"><br><br>  En cliquant sur Â«OKÂ», nous convenons que nous travaillons avec des Ã©chantillons Â«non signÃ©s 8 bitsÂ» (il y aura une autre fenÃªtre), aprÃ¨s quoi la forme d'onde de notre fichier se dÃ©veloppera dans le champ principal de l'Ã©diteur de sons.  Notez que cette vue sera prÃ©sentÃ©e Â«Ã  l'enversÂ», et pour une parfaite conformitÃ© avec la version papier, vous devez inverser la vague dans le menu correspondant.  En consÃ©quence, cela ressemblera Ã  ceci. <br><br><img src="https://habrastorage.org/webt/ru/pf/zj/rupfzjhna9czkxh3xifzjuzhubu.png"><br><br>  Le deuxiÃ¨me cardiogramme semble "plus silencieux", car il n'Ã©tait pas trÃ¨s gros Ã  l'origine. <br><br><img src="https://habrastorage.org/webt/-u/fl/vz/-uflvzhf_iswthnmhrwsdd3xvl4.png"><br><br>  Malheureusement, toutes les cartes son ne vous permettent pas de lire l'audio Ã  une frÃ©quence d'Ã©chantillonnage arbitraire, plus prÃ©cisÃ©ment, la grande majoritÃ© ne sait pas comment.  Pour lire correctement le fichier, vous devez exÃ©cuter la fonction "Convertir le type d'Ã©chantillon".  Nous allons convertir Ã  la valeur standard la plus proche de 8000 Hz, en mÃªme temps augmenter la rÃ©solution en amplitude Ã  16 bits.  Cette derniÃ¨re est nÃ©cessaire pour la prÃ©cision au stade de l'interpolation lors du surÃ©chantillonnage.  Si vous laissez 8 bits, la rÃ©gion restante du spectre sera remplie de bruit de quantification.  Soit dit en passant, cette procÃ©dure pourrait Ãªtre effectuÃ©e par programme Ã  l'Ã©tape de conversion BMP-PCM, mÃªme en utilisant l'interpolation.  Mais l'un des objectifs Ã©tait la simplicitÃ© du code du programme. <br><br>  AprÃ¨s l'opÃ©ration de surÃ©chantillonnage, vous pouvez Ã©couter et apprÃ©cier le rÃ©sultat.  Vous pouvez enregistrer le rÃ©sultat dans un fichier wav ou mp3 standard.  Cela ressemble exactement Ã  ce que j'attendais Ã  l'origine. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ce</a> lien vous permet de tÃ©lÃ©charger l'archive rar, qui contient deux fichiers WAV avec le rÃ©sultat. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419527/">https://habr.com/ru/post/fr419527/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419513/index.html">Configurer la politique de sÃ©curitÃ© des mots de passe dans Zimbra</a></li>
<li><a href="../fr419515/index.html">Comment une startup Â«sans marqueÂ» a obtenu 240 millions de dollars pour vaincre Amazon</a></li>
<li><a href="../fr419519/index.html">Conseils pour les jeux mobiles: Partie 1, lancement en douceur</a></li>
<li><a href="../fr419523/index.html">L'Ã©quipe PVS-Studio est impartiale lors de la rÃ©daction d'articles</a></li>
<li><a href="../fr419525/index.html">De l'API d'abord sur Swagger au contrat unique sur RAML</a></li>
<li><a href="../fr419531/index.html">Choisir la paire parfaite pour vos oreilles: dix conseils pratiques</a></li>
<li><a href="../fr419535/index.html">Mise Ã  jour sur le grille-pain</a></li>
<li><a href="../fr419537/index.html">CyberDemons: Intelligence artificielle DOOM 2016</a></li>
<li><a href="../fr419539/index.html">Webinaire ouvert "Programmation asynchrone en Python"</a></li>
<li><a href="../fr419547/index.html">Organiser un rÃ©sumÃ© de journal rÃ©gulier avec python et ansible en utilisant un astÃ©risque comme exemple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>