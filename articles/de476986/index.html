<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≥ üéä üÜó Multiplexen der Datenausgabe an eine Anzeige mit parallelem Anschluss üò∏ üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø üë¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Multiplexing-Datenbus-Anzeige mit parallelem Ausgang und seriellem Port Arduino. 

 Der Artikel beschreibt die Methode zum Multiplexen der Verwendung ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Multiplexen der Datenausgabe an eine Anzeige mit parallelem Anschluss</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476986/"> Multiplexing-Datenbus-Anzeige mit parallelem Ausgang und seriellem Port Arduino. <br><br>  Der Artikel beschreibt die Methode zum Multiplexen der Verwendung von Port D des ATMEL 328P-Mikroprozessors (Arduino NANO), um eine alternative Byte-Ausgabe f√ºr die Anzeige und den Austausch √ºber den seriellen Kanal bereitzustellen. <br><a name="habracut"></a><br>  Irgendwie habe ich ein Ger√§t zur √úberwachung des Kohlenmonoxidspiegels (CO) aus unn√∂tigen Elementen zusammengebaut - ein Display des Nokia N95, Arduino NANO mit schlechten Anschl√ºssen (D3 und D11, defekt aufgrund eines erfolglosen Kurzschlusses auf +400 Volt beim Debuggen eines Hochspannungsgenerators), Platinen Sound Bites und Kohlenmonoxidsensor MQ7 spielen.  All diese Details waren bis auf den einen oder anderen Grad fehlerhaft (mit Ausnahme des Sensors) und konnten in keinem anderen Projekt gefunden werden.  Seltsamerweise hat sich herausgestellt, dass das Ger√§t sehr n√ºtzlich ist, wenn man auf dem Land einen Herd benutzt.  Der Sommer 2019 erwies sich als nicht hei√ü und ich heizte den Ofen im Juli fast t√§glich f√ºr ein paar Wochen, wobei ich angenehm (Meditation auf der Flamme) mit n√ºtzlich (Recycling von ges√§gten M√ºllb√§umen) kombinierte.  Es stellte sich als sehr einfach heraus, die Verbrennungsregime zu steuern. Alle Manipulationen an den Klappen spiegelten sich sofort in den Ablesungen des Ger√§ts wider, was eine intelligente Steuerung des Ofens erm√∂glichte.  Das Ger√§t wird in diesem Artikel nicht beschrieben, es gibt im Internet jede Menge solcher Ger√§te f√ºr jeden Geschmack.  Ein charakteristisches Merkmal meines Ger√§ts ist die Funktion der kontinuierlichen √úberwachung des Zustands des CO-Sensors auf der Grundlage eines Vergleichs der gespeicherten Referenzkurve in Echtzeit sowie der hohen Reaktionsrate auf √Ñnderungen des CO-Niveaus, die durch den Vergleich der im vorherigen Zyklus gespeicherten Daten mit den aktuellen Daten erzielt wurden. <br><br>  Der Schwerpunkt dieses Artikels liegt auf der Erh√∂hung der Prozessor- und Anzeigegeschwindigkeit bei parallelem Byte-Datenaustausch. <br><br>  Die Anzeige hat einen parallelen Byteaustausch, und trotz der Verwendung aller mir bekannten Methoden zur Erh√∂hung des Wechselkurses erwies sich die Ausgabe zu ihr als ziemlich langsam.  Der Hauptgrund ist die Notwendigkeit, ein Datenbyte bitweise an verschiedene Bits verschiedener Ports auszugeben, da Arduino Nano keinen einzigen vollwertigen Port mit einer Breite von einem Byte besitzt.  Dieser Ausgabemodus ben√∂tigt ungef√§hr achtmal mehr Zeit als das Schreiben eines Bytes in ein Register.  NANO hat einen einzigen vollwertigen Port D, aber seine niedrigstwertigen Bits werden f√ºr den seriellen Hardware-Port verwendet, √ºber den die Skizzen in den Prozessor geladen und die Skizze mit der Host-Maschine ausgetauscht werden. <br><br>  Ich habe eine relativ einfache M√∂glichkeit gefunden, die Ausgabe der Anzeige byteweise zu verwenden.  Diese Methode besteht in der alternativen Verwendung von Port D f√ºr die Ausgabe von Daten an ein Display und f√ºr den Datenaustausch √ºber einen seriellen Kanal. <br><br>  Das vorgeschlagene Verfahren kann die Geschwindigkeit des integralen Austauschs mit der Anzeige signifikant erh√∂hen (ungef√§hr dreimal gem√§√ü meinen Messungen).  Das Wort "Integral" bedeutet, dass die Gesamtzeiten der Ausf√ºhrung von Bildschirmwiedergabevorg√§ngen auf Makroebene gemessen wurden.  Es ist wahrscheinlich, dass die Messung der Zeit auf der Ebene der atomaren E / A einen signifikant gr√∂√üeren Gewinn ergibt (im Bereich der gleichen Gr√∂√üenordnung). <br><br>  Die Messungen wurden an einem speziell zusammengebauten Modell (siehe Abbildung 1) folgenderma√üen durchgef√ºhrt: <br><br><ol><li>  Im Testprogramm wurden Zeitstempel mit der Ausgabe auf dem Hostcomputer platziert. </li><li>  Das Display wurde an die Pins D2 - D9 angeschlossen, ein Testprogramm wurde geladen, in dem das Byte durch Verteilung des Bytes nach Bits ausgegeben wurde. </li><li>  Das Display wurde an die Klemmen D0 - D7 angeschlossen, ein Testprogramm wurde geladen, in dem das Byte mit dem Befehl PORTD = data ausgegeben wurde. </li></ol><br><img src="https://habrastorage.org/webt/ia/_e/we/ia_ewej9cpjqsuc-rbbqqfunq-o.jpeg" alt="Bild"><br><br><img src="https://habrastorage.org/webt/yn/bx/ik/ynbxikh8knlpxyljyaotlupzsh8.jpeg" alt="Bild"><br>  <i>Abbildung 1. Fotos des Layouts zum Testen des Output-Multiplexing</i> <br><br>  Die Programme sind exakt gleich, die Umstellung der Ausgabemethode erfolgte durch √Ñnderung der Namen der Routinen SendDat und SendCom in SendDat1 bzw. SendCom1. <br>  Die Ausgabe des Programms an den eingebauten Serienmonitor wurde in OneNote aufgezeichnet und analysiert. <br><br><img src="https://habrastorage.org/webt/9l/k7/9h/9lk79hhwlc5wxhrjeit0ppzr6dq.png" alt="Bild"><br>  <i>Abbildung 2. Messen der Zeit, die f√ºr die Anzeige im Byte-Ausgabemodus ben√∂tigt wird</i> <i><br></i> <br><img src="https://habrastorage.org/webt/ug/ed/ne/ugedneqgze0ashcycrpxhb4tqyi.png" alt="Bild"><br>  <i>Abbildung 3. Messung der Bildschirmzeit im Bitausgabemodus</i> <br><br>  Die Messergebnisse sind in Tabelle 1 zusammengefasst. <br><br><img src="https://habrastorage.org/webt/dt/1-/mt/dt1-mtztotwlq1ff3wd8pjr2rsc.png" alt="Bild"><br>  <i>Tabelle 1. Integrierter Wechselkursgewinn</i> <br><br>  Die Nachteile des vorgeschlagenen Verfahrens sind die Notwendigkeit, zus√§tzliche Befehle zu verwenden, um den Anzeigemodus zu wechseln und √ºber eine serielle Schnittstelle auszutauschen. <br>  Auch beim Empfang von Daten vom Host-Rechner sind einige Schwierigkeiten zu erwarten. Der Empfang ist nur mit der expliziten Einbeziehung des seriellen Kanalmodus m√∂glich, der eine klare zeitliche Organisation der Prozesse in der Skizze erfordert. <br><br>  Das Studium des Prozessorhandbuchs ergab die folgenden Informationen: Die Einbeziehung des seriellen Schnittstellenmodus unterbricht die Steuerung der Zweige D0 und D1 auf Hardwareebene.  Dies bedeutet, dass Versuche, die Beine von der Skizze aus zu steuern, nicht zum gew√ºnschten Ergebnis f√ºhren. <br><br>  Eine weitere Untersuchung des Problems ergab, dass der gesamte Anschluss D dem Benutzer zur Verf√ºgung steht, wenn Sie den seriellen Anschluss nicht mit dem Befehl Serial.open () in die Skizze aufnehmen.  Sie k√∂nnen den Port mit dem Befehl DDRD = 0xFF auf allen Zweigen in den Ausgabemodus versetzen und gleichzeitig das gesamte Byte mit dem Befehl PORTD = data ausgeben, wobei die Datenvariable die Ausgabedaten enth√§lt. <br><br>  Das einmalige Versetzen von Port D in den Ausgabemodus ist ausreichend (im Setup).  Das anschlie√üende Ein- und Ausschalten des seriellen Kommunikationsmodus wirkt sich nicht auf den Port D-Modus aus. Er verbleibt im parallelen 8-Bit-Ausgangsmodus.  Wenn der serielle Austauschmodus eingeschaltet ist, gehen die Anschl√ºsse D0 und D1 in den Empfangs- bzw. Sendemodus.  Unabh√§ngig vom vorherigen Status des D1-Bits wird auf dem D1-Pin eine ‚Äû1‚Äú angezeigt, und diese ‚Äû1‚Äú befindet sich die ganze Zeit auf diesem Pin, solange der serielle √úbertragungsmodus aktiv ist, mit Ausnahme der Momente der Symbol√ºbertragung.  Wenn der serielle √úbertragungsmodus ausgeschaltet ist, gehen die Ausg√§nge D0 und D1 in den Ausgangszustand und die Signale aus dem Ausgangsregister erscheinen auf ihnen.  Wenn im Ausgangsregister anstelle von D1 "0" steht, wird am Ausgang eine negative Flanke erzeugt, die zur √úbertragung des St√∂rzeichens auf den seriellen Kanal f√ºhrt. <br><br>  Betrachten wir nun die Frage: Verhindert eine solche Verwendung von Port D das Herunterladen von Programmen?  Beim Laden des Programms wird der Prozessor durch den Impuls zur√ºckgesetzt, der vom USB-Port-Controller FT232RL (oder seinem analogen CH340) erzeugt wird, wenn das DTR-Signal gesetzt wird.  Das DTR-Signal geht von 1 auf 0 und ein negativer Abfall durch den Kondensator setzt den Prozessor zur√ºck.  Nach einem Reset schaltet der Prozessor die serielle Schnittstelle ein, startet den Bootloader und empf√§ngt den Programmcode.  Das √Ñndern des Betriebsmodus von Port D beeintr√§chtigt also nicht das normale Laden der Skizze. <br>  Wenn f√ºr die Skizze eine Ausgabe an die serielle Schnittstelle erforderlich ist, reicht der Befehl Serial.open () vor den Ausgabebefehlen aus. <br><br>  Es gibt jedoch Subtilit√§t.  Es besteht darin, dass der RxD-Eingang des FT232RL-Chips mit dem TxD-Ausgang verbunden bleibt und die Daten, die zur Anzeige gehen, empfangen und weiter an die Host-Maschine gesendet werden.  Diese Daten sehen wie Rauschen aus, obwohl dies in Wirklichkeit nicht der Fall ist (Abbildung 4). <br><br><img src="https://habrastorage.org/webt/ci/xo/rd/cixordnfxc94okd3u-s1pvzmqmk.png" alt="Bild"><br>  <i>Abbildung 4. Bildschirmansicht im Byte-Ausgabemodus ohne Blockierung</i> <br><br>  Es gibt zwei M√∂glichkeiten, mit diesem unn√∂tigen Signal umzugehen. <br><br>  Der erste Weg ist Software.  Es besteht darin, dass die Skizze vor der Ausgabe den Befehl Serial.println () verwendet, um vor der Ausgabe n√ºtzlicher Informationen eine neue Zeile zu erstellen.  Auf diese Weise kann der Hostrechner eingehende Leitungen leichter analysieren und n√ºtzliche Informationen aus der Skizze hervorheben. <br><br>  Der zweite Weg ist Hardware.  Der RxD-Eingang des FT232RL ist √ºber einen 1 kŒ©-Widerstand mit dem TxD-Ausgang verbunden.  Um die √úbertragung von Informationen zu blockieren, verbinden Sie einfach den Eingang RxD FT232RL mit "1".  Dies am einfachsten zu machen, ist eine der freien Schlussfolgerungen von Arduino.  Ich habe die Ausgabe von D8 verwendet.  Um diese Aktion auszuf√ºhren, habe ich an Pin 7 des RP1B-Widerstands mit einem Nennwert von 1 kŒ© Dr√§hten mit einem Stecker am Ende gel√∂tet und ihn zur mechanischen Fixierung durch die L√∂cher in der Platine gef√ºhrt.  In Abbildung 5 ist diese Verbindung durch eine rote Linie dargestellt, Abbildung 6 zeigt eine Fotografie der L√∂tstelle. <br><br><img src="https://habrastorage.org/webt/dn/r7/jj/dnr7jj05izmbz4fvr7s78uo2fn0.png" alt="Bild"><br>  <i>Abbildung 5. Teil der Arduino Nano-Schaltung</i> <br><br><img src="https://habrastorage.org/webt/wl/zp/_8/wlzp_8meo0relvtdyz4mt8slzlk.jpeg" alt="Bild"><br>  <i>Abbildung 6. Ort des L√∂tens eines zus√§tzlichen Drahtes in Arduino NANO</i> <br><br>  Dieser Mechanismus funktioniert folgenderma√üen: Nach dem Zur√ºcksetzen befindet sich der D8-Zweig im hochohmigen Eingangsmodus und die Arduino-Platine st√∂rt den normalen Betrieb des Programmlademechanismus auf der Platine nicht. <br><br>  Wenn die Steuerung der Anzeige in der Skizze gestartet werden muss, wird der Pin D8 in den aktiven Pin-Modus geschaltet und auf ‚Äû1‚Äú gesetzt (dies blockiert die √úbertragung von Daten vom Pin TxD Atmel328P zum Pin RxD FT232RL). Danach wird der Befehl Serial.end () ausgef√ºhrt.  Die Vorgehensweise ist wichtig, da nach dem Ausschalten des seriellen √úbertragungsmodus das Bit D1 auf dem TxD-Pin erscheint, das im Ausgangsregister von Port D des vorherigen Byte-Datensatzes in diesem Port gespeichert ist.  Wenn das Bit D1 "0" war, schaltet der Prozessorzweig beim Ausschalten des seriellen √úbertragungsmodus von "1" auf "0" um, und dies erzeugt eine parasit√§re Zeichen√ºbertragung auf dem seriellen Kanal. <br><br>  Beim Debuggen stellte sich au√üerdem heraus, dass wir vor dem Blockieren des seriellen Kanals auf das Ende der √úbertragung des gesamten Puffers zum Host-Computer warten mussten, da sonst ein Teil der √ºbertragenen Daten verloren gehen w√ºrde. <br><br>  Wenn eine Skizze die Daten√ºbertragung √ºber die serielle Schnittstelle erm√∂glichen soll, m√ºssen Sie den seriellen √úbertragungsmodus aktivieren und die Blockierung der seriellen Daten√ºbertragung deaktivieren, indem Sie den Lesemodus auf Pin D8 einstellen. <br><br>  Um diese Aufgaben auszuf√ºhren, wurden der Skizze zwei Routinen hinzugef√ºgt: <br><br><pre><code class="plaintext hljs">void s_begin() { Serial.begin(115200); //    TxD   USART.  TxD   "1",  RxD   pinMode(8, INPUT); //    RxD FT232RL  "1",       RxD FT232RL }</code> </pre> <br><pre> <code class="plaintext hljs">void s_end() { Serial.flush(); //   pinMode(8, OUTPUT); //  FT232RL  "1"       .   D8_High; //    Serial.end(); //   .      TxD  RxD    D0(RxD)  D1(TxD)  D }</code> </pre><br>  Ein vollst√§ndiges Testprogramm kann <a href="https://yadi.sk/d/bvtryfAhOqjCSw">hier</a> abgelegt werden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de476986/">https://habr.com/ru/post/de476986/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de476974/index.html">Lernen Sie Responsive Web Design in 5 Minuten</a></li>
<li><a href="../de476976/index.html">6 Redefehler bei Konferenzen</a></li>
<li><a href="../de476980/index.html">Was ist Legal Support? Empfehlungen f√ºr einen Anwalt eines IT-Unternehmens</a></li>
<li><a href="../de476982/index.html">Entwickler auf einer Remote-Site - von Grund auf neu zu einem Helden</a></li>
<li><a href="../de476984/index.html">Fallbeispiel von Narcade: T√ºrkische Entwickler sprechen √ºber die Lokalisierung mobiler Spiele und den t√ºrkischen Spielemarkt</a></li>
<li><a href="../de476990/index.html">Man kann es nicht einfach nehmen und alles perfekt machen: Was bleibt hinter den Kulissen des Guinness-Weltrekords?</a></li>
<li><a href="../de476994/index.html">Was machte Lisp so besonders?</a></li>
<li><a href="../de476996/index.html">L√∂sen des Problems des Umschaltens von Alt + Shift unter Linux in Anwendungen auf Electron</a></li>
<li><a href="../de476998/index.html">Kubernetes 1.17: √úbersicht der wichtigsten Neuerungen</a></li>
<li><a href="../de477000/index.html">So erh√∂hen Sie die Genauigkeit von Sensoren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>