<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•ºğŸ¾ â¬…ï¸ ğŸ‘©ğŸ¼â€ğŸ“ Cataclysm Dark Days Menjelang, Analisis Statis, dan Bagel ğŸ§›ğŸ¼ ğŸï¸ ğŸ“´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kemungkinan besar, Anda sudah menebak dari judul artikel bahwa fokusnya adalah pada kesalahan dalam kode sumber. Namun ini bukan satu-satunya hal yang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cataclysm Dark Days Menjelang, Analisis Statis, dan Bagel</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/449472/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/73b/65b/d13/73b65bd13915628ce2e414e1881f9ac3.png" alt="Gambar 10"></div><br>  Kemungkinan besar, Anda sudah menebak dari judul artikel bahwa fokusnya adalah pada kesalahan dalam kode sumber.  Namun ini bukan satu-satunya hal yang akan dibahas dalam artikel ini.  Jika selain C ++ dan kesalahan dalam kode orang lain Anda tertarik dengan permainan yang tidak biasa dan Anda tertarik untuk mengetahui apa "bagel" ini dan apa yang mereka makan bersama mereka, selamat datang di kat! <br><a name="habracut"></a><br>  Dalam pencarian saya untuk game yang tidak biasa, saya menemukan permainan Cataclysm Dark Days Ahead, yang berbeda dari grafik yang tidak biasa lainnya: ia diimplementasikan menggunakan karakter ASCII multi-warna pada latar belakang hitam. <br><br>  Apa yang mencolok dalam game ini dan sejenisnya adalah seberapa banyak semuanya diterapkan di dalamnya.  Khususnya, dalam Cataclysm, misalnya, bahkan untuk membuat karakter saya ingin mencari panduan, karena ada puluhan parameter, fitur, dan plot awal yang berbeda, belum lagi variasi acara dalam permainan itu sendiri. <br><br>  Ini adalah permainan sumber terbuka, dan juga ditulis dalam C ++.  Jadi tidak mungkin untuk melewati dan tidak menjalankan proyek ini melalui analisa statis PVS-Studio, dalam pengembangan yang sekarang saya terlibat aktif.  Proyek itu sendiri mengejutkan saya dengan kualitas kode yang tinggi, namun masih mengandung beberapa kekurangan dan saya akan membahas beberapa di antaranya dalam artikel ini. <br><br>  Sampai saat ini, dengan bantuan PVS-Studio, banyak game yang telah diuji.  Misalnya, Anda dapat membaca artikel kami yang lain, " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Analisis Statis di Industri Video Game: 10 Kesalahan Perangkat Lunak Teratas</a> ". <br><br><h2>  Logika </h2><br>  <b>Contoh 1:</b> <br><br>  Contoh berikut adalah kesalahan salin khas. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V501</a> Ada sub-ekspresi identik ke kiri dan ke kanan '||'  operator: rng (2, 7) &lt;abs (z) ||  rng (2, 7) &lt;abs (z) overmap.cpp 1503 <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> overmap::generate_sub( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z ) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( rng( <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> ) &lt; <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>( z ) || rng( <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> ) &lt; <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>( z ) ) { .... } .... }</code> </pre> <br>  Di sini kondisi yang sama diperiksa dua kali.  Kemungkinan besar, ekspresi itu disalin dan lupa untuk mengubah sesuatu di dalamnya.  Saya merasa sulit untuk mengatakan apakah kesalahan ini signifikan, tetapi pemeriksaan tidak berfungsi sebagaimana dimaksud. <br><br>  Peringatan serupa: <ul><li>  V501 Ada sub-ekspresi identik 'one_in (100000 / to_turns &lt;int&gt; (dur))' di sebelah kiri dan di sebelah kanan operator '&amp;&amp;'.  player_hardcoded_effects.cpp 547 </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e8c/16d/103/e8c16d1033a55f07c7754b604aae4807.png" alt="Gambar 9"></div><br>  <b>Contoh 2:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V728</a> Pemeriksaan berlebihan dapat disederhanakan.  The '(A &amp;&amp; B) ||  Ekspresi (! A &amp;&amp;! B) 'sama dengan ekspresi' bool (A) == bool (B) '.  inventory_ui.cpp 199 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> inventory_selector_preset::sort_compare( .... ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> left_fav = g-&gt;u.inv.assigned.count( lhs.location-&gt;invlet ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> right_fav = g-&gt;u.inv.assigned.count( rhs.location-&gt;invlet ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ( left_fav &amp;&amp; right_fav ) || ( !left_fav &amp;&amp; !right_fav ) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .... } .... }</code> </pre> <br>  Tidak ada kesalahan dalam kondisi ini, tetapi tidak perlu rumit.  Sebaiknya kasihan pada mereka yang harus membongkar kondisi ini, dan lebih mudah untuk menulis <i>jika (left_fav == right_fav)</i> . <br><br>  Peringatan serupa: <br><br><ul><li>  V728 Pemeriksaan berlebihan dapat disederhanakan.  The '(A &amp;&amp;! B) ||  Ekspresi (! A &amp;&amp; B) 'sama dengan ekspresi' bool (A)! = Bool (B) '.  iuse_actor.cpp 2653 </li></ul><br><h2>  Mundur saya </h2><br>  Ternyata menjadi penemuan bagi saya bahwa game yang sekarang disebut "bagel" hanyalah pengikut yang cukup ringan dari genre lama game roguelike.  Semuanya dimulai dengan permainan Rogue kultus tahun 1980, yang menjadi panutan dan menginspirasi banyak siswa dan programmer untuk membuat game mereka sendiri.  Saya pikir banyak juga yang dibawa oleh komunitas bermain peran dewan DnD dan variasinya. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4dc/d85/de3/4dcd85de3509609962cab730653f7ed1.png" alt="Gambar 8"></div><br><h2>  Optimalisasi mikro </h2><br>  <b>Contoh 3:</b> <br><br>  Grup berikutnya dari penganalisa peringatan tidak menunjukkan kesalahan, tetapi kemungkinan optimasi mikro dari kode program. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V801</a> Menurunkan Kinerja.  Lebih baik mendefinisikan kembali argumen fungsi kedua sebagai referensi.  Pertimbangkan untuk mengganti 'const ... ketik' dengan 'const ... &amp; ketik'.  map.cpp 4644 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Stack&gt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;item&gt; use_amount_stack( Stack <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> itype_id type ) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;item&gt; ret; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> a = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>.begin(); a != <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>.end() &amp;&amp; quantity &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( a-&gt;use_amount( type, ret ) ) { a = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>.erase( a ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ++a; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br>  Di sini <i>itdpe_id</i> menyembunyikan <i>std :: string</i> .  Karena argumennya tetap konstan, yang tidak akan membiarkannya diubah, akan lebih cepat untuk hanya meneruskan referensi variabel ke fungsi dan tidak membuang sumber daya untuk menyalin.  Dan meskipun, kemungkinan besar, garis di sana akan sangat kecil, tetapi penyalinan yang konstan tanpa alasan yang jelas tidak diperlukan.  Selain itu, fungsi ini dipanggil dari tempat yang berbeda, banyak di antaranya, pada gilirannya, juga mendapatkan <i>tipe</i> dari luar dan menyalinnya. <br><br>  Peringatan serupa: <br><br><ul><li>  V801 Menurunkan Kinerja.  Lebih baik mendefinisikan kembali argumen fungsi ketiga sebagai referensi.  Pertimbangkan untuk mengganti 'const ... evt_filter' dengan 'const ... &amp; evt_filter'.  input.cpp 691 </li><li>  V801 Menurunkan Kinerja.  Lebih baik mendefinisikan kembali argumen fungsi kelima sebagai referensi.  Pertimbangkan untuk mengganti 'const ... color' dengan 'const ... &amp; color'.  output.h 207 </li><li>  Secara total, penganalisa menghasilkan 32 peringatan seperti itu. </li></ul><br>  <b>Contoh 4:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V813</a> Menurunkan Kinerja.  Argumen 'str' mungkin harus diterjemahkan sebagai referensi konstan.  catacharset.cpp 256 <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base64_encode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> str )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( str.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; str[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'#'</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> input_length = str.length(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( output_length, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'\0'</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, j = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; input_length; ) { .... } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; mod_table[input_length % <span class="hljs-number"><span class="hljs-number">3</span></span>]; i++ ) { encoded_data[output_length - <span class="hljs-number"><span class="hljs-number">1</span></span> - i] = <span class="hljs-string"><span class="hljs-string">'='</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"#"</span></span> + encoded_data; }</code> </pre> <br>  Dalam hal ini, argumen, meskipun tidak konstan, tidak berubah dalam tubuh fungsi.  Oleh karena itu, untuk pengoptimalan, alangkah baiknya untuk mengirimkannya melalui tautan konstan, dan tidak memaksa kompiler untuk membuat salinan lokal. <br><br>  Peringatan ini juga tidak tunggal, ada total 26 kasus. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ff/557/9b3/4ff5579b36733a7bd46f4c3df6f30d90.png" alt="Gambar 7"></div><br>  Peringatan serupa: <br><br><ul><li>  V813 Menurunkan Kinerja.  Argumen 'pesan' mungkin harus diterjemahkan sebagai referensi konstan.  json.cpp 1452 </li><li>  V813 Menurunkan Kinerja.  Argumen 's' mungkin harus diterjemahkan sebagai referensi konstan.  catacharset.cpp 218 </li><li>  Dan seterusnya ... </li></ul><br><h2>  Retret II </h2><br>  Beberapa game roguelike klasik masih dikembangkan.  Jika Anda pergi ke gudang Dac atau NetHack Cataclysm GitHub, Anda dapat melihat bahwa perubahan sedang dilakukan secara aktif setiap hari.  NetHack umumnya adalah game tertua yang masih dikembangkan: dirilis pada Juli 1987, dan versi terbaru dari 2018. <br><br>  Salah satu yang terkenal, bagaimanapun, permainan selanjutnya dari genre ini adalah Dwarf Fortress, dikembangkan sejak 2002 dan dirilis pertama kali pada 2006.  â€œLosing is funâ€ adalah moto permainan, yang secara akurat mencerminkan esensinya, karena tidak mungkin untuk memenangkannya.  Game ini pada 2007 mendapatkan gelar game roguelike terbaik tahun ini sebagai hasil pemungutan suara, yang diadakan setiap tahun di situs web ASCII GAMES. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e39/7fb/efa/e397fbefa4204777cc74d97e2b8e52e9.png" alt="Gambar 6"></div><br>  Ngomong-ngomong, mereka yang tertarik dengan game ini mungkin tertarik dengan berita berikut.  Dwarf Fortress akan dirilis di Steam dengan grafis 32-bit yang ditingkatkan.  Dengan gambar yang diperbarui yang sedang dikerjakan oleh dua moderator game berpengalaman, Dwarf Fortress versi premium akan menerima trek musik tambahan dan dukungan untuk Steam Workshop.  Tetapi jika ada, pemilik versi berbayar Dwarf Fortress akan dapat mengubah grafik yang diperbarui ke bentuk sebelumnya di ASCII.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lebih detail</a> . <br><br><h2>  Operator Tugas Utama </h2><br>  <b>Contoh 5, 6:</b> <br><br>  Ada juga sepasang peringatan serupa yang menarik. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V690</a> Kelas 'JsonObject' mengimplementasikan copy constructor, tetapi tidak memiliki operator '='.  Berbahaya menggunakan kelas semacam itu.  json.h 647 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonObject</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: .... JsonIn *jsin; .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: JsonObject( JsonIn &amp;jsin ); JsonObject( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> JsonObject &amp;jsobj ); JsonObject() : positions(), start( <span class="hljs-number"><span class="hljs-number">0</span></span> ), end( <span class="hljs-number"><span class="hljs-number">0</span></span> ), jsin( <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) {} ~JsonObject() { finish(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finish</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// moves the stream to the end of the object .... void JsonObject::finish() { .... } .... }</span></span></code> </pre> <br>  Kelas ini memiliki copy constructor dan destructor, namun, itu tidak membebani operator penugasan.  Masalahnya di sini adalah bahwa operator penugasan yang dibuat secara otomatis hanya dapat menetapkan penunjuk ke <i>JsonIn</i> .  Akibatnya, kedua objek dari kelas <i>JsonObject</i> menunjuk ke <i>JsonIn yang</i> sama.  Tidak diketahui apakah situasi seperti itu dapat muncul di suatu tempat sekarang, tetapi, dalam hal apa pun, ini adalah garu yang akan diinjak seseorang cepat atau lambat. <br><br>  Masalah serupa hadir di kelas berikut. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V690</a> Kelas 'JsonArray' mengimplementasikan copy constructor, tetapi tidak memiliki operator '='.  Berbahaya menggunakan kelas semacam itu.  json.h 820 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonArray</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: .... JsonIn *jsin; .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: JsonArray( JsonIn &amp;jsin ); JsonArray( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> JsonArray &amp;jsarr ); JsonArray() : positions(), ...., jsin( <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) {}; ~JsonArray() { finish(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finish</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// move the stream position to the end of the array void JsonArray::finish() { .... } }</span></span></code> </pre> <br>  Anda dapat membaca lebih lanjut tentang bahaya kurangnya kelebihan operator penugasan untuk kelas kompleks di artikel " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Hukum Dua Besar</a> " (atau dalam terjemahan artikel ini " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">C ++: Hukum Dua Besar</a> "). <br><br>  <b>Contoh 7, 8:</b> <br><br>  Contoh lain terkait dengan operator penugasan yang kelebihan beban, tetapi kali ini kita berbicara tentang implementasi spesifiknya. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V794</a> Operator penugasan harus dilindungi dari kasus 'this == &amp; other'.  mattack_common.h 49 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringRef</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">friend</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringRefTestAccess</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>* m_start; size_type m_size; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* m_data = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> = ( StringRef <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp;other ) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> -&gt; StringRef&amp; { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>[] m_data; m_data = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; m_start = other.m_start; m_size = other.m_size; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre><br>  Masalahnya adalah bahwa implementasi ini tidak terlindungi dari menetapkan objek ke dirinya sendiri, yang merupakan praktik yang tidak aman.  Artinya, jika referensi ke <i>* ini</i> diteruskan ke operator ini, kebocoran memori dapat terjadi. <br><br>  Contoh serupa dari operator penugasan yang keliru membebani dengan efek samping yang menarik: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V794</a> Operator penugasan harus dilindungi dari kasus 'this == &amp; rhs'.  player_activity.cpp 38 <br><br><pre> <code class="cpp hljs">player_activity &amp;player_activity::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> player_activity &amp;rhs ) { type = rhs.type; .... targets.clear(); targets.reserve( rhs.targets.size() ); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::transform( rhs.targets.begin(), rhs.targets.end(), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::back_inserter( targets ), []( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> item_location &amp; e ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e.clone(); } ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre><br>  Dalam hal ini, sama seperti tidak ada pemeriksaan pada penugasan objek untuk dirinya sendiri.  Tetapi di samping itu, vektor mengisi.  Jika Anda mencoba untuk menetapkan objek kepada diri Anda sendiri dengan kelebihan seperti itu, maka di bidang <i>target</i> kami mendapatkan vektor berlipat ganda, beberapa di antaranya elemennya rusak.  Namun, ada yang <i>jelas</i> sebelum <i>mentransformasikan</i> yang akan menghapus vektor objek dan data akan hilang. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/92a/db9/a3a/92adb9a3ab8b30a4f8c02de2bc353a7a.png" alt="Gambar 16"></div><br><h2>  Retret III </h2><br>  Pada tahun 2008, bagel bahkan memperoleh definisi formal, yang diberi nama epik "Berlin Interpretation".  Menurut definisi ini, fitur utama dari game tersebut adalah: <br><br><ul><li>  Dunia yang dihasilkan secara acak yang meningkatkan nilai replay; </li><li>  Permadeath: jika karakter Anda mati, dia mati selamanya dan semua item hilang; </li><li>  Langkah-demi-langkah: perubahan hanya terjadi bersamaan dengan aksi pemain, sampai aksi dilakukan - waktu berhenti; </li><li>  Kelangsungan hidup: sumber daya sangat terbatas. </li></ul><br>  Baik dan yang paling penting: bagel ditujukan terutama untuk menjelajahi dan menemukan dunia, mencari cara baru untuk menggunakan objek dan melewati ruang bawah tanah. <br><br>  Situasi yang biasa di DDA Cataclysm: beku dan lapar sampai mati, Anda tersiksa oleh kehausan, dan memang Anda memiliki enam tentakel alih-alih kaki. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/f8e/b69/8fef8eb69a48050011726fe47ec1da35.png" alt="Gambar 15"></div><br><h2>  Detail penting </h2><br>  <b>Contoh 9:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V1028</a> Kemungkinan meluap.  Pertimbangkan casting operan dari operator 'mulai + lebih besar' ke tipe 'size_t', bukan hasilnya.  worldfactory.cpp 638 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> worldfactory::draw_mod_list( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> &amp;start, .... ) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> larger = ....; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iNum = ....; .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( .... ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( iNum &gt;= <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>&gt;( start ) &amp;&amp; iNum &lt; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>&gt;( start + larger ) ) { .... } .... } .... }</code> </pre> <br>  Sepertinya programmer ingin menghindari overflow.  Tetapi membawa hasil penambahan dalam hal ini tidak ada gunanya, karena overflow akan terjadi ketika angka ditambahkan, dan ekspansi tipe akan dilakukan pada hasil yang tidak berarti.  Untuk menghindari situasi ini, Anda hanya perlu memberikan satu argumen ke tipe yang lebih besar: <i>(static_cast &lt;size_t&gt; (start) + lebih besar)</i> . <br><br>  <b>Contoh 10:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V530</a> Nilai balik fungsi 'ukuran' diperlukan untuk digunakan.  worldfactory.cpp 1340 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> worldfactory::world_need_lua_build( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> world_name ) { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> LUA .... #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Prevent unused var error when LUA and RELEASE enabled. world_name.size(); return false; }</span></span></span></span></code> </pre> <br>  Untuk kasus seperti itu, ada sedikit trik.  Jika variabel tidak digunakan, alih-alih mencoba memanggil metode apa pun, Anda bisa menulis <i>(void) world_name</i> untuk menekan peringatan kompiler. <br><br>  <b>Contoh 11:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V812</a> Menurunkan Performa.  Penggunaan fungsi 'hitungan' yang tidak efektif.  Itu mungkin dapat diganti dengan panggilan ke fungsi 'temukan'.  player.cpp 9600 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> player::read( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> inventory_position, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> continuous ) { .... player_activity activity; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !continuous || !<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::all_of( learners.begin(), learners.end(), [&amp;]( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::pair&lt;npc *, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; elem ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::count( activity.values.begin(), activity.values.end(), elem.first-&gt;getID() ) != <span class="hljs-number"><span class="hljs-number">0</span></span>; } ) { .... } .... }</code> </pre> <br>  Dilihat oleh fakta bahwa hasil <i>perhitungan</i> dibandingkan dengan nol, idenya adalah untuk memahami jika setidaknya ada satu elemen yang diperlukan di antara <i>aktivitas</i> .  Tetapi <i>hitungan</i> dipaksa untuk melewati seluruh wadah, karena menghitung semua kejadian elemen.  Dalam situasi ini, akan lebih cepat menggunakan <i>find</i> , yang berhenti setelah kecocokan pertama ditemukan. <br><br>  <b>Contoh 12:</b> <br><br>  Kesalahan berikut mudah terdeteksi jika Anda tahu tentang satu kehalusan. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V739</a> EOF tidak boleh dibandingkan dengan nilai tipe 'char'.  'Ch' harus dari tipe 'int'.  json.cpp 762 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> JsonIn::skip_separator() { <span class="hljs-keyword"><span class="hljs-keyword">signed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ch; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">','</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ate_separator ) { .... } .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == EOF) { .... }</code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/976/f53/d2f/976f53d2fe83c567077c7eacb481d852.png" alt="Gambar 3"></div><br>  Ini adalah salah satu kesalahan yang sulit untuk diketahui jika Anda tidak tahu bahwa <i>EOF</i> didefinisikan sebagai -1.  Karenanya, jika Anda mencoba membandingkannya dengan variabel tipe <i>char yang ditandatangani</i> , kondisinya hampir selalu <i>salah</i> .  Satu-satunya pengecualian adalah jika kode karakter adalah 0xFF (255).  Saat membandingkan, simbol seperti itu akan berubah menjadi -1 dan kondisinya akan benar. <br><br>  <b>Contoh 13:</b> <br><br>  Kesalahan kecil berikutnya mungkin suatu hari menjadi kritis.  Tidak heran itu ada di daftar CWE sebagai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-834</a> .  Omong-omong, ada lima dari mereka. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V663</a> Infinite loop dimungkinkan.  Kondisi 'cin.eof ()' tidak cukup untuk memutuskan dari loop.  Pertimbangkan untuk menambahkan pemanggilan fungsi 'cin.fail ()' ke ekspresi kondisional.  action.cpp 46 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_keymap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::istream &amp;keymap_txt, .... )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( !keymap_txt.eof() ) { .... } }</code> </pre> <br>  Seperti yang dinyatakan dalam peringatan, memeriksa untuk mencapai akhir file saat membaca tidak cukup, Anda juga harus memeriksa kesalahan baca <i>cin.fail ()</i> .  Ubah kode untuk pembacaan yang lebih aman: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( !keymap_txt.eof() ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(keymap_txt.fail()) { keymap_txt.clear(); keymap_txt.ignore(numeric_limits&lt;streamsize&gt;::max(),<span class="hljs-string"><span class="hljs-string">'\n'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } .... }</code> </pre> <br>  <i>keymap_txt.clear ()</i> diperlukan untuk menghapus status kesalahan (flag) dari aliran jika terjadi kesalahan pembacaan dari file, jika tidak teks tidak dapat dibaca lebih lanjut.  <i>keymap_txt.ignore</i> dengan <i>numeric_limits</i> parameter <i>&lt;</i> <i>streamsize</i> <i>&gt; :: max ()</i> dan karakter kontrol umpan baris memungkinkan Anda untuk melewati sisa baris. <br><br>  Ada cara yang lebih sederhana untuk berhenti membaca: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( !keymap_txt ) { .... }</code> </pre> <br>  Ketika digunakan dalam konteks logika, itu mengkonversi dirinya sendiri ke nilai yang setara dengan yang <i>benar</i> sampai <i>EOF</i> tercapai. <br><br><h2>  Mundur IV </h2><br>  Sekarang gim yang paling populer adalah gim yang menggabungkan tanda-tanda permainan roguelike dan genre lainnya: platformer, strategi, dll. Game semacam itu kemudian disebut roguelike-like atau roguelite.  Game-game tersebut termasuk judul-judul terkenal seperti Don't Starve, The Binding of Isaac, FTL: Faster Than Light, Darkest Dungeon, dan bahkan Diablo. <br><br>  Meskipun kadang-kadang perbedaan antara roguelike dan roguelite sangat kecil sehingga tidak jelas genre yang dimiliki permainan.  Seseorang percaya bahwa Dwarf Fortress tidak lagi seperti roguelike, tetapi bagi seseorang, Diablo adalah bagel klasik. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/330/a83/895/330a838954a71a90e8bd65764a9169a8.png" alt="Gambar 1"></div><br><h2>  Kesimpulan </h2><br>  Meskipun proyek secara keseluruhan adalah contoh kode berkualitas tinggi, dan tidak mungkin menemukan banyak kesalahan serius, ini tidak berarti bahwa penggunaan analisis statis adalah berlebihan untuk itu.  Intinya bukan dalam satu kali pemeriksaan yang kami lakukan untuk mempopulerkan metodologi analisis kode statis, tetapi dalam penggunaan reguler penganalisis.  Kemudian banyak kesalahan dapat diidentifikasi pada tahap awal dan, oleh karena itu, mengurangi biaya untuk memperbaikinya.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Contoh</a> perhitungan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/18d/90c/4b5/18d90c4b57268f6f55e2721a68fc017c.png" alt="Gambar 2"></div><br>  Pekerjaan aktif sedang berlangsung pada game yang dipertimbangkan, dan ada komunitas modders yang aktif.  Selain itu, ini porting ke banyak platform, termasuk iOS dan Android.  Jadi, jika Anda tertarik dengan game ini, saya sarankan Anda mencoba! <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id449472/">https://habr.com/ru/post/id449472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id449460/index.html">Museum DataArt. Manipulasi mouse dari informasi grafis</a></li>
<li><a href="../id449462/index.html">Menggunakan mekanisme token kriptografis PKCS # 11 dalam bahasa scripting</a></li>
<li><a href="../id449464/index.html">Widget vk.com tanpa permintaan menetapkan penghitung dari mail.ru di situs</a></li>
<li><a href="../id449466/index.html">Jeda dalam game HTML5</a></li>
<li><a href="../id449468/index.html">Bagaimana "peretasan etis" dari produsen perangkat lunak perjudian berubah menjadi mimpi buruk yang lengkap</a></li>
<li><a href="../id449476/index.html">Jenis penyimpanan SSD baru akan mengurangi konsumsi daya di pusat data - cara kerjanya</a></li>
<li><a href="../id449478/index.html">Menambahkan UICollectionViews ke UITableViewCell khusus yang dilakukan melalui Xib</a></li>
<li><a href="../id449480/index.html">Pilih pelacakan bug yang sesuai</a></li>
<li><a href="../id449484/index.html">Kami membuat sensor kontrol kualitas udara pada InfluxDB, Grafana, Docker dan Raspberry Pi</a></li>
<li><a href="../id449486/index.html">Eksodus massal game browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>