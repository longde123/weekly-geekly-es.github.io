<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜© ğŸ‘©ğŸ»â€ğŸ”§ ğŸ‘‰ğŸ¼ ä¸šä½™ç¬”è®°ï¼Œæˆ–ã€Š Scala FPGAå¼€å‘äººå‘˜å¦‚ä½•é…ç½®çš„æ•…äº‹ã€‹ ğŸ•Šï¸ ğŸ“¶ ğŸ™ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¾ˆé•¿æ—¶é—´ä»¥æ¥ï¼Œæˆ‘ä¸€ç›´æ¢¦æƒ³ç€å­¦ä¹ å¦‚ä½•ä½¿ç”¨FPGAï¼Œå› æ­¤æˆ‘ä¸€ç›´åœ¨ä»”ç»†ç ”ç©¶ã€‚ ç„¶åï¼Œä»–ä¹°äº†ä¸€ä¸ªè°ƒè¯•æ¿ï¼Œå†™äº†å‡ ä¸ªé—®å€™ï¼Œå¹¶å°†è¯¥æ¿æ”¾å…¥ç›’å­ä¸­ï¼Œå› ä¸ºå°šä¸æ¸…æ¥šè¯¥å¦‚ä½•å¤„ç†ã€‚ ç„¶åè¿™ä¸ªæƒ³æ³•å°±æ¥äº†ï¼šè®©æˆ‘ä»¬ä¸ºå¤è€çš„CRTç”µè§†ç¼–å†™ä¸€ä¸ªå¤åˆè§†é¢‘ç”Ÿæˆå™¨ã€‚ è¿™ä¸ªæƒ³æ³•å½“ç„¶å¾ˆæœ‰è¶£ï¼Œä½†æ˜¯æˆ‘å¹¶ä¸çœŸæ­£äº†è§£Verilogï¼Œæˆ‘ä»ç„¶å¿…é¡»è®°ä½å®ƒï¼Œå¹¶...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä¸šä½™ç¬”è®°ï¼Œæˆ–ã€Š Scala FPGAå¼€å‘äººå‘˜å¦‚ä½•é…ç½®çš„æ•…äº‹ã€‹</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414995/"><p><img src="https://habrastorage.org/webt/iv/-q/hz/iv-qhzuto0ce_yrg6l226fghqf8.png" width="60%" align="left"> å¾ˆé•¿æ—¶é—´ä»¥æ¥ï¼Œæˆ‘ä¸€ç›´æ¢¦æƒ³ç€å­¦ä¹ å¦‚ä½•ä½¿ç”¨FPGAï¼Œå› æ­¤æˆ‘ä¸€ç›´åœ¨ä»”ç»†ç ”ç©¶ã€‚ ç„¶åï¼Œä»–ä¹°äº†ä¸€ä¸ªè°ƒè¯•æ¿ï¼Œå†™äº†å‡ ä¸ªé—®å€™ï¼Œå¹¶å°†è¯¥æ¿æ”¾å…¥ç›’å­ä¸­ï¼Œå› ä¸ºå°šä¸æ¸…æ¥šè¯¥å¦‚ä½•å¤„ç†ã€‚ ç„¶åè¿™ä¸ªæƒ³æ³•å°±æ¥äº†ï¼šè®©æˆ‘ä»¬ä¸ºå¤è€çš„CRTç”µè§†ç¼–å†™ä¸€ä¸ªå¤åˆè§†é¢‘ç”Ÿæˆå™¨ã€‚ è¿™ä¸ªæƒ³æ³•å½“ç„¶å¾ˆæœ‰è¶£ï¼Œä½†æ˜¯æˆ‘å¹¶ä¸çœŸæ­£äº†è§£Verilogï¼Œæˆ‘ä»ç„¶å¿…é¡»è®°ä½å®ƒï¼Œå¹¶ä¸”æˆ‘çœŸçš„ä¸éœ€è¦è¿™ä¸ªç”Ÿæˆå™¨...æœ€è¿‘ï¼Œæˆ‘æƒ³ç ”ç©¶<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RISC-V</a>è½¯ä»¶å¤„ç†å™¨ã€‚ æ‚¨éœ€è¦ä»æŸä¸ªåœ°æ–¹å¼€å§‹ï¼Œç„¶åç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Chisel</a>ç¼–å†™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rocket Chip</a>ä»£ç ï¼ˆè¿™æ˜¯å®ç°ä¹‹ä¸€ï¼‰-è¿™æ˜¯ç”¨äºScalaçš„DSLã€‚ ç„¶åæˆ‘çªç„¶æƒ³èµ·äº†æˆ‘ä¸¤å¹´æ¥ä¸€ç›´åœ¨Scalaä¸Šè¿›è¡Œä¸“ä¸šå¼€å‘å¹¶æ„è¯†åˆ°ï¼šæ—¶é—´åˆ°äº†... </p><br><p> å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³é˜…è¯»å‰ªçº¿é’³ï¼Œæ•°å­—ä¸‡ç”¨è¡¨å’Œç¤ºæ³¢å™¨ç­‰å·²å®ç°çš„æ•…äº‹ï¼Œé‚£ä¹ˆæ¬¢è¿æ‚¨ã€‚ </p><a name="habracut"></a><br><p> é‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°†ä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ åœ¨å…¶ä¸­ï¼Œæˆ‘å°†æè¿°ç”±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">nckma</a>åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç«æ˜Ÿæ¢æµ‹å™¨2</a>æ¿ä¸Šç”Ÿæˆå¤åˆPALè§†é¢‘ä¿¡å·çš„å°è¯•ï¼ˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨PALï¼Ÿ-æˆ‘åˆšåˆšé‡åˆ°äº†ä¸€ä¸ªä¸“é—¨ä»‹ç»PALç”Ÿæˆçš„å¾ˆå¥½çš„æ•™ç¨‹ï¼‰ã€‚ å…³äºæœ¬æ–‡ä¸­çš„RISC-Vï¼Œæˆ‘ä»€ä¹ˆä¹Ÿä¸ä¼šè¯´ã€‚  :) </p><br><p> é¦–å…ˆï¼Œä»‹ç»ä¸€ä¸‹Scalaå’ŒChiselï¼šScalaæ˜¯ä¸€ç§åœ¨Javaè™šæ‹Ÿæœºä¹‹ä¸Šè¿è¡Œçš„è¯­è¨€ï¼Œå®ƒé€æ˜åœ°ä½¿ç”¨ç°æœ‰çš„Javaåº“ï¼ˆå°½ç®¡ä¹Ÿæœ‰Scala.jså’ŒScala Nativeï¼‰ã€‚ å½“æˆ‘åˆšå¼€å§‹ç ”ç©¶å®ƒæ—¶ï¼Œæˆ‘æ„Ÿåˆ°å®ƒæ˜¯â€œ plussâ€å’ŒHaskellçš„éå¸¸å¯è¡Œçš„æ··åˆä½“<em>ï¼ˆä½†æ˜¯ï¼ŒåŒäº‹ä»¬å¯¹æ­¤çœ‹æ³•ä¸ä¸€ï¼‰</em> â€“è¿™æ˜¯ä¸€ä¸ªç—›è‹¦çš„é«˜çº§ç±»å‹ç³»ç»Ÿå’Œç®€æ´çš„è¯­è¨€ï¼Œä½†æ˜¯ç”±äºéœ€è¦äº¤å‰ä½¿ç”¨åŠŸèƒ½ä¸»ä¹‰OOPåœ¨æŸäº›åœ°æ–¹ä¸°å¯Œçš„è¯­è¨€æ„é€ è®©äººè”æƒ³èµ·C ++ã€‚ ä½†æ˜¯ï¼Œä¸è¦å®³æ€•Scala-å®ƒæ˜¯ä¸€ç§éå¸¸ç®€æ´å’Œå®‰å…¨çš„è¯­è¨€ï¼Œå…·æœ‰å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿï¼Œèµ·åˆæ‚¨å¯ä»¥ç®€å•åœ°å°†å…¶ç¼–å†™ä¸ºæ”¹è¿›çš„Javaã€‚ è€Œä¸”æ®æˆ‘æ‰€çŸ¥ï¼ŒScalaæœ€åˆæ˜¯ä¸ºæ–¹ä¾¿åˆ›å»º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¢†åŸŸç‰¹å®šè¯­è¨€</a>è€Œå¼€å‘çš„ä¸€ç§è¯­è¨€-è¿™æ˜¯å½“æ‚¨ä»¥ä¸€ç§æ­£å¼è¯­è¨€æè¿°ä¾‹å¦‚æ•°å­—è®¾å¤‡æˆ–éŸ³ç¬¦æ—¶ï¼Œä»å…¶ä¸»é¢˜é¢†åŸŸçš„è§’åº¦æ¥çœ‹ï¼Œè¿™ç§è¯­è¨€çœ‹èµ·æ¥å¾ˆåˆé€»è¾‘ã€‚ ç„¶åï¼Œæ‚¨çªç„¶å‘ç°è¿™æ˜¯Scalaï¼ˆæˆ–è€…Haskellï¼‰ä¸­æ­£ç¡®çš„ä»£ç -æ°å¥½äººä»¬å†™äº†ä¸€ä¸ªå…·æœ‰æ–¹ä¾¿æ¥å£çš„åº“ã€‚  Chiselå°±æ˜¯è¿™æ ·çš„Scalaåº“ï¼Œå®ƒå…è®¸æ‚¨åœ¨ä¾¿æ·çš„DSLä¸Šæè¿°æ•°å­—é€»è¾‘ï¼Œç„¶åè¿è¡Œç”Ÿæˆçš„Scalaä»£ç å¹¶åœ¨Verilogï¼ˆæˆ–å…¶ä»–æ–¹å¼ï¼‰ä¸Šç”Ÿæˆä»£ç ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°Quartusé¡¹ç›®ä¸­ã€‚ å¥½å§ï¼Œæˆ–è€…ç«‹å³è¿è¡Œæ ‡å‡†çš„Scalaé£æ ¼çš„å•å…ƒæµ‹è¯•ï¼Œå®ƒä»¬è‡ªå·±å°†æ¨¡æ‹Ÿæµ‹è¯•å¹³å°å¹¶å‘å¸ƒç»“æœæŠ¥å‘Šã€‚ </p><br><p> ä¸ºäº†ç†Ÿæ‚‰æ•°å­—ç”µè·¯ï¼Œæˆ‘å¼ºçƒˆæ¨è<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™æœ¬ä¹¦</a> ï¼ˆå®ƒå·²ç»å°åœ¨ä¿„è¯­ç‰ˆæœ¬ä¸­ï¼‰ã€‚ å®é™…ä¸Šï¼Œæˆ‘å¯¹FPGAé¢†åŸŸçš„ç³»ç»Ÿäº†è§£å‡ ä¹ä»¥è¿™æœ¬ä¹¦ç»“å°¾ï¼Œå› æ­¤æ¬¢è¿åœ¨è¯„è®ºä¸­è¿›è¡Œå»ºè®¾æ€§çš„æ‰¹è¯„ï¼ˆä½†æ˜¯ï¼Œæˆ‘å†è¯´ä¸€éï¼Œè¿™æœ¬ä¹¦å¾ˆæ£’ï¼šå®ƒä»åŸºç¡€åˆ°åˆ›å»ºä¸€ä¸ªç®€å•çš„ä¼ é€å¼å¤„ç†å™¨éƒ½åœ¨è®²è¿°ï¼Œé‚£é‡Œæœ‰å›¾ç‰‡;ï¼‰ã€‚ï¼‰ å¥½å§ï¼Œæ®Chiselæ‰€è¯´ï¼Œæœ‰ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¾ˆå¥½çš„å®˜æ–¹æ•™ç¨‹</a> ã€‚ </p><br><p>  <strong>å…è´£å£°æ˜ï¼š</strong>ä½œè€…å¯¹çƒ§æ¯çš„è®¾å¤‡ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ï¼Œå¦‚æœæ‚¨å†³å®šé‡å¤å®éªŒï¼Œæœ€å¥½ç”¨ç¤ºæ³¢å™¨æ£€æŸ¥ä¿¡å·ç”µå¹³ï¼Œé‡æ–°åˆ¶ä½œæ¨¡æ‹Ÿéƒ¨åˆ†ï¼Œç­‰ç­‰ã€‚ é€šå¸¸ï¼Œè¯·éµå®ˆå®‰å…¨é¢„é˜²æªæ–½ã€‚  <em>ï¼ˆä¾‹å¦‚ï¼Œåœ¨æ’°å†™æœ¬æ–‡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ„è¯†åˆ°è…¿ä¹Ÿæ˜¯å››è‚¢ï¼Œæ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä»¥å°†å®ƒä»¬ç²˜åœ¨ä¸­å¤®åŠ çƒ­ç”µæ± ä¸­ï¼Œä»è€Œä¿æŒä½æ¿å­çš„è¾“å‡º...ï¼‰</em>é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿™ç§æ„ŸæŸ“è¿˜å¯¹éš”å£æˆ¿é—´çš„ç”µè§†é€ æˆäº†å¹²æ‰°ã€‚åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­... </p><br><h2 id="nastroyka-proekta"> é¡¹ç›®è®¾ç½® </h2><br><p>æˆ‘ä»¬å°†åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">IntelliJ Idea Community Editionä¸­</a>ç¼–å†™ä»£ç ï¼Œè€Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sbt</a>å°†æ˜¯æ„å»ºç³»ç»Ÿï¼Œå› æ­¤åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»æ­¤å¤„å¼€å§‹</a>å°†<code>.gitignore</code> ï¼Œ <code>project/build.properties</code> ï¼Œ <code>project/plugins.sbt</code>å’Œ </p><br><div class="spoiler">  <b class="spoiler_title">ç¨å¾®ç®€åŒ–äº†build.sbt</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scalacOptionsVersion</span></span></span></span>(scalaVersion: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = { <span class="hljs-type"><span class="hljs-type">Seq</span></span>() ++ { <span class="hljs-comment"><span class="hljs-comment">// If we're building with Scala &gt; 2.11, enable the compile option // switch to support our anonymous Bundle definitions: // https://github.com/scala/bug/issues/10047 CrossVersion.partialVersion(scalaVersion) match { case Some((2, scalaMajor: Long)) if scalaMajor &lt; 12 =&gt; Seq() case _ =&gt; Seq("-Xsource:2.11") } } } name := "chisel-example" version := "1.0.0" scalaVersion := "2.11.12" resolvers ++= Seq( Resolver.sonatypeRepo("snapshots"), Resolver.sonatypeRepo("releases") ) // Provide a managed dependency on X if -DXVersion="" is supplied on the command line. val defaultVersions = Map( "chisel3" -&gt; "3.1.+", "chisel-iotesters" -&gt; "1.2.+" ) libraryDependencies ++= (Seq("chisel3","chisel-iotesters").map { dep: String =&gt; "edu.berkeley.cs" %% dep % sys.props.getOrElse(dep + "Version", defaultVersions(dep)) }) scalacOptions ++= scalacOptionsVersion(scalaVersion.value)</span></span></code> </pre> </div></div><br><p> ç°åœ¨ï¼Œåœ¨Ideaä¸­æ‰“å¼€å®ƒï¼Œå¹¶è¦æ±‚å¯¼å…¥sbté¡¹ç›®-sbtå°†ä¸‹è½½å¿…è¦çš„ä¾èµ–é¡¹ã€‚ </p><br><h2 id="pervye-moduli"> ç¬¬ä¸€ä¸ªæ¨¡å— </h2><br><h3 id="shim"> è„‰å®½è°ƒåˆ¶ </h3><br><p> é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°è¯•ç¼–å†™ä¸€ä¸ªç®€å•çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PWM</a> ã€‚ æˆ‘çš„é€»è¾‘å¤§è‡´å¦‚ä¸‹ï¼šè¦ç”Ÿæˆå ç©ºæ¯”ä¿¡å·n / mï¼Œæˆ‘ä»¬é¦–å…ˆå°†0æ”¾å…¥å¯„å­˜å™¨ï¼Œç„¶ååœ¨æ¯ä¸€æ­¥ä¸­å°†nåŠ åˆ°å¯„å­˜å™¨ä¸­ã€‚ å½“å¯„å­˜å™¨çš„å€¼è¶…è¿‡mæ—¶ï¼Œå‡å»må¹¶åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…å‘å‡ºé«˜ç”µå¹³ã€‚ å®é™…ä¸Šï¼Œå¦‚æœn&gt; mï¼Œè¿™å°†æ˜¯è¶Šé‡è½¦ï¼Œä½†æˆ‘ä»¬å°†è®¤ä¸ºè¿™æ˜¯ä¸ç¡®å®šçš„è¡Œä¸ºï¼Œè¿™å¯¹äºä¼˜åŒ–ä½¿ç”¨çš„å®é™…æ¡ˆä¾‹æ˜¯å¿…éœ€çš„ã€‚ </p><br><p> æˆ‘ä¸ä¼šè®²å®Œæ•´çš„åˆå­¦è€…æŒ‡å—-å®ƒéœ€è¦åŠä¸ªå°æ—¶çš„é˜…è¯»æ—¶é—´ï¼Œæˆ‘åªä¼šè¯´ï¼Œä¸ºäº†æè¿°æ¨¡å—ï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥<code>chisel3._</code>å¹¶ä»æŠ½è±¡ç±»<code>Module</code>ç»§æ‰¿ã€‚ è¿™æ˜¯æŠ½è±¡çš„ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ç”¨åç§°<code>io</code>æ¥æè¿°<code>io</code>å®ƒå…·æœ‰æ¨¡å—çš„æ•´ä¸ªæ¥å£ã€‚ åŒæ—¶ï¼Œ <code>clock</code>å’Œ<code>reset</code>è¾“å…¥å°†éšå¼æ˜¾ç¤º-æ‚¨æ— éœ€åˆ†åˆ«æè¿°å®ƒä»¬ã€‚ è¿™æ˜¯å‘ç”Ÿäº†ä»€ä¹ˆï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWM</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numerator = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> denominator = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pulse = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> counter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> nextValue = counter + io.numerator io.pulse := nextValue &gt; io.denominator counter := <span class="hljs-type"><span class="hljs-type">Mux</span></span>(io.pulse, nextValue - io.denominator, nextValue) }</code> </pre><br><p> æ³¨æ„ï¼Œæˆ‘ä»¬<code>.W</code>å¸¸è§„int <code>.W</code>è°ƒç”¨<code>.W</code>æ–¹æ³•ä»¥è·å–ç«¯å£å®½åº¦ï¼Œè€Œé€šå¸¸åœ¨æ•´æ•°å¸¸é‡ä¸Šè°ƒç”¨<code>.asUInt(width.W)</code>æ–¹æ³•ï¼ è¿™æ€ä¹ˆå¯èƒ½ï¼Ÿ  -å¥½å§ï¼Œåœ¨Smalltalkä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºIntegerç±»ï¼ˆæˆ–åœ¨é‚£é‡Œæ‰€è°“çš„ä»»ä½•ä¸œè¥¿ï¼‰å®šä¹‰ä¸€ä¸ªæ–°æ–¹æ³•ï¼Œä½†æ˜¯åœ¨JVMä¸­ï¼Œæˆ‘ä»¬ä»ç„¶æ²¡æœ‰æ•´ä¸ªå¯¹è±¡-è¿˜æœ‰åŸå§‹ç±»å‹ï¼ŒScalaç†è§£è¿™ä¸€ç‚¹ï¼ˆæ­¤å¤–ï¼Œæœ‰ä¸€äº›æˆ‘ä»¬æ— æ³•ä¿®æ”¹çš„ç¬¬ä¸‰æ–¹ç±»ï¼‰ã€‚ å› æ­¤ï¼Œå­˜åœ¨å„ç§éšå¼sï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒScalaå¯èƒ½ä¼šå‘ç°ç±»ä¼¼ </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BetterInt</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">n: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">W</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Width</span></span> = ... }</code> </pre> <br><p> åœ¨ç›®å‰çš„èŒƒå›´å†…ï¼Œæ™®é€šçš„intå…·æœ‰è¶…èƒ½åŠ›ã€‚ è¿™æ˜¯ä½¿Scalaæ›´åŠ ç®€æ´å’Œæ˜“äºåˆ›å»ºDSLçš„åŠŸèƒ½ä¹‹ä¸€ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä¸ºæ­¤æ·»åŠ ä¸€äº›æµ‹è¯•ã€‚</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.iotesters._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatest.{<span class="hljs-type"><span class="hljs-type">FlatSpec</span></span>, <span class="hljs-type"><span class="hljs-type">Matchers</span></span>} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMSpec</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterConstant</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, denum: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, const: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">) </span></span>{ poke(pwm.io.numerator, <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (const) denum <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) poke(pwm.io.denominator, denum) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">2</span></span> * denum) { step(<span class="hljs-number"><span class="hljs-number">1</span></span>) expect(pwm.io.pulse, const) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterExact</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, num: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, ratio: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">) </span></span>{ poke(pwm.io.numerator, num) poke(pwm.io.denominator, num * ratio) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> delay = (<span class="hljs-number"><span class="hljs-number">1</span></span> to ratio + <span class="hljs-number"><span class="hljs-number">2</span></span>).takeWhile { _ =&gt; step(<span class="hljs-number"><span class="hljs-number">1</span></span>) peek(pwm.io.pulse) == <span class="hljs-type"><span class="hljs-type">BigInt</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) } println(<span class="hljs-string"><span class="hljs-string">s"delay = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$delay</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">10</span></span>) { expect(pwm.io.pulse, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to ratio - <span class="hljs-number"><span class="hljs-number">1</span></span>) { step(<span class="hljs-number"><span class="hljs-number">1</span></span>) expect(pwm.io.pulse, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } step(<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterApproximate</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, num: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, denom: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">)</span></span>{ poke(pwm.io.numerator, num) poke(pwm.io.denominator, denom) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> count = (<span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">100</span></span> * denom).map { _ =&gt; step(<span class="hljs-number"><span class="hljs-number">1</span></span>) peek(pwm.io.pulse).toInt }.sum <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> diff = count - <span class="hljs-number"><span class="hljs-number">100</span></span> * num println(<span class="hljs-string"><span class="hljs-string">s"Difference = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$diff</span></span></span><span class="hljs-string">"</span></span>) expect(<span class="hljs-type"><span class="hljs-type">Math</span></span>.abs(diff) &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"Difference should be almost 0"</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlatSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Matchers</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">PWMSpec</span></span>._ behavior of <span class="hljs-string"><span class="hljs-string">"PWMSpec"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWith</span></span></span></span>(testerConstructor: <span class="hljs-type"><span class="hljs-type">PWM</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">PeekPokeTester</span></span>[<span class="hljs-type"><span class="hljs-type">PWM</span></span>]): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { chisel3.iotesters.<span class="hljs-type"><span class="hljs-type">Driver</span></span>(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWM</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>))(testerConstructor) shouldBe <span class="hljs-literal"><span class="hljs-literal">true</span></span> } it should <span class="hljs-string"><span class="hljs-string">"return True constant for 1/1"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return True constant for 10/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return False constant for 1/1"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return False constant for 10/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return True exactly once in 3 steps for 1/3"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterExact</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return good approximation for 3/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterApproximate</span></span>(_, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)) } }</code> </pre> </div></div><br><p>  <code>PeekPokeTester</code>æ˜¯Chiselä¸­çš„ä¸‰ä¸ªæ ‡å‡†æµ‹è¯•å™¨ä¹‹ä¸€ã€‚ å®ƒå…è®¸æ‚¨åœ¨DUTï¼ˆè¢«æµ‹è®¾å¤‡ï¼‰çš„è¾“å…¥ç«¯è®¾ç½®å€¼ï¼Œå¹¶æ£€æŸ¥è¾“å‡ºç«¯çš„å€¼ã€‚ å¦‚æˆ‘ä»¬æ‰€è§ï¼Œé€šå¸¸çš„ScalaTestç”¨äºæµ‹è¯•ï¼Œæµ‹è¯•å ç”¨çš„ç©ºé—´æ˜¯å®ç°æœ¬èº«çš„5å€ï¼Œä»åŸåˆ™ä¸Šè®²ï¼Œè¿™å¯¹äºè½¯ä»¶æ¥è¯´æ˜¯æ­£å¸¸çš„ã€‚ ä½†æ˜¯ï¼Œæˆ‘æ€€ç–‘ç»éªŒä¸°å¯Œçš„â€œé“¸ç¡…â€è®¾å¤‡å¼€å‘äººå‘˜åªä¼šå¯¹å¦‚æ­¤å¾®è§‚çš„æµ‹è¯•å¾®ç¬‘ã€‚ å‘å°„å’Œå“å‘€... </p><br><pre> <code class="hljs powershell">Circuit state created [<span class="hljs-type"><span class="hljs-type">info</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">000</span></span>] SEED <span class="hljs-number"><span class="hljs-number">1529827417539</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">000</span></span>] EXPECT AT <span class="hljs-number"><span class="hljs-number">1</span></span> io_pulse got <span class="hljs-number"><span class="hljs-number">0</span></span> expected <span class="hljs-number"><span class="hljs-number">1</span></span> FAIL ... [<span class="hljs-type"><span class="hljs-type">info</span></span>] PWMSpec: [<span class="hljs-type"><span class="hljs-type">info</span></span>] PWMSpec [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span> *** FAILED *** [<span class="hljs-type"><span class="hljs-type">info</span></span>] false was not equal to true (PWMSpec.scala:<span class="hljs-number"><span class="hljs-number">56</span></span>) [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> False constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> False constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True exactly once <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> steps <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> good approximation <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><p> æ˜¯çš„ï¼Œå°†å…¶å›ºå®šåœ¨PWMçš„<code>io.pulse := nextValue &gt; io.denominator</code>è¡Œä¸­<code>io.pulse := nextValue &gt; io.denominator</code>ç™»å½•<code>&gt;=</code> ï¼Œé‡æ–°å¼€å§‹æµ‹è¯•-ä¸€åˆ‡æ­£å¸¸ï¼ ææ€•ç»éªŒä¸°å¯Œçš„æ•°å­—è®¾å¤‡å¼€å‘äººå‘˜ä¼šä»¥è¿™ç§è½»ç‡çš„è®¾è®¡æ€åº¦æ€æ­»æˆ‘ï¼ˆæœ‰äº›è½¯ä»¶å¼€å‘äººå‘˜ä¼šå¾ˆä¹æ„åŠ å…¥å…¶ä¸­ï¼‰... </p><br><h3 id="generator-impulsov"> è„‰å†²å‘ç”Ÿå™¨ </h3><br><p> æˆ‘ä»¬è¿˜å°†éœ€è¦ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œè¯¥ç”Ÿæˆå™¨å°†ä¸ºâ€œåŠå¸§â€å‘å‡ºåŒæ­¥è„‰å†²ã€‚ ä¸ºä»€ä¹ˆåŠï¼Ÿ å› ä¸ºé¦–å…ˆä¼ è¾“å¥‡æ•°è¡Œï¼Œç„¶åä¼ è¾“å¶æ•°è¡Œï¼ˆå—¯ï¼Œåä¹‹äº¦ç„¶ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¯¹è„‚è‚ªä¸æ„Ÿå…´è¶£ï¼‰ã€‚ </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.util._ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OneShotPulseGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">val lengths: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">], val initial: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Add sentinel value here, so no output flip required after the last state private val delayVecValues = lengths.map(_ - 1) :+ 0 val io = IO(new Bundle { val signal = Output(Bool()) }) private val nextIndex = RegInit(1.asUInt( log2Ceil(delayVecValues.length + 1).W )) private val countdown = RegInit(delayVecValues.head.asUInt( log2Ceil(lengths.max + 1).W )) private val output = RegInit(initial.asBool) private val delaysVec = VecInit(delayVecValues.map(_.asUInt)) private val moveNext = countdown === 0.asUInt private val finished = nextIndex === delayVecValues.length.asUInt when (!finished) { when (moveNext) { countdown := delaysVec(nextIndex) nextIndex := nextIndex + 1.asUInt output := !output }.otherwise { countdown := countdown - 1.asUInt } } io.signal := output }</span></span></code> </pre> <br><p> ç§»é™¤<code>reset</code>ä¿¡å·åï¼Œå®ƒä¼šä»¥çŸ©å½¢è„‰å†²å‘å°„ï¼Œå…¶é•¿åº¦ç”±<code>lengths</code>å‚æ•°æŒ‡å®šï¼Œ <code>lengths</code>åˆ‡æ¢ä¹‹é—´çš„é—´éš”æ—¶é—´<code>lengths</code> ï¼Œæ­¤åå®ƒå°†æ°¸è¿œä¿æŒåœ¨æœ€åçŠ¶æ€ã€‚ æœ¬ç¤ºä¾‹æ¼”ç¤ºäº†ä½¿ç”¨<code>VecInit</code>å€¼è¡¨çš„ä½¿ç”¨ä»¥åŠè·å¾—æ‰€éœ€å¯„å­˜å™¨å®½åº¦çš„æ–¹æ³•ï¼š <code>chisel3.util.log2Ceil(maxVal + 1).W</code> ã€‚ è€å®è¯´ï¼Œæˆ‘ä¸è®°å¾—å®ƒæ˜¯å¦‚ä½•åœ¨Verilogä¸­å®Œæˆçš„ï¼Œä½†æ˜¯åœ¨Chiselä¸­ï¼Œè¦åˆ›å»ºä¸€ä¸ªç”±å€¼å‘é‡å‚æ•°åŒ–çš„æ¨¡å—ï¼Œåªéœ€ç”¨å¿…éœ€çš„å‚æ•°è°ƒç”¨ç±»çš„æ„é€ å‡½æ•°å³å¯ã€‚ </p><br><p> æ‚¨å¯èƒ½ä¼šé—®ï¼šâ€œå¦‚æœ<code>clock</code>å’Œ<code>reset</code>è¾“å…¥æ˜¯éšå¼ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å¦‚ä½•ä¸ºâ€œæ¯ä¸€å¸§çš„è„‰å†²å‘ç”Ÿå™¨â€å……ç”µï¼Ÿ å‡¿å­å¼€å‘äººå‘˜æä¾›äº†ä¸€åˆ‡ï¼š </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> module = <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> moduleWithCustomReset = withReset(customReset) { <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> otherClockDomain = withClock(otherClock) { <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) }</code> </pre> <br><h2 id="naivnaya-realizaciya-generatora-signala"> å¤©çœŸçš„å®ç°ä¿¡å·å‘ç”Ÿå™¨ </h2><br><p> ä¸ºäº†ä½¿ç”µè§†è‡³å°‘èƒ½ä»¥æŸç§æ–¹å¼ç†è§£æˆ‘ä»¬ï¼Œæ‚¨éœ€è¦æ”¯æŒå¹³å‡æŠ€å·§çº§åˆ«çš„â€œåè®®â€ï¼šæœ‰ä¸‰ä¸ªé‡è¦çš„ä¿¡å·çº§åˆ«ï¼š </p><br><ul><li>  1.0V-ç™½è‰² </li><li>  0.3V-é»‘è‰² </li><li>  0V-ç‰¹æ®Šç”µå¹³ </li></ul><br><p> ä¸ºä»€ä¹ˆæˆ‘ç§°0Vä¸ºç‰¹æ®Šç”µå‹ï¼Ÿ å› ä¸ºä»0.3Våˆ°1.0Vå¹³æ»‘è¿‡æ¸¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»é»‘è‰²å¹³æ»‘è¿‡æ¸¡åˆ°ç™½è‰²ï¼Œå¹¶ä¸”åœ¨0Vå’Œ0.3Vä¹‹é—´å¹³æ»‘åˆ‡æ¢ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼Œæ²¡æœ‰ä¸­é—´ç”µå¹³ï¼Œå¹¶ä¸”0Vä»…ç”¨äºåŒæ­¥ã€‚  <em>ï¼ˆå®é™…ä¸Šï¼Œå®ƒç”šè‡³ä¸ä¼šåœ¨0V-1VèŒƒå›´å†…å˜åŒ–ï¼Œè€Œæ˜¯åœ¨-0.3V-0.7VèŒƒå›´å†…å˜åŒ–ï¼Œä½†å¸Œæœ›åœ¨è¾“å…¥ç«¯ä»æœ‰ä¸€ä¸ªç”µå®¹å™¨ï¼‰</em> </p><br><p> æ­£å¦‚è¿™ç¯‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç²¾å½©çš„æ–‡ç« æ‰€</a>æ•™å¯¼çš„é‚£æ ·ï¼Œå¤åˆPALä¿¡å·ç”±625æ¡é‡å¤è¡Œç»„æˆçš„æ— å°½æµç»„æˆï¼šå…¶ä¸­å¤§å¤šæ•°æ˜¯è¡Œï¼Œå®é™…ä¸Šæ˜¯å›¾ç‰‡ï¼ˆåˆ†åˆ«ä¸ºå¶æ•°å’Œå¥‡æ•°ï¼‰ï¼Œæœ‰äº›ç”¨äºåŒæ­¥ç›®çš„ï¼ˆæˆ‘ä»¬ä¸ºå®ƒä»¬åšäº†å‘ç”Ÿå™¨ä¿¡å·ï¼‰ï¼Œæœ‰äº›åœ¨å±å¹•ä¸Šä¸å¯è§ã€‚ å®ƒä»¬çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆæˆ‘ä¸ä¼šç›—ç‰ˆï¼Œå¹¶æä¾›åŸå§‹é“¾æ¥ï¼‰ï¼š </p><br><ul><li>  <a href="">ä¸€æ¡å¸¸è§„å›¾åƒè¡Œ</a> </li><li>  <a href="">åŒæ­¥å­—ç¬¦ä¸²</a> </li></ul><br><p> è®©æˆ‘ä»¬å°è¯•æè¿°æ¨¡å—çš„æ¥å£ï¼š </p><br><p>  <code>BWGenerator</code>å°†ç®¡ç†æ—¶é—´ç­‰ï¼Œå®ƒéœ€è¦çŸ¥é“å…¶å·¥ä½œé¢‘ç‡ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BWGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">L</span></span> = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> inScanLine = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  <code>PalColorCalculator</code>å°†è®¡ç®—äº®åº¦ä¿¡å·ä»¥åŠå…¶ä»–é¢œè‰²ä¿¡å·çš„ç”µå¹³ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PalColorCalculator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scanLine = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">L</span></span> = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-comment"><span class="hljs-comment">//  --  / io.L := (0.asUInt(10.W) + io.red + io.green + io.blue) / 4.asUInt io.millivolts := 0.asUInt }</span></span></code> </pre> <br><p> åœ¨<code>PalGenerator</code>æ¨¡å—ä¸­ï¼Œ <code>PalGenerator</code>åªéœ€<code>PalGenerator</code>ä¸¤ä¸ªæŒ‡å®šçš„æ¨¡å—ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PalGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bw = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">BWGenerator</span></span>(clocksPerUs)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> color = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PalColorCalculator</span></span>) io.red &lt;&gt; color.io.red io.green &lt;&gt; color.io.green io.blue &lt;&gt; color.io.blue bw.io.<span class="hljs-type"><span class="hljs-type">L</span></span> &lt;&gt; color.io.<span class="hljs-type"><span class="hljs-type">L</span></span> bw.io.inScanLine &lt;&gt; color.io.scanLine bw.io.x &lt;&gt; io.x bw.io.y &lt;&gt; io.y io.millivolts := bw.io.millivolts + color.io.millivolts }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">ç°åœ¨æˆ‘ä»¬å¯æ‚²åœ°ç”»äº†ç¬¬ä¸€åªçŒ«å¤´é¹°...</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.github.atrosinenko.fpga.tv <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.core.withReset <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io.github.atrosinenko.fpga.common.<span class="hljs-type"><span class="hljs-type">OneShotPulseGenerator</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BWGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">ScanLineHSyncStartUs</span></span> = <span class="hljs-number"><span class="hljs-number">4.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">ScanLineHSyncEndUs</span></span> = <span class="hljs-number"><span class="hljs-number">12.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">TotalScanLineLengthUs</span></span> = <span class="hljs-number"><span class="hljs-number">64.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">VSyncStart</span></span> = <span class="hljs-type"><span class="hljs-type">Seq</span></span>( <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-comment"><span class="hljs-comment">// 623 / 311 2, 30, 2, 30 // 624 / 312 ) val VSyncEnd = Seq( 30, 2, 30, 2, // 2 / 314 30, 2, 30, 2, // 3 / 315 2, 30, 2, 30, // 4 / 316 2, 30, 2, 30 // 5 / 317 ) val VSync1: Seq[Int] = VSyncStart ++ Seq( 2, 30, 2, 30, // 625 30, 2, 30, 2 // 1 ) ++ VSyncEnd ++ (6 to 23).flatMap(_ =&gt; Seq(4, 60)) val VSync2: Seq[Int] = VSyncStart ++ Seq( 2, 30, 30, 2 // 313 ) ++ VSyncEnd ++ (318 to 335).flatMap(_ =&gt; Seq(4, 60)) val BlackMv = 300.asUInt(12.W) val WhiteMv = 1000.asUInt(12.W) val FirstHalf = (24, 311) val SecondHalf = (336, 623) val TotalScanLineCount = 625 } class BWGenerator(clocksPerUs: Int) extends Module { import BWGenerator._ val io = IO(new Bundle { val L = Input(UInt(8.W)) val x = Output(UInt(10.W)) val y = Output(UInt(10.W)) val inScanLine = Output(Bool()) val millivolts = Output(UInt(12.W)) }) private val scanLineNr = RegInit(0.asUInt(10.W)) private val inScanLineCounter = RegInit(0.asUInt(16.W)) when (inScanLineCounter === (TotalScanLineLengthUs * clocksPerUs - 1).toInt.asUInt) { inScanLineCounter := 0.asUInt when(scanLineNr === (TotalScanLineCount - 1).asUInt) { scanLineNr := 0.asUInt } otherwise { scanLineNr := scanLineNr + 1.asUInt } } otherwise { inScanLineCounter := inScanLineCounter + 1.asUInt } private val fieldIActive = SecondHalf._2.asUInt &lt;= scanLineNr || scanLineNr &lt; FirstHalf._1.asUInt private val fieldIGenerator = withReset(!fieldIActive) { Module(new OneShotPulseGenerator(VSync1.map(_ * clocksPerUs), initial = false)) } private val fieldIIActive = FirstHalf._2.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; SecondHalf._1.asUInt private val fieldIIGenerator = withReset(!fieldIIActive) { Module(new OneShotPulseGenerator(VSync2.map(_ * clocksPerUs), initial = false)) } private val inFirstHalf = FirstHalf ._1.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; FirstHalf ._2.asUInt private val inSecondHalf = SecondHalf._1.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; SecondHalf._2.asUInt io.inScanLine := (inFirstHalf || inSecondHalf) &amp;&amp; ((ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt &lt;= inScanLineCounter) io.x := Mux( io.inScanLine, inScanLineCounter - (ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt, 0.asUInt ) / 4.asUInt io.y := Mux( io.inScanLine, Mux( inFirstHalf, ((scanLineNr - FirstHalf ._1.asUInt) &lt;&lt; 1).asUInt, ((scanLineNr - SecondHalf._1.asUInt) &lt;&lt; 1).asUInt + 1.asUInt ), 0.asUInt ) when (fieldIActive) { io.millivolts := Mux(fieldIGenerator .io.signal, BlackMv, 0.asUInt) }.elsewhen (fieldIIActive) { io.millivolts := Mux(fieldIIGenerator.io.signal, BlackMv, 0.asUInt) }.otherwise { when (inScanLineCounter &lt; (ScanLineHSyncStartUs * clocksPerUs).toInt.asUInt) { io.millivolts := 0.asUInt }.elsewhen (inScanLineCounter &lt; (ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt) { io.millivolts := BlackMv }.otherwise { io.millivolts := (BlackMv + (io.L &lt;&lt; 1).asUInt).asUInt } } }</span></span></code> </pre> </div></div><br><h3 id="generaciya-sinteziruemogo-koda"> ç»¼åˆä»£ç ç”Ÿæˆ </h3><br><p> ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›å°†æœ€ç»ˆçš„è®¾è®¡ç¼åˆ°æ¿ä¸Šã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åˆæˆVerilogã€‚ è¿™æ˜¯é€šè¿‡éå¸¸ç®€å•çš„æ–¹å¼å®Œæˆçš„ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io.github.atrosinenko.fpga.common.<span class="hljs-type"><span class="hljs-type">PWM</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Codegen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestModule</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">mhz: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> imageGenerator = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TestColorImageGenerator</span></span>(<span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">400</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encoder = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PalGenerator</span></span>(clocksPerUs = mhz)) imageGenerator.io.x &lt;&gt; encoder.io.x imageGenerator.io.y &lt;&gt; encoder.io.y imageGenerator.io.red &lt;&gt; encoder.io.red imageGenerator.io.green &lt;&gt; encoder.io.green imageGenerator.io.blue &lt;&gt; encoder.io.blue io.millivolts := encoder.io.millivolts <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">desiredName</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"CompositeSignalGenerator"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>(args: <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { <span class="hljs-type"><span class="hljs-type">Driver</span></span>.execute(args, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWM</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span>)) <span class="hljs-type"><span class="hljs-type">Driver</span></span>.execute(args, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TestModule</span></span>(mhz = <span class="hljs-number"><span class="hljs-number">32</span></span>)) } }</code> </pre><br><p> å®é™…ä¸Šï¼Œåœ¨ä¸¤è¡Œæ–¹æ³•<code>main()</code>æˆ‘ä»¬æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œå…¶ä½™çš„ä»£ç æ˜¯å¦ä¸€ä¸ªç²˜è´´çš„æ¨¡å— </p><br><div class="spoiler">  <b class="spoiler_title">ç»å¯¹æ— èŠçš„æµ‹è¯•å›¾ç‰‡ç”Ÿæˆå™¨</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestColorImageGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, height: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) io.red := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">200.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) io.green := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">200.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) io.blue := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) }</code> </pre> </div></div><br><p> ç°åœ¨ï¼Œæ‚¨éœ€è¦å°†å…¶æ¨é€åˆ°Quartusé¡¹ç›®ä¸­ã€‚ å¯¹äºç«æ˜Ÿæ¢æµ‹å™¨2ï¼Œæˆ‘ä»¬éœ€è¦Quartus 13.1çš„å…è´¹ç‰ˆæœ¬ã€‚ å¦‚ä½•å®‰è£…ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†™</a>åœ¨ç«æ˜Ÿæ¢æµ‹å™¨çš„ç½‘ç«™ä¸Šã€‚ ä»é‚£é‡Œï¼Œæˆ‘ä¸‹è½½äº†ç«æ˜Ÿæ¼«æ¸¸è€…2æ¿çš„â€œç¬¬ä¸€ä¸ªé¡¹ç›®â€ï¼Œå°†å…¶æ”¾å…¥å­˜å‚¨åº“ä¸­ï¼Œå¹¶è¿›è¡Œäº†ä¸€äº›æ›´æ­£ã€‚ ç”±äºæˆ‘ä¸æ˜¯ç”µå­å·¥ç¨‹å¸ˆï¼ˆè€Œä¸”æˆ‘å®é™…ä¸Šå¯¹FPGAä½œä¸ºåŠ é€Ÿå™¨æ¯”å¯¹æ¥å£å¡æ›´æ„Ÿå…´è¶£ï¼‰ï¼Œå› æ­¤ </p><br><div class="spoiler">  <b class="spoiler_title">å°±åƒé‚£ä¸ªç¬‘è¯...</b> <div class="spoiler_text"><p> ç¨‹åºå‘˜åœ¨è°ƒè¯•æ–¹é¢åå¾—å¾ˆæ·±ã€‚ <br> é€‚åˆå„¿å­ï¼š <br>  â€œçˆ¸çˆ¸ï¼Œä¸ºä»€ä¹ˆå¤ªé˜³æ¯å¤©åœ¨ä¸œæ–¹å‡èµ·è€Œåœ¨è¥¿æ–¹è½ä¸‹ï¼Ÿâ€ <br>  â€œä½ æ£€æŸ¥äº†å—ï¼Ÿâ€ <br>  -å·²æ£€æŸ¥ã€‚ <br>  -æ£€æŸ¥å¾—å¥½å—ï¼Ÿ <br>  -å¥½ <br>  -æœ‰æ•ˆå—ï¼Ÿ <br>  -æœ‰æ•ˆã€‚ <br>  -æ¯å¤©éƒ½å¯ä»¥å—ï¼Ÿ <br>  -æ˜¯çš„ï¼Œæ¯å¤©ã€‚ <br>  -é‚£ä¹ˆï¼Œä¸Šå¸å•Šï¼Œå„¿å­ï¼Œä¸è¦è§¦æ‘¸ä»»ä½•ä¸œè¥¿ï¼Œä¸è¦æ”¹å˜ä»»ä½•ä¸œè¥¿ã€‚ </p></div></div><br><p>  ...æˆ‘åªæ˜¯åˆ é™¤äº†VGAä¿¡å·å‘ç”Ÿå™¨å¹¶æ·»åŠ äº†æˆ‘çš„æ¨¡å—ã€‚ </p><br><p><img src="https://habrastorage.org/webt/uq/tu/fx/uqtufxsowkzdbhnd652ezepquva.png" alt="åˆ‡æ¢Quatus"></p><br><p> ä¹‹åï¼Œæˆ‘å°†æ¨¡æ‹Ÿç”µè§†è°ƒè°å™¨è¿æ¥åˆ°å¦ä¸€å°è®¡ç®—æœºï¼ˆç¬”è®°æœ¬ç”µè„‘ï¼‰ï¼Œä»¥ä¾¿ä¿¡å·å‘ç”Ÿå™¨å’Œä½¿ç”¨è€…çš„ç”µæºä¹‹é—´è‡³å°‘å­˜åœ¨ç”µæ°”éš”ç¦»ï¼Œå¹¶ä¸”åªæ˜¯å°†ä¿¡å·ä»æ¿çš„IO7ï¼ˆ+ï¼‰å’ŒGNDï¼ˆ-ï¼‰å¼•è„šå‘é€åˆ°å¤åˆè¾“å…¥ï¼ˆå‡å·ï¼‰ã€‚å¤–éƒ¨è”ç³»äººï¼Œå†åŠ ä¸Šä¸­å¿ƒï¼‰ã€‚ å¥½å§ï¼Œå°±æ˜¯è¯´ï¼Œâ€œç®€å•â€â€¦â€¦è¿™ä»…ä»…æ˜¯å¦‚æœæ‰‹ä»åº”è¯¥åº”è¯¥ä¼¸å‡ºçš„åœ°æ–¹ä¼¸å‡ºï¼Œæˆ–è€…å¦‚æœæˆ‘æœ‰é˜´é˜³è¿æ¥çº¿ã€‚ ä½†æ˜¯æˆ‘åªæœ‰ä¸€å †å…¬æ¯ç”µçº¿ã€‚ ä½†æ˜¯æˆ‘æœ‰åšéŸ§å’Œé’³å­ï¼ é€šå¸¸ï¼Œä¾¿ç§˜åªæœ‰ä¸€ä¸ï¼Œæˆ‘ç¡®å®ä½¿è‡ªå·±æˆä¸ºäº†å‡ ä¹ä¸¤ä¸ªå·¥äººï¼Œè™½ç„¶å¾ˆå›°éš¾ï¼Œä½†æ˜¯å´æ‰§ç€äºè‘£äº‹ä¼šã€‚ è¿™æ˜¯æˆ‘æ‰€çœ‹åˆ°çš„ï¼š </p><br><p><img src="https://habrastorage.org/webt/7a/pi/d-/7apid-1jqyjglndca2aefk2wi2u.png" alt="ç¬¬ä¸€ä¸ªé»‘ç™½å›¾åƒ"></p><br><p> å®é™…ä¸Šï¼Œæˆ‘å½“ç„¶æ¬ºéª—äº†æ‚¨ã€‚ ä¸Šé¢æ˜¾ç¤ºçš„ä»£ç æ˜¯åœ¨â€œåœ¨ç¡¬ä»¶ä¸Šâ€è°ƒè¯•å¤§çº¦ä¸‰ä¸ªå°æ—¶åå¾—åˆ°çš„ï¼Œä½†æ˜¯ï¼Œè¯¥æ­»ï¼Œæˆ‘å†™äº†å®ƒï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸å·¥ä½œï¼ è€Œä¸”ï¼Œè€ƒè™‘åˆ°æˆ‘è¿‡å»å‡ ä¹ä¸ç†Ÿæ‚‰ä¸¥è‚ƒçš„ç”µå­æŠ€æœ¯ï¼Œæˆ‘è®¤ä¸ºè¿™é¡¹ä»»åŠ¡å¹¶ä¸å¯æ€•ï¼Œè¿™æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ </p><br><h2 id="generaciya-cvetnogo-videosignala"> å½©è‰²è§†é¢‘ç”Ÿæˆ </h2><br><p> å¥½å§ï¼Œé‚£ä¹ˆäº‹æƒ…å°±å˜å¾—å¾ˆå°äº†-æ·»åŠ å½©è‰²è§†é¢‘ä¿¡å·å‘ç”Ÿå™¨ã€‚ æˆ‘å­¦ä¹ äº†æœ¬æ•™ç¨‹ï¼Œå¹¶å¼€å§‹å°è¯•å½¢æˆä¸€ä¸ªè‰²åŒæ­¥ä¿¡å·ï¼ˆåœ¨è‰²å½©ä¿¡å·çš„è½½æ³¢é¢‘ç‡ä¸Šæ·»åŠ åˆ°æ­£å¼¦æ³¢çš„é»‘è‰²ç”µå¹³ä¸­ï¼Œè¯¥ä¿¡å·åœ¨HSyncæœŸé—´ä¼šçŸ­æš‚äº§ç”Ÿï¼‰ï¼Œå®é™…ä¸Šæ˜¯æ ¹æ®å…¬å¼æ¥å½¢æˆã€‚ ä½†æ˜¯ï¼Œå³ä½¿æ‚¨ç ´è§£äº†å®ƒä¹Ÿä¸ä¼šå‡ºæ¥...åœ¨æŸä¸ªæ—¶å€™ï¼Œæˆ‘çªç„¶æ„è¯†åˆ°ï¼Œå°½ç®¡é¢‘ç‡å¹¶ä¸èƒ½ä½¿æˆ‘å¿«é€Ÿæµè§ˆæ–‡æ¡£ï¼Œä½†ç”µè§†å´å¾ˆéš¾è°ƒåˆ°ä»»æ„ä¸€å°ã€‚ æœç´¢åï¼Œæˆ‘å‘ç°PALä½¿ç”¨4.43 MHzçš„è½½æ³¢é¢‘ç‡ã€‚ æˆ‘æƒ³è¿™æ˜¯å¸½å­ã€‚  â€œæ“ä½ ï¼Œâ€è°ƒè°å™¨å›ç­”ã€‚ ç»è¿‡ä¸€æ•´å¤©çš„è°ƒè¯•ï¼Œå¹¶ä¸”ä»…ä¸€æ¬¡çœ‹åˆ°å›¾ç‰‡ä¸­çš„å½©è‰²é˜´å½±ï¼ˆæ­¤å¤–ï¼Œå½“æˆ‘å‘Šè¯‰è°ƒè°å™¨å®ƒé€šå¸¸æ˜¯NTSCæ—¶ï¼‰ </p><br><div class="spoiler">  <b class="spoiler_title">...æˆ‘æ„è¯†åˆ°ç»æœ›çš„æ ·å­</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/7a/pi/d-/7apid-1jqyjglndca2aefk2wi2u.png" alt="ç»æœ›"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘è®°å¾—....</a> </p></div></div><br><p> ç„¶åæˆ‘æ„è¯†åˆ°æ²¡æœ‰ç¤ºæ³¢å™¨æ˜¯æˆ‘æ— æ³•åšåˆ°çš„ã€‚ è€Œä¸”ï¼Œæ­£å¦‚æˆ‘å·²ç»è¯´è¿‡çš„ï¼Œæˆ‘å¯¹ç”µå­äº§å“å¹¶ä¸ç†Ÿæ‚‰ï¼Œå½“ç„¶ï¼Œæˆ‘åœ¨å®¶ä¸­æ²¡æœ‰è¿™æ ·çš„æŠ€æœ¯å¥‡è¿¹ã€‚ ä¹°ï¼Ÿ å¯¹äºä¸€ä¸ªå®éªŒæ¥è¯´æœ‰ç‚¹è´µ...ä»è†ç›–ä¸Šå¯ä»¥æ„ç­‘ä»€ä¹ˆå‘¢ï¼Ÿ å°†ä¿¡å·è¿æ¥åˆ°å£°å¡çš„çº¿è·¯è¾“å…¥ï¼Ÿ æ˜¯çš„ï¼Œåªæœ‰4ä¸ªåŠå…†èµ«-ä¸å¤ªå¯èƒ½å¼€å§‹ï¼ˆè‡³å°‘æ²¡æœ‰æ”¹åŠ¨ï¼‰ã€‚ å—¯ï¼Œç«æ˜Ÿæ¼«æ¸¸è€…æœ‰ä¸€ä¸ª20 MHzçš„ADCï¼Œä½†æ˜¯å°†ä¸²è¡Œæ¥å£é€Ÿåº¦çš„åŸå§‹æµä¼ è¾“åˆ°è®¡ç®—æœºè¿˜ä¸å¤Ÿã€‚ å—¯ï¼Œåœ¨æŸä¸ªåœ°æ–¹ï¼Œæ‚¨ä»ç„¶å¿…é¡»å¤„ç†ä¿¡å·ä»¥è¿›è¡Œæ˜¾ç¤ºï¼Œå®é™…ä¸Šä¼šæœ‰ç›¸å½“å¤šçš„ä¿¡æ¯ä½ï¼Œä½†æ˜¯è¿™ä¹Ÿå¼„ä¹±äº†ä¸²è¡Œç«¯å£ï¼Œä¸ºè®¡ç®—æœºç¼–å†™ç¨‹åºâ€¦â€¦ç„¶åï¼Œæˆ‘è®¤ä¸ºå·¥ç¨‹å¸ˆåº”è¯¥å¼€å‘æœ¬èº«å°±å…·æœ‰å¥åº·çš„éŸ§æ€§ï¼šæœ‰ä¸€å°ç©ºé—²çš„å½©è‰²æˆåƒä»ªï¼Œä¸€å°ADCâ€¦â€¦ä½†æ˜¯é»‘ç™½å›¾åƒå´ç¨³å®šåœ°è¾“å‡ºäº†â€¦â€¦å¥½å§ï¼Œè®©ä¿¡å·å‘ç”Ÿå™¨è°ƒè¯•ä¸€ä¸‹ï¼ </p><br><p>  <em>æŠ’æƒ…ç¦»é¢˜ï¼ˆæ­£å¦‚ä»–ä»¬æ‰€è¯´ï¼Œâ€œå­¦ç”Ÿçš„æ„è§ä¸å¿…ä¸è€å¸ˆçš„æ„è§ï¼Œå¸¸è¯†å’ŒPeanoçš„å…¬ç†å­¦ç›¸å»åˆâ€ï¼‰ï¼š</em>å½“æˆ‘å°†è‰²å½©ç”Ÿæˆä¸å„ç§ä¹˜æ³•å’Œå…¶ä»–å¤æ‚äº‹ç‰©ç›¸åŠ æ—¶ï¼ŒFmaxå¯¹äºä¿¡å·è°ƒç†å™¨äº§ç”Ÿäº†å¼ºçƒˆçš„ä¸‹å‚ã€‚ ä»€ä¹ˆæ˜¯Fmaxï¼Ÿ æ®æˆ‘ä»Harrisï¼†Harrisæ•™ç§‘ä¹¦ä¸­äº†è§£åˆ°çš„é‚£æ ·ï¼ŒFPGAçš„CADå€¾å‘äºåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸æŒ‰æ ‡å‡†ç¼–å†™Verilogï¼Œè€Œæ˜¯â€œæŒ‰æ¦‚å¿µâ€ç¼–å†™ï¼šä¾‹å¦‚ï¼Œç»“æœåº”ä¸ºåŒæ­¥ç”µè·¯-ä¸€ç§æ¥è‡ª<em>ç»„åˆé€»è¾‘</em> ï¼ˆåŠ æ³•ï¼Œä¹˜æ³•ï¼‰çš„å®šå‘æ— ç¯ç½‘ç»œï¼Œé™¤æ³•ï¼Œé€»è¾‘è¿ç®—...ï¼‰ï¼Œå…¶è¾“å…¥å’Œè¾“å‡ºåˆ†åˆ«å¡åœ¨è§¦å‘å™¨çš„è¾“å‡ºå’Œè¾“å…¥ä¸Šã€‚ æ—¶é’Ÿä¿¡å·æ²¿ä¸Šçš„è§¦å‘å™¨ä¼šè®°ä½æ•´ä¸ªä¸‹ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸçš„è¾“å…¥å€¼ï¼Œè¯¥ä¿¡å·çš„ç”µå¹³å¿…é¡»åœ¨å‰ç«¯ä¹‹å‰çš„æŸä¸ªæ—¶é—´å’Œä¹‹åçš„æŸä¸ªæ—¶é—´ï¼ˆè¿™ä¸¤ä¸ªæ—¶é—´å¸¸æ•°ï¼‰ä¿æŒç¨³å®šã€‚ ç»§æ—¶é’Ÿä¿¡å·å¼€å§‹è¿è¡Œä¹‹åï¼Œæ¥è‡ªè§¦å‘å™¨è¾“å‡ºçš„ä¿¡å·åˆæµå‘ç»„åˆé€»è¾‘çš„è¾“å‡ºï¼ˆä»¥åŠå…¶ä»–è§¦å‘å™¨çš„è¾“å…¥ã€‚å› æ­¤ï¼Œè¿˜æœ‰å¾®ç”µè·¯çš„è¾“å‡ºï¼‰ï¼Œå®ƒçš„ç‰¹å¾è¿˜åœ¨äºä¸¤ä¸ªé—´éš”ï¼šæ²¡æœ‰è¾“å‡ºçš„æ—¶é—´å°†æœ‰æ—¶é—´å¼€å§‹æ›´æ”¹ï¼Œä¹‹åæ—¶é—´å°†å¹³é™ä¸‹æ¥ï¼ˆå‡è®¾è¾“å…¥å·²æ›´æ”¹ä¸€æ¬¡ï¼‰ã€‚ è¿™æ˜¯ç»„åˆé€»è¾‘ç¡®ä¿æ»¡è¶³è§¦å‘å™¨è¦æ±‚çš„æœ€å¤§é¢‘ç‡-è¿™æ˜¯Fmaxã€‚ å½“ä¸¤ä¸ªæ—¶é’Ÿä¹‹é—´çš„ç”µè·¯æœ‰æ—¶é—´è®¡æ•°æ—¶ï¼ŒFmaxä¼šå‡å°ã€‚ å½“ç„¶ï¼Œæˆ‘å¸Œæœ›é¢‘ç‡æ›´å¤§ï¼Œä½†æ˜¯å¦‚æœå®ƒçªç„¶è·³äº†10æ¬¡ï¼ˆç”šè‡³CADæŠ¥å‘Šä¸­çš„é¢‘åŸŸæ•°é‡å‡å°‘äº†ï¼‰ï¼Œè¯·æ£€æŸ¥ä¸€ä¸‹ï¼Œä¹Ÿè®¸æ‚¨å¼„ä¹±äº†æŸä¸ªåœ°æ–¹ï¼Œç»“æœCADæ‰¾åˆ°äº†ä¸€ä¸ªå¸¸æ•°è¡¨è¾¾å¼å¹¶é«˜å…´åœ°å°†å…¶ç”¨äºä¼˜åŒ–ã€‚ </p><br><h3 id="raskrutka-oscillografa"> ç¤ºæ³¢å™¨ä¿ƒé”€ </h3><br><p> ä¸ï¼Œä¸æ˜¯åœ¨ç¤ºæ³¢å™¨å‡ºç°æ‰­æ›²å’Œå°‘é‡å…¶ä»–é›¶ä»¶ä¹‹åï¼Œä½†æ˜¯ç¤ºæ³¢å™¨è‡ªä¸¾å°±åƒç¼–è¯‘å™¨è‡ªä¸¾ä¸€æ ·ï¼Œä»…é€‚ç”¨äºç¤ºæ³¢å™¨ã€‚ </p><br><p> æˆ‘ä»¬å°†æ ¹æ®å‘½ä»¤åˆ¶ä½œä¸€ä¸ªç¤ºæ³¢å™¨ï¼Œè®°å½•ä¸€äº›è¾“å…¥ä¿¡å·æ ·æœ¬ï¼Œä¹‹åä»…æ˜¾ç¤ºè®°å½•çš„å†…å®¹ã€‚ ç”±äºä»–å°†éœ€è¦ä»¥æŸç§æ–¹å¼å‘å‡ºå‘½ä»¤è¿›è¡Œè®°å½•ï¼Œç„¶å-åœ¨å…¶ä¸­å¯¼èˆªï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸€äº›æŒ‰é’®æ§åˆ¶å™¨-æˆ‘å†™çš„ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œä½†ç›¸å½“åŸå§‹ï¼Œè¿™é‡Œæ˜¯ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleButtonController</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> clickThreshold: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pressThreshold: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, period: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pressedIsHigh: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> buttonInput = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> click = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> longPress = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) })</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">éœ‡æ’¼ï¼</b>  <b class="spoiler_title">æ„Ÿè§‰ï¼</b>  <b class="spoiler_title">è¦ä½¿å…¶å·¥ä½œï¼Œæ‚¨åªéœ€è¦...</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cycleCounter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pressedCounter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) io.click := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> io.longPress := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> when (cycleCounter === <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) { when (pressedCounter &gt;= pressThreshold.asUInt) { io.longPress := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> }.elsewhen (pressedCounter &gt;= clickThreshold.asUInt) { io.click := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } cycleCounter := period.asUInt pressedCounter := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt } otherwise { cycleCounter := cycleCounter - <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt when (io.buttonInput === pressedIsHigh.<span class="hljs-type"><span class="hljs-type">B</span></span>) { pressedCounter := pressedCounter + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt } } }</code> </pre> </div></div><br><p>     : </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Oscilloscope</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, inputWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, windowPixelWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, windowPixelHeight: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> signal = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> visualOffset = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> start = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> output = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem = <span class="hljs-type"><span class="hljs-type">SyncReadMem</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> physicalPixel = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) when (io.start) { physicalPixel := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt } when (physicalPixel &lt; mem.length.asUInt) { mem.write(physicalPixel, io.signal) physicalPixel := physicalPixel + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> shiftedX = io.x + io.visualOffset <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> currentValue = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) currentValue := ((<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; inputWidth) - <span class="hljs-number"><span class="hljs-number">1</span></span>).asUInt - mem.read( <span class="hljs-type"><span class="hljs-type">Mux</span></span>(shiftedX &lt; mem.length.asUInt, shiftedX, (mem.length - <span class="hljs-number"><span class="hljs-number">1</span></span>).asUInt) ) when (io.x &gt; windowPixelWidth.asUInt || io.y &gt; windowPixelHeight.asUInt) { <span class="hljs-comment"><span class="hljs-comment">//  1 -  io.output := !( io.y &gt; (windowPixelHeight + 10).asUInt &amp;&amp; io.y &lt; (windowPixelHeight + 20).asUInt &amp;&amp; (io.x / clocksPerUs.asUInt)(0) ) } otherwise { // , ,  // signal / 2^inputWidth ~ y / windowPixelHeight // signal * windowPixelHeight ~ y * 2^inputWidth io.output := (currentValue * windowPixelHeight.asUInt &gt;= ((io.y - 5.asUInt) &lt;&lt; inputWidth).asUInt) &amp;&amp; (currentValue * windowPixelHeight.asUInt &lt;= ((io.y + 5.asUInt) &lt;&lt; inputWidth).asUInt) } }</span></span></code> </pre> <br><p>   â€” ,   : </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OscilloscopeController</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> visibleWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, createButtonController: (</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleButtonController</span></span></span><span class="hljs-class"> ) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> button1 = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> button2 = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> visibleOffset = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> start = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> leds = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">4.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> controller1 = <span class="hljs-type"><span class="hljs-type">Module</span></span>(createButtonController()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> controller2 = <span class="hljs-type"><span class="hljs-type">Module</span></span>(createButtonController()) controller1.io.buttonInput &lt;&gt; io.button1 controller2.io.buttonInput &lt;&gt; io.button2 <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> offset = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> leds = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">4.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) io.start := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> when (controller1.io.longPress &amp;&amp; controller2.io.longPress) { offset := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt io.start := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> leds := leds + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt }.elsewhen (controller1.io.click) { offset := offset + (visibleWidth / <span class="hljs-number"><span class="hljs-number">10</span></span>).asUInt }.elsewhen (controller2.io.click) { offset := offset - (visibleWidth / <span class="hljs-number"><span class="hljs-number">10</span></span>).asUInt }.elsewhen (controller1.io.longPress) { offset := offset + visibleWidth.asUInt }.elsewhen (controller2.io.longPress) { offset := offset - visibleWidth.asUInt } io.visibleOffset := offset io.leds := leds }</code> </pre> <br><p>            (,   ),      - :           â€” ,    â€”  ,       (   â€”  ).    â€”       ! ,  Verilog  ?.. </p><br><p>     - ,    FPGA: </p><br><p><img src="https://habrastorage.org/webt/fz/bf/ig/fzbfigfaqcfjsuhwmrooccvryze.png" alt="ä»ä¿¡å·é©±åŠ¨å™¨---ç«‹å³åˆ°å›¾è¡¨"></p><br><p>   â€”  (      IO7,   VGA_GREEN  R-2R )        : </p><br><p><img src="https://habrastorage.org/webt/71/uy/x-/71uyx-fz7rf4c9kp2yw2pwxbed4.png" alt="ä»¥æ¨¡æ‹Ÿæ–¹å¼ï¼Œç„¶ååœ¨â€œæ•°å­—â€ä¸­ï¼Œç„¶ååœ¨å›¾å½¢ä¸Š-"></p><br><p>    ,  â€”   ,  ,     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   PAL</a> â€” "Picture At Last (-, !)" </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  GitHub</a> . </p><br><h2 id="vyvody"> ç»“è®º </h2><br><p> Scala + Chisel       â€”    ,        Higher-kinded types.     Scala- ,   Chisel  ,       .             .   â€” ! </p><br><p>   : "   -?" â€”   ! <em>  ...</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN414995/">https://habr.com/ru/post/zh-CN414995/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN414981/index.html">ä¸æˆæ–‡çš„å›¾ä¹¦é¦†</a></li>
<li><a href="../zh-CN414983/index.html">è‰¾ä¼¦Â·å‡¯ï¼ˆAlan Kayï¼‰ï¼šæ–½ä¹PARCçš„ä¸ä¼—ä¸åŒä¹‹å¤„ä»¥åŠä»Šå¤©ä»ç„¶åƒä»–ä»¬ä¸€æ ·</a></li>
<li><a href="../zh-CN414989/index.html">å›½é™…ç©ºé—´ç«™å‘å°„çš„ç©ºé—´ç¢ç‰‡å«æ˜Ÿ</a></li>
<li><a href="../zh-CN414991/index.html">ä½¿ç”¨find_object_2dåŒ…ä»ROSä¸­çš„ç›¸æœºæ£€æµ‹å’Œè¯†åˆ«å¯¹è±¡</a></li>
<li><a href="../zh-CN414993/index.html">é‰´å®šå’Œåˆ†ç±»æœ‰æ¯’è¯„è®ºã€‚ Yandexè®²åº§</a></li>
<li><a href="../zh-CN414997/index.html">ML-Blitzï¼šç¬¬ä¸€è½®èµ„æ ¼èµ›çš„ä»»åŠ¡åˆ†æ</a></li>
<li><a href="../zh-CN414999/index.html">3D Watchmanå’Œçƒ­æ•ç”µé˜»æµ‹è¯•ä»ª</a></li>
<li><a href="../zh-CN415001/index.html">æ’å€’éª‘è½¦äººçš„Uberæœºå™¨äººè½¦çš„æ“ä½œå‘˜åœ¨æ’è½¦æ—¶è§‚çœ‹äº†è¯­éŸ³èŠ‚ç›®</a></li>
<li><a href="../zh-CN415003/index.html">åœ¨Apple.comä¸Šä¸å—é™åˆ¶åœ°ä¸Šä¼ æ–‡ä»¶</a></li>
<li><a href="../zh-CN415005/index.html">å¤ªé˜³èƒ½ç”µæ± æ¿ï¼Œè¯­éŸ³å‘½ä»¤å’Œè¶Šé‡èµ›è½¦ï¼šç”µåŠ¨è‡ªè¡Œè½¦çš„ç°åœ¨å’Œæœªæ¥</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>