<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤰🏽 👧🏾 🤶🏻 GraalVM可以做的十件事 👩🏼‍💻 ⚜️ 🐍</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="译者的话：GraalVM是一项有趣的新技术，但是在Habré上，没有多少文章可以展示Graal功能的示例。 下面的文章不仅列出了GraalVM的功能，而且还类似于Chris Seaton和Oleg Shelaev在Oracle CodeOne 2018上进行的小型大师班。在作者之后，我敦促您尝试从本...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GraalVM可以做的十件事</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/433432/"><p><img src="https://habrastorage.org/webt/7z/5d/ap/7z5dap05rvptsue50u6ajtsxsmw.png"><br>  <em>译者的话：GraalVM是一项有趣的新技术，但是在Habré上，没有多少文章可以展示Graal功能的示例。</em>  <em>下面的文章不仅列出了GraalVM的功能，而且还类似于Chris Seaton和Oleg Shelaev在Oracle CodeOne 2018上进行的小型大师班。在作者之后，我敦促您尝试从本文中举例说明，有趣。</em> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GraalVM中有</a>很多不同的事情，如果您以前听过这个名字，甚至看到过报告，您可能仍然不知道很多事情，但是GraalVM可以做什么。 在本文中，我们将介绍GraalVM提供的各种功能，并展示您可以使用它们做什么。 </p><br><ol><li>  Java快速执行 </li><li> 减少Java的启动时间和内存使用量 </li><li> 结合JavaScript，Java，Ruby和R </li><li> 执行以平台特定语言编写的程序 </li><li> 所有编程语言的通用工具 </li><li>  JVM应用程序补充 </li><li> 平台相关的应用 </li><li>  Java代码作为特定于平台的库 </li><li> 支持数据库中的多种编程语言 </li><li> 为GraalVM创建编程语言 </li></ol><a name="habracut"></a><br><p> 您可以使用GraalVM 1.0.0 RC1完成本文中显示的所有操作，可通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GraalVM网站</a>上的链接<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">获得该功能</a> 。 我使用了MacOS Enterprise Edition，但此处编写的代码将在Linux和GraalVM Community Edition上运行。 </p><br><p> 阅读本文时，请运行其中描述的程序！ 可以从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub</a>下载代码。 </p><br><h2 id="ustanovka"> 安装方式 </h2><br><p>从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://graalvm.org/downloads</a>下载后<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">，</a>我在<code>$PATH</code>添加了GraalVM可执行文件的<code>$PATH</code> 。 默认情况下，这增加了对Java和JavaScript执行的支持。 </p><br><pre> <code class="plaintext hljs">$ git clone https://github.com/chrisseaton/graalvm-ten-things.git $ cd foo $ tar -zxf graalvm-ee-1.0.0-rc1-macos-amd64.tar.gz # or graalvm-ee-1.0.0-rc1-linux-amd64.tar.gz on Linux $ export PATH=graalvm-1.0.0-rc1/Contents/Home/bin:$PATH # or PATH=graalvm-1.0.0-rc1/bin:$PATH on Linux</code> </pre> <br><p>  GraalVM带有内置的JavaScript支持，并包含一个名为<code>gu</code>的软件包管理器，该软件包管理器增加了安装对Java和JavaScript以外的语言的支持的功能。 我还安装了Ruby，Python和R，它们是从GitHub下载的。 </p><br><pre> <code class="plaintext hljs">$ gu install -c org.graalvm.ruby $ gu install -c org.graalvm.python $ gu install -c org.graalvm.R</code> </pre> <br><p> 现在，如果执行<code>java</code>或<code>js</code>命令，您将看到这些引擎的GraalVM版本。 </p><br><pre> <code class="plaintext hljs">$ java -version java version "1.8.0_161" Java(TM) SE Runtime Environment (build 1.8.0_161-b12) GraalVM 1.0.0-rc1 (build 25.71-b01-internal-jvmci-0.42, mixed mode) $ js --version Graal JavaScript 1.0 (GraalVM 1.0.0-rc1)</code> </pre> <br><h2 id="1-bystroe-vypolnenie-java">  1.快速执行Java </h2><br><p>  GraalVM中的“ Graal”是编译器的名称。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">他一个人被创造来统治一切</a> ！ 这意味着这是一个以库的形式编写的编译器实现，可以用于许多不同的事情。 例如，我们使用Graal <em>提前</em>编译和<em>及时</em>编译，以编译用不同编程语言（包括用于不同处理器体系结构）编写的代码。 </p><br><p> 使用Graal的第一种也是最简单的方法是将其用作Java JIT编译器。 </p><br><p> 例如，我们将使用一个程序，该程序在文档中产生10个最常见的单词。 该程序使用了现代Java语言的功能，例如流和集合。 </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.file.Files; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.file.Paths; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Function; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Collectors; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Stream; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Arrays.stream(args) .flatMap(TopTen::fileLines) .flatMap(line -&gt; Arrays.stream(line.split(<span class="hljs-string"><span class="hljs-string">"\\b"</span></span>))) .map(word -&gt; word.replaceAll(<span class="hljs-string"><span class="hljs-string">"[^a-zA-Z]"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) .filter(word -&gt; word.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) .map(word -&gt; word.toLowerCase()) .collect(Collectors.groupingBy(Function.identity(), Collectors.counting())) .entrySet().stream() .sorted((a, b) -&gt; -a.getValue().compareTo(b.getValue())) .limit(<span class="hljs-number"><span class="hljs-number">10</span></span>) .forEach(e -&gt; System.out.format(<span class="hljs-string"><span class="hljs-string">"%s = %d%n"</span></span>, e.getKey(), e.getValue())); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Stream&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String path)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Files.lines(Paths.get(path)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(e); } } }</code> </pre> <br><p>  GraalVM包含<code>javac</code>编译器，但是此演示无论使用它还是使用标准编译器都没有区别。 因此，您可以根据需要使用标准的<code>javac</code>编译器。 </p><br><pre> <code class="plaintext hljs">$ javac TopTen.java</code> </pre> <br><p> 如果我们运行GraalVM中包含的<code>java</code>命令，那么Grait JIT编译器将自动使用-无需其他步骤。 我将使用<code>time</code>命令来获取有关从头到尾执行程序所花费时间的真实数据，而不是部署复杂的微基准测试。 也将使用大量输入，因此不会在这里或那里暗示所节省的几秒钟。  <code>large.txt</code>文件的大小为150 MB。 </p><br><pre> <code class="plaintext hljs">$ make large.txt $ time java TopTen large.txt sed = 502701 ut = 392657 in = 377651 et = 352641 id = 317627 eu = 317627 eget = 302621 vel = 300120 a = 287615 sit = 282613 real 0m17.367s user 0m32.355s sys 0m1.456s</code> </pre> <br><p> 像大多数其他Java的JIT编译器一样，Graal用Java而不是C ++编写。 我们认为，这使我们能够比现有的编译器更快地对其进行改进，并添加了针对HotSpot的标准JIT编译器中不提供的新的强大优化（例如，部分转义分析）。 <br> 这可以使您的Java程序更快。 </p><br><p> 为了进行比较，要在没有Grait JIT编译器的情况下运行程序，我将使用<code>-XX:-UseJVMCICompiler</code> 。  JVMCI是Graal和JVM之间的接口。 您还可以在标准JVM上运行该示例并比较结果。 </p><br><pre> <code class="plaintext hljs">$ time java -XX:-UseJVMCICompiler TopTen large.txt sed = 502701 ut = 392657 in = 377651 et = 352641 id = 317627 eu = 317627 eget = 302621 vel = 300120 a = 287615 sit = 282613 real 0m23.511s user 0m24.293s sys 0m0.579s</code> </pre> <br><p> 该测试表明，Graal使用标准的HotSpot编译器运行Java程序的时间大约为四分之三。 我们认为以百分比为单位提高生产力是一项重大成就，而25％的意义重大。 </p><br><p>  Twitter是当今唯一一家<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在“战斗”服务器上使用Graal的</a>公司，并且他们说，这样做对节省资金是有道理的。  Twitter使用Graal执行用Scala编写的应用程序-Graal在JVM字节码级别上工作，即 适用于任何JVM语言。 </p><br><p> 这是GraalVM的第一个用例-只需用现有Java应用程序的更好版本替换JIT编译器。 </p><br><h2 id="2-umenshenie-vremeni-starta-i-potrebleniya-pamyati-dlya-java">  2.减少Java的启动时间和内存使用量 </h2><br><p> 当使用长时间运行的进程和峰值负载时，Java平台的优势尤其明显。 相比之下，寿命短的进程则需要较长的启动时间和相对较高的内存使用量。 </p><br><p> 例如，如果我们运行上一节中的应用程序，向它提供少量的输入数据-大约1Kb而不是150MB，那么为了处理这么小的文件，似乎将花费不合理的时间和大量的内存-大约60MB。 。 除了执行时间以外，我们还使用<code>-l</code>选项来打印已使用的内存量。 </p><br><pre> <code class="plaintext hljs">$ make small.txt $ /usr/bin/time -l java TopTen small.txt # -v on Linux instead of -l sed = 6 sit = 6 amet = 6 mauris = 3 volutpat = 3 vitae = 3 dolor = 3 libero = 3 tempor = 2 suscipit = 2 0.32 real 0.49 user 0.05 sys 59846656 maximum resident set size</code> </pre> <br><p>  GraalVM为我们提供了解决此问题的工具。 我们说过Graal是一个编译器库，可以用许多不同的方式使用。 其中之一是<em>提前</em>编译为<em>依赖</em>于平台的可执行映像，而不是在运行时即时编译。 这类似于常规编译器（例如<code>gcc</code> 。 </p><br><pre> <code class="plaintext hljs">$ native-image --no-server TopTen classlist: 1,513.82 ms (cap): 2,333.95 ms setup: 3,584.09 ms (typeflow): 4,642.13 ms (objects): 3,073.58 ms (features): 156.34 ms analysis: 8,059.94 ms universe: 353.02 ms (parse): 1,277.02 ms (inline): 1,412.08 ms (compile): 10,337.76 ms compile: 13,776.23 ms image: 2,526.63 ms write: 1,525.03 ms [total]: 31,439.47 ms</code> </pre> <br><p> 此命令创建一个平台<code>topten</code>称为<code>topten</code> 。 该文件不会启动JVM，它没有链接到JVM，并且它不以任何方式包括JVM。  <code>native-image</code>命令可将您的Java代码和您使用的Java库真正编译为完整的机器代码。 对于运行时组件（例如垃圾收集器），我们启动了自己的新虚拟机，称为SubstrateVM，与Graal一样，它也是用Java编写的。 </p><br><p> 如果查看<code>topten</code>使用的依赖项，您将看到它们只是标准系统库。 我们只能将这一个文件传输到从未安装过JVM的系统中，然后在该系统中运行该文件以确认它不使用JVM或任何其他文件。  <code>Topten</code>也非常小-可执行代码占用的<code>Topten</code>不到6 MB。 </p><br><pre> <code class="plaintext hljs">$ otool -L topten # ldd topten on Linux topten: .../CoreFoundation.framework ... .../libz.1.dylib ... .../libSystem.B.dylib ... $ du -h topten 5.7M topten</code> </pre> <br><p> 如果运行此可执行文件，我们将看到它的启动速度比在JVM下运行的同一程序快大约一个数量级，并且使用的内存少大约一个数量级。 发射是如此之快，您几乎不会注意到它花了多长时间。 如果使用命令行，当您在JVM下运行一个短暂的小型程序时，通常不会出现暂停现象 </p><br><pre> <code class="plaintext hljs">$ /usr/bin/time -l ./topten small.txt sed = 6 sit = 6 amet = 6 mauris = 3 volutpat = 3 vitae = 3 dolor = 3 libero = 3 tempor = 2 suscipit = 2 0.02 real 0.00 user 0.00 sys 4702208 maximum resident set size</code> </pre> <br><p> 本<code>native-image</code>实用程序有一些<a href="">限制</a> 。 因此，在编译时，应该提供所有类，并且在使用Reflection API方面也有一些限制。 但是，与基本编译相比，还有其他一些优点，例如在编译时执行静态初始化程序。 因此，减少了每次下载应用程序时执行的工作量。 </p><br><p> 这是GraalVM的第二个应用程序-现有Java程序的分发和执行，具有快速启动和较少的内存消耗的功能。 此方法修复了配置问题，例如在运行时找到正确的jar，还允许您创建较小的docker映像。 </p><br><h2 id="3-kombinirovanie-javascript-java-ruby-i-r">  3.结合JavaScript，Java，Ruby和R </h2><br><p> 与Java一起，GraalVM包括JavaScript，Ruby，R和Python引擎的新实现。 它们是使用称为<em>Truffle</em>的新框架编写的。 该框架使创建简单而高性能的语言解释器成为可能。 当您使用Truffle编写语言解释器时，它将自动使用Graal为您的语言提供JIT编译。 因此，Graal不仅是Java的JIT编译器和AOT编译器，而且还可以是JavaScript，Ruby，R和Python的JIT编译器。 </p><br><p>  GraalVM中对第三方语言的支持旨在透明替代现有引擎，以执行各种语言。 例如，我们可以为Node.js安装“颜色”模块： </p><br><pre> <code class="plaintext hljs">$ npm install --global color ... + color@3.0.0 added 6 packages in 14.156s</code> </pre> <br><p> 然后使用该模块编写一个程序，将RGB HTML颜色转换为HSL： </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Color = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'color'</span></span>); process.argv.slice(<span class="hljs-number"><span class="hljs-number">2</span></span>).forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">) </span></span>{ print(Color(val).hsl().string()); });</code> </pre> <br><p> 并以通常的方式运行它： </p><br><pre> <code class="plaintext hljs">$ node color.js '#42aaf4' hsl(204.89999999999998, 89%, 60.8%)</code> </pre> <br><p>  GraalVM中不同语言的执行引擎可以协同工作-有一个API，使您可以在用另一种语言编写的程序中从一种语言运行代码。 这样，您就可以编写多语言程序-用一种以上的编程语言编写的程序。 </p><br><p> 如果您使用一种语言编写大多数程序，但是想使用以另一种编程语言编写的库，则可能有必要。 例如，假设我们需要编写一个应用程序来将颜色名称从CSS转换为Node.js中的数字表示形式，但是我们想使用Ruby颜色库而不是自己编写转换。 </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = express(); color_rgb = Polyglot.eval(<span class="hljs-string"><span class="hljs-string">'ruby'</span></span>, <span class="hljs-string"><span class="hljs-string">` require 'color' Color::RGB `</span></span>); app.get(<span class="hljs-string"><span class="hljs-string">'/css/:name'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ color = color_rgb.by_name(req.params.name).html() res.send(<span class="hljs-string"><span class="hljs-string">'&lt;h1 style="color: '</span></span> + color + <span class="hljs-string"><span class="hljs-string">'" &gt;'</span></span> + color + <span class="hljs-string"><span class="hljs-string">'&lt;/h1&gt;'</span></span>); }); app.listen(<span class="hljs-number"><span class="hljs-number">8080</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'serving at http://localhost:8080'</span></span>) });</code> </pre> <br><p> 在这段代码中，我们写道我们需要将Ruby代码作为字符串执行，但是请注意，我们在这里并没有做太多事情-我们只是连接了库，然后返回了Ruby对象。 在Ruby中，我们将这样使用它： <code>Color::RGB.by_name (name).html</code> 。 如果您稍后查看如何在JavaScript中使用<code>color_rgb</code> ，您将看到我们实际上从JavaScript调用了相同的方法，尽管它们是Ruby对象和方法。 然后将它们作为JavaScript字符串传递，并将结果（一个Ruby字符串）与一个JavaScript字符串组合在一起。 </p><br><p> 安装两个依赖项-Ruby和JavaScript。 </p><br><pre> <code class="plaintext hljs">$ gem install color Fetching: color-1.8.gem (100%) Successfully installed color-1.8 1 gem installed $ npm install express + express@4.16.2 updated 1 package in 10.393s</code> </pre> <br><p> 然后，您需要使用两个附加选项来启动<code>node</code> ：-- <code>--polyglot</code> ，也就是说我们需要访问其他语言和<code>--jvm</code> ，因为默认情况下， <code>node</code>的可执行映像不包含JavaScript以外的任何内容。 </p><br><pre> <code class="plaintext hljs">$ node --polyglot --jvm color-server.js serving at http://localhost:8080</code> </pre> <br><p> 然后，像往常一样，在浏览器中转到URL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http：//本地主机：8080 / css / orange</a> （或其他颜色）。 <br><img src="https://habrastorage.org/webt/_h/uz/e2/_huze29ugzgpz8ecll22rpv6s1w.png"><br> 让我们尝试做一个更严肃的例子，它使用更多的语言和模块。 </p><br><p>  JavaScript不支持非常大的整数。 我发现了几个模块，例如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">big-integer</a> ，但是它们都效率不高，因为 将数字的组成部分存储为JavaScript浮点数。  Java中的<code>BigInteger</code>类效率更高，让我们使用它对大整数进行一些算术运算。 </p><br><p>  JavaScript也没有内置的图形绘制支持，而R可以出色地绘制图形。 让我们使用R中的<code>svg</code>模块在3D空间中绘制三角函数的散点图。 </p><br><p> 在这两种情况下，我们都将使用该API支持GraalVM的多种语言（以下称为Polyglot API），并且我们可以简单地将其他语言的程序执行结果插入JavaScript。 </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BigInteger = Java.type(<span class="hljs-string"><span class="hljs-string">'java.math.BigInteger'</span></span>) app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = <span class="hljs-string"><span class="hljs-string">'Hello World from Graal.js!&lt;br&gt; '</span></span> <span class="hljs-comment"><span class="hljs-comment">// Using Java standard library classes text += BigInteger.valueOf(10).pow(100) .add(BigInteger.valueOf(43)).toString() + '&lt;br&gt;' // Using R interoperability to create graphs text += Polyglot.eval('R', `svg(); require(lattice); x &lt;- 1:100 y &lt;- sin(x/10) z &lt;- cos(x^1.3/(runif(1)*5+10)) print(cloud(x~y*z, main="cloud plot")) grDevices:::svg.off() `); res.send(text) }) app.listen(3000, function () { console.log('Example app listening on port 3000!') })</span></span></code> </pre> <br><p> 在浏览器中打开<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http：// localhost：3000 /</a>以查看结果： <br><img src="https://habrastorage.org/webt/1o/so/fj/1osofjuimjcfd7pv1qhcikonupo.png"><br> 这是我们使用GraalVM可以做的第三件事-运行以多种语言编写的程序，并在一个程序中一起使用这些语言的模块。 我们将其作为统一运行时环境和库的一种方式-您可以使用认为最适合解决当前任务的编程语言以及所需的任何库，而无需考虑使用哪种编程语言。 </p><br><h2 id="4-ispolnenie-programm-napisannyh-na-platformo-zavisimyh-yazykah">  4.以平台特定语言编写的程序的执行 </h2><br><p>  GraalVM支持的另一种语言是C。GraalVM可以执行C代码，就像执行以JavaScript和Ruby编写的程序一样。 </p><br><p>  GraalVM实际支持的是执行LLVM实用程序所产生的代码，即 位代码，而不是直接支持C。这意味着您可以使用现有的C语言工具以及其他支持LLVM的工具，例如C ++，Fortran以及将来可能使用的更多语言。 为了简化演示，我运行了一个特殊版本的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">gzip</a> ，该版本在一个文件中组装（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Stephen McCamant</a>支持该版本）。 为了简单起见，这只是<code>gzip</code>源代码和<code>autoconf</code>配置组合到一个文件中。 我必须修补一些东西才能使其在macOS和clang上运行，但是我没有做任何专门支持GraalVM的事情。 </p><br><p> 我们使用标准的<code>clang</code> （用于C的LLVM编译器）编译gzip，并希望它使我们成为LLVM位代码，而不是特定于平台的版本，因为GraalVM不会启动它。 我正在使用<code>clang</code> 4.0.1。 </p><br><pre> <code class="plaintext hljs">$ clang -c -emit-llvm gzip.c</code> </pre> <br><p> 然后直接使用GraalVM的lli命令（LLVM位代码解释器）运行结果。 让我们尝试使用我的gzip系统存档程序压缩文件，然后使用在GraalVM下运行的gzip解压缩文件。 </p><br><pre> <code class="plaintext hljs">$ cat small.txt Lorem ipsum dolor sit amet... $ gzip small.txt $ lli gzip.bc -d small.txt.gz $ cat small.txt Lorem ipsum dolor sit amet...</code> </pre> <br><p>  GraalVM中的Ruby和Python实现使用相同的技术来运行用C语言编写的针对这些语言的扩展。 这意味着您可以在VM内运行这些扩展，即使我们使用了特定于平台的扩展接口，也可以使我们保持较高的执行速度。 </p><br><p> 这是使用GraalVM的第四种方法-运行以特定于平台的语言（例如C或C ++）编写的程序，以及启动对诸如Python或Ruby之类的语言的扩展，这些扩展无法使这些语言的JVM实现成为可能，例如JRuby。 </p><br><h2 id="5-obschie-instrumenty-dlya-vseh-yazykov-programmirovaniya">  5.适用于所有编程语言的通用工具 </h2><br><p> 如果您使用Java编程，则可能使用的是非常高质量的工具，例如IDE，调试器和分析器。 并非所有语言都具有此工具包，但是如果您使用GraalVM支持的语言，则可以获得一个工具包。 </p><br><p> 使用通用框架-Truffle实现了对GraalVM中所有语言（目前不包括Java）的支持。 这样，我们便可以一次创建该功能（例如调试器），并将其用于所有语言。 </p><br><p> 为此，我们将编写最简单的程序<em>FizzBu​​zz</em> ，因为它是可视的（在屏幕上打印出一些东西），并且具有清晰的分支，仅在某些迭代中使用。 因此，对我们来说设置断点将更加容易。 让我们从JavaScript实现开始。 </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fizzbuzz</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((n % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; (n % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'FizzBuzz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Fizz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Buzz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-number"><span class="hljs-number">1</span></span>; n &lt;= <span class="hljs-number"><span class="hljs-number">20</span></span>; n++) { print(fizzbuzz(n)); }</code> </pre> <br><p> 我们使用GraalVM下的<code>js</code>实用程序照常启动程序。 </p><br><pre> <code class="plaintext hljs">$ js fizzbuzz.js 1 2 Fizz 4 Buzz Fizz</code> </pre> <br><p> 我们还可以使用<code>--inspect</code>标志运行该程序。 这将为我们提供一个链接，您可以在Chrome中打开该链接并在调试器中停止该程序。 </p><br><pre> <code class="plaintext hljs">$ js --inspect fizzbuzz.js Debugger listening on port 9229. To start debugging, open the following URL in Chrome: chrome-devtools://devtools/bundled/inspector.html?ws=127.0.0.1:9229/6c478d4e-1350b196b409</code> </pre> <br><p> 您可以在<em>FizzBu​​zz</em>代码中设置一个断点，然后继续执行。 当程序中断执行时，我们将在调试器中看到变量<code>n</code>的值，我们可以继续执行程序或研究调试器接口。 <br><img src="https://habrastorage.org/webt/kn/nq/so/knnqsotzl0j-k8e4y83a1ziz97w.png"><br>  Chrome中的调试器通常用于JavaScript，但JavaScript中的GraalVM与其他语言没有什么不同。  <code>--inspect</code>标志也可用，并且可以在Python，Ruby和R实现中使用。我不会向您展示每个程序的源代码，但是它们以相同的方式运行，并且您在Chrome中为每个程序都使用了相同的调试器。 </p><br><pre> <code class="plaintext hljs">$ graalpython --jvm --inspect fizzbuzz.py</code> </pre> <br><p><img src="https://habrastorage.org/webt/6t/fx/2m/6tfx2m4btthox9mxxkweqehwjgm.png"></p><br><pre> <code class="plaintext hljs">$ ruby --inspect fizzbuzz.rb</code> </pre> <br><p><img src="https://habrastorage.org/webt/2z/_z/ti/2z_ztia4yk9fqomzo_vxj9c7mb0.png"></p><br><pre> <code class="plaintext hljs">$ Rscript --inspect fizzbuzz.r</code> </pre> <br><p><img src="https://habrastorage.org/webt/rg/12/wn/rg12wnspfc176rtrz7uww4qymo0.png"><br> 您可能从Java熟悉的另一个工具是VisualVM。 它提供了一个用户界面，通过该用户界面，您可以在本地计算机上或通过网络加入正在运行的JVM，以检查程序执行的各个方面，例如内存使用或线程执行。 </p><br><p>  GraalVM包括VisualVM作为标准的<code>jvisualvm</code>实用程序。 </p><br><pre> <code class="plaintext hljs">$ jvisualvm &amp;&gt; /dev/null &amp;</code> </pre> <br><p> 如果在<code>TopTen</code> Java程序运行时运行VisualVM，则可以观察内存使用情况，例如，对内存内容进行快照，并查看我们在堆上使用内存的对象类型。 </p><br><pre> <code class="plaintext hljs">$ java TopTen large.txt</code> </pre> <br><p><img src="https://habrastorage.org/webt/gd/-5/ld/gd-5ldwlrn3y9szdaoqrmd_7res.png"><br> 我用Ruby编写了此程序，以便在运行时在内存中生成一些垃圾。 </p><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'erb'</span></span> x = <span class="hljs-number"><span class="hljs-number">42</span></span> template = ERB.new &lt;&lt;-EOF The value of x <span class="hljs-symbol"><span class="hljs-symbol">is:</span></span> &lt;%= x %&gt; EOF loop <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> puts template.result(binding) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p> 如果您在JVM-JRuby上运行标准Ruby实现，您将对VisualVM感到失望，因为您只会看到内部Java对象，而不是您所用语言的对象。 </p><br><p> 如果使用Ruby for GraalVM版本，则VisualVM可以识别Ruby对象。 我们需要使用<code>--jvm</code>选项来使用VisualVM，因为 它不支持Ruby的本机版本。 </p><br><pre> <code class="plaintext hljs">$ ruby --jvm render.rb</code> </pre> <br><p> ,  ,       Java ,    , ,   Summary,   Ruby Heap       Ruby . <br><img src="https://habrastorage.org/webt/ge/d4/xc/ged4xcxp5ylkaxjxyxd5b8v3kyo.png"><br>  Truffle —  -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Nexus</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a> .         Truffle      ,  ,   API Truffle'  ,         ,   Truffle,         . </p><br><p> ,   GraalVM —         ,       .   Truffle  GraalVM      ,       VisualVM. </p><br><h2 id="6-dopolnenie-jvm-prilozheniy"> 6.  JVM  </h2><br><p>   ,   ,   ,        Java .  API   <code>org.graalvm.polyglot</code>      ,         . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.polyglot.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.polyglot.Value; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtendJava</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ String language = <span class="hljs-string"><span class="hljs-string">"js"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (Context context = Context.newBuilder().allowNativeAccess(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>).build()) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String arg: args) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg.startsWith(<span class="hljs-string"><span class="hljs-string">"-"</span></span>)) { language = arg.substring(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Value v = context.eval(language, arg); System.out.println(v); } } } } }</code> </pre> <br><p>    <code>javac</code>  <code>java</code>   GraalVM,   <code>org.graalvm.*</code>     <code>classpath</code> , ..          . </p><br><pre> <code class="plaintext hljs">$ javac ExtendJava.java $ java ExtendJava '14 + 2' 16 $ java ExtendJava -js 'Math.sqrt(14)' 3.7416573867739413 $ java ExtendJava -python '[2**n for n in range(0, 8)]' [1, 2, 4, 8, 16, 32, 64, 128] $ java ExtendJava -ruby '[4, 2, 3].sort' [2, 3, 4]</code> </pre> <br><p> ,        —     ,      <code>node</code>  <code>ruby</code> ,  GraalVM. </p><br><p>     GraalVM —             Java . Polyglot API     “”      Java ,       . </p><br><h2 id="7-dopolnenie-platformo-zavisimyh-prilozheniy"> 7.  -  </h2><br><p>  GraalVM    ,  ,    —  ,        ,  GraalVM,  - . ,  JavaScript ,  V8,  Python — CPython     , ..          . GraalVM           —      Polyglot . </p><br><p>    GraalVM,       ,         JavaScript.    Polyglot ,    ,  : </p><br><pre> <code class="plaintext hljs">$ graalvm-1.0.0-rc1/Contents/Home/jre/lib/svm/bin/rebuild-images libpolyglot</code> </pre> <br><p>     C,   ,    ,  GraalVM,     .       <code>ExtendJava</code>   ,    ,   . </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;polyglot_api.h&gt; int main(int argc, char **argv) { graal_isolate_t *isolate = NULL; graal_isolatethread_t *thread = NULL; if (graal_create_isolate(NULL, &amp;isolate) != 0 || (thread = graal_current_thread(isolate)) == NULL) { fprintf(stderr, "initialization error\n"); return 1; } poly_context context = NULL; if (poly_create_context(thread, NULL, 0, &amp;context) != poly_ok) { fprintf(stderr, "initialization error\n"); return 1; } char* language = "js"; for (int n = 1; n &lt; argc; n++) { if (argv[n][0] == '-') { language = &amp;argv[n][1]; } else { poly_value result = NULL; if (poly_context_eval(thread, context, language, "unicalc", argv[n], &amp;result) != poly_ok) { fprintf(stderr, "eval error\n"); return 1; } char buffer[1024]; size_t length; if (poly_value_to_string_utf8(thread, result, buffer, sizeof(buffer), &amp;length) != poly_ok) { fprintf(stderr, "to string error\n"); return 1; } buffer[length] = '\0'; printf("%s\n", buffer); poly_destroy_handle(thread, result); } } return 0; }</span></span></span></span></code> </pre> </div></div><br><p>      ,       polyglot   GraalVM.  , ,    JVM. </p><br><pre> <code class="plaintext hljs">$ clang -Igraalvm-1.0.0-rc1/Contents/Home/jre/lib/polyglot / -rpath graalvm-1.0.0-rc1/Contents/Home / -Lgraalvm-1.0.0-rc1/Contents/Home/jre/lib/polyglot / -lpolyglot extendc.c -o extendc $ otool -L extendc extendc: .../libpolyglot.dylib ... .../libSystem.B.dylib ...</code> </pre> <br><pre> <code class="plaintext hljs">$ ./extendc '14 + 2' 16 $ ./extendc -js 'Math.sqrt(14)' 3.7416573867739413 $ ./extendc -python '[2**n for n in range(0, 8)]' [1, 2, 4, 8, 16, 32, 64, 128]</code> </pre> <br><p>   ,      GraalVM —  -    ,    ,  GraalVM. </p><br><h2 id="8-kod-na-java-kak-platformo-zavisimaya-biblioteka"> 8.   Java  -  </h2><br><p>  Java        , , ,    ,  - ,      .     Java   - ,     JVM   ,         . </p><br><p> GraalVM    Java ,   ,      - ,          .      ,    ,    Java    JVM. </p><br><p>   ,     Apache SIS    ,     ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> )     .   SIS 0.8,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://sis.apache.org/</a>     jar. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.sis.distance.DistanceUtils; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Distance</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> aLat = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> aLong = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> bLat = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> bLong = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">3</span></span>]); System.out.printf(<span class="hljs-string"><span class="hljs-string">"%.2f km%n"</span></span>, DistanceUtils.getHaversineDistance(aLat, aLong, bLat, bLong)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IsolateThread thread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aLat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aLong, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bLat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bLong)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DistanceUtils.getHaversineDistance(aLat, aLong, bLat, bLong); } }</code> </pre> <br><p>      ,       - </p><br><pre> <code class="plaintext hljs">$ javac -cp sis.jar -parameters Distance.java $ java -cp sis.jar:. Distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>       ,      <code>topten</code> . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server -cp sis.jar:. Distance ... $ ./distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>      ,    .   ,        <code>@CEntryPoint</code> </p><br><pre> <code class="java hljs">... <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.nativeimage.IsolateThread; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.nativeimage.c.function.CEntryPoint; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Distance</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@CEntryPoint</span></span>(name = <span class="hljs-string"><span class="hljs-string">"distance"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IsolateThread thread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a_lat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a_long, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b_lat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b_long)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DistanceUtils.getHaversineDistance(a_lat, a_long, b_lat, b_long); } ... }</code> </pre> <br><p>      <code>javac</code> ,   GraalVM    API  <code>classpath</code> . C         . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server -cp sis.jar:. -H:Kind=SHARED_LIBRARY \ -H:Name=libdistance $ otool -L libdistance.dylib # .so on Linux libdistance.dylib: .../libdistance.dylib ... .../CoreFoundation.framework ... .../libz.1.dylib ... .../libSystem.B.dylib ... $ du -h libdistance.dylib 4.8M libdistance.dylib</code> </pre> <br><p>      ,     .     ,    :   VM   ,      ,           . </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;libdistance.h&gt; int main(int argc, char **argv) { graal_isolate_t *isolate = NULL; graal_isolatethread_t *thread = NULL; if (graal_create_isolate(NULL, &amp;isolate) != 0 || (thread = graal_current_thread(isolate)) == NULL) { fprintf(stderr, "initialization error\n"); return 1; } double a_lat = strtod(argv[1], NULL); double a_long = strtod(argv[2], NULL); double b_lat = strtod(argv[3], NULL); double b_long = strtod(argv[4], NULL); printf("%.2f km\n", distance(thread, a_lat, a_long, b_lat, b_long)); return 0; }</span></span></span></span></code> </pre> <br><p>       ,       (  <code>LD_LIBRARY_PARTH=.</code>  Linux) </p><br><pre> <code class="plaintext hljs">$ clang -I. -L. -ldistance distance.c -o distance $ otool -L distance distance: .../libdistance.dylib ... .../libSystem.B.dylib ... $ ./distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>     GraalVM —   java  - ,         JVM </p><br><h2 id="9-podderzhka-neskolkih-yazykov-programmirovaniya-v-baze-dannyh"> 9.        </h2><br><p>     Polyglot  —     Oracle.      Oracle Database Multilingual Engine (MLE),         GraalVM   SQL. </p><br><p> ,    front-end,    JavaScript     email ,  JavaScript  <code>validator</code> .     -       ,      SQL  PL/SQL.         ,    . </p><br><p>  MLE  Docker  : </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://oracle.github.io/oracle-db-mle/releases/0.2.7/docker/</a> </p><br><p>     Docker Daemon. </p><br><pre> <code class="plaintext hljs">$ docker load --input mle-docker-0.2.7.tar.gz</code> </pre> <br><p>  ,  Docker,  ,    (    ),  Bash   . </p><br><pre> <code class="plaintext hljs">$ docker run mle-docker-0.2.7 $ docker ps $ docker exec -ti &lt;container_id&gt; bash -li</code> </pre> <br><p>    <code>sqlplus</code> ( SQL ),   Bash,     ,   ,     . </p><br><pre> <code class="plaintext hljs">$ sqlplus scott/tiger@localhost:1521/ORCLCDB</code> </pre> <br><p>    ,    <code>sqlplus</code> . ,   Bash  Docker,         <code>dbjs</code> ,       .   <code>sqlplus</code> . </p><br><pre> <code class="plaintext hljs">$ npm install validator $ npm install @types/validator $ dbjs deploy -u scott -p tiger -c localhost:1521/ORCLCDB validator $ sqlplus scott/tiger@localhost:1521/ORCLCDB</code> </pre> <br><p>         <code>validator</code>   SQL . </p><br><pre> <code class="plaintext hljs">SQL&gt; select validator.isEmail('hello.world@oracle.com') from dual; VALIDATOR.ISEMAIL('HELLO.WORLD@ORACLE.COM') ------------------------------------------- 1 SQL&gt; select validator.isEmail('hello.world') from dual; VALIDATOR.ISEMAIL('HELLO.WORLD') -------------------------------- 0</code> </pre> <br><p>    ,     GraalVM —  ,  GraalVM,   Oracle.  ,     front-end  back-end,    ,  ,           . </p><br><h2 id="10-sozdanie-yazykov-programmirovaniya-dlya-graalvm"> 10.     GraalVM </h2><br><p> Oracle Labs            JavaScript, R, Ruby, Python  C   ,      Truffle,       GraalVM. </p><br><p> Truffle —  java ,     <em>  </em> (AST).  AST — ,     ,                ,   , ,  .     ,    ,   Truffle  Graal   JIT  ,       AST . </p><br><p>    Truffle,    GraalVM    ,      ,  DSL.      Truffle  Graal   ,     ,  Truffle —         GraalVM.        , , , , . ,         ,        . Oracle labs    Ruby ,    ,         . </p><br><p>       ,     ,   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SimpleLanguage</a> —         Truffle,       JavaScript.  ,  ,   , , , <a href="">   if</a> . </p><br><p>  ,    Truffle   Oracle Labs,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SmallTalk</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Newspeak</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lisp</a> .    Lisp  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> ,         . </p><br><h2 id="zaklyuchenie"> 结论 </h2><br><p> GraalVM        —  ,         ,       .       ,  ,    ,      ,    . </p><br><p>   GraalVM,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://www.graalvm.org/</a> .          ,  ,      . </p><br><p>    ,              ,    .     ,     GraalVM         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@ChrisGSeaton</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@shelajev</a> . </p><br><p> <em>:</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Oleg Šelajev</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Olya Gupalo</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Doug Simon</a> </p><cut></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN433432/">https://habr.com/ru/post/zh-CN433432/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN433414/index.html">测试PRTG网络监视器并与Zabbix进行比较</a></li>
<li><a href="../zh-CN433420/index.html">ZeroNights 2018结果</a></li>
<li><a href="../zh-CN433424/index.html">可以在Super Mario Maker中加载无法逾越的关卡吗？</a></li>
<li><a href="../zh-CN433428/index.html">创造力从何而来：在RAT测试过程中对大脑α波活动的分析</a></li>
<li><a href="../zh-CN433430/index.html">新鲜的SoC Amlogic S905X2上具有4 GB RAM和Android TV 8.1的Android盒子Mecool KM9-了解并原谅</a></li>
<li><a href="../zh-CN433434/index.html">“绝对不需要Pascal，尤其是Basic，”：对体育编程培训师的采访</a></li>
<li><a href="../zh-CN433436/index.html">绩效研究介绍</a></li>
<li><a href="../zh-CN433438/index.html">国家杜马将限制众筹</a></li>
<li><a href="../zh-CN433442/index.html">实体框架核心2.2发布。 最新消息 （3之3）</a></li>
<li><a href="../zh-CN433446/index.html">安全周51：WordPress 5.0和Logitech软件中的错误，Facebook照片漏洞</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>