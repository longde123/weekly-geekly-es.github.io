<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíå üëêüèº üßëüèΩ‚Äçü§ù‚Äçüßëüèº Organizaci√≥n de la navegaci√≥n en aplicaciones iOS usando el Root Controller üêÉ üçò üéñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La mayor√≠a de las aplicaciones m√≥viles contienen m√°s de una docena de pantallas, transiciones complejas, as√≠ como partes de la aplicaci√≥n, separadas p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Organizaci√≥n de la navegaci√≥n en aplicaciones iOS usando el Root Controller</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416147/"><img src="https://habrastorage.org/webt/uf/0h/3q/uf0h3qqyj6c6tnvj6fbf4089bye.jpeg"><br><br>  La mayor√≠a de las aplicaciones m√≥viles contienen m√°s de una docena de pantallas, transiciones complejas, as√≠ como partes de la aplicaci√≥n, separadas por significado y prop√≥sito.  Por lo tanto, existe la necesidad de organizar la estructura de navegaci√≥n correcta para la aplicaci√≥n, que ser√° flexible, conveniente, ampliable, proporcionar√° un acceso c√≥modo a varias partes de la aplicaci√≥n y tambi√©n tendr√° cuidado con los recursos del sistema. <br><br>  En este art√≠culo, dise√±aremos la navegaci√≥n en la aplicaci√≥n para evitar los errores m√°s comunes que provocan p√©rdidas de memoria, arruinan la arquitectura y rompen la estructura de navegaci√≥n. <br><a name="habracut"></a><br>  La mayor√≠a de las aplicaciones tienen al menos dos partes: autenticaci√≥n (pre-inicio de sesi√≥n) y parte privada (post-inicio de sesi√≥n).  Algunas aplicaciones pueden tener una estructura m√°s compleja, m√∫ltiples perfiles con un solo inicio de sesi√≥n, transiciones condicionales despu√©s de iniciar la aplicaci√≥n (enlaces profundos), etc. <br><br>  En la pr√°ctica, dos enfoques se utilizan principalmente para navegar por la aplicaci√≥n: <br><br><ol><li>  Una pila de navegaci√≥n para los controladores de presentaci√≥n (presente) y los controladores de navegaci√≥n (push), sin la capacidad de retroceder.  Este enfoque hace que todos los ViewControllers anteriores permanezcan en la memoria. </li><li>  Utiliza la alternancia window.rootViewController.  Con este enfoque, todos los ViewControllers anteriores se destruyen en la memoria, pero esto no se ve mejor desde el punto de vista de la IU.  Adem√°s, no le permite moverse de un lado a otro si es necesario. </li></ol><br>  Ahora veamos c√≥mo puede crear una estructura f√°cil de mantener que le permita cambiar sin problemas entre diferentes partes de la aplicaci√≥n, sin c√≥digo de espagueti y f√°cil navegaci√≥n. <br><br>  Imaginemos que estamos escribiendo una aplicaci√≥n que consiste en: <br><br><ul><li>  La pantalla principal (pantalla de <b>bienvenida</b> ): esta es la primera pantalla que ve, tan pronto como se inicia la aplicaci√≥n, puede agregar, por ejemplo, animaci√≥n o realizar cualquier solicitud de API principal. </li><li>  <b>Parte de autenticaci√≥n</b> : inicio de sesi√≥n, registro, restablecimiento de contrase√±a, confirmaci√≥n por correo electr√≥nico, etc.  La sesi√≥n de trabajo del usuario generalmente se guarda, por lo que no es necesario ingresar cada vez que se inicia la aplicaci√≥n. </li><li>  <b>Parte principal</b> : la l√≥gica empresarial de la aplicaci√≥n principal </li></ul><br>  Todas estas partes de la aplicaci√≥n est√°n aisladas unas de otras y cada una existe en su propia pila de navegaci√≥n.  Por lo tanto, podemos necesitar las siguientes transiciones: <br><br><ul><li>  <b>Pantalla de bienvenida -&gt; Pantalla de autenticaci√≥n</b> , si la sesi√≥n actual del usuario activo est√° ausente. </li><li>  <b>Pantalla de bienvenida -&gt;</b> Pantalla <b>principal</b> , si el usuario ya ha iniciado sesi√≥n en la aplicaci√≥n anteriormente y hay una sesi√≥n activa. </li><li>  <b>Pantalla principal -&gt; Pantalla de autenticaci√≥n</b> , en caso de que el usuario cierre sesi√≥n </li></ul><br><br>  <b>Ajuste b√°sico</b> <br><br>  Cuando se inicia la aplicaci√≥n, necesitamos inicializar el <i>RootViewController</i> , que se cargar√° primero.  Esto se puede hacer tanto con c√≥digo como a trav√©s de Interface Builder.  Cree un nuevo proyecto en xCode y todo esto ya se har√° de forma predeterminada: <i>main.storyboard</i> ya <i>est√°</i> vinculado a <i>window.rootViewController</i> . <br><br>  Pero para centrarnos en el tema principal del art√≠culo, no utilizaremos guiones gr√°ficos en nuestro proyecto.  Por lo tanto, elimine <i>main.storyboard</i> y tambi√©n borre el campo "Interfaz principal" en Objetivos -&gt; General -&gt; Informaci√≥n de implementaci√≥n: <br><br><img src="https://habrastorage.org/webt/kc/ku/cq/kckucqq5vpiklb5p7kyp7rwgqfu.png"><br><br>  Ahora cambiemos el m√©todo <i>didFinishLaunchingWithOptions</i> en <i>AppDelegate</i> para que se vea as√≠: <br><br><pre><code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">]?)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { window = <span class="hljs-type"><span class="hljs-type">UIWindow</span></span>(frame: <span class="hljs-type"><span class="hljs-type">UIScreen</span></span>.main.bounds) window?.rootViewController = <span class="hljs-type"><span class="hljs-type">RootViewController</span></span>() window?.makeKeyAndVisible() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br>  Ahora la aplicaci√≥n iniciar√° primero el <i>RootViewController</i> .  Cambie el nombre del <i>ViewController</i> base al <i>RootViewController</i> : <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController { }</span></span></span></span></code> </pre> <br>  Este ser√° el controlador principal responsable de todas las transiciones entre diferentes secciones de la aplicaci√≥n.  Por lo tanto, necesitaremos un enlace cada vez que queramos hacer la transici√≥n.  Para hacer esto, agregue la extensi√≥n a <i>AppDelegate</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shared: <span class="hljs-type"><span class="hljs-type">AppDelegate</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UIApplication</span></span>.shared.delegate <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">AppDelegate</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rootViewController: <span class="hljs-type"><span class="hljs-type">RootViewController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> window!.rootViewController <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">RootViewController</span></span> } }</code> </pre> <br>  <i>La recuperaci√≥n forzada de una opci√≥n en este caso est√° justificada, porque RootViewController no cambia, y si esto ocurre por accidente, el bloqueo de la aplicaci√≥n es una situaci√≥n normal.</i> <i><br></i> <br>  Entonces, ahora tenemos un enlace al <i>RootViewController</i> desde cualquier lugar de la aplicaci√≥n: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rootViewController = <span class="hljs-type"><span class="hljs-type">AppDelegate</span></span>.shared.rootViewController</code> </pre> <br>  Ahora creemos algunos controladores m√°s que necesitamos: <i>SplashViewController, LoginViewController</i> y <i>MainViewController</i> . <br><br>  La pantalla de bienvenida es la primera pantalla que ver√° un usuario despu√©s de iniciar la aplicaci√≥n.  En este momento, generalmente se realizan todas las solicitudes API necesarias, se verifica la actividad de la sesi√≥n del usuario, etc.  Para mostrar las acciones en segundo plano en curso, use <i>UIActivityIndicatorView</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SplashViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> activityIndicator = <span class="hljs-type"><span class="hljs-type">UIActivityIndicatorView</span></span>(activityIndicatorStyle: .whiteLarge) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() view.backgroundColor = <span class="hljs-type"><span class="hljs-type">UIColor</span></span>.white view.addSubview(activityIndicator) activityIndicator.frame = view.bounds activityIndicator.backgroundColor = <span class="hljs-type"><span class="hljs-type">UIColor</span></span>(white: <span class="hljs-number"><span class="hljs-number">0</span></span>, alpha: <span class="hljs-number"><span class="hljs-number">0.4</span></span>) makeServiceCall() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeServiceCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { } }</code> </pre> <br>  Para simular solicitudes de API, agregue el m√©todo <i>DispatchQueue.main.asyncAfter</i> con un retraso de 3 segundos: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeServiceCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { activityIndicator.startAnimating() <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.asyncAfter(deadline: <span class="hljs-type"><span class="hljs-type">DispatchTime</span></span>.now() + .seconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.activityIndicator.stopAnimating() } }</code> </pre> <br>  Creemos que la sesi√≥n del usuario tambi√©n se establece en estas solicitudes.  En nuestra aplicaci√≥n, usamos <i>UserDefaults</i> para esto: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeServiceCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { activityIndicator.startAnimating() <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.asyncAfter(deadline: <span class="hljs-type"><span class="hljs-type">DispatchTime</span></span>.now() + .seconds(<span class="hljs-number"><span class="hljs-number">3</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.activityIndicator.stopAnimating() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-type"><span class="hljs-type">UserDefaults</span></span>.standard.bool(forKey: ‚Äú<span class="hljs-type"><span class="hljs-type">LOGGED_IN</span></span>‚Äù) { <span class="hljs-comment"><span class="hljs-comment">// navigate to protected page } else { // navigate to login screen } } }</span></span></code> </pre><br>  <i>Definitivamente no utilizar√° UserDefaults para guardar el estado de una sesi√≥n de usuario en la versi√≥n de lanzamiento del programa.</i>  <i>Utilizamos configuraciones locales en nuestro proyecto para simplificar la comprensi√≥n y no ir mucho m√°s all√° del tema principal del art√≠culo.</i> <br><br>  Cree un <i>LoginViewController</i> .  Se utilizar√° para autenticar al usuario si la sesi√≥n de usuario actual est√° inactiva.  Puede agregar su IU personalizada al controlador, pero agregar√© aqu√≠ solo el t√≠tulo de la pantalla y el bot√≥n de inicio de sesi√≥n en la barra de navegaci√≥n. <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() view.backgroundColor = <span class="hljs-type"><span class="hljs-type">UIColor</span></span>.white title = <span class="hljs-string"><span class="hljs-string">"Login Screen"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> loginButton = <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Log In"</span></span>, style: .plain, target: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, action: #selector(login)) navigationItem.setLeftBarButton(loginButton, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) } <span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// store the user session (example only, not for the production) UserDefaults.standard.set(true, forKey: "LOGGED_IN") // navigate to the Main Screen } }</span></span></code> </pre> <br>  Y finalmente, cree el controlador principal de la aplicaci√≥n <i>MainViewController</i> : <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MainViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.backgroundColor = UIColor.lightGray // <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> visually distinguish the protected part title = ‚ÄúMain Screen‚Äù let logoutButton = UIBarButtonItem(title: ‚Äú<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>‚Äù, style: .plain, target: self, action: #selector(logout)) navigationItem.setLeftBarButton(logoutButton, animated: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) } @objc private func logout() { // clear the <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> (example <span class="hljs-keyword"><span class="hljs-keyword">only</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the production) UserDefaults.standard.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, forKey: ‚ÄúLOGGED_IN‚Äù) // navigate <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the Main Screen } }</code> </pre> <br>  <b>Navegaci√≥n de ra√≠z</b> <br><br>  Ahora volvamos al <i>RootViewController</i> . <br>  Como dijimos anteriormente, <i>RootViewController</i> es el √∫nico objeto responsable de las transiciones entre diferentes pilas de controladores independientes.  Para conocer el estado actual de la aplicaci√≥n, crearemos una variable en la que almacenaremos el <i>ViewController</i> actual: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> }</code> </pre> <br>  Agregue el inicializador de clase y cree el primer <i>ViewController</i> que queremos cargar cuando se inicia la aplicaci√≥n.  En nuestro caso, ser√° <i>SplashViewController</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.current = <span class="hljs-type"><span class="hljs-type">SplashViewController</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(nibName: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) } }</code> </pre> <br>  En <i>viewDidLoad,</i> agregue el <i>viewController</i> actual al <i>RootViewController</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() addChildViewController(current) <span class="hljs-comment"><span class="hljs-comment">// 1 current.view.frame = view.bounds // 2 view.addSubview(current.view) // 3 current.didMove(toParentViewController: self) // 4 } }</span></span></code> </pre> <br>  Una vez que agregamos <i>childViewController</i> (1), ajustamos su tama√±o estableciendo <i>current.view.frame</i> en <i>view.bounds</i> (2). <br><br>  Si <i>omitimos</i> esta l√≠nea, <i>viewController</i> todav√≠a se colocar√° correctamente en la mayor√≠a de los casos, pero pueden surgir problemas si cambia el tama√±o del <i>marco</i> . <br><br>  Agregue una nueva subvista (3) y llame al m√©todo didMove (toParentViewController :).  Esto completar√° la operaci√≥n de agregar controlador.  Tan pronto como se <i>inicia RootViewController</i> , inmediatamente despu√©s <i>se</i> muestra <i>SplashViewController</i> . <br><br>  Ahora puede agregar varios m√©todos de navegaci√≥n en la aplicaci√≥n.  <i>Mostraremos</i> el <i>LoginViewController</i> sin ninguna animaci√≥n, <i>MainViewController</i> usar√° la animaci√≥n con atenuaci√≥n suave y la transici√≥n de las pantallas al desconectar al usuario tendr√° un efecto deslizante. <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController</span></span></span><span class="hljs-class"> { ... func showLoginScreen() { let new = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UINavigationController</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rootViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LoginViewController</span></span></span><span class="hljs-class">()) // 1 addChildViewController(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">) // 2 new.view.frame = view.bounds // 3 view.addSubview(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">) // 4 new.didMove(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">toParentViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">) // 5 current.willMove(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">toParentViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil</span></span></span><span class="hljs-class">) // 6 current.view.removeFromSuperview()] // 7 current.removeFromParentViewController() // 8 current = new // 9 }</span></span></code> </pre><br>  Cree <i>LoginViewController</i> (1), agregue como controlador secundario (2), establezca el marco (3).  Agregue la vista de <i>LoginController</i> como <i>subview</i> (4) y llame al m√©todo didMove (5).  A continuaci√≥n, prepare el controlador actual para su eliminaci√≥n utilizando el m√©todo willMove (6).  Finalmente, elimine la vista actual de la supervista (7) y elimine el controlador actual de <i>RootViewController</i> (8).  Recuerde actualizar el valor del controlador actual (9). <br><br>  Ahora <i>creemos el</i> m√©todo <i>switchToMainScreen</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchToMainScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mainViewController = <span class="hljs-type"><span class="hljs-type">MainViewController</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mainScreen = <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>(rootViewController: mainViewController) ... }</code> </pre> <br>  Animar la transici√≥n requiere un m√©todo diferente: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animateFadeTransition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to new: UIViewController, completion: </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)? = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { current.willMove(toParentViewController: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) addChildViewController(new) transition(from: current, to: new, duration: <span class="hljs-number"><span class="hljs-number">0.3</span></span>, options: [.transitionCrossDissolve, .curveEaseOut], animations: { }) { completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.current.removeFromParentViewController() new.didMove(toParentViewController: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.current = new completion?() <span class="hljs-comment"><span class="hljs-comment">//1 } }</span></span></code> </pre> <br>  Este m√©todo es muy similar a <i>showLoginScreen</i> , pero todos los √∫ltimos pasos se realizan una vez que se completa la animaci√≥n.  Para notificar al m√©todo de llamada el final de la transici√≥n, al final llamamos cierre (1). <br><br>  Ahora la versi√≥n final del m√©todo <i>switchToMainScreen</i> se ver√° as√≠: <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchToMainScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mainViewController = <span class="hljs-type"><span class="hljs-type">MainViewController</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mainScreen = <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>(rootViewController: mainViewController) animateFadeTransition(to: mainScreen) }</code> </pre> <br>  Y finalmente, <i>creemos</i> el √∫ltimo m√©todo que ser√° responsable de la transici√≥n de <i>MainViewController</i> a <i>LoginViewController</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchToLogout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> loginViewController = <span class="hljs-type"><span class="hljs-type">LoginViewController</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logoutScreen = <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>(rootViewController: loginViewController) animateDismissTransition(to: logoutScreen) }</code> </pre> <br>  El m√©todo <i>AnimateDismissTransition</i> proporciona animaci√≥n de diapositivas: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animateDismissTransition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to new: UIViewController, completion: </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)? = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { new.view.frame = <span class="hljs-type"><span class="hljs-type">CGRect</span></span>(x: -view.bounds.width, y: <span class="hljs-number"><span class="hljs-number">0</span></span>, width: view.bounds.width, height: view.bounds.height) current.willMove(toParentViewController: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) addChildViewController(new) transition(from: current, to: new, duration: <span class="hljs-number"><span class="hljs-number">0.3</span></span>, options: [], animations: { new.view.frame = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.bounds }) { completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.current.removeFromParentViewController() new.didMove(toParentViewController: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.current = new completion?() } }</code> </pre><br>  Estos son solo dos ejemplos de animaci√≥n, con el mismo enfoque puede crear cualquier animaci√≥n compleja que necesite <br><br>  Para completar la configuraci√≥n, agregue llamadas a m√©todos con animaciones de <i>SplashViewController, LoginViewController</i> y <i>MainViewController</i> : <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SplashViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController</span></span></span><span class="hljs-class"> { ... private func makeServiceCall() { if </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserDefaults</span></span></span><span class="hljs-class">.standard.bool(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">forKey</span></span></span><span class="hljs-class">: ‚Äú</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LOGGED_IN</span></span></span><span class="hljs-class">‚Äù) { // navigate to protected page </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppDelegate</span></span></span><span class="hljs-class">.shared.rootViewController.switchToMainScreen() } else { // navigate to login screen </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppDelegate</span></span></span><span class="hljs-class">.shared.rootViewController.switchToLogout() } } } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LoginViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController</span></span></span><span class="hljs-class"> { ... @objc private func login() { ... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppDelegate</span></span></span><span class="hljs-class">.shared.rootViewController.switchToMainScreen() } } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MainViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController</span></span></span><span class="hljs-class"> { ... @objc private func logout() { ... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppDelegate</span></span></span><span class="hljs-class">.shared.rootViewController.switchToLogout() } }</span></span></code> </pre><br>  Compile, ejecute la aplicaci√≥n y verifique su funcionamiento de dos maneras: <br><br>  - cuando el usuario ya tiene una sesi√≥n activa actual (iniciada sesi√≥n) <br>  - cuando no hay sesi√≥n activa y se requiere autenticaci√≥n <br><br>  En ambos casos, deber√≠a ver una transici√≥n a la pantalla deseada, inmediatamente despu√©s de cargar <i>SplashScreen</i> . <br><br><img src="https://habrastorage.org/webt/zq/n5/ss/zqn5ssn9toyzyjhas3wvljnfj9m.gif"><br><br>  Como resultado, creamos un peque√±o modelo de prueba de la aplicaci√≥n, con navegaci√≥n a trav√©s de sus m√≥dulos principales.  Si necesita expandir las capacidades de la aplicaci√≥n, agregar m√≥dulos adicionales y transiciones entre ellos, siempre puede expandir y escalar este sistema de navegaci√≥n de manera r√°pida y conveniente. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es416147/">https://habr.com/ru/post/es416147/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es416131/index.html">C√≥mo manejar la EP en la Federaci√≥n de Rusia y no violar la ley</a></li>
<li><a href="../es416135/index.html">Aplicaci√≥n GUI menor a 1 kb</a></li>
<li><a href="../es416137/index.html">Zabbix como esc√°ner de seguridad</a></li>
<li><a href="../es416139/index.html">Autenticaci√≥n fuerte como parte de la estrategia GDPR</a></li>
<li><a href="../es416143/index.html">El libro "¬°Se mostrar√° una autopsia!" An√°lisis pr√°ctico de malware ¬ª</a></li>
<li><a href="../es416149/index.html">Preguntas y respuestas sobre energ√≠as renovables, parte 1</a></li>
<li><a href="../es416151/index.html">Globo adimensional. An√°lisis utilitario de la dimensi√≥n m√°gica</a></li>
<li><a href="../es416153/index.html">¬øLos aviones se volver√°n m√°s confiables? Los fabricantes de aviones presentan robots a las empresas</a></li>
<li><a href="../es416155/index.html">WebSockets en Angular: cree un servicio angular para trabajar con sockets web</a></li>
<li><a href="../es416157/index.html">En los brazos de Python (solo mujeres)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>