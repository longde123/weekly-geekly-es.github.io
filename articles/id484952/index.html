<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕥 🤾🏽 👌🏽 Mengganti Redux dengan Observable dan React Hooks 🙇🏾 💲 🎞️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Manajemen negara adalah salah satu tugas paling penting yang diselesaikan dalam pengembangan React. Banyak alat telah dibuat untuk membantu pengembang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengganti Redux dengan Observable dan React Hooks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484952/"><p><img align="right" src="https://habrastorage.org/webt/fo/2d/t7/fo2dt7_8xrgtb3goulj7cwpxrpg.png">  Manajemen negara adalah salah satu tugas paling penting yang diselesaikan dalam pengembangan React.  Banyak alat telah dibuat untuk membantu pengembang memecahkan masalah ini.  Alat yang paling populer adalah Redux, perpustakaan kecil yang dibuat oleh Dan Abramov untuk membantu pengembang menggunakan pola desain Flux dalam aplikasi mereka.  Di artikel ini, kita akan melihat apakah kita benar-benar membutuhkan Redux dan melihat bagaimana kita bisa menggantinya dengan pendekatan yang lebih sederhana berdasarkan Observable and React Hooks. </p><a name="habracut"></a><br><h1 id="zachem-nam-voobsche-nuzhen-redux">  Mengapa kita membutuhkan Redux? </h1><br><p> Redux sangat sering dikaitkan dengan Bereaksi sehingga banyak pengembang menggunakannya tanpa memikirkan mengapa mereka membutuhkan Redux.  Bereaksi membuatnya mudah untuk menyinkronkan komponen dan <code>useState()</code> dengan <code>setState()</code> / <code>useState()</code> .  Tetapi semuanya menjadi lebih rumit segera setelah negara mulai digunakan oleh beberapa komponen sekaligus.  Solusi yang paling jelas untuk berbagi keadaan umum antara beberapa komponen adalah memindahkannya (keadaan) ke induknya yang sama.  Tetapi solusi "langsung" seperti itu dapat dengan cepat menimbulkan kesulitan: jika komponen-komponen tersebut jauh dari satu sama lain dalam hierarki komponen, maka memperbarui keadaan umum akan membutuhkan banyak pengguliran melalui properti-properti komponen.  Bereaksi Konteks dapat membantu mengurangi jumlah tumpahan, tetapi menyatakan konteks baru setiap kali negara mulai digunakan bersama dengan komponen lain akan membutuhkan lebih banyak upaya dan pada akhirnya dapat menyebabkan kesalahan. </p><br><p>  Redux memecahkan masalah ini dengan memperkenalkan objek <code>Store</code> yang berisi seluruh status aplikasi.  Dalam komponen yang memerlukan akses untuk menyatakan, <code>Store</code> ini diimplementasikan menggunakan fungsi <code>connect</code> .  Fungsi ini juga memastikan bahwa ketika keadaan berubah, semua komponen yang bergantung padanya akan digambar ulang.  Akhirnya, untuk mengubah keadaan, komponen harus mengirim tindakan yang memicu peredam untuk menghitung keadaan yang baru diubah. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/b6f/531/9dc/b6f5319dc6eb751b9a18482cb7863f8d.gif"><br><p>  <em>Ketika saya pertama kali memahami konsep Redux</em> </p><br><h1 id="chto-ne-tak-s-redux">  Apa yang salah dengan Redux? </h1><br><p>  Pertama kali saya membaca <a href="https://redux.js.org/basics/basic-tutorial/" rel="nofollow">tutorial</a> resmi <a href="https://redux.js.org/basics/basic-tutorial/" rel="nofollow">Redux</a> , saya paling kaget dengan banyaknya kode yang harus saya tulis untuk mengubah status.  Mengubah negara membutuhkan mendeklarasikan tindakan baru, mengimplementasikan peredam yang sesuai, dan akhirnya mengirimkan tindakan.  Redux juga mendorong <a href="https://redux.js.org/basics/actions/" rel="nofollow">penulisan pembuat tindakan</a> untuk memudahkan membuat tindakan setiap kali Anda ingin mengirimkannya. </p><br><p>  Dengan semua langkah ini, Redux mempersulit pemahaman kode, refactoring, dan debugging.  Saat membaca kode yang ditulis oleh orang lain, seringkali sulit untuk mengetahui apa yang terjadi ketika tindakan diajukan.  Pertama, kita harus masuk ke kode pembuat tindakan untuk menemukan jenis tindakan yang sesuai, dan kemudian menemukan reduksi yang menangani jenis tindakan ini.  Hal-hal dapat menjadi lebih rumit jika beberapa middlewares digunakan, seperti redux-saga, yang membuat konteks solusi lebih implisit. </p><br><p>  Dan akhirnya, saat menggunakan TypeScript, Redux bisa mengecewakan.  Secara desain, aksi hanyalah string yang terkait dengan parameter tambahan.  Ada beberapa cara untuk menulis kode Redux yang diketik dengan baik menggunakan TypeScript, tetapi bisa sangat membosankan dan sekali lagi dapat menyebabkan peningkatan jumlah kode yang harus kita tulis. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/b0e/9ff/261/b0e9ff26168370d91b5433ad8b1ae4fe.gif"><br><p>  <em>Sensasi kode pembelajaran ditulis dengan Redux</em> </p><br><h1 id="observable-i-hook-prostoy-podhod-k-upravleniyu-sostoyaniem">  Diamati dan kaitkan: pendekatan sederhana untuk mengelola negara. </h1><br><h3 id="zamenyaem-store-c-pomoschyu-observable">  Ganti Store dengan Observable </h3><br><p>  Untuk mengatasi masalah pembagian negara dengan cara yang lebih sederhana, pertama-tama kita perlu menemukan cara untuk memberi tahu komponen ketika komponen lain mengubah keadaan umumnya.  Untuk melakukan ini, mari kita buat kelas yang dapat <code>Observable</code> yang berisi nilai tunggal dan yang memungkinkan komponen untuk berlangganan perubahan nilai ini.  Metode berlangganan akan mengembalikan fungsi yang harus dipanggil untuk berhenti berlangganan dari <code>Observable</code> . </p><br><p>  Di TypeScript, mengimplementasikan kelas semacam itu cukup sederhana: </p><br><pre> <code class="javascript hljs">type Listener&lt;T&gt; = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val: T</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; type Unsubscriber = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Observable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ private _listeners: Listener&lt;T&gt;[]; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private _val: T) {} get(): T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val; } set(val: T) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val !== val) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val = val; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">l</span></span></span><span class="hljs-function"> =&gt;</span></span> l(val)); } } subscribe(listener: Listener&lt;T&gt;): Unsubscriber { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.push(listener); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">l</span></span></span><span class="hljs-function"> =&gt;</span></span> l !== listener); }; } }</code> </pre> <br><p>  Jika Anda membandingkan kelas ini dengan Redux <code>Store</code> , Anda akan melihat bahwa mereka sangat mirip: <code>get()</code> sesuai dengan <code>getState()</code> , dan <code>subscribe()</code> adalah sama.  Perbedaan utama adalah metode <code>dispatch()</code> , yang telah digantikan oleh metode <code>set()</code> lebih sederhana, yang memungkinkan Anda untuk mengubah nilai yang terkandung di dalamnya tanpa harus bergantung pada peredam.  Perbedaan signifikan lainnya adalah bahwa, berbeda dengan Redux, kami akan menggunakan banyak <code>Observable</code> daripada satu <code>Store</code> berisi semua status. </p><br><h3 id="zamenyaem-reducer-servisami">  Ganti layanan peredam </h3><br><p>  Sekarang <code>Observable</code> dapat digunakan untuk menyimpan keadaan umum, tetapi kita masih perlu memindahkan logika yang terkandung dalam peredam.  Untuk ini kami menggunakan konsep layanan.  Layanan adalah kelas yang mengimplementasikan seluruh logika bisnis aplikasi kita.  Mari kita coba menulis ulang peredam <code>Todo</code> dari tutorial Redux ke layanan <code>Todo</code> menggunakan <code>Observable</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observable"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface Todo { readonly text: string; readonly completed: boolean; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> enum VisibilityFilter { SHOW_ALL, SHOW_COMPLETED, SHOW_ACTIVE, } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TodoService</span></span></span><span class="hljs-class"> </span></span>{ readonly todos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observable&lt;Todo[]&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">readonly</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">visibilityFilter</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Observable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter.SHOW_ALL</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">addTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text: string</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[...</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.todos.get(</span></span></span><span class="hljs-function">), { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">completed</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">false</span></span></span><span class="hljs-function"> }]); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">toggleTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index: number</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.todos.get(</span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">map</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> (todo, i</span></span></span><span class="hljs-function">) =&gt;</span></span> (i === index ? { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: todo.text, <span class="hljs-attr"><span class="hljs-attr">completed</span></span>: !todo.completed } : todo) )); } setVisibilityFilter(filter: VisibilityFilter) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.visibilityFilter.set(filter); } }</code> </pre> <br><p>  Membandingkan ini dengan peredam <code>Todo</code> , kita dapat mencatat perbedaan berikut: </p><br><ul><li>  Tindakan digantikan oleh metode, menghilangkan kebutuhan untuk menyatakan jenis tindakan, tindakan itu sendiri, dan pembuat tindakan. </li><li>  Anda tidak perlu lagi menulis peralihan besar untuk merutekan di antara jenis tindakan.  Pengiriman Javascript dinamis (mis. Panggilan metode) menangani hal ini. </li><li>  Dan yang paling penting, layanan berisi dan mengubah keadaan yang dikelolanya.  Ini adalah perbedaan konseptual besar dari reduksi, yang merupakan fungsi murni. </li></ul><br><h2 id="dostup-k-servisam-i-observable-iz-komponentov">  Akses ke layanan dan dapat diamati dari komponen </h2><br><p>  Sekarang kami telah mengganti "store and reducer from Redux" dengan "Observable and services", kami perlu menyediakan layanan dari semua komponen Bereaksi.  Ada beberapa cara untuk melakukan ini: kita bisa menggunakan kerangka kerja IoC, misalnya, Membalikkan;  gunakan konteks Bereaksi atau gunakan pendekatan yang sama seperti di <code>Store</code> Redux - satu contoh global untuk setiap layanan.  Dalam artikel ini, kami akan mempertimbangkan pendekatan terakhir: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TodoService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./todoService"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> todoService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TodoService();</code> </pre> <br><p>  Sekarang kita dapat mengakses status bersama dan mengubahnya dari semua komponen Bereaksi kita dengan mengimpor turunan <code>todoService</code> .  Tetapi kita masih perlu menemukan cara untuk menggambar ulang komponen kita ketika keadaan umum diubah oleh komponen lain.  Untuk melakukan ini, kita akan menulis sebuah kait sederhana yang menambahkan variabel status ke komponen, berlangganan <code>Observable</code> dan memperbarui variabel state ketika nilai <code>Observable</code> berubah: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useEffect, useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observable"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useObservable</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">observable: Observable&lt;T&gt;</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [val, setVal] = useState(observable.get()); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { setVal(observable.get()); <span class="hljs-comment"><span class="hljs-comment">//   @mayorovp return observable.subscribe(setVal); }, [observable]); return val; }</span></span></code> </pre> <br><h1 id="sobiraem-vse-vmeste">  Menyatukan semuanya </h1><br><p>  Toolkit kami siap.  Kita dapat menggunakan <code>Observable</code> untuk menyimpan status umum dalam layanan dan menggunakan <code>useObservable</code> untuk memastikan bahwa komponen akan selalu selaras dengan kondisi ini. </p><br><p>  Mari kita menulis ulang komponen TodoList dari tutorial Redux menggunakan hook baru: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useObservable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observableHook"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { todoService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./services"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Todo, VisibilityFilter } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./todoService"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TodoList = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> todos = useObservable(todoService.todos); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = useObservable(todoService.visibilityFilter); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> visibleTodos = getVisibleTodos(todos, filter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div&gt; &lt;ul&gt; {visibleTodos.map((todo, index</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">TodoItem</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{index}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">todo</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{todo}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{index}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;p&gt; Show: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FilterLink</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">filter</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{VisibilityFilter.SHOW_ALL}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">All</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FilterLink</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>, &lt;FilterLink filter={VisibilityFilter.SHOW_ACTIVE}&gt;Active&lt;<span class="hljs-regexp"><span class="hljs-regexp">/FilterLink&gt;, &lt;FilterLink filter={VisibilityFilter.SHOW_ALL}&gt;Completed&lt;/</span></span>FilterLink&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; ); }; const TodoItem = ({ todo: { text, completed }, index }: { todo: Todo; index: number }) =&gt; { return ( &lt;li style={{ textDecoration: completed ? "line-through" : "none", }} onClick={() =&gt; todoService.toggleTodo(index)} &gt; {text} &lt;/</span></span>li&gt; ); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FilterLink = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ filter, children }: { filter: VisibilityFilter; children: React.ReactNode }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> activeFilter = useObservable(todoService.visibilityFilter); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> active = filter === activeFilter; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> active ? <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;span&gt;{children}&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/span&gt; ) : ( &lt;a href="" onClick={() =&gt; todoService.setVisibilityFilter(filter)}&gt; {children} &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">a&gt; </span></span></span><span class="hljs-function">); }; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getVisibleTodos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos: Todo[], filter: VisibilityFilter</span></span></span><span class="hljs-function">): </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Todo</span></span></span><span class="hljs-function">[] { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">switch</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_ALL</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_COMPLETED</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t =&gt; t.completed</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_ACTIVE</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t =&gt; !t.completed</span></span></span><span class="hljs-function">); } }</span></span></code> </pre> <br><p>  Seperti yang dapat kita lihat, kita telah menulis beberapa komponen yang merujuk ke nilai keadaan umum ( <code>todos</code> dan <code>visibilityFilter</code> ).  Nilai-nilai ini hanya diubah dengan memanggil metode dari <code>todoService</code> .  Berkat hook useObservable, yang berlangganan perubahan nilai, komponen ini secara otomatis digambar ulang ketika keadaan umum berubah. </p><br><h1 id="vyvod">  Kesimpulan </h1><br><p>  Jika kita membandingkan kode ini dengan pendekatan Redux, kita akan melihat beberapa keuntungan: </p><br><ul><li>  <strong>Keringkasan:</strong> satu <strong>-</strong> satunya hal yang perlu kita lakukan adalah membungkus nilai-nilai keadaan di <code>Observable</code> dan menggunakan hook <code>useObservable</code> ketika mengakses nilai-nilai ini dari komponen.  Tidak perlu mendeklarasikan tindakan, pembuat tindakan, menulis atau menggabungkan peredam, atau menghubungkan komponen kami ke repositori dengan <code>mapDispatchToProps</code> dan <code>mapDispatchToProps</code> . </li><li>  <strong>Kesederhanaan:</strong> Sekarang jauh lebih mudah untuk melacak eksekusi kode.  Memahami apa yang sebenarnya terjadi ketika tombol ditekan hanyalah masalah beralih ke implementasi metode yang disebut.  Eksekusi langkah demi langkah menggunakan debugger juga meningkat secara signifikan, karena tidak ada tingkat menengah antara komponen kami dan layanan kami. </li><li>  <strong>Ketik keamanan di luar kotak:</strong> Pengembang TypeScript tidak perlu pekerjaan tambahan untuk memiliki kode yang diketik dengan benar.  Tidak perlu mendeklarasikan tipe untuk negara dan untuk setiap tindakan. </li><li>  <strong>Dukungan untuk async / menunggu:</strong> walaupun ini belum diperlihatkan di sini, solusi ini bekerja sangat baik dengan fungsi asinkron, sangat menyederhanakan pemrograman asinkron.  Tidak perlu bergantung pada middleware, seperti redux-thunk, yang membutuhkan pengetahuan mendalam tentang pemrograman fungsional untuk memahami. </li></ul><br><p>  Redux, tentu saja, masih memiliki beberapa keuntungan serius, terutama Redux DevTools, yang memungkinkan pengembang untuk memantau perubahan status selama pengembangan dan bergerak dalam waktu ke kondisi aplikasi sebelumnya, yang dapat menjadi alat yang hebat untuk debugging.  Tetapi dalam pengalaman saya, saya jarang menggunakan ini, dan harga yang harus dibayar tampaknya terlalu tinggi untuk keuntungan kecil. </p><br><p>  Dalam semua aplikasi Bereaksi dan Bereaksi Asli kami, kami telah berhasil menggunakan pendekatan yang mirip dengan yang dijelaskan dalam artikel ini.  Faktanya, kami tidak pernah merasakan kebutuhan akan sistem manajemen negara yang lebih kompleks daripada ini. </p><br><h1 id="primechaniya">  Catatan </h1><br><p>  Kelas yang dapat <code>Observable</code> diperkenalkan dalam posting ini cukup sederhana.  Ini dapat diganti dengan implementasi yang lebih maju seperti micro-observable (perpustakaan kami sendiri) atau RxJS. </p><br><p>  Solusi yang disajikan di sini sangat mirip dengan apa yang dapat dicapai dengan MobX.  Perbedaan utama adalah bahwa MobX mendukung sifat yang dapat berubah-ubah dari keadaan objek.  Itu juga bergantung pada proksi ES6 untuk memberitahukan perubahan, secara implisit merender ulang, dan menyulitkan proses debug ketika hal-hal tidak berjalan seperti yang diharapkan.  Selain itu, MobX tidak berfungsi dengan baik dengan fungsi asinkron. </p><br><blockquote>  Dari penerjemah: Publikasi ini, yang dapat dilihat sebagai pengantar manajemen negara menggunakan Observable, adalah kelanjutan dari topik yang dibahas dalam artikel <a href="https://habr.com/ru/post/483526/">Mengelola Aplikasi Negara dengan RxJS / Immer sebagai alternatif sederhana untuk Redux / MobX</a> , yang menjelaskan cara menyederhanakan penggunaan pendekatan ini. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id484952/">https://habr.com/ru/post/id484952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id484934/index.html">Dari pengembangan pribadi hingga Agile dalam skala XXXL dalam dua hari di TeamLead Conf</a></li>
<li><a href="../id484936/index.html">Pengetahuan dan kompetensi dalam tim: menemukan, melihat, memompa</a></li>
<li><a href="../id484944/index.html">Apa yang saya dalam ACID atau tidak cocok untuk kita</a></li>
<li><a href="../id484946/index.html">Pemodelan GPR</a></li>
<li><a href="../id484948/index.html">NEC merilis kabel bawah laut dengan rekor 20 pasang serat optik</a></li>
<li><a href="../id484954/index.html">Panduan Pemecahan Masalah Visual untuk Kubernetes</a></li>
<li><a href="../id484964/index.html">Mengkonfigurasi keseimbangan beban pada InfoWatch Traffic Monitor</a></li>
<li><a href="../id484966/index.html">Template siap pakai untuk pengujian menggunakan Spring</a></li>
<li><a href="../id484968/index.html">WPF DataGrid. Berjuang untuk Templat</a></li>
<li><a href="../id484972/index.html">Wine 5.0 dirilis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>