<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê© üíÖüèø ü§öüèΩ Cara menggunakan metode kuadrat terkecil untuk mengevaluasi sumber daya dan memonitor database Oracle ü•â üö´ üîÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam operasi sehari-hari, administrator database Oracle perlu melacak sejumlah besar metrik dalam hal throughput, memuat, pertumbuhan DBMS, host DBMS...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara menggunakan metode kuadrat terkecil untuk mengevaluasi sumber daya dan memonitor database Oracle</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vtb/blog/431112/"> Dalam operasi sehari-hari, administrator database Oracle perlu melacak sejumlah besar metrik dalam hal throughput, memuat, pertumbuhan DBMS, host DBMS, subsistem disk, dll.  Semua data ini dikumpulkan dan disimpan dengan cermat oleh sistem pemantauan.  Agar informasi tersebut tidak berbobot mati, dapat digunakan untuk peramalan dalam hal masalah ukuran dan bahkan pemantauan proaktif.  Dalam posting ini kami akan menunjukkan cara melakukannya. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/72c/f01/1bf/72cf011bfc922f999875aa9aa56e4678.png"><br><a name="habracut"></a><br>  Ambil Oracle Cloud Control.  Dalam skema SYSMAN dalam tampilan <code>MGMT_METRICS_1DAY</code> , kami menyimpan nilai metrik ‚ÄúRuang <code>TARGET_GUID = '6B1E3AFA92B3EA29AD73BB87432C084C'</code> Tersedia (MB)‚Äù untuk host dengan <code>TARGET_GUID = '6B1E3AFA92B3EA29AD73BB87432C084C'</code> . <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TO_CHAR (<span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span> (ROLLUP_TIMESTAMP <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>), <span class="hljs-string"><span class="hljs-string">'YYYY-MM-DD"T"HH24:MI:SS'</span></span>),        <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span> (VALUE_AVERAGE, <span class="hljs-number"><span class="hljs-number">2</span></span>) AVG_FREE_SPACE_INM   <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> SYSMAN.MGMT_METRICS_1DAY  <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> TARGET_GUID = <span class="hljs-string"><span class="hljs-string">'6B1E3AFA92B3EA29AD73BB87432C084C'</span></span>        <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> METRIC_GUID = HEXTORAW (<span class="hljs-string"><span class="hljs-string">'E8838C71E687BF0A9E02FFACC0C9AC80'</span></span>)        <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> KEY_VALUE = <span class="hljs-string"><span class="hljs-string">'/u10'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ROLLUP_TIMESTAMP;</code> </pre><br>  Grafik di bawah ini menunjukkan bahwa selama tiga bulan, dari 14 Agustus 2018 hingga 15 November 2018, ruang kosong di sistem file / u01 menurun 1,5TB - dari 4,1 TB menjadi 2,6 TB <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a6/7e0/845/5a67e0845772e7c839e22085ad274d01.png"><br><br>  Untuk menentukan waktu yang tersisa untuk 2,6 TB sudah cukup bagi kami, kami beralih ke fungsi regresi linier. <br><br>  Oracle menggunakan fungsi <code>REGR_SLOPE(x,y)</code> untuk menghitung kemiringan garis regresi.  Fungsi kemiringan garis regresi REGR_SLOPE ditentukan oleh rasio kovarians dari himpunan x dan y terhadap varians himpunan y: <br><br><pre> <code class="sql hljs">REGR_SLOPE(x,y) = COVAR_POP(x,y) / VAR_POP(y)</code> </pre> <br>  Untuk menghitung penangkapan sumbu Y, gunakan fungsi <code>REGR_INTERCEPT(x,y)</code> .  Fungsi intersepsi Y-axis <code>REGR_INTERCEPT</code> ditentukan oleh perbedaan antara nilai rata-rata himpunan x dan produk dari kemiringan garis regresi dan nilai rata-rata himpunan y: <br><br><pre> <code class="sql hljs">REGR_INTERCEPT(x,y) = AVG(x) ‚Äì REGR_SLOPE(x, y) * AVG(y)</code> </pre> <br>  Untuk menghitung R-square atau koefisien determinasi, fungsi REGR_R2 (x, y) digunakan, yang tidak didefinisikan pada varians nol y, dan sama dengan kesatuan pada dispersi nol x dan varians nol bukan y.  Dan dalam kasus varian positif x dan varian non-nol dari y sama dengan kuadrat korelasi x dan y: <br><br><pre> <code class="sql hljs">NULL if VAR_POP(y)  = 0 1 if VAR_POP(x)  = 0 and VAR_POP(y) != 0 POWER(CORR(expr1,expr),2) if VAR_POP(x)  &gt; 0 and VAR_POP(y)  != 0</code> </pre> <br>  Kami akan menggambarkan koefisien determinasi sebagai kuantitas yang mencirikan persentase variasi yang dijelaskan oleh model.  Jika koefisien determinasi adalah 1, maka model kami menjelaskan 100% variasi dan perkiraan kami akan seakurat mungkin. <br><br>  Kami mengusulkan untuk mengambil selisih x saat metrik diterima dan waktu saat ini - ROLLUP_TIMESTAMP-SYSDATE.  Seperti yang kita ambil nilai rata-rata ruang disk yang tersisa bebas / u01 di MB - "Filesystem Space Available (MB)".  Dalam hal ini, menggunakan fungsi REGR_INTERCEPT (ROLLUP_TIMESTAMP-SYSDATE, VALUE_AVERAGE) sebagai fungsi grup, kita dapat memperkirakan berapa hari ruang disk / u01 akan habis. <br><br>  Dalam bentuk diperluas, nilai fungsi kemiringan garis regresi, intersepsi sumbu dan koefisien determinasi diperoleh dengan kueri <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">COVAR_POP</span></span> (ROLLUP_TIMESTAMP - <span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span> (VALUE_AVERAGE, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>)) / VAR_POP (<span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span> (VALUE_AVERAGE, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">REGR_SLOPE</span></span>,        <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span> (ROLLUP_TIMESTAMP)- (<span class="hljs-keyword"><span class="hljs-keyword">COVAR_POP</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span> - ROLLUP_TIMESTAMP, <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span> (VALUE_AVERAGE, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>))/VAR_POP(<span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(VALUE_AVERAGE, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>)))*<span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(VALUE_AVERAGE, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>))           <span class="hljs-keyword"><span class="hljs-keyword">REGR_INTERCEPT</span></span>,        <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span> - ROLLUP_TIMESTAMP)-(<span class="hljs-keyword"><span class="hljs-keyword">COVAR_POP</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span> - ROLLUP_TIMESTAMP,<span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(VALUE_AVERAGE,<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-number"><span class="hljs-number">0</span></span>))/VAR_POP(<span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(VALUE_AVERAGE,<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-number"><span class="hljs-number">0</span></span>)))*<span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(VALUE_AVERAGE,<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-number"><span class="hljs-number">0</span></span>)))      REGR_INTERCEPT_ABS,        <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> VAR_POP (<span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span> (VALUE_AVERAGE, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span>              <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span>     VAR_POP (<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span> - ROLLUP_TIMESTAMP) = <span class="hljs-number"><span class="hljs-number">0</span></span>                <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> VAR_POP (<span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span> (VALUE_AVERAGE, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>)) != <span class="hljs-number"><span class="hljs-number">0</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span>              <span class="hljs-number"><span class="hljs-number">1</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span>     VAR_POP (<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span> - ROLLUP_TIMESTAMP) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>                <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> VAR_POP (<span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span> (VALUE_AVERAGE, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>)) != <span class="hljs-number"><span class="hljs-number">0</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span>              <span class="hljs-keyword"><span class="hljs-keyword">POWER</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">CORR</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span> - ROLLUP_TIMESTAMP, <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span> (VALUE_AVERAGE, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>)),<span class="hljs-number"><span class="hljs-number">2</span></span>)        <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">REGR_R2</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> MGMT_METRICS_1DAY  <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> TARGET_GUID = <span class="hljs-string"><span class="hljs-string">'6B1E3AFA92B3EA29AD73BB87432C084C'</span></span>        <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> METRIC_GUID = HEXTORAW (<span class="hljs-string"><span class="hljs-string">'E8838C71E687BF0A9E02FFACC0C9AC80'</span></span>)        <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> KEY_VALUE = <span class="hljs-string"><span class="hljs-string">'/u10'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ROLLUP_TIMESTAMP;</code> </pre> <br>  Atau sudah menggunakan fungsi <code>REGR_SLOPE</code> , <code>REGR_INTERCEPT</code> dan <code>REGR_R2</code> : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REGR_SLOPE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span>-ROLLUP_TIMESTAMP, <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(VALUE_AVERAGE,<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-number"><span class="hljs-number">0</span></span>)) RSLP,      <span class="hljs-keyword"><span class="hljs-keyword">REGR_INTERCEPT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span>-ROLLUP_TIMESTAMP, <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(VALUE_AVERAGE,<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-number"><span class="hljs-number">0</span></span>)) RINSP,       <span class="hljs-keyword"><span class="hljs-keyword">REGR_R2</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span>-ROLLUP_TIMESTAMP, <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(VALUE_AVERAGE,<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-number"><span class="hljs-number">0</span></span>)) RSQR      <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> MGMT_METRICS_1DAY      <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> TARGET_GUID=<span class="hljs-string"><span class="hljs-string">'6B1E3AFA92B3EA29AD73BB87432C084C'</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> METRIC_GUID=HEXTORAW(<span class="hljs-string"><span class="hljs-string">'E8838C71E687BF0A9E02FFACC0C9AC80'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> KEY_VALUE=<span class="hljs-string"><span class="hljs-string">'/u10'</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ROLLUP_TIMESTAMP;</code> </pre> <br><pre> <code class="plaintext hljs">REGR_SLOPE = -0.00005 REGR_INTERCEPT = 149.46 REGR_R2 = 0.97</code> </pre> <br>  Dalam kasus kami, koefisien determinasi mendekati 1, dan kami melihat bahwa setelah sekitar 149 hari tempat pada sistem file / u10 akan berakhir. <br><br>  Kita dapat menggunakan metode ini untuk memperkirakan waktu di mana kita memiliki ruang disk yang cukup untuk host dari database produktif.  Dalam kasus kami, host dari database produktif dimasukkan dalam grup dengan <code>METRIC_GUID='E8838C71E687BF0A9E02FFACC0C9AC80'</code> . <br><br>  Kami membuat <code>User Definded Type T_TYPE</code> dengan bidang yang kami butuhkan untuk output: nama host, nama sistem file, kemiringan garis regresi, jumlah hari setelah ruang ruang pada sistem file berakhir dan koefisien determinasi. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> T_TYPE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OBJECT</span></span>(TARGET_NAME VARCHAR2(<span class="hljs-number"><span class="hljs-number">256</span></span>), KEY_VALUE VARCHAR2(<span class="hljs-number"><span class="hljs-number">256</span></span>), RSLP <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>,RINSP <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>,RSQR <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>);</code> </pre> <br>  Buat Tabel Bersarang Jenis R_TYPE berdasarkan T_TYPE: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> R_TYPE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> T_TYPE;</code> </pre> <br>  Kami membuat paket yang menyertakan fungsi <code>GET_VALUES</code> untuk mengekstraksi data dari <code>MGMT_METRICS_1DAY</code> dan prosedur untuk mengirim data yang diterima melalui surat <code>SEND_VALUES</code> . <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PACKAGE</span></span> EST_FS_EXHAUST <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span></code> </pre> <br>  Untuk fungsi <code>GET_VALUES</code> parameter input akan menjadi variabel <code>V_GN</code> dengan nama grup host dan nilai koefisien determinasi <code>V_RSQ</code> . <br><br><pre> <code class="sql hljs">FUNCTION GET_VALUES(V_GN VARCHAR2, V_RSQ NUMBER) RETURN R_TYPE;</code> </pre> <br>  Untuk prosedur <code>SEND_VALUES</code> parameter input akan menjadi variabel <code>V_GN</code> dan <code>V_RSQ</code> , mirip dengan variabel fungsi <code>GET_VALUES</code> , ditambah email yang akan kami kirimi mini-report kami. <br><br><pre> <code class="sql hljs">PROCEDURE SEND_VALUES(V_GN VARCHAR2, V_RSQ NUMBER, V_MAIL VARCHAR2); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> EST_FS_EXHAUST;</code> </pre><br>  Dalam tubuh paket, kami mendefinisikan fungsi <code>GET_VALUES</code> dan prosedur <code>SEND_VALUES</code> <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PACKAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span> EST_FS_EXHAUST <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> GET_VALUES(V_GN VARCHAR2, V_RSQ <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> R_TYPE <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span>  V_REC R_TYPE; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> T_TYPE( M.TARGET_NAME, D.KEY_VALUE, <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">REGR_SLOPE</span></span>(D.ROLLUP_TIMESTAMP-<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(D.VALUE_AVERAGE,<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-number"><span class="hljs-number">0</span></span>)),<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">ABS</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">REGR_INTERCEPT</span></span>(D.ROLLUP_TIMESTAMP-<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(D.VALUE_AVERAGE,<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-number"><span class="hljs-number">0</span></span>)))),<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">REGR_R2</span></span>(D.ROLLUP_TIMESTAMP-<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(D.VALUE_AVERAGE,<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-number"><span class="hljs-number">0</span></span>)),<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">BULK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLLECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> V_REC <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> MGMT_METRICS_1DAY D, MGMT_TARGETS M, MGMT_TARGET_MEMBERSHIPS G <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> M.TARGET_GUID=G.MEMBER_TARGET_GUID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> M.TARGET_GUID=D.TARGET_GUID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> G.COMPOSITE_TARGET_NAME=V_GN <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> METRIC_GUID=HEXTORAW(<span class="hljs-string"><span class="hljs-string">'E8838C71E687BF0A9E02FFACC0C9AC80'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> M.TARGET_NAME, D.KEY_VALUE <span class="hljs-keyword"><span class="hljs-keyword">HAVING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REGR_R2</span></span>(D.ROLLUP_TIMESTAMP-<span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NULLIF</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(D.VALUE_AVERAGE,<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-number"><span class="hljs-number">0</span></span>)) &gt; V_RSQ      ; RETURN V_REC; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> GET_VALUES; PROCEDURE SEND_VALUES(V_GN VARCHAR2, V_RSQ NUMBER, V_MAIL VARCHAR2) IS V_REC R_TYPE; MSG VARCHAR2(2048):=''; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> V_REC:= GET_VALUES(V_GN,V_RSQ); FOR I IN V_REC.FIRST..V_REC.LAST LOOP MSG:=CHR(10)||MSG||' Host '||V_REC(I).TARGET_NAME||' filesystem '||V_REC(I).KEY_VALUE||' will be exhausted in '||V_REC(I).RINSP||' days'|| CHR(9)||CHR(10); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOOP</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IMMEDIATE</span></span> <span class="hljs-string"><span class="hljs-string">'ALTER SESSION SET smtp_out_server = ''mail_server'''</span></span>; UTL_MAIL.SEND(SENDER =&gt; 'monitoring@yourmail.com',       RECIPIENTS =&gt; V_MAIL,          SUBJECT =&gt; 'Test Mail',          MESSAGE =&gt; MSG,        MIME_TYPE =&gt; 'text; charset=us-ascii'); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> EST_FS_EXHAUST; /</code> </pre><br>  Misalkan kita ingin mendapatkan waktu setelah itu tempat di sistem file 'host_hosts' grup produktif berakhir dengan koefisien determinasi lebih besar dari 0,5: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> EST_FS_EXHAUST.SEND_VALUES(<span class="hljs-string"><span class="hljs-string">'prod_hosts'</span></span>,<span class="hljs-number"><span class="hljs-number">0.5</span></span>,<span class="hljs-string"><span class="hljs-string">'operator@yourdomain.com'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; / PL/SQL procedure successfully completed.</code> </pre><br>  Akibatnya, sebuah pesan tiba di surat: <br><br>  Host filesystem1 / u51 akan habis dalam 342 hari <br>  Sistem file host2 host / u40 akan habis dalam 236 hari <br>  <b>Host filesystem3 / u20 / redo01 akan habis dalam 1100310 hari</b> <br>  Sistem file host host4 / u10 akan habis dalam 150 hari <br>  Host filesystem4 host / u01 / integrasi akan habis dalam 75080 hari <br>  Host filesystem4 host / u01 / app akan habis dalam 135 hari <br>  <b>Host filesystem5 host / u30 / redo01 akan habis dalam 62252596 hari</b> <br>  Host filesystem6 / u01 akan habis dalam 260 hari <br>  Sistem file host host7 / u99 akan habis dalam 1038 hari <br><br>  Perhatikan sistem file / u20 / redo01 dan / u30 / redo01 - ini adalah REDO LOGS dan tempatnya tidak sia-sia.  Model kami memperkirakan bahwa tempat di / u20 / redo01 pada host3 akan berakhir dalam 2990 tahun, dan di / u30 / redo01 pada host5 dalam 169164 tahun.  Dalam kedua kasus, kemiringan garis regresi kurang dari -1. <br><br>  Penggunaan metode ini dapat diperluas - misalnya, untuk memperkirakan waktu sebelum kehabisan ruang di FAST RECOVERY AREA, dalam ruang tabel database dan area lainnya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id431112/">https://habr.com/ru/post/id431112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id431102/index.html">Bagaimana alamat fisik ditampilkan dalam string DRAM dan bank</a></li>
<li><a href="../id431104/index.html">Bagaimana Kami di Neoflex Mengembangkan Keahlian DevOps</a></li>
<li><a href="../id431106/index.html">Berapa banyak uang yang dihabiskan orang Amerika Black Friday ini, dan apa hubungannya smartphone dengan itu?</a></li>
<li><a href="../id431108/index.html">Cara mengubah citra satelit menjadi peta. Visi komputer dalam Yandex</a></li>
<li><a href="../id431110/index.html">Berhenti memberi makan penerbit. UE sedang mengembangkan aturan untuk akses gratis wajib untuk penelitian</a></li>
<li><a href="../id431116/index.html">Ingin aneh: ulasan tentang konferensi DartUP mendatang di St. Petersburg</a></li>
<li><a href="../id431118/index.html">Seluruh kebenaran tentang RTOS. Artikel # 22. Kotak Surat: Layanan Tambahan dan Struktur Data</a></li>
<li><a href="../id431120/index.html">Penderitaan di tempat kerja tidak perlu</a></li>
<li><a href="../id431122/index.html">Grafana sebagai alat lain untuk pemantauan teknis produk perangkat lunak kami</a></li>
<li><a href="../id431124/index.html">"Ilmu Data, seperti matematika dan fisika, adalah cara lain untuk menjelajahi dunia di sekitar Anda."</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>