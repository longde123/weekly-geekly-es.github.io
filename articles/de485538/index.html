<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÉüèΩ üèîÔ∏è üë®üèø‚Äçü§ù‚Äçüë®üèΩ Zabbix: alles hintereinander √ºberwachen (am Beispiel von Redis) üåí üî∞ üéØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zabbix ist ein gro√üartiges Produkt f√ºr Administratoren gro√üer Software- und Hardwaresysteme. Es ist so gut, dass es nicht nur von Gro√üunternehmen, son...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix: alles hintereinander √ºberwachen (am Beispiel von Redis)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485538/"><p> <a href="https://www.zabbix.com/ru/" rel="nofollow">Zabbix</a> ist ein gro√üartiges Produkt f√ºr Administratoren gro√üer Software- und Hardwaresysteme.  Es ist so gut, dass es nicht nur von Gro√üunternehmen, sondern auch von mittelst√§ndischen Unternehmen und sogar in einem <code>pet</code> .  Im Allgemeinen habe ich wenig Erfahrung mit Zabbix und kann es ohne Bedenken zur Verwendung empfehlen. </p><br><p>  Nat√ºrlich kann ich nicht sagen, dass ich die ‚Äû <em>Zabbix-Philosophie</em> ‚Äú verstehe.  Trotz der umfangreichen detaillierten Dokumentation in russischer Sprache war es f√ºr mich schwierig, in die Welt von Zabbix einzutauchen - ich hatte das Gef√ºhl, dass die Entwickler und ich die gleichen Dinge bei unterschiedlichen Namen nannten.  Vielleicht, weil Zabbix von Admins f√ºr Admins erstellt wurde, aber ich bin immer noch ein Entwickler und ein Benutzer. </p><br><p>  Um Zabbix auszuf√ºhren und die wichtigsten Parameter von Computersystemen (Prozessor, Speicher usw.) zu √ºberwachen, sind jedoch die F√§higkeiten eines normalen Linux-Benutzers ausreichend.  Es gibt eine gro√üe Anzahl von Plug-Ins von Drittanbietern, die die Funktionen von Zabbix erweitern.  F√ºr meine Bed√ºrfnisse musste ich die √úberwachung des Redis-Servers konfigurieren.  Ich habe ein wenig im Code der verf√ºgbaren Plug-Ins gest√∂bert und anhand ihres Beispiels herausgefunden, dass die Architektur von Zabbix es Ihnen erm√∂glicht, einfach eine Verbindung zur √úberwachung aller Parameter von Informationssystemen herzustellen, die in numerischer Form ausgedr√ºckt werden k√∂nnen. </p><br><p>  Unter der Katze - ein Beispiel f√ºr ein Zabbix-Plugin mit meiner Erkl√§rung der Zabbix-Terminologie.  F√ºr einige wird dieses Beispiel naiv erscheinen, f√ºr andere wird es einfacher sein, sich mit Konzepten vertraut zu machen.  In jedem Fall ist Zabbix <a href="http://irinagold.pro/na-kogo-pohozh-slon-pritcha/" rel="nofollow">gro√ü genug</a> , um es aus verschiedenen Blickwinkeln zu f√ºhlen. </p><a name="habracut"></a><br><h1 id="bazovye-ponyatiya">  Grundlegende Konzepte </h1><br><p>  Kurz √ºber einige der in Zabbix verwendeten Konzepte: <em>Agenten</em> , <em>Elemente</em> , <em>Trigger</em> , <em>Aktionen</em> , <em>Benachrichtigungen</em> , <em>Vorlagen</em> . </p><br><h2 id="server-i-agenty">  Server und Agenten </h2><br><p>  Aus Sicht des Benutzers ist Zabbix in zwei gro√üe Teile unterteilt: Server und Agenten.  Der Server befindet sich auf einem Computer, auf dem statistische Daten erfasst und gespeichert werden, und Agenten auf den Computern, auf denen Daten erfasst werden: </p><br><p><img src="https://habrastorage.org/webt/22/cc/y2/22ccy2szuqjhs0eprqqxkn29-2e.png" alt="Zabbix Server und Agenten"></p><br><h2 id="parametry-monitoringa">  √úberwachungsoptionen </h2><br><p>  Jede Menge, die in numerischer Form oder als Zeichenfolge ausgedr√ºckt werden kann, wird in der Terminologie von Zabbix - einem Datenelement (Element) - aufgerufen.  Jedem Element ist ein eindeutiger <a href="https://www.zabbix.com/documentation/current/ru/manual/config/items/item/key" rel="nofollow">Schl√ºssel</a> (Name) zugeordnet.  Hier sind Beispiele f√ºr Datenelemente: </p><br><ul><li>  <strong>system.cpu.load [percpu, avg1]</strong> : 0.1167 </li><li>  <strong>system.uname</strong> : "Linux supru 4.15.0-50-generic # 54-Ubuntu SMP Mo 6. Mai 18:46:08 UTC 2019 x86_64" </li></ul><br><p>  Die Werte dieser Datenelemente (√úberwachungsparameter) werden an die Zeit angeh√§ngt, die Historie der Parameterwerte wird in der Serverdatenbank gespeichert. </p><br><h2 id="sobytiya">  Ereignisse </h2><br><p>  Wenn ein Ereignis in Zabbix eintritt, wird ein Trigger ausgel√∂st.  Zum Beispiel </p><br><ul><li>  <strong>{system.cpu.load [percpu, avg1] .avg (5m)}&gt; 10</strong> - Der Durchschnittswert des Parameters in den letzten 5 Minuten hat "10" √ºberschritten. </li><li>  <strong>{system.uname.diff (0)}&gt; 0</strong> - Der aktuelle Wert des Parameters entspricht nicht dem vorherigen Wert </li></ul><br><p>  Tats√§chlich sind Trigger Formeln, in denen die √úberwachungsparameter (aktuell und gespeichert) als Variablen fungieren und die am Ausgang <code>true</code> / <code>false</code> ergeben. </p><br><h2 id="deystviya-i-opovescheniya">  Aktionen und Warnungen </h2><br><p>  Im Ereignisfall (Trigger) kann der Server eine Aktion ausf√ºhren.  Senden Sie beispielsweise eine E-Mail-Benachrichtigung an eine bestimmte Adresse (" <em>Problem: Host ist 5 Minuten lang nicht erreichbar</em> ").  Eine Aktion kann auch ausgef√ºhrt werden, wenn der Trigger in seinen urspr√ºnglichen Zustand zur√ºckkehrt (" <em>Behoben: Host ist 5 Minuten lang nicht erreichbar</em> ").  Alle Ereignisse (Trigger Switching) werden serverseitig protokolliert. </p><br><h2 id="shablony">  Muster </h2><br><p>  Mit Zabbix k√∂nnen Sie √úberwachungsregeln f√ºr einen einzelnen Host konfigurieren und eine Regelvorlage (Template) erstellen, die auf verschiedene Hosts angewendet werden kann: </p><br><p><img src="https://habrastorage.org/webt/4t/yt/qw/4tytqw7tog1do4nsqoizzxjbglw.png" alt="zabbix vorlagen"></p><br><p>  Das Beispiel zeigt, dass die Vorlage "Template App SSH Service" eine Anwendung (Applications), einen √úberwachungsparameter (Items) und einen Trigger (Trigger) beschreibt.  Beschreibungen f√ºr Diagramme, Bildschirme, Erkennungsregeln und Webskripts sind ebenfalls verf√ºgbar. </p><br><h1 id="postanovka-zadachi-dlya-plagina">  Festlegen der Aufgabe f√ºr das Plugin </h1><br><h2 id="nachalnoe-polozhenie">  Ausgangsposition </h2><br><p>  Zabbix selbst bietet ein <a href="https://www.zabbix.com/ru/integrations/redis" rel="nofollow">eigenes Plugin</a> zur √úberwachung des Status von Redis an, aber auf meiner Serverversion (4.2.8) konnte ich es nicht verwenden (Plugin f√ºr Version 4.4 und h√∂her).  <a href="https://www.zabbix.com/ru/integrations/redis" rel="nofollow">Es werden auch L√∂sungen von Drittanbietern</a> angeboten (etwa ein Dutzend Optionen f√ºr verschiedene Versionen von Zabbix, es gibt nur die ersten drei auf dem Bild): </p><br><p><img src="https://habrastorage.org/webt/bv/pt/tk/bvpttkxf9lkxqn2thcnwwacutyw.png" alt="Redis Plugins f√ºr zabbix"></p><br><p>  Jeder von ihnen hatte seine eigenen Vor- und Nachteile, musste hineinschauen, um zu w√§hlen.  Das Beste war meiner Meinung nach das <a href="https://github.com/Shakeeljaveed/zabbix-redis-userparamaters" rel="nofollow">Plugin Shakeeljaveed / zabbix-redis-userparamaters</a> , das aus zwei Dateien bestand: </p><br><ul><li>  README.md </li><li>  redis-userparameter.conf </li></ul><br><p>  Ich musste ein wenig "Stifte" arbeiten, aber an seinem Beispiel wurde etwas klarer, wie die Daten vom Agenten zum Server gelangen.  Auf Vorschlag des Autors <a href="https://github.com/Shakeeljaveed" rel="nofollow">Javeed Shakeel wurde der</a> Status von <a href="https://github.com/Shakeeljaveed" rel="nofollow">Redis</a> alle 2 Minuten von der Krone auf die <code>/tmp/redismetric</code> : </p><br><pre> <code class="plaintext hljs">*/2 * * * * /usr/bin/redis-cli info &gt; /tmp/redismetric</code> </pre> <br><p>  Anschlie√üend wurde jeder √úberwachungsparameter vom Agenten mit den Tools des Betriebssystems selbst aus der <code>/tmp/redismetric</code> extrahiert.  Anweisungen hierzu wurden in der Konfiguration des Zabbix-Agenten <code>/etc/zabbix/zabbix_agent.conf.d/userparameter_redis.conf</code> .  So sieht beispielsweise die Anweisung zum Abrufen des Parameters <code>used_memory</code> (Speicherbelegung durch den Redis-Server) aus: </p><br><pre> <code class="plaintext hljs">UserParameter=used_memory,grep -w 'used_memory' /tmp/redismetric | cut -d: -f2</code> </pre> <br><p>  Das hei√üt, in der <code>/tmp/redismetric</code> mit der Ausgabe von <code>redis-cli INFO</code> wird der String ( <code>grep -w ...</code> ) vom <code>used_memory</code> Schl√ºssel gesucht </p><br><pre> <code class="plaintext hljs">used_memory:7153216</code> </pre> <br><p>  welches dann durch das Trennzeichen ":" in Spalten aufgeteilt wird ( <code>cut -d: -f2</code> ).  Am Ausgang erh√§lt der Agent die Nummer <code>7153216</code> und weist sie dem Parameter <code>used_memory</code> . </p><br><p>  Der Server muss weiterhin √ºber die webbasierte Schnittstelle so konfiguriert werden, dass er regelm√§√üig Anforderungen an den Agenten sendet, um Daten mithilfe des Parameters <code>used_memory</code> zu empfangen. <code>used_memory</code> werden die Daten auf den in der Datenbank gespeicherten Server √ºbertragen. Sie k√∂nnen damit Diagramme erstellen und Trigger erstellen, die auf √Ñnderungen an diesem Parameter reagieren. </p><br><h2 id="cel">  Zweck </h2><br><p>  Die Aufgabe der Status√ºberwachung eines Systems besteht nicht nur in der Erfassung von Statistiken, sondern auch in der Warnung vor dem Auftreten von Situationen, die menschliches Eingreifen erfordern.  Da ich mit Redis als unerfahrener Benutzer arbeite, musste ich nach Informationen suchen, auf welche "Gesundheits" -Parameter ich achten sollte und was sie bedeuten.  Der w√ºrdigste Artikel lautete " <a href="https://scalegrid.io/blog/6-crucial-redis-monitoring-metrics/" rel="nofollow">6 wichtige Redis-√úberwachungsmetriken, die Sie beobachten m√ºssen</a> ".  Nachdem ich es analysiert hatte, kam ich zu dem Schluss, dass ich, um vollkommen gl√ºcklich zu sein, Daten sammeln muss, um die folgenden Ereignisse zu erkennen: </p><br><ul><li>  Speicherfragmentierung: used_memory_rss / used_memory&gt; 1.5 </li><li>  Niedrige Cachetrefferquote: (keyspace_hits) / (keyspace_hits + keyspace_misses) &lt;0.8 </li><li>  Abgelehnte Verbindungen: reject_connections&gt; 0 </li><li>  Ausgeschlossene Schl√ºssel: evicted_keys&gt; 0 </li></ul><br><p>  Ich wollte auch Statistiken √ºber zus√§tzliche Parameter (Redis-Version, Betriebszeit usw.) sammeln.  Wenn Sie eine allgemeine Vorstellung davon haben, wie die Daten vom Agenten erfasst und an den Server √ºbertragen werden, kann Wishlist stark eingeschr√§nkt sein.  Als Ergebnis haben wir eine Liste von Parametern f√ºr die √úberwachung von 12 Positionen erhalten. </p><br><h1 id="sozdanie-sobstvennogo-plagina">  Erstelle dein eigenes Plugin </h1><br><h2 id="parametry-monitoringa-1">  √úberwachungsoptionen </h2><br><p>  Das von mir analysierte Plugin ging von der Ausf√ºhrung eines separaten Befehls aus, um einen separaten Parameter (Datenelement, Element) zu erhalten: </p><br><pre> <code class="plaintext hljs">grep -w 'used_memory' /tmp/redismetric | cut -d: -f2</code> </pre> <br><p>  Das hei√üt, um Daten zu 12 Parametern zu erhalten, muss der Agent 12-mal verschiedene Befehlss√§tze ausf√ºhren.  Und wenn ich Parameter √ºberwachen muss, die mit einer Befehlskette schwer zu extrahieren sind und ein separates Shell-Skript oder ein vollwertiges Programm schreiben m√ºssen?  F√ºr eine solche "Wunschliste" bietet Zabbix eine Variante mit abh√§ngigen Datenelementen an.  Im Wesentlichen bildet das Skript auf der Agentenseite einen Datensatz (z. B. im JSON-Format), der als Zeichenfolgenparameter an den Server √ºbertragen wird.  Dann werden auf der Serverseite die empfangenen Daten analysiert und einzelne Elementarparameter daraus extrahiert. </p><br><h3 id="osnovnoy-element-dannyh">  Hauptdatenelement </h3><br><p>  Ich habe das Hauptdatenelement <code>redis.info</code> Zeichenfolgentyps mit einer Aktualisierungsdauer von 1 Minute beschrieben, ohne den √Ñnderungsverlauf zu speichern: </p><br><p><img src="https://habrastorage.org/webt/hz/_m/tn/hz_mtnfj7n2uqzbssnnsdhtpgq4.png" alt="Basiselement"></p><br><p>  Vermutlich sollte auf der Agentenseite der folgende JSON generiert werden: </p><br><pre> <code class="plaintext hljs">{ "version": "4.0.9", "uptime": 1897336, "used_memory": 1054943416, "used_memory_rss": 1138159616, "keyspace_hits": 75810274, "keyspace_misses": 13545949, "connected_clients": 15, "rdb_last_save_time": 1580126954, "total_connections_received": 1258614, "rejected_connections": 0, "expired_keys": 60270, "evicted_keys": 0 }</code> </pre> <br><p>  <code>redis.info</code> soll dieser Text als <code>redis.info</code> Datenelement an den Server <code>redis.info</code> , aber nicht gespeichert werden, sondern als Basis f√ºr andere Datenelemente (√úberwachungsparameter) dienen. </p><br><h3 id="zavisimyy-element-dannyh">  Abh√§ngiges Datenelement </h3><br><p>  Der <code>redis.info.version</code> h√§ngt von <code>redis.info</code> und speichert seine Werte 90 Tage lang in der Datenbank.  Die H√§ufigkeit der Parameter√ºberwachung ist abh√§ngig vom Basiselement ( <code>redis.info</code> ): </p><br><p><img src="https://habrastorage.org/webt/eu/3u/jy/eu3ujyhzzyful-jrh8ceyqxsoz4.png" alt="abh√§ngiger Gegenstand (Basis)"></p><br><p>  Der <code>redis.info.version</code> Parameters " <code>redis.info</code> wird mithilfe von JSONPath-Anweisungen aus dem Wert "redis.info" abgerufen: </p><br><p><img src="https://habrastorage.org/webt/pn/3j/ad/pn3jad7k78sxnpq7pl1ubne9btk.png" alt="abh√§ngiger Artikel (Vorverarbeitung)"></p><br><p>  Ein √§hnliches Schema beschreibt die √ºbrigen abh√§ngigen Datenelemente (√úberwachungsparameter), die in Form von JSON √ºbertragen werden.  Hier ist ein Beispiel f√ºr die Beschreibung des numerischen Parameters <code>redis.info.used_memory</code> : </p><br><p><img src="https://habrastorage.org/webt/rh/_t/d8/rh_td8dczrfqa2ejsihinaobiho.png" alt="abh√§ngiges Nummernelement (Basis)"></p><br><p>  Alles ist ziemlich transparent, mit Ausnahme der <code>Units</code> und der <code>Trend storage period</code> .  Ich habe den zweiten Punkt nicht verstanden, habe ihn standardm√§√üig verlassen und die Ma√üeinheiten werden in der <a href="https://www.zabbix.com/documentation/current/ru/manual/appendix/suffixes" rel="nofollow">Dokumentation</a> erl√§utert.  In diesem Fall wird der Wert von <code>redis.info.used_memory</code> in Bytes gemessen und im Webinterface auf Kilo / Mega / Giga /...-Bytes minimiert. </p><br><p>  Die Formel zum Extrahieren eines Werts aus JSON lautet: <code>JSONPath = $.used_memory</code> </p><br><h3 id="vychislyaemyy-element-dannyh">  Berechnetes Datenelement </h3><br><p>  Um die Fragmentierung des Speichers zu berechnen, wird die Beziehung <code>used_memory_rss</code> / <code>used_memory</code> verwendet. Auf dieser Grundlage wird ein Ausl√∂ser bestimmt, der ausgel√∂st wird, wenn das Verh√§ltnis 1,5 √ºberschreitet.  Zabbix hat einen berechneten Datenelementtyp: </p><br><p><img src="https://habrastorage.org/webt/iy/sd/4g/iysd4g2bqofdmwrvp9cpbguzvzo.png" alt="Artikel berechnen"></p><br><p>  Der Wert f√ºr den Parameter <code>redis.info.used_memory_ratio</code> jede Minute basierend auf den letzten Werten von zwei anderen Parametern ( <code>redis.info.used_memory_rss</code> und <code>redis.info.used_memory</code> ) <code>redis.info.used_memory_rss</code> und 90 Tage in der Datenbank gespeichert. </p><br><h2 id="triggery">  Ausl√∂ser </h2><br><p>  Hier ist ein Beispiel f√ºr einen Trigger, der ausgel√∂st wird, wenn der Speicher zu fragmentiert ist: </p><br><p><img src="https://habrastorage.org/webt/bl/81/oj/bl81ojowbfvanebjn9nefzoh29w.png"></p><br><p>  Nichts Ungew√∂hnliches au√üer dem Ausdrucksformat, das in der √Ñnderungsformel f√ºr den Triggerstatus verwendet wird.  Zabbix verf√ºgt √ºber einen Formularkonstruktor, den Sie verwenden oder in der <a href="https://www.zabbix.com/documentation/current/ru/manual/config/triggers/expression" rel="nofollow">Dokumentation</a> / den Beispielen nachlesen k√∂nnen (die Liste der Trigger finden Sie √ºber die Weboberfl√§che unter " <em>Konfiguration / Vorlagen / $ {Vorlagenname} / Trigger</em> "). </p><br><p>  Ein Trigger kann auf beliebigen Datenelementen (Elementen) basieren, unabh√§ngig von ihrem Typ (Haupt, Abh√§ngig, Berechnet). </p><br><h2 id="nastroyka-agenta">  Agent-Setup </h2><br><h3 id="generaciya-jsona">  JSON-Generation </h3><br><p>  Um die Werte der √úberwachungsparameter und die Bildung von JSON abzurufen, verwende ich dieses Shell-Skript: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash ## =========================================================================== # Script to generate Redis monitoring data in JSON format # for 'zabbix-agent'. ## =========================================================================== # collect working variables/data BIN_REDIS=$(whereis -b redis-cli | cut -d" " -f2) # /usr/bin/redis-cli DATA_INFO=$(${BIN_REDIS} INFO | tr -d '\r') # get info and remove trailing '\r' from output ## # Extract stats and save it into env. vars. ## # find lines with 'grep', cut second field after ":" and put it into env. variable: ITEM_VERSION=$(grep "^redis_version:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_UPTIME=$(grep "^uptime_in_seconds:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_USED_MEMORY=$(grep "^used_memory:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_USED_MEMORY_RSS=$(grep "^used_memory_rss:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_KEYSPACE_HITS=$(grep "^keyspace_hits:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_KEYSPACE_MISSES=$(grep "^keyspace_misses:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_CONNECTED_CLIENTS=$(grep "^connected_clients:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_RDB_LAST_SAVE_TIME=$(grep "^rdb_last_save_time:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_TOTAL_CONNECTIONS_RECEIVED=$(grep "^total_connections_received:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_REJECTED_CONNECTIONS=$(grep "^rejected_connections:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_EXPIRED_KEYS=$(grep "^expired_keys:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_EVICTED_KEYS=$(grep "^evicted_keys:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) # compose output JSON for Zabbix server: echo -n "{" echo -n "\"version\": \"${ITEM_VERSION}\"," echo -n "\"uptime\": ${ITEM_UPTIME}," echo -n "\"used_memory\": ${ITEM_USED_MEMORY}," echo -n "\"used_memory_rss\": ${ITEM_USED_MEMORY_RSS}," echo -n "\"keyspace_hits\": ${ITEM_KEYSPACE_HITS}," echo -n "\"keyspace_misses\": ${ITEM_KEYSPACE_MISSES}," echo -n "\"connected_clients\": ${ITEM_CONNECTED_CLIENTS}," echo -n "\"rdb_last_save_time\": ${ITEM_RDB_LAST_SAVE_TIME}," echo -n "\"total_connections_received\": ${ITEM_TOTAL_CONNECTIONS_RECEIVED}," echo -n "\"rejected_connections\": ${ITEM_REJECTED_CONNECTIONS}," echo -n "\"expired_keys\": ${ITEM_EXPIRED_KEYS}," echo -n "\"evicted_keys\": ${ITEM_EVICTED_KEYS}" echo -n "}"</span></span></code> </pre> <br><p>  Ich habe dieses Skript in der Datei <code>/var/lib/zabbix/user_parameter/redis/get_info.sh</code> auf dem Server mit Redis <code>/var/lib/zabbix/user_parameter/redis/get_info.sh</code> auf dem der Zabbix-Agent bereits installiert ist.  Der Benutzer, unter dem der Zabbix-Agent <code>zabbix</code> (normalerweise <code>zabbix</code> ), muss √ºber die Berechtigung verf√ºgen, die Datei <code>get_info.sh</code> auszuf√ºhren. </p><br><h2 id="fayl-userparameter_xxxconf">  <code>userparameter_XXX.conf</code> Datei </h2><br><p>  Auf der Agentenseite werden zus√§tzliche √úberwachungsparameter in die <code>userparameter_*.conf</code> im Verzeichnis <code>userparameter_*.conf</code> .  Daher habe ich die Datei <code>/etc/zabbix/zabbix_agentd.d/userparameter_redis.conf</code> mit folgendem Inhalt erstellt, damit der Agent herausfinden kann, wie Daten f√ºr den Parameter <code>/etc/zabbix/zabbix_agentd.d/userparameter_redis.conf</code> werden m√ºssen: </p><br><pre> <code class="plaintext hljs">UserParameter=redis.info,/var/lib/zabbix/user_parameter/redis/get_info.sh</code> </pre> <br><p>  Das hei√üt, um Daten zum Parameter <code>redis.info</code> muss <code>redis.info</code> Agent das Skript <code>/var/lib/zabbix/user_parameter/redis/get_info.sh</code> und das Ergebnis der Ausf√ºhrung auf den Server √ºbertragen. </p><br><p>  Nach dem Neustart des Zabbix-Agenten ( <code>sudo service zabbix-agent restart</code> ) k√∂nnen Daten f√ºr den Parameter <code>redis.info</code> und an den Server gesendet werden. </p><br><h1 id="rezyume">  Zusammenfassung </h1><br><p>  Zabbix zu verstehen, fiel mir (und kommt immer noch) ziemlich schwer.  Trotzdem halte ich es f√ºr ein gro√üartiges Werkzeug, besonders nachdem ich mir die M√∂glichkeit erarbeitet habe, einfach meine eigenen √úberwachungsparameter (Datenelemente) hinzuzuf√ºgen.  Im Gro√üen und Ganzen f√ºgen Sie dem Server mit dem Agenten ( <code>userparameter_XXX.conf</code> ) nur eine Datei hinzu, und <code>userparameter_XXX.conf</code> mit einem Shell-Befehl, um Daten zu erfassen und den Zabbix-Server so zu konfigurieren, dass er diese Daten √ºber die Weboberfl√§che empf√§ngt.  Und das war's - Sie k√∂nnen Daten sammeln, Diagramme erstellen, √Ñnderungen analysieren und einen Ausl√∂ser erstellen, der auf diese √Ñnderungen reagiert. </p><br><p>  Der Code f√ºr die Vorlage, die Datei <code>userparameter_redis.conf</code> und das Skript <code>get_info.sh</code> k√∂nnen im <a href="https://github.com/flancer32/zabbix_plugin_redis/tree/habr" rel="nofollow">Projekt flancer32 / zabbix_plugin_redis angezeigt werden</a> . </p><br><p>  Vielen Dank an alle, die bis zum Ende gelesen haben und vor allem an diejenigen, die in der Publikation etwas N√ºtzliches f√ºr sich gefunden haben. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485538/">https://habr.com/ru/post/de485538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485528/index.html">So schlie√üen Sie ein Softwareentwicklungsprojekt richtig ab</a></li>
<li><a href="../de485530/index.html">Gef√ºhrtes Lernen</a></li>
<li><a href="../de485532/index.html">Interview Guide f√ºr diejenigen Programmierer, die sie nicht verstehen</a></li>
<li><a href="../de485534/index.html">HighLoad ++, Mikhail Makurov (Intersvyaz): Erfahrung in der Erstellung eines Backup- und Cluster-Zabbix-Dienstes</a></li>
<li><a href="../de485536/index.html">Ist es m√∂glich ein Flugzeug zu hacken - 2</a></li>
<li><a href="../de485542/index.html">Hinzuf√ºgen von Grafiken zu Notion</a></li>
<li><a href="../de485544/index.html">Schach als dynamisches System</a></li>
<li><a href="../de485546/index.html">Die Apokalypse kommt</a></li>
<li><a href="../de485548/index.html">SwiftUI in den Regalen</a></li>
<li><a href="../de485550/index.html">Gibt es ein Leben jenseits der Moskauer Ringstra√üe? Wie wir Entwickler suchen und vorbereiten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>