<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüéì üôÖüèæ üë®‚Äçüë®‚Äçüëß Trabalhar com prote√ß√£o de informa√ß√µes criptogr√°ficas e portadores de chaves de hardware no Linux üè≥Ô∏è ü¶ó „äôÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O armazenamento de chaves em tokens e cart√µes inteligentes oferece prote√ß√£o adicional contra invasores externos e internos, incluindo aqueles com um c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trabalhar com prote√ß√£o de informa√ß√µes criptogr√°ficas e portadores de chaves de hardware no Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfa/blog/441212/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/6t/xz/yg/6txzyg12acxsce8jlw0nl-ukdqa.png" width="80%" height="80%"></div><br>  O armazenamento de chaves em tokens e cart√µes inteligentes oferece prote√ß√£o adicional contra invasores externos e internos, incluindo aqueles com um certo n√≠vel de acesso ao sistema e equipamento de informa√ß√£o. <br><br>  Hoje, mostrarei como protegemos chaves de criptografia e assinaturas eletr√¥nicas em nossos sistemas de informa√ß√£o, e farei isso em um guia detalhado e bem ilustrado para configurar o SUSE Linux Enterprise Server 12 SP3 para trabalhar com o token Aladdin JaCarta PKI e o CryptoPro CSP KC2 4.0.9944. <br><br>  Havia v√°rios motivos para publicar este guia: <br><a name="habracut"></a><br><h4>  Raz√£o 1 </h4><br>  A documenta√ß√£o oficial do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aladdin-RD JaCarta √©</a> mais adaptada aos sistemas operacionais Astra Linux e ALT Linux, certificados pelo Minist√©rio da Defesa, FSTEC e FSB como um meio de proteger informa√ß√µes. <br><br><h4>  Raz√£o 2 </h4><br>  A melhor instru√ß√£o sobre como configurar a intera√ß√£o com a m√≠dia de hardware no Linux, tamb√©m foi encontrada em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wiki.astralinux.ru - Trabalhando com o CryptoPro CSP</a> <br><br><h4>  Raz√£o 3 </h4><br>  <b>UPD 16/04/2019:</b> No processo de configura√ß√£o do ambiente e do equipamento, verificou-se que a transportadora que estava dispon√≠vel pela primeira vez n√£o era o JaCarta PKI Nano, como esperado, mas um dispositivo operando no modo SafeNet Authentication Client eToken PRO. <br><br>  <b>UPD 16/04/2019:</b> Uma vez que o banco precisava de um dispositivo que pudesse funcionar na mesma infraestrutura do eToken PRO (Java).  Como tal dispositivo, a empresa "ZAO Aladdin R.D."  ofereceu um token JaCarta PRO, que foi selecionado pelo banco.  No entanto, na fase de forma√ß√£o do artigo e dos documentos de expedi√ß√£o, um funcion√°rio da empresa cometeu um erro.  Em vez do modelo JaCarta PRO, o JaCarta PKI foi acidentalmente inserido no artigo e nos documentos de remessa. <br><br>  <b>UPD 16/04/2019:</b> Agrade√ßo √† empresa Aladdin R.D. por ajudar a descobrir e estabelecer a verdade. <br><br><blockquote>  N√£o h√° significados pol√≠ticos e ocultos nesse erro, mas apenas o erro t√©cnico de um funcion√°rio na prepara√ß√£o de documentos.  Token JaCarta PRO √© um produto da empresa Aladdin R.D.  O applet que executa a parte funcional foi desenvolvido pela empresa "ZAO Aladdin R.D." </blockquote><br><br>  Este eToken PRO foi para uma festa lan√ßada antes de 1 de dezembro de 2017. <br>  Ap√≥s essa data, a empresa "Aladdin R.D."  Parou de vender dispositivos eToken PRO (Java). <br><br>  Seguindo um pouco √† frente, devo dizer que o trabalho com ele foi configurado atrav√©s dos drivers apropriados - <b>SafenetAuthenticationClient-10.0.32-0.x86_64</b> , que s√≥ podem ser obtidos em suporte ao Aladdin R.D.  em um aplicativo online separado. <br><br>  No CryptoPro CSP, para trabalhar com esse token, era necess√°rio instalar o <b>pacote cprocsp-rdr-emv-64 |</b>  <b>M√≥dulo de suporte EMV / Gemalto</b> . <br><br>  Este token foi determinado e respondeu.  Usando o utilit√°rio <b>SACTools do</b> pacote <b>SafenetAuthenticationClient</b> , foi poss√≠vel inicializ√°-lo.  Mas, ao trabalhar com prote√ß√£o de informa√ß√µes criptogr√°ficas, ele se comportou de maneira extremamente estranha e imprevis√≠vel. <br><br>  Foi mostrado da seguinte forma, no comando: <br><br><pre><code class="plaintext hljs">csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (205D325E5842) 00 00\alfa_shark' -check</code> </pre> <br>  A resposta foi que estava tudo bem: <br><br><pre> <code class="plaintext hljs">[ErrorCode: 0x00000000]</code> </pre> <br>  Mas imediatamente ap√≥s tentar ler as chaves programaticamente, a mesma verifica√ß√£o come√ßou a produzir um erro: <br><br><pre> <code class="plaintext hljs">[ErrorCode: 0x8009001a]</code> </pre> <br>  De acordo com a lista de c√≥digos de erro do modelo de objeto dos componentes do Microsoft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">COM Error Codes (Security and Setup)</a> <br><br><pre> <code class="plaintext hljs">NTE_KEYSET_ENTRY_BAD 0x8009001A Keyset as registered is invalid.</code> </pre> <br>  ‚ÄúConjunto de chaves inv√°lido‚Äù - o motivo dessa mensagem pode estar no antigo chip, firmware e applet da Gemalto ou em seus drivers para o sistema operacional que n√£o oferecem suporte aos novos padr√µes de gera√ß√£o ES e fun√ß√µes de hash GOST R 34.10-2012 e GOST R 34.11- 2012. <br><br>  Nesse estado, o token foi bloqueado.  O √≠ndice de prote√ß√£o de informa√ß√µes criptogr√°ficas come√ßou a mostrar o estado irrelevante do leitor e do cont√™iner de chaves.  Reiniciar o servi√ßo <b>cprocspractor</b> provider <b>cprocsp</b> , os <b>servi√ßos de token pcscd</b> e cart√£o inteligente e todo o sistema operacional n√£o ajudou, apenas a reinicializa√ß√£o. <br><br>  Para ser sincero, observe que o SafeNet eToken PRO funcionou corretamente com as teclas GOST R 34.10-2001 no sistema operacional Windows 7 e 10. <br><br>  Voc√™ pode tentar instalar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CryptoPro CSP 4.0 FCN (Gemalto)</a> , mas o objetivo √© proteger nosso ES e chaves de criptografia com os produtos FSB e FSTEC certificados pela fam√≠lia JaCarta que suportam novos padr√µes. <br><br>  O problema foi resolvido usando o token JaCarta PKI real na embalagem regular (XL). <br><br>  Mas foi gasto muito tempo tentando fazer o Safenet eToken PRO funcionar.  Eu queria chamar a aten√ß√£o para isso e, talvez, proteger algu√©m disso. <br><br><h4>  Raz√£o 4 </h4><br>  √Äs vezes, voc√™ mesmo precisa retornar a artigos e instru√ß√µes antigos.  Isso √© conveniente quando as informa√ß√µes s√£o colocadas em uma fonte externa.  Ent√£o, obrigado a Habr pela oportunidade. <br><br><h2>  Guia de configura√ß√£o </h2><br>  Depois de instalar o token JaCarta PKI na porta USB do servidor e iniciar o sistema, verificamos que o novo dispositivo foi detectado e aparece na lista: <br><br> <code>lsusb</code> <br> <br><img src="https://habrastorage.org/webt/ge/fs/tu/gefstux3tlhb7j0pag8r_fa-ose.png"><br><br>  No nosso caso, √© o <i>dispositivo 003 do barramento 004: ID 24dc: 0101</i> <br><br>  Para diagnosticar os leitores, voc√™ pode usar o utilit√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pcsc-tools no projeto security: chipcard (software.opensuse.org)</a> . <br><br>  √â iniciado pelo comando: <br><br> <code>pcsc_scan</code> <br> <br><img src="https://habrastorage.org/webt/rm/v3/ki/rmv3kikfuuwmh8c9mijm3it-ieq.png"><br><br>  At√© que todos os pacotes necess√°rios sejam instalados, as informa√ß√µes sobre o token n√£o ser√£o exibidas. <br><br><h3>  Instalando drivers e software para trabalhar com o JaCarta PKI </h3><br>  Na p√°gina de suporte do site "Aladdin R.D."  Fazemos o download da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o e do software para trabalhar apenas com o JaCarta PKI</a> <br><br>  De acordo com o Guia de Implementa√ß√£o do JaCarta for Linux, se√ß√£o 4.2., A primeira etapa √© instalar o <b>pcsc-lite</b> , <b>ccid</b> e <b>libusb</b> . <br><blockquote>  Para que o utilit√°rio de gerenciamento JaCarta funcione, os seguintes componentes devem ser instalados: <br><br><ul><li>  PC / SC Lite - uma camada intermedi√°ria para fornecer acesso a cart√µes inteligentes de acordo com o padr√£o PC / SC, pacote pcsc-lite. </li><li>  Bibliotecas Ccid e libusb para trabalhar com chaves USB, cart√µes inteligentes e leitores de cart√µes inteligentes. </li></ul></blockquote>  Verificamos a disponibilidade desses pacotes e instalamos: <br><br> <code>zypper search pcsc-lite</code> <br> <br><img src="https://habrastorage.org/webt/ez/0m/n_/ez0mn_o8-hmwibwiiltr5jk34xi.jpeg"><br><br> <code>zypper search libusb</code> <br> <br><img src="https://habrastorage.org/webt/ba/jn/zt/bajnztgbtt_fsbfp0tanzfvv7hk.png"><br><br> <code>zypper install pcsc-lite</code> <br> <br><img src="https://habrastorage.org/webt/qe/6i/pl/qe6ipldd5fimbo_m7j4yrmvtibw.jpeg"><br><br><img src="https://habrastorage.org/webt/1m/bo/mc/1mbomc3je9v8e82whld_0tqheje.png"><br><br> <code>zypper search CCID</code> <br> <br><img src="https://habrastorage.org/webt/mq/f4/8x/mqf48xewg61la3nuv_kumzsaxkq.png"><br><br> <code>zypper install pcsc-ccid</code> <br> <br><img src="https://habrastorage.org/webt/lx/yv/ng/lxyvngqgd1d_rdkh7tw2lofepjs.png"><br><br> <code>zypper search CCID</code> <br> <br><img src="https://habrastorage.org/webt/kq/az/ly/kqazlyxzmdusuprtyyfjhkkjick.jpeg"><br><br> <code>zypper install libusb</code> <br> <br><img src="https://habrastorage.org/webt/1f/ul/bk/1fulbklde9aj87m_ur21u8xvms0.png"><br><br>  Como resultado, o pacote pcsc-lite foi atualizado, o CCID foi instalado e o libusb n√£o foi necess√°rio executar nenhuma a√ß√£o. <br><br>  Os dois comandos a seguir instalam o pacote com drivers e software diretamente para trabalhar com o JaCarta PKI: <br><br> <code>zypper install idprotectclientlib-637.03-0.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/ux/ep/1u/uxep1uijp_2kvyix-yn6qkg5ing.jpeg"><br><br> <code>zypper install idprotectclient-637.03-0.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/xy/32/hq/xy32hqxgtmgwpn-pocygfs-rn3q.jpeg"><br><br>  Verifique se os drivers e o software do JaCarta PKI est√£o instalados: <br><br> <code>zypper search idprotectclient</code> <br> <br><img src="https://habrastorage.org/webt/7k/os/nk/7kosnk44-yewdh9i7odevcdzqdc.jpeg"><br><br>  Ao tentar fazer o SafeNet eToken PRO funcionar, encontrei informa√ß√µes de que o <b>pacote openct - Biblioteca para leitores de cart√£o inteligente</b> pr√©-instalado no SLES pode entrar em conflito com o <b>pcsc-lite - PCSC Smart Cards Library</b> , cuja instala√ß√£o requer Aladdin R.D. <br><br> <code>zypper search openct</code> <br> <br><img src="https://habrastorage.org/webt/g8/ja/mr/g8jamrjqjkxybghgrj8rnbfuuaw.png"><br><br>  Portanto, removemos o pacote openct: <br><br> <code>rpm -e openct</code> <br> <br>  Agora todos os drivers e softwares necess√°rios para trabalhar com o token est√£o instalados. <br><br>  <b>Realizamos</b> diagn√≥sticos usando o utilit√°rio <b>pcsc-tools</b> e garantimos que o JaCarta seja detectado no sistema operacional: <br><br> <code>pcsc_scan</code> <br> <br><img src="https://habrastorage.org/webt/t_/5s/ga/t_5sgar9ugi-z-mx2isjhpxfzj8.jpeg"><br><br><h3>  Instalando pacotes CryptoPro CSP </h3><br>  Ao instalar o CryptoPro CSP por padr√£o, os pacotes necess√°rios para trabalhar com tokens e cart√µes inteligentes est√£o ausentes. <br><br> <code>zypper search cprocsp</code> <br> <br><img src="https://habrastorage.org/webt/kq/g7/sc/kqg7scnpbnxlbxiicva_gjejk8k.png"><br><br>  Instalando os <b>componentes JaCarta para o componente de</b> suporte <b>CryptoPro CSP no CSP</b> <br><br> <code>zypper install cprocsp-rdr-jacarta-64-3.6.408.683-4.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/9d/uu/3e/9duu3e1vs9wu3qotu6dsllot9km.jpeg"><br><br>  Alguns componentes t√™m depend√™ncias.  Portanto, por exemplo, se voc√™ tentar instalar o pacote de suporte do SafeNet eToken PRO <b>cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm - m√≥dulo de suporte EMV / Gemalto</b> , receberemos uma mensagem sobre a necessidade de instalar primeiro o componente base do suporte do leitor CSP <b>cprocsp -rdr-pcsc-64-4.0.9944-5.x86_64.rpm - Componentes PC / SC para leitores CryptoPro CSP</b> : <br><br><pre> <code class="plaintext hljs">zypper install cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm Loading repository data... Reading installed packages... Resolving package dependencies... Problem: nothing provides cprocsp-rdr-pcsc-64 &gt;= 4.0 needed by cprocsp-rdr-emv-64-4.0.9944-5.x86_64 Solution 1: do not install cprocsp-rdr-emv-64-4.0.9944-5.x86_64 Solution 2: break cprocsp-rdr-emv-64-4.0.9944-5.x86_64 by ignoring some of its dependencies Choose from above solutions by number or cancel [1/2/c] (c): c</code> </pre><br>  Instale os pacotes de suporte b√°sico para leitores e m√≠dia principal: <br><br> <code>zypper install cprocsp-rdr-pcsc-64-4.0.9944-5.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/ku/al/eh/kualehuiobnjcc6sxcfgzlzedcu.png"><br><br> <code>zypper install lsb-cprocsp-pkcs11-64-4.0.9944-5.x86_64.rpm</code> <br> <br>  Agora voc√™ pode instalar m√≥dulos para trabalhar com outros tipos de m√≠dia e componentes da GUI: <br><br> <code>zypper install cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/b1/ka/hy/b1kahy9lzptzyp6gclxtou5775y.png"><br><br><pre> <code class="plaintext hljs">zypper install cprocsp-rdr-novacard-64-4.0.9944-5.x86_64.rpm zypper install cprocsp-rdr-mskey-64-4.0.9944-5.x86_64.rpm zypper install cprocsp-rdr-gui-gtk-64-4.0.9944-5.x86_64.rpm</code> </pre><br><img src="https://habrastorage.org/webt/gn/rs/s-/gnrss-ht0-vovsebsgfdvdioxhc.png"><br><br>  Verifique a configura√ß√£o final do CryptoPro CSP: <br><br><pre> <code class="plaintext hljs">zypper search cprocsp Loading repository data... Reading installed packages...</code> </pre><br><br> <code>S | Name | Summary | Type <br> ---+-----------------------------+----------------------------------------------------+-------- <br> i+ | cprocsp-curl-64 | CryptoPro Curl shared library and binaris. Build 9944. | package <br> i+ | cprocsp-rdr-emv-64 | EMV/Gemalto support module | package <br> i+ | cprocsp-rdr-gui-gtk-64 | GUI components for CryptoPro CSP readers. Build 9944. | package <br> i+ | cprocsp-rdr-jacarta-64 | JaCarta components for CryptoPro CSP. Build 683. | package <br> i+ | cprocsp-rdr-mskey-64 | Mskey support module | package <br> i+ | cprocsp-rdr-novacard-64 | Novacard support module | package <br> i+ | cprocsp-rdr-pcsc-64 | PC/SC components for CryptoPro CSP readers. Build 9944.| package <br> i+ | lsb-cprocsp-base | CryptoPro CSP directories and scripts. Build 9944. | package <br> i+ | lsb-cprocsp-ca-certs | CA certificates. Build 9944. | package <br> i+ | lsb-cprocsp-capilite-64 | CryptoAPI lite. Build 9944. | package <br> i+ | lsb-cprocsp-kc2-64 | CryptoPro CSP KC2. Build 9944. | package <br> i+ | lsb-cprocsp-pkcs11-64 | CryptoPro PKCS11. Build 9944. | package <br> i+ | lsb-cprocsp-rdr-64 | CryptoPro CSP readers. Build 9944. | package <br></code> <br><br><img src="https://habrastorage.org/webt/f-/rc/ad/f-rcadtwgu68ba6ad5wde2zke-m.jpeg"><br><br>  Para aplicar as altera√ß√µes, reiniciamos o servi√ßo de provedor de criptografia e verificamos seu status: <br><br><pre> <code class="plaintext hljs">/etc/init.d/cprocsp restart /etc/init.d/cprocsp status</code> </pre><br><img src="https://habrastorage.org/webt/vd/1a/th/vd1athcps5p7fe9cjp_ipmvvq-a.jpeg"><br><br><h3>  Configura√ß√£o e diagn√≥stico do CryptoPro CSP </h3><br>  Verifique se o provedor de criptografia v√™ nosso token e outros tipos de m√≠dia dispon√≠veis com os seguintes comandos: <br><br> <code>/opt/cprocsp/bin/amd64/csptest -card -enum -v ‚Äìv</code> <br> <br><img src="https://habrastorage.org/webt/2m/z1/d4/2mz1d4m5oyvg9nknwbnci24wcre.jpeg"><br><br> <code>/opt/cprocsp/bin/amd64/csptest -enum -info -type PP_ENUMREADERS | iconv -f cp1251</code> <br> <br><img src="https://habrastorage.org/webt/i0/xw/ro/i0xwroly12wmu3ejps9udt4tvxs.png"><br><br> <code>/opt/cprocsp/sbin/amd64/cpconfig -hardware reader -view -f cp1251</code> <br> <br><img src="https://habrastorage.org/webt/id/qu/rm/idqurmsxvepldfelr_w9vakfbwu.jpeg"><br><br>  <b>Aladdin RD JaCarta [Interface SCR] (000000000000) 00 00</b> √© o nosso meio. <br><br>  Seguindo as instru√ß√µes do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CryptoPro CSP para Linux.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configure</a> , execute seu registro no provedor de criptografia: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/sbin/amd64/cpconfig -hardware reader -add "Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"</code> </pre> <br><img src="https://habrastorage.org/webt/1v/xj/z_/1vxjz_h0nppdftdaeylhhobwt-a.png"><br><br>  Como resultado da execu√ß√£o no arquivo de configura√ß√£o <b>/etc/opt/cprocsp/config64.ini</b> <br>  uma entrada ser√° adicionada √† se√ß√£o [KeyDevices \ PCSC]: <br><br> <code>[KeyDevices\PCSC\"Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"\Default] <br></code> <br><br>  Para cumprir os requisitos do formul√°rio CryptoPro CSP, os Termos de uso e o Guia do administrador de seguran√ßa: <br><blockquote>  O uso do CryptoPro CSP CIP vers√£o 4.0 com o modo de controle avan√ßado de chave desativado n√£o √© permitido.  A inclus√£o desse modo est√° descrita nos documentos ZHTYA.00087-01 91 02. Guia do administrador de seguran√ßa. </blockquote>  √â necess√°rio habilitar o controle aprimorado do uso de chaves: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/sbin/amd64/cpconfig -ini '\config\parameters' -add long StrengthenedKeyUsageControl 1</code> </pre> <br>  Verifique se o modo est√° ativado: <br><br> <code>cat /etc/opt/cprocsp/config64.ini | grep StrengthenedKeyUsageControl</code> <br> <br><img src="https://habrastorage.org/webt/lg/hn/mm/lghnmmk1d5g9xhmxgmyqjcsrddo.jpeg"><br><br>  Reiniciamos o servi√ßo de provedor de criptografia: <br><br><pre> <code class="plaintext hljs">/etc/init.d/cprocsp restart /etc/init.d/cprocsp status</code> </pre><br>  Ap√≥s o rein√≠cio, verificamos se n√£o h√° erros no trabalho do provedor com as principais operadoras: <br><br> <code>/opt/cprocsp/bin/amd64/csptest -keyset ‚Äìverifycontext</code> <br> <br><img src="https://habrastorage.org/webt/qo/5x/v7/qo5xv7ayjfqa1ssyuds6dl-f-ue.jpeg"><br><br> <code>/opt/cprocsp/bin/amd64/csptest -keyset -verifycontext -enum ‚Äìunique</code> <br> <br><pre> <code class="plaintext hljs">CSP (Type:80) v4.0.9017 KC2 Release Ver:4.0.9944 OS:Linux CPU:AMD64 FastCode:REA AcquireContext: OK. HCRYPTPROV: 16052291 alfa_shark1 |SCARD\JACARTA_4E3900154029304C\CC00\E9F6 OK. Total: SYS: 0.000 sec USR: 0.000 sec UTC: 4.560 sec [ErrorCode: 0x00000000]</code> </pre><br><h3>  Trabalhar com o JaCarta PKI Token </h3><br>  Vamos executar o programa Xming (encaminhamento X11) em nossa esta√ß√£o para que possamos abrir e trabalhar com as interfaces gr√°ficas dos utilit√°rios necess√°rios via SSH. <br><br><img src="https://habrastorage.org/webt/-s/8j/r9/-s8jr9lfz0xkjurnsrgvwx71pfy.png"><br><br>  Ap√≥s instalar o <b>IDProtectClient</b> - software para trabalhar com o JaCarta PKI, dois arquivos apareceram no servidor na pasta <b>/ usr / share / applications</b> : <br><br>  Athena-IDProtectClient.desktop <br>  Athena-IDProtectManager.desktop <br><br>  Esses s√£o os atalhos nos quais voc√™ pode ver as op√ß√µes de inicializa√ß√£o dos utilit√°rios <i>Exec = / usr / bin / SACTools</i> <br><br>  Execute o utilit√°rio <b>IDProtectPINTool</b> . <br><br>  Utilizando-o, os c√≥digos de acesso PIN para o token s√£o definidos e alterados. <br><br> <code>/usr/bin/IDProtectPINTool</code> <br> <br><img src="https://habrastorage.org/webt/wx/nf/-j/wxnf-jyonzkwr2hs2cnfy1wzxie.png"><br><br>  Ao inicializar o token pela primeira vez, um link contendo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">c√≥digos PIN (senhas) das principais operadoras por padr√£o</a> ser√° √∫til <br><br>  O programa <b>IDProtect_Manager</b> permite exibir informa√ß√µes sobre o token e o cont√™iner com chaves e certificado: <br><br> <code>/usr/bin/IDProtect_Manager</code> <br> <br><img src="https://habrastorage.org/webt/nb/xb/ex/nbxbexx9njsuvpxawxszgs3lr8s.png"><br><br>  Para acessar o cont√™iner com as chaves, √© necess√°rio digitar a senha: <br><br><img src="https://habrastorage.org/webt/oh/pp/l_/ohppl_roac1knnwejckvd8afypy.png"><br><br><img src="https://habrastorage.org/webt/to/bh/vb/tobhvb23ey_zq2cdwp166-qrs5m.png"><br><br>  Para trabalhar com o <b>SafeNet Authentication Client eToken PRO,</b> existem programas semelhantes - <b>SafeNet Authentication Client Monitor</b> e <b>SafeNet Authentication Client Tools</b> , que s√£o executados da seguinte maneira: <br><br><pre> <code class="plaintext hljs">/usr/bin/SACMonitor /usr/bin/SACTools</code> </pre><br><img src="https://habrastorage.org/webt/ox/kl/by/oxklbysagi4vqp8crlzbzpmbuv8.jpeg"><br><br>  √â mais conveniente executar opera√ß√µes diretamente com os principais cont√™ineres na interface do provedor de criptografia CryptoPro JavaCSP: <br><br> <code>/jdk1.8.0_181/jre/bin/java ru.CryptoPro.JCP.ControlPane.MainControlPane <br></code> <br><br><img src="https://habrastorage.org/webt/yj/fi/je/yjfije_eiqqx49g1s7lvwbcwtlc.jpeg"><br><br>  Para exibir informa√ß√µes sobre o conte√∫do do cont√™iner com as chaves, voc√™ pode executar o comando: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/bin/amd64/csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00\alfa_shark1' -info</code> </pre> <br>  Para diagnosticar o cont√™iner, use o mesmo comando com a op√ß√£o ‚Äìcheck <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/bin/amd64/csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00\alfa_shark' ‚Äìcheck</code> </pre> <br>  Voc√™ precisar√° digitar a senha do cont√™iner: <br><br><img src="https://habrastorage.org/webt/m1/n4/cv/m1n4cvq78kcuqrfn1c7oxm9y3o4.png"><br><br><img src="https://habrastorage.org/webt/jr/vi/ga/jrvigahwffdkjcmfuwnwij4pdds.jpeg"><br><br><h3>  Recupera√ß√£o de chave de software </h3><br>  Em geral, um exemplo de recupera√ß√£o de uma chave privada e de um certificado de chave p√∫blica de um cont√™iner em um token usando o CryptoPro Java CSP √© o seguinte: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.CryptoPro.JCP.KeyStore.JCPPrivateKeyEntry; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.CryptoPro.JCP.params.JCPProtectionParameter; KeyStore keyStore = KeyStore.getInstance(<span class="hljs-string"><span class="hljs-string">"Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"</span></span>, <span class="hljs-string"><span class="hljs-string">"JCSP"</span></span>); keyStore.load(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); JCPPrivateKeyEntry entry = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; X509Certificate certificate = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; PrivateKey privateKey = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { entry = (JCPPrivateKeyEntry) keyStore.getEntry(keyAlias, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JCPProtectionParameter(pwd)); certificate = (X509Certificate) entry.getCertificate(); privateKey = entry.getPrivateKey(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnrecoverableEntryException | NullPointerException e) { LOGGER.log(Level.WARNING, PRIVATE_KEY_NOT_FOUND + keyAlias + ExceptionUtils.getFullStackTrace(e)); }</code> </pre><br><br>  Se voc√™ agir assim: <br><br><pre> <code class="java hljs">Key key = keyStore.getKey(keyAlias, pwd);</code> </pre><br>  o provedor de criptografia tentar√° exibir uma solicita√ß√£o para inserir a senha no cont√™iner por meio do console ou da janela da GUI. <br><br><h3>  Resultados </h3><br>  O token da portadora da chave do token √© instalado na porta USB interna do servidor. <br><br>  O hardware do servidor √© selado e colocado em uma sala com acesso limitado. <br><br>  Tais medidas podem aumentar o n√≠vel de prote√ß√£o de nossos sistemas de informa√ß√µes contra roubo e comprometimento de chaves de assinatura ou criptografia eletr√¥nica, remotamente pela rede e fisicamente. <br><br><h3>  Links √∫teis </h3><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aladdin-RD JaCarta Documenta√ß√£o</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wiki.astralinux.ru - Trabalhe com o CryptoPro CSP</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A lista de c√≥digos de erro do modelo de objeto dos componentes dos C√≥digos de erro do Microsoft COM (seguran√ßa e instala√ß√£o)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CryptoPro CSP 4.0 CSP 4.0 FCN (Gemalto)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Utilit√°rio de diagn√≥stico do Pcsc-tools reader da security: projeto chipcard (software.opensuse.org)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CryptoPro CSP para Linux.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Personaliza√ß√£o.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PINs padr√£o do portador de chave Aladdin-RD (senhas)</a> <br></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt441212/">https://habr.com/ru/post/pt441212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt441202/index.html">As empresas de servi√ßos sonham com seus produtos? Conversa com Maxilect</a></li>
<li><a href="../pt441204/index.html">Uma abordagem avan√ßada para detectar limites usando as paredes dos navios como exemplo</a></li>
<li><a href="../pt441206/index.html">Wolfensteiny 3D - engenharia reversa 251 bytes de JavaScript</a></li>
<li><a href="../pt441208/index.html">Como reduzimos a emiss√£o de empr√©stimos para 2 cliques</a></li>
<li><a href="../pt441210/index.html">Marca-passo de armazenamento em cluster + DRBD (prim√°rio duplo) + samba</a></li>
<li><a href="../pt441214/index.html">Guia do Usu√°rio Kibana. Visualiza√ß√£o. Parte 1</a></li>
<li><a href="../pt441216/index.html">Espelho preto ou an√∫ncio Picooc?</a></li>
<li><a href="../pt441218/index.html">OpenAI Gym + ROS + Gazebo: treinando um rob√¥ aut√¥nomo em casa. Parte 1</a></li>
<li><a href="../pt441220/index.html">An√°lise de recentes ataques em massa com captura de DNS</a></li>
<li><a href="../pt441222/index.html">Por que o Kubernetes √© t√£o complicado com reposit√≥rios?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>