<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“— ğŸ‘¨ğŸ¼â€ğŸ¨ ğŸ‘©â€ğŸ« Comment crÃ©er un jeu si vous n'Ãªtes jamais artiste ğŸ ğŸ˜ ğŸ’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y avait des moments dans la vie de chaque programmeur quand il rÃªvait de faire un jeu intÃ©ressant. De nombreux programmeurs rÃ©alisent ces rÃªves, et...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment crÃ©er un jeu si vous n'Ãªtes jamais artiste</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445278/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/96/hp/x0/96hpx0qpk4w0_hmjm3csu0lj92o.png"></div><br>  Il y avait des moments dans la vie de chaque programmeur quand il rÃªvait de faire un jeu intÃ©ressant.  De nombreux programmeurs rÃ©alisent ces rÃªves, et mÃªme avec succÃ¨s, mais cela ne les concerne pas.  Il s'agit de ceux qui aiment jouer Ã  des jeux, qui (mÃªme sans connaissances ni expÃ©rience) ont essayÃ© de les crÃ©er une fois, s'inspirant d'exemples de hÃ©ros isolÃ©s qui ont atteint une renommÃ©e mondiale (et d'Ã©normes profits), mais qui ont compris au fond que rivaliser avec le gourou igrostroya qu'il ne peut pas se permettre. <br><br>  Et non ... <br><a name="habracut"></a><br><h2>  Petite introduction </h2><br>  Je ferai une rÃ©servation tout de suite: notre objectif n'est pas de gagner de l'argent - il y a beaucoup d'articles sur ce sujet sur HabrÃ©.  Non, nous allons faire un jeu de rÃªve. <br><br><div class="spoiler">  <b class="spoiler_title">Digression lyrique sur le jeu des rÃªves</b> <div class="spoiler_text">  Combien de fois ai-je entendu ce mot de dÃ©veloppeurs uniques et de petits studios.  OÃ¹ que vous regardiez, tous les joueurs dÃ©butants sont pressÃ©s de rÃ©vÃ©ler leurs rÃªves et leur Â«vision parfaiteÂ» au monde, puis d'Ã©crire de longs articles sur leurs efforts hÃ©roÃ¯ques, leur processus de travail, leurs difficultÃ©s financiÃ¨res inÃ©vitables, leurs problÃ¨mes avec les Ã©diteurs et gÃ©nÃ©ralement Â«joueurs-ingrats-chiens-im- donner-graphique-et-piÃ¨ces-et-tout-gratuitement-et-payer-ne-pas-vouloir-un-jeu-pirates-et-nous-avons-perdu-les profits-Ã  cause d'eux-ici. " <br><br>  Les gens, ne vous laissez pas berner.  Vous ne faites pas un jeu de rÃªve, mais un jeu qui se vendra bien - ce sont deux choses diffÃ©rentes.  Les joueurs (et surtout les plus sophistiquÃ©s) ne se soucient pas de votre rÃªve et ne le paieront pas.  Si vous voulez des profits - Ã©tudiez les tendances, voyez ce qui est populaire maintenant, faites quelque chose d'unique, faites mieux, plus inhabituel que d'autres, lisez des articles (il y en a beaucoup), communiquez avec les Ã©diteurs - en gÃ©nÃ©ral, rÃ©alisez les rÃªves des utilisateurs finaux, pas les vÃ´tres. <br><br>  Si vous ne vous Ãªtes pas encore enfui et souhaitez toujours rÃ©aliser le jeu de vos rÃªves, renoncez Ã  l'avance aux bÃ©nÃ©fices.  Ne vendez pas du tout votre rÃªve - partagez-le gratuitement.  Donnez aux gens votre rÃªve, amenez-les Ã  lui, et si votre rÃªve vaut quelque chose, vous recevrez, sinon de l'argent, mais de l'amour et de la reconnaissance.  C'est parfois beaucoup plus prÃ©cieux. <br></div></div><br>  Beaucoup de gens pensent que les jeux sont une perte de temps et d'Ã©nergie, et que les gens sÃ©rieux ne devraient pas du tout parler de ce sujet.  Mais les gens rÃ©unis ici ne sont pas sÃ©rieux, donc nous ne sommes d'accord qu'en partie - les jeux prennent vraiment beaucoup de temps si vous les jouez.  Cependant, le dÃ©veloppement de jeux, bien que cela prenne beaucoup plus de temps, peut apporter de nombreux avantages.  Par exemple, il vous permet de vous familiariser avec les principes, les approches et les algorithmes que l'on ne trouve pas dans le dÃ©veloppement d'applications non ludiques.  Ou approfondissez les compÃ©tences de possÃ©der des outils (par exemple, un langage de programmation), en faisant quelque chose d'inhabituel et d'excitant.  Tout seul, je peux ajouter (et beaucoup seront d'accord) que le dÃ©veloppement de jeux (mÃªme infructueux) est toujours une expÃ©rience spÃ©ciale et incomparable, que vous vous souviendrez plus tard avec apprÃ©hension et amour, que je veux vivre pour chaque dÃ©veloppeur au moins une fois dans ma vie. <br><br>  Nous n'utiliserons pas de nouveaux moteurs de jeu, de nouveaux frameworks, de nouvelles bibliothÃ¨ques - nous examinerons l'essence mÃªme du gameplay et le ressentirons de l'intÃ©rieur.  Nous abandonnons les mÃ©thodologies de dÃ©veloppement flexibles (la tÃ¢che est simplifiÃ©e par la nÃ©cessitÃ© d'organiser le travail d'une seule personne).  Nous ne passerons pas de temps et d'Ã©nergie Ã  chercher des designers, des artistes, des compositeurs et des spÃ©cialistes du son - nous ferons tout nous-mÃªmes comme nous le pouvons (mais en mÃªme temps nous ferons tout sagement - si nous avons soudainement un artiste, nous ne ferons pas beaucoup d'efforts pour attacher la mode graphiques sur le cadre fini).  En fin de compte, nous nâ€™Ã©tudierons mÃªme pas vraiment les outils et ne choisirons pas le bon - nous le ferons sur celui que nous connaissons et savons utiliser.  Par exemple, en Java, afin que plus tard, si nÃ©cessaire, transfÃ©rez-le vers Android (ou vers une cafetiÃ¨re). <br><br>  <i>Â«Ah !!!</i>  <i>Horreur!</i>  <i>Un cauchemar!</i>  <i>Comment pouvez-vous passer du temps sur un tel non-sens!</i>  <i>Sortez d'ici, je vais lire quelque chose de plus intÃ©ressant! Â»</i> <br><br>  Pourquoi faire Ã§a?  Je veux dire, rÃ©inventer la roue?  Pourquoi ne pas utiliser un moteur de jeu prÃªt Ã  l'emploi?  La rÃ©ponse est simple: nous ne savons rien de lui, mais nous voulons le jeu maintenant.  Imaginez l'Ã©tat d'esprit du programmeur moyen: Â«Je veux faire un jeu!  Il y aura de la viande, des explosions et du pompage, <s>et vous pouvez voler un korovan</s> , et l'intrigue est en <s>train de</s> bombarder, et cela ne s'est jamais produit ailleurs!  Je vais commencer Ã  Ã©crire maintenant! .. Et sur quoi?  Voyons ce qui est populaire chez nous maintenant ... Ouais, X, Y et Z. Prenons Z, maintenant tout le monde y Ã©crit ... ".  Et commence Ã  Ã©tudier le moteur.  Et il jette l'idÃ©e, car il n'y a dÃ©jÃ  pas assez de temps pour cela.  Fin.  Ou bien, Ã§a n'abandonne pas, mais sans vraiment apprendre le moteur, c'est pris pour le jeu.  Eh bien, si alors il a la conscience de ne montrer Ã  personne son premier "mÃ©tier".  Habituellement non (allez dans n'importe quel magasin d'applications, voyez par vous-mÃªme) - eh bien, eh bien, je veux des profits, aucune force Ã  endurer.  Une fois que la crÃ©ation de jeux Ã©tait le lot de gens crÃ©atifs enthousiastes.  HÃ©las, cette fois est irrÃ©vocablement passÃ©e - maintenant, l'essentiel dans le jeu n'est plus l'Ã¢me, mais le modÃ¨le commercial (au moins, il y a beaucoup plus de conversations Ã  ce sujet).  Notre objectif est simple: nous allons faire des jeux avec l'Ã¢me.  Par consÃ©quent, nous rÃ©sumons l'outil (n'importe qui le fera) et nous concentrons sur la tÃ¢che. <br><br>  Alors continuons. <br>  Je n'entrerai pas dans les dÃ©tails de ma propre expÃ©rience amÃ¨re, mais je dirai que l'un des principaux problÃ¨mes pour un programmeur dans le dÃ©veloppement de jeux est le graphisme.  Les programmeurs ne savent gÃ©nÃ©ralement pas comment dessiner (bien qu'il y ait des exceptions), et les artistes ne savent gÃ©nÃ©ralement pas comment programmer (bien qu'il y ait des exceptions).  Et sans graphisme, il faut l'avouer, un jeu rare est contournÃ©.  Que faire? <br><br>  Il y a des options: <br><br><div class="spoiler">  <b class="spoiler_title">1. Dessinez tout vous-mÃªme dans un simple Ã©diteur graphique</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/5b/no/-o/5bno-orbfc3-ov3esi3ld_ezdqs.png"></a> <br>  <i>Captures d'Ã©cran du jeu "Kill Him All", 2003</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">2. Dessinez tout vous-mÃªme dans un vecteur</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/46/dj/u8/46dju8rama3wvfx2fzopin-yfiw.png"></a> <br>  <i>Captures d'Ã©cran du jeu "Raven", 2001</i> <br><br> <a href=""><img src="https://habrastorage.org/webt/jn/mm/vz/jnmmvzujgfsziasffz8m6sitmi0.png"></a> <br>  <i>Captures d'Ã©cran du jeu "Inferno", 2002</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">3. Demandez Ã  un frÃ¨re qui ne sait pas non plus dessiner (mais le fait un peu mieux)</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/tf/tx/jc/tftxjcy5luf045ehrm5_kdb5fzy.png"></a> <br>  <i>Captures d'Ã©cran du jeu "Fucking", 2004</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">4. TÃ©lÃ©chargez un programme de modÃ©lisation 3D et faites glisser les ressources Ã  partir de lÃ </b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/k9/nj/o6/k9njo6wryhhmaiagpool44qt5ua.jpeg"></a> <br>  <i>Captures d'Ã©cran du jeu "Fucking 2. Demo", 2006</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">5. En dÃ©sespoir de cause, se dÃ©chirer les cheveux sur la tÃªte</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/3p/fw/01/3pfw013bspmxrjyyewsnsgqobma.png"></a> <br> <a href=""><img src="https://habrastorage.org/webt/oa/gx/go/oagxgo1wmfykrll-ji-qwyrsv7e.png"></a> <br>  <i>Captures d'Ã©cran du jeu "Fucking", 2004</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">6. Dessinez tout vous-mÃªme en pseudographie (ASCII)</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/db/ht/s5/dbhts5ryeccznntuaiiwjmx32fo.png"></a> <br>  <i>Captures d'Ã©cran du jeu "Fifa", 2000</i> <br><br> <a href=""><img src="https://habrastorage.org/webt/q0/u-/vu/q0u-vuxozevapmdwswaygicakgg.png"></a> <br>  <i>Captures d'Ã©cran du jeu "Sumo", 1998</i> <br></div></div><br>  ArrÃªtons-nous sur ce dernier (en partie parce qu'il n'a pas l'air aussi dÃ©primant que les autres).  De nombreux joueurs inexpÃ©rimentÃ©s croient que les jeux sans graphismes modernes et cool ne peuvent pas gagner le cÅ“ur des joueurs - mÃªme le nom du jeu ne les transforme mÃªme pas en jeux.  Les dÃ©veloppeurs de chefs-d'Å“uvre tels que <i>ADOM</i> , <i>NetHack</i> et <i>Dwarf Fortress</i> s'opposent tacitement Ã  de tels arguments.  L'apparence n'est pas toujours un facteur dÃ©cisif, l'utilisation de l' <abbr title="Code standard amÃ©ricain pour l'Ã©change d'informations">ASCII</abbr> offre des avantages intÃ©ressants: <br><br><ul><li>  en cours de dÃ©veloppement, le programmeur se concentre sur le gameplay, la mÃ©canique du jeu, la composante intrigue et plus, sans Ãªtre distrait par des choses mineures; </li><li>  dÃ©velopper un composant graphique ne prend pas trop de temps - un prototype fonctionnel (c'est-Ã -dire une version en jouant que vous pouvez comprendre, mais cela vaut la peine de continuer) sera prÃªt beaucoup plus tÃ´t; </li><li>  pas besoin d'apprendre les frameworks et les moteurs graphiques; </li><li>  vos graphismes ne deviendront pas obsolÃ¨tes dans les cinq ans que vous dÃ©velopperez le jeu; </li><li>  les travailleurs inconditionnels pourront Ã©valuer votre produit mÃªme sur des plates-formes qui n'ont pas d'environnement graphique; </li><li>  si tout est fait correctement, les graphismes sympas peuvent Ãªtre attachÃ©s plus tard, plus tard. </li></ul><br>  La longue introduction ci-dessus Ã©tait destinÃ©e Ã  aider les novices igrodelov Ã  surmonter leurs peurs et leurs prÃ©jugÃ©s, Ã  cesser de s'inquiÃ©ter et Ã  essayer de faire quelque chose comme Ã§a.  ÃŠtes-vous prÃªt?  CommenÃ§ons alors. <br><br><h2>  <font color="#0474a0">PremiÃ¨re Ã©tape.</font>  <font color="#0474a0">IdÃ©e</font> </h2><br>  Comment?  Vous n'en avez toujours aucune idÃ©e? <br><br>  Ã‰teignez l'ordinateur, allez manger, marcher, faire de l'exercice.  Ou dormir, au pire.  Concevoir un jeu, ce n'est pas laver les fenÃªtres - il n'y a pas de perspicacitÃ© dans le processus.  D'habitude, l'idÃ©e d'un jeu naÃ®t soudainement, de faÃ§on inattendue, quand on n'y pense pas du tout.  Si cela se produit soudainement, prenez un crayon plus rapidement et Ã©crivez jusqu'Ã  ce que l'idÃ©e s'envole.  Tout processus crÃ©atif est mis en Å“uvre de cette maniÃ¨re. <br><br>  Et vous pouvez copier les jeux d'autres personnes.  Eh bien, copie.  Bien sÃ»r, ne dÃ©chirez pas sans vergogne, racontant Ã  chaque coin Ã  quel point vous Ãªtes intelligent, mais utilisez l'expÃ©rience des autres dans votre produit.  Combien aprÃ¨s cela restera spÃ©cifiquement de votre rÃªve est une question secondaire, car souvent les joueurs ont ceci: ils aiment tout dans le jeu, Ã  l'exception de deux ou trois choses ennuyeuses, mais si c'Ã©tait fait diffÃ©remment ... Qui sait peut-Ãªtre que vous rÃªvez de la bonne idÃ©e de quelqu'un. <br><br>  Mais nous allons suivre la voie simple - supposons que nous ayons dÃ©jÃ  une idÃ©e, et que nous n'y ayons pas rÃ©flÃ©chi depuis longtemps.  Comme notre premier projet grandiose, nous ferons un clone d'un bon jeu d'Obsidian - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pathfinder Adventures</a> . <br><br>  <i>Â«Qu'est-ce que c'est que Ã§a!</i>  <i>Des tables? "</i> <br><br>  Comme on dit, <i>pourquoi pas?</i>  Nous semblons avoir dÃ©jÃ  abandonnÃ© les prÃ©jugÃ©s, et nous commenÃ§ons donc hardiment Ã  affiner l'idÃ©e.  Naturellement, nous ne clonerons pas le jeu un Ã  un, mais nous emprunterons les mÃ©canismes de base.  De plus, la mise en place d'un jeu coopÃ©ratif au tour par tour a ses avantages: <br><br><ul><li>  c'est Ã©tape par Ã©tape - cela vous permet de ne pas vous soucier des minuteries, de la synchronisation, de l'optimisation, des FPS et d'autres choses mornes; </li><li>  il est coopÃ©ratif, c'est-Ã -dire que le ou les joueurs ne se font pas concurrence, mais contre un certain "environnement" jouant selon des rÃ¨gles dÃ©terministes - cela Ã©limine la nÃ©cessitÃ© de programmer l' <abbr title="Intelligence artificielle">IA</abbr> ( <abbr title="Intelligence artificielle">AI</abbr> ) - l'une des Ã©tapes les plus difficiles du dÃ©veloppement du jeu; </li><li>  c'est significatif - les dessus de table sont gÃ©nÃ©ralement des gens fantaisistes, ils ne joueront rien: donnez-leur des mÃ©canismes rÃ©flÃ©chis et un gameplay intÃ©ressant - vous ne sortirez pas dans une belle image (cela donne quelque chose Ã  des amis, non?); </li><li>  c'est avec l'intrigue - de nombreux e-sportifs ne seront pas d'accord, mais pour moi personnellement, le jeu devrait raconter une histoire intÃ©ressante - comme un livre, en utilisant uniquement ses moyens artistiques spÃ©ciaux. </li><li>  elle est divertissante, ce qui n'est pas pour tout le monde - les approches dÃ©crites peuvent Ãªtre appliquÃ©es Ã  tout rÃªve ultÃ©rieur, peu importe le nombre que vous avez. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Pour ceux qui ne connaissent pas les rÃ¨gles, une brÃ¨ve introduction:</b> <div class="spoiler_text">  <b>Pathfinder Adventures</b> est une version numÃ©rique d'un jeu de cartes crÃ©Ã© sur la base d'un jeu de rÃ´le (ou plutÃ´t d'un systÃ¨me de jeu de rÃ´les) Pathfinder.  Les joueurs (de 1 Ã  6) choisissent un personnage pour eux-mÃªmes et, avec lui, partent Ã  l'aventure, divisÃ©s en plusieurs scÃ©narios.  Chaque personnage a Ã  sa disposition des cartes de diffÃ©rents types (telles que: armes, armures, sorts, alliÃ©s, objets, etc.), avec l'aide desquelles dans chaque scÃ©nario, il doit trouver et punir brutalement le Scoundrel - une carte spÃ©ciale avec des propriÃ©tÃ©s spÃ©ciales. <br><br>  Chaque scÃ©nario fournit un certain nombre d'emplacements ou d'emplacements (leur nombre dÃ©pend du nombre de joueurs) que les joueurs doivent visiter et explorer.  Chaque emplacement contient un jeu de cartes couchÃ© face cachÃ©e, que les personnages explorent Ã  leur tour - c'est-Ã -dire qu'ils ouvrent la carte du dessus et essaient de la surmonter selon les rÃ¨gles pertinentes.  En plus des cartes inoffensives reconstituant le deck du joueur, ces decks contiennent Ã©galement des ennemis et des obstacles malÃ©fiques - ils doivent Ãªtre vaincus pour avancer plus loin.  La carte Scoundrel se trouve Ã©galement dans l'un des decks, mais les joueurs ne savent pas lequel - elle doit Ãªtre trouvÃ©e. <br><br>  Pour vaincre les cartes (et en acquÃ©rir de nouvelles), les personnages doivent passer le test d'une de leurs caractÃ©ristiques (standard pour les RPG, force, dextÃ©ritÃ©, sagesse, etc.) en lanÃ§ant un dÃ© dont la taille est dÃ©terminÃ©e par la valeur de la caractÃ©ristique correspondante (de d4 Ã  d12), en ajoutant des modificateurs (dÃ©finis rÃ¨gles et le niveau de dÃ©veloppement du personnage) et jouer pour amÃ©liorer l'effet des cartes appropriÃ©es de la main.  En cas de victoire, la carte rencontrÃ©e est soit retirÃ©e du jeu (s'il s'agit d'un ennemi), soit reconstitue la main d'un joueur (s'il s'agit d'un objet) et le coup revient Ã  un autre joueur.  En perdant, le personnage est souvent endommagÃ©, ce qui lui fait dÃ©fausser les cartes de sa main.  Un mÃ©canisme intÃ©ressant est que la santÃ© du personnage est dÃ©terminÃ©e par le nombre de cartes dans son deck - dÃ¨s que le joueur doit piocher une carte du deck, mais elles ne sont pas lÃ , son personnage meurt. <br><br>  Le but est, aprÃ¨s avoir fait son chemin Ã  travers des cartes de localisation, de trouver et de vaincre le Scoundrel, ayant prÃ©cÃ©demment bloquÃ© son chemin de retraite (vous pouvez en apprendre plus Ã  ce sujet et bien plus encore en lisant les rÃ¨gles).  Cela doit Ãªtre fait pendant un certain temps, ce qui est la principale difficultÃ© du jeu.  Le nombre de coups est strictement limitÃ© et une simple Ã©numÃ©ration de toutes les cartes disponibles n'atteint pas l'objectif.  Par consÃ©quent, vous devez appliquer diverses astuces et techniques intelligentes. <br><br>  Au fur et Ã  mesure que les scÃ©narios se rÃ©aliseront, les personnages grandiront et se dÃ©velopperont, amÃ©liorant leurs caractÃ©ristiques et acquÃ©rant de nouvelles compÃ©tences utiles.  La gestion du jeu est Ã©galement un Ã©lÃ©ment trÃ¨s important du jeu, car le rÃ©sultat du scÃ©nario (en particulier dans les Ã©tapes ultÃ©rieures) dÃ©pend gÃ©nÃ©ralement de cartes correctement sÃ©lectionnÃ©es (et de beaucoup de chance, mais que voulez-vous d'un jeu avec des dÃ©s?). </div></div><br>  En gÃ©nÃ©ral, le jeu est intÃ©ressant, digne, digne d'attention, et, ce qui est important pour nous, assez compliquÃ© (notez que je dis Â«difficileÂ» pas au sens de Â«difficileÂ») pour le rendre intÃ©ressant Ã  implÃ©menter son clone. <br><br>  Dans notre cas, nous ferons un changement conceptuel global - nous abandonnerons les cartes.  Au contraire, nous ne refuserons pas du tout, mais nous remplacerons les cartes par des cubes, toujours de tailles et de couleurs diffÃ©rentes (techniquement, ce n'est pas tout Ã  fait correct d'utiliser leurs "cubes", car il y a d'autres formes que le bon hexagone, mais il est inhabituel pour moi de les appeler "os" et c'est dÃ©sagrÃ©able, mais utiliser la marguerite amÃ©ricaine est un signe de mauvais goÃ»t, alors laissez-le tel quel).  DÃ©sormais, au lieu des decks, les joueurs auront des sacs.  Et les emplacements auront Ã©galement des sacs, desquels les joueurs en cours de recherche sortiront des cubes arbitraires.  La couleur du cube dÃ©terminera son type et, par consÃ©quent, les rÃ¨gles de rÃ©ussite du test.  Les caractÃ©ristiques personnelles du personnage (force, dextÃ©ritÃ©, etc.), en consÃ©quence, seront Ã©liminÃ©es, mais de nouvelles mÃ©caniques intÃ©ressantes apparaÃ®tront (plus sur lesquelles plus tard). <br><br>  Sera-ce amusant Ã  jouer?  Je n'en ai aucune idÃ©e, et personne ne peut le comprendre tant qu'un prototype fonctionnel n'est pas prÃªt.  Mais nous n'aimons pas le jeu, mais le dÃ©veloppement, non?  Par consÃ©quent, il ne devrait y avoir aucun doute sur le succÃ¨s. <br><br><h2>  <font color="#0474a0">DeuxiÃ¨me Ã©tape</font>  <font color="#0474a0">La conception</font> </h2><br>  Avoir une idÃ©e n'est qu'un tiers de l'histoire.  Maintenant, il est important de dÃ©velopper cette idÃ©e.  Autrement dit, ne vous promenez pas dans le parc ou ne prenez pas de bain de vapeur, mais asseyez-vous Ã  la table, prenez du papier avec un stylo (ou ouvrez votre Ã©diteur de texte prÃ©fÃ©rÃ©) et rÃ©digez soigneusement un document de conception, en travaillant minutieusement tous les aspects de la mÃ©canique du jeu.  Le temps pour cela prendra une percÃ©e, alors ne vous attendez pas Ã  terminer l'Ã©criture en une seule sÃ©ance.  Et n'espÃ©rez mÃªme pas penser Ã  tout Ã  la fois - au fur et Ã  mesure que vous implÃ©mentez, vous verrez la nÃ©cessitÃ© d'apporter un tas de changements et de changements (et parfois de retravailler quelque chose Ã  l'Ã©chelle mondiale), mais une base doit Ãªtre prÃ©sente avant le dÃ©but du processus de dÃ©veloppement. <br><br><div class="spoiler">  <b class="spoiler_title">Au dÃ©but, votre document de conception ressemblera Ã  ceci</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/oi/qw/fp/oiqwfpjf6vasnpmy6ucqglbnwy8.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/ff/gu/7q/ffgu7qx80qefetycgrmdraoetv8.jpeg"></a> <br></div></div><br>  Et seulement aprÃ¨s avoir fait face Ã  la premiÃ¨re vague d'idÃ©es grandioses, vous prenez la tÃªte, dÃ©cidez de la structure du document et commencez Ã  le remplir mÃ©thodiquement de contenu (en vÃ©rifiant chaque seconde avec ce qui a dÃ©jÃ  Ã©tÃ© Ã©crit afin d'Ã©viter les rÃ©pÃ©titions inutiles et surtout les contradictions).  Petit Ã  petit, Ã©tape par Ã©tape, vous obtenez quelque chose de significatif et de concis, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme ceci</a> . <br><br>  Lorsque vous dÃ©crivez le design, choisissez la langue dans laquelle il vous sera plus facile d'exprimer vos pensÃ©es, surtout si vous travaillez seul.  Si jamais vous avez besoin d'impliquer des dÃ©veloppeurs tiers dans le projet, assurez-vous qu'ils comprennent toutes les bÃªtises crÃ©atives qui se passent dans votre tÃªte. <br><br>  Pour continuer, je vous recommande fortement de lire le document citÃ© au moins en diagonale, car Ã  l'avenir je ferai rÃ©fÃ©rence aux termes et concepts qui y sont prÃ©sentÃ©s, sans m'attarder en dÃ©tail sur leur interprÃ©tation. <br><br>  <i>Â«Auteur, tuez-vous contre le mur.</i>  <i>Trop de lettres. "</i> <br><br><h2>  <font color="#0474a0">TroisiÃ¨me Ã©tape</font>  <font color="#0474a0">ModÃ©lisation</font> </h2><br>  Autrement dit, le mÃªme design, mais plus dÃ©taillÃ©. <br>  Je sais que beaucoup sont dÃ©jÃ  impatients d'ouvrir un IDE et de commencer Ã  coder, mais soyez patient un peu plus.  Lorsque les idÃ©es nous submergent la tÃªte, il nous semble que nous n'avons qu'Ã  toucher le clavier et nos mains se prÃ©cipiteront Ã  des distances vertigineuses - avant que le cafÃ© n'ait le temps de bouillir sur le poÃªle, lorsque la version de travail de l'application est prÃªte ... pour aller Ã  la poubelle.  Afin de ne pas rÃ©Ã©crire la mÃªme chose plusieurs fois (et surtout de ne pas vous assurer aprÃ¨s trois heures de dÃ©veloppement que la mise en page ne fonctionne pas et doit Ãªtre recommencÃ©e), je vous suggÃ¨re d'abord de rÃ©flÃ©chir (et de documenter) la structure principale de l'application. <br><br>  Puisque nous, en tant que dÃ©veloppeurs, connaissons bien la programmation orientÃ©e objet (POO), nous utiliserons ses principes dans notre projet.  Mais pour la POO, rien n'est plus attendu que de commencer le dÃ©veloppement avec un tas de diagrammes UML ennuyeux.  (Vous ne savez pas ce qu'est <abbr title="Langage de modÃ©lisation unifiÃ©">UML</abbr> ? J'ai presque oubliÃ© aussi, mais je m'en souviendrai avec plaisir - juste pour montrer ce que je suis un programmeur assidu, hehe.) <br><br>  CommenÃ§ons par le diagramme de cas d'utilisation.  Nous allons y dÃ©crire les faÃ§ons dont notre utilisateur (joueur) interagit avec le futur systÃ¨me: <br><br><div class="spoiler">  <b class="spoiler_title">Cas d'utilisation</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/rt/ph/st/rtphstumyokd9_gnpgzoewpaux8.png"></a> <br></div></div><br>  <i>"Euh ... qu'est-ce que c'est que Ã§a?"</i> <br><br>  Je plaisante, je plaisante ... et, peut-Ãªtre, j'arrÃªte de plaisanter Ã  ce sujet - c'est une question sÃ©rieuse (un rÃªve, aprÃ¨s tout).  Sur le schÃ©ma des cas d'utilisation, il est nÃ©cessaire d'afficher les possibilitÃ©s que le systÃ¨me offre Ã  l'utilisateur.  En dÃ©tails.  Mais il est arrivÃ© historiquement que ce type particulier de diagrammes soit le pire pour moi - la patience ne suffit pas, apparemment.  Et vous n'avez pas Ã  me regarder comme Ã§a - nous ne sommes pas Ã  l'universitÃ© pour protÃ©ger le diplÃ´me, mais nous apprÃ©cions le processus de travail.  Et pour ce processus, les cas d'utilisation ne sont pas si importants.  Il est beaucoup plus important de diviser correctement l'application en modules indÃ©pendants, c'est-Ã -dire d'implÃ©menter le jeu de telle maniÃ¨re que les fonctionnalitÃ©s de l'interface visuelle n'affectent pas la mÃ©canique du jeu et que le composant graphique puisse Ãªtre facilement modifiÃ© si vous le souhaitez. <br><br>  Ce point peut Ãªtre dÃ©taillÃ© dans le diagramme de composants suivant: <br><br><div class="spoiler">  <b class="spoiler_title">Composants systÃ¨me</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/lm/br/br/lmbrbrdoyppboylxuoopjr--d5u.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, nous avons dÃ©jÃ  identifiÃ© des sous-systÃ¨mes spÃ©cifiques qui font partie de notre application et, comme nous le verrons plus loin, ils seront tous dÃ©veloppÃ©s indÃ©pendamment les uns des autres. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, au mÃªme stade, nous dÃ©terminerons Ã  quoi ressemblera le cycle de jeu principal (ou plutÃ´t, sa partie la plus intÃ©ressante est celle qui implÃ©mente les personnages dans le script). </font><font style="vertical-align: inherit;">Pour cela, un diagramme d'activitÃ© nous convient:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous vous levez, asseyez-vous</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/o-/f6/ev/o-f6evthl0hpqu0rhwlejbxyhty.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et enfin, il serait bien de prÃ©senter en termes gÃ©nÃ©raux la sÃ©quence de l'interaction de l'utilisateur final avec le moteur de jeu via un systÃ¨me d'entrÃ©e-sortie. </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saucisses</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/hs/jo/_d/hsjo_dinyd5genlr77jrgz0ouys.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La nuit est longue, bien avant l'aube. </font><font style="vertical-align: inherit;">AprÃ¨s vous Ãªtre assis comme il se doit Ã  la table, vous dessinerez calmement les deux douzaines de diagrammes - croyez-moi, Ã  l'avenir, leur prÃ©sence vous aidera Ã  rester sur le chemin choisi, augmentera votre estime de soi, mettra Ã  jour l'intÃ©rieur de la piÃ¨ce, suspendra des papiers peints dÃ©colorÃ©s avec des affiches colorÃ©es, et transmettra votre vision en termes simples Ã  collÃ¨gues dÃ©veloppeurs qui se prÃ©cipiteront bientÃ´t aux portes de votre nouveau studio en masse (nous ne visons pas le succÃ¨s, vous vous souvenez?). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jusqu'Ã  prÃ©sent, nous n'allons pas citer les diagrammes de classes (classe) que nous aimons tous - les classes devraient </font><font style="vertical-align: inherit;">beaucoup </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">percer</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et l'image dans trois Ã©crans de clartÃ© au dÃ©but ne s'ajoutera pas. </font><font style="vertical-align: inherit;">Il est prÃ©fÃ©rable de le dÃ©composer et de le disposer progressivement, au fur et Ã  mesure que vous dÃ©veloppez le sous-systÃ¨me appropriÃ©.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QuatriÃ¨me Ã©tape </font><font style="vertical-align: inherit;">SÃ©lection d'outils</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme dÃ©jÃ  convenu, nous dÃ©velopperons une application multiplateforme qui s'exÃ©cute Ã  la fois sur des ordinateurs de bureau exÃ©cutant divers systÃ¨mes d'exploitation et sur des appareils mobiles. Nous choisirons Java comme langage de programmation, et Kotlin est encore meilleur, car ce dernier est plus rÃ©cent et plus frais, et n'a pas encore eu le temps de nager dans les vagues d'indignation qui ont balayÃ© son prÃ©dÃ©cesseur avec sa tÃªte (en mÃªme temps je le formerai si quelqu'un d'autre ne le possÃ¨de pas). </font></font><abbr title="Machine virtuelle Java"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La JVM</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , comme vous le savez, est disponible partout (sur trois milliards d'appareils, hehe), nous prendrons en charge Windows et UNIX, et mÃªme sur un serveur distant, nous pouvons jouer via une connexion SSH (il est inconnu de tous ceux qui en ont besoin, mais Nous fournirons une telle opportunitÃ©). Nous le transfÃ©rerons Ã©galement sur Android lorsque nous serons riches et embaucherons un artiste, mais plus Ã  ce sujet plus tard.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les bibliothÃ¨ques (nous ne pouvons aller nulle part sans elles), nous choisirons en fonction de nos exigences multiplateformes. </font><font style="vertical-align: inherit;">Nous utiliserons Maven comme systÃ¨me de construction. </font><font style="vertical-align: inherit;">Ou Gradle. </font><font style="vertical-align: inherit;">Ou tout de mÃªme, Maven, commenÃ§ons par Ã§a. </font><font style="vertical-align: inherit;">Je vous conseille immÃ©diatement de mettre en place un systÃ¨me de contrÃ´le de version (celui que vous prÃ©fÃ©rez), de sorte qu'aprÃ¨s de nombreuses annÃ©es, il sera plus facile de rappeler avec des sentiments nostalgiques Ã  quel point c'Ã©tait gÃ©nial. </font><font style="vertical-align: inherit;">IDE choisit Ã©galement le familier, le favori et le plus pratique. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, nous n'avons besoin de rien d'autre. </font><font style="vertical-align: inherit;">Vous pouvez commencer Ã  dÃ©velopper.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CinquiÃ¨me Ã©tape </font><font style="vertical-align: inherit;">CrÃ©ation et mise en place d'un projet</font></font></font> </h2><br>  Si vous utilisez un IDE, la crÃ©ation d'un projet est triviale.  Il vous suffit de choisir un nom sonore (par exemple, <b>Dice</b> ) pour notre futur chef-d'Å“uvre, n'oubliez pas d'activer le support Maven dans les paramÃ¨tres et d'Ã©crire les identifiants nÃ©cessaires dans le fichier <code>pom.xml</code> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Ajoutez Ã©galement la prise en charge de Kotlin, qui est manquante par dÃ©faut: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-stdlib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  et certains paramÃ¨tres sur lesquels nous ne nous attarderons pas en dÃ©tail: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span>UTF-8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3.20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Un peu d'informations sur les projets hybrides</b> <div class="spoiler_text">  Si vous prÃ©voyez d'utiliser Ã  la fois Java et Kotlin dans votre projet, en plus du <code>src/main/kotlin</code> , vous aurez Ã©galement le dossier <code>src/main/java</code> .  Les dÃ©veloppeurs de Kotlin affirment que les fichiers source du premier dossier ( <code>*.kt</code> ) doivent Ãªtre compilÃ©s plus tÃ´t que les fichiers source du deuxiÃ¨me dossier ( <code>*.java</code> ) et recommandent donc fortement de modifier les paramÃ¨tres des cibles Maven standard: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>process-sources<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/main/kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/main/java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/test/kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/test/java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.maven.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-compiler-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.5.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Replacing default-compile --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>default-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>none<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Replacing default-testCompile --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>default-testCompile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>none<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>java-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>java-test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>testCompile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Je ne peux pas dire Ã  quel point cela est important - les projets se dÃ©roulent assez bien sans cette feuille.  Mais juste au cas oÃ¹, vous Ãªtes prÃ©venu. <br></div></div><br>  CrÃ©ons trois packages Ã  la fois (pourquoi chier quelque chose?): <br><br><ul><li>  <code>model</code> - pour les classes qui dÃ©crivent des objets du monde du jeu; </li><li>  <code>game</code> - pour les classes qui mettent en Å“uvre le gameplay; </li><li>  <code>ui</code> - pour les classes responsables de l'interaction avec l'utilisateur. </li></ul><br>  Ce dernier ne contiendra que des interfaces dont nous utiliserons les mÃ©thodes d'entrÃ©e et de sortie des donnÃ©es.  Nous allons stocker des implÃ©mentations spÃ©cifiques dans un projet distinct, mais plus Ã  ce sujet plus tard.  En attendant, afin de ne pas trop vaporiser, nous ajouterons ici ces classes cÃ´te Ã  cÃ´te. <br><br>  N'essayez pas de le faire immÃ©diatement parfaitement: rÃ©flÃ©chissez aux dÃ©tails des noms de package, des interfaces, des classes et des mÃ©thodes;  prescrire Ã  fond l'interaction des objets entre eux - tout cela va changer, et plus d'une douzaine de fois.  Au fur et Ã  mesure que le projet se dÃ©veloppe, beaucoup de choses vous sembleront moches, encombrantes, inefficaces et similaires - n'hÃ©sitez pas Ã  les changer, car la refactorisation dans les IDE modernes est une opÃ©ration trÃ¨s bon marchÃ©. <br><br>  Nous allons Ã©galement crÃ©er une classe avec la fonction <code>main</code> et nous sommes prÃªts pour de grandes rÃ©alisations.  Vous pouvez utiliser l'IDE lui-mÃªme pour le lancement, mais comme vous le verrez plus tard, cette mÃ©thode ne convient pas Ã  nos fins (la console IDE standard n'est pas en mesure d'afficher nos rÃ©sultats graphiques comme il se doit), nous allons donc configurer le lancement de l'extÃ©rieur Ã  l'aide de batch (ou shell sur les systÃ¨mes UNIX) fichier.  Mais avant cela, nous allons faire des paramÃ¨tres supplÃ©mentaires. <br><br>  Une fois l'opÃ©ration de <code>mvn package</code> terminÃ©e, nous obtenons la sortie de l'archive JAR avec toutes les classes compilÃ©es.  Tout d'abord, par dÃ©faut, cette archive n'inclut pas les dÃ©pendances nÃ©cessaires au fonctionnement du projet (jusqu'Ã  prÃ©sent nous ne les avons pas, mais elles apparaÃ®tront certainement Ã  l'avenir).  DeuxiÃ¨mement, le chemin d'accÃ¨s Ã  la classe principale contenant la mÃ©thode <code>main</code> n'est pas spÃ©cifiÃ© dans le fichier manifeste d'archive, nous ne pourrons donc pas dÃ©marrer le projet avec la commande <code>java -jar dice-1.0.jar</code> .  Corrigez cela en ajoutant des paramÃ¨tres supplÃ©mentaires Ã  <code>pom.xml</code> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-assembly-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>package<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>single<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span>jar-with-dependencies<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span>my.company.dice.MainKt<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Faites attention au nom de la classe principale.  Pour les fonctions Kotlin contenues en dehors des classes (telles que les fonctions <code>main</code> ), les classes sont quand mÃªme crÃ©Ã©es pendant la compilation (car la JVM ne sait rien et ne veut pas savoir).  Le nom de cette classe est le nom du fichier avec l'ajout de <code>Kt</code> .  Autrement dit, si vous avez nommÃ© la classe principale <code>Main</code> , elle sera compilÃ©e dans le fichier <code>MainKt.class</code> .  C'est ce dernier que nous devons indiquer dans le manifeste du fichier jar. <br><br>  Maintenant, lors de la construction du projet, nous obtiendrons deux fichiers jar Ã  la sortie: <code>dice-1.0.jar</code> et <code>dice-1.0-jar-with-dependencies.jar</code> .  Nous sommes intÃ©ressÃ©s par le second.  Nous allons lui Ã©crire un script de lancement. <br><br>  <b>dice.bat</b> (pour Windows) <br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> OFF <span class="hljs-built_in"><span class="hljs-built_in">rem</span></span> Compiling <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\Dice\pom.xml" package <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">errorlevel</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Project compilation failed! &amp; <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> :EOF <span class="hljs-built_in"><span class="hljs-built_in">rem</span></span> Running java -jar path_to_project\Dice\target\dice-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span></code> </pre><br>  <b>dice.sh</b> (pour UNIX) <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # Compiling mvn -f "path_to_project/Dice/pom.xml" package if [[ "$?" -ne 0 ]] ; then echo 'Project compilation failed!'; exit $rc fi # Running java -jar path_to_project/Dice/target/dice-1.0-jar-with-dependencies.jar</span></span></code> </pre><br>  Veuillez noter que si la compilation Ã©choue, nous sommes obligÃ©s d'interrompre le script.  Sinon, pas la derniÃ¨re harpe ne sera lancÃ©e, mais le fichier restant de l'assemblage rÃ©ussi prÃ©cÃ©dent (parfois nous ne trouverons mÃªme pas la diffÃ©rence).  Souvent, les dÃ©veloppeurs utilisent la commande <code>mvn clean package</code> pour supprimer tous les fichiers prÃ©cÃ©demment compilÃ©s, mais dans ce cas, l'ensemble du processus de compilation commencera toujours depuis le tout dÃ©but (mÃªme si le code source n'a pas changÃ©), ce qui prendra beaucoup de temps.  Mais nous ne pouvons pas attendre - nous devons crÃ©er un jeu. <br><br>  Donc, le projet dÃ©marre bien, mais jusqu'Ã  prÃ©sent ne fait rien.  Ne vous inquiÃ©tez pas, nous le rÃ©parerons bientÃ´t. <br><br><h2>  <font color="#0474a0">Ã‰tape six</font>  <font color="#0474a0">Objets principaux</font> </h2><br>  Petit Ã  petit, nous commencerons Ã  remplir le package du <code>model</code> avec les classes nÃ©cessaires au gameplay. <br><br><div class="spoiler">  <b class="spoiler_title">Diagramme de classe</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/lv/de/4t/lvde4t7282puwgyjgl6qrooazka.png"></a> <br></div></div><br>  Les cubes sont notre tout, ajoutez-les d'abord.  Chaque dÃ© (une instance de la classe <code>Die</code> ) est caractÃ©risÃ© par son type (couleur) et sa taille.  Pour les types de cube, nous allons faire une Ã©numÃ©ration distincte ( <code>Die.Type</code> ), marquer la taille avec un entier de 4 Ã  12. Nous implÃ©mentons Ã©galement la mÃ©thode <code>roll()</code> , qui produira un nombre arbitraire et uniformÃ©ment distribuÃ© Ã  partir de la plage disponible pour le cube (de 1 Ã  la valeur de taille incluse). <br><br>  La classe implÃ©mente l'interface <code>Comparable</code> que les cubes puissent Ãªtre comparÃ©s les uns aux autres (utile plus tard lorsque nous afficherons plusieurs cubes dans une rangÃ©e ordonnÃ©e).  Des cubes plus grands seront placÃ©s plus tÃ´t. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Die</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) : Comparable&lt;Die&gt; { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ PHYSICAL, <span class="hljs-comment"><span class="hljs-comment">//Blue SOMATIC, //Green MENTAL, //Purple VERBAL, //Yellow DIVINE, //Cyan WOUND, //Gray ENEMY, //Red VILLAIN, //Orange OBSTACLE, //Brown ALLY //White } fun roll() = (1.. size).random() override fun toString() = "d$size" override fun compareTo(other: Die): Int { return compareValuesBy(this, other, Die::type, { -it.size }) } }</span></span></code> </pre><br>  Afin de ne pas accumuler de poussiÃ¨re, les cubes sont stockÃ©s dans des sacs Ã  main (copies de la classe <code>Bag</code> ).  On ne peut que deviner ce qui se passe Ã  l'intÃ©rieur du sac; par consÃ©quent, cela n'a aucun sens d'utiliser une collection commandÃ©e.  Il semble que ce soit le cas.  Les ensembles (ensembles) mettent bien en Å“uvre l'idÃ©e dont nous avons besoin, mais ne conviennent pas pour deux raisons.  Tout d'abord, lorsque vous les utiliserez, vous devrez implÃ©menter les mÃ©thodes <code>equals()</code> et <code>hashCode()</code> , et il n'est pas clair comment, car il est incorrect de comparer les types et les tailles de cubes - n'importe quel nombre de cubes identiques peut Ãªtre stockÃ© dans notre ensemble.  DeuxiÃ¨mement, en tirant le cube hors du sac, nous nous attendons Ã  obtenir non seulement quelque chose de non dÃ©terministe, mais alÃ©atoire, chaque fois diffÃ©rent.  Par consÃ©quent, je vous conseille nÃ©anmoins d'utiliser une collection ordonnÃ©e (liste) et de la mÃ©langer Ã  chaque fois que vous ajoutez un nouvel Ã©lÃ©ment (dans la mÃ©thode <code>put()</code> ) ou immÃ©diatement avant de le publier (dans la mÃ©thode <code>draw()</code> ). <br><br>  La mÃ©thode <code>examine()</code> convient aux cas oÃ¹ un joueur fatiguÃ© de l'incertitude secoue le contenu du sac sur la table dans le cÅ“ur (attention au tri) et la mÃ©thode <code>clear()</code> - si les cubes secouÃ©s ne reviennent pas dans le sac. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bag</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dice = LinkedList&lt;Die&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = dice.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">put</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">vararg</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dice: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { dice.forEach(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dice::addLast) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dice.shuffle() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Die = dice.pollFirst() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = dice.clear() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">examine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = dice.sorted().toList() }</code> </pre><br>  En plus des sacs avec des cubes, vous avez Ã©galement besoin de tas de cubes (instances de la classe <code>Pile</code> ).  Du premier, les seconds diffÃ¨rent en ce que leur contenu est visible pour les joueurs, et donc, si nÃ©cessaire, retirez un dÃ© du tas, le joueur peut sÃ©lectionner une instance d'intÃ©rÃªt spÃ©cifique.  Nous implÃ©mentons cette idÃ©e en utilisant la mÃ©thode <code>removeDie()</code> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pile</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Bag</span></span></span></span>() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = dice.remove(die) }</code> </pre><br>  Nous nous tournons maintenant vers nos personnages principaux - les hÃ©ros.  Autrement dit, des personnages que nous appellerons maintenant des hÃ©ros (il y a une bonne raison de ne pas appeler votre classe avec le nom de <code>Character</code> en Java).  Il existe diffÃ©rents types de personnages (pour le mettre en classe, bien qu'il soit prÃ©fÃ©rable de ne pas utiliser le mot <code>class</code> ), mais pour notre prototype de travail, nous n'en prendrons que deux: <i>Brawler</i> (c'est-Ã -dire Fighter en mettant l'accent sur la force et la force) et <i>Hunter</i> (aka Ranger / Thief, avec l'accent dextÃ©ritÃ© et furtivitÃ©).  La classe du hÃ©ros dÃ©termine ses caractÃ©ristiques, ses compÃ©tences et l'ensemble initial de cubes, mais comme nous le verrons plus loin, les hÃ©ros ne seront pas strictement liÃ©s aux classes, et donc leurs paramÃ¨tres personnels peuvent Ãªtre facilement modifiÃ©s en un seul endroit. <br><br>  Nous ajouterons les propriÃ©tÃ©s nÃ©cessaires au hÃ©ros conformÃ©ment au document de conception: nom, type de cube prÃ©fÃ©rÃ©, limites du cube, compÃ©tences apprises et non Ã©tudiÃ©es, main, sac et pile Ã  rÃ©initialiser.  Faites attention aux fonctionnalitÃ©s d'implÃ©mentation des propriÃ©tÃ©s de collection.  Dans tout le monde civilisÃ©, il est considÃ©rÃ© comme une mauvaise forme de fournir un accÃ¨s extÃ©rieur (avec l'aide d'un getter) aux collections stockÃ©es Ã  l'intÃ©rieur de l'objet - des programmeurs sans scrupules pourront modifier le contenu de ces collections Ã  l'insu de la classe.  Une faÃ§on de rÃ©soudre ce problÃ¨me consiste Ã  implÃ©menter des mÃ©thodes distinctes pour ajouter et supprimer des Ã©lÃ©ments, obtenir leur nombre et accÃ©der par index.  Vous pouvez implÃ©menter getter, mais en mÃªme temps, ne retournez pas la collection elle-mÃªme, mais sa copie immuable - pour un petit nombre d'Ã©lÃ©ments, il n'est pas particuliÃ¨rement effrayant de faire exactement cela. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hero</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ BRAWLER HUNTER } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isAlive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> favoredDieType: Die.Type = Die.Type.ALLY <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hand = Hand(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bag: Bag = Bag() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> discardPile: Pile = Pile() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> diceLimits = mutableListOf&lt;DiceLimit&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> skills = mutableListOf&lt;Skill&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills = mutableListOf&lt;Skill&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addDiceLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(limit: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DiceLimit</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = diceLimits.add(limit) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceLimits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;DiceLimit&gt; = Collections.unmodifiableList(diceLimits) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(skill: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = skills.add(skill) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSkills</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Skill&gt; = Collections.unmodifiableList(skills) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addDormantSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(skill: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = dormantSkills.add(skill) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDormantSkills</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Skill&gt; = Collections.unmodifiableList(dormantSkills) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">increaseDiceLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { diceLimits.find { it.type == type }?.let { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { it.current &lt; it.maximal -&gt; it.current++ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Already at maximum"</span></span>) } } ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Incorrect type specified"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideDieFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { bag.put(die) hand.removeDie(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">discardDieFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { discardPile.put(die) hand.removeDie(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = skills.any { it.type == type } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improveSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { dormantSkills .find { it.type == type } ?.let { skills.add(it) dormantSkills.remove(it) } skills .find { it.type == type } ?.let { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { it.level &lt; it.maxLevel -&gt; it.level += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Skill already maxed out"</span></span>) } } ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Skill not found"</span></span>) } }</code> </pre><br>  La main du hÃ©ros (les cubes qu'il a en ce moment) est dÃ©crite par un objet sÃ©parÃ© (classe <code>Hand</code> ).  La dÃ©cision de conception de garder les cubes alliÃ©s sÃ©parÃ©s du bras principal a Ã©tÃ© l'une des premiÃ¨res Ã  venir Ã  l'esprit.  Au dÃ©but, cela semblait Ãªtre une fonctionnalitÃ© super cool, mais plus tard, cela a gÃ©nÃ©rÃ© un grand nombre de problÃ¨mes et d'inconvÃ©nients.  NÃ©anmoins, nous ne recherchons pas de moyens faciles, et donc les listes de <code>dice</code> et d' <code>allies</code> sont Ã  notre service, avec toutes les mÃ©thodes dont vous avez besoin pour ajouter, recevoir et supprimer (certaines d'entre elles dÃ©terminent intelligemment laquelle des deux listes accÃ©der).  Lorsque vous supprimez un cube de votre main, tous les cubes suivants se dÃ©placeront en haut de la liste, remplissant les blancs - Ã  l'avenir, cela facilitera grandement la recherche (pas besoin de gÃ©rer les situations avec <code>null</code> ). <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hand</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> capacity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dice = LinkedList&lt;Die&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allies = LinkedList&lt;Die&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = dice.size <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyDieCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = allies.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dieAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { (index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until dieCount) -&gt; dice[index] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allyDieAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { (index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until allyDieCount) -&gt; allies[index] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { die.type == Die.Type.ALLY -&gt; allies.addLast(die) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; dice.addLast(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { die.type == Die.Type.ALLY -&gt; allies.remove(die) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; dice.remove(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findDieOfType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Die? = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { Die.Type.ALLY -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (allies.isNotEmpty()) allies.first <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; dice.firstOrNull { it.type == type } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">examine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Die&gt; = (dice + allies).sorted() }</code> </pre><br>  La collection d'objets de la classe <code>DiceLimit</code> fixe des limites sur le nombre de cubes de chaque type que le hÃ©ros peut avoir au dÃ©but du script.  Il n'y a rien de spÃ©cial Ã  dire, on dÃ©termine dans un premier temps, les valeurs maximales et actuelles pour chaque type. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceLimit</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Die.Type, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initial: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maximal: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>)</code> </pre><br>  Mais avec des compÃ©tences, c'est plus intÃ©ressant.  Chacun d'eux devra Ãªtre implÃ©mentÃ© individuellement (Ã  propos de quoi plus tard), mais nous n'en considÃ©rerons que deux: <i>Hit</i> et <i>Shoot</i> (un pour chaque classe, respectivement).  Les compÃ©tences peuvent Ãªtre dÃ©veloppÃ©es (Â«pompÃ©esÂ») du niveau initial au niveau maximum, ce qui affecte souvent les modificateurs qui sont ajoutÃ©s aux lancers de dÃ©s.  Cela se <code>maxLevel</code> dans le <code>level</code> propriÃ©tÃ©s, <code>maxLevel</code> , <code>modifier1</code> et <code>modifier2</code> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Skill</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//Brawler HIT, //Hunter SHOOT, } var level = 1 var maxLevel = 3 var isActive = true var modifier1 = 0 var modifier2 = 0 }</span></span></code> </pre><br>  Faites attention aux mÃ©thodes auxiliaires de la classe des <code>Hero</code> , qui vous permettent de cacher ou de lancer un dÃ© de votre main, de vÃ©rifier si le hÃ©ros possÃ¨de une certaine compÃ©tence, et Ã©galement d'augmenter le niveau de la compÃ©tence acquise ou d'en apprendre une nouvelle.  Tous seront nÃ©cessaires tÃ´t ou tard, mais maintenant nous ne nous attarderons pas sur eux en dÃ©tail. <br><br>  N'ayez pas peur du nombre de cours que nous devons crÃ©er.  Pour un projet de cette complexitÃ©, plusieurs centaines est chose courante.  Ici, comme dans toute occupation sÃ©rieuse - on commence petit, on augmente progressivement le rythme, en un mois on est terrifiÃ© par la portÃ©e.  N'oubliez pas, nous sommes toujours un petit studio d'une seule personne - nous ne sommes pas confrontÃ©s Ã  des tÃ¢ches Ã©crasantes. <br><br>  <i>Â«Quelque chose est tombÃ© malade de moi.</i>  <i>Je vais fumer ou quelque chose ... "</i> <br><br>  Et nous allons continuer. <br>  Les hÃ©ros et leurs capacitÃ©s sont dÃ©crits, il est temps de passer aux forces adverses - la grande et terrible Game Mechanics.  Ou plutÃ´t des objets avec lesquels nos hÃ©ros doivent interagir. <br><br><div class="spoiler">  <b class="spoiler_title">Un autre diagramme de classes</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/bq/7k/iq/bq7kiq7fcsqbhrf61f9g1bh-9e8.png"></a> <br></div></div><br>  Trois vaillants cubes et cartes opposeront nos vaillants protagonistes: les mÃ©chants (classe <code>Villain</code> ), les ennemis (classe <code>Enemy</code> ) et les obstacles (classe <code>Obstacle</code> ), unis sous le terme gÃ©nÃ©ral de "menaces" (La <code>Threat</code> est une classe abstraite "verrouillÃ©e", la liste de ses hÃ©ritiers possibles est strictement limitÃ©e).  Chaque menace a un ensemble de caractÃ©ristiques distinctives (trait) qui dÃ©crivent des rÃ¨gles de comportement spÃ©ciales face Ã  une telle menace et ajoutent de la variÃ©tÃ© au gameplay. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Threat</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits = mutableListOf&lt;Trait&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTrait</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">trait</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Trait</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = traits.add(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getTraits</span></span></span></span>(): List&lt;Trait&gt; = traits } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Obstacle</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tier: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieTypes: Die.Type) : Threat() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Villain</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Threat</span></span></span></span>() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enemy</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Threat</span></span></span></span>() <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Trait</span></span></span><span class="hljs-class"> </span></span>{ MODIFIER_PLUS_ONE, <span class="hljs-comment"><span class="hljs-comment">//Add +1 modifier MODIFIER_PLUS_TWO, //Add +2 modifier }</span></span></code> </pre><br>  Veuillez noter que la liste des objets de la classe <code>Trait</code> est dÃ©finie comme mutable ( <code>MutableList</code> ), mais elle est donnÃ©e comme une interface <code>List</code> immuable.  Bien que cela fonctionne dans Kotlin, l'approche n'est cependant pas sÃ»re, car rien ne l'empÃªche de convertir la liste rÃ©sultante en une interface mutable et d'apporter diverses modifications - il est particuliÃ¨rement facile de le faire si vous accÃ©dez Ã  la classe Ã  partir du code Java (oÃ¹ l'interface <code>List</code> est mutable).  La faÃ§on la plus paranoÃ¯aque de protÃ©ger votre collection est de faire quelque chose comme ceci: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTraits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Trait&gt; = Collections.unmodifiableList(traits)</code> </pre> <br>  mais nous ne serons pas aussi scrupuleux dans l'approche du problÃ¨me (vous Ãªtes cependant prÃ©venu). <br><br>  En raison des particularitÃ©s des mÃ©canismes de jeu, la classe <code>Obstacle</code> diffÃ¨re de ses homologues en prÃ©sence de champs supplÃ©mentaires, mais nous ne nous concentrerons pas sur eux. <br><br>  Les cartes de menace (et si vous lisez attentivement le document de conception, n'oubliez pas que ce sont des cartes) sont combinÃ©es en decks reprÃ©sentÃ©s par la classe <code>Deck</code> : <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Deck</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">E: Threat</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cards = LinkedList&lt;E&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = cards.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addToTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(card: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">E</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = cards.addFirst(card) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addToBottom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(card: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">E</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = cards.addLast(card) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">revealTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: E = cards.first <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawFromTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: E = cards.removeFirst() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shuffle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = cards.shuffle() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = cards.clear() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">examine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = cards.toList() }</code> </pre><br>  Il n'y a rien d'inhabituel ici, sauf que la classe est paramÃ©trÃ©e et contient une liste ordonnÃ©e (ou plutÃ´t une file d'attente bidirectionnelle), qui peut Ãªtre mÃ©langÃ©e en utilisant la mÃ©thode appropriÃ©e.  Des ponts d'ennemis et d'obstacles nous seront nÃ©cessaires littÃ©ralement dans une seconde, lorsque nous en arriverons Ã  la considÃ©ration ... <br><br>  ... de la classe <code>Location</code> , dont chaque instance dÃ©crit une localitÃ© unique que nos hÃ©ros devront visiter dans le cadre du script. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Location</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isOpen = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> closingDifficulty = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bag: Bag <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> villain: Villain? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> enemies: Deck&lt;Enemy&gt; <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obstacles: Deck&lt;Obstacle&gt; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = mutableListOf&lt;SpecialRule&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSpecialRule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rule: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SpecialRule</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = specialRules.add(rule) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpecialRules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = specialRules }</code> </pre><br>  Chaque localitÃ© a un nom, une description, une difficultÃ© de fermeture et le signe Â«ouvert / fermÃ©Â».  Quelque part ici, le mÃ©chant peut se cacher (ou il peut ne pas se cacher, Ã  la suite de quoi la propriÃ©tÃ© du <code>villain</code> peut Ãªtre <code>null</code> ).  Dans chaque zone, il y a un sac avec des cubes et un jeu de cartes avec des menaces.  De plus, la zone peut avoir ses propres caractÃ©ristiques de jeu uniques ( <code>SpecialRule</code> ), qui, comme les propriÃ©tÃ©s des menaces, ajoutent de la variÃ©tÃ© au gameplay.  Comme vous pouvez le voir, nous jetons les bases de fonctionnalitÃ©s futures, mÃªme si nous ne prÃ©voyons pas de les implÃ©menter dans un avenir proche (pour lequel, en fait, nous avons besoin de l'Ã©tape de modÃ©lisation). <br><br>  Enfin, il reste Ã  implÃ©menter les scripts (classe <code>Scenario</code> ): <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scenario</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> level = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initialTimer = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allySkills = mutableListOf&lt;AllySkill&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = mutableListOf&lt;SpecialRule&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAllySkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(skill: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AllySkill</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = allySkills.add(skill) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAllySkills</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;AllySkill&gt; = Collections.unmodifiableList(allySkills) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSpecialRule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rule: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SpecialRule</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = specialRules.add(rule) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpecialRules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;SpecialRule&gt; = Collections.unmodifiableList(specialRules) }</code> </pre><br>  Chaque scÃ©nario est caractÃ©risÃ© par le niveau et la valeur initiale du temporisateur.  Semblable Ã  ce qui a Ã©tÃ© vu prÃ©cÃ©demment, des rÃ¨gles spÃ©ciales (rÃ¨gles spÃ©ciales) et les compÃ©tences des alliÃ©s sont dÃ©finies (nous allons manquer de considÃ©ration).  Vous pourriez penser que le script devrait Ã©galement contenir une liste d'emplacements (objets de la classe <code>Location</code> ) et, logiquement, c'est vraiment le cas.  Mais comme on le verra plus loin, nous n'utiliserons une telle connexion nulle part et cela ne donne aucun avantage technique. <br><br>  Je vous rappelle que toutes les classes considÃ©rÃ©es jusqu'Ã  prÃ©sent sont contenues dans le package du <code>model</code> - nous, en tant qu'enfant, en prÃ©vision d'une bataille de jouets Ã©pique, avons placÃ© des soldats Ã  la surface de la table.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et maintenant, aprÃ¨s quelques moments douloureux, au signal du commandant en chef, nous allons nous prÃ©cipiter dans la bataille, rassembler nos jouets et profiter des consÃ©quences du gameplay. </font><font style="vertical-align: inherit;">Mais avant cela, un peu sur l'arrangement lui-mÃªme. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Bien sooo ..."</font></font></i> <br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeptiÃ¨me Ã©tape. </font><font style="vertical-align: inherit;">ModÃ¨les et gÃ©nÃ©rateurs</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imaginons une seconde quel sera le processus de gÃ©nÃ©ration de l'un des objets prÃ©cÃ©demment considÃ©rÃ©s, par exemple, l'emplacement (terrain). </font><font style="vertical-align: inherit;">Nous devons crÃ©er une instance de la classe </font></font><code>Location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, initialiser ses champs avec des valeurs, et ainsi pour chaque localitÃ© que nous voulons utiliser dans le jeu. </font><font style="vertical-align: inherit;">Mais attendez: chaque emplacement doit avoir un sac, qui doit Ã©galement Ãªtre gÃ©nÃ©rÃ©. </font><font style="vertical-align: inherit;">Et les sacs ont des cubes - ce sont aussi des instances de la classe correspondante ( </font></font><code>Die</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Je ne parle pas des ennemis et des obstacles - ils doivent gÃ©nÃ©ralement Ãªtre collectÃ©s sur des ponts. </font><font style="vertical-align: inherit;">Et le mÃ©chant ne dÃ©termine pas le terrain lui-mÃªme, mais les caractÃ©ristiques du scÃ©nario situÃ©es un niveau plus haut. </font><font style="vertical-align: inherit;">Eh bien, vous obtenez le point. </font><font style="vertical-align: inherit;">Le code source de ce qui prÃ©cÃ¨de peut ressembler Ã  ceci:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> location = Location().apply { name = <span class="hljs-string"><span class="hljs-string">"Some location"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> isOpen = <span class="hljs-literal"><span class="hljs-literal">true</span></span> closingDifficulty = <span class="hljs-number"><span class="hljs-number">4</span></span> bag = Bag().apply { put(Die(Die.Type.PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>)) put(Die(Die.Type.SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>)) put(Die(Die.Type.MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>)) put(Die(Die.Type.ENEMY, <span class="hljs-number"><span class="hljs-number">6</span></span>)) put(Die(Die.Type.OBSTACLE, <span class="hljs-number"><span class="hljs-number">6</span></span>)) put(Die(Die.Type.VILLAIN, <span class="hljs-number"><span class="hljs-number">6</span></span>)) } villain = Villain().apply { name = <span class="hljs-string"><span class="hljs-string">"Some villain"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> addTrait(Trait.MODIFIER_PLUS_ONE) } enemies = Deck&lt;Enemy&gt;().apply { addToTop(Enemy().apply { name = <span class="hljs-string"><span class="hljs-string">"Some enemy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> }) addToTop(Enemy().apply { name = <span class="hljs-string"><span class="hljs-string">"Other enemy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> }) shuffle() } obstacles = Deck&lt;Obstacle&gt;().apply { addToTop(Obstacle(<span class="hljs-number"><span class="hljs-number">1</span></span>, Die.Type.PHYSICAL, Die.Type.VERBAL).apply { name = <span class="hljs-string"><span class="hljs-string">"Some obstacle"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some Description"</span></span> }) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est aussi grÃ¢ce au langage et Ã  la conception de Kotlin </font></font><code>apply{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- en Java, le code serait deux fois plus volumineux. De plus, il y aura de nombreux endroits, comme nous l'avons dit, et Ã  cÃ´tÃ© d'eux il y a aussi des scÃ©narios, des aventures et des hÃ©ros avec leurs compÃ©tences et leurs caractÃ©ristiques - en gÃ©nÃ©ral, il y a quelque chose Ã  faire pour le game designer.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais le concepteur du jeu n'Ã©crira pas de code, et il est gÃªnant pour nous de recompiler le projet au moindre changement dans le monde du jeu. </font><font style="vertical-align: inherit;">Ici, tout programmeur compÃ©tent objectera que les descriptions des objets du code de classe doivent Ãªtre sÃ©parÃ©es - idÃ©alement, de sorte que les instances de ce dernier soient gÃ©nÃ©rÃ©es dynamiquement en fonction du premier si nÃ©cessaire, de la mÃªme maniÃ¨re que la piÃ¨ce est fabriquÃ©e Ã  partir d'une usine de dessin. </font><font style="vertical-align: inherit;">Nous implÃ©mentons Ã©galement de tels dessins, nous les appelons uniquement des modÃ¨les et les reprÃ©sentons comme des instances d'une classe spÃ©ciale. </font><font style="vertical-align: inherit;">Ayant de tels modÃ¨les, un code de programme spÃ©cial (gÃ©nÃ©rateur) crÃ©era les objets finaux Ã  partir du modÃ¨le dÃ©crit prÃ©cÃ©demment.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le processus de gÃ©nÃ©ration d'un objet Ã  partir d'un modÃ¨le</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/lj/cn/hb/ljcnhbcwls0jogmaxfbncrek6gc.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, pour chaque classe de nos objets, deux nouvelles entitÃ©s doivent Ãªtre dÃ©finies: l'interface modÃ¨le et la classe gÃ©nÃ©rateur. </font><font style="vertical-align: inherit;">Et comme une quantitÃ© dÃ©cente d'objets s'est accumulÃ©e, il y aura Ã©galement un certain nombre d'entitÃ©s ... indÃ©centes:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagramme de classe</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ef/hu/4k/efhu4kgepx97_87cnpis8ranl0c.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veuillez respirer plus profondÃ©ment, Ã©couter attentivement et ne pas Ãªtre distrait. PremiÃ¨rement, le diagramme ne montre pas tous les objets du monde du jeu, mais seulement les principaux, dont vous ne pouvez pas vous passer au dÃ©but. DeuxiÃ¨mement, afin de ne pas surcharger le circuit avec des dÃ©tails inutiles, certaines des connexions dÃ©jÃ  mentionnÃ©es prÃ©cÃ©demment dans d'autres diagrammes ont Ã©tÃ© omises. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CommenÃ§ons par quelque chose de simple: gÃ©nÃ©rer des cubes. Â«Comment? - dites-vous. - Sommes-nous pas assez constructeur? Oui, c'est celui avec le type et la taille. " Non, je rÃ©pondrai, pas assez. En effet, dans de nombreux cas (lire les rÃ¨gles), les cubes doivent Ãªtre gÃ©nÃ©rÃ©s arbitrairement en quantitÃ© arbitraire (par exemple: Â«d'un Ã  trois cubes de bleu ou de vertÂ»). De plus, la taille doit Ãªtre sÃ©lectionnÃ©e en fonction du niveau de complexitÃ© du script. Par consÃ©quent, nous introduisons une interface spÃ©ciale </font></font><code>DieTypeFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DieTypeFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DiffÃ©rentes implÃ©mentations de cette interface vÃ©rifieront si le type de cube correspond Ã  diffÃ©rents ensembles de rÃ¨gles (celles qui ne viennent qu'Ã  l'esprit). </font><font style="vertical-align: inherit;">Par exemple, si le type correspond Ã  une valeur strictement spÃ©cifiÃ©e ("bleu") ou Ã  une plage de valeurs ("bleu, jaune ou vert"); </font><font style="vertical-align: inherit;">ou, Ã  l'inverse, correspond Ã  tout type autre que celui donnÃ© ("si seulement il n'Ã©tait pas blanc dans tous les cas" - n'importe quoi, mais pas Ã§a). </font><font style="vertical-align: inherit;">MÃªme si on ne sait pas Ã  l'avance quelles implÃ©mentations spÃ©cifiques sont nÃ©cessaires, cela n'a pas d'importance - elles peuvent Ãªtre ajoutÃ©es plus tard, le systÃ¨me n'en cassera pas (polymorphisme, rappelez-vous?).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type == type) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvertedSingleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type != type) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultipleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvertedMultipleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (type !<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La taille du cube sera Ã©galement dÃ©finie arbitrairement, mais plus Ã  ce sujet plus tard. </font><font style="vertical-align: inherit;">En attendant, nous Ã©crirons un gÃ©nÃ©rateur de cubes ( </font></font><code>DieGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) qui, contrairement au constructeur de classe </font></font><code>Die</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, n'acceptera pas le type et la taille explicites du cube, mais le filtre et le niveau de complexitÃ©.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTION_LEVEL1 = intArrayOf(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTION_LEVEL2 = intArrayOf(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTION_LEVEL3 = intArrayOf(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTIONS = arrayOf( intArrayOf(<span class="hljs-number"><span class="hljs-number">4</span></span>), DISTRIBUTION_LEVEL1, DISTRIBUTION_LEVEL2, DISTRIBUTION_LEVEL3 ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMaxLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = DISTRIBUTIONS.size - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Die(generateDieType(filter), generateDieSize(level)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDieType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Die.Type { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type: Die.Type <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { type = Die.Type.values().random() } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!filter.test(type)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> type } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDieSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = DISTRIBUTIONS[<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || level &gt; getMaxLevel()) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> level].random()</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En Java, ces mÃ©thodes seraient statiques, mais comme nous avons affaire Ã  Kotlin, nous n'avons pas besoin de la classe en tant que telle, ce qui est Ã©galement vrai pour les autres gÃ©nÃ©rateurs dÃ©crits ci-dessous (nÃ©anmoins, au niveau logique, nous utiliserons toujours le concept de classe). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deux mÃ©thodes privÃ©es gÃ©nÃ¨rent sÃ©parÃ©ment le type et la taille du cube - quelque chose d'intÃ©ressant peut Ãªtre dit Ã  propos de chacune. La mÃ©thode </font></font><code>generateDieType()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut Ãªtre conduite dans une boucle infinie en passant un filtre d'entrÃ©e avec</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Les Ã©crivains croient fermement que l'on peut sortir des incohÃ©rences logiques et tracer des trous si les personnages eux-mÃªmes les dirigent vers le public pendant l'histoire). La mÃ©thode </font></font><code>generateDieSize()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gÃ©nÃ¨re une taille pseudo-alÃ©atoire basÃ©e sur la distribution spÃ©cifiÃ©e sous la forme d'un tableau (un pour chaque niveau). Quand je serai riche et que j'achÃ¨terai un paquet de cubes de jeu multicolores, je ne pourrai pas jouer aux </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dÃ©s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , parce que je ne saurai pas rÃ©cupÃ©rer un sac au hasard (sauf pour demander Ã  un voisin et se dÃ©tourner Ã  ce moment-lÃ ). Ce n'est pas un jeu de cartes qui peut Ãªtre mÃ©langÃ© Ã  l'envers, il nÃ©cessite des mÃ©canismes et des dispositifs spÃ©ciaux. Si quelqu'un a des idÃ©es (et il a eu la patience de lire Ã  cet endroit), veuillez partager dans les commentaires.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et puisque nous parlons de sacs, nous allons dÃ©velopper un modÃ¨le pour eux. </font><font style="vertical-align: inherit;">Contrairement Ã  vos amis, ce modÃ¨le ( </font></font><code>BagTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) sera une classe spÃ©cifique. </font><font style="vertical-align: inherit;">Il contient d'autres modÃ¨les - chacun d'eux dÃ©crit les rÃ¨gles (ou </font></font><code>Plan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) selon lesquelles un ou plusieurs cubes (rappelez-vous les exigences faites prÃ©cÃ©demment?) Sont ajoutÃ©s au sac.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BagTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plan</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> minQuantity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maxQuantity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> filter: DieTypeFilter) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> plans = mutableListOf&lt;Plan&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPlan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(minQuantity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, maxQuantity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { plans.add(Plan(minQuantity, maxQuantity, filter)) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque plan dÃ©finit un modÃ¨le pour le type de cubes, ainsi que le nombre (minimum et maximum) de cubes qui satisfont ce modÃ¨le. </font><font style="vertical-align: inherit;">GrÃ¢ce Ã  cette approche, vous pouvez gÃ©nÃ©rer des sacs selon des rÃ¨gles bizarres (et je pleure Ã  nouveau amÃ¨rement la vieillesse, car mon voisin refuse catÃ©goriquement de m'aider). </font><font style="vertical-align: inherit;">Quelque chose comme Ã§a:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">realizePlan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(plan: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">BagTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Plan</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Array&lt;Die&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> count = (plan.minQuantity..plan.maxQuantity).shuffled().last() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>..count).map { generateDie(plan.filter, level) }.toTypedArray() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateBag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">BagTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Bag { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> template.plans.asSequence() .map { realizePlan(it, level) } .fold(Bag()) { b, d -&gt; b.put(*d); b } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous, comme moi, Ãªtes fatiguÃ©s de tout ce fonctionnalisme, attachez-vous - cela ne fera qu'empirer. Mais alors, contrairement Ã  de nombreux didacticiels indistincts sur Internet, nous avons la possibilitÃ© d'Ã©tudier l'utilisation de diverses mÃ©thodes intelligentes par rapport Ã  un sujet rÃ©el et comprÃ©hensible. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En eux-mÃªmes, les sacs ne seront pas couchÃ©s sur le terrain - vous devez les donner aux hÃ©ros et aux lieux. CommenÃ§ons par ce dernier.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocationTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bagTemplate: BagTemplate <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> basicClosingDifficulty: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardsCount: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardsCount: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardPool: Collection&lt;EnemyTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardPool: Collection&lt;ObstacleTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules: List&lt;SpecialRule&gt; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le langage Kotlin, au lieu de mÃ©thodes, </font></font><code>get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez utiliser les propriÃ©tÃ©s d'interface - c'est beaucoup plus concis. Nous connaissons dÃ©jÃ  le modÃ¨le de sac, considÃ©rons les mÃ©thodes restantes. La propriÃ©tÃ© </font></font><code>basicClosingDifficulty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dÃ©finira la complexitÃ© de base du contrÃ´le de fermeture du terrain. Le mot Â«basiqueÂ» signifie ici seulement que la complexitÃ© finale dÃ©pendra du niveau du scÃ©nario et n'est pas claire Ã  ce stade. De plus, nous devons dÃ©finir des modÃ¨les pour les ennemis et les obstacles (et les mÃ©chants en mÃªme temps). De plus, parmi la variÃ©tÃ© d'ennemis et d'obstacles dÃ©crits dans le modÃ¨le, tous ne seront pas utilisÃ©s, mais seulement un nombre limitÃ© (pour augmenter la valeur de relecture). Veuillez noter que les rÃ¨gles spÃ©ciales ( </font></font><code>SpecialRule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) de la zone sont implÃ©mentÃ©es par une simple Ã©numÃ©ration ( </font></font><code>enum class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), et ne nÃ©cessitent donc pas de modÃ¨le sÃ©parÃ©.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnemyTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits: List&lt;Trait&gt; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObstacleTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tier: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieTypes: Array&lt;Die.Type&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits: List&lt;Trait&gt; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VillainTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits: List&lt;Trait&gt; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et laissez le gÃ©nÃ©rateur crÃ©er non seulement des objets individuels, mais aussi des decks entiers avec eux. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateVillain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">VillainTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Villain().apply { name = template.name description = template.description template.traits.forEach { addTrait(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateEnemy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EnemyTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Enemy().apply { name = template.name description = template.description template.traits.forEach { addTrait(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateObstacle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ObstacleTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Obstacle(template.tier, *template.dieTypes).apply { name = template.name description = template.description template.traits.forEach { addTrait(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateEnemyDeck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(types: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Collection</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EnemyTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, limit: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Deck&lt;Enemy&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deck = types .map { generateEnemy(it) } .shuffled() .fold(Deck&lt;Enemy&gt;()) { d, c -&gt; d.addToTop(c); d } limit?.let { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (deck.size &gt; it) deck.drawFromTop() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deck } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateObstacleDeck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(templates: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Collection</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ObstacleTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, limit: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Deck&lt;Obstacle&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deck = templates .map { generateObstacle(it) } .shuffled() .fold(Deck&lt;Obstacle&gt;()) { d, c -&gt; d.addToTop(c); d } limit?.let { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (deck.size &gt; it) deck.drawFromTop() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deck }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S'il y a plus de cartes dans le jeu que nous n'en avons besoin (paramÃ¨tre </font></font><code>limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), nous les en retirerons. </font><font style="vertical-align: inherit;">Pouvant gÃ©nÃ©rer des sacs avec des cubes et des packs de cartes, nous pouvons enfin crÃ©er du terrain:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LocationTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Location().apply { name = template.name description = template.description bag = generateBag(template.bagTemplate, level) closingDifficulty = template.basicClosingDifficulty + level * <span class="hljs-number"><span class="hljs-number">2</span></span> enemies = generateEnemyDeck(template.enemyCardPool, template.enemyCardsCount) obstacles = generateObstacleDeck(template.obstacleCardPool, template.obstacleCardsCount) template.specialRules.forEach { addSpecialRule(it) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le terrain que nous avons explicitement dÃ©fini dans le code au dÃ©but du chapitre prendra maintenant un tout autre aspect: </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeLocationTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LocationTemplate { override val name = "Some location" override val description = "Some description" override val bagTemplate = BagTemplate</span></span></span></span>().apply { addPlan(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, SingleDieTypeFilter(Die.Type.PHYSICAL)) addPlan(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, SingleDieTypeFilter(Die.Type.SOMATIC)) addPlan(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.MENTAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, MultipleDieTypeFilter(Die.Type.ENEMY, Die.Type.OBSTACLE)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> basicClosingDifficulty = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardsCount = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardsCount = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardPool = listOf( SomeEnemyTemplate(), OtherEnemyTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardPool = listOf( SomeObstacleTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = emptyList&lt;SpecialRule&gt;() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeEnemyTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EnemyTemplate { override val name = "Some enemy" override val description = "Some description" override val traits = emptyList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Trait</span></span></span><span class="hljs-class">&gt;</span></span>() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OtherEnemyTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EnemyTemplate { override val name = "Other enemy" override val description = "Some description" override val traits = emptyList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Trait</span></span></span><span class="hljs-class">&gt;</span></span>() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeObstacleTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ObstacleTemplate { override val name = "Some obstacle" override val description = "Some description" override val traits = emptyList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Trait</span></span></span><span class="hljs-class">&gt;</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tier = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieTypes = arrayOf( Die.Type.PHYSICAL, Die.Type.VERBAL ) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> location = generateLocation(SomeLocationTemplate(), <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La gÃ©nÃ©ration de scÃ©narios se produira de la mÃªme maniÃ¨re. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScenarioTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialTimer: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> staticLocations: List&lt;LocationTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dynamicLocationsPool: List&lt;LocationTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> villains: List&lt;VillainTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules: List&lt;SpecialRule&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateDynamicLocationsCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numberOfHeroes: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = numberOfHeroes + <span class="hljs-number"><span class="hljs-number">2</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConformÃ©ment aux rÃ¨gles, le nombre d'emplacements gÃ©nÃ©rÃ©s dynamiquement dÃ©pend du nombre de hÃ©ros. </font><font style="vertical-align: inherit;">L'interface dÃ©finit une fonction de calcul standard qui, si vous le souhaitez, peut Ãªtre redÃ©finie dans des implÃ©mentations spÃ©cifiques. </font><font style="vertical-align: inherit;">En lien avec cette exigence, le gÃ©nÃ©rateur de scÃ©nario gÃ©nÃ©rera Ã©galement un terrain pour ces scÃ©narios - au mÃªme endroit, les mÃ©chants seront rÃ©partis au hasard entre les localitÃ©s.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateScenario</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ScenarioTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Scenario().apply { name =template.name description = template.description <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.level = level initialTimer = template.initialTimer template.specialRules.forEach { addSpecialRule(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateLocations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ScenarioTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, numberOfHeroes: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;Location&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locations = template.staticLocations.map { generateLocation(it, level) } + template.dynamicLocationsPool .map { generateLocation(it, level) } .shuffled() .take(template.calculateDynamicLocationsCount(numberOfHeroes)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> villains = template.villains .map(::generateVillain) .shuffled() locations.forEachIndexed { index, location -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &lt; villains.size) { location.villain = villains[index] location.bag.put(generateDie(SingleDieTypeFilter(Die.Type.VILLAIN), level)) } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> locations }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De nombreux lecteurs attentifs objecteront que les modÃ¨les doivent Ãªtre stockÃ©s non pas dans le code source des classes, mais dans certains fichiers texte (scripts) afin que mÃªme ceux qui ne sont pas programmÃ©s puissent les crÃ©er et les maintenir. </font><font style="vertical-align: inherit;">Je suis d'accord, j'enlÃ¨ve mon chapeau, mais je ne saupoudre pas de cendres sur ma tÃªte - car l'un n'interfÃ¨re pas avec l'autre. </font><font style="vertical-align: inherit;">Si vous le souhaitez, dÃ©finissez simplement une implÃ©mentation spÃ©ciale du modÃ¨le, dont les valeurs de propriÃ©tÃ© seront chargÃ©es Ã  partir d'un fichier externe. </font><font style="vertical-align: inherit;">Le processus de gÃ©nÃ©ration n'en changera pas un iota. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, il semble qu'ils n'aient rien oubliÃ© ... Oh oui, les hÃ©ros - ils doivent Ã©galement Ãªtre gÃ©nÃ©rÃ©s, ce qui signifie qu'ils ont Ã©galement besoin de leurs propres modÃ¨les. </font><font style="vertical-align: inherit;">En voici quelques exemples, par exemple:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeroTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Hero.Type <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialHandCapacity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> favoredDieType: Die.Type <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialDice: Collection&lt;Die&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialSkills: List&lt;SkillTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills: List&lt;SkillTemplate&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Pair&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;? }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et immÃ©diatement, nous remarquons deux bizarreries. </font><font style="vertical-align: inherit;">PremiÃ¨rement, nous n'utilisons pas de modÃ¨les pour y gÃ©nÃ©rer des sacs et des cubes.</font></font> Pourquoi?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, car pour chaque type (classe) de hÃ©ros, la liste des cubes initiaux est strictement dÃ©finie - cela n'a aucun sens de compliquer le processus de crÃ©ation. </font><font style="vertical-align: inherit;">DeuxiÃ¨mement, </font></font><code>getDiceCount()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- quel genre de lie est-ce ??? </font><font style="vertical-align: inherit;">Calmez-vous, ce sont eux </font></font><code>DiceLimit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui dÃ©finissent les restrictions sur les cubes. </font><font style="vertical-align: inherit;">Et le modÃ¨le pour eux a Ã©tÃ© choisi sous une forme si bizarre que des valeurs spÃ©cifiques ont Ã©tÃ© enregistrÃ©es plus clairement. </font><font style="vertical-align: inherit;">Voyez par vous-mÃªme l'exemple:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BrawlerHeroTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HeroTemplate { override val type = Hero.Type.BRAWLER override val favoredDieType = PHYSICAL override val initialHandCapacity = 4 override val initialDice = listOf</span></span></span></span>( Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(VERBAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(VERBAL, <span class="hljs-number"><span class="hljs-number">4</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { PHYSICAL -&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> to <span class="hljs-number"><span class="hljs-number">12</span></span> SOMATIC -&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> to <span class="hljs-number"><span class="hljs-number">7</span></span> MENTAL -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">2</span></span> VERBAL -&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> to <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialSkills = listOf( HitSkillTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills = listOf&lt;SkillTemplate&gt;() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HunterHeroTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HeroTemplate { override val type = Hero.Type.HUNTER override val favoredDieType = SOMATIC override val initialHandCapacity = 5 override val initialDice = listOf</span></span></span></span>( Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(VERBAL, <span class="hljs-number"><span class="hljs-number">4</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { PHYSICAL -&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> to <span class="hljs-number"><span class="hljs-number">5</span></span> SOMATIC -&gt; <span class="hljs-number"><span class="hljs-number">7</span></span> to <span class="hljs-number"><span class="hljs-number">11</span></span> MENTAL -&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> to <span class="hljs-number"><span class="hljs-number">7</span></span> VERBAL -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialSkills = listOf( ShootSkillTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills = listOf&lt;SkillTemplate&gt;() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mais avant d'Ã©crire un gÃ©nÃ©rateur, nous dÃ©finissons un modÃ¨le de compÃ©tences. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SkillTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Skill.Type <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maxLevel: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> modifier1: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> modifier2: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> isActive <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HitSkillTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SkillTemplate { override val type = Skill.Type.HIT override val maxLevel = 3 override val modifier1 = +1 override val modifier2 = +3 } class ShootSkillTemplate : SkillTemplate { override val type = Skill.Type.SHOOT override val maxLevel = 3 override val modifier1 = +0 override val modifier2 = +2 }</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malheureusement, nous ne rÃ©ussirons pas Ã  riveter les compÃ©tences par lots de la mÃªme maniÃ¨re que les ennemis et les scripts. </font><font style="vertical-align: inherit;">Chaque nouvelle compÃ©tence nÃ©cessite l'extension des mÃ©canismes de jeu, l'ajout d'un nouveau code au moteur de jeu - mÃªme avec des hÃ©ros Ã  cet Ã©gard est plus facile. </font><font style="vertical-align: inherit;">Peut-Ãªtre que ce processus peut Ãªtre abstrait, mais je n'ai pas encore trouvÃ© de moyen. </font><font style="vertical-align: inherit;">Oui, et pas trop essayÃ©, pour Ãªtre honnÃªte.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SkillTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, initialLevel: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Skill { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> skill = Skill(template.type) skill.isActive = template.isActive skill.level = initialLevel skill.maxLevel = template.maxLevel skill.modifier1 = template.modifier1 skill.modifier2 = template.modifier2 <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> skill } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateHero</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">, name: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Hero { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> template = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { BRAWLER -&gt; BrawlerHeroTemplate() HUNTER -&gt; HunterHeroTemplate() } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hero = Hero(type) hero.name = name hero.isAlive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> hero.favoredDieType = template.favoredDieType hero.hand.capacity = template.initialHandCapacity template.initialDice.forEach { hero.bag.put(it) } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ((t, l) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Die.Type.values().map { it to template.getDiceCount(it) }) { l?.let { hero.addDiceLimit(DiceLimit(t, it.first, it.second, it.first)) } } template.initialSkills .map { generateSkill(it) } .forEach { hero.addSkill(it) } template.dormantSkills .map { generateSkill(it, <span class="hljs-number"><span class="hljs-number">0</span></span>) } .forEach { hero.addDormantSkill(it) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hero }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques instants sont frappants. </font><font style="vertical-align: inherit;">Tout d'abord, la mÃ©thode de gÃ©nÃ©ration elle-mÃªme sÃ©lectionne le modÃ¨le souhaitÃ© en fonction de la classe du hÃ©ros. </font><font style="vertical-align: inherit;">DeuxiÃ¨mement, il n'est pas nÃ©cessaire de spÃ©cifier un nom immÃ©diatement (parfois au stade de la gÃ©nÃ©ration, nous ne le connaÃ®trons pas encore). </font><font style="vertical-align: inherit;">TroisiÃ¨mement, Kotlin a apportÃ© une quantitÃ© sans prÃ©cÃ©dent de sucre syntaxique, dont certains dÃ©veloppeurs abusent dÃ©raisonnablement. </font><font style="vertical-align: inherit;">Et pas un peu honteux.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tape huit. </font><font style="vertical-align: inherit;">Cycle de jeu</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, nous sommes arrivÃ©s au plus intÃ©ressant - la mise en Å“uvre du cycle de jeu. </font><font style="vertical-align: inherit;">En termes simples, ils ont commencÃ© Ã  Â«faire le jeuÂ». </font><font style="vertical-align: inherit;">De nombreux dÃ©veloppeurs dÃ©butants partent souvent prÃ©cisÃ©ment de cette Ã©tape, Ã  part la crÃ©ation de jeux, tout le reste. </font><font style="vertical-align: inherit;">Surtout toutes sortes de petits schÃ©mas insignifiants Ã  dessiner, pfff ... Mais nous ne nous prÃ©cipiterons pas (c'est encore loin du matin), et donc un peu plus de modÃ©lisation. </font><font style="vertical-align: inherit;">Oui encore.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableau d'activitÃ©</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/up/tm/6t/uptm6t8obpw80m3_cr1i6b9q62e.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous pouvez le voir, le fragment donnÃ© du cycle de jeu est d'un ordre de grandeur infÃ©rieur Ã  ce que nous avons citÃ© ci-dessus. Nous ne considÃ©rerons que le processus de transfert du parcours, l'exploration de la zone (et nous dÃ©crirons la rÃ©union avec seulement deux types de cubes) et l'Ã©limination des cubes Ã  la fin du tour. Et terminer le scÃ©nario avec une perte (oui, nous ne rÃ©ussirons pas encore Ã  gagner notre jeu) - mais comment aimez-vous? Le chronomÃ¨tre diminuera Ã  chaque tour, et Ã  la fin, quelque chose doit Ãªtre fait. Par exemple, affichez un message et terminez le jeu - tout est comme il est Ã©crit dans les rÃ¨gles. Un autre jeu doit Ãªtre terminÃ© Ã  la mort des hÃ©ros, mais personne ne leur fera de mal, donc nous le quitterons. Pour gagner, vous devez fermer toutes les zones, ce qui est difficile mÃªme si ce n'est qu'une seule. Par consÃ©quent, quittons ce moment. Cela n'a pas de sens de pulvÃ©riser trop - il est important pour nous de comprendre l'essence et de terminer le reste plus tard, pendant mon temps libre (ou plutÃ´t de le terminer,et vous - allez Ã©crire un jeu</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de vos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rÃªves). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donc, la premiÃ¨re chose Ã  faire est de dÃ©cider des objets dont nous avons besoin. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les hÃ©ros Le script. Emplacements.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons dÃ©jÃ  revu le processus de leur crÃ©ation - nous ne le rÃ©pÃ©terons pas. Nous notons seulement le modÃ¨le de terrain que nous utiliserons dans notre petit exemple.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestLocationTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LocationTemplate { override val name = "Test" override val description = "Some Description" override val basicClosingDifficulty = 0 override val enemyCardsCount = 0 override val obstacleCardsCount = 0 override val bagTemplate = BagTemplate</span></span></span></span>().apply { addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.PHYSICAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.SOMATIC)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.MENTAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.VERBAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.DIVINE)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardPool = emptyList&lt;EnemyTemplate&gt;() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardPool = emptyList&lt;ObstacleTemplate&gt;() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = emptyList&lt;SpecialRule&gt;() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous pouvez le voir, dans le sac ne sont que des cubes "positifs" - bleu, vert, violet, jaune et bleu. Il n'y a pas d'ennemis et d'obstacles dans la rÃ©gion, les mÃ©chants et les blessures ne sont pas trouvÃ©s. Il n'y a pas non plus de rÃ¨gles spÃ©ciales - leur mise en Å“uvre est trÃ¨s secondaire. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tas de cubes retenus.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ou une pile dissuasive. Puisque nous mettons les cubes bleus dans le sac du terrain, ils peuvent Ãªtre utilisÃ©s dans les contrÃ´les et aprÃ¨s utilisation, conservÃ©s dans un tas spÃ©cial. Une instance de la classe est utile pour cela </font></font><code>Pile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modificateurs.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autrement dit, les valeurs numÃ©riques qui doivent Ãªtre ajoutÃ©es ou soustraites du rÃ©sultat du jet de dÃ©. Vous pouvez implÃ©menter un modificateur global ou un modificateur distinct pour chaque cube. Nous choisirons la deuxiÃ¨me option (donc plus clairement), donc nous crÃ©erons une classe simple </font></font><code>DiePair</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiePair</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> die: Die, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> modifier: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'emplacement des personnages dans la zone.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dans le bon sens, ce moment doit Ãªtre suivi Ã  l'aide d'une structure spÃ©ciale. Par exemple, des cartes du formulaire </font></font><code>Map&lt;Location, List&lt;Hero&gt;&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oÃ¹ chaque localitÃ© contiendra une liste des hÃ©ros qui s'y trouvent actuellement (ainsi qu'une mÃ©thode pour l'inverse - dÃ©terminer la localitÃ© dans laquelle se trouve un hÃ©ros particulier). Si vous dÃ©cidez de suivre ce chemin, n'oubliez pas d'ajouter des </font></font><code>Location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mÃ©thodes Ã  la </font><font style="vertical-align: inherit;">classe d' </font><font style="vertical-align: inherit;">implÃ©mentation </font></font><code>equals()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>hashCode()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, j'espÃ¨re, il n'est pas nÃ©cessaire d'expliquer pourquoi. Nous ne perdrons pas de temps lÃ -dessus, car la rÃ©gion n'en est qu'une et les hÃ©ros ne la quittent nulle part. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VÃ©rifier les mains du hÃ©ros.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au cours du jeu, les hÃ©ros doivent constamment passer par des contrÃ´les (dÃ©crits ci-dessous), c'est-Ã -dire prendre des cubes de la main, les lancer (ajouter des modificateurs), agrÃ©ger les rÃ©sultats s'il y a plusieurs cubes (rÃ©sumer, prendre le maximum / minimum, la moyenne, etc.), les comparer avec le lancer un autre cube (celui qui est retirÃ© du sac de la zone) et, selon le rÃ©sultat, effectuez les actions suivantes. Mais tout d'abord, il faut comprendre si le hÃ©ros est en principe capable de passer le test, c'est-Ã -dire s'il a les cubes nÃ©cessaires en main. Pour cela, nous proposons une interface simple </font></font><code>HandFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hand: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hand</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les implÃ©mentations d'interface prennent la main du hÃ©ros (objet de classe </font></font><code>Hand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">en entrÃ©e </font><font style="vertical-align: inherit;">et retournent l'une </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou l'autre en </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction des rÃ©sultats de la vÃ©rification. Pour notre fragment du jeu, nous avons besoin d'une seule implÃ©mentation: si un cube bleu, vert, violet ou jaune est rencontrÃ©, nous devons dÃ©terminer si la main du hÃ©ros a un cube de la mÃªme couleur.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleDieHandFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types: Die.Type) : HandFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hand: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hand</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.dieCount).mapNotNull { hand.dieAt(it) }.any { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types } || (Die.Type.ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types &amp;&amp; hand.allyDieCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, le fonctionnalisme Ã  nouveau. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰lÃ©ments actifs / sÃ©lectionnÃ©s.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Maintenant que nous nous sommes assurÃ©s que la main du hÃ©ros est appropriÃ©e pour effectuer le test, il est nÃ©cessaire que le joueur choisisse dans la main les dÃ©s (ou cubes) avec lesquels il rÃ©ussira ce test. Tout d'abord, vous devez mettre en Ã©vidence (surligner) les positions appropriÃ©es (dans lesquelles il y a des cubes du type souhaitÃ©). DeuxiÃ¨mement, vous devez en quelque sorte marquer les cubes sÃ©lectionnÃ©s. Pour ces deux exigences, une classe convient </font></font><code>HandMask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui, en fait, contient un ensemble d'entiers (nombre de positions sÃ©lectionnÃ©es) et des mÃ©thodes pour les ajouter et les supprimer.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandMask</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> positions = mutableSetOf&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyPositions = mutableSetOf&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> positionCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = positions.size <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyPositionCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = allyPositions.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = positions.add(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removePosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = positions.remove(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = allyPositions.add(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = allyPositions.remove(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = position <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> positions <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = position <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> allyPositions <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!removePosition(position)) { addPosition(position) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!removeAllyPosition(position)) { addAllyPosition(position) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { positions.clear() allyPositions.clear() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai dÃ©jÃ  dit Ã  quel point je souffre de l'idÃ©e Â«ingÃ©nieuseÂ» de stocker des cubes blancs dans une main sÃ©parÃ©e? En raison de cette stupiditÃ©, vous devez faire face Ã  deux ensembles et dupliquer chacune des mÃ©thodes prÃ©sentÃ©es. Si quelqu'un a des idÃ©es sur la faÃ§on de simplifier la mise en Å“uvre de cette exigence (par exemple, utilisez un ensemble, mais pour les cubes blancs, les indices commencent par cent - ou autre chose tout aussi obscur) - partagez-les dans les commentaires. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en passant, une classe similaire doit Ãªtre implÃ©mentÃ©e pour sÃ©lectionner des cubes dans le tas ( </font></font><code>PileMask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), mais cette fonctionnalitÃ© sort du cadre de cet exemple. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le choix des cubes de la main.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais il ne suffit pas de Â«surlignerÂ» des positions acceptables, il est important de changer ce Â«surlignageÂ» dans le processus de choix des cubes. Autrement dit, si un joueur est tenu de ne prendre qu'un seul dÃ© de sa main, alors lors du choix de ce dÃ©, toutes les autres positions devraient devenir inaccessibles. De plus, Ã  chaque Ã©tape, il est nÃ©cessaire de contrÃ´ler la rÃ©alisation du but par le joueur, c'est-Ã -dire de savoir si les cubes sÃ©lectionnÃ©s suffisent pour passer l'un ou l'autre test. Une tÃ¢che aussi difficile nÃ©cessite une instance complexe d'une classe complexe.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandMaskRule</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hand: Hand) { <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCheckedDice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;Die&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.dieCount).filter(mask::checkPosition).map(hand::dieAt)) .plus((<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.allyDieCount).filter(mask::checkAllyPosition).map(hand::allyDieAt)) .filterNotNull() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logique assez compliquÃ©e, je vais vous comprendre et vous pardonner si ce cours vous est incomprÃ©hensible. Et essayez toujours d'expliquer. Les implÃ©mentations de cette classe stockent toujours une rÃ©fÃ©rence Ã  la main (objet </font></font><code>Hand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) avec laquelle elles seront traitÃ©es. Chacune des mÃ©thodes reÃ§oit un masque ( </font></font><code>HandMask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), qui reflÃ¨te l'Ã©tat actuel de la sÃ©lection (quelles positions sont sÃ©lectionnÃ©es par le joueur et lesquelles ne le sont pas). La mÃ©thode </font></font><code>checkMask()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indique si les cubes sÃ©lectionnÃ©s sont suffisants pour rÃ©ussir le test. La mÃ©thode </font></font><code>isPositionActive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indique s'il est nÃ©cessaire de mettre en Ã©vidence une position spÃ©cifique - s'il est possible d'ajouter un cube Ã  cette position au test (ou de supprimer un cube dÃ©jÃ  sÃ©lectionnÃ©). La mÃ©thode </font></font><code>isAllyPositionActive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est la mÃªme pour les dÃ©s blancs (oui, je sais, je suis un idiot). Eh bien et la mÃ©thode d'aide</font></font><code>getCheckedDice()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il renvoie simplement une liste de tous les cubes de la main qui correspondent au masque - cela est nÃ©cessaire pour les prendre tous Ã  la fois, les jeter sur la table et profiter du drÃ´le de coup, avec lequel ils se dispersent dans diffÃ©rentes directions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous aurons besoin de deux rÃ©alisations de cette classe abstraite (surprise, surprise!). Le premier contrÃ´le le processus de rÃ©ussite du test lors de l'acquisition d'un nouveau cube d'un type spÃ©cifique (pas blanc). Comme vous vous en souvenez, n'importe quel nombre de cubes bleus peut Ãªtre ajoutÃ© Ã  un tel contrÃ´le.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatDieAcquireHandMaskRule</span></span></span></span>(hand: Hand, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> requiredType: Die.Type) : HandMaskRule(hand) { <span class="hljs-comment"><span class="hljs-comment">/** * Define how many dice of specified type are currently checked */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkedDieCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.dieCount) .filter(mask::checkPosition) .mapNotNull(hand::dieAt) .count { it.type === requiredType } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (mask.allyPositionCount == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; checkedDieCount(mask) == <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = with(hand.dieAt(position)) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { mask.checkPosition(position) -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type === Die.Type.DIVINE -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type === requiredType &amp;&amp; checkedDieCount(mask) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La deuxiÃ¨me implÃ©mentation est plus compliquÃ©e. Elle contrÃ´le le jet de dÃ© Ã  la fin du tour. Dans ce cas, deux options sont possibles. Si le nombre de cubes dans la main dÃ©passe sa taille maximale autorisÃ©e (capacitÃ©), nous devons jeter tous les cubes supplÃ©mentaires plus n'importe quel nombre de cubes supplÃ©mentaires (si nous le voulons). Si la taille n'est pas dÃ©passÃ©e, vous ne pouvez rien rÃ©initialiser (ou vous pouvez rÃ©initialiser, si vous le souhaitez). En aucun cas, les dÃ©s gris ne peuvent Ãªtre jetÃ©s.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiscardExtraDiceHandMaskRule</span></span></span></span>(hand: Hand) : HandMaskRule(hand) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> minDiceToDiscard = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hand.dieCount &gt; hand.capacity) min(hand.dieCount - hand.woundCount, hand.dieCount - hand.capacity) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maxDiceToDiscard = hand.dieCount - hand.woundCount <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (mask.positionCount <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> minDiceToDiscard..maxDiceToDiscard) &amp;&amp; (mask.allyPositionCount <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>..hand.allyDieCount) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { mask.checkPosition(position) -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> hand.dieAt(position) == <span class="hljs-literal"><span class="hljs-literal">null</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> hand.dieAt(position)!!.type == Die.Type.WOUND -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> mask.positionCount &lt; maxDiceToDiscard -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = hand.allyDieAt(position) != <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nezhdanchik: </font></font><code>Hand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une propriÃ©tÃ© est soudainement apparue </font><font style="vertical-align: inherit;">dans la classe </font></font><code>woundCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui n'existait pas auparavant. Vous pouvez Ã©crire vous-mÃªme son implÃ©mentation, c'est simple. Pratiquez en mÃªme temps. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passer les chÃ¨ques.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enfin arrivÃ© Ã  eux. Lorsque les dÃ©s sont retirÃ©s de la main, il est temps de les lancer. Pour chaque cube il faut considÃ©rer: sa taille, ses modificateurs, le rÃ©sultat de son lancer. Bien qu'un seul cube puisse Ãªtre retirÃ© du sac Ã  la fois, plusieurs dÃ©s peuvent Ãªtre placÃ©s contre lui, agrÃ©geant les rÃ©sultats de leurs jets. En gÃ©nÃ©ral, abstenons-nous des dÃ©s et reprÃ©sentons les troupes sur le champ de bataille. D'une part, nous avons un ennemi - il n'est qu'un, mais il est fort et fÃ©roce. D'un autre cÃ´tÃ©, un adversaire de force Ã©gale Ã  lui, mais avec soutien. L'issue de la bataille sera dÃ©cidÃ©e en une courte escarmouche, le vainqueur ne pourra Ãªtre qu'un ...</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DÃ©solÃ©, emportÃ©. Pour simuler notre bataille gÃ©nÃ©rale, nous implÃ©mentons une classe spÃ©ciale.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DieBattleCheck</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> method: Method, opponent: DiePair? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Method</span></span></span><span class="hljs-class"> </span></span>{ SUM, AVG_UP, AVG_DOWN, MAX, MIN } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Wrap</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pair: DiePair, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roll: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">infix</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> DiePair.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(roll: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Wrap(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, roll) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> opponent: Wrap? = opponent?.with(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroics = ArrayList&lt;Wrap&gt;() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isRolled = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroPairCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = heroics.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOpponentPair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = opponent?.pair <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOpponentResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { isRolled -&gt; opponent?.roll ?: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Not rolled yet"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHeroPair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pair: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DiePair</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method == Method.SUM &amp;&amp; heroics.size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { pair.modifier = <span class="hljs-number"><span class="hljs-number">0</span></span> } heroics.add(pair with <span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHeroPair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">, modifier: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = addHeroPair(DiePair(die, modifier)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearHeroPairs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = heroics.clear() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeroPairAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = heroics[index].pair <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeroResultAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { isRolled -&gt; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { (index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until heroics.size) -&gt; heroics[index].roll <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Not rolled yet"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">roll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">roll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(wrap: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Wrap</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { wrap.roll = wrap.pair.die.roll() } isRolled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> opponent?.let { roll(it) } heroics.forEach { roll(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isRolled) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Not rolled yet"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> opponentResult = opponent?.let { it.roll + it.pair.modifier } ?: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> stats = heroics.map { it.roll + it.pair.modifier } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroResult = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (method) { DieBattleCheck.Method.SUM -&gt; stats.sum() DieBattleCheck.Method.AVG_UP -&gt; ceil(stats.average()).toInt() DieBattleCheck.Method.AVG_DOWN -&gt; floor(stats.average()).toInt() DieBattleCheck.Method.MAX -&gt; stats.max() ?: <span class="hljs-number"><span class="hljs-number">0</span></span> DieBattleCheck.Method.MIN -&gt; stats.min() ?: <span class="hljs-number"><span class="hljs-number">0</span></span> } result = heroResult - opponentResult } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tant donnÃ© que chaque cube peut avoir un modificateur, nous stockons les donnÃ©es dans des objets </font></font><code>DiePair</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Il semble que ce soit le cas. En fait, non, car en plus du cube et du modificateur, vous devez Ã©galement stocker le rÃ©sultat de son lancer (rappelez-vous, bien que le cube lui-mÃªme gÃ©nÃ¨re cette valeur, il ne la stocke pas parmi ses propriÃ©tÃ©s). Par consÃ©quent, enveloppez chaque paire dans un wrapper ( </font></font><code>Wrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Faites attention Ã  la mÃ©thode infixe </font></font><code>with</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, hehe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le constructeur de classe dÃ©finit la mÃ©thode d'agrÃ©gation (une instance de l'Ã©numÃ©ration interne </font></font><code>Method</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et l'adversaire (qui peut ne pas exister). La liste des cubes hÃ©ros est formÃ©e en utilisant les mÃ©thodes appropriÃ©es. Il fournit Ã©galement un tas de mÃ©thodes pour impliquer les paires dans le test et les rÃ©sultats de leurs lancers (le cas Ã©chÃ©ant). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mÃ©thode</font></font><code>roll()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appelle la mÃ©thode du mÃªme nom de chaque cube, enregistre les rÃ©sultats intermÃ©diaires et marque le fait de son exÃ©cution avec un drapeau </font></font><code>isRolled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Veuillez noter que le rÃ©sultat final du lancer n'est pas calculÃ© immÃ©diatement - il existe une mÃ©thode spÃ©ciale pour cela </font></font><code>calculateResult()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dont le rÃ©sultat est d'Ã©crire la valeur finale dans la propriÃ©tÃ© </font></font><code>result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pourquoi est-ce nÃ©cessaire? Pour un effet dramatique. La mÃ©thode </font></font><code>roll()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera exÃ©cutÃ©e plusieurs fois, chaque fois sur les faces des cubes diffÃ©rentes valeurs seront affichÃ©es (comme dans la vraie vie). Et seulement lorsque les cubes se calment sur la table, nous apprenons </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notre sort le</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rÃ©sultat final (la diffÃ©rence entre les valeurs des cubes du hÃ©ros et des cubes de l'adversaire). Pour soulager le stress, je dirai qu'un rÃ©sultat de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera considÃ©rÃ© comme une rÃ©ussite au test.</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'Ã©tat du moteur de jeu.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Des objets sophistiquÃ©s triÃ©s, maintenant les choses sont plus simples. Ce ne sera pas une grande dÃ©couverte de dire que nous devons contrÃ´ler la Â«progressionÂ» actuelle du moteur de jeu, le stade ou la phase dans laquelle il se trouve. Une Ã©numÃ©ration spÃ©ciale est utile pour cela.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GamePhase</span></span></span><span class="hljs-class"> </span></span>{ SCENARIO_START, HERO_TURN_START, HERO_TURN_END, LOCATION_BEFORE_EXPLORATION, LOCATION_ENCOUNTER_STAT, LOCATION_ENCOUNTER_DIVINE, LOCATION_AFTER_EXPLORATION, GAME_LOSS }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, il y a plus de phases, mais nous avons sÃ©lectionnÃ© uniquement celles qui sont utilisÃ©es dans notre exemple. Pour changer la phase du moteur de jeu, nous utiliserons des mÃ©thodes </font></font><code>changePhaseX()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, oÃ¹ </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est la valeur de la liste ci-dessus. Dans ces mÃ©thodes, toutes les variables internes du moteur seront rÃ©duites Ã  des valeurs adÃ©quates pour le dÃ©but de la phase correspondante, mais plus Ã  ce sujet plus tard. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des messages</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Garder l'Ã©tat du moteur de jeu ne suffit pas. Il est Ã©galement important pour l'utilisateur de l'informer d'une maniÃ¨re ou d'une autre - sinon, comment ce dernier saura-t-il ce qui se passe sur son Ã©cran? C'est pourquoi nous avons besoin d'une autre liste.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatusMessage</span></span></span><span class="hljs-class"> </span></span>{ EMPTY, CHOOSE_DICE_PERFORM_CHECK, END_OF_TURN_DISCARD_EXTRA, END_OF_TURN_DISCARD_OPTIONAL, CHOOSE_ACTION_BEFORE_EXPLORATION, CHOOSE_ACTION_AFTER_EXPLORATION, ENCOUNTER_PHYSICAL, ENCOUNTER_SOMATIC, ENCOUNTER_MENTAL, ENCOUNTER_VERBAL, ENCOUNTER_DIVINE, DIE_ACQUIRE_SUCCESS, DIE_ACQUIRE_FAILURE, GAME_LOSS_OUT_OF_TIME }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous pouvez le voir, tous les Ã©tats possibles de notre exemple sont dÃ©crits par les valeurs de cette Ã©numÃ©ration. Pour chacun d'eux, une ligne de texte est fournie, qui sera affichÃ©e Ã  l'Ã©cran (sauf </font></font><code>EMPTY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- c'est une signification particuliÃ¨re), mais nous en apprendrons un peu plus tard. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actions</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour la communication entre l'utilisateur et le moteur de jeu, de simples messages ne suffisent pas. Il est Ã©galement important d'informer le premier des actions qu'il peut entreprendre en ce moment (rechercher, passer les blocs, terminer le mouvement - c'est tout bon). Pour ce faire, nous dÃ©velopperons une classe spÃ©ciale.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Action</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isEnabled: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ NONE, <span class="hljs-comment"><span class="hljs-comment">//Blank type CONFIRM, //Confirm some action CANCEL, //Cancel action HAND_POSITION, //Some position in hand HAND_ALLY_POSITION, //Some ally position in hand EXPLORE_LOCATION, //Explore current location FINISH_TURN, //Finish current turn ACQUIRE, //Acquire (DIVINE) die FORFEIT, //Remove die from game HIDE, //Put die into bag DISCARD, //Put die to discard pile } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une Ã©numÃ©ration interne </font></font><code>Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dÃ©crit le type d'action effectuÃ©e. Le champ est </font></font><code>isEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nÃ©cessaire pour afficher les actions dans un Ã©tat inactif. Autrement dit, pour signaler que cette action est gÃ©nÃ©ralement disponible, mais pour le moment, pour une raison quelconque, ne peut pas Ãªtre effectuÃ©e (un tel affichage est beaucoup plus informatif que lorsque l'action n'est pas affichÃ©e du tout). La propriÃ©tÃ© </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(nÃ©cessaire pour certains types d'actions) stocke une valeur spÃ©ciale qui communique certains dÃ©tails supplÃ©mentaires (par exemple, l'index de la position sÃ©lectionnÃ©e par l'utilisateur ou le numÃ©ro de l'Ã©lÃ©ment sÃ©lectionnÃ© dans la liste). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klas</font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est la principale "interface" entre le moteur de jeu et les systÃ¨mes d'entrÃ©e-sortie (dont ci-dessous). </font><font style="vertical-align: inherit;">Puisqu'il y a souvent plusieurs actions (sinon, pourquoi alors choisir?), Elles seront combinÃ©es en groupes (listes). </font><font style="vertical-align: inherit;">Au lieu d'utiliser des collections standard, nous Ã©crirons notre propre collection Ã©tendue.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionList</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Iterable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Action</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actions = mutableListOf&lt;Action&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = actions.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { actions.add(action) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">, enabled: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { add(Action(type, enabled)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { actions.forEach { add(it) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { actions.removeIf { it.type == type } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = actions[index] <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = actions.find { it.type == type } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iterator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Iterator&lt;Action&gt; = ActionListIterator() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionListIterator</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Iterator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Action</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> position = -<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = (actions.size &gt; position + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = actions[++position] } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> EMPTY <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = ActionList() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La classe contient de nombreuses mÃ©thodes diffÃ©rentes pour ajouter et supprimer des actions de la liste (qui peuvent Ãªtre chaÃ®nÃ©es ensemble), ainsi que pour obtenir Ã  la fois par index et par type (notez la Â«surchargeÂ» </font></font><code>get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- l'opÃ©rateur entre crochets est applicable Ã  notre liste). </font><font style="vertical-align: inherit;">L'implÃ©mentation de l'interface </font></font><code>Iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous permet de faire </font><font style="vertical-align: inherit;">diverses manipulations de flux (fonctionnalitÃ©, aha) </font><font style="vertical-align: inherit;">avec nos </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toutes sortes de</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> classe de </font><s><font style="vertical-align: inherit;">merde folle</font></s><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Une valeur VIDE est Ã©galement fournie pour crÃ©er rapidement une liste vide. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰crans.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, une autre liste qui dÃ©crit les diffÃ©rents types de contenus actuellement affichÃ©s ... Vous me regardez et clignez des yeux, je sais. Lorsque jâ€™ai commencÃ© Ã  rÃ©flÃ©chir Ã  la faÃ§on de dÃ©crire plus clairement ce cours, je me suis cognÃ© la tÃªte sur la table, car je ne pouvais vraiment rien comprendre. Comprenez-vous, j'espÃ¨re.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameScreen</span></span></span><span class="hljs-class"> </span></span>{ HERO_TURN_START, LOCATION_INTERIOR, GAME_LOSS }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SÃ©lectionnez uniquement ceux utilisÃ©s dans l'exemple. Une mÃ©thode de rendu distincte sera fournie pour chacun d'eux ... je l'explique encore une fois inexplicablement. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Affichage" et "entrÃ©e".</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et maintenant, nous arrivons enfin au point le plus important - l'interaction du moteur de jeu avec l'utilisateur (joueur). Si une si longue introduction ne vous a pas encore ennuyÃ©, vous vous souvenez probablement que nous avons convenu de sÃ©parer fonctionnellement ces deux parties l'une de l'autre. Par consÃ©quent, au lieu d'une implÃ©mentation spÃ©cifique du systÃ¨me d'E / S, nous ne fournirons qu'une interface. Plus prÃ©cisÃ©ment, deux. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PremiÃ¨re interface</font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, conÃ§u pour afficher des images Ã  l'Ã©cran. Je vous rappelle que nous faisons abstraction des tailles d'Ã©cran, de bibliothÃ¨ques graphiques spÃ©cifiques, etc. Nous envoyons simplement la commande: "dessine-moi ceci" - et ceux d'entre vous qui ont compris notre conversation trouble sur les Ã©crans ont dÃ©jÃ  devinÃ© que chacun de ces Ã©crans avait sa propre mÃ©thode dans l'interface.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameRenderer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHeroTurnStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawLocationInteriorScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( location: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Location</span></span></span></span><span class="hljs-function"><span class="hljs-params">, heroesAtLocation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, timer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, currentHero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">, battleCheck: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieBattleCheck</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, encounteredDie: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DiePair</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, pickedDice: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, activePositions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, statusMessage: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">, actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawGameLoss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je pense qu'il n'y a pas besoin d'explications supplÃ©mentaires ici - le but de tous les objets transfÃ©rÃ©s est discutÃ© en dÃ©tail ci-dessus. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour la saisie par l'utilisateur, nous implÃ©mentons une interface diffÃ©rente - </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(oui, les scripts de vÃ©rification orthographique mettront toujours l'accent sur ce mot, bien qu'il semble ...). Ses mÃ©thodes demanderont au joueur les commandes requises pour diverses situations: sÃ©lectionnez une action dans la liste des propositions, sÃ©lectionnez un Ã©lÃ©ment dans la liste, sÃ©lectionnez des cubes dans la main, appuyez au moins sur quelque chose, etc. Il convient de noter immÃ©diatement que l'entrÃ©e se produit de maniÃ¨re synchrone (le jeu est Ã©tape par Ã©tape), c'est-Ã -dire que l'exÃ©cution de la boucle de jeu est suspendue jusqu'Ã  ce que l'utilisateur rÃ©ponde Ã  la demande.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameInteractor</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickDiceFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(activePositions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã€ propos de la derniÃ¨re mÃ©thode un peu plus. </font><font style="vertical-align: inherit;">Comme son nom l'indique, from invite l'utilisateur Ã  sÃ©lectionner des cubes dans la main, fournissant un objet </font></font><code>HandMask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- le nombre de positions actives. </font><font style="vertical-align: inherit;">L'exÃ©cution de la mÃ©thode se poursuivra jusqu'Ã  ce que certaines d'entre elles soient sÃ©lectionnÃ©es - dans ce cas, la mÃ©thode renverra une action de type </font></font><code>HAND_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ou </font></font><code>HAND_ALLY_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mda) avec le numÃ©ro de la position sÃ©lectionnÃ©e dans le champ </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">De plus, il est possible de sÃ©lectionner une autre action (par exemple, </font></font><code>CONFIRM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>CANCEL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) dans l'objet </font></font><code>ActionList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Les implÃ©mentations des mÃ©thodes de saisie doivent distinguer les situations lorsque le champ est </font></font><code>isEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dÃ©fini sur </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ignorer la saisie par l'utilisateur de telles actions. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classe de moteur de jeu. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons examinÃ© tout le nÃ©cessaire au travail, le moment est venu et le moteur Ã  mettre en Å“uvre. </font><font style="vertical-align: inherit;">CrÃ©er une classe</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec le contenu suivant: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DÃ©solÃ©, cela ne doit pas Ãªtre montrÃ© aux personnes impressionnables.</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer: GameRenderer, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor: GameInteractor, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scenario: Scenario, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locations: List&lt;Location&gt;, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroes: List&lt;Hero&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timer = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentHeroIndex = -<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentHero: Hero <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentLocation: Location <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deterrentPile = Pile() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> encounteredDie: DiePair? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> battleCheck: DieBattleCheck? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> activeHandPositions = HandMask() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pickedHandPositions = HandMask() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phase: GamePhase = GamePhase.SCENARIO_START <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> screen = GameScreen.SCENARIO_INTRO <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statusMessage = StatusMessage.EMPTY <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> actions: ActionList = ActionList.EMPTY <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heroes.isEmpty()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Heroes list is empty!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locations.isEmpty()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Location list is empty!"</span></span>) heroes.forEach { it.isAlive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } timer = scenario.initialTimer <span class="hljs-comment"><span class="hljs-comment">//Draw initial hand for each hero heroes.forEach(::drawInitialHand) //First hero turn currentHeroIndex = -1 changePhaseHeroTurnStart() processCycle() } private fun drawInitialHand(hero: Hero) { val hand = hero.hand val favoredDie = hero.bag.drawOfType(hero.favoredDieType) hand.addDie(favoredDie!!) refillHeroHand(hero, false) } private fun refillHeroHand(hero: Hero, redrawScreen: Boolean = true) { val hand = hero.hand while (hand.dieCount &lt; hand.capacity &amp;&amp; hero.bag.size &gt; 0) { val die = hero.bag.draw() hand.addDie(die) if (redrawScreen) { Audio.playSound(Sound.DIE_DRAW) drawScreen() Thread.sleep(500) } } } private fun changePhaseHeroTurnEnd() { battleCheck = null encounteredDie = null phase = GamePhase.HERO_TURN_END //Discard extra dice (or optional dice) val hand = currentHero.hand pickedHandPositions.clear() activeHandPositions.clear() val allowCancel = if (hand.dieCount &gt; hand.capacity) { statusMessage = StatusMessage.END_OF_TURN_DISCARD_EXTRA false } else { statusMessage = StatusMessage.END_OF_TURN_DISCARD_OPTIONAL true } val result = pickDiceFromHand(DiscardExtraDiceHandMaskRule(hand), allowCancel) statusMessage = StatusMessage.EMPTY actions = ActionList.EMPTY if (result) { val discardDice = collectPickedDice(hand) val discardAllyDice = collectPickedAllyDice(hand) pickedHandPositions.clear() (discardDice + discardAllyDice).forEach { die -&gt; Audio.playSound(Sound.DIE_DISCARD) currentHero.discardDieFromHand(die) drawScreen() Thread.sleep(500) } } pickedHandPositions.clear() //Replenish hand refillHeroHand(currentHero) changePhaseHeroTurnStart() } private fun changePhaseHeroTurnStart() { phase = GamePhase.HERO_TURN_START screen = GameScreen.HERO_TURN_START //Tick timer timer-- if (timer &lt; 0) { changePhaseGameLost(StatusMessage.GAME_LOSS_OUT_OF_TIME) return } //Pick next hero do { currentHeroIndex = ++currentHeroIndex % heroes.size currentHero = heroes[currentHeroIndex] } while (!currentHero.isAlive) currentLocation = locations[0] //Setup Audio.playMusic(Music.SCENARIO_MUSIC_1) Audio.playSound(Sound.TURN_START) } private fun changePhaseLocationBeforeExploration() { phase = GamePhase.LOCATION_BEFORE_EXPLORATION screen = GameScreen.LOCATION_INTERIOR encounteredDie = null battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = StatusMessage.CHOOSE_ACTION_BEFORE_EXPLORATION actions = ActionList() actions.add(Action.Type.EXPLORE_LOCATION, checkLocationCanBeExplored(currentLocation)) actions.add(Action.Type.FINISH_TURN) } private fun changePhaseLocationEncounterStatDie() { Audio.playSound(Sound.ENCOUNTER_STAT) phase = GamePhase.LOCATION_ENCOUNTER_STAT screen = GameScreen.LOCATION_INTERIOR battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = when (encounteredDie!!.die.type) { Die.Type.PHYSICAL -&gt; StatusMessage.ENCOUNTER_PHYSICAL Die.Type.SOMATIC -&gt; StatusMessage.ENCOUNTER_SOMATIC Die.Type.MENTAL -&gt; StatusMessage.ENCOUNTER_MENTAL Die.Type.VERBAL -&gt; StatusMessage.ENCOUNTER_VERBAL else -&gt; throw AssertionError("Should not happen") } val canAttemptCheck = checkHeroCanAttemptStatCheck(currentHero, encounteredDie!!.die.type) actions = ActionList() actions.add(Action.Type.HIDE, canAttemptCheck) actions.add(Action.Type.DISCARD, canAttemptCheck) actions.add(Action.Type.FORFEIT) } private fun changePhaseLocationEncounterDivineDie() { Audio.playSound(Sound.ENCOUNTER_DIVINE) phase = GamePhase.LOCATION_ENCOUNTER_DIVINE screen = GameScreen.LOCATION_INTERIOR battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = StatusMessage.ENCOUNTER_DIVINE actions = ActionList() actions.add(Action.Type.ACQUIRE, checkHeroCanAcquireDie(currentHero, Die.Type.DIVINE)) actions.add(Action.Type.FORFEIT) } private fun changePhaseLocationAfterExploration() { phase = GamePhase.LOCATION_AFTER_EXPLORATION screen = GameScreen.LOCATION_INTERIOR encounteredDie = null battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = StatusMessage.CHOOSE_ACTION_AFTER_EXPLORATION actions = ActionList() actions.add(Action.Type.FINISH_TURN) } private fun changePhaseGameLost(message: StatusMessage) { Audio.stopMusic() Audio.playSound(Sound.GAME_LOSS) phase = GamePhase.GAME_LOSS screen = GameScreen.GAME_LOSS statusMessage = message } private fun pickDiceFromHand(rule: HandMaskRule, allowCancel: Boolean = true, onEachLoop: (() -&gt; Unit)? = null): Boolean { //Preparations pickedHandPositions.clear() actions = ActionList().add(Action.Type.CONFIRM, false) if (allowCancel) { actions.add(Action.Type.CANCEL) } val hand = rule.hand while (true) { //Recurring action onEachLoop?.invoke() //Define success condition val canProceed = rule.checkMask(pickedHandPositions) actions[Action.Type.CONFIRM]?.isEnabled = canProceed //Prepare active hand commands activeHandPositions.clear() (0 until hand.dieCount) .filter { rule.isPositionActive(pickedHandPositions, it) } .forEach { activeHandPositions.addPosition(it) } (0 until hand.allyDieCount) .filter { rule.isAllyPositionActive(pickedHandPositions, it) } .forEach { activeHandPositions.addAllyPosition(it) } //Draw current phase drawScreen() //Process interaction result val result = interactor.pickDiceFromHand(activeHandPositions, actions) when (result.type) { Action.Type.CONFIRM -&gt; if (canProceed) { activeHandPositions.clear() return true } Action.Type.CANCEL -&gt; if (allowCancel) { activeHandPositions.clear() pickedHandPositions.clear() return false } Action.Type.HAND_POSITION -&gt; { Audio.playSound(Sound.DIE_PICK) pickedHandPositions.switchPosition(result.data) } Action.Type.HAND_ALLY_POSITION -&gt; { Audio.playSound(Sound.DIE_PICK) pickedHandPositions.switchAllyPosition(result.data) } else -&gt; throw AssertionError("Should not happen") } } } private fun collectPickedDice(hand: Hand) = (0 until hand.dieCount) .filter(pickedHandPositions::checkPosition) .mapNotNull(hand::dieAt) private fun collectPickedAllyDice(hand: Hand) = (0 until hand.allyDieCount) .filter(pickedHandPositions::checkAllyPosition) .mapNotNull(hand::allyDieAt) private fun performStatDieAcquireCheck(shouldDiscard: Boolean): Boolean { //Prepare check battleCheck = DieBattleCheck(DieBattleCheck.Method.SUM, encounteredDie) pickedHandPositions.clear() statusMessage = StatusMessage.CHOOSE_DICE_PERFORM_CHECK val hand = currentHero.hand //Try to pick dice from performer's hand if (!pickDiceFromHand(StatDieAcquireHandMaskRule(currentHero.hand, encounteredDie!!.die.type), true) { battleCheck!!.clearHeroPairs() (collectPickedDice(hand) + collectPickedAllyDice(hand)) .map { DiePair(it, if (shouldDiscard) 1 else 0) } .forEach(battleCheck!!::addHeroPair) }) { battleCheck = null pickedHandPositions.clear() return false } //Remove dice from hand collectPickedDice(hand).forEach { hand.removeDie(it) } collectPickedAllyDice(hand).forEach { hand.removeDie(it) } pickedHandPositions.clear() //Perform check Audio.playSound(Sound.BATTLE_CHECK_ROLL) for (i in 0..7) { battleCheck!!.roll() drawScreen() Thread.sleep(100) } battleCheck!!.calculateResult() val result = battleCheck?.result ?: -1 val success = result &gt;= 0 //Process dice which participated in the check (0 until battleCheck!!.heroPairCount) .map(battleCheck!!::getHeroPairAt) .map(DiePair::die) .forEach { d -&gt; if (d.type === Die.Type.DIVINE) { currentHero.hand.removeDie(d) deterrentPile.put(d) } else { if (shouldDiscard) { currentHero.discardDieFromHand(d) } else { currentHero.hideDieFromHand(d) } } } //Show message to user Audio.playSound(if (success) Sound.BATTLE_CHECK_SUCCESS else Sound.BATTLE_CHECK_FAILURE) statusMessage = if (success) StatusMessage.DIE_ACQUIRE_SUCCESS else StatusMessage.DIE_ACQUIRE_FAILURE actions = ActionList.EMPTY drawScreen() interactor.anyInput() //Clean up battleCheck = null //Resolve consequences of the check if (success) { Audio.playSound(Sound.DIE_DRAW) currentHero.hand.addDie(encounteredDie!!.die) } return true } private fun processCycle() { while (true) { drawScreen() when (phase) { GamePhase.HERO_TURN_START -&gt; { interactor.anyInput() changePhaseLocationBeforeExploration() } GamePhase.GAME_LOSS -&gt; { interactor.anyInput() return } GamePhase.LOCATION_BEFORE_EXPLORATION -&gt; when (interactor.pickAction(actions).type) { Action.Type.EXPLORE_LOCATION -&gt; { val die = currentLocation.bag.draw() encounteredDie = DiePair(die, 0) when (die.type) { Die.Type.PHYSICAL, Die.Type.SOMATIC, Die.Type.MENTAL, Die.Type.VERBAL -&gt; changePhaseLocationEncounterStatDie() Die.Type.DIVINE -&gt; changePhaseLocationEncounterDivineDie() else -&gt; TODO("Others") } } Action.Type.FINISH_TURN -&gt; changePhaseHeroTurnEnd() else -&gt; throw AssertionError("Should not happen") } GamePhase.LOCATION_ENCOUNTER_STAT -&gt; { val type = interactor.pickAction(actions).type when (type) { Action.Type.DISCARD, Action.Type.HIDE -&gt; { performStatDieAcquireCheck(type === Action.Type.DISCARD) changePhaseLocationAfterExploration() } Action.Type.FORFEIT -&gt; { Audio.playSound(Sound.DIE_REMOVE) changePhaseLocationAfterExploration() } else -&gt; throw AssertionError("Should not happen") } } GamePhase.LOCATION_ENCOUNTER_DIVINE -&gt; when (interactor.pickAction(actions).type) { Action.Type.ACQUIRE -&gt; { Audio.playSound(Sound.DIE_DRAW) currentHero.hand.addDie(encounteredDie!!.die) changePhaseLocationAfterExploration() } Action.Type.FORFEIT -&gt; { Audio.playSound(Sound.DIE_REMOVE) changePhaseLocationAfterExploration() } else -&gt; throw AssertionError("Should not happen") } GamePhase.LOCATION_AFTER_EXPLORATION -&gt; when (interactor.pickAction(actions).type) { Action.Type.FINISH_TURN -&gt; changePhaseHeroTurnEnd() else -&gt; throw AssertionError("Should not happen") } else -&gt; throw AssertionError("Should not happen") } } } private fun drawScreen() { when (screen) { GameScreen.HERO_TURN_START -&gt; renderer.drawHeroTurnStart(currentHero) GameScreen.LOCATION_INTERIOR -&gt; renderer.drawLocationInteriorScreen(currentLocation, heroes, timer, currentHero, battleCheck, encounteredDie, null, pickedHandPositions, activeHandPositions, statusMessage, actions) GameScreen.GAME_LOSS -&gt; renderer.drawGameLoss(statusMessage) } } private fun checkLocationCanBeExplored(location: Location) = location.isOpen &amp;&amp; location.bag.size &gt; 0 private fun checkHeroCanAttemptStatCheck(hero: Hero, type: Die.Type): Boolean { return hero.isAlive &amp;&amp; SingleDieHandFilter(type).test(hero.hand) } private fun checkHeroCanAcquireDie(hero: Hero, type: Die.Type): Boolean { if (!hero.isAlive) { return false } return when (type) { Die.Type.ALLY -&gt; hero.hand.allyDieCount &lt; MAX_HAND_ALLY_SIZE else -&gt; hero.hand.dieCount &lt; MAX_HAND_SIZE } } }</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MÃ©thode </font></font><code>start()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- le point d'entrÃ©e au jeu. </font><font style="vertical-align: inherit;">Ici, les variables sont initialisÃ©es, les hÃ©ros sont pesÃ©s, les mains remplies de cubes et les journalistes brillent avec des camÃ©ras de tous les cÃ´tÃ©s. </font><font style="vertical-align: inherit;">Le cycle principal sera lancÃ© toutes les minutes, aprÃ¨s quoi il ne pourra plus Ãªtre arrÃªtÃ©. </font><font style="vertical-align: inherit;">La mÃ©thode </font></font><code>drawInitialHand()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parle d'elle-mÃªme (nous n'avons pas semblÃ© considÃ©rer le code de la mÃ©thode de </font></font><code>drawOfType()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe </font></font><code>Bag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais aprÃ¨s avoir fait un si long chemin ensemble, vous pouvez Ã©crire ce code vous-mÃªme). </font><font style="vertical-align: inherit;">La mÃ©thode </font></font><code>refillHeroHand()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a deux options (en fonction de la valeur de l'argument </font></font><code>redrawScreen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">): rapide et silencieuse (lorsque vous devez remplir les mains de tous les hÃ©ros au dÃ©but du jeu), et bruyante avec un tas de pathos, quand Ã  la fin du mouvement, vous devez retirer les cubes du sac, ce qui porte la main Ã  la bonne taille. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un tas de mÃ©thodes avec des noms commenÃ§ant par</font></font><code>changePhase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, - comme nous l'avons dÃ©jÃ  dit, elles servent Ã  changer la phase de jeu en cours et sont engagÃ©es dans l'affectation des valeurs correspondantes des variables de jeu. Ici, une liste est formÃ©e </font></font><code>actions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oÃ¹ les actions caractÃ©ristiques de cette phase sont ajoutÃ©es. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mÃ©thode d'utilitÃ© </font></font><code>pickDiceFromHand()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sous une forme gÃ©nÃ©ralisÃ©e est engagÃ©e dans la sÃ©lection des cubes de la main. Un objet d'une classe familiÃ¨re </font></font><code>HandMaskRule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui dÃ©finit les rÃ¨gles de sÃ©lection </font><font style="vertical-align: inherit;">est passÃ© ici </font><font style="vertical-align: inherit;">. Il indique Ã©galement la possibilitÃ© de refuser la sÃ©lection ( </font></font><code>allowCancel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), ainsi qu'une fonction </font></font><code>onEachLoop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dont le code doit Ãªtre appelÃ© Ã  chaque fois que la liste des cubes sÃ©lectionnÃ©s est modifiÃ©e (gÃ©nÃ©ralement un redessin d'Ã©cran). Les cubes sÃ©lectionnÃ©s par cette mÃ©thode peuvent Ãªtre assemblÃ©s Ã  la main en utilisant les mÃ©thodes </font></font><code>collectPickedDice()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>collectPickedAllyDice()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre mÃ©thode utilitaire</font></font><code>performStatDieAcquireCheck()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implÃ©mente pleinement le hÃ©ros passant le test pour l'acquisition d'un nouveau cube. Le rÃ´le central dans cette mÃ©thode est jouÃ© par l'objet </font></font><code>DieBattleCheck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le processus commence par la sÃ©lection des cubes par la mÃ©thode </font></font><code>pickDiceFromHand()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Ã  chaque Ã©tape la liste des Â«participantsÂ» est mise Ã  jour </font></font><code>DieBattleCheck</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Les cubes sÃ©lectionnÃ©s sont retirÃ©s de la main, aprÃ¨s quoi un "jet" se produit - chaque dÃ© met Ã  jour sa valeur (huit fois de suite), aprÃ¨s quoi le rÃ©sultat est calculÃ© et affichÃ©. Lors d'un lancer rÃ©ussi, un nouveau dÃ© tombe entre les mains du hÃ©ros. Les cubes participant au test sont soit tenus (s'ils sont bleus), soit jetÃ©s (si </font></font><code>shouldDiscard = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), soit cachÃ©s dans le sac (si </font></font><code>shouldDiscard = false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MÃ©thode principale</font></font><code>processCycle()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient une boucle infinie (je demande sans s'Ã©vanouir) dans laquelle l'Ã©cran est d'abord dessinÃ©, puis l'utilisateur est invitÃ© Ã  entrer, puis cette entrÃ©e est traitÃ©e - avec toutes les consÃ©quences qui en dÃ©coulent. </font><font style="vertical-align: inherit;">La mÃ©thode </font></font><code>drawScreen()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appelle la mÃ©thode d'interface souhaitÃ©e </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(en fonction de la valeur actuelle </font></font><code>screen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), en lui passant les objets requis Ã  l'entrÃ©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En outre, la classe contient plusieurs mÃ©thodes d'assistance: </font></font><code>checkLocationCanBeExplored()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>checkHeroCanAttemptStatCheck()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>checkHeroCanAcquireDie()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Leurs noms parlent d'eux-mÃªmes, nous ne nous attarderons donc pas sur eux en dÃ©tail. </font><font style="vertical-align: inherit;">Et il existe Ã©galement des appels de mÃ©thode de classe </font></font><code>Audio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, soulignÃ©s par une ligne ondulÃ©e rouge. </font><font style="vertical-align: inherit;">Commentez-les pour le moment - nous examinerons leur objectif plus tard.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qui ne comprend rien du tout, voici un schÃ©ma (pour plus de clartÃ©, pour ainsi dire):</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/j3/hl/so/j3hlsov7ev0lducteyrvthdwkge.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est tout, le jeu est prÃªt (hehe). </font><font style="vertical-align: inherit;">Il y avait de vraies petites choses, Ã  leur sujet ci-dessous.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tape neuf. </font><font style="vertical-align: inherit;">Afficher l'image</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous arrivons donc au sujet principal de la conversation d'aujourd'hui - le composant graphique de l'application. </font><font style="vertical-align: inherit;">Comme vous vous en souvenez, notre tÃ¢che est de mettre en Å“uvre l'interface </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ses trois mÃ©thodes, et comme il n'y a toujours pas d'artiste talentueux dans notre Ã©quipe, nous le ferons nous-mÃªmes en utilisant des pseudographies. </font><font style="vertical-align: inherit;">Mais pour commencer, ce serait bien de comprendre ce que nous attendons gÃ©nÃ©ralement Ã  la sortie. </font><font style="vertical-align: inherit;">Et nous voulons voir trois Ã©crans d'environ le contenu suivant:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰cran 1. ID de tour du joueur</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ey/kv/ro/eykvrovfqckvawmiylrmb03gx70.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰cran 2. Informations sur la zone et le hÃ©ros actuel</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/5v/xd/ad/5vxdadvii-aunblqcdkxs4h8jrs.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰cran 3. Message de perte de script</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ry/l1/6y/ryl16yvaas4njnnu5mxginmvsm0.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je pense que la majoritÃ© a dÃ©jÃ  rÃ©alisÃ© que les images prÃ©sentÃ©es sont diffÃ©rentes de tout ce que nous avons l'habitude de voir dans la console des applications Java, et que les fonctionnalitÃ©s habituelles </font></font><code>prinltn()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne seront Ã©videmment pas suffisantes. J'aimerais Ã©galement pouvoir sauter Ã  des endroits arbitraires sur l'Ã©cran et dessiner des symboles de diffÃ©rentes couleurs. </font><s><font style="vertical-align: inherit;">Les </font></s><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">codes ANSI </font></a><s><font style="vertical-align: inherit;">Chip et Dale se</font></s></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prÃ©cipitent Ã  notre secours</font></font><s><font style="vertical-align: inherit;"></font></s> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En envoyant des sÃ©quences de caractÃ¨res bizarres en sortie, vous pouvez obtenir des effets non moins bizarres: changez la couleur du texte / arriÃ¨re-plan, la faÃ§on dont les caractÃ¨res sont dessinÃ©s, la position du curseur sur l'Ã©cran, et bien plus encore. Bien sÃ»r, nous ne les prÃ©senterons pas sous leur forme pure - nous cacherons l'implÃ©mentation derriÃ¨re les mÃ©thodes de la classe. Et nous n'Ã©crirons pas le cours lui-mÃªme Ã  partir de zÃ©ro - heureusement, les gens intelligents l'ont fait pour nous. Il suffit de tÃ©lÃ©charger et de connecter une bibliothÃ¨que lÃ©gÃ¨re au projet, par exemple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jansi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.fusesource.jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.17.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et vous pouvez commencer Ã  crÃ©er. </font><font style="vertical-align: inherit;">Cette bibliothÃ¨que nous fournit un objet de classe </font></font><code>Ansi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(obtenu Ã  la suite d'un appel statique </font></font><code>Ansi.ansi()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) avec un tas de mÃ©thodes pratiques qui peuvent Ãªtre chaÃ®nÃ©es. </font><font style="vertical-align: inherit;">Il fonctionne sur le principe de </font></font><code>StringBuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'a - nous formons d'abord l'objet, puis l'envoyons Ã  l'impression. </font><font style="vertical-align: inherit;">Parmi les mÃ©thodes utiles, nous trouverons utiles:</font></font><br><br><ul><li> <code>a()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour afficher des caractÃ¨res; </font></font></li><li> <code>cursor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour dÃ©placer le curseur sur l'Ã©cran; </font></font></li><li> <code>eraseLine()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - comme si elle parlait d'elle-mÃªme; </font></font></li><li> <code>eraseScreen()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - de mÃªme; </font></font></li><li> <code>fg(), bg(), fgBright(), bgBright()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - mÃ©thodes trÃ¨s gÃªnantes pour travailler avec les couleurs du texte et de l'arriÃ¨re-plan - nous rendrons les nÃ´tres plus agrÃ©ables; </font></font></li><li> <code>reset()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour rÃ©initialiser les paramÃ¨tres de couleur dÃ©finis, le scintillement, etc. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CrÃ©ons une classe </font></font><code>ConsoleRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec des mÃ©thodes utilitaires qui peuvent nous Ãªtre utiles dans notre travail. </font><font style="vertical-align: inherit;">La premiÃ¨re version ressemblera Ã  ceci:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleRenderer</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ansi: Ansi <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { AnsiConsole.systemInstall() clearScreen() resetAnsi() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resetAnsi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ansi = Ansi.ansi() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { print(Ansi.ansi().eraseScreen(Ansi.Erase.ALL).cursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { print(ansi.toString()) resetAnsi() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mÃ©thode </font></font><code>resetAnsi()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crÃ©e un nouvel objet (vide) </font></font><code>Ansi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui sera rempli avec les commandes nÃ©cessaires (dÃ©placement, sortie, etc.). </font><font style="vertical-align: inherit;">Une fois le remplissage terminÃ©, l'objet gÃ©nÃ©rÃ© est envoyÃ© pour impression par la mÃ©thode </font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la variable est initialisÃ©e avec un nouvel objet. </font><font style="vertical-align: inherit;">Rien de compliquÃ© pour l'instant, non? </font><font style="vertical-align: inherit;">Et si c'est le cas, alors nous commencerons Ã  remplir cette classe avec d'autres mÃ©thodes utiles. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CommenÃ§ons par les tailles. </font><font style="vertical-align: inherit;">La console standard de la plupart des terminaux mesure 80 x 24. </font><font style="vertical-align: inherit;">On note ce fait avec deux constantes </font></font><code>CONSOLE_WIDTH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>CONSOLE_HEIGHT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous ne serons pas attachÃ©s Ã  des valeurs spÃ©cifiques et essaierons de rendre le design aussi caoutchouteux que possible (comme sur le web). </font><font style="vertical-align: inherit;">La numÃ©rotation des coordonnÃ©es commence par une, la premiÃ¨re coordonnÃ©e est une ligne, la seconde est une colonne. </font><font style="vertical-align: inherit;">Sachant tout cela, nous Ã©crivons une mÃ©thode utilitaire</font></font><code>drawHorizontalLine()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour remplir la chaÃ®ne spÃ©cifiÃ©e avec le caractÃ¨re spÃ©cifiÃ©. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHorizontalLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, filler: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Char</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span>..CONSOLE_WIDTH).forEach { ansi.a(filler) } <span class="hljs-comment"><span class="hljs-comment">//for (i in 1..CONSOLE_WIDTH) { ansi.a(filler) } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encore une fois, je vous rappelle que l'invocation de commandes </font></font><code>a()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>cursor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'entraÃ®ne aucun effet instantanÃ©, mais ajoute uniquement la </font></font><code>Ansi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sÃ©quence de commandes correspondante </font><font style="vertical-align: inherit;">Ã  l'objet </font><font style="vertical-align: inherit;">. Ce n'est que lorsque ces sÃ©quences seront envoyÃ©es Ã  l'impression que nous les verrons Ã  l'Ã©cran. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il </font><font style="vertical-align: inherit;">n'y a pas de diffÃ©rence fondamentale </font><font style="vertical-align: inherit;">entre l'utilisation du cycle classique </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et l'approche fonctionnelle avec </font></font><code>ClosedRange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>forEach{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- chaque dÃ©veloppeur dÃ©cide par lui-mÃªme de ce qui lui convient le mieux. Cependant, je continuerai Ã  vous tromper avec le fonctionnalisme, simplement parce que </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je suis un singe qui aime tout ce qui est nouveau et que les</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supports </font><s><font style="vertical-align: inherit;">brillants</font></s><font style="vertical-align: inherit;"> ne sont pas enveloppÃ©s dans une nouvelle ligne et que le code semble plus compact. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous implÃ©mentons une autre mÃ©thode utilitaire </font></font><code>drawBlankLine()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui fait la mÃªme chose que</font></font><code>drawHorizontalLine(offsetY, ' ')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, uniquement avec extension. </font><font style="vertical-align: inherit;">Parfois, nous devons rendre la ligne vide pas complÃ¨tement, mais laisser une ligne verticale au dÃ©but et Ã  la fin (cadre, oui). </font><font style="vertical-align: inherit;">Le code ressemblera Ã  ceci:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawBlankLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) { ansi.a(<span class="hljs-string"><span class="hljs-string">'â”‚'</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-string"><span class="hljs-string">'â”‚'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ansi.eraseLine(Ansi.Erase.ALL) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment, vous n'avez jamais dessinÃ© de cadres Ã  partir de pseudographies? </font><font style="vertical-align: inherit;">Les symboles peuvent Ãªtre insÃ©rÃ©s directement dans le code source. </font><font style="vertical-align: inherit;">Maintenez la touche Alt enfoncÃ©e et tapez le code de caractÃ¨re sur le pavÃ© numÃ©rique. </font><font style="vertical-align: inherit;">Alors lÃ¢chez prise. </font><font style="vertical-align: inherit;">Les codes ASCII dont nous avons besoin dans n'importe quel codage sont les mÃªmes, voici l'ensemble minimal de gentleman:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6u/0y/js/6u0yjs19ntz1fue2wgkichhvnfo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et puis, comme dans minecraft, les possibilitÃ©s ne sont limitÃ©es que par les limites de votre imagination. </font><font style="vertical-align: inherit;">Et la taille de l'Ã©cran.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawCenteredCaption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, text: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> center = (CONSOLE_WIDTH - text.length) / <span class="hljs-number"><span class="hljs-number">2</span></span> ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'â”‚'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until center).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.color(color).a(text).reset() (text.length + center until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'â”‚'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parlons un peu des fleurs. La classe </font></font><code>Ansi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient des constantes </font></font><code>Color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour huit couleurs primaires (noir, bleu, vert, cyan, rouge, violet, jaune, gris), que vous devez passer Ã  l'entrÃ©e des mÃ©thodes </font></font><code>fg()/bg()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour la version sombre ou </font></font><code>fgBright()/bgBright()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour la claire, ce qui est terriblement gÃªnant Ã  faire, car pour identifier la couleur par maniÃ¨re, une valeur ne nous suffit pas - nous en avons besoin d'au moins deux (couleur et luminositÃ©). Par consÃ©quent, nous allons crÃ©er notre liste de constantes et nos mÃ©thodes d'extension (ainsi que les couleurs de liaison de cartes aux types de cubes et aux classes de hÃ©ros):</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Color</span></span></span><span class="hljs-class"> </span></span>{ BLACK, DARK_BLUE, DARK_GREEN, DARK_CYAN, DARK_RED, DARK_MAGENTA, DARK_YELLOW, LIGHT_GRAY, DARK_GRAY, LIGHT_BLUE, LIGHT_GREEN, LIGHT_CYAN, LIGHT_RED, LIGHT_MAGENTA, LIGHT_YELLOW, WHITE } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Ansi.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Ansi = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (color) { Color.BLACK -&gt; fgBlack() Color.DARK_BLUE -&gt; fgBlue() Color.DARK_GREEN -&gt; fgGreen() Color.DARK_CYAN -&gt; fgCyan() Color.DARK_RED -&gt; fgRed() Color.DARK_MAGENTA -&gt; fgMagenta() Color.DARK_YELLOW -&gt; fgYellow() Color.LIGHT_GRAY -&gt; fg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; fgBrightBlack() Color.LIGHT_BLUE -&gt; fgBrightBlue() Color.LIGHT_GREEN -&gt; fgBrightGreen() Color.LIGHT_CYAN -&gt; fgBrightCyan() Color.LIGHT_RED -&gt; fgBrightRed() Color.LIGHT_MAGENTA -&gt; fgBrightMagenta() Color.LIGHT_YELLOW -&gt; fgBrightYellow() Color.WHITE -&gt; fgBright(Ansi.Color.WHITE) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Ansi.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Ansi = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (color) { Color.BLACK -&gt; ansi.bg(Ansi.Color.BLACK) Color.DARK_BLUE -&gt; ansi.bg(Ansi.Color.BLUE) Color.DARK_GREEN -&gt; ansi.bgGreen() Color.DARK_CYAN -&gt; ansi.bg(Ansi.Color.CYAN) Color.DARK_RED -&gt; ansi.bgRed() Color.DARK_MAGENTA -&gt; ansi.bgMagenta() Color.DARK_YELLOW -&gt; ansi.bgYellow() Color.LIGHT_GRAY -&gt; ansi.bg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; ansi.bgBright(Ansi.Color.BLACK) Color.LIGHT_BLUE -&gt; ansi.bgBright(Ansi.Color.BLUE) Color.LIGHT_GREEN -&gt; ansi.bgBrightGreen() Color.LIGHT_CYAN -&gt; ansi.bgBright(Ansi.Color.CYAN) Color.LIGHT_RED -&gt; ansi.bgBrightRed() Color.LIGHT_MAGENTA -&gt; ansi.bgBright(Ansi.Color.MAGENTA) Color.LIGHT_YELLOW -&gt; ansi.bgBrightYellow() Color.WHITE -&gt; ansi.bgBright(Ansi.Color.WHITE) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieColors = mapOf( Die.Type.PHYSICAL to Color.LIGHT_BLUE, Die.Type.SOMATIC to Color.LIGHT_GREEN, Die.Type.MENTAL to Color.LIGHT_MAGENTA, Die.Type.VERBAL to Color.LIGHT_YELLOW, Die.Type.DIVINE to Color.LIGHT_CYAN, Die.Type.WOUND to Color.DARK_GRAY, Die.Type.ENEMY to Color.DARK_RED, Die.Type.VILLAIN to Color.LIGHT_RED, Die.Type.OBSTACLE to Color.DARK_YELLOW, Die.Type.ALLY to Color.WHITE ) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroColors = mapOf( Hero.Type.BRAWLER to Color.LIGHT_BLUE, Hero.Type.HUNTER to Color.LIGHT_GREEN )</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DÃ©sormais, chacune des 16 couleurs disponibles est identifiÃ©e de maniÃ¨re unique par une seule constante. Nous allons Ã©crire quelques autres mÃ©thodes utilitaires, mais avant cela, nous allons trouver une derniÃ¨re chose: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oÃ¹ stocker les constantes pour les chaÃ®nes de texte? </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â«Les constantes de chaÃ®ne doivent Ãªtre extraites dans des fichiers sÃ©parÃ©s afin qu'elles soient stockÃ©es en un seul endroit, ce qui les rend plus faciles Ã  gÃ©rer. Et c'est aussi important pour la localisation ... "</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les constantes de chaÃ®ne doivent Ãªtre dÃ©placÃ©es vers des fichiers sÃ©parÃ©s ... enfin, oui. Nous endurerons. Le mÃ©canisme Java standard pour travailler avec ce type de ressources est les objets </font></font><code>java.util.ResourceBundle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui fonctionnent avec des fichiers </font></font><code>.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ici, nous partons d'un tel fichier:</font></font><br><br><pre> <code class="plaintext hljs"># Game status messages choose_dice_perform_check=Choose dice to perform check: end_of_turn_discard_extra=END OF TURN: Discard extra dice: end_of_turn_discard_optional=END OF TURN: Discard any dice, if needed: choose_action_before_exploration=Choose your action: choose_action_after_exploration=Already explored this turn. Choose what to do now: encounter_physical=Encountered PHYSICAL die. Need to pass respective check or lose this die. encounter_somatic=Encountered SOMATIC die. Need to pass respective check or lose this die. encounter_mental=Encountered MENTAL die. Need to pass respective check or lose this die. encounter_verbal=Encountered VERBAL die. Need to pass respective check or lose this die. encounter_divine=Encountered DIVINE die. Can be acquired automatically (no checks needed): die_acquire_success=You have acquired the die! die_acquire_failure=You have failed to acquire the die. game_loss_out_of_time=You ran out of time # Die types physical=PHYSICAL somatic=SOMATIC mental=MENTAL verbal=VERBAL divine=DIVINE ally=ALLY wound=WOUND enemy=ENEMY villain=VILLAIN obstacle=OBSTACLE # Hero types and descriptions brawler=Brawler hunter=Hunter # Various labels avg=avg bag=Bag bag_size=Bag size class=Class closed=Closed discard=Discard empty=Empty encountered=Encountered fail=Fail hand=Hand heros_turn=%s's turn max=max min=min perform_check=Perform check: pile=Pile received_new_die=Received new die result=Result success=Success sum=sum time=Time total=Total # Action names and descriptions action_confirm_key=ENTER action_confirm_name=Confirm action_cancel_key=ESC action_cancel_name=Cancel action_explore_location_key=E action_explore_location_name=xplore action_finish_turn_key=F action_finish_turn_name=inish action_hide_key=H action_hide_name=ide action_discard_key=D action_discard_name=iscard action_acquire_key=A action_acquire_name=cquire action_leave_key=L action_leave_name=eave action_forfeit_key=F action_forfeit_name=orfeit</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque ligne contient une paire clÃ©-valeur, sÃ©parÃ©e par un caractÃ¨re </font></font><code>=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vous pouvez placer le fichier n'importe oÃ¹ - l'essentiel est que le chemin d'accÃ¨s fasse partie du chemin de classe. </font><font style="vertical-align: inherit;">Veuillez noter que le texte des actions se compose de deux parties: la premiÃ¨re lettre est non seulement surlignÃ©e en jaune lorsqu'elle est affichÃ©e Ã  l'Ã©cran, mais dÃ©termine Ã©galement la touche qui doit Ãªtre enfoncÃ©e pour effectuer cette action. </font><font style="vertical-align: inherit;">Par consÃ©quent, il est pratique de les stocker sÃ©parÃ©ment. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, nous faisons abstraction d'un format spÃ©cifique (dans Android, par exemple, les chaÃ®nes sont stockÃ©es diffÃ©remment) et dÃ©crivons l'interface de chargement des constantes de chaÃ®ne.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringLoader</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La clÃ© est transmise Ã  l'entrÃ©e, la sortie est une ligne spÃ©cifique. </font><font style="vertical-align: inherit;">L'implÃ©mentation est aussi simple que l'interface elle-mÃªme (supposons que le fichier se trouve le long du chemin </font></font><code>src/main/resources/text/strings.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertiesStringLoader</span></span></span></span>() : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> properties = ResourceBundle.getBundle(<span class="hljs-string"><span class="hljs-string">"text.strings"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = properties.getString(key) ?: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, il ne sera pas difficile de mettre en Å“uvre une mÃ©thode </font></font><code>drawStatusMessage()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour afficher l'Ã©tat actuel du moteur de jeu ( </font></font><code>StatusMessage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">Ã  l'Ã©cran </font><font style="vertical-align: inherit;">et une mÃ©thode </font></font><code>drawActionList()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour afficher une liste d'actions disponibles ( </font></font><code>ActionList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Ainsi que d'autres mÃ©thodes officielles que seule l'Ã¢me dÃ©sire.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a beaucoup de code, une partie que nous avons dÃ©jÃ  vu ... alors voici un spoiler pour vous</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleRenderer</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> strings: StringLoader) { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ansi: Ansi <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { AnsiConsole.systemInstall() clearScreen() resetAnsi() } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = strings.loadString(key) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resetAnsi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ansi = Ansi.ansi() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { print(Ansi.ansi().eraseScreen(Ansi.Erase.ALL).cursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ansi.cursor(CONSOLE_HEIGHT, CONSOLE_WIDTH) System.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.print(ansi.toString()) resetAnsi() } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawBigNumber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetX: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, number: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = with(ansi) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentX = offsetX cursor(offsetY, currentX) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text = number.toString() text.forEach { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (it) { <span class="hljs-string"><span class="hljs-string">'0'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆ â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆ â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆ â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆâ–ˆ "</span></span>) } <span class="hljs-string"><span class="hljs-string">'1'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆ â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ "</span></span>) } <span class="hljs-string"><span class="hljs-string">'2'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆ â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ "</span></span>) } <span class="hljs-string"><span class="hljs-string">'3'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆâ–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆâ–ˆâ–ˆâ–ˆ "</span></span>) } <span class="hljs-string"><span class="hljs-string">'4'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) } <span class="hljs-string"><span class="hljs-string">'5'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆâ–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆâ–ˆâ–ˆâ–ˆ "</span></span>) } <span class="hljs-string"><span class="hljs-string">'6'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆâ–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆ â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆâ–ˆ "</span></span>) } <span class="hljs-string"><span class="hljs-string">'7'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) } <span class="hljs-string"><span class="hljs-string">'8'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆ â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆ â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆâ–ˆ "</span></span>) } <span class="hljs-string"><span class="hljs-string">'9'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"â–ˆ â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆâ–ˆâ–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆ "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" â–ˆâ–ˆâ–ˆ "</span></span>) } } currentX += <span class="hljs-number"><span class="hljs-number">6</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHorizontalLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, filler: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Char</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span>..CONSOLE_WIDTH).forEach { ansi.a(filler) } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawBlankLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) { ansi.a(<span class="hljs-string"><span class="hljs-string">'â”‚'</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-string"><span class="hljs-string">'â”‚'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ansi.eraseLine(Ansi.Erase.ALL) } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawCenteredCaption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, text: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> center = (CONSOLE_WIDTH - text.length) / <span class="hljs-number"><span class="hljs-number">2</span></span> ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'â”‚'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until center).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.color(color).a(text).reset() (text.length + center until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'â”‚'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawStatusMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, message: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//Setup val messageText = loadString(message.toString().toLowerCase()) var currentX = 1 val rightBorder = CONSOLE_WIDTH - if (drawBorders) 1 else 0 //Left border ansi.cursor(offsetY, 1) if (drawBorders) { ansi.a('â”‚') currentX++ } ansi.a(' ') currentX++ //Text ansi.a(messageText) currentX += messageText.length //Right border (currentX..rightBorder).forEach { ansi.a(' ') } if (drawBorders) { ansi.a('â”‚') } } protected fun drawActionList(offsetY: Int, actions: ActionList, drawBorders: Boolean = true) { val rightBorder = CONSOLE_WIDTH - if (drawBorders) 1 else 0 var currentX = 1 //Left border ansi.cursor(offsetY, 1) if (drawBorders) { ansi.a('â”‚') currentX++ } ansi.a(' ') currentX++ //List of actions actions.forEach { action -&gt; val key = loadString("action_${action.toString().toLowerCase()}_key") val name = loadString("action_${action.toString().toLowerCase()}_name") val length = key.length + 2 + name.length if (currentX + length &gt;= rightBorder) { (currentX..rightBorder).forEach { ansi.a(' ') } if (drawBorders) { ansi.a('â”‚') } ansi.cursor(offsetY + 1, 1) currentX = 1 if (drawBorders) { ansi.a('â”‚') currentX++ } ansi.a(' ') currentX++ } if (action.isEnabled) { ansi.color(Color.LIGHT_YELLOW) } ansi.a('(').a(key).a(')').reset() ansi.a(name) ansi.a(" ") currentX += length + 2 } //Right border (currentX..rightBorder).forEach { ansi.a(' ') } if (drawBorders) { ansi.a('â”‚') } } protected enum class Color { BLACK, DARK_BLUE, DARK_GREEN, DARK_CYAN, DARK_RED, DARK_MAGENTA, DARK_YELLOW, LIGHT_GRAY, DARK_GRAY, LIGHT_BLUE, LIGHT_GREEN, LIGHT_CYAN, LIGHT_RED, LIGHT_MAGENTA, LIGHT_YELLOW, WHITE } protected fun Ansi.color(color: Color?): Ansi = when (color) { Color.BLACK -&gt; fgBlack() Color.DARK_BLUE -&gt; fgBlue() Color.DARK_GREEN -&gt; fgGreen() Color.DARK_CYAN -&gt; fgCyan() Color.DARK_RED -&gt; fgRed() Color.DARK_MAGENTA -&gt; fgMagenta() Color.DARK_YELLOW -&gt; fgYellow() Color.LIGHT_GRAY -&gt; fg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; fgBrightBlack() Color.LIGHT_BLUE -&gt; fgBrightBlue() Color.LIGHT_GREEN -&gt; fgBrightGreen() Color.LIGHT_CYAN -&gt; fgBrightCyan() Color.LIGHT_RED -&gt; fgBrightRed() Color.LIGHT_MAGENTA -&gt; fgBrightMagenta() Color.LIGHT_YELLOW -&gt; fgBrightYellow() Color.WHITE -&gt; fgBright(Ansi.Color.WHITE) else -&gt; this } protected fun Ansi.background(color: Color?): Ansi = when (color) { Color.BLACK -&gt; ansi.bg(Ansi.Color.BLACK) Color.DARK_BLUE -&gt; ansi.bg(Ansi.Color.BLUE) Color.DARK_GREEN -&gt; ansi.bgGreen() Color.DARK_CYAN -&gt; ansi.bg(Ansi.Color.CYAN) Color.DARK_RED -&gt; ansi.bgRed() Color.DARK_MAGENTA -&gt; ansi.bgMagenta() Color.DARK_YELLOW -&gt; ansi.bgYellow() Color.LIGHT_GRAY -&gt; ansi.bg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; ansi.bgBright(Ansi.Color.BLACK) Color.LIGHT_BLUE -&gt; ansi.bgBright(Ansi.Color.BLUE) Color.LIGHT_GREEN -&gt; ansi.bgBrightGreen() Color.LIGHT_CYAN -&gt; ansi.bgBright(Ansi.Color.CYAN) Color.LIGHT_RED -&gt; ansi.bgBrightRed() Color.LIGHT_MAGENTA -&gt; ansi.bgBright(Ansi.Color.MAGENTA) Color.LIGHT_YELLOW -&gt; ansi.bgBrightYellow() Color.WHITE -&gt; ansi.bgBright(Ansi.Color.WHITE) else -&gt; this } protected val dieColors = mapOf( Die.Type.PHYSICAL to Color.LIGHT_BLUE, Die.Type.SOMATIC to Color.LIGHT_GREEN, Die.Type.MENTAL to Color.LIGHT_MAGENTA, Die.Type.VERBAL to Color.LIGHT_YELLOW, Die.Type.DIVINE to Color.LIGHT_CYAN, Die.Type.WOUND to Color.DARK_GRAY, Die.Type.ENEMY to Color.DARK_RED, Die.Type.VILLAIN to Color.LIGHT_RED, Die.Type.OBSTACLE to Color.DARK_YELLOW, Die.Type.ALLY to Color.WHITE ) protected val heroColors = mapOf( Hero.Type.BRAWLER to Color.LIGHT_BLUE, Hero.Type.HUNTER to Color.LIGHT_GREEN ) protected open fun shortcut(index: Int) = "1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ"[index] }</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi avons-nous tous fait cela, demandez-vous? </font><font style="vertical-align: inherit;">Oui, afin d'hÃ©riter notre implÃ©mentation d'interface de cette merveilleuse classe </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagramme de classe</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/tn/00/fj/tn00fjvlnpga4zqm1p-ojveq7nm.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voici Ã  quoi ressemblera l'implÃ©mentation de la premiÃ¨re mÃ©thode la plus simple: </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawGameLoss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> centerY = CONSOLE_HEIGHT / <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> until centerY).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = loadString(message.toString().toLowerCase()).toUpperCase() drawCenteredCaption(centerY, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>, LIGHT_RED, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) (centerY + <span class="hljs-number"><span class="hljs-number">1</span></span>..CONSOLE_HEIGHT).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } render() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rien de surnaturel, juste une ligne de texte ( </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) tracÃ©e en rouge au centre de l'Ã©cran ( </font></font><code>drawCenteredCaption()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Le reste du code remplit le reste de l'Ã©cran avec des lignes vides. Peut-Ãªtre que quelqu'un demandera pourquoi cela est nÃ©cessaire - aprÃ¨s tout </font></font><code>clearScreen()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">il existe une mÃ©thode </font><font style="vertical-align: inherit;">, il suffit de l'appeler au dÃ©but de la mÃ©thode, d'effacer l'Ã©cran, puis de dessiner le texte souhaitÃ©. HÃ©las, c'est une approche paresseuse que nous n'utiliserons pas. La raison est trÃ¨s simple: avec cette approche, certaines positions sur l'Ã©cran sont dessinÃ©es deux fois, ce qui conduit Ã  un scintillement notable, surtout lorsque l'Ã©cran est dessinÃ© sÃ©quentiellement plusieurs fois de suite (lors des animations). Par consÃ©quent, notre tÃ¢che n'est pas seulement de dessiner les bons personnages aux bons endroits, mais de remplir l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ensemble</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le reste de l'Ã©cran avec des caractÃ¨res vides (afin que les artefacts d'autres rendus ne restent pas dessus). Et cette tÃ¢che n'est pas si simple. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mÃ©thode suivante suit ce principe:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHeroTurnStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> centerY = (CONSOLE_HEIGHT - <span class="hljs-number"><span class="hljs-number">5</span></span>) / <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> until centerY).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } ansi.color(heroColors[hero.type]) drawHorizontalLine(centerY, <span class="hljs-string"><span class="hljs-string">'â”€'</span></span>) drawHorizontalLine(centerY + <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'â”€'</span></span>) ansi.reset() ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).eraseLine() ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).eraseLine() ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text = String.format(loadString(<span class="hljs-string"><span class="hljs-string">"heros_turn"</span></span>), hero.name.toUpperCase()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> index = text.indexOf(hero.name.toUpperCase()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> center = (CONSOLE_WIDTH - text.length) / <span class="hljs-number"><span class="hljs-number">2</span></span> ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">2</span></span>, center) ansi.eraseLine(Ansi.Erase.BACKWARD) ansi.a(text.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, index)) ansi.color(heroColors[hero.type]).a(hero.name.toUpperCase()).reset() ansi.a(text.substring(index + hero.name.length)) ansi.eraseLine(Ansi.Erase.FORWARD) (centerY + <span class="hljs-number"><span class="hljs-number">5</span></span>..CONSOLE_HEIGHT).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } render() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, en plus du texte centrÃ©, il y a aussi deux lignes horizontales (voir les captures d'Ã©cran ci-dessus). </font><font style="vertical-align: inherit;">Veuillez noter que le lettrage central est affichÃ© en deux couleurs. </font><font style="vertical-align: inherit;">Et assurez-vous Ã©galement que l'apprentissage des mathÃ©matiques Ã  l'Ã©cole est toujours utile. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, nous avons examinÃ© les mÃ©thodes les plus simples et il est temps de connaÃ®tre la mise en Å“uvre </font></font><code>drawLocationInteriorScreen()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Comme vous le comprenez vous-mÃªme, il y aura un ordre de grandeur plus de code ici. </font><font style="vertical-align: inherit;">De plus, le contenu de l'Ã©cran changera dynamiquement en rÃ©ponse aux actions de l'utilisateur et devra Ãªtre constamment redessinÃ© (parfois avec animation). </font><font style="vertical-align: inherit;">Eh bien, pour enfin vous achever: imaginez qu'en plus de la capture d'Ã©cran ci-dessus, dans le cadre de cette mÃ©thode, il faut implÃ©menter l'affichage de trois autres:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Rencontre avec le cube retirÃ© du sac</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/8x/lx/h9/8xlxh9h-ulu0efaigsnnfuo6nsq.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. SÃ©lection des dÃ©s pour rÃ©ussir le test</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/cd/iw/2e/cdiw2e0fxlfdsjeijyxwauzth-m.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Affichage des rÃ©sultats des tests</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/t3/-w/7r/t3-w7rfvplkfeywr9_5accvkada.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par consÃ©quent, voici mon excellent conseil: ne mettez pas tout le code dans une seule mÃ©thode. </font><font style="vertical-align: inherit;">Divisez l'implÃ©mentation en plusieurs mÃ©thodes (mÃªme si chacune d'elles ne sera appelÃ©e qu'une seule fois). </font><font style="vertical-align: inherit;">Eh bien, n'oubliez pas le "caoutchouc".</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si cela commence Ã  onduler dans vos yeux, clignez des yeux pendant quelques secondes - cela devrait aider</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleGameRenderer</span></span></span></span>(loader: StringLoader) : ConsoleRenderer(loader), GameRenderer { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawLocationTopPanel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(location: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Location</span></span></span></span><span class="hljs-function"><span class="hljs-params">, heroesAtLocation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, currentHero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">, timer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> closedString = loadString(<span class="hljs-string"><span class="hljs-string">"closed"</span></span>).toLowerCase() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> timeString = loadString(<span class="hljs-string"><span class="hljs-string">"time"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locationName = location.name.toString().toUpperCase() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> separatorX1 = locationName.length + <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.isOpen) { <span class="hljs-number"><span class="hljs-number">6</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.bag.size &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { closedString.length + <span class="hljs-number"><span class="hljs-number">7</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> separatorX2 = CONSOLE_WIDTH - timeString.length - <span class="hljs-number"><span class="hljs-number">6</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timer &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">//Top border ansi.cursor(1, 1) ansi.a('â”Œ') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2) 'â”¬' else 'â”€') } ansi.a('â”') //Center row ansi.cursor(2, 1) ansi.a("â”‚ ") if (location.isOpen) { ansi.color(WHITE).a(locationName).reset() ansi.a(": ").a(location.bag.size) } else { ansi.a(locationName).reset() ansi.color(DARK_GRAY).a(" (").a(closedString).a(')').reset() } ansi.a(" â”‚") var currentX = separatorX1 + 2 heroesAtLocation.forEach { hero -&gt; ansi.a(' ') ansi.color(heroColors[hero.type]) ansi.a(if (hero === currentHero) 'â˜»' else '').reset() currentX += 2 } (currentX..separatorX2).forEach { ansi.a(' ') } ansi.a("â”‚ ").a(timeString).a(": ") when { timer &lt;= 5 -&gt; ansi.color(LIGHT_RED) timer &lt;= 15 -&gt; ansi.color(LIGHT_YELLOW) else -&gt; ansi.color(LIGHT_GREEN) } ansi.bold().a(timer).reset().a(" â”‚") //Bottom border ansi.cursor(3, 1) ansi.a('â”œ') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2) 'â”´' else 'â”€') } ansi.a('â”¤') } private fun drawLocationHeroPanel(offsetY: Int, hero: Hero) { val bagString = loadString("bag").toUpperCase() val discardString = loadString("discard").toUpperCase() val separatorX1 = hero.name.length + 4 val separatorX3 = CONSOLE_WIDTH - discardString.length - 6 - if (hero.discardPile.size &gt;= 10) 1 else 0 val separatorX2 = separatorX3 - bagString.length - 6 - if (hero.bag.size &gt;= 10) 1 else 0 //Top border ansi.cursor(offsetY, 1) ansi.a('â”œ') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2 || it == separatorX3) 'â”¬' else 'â”€') } ansi.a('â”¤') //Center row ansi.cursor(offsetY + 1, 1) ansi.a("â”‚ ") ansi.color(heroColors[hero.type]).a(hero.name.toUpperCase()).reset() ansi.a(" â”‚") val currentX = separatorX1 + 1 (currentX until separatorX2).forEach { ansi.a(' ') } ansi.a("â”‚ ").a(bagString).a(": ") when { hero.bag.size &lt;= hero.hand.capacity -&gt; ansi.color(LIGHT_RED) else -&gt; ansi.color(LIGHT_YELLOW) } ansi.a(hero.bag.size).reset() ansi.a(" â”‚ ").a(discardString).a(": ") ansi.a(hero.discardPile.size) ansi.a(" â”‚") //Bottom border ansi.cursor(offsetY + 2, 1) ansi.a('â”œ') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2 || it == separatorX3) 'â”´' else 'â”€') } ansi.a('â”¤') } private fun drawDieSize(die: Die, checked: Boolean = false) { when { checked -&gt; ansi.background(dieColors[die.type]).color(BLACK) else -&gt; ansi.color(dieColors[die.type]) } ansi.a(die.toString()).reset() } private fun drawDieFrameSmall(offsetX: Int, offsetY: Int, longDieSize: Boolean) { //Top border ansi.cursor(offsetY, offsetX) ansi.a('â•”') (0 until if (longDieSize) 5 else 4).forEach { ansi.a('â•') } ansi.a('â•—') //Left border ansi.cursor(offsetY + 1, offsetX) ansi.a("â•‘ ") //Bottom border ansi.cursor(offsetY + 2, offsetX) ansi.a("â•š") (0 until if (longDieSize) 5 else 4).forEach { ansi.a('â•') } ansi.a('â•') //Right border ansi.cursor(offsetY + 1, offsetX + if (longDieSize) 6 else 5) ansi.a('â•‘') } private fun drawDieSmall(offsetX: Int, offsetY: Int, pair: DiePair, rollResult: Int? = null) { ansi.color(dieColors[pair.die.type]) val longDieSize = pair.die.size &gt;= 10 drawDieFrameSmall(offsetX, offsetY, longDieSize) //Roll result or die size ansi.cursor(offsetY + 1, offsetX + 1) if (rollResult != null) { ansi.a(String.format(" %2d %s", rollResult, if (longDieSize) " " else "")) } else { ansi.a(' ').a(pair.die.toString()).a(' ') } //Draw modifier ansi.cursor(offsetY + 3, offsetX) val modString = if (pair.modifier == 0) "" else String.format("%+d", pair.modifier) val frameLength = 4 + if (longDieSize) 3 else 2 var spaces = (frameLength - modString.length) / 2 (0 until spaces).forEach { ansi.a(' ') } ansi.a(modString) spaces = frameLength - spaces - modString.length (0 until spaces).forEach { ansi.a(' ') } ansi.reset() } private fun drawDieFrameBig(offsetX: Int, offsetY: Int, longDieSize: Boolean) { //Top border ansi.cursor(offsetY, offsetX) ansi.a('â•”') (0 until if (longDieSize) 3 else 2).forEach { ansi.a("â•â•â•â•â•â•") } ansi.a("â•â•—") //Left border (1..5).forEach { ansi.cursor(offsetY + it, offsetX) ansi.a('â•‘') } //Bottom border ansi.cursor(offsetY + 6, offsetX) ansi.a('â•š') (0 until if (longDieSize) 3 else 2).forEach { ansi.a("â•â•â•â•â•â•") } ansi.a("â•â•") //Right border val currentX = offsetX + if (longDieSize) 20 else 14 (1..5).forEach { ansi.cursor(offsetY + it, currentX) ansi.a('â•‘') } } private fun drawDieSizeBig(offsetX: Int, offsetY: Int, pair: DiePair) { ansi.color(dieColors[pair.die.type]) val longDieSize = pair.die.size &gt;= 10 drawDieFrameBig(offsetX, offsetY, longDieSize) //Die size ansi.cursor(offsetY + 1, offsetX + 1) ansi.a(" â–ˆâ–ˆâ–ˆâ–ˆ ") ansi.cursor(offsetY + 2, offsetX + 1) ansi.a(" â–ˆ â–ˆ ") ansi.cursor(offsetY + 3, offsetX + 1) ansi.a(" â–ˆ â–ˆ ") ansi.cursor(offsetY + 4, offsetX + 1) ansi.a(" â–ˆ â–ˆ ") ansi.cursor(offsetY + 5, offsetX + 1) ansi.a(" â–ˆâ–ˆâ–ˆâ–ˆ ") drawBigNumber(offsetX + 8, offsetY + 1, pair.die.size) //Draw modifier ansi.cursor(offsetY + 7, offsetX) val modString = if (pair.modifier == 0) "" else String.format("%+d", pair.modifier) val frameLength = 4 + 6 * if (longDieSize) 3 else 2 var spaces = (frameLength - modString.length) / 2 (0 until spaces).forEach { ansi.a(' ') } ansi.a(modString) spaces = frameLength - spaces - modString.length - 1 (0 until spaces).forEach { ansi.a(' ') } ansi.reset() } private fun drawBattleCheck(offsetY: Int, battleCheck: DieBattleCheck) { val performCheck = loadString("perform_check") var currentX = 4 var currentY = offsetY //Top message ansi.cursor(offsetY, 1) ansi.a("â”‚ ").a(performCheck) (performCheck.length + 4 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('â”‚') //Left border (1..4).forEach { ansi.cursor(offsetY + it, 1) ansi.a("â”‚ ") } //Opponent var opponentWidth = 0 var vsWidth = 0 (battleCheck.getOpponentPair())?.let { //Die if (battleCheck.isRolled) { drawDieSmall(4, offsetY + 1, it, battleCheck.getOpponentResult()) } else { drawDieSmall(4, offsetY + 1, it) } opponentWidth = 4 + if (it.die.size &gt;= 10) 3 else 2 currentX += opponentWidth //VS ansi.cursor(currentY + 1, currentX) ansi.a(" ") ansi.cursor(currentY + 2, currentX) ansi.color(LIGHT_YELLOW).a(" VS ").reset() ansi.cursor(currentY + 3, currentX) ansi.a(" ") ansi.cursor(currentY + 4, currentX) ansi.a(" ") vsWidth = 4 currentX += vsWidth } //Clear below for (row in currentY + 5..currentY + 8) { ansi.cursor(row, 1) ansi.a('â”‚') (2 until currentX).forEach { ansi.a(' ') } } //Dice for (index in 0 until battleCheck.heroPairCount) { if (index &gt; 0) { ansi.cursor(currentY + 1, currentX) ansi.a(" ") ansi.cursor(currentY + 2, currentX) ansi.a(if (battleCheck.method == DieBattleCheck.Method.SUM) " + " else " / ").reset() ansi.cursor(currentY + 3, currentX) ansi.a(" ") ansi.cursor(currentY + 4, currentX) ansi.a(" ") currentX += 3 } val pair = battleCheck.getHeroPairAt(index) val width = 4 + if (pair.die.size &gt;= 10) 3 else 2 if (currentX + width + 3 &gt; CONSOLE_WIDTH) { //Out of space for (row in currentY + 1..currentY + 4) { ansi.cursor(row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('â”‚') } currentY += 4 currentX = 4 + vsWidth + opponentWidth } if (battleCheck.isRolled) { drawDieSmall(currentX, currentY + 1, pair, battleCheck.getHeroResultAt(index)) } else { drawDieSmall(currentX, currentY + 1, pair) } currentX += width } //Clear the rest (currentY + 1..currentY + 4).forEach { row -&gt; ansi.cursor(row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('â”‚') } if (currentY == offsetY) { //Still on the first line currentX = 4 + vsWidth + opponentWidth (currentY + 5..currentY + 8).forEach { row -&gt; ansi.cursor(row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('â”‚') } } //Draw result (battleCheck.result)?.let { r -&gt; val frameTopY = offsetY + 5 val result = String.format("%+d", r) val message = loadString(if (r &gt;= 0) "success" else "fail").toUpperCase() val color = if (r &gt;= 0) DARK_GREEN else DARK_RED //Frame ansi.color(color) drawHorizontalLine(frameTopY, 'â–’') drawHorizontalLine(frameTopY + 3, 'â–’') ansi.cursor(frameTopY + 1, 1).a("â–’â–’") ansi.cursor(frameTopY + 1, CONSOLE_WIDTH - 1).a("â–’â–’") ansi.cursor(frameTopY + 2, 1).a("â–’â–’") ansi.cursor(frameTopY + 2, CONSOLE_WIDTH - 1).a("â–’â–’") ansi.reset() //Top message val resultString = loadString("result") var center = (CONSOLE_WIDTH - result.length - resultString.length - 2) / 2 ansi.cursor(frameTopY + 1, 3) (3 until center).forEach { ansi.a(' ') } ansi.a(resultString).a(": ") ansi.color(color).a(result).reset() (center + result.length + resultString.length + 2 until CONSOLE_WIDTH - 1).forEach { ansi.a(' ') } //Bottom message center = (CONSOLE_WIDTH - message.length) / 2 ansi.cursor(frameTopY + 2, 3) (3 until center).forEach { ansi.a(' ') } ansi.color(color).a(message).reset() (center + message.length until CONSOLE_WIDTH - 1).forEach { ansi.a(' ') } } } private fun drawExplorationResult(offsetY: Int, pair: DiePair) { val encountered = loadString("encountered") ansi.cursor(offsetY, 1) ansi.a("â”‚ ").a(encountered).a(':') (encountered.length + 5 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('â”‚') val dieFrameWidth = 3 + 6 * if (pair.die.size &gt;= 10) 3 else 2 for (row in 1..8) { ansi.cursor(offsetY + row, 1) ansi.a("â”‚ ") ansi.cursor(offsetY + row, dieFrameWidth + 4) (dieFrameWidth + 4 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('â”‚') } drawDieSizeBig(4, offsetY + 1, pair) } private fun drawHand(offsetY: Int, hand: Hand, checkedDice: HandMask, activePositions: HandMask) { val handString = loadString("hand").toUpperCase() val alliesString = loadString("allies").toUpperCase() val capacity = hand.capacity val size = hand.dieCount val slots = max(size, capacity) val alliesSize = hand.allyDieCount var currentY = offsetY var currentX = 1 //Hand title ansi.cursor(currentY, currentX) ansi.a("â”‚ ").a(handString) //Left border currentY += 1 currentX = 1 ansi.cursor(currentY, currentX) ansi.a("â”‚ â•”") ansi.cursor(currentY + 1, currentX) ansi.a("â”‚ â•‘") ansi.cursor(currentY + 2, currentX) ansi.a("â”‚ â•š") ansi.cursor(currentY + 3, currentX) ansi.a("â”‚ ") currentX += 3 //Main hand for (i in 0 until min(slots, MAX_HAND_SIZE)) { val die = hand.dieAt(i) val longDieName = die != null &amp;&amp; die.size &gt;= 10 //Top border ansi.cursor(currentY, currentX) if (i &lt; capacity) { ansi.a("â•â•â•â•").a(if (longDieName) "â•" else "") } else { ansi.a("â”€â”€â”€â”€").a(if (longDieName) "â”€" else "") } ansi.a(if (i &lt; capacity - 1) 'â•¤' else if (i == capacity - 1) 'â•—' else if (i &lt; size - 1) 'â”¬' else 'â”') //Center row ansi.cursor(currentY + 1, currentX) ansi.a(' ') if (die != null) { drawDieSize(die, checkedDice.checkPosition(i)) } else { ansi.a(" ") } ansi.a(' ') ansi.a(if (i &lt; capacity - 1) 'â”‚' else if (i == capacity - 1) 'â•‘' else 'â”‚') //Bottom border ansi.cursor(currentY + 2, currentX) if (i &lt; capacity) { ansi.a("â•â•â•â•").a(if (longDieName) 'â•' else "") } else { ansi.a("â”€â”€â”€â”€").a(if (longDieName) 'â”€' else "") } ansi.a(if (i &lt; capacity - 1) 'â•§' else if (i == capacity - 1) 'â•' else if (i &lt; size - 1) 'â”´' else 'â”˜') //Die number ansi.cursor(currentY + 3, currentX) if (activePositions.checkPosition(i)) { ansi.color(LIGHT_YELLOW) } ansi.a(String.format(" (%s) %s", shortcut(i), if (longDieName) " " else "")) ansi.reset() currentX += 5 + if (longDieName) 1 else 0 } //Ally subhand if (alliesSize &gt; 0) { currentY = offsetY //Ally title ansi.cursor(currentY, handString.length + 5) (handString.length + 5 until currentX).forEach { ansi.a(' ') } ansi.a(" ").a(alliesString) (currentX + alliesString.length + 5 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('â”‚') //Left border currentY += 1 ansi.cursor(currentY, currentX) ansi.a(" â”Œ") ansi.cursor(currentY + 1, currentX) ansi.a(" â”‚") ansi.cursor(currentY + 2, currentX) ansi.a(" â””") ansi.cursor(currentY + 3, currentX) ansi.a(" ") currentX += 4 //Ally slots for (i in 0 until min(alliesSize, MAX_HAND_ALLY_SIZE)) { val allyDie = hand.allyDieAt(i)!! val longDieName = allyDie.size &gt;= 10 //Top border ansi.cursor(currentY, currentX) ansi.a("â”€â”€â”€â”€").a(if (longDieName) "â”€" else "") ansi.a(if (i &lt; alliesSize - 1) 'â”¬' else 'â”') //Center row ansi.cursor(currentY + 1, currentX) ansi.a(' ') drawDieSize(allyDie, checkedDice.checkAllyPosition(i)) ansi.a(" â”‚") //Bottom border ansi.cursor(currentY + 2, currentX) ansi.a("â”€â”€â”€â”€").a(if (longDieName) "â”€" else "") ansi.a(if (i &lt; alliesSize - 1) 'â”´' else 'â”˜') //Die number ansi.cursor(currentY + 3, currentX) if (activePositions.checkAllyPosition(i)) { ansi.color(LIGHT_YELLOW) } ansi.a(String.format(" (%s) %s", shortcut(i + 10), if (longDieName) " " else "")).reset() currentX += 5 + if (longDieName) 1 else 0 } } else { ansi.cursor(offsetY, 9) (9 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('â”‚') ansi.cursor(offsetY + 4, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('â”‚') } //Clear the end of the line (0..3).forEach { row -&gt; ansi.cursor(currentY + row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('â”‚') } } override fun drawHeroTurnStart(hero: Hero) { val centerY = (CONSOLE_HEIGHT - 5) / 2 (1 until centerY).forEach { drawBlankLine(it, false) } ansi.color(heroColors[hero.type]) drawHorizontalLine(centerY, 'â”€') drawHorizontalLine(centerY + 4, 'â”€') ansi.reset() ansi.cursor(centerY + 1, 1).eraseLine() ansi.cursor(centerY + 3, 1).eraseLine() ansi.cursor(centerY + 2, 1) val text = String.format(loadString("heros_turn"), hero.name.toUpperCase()) val index = text.indexOf(hero.name.toUpperCase()) val center = (CONSOLE_WIDTH - text.length) / 2 ansi.cursor(centerY + 2, center) ansi.eraseLine(Ansi.Erase.BACKWARD) ansi.a(text.substring(0, index)) ansi.color(heroColors[hero.type]).a(hero.name.toUpperCase()).reset() ansi.a(text.substring(index + hero.name.length)) ansi.eraseLine(Ansi.Erase.FORWARD) (centerY + 5..CONSOLE_HEIGHT).forEach { drawBlankLine(it, false) } render() } override fun drawLocationInteriorScreen( location: Location, heroesAtLocation: List&lt;Hero&gt;, timer: Int, currentHero: Hero, battleCheck: DieBattleCheck?, encounteredDie: DiePair?, pickedDice: HandMask, activePositions: HandMask, statusMessage: StatusMessage, actions: ActionList) { //Top panel drawLocationTopPanel(location, heroesAtLocation, currentHero, timer) //Encounter info when { battleCheck != null -&gt; drawBattleCheck(4, battleCheck) encounteredDie != null -&gt; drawExplorationResult(4, encounteredDie) else -&gt; (4..12).forEach { drawBlankLine(it) } } //Fill blank space val bottomHalfTop = CONSOLE_HEIGHT - 11 (13 until bottomHalfTop).forEach { drawBlankLine(it) } //Hero-specific info drawLocationHeroPanel(bottomHalfTop, currentHero) drawHand(bottomHalfTop + 3, currentHero.hand, pickedDice, activePositions) //Separator ansi.cursor(bottomHalfTop + 8, 1) ansi.a('â”œ') (2 until CONSOLE_WIDTH).forEach { ansi.a('â”€') } ansi.a('â”¤') //Status and actions drawStatusMessage(bottomHalfTop + 9, statusMessage) drawActionList(bottomHalfTop + 10, actions) //Bottom border ansi.cursor(CONSOLE_HEIGHT, 1) ansi.a('â””') (2 until CONSOLE_WIDTH).forEach { ansi.a('â”€') } ansi.a('â”˜') //Finalize render() } override fun drawGameLoss(message: StatusMessage) { val centerY = CONSOLE_HEIGHT / 2 (1 until centerY).forEach { drawBlankLine(it, false) } val data = loadString(message.toString().toLowerCase()).toUpperCase() drawCenteredCaption(centerY, data, LIGHT_RED, false) (centerY + 1..CONSOLE_HEIGHT).forEach { drawBlankLine(it, false) } render() } }</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a un petit problÃ¨me associÃ© Ã  la vÃ©rification du fonctionnement de tout ce code. </font><font style="vertical-align: inherit;">Ã‰tant donnÃ© que la console IDE intÃ©grÃ©e ne prend pas en charge les sÃ©quences d'Ã©chappement ANSI, vous devrez dÃ©marrer l'application dans un terminal externe (nous avons dÃ©jÃ  Ã©crit un script pour le lancer plus tÃ´t). </font><font style="vertical-align: inherit;">De plus, avec la prise en charge ANSI, tout ne va pas bien sous Windows - Ã  ma connaissance, seule la 10e version du cmd.exe standard peut nous plaire avec un affichage de haute qualitÃ© (et cela, avec certains problÃ¨mes sur lesquels nous ne nous concentrerons pas). </font><font style="vertical-align: inherit;">Et PowerShell n'a pas immÃ©diatement appris Ã  reconnaÃ®tre les sÃ©quences (malgrÃ© la demande actuelle). </font><font style="vertical-align: inherit;">Si vous n'avez pas de chance, ne vous dÃ©couragez pas - il existe toujours des solutions alternatives ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ceci, par exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Et nous continuons.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tape dix </font><font style="vertical-align: inherit;">EntrÃ©e utilisateur</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'affichage de l'image Ã  l'Ã©cran reprÃ©sente toujours la moitiÃ© de la bataille. Il est Ã©galement important de recevoir correctement les commandes de contrÃ´le de l'utilisateur. Et cette tÃ¢che, je tiens Ã  vous le dire, peut s'avÃ©rer techniquement beaucoup plus difficile Ã  mettre en Å“uvre que toutes les prÃ©cÃ©dentes. Mais tout d'abord. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous vous en souvenez, nous sommes confrontÃ©s Ã  la nÃ©cessitÃ© d'implÃ©menter des mÃ©thodes de classe </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Il n'y en a que trois, mais elles nÃ©cessitent une attention particuliÃ¨re. Tout d'abord, la synchronisation. Le moteur de jeu doit Ãªtre suspendu jusqu'Ã  ce que le joueur appuie sur une touche. DeuxiÃ¨mement, cliquez sur le traitement. Malheureusement, la capacitÃ© des classes standard </font></font><code>Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Scanner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Console</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne suffit pas Ã  les </font><font style="vertical-align: inherit;">reconnaÃ®tre les </font><font style="vertical-align: inherit;">plus pressants: nous ne demandons pas que </font><font style="vertical-align: inherit;">l'utilisateur presse ENTRER aprÃ¨s chaque commande. Nous avons besoin de quelque chose comme</font></font><code>KeyListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais, mais il est Ã©troitement liÃ© au cadre Swing, et notre application console est sans tout ce clinquant graphique.</font></font><br><br>  Que faire?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La recherche de bibliothÃ¨ques, bien sÃ»r, et cette fois, leur travail reposera entiÃ¨rement sur du code natif. Qu'est-ce que cela signifie Â«au revoir, multiplateformeÂ» ... Ou pas? HÃ©las, je n'ai pas encore trouvÃ© de bibliothÃ¨que qui implÃ©mente des fonctionnalitÃ©s simples sous une forme lÃ©gÃ¨re et indÃ©pendante de la plateforme. En attendant, faisons attention au monstre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jLine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui implÃ©mente un rÃ©colteur pour construire des interfaces utilisateur avancÃ©es (dans la console). Oui, il a une implÃ©mentation native, oui, il prend en charge Windows et Linux / UNIX (en fournissant les bibliothÃ¨ques appropriÃ©es). Et oui, utilisÃ© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la plupart de ses fonctionnalitÃ©s, on n'a pas besoin de cent ans. Tout ce qu'il faut, c'est une petite opportunitÃ© mal documentÃ©e, dont nous allons maintenant analyser le travail.</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.14.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veuillez noter que nous n'avons pas besoin de la troisiÃ¨me, derniÃ¨re version, mais de la seconde, oÃ¹ il y a une classe </font></font><code>ConsoleReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec une mÃ©thode </font></font><code>readCharacter()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Comme son nom l'indique, cette mÃ©thode renvoie le code du caractÃ¨re pressÃ© sur le clavier (tout en travaillant de maniÃ¨re synchrone, ce dont nous avons besoin). Le reste est une question technique: compiler un tableau de correspondances entre symboles et types d'actions ( </font></font><code>Action.Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et, en cliquant sur l'un, renvoyer l'autre. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â«Savez-vous que toutes les touches du clavier ne peuvent pas Ãªtre reprÃ©sentÃ©es avec un seul caractÃ¨re? De nombreuses touches utilisent des sÃ©quences d'Ã©chappement de deux, trois, quatre caractÃ¨res diffÃ©rents. Comment Ãªtre avec eux? "</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il convient de noter que la tÃ¢che de saisie est compliquÃ©e si nous voulons reconnaÃ®tre les Â«touches sans caractÃ¨reÂ»: flÃ¨ches, touches F, accueil, insertion, PgUp / Dn, fin, suppression, pavÃ© numÃ©rique et autres. </font><font style="vertical-align: inherit;">Mais nous ne voulons pas, nous allons donc continuer. </font><font style="vertical-align: inherit;">CrÃ©ons une classe </font></font><code>ConsoleInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec les mÃ©thodes de service nÃ©cessaires.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleInteractor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reader = ConsoleReader() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mapper = mapOf( CONFIRM to <span class="hljs-number"><span class="hljs-number">13</span></span>.toChar(), CANCEL to <span class="hljs-number"><span class="hljs-number">27</span></span>.toChar(), EXPLORE_LOCATION to <span class="hljs-string"><span class="hljs-string">'e'</span></span>, FINISH_TURN to <span class="hljs-string"><span class="hljs-string">'f'</span></span>, ACQUIRE to <span class="hljs-string"><span class="hljs-string">'a'</span></span>, LEAVE to <span class="hljs-string"><span class="hljs-string">'l'</span></span>, FORFEIT to <span class="hljs-string"><span class="hljs-string">'f'</span></span>, HIDE to <span class="hljs-string"><span class="hljs-string">'h'</span></span>, DISCARD to <span class="hljs-string"><span class="hljs-string">'d'</span></span>, ) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = reader.readCharacter().toChar() <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIndexForKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Char</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-string"><span class="hljs-string">"1234567890abcdefghijklmnopqrstuvw"</span></span>.indexOf(key) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DÃ©finissez la carte </font></font><code>mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la mÃ©thode </font></font><code>read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">De plus, nous fournirons une mÃ©thode </font></font><code>getIndexForKey()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisÃ©e dans les situations oÃ¹ nous devons sÃ©lectionner un Ã©lÃ©ment dans une liste ou des cubes dans une main. </font><font style="vertical-align: inherit;">Il reste Ã  hÃ©riter notre implÃ©mentation d'interface de cette classe </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagramme de classe</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/hv/oh/h_/hvohh_s5evuqa4kwwwhtvvfbsmw.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et, en fait, le code: </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleGameInteractor</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConsoleInteractor</span></span></span></span>(), GameInteractor { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { read() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key = read() list .filter(Action::isEnabled) .find { mapper[it.type] == key } ?.let { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it } } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickDiceFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(activePositions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> : Action { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key = read() actions.forEach { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mapper[it.type] == key &amp;&amp; it.isEnabled) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it } <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (key) { <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'1'</span></span>..<span class="hljs-string"><span class="hljs-string">'9'</span></span> -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> index = key - <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activePositions.checkPosition(index)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Action(HAND_POSITION, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = index) } } <span class="hljs-string"><span class="hljs-string">'0'</span></span> -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activePositions.checkPosition(<span class="hljs-number"><span class="hljs-number">9</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Action(HAND_POSITION, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = <span class="hljs-number"><span class="hljs-number">9</span></span>) } } <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'a'</span></span>..<span class="hljs-string"><span class="hljs-string">'f'</span></span> -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyIndex = key - <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activePositions.checkAllyPosition(allyIndex)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Action(HAND_ALLY_POSITION, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = allyIndex) } } } } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mise en Å“uvre de nos mÃ©thodes est assez polie et bien rodÃ©e pour ne pas faire ressortir divers bÃªtises inadÃ©quates. </font><font style="vertical-align: inherit;">Ils vÃ©rifient eux-mÃªmes que l'action sÃ©lectionnÃ©e est active et que la position de la main sÃ©lectionnÃ©e est incluse dans l'ensemble des valides. </font><font style="vertical-align: inherit;">Et je souhaite que nous soyons tous aussi polis envers les gens qui nous entourent.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tape onze. </font><font style="vertical-align: inherit;">Sons et musique</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais comment cela peut-il se passer d'eux? Si vous avez dÃ©jÃ  jouÃ© Ã  des jeux avec le son dÃ©sactivÃ© (par exemple, avec une tablette sous les couvertures alors que personne Ã  la maison ne le voit), vous avez peut-Ãªtre rÃ©alisÃ© combien vous perdez. C'est comme jouer seulement la moitiÃ© du match. De nombreux jeux ne peuvent pas Ãªtre imaginÃ©s sans accompagnement sonore, pour beaucoup c'est une exigence inaliÃ©nable, bien qu'il y ait des situations inverses (par exemple, quand il n'y a pas de sons en principe, ou ils sont si misÃ©rables qu'il serait mieux sans eux). Faire un bon travail n'est en fait pas aussi simple qu'il y paraÃ®t Ã  premiÃ¨re vue (non sans raison que des spÃ©cialistes hautement qualifiÃ©s le font dans les grands studios), mais quoi qu'il en soit, dans la plupart des cas, il est prÃ©fÃ©rable d'avoir un composant audio (au moins certains) dans votre jeu que de ne pas l'avoir du tout. En dernier recours, la qualitÃ© sonore peut Ãªtre amÃ©liorÃ©e ultÃ©rieurement,lorsque le temps et l'humeur le permettent.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En raison des spÃ©cificitÃ©s du genre, notre jeu ne sera pas caractÃ©risÃ© par des effets sonores de chef-d'Å“uvre - si vous avez jouÃ© des adaptations numÃ©riques de jeux de sociÃ©tÃ©, vous comprenez ce que je veux dire. Les sons repoussent leur monotonie, deviennent vite ennuyeux et aprÃ¨s un certain temps, jouer sans eux ne semble plus Ãªtre une perte sÃ©rieuse. Le problÃ¨me est aggravÃ© par le fait qu'il n'existe aucun moyen efficace de faire face Ã  ce phÃ©nomÃ¨ne. Remplacez les sons du jeu par des sons complÃ¨tement diffÃ©rents, et au fil du temps, ils deviendront dÃ©goÃ»tÃ©s. Dans les bons jeux, les sons complÃ¨tent le gameplay, rÃ©vÃ¨lent l'atmosphÃ¨re de l'action en cours, la rendent vivante - c'est difficile Ã  rÃ©aliser si l'atmosphÃ¨re n'est qu'une table avec un tas de sacs poussiÃ©reux, et le gameplay entier consiste Ã  lancer des dÃ©s. NÃ©anmoins, c'est exactement ce que nous allons exprimer: la soie est ici, la distribution est ici,bruissement et bruissement de cris bruyants - comme si nous n'Ã©tions pas en train d'observer une image sur l'Ã©cran, mais que nous interagissions vraiment avec de vrais objets physiques. Ils doivent Ãªtre entiÃ¨rement exprimÃ©s, mais discrÃ¨tement - tout au long du script, vous les entendrez cent fois, de sorte que les sons ne doivent pas venir au premier plan - il suffit d'ombrer doucement le gameplay. Comment y parvenir avec compÃ©tence? Je n'en ai aucune idÃ©e, je ne suis pas spÃ©cial en son. Je ne peux que vous conseiller de jouer Ã  votre jeu autant que possible, en remarquant et en polissant des dÃ©fauts visibles (ce conseil, d'ailleurs, ne s'applique pas uniquement aux sons).Comment y parvenir avec compÃ©tence? Je n'en ai aucune idÃ©e, je ne suis pas spÃ©cial en son. Je ne peux que vous conseiller de jouer Ã  votre jeu autant que possible, en remarquant et en polissant des dÃ©fauts visibles (ce conseil, d'ailleurs, ne s'applique pas uniquement aux sons).Comment y parvenir avec compÃ©tence? Je n'en ai aucune idÃ©e, je ne suis pas spÃ©cial en son. Je ne peux que vous conseiller de jouer Ã  votre jeu autant que possible, en remarquant et en polissant des dÃ©fauts visibles (ce conseil, d'ailleurs, ne s'applique pas uniquement aux sons).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avec la thÃ©orie, semble-t-il, rÃ©glÃ©e, maintenant il est temps de passer Ã  la pratique. Et avant cela, vous devez vous poser une question: oÃ¹, en fait, prendre les fichiers du jeu? Le moyen le plus simple et le plus sÃ»r est de les enregistrer vous-mÃªme en qualitÃ© laide, en utilisant un vieux microphone ou mÃªme en utilisant le tÃ©lÃ©phone. Internet regorge de vidÃ©os sur la faÃ§on dont le dÃ©vissage du sommet de l'ananas ou la rupture de la glace avec une botte peut produire l'effet d'Ã©crasement des os et d'une colonne vertÃ©brale croustillante. Si vous n'Ãªtes pas Ã©tranger Ã  l'esthÃ©tique du surrÃ©alisme, vous pouvez utiliser votre propre voix ou des ustensiles de cuisine comme instrument de musique (il existe des exemples - et mÃªme des succÃ¨s - oÃ¹ cela a Ã©tÃ© fait). Ou vous pouvez aller sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">freesound.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oÃ¹ une centaine d'autres personnes l'ont fait pour vous il y a longtemps. </font><font style="vertical-align: inherit;">Faites attention uniquement Ã  la licence: de nombreux auteurs sont trÃ¨s sensibles aux enregistrements audio de leur forte toux ou piÃ¨ces jetÃ©es sur le sol - vous ne voulez en aucun cas utiliser sans scrupule les fruits de leurs travaux sans payer le crÃ©ateur d'origine ou sans mentionner son pseudonyme crÃ©atif (parfois trÃ¨s bizarre) dans les commentaires. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faites glisser les fichiers que vous aimez et placez-les quelque part dans le chemin de classe. </font><font style="vertical-align: inherit;">Pour les identifier, nous utiliserons l'Ã©numÃ©ration, oÃ¹ chaque instance correspond Ã  un effet sonore.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sound</span></span></span><span class="hljs-class"> </span></span>{ TURN_START, <span class="hljs-comment"><span class="hljs-comment">//Hero starts the turn BATTLE_CHECK_ROLL, //Perform check, type BATTLE_CHECK_SUCCESS, //Check was successful BATTLE_CHECK_FAILURE, //Check failed DIE_DRAW, //Draw die from bag DIE_HIDE, //Remove die to bag DIE_DISCARD, //Remove die to pile DIE_REMOVE, //Remove die entirely DIE_PICK, //Check/uncheck the die TRAVEL, //Move hero to another location ENCOUNTER_STAT, //Hero encounters STAT die ENCOUNTER_DIVINE, //Hero encounters DIVINE die ENCOUNTER_ALLY, //Hero encounters ALLY die ENCOUNTER_WOUND, //Hero encounters WOUND die ENCOUNTER_OBSTACLE, //Hero encounters OBSTACLE die ENCOUNTER_ENEMY, //Hero encounters ENEMY die ENCOUNTER_VILLAIN, //Hero encounters VILLAIN die DEFEAT_OBSTACLE, //Hero defeats OBSTACLE die DEFEAT_ENEMY, //Hero defeats ENEMY die DEFEAT_VILLAIN, //Hero defeats VILLAIN die TAKE_DAMAGE, //Hero takes damage HERO_DEATH, //Hero death CLOSE_LOCATION, //Location closed GAME_VICTORY, //Scenario completed GAME_LOSS, //Scenario failed ERROR, //When something unexpected happens }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tant donnÃ© que la mÃ©thode de reproduction des sons variera en fonction de la plate-forme matÃ©rielle, nous pouvons Ãªtre abstraits d'une implÃ©mentation spÃ©cifique Ã  l'aide de l'interface. </font><font style="vertical-align: inherit;">Par exemple, celui-ci:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoundPlayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme les interfaces prÃ©cÃ©demment discutÃ©es </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, son implÃ©mentation doit Ã©galement Ãªtre passÃ©e Ã  l'entrÃ©e de l'instance de classe </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pour commencer, une implÃ©mentation pourrait ressembler Ã  ceci:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MuteSoundPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SoundPlayer { override fun play</span></span></span></span>(sound: Sound) { <span class="hljs-comment"><span class="hljs-comment">//Do nothing } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par la suite, nous considÃ©rerons des implÃ©mentations plus intÃ©ressantes, mais pour l'instant parlons de musique. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme les effets sonores, il joue un rÃ´le Ã©norme dans la crÃ©ation de l'atmosphÃ¨re du jeu, et de la mÃªme maniÃ¨re, un excellent jeu peut Ãªtre ruinÃ© par une musique inappropriÃ©e. Comme les sons, la musique doit Ãªtre discrÃ¨te, ne pas Ãªtre mise en avant (sauf si elle est nÃ©cessaire pour un effet artistique) et correspondre adÃ©quatement Ã  l'action Ã  l'Ã©cran (n'espÃ©rez pas que quelqu'un soit sÃ©rieusement imprÃ©gnÃ© du sort d'un personnage principal pris en embuscade et impitoyablement tuÃ©) hÃ©ros, si la scÃ¨ne de sa mort tragique sera accompagnÃ©e d'une petite musique amusante d'une chanson pour enfants). Il est trÃ¨s difficile d'y parvenir, des personnes spÃ©cialement formÃ©es s'occupent de ces problÃ¨mes (nous ne les connaissons pas), mais nous, en tant que dÃ©butants du gÃ©nie de la construction de jeux, pouvons Ã©galement faire quelque chose. Par exemple, allez quelque part sur</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">freemusicarchive.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soundcloud.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ou mÃªme YouTube) et trouvez quelque chose Ã  votre goÃ»t. </font><font style="vertical-align: inherit;">Pour les ordinateurs de bureau, l'ambiant est un bon choix - une musique douce et douce sans mÃ©lodie prononcÃ©e, bien adaptÃ©e pour crÃ©er un arriÃ¨re-plan. </font><font style="vertical-align: inherit;">Faites attention Ã  la licence: mÃªme la musique gratuite est parfois Ã©crite par des compositeurs talentueux qui mÃ©ritent, sinon une rÃ©compense monÃ©taire, au moins une reconnaissance universelle. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CrÃ©ons une autre Ã©numÃ©ration:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Music</span></span></span><span class="hljs-class"> </span></span>{ SCENARIO_MUSIC_1, SCENARIO_MUSIC_2, SCENARIO_MUSIC_3, }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> De mÃªme, nous dÃ©finissons l'interface et son implÃ©mentation par dÃ©faut. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MusicPlayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MuteMusicPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MusicPlayer { override fun play</span></span></span></span>(music: Music) { <span class="hljs-comment"><span class="hljs-comment">//Do nothing } override fun stop() { //Do nothing } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veuillez noter que dans ce cas, deux mÃ©thodes sont nÃ©cessaires: l'une pour dÃ©marrer la lecture, l'autre pour l'arrÃªter. </font><font style="vertical-align: inherit;">Il est Ã©galement tout Ã  fait possible que des mÃ©thodes supplÃ©mentaires (pause / reprise, rembobinage, etc.) soient utiles Ã  l'avenir, mais jusqu'Ã  prÃ©sent, ces deux sont suffisantes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passer des rÃ©fÃ©rences aux classes de joueurs entre les objets Ã  chaque fois peut ne pas sembler une solution trÃ¨s pratique. </font><font style="vertical-align: inherit;">Ã€ un moment donnÃ© </font><font style="vertical-align: inherit;">, il faut qu'un seul joueur de ekzepmlyar, donc je me permets de suggÃ©rer de faire tout le nÃ©cessaire pour jouer des </font><font style="vertical-align: inherit;">sons et des </font><font style="vertical-align: inherit;">mÃ©thodes de musique dans un objet distinct et en </font><font style="vertical-align: inherit;">faire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un loner</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (singleton). </font><font style="vertical-align: inherit;">Ainsi, le sous-systÃ¨me audio responsable est toujours disponible de n'importe oÃ¹ dans l'application sans transmettre constamment de liens vers la mÃªme instance. </font><font style="vertical-align: inherit;">Cela ressemblera Ã  ceci:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagramme de classe du systÃ¨me de lecture audio</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ie/jf/86/iejf862lemxbjw9vm5ozkq7ow4k.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La classe </font></font><code>Audio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est notre singleton. </font><font style="vertical-align: inherit;">Il fournit une seule faÃ§ade au sous-systÃ¨me ... Ã  propos, voici la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faÃ§ade</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (faÃ§ade) - un autre modÃ¨le de conception, soigneusement conÃ§u et dÃ©crit Ã  plusieurs reprises (avec des exemples) sur ceux de votre Internet. </font><font style="vertical-align: inherit;">Par consÃ©quent, aprÃ¨s avoir dÃ©jÃ  entendu des cris insatisfaits des rangÃ©es arriÃ¨re, j'arrÃªte d'expliquer les choses connues depuis longtemps et je continue. </font><font style="vertical-align: inherit;">Le code est:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Audio { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> soundPlayer: SoundPlayer = MuteSoundPlayer() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> musicPlayer: MusicPlayer = MuteMusicPlayer() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(soundPlayer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SoundPlayer</span></span></span></span><span class="hljs-function"><span class="hljs-params">, musicPlayer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MusicPlayer</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.soundPlayer = soundPlayer <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.musicPlayer = musicPlayer } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playSound</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.soundPlayer.play(sound) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playMusic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.musicPlayer.play(music) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopMusic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.musicPlayer.stop() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il suffit de l'appeler </font></font><code>init()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une seule fois quelque part au tout dÃ©but (en l'initialisant avec les objets nÃ©cessaires) et d'utiliser Ã  l'avenir des mÃ©thodes pratiques, en oubliant complÃ¨tement les dÃ©tails de l'implÃ©mentation. </font><font style="vertical-align: inherit;">MÃªme si vous ne le faites pas, ne vous inquiÃ©tez pas, le systÃ¨me va mourir - l'objet sera initialisÃ© par les classes par dÃ©faut.</font></font><br><br>  Câ€™est tout.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reste Ã  gÃ©rer la lecture rÃ©elle. En ce qui concerne la lecture de sons (ou, comme disent les gens intelligents, les </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã©chantillons</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), Java a une classe </font></font><code>AudioSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et une interface pratiques </font></font><code>Clip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Tout ce dont nous avons besoin est de dÃ©finir correctement le chemin d'accÃ¨s au fichier audio (qui se trouve dans notre chemin de classe, vous vous souvenez?):</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.sound.sampled.AudioSystem <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasicSoundPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SoundPlayer { private fun pathToFile</span></span></span></span>(sound: Sound) = <span class="hljs-string"><span class="hljs-string">"/sound/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${sound.toString().toLowerCase()}</span></span></span><span class="hljs-string">.wav"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url = javaClass.getResource(pathToFile(sound)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> audioIn = AudioSystem.getAudioInputStream(url) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clip = AudioSystem.getClip() clip.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>(audioIn) clip.start() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mÃ©thode </font></font><code>open()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut le jeter </font></font><code>IOException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(surtout s'il n'aimait pas le format de fichier avec quelque chose - dans ce cas, je recommande d'ouvrir le fichier dans un Ã©diteur audio et de le rÃ©-enregistrer), donc ce serait bien de l'envelopper dans un bloc </font></font><code>try-catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais au dÃ©but, nous ne le ferons pas pour que l'application soit bruyante plantait Ã  chaque fois avec des problÃ¨mes de son. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Je ne sais mÃªme pas quoi dire ..."</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les choses sont bien pires avec la musique. </font><font style="vertical-align: inherit;">Pour autant que je sache, il n'y a pas de mÃ©thode standard pour lire des fichiers musicaux (par exemple, au format mp3) en Java, donc dans tous les cas vous devrez utiliser une bibliothÃ¨que tierce (il y en a des dizaines de diffÃ©rentes). </font><font style="vertical-align: inherit;">Tout poids lÃ©ger avec une fonctionnalitÃ© minimale nous convient, par exemple, le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JLayer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plutÃ´t populaire </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ajoutez-le en fonction:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.googlecode.soundlibs<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jlayer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.1.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et nous implÃ©mentons notre lecteur avec son aide. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasicMusicPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MusicPlayer { private var currentMusic: Music? = null private var thread: PlayerThread? = null private fun pathToFile</span></span></span></span>(music: Music) = <span class="hljs-string"><span class="hljs-string">"/music/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${music.toString().toLowerCase()}</span></span></span><span class="hljs-string">.mp3"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentMusic == music) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } currentMusic = music thread?.finish() Thread.yield() thread = PlayerThread(pathToFile(music)) thread?.start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { currentMusic = <span class="hljs-literal"><span class="hljs-literal">null</span></span> thread?.finish() } <span class="hljs-comment"><span class="hljs-comment">// Thread responsible for playback private inner class PlayerThread(private val musicPath: String) : Thread() { private lateinit var player: Player private var isLoaded = false private var isFinished = false init { isDaemon = true } override fun run() { loop@ while (!isFinished) { try { player = Player(javaClass.getResource(musicPath).openConnection().apply { useCaches = false }.getInputStream()) isLoaded = true player.play() } catch (ex: Exception) { finish() break@loop } player.close() } } fun finish() { isFinished = true this.interrupt() if (isLoaded) { player.close() } } } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, cette bibliothÃ¨que effectue la lecture de maniÃ¨re synchrone, bloquant le flux principal jusqu'Ã  la fin du fichier. Par consÃ©quent, nous devons implÃ©menter un thread sÃ©parÃ© ( </font></font><code>PlayerThread</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), et le rendre Â«facultatifÂ» (dÃ©mon), afin qu'en aucun cas il n'interfÃ¨re avec l'application pour se terminer plus tÃ´t. DeuxiÃ¨mement, l'identifiant du fichier musical en cours de lecture ( </font></font><code>currentMusic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) est </font><font style="vertical-align: inherit;">stockÃ© dans le code du lecteur </font><font style="vertical-align: inherit;">. Si une deuxiÃ¨me commande vient soudainement de la jouer, nous ne commencerons pas la lecture depuis le tout dÃ©but. TroisiÃ¨mement, Ã  la fin du fichier musical, sa lecture recommencera - et ainsi de suite jusqu'Ã  ce que le flux soit explicitement arrÃªtÃ© par la commande</font></font><code>finish()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ou jusqu'Ã  ce que d'autres discussions soient terminÃ©es, comme dÃ©jÃ  mentionnÃ©). </font><font style="vertical-align: inherit;">QuatriÃ¨mement, bien que le code ci-dessus regorge de commandes et d'indicateurs apparemment inutiles, il est soigneusement dÃ©boguÃ© et testÃ© - le lecteur fonctionne comme prÃ©vu, ne ralentit pas le systÃ¨me, n'interrompt pas soudainement Ã  mi-chemin, n'entraÃ®ne pas de fuites de mÃ©moire, ne contient pas d'objets gÃ©nÃ©tiquement modifiÃ©s, brille fraÃ®cheur et puretÃ©. </font><font style="vertical-align: inherit;">Prenez-le et utilisez-le avec audace dans vos projets.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tape douze. </font><font style="vertical-align: inherit;">Localisation</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Notre jeu est presque prÃªt, mais personne ne le jouera. </font></font> Pourquoi? <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Il n'y a pas de russe! .. Il n'y a pas de russe! .. Ajoutez la langue russe! .. DÃ©veloppÃ© par des chiens!" </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez la page de tout jeu d'histoire intÃ©ressant (en particulier mobile) sur le site Web du magasin et lisez les avis. </font><font style="vertical-align: inherit;">Vont-ils commencer Ã  faire l'Ã©loge de superbes graphismes dessinÃ©s Ã  la main? </font><font style="vertical-align: inherit;">Ou admirer le son atmosphÃ©rique? </font><font style="vertical-align: inherit;">Ou discuter d'une histoire passionnante qui crÃ©e une dÃ©pendance dÃ¨s la premiÃ¨re minute et ne lÃ¢che pas jusqu'Ã  la fin?</font></font><br><br>  Non.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les "joueurs" insatisfaits instruiront un tas d'unitÃ©s et supprimeront gÃ©nÃ©ralement le jeu. </font><font style="vertical-align: inherit;">Et puis ils auront Ã©galement besoin d'argent - et tout cela pour une raison simple. </font><font style="vertical-align: inherit;">Oui, vous avez oubliÃ© de traduire votre chef-d'Å“uvre dans les 95 langues du monde. </font><font style="vertical-align: inherit;">Ou plutÃ´t celui dont les porteurs crient le plus fort.</font></font> Et c'est tout!  Tu comprends?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des mois de dur labeur, de longues nuits blanches, des dÃ©pressions nerveuses constantes - tout cela est un hamster sous la queue. Vous avez perdu un grand nombre de joueurs et cela ne peut pas Ãªtre rÃ©solu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alors, pensez-y. DÃ©cidez de votre public cible, sÃ©lectionnez plusieurs langues principales, commandez des services de traduction ... en gÃ©nÃ©ral, faites tout ce que les autres ont dÃ©crit plus d'une fois dans des articles thÃ©matiques (plus intelligent que moi). Nous nous concentrerons sur le cÃ´tÃ© technique du problÃ¨me et discuterons de la faÃ§on de localiser sans douleur notre produit. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D'abord, nous entrons dans les modÃ¨les. Rappelez-vous, avant que les noms et les descriptions ne soient stockÃ©s aussi simplement </font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Maintenant Ã§a ne marchera pas. En plus de la langue par dÃ©faut, vous devez Ã©galement fournir une traduction dans toutes les langues que vous prÃ©voyez de prendre en charge. Par exemple, comme ceci:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestEnemyTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EnemyTemplate { override val name = "Test enemy" override val description = "Some enemy standing in your way." override val nameLocalizations = mapOf</span></span></span></span>( <span class="hljs-string"><span class="hljs-string">"ru"</span></span> to <span class="hljs-string"><span class="hljs-string">" -"</span></span>, <span class="hljs-string"><span class="hljs-string">"ar"</span></span> to <span class="hljs-string"><span class="hljs-string">"Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ø¯Ùˆ"</span></span>, <span class="hljs-string"><span class="hljs-string">"iw"</span></span> to <span class="hljs-string"><span class="hljs-string">"××™×–×” ××•×™×‘"</span></span>, <span class="hljs-string"><span class="hljs-string">"zh"</span></span> to <span class="hljs-string"><span class="hljs-string">"ä¸€äº›æ•µäºº"</span></span>, <span class="hljs-string"><span class="hljs-string">"ua"</span></span> to <span class="hljs-string"><span class="hljs-string">"Ñ– "</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> descriptionLocalizations = mapOf( <span class="hljs-string"><span class="hljs-string">"ru"</span></span> to <span class="hljs-string"><span class="hljs-string">" - ."</span></span>, <span class="hljs-string"><span class="hljs-string">"ar"</span></span> to <span class="hljs-string"><span class="hljs-string">"ÙˆØµÙ Ø§Ù„Ø¹Ø¯Ùˆ"</span></span>, <span class="hljs-string"><span class="hljs-string">"iw"</span></span> to <span class="hljs-string"><span class="hljs-string">"×ª×™××•×¨ ×”××•×™×‘"</span></span>, <span class="hljs-string"><span class="hljs-string">"zh"</span></span> to <span class="hljs-string"><span class="hljs-string">"ä¸€äº›æ•µäººçš„æè¿°"</span></span>, <span class="hljs-string"><span class="hljs-string">"ua"</span></span> to <span class="hljs-string"><span class="hljs-string">" Ñ— Ñ–   ."</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits = listOf&lt;Trait&gt;() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour les modÃ¨les, cette approche est tout Ã  fait appropriÃ©e. </font><font style="vertical-align: inherit;">Si vous ne souhaitez pas spÃ©cifier de traduction pour une langue, vous n'avez pas besoin de le faire - il y a toujours une valeur par dÃ©faut. </font><font style="vertical-align: inherit;">Cependant, dans les objets finaux, je ne voudrais pas Ã©tendre les lignes dans plusieurs champs diffÃ©rents. </font><font style="vertical-align: inherit;">Par consÃ©quent, nous en laisserons un, mais remplacerons son type.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocalizedString</span></span></span></span>(defaultValue: String, localizations: Map&lt;String, String&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: String = defaultValue <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> values: Map&lt;String, String&gt; = localizations.toMap() <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lang: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = values.getOrDefault(lang, <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(other: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> === other -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> other !<span class="hljs-keyword"><span class="hljs-keyword">is</span></span> LocalizedString -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> == other.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.hashCode() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et corrigez le code du gÃ©nÃ©rateur en consÃ©quence. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateEnemy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EnemyTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Enemy().apply { name = LocalizedString(template.name, template.nameLocalizations) description = LocalizedString(template.description, template.descriptionLocalizations) template.traits.forEach { addTrait(it) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Naturellement, la mÃªme approche doit Ãªtre appliquÃ©e aux types de modÃ¨les restants. </font><font style="vertical-align: inherit;">Lorsque les modifications sont prÃªtes, elles peuvent Ãªtre utilisÃ©es sans difficultÃ©.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> language = Locale.getDefault().language <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyName = enemy.name[language]</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans notre exemple, nous avons fourni une version simplifiÃ©e de la localisation, oÃ¹ seule la langue est prise en compte. En gÃ©nÃ©ral, les objets de classe </font></font><code>Locale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dÃ©finissent Ã©galement le pays et la rÃ©gion. Si cela est important dans votre application, alors le vÃ´tre </font></font><code>LocalizedString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera un peu diffÃ©rent, mais nous en sommes satisfaits de toute faÃ§on. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons traitÃ© des modÃ¨les, il reste Ã  localiser les lignes de service utilisÃ©es dans notre application. Heureusement, il </font></font><code>ResourceBundle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient dÃ©jÃ  tous les mÃ©canismes nÃ©cessaires. Il suffit de prÃ©parer des fichiers avec des traductions et de changer la faÃ§on dont ils sont tÃ©lÃ©chargÃ©s.</font></font><br><br><pre> <code class="plaintext hljs"># Game status messages choose_dice_perform_check=    : end_of_turn_discard_extra= :   : end_of_turn_discard_optional= :    : choose_action_before_exploration=,  : choose_action_after_exploration= .   ? encounter_physical=  .   . encounter_somatic=  .   . encounter_mental=  .   . encounter_verbal=  .   . encounter_divine=  .    : die_acquire_success=   ! die_acquire_failure=    . game_loss_out_of_time=    # Die types physical= somatic= mental= verbal= divine= ally= wound= enemy= villain= obstacle= # Hero types and descriptions brawler= hunter= # Various labels avg= bag= bag_size=  class= closed= discard= empty= encountered=  fail= hand= heros_turn= %s max= min= perform_check= : pile= received_new_die=   result= success= sum= time= total= # Action names and descriptions action_confirm_key=ENTER action_confirm_name= action_cancel_key=ESC action_cancel_name= action_explore_location_key=E action_explore_location_name= action_finish_turn_key=F action_finish_turn_name=  action_hide_key=H action_bag_name= action_discard_key=D action_discard_name= action_acquire_key=A action_acquire_name= action_leave_key=L action_leave_name= action_forfeit_key=F action_forfeit_name=</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je ne dirai pas pour mÃ©moire: Ã©crire des phrases en russe est beaucoup plus difficile qu'en anglais. S'il est nÃ©cessaire d'utiliser un nom dans un cas dÃ©finitif ou de se dÃ©sengager du sexe (et ces exigences seront nÃ©cessairement maintenues), vous devrez beaucoup transpirer avant d'obtenir un rÃ©sultat qui, d'une part, rÃ©pond aux exigences, et d'autre part, ne ressemble pas Ã  une traduction mÃ©canique faite par un cyborg avec des cerveaux de poulet. Notez Ã©galement que nous ne modifions pas les touches d'action - comme auparavant, les mÃªmes caractÃ¨res seront utilisÃ©s pour exÃ©cuter cette derniÃ¨re que dans la langue anglaise (qui, en passant, ne fonctionnera pas dans une disposition de clavier autre que la latine, mais ce n'est pas notre affaire - pour l'instant laissons tel quel).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertiesStringLoader</span></span></span></span>(locale: Locale) : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> properties = ResourceBundle.getBundle(<span class="hljs-string"><span class="hljs-string">"text.strings"</span></span>, locale) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = properties.getString(key) ?: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre>  . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme dÃ©jÃ  mentionnÃ©, </font></font><code>ResourceBundle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il se chargera lui-mÃªme de trouver parmi les fichiers de localisation celui qui correspond le mieux aux paramÃ¨tres rÃ©gionaux actuels. </font><font style="vertical-align: inherit;">Et s'il ne le trouve pas, il prendra le fichier par dÃ©faut ( </font></font><code>string.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Et tout ira bien ...</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouais! </font><font style="vertical-align: inherit;">Ã‡a y Ã©tait!</font></font></b> <div class="spoiler_text"> ,  Unicode   <code>.properties</code>     Java 9.       ISO-8859-1 â€” <code>ResourceBundle</code>     .  ,     ,           â€”     .       Unicode- â€” ,  ,   : <code>'\uXXXX'</code> .    ,      ,   Java       <b>native2ascii</b> ,        .         : <br><br><pre> <code class="plaintext hljs"># Game status messages choose_dice_perform_check=\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0443\u0431\u0438\u043a\u0438 \u0434\u043b\u044f \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438: end_of_turn_discard_extra=\u041a\u041e\u041d\u0415\u0426 \u0425\u041e\u0414\u0410: \u0421\u0431\u0440\u043e\u0441\u044c\u0442\u0435 \u043b\u0438\u0448\u043d\u0438\u0435 \u043a\u0443\u0431\u0438\u043a\u0438: end_of_turn_discard_optional=\u041a\u041e\u041d\u0415\u0426 \u0425\u041e\u0414\u0410: \u0421\u0431\u0440\u043e\u0441\u044c\u0442\u0435 \u043a\u0443\u0431\u0438\u043a\u0438 \u043f\u043e \u0436\u0435\u043b\u0430\u043d\u0438\u044e: choose_action_before_exploration=\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435, \u0447\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c: choose_action_after_exploration=\u0418\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u043e. \u0427\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c \u0434\u0430\u043b\u044c\u0448\u0435? encounter_physical=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0424\u0418\u0417\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_somatic=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0421\u041e\u041c\u0410\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_mental=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u041c\u0415\u041d\u0422\u0410\u041b\u042c\u041d\u042b\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_verbal=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0412\u0415\u0420\u0411\u0410\u041b\u042c\u041d\u042b\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_divine=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0411\u041e\u0416\u0415\u0421\u0422\u0412\u0415\u041d\u041d\u042b\u0419 \u043a\u0443\u0431\u0438\u043a. \u041c\u043e\u0436\u043d\u043e \u0432\u0437\u044f\u0442\u044c \u0431\u0435\u0437 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438: die_acquire_success=\u0412\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u0438 \u043d\u043e\u0432\u044b\u0439 \u043a\u0443\u0431\u0438\u043a! die_acquire_failure=\u0412\u0430\u043c \u043d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u0443\u0431\u0438\u043a. game_loss_out_of_time=\u0423 \u0432\u0430\u0441 \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u043e\u0441\u044c \u0432\u0440\u0435\u043c\u044f</code> </pre><br>           .     â€”  .    â€”  .  ,  IDE    ( )  Â« Â»,       â€”            -  (  ),    IDE,    . <br><br>  ,  .  <code>getBundle()</code> ,    ,   ,      <code>ResourceBundle.Control</code> â€” -         . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertiesStringLoader</span></span></span></span>(locale: Locale) : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> properties = ResourceBundle.getBundle( <span class="hljs-string"><span class="hljs-string">"text.strings"</span></span>, locale, Utf8ResourceBundleControl()) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = properties.getString(key) ?: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br> , ,  : <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Utf8ResourceBundleControl</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ResourceBundle.Control</span></span></span></span>() { <span class="hljs-meta"><span class="hljs-meta">@Throws(IllegalAccessException::class, InstantiationException::class, IOException::class)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newBundle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(baseName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, locale: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Locale</span></span></span></span><span class="hljs-function"><span class="hljs-params">, format: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, loader: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ClassLoader</span></span></span></span><span class="hljs-function"><span class="hljs-params">, reload: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ResourceBundle? { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bundleName = toBundleName(baseName, locale) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (format) { <span class="hljs-string"><span class="hljs-string">"java.class"</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.newBundle(baseName, locale, format, loader, reload) <span class="hljs-string"><span class="hljs-string">"java.properties"</span></span> -&gt; with((<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"://"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bundleName) <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> toResourceName(bundleName, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>)) ?: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { reload -&gt; reload(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, loader) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; loader.getResourceAsStream(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }?.let { stream -&gt; InputStreamReader(stream, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>).use { r -&gt; PropertyResourceBundle(r) } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Unknown format: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$format</span></span></span><span class="hljs-string">"</span></span>) } } <span class="hljs-meta"><span class="hljs-meta">@Throws(IOException::class)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resourceName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, classLoader: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ClassLoader</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: InputStream { classLoader.getResource(resourceName)?.let { url -&gt; url.openConnection().let { connection -&gt; connection.useCaches = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> connection.getInputStream() } } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"Unable to load data!"</span></span>) } }</code> </pre><br>    ,   â€¦ ,  ( ) â€”   (  Kotlin    ).    â€” ,       <code>.properties</code>   UTF-8  - . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour tester le fonctionnement de l'application dans diffÃ©rentes langues, il n'est pas nÃ©cessaire de modifier les paramÃ¨tres du systÃ¨me d'exploitation - il suffit de spÃ©cifier la langue requise lors du dÃ©marrage du JRE: </font></font><br><br><pre> <code class="dos hljs">java -Duser.language=ru -jar path_to_project\Dice\target\dice-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar</code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous travaillez toujours sur Windows, attendez-vous Ã  des problÃ¨mes</font></font></b> <div class="spoiler_text">  ,   Windows (cmd.exe)     437 (   DOSLatinUS),     â€”      .  , UTF-8 ,        : <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">chcp</span></span> <span class="hljs-number"><span class="hljs-number">65001</span></span></code> </pre> <br>    Java  ,    ,       .     : <br><br><pre> <code class="dos hljs">java -Dfile.encoding=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> -Duser.language=ru -jar path_to_project\Dice\target\dice-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar</code> </pre><br>   ,      ,  Unicode- (, Lucida Console) <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AprÃ¨s toutes nos aventures passionnantes, le rÃ©sultat peut Ãªtre fiÃ¨rement dÃ©montrÃ© au grand public et dÃ©clarÃ© haut et fort: "Nous ne sommes pas des chiens!" </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option fidÃ¨le raciale</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ap/92/qd/ap92qdlfulptfgjg_-ms3ejqddm.png"></a> <br></div></div><br>  Et c'est bien. <br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tape treize </font><font style="vertical-align: inherit;">Tout mettre ensemble</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les lecteurs attentifs ont dÃ» remarquer que je n'ai mentionnÃ© les noms de packages spÃ©cifiques qu'une seule fois et ne leur suis jamais revenu. PremiÃ¨rement, chaque dÃ©veloppeur a ses propres considÃ©rations concernant la classe qui doit se trouver dans quel package. DeuxiÃ¨mement, au fur et Ã  mesure que vous travaillez sur le projet, avec l'ajout de plus en plus de nouvelles classes, vos pensÃ©es vont changer. TroisiÃ¨mement, changer la structure de l'application est simple et bon marchÃ© (et les systÃ¨mes de contrÃ´le de version modernes dÃ©tecteront la migration, vous ne perdrez donc pas l'historique), alors n'hÃ©sitez pas Ã  changer les noms des classes, des packages, des mÃ©thodes et des variables - n'oubliez pas de ne mettre Ã  jour que la documentation (vous la gardez non?). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et il ne nous reste plus qu'Ã  monter et lancer notre projet. Comme vous vous en souvenez, </font></font><code>main()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous avons dÃ©jÃ  crÃ©Ã© une </font><font style="vertical-align: inherit;">mÃ©thode </font><font style="vertical-align: inherit;">, nous allons maintenant la remplir de contenu.</font></font> Nous aurons besoin de: <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> scÃ©nario et terrain; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les hÃ©ros </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mise en Å“uvre de l'interface </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mise en place d'interfaces </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>StringLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mise en place d'interfaces </font></font><code>SoundPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>MusicPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objet de classe </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une bouteille de champagne. </font></font></li></ul><br>  C'est parti! <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { Audio.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(BasicSoundPlayer(), BasicMusicPlayer()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> loader = PropertiesStringLoader(Locale.getDefault()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer = ConsoleGameRenderer(loader) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor = ConsoleGameInteractor() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> template = TestScenarioTemplate() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scenario = generateScenario(template, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locations = generateLocations(template, <span class="hljs-number"><span class="hljs-number">1</span></span>, heroes.size) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroes = listOf( generateHero(Hero.Type.BRAWLER, <span class="hljs-string"><span class="hljs-string">"Brawler"</span></span>), generateHero(Hero.Type.HUNTER, <span class="hljs-string"><span class="hljs-string">"Hunter"</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> game = Game(renderer, interactor, scenario, locations, heroes) game.start() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous lanÃ§ons et apprÃ©cions le premier prototype fonctionnel. </font><font style="vertical-align: inherit;">VoilÃ .</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tape quatorze. </font><font style="vertical-align: inherit;">Ã‰quilibre du jeu</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ummm ... </font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tape quinze. </font><font style="vertical-align: inherit;">Les tests</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant que la majeure partie du code du premier prototype fonctionnel a Ã©tÃ© Ã©crite, il serait bien d'ajouter quelques tests unitaires ... </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Comment? </font><font style="vertical-align: inherit;">Tout Ã  l'heure? </font><font style="vertical-align: inherit;">Oui, les tests devaient Ãªtre Ã©crits au tout dÃ©but, puis coder! Â» </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De nombreux lecteurs remarquent Ã  juste titre que l'Ã©criture de tests unitaires devrait prÃ©cÃ©der le dÃ©veloppement du code de travail ( </font></font><abbr title="DÃ©veloppement pilotÃ© par les tests"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDD</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et autres mÃ©thodologies Ã  la mode). D'autres seront indignÃ©s: il n'y a rien pour que les gens trompent leur cerveau avec leurs tests, mÃªme si au moins ils commencent Ã  dÃ©velopper quelque chose, sinon toute motivation sera perdue. Un autre couple de personnes sortira de l'espace dans la plinthe et dira timidement: "Je ne comprends pas pourquoi ces tests sont nÃ©cessaires - tout fonctionne pour moi" ... Ensuite, ils seront poussÃ©s au visage avec une botte et rapidement repoussÃ©s. Je ne commencerai pas Ã  initier des confrontations idÃ©ologiques (ils en sont dÃ©jÃ  pleins sur Internet), et donc je suis partiellement d'accord avec tout le monde. Oui, les tests sont parfois utiles (en particulier dans le code qui change souvent ou est associÃ© Ã  des calculs complexes), oui, les tests unitaires ne conviennent pas Ã  tous les codes (par exemple, ils ne couvrent pas les interactions avec l'utilisateur ou les systÃ¨mes externes), oui, il y a plus que des tests unitaires de nombreux autres types (enfin, au moins cinq ont Ã©tÃ© nommÃ©s),et oui, nous ne nous concentrerons pas sur l'Ã©criture de tests - notre article porte sur autre chose.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disons simplement que de nombreux programmeurs (en particulier les dÃ©butants) nÃ©gligent les tests. </font><font style="vertical-align: inherit;">Beaucoup se justifient en disant que la fonctionnalitÃ© de leurs applications est mal couverte par les tests. </font><font style="vertical-align: inherit;">Par exemple, il est beaucoup plus facile de lancer l'application et de voir si tout est en ordre avec l'apparence et l'interaction, plutÃ´t que de clÃ´turer des constructions complexes avec la participation de cadres spÃ©cialisÃ©s pour tester l'interface utilisateur (et il y en a). </font><font style="vertical-align: inherit;">Et je vais vous dire quand j'implÃ©mentais les interfaces </font></font><code>Renderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- c'est ce que j'ai fait. </font><font style="vertical-align: inherit;">Cependant, il existe des mÃ©thodes parmi notre code pour lesquelles le concept de test unitaire est gÃ©nial.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, les gÃ©nÃ©rateurs. </font><font style="vertical-align: inherit;">Et c'est tout. </font><font style="vertical-align: inherit;">C'est une boÃ®te noire idÃ©ale: des modÃ¨les sont envoyÃ©s en entrÃ©e, des objets du monde du jeu sont obtenus en sortie. </font><font style="vertical-align: inherit;">Il se passe quelque chose Ã  l'intÃ©rieur, mais nous devons le tester. </font><font style="vertical-align: inherit;">Par exemple, comme ceci:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DieGeneratorTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetMaxLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertEquals(<span class="hljs-string"><span class="hljs-string">"Max level should be 3"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, DieGeneratorKt.getMaxLevel()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDieGenerationSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ DieTypeFilter filter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.ALLY); List&lt;? extends List&lt;Integer&gt;&gt; allowedSizes = Arrays.asList( <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, Arrays.asList(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>), Arrays.asList(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), Arrays.asList(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>) ); IntStream.rangeClosed(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>).forEach(level -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = DieGeneratorKt.generateDie(filter, level).getSize(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect level of die generated: "</span></span> + size, allowedSizes.get(level).contains(size)); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die size: "</span></span> + size, size &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span>); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die size: "</span></span> + size, size &lt;= <span class="hljs-number"><span class="hljs-number">12</span></span>); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die size: "</span></span> + size, size % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>); } }); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDieGenerationType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Die.Type&gt; allowedTypes1 = Arrays.asList(Die.Type.PHYSICAL); List&lt;Die.Type&gt; allowedTypes2 = Arrays.asList(Die.Type.PHYSICAL, Die.Type.SOMATIC, Die.Type.MENTAL, Die.Type.VERBAL); List&lt;Die.Type&gt; allowedTypes3 = Arrays.asList(Die.Type.ALLY, Die.Type.VILLAIN, Die.Type.ENEMY); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { Die.Type type1 = DieGeneratorKt.generateDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.PHYSICAL), <span class="hljs-number"><span class="hljs-number">1</span></span>).getType(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die type: "</span></span> + type1, allowedTypes1.contains(type1)); Die.Type type2 = DieGeneratorKt.generateDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatsDieTypeFilter(), <span class="hljs-number"><span class="hljs-number">1</span></span>).getType(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die type: "</span></span> + type2, allowedTypes2.contains(type2)); Die.Type type3 = DieGeneratorKt.generateDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MultipleDieTypeFilter(Die.Type.ALLY, Die.Type.VILLAIN, Die.Type.ENEMY), <span class="hljs-number"><span class="hljs-number">1</span></span>).getType(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die type: "</span></span> + type3, allowedTypes3.contains(type3)); } } }</code> </pre><br>  Ou alors: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BagGeneratorTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGenerateBag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ BagTemplate template1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BagTemplate(); template1.addPlan(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.PHYSICAL)); template1.addPlan(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.SOMATIC)); template1.setFixedDieCount(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); BagTemplate template2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BagTemplate(); template2.addPlan(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.DIVINE)); template2.setFixedDieCount(<span class="hljs-number"><span class="hljs-number">5</span></span>); BagTemplate template3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BagTemplate(); template3.addPlan(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.ALLY)); template3.setFixedDieCount(<span class="hljs-number"><span class="hljs-number">50</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { Bag bag1 = BagGeneratorKt.generateBag(template1, <span class="hljs-number"><span class="hljs-number">1</span></span>); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect bag size: "</span></span> + bag1.getSize(), bag1.getSize() &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> &amp;&amp; bag1.getSize() &lt;= <span class="hljs-number"><span class="hljs-number">15</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect number of SOMATIC dice"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, bag1.examine().stream().filter(d -&gt; d.getType() == Die.Type.SOMATIC).count()); Bag bag2 = BagGeneratorKt.generateBag(template2, <span class="hljs-number"><span class="hljs-number">1</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect bag size"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, bag2.getSize()); Bag bag3 = BagGeneratorKt.generateBag(template3, <span class="hljs-number"><span class="hljs-number">1</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect bag size"</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, bag3.getSize()); List&lt;Die.Type&gt; dieTypes3 = bag3.examine().stream().map(Die::getType).distinct().collect(Collectors.toList()); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect die types"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, dieTypes3.size()); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect die types"</span></span>, Die.Type.ALLY, dieTypes3.get(<span class="hljs-number"><span class="hljs-number">0</span></span>)); } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ou mÃªme comme Ã§a: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocationGeneratorTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testLocationGeneration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, LocationTemplate template)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"Template: "</span></span> + template.getName()); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect template type"</span></span>, name, template.getName()); IntStream.rangeClosed(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>).forEach(level -&gt; { Location location = LocationGeneratorKt.generateLocation(template, level); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect location type"</span></span>, name, location.getName().get(<span class="hljs-string"><span class="hljs-string">""</span></span>)); assertTrue(<span class="hljs-string"><span class="hljs-string">"Location not open by default"</span></span>, location.isOpen()); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> closingDifficulty = location.getClosingDifficulty(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Closing difficulty too small"</span></span>, closingDifficulty &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect closing difficulty"</span></span>, closingDifficulty, template.getBasicClosingDifficulty() + level * <span class="hljs-number"><span class="hljs-number">2</span></span>); Bag bag = location.getBag(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"Bag is null"</span></span>, bag); assertTrue(<span class="hljs-string"><span class="hljs-string">"Bag is empty"</span></span>, location.getBag().getSize() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); Deck&lt;Enemy&gt; enemies = location.getEnemies(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"Enemies are null"</span></span>, enemies); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect enemy threat count"</span></span>, enemies.getSize(), template.getEnemyCardsCount()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bag.drawOfType(Die.Type.ENEMY) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { assertTrue(<span class="hljs-string"><span class="hljs-string">"Enemy cards not specified"</span></span>, enemies.getSize() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); } Deck&lt;Obstacle&gt; obstacles = location.getObstacles(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"Obstacles are null"</span></span>, obstacles); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect obstacle threat count"</span></span>, obstacles.getSize(), template.getObstacleCardsCount()); List&lt;SpecialRule&gt; specialRules = location.getSpecialRules(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"SpecialRules are null"</span></span>, specialRules); }); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGenerateLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ testLocationGeneration(<span class="hljs-string"><span class="hljs-string">"Test Location"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestLocationTemplate()); testLocationGeneration(<span class="hljs-string"><span class="hljs-string">"Test Location 2"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestLocationTemplate2()); } }</code> </pre><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ArrÃªte, arrÃªte, arrÃªte!" </font><font style="vertical-align: inherit;">Qu'est-ce que c'est? </font><font style="vertical-align: inherit;">Java ??? " </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tu l'as. </font><font style="vertical-align: inherit;">De plus, il est bon d'Ã©crire de tels tests au dÃ©but, avant de commencer Ã  implÃ©menter le gÃ©nÃ©rateur lui-mÃªme. </font><font style="vertical-align: inherit;">Bien sÃ»r, le code sous test est assez simple et trÃ¨s probablement la mÃ©thode fonctionnera la premiÃ¨re fois et sans aucun test, mais Ã©crire un test une fois que vous </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'oublierez pour toujours</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous protÃ©gera de tout problÃ¨me possible Ã  l'avenir (dont la solution prend beaucoup de temps, surtout quand Ã  partir du moment du dÃ©veloppement cinq ans se sont Ã©coulÃ©s et vous avez dÃ©jÃ  oubliÃ© comment tout fonctionne Ã  l'intÃ©rieur de la mÃ©thode). </font><font style="vertical-align: inherit;">Et si un jour votre projet cesse de collecter en raison d'Ã©checs de tests, vous en connaÃ®trez certainement la raison: les exigences du systÃ¨me ont changÃ© et vos anciens tests ne les satisfont plus (Ã  quoi avez-vous pensÃ©?). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et encore une chose. </font><font style="vertical-align: inherit;">N'oubliez pas la classe</font></font><code>HandMaskRule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ses hÃ©ritiers? Imaginez maintenant qu'Ã  un moment donnÃ© pour utiliser la compÃ©tence, le hÃ©ros doit prendre trois dÃ©s de sa main, et les types de ces dÃ©s sont occupÃ©s par des restrictions sÃ©vÃ¨res (par exemple, "le premier dÃ© doit Ãªtre bleu, vert ou blanc, le second - jaune, blanc ou bleu, et le troisiÃ¨me - bleu ou violet "- ressentez-vous la difficultÃ©?). Comment aborder l'implÃ©mentation de classe? Eh bien ... pour commencer, vous pouvez dÃ©cider des paramÃ¨tres d'entrÃ©e et de sortie. De toute Ã©vidence, vous devez que la classe accepte trois tableaux (ou ensembles), chacun contenant des types valides pour, respectivement, les premier, deuxiÃ¨me et troisiÃ¨me cubes. Et puis quoi? Busting? Des rÃ©cursions? Et si je manque quelque chose? Faites une entrÃ©e profonde. Reportez maintenant l'implÃ©mentation des mÃ©thodes de classe et Ã©crivez un test - car les exigences sont simples, comprÃ©hensibles et bien formalisables.Et mieux Ã©crire quelques tests ... Mais nous en considÃ©rerons un, ici par exemple:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TripleDieHandMaskRuleTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Hand hand; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ hand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hand(<span class="hljs-number"><span class="hljs-number">10</span></span>); hand.addDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Die(Die.Type.PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//0 hand.addDie(new Die(Die.Type.PHYSICAL, 4)); //1 hand.addDie(new Die(Die.Type.SOMATIC, 4)); //2 hand.addDie(new Die(Die.Type.SOMATIC, 4)); //3 hand.addDie(new Die(Die.Type.MENTAL, 4)); //4 hand.addDie(new Die(Die.Type.MENTAL, 4)); //5 hand.addDie(new Die(Die.Type.VERBAL, 4)); //6 hand.addDie(new Die(Die.Type.VERBAL, 4)); //7 hand.addDie(new Die(Die.Type.DIVINE, 4)); //8 hand.addDie(new Die(Die.Type.DIVINE, 4)); //9 hand.addDie(new Die(Die.Type.ALLY, 4)); //A (0) hand.addDie(new Die(Die.Type.ALLY, 4)); //B (1) } @Test public void testRule1() { HandMaskRule rule = new TripleDieHandMaskRule( hand, new Die.Type[]{Die.Type.PHYSICAL, Die.Type.SOMATIC}, new Die.Type[]{Die.Type.MENTAL, Die.Type.VERBAL}, new Die.Type[]{Die.Type.PHYSICAL, Die.Type.ALLY} ); HandMask mask = new HandMask(); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertTrue("Should be on", rule.isPositionActive(mask, 5)); assertTrue("Should be on", rule.isPositionActive(mask, 6)); assertTrue("Should be on", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met yet", rule.checkMask(mask)); mask.addPosition(0); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertTrue("Should be on", rule.isPositionActive(mask, 5)); assertTrue("Should be on", rule.isPositionActive(mask, 6)); assertTrue("Should be on", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met yet", rule.checkMask(mask)); mask.addPosition(4); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertFalse("Should be off", rule.isPositionActive(mask, 5)); assertFalse("Should be off", rule.isPositionActive(mask, 6)); assertFalse("Should be off", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met yet", rule.checkMask(mask)); mask.addAllyPosition(0); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertFalse("Ally should be off", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertFalse("Should be off", rule.isPositionActive(mask, 1)); assertFalse("Should be off", rule.isPositionActive(mask, 2)); assertFalse("Should be off", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertFalse("Should be off", rule.isPositionActive(mask, 5)); assertFalse("Should be off", rule.isPositionActive(mask, 6)); assertFalse("Should be off", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertTrue("Rule should be met", rule.checkMask(mask)); mask.removePosition(0); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertFalse("Ally should be off", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertFalse("Should be off", rule.isPositionActive(mask, 5)); assertFalse("Should be off", rule.isPositionActive(mask, 6)); assertFalse("Should be off", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met again", rule.checkMask(mask)); } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est fatigant, mais pas autant qu'il n'y paraÃ®t, jusqu'Ã  ce que vous commenciez (Ã  un moment donnÃ©, cela devient mÃªme amusant). Mais aprÃ¨s avoir passÃ© un tel test (et quelques autres, pour diffÃ©rentes occasions), vous vous sentirez soudainement calme et sÃ»r de vous. Maintenant, aucune petite faute de frappe ne gÃ¢chera votre mÃ©thode et ne vous conduira Ã  de mauvaises surprises qui seront beaucoup plus difficiles Ã  tester manuellement. Petit Ã  petit, lentement, nous commenÃ§ons Ã  mettre en Å“uvre les mÃ©thodes nÃ©cessaires de la classe. Et Ã  la fin, nous exÃ©cutons le test pour nous assurer que quelque part nous avons fait une erreur. Trouvez le problÃ¨me et rÃ©Ã©crivez. RÃ©pÃ©tez jusqu'Ã  ce que cela soit fait.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TripleDieHandMaskRule</span></span></span></span>( hand: Hand, types1: Array&lt;Die.Type&gt;, types2: Array&lt;Die.Type&gt;, types3: Array&lt;Die.Type&gt;) : HandMaskRule(hand) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types1 = types1.toSet() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types2 = types2.toSet() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types3 = types3.toSet() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mask.positionCount + mask.allyPositionCount != <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getCheckedDice(mask).asSequence() .filter { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 } .any { d1 -&gt; getCheckedDice(mask) .filter { d2 -&gt; d2 !== d1 } .filter { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 } .any { d2 -&gt; getCheckedDice(mask) .filter { d3 -&gt; d3 !== d1 } .filter { d3 -&gt; d3 !== d2 } .any { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 } } } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mask.checkPosition(position)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> die = hand.dieAt(position) ?: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (mask.positionCount + mask.allyPositionCount) { <span class="hljs-number"><span class="hljs-number">0</span></span> -&gt; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; with(getCheckedDice(mask).first()) { (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; (die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; (die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; (die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2)) } <span class="hljs-number"><span class="hljs-number">2</span></span>-&gt; with(getCheckedDice(mask)) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>] (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) } <span class="hljs-number"><span class="hljs-number">3</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mask.checkAllyPosition(position)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hand.allyDieAt(position) == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (mask.positionCount + mask.allyPositionCount) { <span class="hljs-number"><span class="hljs-number">0</span></span> -&gt; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; with(getCheckedDice(mask).first()) { (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; (ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; (ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; (ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2)) } <span class="hljs-number"><span class="hljs-number">2</span></span>-&gt; with(getCheckedDice(mask)) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>] (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) } <span class="hljs-number"><span class="hljs-number">3</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez des idÃ©es sur la faÃ§on de mettre en Å“uvre une telle fonctionnalitÃ© plus facilement, vous Ãªtes invitÃ©s Ã  commenter. </font><font style="vertical-align: inherit;">Et je suis incroyablement heureux d'avoir Ã©tÃ© assez intelligent pour commencer Ã  implÃ©menter cette classe en Ã©crivant un test. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â«Et je &lt;...&gt; suis aussi &lt;...&gt; trÃ¨s &lt;...&gt; content &lt;...&gt;. </font><font style="vertical-align: inherit;">Montez! </font><font style="vertical-align: inherit;">&lt;...&gt; de retour! </font><font style="vertical-align: inherit;">&lt;...&gt; dans l'Ã©cart! "</font></font></i> <br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tape seize. </font><font style="vertical-align: inherit;">ModularitÃ©</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme prÃ©vu, les enfants arrivÃ©s Ã  maturitÃ© ne peuvent pas Ãªtre Ã  l'abri de leurs parents toute leur vie - tÃ´t ou tard, ils doivent choisir leur propre chemin et le suivre avec audace, surmontant les difficultÃ©s et les perturbations. </font><font style="vertical-align: inherit;">Les composants que nous avons dÃ©veloppÃ©s ont tellement mÃ»ri qu'ils sont devenus Ã©troits sous un mÃªme toit. </font><font style="vertical-align: inherit;">Le moment est venu de les diviser en plusieurs parties. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous sommes confrontÃ©s Ã  une tÃ¢che plutÃ´t banale. </font><font style="vertical-align: inherit;">Il est nÃ©cessaire de diviser toutes les classes crÃ©Ã©es jusqu'Ã  prÃ©sent en trois groupes:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionnalitÃ©s de base: module, moteur de jeu, interfaces de connecteur et implÃ©mentations indÃ©pendantes de la plate-forme ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cÅ“ur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modÃ¨les de scÃ©narios, de terrain, d'ennemis et d'obstacles - composants de la soi-disant Â«aventureÂ» ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aventure</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implÃ©mentations spÃ©cifiques d'interfaces spÃ©cifiques Ã  une plateforme particuliÃ¨re: dans notre cas, une application console ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cli</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le rÃ©sultat de cette sÃ©paration ressemblera finalement au schÃ©ma suivant: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme les acteurs Ã  la fin du spectacle, les hÃ©ros de notre aujourd'hui rÃ©intÃ¨grent la scÃ¨ne en force</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ci/t5/gm/cit5gmpnmhdsrzoprl0fagpzpw8.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CrÃ©ez des projets supplÃ©mentaires et transfÃ©rez la classe correspondante. </font><font style="vertical-align: inherit;">Et nous avons juste besoin de configurer correctement l'interaction des projets entre eux. </font><font style="vertical-align: inherit;">Projet de </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ce projet est un pur moteur. </font><font style="vertical-align: inherit;">Toutes les classes spÃ©cifiques ont Ã©tÃ© transfÃ©rÃ©es vers d'autres projets - seule la fonctionnalitÃ© de base, le noyau, est restÃ©e. </font><font style="vertical-align: inherit;">BibliothÃ¨que si vous voulez. </font><font style="vertical-align: inherit;">Il n'y a plus de classe de lancement, il n'est mÃªme plus nÃ©cessaire de construire un package. </font><font style="vertical-align: inherit;">Les assemblys de ce projet seront hÃ©bergÃ©s dans le rÃ©fÃ©rentiel Maven local (plus Ã  ce sujet plus tard) et utilisÃ©s par d'autres projets comme dÃ©pendances. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fichier </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est le suivant:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-stdlib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>junit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>junit-dep<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>4.8.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- other Kotlin setup --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span>UTF-8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3.20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A partir de maintenant, nous le collecterons comme ceci: </font></font><br><br><pre> <code class="bash hljs">mvn -f <span class="hljs-string"><span class="hljs-string">"path_to_project/DiceCore/pom.xml"</span></span> install</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projet Cli</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voici le point d'entrÃ©e de l'application - c'est avec ce projet que l'utilisateur final va interagir. </font><font style="vertical-align: inherit;">Le noyau est utilisÃ© comme dÃ©pendance. </font><font style="vertical-align: inherit;">Ã‰tant donnÃ© que dans notre exemple, nous travaillons avec la console, le projet contiendra les classes nÃ©cessaires pour travailler avec elle (si nous voulons soudainement dÃ©marrer le jeu sur une cafetiÃ¨re, nous remplaÃ§ons simplement ce projet par un similaire avec les implÃ©mentations correspondantes). </font><font style="vertical-align: inherit;">Nous ajouterons immÃ©diatement des ressources (lignes, fichiers audio, etc.). </font><font style="vertical-align: inherit;">Les dÃ©pendances sur les bibliothÃ¨ques externes seront transfÃ©rÃ©es dans le </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice-cli<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-stdlib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.fusesource.jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.17.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.14.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.googlecode.soundlibs<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jlayer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.1.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- other Kotlin setup --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-assembly-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>package<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>single<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span>jar-with-dependencies<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span>my.company.dice.MainKt<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span>UTF-8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3.20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons dÃ©jÃ  vu le script pour construire et exÃ©cuter ce projet - nous ne commencerons pas Ã  le rÃ©pÃ©ter. </font></font><br><br>  <b>Aventure</b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, dans un projet sÃ©parÃ©, nous sortons l'intrigue. Autrement dit, tous les scÃ©narios, le terrain, les ennemis et autres objets uniques du monde du jeu que le personnel du dÃ©partement de scÃ©nario de votre entreprise peut imaginer (enfin, ou jusqu'Ã  prÃ©sent, seulement notre imagination malade - nous sommes toujours le seul concepteur de jeux dans la rÃ©gion). L'idÃ©e est de regrouper les scripts en ensembles (aventures) et de distribuer chacun de ces ensembles en tant que projet distinct (similaire Ã  la faÃ§on dont cela se fait dans le monde des jeux de sociÃ©tÃ© et des jeux vidÃ©o). Autrement dit, collectez les archives du pot et placez-les dans un dossier sÃ©parÃ© afin que le moteur de jeu analyse ce dossier et connecte automatiquement toutes les aventures qu'il contient. Cependant, la mise en Å“uvre technique de cette approche se heurte Ã  d'Ã©normes difficultÃ©s.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par oÃ¹ commencer? Eh bien, tout d'abord, du fait que nous distribuons des modÃ¨les sous la forme de classes java spÃ©cifiques (oui, battez-moi et grondez-moi - je l'avais prÃ©vu). Et si c'est le cas, ces classes doivent se trouver dans le chemin d'accÃ¨s aux classes de l'application au dÃ©marrage. L'application de cette exigence n'est pas difficile - vous enregistrez explicitement vos fichiers jar dans la variable d'environnement appropriÃ©e (Ã  partir de Java 6, vous pouvez mÃªme utiliser * - des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caractÃ¨res gÃ©nÃ©riques</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><pre> <code class="bash hljs">java -classpath <span class="hljs-string"><span class="hljs-string">"path_to_project/DiceCli/target/adventures/*"</span></span> -jar path_to_project/DiceCli/target/dice-1.0-jar-with-dependencies.jar</code> </pre><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â«Un idiot, ou quoi? Lorsque vous utilisez le commutateur -jar, le commutateur -classpath est ignorÃ©! Â»</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cependant, cela ne fonctionnera pas. Le chemin de classe pour les archives jar exÃ©cutables doit Ãªtre explicitement Ã©crit dans le fichier interne </font></font><code>META-INF/MANIFEST.MF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(la section est appelÃ©e - </font></font><code>Claspath:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). C'est bon, il y a mÃªme des plugins spÃ©ciaux pour cela ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maven-compiler-plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou, au pire, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maven-assembly-plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Mais les caractÃ¨res gÃ©nÃ©riques dans le manifeste, hÃ©las, ne fonctionnent pas - vous devrez spÃ©cifier explicitement les noms des fichiers jar dÃ©pendants. Autrement dit, les connaÃ®tre Ã  l'avance, ce qui dans notre cas est problÃ©matique. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et de toute faÃ§on, je ne voulais pas Ã§a. Je voulais que le projet ne doive pas Ãªtre recompilÃ©. Vers le dossier</font></font><code>adventures/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez lancer un nombre illimitÃ© d'aventures, de sorte que toutes soient visibles par le moteur de jeu pendant l'exÃ©cution. </font><font style="vertical-align: inherit;">Malheureusement, la fonctionnalitÃ© apparemment Ã©vidente va au-delÃ  des reprÃ©sentations standard du monde Java. </font><font style="vertical-align: inherit;">Ce n'est donc pas le bienvenu. </font><font style="vertical-align: inherit;">Une approche diffÃ©rente doit Ãªtre adoptÃ©e pour diffuser l'aventure indÃ©pendante. </font><font style="vertical-align: inherit;">Lequel? </font><font style="vertical-align: inherit;">Je ne sais pas, Ã©crivez dans les commentaires - c'est sÃ»r que quelqu'un a des idÃ©es intelligentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En attendant, il n'y a pas d'idÃ©es, voici une petite (ou grande, selon votre apparence) qui vous permet d'ajouter dynamiquement des dÃ©pendances au chemin de classe sans mÃªme connaÃ®tre leurs noms et sans avoir Ã  recompiler le projet: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sous Windows:</font></font><br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> OFF <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\DiceCore\pom.xml" install <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\DiceCli\pom.xml" package <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\TestAdventure\pom.xml" package <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> path_to_project\DiceCli\target\adventures <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> "path_to_project\TestAdventure\target\test-adventure-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.jar" path_to_project\DiceCli\target\adventures\ <span class="hljs-built_in"><span class="hljs-built_in">chcp</span></span> <span class="hljs-number"><span class="hljs-number">65001</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> path_to_project\DiceCli\target\ java -Dfile.encoding=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> -cp "dice-cli-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar;adventures\*" my.company.dice.MainKt <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et sur Unix: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh mvn -f "path_to_project/DiceCore/pom.xml" install mvn -f "path_to_project/DiceCli/pom.xml" package mvn -f "path_to_project/TestAdventure/pom.xml" package mkdir path_to_project/DiceCli/target/adventures cp path_to_project/TestAdventure/target/test-adventure-1.0.jar path_to_project/DiceCli/target/adventures/ cd path_to_project/DiceCli/target/ java -cp "dice-cli-1.0-jar-with-dependencies.jar:adventures/*" my.company.dice.MainKt</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et voici l'astuce. </font><font style="vertical-align: inherit;">Au lieu d'utiliser la clÃ©, </font></font><code>-jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous ajoutons le projet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au chemin de classe et spÃ©cifions explicitement la classe qu'il contient comme point d'entrÃ©e </font></font><code>MainKt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">De plus, ici, nous connectons toutes les archives du dossier </font></font><code>adventures/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inutile d'indiquer une fois de plus Ã  quel point cette dÃ©cision tordue est - je le sais moi-mÃªme, merci. </font><font style="vertical-align: inherit;">Mieux vaut suggÃ©rer vos idÃ©es dans les commentaires. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je vous en prie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(à²¥ï¹à²¥)</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰tape dix-sept. </font><font style="vertical-align: inherit;">Terrain</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de paroles. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notre article concerne le cÃ´tÃ© technique du flux de travail, mais les jeux ne sont pas seulement du code logiciel. Ce sont des mondes passionnants avec des Ã©vÃ©nements intÃ©ressants et des personnages vivants, dans lesquels vous plongez avec votre tÃªte, renonÃ§ant au monde rÃ©el. Chacun de ces mondes est inhabituel Ã  sa maniÃ¨re et intÃ©ressant Ã  sa maniÃ¨re, dont beaucoup vous vous souvenez encore, aprÃ¨s de nombreuses annÃ©es. Si vous voulez que votre monde se souvienne Ã©galement de sentiments chaleureux, rendez-le inhabituel et intÃ©ressant.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je sais que nous sommes des programmeurs ici, pas des scÃ©naristes, mais nous avons quelques idÃ©es de base sur la composante narrative du genre de jeu (les joueurs expÃ©rimentÃ©s, non?). </font><font style="vertical-align: inherit;">Comme dans tout livre, l'histoire doit avoir un Å“il (dans lequel nous dÃ©crivons progressivement le problÃ¨me auquel sont confrontÃ©s les hÃ©ros), le dÃ©veloppement, deux ou trois virages intÃ©ressants, un point culminant (le moment le plus aigu de l'intrigue, lorsque les lecteurs se figent d'excitation et oublient de respirer) et le dÃ©nouement (dans quels Ã©vÃ©nements arrivent progressivement Ã  leur conclusion logique). </font><font style="vertical-align: inherit;">Ã‰vitez l'euphÃ©misme, l'inutilitÃ© logique et les trous de tracÃ© - toutes les lignes commencÃ©es devraient arriver Ã  une conclusion adÃ©quate. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, lisons notre histoire aux autres - un regard impartial de cÃ´tÃ© aide trÃ¨s souvent Ã  comprendre les dÃ©fauts et Ã  les corriger Ã  temps.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'intrigue du jeu</font></font></b> <div class="spoiler_text">         ,    ,      .      ,     :  ( )   ( ),   .       ,     . <br><br>   â€”   ,              .     ,                  ,     . <br><br> ,  ,  - . ,    ,  ,           ,     .       . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heureusement, je ne suis pas Tolkien, je n'ai pas travaillÃ© le monde du jeu avec trop de dÃ©tails, mais j'ai essayÃ© de le rendre suffisamment intÃ©ressant et, surtout, logiquement justifiÃ©. En mÃªme temps, il s'est permis d'introduire des ambiguÃ¯tÃ©s, que chaque joueur est libre d'interprÃ©ter Ã  sa maniÃ¨re. Par exemple, il ne s'est concentrÃ© nulle part sur le niveau de dÃ©veloppement technologique du monde dÃ©crit: le systÃ¨me fÃ©odal et les institutions dÃ©mocratiques modernes, les tyrans pervers et les groupes criminels organisÃ©s, le but le plus Ã©levÃ© et la survie courante, les trajets en bus et les combats dans les tavernes - mÃªme les personnages tirent pour une raison quelconque: des arcs / arbalÃ¨tes ou des fusils d'assaut. Dans le monde, il y a un semblant de magie (sa prÃ©sence ajoute un gameplay aux capacitÃ©s tactiques) et des Ã©lÃ©ments de mysticisme (juste pour Ãªtre).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je voulais m'Ã©loigner des clichÃ©s de l'intrigue et des biens de consommation fantastiques - tous ces elfes, gnomes, dragons, seigneurs noirs et mal du monde absolu (ainsi que: des hÃ©ros sÃ©lectionnÃ©s, des prophÃ©ties anciennes, des super-artefacts, des batailles Ã©piques ... bien que ces derniers puissent Ãªtre laissÃ©s). Je voulais aussi vraiment rendre le monde vivant, afin que chaque personnage rencontrÃ© (mÃªme mineur) ait sa propre histoire et sa motivation, que les Ã©lÃ©ments de la mÃ©canique du jeu s'inscrivent dans les lois du monde, que le dÃ©veloppement des hÃ©ros se dÃ©roule naturellement, que la prÃ©sence d'ennemis et d'obstacles dans les lieux soit logiquement justifiÃ©e par les caractÃ©ristiques de l'emplacement lui-mÃªme ... et ainsi de suite. Malheureusement, ce dÃ©sir a jouÃ© une plaisanterie cruelle, ralentissant beaucoup le processus de dÃ©veloppement, et il n'Ã©tait pas toujours possible de s'Ã©carter des conventions de jeu. NÃ©anmoins, la satisfaction du produit final s'est avÃ©rÃ©e Ãªtre d'un ordre de grandeur supÃ©rieur.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce que je veux dire avec tout Ã§a? Un complot bien pensÃ© peut ne pas Ãªtre si nÃ©cessaire, mais votre jeu ne souffrira pas de sa prÃ©sence: dans le meilleur des cas, les joueurs l'apprÃ©cieront, dans le pire des cas, ils l'ignoreront simplement. Et ceux qui sont particuliÃ¨rement enthousiastes pardonneront mÃªme Ã  votre jeu certains dÃ©fauts fonctionnels, juste pour dÃ©couvrir comment l'histoire se termine.</font></font><br><br><h2>  Et ensuite? </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La programmation se termine et la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conception du jeu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> commence </font><font style="vertical-align: inherit;">. Il est maintenant temps de ne pas Ã©crire le code, mais de rÃ©flÃ©chir Ã  des scÃ©narios, des emplacements, des ennemis - vous comprenez, toute cette lie. Si vous travaillez toujours seul, je vous fÃ©licite - vous avez atteint le stade oÃ¹ la plupart des projets de jeu se prÃ©cipitent. Dans les grands studios AAA, des personnes spÃ©ciales travaillent en tant que concepteurs et scÃ©naristes qui reÃ§oivent de l'argent pour cela - ils n'ont tout simplement nulle part oÃ¹ aller. Mais nous avons beaucoup d'options: aller se promener, manger, dormir de faÃ§on banale - mais ce qui peut Ãªtre fait lÃ -bas, mÃªme pour dÃ©marrer un nouveau projet, en utilisant l'expÃ©rience et les connaissances accumulÃ©es.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous Ãªtes toujours lÃ  et que vous voulez continuer Ã  tout prix, alors prÃ©parez-vous aux difficultÃ©s. Manque de temps, paresse, manque d'inspiration crÃ©ative - quelque chose vous distraira constamment. Il n'est pas facile de surmonter tous ces obstacles (encore une fois, de nombreux articles ont Ã©tÃ© Ã©crits sur ce sujet), mais c'est possible. Tout d'abord, je vous conseille de planifier soigneusement le dÃ©veloppement futur du projet. Heureusement, nous travaillons pour notre plaisir, les Ã©diteurs ne nous poussent pas, personne n'exige le respect de dÃ©lais prÃ©cis - ce qui signifie qu'il est possible d'aller au point sans hÃ¢te inutile. Faites une Â«feuille de routeÂ» du projet, dÃ©terminez les principales Ã©tapes et (si vous avez le courage) des termes approximatifs pour leur mise en Å“uvre. Procurez-vous un cahier (vous pouvez l'Ã©lectronique) et notez constamment les idÃ©es qui en dÃ©coulent (mÃªme en vous rÃ©veillant soudainement au milieu de la nuit).Marquez vos progrÃ¨s avec des tableaux (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par exemple, tels</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ou d'autres appareils et accessoires fonctionnels. DÃ©marrez la documentation: Ã  la fois externe, publique ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki, par exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) pour la future Ã©norme communautÃ© de fans, et interne, pour vous-mÃªme (je ne partagerai pas le lien) - croyez-moi, sans elle aprÃ¨s une pause d'un mois, vous ne vous souviendrez pas exactement de quoi et comment vous l'avez fait. En gÃ©nÃ©ral, Ã©crivez autant d'informations que possible sur votre jeu, n'oubliez pas d'Ã©crire le jeu lui-mÃªme. J'ai proposÃ© des options de base, mais je ne donne pas de conseils spÃ©cifiques - chacun dÃ©cide par lui-mÃªme comment il est plus pratique pour lui d'organiser son processus de travail. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Mais encore, vous ne voulez pas parler de l'Ã©quilibre du jeu?"</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PrÃ©parez-vous immÃ©diatement au fait que la crÃ©ation du jeu parfait la premiÃ¨re fois ne fonctionnera pas. Un prototype fonctionnel est bon - au dÃ©but, il montrera la viabilitÃ© du projet, vous convaincra ou vous dÃ©cevra et donnera une rÃ©ponse Ã  une question trÃ¨s importante: Â«cela vaut-il la peine de continuer?Â». Cependant, il ne rÃ©pondra pas Ã  beaucoup d'autres questions, dont la principale, probablement: "sera-t-il intÃ©ressant de jouer mon jeu sur le long terme?" Il existe un grand nombre de thÃ©ories et d'articles (enfin, encore une fois) sur ce sujet. Un jeu intÃ©ressant devrait Ãªtre modÃ©rÃ©ment difficile, car un jeu trop simple ne pose pas de dÃ©fi au joueur. D'un autre cÃ´tÃ©, si la complexitÃ© est prohibitive, seuls les joueurs hardcore tÃªtus ou les personnes qui essaient de prouver quelque chose Ã  quelqu'un resteront du public du jeu. Le jeu devrait Ãªtre assez diversifiÃ©, idÃ©alement - fournir plusieurs options pour atteindre l'objectif,afin que chaque joueur choisisse une option Ã  son goÃ»t. Une stratÃ©gie de dÃ©passement ne devrait pas dominer les autres, sinon ils ne l'utiliseront que ... Et ainsi de suite.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En d'autres termes, le jeu doit Ãªtre Ã©quilibrÃ©. Cela est particuliÃ¨rement vrai du jeu de sociÃ©tÃ©, oÃ¹ les rÃ¨gles sont clairement formalisÃ©es. Comment faire Je n'en ai aucune idÃ©e. Si vous n'avez pas d'ami mathÃ©maticien capable de crÃ©er un modÃ¨le mathÃ©matique (je l'ai vu, ils le font) et que vous-mÃªme n'y comprenez rien (et nous ne comprenons pas), alors la seule issue est </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de s'appuyer sur l'intuition du </font></font></s> <font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">test </font></i><s><font style="vertical-align: inherit;">de </font></s></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Jouez d'abord le jeu vous-mÃªme. Lorsque vous Ãªtes fatiguÃ© - offrez de jouer Ã  votre femme. AprÃ¨s le divorce, invitez d'autres parents, amis, connaissances, personnes au hasard dans la rue Ã  jouer. Lorsque vous vous retrouvez complÃ¨tement seul, tÃ©lÃ©chargez l'assembly sur Internet. Les gens seront intÃ©ressÃ©s, voudront jouer, et vous leur rÃ©pondrez: "retour d'information de votre part!". Peut-Ãªtre que quelqu'un aimera votre rÃªve de la mÃªme maniÃ¨re que vous et voudra travailler avec vous - de cette faÃ§on, vous trouverez des personnes partageant les mÃªmes idÃ©es ou au moins un groupe de soutien (pourquoi pensez-vous que j'ai Ã©crit cet article?) (Hehe).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blague Ã  part, je nous souhaite ... Ã  vous tous de rÃ©ussir. </font><font style="vertical-align: inherit;">En savoir plus (qui aurait pensÃ©!) - sur la conception de jeux et plus encore. </font><font style="vertical-align: inherit;">Toutes les questions que nous avons examinÃ©es ont dÃ©jÃ  Ã©tÃ© abordÃ©es d'une maniÃ¨re ou d'une autre dans des articles et de la littÃ©rature (bien que, si vous Ãªtes toujours lÃ , il est Ã©videmment inutile de vous inciter Ã  lire). </font><font style="vertical-align: inherit;">Partagez vos impressions, communiquez sur les forums - en gÃ©nÃ©ral, vous me connaissez de mieux en mieux. </font><font style="vertical-align: inherit;">Ne soyez pas paresseux et vous rÃ©ussirez. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur cette note optimiste, permettez-moi de prendre votre congÃ©. </font><font style="vertical-align: inherit;">Merci Ã  tous pour votre attention. </font><font style="vertical-align: inherit;">A trÃ¨s bientÃ´t! </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â«Eh! </font><font style="vertical-align: inherit;">Qui vous voyez? </font><font style="vertical-align: inherit;">Comment lancer maintenant tout cela sur un tÃ©lÃ©phone portable? </font><font style="vertical-align: inherit;">Ai-je attendu en vain, ou quoi? "</font></font></i> <br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Postface. </font><font style="vertical-align: inherit;">Android</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour dÃ©crire l'intÃ©gration de notre moteur de jeu avec la plate-forme Android, laissons la classe tranquille </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et considÃ©rons une </font><font style="vertical-align: inherit;">classe </font><font style="vertical-align: inherit;">similaire, mais beaucoup plus simple </font></font><code>MainMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Comme son nom l'indique, il est destinÃ© Ã  implÃ©menter le menu principal de l'application et, en fait, est la premiÃ¨re classe avec laquelle l'utilisateur commence Ã  interagir.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'interface de la console, cela ressemble Ã  ceci</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/fx/ov/q7/fxovq7xubhonlcjjwziyvhfl_6g.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme une classe </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il dÃ©finit une boucle infinie, Ã  chaque itÃ©ration dont un Ã©cran est dessinÃ© et une commande est demandÃ©e Ã  l'utilisateur. </font><font style="vertical-align: inherit;">Seulement, il n'y a pas de logique compliquÃ©e ici et ces commandes sont beaucoup plus petites. </font><font style="vertical-align: inherit;">Nous mettons en Å“uvre essentiellement une chose - Â«QuitterÂ».</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableau d'activitÃ©s pour le menu principal</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/0_/xq/b5/0_xqb5sblm16brzqyrpibavvxco.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Facile, non? </font></font> Ã€ ce sujet et discours.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le code est Ã©galement un ordre de grandeur plus simple. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainMenu</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer: MenuRenderer, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor: MenuInteractor ) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> actions = ActionList.EMPTY <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { Audio.playMusic(Music.MENU_MAIN) actions = ActionList() actions.add(Action.Type.NEW_ADVENTURE) actions.add(Action.Type.CONTINUE_ADVENTURE, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) actions.add(Action.Type.MANUAL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) actions.add(Action.Type.EXIT) processCycle() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processCycle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { renderer.drawMainMenu(actions) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (interactor.pickAction(actions).type) { Action.Type.NEW_ADVENTURE -&gt; TODO() Action.Type.CONTINUE_ADVENTURE -&gt; TODO() Action.Type.MANUAL -&gt; TODO() Action.Type.EXIT -&gt; { Audio.stopMusic() Audio.playSound(Sound.LEAVE) renderer.clearScreen() Thread.sleep(<span class="hljs-number"><span class="hljs-number">500</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> AssertionError(<span class="hljs-string"><span class="hljs-string">"Should not happen"</span></span>) } } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'interaction avec l'utilisateur est mise en Å“uvre Ã  l'aide d'interfaces </font></font><code>MenuRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>MenuInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionne de maniÃ¨re similaire Ã  ce qui a Ã©tÃ© vu prÃ©cÃ©demment.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MenuRenderer</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Renderer { fun drawMainMenu</span></span></span></span>(actions: ActionList) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Interactor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous l'avez dÃ©jÃ  compris, nous avons sciemment sÃ©parÃ© les interfaces des implÃ©mentations spÃ©cifiques. </font><font style="vertical-align: inherit;">Il ne nous reste plus qu'Ã  remplacer le </font><font style="vertical-align: inherit;">projet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par un nouveau projet (appelons-le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Droid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), en ajoutant une dÃ©pendance au projet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Faisons-le. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExÃ©cutez Android Studio (gÃ©nÃ©ralement des projets pour Android y sont dÃ©veloppÃ©s), crÃ©ez un projet simple, supprimant tous les guirlandes standard inutiles et ne laissant que la prise en charge du langage Kotlin. </font><font style="vertical-align: inherit;">Nous ajoutons Ã©galement une dÃ©pendance sur le projet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui est stockÃ© dans le rÃ©fÃ©rentiel Maven local de notre machine.</font></font><br><br><pre> <code class="lua hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.application'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android-extensions'</span></span> android { compileSdkVersion <span class="hljs-number"><span class="hljs-number">28</span></span> defaultConfig { applicationId <span class="hljs-string"><span class="hljs-string">"my.company.dice"</span></span> minSdkVersion <span class="hljs-number"><span class="hljs-number">14</span></span> targetSdkVersion <span class="hljs-number"><span class="hljs-number">28</span></span> versionCode <span class="hljs-number"><span class="hljs-number">1</span></span> versionName <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> } } dependencies { implementation <span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"</span></span> implementation <span class="hljs-string"><span class="hljs-string">"my.company:dice-core:1.0"</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par dÃ©faut, cependant, personne ne verra notre dÃ©pendance - vous devez explicitement indiquer la nÃ©cessitÃ© d'utiliser un rÃ©fÃ©rentiel local (mavenLocal) lors de la construction du projet.</font></font><br><br><pre> <code class="lua hljs">buildscript { ext.kotlin_version = <span class="hljs-string"><span class="hljs-string">'1.3.20'</span></span> repositories { google() jcenter() mavenLocal() } dependencies { classpath <span class="hljs-string"><span class="hljs-string">'com.android.tools.build:gradle:3.3.0'</span></span> classpath <span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"</span></span> } } allprojects { repositories { google() jcenter() mavenLocal() } }</code> </pre><br>  ,        ,   â€”  .  ,   ,    : <code>SoundPlayer</code> , <code>MusicPlayer</code> , <code>MenuInteractor</code> ( <code>GameInteractor</code> ), <code>MenuRenderer</code> ( <code>GameRenderer</code> )  <code>StringLoader</code> ,    ,    .    ,          . <br><br>           (, ,    ) Android â€”      <code>Canvas</code> .      -   <code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ce sera notre Â«toileÂ». </font><font style="vertical-align: inherit;">Avec la saisie, c'est un peu plus compliquÃ©, car nous n'avons plus de clavier, et l'interface doit Ãªtre conÃ§ue de telle sorte que la saisie par l'utilisateur sur certaines parties de l'Ã©cran soit considÃ©rÃ©e comme une entrÃ©e de commandes. </font><font style="vertical-align: inherit;">Pour ce faire, nous utiliserons le mÃªme hÃ©ritier </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- de cette maniÃ¨re, il agira en tant qu'intermÃ©diaire entre l'utilisateur et le moteur de jeu (similaire Ã  la faÃ§on dont la console systÃ¨me a agi en tant qu'intermÃ©diaire). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CrÃ©ons l'activitÃ© principale de notre vue et Ã©crivons-la dans le manifeste.</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my.company.dice"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@mipmap/ic_launcher"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/AppTheme"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".ui.MainActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:screenOrientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sensorLandscape"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:configChanges</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"orientation|keyboardHidden|screenSize"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous fixons l'activitÃ© en orientation paysage - comme dans le cas de la plupart des autres jeux, nous ne serons pas en mesure de portrait portrait. </font><font style="vertical-align: inherit;">De plus, nous allons l'Ã©tendre Ã  tout l'Ã©cran de l'appareil, en prescrivant le thÃ¨me principal en consÃ©quence.</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AppTheme"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parent</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android:Theme.Black.NoTitleBar.Fullscreen"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et depuis que nous sommes entrÃ©s dans les ressources, nous transfÃ©rons les </font><font style="vertical-align: inherit;">chaÃ®nes localisÃ©es dont nous avons besoin </font><font style="vertical-align: inherit;">du projet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en les amenant au format souhaitÃ©:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_new_adventure_key"</span></span></span><span class="hljs-tag">&gt;</span></span>N<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_new_adventure_name"</span></span></span><span class="hljs-tag">&gt;</span></span>ew adventure<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_continue_adventure_key"</span></span></span><span class="hljs-tag">&gt;</span></span>C<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_continue_adventure_name"</span></span></span><span class="hljs-tag">&gt;</span></span>ontinue adventure<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_manual_key"</span></span></span><span class="hljs-tag">&gt;</span></span>M<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_manual_name"</span></span></span><span class="hljs-tag">&gt;</span></span>anual<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_exit_key"</span></span></span><span class="hljs-tag">&gt;</span></span>X<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_exit_name"</span></span></span><span class="hljs-tag">&gt;</span></span>Exit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi que les fichiers de sons et de musique utilisÃ©s dans le menu principal (un de chaque type), en les plaÃ§ant respectivement dans </font></font><code>/assets/sound/leave.wav</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>/assets/music/menu_main.mp3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque nous avons triÃ© les ressources, il Ã©tait temps de passer Ã  la conception (oui, encore une fois). </font><font style="vertical-align: inherit;">Contrairement Ã  la console, la plate-forme Android possÃ¨de ses propres caractÃ©ristiques architecturales, ce qui nous oblige Ã  utiliser des approches et des mÃ©thodes spÃ©cifiques.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagramme de classe et d'interface</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/xb/m4/uc/xbm4ucar6ewumegpof3hr53c0a4.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attendez, ne vous Ã©vanouissez pas, maintenant je vais tout expliquer en dÃ©tail. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous commencerons peut-Ãªtre par le plus difficile - la classe </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- l'hÃ©ritier mÃªme </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est appelÃ© Ã  lier ensemble les parties indÃ©pendantes de notre systÃ¨me (si vous le souhaitez, vous pouvez l'hÃ©riter de la classe </font></font><code>SurfaceView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ou mÃªme </font></font><code>GlSurfaceView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- et dessiner dans un thread sÃ©parÃ©, mais nous avons un jeu au tour par tour, pauvre en animation , qui ne nÃ©cessite pas de sortie graphique complexe, nous ne le compliquerons donc pas). Comme mentionnÃ© prÃ©cÃ©demment, sa mise en Å“uvre rÃ©soudra deux problÃ¨mes Ã  la fois: la sortie d'image et le traitement des clics, chacun ayant ses propres difficultÃ©s inattendues. ConsidÃ©rons-les dans l'ordre.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque nous avons peint sur la console, notre moteur de rendu a envoyÃ© des commandes de sortie et formÃ© une image Ã  l'Ã©cran. Dans le cas d'Android, la situation est inverse - le rendu est initiÃ© par la vue elle-mÃªme, qui au moment oÃ¹ la mÃ©thode </font></font><code>onDraw()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est </font><font style="vertical-align: inherit;">exÃ©cutÃ©e </font><font style="vertical-align: inherit;">devrait dÃ©jÃ  savoir quoi, comment et oÃ¹ dessiner. Mais qu'en est-il de la mÃ©thode d' </font></font><code>drawMainMenu()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface </font></font><code>MainMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Ne contrÃ´le-t-il pas la sortie maintenant? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essayons de rÃ©soudre ce problÃ¨me Ã  l'aide d'interfaces fonctionnelles. La classe </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiendra un paramÃ¨tre spÃ©cial </font></font><code>instructions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- en fait, un bloc de code qui doit Ãªtre exÃ©cutÃ© Ã  chaque appel de la mÃ©thode </font></font><code>onDraw()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le rendu, en utilisant une mÃ©thode publique, indiquera quelles instructions spÃ©cifiques doivent Ãªtre suivies. Si quelqu'un est intÃ©ressÃ©, le modÃ¨le utilisÃ© est appelÃ© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> stratÃ©gie. Cela ressemble Ã  ceci:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> RenderInstructions = (Canvas, Paint) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceSurface</span></span></span></span>(context: Context) : View(context) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instructions: RenderInstructions = { _, _ -&gt; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> paint = Paint().apply { color = Color.YELLOW style = Paint.Style.STROKE isAntiAlias = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateInstructions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instructions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RenderInstructions</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.instructions = instructions <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.postInvalidate() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDraw(canvas) canvas.drawColor(Color.BLACK) <span class="hljs-comment"><span class="hljs-comment">//Fill background with black color instructions.invoke(canvas, paint) //Execute current render instructions } } class DroidMenuRenderer(private val surface: DiceSurface): MenuRenderer { override fun clearScreen() { surface.updateInstructions { _, _ -&gt; } } override fun drawMainMenu(actions: ActionList) { surface.updateInstructions { c, p -&gt; val canvasWidth = c.width val canvasHeight = c.height //Draw title text p.textSize = canvasHeight / 3f p.strokeWidth = 0f p.color = Color.parseColor("#ff808000") c.drawText( "DICE", (canvasWidth - p.measureText("DICE")) / 2f, (buttonTop - p.ascent() - p.descent()) / 2f, p ) //Other instructions... } } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autrement dit, toutes les fonctionnalitÃ©s graphiques sont toujours dans la classe Renderer, mais cette fois nous n'exÃ©cutons pas directement les commandes, mais les prÃ©parons pour l'exÃ©cution par notre vue. Faites attention au type de propriÃ©tÃ© </font></font><code>instructions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- vous pouvez crÃ©er une interface distincte et appeler sa seule mÃ©thode, mais Kotlin peut rÃ©duire considÃ©rablement la quantitÃ© de code.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant sur Interactor. Auparavant, la saisie des donnÃ©es se faisait de maniÃ¨re synchrone: lorsque nous demandions des donnÃ©es Ã  la console (clavier), l'application (cycles) Ã©tait suspendue jusqu'Ã  ce que l'utilisateur appuie sur une touche. Avec Android, une telle astuce ne fonctionnera pas - elle a son propre Looper, dont le travail ne doit en aucun cas Ãªtre perturbÃ©, ce qui signifie que l'entrÃ©e doit Ãªtre asynchrone. C'est-Ã -dire que les mÃ©thodes d'interface Interactor mettent toujours le moteur en pause et attendent les commandes, tandis que Activity et toute sa vue continuent de fonctionner jusqu'Ã  ce que tÃ´t ou tard ils envoient cette commande. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette approche est assez simple Ã  implÃ©menter Ã  l'aide d'une interface standard </font></font><code>BlockingQueue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La classe </font></font><code>DroidMenuInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appellera la mÃ©thode</font></font><code>take()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui suspendra l'exÃ©cution du flux de jeu jusqu'Ã  ce que les Ã©lÃ©ments (instances de la classe familiÃ¨re </font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">apparaissent dans la file d'attente </font><font style="vertical-align: inherit;">. </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Ã  son tour, s'adaptera aux clics des utilisateurs (mÃ©thode de </font></font><code>onTouchEvent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe </font><font style="vertical-align: inherit;">standard </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), gÃ©nÃ©rera des objets et les ajoutera Ã  la file d'attente par la mÃ©thode </font></font><code>offer()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cela ressemblera Ã  ceci:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceSurface</span></span></span></span>(context: Context) : View(context) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actionQueue: BlockingQueue&lt;Action&gt; = LinkedBlockingQueue&lt;Action&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">awaitAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Action = actionQueue.take() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MotionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.action == MotionEvent.ACTION_UP) { actionQueue.offer(Action(Action.Type.NONE), <span class="hljs-number"><span class="hljs-number">200</span></span>, TimeUnit.MILLISECONDS) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidMenuInteractor</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> surface: DiceSurface) : Interactor { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { surface.awaitAction() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type = surface.awaitAction().type list .filter(Action::isEnabled) .find { it.type == type } ?.let { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it } } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autrement dit, Interactor appelle la mÃ©thode </font></font><code>awaitAction()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et s'il y a quelque chose dans la file d'attente, il traite la commande reÃ§ue. Faites attention Ã  la faÃ§on dont les Ã©quipes sont ajoutÃ©es Ã  la file d'attente. Ã‰tant donnÃ© que le flux d'interface utilisateur s'exÃ©cute en continu, l'utilisateur peut cliquer sur l'Ã©cran plusieurs fois de suite, ce qui peut entraÃ®ner des blocages, surtout si le moteur de jeu n'est pas prÃªt Ã  accepter des commandes (par exemple, pendant les animations). Dans ce cas, l'augmentation de la capacitÃ© de la file d'attente et / ou la diminution de la valeur du dÃ©lai d'attente seront utiles.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien sÃ»r, nous transfÃ©rons en quelque sorte les commandes, mais seulement la seule et la seule. Nous devons faire la distinction entre les coordonnÃ©es de la pression et, selon leurs valeurs, appeler telle ou telle commande. Cependant, c'est une malchance - Interactor n'a aucune idÃ©e oÃ¹ Ã  quel endroit sur l'Ã©cran les boutons actifs sont dessinÃ©s - nous sommes responsables du rendu Renderer. Nous Ã©tablirons leur interaction comme suit. La classe </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stockera une collection spÃ©ciale - une liste de rectangles actifs (ou d'autres formes, si nous arrivons Ã  ce point). Ces rectangles contiennent les coordonnÃ©es des sommets et du sommet liÃ© </font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le rendu gÃ©nÃ©rera ces rectangles et les ajoutera Ã  la liste, la mÃ©thode </font></font><code>onTouchEvent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dÃ©terminera quel rectangle a Ã©tÃ© pressÃ© et ajoutera celui correspondant Ã  la file d'attente </font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveRect</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> action: Action, left: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>, top: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>, right: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>, bottom: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rect = RectF(left, top, right, bottom) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, y: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, w: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, h: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = rect.contains(x / w, y / h) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mÃ©thode </font></font><code>check()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consiste Ã  vÃ©rifier les coordonnÃ©es spÃ©cifiÃ©es Ã  l'intÃ©rieur du rectangle. Veuillez noter qu'au stade du travail de Renderer (et c'est exactement le moment oÃ¹ les rectangles sont crÃ©Ã©s), nous n'avons pas la moindre idÃ©e de la taille de la toile. Par consÃ©quent, nous devrons stocker les coordonnÃ©es dans des valeurs relatives (pourcentage de la largeur ou de la hauteur de l'Ã©cran) avec des valeurs de 0 Ã  1 et recompter au moment de la pression. Cette approche n'est pas entiÃ¨rement exacte, car elle ne prend pas en compte le rapport hauteur / largeur - Ã  l'avenir, elle devra Ãªtre refaite. Cependant, pour notre tÃ¢che Ã©ducative au dÃ©but, cela suffira. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous allons implÃ©menter </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un champ supplÃ©mentaire </font><font style="vertical-align: inherit;">dans la classe </font><font style="vertical-align: inherit;">, ajouter deux mÃ©thodes ( </font></font><code>addRectangle()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>clearRectangles()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) pour le contrÃ´ler de l'extÃ©rieur (du cÃ´tÃ© du </font></font><code>onTouchEvent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rendu </font><font style="vertical-align: inherit;">), et dÃ©velopper </font><font style="vertical-align: inherit;">en forÃ§ant les coordonnÃ©es des rectangles Ã  prendre en compte.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceSurface</span></span></span></span>(context: Context) : View(context) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actionQueue: BlockingQueue&lt;Action&gt; = LinkedBlockingQueue&lt;Action&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rectangles: MutableSet&lt;ActiveRect&gt; = Collections.newSetFromMap(ConcurrentHashMap&lt;ActiveRect, <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>&gt;()) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instructions: RenderInstructions = { _, _ -&gt; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> paint = Paint().apply { color = Color.YELLOW style = Paint.Style.STROKE isAntiAlias = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateInstructions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instructions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RenderInstructions</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.instructions = instructions <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.postInvalidate() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearRectangles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { rectangles.clear() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addRectangle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">, left: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, top: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, right: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, bottom: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { rectangles.add(ActiveRect(action, left, top, right, bottom)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">awaitAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Action = actionQueue.take() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MotionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.action == MotionEvent.ACTION_UP) { with(rectangles.firstOrNull { it.check(event.x, event.y, width.toFloat(), height.toFloat()) }) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { actionQueue.put(action) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { actionQueue.offer(Action(Action.Type.NONE), <span class="hljs-number"><span class="hljs-number">200</span></span>, TimeUnit.MILLISECONDS) } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDraw(canvas) canvas.drawColor(Color.BLACK) instructions(canvas, paint) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une collection compÃ©titive est utilisÃ©e pour stocker les rectangles - elle permettra d'Ã©viter l'occurrence </font></font><code>ConcurrentModificationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si l'ensemble est mis Ã  jour et dÃ©placÃ© en mÃªme temps par diffÃ©rents threads (ce qui dans notre cas se produira). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code de classe </font></font><code>DroidMenuInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">restera inchangÃ©, mais il </font></font><code>DroidMenuRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">changera. Ajoutez quatre boutons Ã  l'affichage pour chaque Ã©lÃ©ment </font></font><code>ActionList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Placez-les sous le titre DICE, rÃ©partis uniformÃ©ment sur toute la largeur de l'Ã©cran. Eh bien, n'oublions pas les rectangles actifs.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidMenuRenderer</span></span></span><span class="hljs-class"> </span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> surface: DiceSurface, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> loader: StringLoader ) : MenuRenderer { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> helper = StringLoadHelper(loader) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { surface.clearRectangles() surface.updateInstructions { _, _ -&gt; } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawMainMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//Prepare rectangles surface.clearRectangles() val percentage = 1.0f / actions.size actions.forEachIndexed { i, a -&gt; surface.addRectangle(a, i * percentage, 0.45f, i * percentage + percentage, 1f) } //Prepare instructions surface.updateInstructions { c, p -&gt; val canvasWidth = c.width val canvasHeight = c.height val buttonTop = canvasHeight * 0.45f val buttonWidth = canvasWidth / actions.size val padding = canvasHeight / 144f //Draw title text p.textSize = canvasHeight / 3f p.strokeWidth = 0f p.color = Color.parseColor("#ff808000") p.isFakeBoldText = true c.drawText( "DICE", (canvasWidth - p.measureText("DICE")) / 2f, (buttonTop - p.ascent() - p.descent()) / 2f, p ) p.isFakeBoldText = false //Draw action buttons p.textSize = canvasHeight / 24f actions.forEachIndexed { i, a -&gt; p.color = if (a.isEnabled) Color.YELLOW else Color.LTGRAY p.strokeWidth = canvasHeight / 240f c.drawRect( i * buttonWidth + padding, buttonTop + padding, i * buttonWidth + buttonWidth - padding, canvasHeight - padding, p ) val name = mergeActionData(helper.loadActionData(a)) p.strokeWidth = 0f c.drawText( name, i * buttonWidth + (buttonWidth - p.measureText(name)) / 2f, (canvasHeight + buttonTop - p.ascent() - p.descent()) / 2f, p ) } } } private fun mergeActionData(data: Array&lt;String&gt;) = if (data.size &gt; 1) { if (data[1].first().isLowerCase()) data[0] + data[1] else data[1] } else data.getOrNull(0) ?: "" }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, nous sommes revenus Ã  nouveau Ã  l'interface </font></font><code>StringLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et aux capacitÃ©s de la classe auxiliaire </font></font><code>StringLoadHelper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(non reprÃ©sentÃ©es dans le diagramme). </font><font style="vertical-align: inherit;">L'implÃ©mentation de la premiÃ¨re a un nom </font></font><code>ResourceStringLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et est engagÃ©e dans le chargement de chaÃ®nes localisÃ©es Ã  partir (Ã©videmment) des ressources d'application. </font><font style="vertical-align: inherit;">Cependant, il le fait de maniÃ¨re dynamique, car nous ne connaissons pas les identifiants de ressource Ã  l'avance - nous sommes obligÃ©s de les construire sur le pouce.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceStringLoader</span></span></span></span>(context: Context) : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> packageName = context.packageName <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resources = context.resources <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String = resources.getString(resources.getIdentifier(key, <span class="hljs-string"><span class="hljs-string">"string"</span></span>, packageName)) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reste Ã  parler de sons et de musique. </font><font style="vertical-align: inherit;">Il y a une merveilleuse classe dans Android </font></font><code>MediaPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui traite de ces choses. </font><font style="vertical-align: inherit;">Il n'y a rien de mieux pour jouer de la musique:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidMusicPlayer</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> context: Context): MusicPlayer { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentMusic: Music? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> player = MediaPlayer() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentMusic == music) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } currentMusic = music player.setAudioStreamType(AudioManager.STREAM_MUSIC) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> afd = context.assets.openFd(<span class="hljs-string"><span class="hljs-string">"music/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${music.toString().toLowerCase()}</span></span></span><span class="hljs-string">.mp3"</span></span>) player.setDataSource(afd.fileDescriptor, afd.startOffset, afd.length) player.setOnCompletionListener { it.seekTo(<span class="hljs-number"><span class="hljs-number">0</span></span>) it.start() } player.prepare() player.start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { currentMusic = <span class="hljs-literal"><span class="hljs-literal">null</span></span> player.release() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deux points. Tout d'abord, la mÃ©thode </font></font><code>prepare()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est exÃ©cutÃ©e de maniÃ¨re synchrone, ce qui avec une grande taille de fichier (en raison de la mise en mÃ©moire tampon) suspendra le systÃ¨me. Il est recommandÃ© de l'exÃ©cuter dans un thread sÃ©parÃ© ou d'utiliser la mÃ©thode asynchrone </font></font><code>prepareAsync()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>OnPreparedListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. DeuxiÃ¨mement, il serait bien d'associer la lecture au cycle de vie de l'activitÃ© (pause lorsque l'utilisateur minimise l'application et reprise lors de la rÃ©cupÃ©ration), mais nous ne l'avons pas fait. Ai-ai-ai ... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il </font></font><code>MediaPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convient Ã©galement </font><font style="vertical-align: inherit;">aux sons </font><font style="vertical-align: inherit;">, mais s'il y en a peu et qu'ils sont simples (comme dans notre cas), alors Ã§a ira </font></font><code>SoundPool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Son avantage est que lorsque les fichiers audio sont dÃ©jÃ  chargÃ©s en mÃ©moire, leur lecture dÃ©marre instantanÃ©ment. L'inconvÃ©nient est Ã©vident - il n'y a peut-Ãªtre pas assez de mÃ©moire (mais assez pour nous, nous sommes modestes).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidSoundPlayer</span></span></span></span>(context: Context) : SoundPlayer { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> soundPool: SoundPool = SoundPool(<span class="hljs-number"><span class="hljs-number">2</span></span>, AudioManager.STREAM_MUSIC, <span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sounds = mutableMapOf&lt;Sound, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rate = <span class="hljs-number"><span class="hljs-number">1f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lock = ReentrantReadWriteLock() <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { Thread(SoundLoader(context)).start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lock.readLock().tryLock()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { sounds[sound]?.let { s -&gt; soundPool.play(s, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, rate) } } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { lock.readLock().unlock() } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoundLoader</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> context: Context) : Runnable { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> assets = context.assets lock.writeLock().lock() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Sound.values().forEach { s -&gt; sounds[s] = soundPool.load( assets.openFd(<span class="hljs-string"><span class="hljs-string">"sound/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${s.toString().toLowerCase()}</span></span></span><span class="hljs-string">.wav"</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span> ) } } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { lock.writeLock().unlock() } } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de la crÃ©ation d'une classe, tous les sons de l'Ã©numÃ©ration </font></font><code>Sound</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont chargÃ©s dans le rÃ©fÃ©rentiel dans un flux sÃ©parÃ©. </font><font style="vertical-align: inherit;">Cette fois, nous n'utilisons pas de collection synchronisÃ©e, mais nous implÃ©mentons le mutex Ã  l'aide de la classe standard </font></font><code>ReentrantReadWriteLock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, enfin, nous aveuglons tous les composants ensemble Ã  l'intÃ©rieur du nÃ´tre </font></font><code>MainActivity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ne l'avez pas oubliÃ©? </font><font style="vertical-align: inherit;">Veuillez noter que </font></font><code>MainMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(et </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par la suite) doit Ãªtre lancÃ© dans un fil distinct.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) Audio.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(DroidSoundPlayer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>), DroidMusicPlayer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> surface = DiceSurface(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer = DroidMenuRenderer(surface) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor = DroidMenuInteractor(surface, ResourceStringLoader(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) setContentView(surface) Thread { MainMenu(renderer, interactor).start() finish() }.start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBackPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { } }</code> </pre><br>  En fait, c'est tout.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AprÃ¨s tous les tourments, l'Ã©cran principal de notre application est tout simplement incroyable: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le menu principal sur toute l'Ã©tendue de l'Ã©cran mobile</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/m0/u7/-7/m0u7-7lcjmuttu9rerrvirhfgyy.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eh bien, c'est-Ã -dire que cela semblera Ã©tonnant lorsqu'un artiste intelligent apparaÃ®tra dans nos rangs, et avec son aide, cette misÃ¨re sera complÃ¨tement redessinÃ©e. </font></font><br><br><h2>  Liens utiles </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je sais, beaucoup ont dÃ©filÃ© directement jusqu'Ã  ce point. </font><font style="vertical-align: inherit;">C'est bon - la plupart des lecteurs ont complÃ¨tement fermÃ© l'onglet. </font><font style="vertical-align: inherit;">Pour ces unitÃ©s qui ont nÃ©anmoins rÃ©sistÃ© Ã  tout ce flux de bavardages incohÃ©rents - </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">respect et respect,</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> amour infini et gratitude. </font><font style="vertical-align: inherit;">Eh bien et les liens, bien sÃ»r, oÃ¹ sans eux. </font><font style="vertical-align: inherit;">Tout d'abord, sur le code source des projets (gardez Ã  l'esprit que l'Ã©tat actuel des projets est trÃ¨s en avance sur celui considÃ©rÃ© dans l'article):</font></font><br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projet de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">projeter </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le Droid</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, tout Ã  coup, quelqu'un aura envie de dÃ©marrer et de voir le projet, et de recueillir la paresse par lui-mÃªme, voici un lien vers la version de travail: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LINK!</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ici, un lanceur pratique est utilisÃ© pour lancer (vous pouvez Ã©crire un article sÃ©parÃ© sur sa crÃ©ation). Il utilise JavaFX et peut donc ne pas dÃ©marrer sur les machines avec OpenJDK (Ã©criture et aide), mais Ã©limine au moins la nÃ©cessitÃ© d'enregistrer manuellement les chemins d'accÃ¨s aux fichiers. L'aide Ã  l'installation est contenue dans le fichier readme.txt (vous vous en souvenez?). TÃ©lÃ©chargez, regardez, utilisez et enfin je me tais.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous Ãªtes intÃ©ressÃ© par un projet, ou un outil utilisÃ©, ou une mÃ©canique, ou une solution intÃ©ressante, ou, je ne sais pas, des jeux traditionnels, vous pouvez l'examiner plus en dÃ©tail dans un article sÃ©parÃ©. </font><font style="vertical-align: inherit;">Si tu veux. </font><font style="vertical-align: inherit;">Et si vous ne le souhaitez pas, envoyez simplement des commentaires, des regrets et des suggestions. </font><font style="vertical-align: inherit;">Je serai ravi de parler.</font></font><br><br>  Mes meilleurs vÅ“ux. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr445278/">https://habr.com/ru/post/fr445278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr445268/index.html">DÃ©tails GraphQL: quoi, comment et pourquoi</a></li>
<li><a href="../fr445270/index.html">[signet] Bash pour les dÃ©butants: 21 commandes utiles</a></li>
<li><a href="../fr445272/index.html">JavaScript est le meilleur langage de programmation pour les dÃ©butants. C'est vrai ou pas?</a></li>
<li><a href="../fr445274/index.html">Lorsque "ZoÃ«"! == "ZoÃ«", ou pourquoi vous devez normaliser les chaÃ®nes Unicode</a></li>
<li><a href="../fr445276/index.html">Guide d'utilisation complet</a></li>
<li><a href="../fr445280/index.html">RentabilitÃ© des sites et des services</a></li>
<li><a href="../fr445284/index.html">ClickHouse Product Analytics VKontakte</a></li>
<li><a href="../fr445286/index.html">Repose-pieds pour le cerveau: Hedera Hashgraph Distributed Registry Platform</a></li>
<li><a href="../fr445288/index.html">Tous vos prÃªts Ã  la consommation et vos donnÃ©es personnelles Â«en un seul endroitÂ» ...</a></li>
<li><a href="../fr445290/index.html">Comment mettre en Å“uvre des processus unifiÃ©s prenant en compte toutes les fonctionnalitÃ©s de l'entreprise?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>