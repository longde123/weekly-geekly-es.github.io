<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§œğŸ¼ ğŸ‘ğŸ¾ ğŸ‘• ä½¿ç”¨APDS-9960è¿›è¡Œæ‰‹åŠ¿è¯†åˆ« â›³ï¸ ğŸ§‘ğŸ¿â€ğŸ¤â€ğŸ§‘ğŸ¿ ğŸ¤·ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="é˜…è¯»æˆ‘ä»¥å‰å…³äºAPDS-9960çš„æ–‡ç« çš„è¯„è®ºï¼Œå…¶ä¸­æ¶‰åŠé¢œè‰²è¯†åˆ«å’Œäº®åº¦ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œæœ‰ä¸¤ä»¶äº‹å˜å¾—æ˜¾è€Œæ˜“è§ï¼š1ï¼‰æ‰‹åŠ¿è¯†åˆ«ä¸»é¢˜å¾ˆæœ‰è¶£ï¼Œå¹¶ä¸”2ï¼‰è¿™ä¸ªä¸»é¢˜æ²¡æœ‰å…¬å¼€ã€‚ 

 çš„ç¡®ï¼Œå¦‚æœæˆ‘è®²äº†APDS-9960çš„è¯´æ˜ï¼Œé‚£ä¹ˆåœ¨ä¸è€ƒè™‘æ‰‹åŠ¿çš„æƒ…å†µä¸‹ï¼Œè¯´æ˜çœ‹èµ·æ¥æœ‰äº›ä¸å®Œæ•´ã€‚ å› æ­¤ï¼Œæˆ‘ä¹Ÿæœ‰ä¸€äº›ç©ºé—²æ—¶é—´æ¥æ¢ç´¢è¿™ä¸ªä¸»é¢˜ã€‚ 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨APDS-9960è¿›è¡Œæ‰‹åŠ¿è¯†åˆ«</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424947/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ox/bk/bh/oxbkbhl6uwlr0-1dynm5tppscw0.jpeg" alt="å›¾ç‰‡"></div><br> é˜…è¯»æˆ‘ä»¥å‰å…³äºAPDS-9960çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« </a>çš„è¯„è®ºï¼Œå…¶ä¸­æ¶‰åŠé¢œè‰²è¯†åˆ«å’Œäº®åº¦ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œæœ‰ä¸¤ä»¶äº‹å˜å¾—æ˜¾è€Œæ˜“è§ï¼š1ï¼‰æ‰‹åŠ¿è¯†åˆ«ä¸»é¢˜å¾ˆæœ‰è¶£ï¼Œå¹¶ä¸”2ï¼‰è¿™ä¸ªä¸»é¢˜æ²¡æœ‰å…¬å¼€ã€‚ <br><br> çš„ç¡®ï¼Œå¦‚æœæˆ‘è®²äº†APDS-9960çš„è¯´æ˜ï¼Œé‚£ä¹ˆåœ¨ä¸è€ƒè™‘æ‰‹åŠ¿çš„æƒ…å†µä¸‹ï¼Œè¯´æ˜çœ‹èµ·æ¥æœ‰äº›ä¸å®Œæ•´ã€‚ å› æ­¤ï¼Œæˆ‘ä¹Ÿæœ‰ä¸€äº›ç©ºé—²æ—¶é—´æ¥æ¢ç´¢è¿™ä¸ªä¸»é¢˜ã€‚ <br><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æé†’æ‚¨æ³¨æ„APDS-9960ä¼ æ„Ÿå™¨æä¾›çš„æ‰‹åŠ¿è¯†åˆ«åŠŸèƒ½ã€‚ <br><a name="habracut"></a><br> æœ¬æ–‡å°†è€ƒè™‘ç”¨äºè®¾ç½®ä¼ æ„Ÿå™¨ï¼Œæ•°æ®æ”¶é›†ï¼Œå¤„ç†å’Œè¡¨ç¤ºçš„æœºåˆ¶ã€‚ æ‚¨è‡ªå·±å¯ä»¥çœ‹åˆ°ä½¿ç”¨APDS-9960è¿›è¡Œæ‰‹åŠ¿æ“ä½œæœ‰å¤šä¹ˆå®¹æ˜“ã€‚ <br><br> ä¸Šæ¬¡ï¼Œæœ¬æ–‡å°†é™„å¸¦ä¸€ä¸ªä»£ç ï¼Œå…¶ä¸­å°†è¯¦ç»†æè¿°å‘ç”Ÿçš„æ‰€æœ‰äº‹æƒ…ã€‚ æœ¬æ–‡æœ«å°¾æä¾›äº†å®Œæ•´çš„ä»£ç ç‰ˆæœ¬ã€‚ <br><br> éšä¾¿ä¸€å¥è¯ï¼šAPDS-9960æ²¡æœ‰å†…ç½®çš„è‡ªåŠ¨æ‰‹åŠ¿æ£€æµ‹æœºåˆ¶ï¼› ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘è¯»åˆ°äº†å®ƒçš„æ„æ€ï¼Œå³å¯„å­˜å™¨ï¼Œå¹¶ä¸”å·²ç»å­˜åœ¨ç»è¿‡å¤„ç†çš„æ‰‹åŠ¿-è¿™ä¸åœ¨APDS-9960ä¸­ï¼› è¿™æ„å‘³ç€æ‚¨å¿…é¡»ç¼–å†™è‡ªå·±çš„æ‰‹åŠ¿è§£é‡Šç®—æ³•ï¼Œç¨åæˆ‘ä»¬å°†åšã€‚ <br><br> æ€»çš„æ¥è¯´ï¼Œè¿™æ—¢å¥½åˆä¸å¥½ã€‚ å¹¶éå¦‚æ­¤-å› ä¸ºå®ƒå¯ä»¥ä½¿åˆå­¦è€…å¯¹è¯¥ä¼ æ„Ÿå™¨çš„ç ”ç©¶å˜å¾—å¤æ‚ï¼Œä½†æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºï¼ŒåŠ ä¸Šè¿‘ä¼¼æ•°æ®ï¼Œæ‚¨ç”šè‡³å¯ä»¥ç»†åŒ–è‡ªå·±çš„å„ç§æ‰‹åŠ¿ã€‚ <br><br> ä½†æ˜¯ï¼Œç”±äºæœ¬æ–‡ä»…å…·æœ‰æ¦‚è¿°åŠŸèƒ½ï¼Œå› æ­¤æˆ‘ä»¬åªé™äºåŸºæœ¬çš„UP-DOWN-LEFT-RIGHTæ‰‹åŠ¿ã€‚ <br><br> å¥½å§ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚ <br><br><h3> ç†è®º </h3><br> æˆ‘ä¼šç»™è‡ªå·±ä¸€ç‚¹ç‰©èµ„ã€‚ <br><br> ä¸ºäº†è·å¾—æœ‰å…³è¿åŠ¨å’Œè¿åŠ¨æ–¹å‘çš„å¿…è¦ä¿¡æ¯ï¼ŒAPDS-9960ä½¿ç”¨ä¸€ä¸ªIR LEDå’Œå››ä¸ªå…‰ç”µäºŒæç®¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®ƒä»¬æ£€æµ‹è¿‘çº¢å¤–ï¼ˆNIRï¼‰èŒƒå›´å†…çš„ä¿¡å·ã€‚ <br><br><img src="https://habrastorage.org/webt/__/k4/vq/__k4vqf3yty6sjcshtq77znw_v0.jpeg" alt="å›¾ç‰‡"><br><br>  IR LEDï¼ˆLEDï¼‰å…·æœ‰èƒŒå…‰åŠŸèƒ½ï¼Œè€Œå…‰ç”µäºŒæç®¡ï¼ˆUDLRï¼‰è®°å½•ä»â€œéšœç¢ç‰©â€åå°„çš„å…‰ã€‚ <br><br> å…‰ç”µäºŒæç®¡ä»¥è¿™æ ·çš„æ–¹å¼ä½äºä¼ æ„Ÿå™¨ä¸Šï¼šæ ¹æ®â€œéšœç¢ç‰©â€çš„ç§»åŠ¨æ–¹å‘ï¼Œç›¸åº”çš„å…‰ç”µäºŒæç®¡å°†åœ¨è¾“å…¥ç«¯æ¥æ”¶å¤§éƒ¨åˆ†åå°„çš„IRä¿¡å·ï¼Œå¹¶åœ¨è¾“å‡ºç«¯æ¥æ”¶è¾ƒå°çš„ä¸€éƒ¨åˆ†ã€‚ åŒæ—¶ï¼ŒAPDS-9960ä¸Šçš„æ–‡æ¡£æ˜ç¡®å‘Šè¯‰æˆ‘ä»¬ï¼Œæ‚¨å¯ä»¥é€šè¿‡æµ‹é‡å’Œæ¯”è¾ƒUDLRå…‰ç”µäºŒæç®¡ä¿¡å·çš„å¹…åº¦å’Œç›¸ä½å·®æ¥è§£é‡Šè¿åŠ¨æ–¹å‘ã€‚ <br><br><img src="https://habrastorage.org/webt/aj/ts/ok/ajtsok_p-tpsaa1cyx5uoy2uonm.jpeg" alt="å›¾ç‰‡"><br><br><h3> ç»ƒä¹  </h3><br> è¦ä¸APDS-9960ä»¥åŠ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸Šä¸€æ¬¡ä¸€èµ·</a>ä½¿ç”¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨STM32VLDISCOVERYã€‚ è¿æ¥ä¹Ÿæ²¡æœ‰æ”¹å˜ã€‚ <br><br>  <u>é…ç½®APDS-9960</u> <br><br> æˆ‘ä»¬è¿›è¡Œä¼ æ„Ÿå™¨çš„åˆå§‹è®¾ç½®ã€‚ <br><br> åƒè¿™æ ·ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">APDS9960_init</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">APDS9960_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ i2c1_write(APDS9960_CONTROL, DEFAULT_PGAIN); i2c1_write(APDS9960_GPENTH, DEFAULT_GPENTH); i2c1_write(APDS9960_GEXTH, DEFAULT_GEXTH); i2c1_write(APDS9960_GCONF2, DEFAULT_GGAIN); i2c1_write(APDS9960_GPULSE, DEFAULT_PULSE_LENGTH); i2c1_write(APDS9960_PPULSE, DEFAULT_PULSE_LENGTH); }</code> </pre> </div></div><br> è¿™æ˜¯æ€ä¹ˆå›äº‹ è®©æˆ‘ä»¬åšå¯¹ã€‚ <br><br><pre> <code class="cpp hljs">i2c1_write(APDS9960_CONTROL, DEFAULT_PGAIN);</code> </pre> <br>  PGAINï¼ˆæ¥è¿‘åº¦å¢ç›Šæ§åˆ¶ï¼‰æ˜¯æ§åˆ¶æ¥è¿‘åº¦çµæ•åº¦çš„å¢ç›Šçš„å‚æ•°ã€‚ ç»™å®ƒåˆ†é…ä¸€ä¸ªå€¼ä¸º2çš„å€¼ï¼Œå®ƒå¯¹åº”äºå¢ç›Šçš„å››å€ã€‚ <br><br><pre> <code class="cpp hljs">i2c1_write(APDS9960_GPENTH, DEFAULT_GPENTH); i2c1_write(APDS9960_GEXTH, DEFAULT_GEXTH);</code> </pre> <br>  GPENTHï¼ˆæ‰‹åŠ¿æ¥è¿‘åº¦è¾“å…¥é˜ˆå€¼å¯„å­˜å™¨ï¼‰-æ­¤å‚æ•°è®¾ç½®ç”¨äºç¡®å®šæ‰‹åŠ¿è¯†åˆ«å¼€å§‹çš„æ¥è¿‘åº¦é˜ˆå€¼ã€‚ <br><br>  GEXTHï¼ˆæ‰‹åŠ¿é€€å‡ºé˜ˆå€¼å¯„å­˜å™¨ï¼‰åˆ†åˆ«è®¾ç½®ç”¨äºç¡®å®šæ‰‹åŠ¿è¯†åˆ«ç»“æŸçš„é˜ˆå€¼ã€‚ <br><br><pre> <code class="cpp hljs">i2c1_write(APDS9960_GCONF2, DEFAULT_GGAIN);</code> </pre> <br> åœ¨GCONF2ï¼ˆä¸¤ä¸ªæ‰‹åŠ¿é…ç½®ï¼‰å¯„å­˜å™¨ä¸­ï¼Œæˆ‘ä»¬ä»…å°†GGAINï¼ˆæ‰‹åŠ¿å¢ç›Šæ§åˆ¶ï¼‰å‚æ•°æ˜¾å¼è®¾ç½®ä¸ºå¢ç›Šå€¼çš„å››å€ã€‚ <br><br><pre> <code class="cpp hljs">i2c1_write(APDS9960_GPULSE, DEFAULT_PULSE_LENGTH); i2c1_write(APDS9960_PPULSE, DEFAULT_PULSE_LENGTH);</code> </pre> <br> èƒŒå…‰ç¯ é»˜è®¤æƒ…å†µä¸‹ï¼Œçº¢å¤–LEDèƒŒå…‰æºçš„ç”µæµå€¼è®¾ç½®ä¸º0ï¼ˆå¯¹åº”äº100 mAçš„ç”µæµï¼‰ï¼Œè¿™å°†éå¸¸é€‚åˆæˆ‘ä»¬-æˆ‘ä»¬å°†ä¸ä¼šå¯¹å…¶è¿›è¡Œæ›´æ”¹ã€‚ <br><br>  APDS-9960ä¸­çš„IRç…§æ˜æ˜¯ä¸€ä¸ªè„‰å†²åºåˆ—ï¼Œå…¶ç‰¹å¾åœ¨äºæ‰‹åŠ¿GPULSEï¼ˆæ‰‹åŠ¿è„‰å†²è®¡æ•°å’Œé•¿åº¦ï¼‰çš„ç›¸åº”å¯„å­˜å™¨å‚æ•°ï¼šGPLENï¼ˆæ‰‹åŠ¿è„‰å†²é•¿åº¦ï¼‰å’ŒGPULSEï¼ˆæ‰‹åŠ¿è„‰å†²æ•°ï¼‰ï¼Œä»¥åŠPPULSEï¼ˆæ¥è¿‘è„‰å†²è®¡æ•°å¯„å­˜å™¨ï¼‰çš„è¿‘ä¼¼å€¼ï¼‰ï¼šPPLENï¼ˆæ¥è¿‘è„‰å†²é•¿åº¦ï¼‰å’ŒPPULSEï¼ˆæ¥è¿‘è„‰å†²è®¡æ•°ï¼‰è®¾ç½®è„‰å†²æ•°å’Œæ¯ä¸ªå•ç‹¬è„‰å†²çš„å‘¨æœŸã€‚ <br><br> å®šä¹‰GPLENå’ŒPPLENçš„å€¼ä¸º2ç­‰äº16Î¼sï¼ŒGPULSEå’ŒPPULSEçš„å€¼ä¸º9ï¼Œå¯¹åº”10ä¸ªè„‰å†²ã€‚ <br><br> å¦‚æ‚¨æ‰€è§ï¼Œä¸ä»¥å‰çš„APDS-9960è¯„è®ºä¸­çš„é¢œè‰²è¯†åˆ«å’Œç…§æ˜è®¾ç½®ç›¸æ¯”ï¼Œè¯¥è®¾ç½®è¦ç¨å¾®å¤æ‚ä¸€äº›ã€‚ <br><br>  <u>è¯»å–æ•°æ®</u> <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬è¿›å…¥ä¸»ç¨‹åºå¾ªç¯ï¼Œåœ¨è¯¥å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬ä¸æ—¶å¼€å§‹æ³¨å†Œå’Œè§£é‡Šå…‰ç”µäºŒæç®¡ä¸­çš„æ•°æ®ï¼Œå¹¶å­¦ä¹ å¦‚ä½•å°†ä¸€ä¸ªæ‰‹åŠ¿ä¸å¦ä¸€ä¸ªæ‰‹åŠ¿åŒºåˆ†å¼€ã€‚ <br><br> é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»¥æ‰‹åŠ¿å’Œç¼©æ”¾åŠŸèƒ½å¯åŠ¨APDS-9960ã€‚ <br><br><pre> <code class="cpp hljs">GesturesSet(GESTURES_START);</code> </pre> <br> ç„¶åæˆ‘ä»¬ç«‹å³å¼€å§‹è·Ÿè¸ªGVALIDå‚æ•°ã€‚  GVALIDï¼ˆæ‰‹åŠ¿FIFOæ•°æ®ï¼‰æ˜¯GSTATUSå¯„å­˜å™¨ï¼ˆæ‰‹åŠ¿çŠ¶æ€å¯„å­˜å™¨ï¼‰çš„å‚æ•°ï¼Œå¤„äºéé›¶çŠ¶æ€æ—¶ï¼Œé€šçŸ¥æˆ‘ä»¬ä¼ æ„Ÿå™¨å…·æœ‰å¯ç”¨çš„æ‰‹åŠ¿æ•°æ®ã€‚ <br><br> è¯¥æ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬æ‰‹åŠ¿ä¿¡æ¯ä½äºRAMåŒºåŸŸçš„ç¼“å†²åŒºä¸­ï¼Œè¯¥ç¼“å†²åŒºçš„å¤§å°é€šå¸¸ä¸º32 x 4å­—èŠ‚ã€‚ <br><br> å®é™…ä¸Šï¼Œè¯¥ç¼“å†²åŒºçš„å®é™…å¤§å°å¯ä»¥é€šè¿‡è¯»å–GFLVLï¼ˆæ‰‹åŠ¿FIFOçº§åˆ«ï¼‰å¯„å­˜å™¨çš„å€¼æ¥æ‰¾åˆ°ï¼Œå³ æ ¹æ®æˆ‘çš„çº¯ç²¹ç»éªŒå®éªŒè§‚å¯Ÿï¼Œè·å¾—GFLVL * 4ã€‚ åƒè¿™æ ·ï¼š <br><br><img src="https://habrastorage.org/webt/oy/57/ry/oy57ryfaagi3qqrur9htiefckx0.jpeg" alt="å›¾ç‰‡"><br><br> å¥½å§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæ ¹æ®ç¼“å†²åŒºçš„åç§°ï¼Œç¼“å†²åŒºä¸­çš„æ•°æ®æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ’åˆ—ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œç²—ç•¥åœ°è¯´ï¼Œæ¥è‡ªæ¯ä¸ªå…‰ç”µäºŒæç®¡çš„ä¿¡å·â€œè¶Šæ—©â€åˆ°è¾¾ï¼Œå…¶åœ¨GFLVLä¸­çš„â€œè¶Šé«˜â€ã€‚ <br><br> å¯ä»¥ä»ç›¸åº”çš„æ‰‹åŠ¿FIFOå¯„å­˜å™¨è¯»å–å…‰ç”µäºŒæç®¡ï¼ˆUDLRï¼‰çš„æ•°æ®ï¼š <br><br>  -GFIFO_Uï¼ˆæ‰‹åŠ¿FIFOæ•°æ®ï¼ŒUPï¼‰ <br>  -GFIFO_Dï¼ˆæ‰‹åŠ¿FIFOæ•°æ®ï¼Œå‘ä¸‹ï¼‰ <br>  -GFIFO_Lï¼ˆæ‰‹åŠ¿FIFOæ•°æ®ï¼Œå·¦ï¼‰ <br>  -GFIFO_Rï¼ˆæ‰‹åŠ¿FIFOæ•°æ®ï¼Œå³ï¼‰ <br><br> æ¯æ¬¡ä»è¿™äº›å¯„å­˜å™¨ä¸­è¯»å–å€¼åï¼ŒGFLVLéƒ½ä¼šå‡å°ã€‚ å› æ­¤ï¼Œæœ‰å¿…è¦ä»¥è‰¯å¥½çš„æ–¹å¼è¯»å–æ•´ä¸ªç¼“å†²åŒºï¼Œç›´åˆ°GFLVLè¾¾åˆ°é›¶ä¸ºæ­¢ã€‚ <br><br> è¦å®šä¹‰æ‰‹åŠ¿ï¼Œæˆ‘ä»¬åªéœ€è¦æ­¤ç¼“å†²åŒºçš„å‰å››ä¸ªå­—èŠ‚ï¼Œå°±ä¸éœ€è¦æ›´å¤šã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åªä¼šé˜…è¯»å®ƒä»¬ã€‚ <br><br><pre> <code class="cpp hljs">GestureUp = i2c1_read(APDS9960_GFIFO_U); GestureDown = i2c1_read(APDS9960_GFIFO_D); GestureLeft = i2c1_read(APDS9960_GFIFO_L); GestureRight = i2c1_read(APDS9960_GFIFO_R);</code> </pre><br>  <u>æ‰‹åŠ¿è¯†åˆ«</u> <br><br> ä¸ºäº†è§£é‡Šå‘ç”Ÿäº†å“ªç§æ‰‹åŠ¿ï¼Œæˆ‘ä»¬å°†è¿›è¡Œç®€å•çš„è®¡ç®—ï¼š <br><br><pre> <code class="cpp hljs">GestUpDown = GestureUp-GestureDown; GestLeftRight = GestureLeft-GestureRight;</code> </pre> <br> è¦ç¡®å®šå½“å‰å‘ç”Ÿäº†å“ªäº›æ‰‹åŠ¿ï¼Œå¯¹æˆ‘ä»¬è€Œè¨€ï¼Œé‡è¦çš„ä¸æ˜¯GestUpDownå’ŒGestLeftRightçš„å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªå®æ•°çš„ç¬¦å·ã€‚ <br><br> ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥GestUpDownå’ŒGestLeftRightå˜é‡çš„è´Ÿå€¼å’Œæ­£å€¼ä½œä¸ºè¾“å…¥ï¼Œæˆ‘ä»¬ç¡®å®šå“ªä¸ªæ‰‹åŠ¿æ˜¯å®Œç¾çš„ã€‚ <br><br> ä¸‹å›¾æ˜¾ç¤ºäº†GestUpDownå’ŒGestLeftRightå˜é‡çš„çœŸå€¼è¡¨ã€‚ <br><br><img src="https://habrastorage.org/webt/xx/ts/g-/xxtsg-0zw2h7ralowsgsd_8tmoc.jpeg" alt="å›¾ç‰‡"><br><br> ç°åœ¨é‡ç½®GFLVLï¼š <br><br><pre> <code class="cpp hljs">GesturesSet(GESTURES_STOP);</code> </pre> <br>  ...ç„¶åå›åˆ°ä¸»ç¨‹åºå‘¨æœŸçš„å¼€å§‹ã€‚ <br><br> ç°åœ¨æ•´ä¸ªä»£ç ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">main.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stm32f10x.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APDS9960_I2C_ADDR 0x39 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APDS9960_ENABLE 0x80 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APDS9960_GSTATUS 0xAF #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> APDS9960_GFLVL 0xAE </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//Gesture FIFO Register (0xFC â€“ 0xFF): #define APDS9960_GFIFO_U 0xFC #define APDS9960_GFIFO_D 0xFD #define APDS9960_GFIFO_L 0xFE #define APDS9960_GFIFO_R 0xFF #define APDS9960_CONTROL 0x8F #define APDS9960_GPENTH 0xA0 #define APDS9960_GEXTH 0xA1 #define APDS9960_GCONF2 0xA3 #define APDS9960_GPULSE 0xA6 #define APDS9960_PPULSE 0x8E #define GESTURES_START 0x01 #define GESTURES_STOP 0x02 #define DEFAULT_GPENTH 40 // Threshold for entering gesture mode #define DEFAULT_GEXTH 30 // Threshold for exiting gesture mode #define DEFAULT_PGAIN 8 // Proximity Gain Control: 4X #define DEFAULT_GGAIN 0x40 // Gesture Gain Control: 4X #define DEFAULT_PULSE_LENGTH 0x89 // 16us, 10 pulses /* Bit fields */ #define APDS9960_PON 0x01 #define APDS9960_AEN 0x02 #define APDS9960_PEN 0x04 #define APDS9960_WEN 0x08 #define APSD9960_AIEN 0x10 #define APDS9960_PIEN 0x20 #define APDS9960_GEN 0x40 #define APDS9960_GVALID 0x01 int GestUpDown = 0; int GestLeftRight = 0; //----------------------------------------------------------------------- uint8_t i2c1_read(uint8_t addr); void i2c1_write(uint8_t addr, uint8_t data); void I2C1_init(void) { I2C_InitTypeDef I2C_InitStructure; GPIO_InitTypeDef GPIO_InitStructure; RCC_APB1PeriphClockCmd(RCC_APB1Periph_I2C1, ENABLE); RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB| RCC_APB2Periph_AFIO , ENABLE); GPIO_InitStructure.GPIO_Speed = GPIO_Speed_2MHz; GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_OD; GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6 | GPIO_Pin_7; GPIO_Init(GPIOB, &amp;GPIO_InitStructure); I2C_StructInit(&amp;I2C_InitStructure); I2C_InitStructure.I2C_ClockSpeed = 100000; I2C_InitStructure.I2C_OwnAddress1 = 0x01; I2C_InitStructure.I2C_Ack = I2C_Ack_Enable; I2C_Init(I2C1, &amp;I2C_InitStructure); I2C_Cmd(I2C1, ENABLE); } //----------------------------------------------------------------------- void APDS9960_init(void) { i2c1_write(APDS9960_CONTROL, DEFAULT_PGAIN); i2c1_write(APDS9960_GPENTH, DEFAULT_GPENTH); i2c1_write(APDS9960_GEXTH, DEFAULT_GEXTH); i2c1_write(APDS9960_GCONF2, DEFAULT_GGAIN); i2c1_write(APDS9960_GPULSE, DEFAULT_PULSE_LENGTH); i2c1_write(APDS9960_PPULSE, DEFAULT_PULSE_LENGTH); } //----------------------------------------------------------------------- uint8_t i2c1_read(uint8_t addr) { uint8_t data; while(I2C_GetFlagStatus(I2C1, I2C_FLAG_BUSY)); I2C_GenerateSTART(I2C1, ENABLE); while(!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_MODE_SELECT)); I2C_Send7bitAddress(I2C1, APDS9960_I2C_ADDR&lt;&lt;1, I2C_Direction_Transmitter); while(!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_TRANSMITTER_MODE_SELECTED)); I2C_SendData(I2C1, addr); while(!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_BYTE_TRANSMITTED)); I2C_GenerateSTART(I2C1, ENABLE); while(!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_MODE_SELECT)); I2C_Send7bitAddress(I2C1, APDS9960_I2C_ADDR&lt;&lt;1, I2C_Direction_Receiver); while(!I2C_CheckEvent(I2C1,I2C_EVENT_MASTER_BYTE_RECEIVED)); data = I2C_ReceiveData(I2C1); while(!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_BYTE_RECEIVED)); I2C_AcknowledgeConfig(I2C1, DISABLE); I2C_GenerateSTOP(I2C1, ENABLE); while(I2C_GetFlagStatus(I2C1, I2C_FLAG_BUSY)); return data; } //----------------------------------------------------------------------- void i2c1_write(uint8_t addr, uint8_t data) { I2C_GenerateSTART(I2C1, ENABLE); while(!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_MODE_SELECT)); I2C_Send7bitAddress(I2C1, APDS9960_I2C_ADDR&lt;&lt;1, I2C_Direction_Transmitter); while(!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_TRANSMITTER_MODE_SELECTED)); I2C_SendData(I2C1, addr); while(!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_BYTE_TRANSMITTED)); I2C_SendData(I2C1, data); while(!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_BYTE_TRANSMITTED)); I2C_GenerateSTOP(I2C1, ENABLE); while(I2C_GetFlagStatus(I2C1, I2C_FLAG_BUSY)) {}; } //----------------------------------------------------------------------- void GesturesSet(uint8_t GestSel) { switch (GestSel) { case GESTURES_START: i2c1_write(APDS9960_ENABLE, APDS9960_GEN | APDS9960_PEN | APDS9960_PON); break; case GESTURES_STOP: i2c1_write(APDS9960_ENABLE, APDS9960_PEN | APDS9960_PON); break; default: i2c1_write(APDS9960_ENABLE, APDS9960_GEN | APDS9960_PEN | APDS9960_PON); } } //----------------------------------------------------------------------- int main() { uint8_t GFLVL_buf = 0; uint8_t GSTATUS_buf = 0; uint8_t GestureUp = 0; uint8_t GestureDown = 0; uint8_t GestureLeft = 0; uint8_t GestureRight = 0; I2C1_init(); APDS9960_init(); while (1) { GFLVL_buf = 0; GSTATUS_buf = 0; GestureUp = 0; GestureDown = 0; GestureLeft = 0; GestureRight = 0; GestUpDown = 0; GestLeftRight = 0; GesturesSet(GESTURES_START); GSTATUS_buf = i2c1_read(APDS9960_GSTATUS); if(GSTATUS_buf &amp; APDS9960_GVALID) { GFLVL_buf = i2c1_read(APDS9960_GFLVL); if(GFLVL_buf) { GestureUp = i2c1_read(APDS9960_GFIFO_U); GestureDown = i2c1_read(APDS9960_GFIFO_D); GestureLeft = i2c1_read(APDS9960_GFIFO_L); GestureRight = i2c1_read(APDS9960_GFIFO_R); //Truth table: //UP: GestUpDown(+) | GestLeftRight(+) //DOWN: GestUpDown(-) | GestLeftRight(-) //LEFT: GestUpDown(+) | GestLeftRight(-) //RIGHT: GestUpDown(-) | GestLeftRight(+) GestUpDown = GestureUp-GestureDown; GestLeftRight = GestureLeft-GestureRight; GesturesSet(GESTURES_STOP); } } } }</span></span></span></span></code> </pre><br></div></div><br> æˆ‘æƒ³æŒ‡å‡ºï¼ŒAPDS-9960çš„æ‰‹åŠ¿æœºåˆ¶å·¥ä½œå¾—å¾ˆå¥½ã€‚ è¯†åˆ«ç¨³å®šï¼ŒAPDS-9960ç´«å¤–å’Œçº¢å¤–å†…ç½®çš„æ»¤å…‰ç‰‡å·¥ä½œè‰¯å¥½ã€‚ <br><br> æˆ‘å¸Œæœ›è¿™äº›ææ–™å¯¹æŸäººæœ‰ç”¨ã€‚ è°¢è°¢æ‚¨çš„å…³æ³¨ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN424947/">https://habr.com/ru/post/zh-CN424947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN424935/index.html">é£Ÿå“è®¾è®¡æ–‡æ‘˜ï¼Œ2018å¹´9æœˆ</a></li>
<li><a href="../zh-CN424937/index.html">10æœˆ1æ—¥è‡³7æ—¥åœ¨è«æ–¯ç§‘ä¸¾è¡Œçš„æ•°å­—æ´»åŠ¨</a></li>
<li><a href="../zh-CN424939/index.html">å¤šæ€å¥å› </a></li>
<li><a href="../zh-CN424941/index.html">å°†æ•°æ®ä»RESTæœåŠ¡æµä¼ è¾“åˆ°MQé˜Ÿåˆ—</a></li>
<li><a href="../zh-CN424945/index.html">æ™ºèƒ½æ‰‹æœºé©¾é©¶ä¸€è¾†ç©å…·è½¦ã€‚</a></li>
<li><a href="../zh-CN424949/index.html">PHPæ–‡æ‘˜ç¬¬140å·ï¼ˆ2018å¹´9æœˆ17æ—¥è‡³30æ—¥ï¼‰</a></li>
<li><a href="../zh-CN424951/index.html">ä¸‡å²ï¼ è¿™ä¸æ˜¯å¦„æƒ³ç—‡</a></li>
<li><a href="../zh-CN424955/index.html">ä¸Šå‘¨ç¬¬332æœŸæ¥è‡ªå‰ç«¯ä¸–ç•Œçš„æ–°é²œææ–™æ‘˜è¦ï¼ˆ2018å¹´9æœˆ24æ—¥è‡³30æ—¥ï¼‰</a></li>
<li><a href="../zh-CN424957/index.html">ä½¿ç”¨AttnGANä»æ–‡æœ¬ç”Ÿæˆå›¾åƒ</a></li>
<li><a href="../zh-CN424961/index.html">MTA-STS for Postfix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>