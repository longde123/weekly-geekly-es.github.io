<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ô üíÜüèª üåÜ Volver a los microservicios con Istio. Parte 2 üë®üèæ‚Äçüéì üìå üàØÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nota perev. : La primera parte de esta serie se dedic√≥ a presentar Istio y demostrarlo en acci√≥n. Ahora hablaremos sobre aspectos m√°s complejos de la ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Volver a los microservicios con Istio. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/440378/"><img src="https://habrastorage.org/webt/bj/j4/oy/bjj4oyjxqshrbjf5eks9sgsvbeg.png"><br><br>  <i><b>Nota</b></i>  <i><b>perev.</b></i>  <i>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La primera parte de</a> esta serie se dedic√≥ a presentar Istio y demostrarlo en acci√≥n.</i>  <i>Ahora hablaremos sobre aspectos m√°s complejos de la configuraci√≥n y el uso de esta malla de servicios y, en particular, sobre el enrutamiento finamente ajustado y la gesti√≥n del tr√°fico de red.</i> <i><br><br></i>  <i>Tambi√©n le recordamos que el art√≠culo utiliza configuraciones (manifiestos para Kubernetes e Istio) del repositorio de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dominio de istio</a> .</i> <i><a name="habracut"></a></i> <br><br><h2>  Gesti√≥n del tr√°fico </h2><br>  Con Istio, aparecen nuevas caracter√≠sticas en el cl√∫ster para proporcionar: <br><br><ul><li>  <b>Enrutamiento de consultas din√°micas</b> : despliegues canarios, pruebas A / B; </li><li>  <b>Equilibrio de carga</b> : simple y consistente, basado en hashes; </li><li>  <b>Recuperaci√≥n de ca√≠das</b> : tiempos de espera, reintentos, disyuntores; </li><li>  <b>Entrada de falla</b> : demoras, interrupci√≥n de solicitudes, etc. </li></ul><br>  En la continuaci√≥n del art√≠culo, estas caracter√≠sticas se mostrar√°n como un ejemplo de la aplicaci√≥n seleccionada y se introducir√°n nuevos conceptos en el camino.  El primero de estos conceptos ser√° <code>DestinationRules</code> <i>(es decir, reglas sobre el destinatario del tr√°fico / solicitudes, aprox. Transl.)</i> , Con las cuales activaremos las pruebas A / B. <br><br><h2>  Pruebas A / B: Reglas de destino en la pr√°ctica </h2><br>  Las pruebas A / B se usan en los casos en que hay dos versiones de la aplicaci√≥n (generalmente difieren visualmente) y no estamos 100% seguros de cu√°l mejorar√° la interacci√≥n del usuario.  Por lo tanto, lanzamos simult√°neamente ambas versiones y recopilamos m√©tricas. <br><br>  Para implementar la segunda versi√≥n de la interfaz necesaria para demostrar las pruebas A / B, ejecute el siguiente comando: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/kube/ab-testing/sa-frontend-green-deployment.yaml deployment.extensions/sa-frontend-green created</code> </pre> <br>  El manifiesto de implementaci√≥n para la "versi√≥n verde" difiere en dos lugares: <br><br><ol><li>  La imagen se basa en otra etiqueta: <code>istio-green</code> , </li><li>  Las vainas tienen una <code>version: green</code> etiqueta <code>version: green</code> . </li></ol><br>  Dado que ambas implementaciones tienen la etiqueta <code>app: sa-frontend</code> , las solicitudes enrutadas por el <code>sa-external-services</code> virtual <code>sa-external-services</code> servicio <code>sa-frontend</code> se redirigir√°n a todas sus instancias y la carga se distribuir√° utilizando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el algoritmo round-robin</a> , lo que conducir√° a la siguiente situaci√≥n: <br><br><img src="https://habrastorage.org/webt/p-/bi/mj/p-bimjrw8ywosk5q020d3loefsy.png"><br>  <i>Archivos solicitados no encontrados</i> <br><br>  Estos archivos no se encontraron debido al hecho de que se llaman de manera diferente en diferentes versiones de la aplicaci√≥n.  Asegur√©monos de esto: <br><br><pre> <code class="bash hljs">$ curl --silent http://<span class="hljs-variable"><span class="hljs-variable">$EXTERNAL_IP</span></span>/ | tr <span class="hljs-string"><span class="hljs-string">'"'</span></span> <span class="hljs-string"><span class="hljs-string">'\n'</span></span> | grep main /static/css/main.c7071b22.css /static/js/main.059f8e9c.js $ curl --silent http://<span class="hljs-variable"><span class="hljs-variable">$EXTERNAL_IP</span></span>/ | tr <span class="hljs-string"><span class="hljs-string">'"'</span></span> <span class="hljs-string"><span class="hljs-string">'\n'</span></span> | grep main /static/css/main.f87cd8c9.css /static/js/main.f7659dbb.js</code> </pre> <br>  Esto significa que <code>index.html</code> , que solicita una versi√≥n de archivos est√°ticos, puede ser enviado por el equilibrador de carga a pods que tienen una versi√≥n diferente, donde, por razones obvias, tales archivos no existen.  Por lo tanto, para que la aplicaci√≥n funcione, debemos poner una restricci√≥n: " <b>la misma versi√≥n de la aplicaci√≥n que proporcion√≥ index.html tambi√©n debe atender solicitudes posteriores</b> ". <br><br>  Alcanzaremos el objetivo con un equilibrio de carga <i>consistente</i> basado en hash <i>(</i> Equilibrio de carga de <i>hash consistente)</i> .  En este caso, las <b>solicitudes de un cliente se env√≠an a la misma instancia de back-end</b> , para la que se utiliza una propiedad predefinida, por ejemplo, un encabezado HTTP.  Implementado usando DestinationRules. <br><br><h2>  Reglas de destino </h2><br>  Despu√©s de que <b>VirtualService haya</b> enviado una solicitud al servicio deseado, utilizando DestinationRules podemos determinar las pol√≠ticas que se aplicar√°n al tr√°fico destinado a las instancias de este servicio: <br><br><img src="https://habrastorage.org/webt/sd/be/iy/sdbeiy6vndddkdjifebk9a7-q2m.png"><br>  <i>Istio Resource Traffic Management</i> <br><br>  <b>Nota</b> : El efecto de los recursos de Istio en el tr√°fico de red se presenta aqu√≠ de manera simplificada.  Para ser precisos, la decisi√≥n sobre a qu√© instancia enviar la solicitud la toma Envoy en el Ingress Gateway configurado en CRD. <br><br>  Al usar las Reglas de destino, podemos configurar el equilibrio de carga para que se usen hashes consistentes y se garanticen las respuestas de la misma instancia de servicio al mismo usuario.  La siguiente configuraci√≥n permite esto ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">destinationrule-sa-frontend.yaml</a> ) para lograr esto: <br><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: sa-frontend spec: host: sa-frontend trafficPolicy: loadBalancer: consistentHash: httpHeaderName: version # 1</code> </pre> <br>  1: el hash se generar√° en funci√≥n del contenido del encabezado de la <code>version</code> HTTP. <br><br>  Aplique la configuraci√≥n con el siguiente comando: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/ab-testing/destinationrule-sa-frontend.yaml destinationrule.networking.istio.io/sa-frontend created</code> </pre> <br>  Ahora ejecute el comando a continuaci√≥n y aseg√∫rese de obtener los archivos que necesita al especificar el encabezado de la <code>version</code> : <br><br><pre> <code class="bash hljs">$ curl --silent -H <span class="hljs-string"><span class="hljs-string">"version: yogo"</span></span> http://<span class="hljs-variable"><span class="hljs-variable">$EXTERNAL_IP</span></span>/ | tr <span class="hljs-string"><span class="hljs-string">'"'</span></span> <span class="hljs-string"><span class="hljs-string">'\n'</span></span> | grep main</code> </pre> <br>  <b>Nota</b> : Para agregar diferentes valores en el t√≠tulo y probar los resultados directamente en el navegador, puede usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esta extensi√≥n</a> para Chrome <i>(o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esta</a> para Firefox - Transl. Aprox.)</i> . <br><br>  En general, DestinationRules tiene m√°s opciones en el campo del equilibrio de carga: consulte la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n oficial para</a> obtener m√°s detalles. <br><br>  Antes de seguir explorando VirtualService, eliminaremos la "versi√≥n verde" de la aplicaci√≥n y la regla correspondiente en la direcci√≥n del tr√°fico ejecutando los siguientes comandos: <br><br><pre> <code class="bash hljs">$ kubectl delete -f resource-manifests/kube/ab-testing/sa-frontend-green-deployment.yaml deployment.extensions ‚Äúsa-frontend-green‚Äù deleted $ kubectl delete -f resource-manifests/istio/ab-testing/destinationrule-sa-frontend.yaml destinationrule.networking.istio.io ‚Äúsa-frontend‚Äù deleted</code> </pre> <br><h2>  Mirroring: servicios virtuales en la pr√°ctica </h2><br>  El sombreado <i>("blindaje")</i> o el reflejo <i>("reflejo")</i> se usa en aquellos casos en los que queremos probar un cambio en la producci√≥n sin afectar a los usuarios finales: para esto duplicamos las solicitudes ("espejo") para la segunda instancia, donde se realizan los cambios necesarios, y mira las consecuencias.  <i>En pocas palabras, esto es cuando su (a) colega selecciona el problema m√°s cr√≠tico y hace una solicitud de extracci√≥n en forma de un trozo de suciedad tan grande que nadie puede realmente hacerle una revisi√≥n.</i> <br><br>  Para probar este escenario en acci√≥n, cree una segunda instancia de SA-Logic con errores ( <code>buggy</code> ) ejecutando el siguiente comando: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/kube/shadowing/sa-logic-service-buggy.yaml deployment.extensions/sa-logic-buggy created</code> </pre> <br>  Y ahora ejecutamos el comando para asegurarnos de que todas las instancias con <code>app=sa-logic</code> tengan etiquetas con las versiones correspondientes: <br><br><pre> <code class="bash hljs">$ kubectl get pods -l app=sa-logic --show-labels NAME READY LABELS sa-logic-568498cb4d-2sjwj 2/2 app=sa-logic,version=v1 sa-logic-568498cb4d-p4f8c 2/2 app=sa-logic,version=v1 sa-logic-buggy-76dff55847-2fl66 2/2 app=sa-logic,version=v2 sa-logic-buggy-76dff55847-kx8zz 2/2 app=sa-logic,version=v2</code> </pre> <br>  El servicio <code>sa-logic</code> dirige a los pods con la etiqueta <code>app=sa-logic</code> , por lo que todas las solicitudes se distribuir√°n entre todas las instancias: <br><br><img src="https://habrastorage.org/webt/6d/po/v8/6dpov8tnmom1j_sr7tcedj7bufo.png"><br><br>  ... pero queremos que las solicitudes se dirijan a instancias con la versi√≥n v1 y se reflejen en instancias con la versi√≥n v2: <br><br><img src="https://habrastorage.org/webt/7u/n6/aj/7un6aj7gerw57imbzmwgkwgjajw.png"><br><br>  Lo lograremos a trav√©s del VirtualService en combinaci√≥n con DestinationRule, donde las reglas determinar√°n los subconjuntos y rutas del VirtualService a un subconjunto particular. <br><br><h2>  Definici√≥n de subconjuntos en reglas de destino </h2><br>  <i>Los subconjuntos se</i> definen mediante la siguiente configuraci√≥n ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sa-logic-subsets-destinationrule.yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: sa-logic spec: host: sa-logic # 1 subsets: - name: v1 # 2 labels: version: v1 # 3 - name: v2 labels: version: v2</code> </pre> <br><ol><li>  El <code>host</code> determina que esta regla se aplica solo a los casos en que la ruta va hacia el servicio <code>sa-logic</code> ; </li><li>  Los nombres de los subconjuntos se utilizan al enrutar a instancias del subconjunto; </li><li>  Una etiqueta define los pares clave-valor que las instancias deben coincidir para formar parte de un subconjunto. </li></ol><br>  Aplique la configuraci√≥n con el siguiente comando: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/shadowing/sa-logic-subsets-destinationrule.yaml destinationrule.networking.istio.io/sa-logic created</code> </pre> <br>  Ahora que los subconjuntos est√°n definidos, puede continuar y configurar VirtualService para aplicar las reglas a las solicitudes de sa-logic para que: <br><br><ol><li>  Enrutado a un subconjunto de <code>v1</code> , </li><li>  Reflejado en un subconjunto de <code>v2</code> . </li></ol><br>  El siguiente manifiesto le permite lograr su plan ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sa-logic-subsets-shadowing-vs. Yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: sa-logic spec: hosts: - sa-logic http: - route: - destination: host: sa-logic subset: v1 mirror: host: sa-logic subset: v2</code> </pre> <br>  No se requiere explicaci√≥n aqu√≠, as√≠ que solo eche un vistazo a la acci√≥n: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/shadowing/sa-logic-subsets-shadowing-vs.yaml virtualservice.networking.istio.io/sa-logic created</code> </pre> <br>  Agregue la carga llamando a este comando: <br><br><pre> <code class="bash hljs">$ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> curl -v http://<span class="hljs-variable"><span class="hljs-variable">$EXTERNAL_IP</span></span>/sentiment \ -H <span class="hljs-string"><span class="hljs-string">"Content-type: application/json"</span></span> \ -d <span class="hljs-string"><span class="hljs-string">'{"sentence": "I love yogobella"}'</span></span>; \ sleep .8; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br>  Veamos los resultados en Grafana, donde podemos ver que la versi√≥n con <code>buggy</code> bloquea para ~ 60% de las solicitudes, pero ninguno de estos accidentes afecta a los usuarios finales porque tienen un servicio que funciona. <br><br><img src="https://habrastorage.org/webt/x3/g6/so/x3g6so65q5jmyjj48-_kjf254de.png"><br>  <i>√âxito de las respuestas de diferentes versiones del servicio sa-logic</i> <br><br>  Aqu√≠ vimos por primera vez c√≥mo se aplica VirtualService a los Enviados de nuestros servicios: cuando la aplicaci√≥n <code>sa-web-app</code> realiza una solicitud a <code>sa-logic</code> , pasa por el Enviado lateral, que, a trav√©s de VirtualService, est√° configurado para enrutar la solicitud al subconjunto v1 y espejo una solicitud a un subconjunto de v2 del <code>sa-logic</code> . <br><br>  Lo s√©: ya tuvo tiempo de pensar que los servicios virtuales son simples.  En la siguiente secci√≥n, ampliamos esta vista por el hecho de que tambi√©n son realmente magn√≠ficos. <br><br><h2>  Panecillos canarios </h2><br>  Canary Deployment es el proceso de implementar una nueva versi√≥n de una aplicaci√≥n para un peque√±o n√∫mero de usuarios.  Se utiliza para asegurarse de que no haya problemas en el lanzamiento y solo despu√©s de eso, ya confiando en su calidad (lanzamiento) suficiente, para extenderse a <i>un</i> p√∫blico m√°s amplio. <br><br>  Para demostrar los lanzamientos de canarios, continuaremos trabajando con un subconjunto de <code>buggy</code> en <code>sa-logic</code> . <br><br>  No perdamos el tiempo e inmediatamente enviemos el 20% de los usuarios a la versi√≥n con errores (representar√° nuestro lanzamiento canario), y el 80% restante al servicio normal.  Para hacer esto, aplique el siguiente VirtualService ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sa-logic-subsets-canary-vs.yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: sa-logic spec: hosts: - sa-logic http: - route: - destination: host: sa-logic subset: v1 weight: 80 # 1 - destination: host: sa-logic subset: v2 weight: 20 # 1</code> </pre> <br>  1 es el peso, que determina el porcentaje de solicitudes que se enviar√°n al destinatario o un subconjunto del destinatario. <br><br>  Actualice la configuraci√≥n anterior de VirtualService para <code>sa-logic</code> siguiente comando: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/canary/sa-logic-subsets-canary-vs.yaml virtualservice.networking.istio.io/sa-logic configured</code> </pre> <br>  ... e inmediatamente veo que parte de las solicitudes falla: <br><br><pre> <code class="bash hljs">$ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> \ curl -i http://<span class="hljs-variable"><span class="hljs-variable">$EXTERNAL_IP</span></span>/sentiment \ -H <span class="hljs-string"><span class="hljs-string">"Content-type: application/json"</span></span> \ -d <span class="hljs-string"><span class="hljs-string">'{"sentence": "I love yogobella"}'</span></span> \ --silent -w <span class="hljs-string"><span class="hljs-string">"Time: %{time_total}s \t Status: %{http_code}\n"</span></span> \ -o /dev/null; sleep .1; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> Time: 0.153075s Status: 200 Time: 0.137581s Status: 200 Time: 0.139345s Status: 200 Time: 30.291806s Status: 500</code> </pre> <br>  Los servicios virtuales activan los despliegues canarios: en este caso, redujimos las posibles consecuencias de los problemas al 20% de la base de usuarios.  Genial  Ahora, en cada caso, cuando no estamos seguros de nuestro c√≥digo (en otras palabras, siempre ...), podemos usar la duplicaci√≥n y los lanzamientos de canarios. <br><br><h2>  Tiempos de espera y reintentos </h2><br>  Pero no siempre hay errores en el c√≥digo.  En la lista de " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">8 errores en la inform√°tica distribuida</a> ", en primer lugar, aparece la opini√≥n err√≥nea de que "la red es confiable".  En realidad, la red <b>no</b> es confiable, y por esta raz√≥n necesitamos tiempos de espera y <i>reintentos</i> . <br><br>  Para la demostraci√≥n, continuaremos usando la misma versi√≥n de <code>sa-logic</code> ( <code>buggy</code> ), y simularemos la falta de fiabilidad de la red con fallas aleatorias. <br><br>  Deje que nuestro servicio con errores tenga una probabilidad de 1/3 de una respuesta que es demasiado larga, 1/3 para completar con un Error interno del servidor y 1/3 para una devoluci√≥n de p√°gina exitosa. <br><br>  Para mitigar las consecuencias de tales problemas y mejorar la vida de los usuarios, podemos: <br><br><ol><li>  agregue un tiempo de espera si el servicio responde durante m√°s de 8 segundos, </li><li>  vuelva a intentar si la solicitud falla. </li></ol><br>  Para la implementaci√≥n, utilizaremos la siguiente definici√≥n de recurso ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sa-logic-retries-timeouts-vs.yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: sa-logic spec: hosts: - sa-logic http: - route: - destination: host: sa-logic subset: v1 weight: 50 - destination: host: sa-logic subset: v2 weight: 50 timeout: 8s # 1 retries: attempts: 3 # 2 perTryTimeout: 3s # 3</code> </pre> <br><ol><li>  El tiempo de espera para la solicitud se establece en 8 segundos; </li><li>  Los intentos de solicitud repetidos se realizan 3 veces; </li><li>  Y cada intento se considera infructuoso si el tiempo de respuesta supera los 3 segundos. </li></ol><br>  Por lo tanto, hemos logrado la optimizaci√≥n, porque el usuario no tiene que esperar m√°s de 8 segundos y haremos tres nuevos intentos para obtener una respuesta en caso de fallas, aumentando la posibilidad de una respuesta exitosa. <br><br>  Aplique la configuraci√≥n actualizada con el siguiente comando: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/retries/sa-logic-retries-timeouts-vs.yaml virtualservice.networking.istio.io/sa-logic configured</code> </pre> <br>  Y compruebe en los gr√°ficos de Grafana que el n√∫mero de respuestas exitosas ha terminado: <br><br><img src="https://habrastorage.org/webt/ee/l_/qs/eel_qsg8z2vwzjwi35xmqg6eiko.png"><br>  <i>Mejoras en las estad√≠sticas de respuestas exitosas despu√©s de agregar tiempos de espera y reintentos</i> <br><br>  Antes de pasar a la siguiente secci√≥n <i>(o mejor dicho, a la siguiente parte del art√≠culo, porque no habr√° m√°s experimentos en esta pr√°ctica, aprox. Transl.)</i> , Elimine <code>sa-logic-buggy</code> y VirtualService ejecutando los siguientes comandos: <br><br><pre> <code class="bash hljs">$ kubectl delete deployment sa-logic-buggy deployment.extensions ‚Äúsa-logic-buggy‚Äù deleted $ kubectl delete virtualservice sa-logic virtualservice.networking.istio.io ‚Äúsa-logic‚Äù deleted</code> </pre> <br><h2>  Disyuntores y patrones de mamparo </h2><br>  Estamos hablando de dos patrones importantes en la arquitectura de microservicios que le permiten lograr servicios de <i>autocuraci√≥n</i> . <br><br>  <b>El disyuntor</b> <i>("disyuntor") se</i> usa para detener las solicitudes que llegan a una instancia de un servicio que no se considera saludable y restaurarlo mientras las solicitudes del cliente se redirigen a instancias saludables de este servicio (lo que aumenta el porcentaje de respuestas exitosas).  <i>(Nota: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠</a> se puede encontrar una descripci√≥n m√°s detallada del patr√≥n, por ejemplo).</i> <br><br>  <b>Bulkhead</b> <i>("partici√≥n")</i> a√≠sla las fallas de servicio de la derrota de todo el sistema.  Por ejemplo, el servicio B est√° roto y otro servicio (el cliente del servicio B) realiza una solicitud al servicio B, como resultado de lo cual utilizar√° su grupo de subprocesos y no podr√° atender otras solicitudes (incluso si no est√°n relacionadas con el servicio B).  <i>(Nota: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠</a> se puede encontrar una descripci√≥n m√°s detallada del patr√≥n, por ejemplo).</i> <br><br>  Omitir√© los detalles sobre la implementaci√≥n de estos patrones, porque son f√°ciles de encontrar en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n oficial</a> , y realmente quiero mostrar autenticaci√≥n y autorizaci√≥n, que se discutir√°n en la siguiente parte del art√≠culo. <br><br><h2>  PD del traductor </h2><br>  Lea tambi√©n en nuestro blog: <br><br><ul><li>  "Volver a los microservicios con Istio": <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 1 (familiaridad con las caracter√≠sticas principales)</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 3 (autenticaci√≥n y autorizaci√≥n)</a> ; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Conducto: una malla de servicio ligera para Kubernetes</a> "; </li><li>  ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øQu√© es una malla de servicio y por qu√© la necesito [para una aplicaci√≥n en la nube con microservicios]?</a>  ". </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440378/">https://habr.com/ru/post/440378/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440366/index.html">Ciclo de vida de un art√≠culo sobre Habr√©: escribimos un habraparser</a></li>
<li><a href="../440370/index.html">T√©rminos de servicio: el 99% de los usuarios simplemente no los entienden</a></li>
<li><a href="../440372/index.html">Mi compilador Pascal y arte contempor√°neo polaco</a></li>
<li><a href="../440374/index.html">Las funciones de Yandex env√≠an correo</a></li>
<li><a href="../440376/index.html">20 juegos para ense√±arle a tu hijo a programar</a></li>
<li><a href="../440382/index.html">¬ø200 es bueno o malo?</a></li>
<li><a href="../440386/index.html">Liberando el manejo de errores eliminando errores</a></li>
<li><a href="../440388/index.html">Intervalos: la pr√≥xima evoluci√≥n de C ++</a></li>
<li><a href="../440390/index.html">El mundo diverso de los sistemas embebidos y el lugar de Embox en √©l.</a></li>
<li><a href="../440392/index.html">WebRTC en su sitio: sin errores ni presupuesto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>