<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸˆšï¸ â˜ï¸ ğŸ’™ æˆ‘ä»¬å¦‚ä½•å°†TensorflowæœåŠ¡ç”Ÿäº§ç‡æé«˜70ï¼… ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ â¯ï¸ ğŸ…¾ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tensorflowå·²æˆä¸ºæœºå™¨å­¦ä¹ ï¼ˆMLï¼‰çš„æ ‡å‡†å¹³å°ï¼Œåœ¨è¡Œä¸šå’Œç ”ç©¶ä¸­éƒ½éå¸¸æµè¡Œã€‚ å·²ç»åˆ›å»ºäº†è®¸å¤šå…è´¹çš„åº“ï¼Œå·¥å…·å’Œæ¡†æ¶æ¥è®­ç»ƒå’Œç»´æŠ¤MLæ¨¡å‹ã€‚ Tensorflow Servingé¡¹ç›®æœ‰åŠ©äºåœ¨åˆ†å¸ƒå¼ç”Ÿäº§ç¯å¢ƒä¸­ç»´æŠ¤MLæ¨¡å‹ã€‚ 

 æˆ‘ä»¬çš„MuxæœåŠ¡åœ¨åŸºç¡€æ¶æ„çš„å¤šä¸ªéƒ¨åˆ†ä½¿ç”¨Tensorflow Servin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æˆ‘ä»¬å¦‚ä½•å°†TensorflowæœåŠ¡ç”Ÿäº§ç‡æé«˜70ï¼…</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445928/"> Tensorflowå·²æˆä¸ºæœºå™¨å­¦ä¹ ï¼ˆMLï¼‰çš„æ ‡å‡†å¹³å°ï¼Œåœ¨è¡Œä¸šå’Œç ”ç©¶ä¸­éƒ½éå¸¸æµè¡Œã€‚ å·²ç»åˆ›å»ºäº†è®¸å¤šå…è´¹çš„åº“ï¼Œå·¥å…·å’Œæ¡†æ¶æ¥è®­ç»ƒå’Œç»´æŠ¤MLæ¨¡å‹ã€‚  Tensorflow Servingé¡¹ç›®æœ‰åŠ©äºåœ¨åˆ†å¸ƒå¼ç”Ÿäº§ç¯å¢ƒä¸­ç»´æŠ¤MLæ¨¡å‹ã€‚ <br><br> æˆ‘ä»¬çš„MuxæœåŠ¡åœ¨åŸºç¡€æ¶æ„çš„å¤šä¸ªéƒ¨åˆ†ä½¿ç”¨Tensorflow Servingï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºè¿‡Tensorflow Servingåœ¨è§†é¢‘æ ‡é¢˜ç¼–ç ä¸­çš„ä½¿ç”¨ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äºé€šè¿‡ä¼˜åŒ–é¢„æµ‹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¥æ”¹å–„å»¶è¿Ÿçš„æ–¹æ³•ã€‚ æ¨¡å‹é¢„æµ‹é€šå¸¸æ˜¯â€œåœ¨çº¿â€æ“ä½œï¼ˆåœ¨è¯·æ±‚åº”ç”¨ç¨‹åºçš„å…³é”®è·¯å¾„ä¸Šï¼‰ï¼Œå› æ­¤ï¼Œä¼˜åŒ–çš„ä¸»è¦ç›®æ ‡æ˜¯ä»¥å°½å¯èƒ½ä½çš„å»¶è¿Ÿå¤„ç†å¤§é‡è¯·æ±‚ã€‚ <br><a name="habracut"></a><br><h1> ä»€ä¹ˆæ˜¯TensorflowæœåŠ¡ï¼Ÿ </h1><br>  Tensorflow Servingæä¾›äº†ç”¨äºéƒ¨ç½²å’Œç»´æŠ¤MLæ¨¡å‹çš„çµæ´»æœåŠ¡å™¨æ¶æ„ã€‚ è®­ç»ƒå¥½æ¨¡å‹å¹¶å‡†å¤‡å°†å…¶ç”¨äºé¢„æµ‹åï¼ŒTensorflow Servingéœ€è¦å°†å…¶å¯¼å‡ºä¸ºå…¼å®¹ï¼ˆå¯æœåŠ¡ï¼‰æ ¼å¼ã€‚ <br><br>  <i>Servable</i>æ˜¯åŒ…è£…Tensorflowå¯¹è±¡çš„ä¸­å¤®æŠ½è±¡ã€‚ ä¾‹å¦‚ï¼Œæ¨¡å‹å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå¯æœåŠ¡å¯¹è±¡ã€‚ å› æ­¤ï¼ŒServableæ˜¯å®¢æˆ·ç«¯ç”¨äºæ‰§è¡Œè®¡ç®—çš„åŸºæœ¬å¯¹è±¡ã€‚ å¯ä½¿ç”¨çš„å¤§å°å¾ˆé‡è¦ï¼šè¾ƒå°çš„å‹å·å ç”¨è¾ƒå°‘çš„ç©ºé—´ï¼Œä½¿ç”¨è¾ƒå°‘çš„å†…å­˜å¹¶ä¸”åŠ è½½é€Ÿåº¦æ›´å¿«ã€‚ è¦ä½¿ç”¨Predict APIä¸‹è½½å’Œç»´æŠ¤ï¼Œæ¨¡å‹å¿…é¡»ä¸ºSavedModelæ ¼å¼ã€‚ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20b/9f9/47e/20b9f947ea0f318dc7c2eba619b3901f.png"><br><br>  Tensorflow Servingç»“åˆäº†åŸºæœ¬ç»„ä»¶ï¼Œåˆ›å»ºäº†ä¸€ä¸ªgRPC / HTTPæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å¯ä¸ºå¤šä¸ªMLæ¨¡å‹ï¼ˆæˆ–å¤šä¸ªç‰ˆæœ¬ï¼‰æä¾›æœåŠ¡ï¼Œæä¾›ç›‘è§†ç»„ä»¶å’Œè‡ªå®šä¹‰æ¶æ„ã€‚ <br><br><h1>  Tensorflowä¸DockeræœåŠ¡ </h1><br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½¿ç”¨æ ‡å‡†Tensorflow Servingè®¾ç½®ï¼ˆæ— éœ€CPUä¼˜åŒ–ï¼‰é¢„æµ‹æ€§èƒ½çš„å»¶è¿Ÿçš„åŸºæœ¬æŒ‡æ ‡ã€‚ <br><br> é¦–å…ˆï¼Œä»TensorFlow Dockeré›†çº¿å™¨ä¸‹è½½æœ€æ–°æ˜ åƒï¼š <br><br><pre><code class="bash hljs">docker pull tensorflow/serving:latest</code> </pre> <br> åœ¨æœ¬æ–‡ä¸­ï¼Œæ‰€æœ‰å®¹å™¨éƒ½åœ¨å…·æœ‰å››ä¸ªå†…æ ¸ï¼ˆ15 GBï¼ŒUbuntu 16.04ï¼‰çš„ä¸»æœºä¸Šè¿è¡Œã€‚ <br><br><h3> å°†Tensorflowæ¨¡å‹å¯¼å‡ºåˆ°SavedModel </h3><br> å½“ä½¿ç”¨Tensorflowè®­ç»ƒæ¨¡å‹æ—¶ï¼Œå¯ä»¥å°†è¾“å‡ºä¿å­˜ä¸ºå˜é‡æ§åˆ¶ç‚¹ï¼ˆç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼‰ã€‚ é€šè¿‡æ¢å¤æ¨¡å‹çš„æ§åˆ¶ç‚¹æˆ–ä»¥å†»ç»“çš„å†»ç»“å›¾å½¢æ ¼å¼ï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ç›´æ¥æ‰§è¡Œè¾“å‡ºã€‚ <br><br> å¯¹äºTensorflow Servingï¼Œæ­¤å†»ç»“çš„å›¾éœ€è¦å¯¼å‡ºä¸ºSavedModelæ ¼å¼ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Tensorflowæ–‡æ¡£</a>åŒ…å«å°†ç»è¿‡è®­ç»ƒçš„æ¨¡å‹å¯¼å‡ºä¸ºSavedModelæ ¼å¼çš„ç¤ºä¾‹ã€‚ <br><br>  Tensorflowè¿˜æä¾›è®¸å¤š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹å’Œç ”ç©¶</a>æ¨¡å‹ï¼Œä½œä¸ºè¿›è¡Œå®éªŒï¼Œç ”ç©¶æˆ–ç”Ÿäº§çš„èµ·ç‚¹ã€‚ <br><br> ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ·±åº¦æ®‹ç•™ç¥ç»ç½‘ç»œï¼ˆResNetï¼‰æ¨¡å‹</a>å¯¹1000ä¸ªç±»åˆ«çš„ImageNetæ•°æ®é›†è¿›è¡Œåˆ†ç±»ã€‚ ä¸‹è½½ç»è¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¢„å…ˆ</a> <code>ResNet-50 v2</code>æ¨¡å‹ï¼Œå°¤å…¶æ˜¯SavedModelä¸­çš„Channels_lastï¼ˆNHWCï¼‰ <i>é€‰é¡¹</i> ï¼šé€šå¸¸ï¼Œå®ƒåœ¨CPUä¸Šæ•ˆæœæ›´å¥½ã€‚ <br><br> å°†RestNetæ¨¡å‹ç›®å½•å¤åˆ¶åˆ°ä»¥ä¸‹ç»“æ„ä¸­ï¼š <br><br><pre> <code class="plaintext hljs">models/ 1/ saved_model.pb variables/ variables.data-00000-of-00001 variables.index</code> </pre> <br>  Tensorflow Servingå¸Œæœ›ä½¿ç”¨æ•°å­—æ’åºçš„ç›®å½•ç»“æ„è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚ åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œç›®å½•<code>1/</code>å¯¹åº”äºç‰ˆæœ¬1æ¨¡å‹ï¼Œå…¶ä¸­åŒ…å«å¸¦æœ‰æ¨¡å‹æƒé‡ï¼ˆå˜é‡ï¼‰å¿«ç…§çš„<code>saved_model.pb</code>æ¨¡å‹<code>saved_model.pb</code> ã€‚ <br><br><h3> åŠ è½½å’Œå¤„ç†SavedModel </h3><br> ä»¥ä¸‹å‘½ä»¤åœ¨Dockerå®¹å™¨ä¸­å¯åŠ¨Tensorflow Servingæ¨¡å‹æœåŠ¡å™¨ã€‚ è¦åŠ è½½SavedModelï¼Œå¿…é¡»å°†æ¨¡å‹ç›®å½•å®‰è£…åœ¨é¢„æœŸçš„å®¹å™¨ç›®å½•ä¸­ã€‚ <br><br><pre> <code class="plaintext hljs">docker run -d -p 9000:8500 \ -v $(pwd)/models:/models/resnet -e MODEL_NAME=resnet \ -t tensorflow/serving:latest</code> </pre> <br> æ£€æŸ¥å®¹å™¨æ—¥å¿—åï¼Œè¡¨æ˜ModelServerå·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œï¼Œä»¥å¤„ç†gRPCå’ŒHTTPç«¯ç‚¹å¯¹<code>resnet</code>æ¨¡å‹çš„è¾“å‡ºè¯·æ±‚ï¼š <br><br><pre> <code class="plaintext hljs">... I tensorflow_serving/core/loader_harness.cc:86] Successfully loaded servable version {name: resnet version: 1} I tensorflow_serving/model_servers/server.cc:286] Running gRPC ModelServer at 0.0.0.0:8500 ... I tensorflow_serving/model_servers/server.cc:302] Exporting HTTP/REST API at:localhost:8501 ...</code> </pre> <br><h3> é¢„æµ‹å®¢æˆ· </h3><br>  Tensorflow Servingä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åè®®ç¼“å†²åŒº</a> ï¼ˆprotobufsï¼‰æ ¼å¼å®šä¹‰APIæ¨¡å¼ã€‚ é¢„æµ‹APIçš„GRPCå®¢æˆ·ç«¯å®ç°æ‰“åŒ…ä¸ºPythonåŒ…<code>tensorflow_serving.apis</code> ã€‚ æˆ‘ä»¬å°†éœ€è¦å¦ä¸€ä¸ªPythonè½¯ä»¶åŒ…<code>tensorflow</code>ç”¨äºå®ç”¨ç¨‹åºåŠŸèƒ½ã€‚ <br><br> å®‰è£…ä¾èµ–é¡¹ä»¥åˆ›å»ºä¸€ä¸ªç®€å•çš„å®¢æˆ·ç«¯ï¼š <br><br><pre> <code class="plaintext hljs">virtualenv .env &amp;&amp; source .env/bin/activate &amp;&amp; \ pip install numpy grpcio opencv-python tensorflow tensorflow-serving-api</code> </pre> <br>  <code>ResNet-50 v2</code>æ¨¡å‹æœŸæœ›ä»¥æ ¼å¼åŒ–çš„channels_lastï¼ˆNHWCï¼‰æ•°æ®ç»“æ„è¾“å…¥æµ®ç‚¹å¼ é‡ã€‚ å› æ­¤ï¼Œä½¿ç”¨opencv-pythonè¯»å–è¾“å…¥å›¾åƒï¼Œå¹¶å°†å…¶ä½œä¸ºfloat32æ•°æ®ç±»å‹åŠ è½½åˆ°numpyæ•°ç»„ï¼ˆé«˜åº¦Ã—å®½åº¦Ã—é€šé“ï¼‰ä¸­ã€‚ ä¸‹é¢çš„è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªé¢„æµ‹å®¢æˆ·ç«¯å­˜æ ¹ï¼Œå¹¶å°†JPEGæ•°æ®åŠ è½½åˆ°numpyæ•°ç»„ä¸­ï¼Œå°†å…¶è½¬æ¢ä¸ºtensor_protoä»¥å‘å‡ºå¯¹gRPCçš„é¢„æµ‹è¯·æ±‚ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python from __future__ import print_function import argparse import numpy as np import time tt = time.time() import cv2 import tensorflow as tf from grpc.beta import implementations from tensorflow_serving.apis import predict_pb2 from tensorflow_serving.apis import prediction_service_pb2 parser = argparse.ArgumentParser(description='incetion grpc client flags.') parser.add_argument('--host', default='0.0.0.0', help='inception serving host') parser.add_argument('--port', default='9000', help='inception serving port') parser.add_argument('--image', default='', help='path to JPEG image file') FLAGS = parser.parse_args() def main(): # create prediction service client stub channel = implementations.insecure_channel(FLAGS.host, int(FLAGS.port)) stub = prediction_service_pb2.beta_create_PredictionService_stub(channel) # create request request = predict_pb2.PredictRequest() request.model_spec.name = 'resnet' request.model_spec.signature_name = 'serving_default' # read image into numpy array img = cv2.imread(FLAGS.image).astype(np.float32) # convert to tensor proto and make request # shape is in NHWC (num_samples x height x width x channels) format tensor = tf.contrib.util.make_tensor_proto(img, shape=[1]+list(img.shape)) request.inputs['input'].CopyFrom(tensor) resp = stub.Predict(request, 30.0) print('total time: {}s'.format(time.time() - tt)) if __name__ == '__main__': main()</span></span></code> </pre> <br> æ”¶åˆ°JPEGè¾“å…¥åï¼Œå·¥ä½œä¸­çš„å®¢æˆ·ç«¯å°†äº§ç”Ÿä»¥ä¸‹ç»“æœï¼š <br><br><pre> <code class="bash hljs">python tf_serving_client.py --image=images/pupper.jpg total time: 2.56152906418s</code> </pre> <br> æ‰€å¾—å¼ é‡åŒ…å«æ•´æ•°å€¼å’Œç¬¦å·æ¦‚ç‡å½¢å¼çš„é¢„æµ‹ã€‚ <br><br><pre> <code class="python hljs">outputs { key: <span class="hljs-string"><span class="hljs-string">"classes"</span></span> value { dtype: DT_INT64 tensor_shape { dim { size: <span class="hljs-number"><span class="hljs-number">1</span></span> } } int64_val: <span class="hljs-number"><span class="hljs-number">238</span></span> } } outputs { key: <span class="hljs-string"><span class="hljs-string">"probabilities"</span></span> ...</code> </pre> <br> å¯¹äºå•ä¸ªè¯·æ±‚ï¼Œè¿™æ ·çš„å»¶è¿Ÿæ˜¯ä¸å¯æ¥å—çš„ã€‚ ä½†æ˜¯å¹¶ä¸å¥‡æ€ªï¼šTensorflow ServingäºŒè¿›åˆ¶æ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹æ˜¯é’ˆå¯¹å¤§å¤šæ•°ç”¨ä¾‹è®¾è®¡çš„ï¼Œé€‚ç”¨äºæœ€å¹¿æ³›çš„è®¾å¤‡ã€‚ æ‚¨å¯èƒ½åœ¨æ ‡å‡†TensorflowæœåŠ¡å®¹å™¨çš„æ—¥å¿—ä¸­æ³¨æ„åˆ°ä»¥ä¸‹å‡ è¡Œï¼š <br><br><pre> <code class="plaintext hljs">I external/org_tensorflow/tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA</code> </pre> <br> è¿™è¡¨ç¤ºåœ¨å°šæœªå¯¹å…¶è¿›è¡Œä¼˜åŒ–çš„CPUå¹³å°ä¸Šè¿è¡Œçš„TensorFlow ServingäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ <br><br><h3> æ„å»ºä¼˜åŒ–çš„äºŒè¿›åˆ¶æ–‡ä»¶ </h3><br> æ ¹æ®Tensorflow <a href="">æ–‡æ¡£</a> ï¼Œå»ºè®®ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å°†åœ¨å…¶ä¸Šè¿è¡Œçš„ä¸»æœºä¸Šçš„CPUçš„æ‰€æœ‰ä¼˜åŒ–æ–¹æ³•ä»æºä»£ç ç¼–è¯‘Tensorflowã€‚ ç»„è£…æ—¶ï¼Œç‰¹æ®Šæ ‡å¿—å¯æ¿€æ´»ç‰¹å®šå¹³å°çš„CPUæŒ‡ä»¤é›†ï¼š <br><br><div class="scrollable-table"><table><tbody><tr><th> æŒ‡ä»¤é›† </th><th> æ ‡å¿— </th></tr><tr><td>  AVX </td><td>  --copt = -mavx </td></tr><tr><td>  AVX2 </td><td>  --copt = -mavx2 </td></tr><tr><td>  Fma </td><td>  --copt = -mfma </td></tr><tr><td> ä¸Šè¯4.1 </td><td>  --copt = -msse4.1 </td></tr><tr><td> ä¸Šè¯4.2 </td><td>  --copt = -msse4.2 </td></tr><tr><td> å…¨éƒ¨å—å¤„ç†å™¨æ”¯æŒ </td><td>  --copt = -march =æœ¬æœº </td></tr></tbody></table></div><br> å…‹éš†ç‰¹å®šç‰ˆæœ¬çš„TensorflowæœåŠ¡ã€‚ åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯1.13ï¼ˆæœ¬æ–‡å‘å¸ƒæ—¶çš„æœ€åä¸€ä¸ªï¼‰ï¼š <br><br><pre> <code class="bash hljs">USER=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> TAG=<span class="hljs-variable"><span class="hljs-variable">$2</span></span> TF_SERVING_VERSION_GIT_BRANCH=<span class="hljs-string"><span class="hljs-string">"r1.13"</span></span> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> --branch=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TF_SERVING_VERSION_GIT_BRANCH</span></span></span><span class="hljs-string">"</span></span> https://github.com/tensorflow/serving</code> </pre> <br>  Tensorflow Servingå¼€å‘äººå‘˜å›¾åƒä½¿ç”¨Baselå·¥å…·è¿›è¡Œæ„å»ºã€‚ æˆ‘ä»¬ä¸ºç‰¹å®šçš„CPUæŒ‡ä»¤é›†é…ç½®å®ƒï¼š <br><br><pre> <code class="bash hljs">TF_SERVING_BUILD_OPTIONS=<span class="hljs-string"><span class="hljs-string">"--copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-msse4.1 --copt=-msse4.2"</span></span></code> </pre> <br> å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œè¯·åœ¨æ ‡å¿—<code>--local_resources=2048,.5,1.0</code>è¿‡ç¨‹ä¸­ä½¿ç”¨<code>--local_resources=2048,.5,1.0</code>æ ‡å¿—é™åˆ¶å†…å­˜æ¶ˆè€—ã€‚ æœ‰å…³æ ‡å¿—çš„ä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Tensorflow Servingå’ŒDocker</a>å¸®åŠ©ä»¥åŠ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Bazelæ–‡æ¡£</a> ã€‚ <br><br> æ ¹æ®ç°æœ‰å›¾åƒåˆ›å»ºä¸€ä¸ªå·¥ä½œå›¾åƒï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash USER=$1 TAG=$2 TF_SERVING_VERSION_GIT_BRANCH="r1.13" git clone --branch="${TF_SERVING_VERSION_GIT_BRANCH}" https://github.com/tensorflow/serving TF_SERVING_BUILD_OPTIONS="--copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-msse4.1 --copt=-msse4.2" cd serving &amp;&amp; \ docker build --pull -t $USER/tensorflow-serving-devel:$TAG \ --build-arg TF_SERVING_VERSION_GIT_BRANCH="${TF_SERVING_VERSION_GIT_BRANCH}" \ --build-arg TF_SERVING_BUILD_OPTIONS="${TF_SERVING_BUILD_OPTIONS}" \ -f tensorflow_serving/tools/docker/Dockerfile.devel . cd serving &amp;&amp; \ docker build -t $USER/tensorflow-serving:$TAG \ --build-arg TF_SERVING_BUILD_IMAGE=$USER/tensorflow-serving-devel:$TAG \ -f tensorflow_serving/tools/docker/Dockerfile .</span></span></code> </pre> <br> ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TensorFlowæ ‡å¿—</a>é…ç½®ModelServerä»¥æ”¯æŒå¹¶å‘ã€‚ ä»¥ä¸‹é€‰é¡¹å°†ä¸¤ä¸ªçº¿ç¨‹æ± é…ç½®ä¸ºå¹¶è¡Œæ“ä½œï¼š <br><br><pre> <code class="plaintext hljs">intra_op_parallelism_threads</code> </pre> <br><ul><li> æ§åˆ¶ä¸€ä¸ªæ“ä½œå¹¶è¡Œæ‰§è¡Œçš„æœ€å¤§çº¿ç¨‹æ•°ï¼› <br></li><li> ç”¨äºå¹¶è¡ŒåŒ–å…·æœ‰æœ¬è´¨ä¸Šç‹¬ç«‹çš„å­æ“ä½œçš„æ“ä½œã€‚ </li></ul><br><pre> <code class="plaintext hljs">inter_op_parallelism_threads</code> </pre> <br><ul><li> æ§åˆ¶å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹æ“ä½œçš„æœ€å¤§çº¿ç¨‹æ•°ï¼› <br></li><li>  Tensorflow Graphæ“ä½œå½¼æ­¤ç‹¬ç«‹ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ </li></ul><br> é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªå‚æ•°éƒ½è®¾ç½®ä¸º<code>0</code> ã€‚ è¿™æ„å‘³ç€ç³»ç»Ÿæœ¬èº«ä¼šé€‰æ‹©é€‚å½“çš„æ•°å­—ï¼Œè¿™é€šå¸¸æ„å‘³ç€æ¯ä¸ªå†…æ ¸ä¸€ä¸ªçº¿ç¨‹ã€‚ ä½†æ˜¯ï¼Œå¯ä»¥ä¸ºå¤šæ ¸å¹¶å‘æ‰‹åŠ¨æ›´æ”¹è¯¥å‚æ•°ã€‚ <br><br> ç„¶åä»¥ä¸ä¸Šä¸€ä¸ªç›¸åŒçš„æ–¹å¼è¿è¡ŒServingå®¹å™¨ï¼Œè¿™æ¬¡ä½¿ç”¨ä»æºä»£ç ç¼–è¯‘çš„Dockeræ˜ åƒï¼Œå¹¶ä½¿ç”¨é’ˆå¯¹ç‰¹å®šå¤„ç†å™¨çš„Tensorflowä¼˜åŒ–æ ‡å¿—ï¼š <br><br><pre> <code class="bash hljs">docker run -d -p 9000:8500 \ -v $(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>)/models:/models/resnet -e MODEL_NAME=resnet \ -t <span class="hljs-variable"><span class="hljs-variable">$USER</span></span>/tensorflow-serving:<span class="hljs-variable"><span class="hljs-variable">$TAG</span></span> \ --tensorflow_intra_op_parallelism=4 \ --tensorflow_inter_op_parallelism=4</code> </pre> <br> å®¹å™¨æ—¥å¿—ä¸åº”å†æ˜¾ç¤ºæœ‰å…³æœªå®šä¹‰CPUçš„è­¦å‘Šã€‚ åœ¨ä¸æ›´æ”¹åŒä¸€é¢„æµ‹è¯·æ±‚çš„ä»£ç çš„æƒ…å†µä¸‹ï¼Œå»¶è¿Ÿå‡å°‘äº†çº¦35.8ï¼…ï¼š <br><br><pre> <code class="bash hljs">python tf_serving_client.py --image=images/pupper.jpg total time: 1.64234706879s</code> </pre> <br><h3> æé«˜å®¢æˆ·é¢„æµ‹é€Ÿåº¦ </h3><br> è¿˜æœ‰åŠ é€Ÿçš„å¯èƒ½å—ï¼Ÿ æˆ‘ä»¬å·²ç»ä¸ºCPUä¼˜åŒ–äº†æœåŠ¡å™¨ç«¯ï¼Œä½†æ˜¯å»¶è¿Ÿè¶…è¿‡1ç§’ä¼¼ä¹ä»ç„¶å¤ªå¤§ã€‚ <br><br> ç¢°å·§ï¼ŒåŠ è½½<code>tensorflow_serving</code>å’Œ<code>tensorflow</code>åº“ä¼šå¯¹å»¶è¿Ÿäº§ç”Ÿé‡å¤§å½±å“ã€‚ å¯¹<code>tf.contrib.util.make_tensor_proto</code>æ¯ä¸ªä¸å¿…è¦çš„è°ƒç”¨ä¹Ÿä¼šå¢åŠ ä¸€ç§’é’Ÿçš„æ—¶é—´ã€‚ <br><br> æ‚¨å¯èƒ½ä¼šé—®ï¼šâ€œæˆ‘ä»¬æ˜¯å¦ä¸éœ€è¦TensorFlow Pythonè½¯ä»¶åŒ…æ¥å®é™…å‘TensorflowæœåŠ¡å™¨å‘å‡ºé¢„æµ‹è¯·æ±‚ï¼Ÿâ€ å®é™…ä¸Šï¼Œå®é™…ä¸Šå¹¶ä¸<i>éœ€è¦</i> <code>tensorflow_serving</code>å’Œ<code>tensorflow</code>åŒ…ã€‚ <br><br> å¦‚å‰æ‰€è¿°ï¼ŒTensorflowé¢„æµ‹APIè¢«å®šä¹‰ä¸ºåŸå‹ç¼“å†²åŒºã€‚ å› æ­¤ï¼Œå¯ä»¥å°†ä¸¤ä¸ªå¤–éƒ¨ä¾èµ–é¡¹æ›¿æ¢ä¸ºç›¸åº”çš„<code>tensorflow</code>å’Œ<code>tensorflow_serving</code> -ç„¶åæ‚¨æ— éœ€åœ¨å®¢æˆ·ç«¯ä¸Šæå–æ•´ä¸ªï¼ˆæ²‰é‡çš„ï¼‰Tensorflowåº“ã€‚ <br><br> é¦–å…ˆï¼Œæ‘†è„±<code>tensorflow</code>å’Œ<code>tensorflow_serving</code>å¹¶æ·»åŠ <code>grpcio-tools</code>åŒ…ã€‚ <br><br><pre> <code class="bash hljs">pip uninstall tensorflow tensorflow-serving-api &amp;&amp; \ pip install grpcio-tools==1.0.0</code> </pre> <br> å…‹éš†<code>tensorflow/tensorflow</code>å’Œ<code>tensorflow/serving</code>å­˜å‚¨åº“ï¼Œå¹¶å°†ä»¥ä¸‹protobufæ–‡ä»¶å¤åˆ¶åˆ°å®¢æˆ·ç«¯é¡¹ç›®ï¼š <br><br><pre> <code class="plaintext hljs">tensorflow/serving/ tensorflow_serving/apis/model.proto tensorflow_serving/apis/predict.proto tensorflow_serving/apis/prediction_service.proto tensorflow/tensorflow/ tensorflow/core/framework/resource_handle.proto tensorflow/core/framework/tensor_shape.proto tensorflow/core/framework/tensor.proto tensorflow/core/framework/types.proto</code> </pre> <br> å°†è¿™äº›protobufæ–‡ä»¶å¤åˆ¶åˆ°<code>protos/</code>ç›®å½•ï¼Œå¹¶ä¿ç•™åŸå§‹è·¯å¾„ï¼š <br><br><pre> <code class="plaintext hljs">protos/ tensorflow_serving/ apis/ *.proto tensorflow/ core/ framework/ *.proto</code> </pre> <br> ä¸ºäº†ç®€å•èµ·è§ï¼Œå¯ä»¥å°†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">prediction_service.proto</a>ç®€åŒ–ä¸ºä»…å®ç°Predict RPCï¼Œä»¥ä¾¿ä¸ä¸‹è½½æœåŠ¡ä¸­æŒ‡å®šçš„å…¶ä»–RPCçš„åµŒå¥—ä¾èµ–å…³ç³»ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™æ˜¯</a>ç®€åŒ–çš„<code>prediction_service.</code>çš„ç¤ºä¾‹ã€‚ <br><br> ä½¿ç”¨<code>grpcio.tools.protoc</code>åˆ›å»ºPython gRPCå®ç°ï¼š <br><br><pre> <code class="plaintext hljs">PROTOC_OUT=protos/ PROTOS=$(find . | grep "\.proto$") for p in $PROTOS; do python -m grpc.tools.protoc -I . --python_out=$PROTOC_OUT --grpc_python_out=$PROTOC_OUT $p done</code> </pre> <br> ç°åœ¨å¯ä»¥åˆ é™¤æ•´ä¸ª<code>tensorflow_serving</code>æ¨¡å—ï¼š <br><br><pre> <code class="plaintext hljs">from tensorflow_serving.apis import predict_pb2 from tensorflow_serving.apis import prediction_service_pb2</code> </pre> <br>  ...å¹¶æ›¿æ¢ä¸ºä»<code>protos/tensorflow_serving/apis</code>ç”Ÿæˆçš„protobuffersï¼š <br><br><pre> <code class="plaintext hljs">from protos.tensorflow_serving.apis import predict_pb2 from protos.tensorflow_serving.apis import prediction_service_pb2</code> </pre> <br> å¯¼å…¥Tensorflowåº“ä»¥ä½¿ç”¨è¾…åŠ©å‡½æ•°<code>make_tensor_proto</code> ï¼Œè¿™æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†</a> python / numpyå¯¹è±¡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŒ…è£…</a>ä¸ºTensorProtoå¯¹è±¡æ‰€å¿…éœ€çš„ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ›¿æ¢ä»¥ä¸‹ä¾èµ–é¡¹å’Œä»£ç ç‰‡æ®µï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensorflow <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tf ... tensor = tf.contrib.util.make_tensor_proto(features) request.inputs[<span class="hljs-string"><span class="hljs-string">'inputs'</span></span>].CopyFrom(tensor)</code> </pre> <br> å¯¼å…¥protobufferså¹¶æ„å»ºä¸€ä¸ªTensorProtoå¯¹è±¡ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> protos.tensorflow.core.framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensor_pb2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> protos.tensorflow.core.framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensor_shape_pb2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> protos.tensorflow.core.framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> types_pb2 ... <span class="hljs-comment"><span class="hljs-comment"># ensure NHWC shape and build tensor proto tensor_shape = [1]+list(img.shape) dims = [tensor_shape_pb2.TensorShapeProto.Dim(size=dim) for dim in tensor_shape] tensor_shape = tensor_shape_pb2.TensorShapeProto(dim=dims) tensor = tensor_pb2.TensorProto( dtype=types_pb2.DT_FLOAT, tensor_shape=tensor_shape, float_val=list(img.reshape(-1))) request.inputs['inputs'].CopyFrom(tensor)</span></span></code> </pre> <br> å®Œæ•´çš„Pythonè„šæœ¬åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a> ã€‚ è¿è¡Œæ›´æ–°çš„å…¥é—¨å®¢æˆ·ç«¯ï¼Œè¯¥å®¢æˆ·ç«¯é’ˆå¯¹ä¼˜åŒ–çš„Tensorflow Servingå‘å‡ºé¢„æµ‹è¯·æ±‚ï¼š <br><br><pre> <code class="bash hljs">python tf_inception_grpc_client.py --image=images/pupper.jpg total time: 0.58314920859s</code> </pre> <br> ä¸‹å›¾æ˜¾ç¤ºäº†ä¼˜åŒ–ç‰ˆæœ¬çš„Tensorflow Servingä¸æ ‡å‡†ç‰ˆæœ¬ç›¸æ¯”çš„é¢„æµ‹æ‰§è¡Œæ—¶é—´ï¼ˆè¿è¡Œ10å¤šæ¬¡ï¼‰ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/48d/990/b83/48d990b83dc54762fec809a580c450c8.png"><br><br> å¹³å‡å»¶è¿Ÿå‡å°‘äº†çº¦3.38å€ã€‚ <br><br><h1> å¸¦å®½ä¼˜åŒ– </h1><br>  TensorflowæœåŠ¡å¯ä»¥é…ç½®ä¸ºå¤„ç†å¤§é‡æ•°æ®ã€‚ å¸¦å®½ä¼˜åŒ–é€šå¸¸æ˜¯é’ˆå¯¹â€œç‹¬ç«‹â€æ‰¹å¤„ç†æ‰§è¡Œçš„ï¼Œå…¶ä¸­ä¸¥æ ¼çš„å»¶è¿Ÿè¾¹ç•Œä¸æ˜¯ä¸¥æ ¼çš„è¦æ±‚ã€‚ <br><br><h3> æœåŠ¡å™¨ç«¯æ‰¹å¤„ç† </h3><br> å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a>ä¸­æ‰€è¿°ï¼ŒTensorflow Servingæœ¬æœºæ”¯æŒæœåŠ¡å™¨ç«¯æ‰¹å¤„ç†ã€‚ <br><br> å»¶è¿Ÿå’Œååé‡ä¹‹é—´çš„æƒè¡¡ç”±æ‰¹å¤„ç†å‚æ•°ç¡®å®šã€‚ å®ƒä»¬ä½¿æ‚¨å¯ä»¥å®ç°ç¡¬ä»¶åŠ é€Ÿå™¨èƒ½å¤Ÿæä¾›çš„æœ€å¤§ååé‡ã€‚ <br><br> è¦å¯ç”¨æ‰“åŒ…ï¼Œè¯·è®¾ç½®<code>--enable_batching</code>å’Œ<code>--batching_parameters_file</code> ã€‚ æ ¹æ®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SessionBundleConfig</a>è®¾ç½®å‚æ•°ã€‚ å¯¹äºCPUä¸Šçš„ç³»ç»Ÿï¼Œå°†<code>num_batch_threads</code>è®¾ç½®ä¸ºå¯ç”¨å†…æ ¸æ•°ã€‚ å¯¹äºGPUï¼Œè¯·å‚é˜…<a href="">æ­¤å¤„</a>çš„é€‚å½“å‚æ•°ã€‚ <br><br> åœ¨æœåŠ¡å™¨ç«¯å¡«æ»¡æ•´ä¸ªç¨‹åºåŒ…åï¼Œå‘å¸ƒè¯·æ±‚å°†åˆå¹¶ä¸ºä¸€ä¸ªå¤§è¯·æ±‚ï¼ˆå¼ é‡ï¼‰ï¼Œå¹¶ä¸åˆå¹¶çš„è¯·æ±‚ä¸€èµ·å‘é€åˆ°Tensorflowä¼šè¯ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¡®å®æ¶‰åŠCPU / GPUå¹¶è¡Œæ€§ã€‚ <br><br>  Tensorflowæ‰¹å¤„ç†çš„ä¸€äº›å¸¸è§ç”¨é€”ï¼š <br><br><ul><li> ä½¿ç”¨å¼‚æ­¥å®¢æˆ·ç«¯è¯·æ±‚å¡«å……æœåŠ¡å™¨ç«¯æ•°æ®åŒ… <br></li><li> é€šè¿‡å°†æ¨¡å‹å›¾çš„ç»„ä»¶ä¼ è¾“åˆ°CPU / GPUï¼Œå¯ä»¥æ›´å¿«åœ°è¿›è¡Œæ‰¹å¤„ç† <br></li><li> åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šå¤„ç†æ¥è‡ªå¤šä¸ªæ¨¡å‹çš„è¯·æ±‚ <br></li><li> å¼ºçƒˆå»ºè®®å°†æ‰¹å¤„ç†ç”¨äºâ€œç¦»çº¿â€å¤„ç†å¤§é‡è¯·æ±‚ </li></ul><br><h3> å®¢æˆ·ç«¯æ‰¹å¤„ç† </h3><br> å®¢æˆ·ç«¯æ‰¹å¤„ç†å°†å‡ ä¸ªä¼ å…¥è¯·æ±‚åˆ†ç»„ä¸ºä¸€ä¸ªã€‚ <br><br> ç”±äºResNetæ¨¡å‹æ­£åœ¨ç­‰å¾…NHWCæ ¼å¼çš„è¾“å…¥ï¼ˆç¬¬ä¸€ä¸ªç»´åº¦æ˜¯è¾“å…¥æ•°ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªè¾“å…¥å›¾åƒç»„åˆæˆä¸€ä¸ªRPCè¯·æ±‚ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">... </span></span>batch = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> jpeg <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.listdir(FLAGS.images_path): path = os.path.join(FLAGS.images_path, jpeg) img = cv2.imread(path).astype(np.float32) batch.append(img) ... batch_np = np.array(batch).astype(np.float32) dims = [tensor_shape_pb2.TensorShapeProto.Dim(size=dim) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> dim <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> batch_np.shape] t_shape = tensor_shape_pb2.TensorShapeProto(dim=dims) tensor = tensor_pb2.TensorProto( dtype=types_pb2.DT_FLOAT, tensor_shape=t_shape, float_val=list(batched_np.reshape(<span class="hljs-number"><span class="hljs-number">-1</span></span>))) request.inputs[<span class="hljs-string"><span class="hljs-string">'inputs'</span></span>].CopyFrom(tensor)</code> </pre> <br> å¯¹äºNä¸ªå›¾åƒçš„æ•°æ®åŒ…ï¼Œå“åº”ä¸­çš„è¾“å‡ºå¼ é‡å°†åŒ…å«ç›¸åŒæ•°é‡è¾“å…¥çš„é¢„æµ‹ç»“æœã€‚ åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼ŒN = 2ï¼š <br><br><pre> <code class="python hljs">outputs { key: <span class="hljs-string"><span class="hljs-string">"classes"</span></span> value { dtype: DT_INT64 tensor_shape { dim { size: <span class="hljs-number"><span class="hljs-number">2</span></span> } } int64_val: <span class="hljs-number"><span class="hljs-number">238</span></span> int64_val: <span class="hljs-number"><span class="hljs-number">121</span></span> } } ...</code> </pre> <br><h1> ç¡¬ä»¶åŠ é€Ÿ </h1><br> å…³äºGPUçš„å‡ å¥è¯ã€‚ <br><br> å­¦ä¹ è¿‡ç¨‹è‡ªç„¶ä¼šåœ¨GPUä¸Šä½¿ç”¨å¹¶è¡ŒåŒ–ï¼Œå› ä¸ºæ·±åº¦ç¥ç»ç½‘ç»œçš„æ„å»ºéœ€è¦å¤§é‡è®¡ç®—æ‰èƒ½è·å¾—æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚ <br><br> ä½†æ˜¯å¯¹äºè¾“å‡ºç»“æœï¼Œå¹¶è¡ŒåŒ–ä¸æ˜¯å¾ˆæ˜æ˜¾ã€‚ é€šå¸¸ï¼Œæ‚¨å¯ä»¥åŠ å¿«ç¥ç»ç½‘ç»œå‘GPUçš„è¾“å‡ºé€Ÿåº¦ï¼Œä½†æ˜¯æ‚¨éœ€è¦ä»”ç»†é€‰æ‹©å’Œæµ‹è¯•è®¾å¤‡ï¼Œå¹¶è¿›è¡Œæ·±å…¥çš„æŠ€æœ¯å’Œç»æµåˆ†æã€‚ ç¡¬ä»¶å¹¶è¡ŒåŒ–å¯¹äºâ€œè‡ªæ²»â€ç»“è®ºï¼ˆå¤§é‡ï¼‰çš„æ‰¹å¤„ç†æ›´æœ‰ä»·å€¼ã€‚ <br><br> åœ¨è½¬å‘GPUä¹‹å‰ï¼Œè¯·ä»”ç»†è€ƒè™‘ä¸šåŠ¡éœ€æ±‚ï¼Œå¹¶ä»”ç»†åˆ†ææˆæœ¬ï¼ˆè´§å¸ï¼Œè¿è¥ï¼ŒæŠ€æœ¯ï¼‰ï¼Œä»¥è·å–æœ€å¤§åˆ©ç›Šï¼ˆå‡å°‘å»¶è¿Ÿï¼Œé«˜ååé‡ï¼‰ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN445928/">https://habr.com/ru/post/zh-CN445928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN445918/index.html">RollerCoaster Tycoonæˆç«‹20å‘¨å¹´ï¼šæ¸¸æˆåˆ›é€ è€…è®¿è°ˆ</a></li>
<li><a href="../zh-CN445920/index.html">ç›´æ’­ï¼šå¦‚ä½•éåˆ¶å¤§å‹å›¢é˜Ÿçš„iOSå¼€å‘</a></li>
<li><a href="../zh-CN445922/index.html">å¦‚æœæ‚¨å¯ä»¥é˜…è¯»Habrï¼Œä¸ºä»€ä¹ˆè¿˜è¦è§‚çœ‹åœ¨çº¿å¹¿æ’­</a></li>
<li><a href="../zh-CN445924/index.html">çå®ï¼šæ™ºèƒ½æ‰‹è¡¨ä½•æ—¶å˜å¾—æ€ªå¼‚</a></li>
<li><a href="../zh-CN445926/index.html">ç¾å›½UFOç§˜å¯†è®¡åˆ’ä¹Ÿä¸€ç›´åœ¨ç ”ç©¶è™«æ´å’Œå…¶ä»–å°ºå¯¸ã€‚</a></li>
<li><a href="../zh-CN445932/index.html">å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå®‰å…¨æ€§ï¼šå‰ç«¯å¼€å‘äººå‘˜çš„å®ç”¨æŠ€å·§</a></li>
<li><a href="../zh-CN445936/index.html">ç”µå­å¼€å‘ã€‚ å…³äºæ‰‹æŒ‡ä¸Šçš„å¾®æ§åˆ¶å™¨</a></li>
<li><a href="../zh-CN445940/index.html">å¸¦æœ‰Habrçš„AMAï¼Œv 7.0ã€‚ æŸ æª¬ï¼Œç”œç”œåœˆå’Œæ–°é—»</a></li>
<li><a href="../zh-CN445946/index.html">MWCï¼šä½¿ç”¨è¯´æ˜</a></li>
<li><a href="../zh-CN445948/index.html">C ++ä¸­çš„ç»§æ‰¿ï¼šåˆå­¦è€…ï¼Œä¸­çº§ï¼Œé«˜çº§</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>