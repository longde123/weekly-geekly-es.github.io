<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óÄÔ∏è üñáÔ∏è üë®üèæ‚Äç‚úàÔ∏è Flare-On 2019 menulis ü§ôüèæ ‚òéÔ∏è üë©üèª‚Äçü§ù‚Äçüë®üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="-0x01 - Pendahuluan 


 Artikel ini dikhususkan untuk analisis semua tugas Flare-On 2019 - kompetisi tahunan untuk rekayasa balik dari FireEye. Dalam ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Flare-On 2019 menulis</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/469393/"><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/bz/4g/sb/bz4gsbxbvka4sjtartbqmxccw6q.png"></div><br><a name="intro"></a><br><h2 id="-0x01---intro">  -0x01 - Pendahuluan </h2><br><p>  Artikel ini dikhususkan untuk analisis semua tugas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Flare-On 2019</a> - kompetisi tahunan untuk rekayasa balik dari FireEye.  Dalam kompetisi ini, saya ambil bagian untuk kedua kalinya.  Pada tahun sebelumnya, saya berhasil mencapai tempat ke-11 dalam hal waktu penyelesaian, setelah menyelesaikan semua masalah dalam waktu sekitar 13 hari.  Tahun ini, serangkaian tugas lebih mudah, dan saya bertemu dalam 54 jam, mengambil pada waktu yang sama 3 tempat dalam hal pengiriman. </p><br><p> Dalam artikel ini saya mencoba menggambarkan momen-momen yang membangkitkan minat terbesar saya, oleh karena itu, analisis tidak akan menggambarkan rutinitas bekerja di IDA, memahami algoritme masing-masing fungsi dan hal-hal lain yang tidak terlalu menarik.  Saya harap setelah membaca ini, Anda akan menemukan sesuatu yang baru dan berguna untuk diri Anda sendiri.  Anda dapat menemukan analisis masalah dari penulis, serta beberapa statistik dan hadiah untuk para pemenang di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </p><br><p>  Jika Anda tertarik, selamat datang di kucing! </p><a name="habracut"></a><br><h2 id="0x00---soderzhanie">  0x00 - Konten </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x01 - Battlestation Memecat [Edisi Demo Shareware]</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x02 - Terlalu panjang</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x03 - Flarebear</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x04 - Dnschess</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x05 - demo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x06 - bmphide</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x07 - wopr</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x08 - ular</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x09 - dimuat ulang</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x0A - Mugatu</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x0B - vv_max</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x0C - bantuan</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0x0D - Ringkasan</a> </li></ol><br><a name="task01"></a><br><h2 id="0x01---memecat-battlestation-shareware-demo-edition">  0x01 - Battlestation Memecat [Edisi Demo Shareware] </h2><br><blockquote>  Selamat datang di Six Flare-On Challenge! <br><br>  Ini adalah permainan sederhana.  Reverse engineer-nya untuk mencari tahu "kode senjata" apa yang perlu Anda masukkan untuk mengalahkan masing-masing dari dua musuh dan layar kemenangan akan mengungkapkan bendera.  Masukkan bendera di sini di situs ini untuk mencetak gol dan beralih ke level berikutnya. <br><br>  * Tantangan ini ditulis dalam .NET.  Jika Anda belum memiliki alat .NET reverse engineering favorit, saya sarankan dnSpy <br><br>  ** Jika Anda sudah menyelesaikan versi lengkap game ini di gerai kami di BlackHat atau rilis berikutnya di twitter, selamat, masukkan bendera dari layar kemenangan sekarang untuk melewati level ini. </blockquote><p>  Tugas ini disusun sebelumnya sebagai bagian dari Black Hat USA 2019, sekitar waktu yang sama ketika saya memutuskannya. <del>  Saya tidak ingat bagaimana dia menyelesaikannya </del>  Tugasnya cukup sederhana, jadi kami tidak akan mempertimbangkan solusinya. </p><br><a name="task02"></a><br><h2 id="0x02---overlong">  0x02 - Terlalu panjang </h2><br><blockquote>  Rahasia dari tantangan berikut ini disembunyikan dengan cerdik.  Namun, dengan pendekatan yang tepat, menemukan solusi tidak akan memakan waktu terlalu lama. </blockquote><p>  Diberikan file .exe x86.  Ketika Anda mencoba memulai, sebuah pesan ditampilkan dengan konten berikut: </p><br><p><img src="https://habrastorage.org/webt/gb/0q/ee/gb0qeertq_z-3wk0jyry5tuyjts.png"></p><br><p>  Saat menganalisis aplikasi, Anda mungkin menemukan bahwa pesan disimpan dalam beberapa penyandian dengan panjang karakter variabel (dari 1 hingga 4 byte).  Ketika fungsi decoding dipanggil, ia menerima panjang hasil yang diharapkan, yang lebih pendek dari pesan itu sendiri, itulah sebabnya bendera tidak terlihat.  Anda dapat memperbaiki nilai panjang yang diteruskan ke fungsi dalam mode debug dan mendapatkan pesan lengkap dengan bendera: </p><br><p><img src="https://habrastorage.org/webt/5q/lp/be/5qlpbeezlg3hmwbr8-bqnmd-50o.png"></p><br><p>  Anda juga bisa menulis ulang algoritma penguraian kode dengan Python dan mendapatkan tanda: </p><br><pre><code class="python hljs">msg = [ ... ] <span class="hljs-comment"><span class="hljs-comment">#      output = [] i = 0 while i &lt; len(msg): if (msg[i] &gt;&gt; 3) == 0x1e: out_char = ( ((msg[i + 3] &amp; 0x3F) &lt;&lt; 0 ) | ((msg[i + 2] &amp; 0x3F) &lt;&lt; 6 ) | ((msg[i + 1] &amp; 0x3F) &lt;&lt; 12) | ((msg[i + 0] &amp; 7) &lt;&lt; 18) ) output.append(out_char) i += 4 elif (msg[i] &gt;&gt; 4) == 0x0e: out_char = ( ((msg[i + 2] &amp; 0x3F) &lt;&lt; 0 ) | ((msg[i + 1] &amp; 0x3F) &lt;&lt; 6 ) | ((msg[i + 0] &amp; 0xF) &lt;&lt; 12) ) output.append(out_char) i += 3 elif (msg[i] &gt;&gt; 5) == 6: out_char = ( ((msg[i + 1] &amp; 0x3F) &lt;&lt; 0 ) | ((msg[i + 0] &amp; 0xF) &lt;&lt; 6 ) ) output.append(out_char) i += 2 else: output.append(msg[i]) i += 1 print(bytes([i for i in output])) # b'I never broke the encoding: I_a_M_t_h_e_e_n_C_o_D_i_n_g@flare-on.com'</span></span></code> </pre> <br><a name="task03"></a><br><h2 id="0x03---flarebear">  0x03 - Flarebear </h2><br><blockquote>  Kami di Flare telah menciptakan hewan peliharaan Tamagotchi kami sendiri, flarebear.  Dia sangat cerewet.  Buat dia tetap hidup dan bahagia dan dia akan memberi Anda bendera. </blockquote><p>  Dalam tugas ini, file <code>apk</code> untuk <code>Android</code> .  Pertimbangkan metode solusi tanpa memulai aplikasi itu sendiri. </p><br><p>  Langkah pertama adalah mendapatkan kode sumber aplikasi.  Untuk melakukan ini, menggunakan <code>dex2jar</code> utilitas <code>dex2jar</code> konversikan <code>apk</code> ke <code>jar</code> dan kemudian dapatkan kode sumber <code>Java</code> menggunakan dekompiler, yang saya lebih suka menggunakan <code>cfr</code> . </p><br><pre> <code class="plaintext hljs">~/retools/d2j/d2j-dex2jar.sh flarebear.apk java -jar ~/retools/cfr/cfr-0.146.jar --outputdir src flarebear-dex2jar.jar</code> </pre> <br><p>  Dengan menganalisis kode sumber aplikasi, Anda dapat menemukan metode <code>.danceWithFlag()</code> yang menarik, yang terletak di file <code>FlareBearActivity.java</code> .  Di dalam <code>.danceWithFlag()</code> , sumber daya aplikasi <code>raw</code> didekripsi menggunakan metode <code>.decrypt(String, byte[])</code> , argumen pertama di antaranya adalah string yang diperoleh dengan menggunakan metode <code>.getPassword()</code> .  Tentunya benderanya adalah sumber daya terenkripsi, jadi mari kita coba mendekripsi mereka.  Untuk melakukan ini, saya memutuskan untuk menulis ulang sedikit kode yang telah dikompilasi, menyingkirkan dependensi <code>Android</code> dan hanya menyisakan metode yang diperlukan untuk dekripsi, sehingga sebagai hasilnya, kode yang dihasilkan dapat dikompilasi.  Lebih lanjut, selama analisis, ditemukan bahwa metode <code>.getPassword()</code> bergantung pada tiga nilai status integer.  Setiap nilai terletak pada interval kecil dari <code>0</code> hingga <code>N</code> , sehingga Anda dapat menelusuri semua nilai yang mungkin untuk mencari kata sandi yang diinginkan. </p><br><p>  Hasilnya adalah kode berikut: </p><br><div class="spoiler">  <b class="spoiler_title">Main.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.InputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.charset.Charset; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.security.Key; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.security.spec.AlgorithmParameterSpec; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.security.spec.KeySpec; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Collection; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Collectors; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Collections; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.crypto.Cipher; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.crypto.SecretKey; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.crypto.SecretKeyFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.crypto.spec.IvParameterSpec; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.crypto.spec.PBEKeySpec; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.crypto.spec.SecretKeySpec; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String args [])</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ Main a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Main(); InputStream inputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(<span class="hljs-string"><span class="hljs-string">"ecstatic"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> fileSize = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"ecstatic"</span></span>).length(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] file1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) fileSize]; inputStream.read(file1); inputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(<span class="hljs-string"><span class="hljs-string">"ecstatic2"</span></span>); fileSize = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"ecstatic2"</span></span>).length(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] file2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) fileSize]; inputStream.read(file2); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">9</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">7</span></span>; j++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k = <span class="hljs-number"><span class="hljs-number">1</span></span>; k &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>; k++) { String pass = a.getPassword(i, j, k); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] out1 = a.decrypt(pass, file1); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] out2 = a.decrypt(pass, file2); OutputStream outputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(<span class="hljs-string"><span class="hljs-string">"out1"</span></span>); outputStream.write(out1); outputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(<span class="hljs-string"><span class="hljs-string">"out2"</span></span>); outputStream.write(out2); System.out.println(<span class="hljs-string"><span class="hljs-string">"yep!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (javax.crypto.BadPaddingException ex) { } } } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] decrypt(Object object, <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] arrby) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> Exception { Object object2 = Charset.forName(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); object2 = <span class="hljs-string"><span class="hljs-string">"pawsitive_vibes!"</span></span>.getBytes((Charset)object2); object2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IvParameterSpec((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[])object2); object = ((String)object).toCharArray(); Object object3 = Charset.forName(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); object3 = <span class="hljs-string"><span class="hljs-string">"NaClNaClNaCl"</span></span>.getBytes((Charset)object3); object = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PBEKeySpec((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[])object, (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[])object3, <span class="hljs-number"><span class="hljs-number">1234</span></span>, <span class="hljs-number"><span class="hljs-number">256</span></span>); object = SecretKeyFactory.getInstance(<span class="hljs-string"><span class="hljs-string">"PBKDF2WithHmacSHA1"</span></span>).generateSecret((KeySpec)object); object3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SecretKeySpec(((SecretKey)object).getEncoded(), <span class="hljs-string"><span class="hljs-string">"AES"</span></span>); object = Cipher.getInstance(<span class="hljs-string"><span class="hljs-string">"AES/CBC/PKCS5Padding"</span></span>); ((Cipher)object).init(<span class="hljs-number"><span class="hljs-number">2</span></span>, (Key)object3, (AlgorithmParameterSpec)object2); object = ((Cipher)object).doFinal(arrby); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> [])object; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n3)</span></span></span><span class="hljs-function"> </span></span>{ String string2 = <span class="hljs-string"><span class="hljs-string">"*"</span></span>; String string3 = <span class="hljs-string"><span class="hljs-string">"*"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (n % <span class="hljs-number"><span class="hljs-number">9</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>: { string2 = <span class="hljs-string"><span class="hljs-string">"*"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>: { string2 = <span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>: { string2 = <span class="hljs-string"><span class="hljs-string">"@"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: { string2 = <span class="hljs-string"><span class="hljs-string">"#"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: { string2 = <span class="hljs-string"><span class="hljs-string">"!"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: { string2 = <span class="hljs-string"><span class="hljs-string">"+"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: { string2 = <span class="hljs-string"><span class="hljs-string">"$"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: { string2 = <span class="hljs-string"><span class="hljs-string">"-"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: { string2 = <span class="hljs-string"><span class="hljs-string">"_"</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (n3 % <span class="hljs-number"><span class="hljs-number">7</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>: { string3 = <span class="hljs-string"><span class="hljs-string">"@"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: { string3 = <span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: { string3 = <span class="hljs-string"><span class="hljs-string">"#"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: { string3 = <span class="hljs-string"><span class="hljs-string">"+"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: { string3 = <span class="hljs-string"><span class="hljs-string">"_"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: { string3 = <span class="hljs-string"><span class="hljs-string">"$"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: } String string4 = String.join(<span class="hljs-string"><span class="hljs-string">""</span></span>, Collections.nCopies(n / n3, <span class="hljs-string"><span class="hljs-string">"flare"</span></span>)); String string5 = String.join(<span class="hljs-string"><span class="hljs-string">""</span></span>, Collections.nCopies(n2 * <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rotN(<span class="hljs-string"><span class="hljs-string">"bear"</span></span>, n * n2))); String string6 = String.join(<span class="hljs-string"><span class="hljs-string">""</span></span>, Collections.nCopies(n3, <span class="hljs-string"><span class="hljs-string">"yeah"</span></span>)); StringBuilder stringBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); stringBuilder.append(string4); stringBuilder.append(string2); stringBuilder.append(string5); stringBuilder.append(string3); stringBuilder.append(string6); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stringBuilder.toString(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rotN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String charSequence, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ Collection&lt;String&gt; collection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(charSequence.length()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charSequence.length(); ++i) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c2 = c = charSequence.charAt(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Character.isLowerCase(c)) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c3; c2 = c3 = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)(c + n); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c3 &gt; <span class="hljs-string"><span class="hljs-string">'z'</span></span>) { c2 = c3 = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)(c3 - n * <span class="hljs-number"><span class="hljs-number">2</span></span>); } } collection.add(Character.valueOf(c2).toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> collection.stream().collect(Collectors.joining()); <span class="hljs-comment"><span class="hljs-comment">// return ArraysKt.joinToString$default(CollectionsKt.toCharArray((List)collection), (CharSequence)FLARE_BEAR_NAME, null, null, 0, null, null, 62, null); } }</span></span></code> </pre> </div></div><br><p>  Kami akan mengekstrak sumber daya terenkripsi, kompilasi, dan menjalankan file yang dihasilkan: </p><br><pre> <code class="plaintext hljs">$ ~/retools/apktool/apktool d flarebear.apk $ cp flarebear/res/raw/* . $ javac Main.java $ java Main</code> </pre> <br><p>  Untungnya, hanya satu dari semua opsi kata sandi yang Anda pilih yang cocok.  Hasilnya, kami mendapatkan dua gambar dengan bendera: </p><br><pre> <code class="plaintext hljs">~/flareon2019/3 - Flarebear$ file out* out1: PNG image data, 2100 x 2310, 8-bit/color RGB, non-interlaced out2: PNG image data, 2100 x 2310, 8-bit/color RGB, non-interlaced</code> </pre> <br><img width="400" src="https://habrastorage.org/webt/eo/sp/wv/eospwvjutdz_76f4qrwzqqzstie.png"><br><img width="400" src="https://habrastorage.org/webt/mr/cf/wk/mrcfwklfuon1ebo1ctqafdzicti.png"><br><a name="task04"></a><br><h2 id="0x04---dnschess">  0x04 - Dnschess </h2><br><blockquote>  Beberapa lalu lintas jaringan yang mencurigakan mengarahkan kami ke program catur tanpa izin ini yang berjalan di desktop Ubuntu.  Tampaknya ini adalah karya peretas komputer dunia maya.  Anda harus melakukan langkah yang benar untuk menyelesaikannya.  Semoga beruntung </blockquote><p>  Tugas ini berisi dump lalu lintas, file executable <code>ELF</code> <code>ChessUI</code> dan library <code>ChessAI.so</code> .  Dengan menjalankan file yang dapat dieksekusi, Anda dapat melihat papan catur. </p><br><img width="500" src="https://habrastorage.org/webt/5t/7m/gn/5t7mgn6jyrc2zndnuwliuiuzovc.png"><br><p>  Mari kita mulai analisis dengan dump lalu lintas. </p><br><p><img src="https://habrastorage.org/webt/br/00/-5/br00-59yyrbti3rrdxgvizcfkdk.png"></p><br><p>  Semua lalu lintas terdiri dari kueri ke server <code>DNS</code> Tipe <code>A</code>  Pertanyaan itu sendiri terdiri dari nama-nama potongan, deskripsi langkah dalam permainan catur dan bagian konstan dari <code>.game-of-thrones.flare-on.com</code> , misalnya <code>rook-c3-c6.game-of-thrones.flare-on.com</code> .  Secara konstan, Anda dapat dengan mudah menemukan tempat yang tepat di perpustakaan <code>ChessAI.so</code> : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">signed</span></span> __int64 __<span class="hljs-function"><span class="hljs-function">fastcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNextMove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> idx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *chess_name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pos_from, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pos_to, \__int64 a5)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hostent</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">v9</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">// [rsp+20h] [rbp-60h] char *ip_addr; // [rsp+28h] [rbp-58h] char dns_name; // [rsp+30h] [rbp-50h] unsigned __int64 v12; // [rsp+78h] [rbp-8h] v12 = __readfsqword(0x28u); strcpy(&amp;dns_name, chess_name); pos_to_str(&amp;dns_name, pos_from); pos_to_str(&amp;dns_name, pos_to); strcat(&amp;dns_name, ".game-of-thrones.flare-on.com"); v9 = gethostbyname(&amp;dns_name); if ( !v9 ) return 2LL; ip_addr = *v9-&gt;h_addr_list; if ( *ip_addr != 127 || ip_addr[3] &amp; 1 || idx != (ip_addr[2] &amp; 0xF) ) return 2LL; sleep(1u); flag[2 * idx] = ip_addr[1] ^ key[2 * idx]; flag[2 * idx + 1] = ip_addr[1] ^ key[2 * idx + 1]; *(_DWORD *)a5 = (unsigned __int8)ip_addr[2] &gt;&gt; 4; *(_DWORD *)(a5 + 4) = (unsigned __int8)ip_addr[3] &gt;&gt; 1; strcpy((char *)(a5 + 8), off_4120[idx]); return (unsigned __int8)ip_addr[3] &gt;&gt; 7; }</span></span></code> </pre> <br><p>  Dapat dilihat dari kode itu, berdasarkan alamat <code>ip</code> diterima, string byte tertentu didekripsi, yang disimpan di area memori lain, yang saya sebut <code>flag</code> . </p><br><p>  Untuk menyelesaikan tugas tersebut, hal pertama yang harus dilakukan adalah mendapatkan semua alamat <code>ip</code> dari dump lalu lintas.  Anda dapat melakukan ini dengan perintah berikut: </p><br><pre> <code class="plaintext hljs">tshark -r capture.pcap | grep -P -o '127.(\d+).(\d+).(\d+)' | grep -v '127.0.0.1'</code> </pre> <br><p>  <code>ips</code> menyimpan semua alamat <code>ip</code> ke file <code>ips</code> , <code>ips</code> dapat menggunakan kode <code>Python</code> berikut untuk mendapatkan benderanya: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'ips'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: ips = f.read().split() flag = bytearray(<span class="hljs-number"><span class="hljs-number">64</span></span>) key = <span class="hljs-string"><span class="hljs-string">b'yZ\xb8\xbc\xec\xd3\xdf\xdd\x99\xa5\xb6\xac\x156\x85\x8d\t\x08wRMqT}\xa7\xa7\x08\x16\xfd\xd7'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ip <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ips: a, b, c, d = map(int, ip.split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> d &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> idx = c &amp; <span class="hljs-number"><span class="hljs-number">0xf</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> idx &gt; <span class="hljs-number"><span class="hljs-number">14</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> flag[<span class="hljs-number"><span class="hljs-number">2</span></span>*idx] = b ^ key[<span class="hljs-number"><span class="hljs-number">2</span></span>*idx] flag[<span class="hljs-number"><span class="hljs-number">2</span></span>*idx + <span class="hljs-number"><span class="hljs-number">1</span></span>] = b ^ key[<span class="hljs-number"><span class="hljs-number">2</span></span>*idx + <span class="hljs-number"><span class="hljs-number">1</span></span>] print(flag.decode() + <span class="hljs-string"><span class="hljs-string">'@flare-on.com'</span></span>) <span class="hljs-comment"><span class="hljs-comment"># LooksLikeYouLockedUpTheLookupZ@flare-on.com</span></span></code> </pre> <br><a name="task05"></a><br><h2 id="0x05---demo">  0x05 - demo </h2><br><blockquote>  Seseorang di tim Flare mencoba membuat kami terkesan dengan keterampilan demoscene mereka.  Tampaknya kosong.  Lihat apakah Anda dapat mengetahuinya atau mungkin kami harus memecat mereka.  Tidak ada tekanan. </blockquote><p>  Diberikan file executable <code>4k.exe</code> , yang menggunakan <code>DirectX</code> .  Saat diluncurkan, logo <code>FlareOn</code> berputar ditampilkan di jendela utama. </p><br><p><img src="https://habrastorage.org/webt/db/cw/ll/dbcwllgkqhasqqyvcmjv0iugwoc.png"></p><br><p>  Analisis statis program mengungkapkan satu fungsi, yang merupakan titik masuk.  Dalam konten, fungsinya menyerupai implementasi dekripsi kode.  Kami tidak akan membuang waktu menganalisis algoritma dari fungsi ini, cukup berikan breakpoint pada instruksi <code>ret</code> dan lihat di mana kontrol ditransfer.  Setelah kembali, kami menemukan <code>0x00420000</code> di alamat <code>0x00420000</code> , kode di mana dibongkar sebagai sesuatu yang memadai: </p><br><p><img src="https://habrastorage.org/webt/ba/ns/cb/banscbeyqmgqabaf6nbg5khebgk.png"></p><br><p>  Kemudian diputuskan untuk mentransfer kode ini dari mode debug ke database <code>IDA</code> menggunakan <code>API</code> dan melanjutkan analisis statis. </p><br><p>  Kode baru di awal mengimpor fungsi yang diperlukan dari berbagai perpustakaan.  Tabel fungsi-fungsi ini juga dapat dipulihkan dalam dinamika.  Hasilnya adalah serangkaian fungsi berikut: </p><br><p><img src="https://habrastorage.org/webt/hj/em/xv/hjemxvwadjd5f6z-paauo9vh4by.png"></p><br><p>  Titik masuk "nyata" ke program adalah: </p><br><p><img src="https://habrastorage.org/webt/5l/gl/-4/5lgl-4g3pzgrxf0gigfh5m99uqe.png"></p><br><p>  Perhatikan pembuatan <code>DeviceInterface</code> tipe <code>IDirect3DDevice9 **</code> .  Di masa depan, antarmuka ini digunakan secara aktif, dan untuk menyederhanakan kebalikannya, perlu untuk menentukan tabel metode-metodenya.  Dimungkinkan untuk dengan cepat menemukan definisi antarmuka, misalnya, di <a href="">sini</a> .  Saya mem-parsing tabel ini dan mengubahnya menjadi struktur untuk <code>IDA</code> .  Menerapkan jenis yang dihasilkan ke <code>DeviceInterface</code> dapat secara signifikan menyederhanakan analisis kode lebih lanjut.  Tangkapan layar berikut menunjukkan hasil dekompiler untuk fungsi utama siklus rendering adegan sebelum dan sesudah menerapkan tipe. </p><br><p><img src="https://habrastorage.org/webt/gh/yc/35/ghyc35pxpo9mhyi8dx-louqlcsy.png"></p><br><p><img src="https://habrastorage.org/webt/wg/sk/ql/wgskqlsgkdxsul3hqll8m-ohv8c.png"></p><br><p>  Setelah analisis lebih lanjut, ditemukan bahwa dua jerat poligon (mesh, poligon mesh) dibuat dalam program, meskipun ketika program berjalan kita hanya melihat satu objek.  Juga, ketika membangun kisi-kisi, simpul mereka dienkripsi menggunakan <code>XOR</code> , yang juga menimbulkan kecurigaan.  Mari menguraikan dan memvisualisasikan simpul.  Kotak kedua paling menarik, karena  ini memiliki lebih banyak simpul.  <code>matplotlib</code> semua simpul, saya menemukan bahwa koordinat <code>Z</code> masing-masing adalah 0, jadi untuk visualisasi diputuskan untuk menggambar grafik dua dimensi menggunakan <code>matplotlib</code> .  Kode berikut dan hasilnya dengan bendera ternyata: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'vertexes'</span></span>, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: data = f.read() n = len(data) // <span class="hljs-number"><span class="hljs-number">4</span></span> data = list(struct.unpack(<span class="hljs-string"><span class="hljs-string">'{}I'</span></span>.format(n), data)) key = [<span class="hljs-number"><span class="hljs-number">0xCB343C8</span></span>, <span class="hljs-number"><span class="hljs-number">0x867B81F0</span></span>, <span class="hljs-number"><span class="hljs-number">0x84AF72C3</span></span>] data = [data[i] ^ key[i % <span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(data))] data = struct.pack(<span class="hljs-string"><span class="hljs-string">'{}I'</span></span>.format(n), *data) data = list(struct.unpack(<span class="hljs-string"><span class="hljs-string">'{}f'</span></span>.format(n), data)) x = data[<span class="hljs-number"><span class="hljs-number">0</span></span>::<span class="hljs-number"><span class="hljs-number">3</span></span>] y = data[<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-number"><span class="hljs-number">3</span></span>] z = data[<span class="hljs-number"><span class="hljs-number">2</span></span>::<span class="hljs-number"><span class="hljs-number">3</span></span>] print(z) plt.plot(x, y) plt.show()</code> </pre> <br><p><img src="https://habrastorage.org/webt/ke/5w/z5/ke5wz52y1nkpe3jpgxsrl9vcg4c.png"></p><br><a name="task06"></a><br><h2 id="0x06---bmphide">  0x06 - bmphide </h2><br><blockquote>  Tyler Dean mendaki Gunung.  Elbert (gunung tertinggi di Colorado) pada jam 2 pagi untuk mengambil gambar ini pada waktu yang tepat.  Jangan pernah melewatkan hari leg.  Kami menemukan gambar ini dan dapat dieksekusi pada thumb drive yang ditinggalkannya di trail trail.  Bisakah dia dipercaya? </blockquote><p>  Dalam tugas, file executable <code>bmphide.exe</code> dan image <code>image.bmp</code> .  Dapat diasumsikan bahwa beberapa pesan disembunyikan dalam gambar menggunakan metode steganografi. </p><br><p>  Biner ditulis dalam <code>C#</code> , jadi saya menggunakan utilitas <code>dnSpy</code> untuk analisis.  Anda dapat segera melihat bahwa sebagian besar nama metode dikaburkan.  Jika Anda melihat metode <code>Program.Main</code> . Utama, Anda dapat memahami logika program dan membuat asumsi tentang tujuan beberapa di antaranya: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// BMPHIDE.Program // Token: 0x06000018 RID: 24 RVA: 0x00002C18 File Offset: 0x00002C18 private static void Main(string[] args) { Program.Init(); Program.yy += 18; string filename = args[2]; string fullPath = Path.GetFullPath(args[0]); string fullPath2 = Path.GetFullPath(args[1]); byte[] data = File.ReadAllBytes(fullPath2); Bitmap bitmap = new Bitmap(fullPath); byte[] data2 = Program.h(data); Program.i(bitmap, data2); bitmap.Save(filename); }</span></span></code> </pre><br><ul><li>  Aplikasi diinisialisasi menggunakan metode <code>Program.Init()</code> </li><li>  Baca file data dan file gambar </li><li>  Menggunakan metode <code>byte [] Program.h(byte [])</code> , beberapa konversi data dilakukan </li><li>  Menggunakan metode <code>Program.i(Bitmap, byte[])</code> , data yang dikonversi dimasukkan ke dalam gambar </li><li>  Gambar yang dihasilkan disimpan dengan nama baru. </li></ul><br><p>  Selama inisialisasi aplikasi, berbagai metode kelas <code>A</code> dipanggil.  Analisis superfisial dari kelas menunjukkan kesamaan beberapa metodenya dengan metode obfuscator <code>ConfuserEx</code> (file <code>AntiTamper.JIT.cs</code> ).  Aplikasi ini sangat terlindungi dari debugging.  Pada saat yang sama, tidak mungkin untuk menghapus mekanisme perlindungan menggunakan utilitas <code>de4dot</code> dan fork-nya, sehingga diputuskan untuk melanjutkan analisis. </p><br><p>  Pertimbangkan metode <code>Program.i</code> , yang digunakan untuk memasukkan data ke dalam gambar. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Bitmap bm, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num = Program.j(<span class="hljs-number"><span class="hljs-number">103</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = Program.j(<span class="hljs-number"><span class="hljs-number">103</span></span>); i &lt; bm.Width; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = Program.j(<span class="hljs-number"><span class="hljs-number">103</span></span>); j &lt; bm.Height; j++) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> flag = num &gt; data.Length - Program.j(<span class="hljs-number"><span class="hljs-number">231</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } Color pixel = bm.GetPixel(i, j); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> red = ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)pixel.R &amp; Program.j(<span class="hljs-number"><span class="hljs-number">27</span></span>)) | ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)data[num] &amp; Program.j(<span class="hljs-number"><span class="hljs-number">228</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> green = ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)pixel.G &amp; Program.j(<span class="hljs-number"><span class="hljs-number">27</span></span>)) | (data[num] &gt;&gt; Program.j(<span class="hljs-number"><span class="hljs-number">230</span></span>) &amp; Program.j(<span class="hljs-number"><span class="hljs-number">228</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> blue = ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)pixel.B &amp; Program.j(<span class="hljs-number"><span class="hljs-number">25</span></span>)) | (data[num] &gt;&gt; Program.j(<span class="hljs-number"><span class="hljs-number">100</span></span>) &amp; Program.j(<span class="hljs-number"><span class="hljs-number">230</span></span>)); Color color = Color.FromArgb(Program.j(<span class="hljs-number"><span class="hljs-number">103</span></span>), red, green, blue); bm.SetPixel(i, j, color); num += Program.j(<span class="hljs-number"><span class="hljs-number">231</span></span>); } } }</code> </pre> <br><p>  Sangat mirip dengan <code>LSB</code> klasik, namun, di tempat-tempat di mana konstanta diharapkan, metode <code>int Program.j(byte)</code> digunakan.  Hasil kerjanya tergantung pada berbagai nilai global yang diperoleh, termasuk selama inisialisasi dalam metode <code>Program.Init()</code> .  Diputuskan untuk tidak membalikkan pekerjaannya, tetapi untuk mendapatkan semua nilai yang mungkin saat runtime.  <code>dnSpy</code> memungkinkan <code>dnSpy</code> untuk mengedit kode aplikasi yang <code>dnSpy</code> dan menyimpan modul yang dimodifikasi.  Kami mengambil keuntungan dari ini dan menulis ulang metode <code>Program.Main</code> . Utama sebagai berikut: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { Program.Init(); Program.yy += <span class="hljs-number"><span class="hljs-number">18</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">256</span></span>; i++) { Console.WriteLine(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"j({0}) = {1}"</span></span>, i, Program.j((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)i))); } }</code> </pre> <br><p>  Saat startup, kami mendapatkan nilai-nilai berikut: </p><br><pre> <code class="plaintext hljs">E:\&gt;bmphide_j.exe j(0) = 206 j(1) = 204 j(2) = 202 j(3) = 200 j(4) = 198 j(5) = 196 j(6) = 194 j(7) = 192 j(8) = 222 j(9) = 220 j(10) = 218 j(11) = 216 j(12) = 214 j(13) = 212 j(14) = 210 j(15) = 208 j(16) = 238 j(17) = 236 j(18) = 234 j(19) = 232 j(20) = 230 ...</code> </pre> <br><p>  Ganti panggilan ke <code>Program.j</code> dalam metode <code>Program.j</code> dengan konstanta yang dihasilkan: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Bitmap bm, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bm.Width; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; bm.Height; j++) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> flag = num &gt; data.Length - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } Color pixel = bm.GetPixel(i, j); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> red = ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)pixel.R &amp; <span class="hljs-number"><span class="hljs-number">0xf8</span></span>) | ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)data[num] &amp; <span class="hljs-number"><span class="hljs-number">0x7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> green = ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)pixel.G &amp; <span class="hljs-number"><span class="hljs-number">0xf8</span></span>) | (data[num] &gt;&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> &amp; <span class="hljs-number"><span class="hljs-number">0x7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> blue = ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)pixel.B &amp; <span class="hljs-number"><span class="hljs-number">0xfc</span></span>) | (data[num] &gt;&gt; <span class="hljs-number"><span class="hljs-number">6</span></span> &amp; <span class="hljs-number"><span class="hljs-number">0x3</span></span>); Color color = Color.FromArgb(<span class="hljs-number"><span class="hljs-number">0</span></span>, red, green, blue); bm.SetPixel(i, j, color); num += <span class="hljs-number"><span class="hljs-number">1</span></span>; } } }</code> </pre> <br><p>  Sekarang menjadi jelas bagaimana cara memasukkan setiap byte pesan ke dalam gambar: </p><br><ul><li>  bit 0 hingga 2 ditempatkan dalam 3 LSB pada saluran merah titik </li><li>  bit 3 hingga 5 ditempatkan di 3 LSB pada saluran hijau titik </li><li>  bit 6 hingga 7 ditempatkan di 2 LSBs dari saluran biru titik </li></ul><br><p>  Selanjutnya, saya mencoba mengulangi algoritma metode konversi data, tetapi hasil perhitungan tidak sesuai dengan output program.  Ternyata, kelas <code>A</code> juga memiliki fungsi untuk mengganti metode (dalam <code>A.VerifySignature(MethodInfo m1, MethodInfo m2)</code> ) dan memodifikasi <code>IL</code> dari kode byte metode (dalam <code>A.IncrementMaxStack</code> ). </p><br><p>  Untuk memilih metode yang perlu diganti dalam <code>Program</code> , di <code>Program.Init</code> , <code>IL</code> bytecode <code>IL</code> metode hash dan dibandingkan dengan nilai yang telah dihitung.  Secara total, dua metode diganti.  Untuk mengetahui yang mana, kami akan meluncurkan aplikasi di bawah debugger dengan menetapkan breakpoint pada <code>A.VerifySignature</code> panggilan, dan Anda harus melewati panggilan <code>A.CalculateStack()</code> di <code>Program.Init</code> , karena  Ini mencegah debugging. </p><br><p><img src="https://habrastorage.org/webt/v7/2o/l4/v72ol4f8pcefzyg7lnmkywe4tyw.png"></p><br><p>  Sebagai hasilnya, Anda dapat melihat bahwa metode <code>Program.a</code> digantikan oleh <code>Program.b</code> , dan <code>Program.c</code> digantikan oleh <code>Program.d</code> . </p><br><p>  Sekarang Anda perlu berurusan dengan modifikasi bytecode: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsafe</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">uint</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IncrementMaxStack</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr self, A.ICorJitInfo* comp, A.CORINFO_METHOD_INFO* info, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> flags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">** nativeEntry, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params">* nativeSizeOfCode</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> flag = info != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag) { MethodBase methodBase = Ac(info-&gt;ftn); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> flag2 = methodBase != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag2) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> flag3 = methodBase.MetadataToken == <span class="hljs-number"><span class="hljs-number">100663317</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag3) { <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> flNewProtect; A.VirtualProtect((IntPtr)((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)info-&gt;ILCode), info-&gt;ILCodeSize, <span class="hljs-number"><span class="hljs-number">4u</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> flNewProtect); Marshal.WriteByte((IntPtr)((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)info-&gt;ILCode), <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>); Marshal.WriteByte((IntPtr)((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)info-&gt;ILCode), <span class="hljs-number"><span class="hljs-number">62</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>); A.VirtualProtect((IntPtr)((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)info-&gt;ILCode), info-&gt;ILCodeSize, flNewProtect, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> flNewProtect); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> flag4 = methodBase.MetadataToken == <span class="hljs-number"><span class="hljs-number">100663316</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag4) { <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> flNewProtect2; A.VirtualProtect((IntPtr)((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)info-&gt;ILCode), info-&gt;ILCodeSize, <span class="hljs-number"><span class="hljs-number">4u</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> flNewProtect2); Marshal.WriteInt32((IntPtr)((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)info-&gt;ILCode), <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">309030853</span></span>); Marshal.WriteInt32((IntPtr)((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)info-&gt;ILCode), <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">209897853</span></span>); A.VirtualProtect((IntPtr)((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)info-&gt;ILCode), info-&gt;ILCodeSize, flNewProtect2, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> flNewProtect2); } } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> A.originalDelegate(self, comp, info, flags, nativeEntry, nativeSizeOfCode); }</code> </pre> <br><p>  Jelas bahwa metode dengan nilai <code>MetadataToken</code> tertentu, yaitu <code>0x6000015</code> dan <code>0x6000014</code> , akan dimodifikasi.  Token ini sesuai dengan metode <code>Program.h</code> dan <code>Program.g</code> .  <code>dnSpy</code> memiliki built-in <code>hex</code> editor, di mana, ketika melayang, data metode disorot: judulnya (disorot dalam warna ungu) dan kode byte (disorot dalam warna merah), seperti yang ditunjukkan pada tangkapan layar.  Anda dapat pergi ke metode yang diinginkan di <code>hex</code> editor dengan mengklik alamat yang sesuai di komentar sebelum metode yang didekompilasi (misalnya, <code>File Offset: 0x00002924</code> ). </p><br><p><img src="https://habrastorage.org/webt/xt/i6/e6/xti6e6knsrkyrapcutnkypgfeau.png"></p><br><p>  Mari kita coba menerapkan semua modifikasi yang dijelaskan: kita akan membuat salinan file, dalam hex editor apa pun kita akan mengubah nilai pada offset yang diperlukan, yang kita pelajari dari <code>dnSpy</code> dan kita akan mengganti metode <code>a -&gt; b</code> dan <code>c -&gt; d</code> di <code>Program.h</code> .  Kami juga menghapus dari <code>Program.Init</code> semua panggilan ke modul <code>A</code>  Jika semuanya dilakukan dengan benar, maka ketika kita mencoba memasukkan beberapa pesan ke dalam gambar menggunakan aplikasi yang dimodifikasi, kita akan mendapatkan hasil yang sama seperti ketika aplikasi asli bekerja.  Tangkapan layar di bawah ini menunjukkan kode yang telah dikompilasi dari metode aplikasi asli dan yang dimodifikasi. </p><br><p><img src="https://habrastorage.org/webt/lq/wo/em/lqwoemy3gsysvsptxholl6ioyey.png"></p><br><p><img src="https://habrastorage.org/webt/le/tw/j6/letwj6p_uzdmlglrgsky2gifwuy.png"></p><br><p>  Tetap membuat algoritma transformasi terbalik.  Ini cukup sederhana, jadi saya hanya akan memberikan skrip <code>Python</code> dihasilkan: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image <span class="hljs-comment"><span class="hljs-comment"># Rotate left: 0b1001 --&gt; 0b0011 rol = lambda val, r_bits, max_bits: \ (val &lt;&lt; r_bits%max_bits) &amp; (2**max_bits-1) | \ ((val &amp; (2**max_bits-1)) &gt;&gt; (max_bits-(r_bits%max_bits))) # Rotate right: 0b1001 --&gt; 0b1100 ror = lambda val, r_bits, max_bits: \ ((val &amp; (2**max_bits-1)) &gt;&gt; r_bits%max_bits) | \ (val &lt;&lt; (max_bits-(r_bits%max_bits)) &amp; (2**max_bits-1)) rol8 = lambda a, b: rol(a, b, 8) ror8 = lambda a, b: ror(a, b, 8) def extract(fname): img = Image.open(fname) w, h = img.size result = bytearray() for i in range(w): for j in range(h): r, g, b = img.getpixel((i, j)) # print('{:02x} {:02x} {:02x}'.format(r, g, b)) byte = (r &amp; 0b111) | ((g &amp; 0b111) &lt;&lt; 3) | ((b &amp; 0b11) &lt;&lt; 6) result.append(byte) return result enc = extract('image.bmp') n = len(enc) dec = bytearray() def g(idx): b = ((idx + 1) * 309030853) &amp; 0xff k = ((idx + 2) * 209897853) &amp; 0xff return b ^ k j = 0 for i in range(n): x = enc[i] x = rol8(x, 3) x ^= g(2*i + 1) x = ror8(x, 7) x ^= g(2*i + 0) dec.append(x) with open('output', 'wb') as f: f.write(dec)</span></span></code> </pre> <br><p>  Dengan menjalankan skrip ini, kami mendapatkan gambar <code>bmp</code> lain tanpa bendera.  Mengulangi prosedur di atasnya, kita mendapatkan gambar terakhir dengan bendera. </p><br><p><img src="https://habrastorage.org/webt/jj/ba/yq/jjbayqp9cpownsuf1wlrwar-rem.png"></p><br><a name="task07"></a><br><h2 id="0x07---wopr">  0x07 - wopr </h2><br><blockquote>  Kami menggunakan keterampilan peretasan komputer kami sendiri untuk "menemukan" AI ini di superkomputer militer.  Itu sangat menyerupai film klasik 1983 WarGames.  Mungkin hidup meniru seni?  Jika Anda dapat menemukan kode peluncuran untuk kami, kami akan membiarkan Anda lolos ke tantangan berikutnya.  Kami berjanji tidak akan memulai perang termonuklir. </blockquote><p>  Dalam tugasnya, aplikasi konsol <code>worp.exe</code> .  Tampaknya, untuk menyelesaikannya, Anda perlu mengambil beberapa kode. </p><br><p><img src="https://habrastorage.org/webt/ji/1p/2w/ji1p2w_9cpkv8vsaxbezvicozjc.png"></p><br><p>  Analisis titik masuk menunjukkan bahwa ini adalah arsip yang mengekstraksi sendiri.  Saat memulai, variabel lingkungan <code>_MEIPASS2</code> .  Jika variabel ini tidak ada, direktori sementara dibuat ke mana isi arsip dibongkar, dan aplikasi dimulai sekali lagi dengan variabel lingkungan yang diberikan <code>_MEIPASS2</code> .  Konten Arsip: </p><br><pre> <code class="plaintext hljs">. ‚îú‚îÄ‚îÄ api-ms-win-core-console-l1-1-0.dll ‚îú‚îÄ‚îÄ ... ‚îú‚îÄ‚îÄ ... ‚îú‚îÄ‚îÄ api-ms-win-crt-utility-l1-1-0.dll ‚îú‚îÄ‚îÄ base_library.zip ‚îú‚îÄ‚îÄ _bz2.pyd ‚îú‚îÄ‚îÄ _ctypes.pyd ‚îú‚îÄ‚îÄ _hashlib.pyd ‚îú‚îÄ‚îÄ libcrypto-1_1.dll ‚îú‚îÄ‚îÄ libssl-1_1.dll ‚îú‚îÄ‚îÄ _lzma.pyd ‚îú‚îÄ‚îÄ pyexpat.pyd ‚îú‚îÄ‚îÄ python37.dll ‚îú‚îÄ‚îÄ select.pyd ‚îú‚îÄ‚îÄ _socket.pyd ‚îú‚îÄ‚îÄ _ssl.pyd ‚îú‚îÄ‚îÄ this ‚îÇ  ‚îú‚îÄ‚îÄ __init__.py ‚îÇ  ‚îî‚îÄ‚îÄ key ‚îú‚îÄ‚îÄ ucrtbase.dll ‚îú‚îÄ‚îÄ unicodedata.pyd ‚îú‚îÄ‚îÄ VCRUNTIME140.dll ‚îî‚îÄ‚îÄ wopr.exe.manifest 1 directory, 56 files</code> </pre> <br><p>  Dilihat oleh konten, kita berurusan dengan aplikasi <code>Python</code> dikemas dalam <code>exe</code> .  Untuk mendukung ini, dalam biner utama Anda dapat menemukan impor dinamis dari fungsi yang sesuai dari perpustakaan <code>Python</code> : <code>PyMarshal_ReadObjectFromString</code> , <code>PyEval_EvalCode</code> dan lainnya.  Untuk analisis lebih lanjut, Anda perlu mengekstrak bytecode <code>Python</code> .  Untuk melakukan ini, simpan konten arsip dari direktori sementara dan <code>_MEIPASS2</code> variabel lingkungan <code>_MEIPASS2</code> .  Jalankan biner utama dalam mode debug dengan menetapkan breakpoint pada fungsi <code>PyMarshal_ReadObjectFromString</code> .  Fungsi ini mengambil sebagai argumen penunjuk ke buffer dengan kode <code>Python</code> serial dan panjangnya.  Kami membuang konten buffer yang diketahui panjang untuk setiap panggilan.  Saya hanya mendapat 2 panggilan, sedangkan yang kedua, objek bersambung jauh lebih besar, dan kami akan menganalisisnya. </p><br><p>  Cara yang cukup sederhana untuk menganalisis data yang diterima adalah mengonversinya ke format file <code>.pyc</code> (bytecode <code>Python</code> dikompilasi) dan mendekompilasi menggunakan <code>uncompyle6</code> .  Untuk melakukan ini, cukup menambahkan header 16 byte ke data yang diterima.  Akibatnya, saya mendapat file berikut: </p><br><pre> <code class="plaintext hljs">00000000: 42 0d 0d 0a 00 00 00 00 de cd 57 5d 00 00 00 00 B.........W].... 00000010: e3 00 00 00 00 00 00 00 00 00 00 00 00 09 00 00 ................ 00000020: 00 40 00 00 00 73 3c 01 00 00 64 00 5a 00 64 01 .@...s&lt;...dZd 00000030: 64 02 6c 01 5a 01 64 01 64 02 6c 02 5a 02 64 01 dlZddlZd</code> </pre> <br><p>  Selanjutnya, kita mendekompilasi file yang dihasilkan menggunakan <code>uncompyle6</code> : </p><br><pre> <code class="plaintext hljs">uncompyle6 task.pyc &gt; task.py</code> </pre> <br><p>  Jika kami mencoba menjalankan file yang didekompilasi, kami akan mendapatkan pengecualian di baris <code>BOUNCE = pkgutil.get_data('this', 'key')</code> .  Ini mudah diperbaiki dengan hanya menetapkan konten file <code>key</code> dari arsip ke variabel <code>BOUNCE</code> .  Menjalankan ulang skrip, kita hanya akan melihat tulisan <code>LOADING...</code>  Rupanya, beberapa teknik digunakan dalam tugas yang mencegah dekompilasi.  Kami melanjutkan untuk menganalisis kode <code>Python</code> dihasilkan.  Pada akhirnya, kita melihat siklus berikut: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">256</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: print(lzma.decompress(fire(eye(__doc__.encode()), bytes([i]) + BOUNCE))) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><p>  Anda dapat memahami bahwa fungsi <code>print</code> sebenarnya ditimpa sebagai <code>exec</code> , dan argumennya hanya bergantung pada <code>__doc__.encode()</code> - teks di awal file.       <code>print</code>       <code>print</code>   <code>try-except</code> .         . ,   <code>__doc__</code>   .    <code>__doc__</code>      : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> marshal <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'pycode1'</span></span>, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> inp: data = inp.read() code = marshal.loads(data) doc = code.co_consts[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'doc.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> outp: outp.write(doc)</code> </pre> <br><p>    ,   <code>__doc__</code> .  ,    <code>i</code> ,     .       .   <code>wrong</code>    : </p><br><pre> <code class="python hljs">trust = windll.kernel32.GetModuleHandleW(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>)</code> </pre> <br><p>          ,         .      <code>0x100000</code>            <code>wrong</code> ,        .          ,     . </p><br><p>         .    <code>z3</code> : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> z3 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> stage2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wrong xor = [<span class="hljs-number"><span class="hljs-number">212</span></span>, <span class="hljs-number"><span class="hljs-number">162</span></span>, <span class="hljs-number"><span class="hljs-number">242</span></span>, <span class="hljs-number"><span class="hljs-number">218</span></span>, <span class="hljs-number"><span class="hljs-number">101</span></span>, <span class="hljs-number"><span class="hljs-number">109</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">125</span></span>, <span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-number"><span class="hljs-number">249</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">187</span></span>, <span class="hljs-number"><span class="hljs-number">131</span></span>, <span class="hljs-number"><span class="hljs-number">206</span></span>] h = list(wrong()) h = [h[i] ^ xor[i] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">16</span></span>)] b = <span class="hljs-number"><span class="hljs-number">16</span></span> * [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>] x = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">16</span></span>): x.append(BitVec(<span class="hljs-string"><span class="hljs-string">'x'</span></span> + str(i), <span class="hljs-number"><span class="hljs-number">32</span></span>)) b[<span class="hljs-number"><span class="hljs-number">0</span></span>] = x[<span class="hljs-number"><span class="hljs-number">2</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">3</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">4</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">8</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">11</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">14</span></span>] b[<span class="hljs-number"><span class="hljs-number">1</span></span>] = x[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">1</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">8</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">11</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">13</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">14</span></span>] b[<span class="hljs-number"><span class="hljs-number">2</span></span>] = x[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">1</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">2</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">4</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">5</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">8</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">9</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">10</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">13</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">14</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">15</span></span>] b[<span class="hljs-number"><span class="hljs-number">3</span></span>] = x[<span class="hljs-number"><span class="hljs-number">5</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">6</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">8</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">9</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">10</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">12</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">15</span></span>] b[<span class="hljs-number"><span class="hljs-number">4</span></span>] = x[<span class="hljs-number"><span class="hljs-number">1</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">6</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">7</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">8</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">12</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">13</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">14</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">15</span></span>] b[<span class="hljs-number"><span class="hljs-number">5</span></span>] = x[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">4</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">7</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">8</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">9</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">10</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">12</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">13</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">14</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">15</span></span>] b[<span class="hljs-number"><span class="hljs-number">6</span></span>] = x[<span class="hljs-number"><span class="hljs-number">1</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">3</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">7</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">9</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">10</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">11</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">12</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">13</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">15</span></span>] b[<span class="hljs-number"><span class="hljs-number">7</span></span>] = x[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">1</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">2</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">3</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">4</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">8</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">10</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">11</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">14</span></span>] b[<span class="hljs-number"><span class="hljs-number">8</span></span>] = x[<span class="hljs-number"><span class="hljs-number">1</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">2</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">3</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">5</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">9</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">10</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">11</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">12</span></span>] b[<span class="hljs-number"><span class="hljs-number">9</span></span>] = x[<span class="hljs-number"><span class="hljs-number">6</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">7</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">8</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">10</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">11</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">12</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">15</span></span>] b[<span class="hljs-number"><span class="hljs-number">10</span></span>] = x[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">3</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">4</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">7</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">8</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">10</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">11</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">12</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">13</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">14</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">15</span></span>] b[<span class="hljs-number"><span class="hljs-number">11</span></span>] = x[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">2</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">4</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">6</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">13</span></span>] b[<span class="hljs-number"><span class="hljs-number">12</span></span>] = x[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">3</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">6</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">7</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">10</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">12</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">15</span></span>] b[<span class="hljs-number"><span class="hljs-number">13</span></span>] = x[<span class="hljs-number"><span class="hljs-number">2</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">3</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">4</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">5</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">6</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">7</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">11</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">12</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">13</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">14</span></span>] b[<span class="hljs-number"><span class="hljs-number">14</span></span>] = x[<span class="hljs-number"><span class="hljs-number">1</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">2</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">3</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">5</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">7</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">11</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">13</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">14</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">15</span></span>] b[<span class="hljs-number"><span class="hljs-number">15</span></span>] = x[<span class="hljs-number"><span class="hljs-number">1</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">3</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">5</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">9</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">10</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">11</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">13</span></span>] ^ x[<span class="hljs-number"><span class="hljs-number">15</span></span>] solver = Solver() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">16</span></span>): solver.add(x[i] &lt; <span class="hljs-number"><span class="hljs-number">128</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">16</span></span>): solver.add(b[i] == h[i]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> solver.check() == sat: m = solver.model() print(bytes([m[i].as_long() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> x])) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">'unsat'</span></span>)</code> </pre> <br><p>   ,    : <code>5C0G7TY2LWI2YXMB</code> </p><br><p><img src="https://habrastorage.org/webt/yp/ox/jh/ypoxjh3rafci2a5-ukpy2uvbgu0.png"></p><br><a name="task08"></a><br><h2 id="0x08---snake"> 0x08 ‚Äî snake </h2><br><blockquote> The Flare team is attempting to pivot to full-time twitch streaming video games instead of reverse engineering computer software all day. We wrote our own classic NES game to stream content that nobody else has seen and watch those subscribers flow in. It turned out to be too hard for us to beat so we gave up. See if you can beat it and capture the internet points that we failed to collect. </blockquote><p>    <code>NES</code> - .       <code>FCEUX</code> , ..      .  ,   . </p><br><p><img src="https://habrastorage.org/webt/tk/fx/sq/tkfxsqug4puqwqs893v5zceereg.png"></p><br><p>  ,  ,     <code>0x25</code>    .    ,   .     <code>NES</code> -  <code>IDA</code> .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">inesldr</a> .     <code>0x25</code> .   <code>C82A</code>    ,           .      <code>0x33</code> . </p><br><p><img src="https://habrastorage.org/webt/uo/2b/h8/uo2bh8iawskqdff-153-964ljwq.png"></p><br><p> ,     ‚Äî   <code>0x32</code>   <code>0x25</code>       .     ,    .  , <code>FCEUX</code>    .          . </p><br><p><img src="https://habrastorage.org/webt/jn/nu/jh/jnnujhs5-fugmpqugrp1z9m7p0o.png"></p><br><a name="task09"></a><br><h2 id="0x09---reloadered"> 0x09 ‚Äî reloadered </h2><br><blockquote> This is a simple challenge, enter the password, receive the key. I hear that it caused problems when trying to analyze it with ghidra. Remember that valid flare-on flags will always end with @flare-on.com </blockquote><p>      <code>reloaderd.exe</code> ,     .    ,     ,     .     ,       ,         <code>XOR</code>    ,     <code>@FLAG.com</code> ,     . </p><br><p><img src="https://habrastorage.org/webt/ki/ug/mv/kiugmvs_ouxbeziqmqnzjhxgqmu.png"></p><br><p>         ,   <code>NOP</code> .          ,     ,   .          .   ,     .    ,      ,       .   ,      ,     <code>NOP</code> ,      . </p><br><p>        ,      ,      <code>XOR</code>  ,  .      <code>@flare-on.com</code> ,    .            : </p><br><pre> <code class="python hljs">flag = bytearray(<span class="hljs-string"><span class="hljs-string">b'D)6\n)\x0f\x05\x1be&amp;\x10\x04+h0/\x003/\x05\x1a\x1f\x0f8\x02\x18B\x023\x1a(\x04*G?\x04&amp;dfM\x107&gt;(&gt;w\x1c?~64*\x00'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0x539</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0x34</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i % <span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (i % <span class="hljs-number"><span class="hljs-number">7</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>: flag[j] ^= (i &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>) end = <span class="hljs-string"><span class="hljs-string">b'@flare-on.com'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bytes([i^j <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> zip(a, b)]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(flag)): print(i, xor(end, flag[i:])) print(xor(flag, <span class="hljs-string"><span class="hljs-string">b'3HeadedMonkey'</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>))</code> </pre> <br><p><img src="https://habrastorage.org/webt/th/qz/9b/thqz9bwdjdkt-a7smd_tb8uncxs.png"></p><br><a name="task10"></a><br><h2 id="0x0a---mugatu"> 0x0A ‚Äî Mugatu </h2><br><blockquote> Hello, <br><br> I'm working an incident response case for Derek Zoolander. He clicked a link and was infected with MugatuWare! As a result, his new headshot compilation GIF was encrypted. <br><br> To secure an upcoming runway show, Derek needs this GIF decrypted; however, he refuses to pay the ransom. <br><br> We received an additional encrypted GIF from an anonymous informant. The informant told us the GIF should help in our decryption efforts, but we were unable to figure it out. <br><br> We're reaching out to you, our best malware analyst, in hopes that you can reverse engineer this malware and decrypt Derek's GIF. <br><br> I've included a directory full of files containing: <br><ul><li> MugatuWare malware </li><li> Ransom note (GIFtToDerek.txt) </li><li> Encrypted headshot GIF (best.gif.Mugatu) </li><li> Encrypted informant GIF (the_key_to_success_0000.gif.Mugatu) </li></ul><br><br> Thanks, <br> Roy </blockquote><p>     : </p><br><ul><li> best.gif.Mugatu </li><li> GIFtToDerek.txt </li><li> Mugatuware.exe </li><li> the_key_to_success_0000.gif.Mugatu </li></ul><br><p>   ,    ,   <code>GIF</code> -. ,      <code>.Mugatu</code> .      <code>Mugatuware.exe</code> . ,     ‚Äî           .    ,      ,   . </p><br><p><img src="https://habrastorage.org/webt/no/au/se/noauseew8d2jezeoaqj9kd-pp9e.png"></p><br><p>        <code>IDA</code> ,     : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ida_segment <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ida_name <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ida_bytes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ida_typeinf idata = ida_segment.get_segm_by_name(<span class="hljs-string"><span class="hljs-string">'.idata'</span></span>) type_map = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> addr <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(idata.start_ea, idata.end_ea, <span class="hljs-number"><span class="hljs-number">4</span></span>): name = ida_name.get_name(addr) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> name: tp = ida_typeinf.idc_get_type(addr) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tp: type_map[name] = tp <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> addr <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(idata.start_ea, idata.end_ea, <span class="hljs-number"><span class="hljs-number">4</span></span>): imp = ida_bytes.get_dword(addr) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> imp != <span class="hljs-number"><span class="hljs-number">0</span></span>: imp_name = ida_name.get_name(imp) name_part = imp_name.split(<span class="hljs-string"><span class="hljs-string">'_'</span></span>)[<span class="hljs-number"><span class="hljs-number">-1</span></span>] ida_name.set_name(addr, name_part + <span class="hljs-string"><span class="hljs-string">'_imp'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> name_part <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> type_map: tp = type_map[name_part] ida_typeinf.apply_decl(addr, tp.replace(<span class="hljs-string"><span class="hljs-string">'('</span></span>, <span class="hljs-string"><span class="hljs-string">'func('</span></span>) + <span class="hljs-string"><span class="hljs-string">';'</span></span>)</code> </pre> <br><p>        : </p><br><p><img src="https://habrastorage.org/webt/f-/cl/ad/f-cladmcmadtfx1v9bdhjhobt28.png"></p><br><p>   ,        ,     <code>in-memory</code>  <code>PE</code> -.           ,        <code>CrazyPills!!!</code>  .     ,      .       <code>Sleep</code> ,      <code>http</code> -.    ,     ,      ,        .   ,          ,    ,     .    . </p><br><p><img src="https://habrastorage.org/webt/np/pq/5q/nppq5qbcpyirk9xgamtl0wh89h0.png"></p><br><p>  -         : </p><br><ul><li>         ; </li><li>   ; </li><li>           <code>Mailslots</code> ; </li><li>        <code>really, really, really, ridiculously good looking gifs</code> ; </li><li>         <code>.gif</code> .      <code>.Mugatu</code> .      <code>GIFtToDerek.txt</code>   . </li></ul><br><p>  ,   ‚Äî 8 .          <code>XOR</code>     <code>CrazyPills!!!</code> ,        .  ,        : </p><br><p><img src="https://habrastorage.org/webt/bm/em/6u/bmem6uqdty4xdugfaxuz0j9efuw.png"></p><br><p>     <code>XTEA</code> ,    ‚Äî     <code>BYTE</code> ,    <code>DWORD</code> .           .         <code>Python</code> : </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b, key)</span></span></span><span class="hljs-function">:</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">32</span></span>): t = (i + key[i &amp; <span class="hljs-number"><span class="hljs-number">3</span></span>]) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> a = (a + (t ^ (b + ((b &gt;&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ^ (b &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>))))) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> i = (<span class="hljs-number"><span class="hljs-number">0x100000000</span></span> + i - <span class="hljs-number"><span class="hljs-number">0x61C88647</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> t = (i + key[(i &gt;&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">3</span></span>]) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> b = (b + (t ^ (a + ((a &gt;&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ^ (a &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>))))) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a, b <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b, key)</span></span></span><span class="hljs-function">:</span></span> i = <span class="hljs-number"><span class="hljs-number">0xc6ef3720</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">32</span></span>): t = (i + key[(i &gt;&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">3</span></span>]) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> b = (<span class="hljs-number"><span class="hljs-number">0x100000000</span></span> + b - (t ^ (a + ((a &gt;&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ^ (a &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>))))) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> i = (i + <span class="hljs-number"><span class="hljs-number">0x61C88647</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> t = (i + key[i &amp; <span class="hljs-number"><span class="hljs-number">3</span></span>]) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> a = (<span class="hljs-number"><span class="hljs-number">0x100000000</span></span> + a - (t ^ (b + ((b &gt;&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>) ^ (b &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>))))) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a, b</code> </pre><br><p>  ,  <code>the_key_to_success_0000.gif.Mugatu</code>     .        ,     .     : </p><br><p><img src="https://habrastorage.org/webt/lm/bb/jl/lmbbjl90qtlexwxwtywt6wbh09i.gif"></p><br><p>  ,        ,        .        <code>C</code> .     <code>GIF</code> -. </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;unistd.h&gt; void decrypt(unsigned int * inp, unsigned int * outp, unsigned char * key) { unsigned int i = 0xc6ef3720; unsigned int a = inp[0]; unsigned int b = inp[1]; unsigned int t; for(int j = 0; j &lt; 32; j++) { t = i + key[(i &gt;&gt; 11) &amp; 3]; b -= t ^ (a + ((a &gt;&gt; 5) ^ (a &lt;&lt; 4))); i += 0x61C88647; t = i + key[i &amp; 3]; a -= t ^ (b + ((b &gt;&gt; 5) ^ (b &lt;&lt; 4))); } outp[0] = a; outp[1] = b; } int main() { int fd = open("best.gif.Mugatu", 0); unsigned int inp[2]; unsigned int outp[2]; unsigned int key = 0; read(fd, inp, 8); close(fd); for(unsigned long long key = 0; key &lt; 0x100000000; key++) { if((key &amp; 0xffffff) == 0) { printf("%lf\n", ((double)key) / ((double)0x100000000) * 100.0); } decrypt(inp, outp, &amp;key); if( ((char *)outp)[0] == 'G' &amp;&amp; ((char *)outp)[1] == 'I' &amp;&amp; ((char *)outp)[2] == 'F' &amp;&amp; ((char *)outp)[5] == 'a') { printf("%#llx\n", key); } } }</span></span></span></span></code> </pre> <br><p>        <code>0xb1357331</code>      : </p><br><p><img src="https://habrastorage.org/webt/cw/s5/fz/cws5fzu68wbv5mf-myteh-o8uqk.gif"></p><br><a name="task11"></a><br><h2 id="0x0b---vv_max"> 0x0B ‚Äî vv_max </h2><br><blockquote> Hey, at least its not subleq. </blockquote><p>     <code>vv_max.exe</code> ,      .          256-     .       <code>AVX2</code> ,   <code>vpermd</code> , <code>vpslld</code>  .    -    : </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">0000 clear_regs 0001 r0 = 393130324552414c46 0023 r1 = 3030303030303030303030303030303030303030303030303030303030303030 0045 r3 = 1a1b1b1b1a13111111111111111111151a1b1b1b1a1311111111111111111115 0067 r4 = 1010101010101010080408040201101010101010101010100804080402011010 0089 r5 = b9b9bfbf041310000000000000000000b9b9bfbf04131000 00ab r6 = 2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f 00cd r10 = 140014001400140014001400140014001400140014001400140014001400140 00ef r11 = 1100000011000000110000001100000011000000110000001100000011000 0111 r12 = ffffffff0c0d0e08090a040506000102ffffffff0c0d0e08090a040506000102 0133 r13 = ffffffffffffffff000000060000000500000004000000020000000100000000 0155 r16 = ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff 0177 r17 = 6a09e667bb67ae853c6ef372a54ff53a510e527f9b05688c1f83d9ab5be0cd19 0199 r18 = 428a2f9871374491b5c0fbcfe9b5dba53956c25b59f111f1923f82a4ab1c5ed5 01bb r19 = 300000002000000010000000000000007000000060000000500000004 01dd r20 = 0 01ff r21 = 100000001000000010000000100000001000000010000000100000001 0221 r22 = 200000002000000020000000200000002000000020000000200000002 0243 r23 = 300000003000000030000000300000003000000030000000300000003 0265 r24 = 400000004000000040000000400000004000000040000000400000004 0287 r25 = 500000005000000050000000500000005000000050000000500000005 02a9 r26 = 600000006000000060000000600000006000000060000000600000006 02cb r27 = 700000007000000070000000700000007000000070000000700000007 02ed r20 = vpermd(r0, r20) 02f1 r21 = vpermd(r0, r21) 02f5 r22 = vpermd(r0, r22) 02f9 r23 = vpermd(r0, r23) 02fd r24 = vpermd(r0, r24) 0301 r25 = vpermd(r0, r25) 0305 r26 = vpermd(r0, r26) 0309 r27 = vpermd(r0, r27) 030d r7 = vpsrld(r1, 4) 0311 r28 = r20 ^ r21 0315 r28 = r28 ^ r22 0319 r28 = r28 ^ r23 031d r28 = r28 ^ r24 0321 r28 = r28 ^ r25 0325 r28 = r28 ^ r26 0329 r28 = r28 ^ r27 032d r7 = r7 &amp; r6 0331 r29 = vpslld(r17, 7) 0335 r30 = vpsrld(r17, 25) 0339 r15 = r29 | r30 033d r8 = vpcmpeqb(r1, r6) 0341 r29 = vpslld(r17, 21) 0345 r30 = vpsrld(r17, 11) 0349 r29 = r29 | r30 034d r15 = r15 ^ r29 0351 r8 = vpcmpeqb(r1, r6) 0355 r29 = vpslld(r17, 26) 0359 r30 = vpsrld(r17, 6) 035d r29 = r29 | r30 0361 r15 = r15 ^ r29 0365 r29 = r20 ^ r16 0369 r30 = r20 &amp; r18 036d r29 = r29 ^ r30 0371 r15 = add_d(r29, r15) 0375 r20 = add_d(r15, r0) 0379 r7 = add_b(r8, r7) 037d r29 = r20 ^ r28 0381 r17 = vpermd(r29, r19) 0385 r7 = vpshufb(r5, r7) 0389 r29 = vpslld(r17, 7) 038d r30 = vpsrld(r17, 25) 0391 r15 = r29 | r30 0395 r29 = vpslld(r17, 21) 0399 r30 = vpsrld(r17, 11) 039d r29 = r29 | r30 03a1 r15 = r15 ^ r29 03a5 r29 = vpslld(r17, 26) 03a9 r30 = vpsrld(r17, 6) 03ad r29 = r29 | r30 03b1 r15 = r15 ^ r29 03b5 r2 = add_b(r1, r7) 03b9 r29 = r21 ^ r16 03bd r30 = r21 &amp; r18 03c1 r29 = r29 ^ r30 03c5 r15 = add_d(r29, r15) 03c9 r21 = add_d(r15, r0) 03cd r29 = r21 ^ r28 03d1 r17 = vpermd(r29, r19) 03d5 r20 = r20 ^ r21 03d9 r29 = vpslld(r17, 7) 03dd r30 = vpsrld(r17, 25) 03e1 r15 = r29 | r30 03e5 r29 = vpslld(r17, 21) 03e9 r30 = vpsrld(r17, 11) 03ed r29 = r29 | r30 03f1 r15 = r15 ^ r29 03f5 r29 = vpslld(r17, 26) 03f9 r30 = vpsrld(r17, 6) 03fd r29 = r29 | r30 0401 r15 = r15 ^ r29 0405 r7 = vpmaddubsw(r2, r10) 0409 r29 = r22 ^ r16 040d r30 = r22 &amp; r18 0411 r29 = r29 ^ r30 0415 r15 = add_d(r29, r15) 0419 r22 = add_d(r15, r0) 041d r29 = r22 ^ r28 0421 r17 = vpermd(r29, r19) 0425 r20 = r20 ^ r22 0429 r29 = vpslld(r17, 7) 042d r30 = vpsrld(r17, 25) 0431 r15 = r29 | r30 0435 r29 = vpslld(r17, 21) 0439 r30 = vpsrld(r17, 11) 043d r29 = r29 | r30 0441 r15 = r15 ^ r29 0445 r29 = vpslld(r17, 26) 0449 r30 = vpsrld(r17, 6) 044d r29 = r29 | r30 0451 r15 = r15 ^ r29 0455 r2 = vpmaddwd(r7, r11) 0459 r29 = r23 ^ r16 045d r30 = r23 &amp; r18 0461 r29 = r29 ^ r30 0465 r15 = add_d(r29, r15) 0469 r23 = add_d(r15, r0) 046d r29 = r23 ^ r28 0471 r17 = vpermd(r29, r19) 0475 r20 = r20 ^ r23 0479 r29 = vpslld(r17, 7) 047d r30 = vpsrld(r17, 25) 0481 r15 = r29 | r30 0485 r29 = vpslld(r17, 21) 0489 r30 = vpsrld(r17, 11) 048d r29 = r29 | r30 0491 r15 = r15 ^ r29 0495 r29 = vpslld(r17, 26) 0499 r30 = vpsrld(r17, 6) 049d r29 = r29 | r30 04a1 r15 = r15 ^ r29 04a5 r29 = r24 ^ r16 04a9 r30 = r24 &amp; r18 04ad r29 = r29 ^ r30 04b1 r15 = add_d(r29, r15) 04b5 r24 = add_d(r15, r0) 04b9 r29 = r24 ^ r28 04bd r17 = vpermd(r29, r19) 04c1 r20 = r20 ^ r24 04c5 r29 = vpslld(r17, 7) 04c9 r30 = vpsrld(r17, 25) 04cd r15 = r29 | r30 04d1 r29 = vpslld(r17, 21) 04d5 r30 = vpsrld(r17, 11) 04d9 r29 = r29 | r30 04dd r15 = r15 ^ r29 04e1 r29 = vpslld(r17, 26) 04e5 r30 = vpsrld(r17, 6) 04e9 r29 = r29 | r30 04ed r15 = r15 ^ r29 04f1 r29 = r25 ^ r16 04f5 r30 = r25 &amp; r18 04f9 r29 = r29 ^ r30 04fd r15 = add_d(r29, r15) 0501 r25 = add_d(r15, r0) 0505 r29 = r25 ^ r28 0509 r17 = vpermd(r29, r19) 050d r20 = r20 ^ r25 0511 r2 = vpshufb(r2, r12) 0515 r29 = vpslld(r17, 7) 0519 r30 = vpsrld(r17, 25) 051d r15 = r29 | r30 0521 r29 = vpslld(r17, 21) 0525 r30 = vpsrld(r17, 11) 0529 r29 = r29 | r30 052d r15 = r15 ^ r29 0531 r29 = vpslld(r17, 26) 0535 r30 = vpsrld(r17, 6) 0539 r29 = r29 | r30 053d r15 = r15 ^ r29 0541 r29 = r26 ^ r16 0545 r30 = r26 &amp; r18 0549 r29 = r29 ^ r30 054d r15 = add_d(r29, r15) 0551 r26 = add_d(r15, r0) 0555 r29 = r26 ^ r28 0559 r17 = vpermd(r29, r19) 055d r20 = r20 ^ r26 0561 r29 = vpslld(r17, 7) 0565 r30 = vpsrld(r17, 25) 0569 r15 = r29 | r30 056d r29 = vpslld(r17, 21) 0571 r30 = vpsrld(r17, 11) 0575 r29 = r29 | r30 0579 r15 = r15 ^ r29 057d r29 = vpslld(r17, 26) 0581 r30 = vpsrld(r17, 6) 0585 r29 = r29 | r30 0589 r15 = r15 ^ r29 058d r2 = vpermd(r2, r13) 0591 r29 = r27 ^ r16 0595 r30 = r27 &amp; r18 0599 r29 = r29 ^ r30 059d r15 = add_d(r29, r15) 05a1 r27 = add_d(r15, r0) 05a5 r29 = r27 ^ r28 05a9 r17 = vpermd(r29, r19) 05ad r20 = r20 ^ r27 05b1 r19 = ffffffffffffffffffffffffffffffffffffffffffffffff 05d3 r20 = r20 &amp; r19 05d7 r31 = 2176620c3a5c0f290b583618734f07102e332623780e59150c05172d4b1b1e22</code> </pre> </div></div><br><p>             <code>FLARE2019</code> .        ,     ,    .  ,      <code>FLARE2019</code> .    <code>r2</code>  <code>r20</code> .     ,   <code>r20</code>      .     <code>r2</code>  ‚Äî      6  <code>r2</code> .           ,   6       .     <code>Frida</code> : </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># vvmax.py from __future__ import print_function import frida import string import hexdump def check(val): global gdata with open('vvmax.js', 'r') as f: script_src = f.read() pid = frida.spawn(['vv_max.exe', 'FLARE2019', val.ljust(32, 'a')]) session = frida.attach(pid) script = session.create_script(script_src) def handler(message, data): handler.data = data script.on('message', handler) script.load() frida.resume(pid) while not hasattr(handler, 'data'): pass session.detach() return handler.data alph = string.printable def to_bits(x): return ''.join(bin(ord(i))[2:].zfill(8) for i in x) target = to_bits('pp\xb2\xac\x01\xd2^a\n\xa7*\xa8\x08\x1c\x86\x1a\xe8E\xc8)\xb2\xf3\xa1\x1e\x00\x00\x00\x00\x00\x00\x00\x00') password = '' while len(password) != 32: for c in alph: data = to_bits(check(password + c)) i = 6*len(password + c) if data[:i] == target[:i]: password += c i += 1 break print() print('-----&gt;', `password`) print()</span></span></code> </pre> <br><pre> <code class="plaintext hljs">// vvmax.js var modules = Process.enumerateModules(); var base = modules[0].base; Interceptor.attach(base.add(0x1665), function() { var p = this.context.rdx.add(0x840); var res = p.readByteArray(32); send(null, res); });</code> </pre> <br><p>        : </p><br><p><img src="https://habrastorage.org/webt/wo/d7/xp/wod7xpefz_k328dmgnuvnmy7ifi.png"></p><br><a name="task12"></a><br><h2 id="0x0c---help"> 0x0C ‚Äî help </h2><br><blockquote> You're my only hope FLARE-On player! One of our developers was hacked and we're not sure what they took. We managed to set up a packet capture on the network once we found out but they were definitely already on the system. I think whatever they installed must be buggy ‚Äî it looks like they crashed our developer box. We saved off the dump file but I can't make heads or tails of it ‚Äî PLEASE HELP!!!!!! </blockquote><p>       .      <code>RAM</code> -    .       <code>4444</code> , <code>6666</code> , <code>7777</code>  <code>8888</code> .   ,   , ,    <code>RAM</code> -.      <code>volatility</code> .           <code>volatility</code>   <code>Win10x64_15063</code> ,    ,     <code>Win7SP1x64</code> ,        . </p><br><p>      <code>volatility</code>       : </p><br><pre> <code class="plaintext hljs">$ volatility --profile Win7SP1x64 -f help.dmp modules Volatility Foundation Volatility Framework 2.6 Offset(V) Name Base Size File ------------------ -------------------- ------------------ ------------------ ---- 0xfffffa800183e890 ntoskrnl.exe 0xfffff80002a49000 0x5e7000 \SystemRoot\system32\ntoskrnl.exe ... 0xfffffa800428ff30 man.sys 0xfffff880033bc000 0xf000 \??\C:\Users\FLARE ON 2019\Desktop\man.sys</code> </pre> <br><p>     : </p><br><pre> <code class="plaintext hljs">$ volatility --profile Win7SP1x64 -f help.dmp moddump --base 0xfffff880033bc000 -D drivers Volatility Foundation Volatility Framework 2.6 Module Base Module Name Result ------------------ -------------------- ------ 0xfffff880033bc000 man.sys Error: e_magic 0000 is not a valid DOS signature.</code> </pre> <br><p> ,   .       <code>volshell</code>    . </p><br><pre> <code class="plaintext hljs">$ volatility --profile Win7SP1x64 -f help.dmp volshell In [1]: db(0xfffff880033bc000) 0xfffff880033bc000 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0xfffff880033bc010 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0xfffff880033bc020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0xfffff880033bc030 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0xfffff880033bc040 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0xfffff880033bc050 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0xfffff880033bc060 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0xfffff880033bc070 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ In [2]: db(0xfffff880033bc000 + 0x1100) 0xfffff880033bd100 01 48 8b 4c 24 20 48 8b 44 24 28 48 89 41 08 48 .HL$.HD$(HAH 0xfffff880033bd110 83 c4 18 c3 cc cc cc cc cc cc cc cc cc cc cc cc ................ 0xfffff880033bd120 48 89 4c 24 08 48 83 ec 38 48 8b 44 24 40 0f be HL$.H..8H.D$@.. 0xfffff880033bd130 48 43 48 8b 44 24 40 0f be 40 42 83 c0 01 3b c8 HCH.D$@..@B...;. 0xfffff880033bd140 7e 27 45 33 c9 41 b8 15 5b 00 00 48 8d 15 de 44 ~'E3.A..[..H...D 0xfffff880033bd150 00 00 48 8d 0d 07 45 00 00 ff 15 71 4f 00 00 c7 ..H...E....qO... 0xfffff880033bd160 44 24 20 00 00 00 00 eb 08 c7 44 24 20 01 00 00 D$........D$.... 0xfffff880033bd170 00 48 8b 44 24 40 48 8b 80 b8 00 00 00 48 83 c4 .HD$@H......H.. In [4]: man = addrspace().read(0xfffff880033bc000, 0xf000) In [5]: with open('man_writeup.sys', 'wb') as f: ...: f.write(man) ...:</code> </pre> <br><p> ,    ,   <code>moddump</code>  .   .      .  -    ,   ,      . </p><br><p>           <code>RC4</code>   .          ,        . </p><br><p>             <code>user-space</code> .      <code>DLL</code> -   .          <code>DLL</code> - ( <code>m.dll</code> ),    .         ,                 .          : </p><br><ul><li>      ( <code>+0x8</code> ) </li><li>   <code>_EPROCESS</code>   ( <code>+0x68</code> ) </li><li>     ( <code>+0x48</code> ) </li><li>   ( <code>+0x58</code> ) </li></ul><br><p>  <code>DLL</code> -           <code>RC4</code> ,       <code>0x2c</code> -   ,    <code>0x48</code> . </p><br><p>      <code>volatility</code>      <code>volshell</code> : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Crypto.Cipher <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ARC4 head = <span class="hljs-number"><span class="hljs-number">0xfffff880033c8158</span></span> krnl = addrspace() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">u64</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> struct.unpack(<span class="hljs-string"><span class="hljs-string">'Q'</span></span>, x)[<span class="hljs-number"><span class="hljs-number">0</span></span>] fd = u64(krnl.read(head, <span class="hljs-number"><span class="hljs-number">8</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: proc_addr = u64(krnl.read(fd + <span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>)) base = u64(krnl.read(fd + <span class="hljs-number"><span class="hljs-number">0x48</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>)) key = krnl.read(fd + <span class="hljs-number"><span class="hljs-number">0x48</span></span>, <span class="hljs-number"><span class="hljs-number">0x2c</span></span>) sz = u64(krnl.read(fd + <span class="hljs-number"><span class="hljs-number">0x58</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>)) fd = u64(krnl.read(fd, <span class="hljs-number"><span class="hljs-number">8</span></span>)) p = obj.Object(<span class="hljs-string"><span class="hljs-string">'_EPROCESS'</span></span>, proc_addr, krnl) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> p.ImageFileName.v(), hex(proc_addr), hex(base), hex(sz) proc_space = p.get_process_address_space() dump = proc_space.read(base, sz) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> dump[:<span class="hljs-number"><span class="hljs-number">0x100</span></span>] == <span class="hljs-string"><span class="hljs-string">'\x00'</span></span> * <span class="hljs-number"><span class="hljs-number">0x100</span></span>: dump = ARC4.new(key).decrypt(dump) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'proc_{:016x}'</span></span>.format(base), <span class="hljs-string"><span class="hljs-string">'wb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: f.write(dump) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> fd == head: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre> <br><p>   ,  ,            <code>RC4</code> .         <code>IDA</code> ,   ,         : </p><br><div class="spoiler"> <b class="spoiler_title">  IDA</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> __future__ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> print_function <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> idaapi <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_func, decompile, get_name_ea, auto_wait, BADADDR <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> idaapi <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cot_call, cot_obj, init_hexrays_plugin, qexit <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ida_typeinf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ida_lines <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rc4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key, data)</span></span></span><span class="hljs-function">:</span></span> S = list(range(<span class="hljs-number"><span class="hljs-number">256</span></span>)) j = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> list(range(<span class="hljs-number"><span class="hljs-number">256</span></span>)): j = (j + S[i] + ord(key[i % len(key)])) % <span class="hljs-number"><span class="hljs-number">256</span></span> S[i], S[j] = S[j], S[i] j = <span class="hljs-number"><span class="hljs-number">0</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span> out = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> char <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data: j = (j + <span class="hljs-number"><span class="hljs-number">1</span></span>) % <span class="hljs-number"><span class="hljs-number">256</span></span> y = (y + S[j]) % <span class="hljs-number"><span class="hljs-number">256</span></span> S[j], S[y] = S[y], S[j] out.append(chr(ord(char) ^ S[(S[j] + S[y]) % <span class="hljs-number"><span class="hljs-number">256</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>.join(out) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrypt_stack_str_args</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ea)</span></span></span><span class="hljs-function">:</span></span> func = get_func(ea) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> func <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: c_func = decompile(func) c_func.pseudocode <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ex: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> citem <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> c_func.treeitems: citem = citem.to_specific_type <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> citem.is_expr() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span>\ citem.op == cot_call <span class="hljs-keyword"><span class="hljs-keyword">and</span></span>\ citem.ea == ea: args = [] key = citem.a[<span class="hljs-number"><span class="hljs-number">0</span></span>] key_len = citem.a[<span class="hljs-number"><span class="hljs-number">1</span></span>] s = citem.a[<span class="hljs-number"><span class="hljs-number">2</span></span>] s_len = citem.a[<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_var_idx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> obj.opname != <span class="hljs-string"><span class="hljs-string">'var'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> obj.opname <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'ref'</span></span>, <span class="hljs-string"><span class="hljs-string">'cast'</span></span>): obj = obj.x <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception(<span class="hljs-string"><span class="hljs-string">'can\'t find type'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj.v.idx <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> key_len.opname != <span class="hljs-string"><span class="hljs-string">'num'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> s_len.opname != <span class="hljs-string"><span class="hljs-string">'num'</span></span>: print(<span class="hljs-string"><span class="hljs-string">'[!] can\'t get length: 0x{:08x}'</span></span>.format(ea)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: key_len_val = key_len.n._value s_len_val = s_len.n._value print(<span class="hljs-string"><span class="hljs-string">'0x{:08x}'</span></span>.format(ea), <span class="hljs-string"><span class="hljs-string">'key_len ='</span></span>, key_len_val, <span class="hljs-string"><span class="hljs-string">', s_len ='</span></span>, s_len_val) hx_view = idaapi.open_pseudocode(ea, <span class="hljs-number"><span class="hljs-number">-1</span></span>) key_var_stkoff = hx_view.cfunc.get_lvars()[get_var_idx(key)].location.stkoff() s_var_stkoff = hx_view.cfunc.get_lvars()[get_var_idx(s)].location.stkoff() key_var = [v <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hx_view.cfunc.get_lvars() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> v.location.stkoff() == key_var_stkoff][<span class="hljs-number"><span class="hljs-number">0</span></span>] tif = ida_typeinf.tinfo_t() ida_typeinf.parse_decl(tif, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'unsigned __int8 [{}];'</span></span>.format(key_len_val), <span class="hljs-number"><span class="hljs-number">0</span></span>) hx_view.set_lvar_type(key_var, tif) s_var = [v <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hx_view.cfunc.get_lvars() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> v.location.stkoff() == s_var_stkoff][<span class="hljs-number"><span class="hljs-number">0</span></span>] tif = ida_typeinf.tinfo_t() ida_typeinf.parse_decl(tif, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'unsigned __int8 [{}];'</span></span>.format(s_len_val + <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>) hx_view.set_lvar_type(s_var, tif) key_var = [v <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hx_view.cfunc.get_lvars() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> v.location.stkoff() == key_var_stkoff][<span class="hljs-number"><span class="hljs-number">0</span></span>] s_var = [v <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hx_view.cfunc.get_lvars() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> v.location.stkoff() == s_var_stkoff][<span class="hljs-number"><span class="hljs-number">0</span></span>] key_regex = re.compile(<span class="hljs-string"><span class="hljs-string">'{}\[(.+)\] = (.+);'</span></span>.format(key_var.name)) s_regex = re.compile(<span class="hljs-string"><span class="hljs-string">'{}\[(.+)\] = (.+);'</span></span>.format(s_var.name)) key = bytearray(key_len_val) s = bytearray(s_len_val + <span class="hljs-number"><span class="hljs-number">1</span></span>) src = <span class="hljs-string"><span class="hljs-string">'\n'</span></span>.join([ida_lines.tag_remove(i.line) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hx_view.cfunc.pseudocode]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s_regex.findall(src): s[int(i)] = (<span class="hljs-number"><span class="hljs-number">0x100</span></span> + int(j)) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> key_regex.findall(src): key[int(i)] = (<span class="hljs-number"><span class="hljs-number">0x100</span></span> + int(j)) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span> key = <span class="hljs-string"><span class="hljs-string">''</span></span>.join(chr(i) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> key) s = <span class="hljs-string"><span class="hljs-string">''</span></span>.join(chr(i) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) result = rc4(key, s[:<span class="hljs-number"><span class="hljs-number">-1</span></span>]) <span class="hljs-comment"><span class="hljs-comment"># unicode to ascii if set(ord(i) for i in result[1::2]) == {0}: result = 'wide_' + ''.join(result[0::2]) hx_view.rename_lvar(s_var, 's_' + result, True) except Exception as ex: print('[!] error: {}'.format(ex)) print('#### decryption helper script ####') xref_to = get_name_ea(BADADDR, 'decrypt_stack_str') xref_from = get_first_cref_to(xref_to) while xref_from != BADADDR: print('### 0x{:08x}'.format(xref_from)) decrypt_stack_str_args(xref_from) xref_from = get_next_cref_to(xref_to, xref_from)</span></span></code> </pre> </div></div><br><p>    : </p><br><p><img src="https://habrastorage.org/webt/v9/xx/cg/v9xxcgdktosjrdfyg8ohucbha6g.png"></p><br><p>      .       : </p><br><ul><li> <code>m.dll</code> ‚Äî ,    .   <code>4444</code>   .   ‚Äî           ; </li><li> <code>n.dll</code> ‚Äî         <code>192.168.1.243</code> ; </li><li> <code>c.dll</code> ‚Äî          <code>RC4</code> .       ; </li><li> <code>k.dll</code> ‚Äî            (keylogger); </li><li> <code>s.dll</code> ‚Äî       ; </li><li> <code>f.dll</code> ‚Äî       . </li></ul><br><p>      ,       <code>XOR</code>    8.      <code>4444</code>       , ..       .       :    ,       ‚Äî      . ,   -   . </p><br><p>    ( <code>4444</code> )     . ,     -   .       ,      .            : </p><br><ul><li> keys.kdb </li><li> C:\ </li><li> C:\keypass\keys.kdb </li></ul><br><p> ,        <code>f.dll</code> :       <code>keys.kdb</code> ,      . </p><br><p>     <code>6666</code>     .      <code>LZNT1</code>     <code>RC4</code>  <code>XOR</code> .   ,  <code>XOR</code> -  , ..       .   <code>RC4</code>    ,     <code>RAM</code> -: <code>FLARE ON 2019</code> .  ,   <code>GetUserNameA</code> ,        ,            -   ,      <code>RC4</code> .      <code>LZNT1</code>     : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ctypes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * nt = windll.ntdll <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> fname <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">'input'</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(fname, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: buf = f.read() dec_data = create_string_buffer(<span class="hljs-number"><span class="hljs-number">0x10000</span></span>) final_size = c_ulong(<span class="hljs-number"><span class="hljs-number">0</span></span>) status = nt.RtlDecompressBuffer( <span class="hljs-number"><span class="hljs-number">0x102</span></span>, <span class="hljs-comment"><span class="hljs-comment"># COMPRESSION_FORMAT_LZNT1 dec_data, # UncompressedBuffer 0x10000, # UncompressedBufferSize c_char_p(buf), # CompressedBuffer 0xFFFFFF, # CompressedBufferSize byref(final_size) # FinalUncompressedSize ) with open(fname + '.uncompressed', 'wb') as f: f.write(dec_data.raw[:final_size.value])</span></span></code> </pre> <br><p>         <code>6666</code> .    : </p><br><pre> <code class="plaintext hljs">00000000: CC 69 94 FA 6A 37 18 29 CB 8D 87 EF 11 63 8E 73 .i..j7.).....cs 00000010: FE AB 43 3B B3 94 28 4B 4D 19 00 00 00 4F DB C7 ..C;..(KM....O.. 00000020: F3 1E E4 13 15 34 8F 51 A9 2B C2 D7 C1 96 78 F7 .....4.Q.+....x. 00000030: 91 98</code> </pre> <br><p>     ,  : </p><br><pre> <code class="plaintext hljs">00000000: 19 00 00 00 4F DB C7 F3 1E E4 13 15 34 8F 51 A9 ....O.......4.Q. 00000010: 2B C2 D7 C1 96 78 F7 91 98 +....x...</code> </pre> <br><p>  4   ‚Äî    ,     25.   : </p><br><pre> <code class="plaintext hljs">00000000: 12 B0 00 43 3A 5C 6B 65 79 70 61 04 73 73 01 70 ...C:\keypa.ss.p 00000010: 73 2E 6B 64 62 s.kdb</code> </pre> <br><p>        <code>C:\keypass\keys.kdb</code> .   ,      ,     .      <code>6666</code>     ‚Äî      <code>KeePass</code> . </p><br><p>     <code>7777</code>        <code>BMP</code> .       <code>XOR</code> ,   ,     , ..          .       ,   ,    <code>KeePass</code> . </p><br><p><img src="https://habrastorage.org/webt/3h/wg/ud/3hwgud3zz5s77zqiv2siwqjexve.png"></p><br><p><img src="https://habrastorage.org/webt/su/u2/dl/suu2dlwj1a8sqd5nq0vt2oqqkg8.png"></p><br><p>     <code>8888</code>     <code>k.dll</code> ‚Äî      . </p><br><pre> <code class="plaintext hljs">C:\Windows\system32\cmd.exe nslookup googlecom ping 1722173110 nslookup soeblogcom nslookup fiosquatumgatefiosrouterhome C:\Windows\system32\cmd.exe Start Start menu Start menu chrome www.flare-on.com - Google Chrome tis encrypting something twice better than once Is encrypting something twice better than once? - Google Search - Google Chrome Start Start menu Start menu keeKeePass &lt;DYN_TITLE&gt; th1sisth33nd111 KeePass keys.kdb - KeePass Is encrypting something twice better than once? - Google Search - Google Chrome Start Start menu Start menu KeePass &lt;DYN_TITLE&gt; th1sisth33nd111 Open Database - keys.kdb KeePass Start Start menu Start menu KeePass Start menu Start menu Start menu KeePass &lt;DYN_TITLE&gt; th1sisth33nd111</code> </pre> <br><p>       <code>th1sisth33nd111</code>     ,    .    ,     .   ,  keylogger          . ,   ,    <code>ping</code>    .      <code>hashcat</code>      <code>KeePass</code>   ,    .              : </p><br><pre> <code class="plaintext hljs">$ strings help.dmp | grep -i '3nd!' !s_iS_th3_3Nd!!!</code> </pre> <br><p>  <code>Th</code>        . </p><br><p><img src="https://habrastorage.org/webt/xb/9g/yb/xb9gyb5mnp6evacpllttaz1czco.png"></p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>     .      ,   -. </p><br><a name="outro"></a><br><h2 id="0x0d---itog"> 0x0D ‚Äî  </h2><br><p> ,  .   ,       ,        .      ,        <code>volatility</code> ,      .            (  UTC+3:00): </p><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/am/yq/ul/amyquljwc2ieb2qzb4ct9nemtnm.png"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id469393/">https://habr.com/ru/post/id469393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id469381/index.html">Agones, buat server game multi-pengguna. Arsitektur dan Instalasi</a></li>
<li><a href="../id469383/index.html">Solusi Hyperconverged AERODISK vAIR. Dasar - Sistem File ARDFS</a></li>
<li><a href="../id469387/index.html">Kisah satu "pengembang" atau bagaimana pendatang baru menulis aplikasi untuk iOS</a></li>
<li><a href="../id469389/index.html">Parameterisasi oleh jaringan saraf model fisik untuk memecahkan masalah optimasi topologi</a></li>
<li><a href="../id469391/index.html">Audio Interfaces: Berbunyi sebagai sumber informasi di jalan, di kantor dan di langit</a></li>
<li><a href="../id469395/index.html">Di mana dan bagaimana menggunakan multicolumns (Kolom CSS)</a></li>
<li><a href="../id469399/index.html">Wi-Fi di Estate-Museum Arkhangelskoye</a></li>
<li><a href="../id469401/index.html">Pembaruan Layanan 3CX WebMeeting, Elastix Online Converter dan Video Tutorial Baru</a></li>
<li><a href="../id469403/index.html">Kami sedang mewawancarai seorang kandidat untuk posisi Senior Software Developer</a></li>
<li><a href="../id469405/index.html">Deep Learning sekarang ada di Jawa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>