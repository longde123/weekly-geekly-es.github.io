<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úäüèæ üå®Ô∏è ü§ò Como iniciar micropagamentos em seu aplicativo üë∞üèº ‚óÄÔ∏è üöÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na semana passada, desenvolvi meu primeiro programa p√∫blico - um rob√¥ Telegram que funciona como uma carteira Bitcoin e permite que voc√™ "jogue moedas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como iniciar micropagamentos em seu aplicativo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452696/">  Na semana passada, desenvolvi meu primeiro programa p√∫blico - um rob√¥ Telegram que funciona como uma carteira Bitcoin e permite que voc√™ "jogue moedas" para outros membros de bate-papos em grupo e tamb√©m fa√ßa pagamentos externos de Bitcoin para voc√™ ou para os chamados  "Aplicativos Lightning".  Quero dizer que, em geral, o leitor est√° familiarizado com Bitcoin e Telegram, como  Vou tentar escrever brevemente, sem entrar em detalhes.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Uma sele√ß√£o de recursos sobre o Bitcoin est√° dispon√≠vel neste link</a> , mas o Telegram √© uma ferramenta de mensagens instant√¢neas para dispositivos m√≥veis e PCs que permite criar seus pr√≥prios aplicativos pequenos (bots de bate-papo) em sua plataforma. <br><br><h3>  Quais s√£o os principais recursos deste aplicativo? </h3><br><ul><li>  Permite agradecer ou recompensar o interlocutor com um valor verdadeiramente material, e n√£o apenas um <i>"virtual like"</i> , isso leva a comunica√ß√£o eletr√¥nica a um n√≠vel totalmente novo </li><li>  Um exemplo do mundo real de um aplicativo que pode interagir financeiramente com outros aplicativos usando um protocolo de pagamento aberto </li><li>  Todos os componentes do aplicativo s√£o projetos de c√≥digo aberto e √© poss√≠vel modific√°-los e aplic√°-los √†s suas tarefas.  O aplicativo n√£o utiliza solu√ß√µes fechadas e / ou comerciais, apesar de se enquadrar no escopo do com√©rcio eletr√¥nico, hoje dif√≠cil de chamar de aberto. </li></ul><br><h3>  E como aplic√°-lo nos neg√≥cios? </h3><br>  algo assim ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/097/02b/175/09702b1750c94616a10fc66c1275c00f.png" alt="imagem"></div><a name="habracut"></a><br>  mais ou menos ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ef/1ff/85f/3ef1ff85f1e7b77662c63a9d4d838666.png" alt="imagem"></div><br>  O que esses n√∫meros significam?  Estas s√£o <b>unidades de Bitcoin - Satoshi</b> .  A pre√ßos de c√¢mbio de meados de 2019, 1000 Satoshi √© de aproximadamente US $ 0,06.  Satoshi pode ser gasto on-line ou facilmente trocado por moeda nacional.  √â por esse motivo (liquidez) que essa n√£o √© apenas mais uma <i>‚Äúentrada no banco de dados‚Äù</i> ou <i>‚Äúpontos que voc√™ pode gastar nas lojas de nossos parceiros‚Äù,</i> mas <b>dinheiro de verdade na Internet</b> . <br>  <i>* Quero observar imediatamente que, deliberadamente, n√£o estou tentando escrever algumas palavras ou frases em russo. Em alguns casos, n√£o conhe√ßo a tradu√ß√£o contextual em si, ou essa tradu√ß√£o, na minha opini√£o, parece mais confusa do que correta.</i> <br><br>  A quest√£o pode surgir: como usar esse aplicativo se n√£o houver bitcoins.  Eles podem ser comprados facilmente em pequenas quantidades em uma das muitas trocas ou trocadores, ou voc√™ pode obt√™-lo de um amigo de bitcoin ou at√© mesmo obter moedas de usu√°rios de bot atuais.  Muitas carteiras no telefone oferecem comprar bitcoins diretamente "sem sair do caixa". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/883/661/461/883661461bdc686aec7d084d5d581236.png" alt="imagem"><img src="https://habrastorage.org/getpro/habr/post_images/779/716/5d9/7797165d93d292700d9a41a171d882a6.png" alt="imagem"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="imagem"><br><br>  Quando pegamos bitcoins (mas Satoshi (?)) - execute <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@atomic_tipbot</a> e fa√ßa / deposite. <br><br>  O bot em resposta perguntar√° quanto satoshi adicionar ao saldo e enviar√° uma conta para pagamento, que pode ser paga com uma carteira m√≥vel, digitalizando o c√≥digo QR ou clicando no bot√£o ( <i>"abrir na carteira"</i> ) na p√°gina da fatura. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="imagem"><img src="https://habrastorage.org/getpro/habr/post_images/4a3/da5/f76/4a3da5f76574ac9ebb2161d56bceff62.png" alt="imagem"><img src="https://habrastorage.org/getpro/habr/post_images/54d/a43/0be/54da430be68237193dee82ade50bab37.png" alt="imagem"><br><br>  Depois de confirmar o pagamento na sua carteira, quase imediatamente uma confirma√ß√£o de pagamento ser√° enviada ao bot e isso ser√° exibido visualmente no quadro da conta. <br><br>  At√© esse momento, abordamos dois componentes do aplicativo - o bot de telegrama de back-end e o sistema de processamento de pagamentos por criptomoeda (em vez disso, seu front-end). <br><br>  Para criar um bot de Telegram, usei o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Python Telegram Bot</a> .  E, claro, o pr√≥prio bot de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">c√≥digo aberto</a> . <br><br>  Como um sistema para processar pagamentos e resolver problemas de UX, a escolha caiu (na verdade, quase n√£o existe escolha) no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BTCPayServer</a> , para o qual a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o est√° dispon√≠vel neste link</a> . <br><br>  Se voc√™ procurar solu√ß√µes para o processamento direto de eventos de pagamento, preste aten√ß√£o √†s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°ginas de manual</a> da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Electrum CLI</a> para os chamados  pagamentos em cadeia e para solu√ß√µes instant√¢neas de micropagamentos (Lightning), como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lightning-charge</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sparko</a> . <br><br><h3>  Ent√£o, √© auto-hospedado ou n√£o!? </h3><br>  √â sim.  No meu aplicativo, uso o BTCPayServer - BTCPayJungle de hospedagem gratuita, mas √© absolutamente poss√≠vel e n√£o requer muito tempo para iniciar meu pr√≥prio centro de processamento.  No entanto, vale lembrar que voc√™ precisar√° de aproximadamente 500 GB dispon√≠veis na ferrovia para armazenar as blockchains Bitcoin (e Litecoin).  Tamb√©m exigir√° recursos de computa√ß√£o e de rede para a dura√ß√£o da sincroniza√ß√£o e, dependendo de suas necessidades, os "wrappers" necess√°rios para as cadeias de blocos, para que seja conveniente interagir com eles.  O BTCPayServer n√£o cont√©m chaves privadas <i>projetadas</i> ou qualquer outra informa√ß√£o que permita controlar sua carteira. <br><br>  Para pagamentos em cadeia (regulares), √© necess√°rio adicionar o chamado  chave xpub-wallet no BTCPayServer para gerar endere√ßos de recebimento (chaves p√∫blicas).  Isso torna poss√≠vel e seguro usar o BTCPayServer mesmo em um formul√°rio "compartilhado".  Todas essas chaves e endere√ßos xpub podem ser facilmente obtidos em boas carteiras como a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Electrum</a> , para posterior processamento do processamento. <br><br>  Todo mundo que se deparou com o Bitcoin ouviu que o Bitcoin √© lento e as transa√ß√µes s√£o caras, especialmente quando √© exagero; portanto, para micropagamentos instant√¢neos, voc√™ deve usar transa√ß√µes (fora da cadeia) da Lightning Network. <br><br><h3>  O que √© essa rede Lightning? </h3><br>  Este √© um plugin para bitcoin que cria uma camada adicional de abstra√ß√£o e permite que voc√™ fa√ßa transa√ß√µes instant√¢neas e quase gratuitas na rede Bitcoin.  Tudo isso √© poss√≠vel gra√ßas √† magia criptogr√°fica com v√°rias assinaturas, geralmente chamada de <i>contrato inteligente</i> .  Existem v√°rias implementa√ß√µes do protocolo Lightning Network, eu uso a implementa√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">c-lightning</a> em C. <br><br>  A principal diferen√ßa entre pagamentos on-chain e off-chain (Lightning) √© como eles s√£o armazenados.  Todas as transa√ß√µes <b>on-chain</b> s√£o retransmitidas para todos os n√≥s da rede at√© que um dos n√≥s do Bitcoin anuncie um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">novo bloco minado</a> com as transa√ß√µes inclu√≠das nele.  (H√° at√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">BitFury no hub</a> ; eles apenas produzem ferro para minera√ß√£o).  √â por esse motivo que chamamos essas transa√ß√µes <b>em cadeia</b> .  Tais transa√ß√µes ser√£o registradas em uma blockchain comum e armazenadas nela at√© o final de sua exist√™ncia.  Essas transa√ß√µes tamb√©m s√£o de dom√≠nio p√∫blico e podem ser monitoradas, rastreadas e analisadas. <br><br>  No caso de transa√ß√µes <b>fora da cadeia</b> (Lightning), tudo acontece de maneira diferente.  Cada n√≥ da rede Lightning possui um <i>(ou mais)</i> endere√ßos na cadeia - esses s√£o os endere√ßos Bitcoin habituais dos quais tudo come√ßa.  Quando os bitcoins aparecem nesse endere√ßo, √© poss√≠vel abrir o chamado.  <i>canal de raio</i> para outro n√≥, o que significa que, com a ajuda de t√©cnicas criptogr√°ficas, esses dois n√≥s concordaram com a disponibilidade de fundos entre si.  Posteriormente, todas as transa√ß√µes (pr√≥prias e de n√≥s estrangeiros) que passam por esse canal s√£o armazenadas apenas nos n√≥s dos participantes da transa√ß√£o (e n√≥s intermedi√°rios).  As √∫nicas transa√ß√µes registradas na blockchain s√£o transa√ß√µes sobre abertura ou fechamento de um canal.  Em uma escala mais completa, obtemos uma rede de n√≥s interconectados que cria entre os participantes milhares de maneiras diferentes de "transferir" fundos de um n√≥ para outro, de acordo com certas regras estritas.  Quase todas essas transa√ß√µes s√£o armazenadas apenas no arquivo de banco de dados dos pr√≥prios n√≥s.  √â por esse motivo que os chamamos de <b>fora da cadeia</b> . <br><br><h3>  O diagrama mostra a visualiza√ß√£o de todos os componentes do aplicativo </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/3c6/636/b8c/3c6636b8c98d52aab9bd09ff9c52afcb.png" alt="imagem"><br><br>  Em resumo: <br><br>  1) O usu√°rio envia um comando para o bot no <b>Telegram</b> <br><br>  2) O telegrama envia uma mensagem de evento <b>python</b> para o <b>aplicativo</b> bot <br><br>  3) um <b>aplicativo python</b> envia uma solicita√ß√£o ao <b>BTCPayServer</b> <br><br>  4) O BTCPayServer gera endere√ßos BTC e LTC recebidos, al√©m de enviar uma solicita√ß√£o de fatura para <b>a cobran√ßa de uma taxa</b> , que por sua vez se comunica com o daemon <b>c-lightning</b> .  Na sa√≠da, obtemos uma bela forma HTML de processamento de pagamentos <br><br>  5) O usu√°rio paga a fatura e v√™ uma confirma√ß√£o <br><br>  6) <b>BTCPayServer</b> envia <i>uma notifica√ß√£o de pagamento de fatura</i> (IPN) para o callback_url especificado, no nosso caso <b>callbacks.py</b> (outro aplicativo python para receber notifica√ß√µes) <br><br>  7) De acordo com os dados recebidos, o saldo do usu√°rio muda <br><br>  <i>... e se o usu√°rio quisesse retirar fundos (moedas que ele recebeu de outros) ...</i> <br><br>  8) O <b>aplicativo Python</b> do bot aguarda o texto ou a imagem do c√≥digo QR e, quando dados v√°lidos s√£o recebidos, o pagamento pelo utilit√°rio <b>paylightning.py *</b> √© <b>realizado</b> , o que inicializa a transa√ß√£o usando o RPC c-lightning. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/518/3dc/c81/5183dcc817817f1aa676ff74d17d08bb.png" alt="imagem"><br><br>  <i>* Para ser honesto, vale a pena notar que meu wrapper paylightning.py n√£o est√° completamente conclu√≠do e pode retornar um falso negativo em cen√°rios espec√≠ficos.</i>  <i>Eu recomendo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usar um inv√≥lucro bem depurado</a> em casos pr√≥ximos √† produ√ß√£o</i> <br><br>  O que n√≥s temos?  Os usu√°rios do nosso bot podem entrar em um bate-papo em grupo ou diretamente podem transferir o <b>valor do material</b> sem restri√ß√µes.  E isso n√£o √© tudo - gra√ßas ao protocolo Lightning Network, que de certa forma √© uma rede de pagamento unificada e simplificada, √© poss√≠vel enviar o mesmo dinheiro recebido no bate-papo para aplicativos de terceiros completamente.  Por exemplo, o Telegram j√° tinha o primeiro bot para pagamentos em bitcoin - @lntxbot.  "Um saldo" permite que voc√™ use qualquer um dos bots, dependendo das prefer√™ncias de um bate-papo em grupo espec√≠fico (sim, o problema √© completamente artificial e a solu√ß√£o √© muito in√∫til, mas o ponto √© essencial).  Transferir saldo de um bot para outro n√£o custa nada e leva segundos!  √â importante observar que os criadores desses bots nunca se conectaram. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f09/c3a/ef9/f09c3aef995f7a82560987646b0d8ee0.png" alt="imagem"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/344/82c/1e234482c56aa0df1d4b341ecfe3beb8.png" alt="imagem"><br><br>  Basta encaminhar a mensagem de solicita√ß√£o de dep√≥sito de @lntxbot para @atomic_tipbot e voul'a! <br><br>  Isso n√£o √© apenas "transferir n√∫meros para o banco de dados", mas um pagamento entre dois bancos de dados diferentes e n√£o relacionados.  Assim, v√°rios "LApps" j√° est√£o integrados ao bot, entre eles: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sat2.io</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lnsms.world</a> . <br><br>  <b>O que <i>significa a integra√ß√£o do LApp</i> ?</b> <br><br>  Cada n√≥ da <i>Lightning Network</i> √© essencialmente uma carteira Bitcoin.  Ela tem dois saldos: on-chain e off-chain.  O saldo na cadeia √© necess√°rio para abrir novos canais e armazenar fundos de canais fechados.  Mas o saldo fora da cadeia √© exatamente o que ocorre entre os n√≥s.  Os principais requisitos para um n√≥ s√£o receber e enviar pagamentos; portanto, cada n√≥ como software possui fun√ß√µes de <i><b>pagamento</b></i> e <i><b>fatura</b></i> .  Vou demonstrar como isso acontece: <br><br><pre><code class="bash hljs">user@ln-node:/ % lightning-cli invoice 1000000000 internal_description external_description { <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span> : 1558709834, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6"</span></span> }</code> </pre> <br>  Nesse caso, recebemos uma "fatura" da especifica√ß√£o <a href="">BOLT11</a> , que √© um formato de pagamento na rede Bitcoin (e Litecoin, a prop√≥sito, tamb√©m).  Esta √© uma linha que cont√©m informa√ß√µes sobre o destinat√°rio, valor da transa√ß√£o, tempo de expira√ß√£o da solicita√ß√£o, etc., informa√ß√µes detalhadas podem ser obtidas executando o decodepay com rela√ß√£o a esta linha: <br><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> rel√¢mpago-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> </pre><br>  Mas para pagar por essa "fatura", precisamos da fun√ß√£o de pagamento do c-lightning: <br><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> rel√¢mpago-cli lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j pagamento <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> </pre><br>  Todos os estados de transa√ß√£o s√£o tratados por toda a rede e seu pr√≥prio n√≥ em particular.  N√£o h√° necessidade (mas existe essa oportunidade) de interagir com os autores do aplicativo do benefici√°rio ou qualquer uma de suas APIs para obter informa√ß√µes sobre o status do pagamento.  N√£o h√° necessidade de verificar o status do pagamento no sistema de processamento intermedi√°rio.  N√£o √© necess√°rio esperar a aprova√ß√£o de sua transa√ß√£o de um banco ou ag√™ncia governamental.  No final, n√£o h√° estornos e outros fatores externos que podem afetar o saldo da sua conta.  Esta √© uma solu√ß√£o para mover valor via Internet, sem a necessidade de um √°rbitro externo que decida se a transa√ß√£o est√° em conformidade com as regras (√†s vezes at√© regras internas, das quais nem todos os participantes s√£o informados com anteced√™ncia) ou n√£o.  N√£o h√° "regras internas" no bitcoin.  As √∫nicas regras que voc√™ precisa seguir s√£o as regras de rede - abertas e conhecidas. <br><br>  Isso torna transa√ß√µes de dinheiro <b>diretas</b> , <b>praticamente gratuitas</b> e <b>instant√¢neas</b> entre pessoas ou programas, realisticamente reais. <br><br>  Se voc√™ tiver a oportunidade de receber dados de pagamento de um aplicativo de terceiros, ser√° poss√≠vel interagir financeiramente com esse aplicativo.  Como exemplo, considere o servi√ßo lnsms.world, que permite enviar uma mensagem SMS para um n√∫mero arbitr√°rio, pagando-a com bitcoins.  Para integrar esse aplicativo, precisamos apenas transferir dados do formul√°rio da web diretamente para o script de envio do SMS - para emular as a√ß√µes do usu√°rio no site: <br><br><pre> <code class="python hljs">payload = { <span class="hljs-string"><span class="hljs-string">'number'</span></span>: phone_number, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: text, <span class="hljs-string"><span class="hljs-string">'force_unicode'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } send_req = requests.post(<span class="hljs-string"><span class="hljs-string">'https://lnsms.world/invoice'</span></span>, data=payload) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> send_req.status_code == <span class="hljs-number"><span class="hljs-number">201</span></span>: plain_invoice = str(send_req.text)</code> </pre><br>  N√£o sei por que motivo, mas o lnsms responde com o c√≥digo de status HTTP 201 e retorna uma fatura no formato BOLT11.  Bem, isso √© suficiente para os usu√°rios bot pagarem pelo envio de SMS do saldo recebido nas salas de bate-papo.  O usu√°rio nem sabe o que est√° acontecendo l√°, apenas pagou alguns centavos pelo envio de SMS.  E eu, como desenvolvedor, n√£o entro nos detalhes do trabalho dos servi√ßos de SMS.  Apenas encaminhei o pagamento e recebi o servi√ßo.  Voc√™ pode fazer uma marca√ß√£o no topo, mas n√£o pode faz√™-lo - essa √© a minha escolha livre.  Nenhuma conta, contrato ou outra API para tarefas triviais, como o envio de SMS. <br><br>  E agora vamos imaginar por um momento que nosso aplicativo √© algo mais √∫til que um bot de bate-papo e efetua um pagamento n√£o a outro bot, mas a outro aplicativo ou dispositivo conectado √† Internet.  Ou s√£o dezenas ou mesmo centenas de pagamentos insignificantes a cada segundo entre dispositivos, servi√ßos, lojas ou algum tipo de prestador de servi√ßos.  Esse √© o poder dos micropagamentos, ent√£o a Internet das coisas deve parecer.  J√° existem projetos como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Althea</a> que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">d√£o</a> vida a essas id√©ias e, em um futuro pr√≥ximo, veremos grandes mudan√ßas, na minha opini√£o, na √°rea que hoje chamamos de com√©rcio eletr√¥nico. <br><br>  Se voc√™ gostou do post e quer experimentar bitcoins em a√ß√£o, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">envie-me uma cerveja e p√£es franceses macios</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt452696/">https://habr.com/ru/post/pt452696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt452684/index.html">Desenvolvendo um jogo no Svelte 3</a></li>
<li><a href="../pt452686/index.html">Espionagem pela qual eles n√£o pro√≠bem (uma hist√≥ria dos anos 80)</a></li>
<li><a href="../pt452688/index.html">Servi√ßo do Windows. Procure por erros do sistema e exiba-os no WinForm C #</a></li>
<li><a href="../pt452690/index.html">O que h√° de t√£o interessante na Ferrovia Transiberiana?</a></li>
<li><a href="../pt452692/index.html">O autor do projeto rePalm reescreveu o Palm OS do zero e planeja transform√°-lo em uma plataforma de rel√≥gio inteligente</a></li>
<li><a href="../pt452698/index.html">Dois em um: dados tur√≠sticos e ingressos para eventos culturais estavam dispon√≠veis ao p√∫blico</a></li>
<li><a href="../pt452700/index.html">Not√≠cias do mundo do OpenStreetMap No. 460 (7 de maio de 2019 a 13 de maio de 2019)</a></li>
<li><a href="../pt452702/index.html">Testes para c√≥digo e c√≥digo para testes</a></li>
<li><a href="../pt452704/index.html">Depura√ß√£o post-mortem no Cortex-M</a></li>
<li><a href="../pt452706/index.html">Em 1983, este computador da Bella Labs se tornou o primeiro grande mestre.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>