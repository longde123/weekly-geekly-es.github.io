<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛌🏾 ⏺️ ✊🏿 Analyse statique IntelliJ IDEA vs esprit humain 🌟 👈🏿 👏🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il n'y a pas si longtemps, j'ai étudié la sortie de l'analyseur statique IntelliJ IDEA pour le code Java et suis tombé sur un cas intéressant. Étant d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Analyse statique IntelliJ IDEA vs esprit humain</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/JetBrains/blog/472932/"><p>  Il n'y a pas si longtemps, j'ai étudié la sortie de l'analyseur statique IntelliJ IDEA pour le code Java et suis tombé sur un cas intéressant.  Étant donné que le fragment de code correspondant n'est pas open source, je l'ai anonymisé et détaché des dépendances externes.  Nous supposons qu'il ressemblait à ceci: </p><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;Integer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;String, Integer&gt; options, List&lt;String&gt; inputs)</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Integer&gt; res = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cur = -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String str : inputs) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.startsWith(<span class="hljs-string"><span class="hljs-string">"-"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (options.containsKey(str)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cur == -<span class="hljs-number"><span class="hljs-number">1</span></span>) cur = options.get(str); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (options.containsKey(<span class="hljs-string"><span class="hljs-string">"+"</span></span> + str)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cur == -<span class="hljs-number"><span class="hljs-number">1</span></span>) cur = res.isEmpty() ? -<span class="hljs-number"><span class="hljs-number">1</span></span> : res.remove(res.size() - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cur != -<span class="hljs-number"><span class="hljs-number">1</span></span>) res.add(cur + str.length()); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre> <br><p>  Le code est comme du code, quelque chose se transforme, quelque chose se fait, mais l'analyseur statique ne l'aime pas.  Ici, nous voyons deux avertissements: </p><br><p><img src="https://habrastorage.org/webt/oy/nx/zp/oynxzpyjinplzjyvflkbwjid8xw.png" alt="Capture d'écran du code"></p><a name="habracut"></a><br><p>  Sur l'expression <code>res.isEmpty()</code> EDI dit que la condition est toujours vraie, et sur <code>cur</code> que l'affectation n'a pas de sens, puisque la même valeur se trouve déjà dans cette variable.  Il est facile de voir que le problème d'affectation est une conséquence directe du premier problème.  Si <code>res.isEmpty()</code> vraiment toujours vrai, alors la chaîne est réduite à </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cur == -<span class="hljs-number"><span class="hljs-number">1</span></span>) cur = -<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><p>  C'est en effet superflu.  Mais pourquoi l'expression est-elle toujours vraie?  Après tout, <code>res</code> est une liste, elle est remplie dans le même cycle.  Le nombre d'itérations de la boucle et les branches dans lesquelles nous allons dépend des paramètres d'entrée que l'IDE ne peut pas connaître.  Nous pourrions ajouter un élément à <code>res</code> à l'itération précédente, puis la liste ne sera pas vide. </p><br><p>  J'ai vu ce code pour la première fois et j'ai passé beaucoup de temps à traiter ce cas.  Au début, j'étais presque convaincu que je suis tombé sur un bug dans l'analyseur, et je devrais le corriger.  Voyons voir si c'est le cas. </p><br><p>  Tout d'abord, nous marquerons toutes les lignes où l'état de la méthode change.  Il s'agit d'une modification de la variable <code>cur</code> ou d'une modification de la liste <code>res</code> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;Integer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;String, Integer&gt; options, List&lt;String&gt; inputs)</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Integer&gt; res = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cur = -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String str : inputs) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.startsWith(<span class="hljs-string"><span class="hljs-string">"-"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (options.containsKey(str)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cur == -<span class="hljs-number"><span class="hljs-number">1</span></span>) cur = options.get(str); <span class="hljs-comment"><span class="hljs-comment">// A } else if (options.containsKey("+" + str)) { if (cur == -1) cur = res.isEmpty() ? -1 : // B res.remove(res.size() - 1); // C if (cur != -1) res.add(cur + str.length()); // D } } return res; }</span></span></code> </pre> <br><p>  Les lignes <code>'A'</code> et <code>'B'</code> ( <code>'B'</code> est la première branche de l'instruction conditionnelle) modifient la variable <code>cur</code> , <code>'D'</code> modifient la liste et <code>'C'</code> (la deuxième branche de l'instruction conditionnelle) modifie à la fois la liste et la variable <code>cur</code> .  Il nous importe de savoir si <code>cur</code> -1 se trouve et si la liste est vide.  Autrement dit, vous devez surveiller quatre états: </p><br><p><img src="https://habrastorage.org/webt/zz/bv/bt/zzbvbtfjrox1wmrvjm7-zhvnwxc.png"></p><br><p>  La chaîne <code>'A'</code> change <code>cur</code> s'il y avait <code>-1</code> avant.  Et nous ne savons pas si le résultat sera <code>-1</code> ou non.  Par conséquent, deux options sont possibles: </p><br><p><img src="https://habrastorage.org/webt/el/qa/xa/elqaxagjyhxmrmypo9hcgloh_xa.png"></p><br><p>  La chaîne <code>'B'</code> ne fonctionne également que si <code>cur</code> vaut <code>-1</code> .  En même temps, comme nous l'avons déjà remarqué, en principe, elle ne fait rien.  Mais on note quand même cette côte pour compléter le tableau: </p><br><p><img src="https://habrastorage.org/webt/vw/zd/wm/vwzdwmqm5hd2apb38p87r00z_vy.png"></p><br><p>  La chaîne <code>'C'</code> , comme les précédentes, fonctionne avec <code>cur == -1</code> et la change arbitrairement (comme <code>'A'</code> ).  Mais en même temps, il peut toujours transformer la liste non vide en vide ou la laisser non vide s'il y avait plus d'un élément. </p><br><p><img src="https://habrastorage.org/webt/wf/s1/37/wfs137xdsscb9p0naoe3lrjb9xm.png"></p><br><p>  Enfin, la chaîne <code>'D'</code> augmente la taille de la liste: elle peut devenir vide à non vide, ou augmenter non vide.  Il ne peut pas transformer le non vide en vide: </p><br><p><img src="https://habrastorage.org/webt/nm/aj/l2/nmajl255y34yw-d3rxxkhanakg4.png"></p><br><p>  Qu'est-ce que cela nous donne?  Rien du tout.  Il est totalement incompréhensible que la condition <code>res.isEmpty()</code> toujours vraie. </p><br><p>  En fait, nous avons mal commencé.  Dans ce cas, il ne suffit pas de surveiller séparément l'état de chaque variable.  Ici, les états corrélés jouent un rôle important.  Heureusement, du fait que <code>2+2 = 2*2</code> , nous n'en avons également que quatre: </p><br><p><img src="https://habrastorage.org/webt/wv/mo/np/wvmonphwjgopmouzrld0ydm-ao4.png"></p><br><p>  Avec une double bordure, j'ai marqué l'état initial que nous avons lors de la saisie de la méthode.  Eh bien, essayez encore.  <code>'A'</code> change ou enregistre le <code>cur</code> pour toute <code>res</code> , <code>res</code> ne change pas: </p><br><p><img src="https://habrastorage.org/webt/qp/a7/nf/qpa7nfxohi1mvz63r4kxcdgtifm.png"></p><br><p>  <code>'B'</code> ne fonctionne qu'avec <code>cur == -1 &amp;&amp; res.isEmpty()</code> et ne fait rien.  Ajouter: </p><br><p><img src="https://habrastorage.org/webt/oz/lo/zy/ozlozyk9nh0j6ss3mfve5l1cpv0.png"></p><br><p>  <code>'C'</code> ne fonctionne qu'avec <code>cur == -1 &amp;&amp; !res.isEmpty()</code> .  En même temps, <code>cur</code> et <code>res</code> changent arbitrairement: après <code>'C'</code> nous nous retrouvons dans n'importe quel état: </p><br><p><img src="https://habrastorage.org/webt/b7/jm/dk/b7jmdkb-c5kqax0m6kyxevslyfi.png"></p><br><p>  Enfin, <code>'D'</code> peut commencer dans <code>cur != -1 &amp;&amp; res.isEmpty()</code> et rendre la liste non vide, ou commencer dans <code>cur != -1 &amp;&amp; !res.isEmpty()</code> et y rester: </p><br><p><img src="https://habrastorage.org/webt/qn/l4/h6/qnl4h6qs-sizqozc2rn-ecl4hwe.png"></p><br><p>  À première vue, il semble que cela n'a fait qu'empirer: le graphique est devenu plus compliqué et on ne sait pas comment l'utiliser.  Mais en fait, nous sommes proches d'une solution.  Les flèches montrent maintenant tout le flux possible d'exécution de notre méthode.  Puisque nous savons de quel état nous sommes partis, faisons un tour le long des flèches: </p><br><p><img src="https://habrastorage.org/webt/ye/au/jm/yeaujmkezkujggymcc20xa679_m.png"></p><br><p>  Et ici, une chose très intéressante se révèle.  Nous ne pouvons pas accéder au coin inférieur gauche.  Et puisque nous ne pouvons pas y entrer, cela signifie que nous ne pouvons pas marcher le long des flèches <code>'C'</code> .  Autrement dit, la ligne <code>'C'</code> vraiment inaccessible et le <code>'B'</code> peut être exécuté.  Ceci n'est possible que si la condition <code>res.isEmpty()</code> effet toujours vraie!  L'IntelliJ IDEA est tout à fait correct.  Désolé, analyseur, en vain, je pensais que vous étiez buggy.  Vous êtes tellement intelligent que c'est difficile pour moi, une personne ordinaire, de vous rattraper. </p><br><p>  Notre analyseur ne dispose d'aucune technologie «hype» d'intelligence artificielle, mais utilise les approches de l'analyse des flux de contrôle et de l'analyse des flux de données, qui ne sont pas moins d'un demi-siècle.  Néanmoins, il tire parfois des conclusions très non triviales.  Cependant, cela est compréhensible: pendant longtemps, il vaut mieux construire des graphiques et marcher dessus avec des machines qu'avec des personnes.  Il y a un problème important non résolu: il ne suffit pas de simplement dire à une personne qu'elle a une erreur de programme.  Le cerveau de silicium doit expliquer au biologique pourquoi il en a décidé ainsi, et pour que le cerveau biologique le comprenne.  Si quelqu'un a des idées brillantes sur la façon de procéder, je serai heureux de vous entendre.  Si vous êtes prêt à réaliser vos idées vous-même, notre équipe ne refusera pas de coopérer avec vous! </p><br><p>  L'un des tests d'acceptation est devant vous: pour cet exemple, une explication doit être générée automatiquement.  Cela peut être un texte, un graphique, un arbre, une image avec des sceaux - n'importe quoi, si seulement une personne pouvait comprendre. </p><br><p>  La question reste ouverte, que voulait dire l'auteur de la méthode et à quoi devrait ressembler le code.  Les responsables du sous-système m'ont informé que cette partie est quelque peu abandonnée, et eux-mêmes ne savent pas comment la réparer ou il vaut mieux la supprimer complètement. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr472932/">https://habr.com/ru/post/fr472932/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr472918/index.html">ZX Spectrum en Russie et dans la CEI: comment la poursuite du online s'est transformée hors ligne</a></li>
<li><a href="../fr472922/index.html">Le programmeur Defender plus fort que l'entropie</a></li>
<li><a href="../fr472926/index.html">La loi de l'accélération des retours (partie 1)</a></li>
<li><a href="../fr472928/index.html">Service informatique GPU très chargé</a></li>
<li><a href="../fr472930/index.html">Les astrophysiciens de la Silicon Valley quantifient la mode</a></li>
<li><a href="../fr472934/index.html">Qu'est-ce qu'un Zero Trust? Modèle de sécurité</a></li>
<li><a href="../fr472936/index.html">Opération TA505: regroupement de l'infrastructure réseau. 3e partie</a></li>
<li><a href="../fr472940/index.html">À propos des escrocs et des gens</a></li>
<li><a href="../fr472944/index.html">Data as a Service: qu'est-ce que c'est, les difficultés techniques et comment les contourner en utilisant des proxy résidents</a></li>
<li><a href="../fr472948/index.html">Fonctionnement de FaceID sur iPhone X: algorithme Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>