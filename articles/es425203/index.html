<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßóüèø üë©‚Äçüëß‚Äçüë¶ ‚è´ Antigua vulnerabilidad UPnP de una nueva manera üì¥ ü§±üèø üö≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Todo lo nuevo es un viejo bien olvidado (o mejor, un viejo muy bien olvidado). Por supuesto, es correcto monitorear nuevas vulnerabilidades, pero no d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Antigua vulnerabilidad UPnP de una nueva manera</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425203/">  Todo lo nuevo es un viejo bien olvidado (o mejor, un viejo muy bien olvidado).  Por supuesto, es correcto monitorear nuevas vulnerabilidades, pero no debe olvidarse de las antiguas.  Especialmente cuando el fabricante se permite "olvidarlos".  Alguien debe recordar.  De lo contrario, pisaremos el mismo rastrillo una y otra vez. <br><br>  El art√≠culo se centrar√° en uno antiguo, pero result√≥ que nunca ha perdido su relevancia hasta el d√≠a de hoy, el agujero UPnP. <br><br><img src="https://habrastorage.org/webt/n8/oe/yl/n8oeyllfk_t6lcecxmgt5jfakuw.jpeg"><br><br>  PD: No llamar√© al proveedor, √©l no es culpable de esto, pero por otro lado, existe una clara supervisi√≥n de las pol√≠ticas de seguridad que, junto con la arquitectura de la red, hicieron posible explotar esta vulnerabilidad.  Como siempre, las estrellas convergen.  El proveedor instal√≥ enrutadores en su red a clientes con los chips necesarios y lo conect√≥ con una direcci√≥n IP externa.  S√≠, la mayor√≠a de los puertos se filtraron, pero por alguna raz√≥n no 52869. <br><br>  PPS Todos los eventos ocurrieron a finales de 2018.  Los h√©roes son ficticios, y las coincidencias con personalidades reales son aleatorias. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Breve programa educativo:</b> <div class="spoiler_text">  Hay una biblioteca libupnp para desarrollo que "se usa en miles de dispositivos y se llama Intel SDK para dispositivos UPnP o Portable SDK para dispositivos UPnP". <br><br>  En ingles: <br><blockquote>  "El SDK port√°til para dispositivos UPnP (libupnp) proporciona a los desarrolladores una API y un c√≥digo fuente abierto para construir puntos de control, dispositivos y puentes que cumplen con la Versi√≥n 1.0 de la Especificaci√≥n de arquitectura universal de dispositivos Plug and Play y admiten varios sistemas operativos como Linux , * BSD, Solaris y otros ". </blockquote><br></div></div><br>  La primera menci√≥n de la vulnerabilidad fue en 2014: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">tyk</a> <br>  Los intentos de contactar al fabricante no tuvieron mucho √©xito y se public√≥ la vulnerabilidad.  La √∫nica recomendaci√≥n de contraataque fue: <br><blockquote>  "... restringir la interacci√≥n con el servicio ... S√≥lo los clientes y servidores que tienen una relaci√≥n procesal legal ... deber√≠an poder comunicarse con √©l". </blockquote>  Existe una falla en el servicio SOAP miniigd.  El problema es procesar las solicitudes de NewInternalClient debido a la incapacidad de borrar los datos del usuario antes de realizar una llamada al sistema.  Un atacante podr√≠a usar esta vulnerabilidad para ejecutar c√≥digo con privilegios de root. <br><br>  Es decir  En todos los enrutadores con UPnP versi√≥n 1.0, puede ejecutar c√≥digo remoto arbitrario. <br>  Sin autorizaci√≥n  De la ra√≠z.  Genial, verdad? <br><br>  Cualquiera puede encontrar un complemento listo para metasplit en github, cuyo rendimiento fue probado por las sillas quemadas de nuestros ingenieros de servicio. <br>  Fue inesperado y nada divertido. <br><br><h3>  Una breve cronolog√≠a de los acontecimientos de ese d√≠a: </h3><br>  <b>14:00</b> En el soporte t√©cnico, los suscriptores comienzan a recibir llamadas a Internet que funciona mal. <br><br><ul><li>  <u>S√≠ntomas en el lado del cliente:</u> "funciona lentamente, despu√©s de un reinicio funciona bien por un tiempo, luego nuevamente lentamente". </li><li>  <u>S√≠ntomas por parte del equipo: un</u> peque√±o aumento en el tr√°fico y las cargas de CPU se cancelaron en la carga que genera el cliente. </li></ul><br>  Las aplicaciones individuales se registran para verificar la l√≠nea de administradores o la partida del instalador.  No hay una plantilla com√∫n para la acci√≥n.  Nada esta claro. <br><br>  <b>15:00 El</b> n√∫mero de aplicaciones comienza a exceder la temperatura promedio en el hospital y las aplicaciones individuales comienzan a esculpir en aplicaciones para m√°s con el tipo de "Accidente".  Las solicitudes se env√≠an a los administradores superiores para verificar los segmentos de red. <br><br>  <b>15:20 Los</b> administradores cierran los choques masivos, porque  No hay problemas en la red, todas las solicitudes de los clientes desde diferentes puntos de conexi√≥n son √∫nicas.  (Por ejemplo: el conmutador est√° lleno de suscriptores activos, pero no funciona bien para uno).  En este momento, caen las apelaciones y todo se calma.  Alguien presta atenci√≥n (finalmente) de que todas las aplicaciones por mal trabajo se realizaron con el mismo modelo de enrutador, todos juntos fingen que todo est√° bien. <br><br>  <b>15:30</b> Nuevamente la afluencia de solicitudes de suscriptores, nuevamente el registro de un accidente masivo y la transferencia a los administradores.  En este momento, queda claro que algo est√° <b>realmente</b> mal y que hay que hacer algo (quien trabaj√≥ con el servicio al cliente entender√° lo dif√≠cil que a veces es hacerlo. Los clientes <s>siempre</s> mienten y, a veces, la primera l√≠nea es escalar a√∫n m√°s la tarea) . <br><br>  <b>15:35 El</b> ingeniero de turno recibe una solicitud de un problema con el servicio al cliente.  Obtiene una lista de todos los clientes, su tipo de conexi√≥n y modelo de dispositivo.  Y entonces comienza un poco de magia. <br><br><img src="https://habrastorage.org/webt/m9/hj/ba/m9hjbaxp9s7onm3ba8nykkcymwe.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">spoiler</b> <div class="spoiler_text">  Lo cual, por cierto, no funcion√≥ y luego el mago principal fue despedido (pero dicen que no es por esto). <br></div></div><br>  <b>15:40 El</b> ingeniero ejecuta la lista de clientes a trav√©s de todos los diagn√≥sticos, cada enrutador se verific√≥ de acuerdo con todas las m√©tricas est√°ndar y ... no se encontr√≥ nada.  Un enrutador es como un enrutador.  S√≠, la CPU ha aumentado, pero los indicadores no son cr√≠ticos, pero vierte tr√°fico en alguna parte, lo que significa que funciona. <br><br>  S√≠, el servicio UPnP est√° girando en el puerto 52869.  S√≠, todav√≠a hay un mont√≥n de puertos abiertos, abierto significa que son necesarios (l√≥gica de hierro), y siempre estaba girando all√≠ y no hab√≠a problemas (un argumento m√°s de l√≥gica de hierro).  El ssh directo a este modelo de enrutador no es posible (francamente, es posible, pero dentro de las pol√≠ticas de la compa√±√≠a y el busybox muy despojado, se desaconsej√≥ tal paseo por los dispositivos del cliente).  Todo se puso de pie nuevamente. <br><br>  <b>16:00</b> Solo ahora descubrimos que hay algunos problemas.  El ingeniero de servicio informa a su supervisor, y el supervisor nos llama por tel√©fono sobre sus conjeturas sobre el puerto 52869 y le pide ayuda. <br><br>  <b>16:05</b> Entonces todo sucedi√≥ muy r√°pido.  El mismo modelo de enrutador se incluye en el banco de pruebas, la direcci√≥n IP se toma del cliente problem√°tico y se cuelga en la prueba.  El wirehark est√° encendido.  Esto es para atrapar solicitudes al dispositivo. <br><br>  Para capturar las solicitudes del enrutador (en ese momento, el esquema general de c√≥mo la interacci√≥n a√∫n era desconocida), el cliente est√° aislado en el segmento de prueba y todo su tr√°fico se refleja en la m√°quina de prueba m√°s cercana donde se eleva otro wirehark. <br><br>  Esperamos m√°s, miramos la pantalla. <br><br>  Los hacks ya estaban atrapados de esta manera, de manera bastante eficiente y, por lo tanto, decidieron no cambiar los h√°bitos. <br><br>  <b>16:10</b> Mientras se agita Wirehark, en Google existe una vulnerabilidad CVE-2014-8361 sobre la cual se informa a los ingenieros.  El ingeniero, sin escuchar, toma una decisi√≥n (y, en principio, l√≥gica): el filtro de este puerto en la frontera.  Apenas dicho que hecho. <br><br><div class="spoiler">  <b class="spoiler_title">spoiler</b> <div class="spoiler_text">  Esto no funcion√≥. <br></div></div><br>  <b>16:25</b> Se nos dice que <s>toda la mierda de remake Misha</s> no funcion√≥.  Y ya sab√≠amos que eso no funcionar√≠a.  En ese momento, ya hab√≠an tocado el enrutador de prueba, subieron el reverso a <b>otro</b> puerto y comenzaron a usarlo para el puerto DDOS-a hasta 1900 (!) Usando otra vulnerabilidad.  <s>Se√±or, qu√© cubo de basura con fugas</s> <br><br><div class="spoiler">  <b class="spoiler_title">programa educativo todav√≠a</b> <div class="spoiler_text">  Uso en ataques DDoS <br><br>  En 2014, descubrieron inesperadamente que SSDP se usaba en ataques DDoS como "ataque de reflexi√≥n SSDP con amplificaci√≥n".  Muchos dispositivos, incluidos los enrutadores dom√©sticos, ten√≠an una falla en el software UPnP, lo que permit√≠a a un atacante enviar respuestas desde el puerto 1900 a una direcci√≥n arbitraria en Internet.  En el caso de usar una botnet de miles de dispositivos, el atacante podr√≠a crear una gran cantidad de paquetes suficientes para ocupar el ancho de banda y saturar los canales de datos del sitio atacado, lo que lleva a una denegaci√≥n de servicio para los usuarios comunes. <br></div></div><br>  Lo m√°s interesante es que las reglas del firewall en el dispositivo han sido cambiadas y nmap ahora no muestra puertos abiertos desde el exterior.  Solo en un volcado de tr√°fico fue posible detectar solicitudes en estos puertos.  Es decir  un atacante despu√©s de piratear bloque√≥ el acceso al resto.  No es un enfoque de alta tecnolog√≠a, pero bravo de todos modos. <br><br>  <b>16:30</b> Una conferencia se re√∫ne con las preguntas "qui√©n tiene la culpa y qu√© hacer".  Los puertos 1900 y 52869 quedaron prohibidos y se est√°n intentando arreglar algo en dispositivos pirateados.  Reiniciar: no ayud√≥, la idea de volver a flashear fue rechazada de inmediato.  S√≠, existe una funci√≥n tan funcional que fue posible reorganizar el software de forma remota a trav√©s de TR069 con un bot√≥n en todos los dispositivos.  Pero desde  el dispositivo no era la primera frescura, pero el n√∫mero de clientes era grande: un cierto porcentaje de dispositivos de ladrillo crear√≠a problemas. <br><br>  <b>16:40 Para</b> resumir: los dispositivos son pirateados, participan como m√≠nimo en ddos ‚Äã‚Äãy transmiten algo en alg√∫n lugar del canal encriptado.  (Todo en <b>diferentes</b> puertos).  Entrar no es posible, el proveedor rechaz√≥ el acceso total a trav√©s de ssh al dispositivo y vio lo que era imposible llegar all√≠.  La consola est√° protegida por contrase√±a. <br><br>  <b>En alg√∫n lugar cercano a las 17:00, se</b> decidi√≥ coser el dispositivo como la forma m√°s r√°pida.  Despu√©s de flashear y reiniciar, todo volvi√≥ a la normalidad. <br><br><h3>  En lugar de totales </h3><br>  Desafortunadamente, no pudimos resolver completamente este problema. <br><br>  Por "decidir" me refiero a obtener informaci√≥n completa de pirater√≠a y actualizar nuestras pol√≠ticas para contrarrestar esto en el futuro.  S√≠, no todas las tareas se resuelven con √©xito y como nos gustar√≠a.  Esto es normal  Aunque insultante. <br><br>  <i>Si es bueno buscar en el shodan,</i> <i><br></i>  <i>puedes encontrarte algo</i> <i><br></i>  <i>para experimentos:</i> <i><br></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">de una forma</a> u <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">otra</a></i> <i><br></i>  <i>pero no te dije eso.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es425203/">https://habr.com/ru/post/es425203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es425191/index.html">Fastware</a></li>
<li><a href="../es425195/index.html">Las listas negras, blancas y grises protegen la seguridad empresarial</a></li>
<li><a href="../es425197/index.html">Estimaci√≥n de costos de un proyecto de implementaci√≥n de IdM: c√≥mo prever sorpresas</a></li>
<li><a href="../es425199/index.html">Lo que protege a los compradores del fraude de pagos sin contacto</a></li>
<li><a href="../es425201/index.html">"He estado luchando contra el s√≠ndrome del impostor durante tres a√±os" - 10 preguntas para un programador, n√∫mero 7</a></li>
<li><a href="../es425205/index.html">Soft Skills en gesti√≥n de proyectos: concepto, objetivos y consejos para un uso comercial exitoso</a></li>
<li><a href="../es425207/index.html">Pruebas de dise√±o: las 10 mejores conversaciones de Piter Heisenbug 2018</a></li>
<li><a href="../es425209/index.html">Sunrise Manually # 2: seg√∫n el hardcore para el IDE, Cmake y mi decepci√≥n por los animales</a></li>
<li><a href="../es425211/index.html">286 y red</a></li>
<li><a href="../es425213/index.html">Planes para la pr√≥xima versi√≥n de Vue.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>