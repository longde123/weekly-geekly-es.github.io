<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÇ üé≥ üèÑ Di atas gunung berdiri Spring Boot ... üë©üèΩ‚Äçüè≠ üç¢ ü§µüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... keempatnya sedang debugging. 


 Terinspirasi oleh laporan oleh Vladimir Plizgi ( Spring Boot 2: apa yang tidak mereka tulis dalam catatan rilis )...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Di atas gunung berdiri Spring Boot ...</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439918/"><p>  ... keempatnya sedang debugging. </p><br><p> Terinspirasi oleh laporan oleh Vladimir Plizgi ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Spring Boot 2: apa yang tidak mereka tulis dalam catatan rilis</a> ), saya memutuskan untuk berbicara tentang pengalaman saya dengan Spring Booth, fitur dan perangkap yang saya temui dalam perjalanan. </p><a name="habracut"></a><br><h4 id="spring-data-jpa">  Data pegas jpa </h4><br><p>  Laporan Vladimir dikhususkan untuk migrasi ke Spring Booth 2 dan kesulitan yang muncul.  Pada bagian pertama, ia menjelaskan kesalahan kompilasi, jadi saya juga akan memulainya. </p><br><p> Saya pikir banyak yang akrab dengan kerangka kerja Data Spring dan turunannya untuk berbagai gudang data.  Saya bekerja dengan hanya satu dari mereka - Spring Data JPA.  Antarmuka utama yang digunakan dalam kerangka kerja ini - <code>JpaRepository</code> , telah mengalami perubahan signifikan dalam versi 2. *. </p><br><p>  Pertimbangkan metode yang paling sering digunakan: </p><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">// interface JpaRepository&lt;T, ID&gt; { T findOne(ID id); List&lt;T&gt; findAll(Iterable&lt;ID&gt; ids); &lt;S extends T&gt; Iterable&lt;S&gt; save(Iterable&lt;S&gt; entities); } // interface JpaRepository&lt;T, ID&gt; { Optional&lt;T&gt; findById(ID id); List&lt;T&gt; findAllById(Iterable&lt;ID&gt; ids); &lt;S extends T&gt; Iterable&lt;S&gt; saveAll(Iterable&lt;S&gt; entities); }</span></span></code> </pre> <br><p>  Bahkan, ada lebih banyak perubahan, dan setelah pindah ke versi 2. * semuanya akan berubah menjadi kesalahan kompilasi. </p><br><p>  Ketika salah satu proyek kami mengangkat masalah migrasi ke Spring Booth 2 dan langkah-langkah pertama diambil (mengganti versi di pom.xml), seluruh proyek benar-benar berubah menjadi merah: puluhan repositori dan ratusan panggilan ke metode mereka menyebabkan migrasi "(menggunakan metode baru) akan mengaitkan setiap file kedua.  Bayangkan kode paling sederhana: </p><br><pre> <code class="java hljs">SomeEntity something = someRepository.findOne(someId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (something == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { something = someRepository.save(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeEntity()); } useSomething(something);</code> </pre> <br><p>  Agar proyek hanya berkumpul, Anda perlu: </p><br><ul><li>  panggil metode lain </li><li>  ubah jenis variabel <code>something</code> ke <code>Optional&lt;SomeEntity&gt;</code> </li><li>  ganti memeriksa referensi kosong dengan <code>Optional::isPresent</code> atau <code>Optional::orElse</code> / <code>Optional::orElseGet</code> </li><li>  memperbaiki tes </li></ul><br><p>  Untungnya, ada cara yang lebih sederhana, karena Spring Date memberi pengguna kesempatan yang belum pernah terjadi sebelumnya untuk menyesuaikan repositori dengan kebutuhan mereka.  Yang kita butuhkan adalah mendefinisikan (jika belum didefinisikan) antarmuka dan kelas yang akan membentuk dasar dari semua repositori proyek kami.  Ini dilakukan seperti ini: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//    @NoRepositoryBean public interface BaseJpaRepository&lt;T, ID extends Serializable&gt; extends JpaRepository&lt;T, ID&gt; { //   findOne,     1.* @Deprecated T findOne(ID id); //    findAll @Deprecated //         List&lt;T&gt; findAll(Iterable&lt;ID&gt; ids); }</span></span></code> </pre> <br><p>  Semua repositori kami akan mewarisi dari antarmuka ini.  Sekarang implementasi: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseJpaRepositoryImpl</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ID</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleJpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ID</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseJpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ID</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> JpaEntityInformation&lt;T, ?&gt; entityInfo; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> EntityManager entityManager; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BaseJpaRepositoryImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JpaEntityInformation&lt;T, ?&gt; entityInfo, EntityManager entityManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(entityInfo, entityManager); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityInfo = entityInfo; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityManager = entityManager; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOne</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ID id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> findById(id).orElse(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    1.* } @Override public List&lt;T&gt; findAll(Iterable&lt;ID&gt; ids) { return findAllById(ids); //      } }</span></span></code> </pre> <br><p>  Sisanya ada dalam gambar dan rupa.  Semua kesalahan kompilasi hilang, kode berfungsi seperti sebelumnya, dan hanya 2 kelas yang diubah, dan bukan 200. Sekarang Anda dapat secara perlahan mengganti API yang sudah usang dengan yang baru saat pengembangan berlangsung, karena Ide akan dengan hati-hati mewarnai semua panggilan ke metode @Deprecated yellow. </p><br><p>  Stroke terakhir - kami memberi tahu Spring bahwa mulai sekarang dari repositori harus dibangun di atas kelas kami: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableJpaRepositories</span></span>(repositoryBaseClass = BaseJpaRepositoryImpl.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeConfig</span></span></span></span>{ }</code> </pre> <br><h4 id="v-tihom-omute-biny-vodyatsya">  Di kolam yang tenang, nampan ditemukan </h4><br><p>  Spring Booth didasarkan pada dua konsep - starter dan konfigurasi otomatis.  Dalam kehidupan, konsekuensi dari ini adalah properti penting - perpustakaan yang masuk ke jalan setapak aplikasi dipindai oleh SB dan jika kelas ditemukan di dalamnya yang mencakup pengaturan tertentu, maka itu akan menyala tanpa sepengetahuan Anda dan instruksi eksplisit.  Kami menunjukkan ini dengan contoh sederhana. </p><br><p>  Banyak yang menggunakan pustaka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">gson</a> untuk mengubah objek menjadi string JSON dan sebaliknya.  Anda dapat sering melihat kode ini: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Gson().toJson(obj); } }</code> </pre> <br><p>  Dengan akses yang sering, kode ini juga akan memuat pemulung, yang tidak kita inginkan.  Khususnya orang pintar membuat satu objek dan menggunakannya: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Gson </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Gson(); } } <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Gson gson; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gson.toJson(obj); } }</code> </pre> <br><p>  ... bahkan tanpa menyadari bahwa Spring Booth dapat melakukan semuanya sendiri.  Secara default, Sat hadir dengan <code>org.springframework.boot:spring-boot-autoconfigure</code> , yang mencakup banyak kelas bernama <code>*AutoConfiguration</code> , misalnya, ini: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>(Gson.class) <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(GsonProperties.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GsonAutoConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GsonBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gsonBuilder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;GsonBuilderCustomizer&gt; customizers)</span></span></span><span class="hljs-function"> </span></span>{ GsonBuilder builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GsonBuilder(); customizers.forEach((c) -&gt; c.customize(builder)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> builder; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Gson </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GsonBuilder gsonBuilder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gsonBuilder.create(); } }</code> </pre> <br><p>  Pengaturannya sederhana sebagai rail: jika ada kelas <code>Gson</code> dalam aplikasi dan tidak ada kacang yang ditentukan secara manual dari tipe ini, implementasi standar akan dibuat.  Ini adalah kekuatan yang luar biasa, memungkinkan satu ketergantungan dan beberapa anotasi untuk meningkatkan konfigurasi penuh, deskripsi yang digunakan untuk mengambil lembar XML dan banyak nampan tulisan tangan. </p><br><p>  Tapi ini adalah bahaya besar Dewan Keamanan.  Insidiousness terletak pada kerahasiaan, karena banyak pekerjaan terjadi di bawah tenda menurut skrip pra-ditulis.  Ini bagus untuk aplikasi tipikal, tetapi meninggalkan jalur yang dipukuli dapat menyebabkan masalah - konvoi menembak tanpa peringatan.  Banyak kacang dibuat tanpa sepengetahuan kita, contoh dengan Gson menunjukkan ini dengan baik.  Hati-hati dengan kelas dan dependensi Anda, karena ... </p><br><h4 id="vsyo-chto-popadyot-v-vash-classpath-mozhet-byt-ispolzovano-protiv-vas">  Apa pun yang masuk ke jalur kelas Anda dapat digunakan untuk melawan Anda. </h4><br><p>  Sebuah kasus dari kehidupan.  Ada dua aplikasi: satu menggunakan <code>LdapTemplate</code> , sementara yang lain telah menggunakannya sekali.  Kedua aplikasi bergantung pada proyek <code>core</code> , di mana beberapa kelas umum diambil, dan perpustakaan umum untuk kedua aplikasi dilipat dengan hati-hati di pom.xml. </p><br><p>  Setelah beberapa waktu, dari proyek kedua, semua penggunaan <code>LdapTemplate</code> sebagai tidak perlu.  Tapi <code>org.springramework:spring-ldap</code> perpustakaan <code>org.springramework:spring-ldap</code> tetap di <code>core</code> .  Kemudian SB menyerang dan <code>org.springramework.ldap:ldap-core</code> berubah menjadi <code>org.springramework.boot:spring-boot-starter-data-ldap</code> . </p><br><p>  Karena itu, pesan menarik muncul di log: </p><br><pre> <code class="plaintext hljs">Multiple Spring Data modules found, entering strict repository configuration mode! Spring Data LDAP - Could not safely identify store assignment for repository candidate interface ....</code> </pre> <br><p>  Ketergantungan pada <code>core</code> dipimpin <code>org.springramework.boot:spring-boot-starter-data-ldap</code> sesuai dengan proyek di mana LDAP tidak digunakan sama sekali.  Apa artinya ragu?  Tekan classpath :).  Lebih lanjut dengan semua halte: </p><br><ul><li>  Pemberitahuan Spring Boot <code>org.springramework.boot:spring-boot-starter-data-ldap</code> di classpath </li><li>  setiap repositori sekarang diperiksa untuk melihat apakah cocok untuk digunakan dengan Spring Data JPA atau Spring Data LDAP </li><li>  reorganisasi dependensi dan <code>org.springramework.boot:spring-boot-starter-data-ldap</code> tidak perlu <code>org.springramework.boot:spring-boot-starter-data-ldap</code> mengurangi waktu startup aplikasi dengan rata-rata 20 (!) detik dari total 40-50 </li></ul><br><p>  Pembaca yang penuh perhatian dan kritis mungkin akan bertanya: mengapa Anda perlu mengubah <code>org.springramework.ldap:ldap-core</code> ke <code>org.springramework.boot:spring-boot-starter-data-ldap</code> jika Spring Data LDAP tidak digunakan, tetapi hanya satu yang digunakan kelas <code>org.springframework.ldap.LdapTempate</code> ? </p><br><p>  Jawab: itu kesalahan.  Faktanya adalah bahwa sebelum versi 2.1.0.M1, penyetelan otomatis untuk LDAP terlihat seperti ini </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({ContextSource.class}) <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>({LdapProperties.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LdapAutoConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LdapProperties properties; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Environment environment; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LdapAutoConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LdapProperties properties, Environment environment)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.properties = properties; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.environment = environment; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ContextSource </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldapContextSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ LdapContextSource source = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LdapContextSource(); source.setUserDn(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.properties.getUsername()); source.setPassword(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.properties.getPassword()); source.setBase(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.properties.getBase()); source.setUrls(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.properties.determineUrls(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.environment)); source.setBaseEnvironmentProperties(Collections.unmodifiableMap(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.properties.getBaseEnvironment())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source; } }</code> </pre> <br><p>  Di mana <code>LdapTemplate</code> ?  Tapi dia tidak :).  Lebih tepatnya, tetapi terletak di tempat lain: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({LdapContext.class, LdapRepository.class}) <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureAfter</span></span>({LdapAutoConfiguration.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LdapDataAutoConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span>({LdapOperations.class}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LdapTemplate </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldapTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContextSource contextSource)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LdapTemplate(contextSource); } }</code> </pre> <br><p>  Dengan demikian, asumsi dibuat bahwa Anda <code>LdapTemplate</code> mendapatkan <code>LdapTemplate</code> dalam aplikasi Anda dengan memenuhi kondisi <code>@ConditionalOnClass({LdapContext.class, LdapRepository.class})</code> , yang dimungkinkan ketika dependensi <code>spring-boot-starter-data-ldap</code> ditambahkan ke classpath. </p><br><p>  Kemungkinan lain: untuk menentukan kacang ini dengan tangan Anda, yang tidak Anda inginkan (karena itu mengapa kita membutuhkan SB).  <code>org.springramework.boot:spring-boot-starter-data-ldap</code> datang dengan ini setelah mengganti <code>org.springramework.boot:spring-boot-starter-data-ldap</code> dengan <code>org.springramework.ldap:ldap-core</code> . </p><br><p>  Masalahnya diselesaikan di sini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/spring-projects/spring-boot/pull/13136</a> .  Perubahan besar: <code>LdapTemplate</code> bean dipindahkan ke <code>LdapAutoConfiguration</code> .  Sekarang Anda dapat menggunakan LDAP tanpa mengikat ke <code>spring-boot-starter-data-ldap</code> dan mendefinisikan secara manual nampan <code>LdapTemplate</code> . </p><br><h4 id="podkapotnaya-voznya">  Kericuhan hood </h4><br><p>  Jika Anda menggunakan Hibernate, Anda mungkin terbiasa dengan antipattern <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">open-in-view</a> .  Kami tidak akan membahas deskripsinya, dengan referensi dijelaskan dengan cukup detail, dan di sumber lain efek berbahaya dijelaskan dengan sangat rinci. </p><br><p>  Bendera khusus bertanggung jawab untuk mengaktifkan / menonaktifkan mode ini: </p><br><pre> <code class="plaintext hljs">spring: jpa: open-in-view: true</code> </pre> <br><p>  Dalam SB versi 1. * diaktifkan secara default, sementara pengguna tidak diberitahu tentang ini.  Dalam versi 2. * masih diaktifkan, tetapi sekarang peringatan ditulis ke log: </p><br><pre> <code class="plaintext hljs">WARN spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning.</code> </pre> <br><p>  Awalnya, ada permintaan untuk menonaktifkan mode ini, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">epic srach pada topik</a> berisi beberapa lusin (!) Dari komentar rinci, termasuk  dari Oliver G√∂rke (pengembang Spring Date), Vlad Michalce (pengembang Hibernate), Phil Web dan Vedran Pavic (pengembang Spring) dengan pro dan kontra. </p><br><p>  Mereka sepakat bahwa perilaku tidak akan berubah, tetapi peringatan akan ditampilkan (yang diamati).  Ada juga tip yang cukup umum untuk menonaktifkan mode ini: </p><br><pre> <code class="plaintext hljs">spring: jpa: open-in-view: false</code> </pre> <br><p>  Itu saja, tulis tentang fitur rake dan menarik Anda dari Dewan Keamanan - ini benar-benar topik yang tidak ada habisnya. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id439918/">https://habr.com/ru/post/id439918/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id439908/index.html">Kohl, persetan ... Koaksial</a></li>
<li><a href="../id439910/index.html">Digital Rights Center mengundang ke Hari Privasi 2019</a></li>
<li><a href="../id439912/index.html">Misteri penglihatan yang belum terpecahkan</a></li>
<li><a href="../id439914/index.html">Organisasi peredam - melangkah lebih jauh</a></li>
<li><a href="../id439916/index.html">Membuka kemasan: Dridex bootloader</a></li>
<li><a href="../id439920/index.html">Penyebaran otomatis fungsi tanpa server dari Git</a></li>
<li><a href="../id439922/index.html">Perpajakan IP di Kazakhstan: bagaimana menjadi freelancer?</a></li>
<li><a href="../id439924/index.html">Volume paket dari toko online asing meningkat 25%</a></li>
<li><a href="../id439926/index.html">Pertahankan di dalam dan di luar ViewModel</a></li>
<li><a href="../id439928/index.html">Mengemudi trotoar otonom dengan OpenCV dan Tensorflow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>