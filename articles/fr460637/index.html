<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüåæ üñêüèø üöΩ Contr√¥le de la lumi√®re sur ZigBee ‚õπüèº üõ¥ üë©üèº‚Äçü§ù‚Äçüë®üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour mes amis! Aujourd'hui, je veux vous parler d'un d√©veloppement int√©ressant d'un syst√®me de contr√¥le d'√©clairage √† distance. 



 Une maison mod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Contr√¥le de la lumi√®re sur ZigBee</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460637/">  Bonjour mes amis!  Aujourd'hui, je veux vous parler d'un d√©veloppement int√©ressant d'un syst√®me de contr√¥le d'√©clairage √† distance. <br><br><img src="https://habrastorage.org/webt/ro/yx/l6/royxl62-z2oqpfn6hwt5izou3_y.jpeg" alt="image"><br><br>  Une maison moderne est un grand nombre de fils pour au moins r√©duire et rationaliser leur radio.  En r√©alit√©, un tel syst√®me n'est pas nouveau, mais dans le contexte d'un budget limit√©, il s'est pleinement justifi√©. <br><br>  Pour l'avenir, je veux montrer imm√©diatement le sch√©ma fonctionnel du syst√®me de contr√¥le. <br><br><img src="https://habrastorage.org/webt/fh/ey/gj/fheygj8s-fn_phg3oqnva6ajrye.jpeg" alt="image"><br>  <i>Fig.</i>  <i>1</i> <br><br>  Je m'int√©resse √† quelqu'un sous chat. <br><a name="habracut"></a><br>  La question logique est pourquoi tout cela est n√©cessaire?  L'utilisation d'un syst√®me de contr√¥le d'√©clairage sans fil donne: <br><br><ul><li>  R√©duction du nombre de fils allant de chaque interrupteur √† la bo√Æte de jonction de la pi√®ce. </li><li>  Possibilit√© d'impl√©menter des commutateurs de passage. </li><li>  La flexibilit√© de contr√¥ler toutes les charges depuis n'importe quel interrupteur ainsi que l'utilisation de boutons normalement ferm√©s normalement ouverts. </li><li>  La possibilit√© d'impl√©menter n'importe quel d√©lai de fonctionnement marche / arr√™t. </li></ul><br>  La t√¢che technique, au d√©but, n'√©tait que des mots et semblait tr√®s boueuse et incompr√©hensible.  Le fait est que dans un chalet √† deux √©tages avec une superficie de 208 m¬≤, il est n√©cessaire de contr√¥ler l'√©clairage interne on / off, le syst√®me doit √™tre aliment√© en 220v et interrupteur 21-23pcs.  charges (lampes) d'une capacit√© ne d√©passant pas 200 W.  Au moment de la premi√®re inspection de l'objet, tout ressemblait √† ceci <br><br><img src="https://habrastorage.org/webt/cz/bi/_b/czbi_bdenvipzshelqjbmh0himq.jpeg"><br>  <i>Fig.</i>  <i>2. La partie principale des communications est pos√©e dans le sol, puis tout est coul√© avec une chape en b√©ton</i> <br><br><img src="https://habrastorage.org/webt/sh/h-/7m/shh-7mxsspyefbi-nlti3wisn8m.jpeg"><br>  <i>Fig.</i>  <i>3. Place pour l'installation d'une armoire de distribution au deuxi√®me √©tage</i> <br><br>  La forte recommandation √©tait d'utiliser le moins de fils possible.  Id√©alement, seuls ceux qui sont d√©j√† pos√©s dans le sol, les murs et le plafond, ils vont du site d'installation du tableau √† chaque ampoule.  En raison de la compatibilit√© √©lectromagn√©tique de tous les appareils de la maison, il n'√©tait pas recommand√© d'utiliser le wi-fi ordinaire car  il existe d'innombrables appareils de ce type et le client de ce compte a la sensation que les appareils de la maison commenceront √† vivre leur propre vie et la mijoteuse incluse affectera la lumi√®re dans la salle de bain ou les toilettes.  La premi√®re chose que j'ai faite a √©t√© de d√©crire le diagramme, car j'imagine la solution √† ce probl√®me.  Sur fig_4 cette option. <br><br><img src="https://habrastorage.org/webt/80/wk/x2/80wkx2kcoelxunryvcivzi8n7e8.jpeg"><br>  <i>Fig.</i>  <i>4. Diagramme fonctionnel de la commande d'√©clairage.</i> <br><br>  La base a √©t√© prise par le module radio Texas Instruments CC2530 qui prend en charge la technologie ZiegBee et est tout simplement programm√© en C ++ en utilisant IAR-studio 5.5.  La commutation directe des charges est effectu√©e √† l'aide des modules de relais WB-MR6 (wirenboard), j'ai choisi cet √©l√©ment car dans le bo√Ætier compact sur le rail din, six relais avec canaux ind√©pendants sont install√©s sur la commande 16A, toutes les caract√©ristiques de commutation des charges d'alimentation √† usage g√©n√©ral en t sont prises en compte. h  avec des courants de d√©marrage √©lev√©s: contr√¥le des lampes LED, lampes √† incandescence, alimentations √† d√©coupage.  De plus, chaque contact de relais est prot√©g√© contre les surtensions par une varistance.  Six de ces modules ont d√ª √™tre install√©s afin de g√©rer sereinement un nombre donn√© de charges.  Tous les WB-MR6 sont connect√©s via l'interface ModBus dans un seul r√©seau.  Chaque module de relais est r√©gl√© sur une adresse correspondant au sch√©ma de connexion, et l'ensemble du syst√®me avec blocs d'entr√©e, fusibles, disjoncteurs est assez bien mont√© dans deux tableaux SHCHMP2-1 500x400x450.  Pour un placement compact des 46 c√¢bles d'entr√©e 3x1,5 (cuivre unipolaire), il √©tait n√©cessaire de changer la position traditionnelle des rails din en verticale. <br><br><img src="https://habrastorage.org/webt/xv/fx/mn/xvfxmnadqjpt8l0wy8jtzxmaopo.jpeg"><br>  <i>Fig.</i>  <i>5. Tableau de distribution avec placement des dispositifs de commande d'√©clairage.</i> <br><br>  Il convient de noter que la fonction incroyablement utile du WB-MR6 √©tait la capacit√© de contr√¥ler les sorties de relais en connectant simplement les boutons normalement ouverts au bornier inf√©rieur, c'est ce dont vous avez besoin pour un sch√©ma de c√¢blage temporaire.  T.K.  Le contr√¥le ModBus est apparu cinq mois plus tard, apr√®s l'assemblage et l'installation des tableaux.  Pendant ce temps, tous les c√¢bles allant √† chaque charge ont √©t√© enti√®rement test√©s et num√©rot√©s.  Et un sch√©ma de commutation d√©taill√© a √©t√© √©labor√©, avec la logique de commande de l'interrupteur - l'ampoule de la Fig_6. <br><br><img src="https://habrastorage.org/webt/59/ca/lj/59caljsa6bx9fv1bkzm6x9cgz2g.jpeg"><br>  <i>Fig.</i>  <i>6. Sch√©ma de contr√¥le de l'√©clairage et modules de placement et d'interrogation des charges.</i> <br><br>  En ce qui concerne les modules d'enqu√™te, je peux dire ce qui suit, le diagramme fonctionnel montr√© dans la Fig_7 s'est av√©r√© tout √† fait fonctionnel.  Il n'y avait pratiquement pas besoin de refaire quoi que ce soit, le module RF ss2530 vous permet d'affecter n'importe quelle entr√©e √† n'importe quelle sortie.  La seule exception est UART (pin20-Tx, pin21-Rx). La plupart de la liste des √©l√©ments a √©t√© achet√©e sur ali. Les cartes de circuits imprim√©s ont √©t√© command√©es sur r√©sonateur. besoin de.  Mais acquis une exp√©rience inestimable en installant des composants SMD. <br><br><img src="https://habrastorage.org/webt/vv/a3/d6/vva3d686ixu6dxa3rh-fxmemqig.jpeg"><br>  <i>Fig.</i>  <i>7. Diagramme fonctionnel du module d'interrogation des boutons</i> <br><br>  Le processus de d√©bogage du syst√®me et de le mettre dans un √©tat pleinement op√©rationnel a pris un peu plus de trois mois.  Les premi√®res √©tapes apr√®s l'assemblage des cartes Rice_8, la v√©rification de l'alimentation et la connexion au programmateur, ont √©t√© d'√©crire un programme d'interrogation de bouton et de g√©n√©rer des commandes de contr√¥le pour les modules de relais WB-MR6 via le bus ModBus. <br><br><img src="https://habrastorage.org/webt/zj/qq/cg/zjqqcgo-dewjpy6dpqvydmmjpu4.jpeg"><br>  <i>Fig.</i>  <i>8. Module d'interrogation des boutons</i> <br><br>  Cela s'est av√©r√© assez rapide et facile.  Un module d'interrogation √† un bouton est connect√© √† un module relais via RS485 jusqu'√† pr√©sent sans interface r√©seau.  Imm√©diatement r√©ussi √† appliquer le succ√®s obtenu sur l'objet pic_9, la paire torsad√©e UTP, √† partir des boutons situ√©s dans la chambre, a √©t√© pos√©e √† l'avance.  Avec la fixation des modules, je ne suis pas devenu trop intelligent; <br><br><img src="https://habrastorage.org/webt/qq/2m/f2/qq2mf2-bsvhphquu_bb_bikcajw.jpeg"><br>  <i>Fig.</i>  <i>9. Fixation des modules d'interrogation des boutons.</i> <br><br>  Il a ensuite ajout√© par programme l'adresse de chaque module, qui a √©t√© d√©finie √† l'aide du dip-switch et de la carte de commutation correspondante, du mode de fonctionnement ma√Ætre / esclave et de la transmission des commandes par radio.  Un pas en avant √©tait grave et, par cons√©quent, le d√©bogage posait de nombreuses difficult√©s.  Le plus grave est le transfert d'informations sur le bouton press√© vers le module ma√Ætre connect√© au bus Modbus d√®s que le protocole de transfert de donn√©es zig-bee a √©t√© activ√©, tout s'est av√©r√© √™tre beaucoup plus compliqu√©.  Pour ceux qui ont lu jusqu'ici, je peux dire que le probl√®me √©tait que les temporisateurs dans le c≈ìur du processeur fonctionnent de mani√®re impr√©visible, plus pr√©cis√©ment dans le compilateur IAR, vous devez constamment sp√©cifier ses param√®tres lors de l'appel de la proc√©dure de comptage du temps.  Pour trouver un moyen de r√©soudre ce probl√®me, des fonctions de surveillance et de contr√¥le des donn√©es envoy√©es par radio ont √©t√© ajout√©es.  Le contr√¥le de la pression d'un bouton en mode service a √©t√© instantan√©ment affich√© dans l'hyper-terminal de l'ordinateur, qui est connect√© via l'adaptateur RS485-USB au module d'interrogation.  Un autre probl√®me s√©rieux dans l'organisation du r√©seau de contr√¥le d'√©clairage √©tait la port√©e inad√©quate de l'interface radio.  Plus ou moins, en toute confiance, tout ne basculait que dans les limites de la table sur laquelle le trac√© √©tait assembl√©.  Ceci est une cons√©quence de la fonction de mode d'√©conomie d'√©nergie du SS2530, elle a par d√©faut pour fonction de r√©duire la puissance de rayonnement, une fois le lien √©tabli, je ne sais pas pourquoi cela a √©t√© fait, mais cela a √©t√© d√©couvert via jtag en mode de d√©bogage √©tape par √©tape.  Apr√®s avoir d√©sactiv√© ce mode, le r√©seau a commenc√© √† fonctionner dans un seul √©tage du chalet, en fait, les commandes d'√©clairage marche / arr√™t ont √©t√© trait√©es par le serveur, uniquement √† partir des modules d'interrogation situ√©s dans un rayon de 12-14 m.  Pourvu qu'il n'y ait pas de murs.  Pour r√©soudre ce probl√®me, nous avons choisi la fa√ßon de remplacer le module CC2530 par une antenne plane par un module avec une antenne externe (avec connecteur IPEX), d'autant plus qu'il a √©t√© tr√®s r√©ussi d'acheter trois modules en version E18-MSI-IPX plus une antenne et un c√¢ble dans l'un de Saint-P√©tersbourg boutiques en ligne.  Tout cela a √©t√© soud√© rapidement, les coins pour le montage des antennes ont √©t√© r√©alis√©s et viss√©s sur les plaques adaptatrices Fig_10. <br><br><img src="https://habrastorage.org/webt/es/20/je/es20jewxb7gxff5iefdsr9uzmbu.jpeg"><br>  <i>Fig.</i>  <i>10. Utilisation d'une antenne externe</i> <br><br>  Le r√©sultat d'une telle mise √† niveau a √©t√© tr√®s d√©routant pour moi - car la gamme n'a pas beaucoup chang√©, je dirais m√™me qu'elle a l√©g√®rement diminu√©.  J'ai commenc√© √† chercher un moyen de sortir de cette situation en optimisant les algorithmes du programme, les r√©glages initiaux du SS2530 ont d√ª relire la fiche technique voiture et les forums sur ce sujet.  L'objectif √©tait de faire fonctionner chaque module du r√©seau comme un r√©p√©teur, d'autant plus qu'une telle fonction est activ√©e par d√©faut et est prise en charge par tout appareil ex√©cutant le protocole Zig-Bee.  Mais dans mon cas, ce n'√©tait pas √©vident.  En cons√©quence, j'ai d√©cid√© d'introduire un module suppl√©mentaire dans le syst√®me, qui aurait un firmware unique activ√© en n'√©levant que pin_6 sur le dip-switch.  Il devait, √©tait au plafond du premier √©tage et venait de diffuser les commandes re√ßues, c'est-√†-dire  √™tre un amplificateur de signal. <br><br>  Je dirai tout de suite que c'√©tait une impasse.  Mais lors de la mise en ≈ìuvre de cette id√©e, j'ai accidentellement mesur√© les param√®tres de l'antenne ¬´noire¬ª, que j'ai vendue dans une boutique en ligne avec le CC2530 et le c√¢ble.  L'analyseur de r√©seau a montr√© un SWR 1.9 √† une fr√©quence de 2,4 GHz - les commentaires ne sont pas n√©cessaires, vous devez cr√©er votre propre antenne.  Une demande au moteur de recherche donne imm√©diatement la bonne r√©ponse, l'antenne Clover et les instructions de fabrication d√©taill√©es. <br><br><img src="https://habrastorage.org/webt/8f/fo/2s/8ffo2soyaf4iikrhcw75ymoxwwi.jpeg"><br>  <i>Fig.</i>  <i>11. Antenne et dispositif pour sa fabrication.</i> <br><br>  Litt√©ralement dans la soir√©e, j'ai fait trois morceaux de ces antennes, v√©rifi√© leur SWR pour pas moins de 1,2.  Je ne peux pas dire sur les autres caract√©ristiques, le diagramme de rayonnement et le gain.  Mais le fait est que la gamme de r√©ception et d'envoi fiables des commandes a doubl√©.  Fig_12 <br><br><img src="https://habrastorage.org/webt/ye/ba/bd/yebabdzcf80hy4yoaoilnapxxz4.jpeg"><br>  <i>Fig.</i>  <i>12. Mesure d'antenne</i> <br><br>  En cons√©quence, nous avons r√©ussi √† obtenir une r√©ception normale du signal du serveur sur les 12 modules d'interrogation install√©s dans le chalet.  T.O.  l'exigence de savoirs traditionnels est pleinement remplie √† temps; j'ai pratiquement respect√© les d√©lais.  Le client est satisfait. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460637/">https://habr.com/ru/post/fr460637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460627/index.html">vGPU - l'utilisation ne peut pas √™tre ignor√©e</a></li>
<li><a href="../fr460629/index.html">La probabilit√© que 2 mineurs aient le m√™me monde</a></li>
<li><a href="../fr460631/index.html">Autour du badge en 80 jours: de l'autre c√¥t√© OFFZONE</a></li>
<li><a href="../fr460633/index.html">D√©tails d'impl√©mentation pour RSTP et la redondance en anneau √©tendue propri√©taire</a></li>
<li><a href="../fr460635/index.html">CLRium # 6: Concurrence et parall√©lisme. Deux jours: du processeur √† l'async / attente</a></li>
<li><a href="../fr460641/index.html">YouTokenToMe: un outil pour la tokenisation rapide du texte de l'√©quipe VKontakte</a></li>
<li><a href="../fr460643/index.html">R√©partition uniforme des points sur une sph√®re</a></li>
<li><a href="../fr460645/index.html">Faire le bien faire le mal: √©crire du code diabolique avec Go, partie 1</a></li>
<li><a href="../fr460647/index.html">R√©soudre un travail avec pwnable.kr 05 - mot de passe. R√©√©crire la table des liens de proc√©dure via la vuln√©rabilit√© de cha√Æne de format</a></li>
<li><a href="../fr460651/index.html">R√©union de la Society of Anonymous Testers: TMS, monitoring monitoring, search quality evaluation and native iOS tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>