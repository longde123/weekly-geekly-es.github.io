<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßô ü§ú ü•ê Zwei-Wege-Analyse f√ºr Affiliate-Iframe-Widgets mit Google Tag Manager ü§õüèæ üçî üéø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Widgets sind heutzutage ein wesentlicher Bestandteil vieler gro√üer Portale, da Sie damit komplexe Partnerschaftsentw√ºrfe verwenden und langwierige Imp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zwei-Wege-Analyse f√ºr Affiliate-Iframe-Widgets mit Google Tag Manager</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424799/"> Widgets sind heutzutage ein wesentlicher Bestandteil vieler gro√üer Portale, da Sie damit komplexe Partnerschaftsentw√ºrfe verwenden und langwierige Implementierungsverfahren vermeiden k√∂nnen.  Gleichzeitig ist die Webanalyse von Widgets f√ºr alle Beteiligten interessant. Bei iFrame treten jedoch Schwierigkeiten bei der √úbertragung von 100% der Daten an die Teilnehmer der Partnerschaft auf.  Was sind diese Schwierigkeiten und wie wir es geschafft haben, sie zu umgehen, m√∂chte ich in diesem Artikel erz√§hlen.  Zun√§chst wird es f√ºr alle interessant sein, die an der Entwicklung und Implementierung von Widgets auf iFrame beteiligt sind, sowie f√ºr Analysten. <br><a name="habracut"></a><br>  Zun√§chst ein kleiner Hintergrund.  Wir entwickeln eigene L√∂sungen f√ºr die Automatisierung im Bereich des Personenverkehrs sowie Produkte f√ºr den Einsatz auf Partnerstandorten.  Eines davon war das Projekt der automatisierten Buchung von VIP- und Business-Lounges an Flugh√§fen in der Welt und in Russland, um die Bed√ºrfnisse von Gesch√§fts- und Premium-Kunden verschiedener Fluggesellschaften zu erf√ºllen.  Eine einzige Datenbank mit thematischen Diensten an verschiedenen Flugh√§fen ist vor allem f√ºr Unternehmen von Interesse, die mit Passagierflugreisen, Online-Reiseb√ºros sowie Reiseb√ºros mit Websites im Internet verbunden sind.  F√ºr solche Unternehmen wurde ein Widget ‚ÄûVIP-Halle‚Äú erstellt, mit dem Benutzer jeder Partnerseite auf diese Datenbank zugreifen k√∂nnen. <br><br>  Das Widget wird standardm√§√üig √ºber iFrame installiert. Der Partner muss lediglich den Code auf seiner Website platzieren und die Darstellungsparameter gem√§√ü dem allgemeinen Designkonzept konfigurieren.  Infolgedessen wird auf der Website ein Modul zur Auswahl und Buchung von VIP-Lounges am gew√ºnschten Flughafen mit Zugang zu Premium-Flughafendiensten angezeigt, z. B. ein Shuttle (individueller Transfer von der Lounge zum Flugzeug), ein Meeting in der Lounge mit einem Schild, die Begleitung eines Mitarbeiters und die Parkm√∂glichkeit f√ºr VIP Kunden.  Der Buchungsvorgang erfolgt in wenigen einfachen Schritten, in denen der Benutzer den Inhalt der Bestellung variieren kann (Abb. 1). <br><br><img src="https://i.imgur.com/hGuf48V.gif" alt="Bild"><br>  <i>Abbildung 1 - Das Erscheinungsbild des Widgets auf der Site</i> <br><br>  Angesichts der Variabilit√§t der F√ºlldaten stellt sich nat√ºrlich die Frage, ob dieser Prozess aus analytischer Sicht verfolgt werden kann.  Dar√ºber hinaus ist die Webanalyse sowohl f√ºr den <b>Eigent√ºmer des</b> Widgets als auch f√ºr den <b>Partner</b> , der es festlegt, interessant. W√§hrend des Entwicklungsprozesses wurde daher die Aufgabe ausgef√ºhrt, Ereignisse innerhalb des Widgets zu verfolgen und gleichzeitig in zwei Richtungen zu senden: <br><br>  A. Von allen Websites, auf denen das Widget installiert ist, bis zur Webanalyse des Eigent√ºmers (Entwicklers). <br>  B. Von der Site, auf der ein bestimmtes Widget installiert ist, zur Webanalyse des Partners. <br><br>  <b>Was ist die Schwierigkeit hier?</b>  Grunds√§tzlich verwendet der Partner einen einzelnen Widget-Code, der nicht f√ºr eine bestimmte Partner-Site anpassbar ist, aber gleichzeitig Informationen in der Analyse nur in seinem Widget anzeigen m√∂chte.  Die zweite Schwierigkeit besteht darin, dass der Entwickler (Eigent√ºmer) des Widgets Daten von allen Partnerseiten gleichzeitig in einem Z√§hler empfangen muss, was dem Wunsch des Partners widerspricht, nur seine eigenen Informationen zu sehen.  Am Ende m√ºssen Sie nur zwischen den Daten unterscheiden, die der Partner sehen sollte und die der Eigent√ºmer sehen wird.  Das Problem wurde mit dem <b>Google Tag Manager</b> (im Folgenden: GTM) gel√∂st. <br><br>  Dieses Tool wird h√§ufig f√ºr die Webanalyse und das Tag-Management auf Websites verwendet. Es ist nicht sinnvoll, das Funktionsprinzip im Detail zu beschreiben. Zum Verst√§ndnis reicht es aus, sich mit dem Konzept von GTM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aus anderen Artikeln</a> vertraut zu machen.  In diesem Fall ist es wichtig zu verstehen, dass Sie mit Google Tag Manager (Abb. 2) Daten von der Website in Ihren eigenen Containern konsolidieren und nach den angegebenen Regeln an verschiedene Webanalysez√§hler verteilen k√∂nnen. <br><br><img src="https://i.imgur.com/SnMpud3.gif" alt="Bild"><br>  <i>Abbildung 2 - Das Fenster "Tags" von Google Tag Manager mit bereits konfigurierten Tags f√ºr das Widget</i> <br><br>  Zun√§chst werden wir den Algorithmus zur L√∂sung dieses Problems beschreiben, um sofort zu verstehen, wie wir das Ergebnis erzielt haben.  Also: <br><br><ol><li>  Der Partner m√∂chte wie der Eigent√ºmer das Widget auf zwei oder zwei Arten gleichzeitig verfolgen - mithilfe von Yandex.Metrica oder Google Analytics. </li><li>  Eine zufriedenstellende L√∂sung muss Daten an 4 Z√§hler √ºbergeben: den Metrikz√§hler des Eigent√ºmers, den Google Analytics-Z√§hler des Eigent√ºmers, den Metrikz√§hler des Partners und den Google Analytics-Z√§hler des Partners. </li><li>  Im Widget ist ein einzelner Google Tag Manager-Container installiert, der alle Daten sammelt und verteilt, sodass jeder Teilnehmer nur die Informationen erh√§lt, die er ben√∂tigt. </li><li>  Die Kennungen der Z√§hler des Eigent√ºmers sind standardm√§√üig festgelegt. Die Kennungen des Partners sollten ihnen zum Zeitpunkt der Generierung des Widget-Codes im B√ºro des Partners zur weiteren Installation auf der Site angezeigt werden. </li><li>  Da das B√ºro des Partners bereits f√ºr den Partner konfiguriert ist, k√∂nnen darin Kennungen festgelegt und in das Widget geworfen werden, damit der Tag Manager sie verwendet. </li><li>  Innerhalb von GTM werden die Kennungen in die Codes zum Ausl√∂sen von Zielereignissen sowie in die Verteilung der Daten√ºbertragung durch die Eigent√ºmer- und Partnerz√§hler eingesetzt. </li><li>  In diesem Fall sendet GTM alle gesammelten Daten an die Z√§hler des Eigent√ºmers und Daten auf der Website des Partners - nur an die Z√§hler des Partners, weil  Beim Ersetzen von Kennungen wird nur die vom Partner angegebene Site verfolgt. </li></ol><br>  Zum besseren Verst√§ndnis geben wir ein Flussdiagramm des Prozesses (Abb. 3): <br><br><img src="https://i.imgur.com/chOfcFZ.jpg" alt="Bild"><br>  <i>Abbildung 3 - Diagramm des Daten√ºbertragungsprozesses</i> <br><br>  Zun√§chst werden wir feststellen, dass die Website neben dem Google Tag Manager-Code auch automatisch generierte Yandex.Metrica- und Google Analytics-Z√§hlercodes enth√§lt.  In ihnen werden beim Generieren von Code f√ºr die Site vom Partner festgelegte Z√§hler-IDs weitergeleitet. <br><br>  Diese Codes k√∂nnen nicht im Widget festgelegt werden, da Sie sie mit den GTM-Funktionen automatisch auf der Site als entsprechende Tags generieren k√∂nnen (Typ - Benutzerdefiniertes HTML - Abb. 4). In diesem Fall war jedoch ein hartes Schreiben im Widget-Code erforderlich - einige Ereignisse auf der Site erfordern Damit wird der Z√§hler sofort im Widget installiert.  Grunds√§tzlich handelt es sich dabei um Ladeereignisse, das Auftreten von Preroll.  Wenn Sie diese Art von Ereignis nicht haben, k√∂nnen Sie den Z√§hlercode √ºber GTM generieren: <br><br><img src="https://i.imgur.com/OlldDXp.gif" alt="Bild"><br>  <i>Abbildung 4 - Ein Beispiel f√ºr die √úbertragung des Metrikcodes √ºber GTM auf die Site</i> <br><br>  Um Daten gleichzeitig an zwei Z√§hler (Partner und Eigent√ºmer) zu √ºbertragen, m√ºssen Sie nicht zwei verschiedene Metrik- oder Analytics-Codes festlegen, sondern einen <b>speziellen Doppelcode erstellen</b> .  Zum Zeitpunkt des Schreibens sehen die richtigen Codes folgenderma√üen aus (Abb. 5): <br><br><img src="https://i.imgur.com/yf9ROGE.gif" alt="Bild"><br>  <i>Abbildung 5 - Die korrekte Verwendung der Doppelcodes Metric und GA</i> <br><br>  Als n√§chstes m√ºssen Sie die vom Partner angegebene Kennung an den Z√§hlercode √ºbergeben.  Die Schwierigkeit besteht darin, dass der Widget-Code automatisch f√ºr alle Sites generiert wird, w√§hrend die Kennungen bereits in einem separaten Partnerb√ºro festgelegt sind.  F√ºr die korrekte Weiterleitung hat der Programmierer die folgende L√∂sung implementiert: <br><br>  Bei der Initialisierung des Widgets wird ein iFrame erstellt, in dessen Parametern die Kennungen der Z√§hler des Partners √ºbergeben werden (die Z√§hler werden an src iFrame √ºbergeben, wonach sie vom Standort aus im Widget analysiert werden).  iFrame √∂ffnet die Widget-Anwendung und der vom Widget erstellte SPA-Hook (Lifecycle) verarbeitet die Eingabeparameter der Z√§hlernummern vor dem Mounten, und Nummern (Bezeichner) werden im localStorage gespeichert. <br><br>  Das folgende Konstrukt wird verwendet, um den Google Analytics-Code in index.html zu platzieren: <br><br><pre><code class="javascript hljs">&lt;script&gt; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.dataLayer = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.dataLayer || []; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gtag</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ dataLayer.push(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); } gtag(<span class="hljs-string"><span class="hljs-string">'js'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()); gtag(<span class="hljs-string"><span class="hljs-string">'config'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-15930803-13'</span></span>); gtag(<span class="hljs-string"><span class="hljs-string">'config'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>[localStorage.getItem(<span class="hljs-string"><span class="hljs-string">'partnerGA'</span></span>)] || <span class="hljs-string"><span class="hljs-string">'UA-15930803-14'</span></span>); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Skripte mit der Variablen src werden beim Initialisieren der Z√§hler dynamisch eingef√ºgt: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> script = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>) script.setAttribute(<span class="hljs-string"><span class="hljs-string">'src'</span></span>, <span class="hljs-string"><span class="hljs-string">`https://www.googletagmanager.com/gtag/js?id=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${ga || </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'UA-15930803-14'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">`</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.head.insertBefore(script, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.head.firstChild)</code> </pre> <br>  Hier ist UA-15930803-14 der "Z√§hler" -Z√§hler des Eigent√ºmers, der verwendet wird, wenn der Z√§hler nicht vom Partner gesetzt wird.  Diese Situation kann auftreten, wenn der Partner die Kennungen der Z√§hler im Allgemeinen nicht angegeben hat oder wenn nur eine Kennung angegeben wurde. Es sollte immer ein Ersatzcode vorhanden sein, damit auf der Site keine JavaScript-Fehler auftreten, die mit dem Fehlen einer Kennung f√ºr den korrekten Betrieb des √úbertragungscodes eines Ereignisses verbunden sind.  UA-15930803-13 ist in diesem Fall die Hauptkennung des Eigent√ºmers, zu der die Daten in jedem Fall und von jedem Standort stammen. <br><br>  √Ñhnlich wie bei GA wird der Yandex.Metrica-Code generiert, der die angegebene Kennung der Metrik des Eigent√ºmers, die Ersatzkennung des Z√§hlers des Eigent√ºmers und das Design f√ºr die √úbertragung der Partnerkennung verwendet.  Der Code wird gem√§√ü dem in 5 gezeigten Schema unter Verwendung der Strukturen aus dem obigen Beispiel erzeugt. <br><br>  Nach den Z√§hlercodes m√ºssen Sie die vom Partner festgelegten Kennungen an die Kennungen des Google Tag Managers weiterleiten.  Innerhalb des Containers werden sie bereits als interne Variablen verwendet, deren Werte den generierten Ereignissen zugef√ºhrt werden k√∂nnen. <br><br>  F√ºr GTM sind Variablen auf Datenebene (dataLayer) die am h√§ufigsten verwendete Technik.  Die Datenschicht ist eine JavaScript-Variable, deren Initialisierung automatisch im Google Tag Manager-Container beschrieben wird.  Mit dieser Funktion k√∂nnen Sie Ereignisse, die auf der Website auftreten, wie Ereignisse √ºbertragen oder eigene Variablen f√ºr GTM festlegen.  Dies erfolgt anhand der Konstruktion <br><br><pre> <code class="javascript hljs">dataLayer.push(<span class="hljs-string"><span class="hljs-string">'_'</span></span>: <span class="hljs-string"><span class="hljs-string">'_'</span></span>);</code> </pre> <br>  Wird nach der Ank√ºndigung des GTM-Codes auf der Site ausgel√∂st.  In unserem Fall hat die Variable auf Datenebene jedoch nicht funktioniert. M√∂glicherweise liegt es an der Schwierigkeit, speziell mit dem Iframe zu arbeiten.  Wenn Sie das Konstrukt push () automatisch festlegen, empf√§ngt der Container keine Variablen, und in diesem Fall wollten wir eine solche Implementierung der Aufgabe.  Wenn Sie versuchen, die Variable auf Datenebene manuell festzulegen (z. B. durch Klicken auf die Site), wird die Variablenweiterleitung normal ausgef√ºhrt. <br><br>  Um keine Zeit mit dem Parsen des Prozesses zu verschwenden, haben wir eine alternative L√∂sung verwendet - das Erstellen globaler JavaScript-Variablen √ºber <b>localStorage</b> . <br><br>  Mit der Eigenschaft localStorage k√∂nnen Sie Variablen mit den angegebenen Werten speichern, ohne an die ge√∂ffnete Seite der Site gebunden zu sein, und die Daten in diesem Speicher k√∂nnen nicht einfach gel√∂scht werden.  Dementsprechend wurden Partnerz√§hlerkennungen unter Verwendung der folgenden Designs weitergeleitet: <br><br><pre> <code class="javascript hljs">localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'partnerMetrika1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'partnerMetrika2'</span></span>, <span class="hljs-string"><span class="hljs-string">'yaCounter'</span></span>); localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'partnerGA'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA--'</span></span>);</code> </pre> <br>  Hier √ºbertr√§gt das erste Konstrukt die Partnermetriknummer selbst, das zweite Konstrukt den yaCounter-Sammelwert, um das Tag "Ereignis" im Google Tag Manager erstellen zu k√∂nnen (dazu sp√§ter mehr), und das dritte - die Google Analytics-ID. <br><br>  Damit ist die Daten√ºbertragung abgeschlossen und der GTM selbst eingerichtet. <br><br>  Lassen Sie uns zun√§chst entscheiden, wie Google Tag Manager funktioniert.  Es bietet 3 Interaktionsebenen: <br><br>  <b>Tag</b> .  Dies ist Teil des Codes, der auf einer Site mit installiertem GTM gehostet und wie jeder andere Code ausgef√ºhrt werden kann, indem der Inhalt der Site ge√§ndert oder Daten an Webanalysez√§hler √ºbergeben werden. <br><br>  Das Tag wird ausgel√∂st, wenn eine Bedingung auf der Site erf√ºllt ist. <br><br>  <b>Ausl√∂ser</b>  Dies ist tats√§chlich eine Bedingung, deren Erf√ºllung das Ausl√∂sen des Tags bewirkt.  Dies kann ein Ereignis auf einer Site, eine √Ñnderung des Werts von Variablen oder eine Standardaktion sein, z. B. ein Klick oder ein Seitenaufruf. <br><br>  <b>Variable</b> .  Es enth√§lt einige Werte, die auf verschiedene Arten √ºbertragen werden k√∂nnen, und wird als Datenprovider f√ºr Tags oder als Bedingungsmarker verwendet. <br><br>  Der Inhalt der Variablen l√∂st den Trigger aus, und der Trigger l√∂st wiederum das entsprechende Tag aus.  Die Kennungen der Affiliate-Z√§hler werden genau als Variablen festgelegt. Daher lohnt es sich, mit der Datenbildung im GTM-Container zu beginnen. <br><br>  Wir haben drei Hauptvariablen vom Typ ‚ÄûNative JavaScript-Code‚Äú erstellt (Abb. 6): <br><br><img src="https://i.imgur.com/qWZwXhw.gif" alt="Bild"><br>  <i>Abbildung 6 - Ein Beispiel f√ºr eine Variable, die die Affiliate-Metrik-ID verwendet</i> <br><br>  Hier ist der Wert der Variablen = der Wert, den wir von localStorage √ºbernommen haben. <br><br>  Wenn GTM nun auf die Variable zugreift, erh√§lt sie ihren Wert - die Kennung der Partnermetrik.  Auf die gleiche Weise haben wir Variablen f√ºr die Partner-Metriknummer und die Google Analytics-Kennung des Partners erstellt. <br><br>  Wof√ºr werden diese Variablen verwendet?  Sie l√∂sen das Problem des Sendens von Daten √ºber das Ausl√∂sen von Ereignissen auf der Site an Partnerz√§hler.  Google Tag Manager verf√ºgt √ºber ein Standardverfahren zum √úbertragen von Zielen an Google Analytics, bei dem Sie den Wert einer Variablen als Z√§hler-ID verwenden k√∂nnen.  F√ºr die Metrik wird ein Tag in Form eines benutzerdefinierten HTML-Codes verwendet, der die Standard-JavaScript-Metrik enth√§lt: <br><br><pre> <code class="javascript hljs">yaCounterXXXXXX.reachGoal(<span class="hljs-string"><span class="hljs-string">'TARGET_NAME'</span></span>);</code> </pre> <br>  Hier ist TARGET_NAME der interne Name des Zielereignisses f√ºr die Metrik (solche Ziele werden in den Z√§hlereinstellungen √ºber den Typ "JavaScript-Ereignis" erstellt), und  ist die Z√§hlernummer. <br><br>  Daher erstellen wir entsprechende Tags f√ºr verschiedene Arten von Z√§hlern. <br><br>  <b>F√ºr Google Analytics:</b> <br><br>  Der Tag-Typ ist "Universal Analytics", die Tracking-ID stammt aus unserer Variablen. <br><br><img src="https://i.imgur.com/WssMHHk.gif" alt="Bild"><br>  <i>Abbildung 7 - Ein Beispiel f√ºr das Festlegen eines Tags, mit dem Daten an Google Analytics √ºbergeben werden.</i> <br><br>  Hier sind Kategorie und Aktion die Werte, die Google Analytics als Parameter f√ºr das Ausl√∂sen des Ziels erfassen sollte.  Die Tracking-ID ist eine zuvor definierte Variable, die die Partner-ID von localStorage √ºbernimmt. <br><br>  <b>F√ºr Yandex.Metrica:</b> <br><br>  Der Tag-Typ ist "Benutzerdefiniertes HTML" unter Verwendung von JavaScript-Konstrukten. <br><br><img src="https://i.imgur.com/vhg9L0m.gif" alt="Bild"><br>  <i>Abbildung 8 - Ein Beispiel f√ºr das Festlegen eines Tags, das Daten an Yandex.Metrica √ºbertr√§gt</i> <br><br>  Hier ist {{PartnerMetrikaCounter}} die interne Deklaration der Variablen, die die Partnermetrik-ID aus localStorage √ºbernimmt.  Mit dem Fensterobjekt ersetzen wir den Wert der Variablen in den ausf√ºhrbaren Code und erhalten in der Ausgabe yaCounterXXXXXXXX.reachGoal ('widget_loading'); wobei widget_loading der Wert ist, den Metric als Triggerparameter des Ziels abf√§ngt. <br><br>  Es bleiben nur die Trigger zu setzen, um die entsprechenden Tags auszul√∂sen.  Ausl√∂ser in unserem Fall sind zum Beispiel: <br><br><ul><li>  Ereignisse f√ºr das erfolgreiche Laden des Widgets; </li><li>  Ereignisse, bei denen ein Schritt in einem Widget erfolgreich oder erfolglos abgeschlossen wurde; </li><li>  Ausf√ºllen bestimmter Felder; </li><li>  Auswahl der Bedingungen A oder B innerhalb des Widgets; </li><li>  Interaktion mit Formularen, Schaltfl√§chen und Links. </li></ul><br>  In den Einstellungen der Leistungsindikatoren "Metriken" und "Google Analytics" m√ºssen nur die entsprechenden Ziele erstellt werden: <br><br><img src="https://i.imgur.com/Tj70YS0.gif" alt="Bild"><br>  <i>Abbildung 9 - Ein Beispiel f√ºr das Setzen eines Ziels in Yandex.Metrica</i> <br><br><img src="https://i.imgur.com/HstDw1o.gif" alt="Bild"><br>  <i>Abbildung 10 - Ein Beispiel f√ºr das Festlegen eines Ziels in Google Analytics</i> <br><br>  Das Problem ist gel√∂st.  Die Doppelz√§hlercodes ersetzen die von ihnen festgelegten Werte f√ºr die Metrik- und Analysekennungen des Partners, und die Werte der Eigent√ºmerkennungen bleiben unver√§ndert.  Gleichzeitig leitet Google Tag Manager die Antwort der entsprechenden Ziele nur dann an die Z√§hler des Partners weiter, wenn er von den Variablen genau die Kennungen erh√§lt, die der jeweilige Partner auf seiner Website angegeben hat.  Parallel dazu sendet GTM alle Zielereignisse von allen Standorten an den Eigent√ºmer. <br><br>  Wenn der Partner keinen oder beide Bezeichner angegeben hat, werden die Standardwerte verwendet - Bezeichner von Testz√§hlern, die vom Eigent√ºmer im Voraus festgelegt wurden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424799/">https://habr.com/ru/post/de424799/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424787/index.html">Interview mit Aaron Patterson, Sprecher der RubyRussia-Konferenz 2018</a></li>
<li><a href="../de424789/index.html">So stellen Sie eine Ruby on Rails-Anwendung mit HAProxy Ingress, Unicorn / Puma und Web-Sockets bereit</a></li>
<li><a href="../de424791/index.html">Erweitern der Netzwerkfunktionen eines programmierbaren Relais mithilfe von WI-FI</a></li>
<li><a href="../de424793/index.html">So drucken Sie einen Elektromotor</a></li>
<li><a href="../de424795/index.html">Wie gro√ü kann eine solarbetriebene Drohne sein?</a></li>
<li><a href="../de424801/index.html">Zeppelin OS - ein weiterer Schritt in Richtung sicherer intelligenter Vertr√§ge</a></li>
<li><a href="../de424803/index.html">Der taiwanesische Hacker wollte Mark Zuckerbergs Facebook-Seite online hacken, gab aber sp√§ter seine Drohungen auf</a></li>
<li><a href="../de424805/index.html">Wie ich mit GitHub, Docker und TravisCI ein Diplom in LaTeX geschrieben habe</a></li>
<li><a href="../de424807/index.html">EOIP zwischen DD-WRT und Keenetic Giga 2 zum Kombinieren von zwei Apartments in einem Netzwerk oder einer Festplatte in zwei Apartments</a></li>
<li><a href="../de424809/index.html">DNA Mechanismen zum Speichern und Verarbeiten von Informationen. Teil I.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>