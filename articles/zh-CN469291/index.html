<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’ªğŸ¼ ğŸ¤¦ğŸ¾ ğŸ‡ x86ä¸‹JVM HotSpotä¸­å­—èŠ‚ç è§£é‡Šå™¨çš„åˆå§‹åŒ–å’Œæ“ä½œ ğŸˆ ğŸ“‰ ğŸ’¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å‡ ä¹æ¯ä¸ªJavaå¼€å‘äººå‘˜éƒ½çŸ¥é“ç”¨Javaè¯­è¨€ç¼–å†™çš„ç¨‹åºæœ€åˆä¼šè¢«ç¼–è¯‘ä¸ºJVMå­—èŠ‚ç å¹¶å­˜å‚¨ä¸ºæ ‡å‡†æ ¼å¼çš„ç±»æ–‡ä»¶ã€‚ åœ¨è™šæ‹Ÿæœºä¸­è·å–æ­¤ç±»ç±»æ–‡ä»¶ä¹‹åï¼Œç›´åˆ°ç¼–è¯‘å™¨å°šæœªè®¿é—®å®ƒä»¬ä¸ºæ­¢ï¼ŒJVMä¼šè§£é‡Šè¿™äº›ç±»æ–‡ä»¶ä¸­åŒ…å«çš„å­—èŠ‚ç ã€‚ æœ¬æ–‡æ¦‚è¿°äº†æœ‰å…³OpenJDK JVM HotSpotçš„è§£é‡Šå™¨å¦‚ä½•å·¥ä½œã€‚ 


 æ–‡ç« å†…å®¹ï¼š 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>x86ä¸‹JVM HotSpotä¸­å­—èŠ‚ç è§£é‡Šå™¨çš„åˆå§‹åŒ–å’Œæ“ä½œ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469291/"><p>å‡ ä¹æ¯ä¸ªJavaå¼€å‘äººå‘˜éƒ½çŸ¥é“ç”¨Javaè¯­è¨€ç¼–å†™çš„ç¨‹åºæœ€åˆä¼šè¢«ç¼–è¯‘ä¸ºJVMå­—èŠ‚ç å¹¶å­˜å‚¨ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ ‡å‡†æ ¼å¼çš„</a>ç±»æ–‡ä»¶ã€‚ åœ¨è™šæ‹Ÿæœºä¸­è·å–æ­¤ç±»ç±»æ–‡ä»¶ä¹‹åï¼Œç›´åˆ°ç¼–è¯‘å™¨å°šæœªè®¿é—®å®ƒä»¬ä¸ºæ­¢ï¼ŒJVMä¼šè§£é‡Šè¿™äº›ç±»æ–‡ä»¶ä¸­åŒ…å«çš„å­—èŠ‚ç ã€‚ æœ¬æ–‡æ¦‚è¿°äº†æœ‰å…³OpenJDK JVM HotSpotçš„è§£é‡Šå™¨å¦‚ä½•å·¥ä½œã€‚ </p><a name="habracut"></a><br><p> æ–‡ç« å†…å®¹ï¼š </p><br><ul><li> ç¯å¢ƒ </li><li> è¿è¡ŒJavaåº”ç”¨ç¨‹åº </li><li> è§£é‡Šå™¨åˆå§‹åŒ–å’Œæ§åˆ¶æƒè½¬ç§»åˆ°Javaä»£ç  </li><li> ä¾‹å­ </li></ul><br><h4 id="okruzhenie"> ç¯å¢ƒ </h4><br><p> å¯¹äºå®éªŒï¼Œæˆ‘ä»¬ä½¿ç”¨å¸¦æœ‰<a href="">autoconfé…ç½®</a>çš„æœ€æ–°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ç”¨</a> OpenJDK JDK12 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¿®è®¢ç‰ˆ</a>çš„æ±‡ç¼–ã€‚ </p><br><pre><code class="plaintext hljs">--enable-debug --with-native-debug-symbols=internal</code> </pre> <br><p> åœ¨Ubuntu 18.04 / gcc 7.4.0ä¸Šã€‚ </p><br><p>  <code>--with-native-debug-symbols=internal</code>æ„å‘³ç€ï¼Œåœ¨æ„å»ºJDKæ—¶ï¼Œdebazhç¬¦å·å°†åŒ…å«åœ¨äºŒè¿›åˆ¶æ–‡ä»¶æœ¬èº«ä¸­ã€‚ </p><br><p>  <code>--enable-debug</code>äºŒè¿›åˆ¶æ–‡ä»¶å°†åŒ…å«å…¶ä»–è°ƒè¯•ä»£ç ã€‚ </p><br><p> åœ¨è¿™æ ·çš„ç¯å¢ƒä¸­æ„å»ºJDK 12å¹¶ä¸å¤æ‚ã€‚ æˆ‘éœ€è¦åšçš„å°±æ˜¯å®‰è£…JDK11ï¼ˆ <a href="">è¦æ„å»ºJDK nï¼Œéœ€è¦JDK n-1</a> ï¼‰ï¼Œç„¶åæ‰‹åŠ¨äº¤ä»˜è‡ªåŠ¨é…ç½®çš„å¿…éœ€åº“ã€‚ æ¥ä¸‹æ¥ï¼Œè¿è¡Œå‘½ä»¤ </p><br><pre> <code class="plaintext hljs">bash configure --enable-debug --with-native-debug-symbols=internal &amp;&amp; make CONF=fastdebug images</code> </pre> <br><p> ç„¶åç¨ç­‰ç‰‡åˆ»ï¼ˆåœ¨æˆ‘çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šå¤§çº¦10åˆ†é’Ÿï¼‰ï¼Œæˆ‘ä»¬å¾—åˆ°äº†fastdebugæ„å»ºJDK 12ã€‚ </p><br><p> åŸåˆ™ä¸Šï¼Œä»…ä»å…¬å…±å­˜å‚¨åº“å®‰è£…jdkå¹¶é™„å¸¦æä¾›å¸¦æœ‰è°ƒè¯•ç¬¦å·çš„openjdk-xx-dbgè½¯ä»¶åŒ…å°±è¶³å¤Ÿäº†ï¼Œå…¶ä¸­xxæ˜¯jdkç‰ˆæœ¬ï¼Œä½†æ˜¯fastdebugç¨‹åºé›†æä¾›äº†æ¥è‡ªgdbçš„è°ƒè¯•åŠŸèƒ½ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ç®€åŒ–å·¥ä½œã€‚ ç›®å‰ï¼Œæˆ‘æ­£åœ¨ç§¯æä½¿ç”¨<a href="">psï¼ˆï¼‰ï¼ˆ</a>ç”¨äºæŸ¥çœ‹æ¥è‡ªgdbçš„Javaå †æ ˆè·Ÿè¸ªä¿¡æ¯çš„åŠŸèƒ½<a href="">ï¼‰</a>å’Œ<a href="">pflï¼ˆï¼‰ï¼ˆ</a>ç”¨äºåˆ†ææ¡†æ¶å †æ ˆçš„åŠŸèƒ½<a href="">ï¼‰</a> ï¼ˆåœ¨gdbä¸­è°ƒè¯•è§£é‡Šå™¨æ—¶éå¸¸æ–¹ä¾¿ï¼‰ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä¾‹å­psï¼ˆï¼‰å’Œpflï¼ˆï¼‰</b> <div class="spoiler_text"><p> ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹gdbè„šæœ¬ </p><br><pre> <code class="plaintext hljs">#   java file /home/dmitrii/jdk12/build/linux-x86_64-server-fastdebug/images/jdk/bin/java #   SEGV-, HotSpot #  SEGV  . #, https://hg.openjdk.java.net/jdk/jdk12/file/06222165c35f/src/hotspot/cpu/x86/vm_version_x86.cpp#l361 handle SIGSEGV nostop noprint set breakpoint pending on set pagination off #  ,   #    # java- public static void main(String args[]) b PostJVMInit thread 2 commands #   , #    set $buf = (char *) malloc(1000) #        #(   ) b *AbstractInterpreter::_entry_table[0] thread 2 commands #      rbx. #   Method* set $mthd = ((Method *) $rbx) #    $buf call $mthd-&gt;name_and_sig_as_C_string($buf, 1000) # ,  public static void main(String args) if strcmp()("Main.main([Ljava/lang/String;)V", $buf) == 0 #   ,      # ps/pfl        #(    ps/pfl) b InterpreterRuntime::build_method_counters(JavaThread*, Method*) commands #  ,    #   delete breakpoints call ps() call pfl() c end end c end c end r -cp /home/dmitrii/jdk12/ Main</code> </pre> <br><p> è¿è¡Œè¿™æ ·çš„è„šæœ¬çš„ç»“æœæ˜¯ï¼š </p><br><pre> <code class="plaintext hljs">"Executing ps" for thread: "main" #1 prio=5 os_prio=0 cpu=468,61ms elapsed=58,65s tid=0x00007ffff001b800 nid=0x5bfa runnable [0x00007ffff7fd9000] java.lang.Thread.State: RUNNABLE Thread: 0x00007ffff001b800 [0x5bfa] State: _running _has_called_back 0 _at_poll_safepoint 0 JavaThread state: _thread_in_Java 1 - frame( sp=0x00007ffff7fd9920, unextended_sp=0x00007ffff7fd9920, fp=0x00007ffff7fd9968, pc=0x00007fffd828748b) Main.main(Main.java:10) "Executing pfl" for thread: "main" #1 prio=5 os_prio=0 cpu=468,83ms elapsed=58,71s tid=0x00007ffff001b800 nid=0x5bfa runnable [0x00007ffff7fd9000] java.lang.Thread.State: RUNNABLE Thread: 0x00007ffff001b800 [0x5bfa] State: _running _has_called_back 0 _at_poll_safepoint 0 JavaThread state: _thread_in_Java [Describe stack layout] 0x00007ffff7fd99e0: 0x00007ffff7fd9b00 #2 entry frame call_stub word fp - 0 0x00007ffff7fd99d8: 0x00007ffff7fd9c10 call_stub word fp - 1 0x00007ffff7fd99d0: 0x00007fffd8287160 call_stub word fp - 2 0x00007ffff7fd99c8: 0x00007fffbf1fb3e0 call_stub word fp - 3 0x00007ffff7fd99c0: 0x000000000000000a call_stub word fp - 4 0x00007ffff7fd99b8: 0x00007ffff7fd9ce8 call_stub word fp - 5 0x00007ffff7fd99b0: 0x00007ffff7fd9a80 call_stub word fp - 6 0x00007ffff7fd99a8: 0x00007ffff001b800 call_stub word fp - 7 0x00007ffff7fd99a0: 0x00007ffff7fd9b40 call_stub word fp - 8 0x00007ffff7fd9998: 0x00007ffff7fd9c00 call_stub word fp - 9 0x00007ffff7fd9990: 0x00007ffff7fd9a80 call_stub word fp - 10 0x00007ffff7fd9988: 0x00007ffff7fd9ce0 call_stub word fp - 11 0x00007ffff7fd9980: 0x00007fff00001fa0 call_stub word fp - 12 0x00007ffff7fd9978: 0x0000000716a122b8 sp for #2 locals for #1 unextended_sp for #2 local 0 0x00007ffff7fd9970: 0x00007fffd82719f3 0x00007ffff7fd9968: 0x00007ffff7fd99e0 #1 method Main.main([Ljava/lang/String;)V @ 0 - 1 locals 1 max stack 0x00007ffff7fd9960: 0x00007ffff7fd9978 interpreter_frame_sender_sp 0x00007ffff7fd9958: 0x0000000000000000 interpreter_frame_last_sp 0x00007ffff7fd9950: 0x00007fffbf1fb3e0 interpreter_frame_method 0x00007ffff7fd9948: 0x0000000716a11c40 interpreter_frame_mirror 0x00007ffff7fd9940: 0x0000000000000000 interpreter_frame_mdp 0x00007ffff7fd9938: 0x00007fffbf1fb5e8 interpreter_frame_cache 0x00007ffff7fd9930: 0x00007ffff7fd9978 interpreter_frame_locals 0x00007ffff7fd9928: 0x00007fffbf1fb3d0 interpreter_frame_bcp 0x00007ffff7fd9920: 0x00007ffff7fd9920 sp for #1 interpreter_frame_initial_sp unextended_sp for #1</code> </pre> <br><p> å¦‚æ‚¨æ‰€è§ï¼Œåœ¨<code>ps()</code>çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»…è·å¾—è°ƒç”¨å †æ ˆï¼Œåœ¨<code>pfl()</code>çš„æƒ…å†µä¸‹ï¼Œ <code>pfl()</code>å®Œæ•´å †æ ˆç»„ç»‡ã€‚ </p></div></div><br><h4 id="zapusk-java-prilozheniya"> è¿è¡ŒJavaåº”ç”¨ç¨‹åº </h4><br><p> åœ¨ç›´æ¥è¿›è¡Œè§£é‡Šå™¨è®¨è®ºä¹‹å‰ï¼Œæˆ‘ä»¬å°†ç®€è¦å›é¡¾ä¸€ä¸‹å°†æ§åˆ¶æƒè½¬ç§»åˆ°Javaä»£ç ä¹‹å‰æ‰§è¡Œçš„æ“ä½œã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸€ä¸ªâ€œä»€ä¹ˆéƒ½ä¸åšâ€çš„Javaç¨‹åºä¸ºä¾‹ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String args[])</span></span></span></span>{ } }</code> </pre> <br><p> å¹¶å°è¯•æ‰¾å‡ºè¿è¡Œæ­¤ç±»åº”ç”¨ç¨‹åºæ—¶å‘ç”Ÿçš„æƒ…å†µï¼š </p><br><p> <code>javac Main.java &amp;&amp; java Main</code> </p> <br><p> å›ç­”æ­¤é—®é¢˜çš„ç¬¬ä¸€ä»¶äº‹æ˜¯æŸ¥æ‰¾å¹¶æŸ¥çœ‹JavaäºŒè¿›åˆ¶æ–‡ä»¶-æˆ‘ä»¬ç”¨äºè¿è¡Œæ‰€æœ‰JVMåº”ç”¨ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å°±æˆ‘è€Œè¨€ï¼Œå®ƒä½äºè·¯å¾„ä¸Š </p><br><p>  <code>/home/dmitrii/jdk12/build/linux-x86_64-server-fastdebug/images/jdk/bin/java</code> ã€‚ </p><br><p> ä½†æ˜¯æœ€åï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«å€¼å¾—å…³æ³¨çš„ã€‚ è¿™æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸debazhnymiç¬¦å·ä¸€èµ·ä»…å ç”¨20KBï¼Œå¹¶ä¸”ä»…ä»ä¸€ä¸ªæºæ–‡ä»¶<a href="">å¯åŠ¨å™¨/ main.c</a>ç¼–è¯‘<a href="">ã€‚</a> </p><br><p> ä»–æ‰€åšçš„åªæ˜¯æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°ï¼ˆchar * argv []ï¼‰ï¼Œ <a href="">ä»JDK_JAVA_OPTIONSç¯å¢ƒå˜é‡ä¸­è¯»å–å‚æ•°</a> ï¼Œè¿›è¡ŒåŸºæœ¬çš„é¢„å¤„ç†å’ŒéªŒè¯ï¼ˆä¾‹å¦‚ï¼Œæ‚¨ä¸èƒ½åœ¨æ­¤ç¯å¢ƒå˜é‡ä¸­æ·»åŠ <a href="">ç»ˆç«¯é€‰é¡¹</a>æˆ–Main classåç§°ï¼‰å¹¶<a href="">è°ƒç”¨è¯¥å‡½æ•°ã€‚ JLI_Launch</a>åŠå…¶ç»“æœå‚æ•°åˆ—è¡¨ã€‚ </p><br><p>  JLI_Launchå‡½æ•°çš„å®šä¹‰æœªåŒ…å«åœ¨JavaäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ‚¨æŸ¥çœ‹å…¶ç›´æ¥ä¾èµ–é¡¹ï¼Œåˆ™è¯¥å®šä¹‰ï¼š </p><br><pre> <code class="plaintext hljs">$ ldd java linux-vdso.so.1 (0x00007ffcc97ec000) libjli.so =&gt; /home/dmitrii/jdk12/build/linux-x86_64-server-fastdebug/images/jdk/bin/./../lib/libjli.so (0x00007ff27518d000) // &lt;---------    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007ff274d9c000) libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x00007ff274b7f000) libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007ff27497b000) libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007ff27475c000) /lib64/ld-linux-x86-64.so.2 (0x00007ff27559f000)</code> </pre> <br><p> æ‚¨å¯ä»¥çœ‹åˆ°<strong>ä¸å…¶</strong>é“¾æ¥çš„<strong>libjli.so</strong> ã€‚ è¯¥åº“åŒ…å«å¯åŠ¨å™¨æ¥å£-Javaç”¨æ¥åˆå§‹åŒ–å’Œå¯åŠ¨è™šæ‹Ÿæœºçš„ä¸€ç»„å‡½æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬JLI_Launchã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ç•Œé¢åŠŸèƒ½çš„å®Œæ•´åˆ—è¡¨</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ objdump -T -j .text libjli.so libjli.so: file format elf64-x86-64 DYNAMIC SYMBOL TABLE: 0000000000009280 g DF .text 0000000000000038 Base JLI_List_add 0000000000003330 g DF .text 00000000000001c3 Base JLI_PreprocessArg 0000000000008180 g DF .text 0000000000000008 Base JLI_GetStdArgs 0000000000008190 g DF .text 0000000000000008 Base JLI_GetStdArgc 0000000000007e50 g DF .text 00000000000000b8 Base JLI_ReportErrorMessage 000000000000a400 g DF .text 00000000000000df Base JLI_ManifestIterate 0000000000002e70 g DF .text 0000000000000049 Base JLI_InitArgProcessing 0000000000008000 g DF .text 0000000000000011 Base JLI_ReportExceptionDescription 0000000000003500 g DF .text 0000000000000074 Base JLI_AddArgsFromEnvVar 0000000000007f10 g DF .text 00000000000000e9 Base JLI_ReportErrorMessageSys 0000000000005840 g DF .text 00000000000000b8 Base JLI_ReportMessage 0000000000009140 g DF .text 000000000000003a Base JLI_SetTraceLauncher 0000000000009020 g DF .text 000000000000000a Base JLI_MemFree 0000000000008f90 g DF .text 0000000000000026 Base JLI_MemAlloc 00000000000059c0 g DF .text 0000000000002013 Base JLI_Launch 00000000000091c0 g DF .text 000000000000003b Base JLI_List_new 0000000000008ff0 g DF .text 0000000000000026 Base JLI_StringDup 0000000000002ec0 g DF .text 000000000000000c Base JLI_GetAppArgIndex</code> </pre> </div></div><br><p> åœ¨å°†æ§åˆ¶æƒè½¬ç§»åˆ°JLI_Launchä¹‹åï¼Œéœ€è¦æ‰§è¡Œè®¸å¤šæ“ä½œæ¥å¯åŠ¨JVMï¼Œä¾‹å¦‚ï¼š </p><br><p>  <strong>æˆ‘</strong> å°†JVM HotSpotå­—ç¬¦åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶è·å¾—æŒ‡å‘åˆ›å»ºVMçš„å‡½æ•°çš„æŒ‡é’ˆã€‚ </p><br><p> æ‰€æœ‰JVM HotSpotä»£ç éƒ½ä½äºlibjvm.soåº“ä¸­ã€‚ åœ¨ç¡®å®šlibjvm.soçš„ç»å¯¹è·¯å¾„ä¹‹åï¼Œè¯¥<a href="">åº“å°†</a>è¢«<a href="">åŠ è½½åˆ°å†…å­˜ä¸­</a> ï¼Œå¹¶ä¸”<a href="">æŒ‡å‘JNI_CreateJavaVMå‡½æ•°</a>çš„<a href="">æŒ‡é’ˆä¹Ÿå°†è¢«åˆ é™¤</a> ã€‚ è¯¥å‡½æ•°æŒ‡é’ˆè¢«å­˜å‚¨ï¼Œéšåç”¨äºåˆ›å»ºå’Œåˆå§‹åŒ–è™šæ‹Ÿæœºã€‚ </p><br><p> æ˜¾ç„¶libjvm.soæ²¡æœ‰é“¾æ¥åˆ°libjli.so </p><br><p>  <strong>äºŒ</strong> ã€‚ è§£æç»è¿‡é¢„å¤„ç†åä¼ é€’çš„å‚æ•°ã€‚ </p><br><p> å…·æœ‰è¯­éŸ³åç§°<a href="">ParseArguments</a>çš„å‡½æ•°å°†è§£æä»å‘½ä»¤è¡Œä¼ é€’çš„å‚æ•°ã€‚ æ­¤å‚æ•°è§£æå™¨å®šä¹‰<a href="">åº”ç”¨ç¨‹åºå¯åŠ¨æ¨¡å¼</a> </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> LaunchMode { <span class="hljs-comment"><span class="hljs-comment">// cf. sun.launcher.LauncherHelper LM_UNKNOWN = 0, LM_CLASS, LM_JAR, LM_MODULE, LM_SOURCE };</span></span></code> </pre> <br><p> è¿˜å°†éƒ¨åˆ†å‚æ•°è½¬æ¢ä¸º<code>-DpropertyName=propertyValue</code>æ ¼å¼ï¼Œä¾‹å¦‚ï¼Œ <code>-cp=/path</code>è½¬æ¢ä¸º<code>-Djava.class.path=/path</code> ã€‚ æ­¤å¤–ï¼Œæ­¤ç±»<code>SystemProperty</code>å­˜å‚¨åœ¨JVM HotSpotçš„<a href="">å…¨å±€æ•°ç»„</a>ä¸­ï¼Œå¹¶åœ¨<a href="">åˆå§‹åŒ–</a>çš„<a href="">ç¬¬ä¸€é˜¶æ®µ</a>è½¬å‘ç»™<code>java.lang.System::props</code> ï¼ˆåœ¨JDK12ä¸­ï¼Œå·²ç»ä¿®æ”¹äº†java.lang.System.propsçš„åˆå§‹åŒ–æœºåˆ¶ï¼Œåœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤commitä¸­</a>æœ‰æ›´å¤šä¿®æ”¹ï¼‰ã€‚ </p><br><p> è§£æå‚æ•°è¿˜ä¼šä¸¢å¼ƒJVMæœªå¤„ç†çš„ä¸€äº›é€‰é¡¹ï¼ˆä¾‹å¦‚<code>--list-modules</code> ï¼Œæ­¤æ—¶æ­¤é€‰é¡¹çš„å¤„ç†ç›´æ¥åœ¨å¯åŠ¨å™¨ä¸­è¿›è¡Œï¼‰ã€‚ </p><br><p>  <strong>ä¸‰</strong> ã€‚ åˆ†å‰åŸå§‹çº¿ç¨‹å¹¶åœ¨å…¶ä¸­åˆ›å»ºVM </p><br><p> ä½†æ˜¯ï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼Œåˆ™å°è¯•<a href="">åœ¨ä¸»çº¿ç¨‹ä¸­</a> â€œä»…å°è¯•ä¸€ä¸‹â€ <a href="">å¯åŠ¨JVM</a> ã€‚ </p><br><p> ç ”ç©¶äº†è¿™ä¸ªé—®é¢˜ä¹‹åï¼Œæˆ‘å‘ç°äº†JVMæ— æ³•åœ¨ä¸»çº¿ç¨‹ä¸­å¯åŠ¨çš„å¯èƒ½åŸå› ä¹‹ä¸€ã€‚ äº‹å®æ˜¯ï¼ˆè‡³å°‘åœ¨Linuxä¸Šï¼‰pthreadå’Œä¸»çº¿ç¨‹åœ¨å †æ ˆä¸­çš„å·¥ä½œæ–¹å¼ä¸åŒã€‚ ä¸»çº¿ç¨‹'açš„å¤§å°å—<code>ulimit -s</code>é™åˆ¶ï¼Œå³ è®¾ç½®ä»»æ„å¤§çš„å€¼æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªä»»æ„å¤§çš„å †æ ˆã€‚ ä¸»çº¿ç¨‹ä½¿ç”¨ç±»ä¼¼äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MAP_GROWSDOWNçš„</a>ä¸œè¥¿ï¼Œä½†ä¸ä½¿ç”¨<code>MAP_GROWSDOWN</code> ã€‚ ä»¥çº¯æ ¼å¼ä½¿ç”¨<code>MAP_GROWSDOWN</code>æ˜¯ä¸å®‰å…¨çš„ï¼Œå¹¶ä¸”å¦‚æœå†…å­˜å¯¹æˆ‘<code>MAP_GROWSDOWN</code> ï¼Œ <code>MAP_GROWSDOWN</code>å…¶é”å®šã€‚ åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œ <code>MAP_GROWSDOWN</code>ä¸ä¼šæ·»åŠ ä»»ä½•æ•ˆæœã€‚ ä¸»çº¿ç¨‹æ˜ å°„å’ŒMAP_GROWSDOWNä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼Œé™¤äº†<code>MAP_FIXED</code>ä¹‹å¤–ï¼Œæ²¡æœ‰å…¶ä»–<code>mmap</code>å¯ä»¥ä¸å¯èƒ½çš„å †æ ˆæ‰©å±•åŒºåŸŸäº§ç”Ÿå†²çªã€‚ è¯¥è½¯ä»¶æ‰€éœ€è¦åšçš„å°±æ˜¯è®¾ç½®ç›¸åº”çš„<code>rsp</code>å€¼ï¼Œç„¶åæ“ä½œç³»ç»Ÿå°†<code>rsp</code>å€¼ï¼šç„¶åå°†å¤„ç†é¡µé¢é”™è¯¯ï¼Œå¹¶è®¾ç½®<a href="">ä¿æŠ¤æªæ–½</a> ã€‚ è¿™ç§å·®å¼‚ä¼šå½±å“è®¸å¤šè€™ï¼š <a href="">åœ¨ç¡®å®šå½“å‰æµçš„å †æ ˆå¤§å°æ—¶</a> ï¼Œ <a href="">åœ¨åˆ›å»ºä¿æŠ¤é¡µé¢æ—¶</a> </p><br><p> å› æ­¤ï¼Œæˆ‘ä»¬å°†å‡è®¾ç›®å‰æˆ‘ä»¬å·²ç»æˆåŠŸè§£æäº†é€‰é¡¹å¹¶ä¸ºVMåˆ›å»ºäº†çº¿ç¨‹ã€‚ ä¹‹åï¼Œåˆšåˆšåˆ†å‰çš„çº¿ç¨‹å¼€å§‹åˆ›å»ºè™šæ‹Ÿæœºï¼Œç„¶åè¿›å…¥<a href="">Threads :: create_vmå‡½æ•°</a> </p><br><p> åœ¨æ­¤åŠŸèƒ½ä¸­ï¼Œäº§ç”Ÿäº†å¤§é‡ <del> é»‘é­”æ³• </del> åˆå§‹åŒ–ï¼Œæˆ‘ä»¬åªå¯¹å…¶ä¸­ä¸€äº›æ„Ÿå…´è¶£ã€‚ </p><br><h4 id="inicializaciya-intepretatora-i-peredacha-upravleniya-java-kodu"> åˆå§‹åŒ–è§£é‡Šå™¨å¹¶å°†æ§åˆ¶æƒè½¬ç§»åˆ°Javaä»£ç  </h4><br><p> å¯¹äºJVM HotSpotä¸­çš„æ¯æ¡æŒ‡ä»¤ï¼Œéƒ½æœ‰ç”¨äºç‰¹å®šä½“ç³»ç»“æ„çš„ç‰¹å®šæœºå™¨ä»£ç æ¨¡æ¿ã€‚ å½“è§£é‡Šå™¨å¼€å§‹æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼Œå®ƒé¦–å…ˆå¯»æ‰¾çš„æ˜¯å…¶æ¨¡æ¿åœ¨ç‰¹æ®Š<a href="">DispatchTable</a>è¡¨ä¸­çš„åœ°å€ã€‚ æ¥ä¸‹æ¥ï¼Œ <a href="">è·³è½¬</a>åˆ°è¯¥æ¨¡æ¿çš„åœ°å€ï¼Œå¹¶åœ¨æŒ‡ä»¤æ‰§è¡Œå®Œæˆåï¼Œjvm <a href="">æŒ‰é¡ºåº</a>å–å‡º<a href="">ä¸‹ä¸€æ¡æŒ‡ä»¤</a>çš„åœ°å€ï¼Œå¹¶ä»¥ç›¸åŒçš„æ–¹å¼å¼€å§‹æ‰§è¡Œï¼Œä¾æ­¤ç±»æ¨ã€‚ ä½¿ç”¨è§£é‡Šå™¨åªèƒ½é’ˆå¯¹ä¸â€œåˆ†æ´¾â€çš„æŒ‡ä»¤ï¼ˆä¾‹å¦‚ï¼Œç®—æœ¯æŒ‡ä»¤ï¼ˆ <code>xsub</code> ï¼Œ <code>xdiv</code>ç­‰ï¼Œå…¶ä¸­<code>x</code> - <code>i</code> ï¼Œ <code>l</code> ï¼Œ <code>f</code> ï¼Œ <code>d</code> ï¼‰ï¼‰è§‚å¯Ÿåˆ°æ­¤è¡Œä¸ºã€‚ ä»–ä»¬æ‰€åšçš„åªæ˜¯æ‰§è¡Œç®—æœ¯è¿ç®—ã€‚ </p><br><p> å¯¹äºè¿‡ç¨‹è°ƒç”¨æŒ‡ä»¤ï¼ˆ <code>invokestatic</code> ï¼Œ <code>invokestatic</code>ç­‰ï¼‰ï¼Œè¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤å°†æ˜¯è¢«è°ƒç”¨è¿‡ç¨‹ä¸­çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚ è¿™äº›æŒ‡ä»¤æœ¬èº«å°†ä¸‹ä¸€ä¸ªè¦åœ¨å…¶æ¨¡æ¿ä¸­æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€æ”¾ä¸‹ã€‚ </p><br><p> ä¸ºäº†ç¡®ä¿æœ¬æœºåœ¨<a href=""><code>Threads::create_vm</code></a> ï¼Œå°†æ‰§è¡Œè®¸å¤šè§£é‡Šç¨‹åºä¾èµ–çš„åˆå§‹åŒ–ï¼š </p><br><p>  <strong>æˆ‘</strong> åˆå§‹åŒ–å¯ç”¨å­—èŠ‚ç è¡¨ </p><br><p> åœ¨è¿›è¡Œè§£é‡Šå™¨çš„åˆå§‹åŒ–ä¹‹å‰ï¼Œæœ‰å¿…è¦åˆå§‹åŒ–ä½¿ç”¨çš„å­—èŠ‚ç è¡¨ã€‚ å®ƒåœ¨<a href="">Bytecodes :: initialize</a>å‡½æ•°ä¸­æ‰§è¡Œï¼Œå¹¶æ˜¾ç¤ºä¸ºæ˜“äºé˜…è¯»çš„æ ‡ç­¾ã€‚ å…¶ç‰‡æ®µå¦‚ä¸‹ï¼š </p><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Java bytecodes // bytecode bytecode name format wide f. result tp stk traps def(_nop , "nop" , "b" , NULL , T_VOID , 0, false); def(_aconst_null , "aconst_null" , "b" , NULL , T_OBJECT , 1, false); def(_iconst_m1 , "iconst_m1" , "b" , NULL , T_INT , 1, false); def(_iconst_0 , "iconst_0" , "b" , NULL , T_INT , 1, false); def(_iconst_1 , "iconst_1" , "b" , NULL , T_INT , 1, false); def(_iconst_2 , "iconst_2" , "b" , NULL , T_INT , 1, false); def(_iconst_3 , "iconst_3" , "b" , NULL , T_INT , 1, false); def(_iconst_4 , "iconst_4" , "b" , NULL , T_INT , 1, false); def(_iconst_5 , "iconst_5" , "b" , NULL , T_INT , 1, false); def(_lconst_0 , "lconst_0" , "b" , NULL , T_LONG , 2, false); def(_lconst_1 , "lconst_1" , "b" , NULL , T_LONG , 2, false); def(_fconst_0 , "fconst_0" , "b" , NULL , T_FLOAT , 1, false); def(_fconst_1 , "fconst_1" , "b" , NULL , T_FLOAT , 1, false); def(_fconst_2 , "fconst_2" , "b" , NULL , T_FLOAT , 1, false); def(_dconst_0 , "dconst_0" , "b" , NULL , T_DOUBLE , 2, false); def(_dconst_1 , "dconst_1" , "b" , NULL , T_DOUBLE , 2, false); def(_bipush , "bipush" , "bc" , NULL , T_INT , 1, false); def(_sipush , "sipush" , "bcc" , NULL , T_INT , 1, false); def(_ldc , "ldc" , "bk" , NULL , T_ILLEGAL, 1, true ); def(_ldc_w , "ldc_w" , "bkk" , NULL , T_ILLEGAL, 1, true ); def(_ldc2_w , "ldc2_w" , "bkk" , NULL , T_ILLEGAL, 2, true );</span></span></code> </pre> <br><p> æ ¹æ®è¯¥è¡¨ï¼Œä¸ºæ¯ä¸ªå­—èŠ‚ç è®¾ç½®å…¶é•¿åº¦ï¼ˆå¤§å°å§‹ç»ˆä¸º1ä¸ªå­—èŠ‚ï¼Œä½†<code>ConstantPool</code>å¯èƒ½è¿˜æœ‰ä¸€ä¸ªç´¢å¼•ä»¥åŠå®½å­—èŠ‚ç ï¼‰ï¼Œåç§°ï¼Œå­—èŠ‚ç å’Œæ ‡å¿—ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Bytecodes::_is_initialized = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* Bytecodes::_name [Bytecodes::number_of_codes]; BasicType Bytecodes::_result_type [Bytecodes::number_of_codes]; s_char Bytecodes::_depth [Bytecodes::number_of_codes]; u_char Bytecodes::_lengths [Bytecodes::number_of_codes]; Bytecodes::Code Bytecodes::_java_code [Bytecodes::number_of_codes]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> Bytecodes::_flags [(<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;BitsPerByte)*<span class="hljs-number"><span class="hljs-number">2</span></span>];</code> </pre> <br><p> è¿›ä¸€æ­¥éœ€è¦è¿™äº›å‚æ•°æ¥ç”Ÿæˆè§£é‡Šå™¨æ¨¡æ¿ä»£ç ã€‚ </p><br><p>  <strong>äºŒ</strong> ã€‚ åˆå§‹åŒ–ç¼“å­˜ä»£ç  </p><br><p> ä¸ºäº†ç”Ÿæˆè§£é‡Šå™¨æ¨¡æ¿çš„ä»£ç ï¼Œå¿…é¡»é¦–å…ˆä¸ºæ­¤ä¸šåŠ¡åˆ†é…å†…å­˜ã€‚ é«˜é€Ÿç¼“å­˜ä»£ç çš„å†…å­˜ä¿ç•™æ˜¯é€šè¿‡å…·æœ‰ç›¸åŒåç§°<a href="">CodeCache :: initializeï¼ˆï¼‰</a>çš„å‡½æ•°å®ç°çš„ã€‚ ä»æ­¤å‡½æ•°çš„ä»¥ä¸‹ä»£ç éƒ¨åˆ†å¯ä»¥çœ‹å‡º </p><br><pre> <code class="cpp hljs"> CodeCacheExpansionSize = align_up(CodeCacheExpansionSize, os::vm_page_size()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SegmentedCodeCache) { <span class="hljs-comment"><span class="hljs-comment">// Use multiple code heaps initialize_heaps(); } else { // Use a single code heap FLAG_SET_ERGO(uintx, NonNMethodCodeHeapSize, 0); FLAG_SET_ERGO(uintx, ProfiledCodeHeapSize, 0); FLAG_SET_ERGO(uintx, NonProfiledCodeHeapSize, 0); ReservedCodeSpace rs = reserve_heap_memory(ReservedCodeCacheSize); add_heap(rs, "CodeCache", CodeBlobType::All); }</span></span></code> </pre> <br><p> ç¼“å­˜ä»£ç ç”±ä»¥ä¸‹é€‰é¡¹æ§åˆ¶<a href=""><code>-XX:ReservedCodeCacheSize</code></a> ï¼Œ <a href=""><code>-XX:SegmentedCodeCache</code></a> ï¼Œ <a href=""><code>-XX:CodeCacheExpansionSize</code></a> ï¼Œ <a href=""><code>-XX:NonNMethodCodeHeapSize</code></a> ï¼Œ <a href=""><code>-XX:ProfiledCodeHeapSize</code></a> ï¼Œ <a href=""><code>-XX:NonProfiledCodeHeapSize</code></a> ã€‚ è¿™äº›é€‰é¡¹çš„ç®€è¦è¯´æ˜å¯ä»¥åœ¨å®ƒä»¬æ‰€æŒ‡å‘çš„é“¾æ¥ä¸­æ‰¾åˆ°ã€‚ é™¤äº†å‘½ä»¤è¡Œä»¥å¤–ï¼Œå…¶ä¸­æŸäº›é€‰é¡¹çš„å€¼ä¹Ÿç»è¿‡äº†äººä½“å·¥ç¨‹å­¦è°ƒæ•´ï¼Œä¾‹å¦‚ï¼Œå¦‚æœé»˜è®¤æƒ…å†µä¸‹ï¼ˆå…³é—­ï¼‰ <code>SegmentedCodeCache</code>å€¼ï¼ˆå…³é—­ï¼‰ï¼Œåˆ™ä»£ç å¤§å°<code>&gt;= 240Mb</code> ï¼Œ <code>SegmentedCodeCache</code>å°†åŒ…å«åœ¨<a href="">CompilerConfig :: set_tiered_flagsä¸­</a> ã€‚ </p><br><p> æ‰§è¡Œæ£€æŸ¥åï¼Œå°†<code>ReservedCodeCacheSize</code>ä¸€ä¸ªå¤§å°ä¸º<code>ReservedCodeCacheSize</code> bytesçš„åŒºåŸŸã€‚ å¦‚æœå‘ç°<code>SegmentedCodeCache</code>æ˜¯å…¬å¼€çš„ï¼Œåˆ™æ­¤åŒºåŸŸåˆ†ä¸ºä»¥ä¸‹éƒ¨åˆ†ï¼šJITç¼–è¯‘çš„æ–¹æ³•ï¼Œstabä¾‹ç¨‹ç­‰ã€‚ </p><br><p>  <strong>ä¸‰</strong> ã€‚ è§£é‡Šå™¨æ¨¡å¼çš„åˆå§‹åŒ– </p><br><p> å­—èŠ‚ç è¡¨å’Œç¼“å­˜ä»£ç åˆå§‹åŒ–ä¹‹åï¼Œå¯ä»¥ç»§ç»­è¿›è¡Œè§£é‡Šå™¨æ¨¡æ¿çš„ä»£ç ç”Ÿæˆã€‚ ä¸ºæ­¤ï¼Œè§£é‡Šå™¨ä¼šä¿ç•™å…ˆå‰åˆå§‹åŒ–çš„ç¼“å­˜ä»£ç ä¸­çš„ç¼“å†²åŒºã€‚ åœ¨ä»£ç ç”Ÿæˆçš„æ¯ä¸ªé˜¶æ®µï¼Œå°†ä»<a href="">ç¼“å†²åŒºä¸­</a>å‰ªåˆ‡å‡ºå°ä»£ç ï¼ˆä¸€å°æ®µä»£ç ï¼‰ã€‚ åœ¨å®Œæˆå½“å‰çš„ç”Ÿæˆä¹‹åï¼Œå°ç ä¸­æœªè¢«ä»£ç ä½¿ç”¨çš„éƒ¨åˆ†å°†è¢«é‡Šæ”¾ï¼Œå¹¶ä¸”å¯ç”¨äºåç»­ä»£ç ç”Ÿæˆã€‚ </p><br><p> åˆ†åˆ«è€ƒè™‘ä»¥ä¸‹æ¯ä¸ªæ­¥éª¤ï¼š </p><br><ul><li>  <a href="">slow_signature_handler</a> </li></ul><br><pre> <code class="cpp hljs"> { <span class="hljs-function"><span class="hljs-function">CodeletMark </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_masm, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"slow signature handler"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; AbstractInterpreter::_slow_signature_handler = generate_slow_signature_handler(); }</code> </pre><br><p> ç­¾åå¤„ç†ç¨‹åºç”¨äºä¸ºè°ƒç”¨æœ¬æœºæ–¹æ³•å‡†å¤‡å‚æ•°ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæœ¬æœºæ–¹æ³•å…·æœ‰13ä¸ªä»¥ä¸Šçš„å‚æ•°ï¼Œåˆ™ä¼šç”Ÿæˆä¸€ä¸ªé€šç”¨å¤„ç†ç¨‹åºï¼ˆæˆ‘æ²¡æœ‰åœ¨è°ƒè¯•å™¨ä¸­æ£€æŸ¥å®ƒï¼Œä½†æ˜¯ä»<a href="">ä»£ç ä¸­</a>åˆ¤æ–­<a href="">å®ƒ</a>åº”è¯¥åƒè¿™æ ·ï¼‰ </p><br><ul><li>  <a href="">æ— æ•ˆçš„å­—èŠ‚ç å¤„ç†</a> </li></ul><br><pre> <code class="cpp hljs"> { <span class="hljs-function"><span class="hljs-function">CodeletMark </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_masm, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"error exits"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; _unimplemented_bytecode = generate_error_exit(<span class="hljs-string"><span class="hljs-string">"unimplemented bytecode"</span></span>); _illegal_bytecode_sequence = generate_error_exit(<span class="hljs-string"><span class="hljs-string">"illegal bytecode sequence - method not verified"</span></span>); }</code> </pre> <br><p>  VMä¼šåœ¨åˆå§‹åŒ–æœŸé—´éªŒè¯ç±»æ–‡ä»¶ï¼Œä½†è¿™æ˜¯ä¸ºäº†é˜²æ­¢æ ˆä¸Šçš„å‚æ•°ä¸æ˜¯æ‰€éœ€æ ¼å¼æˆ–VMä¸çŸ¥é“çš„å­—èŠ‚ç ã€‚ å½“ä¸ºæ¯ä¸ªå­—èŠ‚ç ç”Ÿæˆæ¨¡æ¿ä»£ç æ—¶ï¼Œå°†ä½¿ç”¨è¿™äº›å­˜æ ¹ã€‚ </p><br><ul><li>  <a href="">ä»åŠŸèƒ½è¿”å›</a> </li></ul><br><p> è°ƒç”¨è¿‡ç¨‹ä¹‹åï¼Œæœ‰å¿…è¦ä»å¸§å †æ ˆä¸­è¿˜åŸæ•°æ®ï¼Œè¯¥è¿‡ç¨‹æ˜¯åœ¨è°ƒç”¨è¿”å›è¿‡ç¨‹çš„è¿‡ç¨‹ä¹‹å‰è¿›è¡Œçš„ã€‚ </p><br><ul><li>  <a href="">æ—©æ³„</a> </li></ul><br><p> ä»è§£é‡Šå™¨è°ƒç”¨è¿è¡Œæ—¶æ—¶ä½¿ç”¨ã€‚ </p><br><ul><li><p>  <a href="">æŠ›å‡ºå¼‚å¸¸</a> </p><br></li><li><p>  <a href="">æ–¹æ³•å…¥å£ç‚¹</a> </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> method_entry(kind) \ { CodeletMark cm(_masm, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"method entry point (kind = "</span></span></span><span class="hljs-meta"> #kind </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">")"</span></span></span><span class="hljs-meta">); \ Interpreter::_entry_table[Interpreter::kind] = generate_method_entry(Interpreter::kind); \ Interpreter::update_cds_entry_table(Interpreter::kind); \ }</span></span></code> </pre> <br><p> æ ¹æ®æ–¹æ³•çš„ç±»å‹æ˜¾ç¤ºä¸ºå®ã€‚ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°†æ‰§è¡Œ<a href="">è§£é‡Šåçš„å †æ ˆå¸§</a>çš„å‡†å¤‡å·¥ä½œï¼ŒStackOverflowæ£€æŸ¥ï¼Œå †æ ˆçˆ†ç‚¸ å¯¹äºæœ¬æœºæ–¹æ³•ï¼Œå®šä¹‰äº†ç­¾åå¤„ç†ç¨‹åºã€‚ </p><br></li><li><p>  <a href="">å­—èŠ‚ç æ¨¡æ¿ç”Ÿæˆ</a> </p><br></li></ul><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Bytecodes set_entry_points_for_all_bytes(); // installation of code in other places in the runtime // (ExcutableCodeManager calls not needed to copy the entries) set_safepoints_for_all_bytes();</span></span></code> </pre> <br><p> è¦æ‰§è¡Œè¯¥æŒ‡ä»¤ï¼ŒVMè§„èŒƒè¦æ±‚å°†æ“ä½œæ•°æ”¾åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Operand Stackä¸­</a> ï¼Œä½†è¿™ä¸ä¼šé˜»æ­¢HotSpotå°†å®ƒä»¬ç¼“å­˜åœ¨å¯„å­˜å™¨ä¸­ã€‚ ä¸ºäº†ç¡®å®šå †æ ˆé¡¶éƒ¨çš„å½“å‰çŠ¶æ€ï¼Œä½¿ç”¨äº†ä¸€ä¸ª<a href="">æšä¸¾ã€‚</a> </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> TosState { <span class="hljs-comment"><span class="hljs-comment">// describes the tos cache contents btos = 0, // byte, bool tos cached ztos = 1, // byte, bool tos cached ctos = 2, // char tos cached stos = 3, // short tos cached itos = 4, // int tos cached ltos = 5, // long tos cached ftos = 6, // float tos cached dtos = 7, // double tos cached atos = 8, // object cached vtos = 9, // tos not cached number_of_states, ilgl // illegal state: should not occur };</span></span></code> </pre> <br><p> æ¯ä¸ªæŒ‡ä»¤å®šä¹‰å †æ ˆçš„<code>TosState</code>é¡¶éƒ¨çš„è¾“å…¥å’Œè¾“å‡ºçŠ¶æ€ï¼Œå¹¶ä¸”æ ¹æ®è¯¥çŠ¶æ€å‘ç”Ÿæ¨¡å¼ã€‚ è¿™äº›æ¨¡æ¿åœ¨å¯è¯»çš„<a href="">æ¨¡æ¿è¡¨</a>ä¸­åˆå§‹åŒ–ã€‚ è¯¥è¡¨çš„ä¸€éƒ¨åˆ†å¦‚ä¸‹ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// interpr. templates // Java spec bytecodes ubcp|disp|clvm|iswd in out generator argument def(Bytecodes::_nop , ____|____|____|____, vtos, vtos, nop , _ ); def(Bytecodes::_aconst_null , ____|____|____|____, vtos, atos, aconst_null , _ ); def(Bytecodes::_iconst_m1 , ____|____|____|____, vtos, itos, iconst , -1 ); def(Bytecodes::_iconst_0 , ____|____|____|____, vtos, itos, iconst , 0 ); def(Bytecodes::_iconst_1 , ____|____|____|____, vtos, itos, iconst , 1 ); def(Bytecodes::_iconst_2 , ____|____|____|____, vtos, itos, iconst , 2 ); def(Bytecodes::_iconst_3 , ____|____|____|____, vtos, itos, iconst , 3 ); def(Bytecodes::_iconst_4 , ____|____|____|____, vtos, itos, iconst , 4 ); def(Bytecodes::_iconst_5 , ____|____|____|____, vtos, itos, iconst , 5 ); def(Bytecodes::_lconst_0 , ____|____|____|____, vtos, ltos, lconst , 0 ); def(Bytecodes::_lconst_1 , ____|____|____|____, vtos, ltos, lconst , 1 ); def(Bytecodes::_fconst_0 , ____|____|____|____, vtos, ftos, fconst , 0 ); def(Bytecodes::_fconst_1 , ____|____|____|____, vtos, ftos, fconst , 1 ); def(Bytecodes::_fconst_2 , ____|____|____|____, vtos, ftos, fconst , 2 ); def(Bytecodes::_dconst_0 , ____|____|____|____, vtos, dtos, dconst , 0 ); def(Bytecodes::_dconst_1 , ____|____|____|____, vtos, dtos, dconst , 1 ); def(Bytecodes::_bipush , ubcp|____|____|____, vtos, itos, bipush , _ ); def(Bytecodes::_sipush , ubcp|____|____|____, vtos, itos, sipush , _ );</span></span></code> </pre> <br><p> æˆ‘ä»¬å°†å¯¹<code>in</code> ï¼Œ <code>out</code>å’Œ<code>generator</code>åˆ—ç‰¹åˆ«æ„Ÿå…´è¶£ã€‚ </p><br><p>  in-æŒ‡ä»¤å¼€å§‹æ—¶å †æ ˆé¡¶éƒ¨çš„çŠ¶æ€ <br>  <code>out</code>æŒ‡ä»¤å®Œæˆæ—¶å †æ ˆé¡¶éƒ¨çš„çŠ¶æ€ <br>  <code>generator</code>æœºå™¨æŒ‡ä»¤ä»£ç æ¨¡æ¿çš„ç”Ÿæˆå™¨ </p><br><p> æ‰€æœ‰å­—èŠ‚ç çš„æ¨¡æ¿çš„ä¸€èˆ¬è§†å›¾å¯ä»¥æè¿°ä¸ºï¼š </p><br><ol><li><p> å¦‚æœæœªä¸ºæŒ‡ä»¤è®¾ç½®è°ƒåº¦ä½ï¼Œåˆ™æ‰§è¡ŒæŒ‡ä»¤åºè¨€ï¼ˆx86ä¸Šä¸ºno-opï¼‰ </p><br></li><li><p> ä½¿ç”¨<code>generator</code>æœºå™¨ç  </p><br></li><li><p> å¦‚æœæœªä¸ºè¯¥æŒ‡ä»¤è®¾ç½®è°ƒåº¦ä½ï¼Œåˆ™æ ¹æ®å †æ ˆé¡¶éƒ¨çš„å‡ºæ ˆçŠ¶æ€ï¼ˆæŒ‰é¡ºåºè¿›å…¥ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼‰æŒ‰é¡ºåºæ‰§è¡Œåˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤çš„è½¬æ¢ã€‚ </p><br></li></ol><br><p> ç»“æœæ¨¡æ¿çš„å…¥å£åœ°å€å­˜å‚¨åœ¨å…¨å±€è¡¨ä¸­ï¼Œå¯ç”¨äºè°ƒè¯•ã€‚ </p><br><p> åœ¨HotSpotä¸­ï¼Œä»¥ä¸‹ç›¸å¯¹ç¬¨æ‹™çš„ä»£ç è´Ÿè´£ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">æŒ‡ä»¤ç ç”Ÿæˆå™¨</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> TemplateInterpreterGenerator::set_entry_points(Bytecodes::Code code) { <span class="hljs-function"><span class="hljs-function">CodeletMark </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_masm, Bytecodes::name(code), code)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// initialize entry points assert(_unimplemented_bytecode != NULL, "should have been generated before"); assert(_illegal_bytecode_sequence != NULL, "should have been generated before"); address bep = _illegal_bytecode_sequence; address zep = _illegal_bytecode_sequence; address cep = _illegal_bytecode_sequence; address sep = _illegal_bytecode_sequence; address aep = _illegal_bytecode_sequence; address iep = _illegal_bytecode_sequence; address lep = _illegal_bytecode_sequence; address fep = _illegal_bytecode_sequence; address dep = _illegal_bytecode_sequence; address vep = _unimplemented_bytecode; address wep = _unimplemented_bytecode; // code for short &amp; wide version of bytecode if (Bytecodes::is_defined(code)) { Template* t = TemplateTable::template_for(code); assert(t-&gt;is_valid(), "just checking"); set_short_entry_points(t, bep, cep, sep, aep, iep, lep, fep, dep, vep); } if (Bytecodes::wide_is_defined(code)) { Template* t = TemplateTable::template_for_wide(code); assert(t-&gt;is_valid(), "just checking"); set_wide_entry_point(t, wep); } // set entry points EntryPoint entry(bep, zep, cep, sep, aep, iep, lep, fep, dep, vep); Interpreter::_normal_table.set_entry(code, entry); Interpreter::_wentry_point[code] = wep; } //... void TemplateInterpreterGenerator::set_short_entry_points(Template* t, address&amp; bep, address&amp; cep, address&amp; sep, address&amp; aep, address&amp; iep, address&amp; lep, address&amp; fep, address&amp; dep, address&amp; vep) { assert(t-&gt;is_valid(), "template must exist"); switch (t-&gt;tos_in()) { case btos: case ztos: case ctos: case stos: ShouldNotReachHere(); // btos/ctos/stos should use itos. break; case atos: vep = __ pc(); __ pop(atos); aep = __ pc(); generate_and_dispatch(t); break; case itos: vep = __ pc(); __ pop(itos); iep = __ pc(); generate_and_dispatch(t); break; case ltos: vep = __ pc(); __ pop(ltos); lep = __ pc(); generate_and_dispatch(t); break; case ftos: vep = __ pc(); __ pop(ftos); fep = __ pc(); generate_and_dispatch(t); break; case dtos: vep = __ pc(); __ pop(dtos); dep = __ pc(); generate_and_dispatch(t); break; case vtos: set_vtos_entry_points(t, bep, cep, sep, aep, iep, lep, fep, dep, vep); break; default : ShouldNotReachHere(); break; } } //... void TemplateInterpreterGenerator::generate_and_dispatch(Template* t, TosState tos_out) { if (PrintBytecodeHistogram) histogram_bytecode(t); #ifndef PRODUCT // debugging code if (CountBytecodes || TraceBytecodes || StopInterpreterAt &gt; 0) count_bytecode(); if (PrintBytecodePairHistogram) histogram_bytecode_pair(t); if (TraceBytecodes) trace_bytecode(t); if (StopInterpreterAt &gt; 0) stop_interpreter_at(); __ verify_FPU(1, t-&gt;tos_in()); #endif // !PRODUCT int step = 0; if (!t-&gt;does_dispatch()) { step = t-&gt;is_wide() ? Bytecodes::wide_length_for(t-&gt;bytecode()) : Bytecodes::length_for(t-&gt;bytecode()); if (tos_out == ilgl) tos_out = t-&gt;tos_out(); // compute bytecode size assert(step &gt; 0, "just checkin'"); // setup stuff for dispatching next bytecode if (ProfileInterpreter &amp;&amp; VerifyDataPointer &amp;&amp; MethodData::bytecode_has_profile(t-&gt;bytecode())) { __ verify_method_data_pointer(); } __ dispatch_prolog(tos_out, step); } // generate template t-&gt;generate(_masm); // advance if (t-&gt;does_dispatch()) { #ifdef ASSERT // make sure execution doesn't go beyond this point if code is broken __ should_not_reach_here(); #endif // ASSERT } else { // dispatch to next bytecode __ dispatch_epilog(tos_out, step); } }</span></span></code> </pre> </div></div><br><p>     ,     .         JVM.       Java-    .       <a href="">JavaCalls</a> .     JVM  ,     <a href="">  main</a> . </p><br><h4 id="primer">  </h4><br><p>  ,        ,     : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sum</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String args[])</span></span></span></span>{ Sum.sum(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); } }</code> </pre> <br><p>         <code>Sum.sum(II)</code> . </p><br><p>   2  <code>javac -c *.java</code>    ,      . <br>  <code>Sum.sum</code> : </p><br><pre> <code class="plaintext hljs"> descriptor: (II)I flags: (0x0009) ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=2, args_size=2 0: iload_0 1: iload_1 2: iadd 3: ireturn LineNumberTable: line 3: 0</code> </pre> <br><p>  Main.main </p><br><pre> <code class="plaintext hljs"> descriptor: ([Ljava/lang/String;)V flags: (0x0009) ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=1, args_size=1 0: iconst_2 1: iconst_3 2: invokestatic #2 // Method Sum.sum:(II)I 5: pop 6: return LineNumberTable: line 13: 0 line 14: 6</code> </pre> <br><p>   ,          â€”      . </p><br><p>   <code>invokestatic</code> '  x86   -   HotSpot    <a href=""></a> </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> TemplateTable::invokestatic(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> byte_no) { transition(vtos, vtos); assert(byte_no == f1_byte, <span class="hljs-string"><span class="hljs-string">"use this argument"</span></span>); prepare_invoke(byte_no, rbx); <span class="hljs-comment"><span class="hljs-comment">// get f1 Method* // do the call __ profile_call(rax); __ profile_arguments_type(rax, rbx, rbcp, false); __ jump_from_interpreted(rbx, rax); }</span></span></code> </pre> <br><p> <code>byte_no == f1_byte</code> â€”   <code>ConstantPoolCache</code> ,    , <code>rbx</code> â€” ,      <code>Method *</code> .      :  , ,      ( <code>method_entry</code>    ). </p><br><p>   <code>prepare_invoke</code> .  ,     <code>invokestatic</code>    <code>ConstantPool</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>Constant_Methodref_Info</code></a> .   HotSpot    .  2      .. <a href=""><code>ConstantPoolCache</code></a> . <code>ConstantPoolCache</code>       ,    (,    <code>ConstantPoolCacheEntry</code>   ,      ).     <code>ConstantPoolCacheEntry</code> ,      (   0)        / .   ,         <code>ConstantPool</code> ,        <code>ConstantPoolCache</code>      ( x86 Little Endian). </p><br><p> , ,  HotSpot    <code>prepare_invoke</code> â€”     <code>ConstantPoolCache</code> .  ,   ,     <code>ConstantPoolCacheEntry</code>    </p><br><pre> <code class="cpp hljs"> __ get_cache_and_index_and_bytecode_at_bcp(Rcache, index, temp, byte_no, <span class="hljs-number"><span class="hljs-number">1</span></span>, index_size); __ cmpl(temp, code); <span class="hljs-comment"><span class="hljs-comment">// have we resolved this bytecode? __ jcc(Assembler::equal, resolved); // resolve first time through address entry = CAST_FROM_FN_PTR(address, InterpreterRuntime::resolve_from_cache); __ movl(temp, code); __ call_VM(noreg, entry, temp); // Update registers with resolved info __ get_cache_and_index_at_bcp(Rcache, index, 1, index_size); __ bind(resolved);</span></span></code> </pre> <br><p>  ,    <code>InterpreterRuntime::resolve_from_cache</code> . </p><br><p>       receiver'a   ,         .     (, ,  ,  <code>ConstantPoolCache</code>   <code>&lt;clinit&gt;</code> ,      ). <a href="">  </a>      define class,    <code>EagerInitialization</code> ( ,      ,           :)).     HotSpot   ( CDS  )     . </p><br><p>  ,         ,   <code>ConstantPoolCacheEntry</code>    .      <code>Method *</code>  <code>rbx</code> ,   ,         . </p><br><p>       <code>Sum.sum(2, 3)</code> .      gdb-script <code>sum.gdb</code> : </p><br><pre> <code class="plaintext hljs">#    java file /home/dmitrii/jdk12/build/linux-x86_64-server-fastdebug/images/jdk/bin/java # gdb    SEGV' #,   https://hg.openjdk.java.net/jdk/jdk12/file/06222165c35f/src/hotspot/cpu/x86/vm_version_x86.cpp#l361 handle SIGSEGV nostop noprint #       set breakpoint pending on #    , #    set pagination off #      main b PostJVMInit commands #   , #    set $buffer = malloc(1000) #   . #jmp       # invokestatic b *AbstractInterpreter::_entry_table[0] thread 2 commands #     invokestatic, # Method*   rbx set $mthd = (Method *) $rbx #    $buffer call $mthd-&gt;name_and_sig_as_C_string($buffer, 1000) if strcmp()($buffer, "Sum.sum(II)I") == 0 #  iload_0,     b *TemplateInterpreter::_normal_table._table[vtos][26] thread 2 #  iload_1,   - int,  #  iload_0 b *TemplateInterpreter::_normal_table._table[itos][27] thread 2 #   iadd b *TemplateInterpreter::_normal_table._table[itos][96] thread 2 end c end c end r -cp . Main</code> </pre><br><p>    <code>gdb -x sum.gdb</code> ,       <code>Sum.sum</code> </p><br><pre> <code class="plaintext hljs">$453 = 0x7ffff7fdcdd0 "Sum.sum(II)I"</code> </pre> <br><p>   <code>layout asm</code> ,    ,   <a href="">generate_normal_entry</a> .      -,  StackOverflow, stack-banging    dispatch    <code>iload_0</code>    .       : </p><br><pre> <code class="plaintext hljs">0x7fffd828fa1f mov eax,DWORD PTR [r14] ;, iload_0 0x7fffd828fa22 movzx ebx,BYTE PTR [r13+0x1] ;   0x7fffd828fa27 inc r13 ; bcp (byte code pointer) 0x7fffd828fa2a movabs r10,0x7ffff717e8a0 ; DispatchTable 0x7fffd828fa34 jmp QWORD PTR [r10+rbx*8] ;jump     </code> </pre> <br><p>        <code>rax</code> ,        </p><br><pre> <code class="plaintext hljs">0x7fffd828fabe push rax ;     ;   ,      0x7fffd828fabf mov eax,DWORD PTR [r14-0x8] 0x7fffd828fac3 movzx ebx,BYTE PTR [r13+0x1] 0x7fffd828fac8 inc r13 0x7fffd828facb movabs r10,0x7ffff717e8a0 0x7fffd828fad5 jmp QWORD PTR [r10+rbx*8]</code> </pre> <br><p>       <code>iadd</code> : </p><br><pre> <code class="plaintext hljs">0x7fffd8292ba7 mov edx,DWORD PTR [rsp] ; ,     iload_1 0x7fffd8292baa add rsp,0x8 ; rsp    0x7fffd8292bae add eax,edx ;   0x7fffd8292bb0 movzx ebx,BYTE PTR [r13+0x1] 0x7fffd8292bb5 inc r13 0x7fffd8292bb8 movabs r10,0x7ffff717e8a0 0x7fffd8292bc2 jmp QWORD PTR [r10+rbx*8]</code> </pre> <br><p>    <code>gdb</code>  <code>eax</code>  <code>edx</code>    ,    </p><br><pre> <code class="plaintext hljs">(gdb) p $eax $457 = 3 (gdb) p $edx $458 = 2</code> </pre> <br><p>       ,     <code>Sum.sum</code> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN469291/">https://habr.com/ru/post/zh-CN469291/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN469271/index.html">åºåˆ—åŒ–å’Œååºåˆ—åŒ–.NET Coreä¸Go Data</a></li>
<li><a href="../zh-CN469275/index.html">å°±åƒæˆ‘åœ¨18æ‰€ç¾å›½å¤§å­¦æ‰€åšçš„é‚£æ ·</a></li>
<li><a href="../zh-CN469277/index.html">è°æ˜¯DevOpsï¼Ÿ</a></li>
<li><a href="../zh-CN469287/index.html">ä»å¡ç‰‡ä¸Šæˆ˜æ–—é­”åƒã€‚ æˆ‘ä»¬å¦‚ä½•å°†æ¸¸æˆè½¬å˜ä¸ºParobot Card League</a></li>
<li><a href="../zh-CN469289/index.html">ä»€ä¹ˆæ˜¯äº¤æ˜“æ‰€çš„ä¿è¯é‡‘äº¤æ˜“ï¼Œå¦‚ä½•è¿ä½œ</a></li>
<li><a href="../zh-CN469295/index.html">â€œéŸ³é¢‘äººçš„å‘ç°â€ï¼šéŸ³ä¹é£æ ¼çš„æ ‘ï¼Œæ¥è‡ªGitHubäº‹ä»¶çš„æœ¨ç´ä»¥åŠå«æ˜Ÿå¹¿æ’­</a></li>
<li><a href="../zh-CN469299/index.html">å³æ—¶æŸ¥çœ‹ï¼Œå³æ—¶è®¿é—®</a></li>
<li><a href="../zh-CN469301/index.html">Agileanï¼šç²¾ç›Š+æ•æ·</a></li>
<li><a href="../zh-CN469303/index.html">Andrei Belyaevåœ¨jug.msk.ruä¼šè®®ä¸Šå…³äºJavaçš„åæ€</a></li>
<li><a href="../zh-CN469307/index.html">è°·æ­Œåšæœ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>