<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Ω üêª ‚ö°Ô∏è Assinatura qualificada do MacOS üë®‚Äçüè≠ üëáüèº üîâ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De acordo com a RBC e a Tensor , em 2019, 4,6 milh√µes de certificados de assinaturas eletr√¥nicas qualificadas (CEP) ser√£o emitidos na R√∫ssia que atend...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Assinatura qualificada do MacOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450516/"><img src="https://habrastorage.org/webt/ex/qt/fa/exqtfaem0qdki9aiaggndkwcpsc.png" align="left"><br><p>  De acordo com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RBC</a> e a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tensor</a> , em 2019, 4,6 milh√µes de certificados de assinaturas eletr√¥nicas qualificadas (CEP) ser√£o emitidos na R√∫ssia que atendem aos requisitos do 63-FZ.  Acontece que dos 8 milh√µes de IPs e LLCs registrados, todo segundo empres√°rio usa uma assinatura eletr√¥nica.  Al√©m dos CEPs para EGAIS e CEPs baseados na nuvem para enviar relat√≥rios emitidos por bancos e servi√ßos de contabilidade, os CEPs universais com tokens seguros s√£o de particular interesse.  Esses certificados permitem que voc√™ fa√ßa login em portais governamentais e assine quaisquer documentos, tornando-os legalmente significativos. </p><br><p>  Gra√ßas ao certificado CEP em um token USB, voc√™ pode concluir remotamente um contrato com uma contraparte ou um funcion√°rio remoto, enviar documentos ao tribunal;  registrar uma caixa registradora on-line, liquidar impostos em atraso e enviar uma declara√ß√£o em sua conta no nalog.ru;  descubra d√≠vidas e verifica√ß√µes futuras de servi√ßos p√∫blicos. </p><br><p>  O manual abaixo o ajudar√° a <strong>trabalhar com o CEP para macOS</strong> - sem estudar os f√≥runs do CryptoPro e instalar uma m√°quina virtual com o Windows. </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Conte√∫do</b> <div class="spoiler_text"><p>  <strong>O que voc√™ precisa para trabalhar com o CEP para macOS:</strong> </p><br><p>  <strong>Instale e configure o CEP para macOS</strong> </p><br><ol><li>  Instale o CryptoPro CSP </li><li>  Instale drivers Rootoken </li><li>  Instalar certificados <br>  3.1  Exclu√≠mos todos os certificados GOST antigos <br>  3.2  Instalar certificados raiz <br>  3.3  Fa√ßa o download dos certificados do centro de certifica√ß√£o <br>  3.4  Instale o certificado com Rutoken </li><li>  Instale o navegador especial Chromium-GOST </li><li>  Instalar extens√µes do navegador <br>  5.1 Plug-in do navegador CryptoPro EDS <br>  5.2  Plugin para servi√ßos governamentais <br>  5.3  Configurar um plugin para servi√ßos p√∫blicos <br>  5.4  Ativar extens√µes <br>  5.5  Configuramos a extens√£o do plug-in CryptoPro EDS Browser </li><li>  Verifique se tudo funciona. <br>  6.1  Vamos para a p√°gina de teste CryptoPro <br>  6.2  Entramos na conta pessoal em nalog.ru <br>  6.3  Vamos a servi√ßos p√∫blicos </li><li>  O que fazer se parar de funcionar </li></ol><br><p>  <strong>Alterar PIN do cont√™iner</strong> </p><br><ol><li>  Descobrimos o nome do container CEP </li><li>  Alterar comando PIN do terminal </li></ol><br><p>  <strong>Assinando arquivos no macOS</strong> </p><br><ol><li>  Descubra o hash do certificado CEP </li><li>  Assinando um arquivo com um comando do terminal </li><li>  Instalar script do Apple Automator </li></ol><br><p>  <strong>Verifique a assinatura no documento</strong> </p></div></div><br><p>  Todas as informa√ß√µes abaixo s√£o obtidas de fontes respeit√°veis ‚Äã‚Äã(CryptoPro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="># 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="># 2</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="># 3</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rutoken</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Corus-Consulting</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Minist√©rio das Comunica√ß√µes do Distrito Federal de Ural</a> ), e prop√µe-se baixar o software de sites confi√°veis.  O autor √© um consultor independente e n√£o √© afiliado a nenhuma das empresas mencionadas.  Seguindo estas instru√ß√µes, voc√™ assume toda a responsabilidade por quaisquer a√ß√µes e consequ√™ncias. </p><br><h2 id="chto-nuzhno-dlya-raboty-s-kep-pod-macos">  O que voc√™ precisa para trabalhar com o CEP para macOS: </h2><br><ol><li>  CEP <strong>no token USB Rutoken Lite</strong> ou <strong>Rutoken EDS</strong> </li><li>  cryptocontainer <strong>no formato CryptoPro</strong> </li><li>  com <strong>licen√ßa integrada para CryptoPro CSP</strong> </li><li>  certificado p√∫blico deve ser armazenado no cont√™iner de chave privada </li></ol><br><p>  As m√≠dias EToken e JaCarta em conjunto com o CryptoPro para macOS n√£o s√£o suportadas.  O transportador Rutoken Lite √© a melhor escolha, custa 500..1000 = rublos, funciona de forma inteligente e permite armazenar at√© 15 chaves. </p><br><p>  Os fornecedores de criptografia VipNet, Signal-COM e LISSI n√£o s√£o suportados no macOS.  Converter cont√™ineres n√£o funciona.  CryptoPro √© a melhor escolha, o custo do certificado deve ser de cerca de 1300 = rublos.  para SP e 1600 = esfregar.  para Yul. </p><br><p>  Normalmente, a licen√ßa anual do CryptoPro CSP j√° est√° conectada ao certificado e muitas CAs s√£o fornecidas gratuitamente.  Se n√£o for assim, voc√™ precisar√° comprar e ativar uma licen√ßa permanente para o CryptoPro CSP estritamente vers√£o 4 no valor de 2700 =.  Atualmente, o CryptoPro CSP vers√£o 5 para macOS n√£o funciona. </p><br><p>  Normalmente, um certificado p√∫blico √© armazenado em um cont√™iner de chave privada, mas isso precisa ser esclarecido ao emitir o CEP e solicitado a ser feito conforme necess√°rio.  Se n√£o funcionar, voc√™ pode importar a chave p√∫blica para o cont√™iner fechado usando o CryptoPro CSP for Windows. </p><br><h2 id="ustanavlivaem-i-nastraivaem-kep-pod-macos">  Instale e configure o CEP para macOS </h2><br><div class="spoiler">  <b class="spoiler_title">Coisas √≥bvias</b> <div class="spoiler_text"><ul><li>  todos os arquivos baixados s√£o baixados no diret√≥rio padr√£o: ~ / Downloads /; </li><li>  n√£o mudamos nada em todos os instaladores, deixamos tudo por padr√£o; </li><li>  se o macOS exibir um aviso de que o software que est√° sendo lan√ßado √© de um desenvolvedor desinstalado, voc√™ precisar√° confirmar o lan√ßamento nas configura√ß√µes do sistema: <em>Prefer√™ncias do Sistema -&gt; Seguran√ßa e Privacidade -&gt; Abrir de qualquer maneira</em> ; </li><li>  se o macOS solicitar uma senha de usu√°rio e permiss√£o para controlar o computador, voc√™ precisar√° digitar uma senha e concordar com tudo. </li></ul></div></div><br><h3 id="1-ustanavlivaem-kriptopro-csp">  1. Instale o CryptoPro CSP </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Registramos</a> no site CryptoPro e baixamos e instalamos a vers√£o do <em>CryptoPro CSP <strong>4.0 R4</strong></em> para <em>macOS</em> na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina de</a> <strong><a href="">download</a></strong> - <strong><a href="">download</a></strong> . </p><br><h3 id="2-ustanavlivaem-drayvery-rutoken">  2. Instale drivers Rootoken </h3><br><p>  O site diz que √© opcional, mas √© melhor entregar.  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina de download</a> no site da Rutoken, fa√ßa o download e instale o <em>KeyChain Support Module</em> - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">download</a></strong> . </p><br><p>  Em seguida, conecte o token usb, inicie o terminal e execute o comando: </p><br><pre><code class="bash hljs">/opt/cprocsp/bin/csptest -card -enum</code> </pre> <br><p>  A resposta deve ser: </p><br><blockquote>  Aktiv Rutoken ... <br>  Cart√£o presente ... <br>  [ErrorCode: 0x00000000] </blockquote><br><h3 id="3-ustanavlivaem-sertifikaty">  3. Instale certificados </h3><br><h4 id="31-udalyaem-vse-starye-gostovskie-sertifikaty">  3.1  Exclu√≠mos todos os certificados GOST antigos </h4><br><p>  Se anteriormente houve tentativas de executar o CEP no macOS, voc√™ deve limpar todos os certificados instalados anteriormente.  Esses comandos no terminal remover√£o apenas os certificados CryptoPro e n√£o afetar√£o os certificados comuns do Keychain no macOS. </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -delete -all -store mroot</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -delete -all -store uroot</code> </pre> <br><pre> <code class="bash hljs">/opt/cprocsp/bin/certmgr -delete -all</code> </pre> <br><p>  A resposta de cada comando deve ser: </p><br><blockquote>  Nenhum certificado corresponde aos crit√©rios </blockquote><p>  ou </p><br><blockquote>  Exclus√£o conclu√≠da </blockquote><br><h4 id="32-ustanavlivaem-kornevye-sertifikaty">  3.2  Instalar certificados raiz </h4><br><p>  Os certificados raiz s√£o comuns a todos os CEPs emitidos por qualquer autoridade de certifica√ß√£o.  Download na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina de download do</a> Minist√©rio das Comunica√ß√µes do Distrito Federal de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ural</a> : </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=4BC6DC14D97010C41A26E058AD851F81C842415A</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=8CAE88BBFD404A7A53630864F9033606E1DC45E2</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=0408435EB90E5C8796A160E69E4BFAC453435D1D</a> </li></ul><br><p>  Instale os seguintes comandos no terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/4BC6DC14D97010C41A26E058AD851F81C842415A.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/8CAE88BBFD404A7A53630864F9033606E1DC45E2.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/0408435EB90E5C8796A160E69E4BFAC453435D1D.cer</code> </pre> <br><p>  Cada equipe deve retornar: </p><br><blockquote>  Instalando: <br>  ... <br>  [ErrorCode: 0x00000000] </blockquote><br><h4 id="33-skachivaem-sertifikaty-udostoveryayuschego-centra">  3.3  Fa√ßa o download dos certificados do centro de certifica√ß√£o </h4><br><p>  Em seguida, voc√™ precisa instalar os certificados da autoridade de certifica√ß√£o onde emitiu o CEP.  Normalmente, os certificados raiz de cada CA est√£o localizados em seu site na se√ß√£o de download. </p><br><p>  Como alternativa, os certificados de qualquer CA podem ser baixados no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site do Distrito Federal Ural do Minist√©rio das Comunica√ß√µes</a> .  Para fazer isso, no formul√°rio de pesquisa, voc√™ precisa encontrar a CA por nome, acessar a p√°gina com certificados e fazer o download de todos <strong>os</strong> certificados <strong>v√°lidos</strong> - ou seja, aqueles cuja segunda data ainda n√£o chegou ao campo <em>'V√°lido'</em> .  Fa√ßa o download do link no campo <em>'Impress√£o'</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/k6/xx/q4/k6xxq4czjusuqkbsqols_hbliei.png"></p><br><p><img src="https://habrastorage.org/webt/dt/oc/tw/dtoctw3qxq3qr6sbusinltnei2y.png"></p></div></div><br><p>  No exemplo do CA Corus Consulting: √© necess√°rio fazer o download de 4 certificados na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina de download</a> : </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=15EB064ABCB96C5AFCE22B9FEA52A1964637D101</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=B9F1D3F78971D48C34AA73786CDCD138477FEE3F</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=55EC48193B6716D38E80BD9D1D2D827BC8A07DE3</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=A0D19D700E2A5F1CAFCE82D3EFE49A0D882559DF</a> </li></ul><br><p>  Instalamos os certificados CA baixados com os comandos do terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/B9F1D3F78971D48C34AA73786CDCD138477FEE3F.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/A0D19D700E2A5F1CAFCE82D3EFE49A0D882559DF.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/55EC48193B6716D38E80BD9D1D2D827BC8A07DE3.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/15EB064ABCB96C5AFCE22B9FEA52A1964637D101.cer</code> </pre> <br><p>  onde ap√≥s <em>~ / Downloads /</em> s√£o os nomes dos arquivos baixados, para cada CA eles ser√£o diferentes. </p><br><p>  Cada equipe deve retornar: </p><br><blockquote>  Instalando: <br>  ... <br>  [ErrorCode: 0x00000000] </blockquote><br><h4 id="34-ustanavlivaem-sertifikat-s-rutoken">  3.4  Instale o certificado com Rutoken </h4><br><p>  Comando no terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptestf -absorb -certs</code> </pre> <br><p>  A equipe deve retornar: </p><br><blockquote>  OK <br>  [ErrorCode: 0x00000000] </blockquote><br><h4 id="35-konfiguriruem-cryptopro-dlya-raboty-ssertifikatami-gost-r-3410-2012">  3.5  Configure o CryptoPro para funcionar com certificados GOST R 34.10-2012 </h4><br><p>  Para funcionar corretamente no nalog.ru com certificados emitidos desde 2019, as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instru√ß√µes</a> no site do CryptoPro recomendam: </p><br><p>  Comandos no terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/sbin/cpconfig -ini <span class="hljs-string"><span class="hljs-string">'\cryptography\OID\1.2.643.7.1.1.1.1!3'</span></span> -add string <span class="hljs-string"><span class="hljs-string">'Name'</span></span> <span class="hljs-string"><span class="hljs-string">'GOST R 34.10-2012 256 bit'</span></span></code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/sbin/cpconfig -ini <span class="hljs-string"><span class="hljs-string">'\cryptography\OID\1.2.643.7.1.1.1.2!3'</span></span> -add string <span class="hljs-string"><span class="hljs-string">'Name'</span></span> <span class="hljs-string"><span class="hljs-string">'GOST R 34.10-2012 512 bit'</span></span></code> </pre> <br><p>  As equipes n√£o retornam nada. </p><br><h3 id="4-ustanavlivaem-specialnyy-brauzer-chromium-gost">  4. Instale o navegador especial Chromium-GOST </h3><br><p>  Para trabalhar com portais governamentais, voc√™ precisa de uma montagem especial do navegador <strong>Chromium</strong> - <strong>Chromium-GOST</strong> .  O c√≥digo fonte do projeto est√° aberto, um link para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio no GitHub √©</a> fornecido no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site do CryptoPro</a> .  De acordo com a experi√™ncia, outros navegadores <em>CryptoFox</em> e <em>Yandex.Browser</em> n√£o s√£o adequados para trabalhar com portais governamentais do macOS.  Vale a pena considerar que, em algumas montagens do Chromium-GOST, a conta pessoal no nalog.ru pode congelar ou o pergaminho para de funcionar completamente, portanto, √© <strong>proposto</strong> o antigo <strong>assembly</strong> comprovado <strong>71.0.3578.98</strong> - <strong><a href="">download</a></strong> . </p><br><p>  Fa√ßa o download e descompacte o arquivo morto, instale o navegador copiando ou arraste e solte no diret√≥rio Aplicativos.  Ap√≥s a instala√ß√£o, feche com for√ßa o Chromium-Gost com um comando do terminal e ainda n√£o o abra (trabalhamos no Safari): </p><br><pre> <code class="bash hljs">killall Chromium-Gost</code> </pre> <br><h3 id="5-ustanavlivaem-rasshireniya-dlya-brauzera">  5. Instale extens√µes do navegador </h3><br><h4 id="51-kriptopro-ecp-browser-plug-in">  5.1 Plug-in do navegador CryptoPro EDS </h4><br><p>  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina de download</a> no site da CryptoPro, fa√ßa o download e instale o <em>plug-in CryptoPro EDS Browser vers√£o 2.0 para usu√°rios</em> - fa√ßa o <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">download</a></strong> . </p><br><h4 id="52-plagin-dlya-gosuslug">  5.2  Plugin para servi√ßos governamentais </h4><br><p>  Na <a href="">p√°gina de download</a> no portal Gosuslug, fa√ßa o download e instale o <em>Plugin para trabalhar com o portal de servi√ßos governamentais (vers√£o para macOS)</em> - <strong><a href="">download</a></strong> . </p><br><h4 id="53-nastraivaem-plagin-dlya-gosuslug">  5.3  Configurar um plugin para servi√ßos p√∫blicos </h4><br><p>  Fa√ßa o download do arquivo de configura√ß√£o correto para a extens√£o dos servi√ßos governamentais para dar suporte ao macOS e novas assinaturas digitais no <strong><a href="">download</a></strong> padr√£o do GOST2012. </p><br><p>  Executamos comandos no terminal: </p><br><pre> <code class="bash hljs">sudo rm /Library/Internet\ Plug-Ins/IFCPlugin.plugin/Contents/ifc.cfg</code> </pre> <br><pre> <code class="bash hljs">sudo cp ~/Downloads/ifc.cfg /Library/Internet\ Plug-Ins/IFCPlugin.plugin/Contents</code> </pre> <br><pre> <code class="bash hljs">sudo cp /Library/Google/Chrome/NativeMessagingHosts/ru.rtlabs.ifcplugin.json /Library/Application\ Support/Chromium/NativeMessagingHosts</code> </pre> <br><h4 id="54-aktiviruem-rasshireniya">  5.4  Ativar extens√µes </h4><br><p>  Iniciamos o navegador Chromium-Gost e, na barra de endere√ßos, digitamos: </p><br><pre> <code class="plaintext hljs">chrome://extensions/</code> </pre> <br><p>  Inclu√≠mos as duas extens√µes instaladas: </p><br><ul><li>  Extens√£o CryptoPro para plug-in de navegador CAdES </li><li>  Extens√£o para plug-in de servi√ßos p√∫blicos </li></ul><br><div class="spoiler">  <b class="spoiler_title">Captura de tela</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/7b/qz/0-/7bqz0-z9zmnua0q7xs9qdcr63ak.png"></p></div></div><br><h4 id="55-nastraivaem-rasshirenie-kriptopro-ecp-browser-plug-in">  5.5  Configuramos a extens√£o do plug-in CryptoPro EDS Browser </h4><br><p>  Na barra de endere√ßo do Chromium-Gost, digite: </p><br><pre> <code class="plaintext hljs">/etc/opt/cprocsp/trusted_sites.html</code> </pre> <br><p>  Na p√°gina exibida, adicionamos os sites √† lista de sites confi√°veis, por sua vez: </p><br><pre> <code class="plaintext hljs">https://*.cryptopro.ru https://*.nalog.ru https://*.gosuslugi.ru</code> </pre> <br><p>  Clique em "Salvar".  Um dado verde deve aparecer: </p><br><blockquote>  A lista de sites confi√°veis ‚Äã‚Äãfoi salva com sucesso. </blockquote><br><div class="spoiler">  <b class="spoiler_title">Captura de tela</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wy/xx/5h/wyxx5hsubwkvcxtw-luvoregeng.png"></p></div></div><br><h3 id="6-proveryaem-chto-vse-rabotaet">  6. Verifique se tudo funciona </h3><br><h4 id="61-zahodim-na-testovuyu-stranicu-kriptopro">  6.1  Vamos para a p√°gina de teste CryptoPro </h4><br><p>  Na barra de endere√ßo do Chromium-Gost, digite: </p><br><pre> <code class="plaintext hljs">https://www.cryptopro.ru/sites/default/files/products/cades/demopage/cades_bes_sample.html</code> </pre> <br><p>  ‚ÄúPlugin carregado‚Äù deve ser exibido e seu certificado deve estar na lista abaixo. <br>  Selecione um certificado da lista e clique em "Assinar".  O PIN do certificado ser√° solicitado.  O resultado deve ser exibido </p><br><blockquote>  Assinatura gerada com sucesso </blockquote><br><div class="spoiler">  <b class="spoiler_title">Captura de tela</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/v9/id/m_/v9idm_5w3mnwdcucyt5edpyhceo.png"></p></div></div><br><h4 id="62-zahodim-v-lichnyy-kabinet-na-nalogru">  6.2  Entramos na conta pessoal em nalog.ru </h4><br><p>  Pode n√£o ser poss√≠vel seguir os links do site nalog.ru, porque  as verifica√ß√µes n√£o ser√£o aprovadas.  Voc√™ precisa ir para links diretos: </p><br><ul><li>  Conta pessoal <strong>IP</strong> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://lkipgost.nalog.ru/lk</a> </li><li>  Conta pessoal da <strong>entidade legal</strong> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://lkul.nalog.ru</a> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Captura de tela</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/fn/2f/gf/fn2fgfejidrtpokh3xdlap4j0ny.png"></p></div></div><br><h4 id="63-zahodim-na-gosuslugi">  6.3  Vamos a servi√ßos p√∫blicos </h4><br><p>  Durante a autoriza√ß√£o, selecione "Entrar usando uma assinatura eletr√¥nica".  Na lista exibida, "Selecione um certificado para uma chave de verifica√ß√£o de assinatura eletr√¥nica", todos os certificados ser√£o exibidos, incluindo raiz e CA. Voc√™ precisa selecionar o seu no token usb e inserir o PIN. </p><br><div class="spoiler">  <b class="spoiler_title">Captura de tela</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/k1/il/ie/k1iliepylyukk20xl-e_ooj4ab0.png"></p><br><p><img src="https://habrastorage.org/webt/gi/ex/hf/giexhftwmegvxgj_k4bahsn7sz4.png"></p></div></div><br><h3 id="7-chto-delat-esli-perestalo-rabotat">  7. O que fazer se parar de funcionar </h3><br><ol><li><p>  Reconectamos o token usb e verificamos se ele √© vis√≠vel usando o comando no terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/csptest -card -enum</code> </pre> <br></li><li><p>  Limpamos o cache do navegador o tempo todo, digitando a barra de endere√ßo do Chromium-Gost: </p><br><pre> <code class="plaintext hljs"> chrome://settings/clearBrowserData</code> </pre> <br></li><li><p>  Reinstale o certificado CEP usando o comando no terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptestf -absorb -certs</code> </pre> <br></li></ol><br><h2 id="smena-pin-koda-konteynera">  Alterar PIN do cont√™iner </h2><br><p>  O c√≥digo PIN padr√£o para Rutoken √© <em>12345678</em> e voc√™ n√£o pode deix√°-lo como tal.  Requisitos para o c√≥digo PIN Rootoken: m√°ximo de 16 caracteres, pode conter letras e n√∫meros latinos. </p><br><h3 id="1-vyyasnyaem-nazvanie-konteynera-kep">  1. Descubra o nome do cont√™iner CEP </h3><br><p>  No token usb e em outros armazenamentos, v√°rios certificados podem ser armazenados, e voc√™ precisa escolher o certo.  Com o token usb inserido, obtemos uma lista de todos os cont√™ineres no sistema com o comando no terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptest -keyset -enum_cont -fqcn -verifycontext</code> </pre> <br><p>  A equipe deve trazer pelo menos 1 cont√™iner e devolver </p><br><blockquote>  [ErrorCode: 0x00000000] </blockquote><p>  O cont√™iner que precisamos √© do formato </p><br><blockquote>  \. \ Aktiv Rutoken lite \ XXXXXXXX </blockquote><p>  Se houver v√°rios cont√™ineres, significa que v√°rios certificados est√£o gravados no token e voc√™ est√° ciente de qual deles √© necess√°rio.  O valor <em>XXXXXXXX</em> ap√≥s a barra precisa ser copiado e substitu√≠do no comando abaixo. </p><br><h3 id="2-smena-pin-komandoy-iz-terminal">  2. Altere o comando PIN do terminal </h3><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptest -passwd -qchange -container <span class="hljs-string"><span class="hljs-string">"XXXXXXXX"</span></span></code> </pre> <br><p>  onde <em>XXXXXXXX</em> √© o nome do cont√™iner obtido na etapa 1 (obrigat√≥rio entre aspas). </p><br><p>  Uma caixa de di√°logo CryptoPro aparecer√° solicitando o c√≥digo PIN antigo para acessar o certificado e, em seguida, outra caixa de di√°logo para inserir um novo c√≥digo PIN.  Feito. </p><br><div class="spoiler">  <b class="spoiler_title">Captura de tela</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xh/fr/9i/xhfr9imuu1gh-uxgvekeqleptyw.png"></p></div></div><br><h2 id="podpis-faylov-v-macos">  Assinando arquivos no macOS </h2><br><p>  No macOS, os arquivos podem ser assinados no software <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CryptoArm</a> (custo da licen√ßa 2500 = rublos) ou com um simples comando atrav√©s do terminal - de gra√ßa. </p><br><h3 id="1-vyyasnyaem-hesh-sertifikata-kep">  1. Descubra o hash do certificado CEP </h3><br><p>  Pode haver v√°rios certificados no token e em outros armazenamentos.  √â necess√°rio identificar exclusivamente aquele com quem continuaremos assinando documentos.  √â feito uma vez. <br>  O token deve ser inserido.  N√≥s obtemos a lista de certificados nos reposit√≥rios usando o comando do terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/certmgr -list</code> </pre> <br><p>  A equipe deve exibir pelo menos 1 certificado do formul√°rio: </p><br><blockquote>  Certmgr 1.1 ¬© "Crypto-Pro", 2007-2018. <br>  programa para gerenciar certificados, CRLs e lojas <br>  = = = = = = = = = = = = = = = = = = = = = = <br>  1 ------- <br>  Emissor: E = help @ esphere.ru, ... CN = KORUS Consulting CIS LLC ... <br>  Assunto: E = sergzah @ gmail.com, ... CN = Zakharov Sergey Anatolyevich ... <br>  Serial: 0x0000000000000000000000000000000000000000 <br>  Hash SHA1: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX <br>  ... <br>  Cont√™iner: SCARD \ rutoken_lt_00000000 \ 0000 \ 0000 <br>  ... <br>  = = = = = = = = = = = = = = = = = = = = = = <br>  [ErrorCode: 0x00000000] </blockquote><p>  O certificado que precisamos no par√¢metro Container deve ter um valor no formato <em>SCARD \ rutoken ....</em>  Se houver v√°rios certificados com esses valores, isso significa que v√°rios certificados est√£o gravados no token e voc√™ est√° ciente de qual deles precisa.  O valor do par√¢metro <em>SHA1 Hash</em> (40 caracteres) deve ser copiado e substitu√≠do no comando abaixo. </p><br><h3 id="2-podpis-fayla-komandoy-iz-terminal">  2. Assinando um arquivo com um comando do terminal </h3><br><p>  No terminal, v√° para o diret√≥rio com o arquivo para assinar e execute o comando: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/cryptcp -signf -detach -cert -der -strict -thumbprint  FILE</code> </pre> <br><p>  onde <em> ...</em> √© o hash do certificado obtido na etapa 1 e <em>FILE</em> √© o nome do arquivo a ser assinado (com todas as extens√µes, mas sem um caminho). </p><br><p>  A equipe deve retornar: </p><br><blockquote>  A mensagem assinada √© criada. <br>  [ErrorCode: 0x00000000] </blockquote><p>  Um arquivo de assinatura eletr√¥nica com a extens√£o * .sgn ser√° criado - esta √© uma assinatura desconectada no formato CMS com codifica√ß√£o DER. </p><br><h3 id="3-ustanovka-apple-automator-script">  3. Instale o script do Apple Automator </h3><br><p>  Para n√£o trabalhar com o terminal de cada vez, voc√™ pode instalar o Automator Script uma vez, com o qual √© poss√≠vel assinar documentos no menu de contexto do Finder.  Para fazer isso, baixe o arquivo - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">download</a></strong> . </p><br><ol><li>  Descompacte o arquivo <em>'Sign with CryptoPro.zip'</em> </li><li>  Launch <em>Automator</em> </li><li>  Localize e abra o arquivo descompactado <em>'Sign with CryptoPro.workflow'</em> </li><li>  No bloco <em>Run Shell Script</em> , <em>alteramos</em> o texto <em></em> para o valor do par√¢metro <em>SHA1 Hash</em> do certificado CEP obtido acima. </li><li>  Salve o script: ‚åòCommand + S </li><li>  Execute o arquivo <em>'Sign with CryptoPro.workflow'</em> e confirme a instala√ß√£o. </li><li>  V√° para <em>Prefer√™ncias do</em> sistema <em>-&gt; Extens√µes -&gt; Localizador</em> e verifique se a a√ß√£o r√°pida <em>Assinar com CryptoPro</em> est√° marcada. </li><li>  No Finder, chame o menu de contexto de qualquer arquivo e, na se√ß√£o <em>A√ß√µes R√°pidas</em> e / ou <em>Servi√ßos</em> , selecione <strong>Assinar com CryptoPro</strong> </li><li>  Na caixa de di√°logo CryptoPro exibida, digite o PIN do usu√°rio no CEP </li><li>  Um arquivo com a extens√£o * .sgn aparecer√° no diret√≥rio atual - uma assinatura desconectada no formato CMS com codifica√ß√£o DER. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><p>  Janela do Apple Automator: <br><img src="https://habrastorage.org/webt/ci/md/am/cimdamgbcmuwupqnikoxm4zlr0u.png"></p><br><p>  Prefer√™ncias do sistema: <br><img src="https://habrastorage.org/webt/ds/aj/4y/dsaj4ybkjxfuc72-ujruj0jor1c.png"></p><br><p>  Localizador do menu de contexto: </p><br><p><img src="https://habrastorage.org/webt/n5/sz/8y/n5sz8ylptnlud2tdd3o4pvkvqk4.png"></p></div></div><br><h2 id="proverit-podpis-na-dokumente">  Verifique a assinatura no documento </h2><br><p>  Se o conte√∫do do documento n√£o contiver segredos e segredos, a maneira mais f√°cil √© usar o servi√ßo da web no portal Gosuslug - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.gosuslugi.ru/pgu/eds</a> .  Assim, voc√™ pode tirar uma captura de tela de um recurso autorizado e ter certeza de que est√° tudo bem com uma assinatura. </p><br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/8u/8m/rk/8u8mrkglxf7z5nzdxmo4f7nj66k.png"></p><br><p><img src="https://habrastorage.org/webt/63/7p/od/637pod0rngetfm1nudyyse-3h2q.png"></p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt450516/">https://habr.com/ru/post/pt450516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt450504/index.html">Como criar um aplicativo a partir do site e coloc√°-lo no Google Play em algumas horas. Parte 1/2: Aplicativo Web Progressivo</a></li>
<li><a href="../pt450506/index.html">Como criar um aplicativo a partir do site e coloc√°-lo no Google Play em algumas horas. Parte 2/2: Atividade confi√°vel na Web</a></li>
<li><a href="../pt450508/index.html">Joe Armstrong sobre Elixir, Erlang, FP e OOP</a></li>
<li><a href="../pt450510/index.html">Cinco problemas nos processos de opera√ß√£o e suporte dos sistemas de TI Highload</a></li>
<li><a href="../pt450514/index.html">CVT vs state</a></li>
<li><a href="../pt450518/index.html">Arduino e Processamento. Como controlar um microcontrolador atrav√©s de uma porta COM. Comunica√ß√£o em dois sentidos</a></li>
<li><a href="../pt450520/index.html">Criando uma IA confi√°vel e verificada: conformidade com as especifica√ß√µes, treinamento confi√°vel e verifica√ß√£o formal</a></li>
<li><a href="../pt450522/index.html">Internet History: Decay, Parte 1</a></li>
<li><a href="../pt450524/index.html">Controle de computador via Telegram</a></li>
<li><a href="../pt450526/index.html">10. Ponto de verifica√ß√£o Introdu√ß√£o R80.20. Consci√™ncia da identidade</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>