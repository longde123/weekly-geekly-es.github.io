<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∞üèΩ üìª ü§¶üèª Como fazer uma muleta para a Tinkoff Investments com suas pr√≥prias m√£os ou notifica√ß√µes de a√ß√µes necess√°rias para obter lucros / perdas üë©üèº‚Äç‚öñÔ∏è üßëüèº üë©üèº‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Existe um corretor desse tipo - o Tinkoff Bank. E h√° um problema no fato de que, no momento, esse corretor n√£o possui ordens de lucro / stop loss. Por...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como fazer uma muleta para a Tinkoff Investments com suas pr√≥prias m√£os ou notifica√ß√µes de a√ß√µes necess√°rias para obter lucros / perdas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442734/"> Existe um corretor desse tipo - o Tinkoff Bank.  E h√° um problema no fato de que, no momento, esse corretor n√£o possui ordens de lucro / stop loss.  Portanto, se voc√™ deseja negociar de forma mais ativa, precisa criar algum tipo de solu√ß√£o tempor√°ria, enquanto nas profundezas dos programadores de Tinkoff est√£o desenvolvendo um recurso matador, obt√©m lucro / stop loss e, sob esse corte, √© um deles. <br>  <b>atualiza√ß√£o:</b> 22/03/2019, O corretor lan√ßou a vers√£o principal 3.0.0 no Google Play, na qual o lucro / stop loss ainda aparecia. <br><a name="habracut"></a><br>  Por que eu decidi escrever este artigo aqui?  Pareceu-me que o Tinkoff Bank e seus produtos s√£o bastante populares entre as pessoas de TI, e talvez algu√©m tenha a mesma necessidade, mas n√£o h√° desejo ou tempo para andar de bicicleta.  Portanto, eu compartilho o meu. <br><br>  Para come√ßar - sobre as oportunidades alternativas oferecidas pelo pr√≥prio corretor. <br>  Primeiro, Tinkoff tem pedidos limitados que apareceram em fevereiro de 2019 (eles esperaram dois anos, sem brincadeiras!), Mas eles trabalham em um dia e, pior ainda, em um pequeno intervalo de dinheiro, o que cria inconvenientes no mercado vol√°til.  √â simplesmente imposs√≠vel definir valores menores (mais) que um determinado limite calculado a partir das cota√ß√µes atuais.  Bem, provavelmente √© imposs√≠vel definir mais de um pedido limite (quando tento salvar o primeiro pedido, o aplicativo m√≥vel sempre falha, mas o site n√£o possui essa funcionalidade). <br>  Segundo, dentro do aplicativo m√≥vel, voc√™ pode assinar uma altera√ß√£o de pre√ßo definindo um limite absoluto ou limite para uma altera√ß√£o percentual (aumentar ou diminuir), mas √© poss√≠vel definir um e apenas um limite por ativo. <br><br>  A l√≥gica da minha bicicleta √© simples: <br>  1) temos limiares (doravante - limiares) para nossa seguran√ßa (ativo), nos quais devemos ter uma a√ß√£o manual de realizar lucro / parar perda.  Os limites s√£o calculados independentemente, com base no pre√ßo de compra do ativo; <br>  2) precisamos analisar os dados do pre√ßo atual do ativo de algum lugar; <br>  3) envie a si mesmo um aviso se um dos limites tiver sido atingido. <br>  Apesar da descri√ß√£o direta, h√° nuances na implementa√ß√£o :) <br><br>  1) Embora meu portf√≥lio consistisse em um ativo, registrei os limites diretamente no corpo do script, e a pesquisa em papel foi feita n√£o apenas uma vari√°vel, mas simplesmente uma linha m√°gica.  M√° decis√£o, mas o suficiente para testar a ideia.  Como a carteira diversificou, criei um arquivo de onde os t√≠tulos s√£o carregados, as trocas nas quais s√£o negociados e os valores-limite. <br><br>  2) Como meu ativo era uma garantia estrangeira negociada na Bolsa de S√£o Petersburgo, primeiro decidi analisar os dados do site da Bolsa de S√£o Petersburgo na seguinte p√°gina: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">spbexchange.ru/ru/market-data/Default.aspx</a> <br>  A classifica√ß√£o na Bolsa de Valores de S√£o Petersburgo ocorre de acordo com o volume de negocia√ß√µes, e minha seguran√ßa sempre esteve na primeira p√°gina.  Funcionou muito bem, mas no dia 8 de mar√ßo tudo quebrou.  Por alguma raz√£o, o TSLA j√° estava na p√°gina 25 e o paginador carrega os dados dinamicamente atrav√©s do JS.  Esse problema pode ser resolvido "de frente": analisando todas as p√°ginas at√© encontrarmos nosso ativo.  Mas essa abordagem n√£o √© muito eficaz, se considerarmos o tempo de execu√ß√£o do loop de script.  Em vez disso, decidi adicionar a an√°lise do tradingview.com.  N√£o h√° necessidade de vasculhar listas longas em mais p√°ginas.  L√°, cada ativo tem algo como este link: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.tradingview.com/symbols/NASDAQ-TSLA</a> <br>  Pareceu-me que tudo deveria come√ßar de forma r√°pida e simples, mas havia um problema - os dados de interesse para mim s√£o carregados por meio do JS e os Pedidos habituais n√£o conseguiam lidar com isso. <br>  Esse problema tem tr√™s solu√ß√µes que eu conhe√ßo: <br>  PyQT, sel√™nio (webdriver) e a extens√£o Solicita√ß√µes-HTML.  Como eu j√° tinha solicita√ß√µes no projeto, foi decidido usar sua pr√≥pria extens√£o. <br>  Infelizmente, esta solu√ß√£o n√£o funcionou muito est√°vel, tive que procurar solu√ß√µes. <br><pre><code class="python hljs">session = HTMLSession() r = session.get(url) my = r.html.render(timeout=<span class="hljs-number"><span class="hljs-number">30</span></span>) selector = <span class="hljs-string"><span class="hljs-string">'span.tv-symbol-header-quote__value.tv-symbol-header-quote__value--large.js-symbol-last'</span></span> price = r.html.find(selector)[<span class="hljs-number"><span class="hljs-number">0</span></span>].text r.close() session.close()</code> </pre> <br>  Observe o tempo limite, bem como as chamadas para o m√©todo close ().  Eles n√£o s√£o encontrados em todos os exemplos, mas funciona melhor com eles do que sem eles. <br><br>  3) Registramos um servi√ßo que pode enviar SMS (sms.ru), pegar sua API, criar uma chave.  At√© 5 SMS por dia - gratuitamente.  O suficiente para mim. <br>  A chave fica assim: <br>  24A41EA5-EEEE-Priv-5555-094143C2EDDD <br>  e o envio de SMS nas primeiras vers√µes foi implementado assim: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mymessage)</span></span></span><span class="hljs-function">:</span></span> sms_url = <span class="hljs-string"><span class="hljs-string">'https://sms.ru/sms/send?api_id=key&amp;to=number&amp;msg=message&amp;json=1'</span></span> sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'key'</span></span>, mykey) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'number'</span></span>, mynumber) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, mymessage) sms_response = requests.get(sms_url)</code> </pre> <br><br>  Durante o desenvolvimento, surgiu a seguinte pergunta: o que fazer se j√° tivermos enviado um SMS ao usu√°rio sobre a ultrapassagem do limite?  Embora n√£o houvesse cheques, ele enviou o SMS novamente.  Toda vez.  Rapidamente "comeu" o limite gratuito e come√ßou a pensar no que fazer com ele.  Eu tive que adicionar um contador de SMS enviado (sms_counter), que verificamos antes de chamar send_message. <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> sms_counter sms_counter = sms_counter + <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><br>  Outra pergunta ser√° rastreada: excelente, durante o preg√£o, processamos uma passagem de limiar com um determinado ativo, e isso nos conv√©m.  O que fazer para a pr√≥xima sess√£o de negocia√ß√£o?  Foi decidido redefinir o contador do SMS enviado.  Havia tr√™s op√ß√µes: armazenar dados no banco de dados (mas atualmente tenho um aplicativo sem estado), analisar hora / data ou reiniciar o script.  At√© agora, estou fazendo a terceira op√ß√£o, mas no futuro passarei para a segunda ou primeira op√ß√£o. <br><br>  Agora a solu√ß√£o j√° est√° operacional e pode ser baixada no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Github</a> <br>  Para usu√°rios que n√£o entendem o que √© Python e como configur√°-lo, sugiro tentar iniciar uma <a href="">solu√ß√£o</a> empacotada <a href="">para Windows</a> <br><br>  Planos para um maior desenvolvimento: <br>  1) analisar data / hora, para redefinir o contador de SMS (em vez de reiniciar o script); <br>  2) agora √© um aplicativo sem estado, mas pretendo danificar o banco de dados; <br>  3) ap√≥s o item 2, quero adicionar o rastreamento de saltos acentuados no aumento / diminui√ß√£o do pre√ßo, em rela√ß√£o ao pre√ßo de fechamento do dia anterior; <br>  4) expandir as oportunidades de "comunica√ß√£o": mais caminhos (Telegram, Viber, chamadas de voz, outras op√ß√µes) e provedores (pretendo adicionar smsc.ru, pois o sms.ru √†s vezes perde a capacidade de resposta e, embora envie SMS, mas o script n√£o √© executado at√© chegarmos a sms_response). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt442734/">https://habr.com/ru/post/pt442734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt442722/index.html">Interromper o download e o armazenamento de zeros</a></li>
<li><a href="../pt442724/index.html">O filme ‚ÄúOffice Space‚Äù tem 20 anos: como mudou nossos empregos</a></li>
<li><a href="../pt442726/index.html">O rob√¥ de chita do MIT pode fazer back flips e correr r√°pido</a></li>
<li><a href="../pt442730/index.html">Microsoft: R√∫ssia est√° √† frente dos EUA e da Europa na implementa√ß√£o de intelig√™ncia artificial</a></li>
<li><a href="../pt442732/index.html">My Little Relays: Triple Brainfuck, ou o que √© loucura</a></li>
<li><a href="../pt442736/index.html">6 jogos de tabuleiro para nivelar o ingl√™s</a></li>
<li><a href="../pt442738/index.html">Cria√ß√£o de perfil e rastreio com perf</a></li>
<li><a href="../pt442740/index.html">Engenharia reversa de formato bin√°rio usando arquivos SNG Korg como exemplo. Parte 2</a></li>
<li><a href="../pt442742/index.html">Notebook Compaq LTE 5000, parte dois e meio - b√¥nus</a></li>
<li><a href="../pt442744/index.html">Solu√ß√£o RIPE e suas consequ√™ncias para a exclus√£o de dois LIRs russos (Netup, gcxc.net)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>