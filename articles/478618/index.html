<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ö´Ô∏è ‚ÅâÔ∏è üë©üèø‚Äçüåæ School of Magic PHP üç¶ üé∂ ü•ñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øQu√© es la magia en PHP? Esto generalmente significa m√©todos como _construct() o __get() . Los m√©todos m√°gicos en PHP son lagunas que ayudan a los des...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>School of Magic PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/478618/"> ¬øQu√© es la magia en PHP?  Esto generalmente significa m√©todos como <code>_construct()</code> o <code>__get()</code> .  Los m√©todos m√°gicos en PHP son lagunas que ayudan a los desarrolladores a hacer cosas incre√≠bles.  La red est√° llena de instrucciones para usarlas, con las cuales probablemente est√© familiarizado.  Pero, ¬øy si decimos que ni siquiera has visto la verdadera magia?  Despu√©s de todo, cuanto m√°s te parezca que lo sabes todo, m√°s magia se te escapa. <br><br><img src="https://habrastorage.org/webt/kd/xp/vm/kdxpvmeklgs6av1hp8ldzbnq4vc.jpeg"><br><br>  Dejemos caer el marco establecido de las reglas de OOP y hagamos lo imposible posible en la escuela de magia de PHP.  El principal y primer maestro m√°gico de la escuela es <b>Alexander Lisachenko</b> ( <a href="https://habr.com/ru/users/nighttiger/" class="user_link">NightTiger</a> ).  Ense√±ar√° pensamiento m√°gico y quiz√°s le encantar√°n los m√©todos m√°gicos, las formas no est√°ndar de acceder a las propiedades, los contextos cambiantes, la programaci√≥n orientada a aspectos y los filtros de flujo. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1W3UR7v3sAo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <b>Alexander Lisachenko</b> es el jefe del departamento de desarrollo web y arquitectura en Alpari.  El autor y desarrollador principal del marco orientado a aspectos <a href="http://go.aopphp.com/">Go!</a>  <a href="http://go.aopphp.com/">Aop</a>  Ponente en conferencias internacionales sobre PHP. <br><br>  En la buena pel√≠cula "La ilusi√≥n del enga√±o" hay una frase: <br><blockquote>  "Cuanto m√°s cerca est√°s, menos ves". </blockquote><br>  Lo mismo puede decirse de PHP, como un truco de magia que le permite hacer cosas inusuales.  Pero antes que nada, fue creado para enga√±arte: "... una acci√≥n que pretende enga√±ar, ya sea como una forma de enga√±ar a alguien, o como una broma o una forma de entretenimiento". <br><br>  Si tomamos PHP juntos y tratamos de escribir algo m√°gico en √©l, lo m√°s probable es que te enga√±e.  Har√© alg√∫n truco y te preguntar√°s durante mucho tiempo por qu√© sucede esto.  Eso es porque PHP es un lenguaje de programaci√≥n conocido por sus cosas inusuales. <br><br><h2>  Equipo m√°gico </h2><br>  ¬øQu√© necesitamos del equipo m√°gico?  M√©todos dolorosamente familiares. <br><br> <code>__construct(), __destruct(), __clone(), <br> __call(), __callStatic(), <br> __get(), __set(), __isset(), __unset(), <br> __sleep(), __wakeup(), <br> __toString(), __invoke(), __set_state(), <br> __debugInfo()</code> <br> <br>  Notar√© el √∫ltimo m√©todo por separado: con √©l puedes poner en marcha cosas inusuales.  Pero eso no es todo. <br><br><ul><li>  <code>declare(ticks=1)</code> . <br></li><li>  <code>debug_backtrace()</code> .  Este es nuestro compa√±ero para comprender d√≥nde estamos en el c√≥digo actual, para ver qui√©n nos llam√≥ y por qu√©, con qu√© argumentos.  √ötil para decidir no seguir toda la l√≥gica. <br></li><li>  <code>unset(), isset()</code> .  Parece que nada especial, pero estos dise√±os esconden muchos trucos, que consideraremos m√°s a fondo. <br></li><li>  <code>by-reference passing</code> .  Cuando pasamos alg√∫n objeto o variable por referencia, deber√≠amos esperar que algo de magia te suceda inevitablemente. <br></li><li>  <code>bound closures</code> .  Sobre los cierres y el hecho de que se pueden unir, puedes construir muchos trucos. <br></li><li>  Reflection API ayuda a llevar la reflexi√≥n a un nuevo nivel. <br></li><li>  StreamWrapper API. <br></li></ul><br>  El equipo est√° listo. Recordar√© la primera regla de la magia. <br><br><blockquote>  S√© siempre el chico m√°s listo de la sala. </blockquote><br><h2>  Truco # 1.  Comparaci√≥n imposible </h2><br>  Comencemos con el primer truco, al que llamo Comparaci√≥n imposible. <br>  Observe de cerca el c√≥digo y vea si esto puede suceder en PHP. <br><br><img src="https://habrastorage.org/webt/ji/sd/8i/jisd8ip2pzz7kx9otvdxq8_c-k4.png"><br><br>  Hay una variable, declaramos su valor y, de repente, no es igual a s√≠ misma. <br><br><h3>  No es un n√∫mero </h3><br>  Existe un artefacto m√°gico como NaN - No es un n√∫mero. <br><br><img src="https://habrastorage.org/webt/gf/fw/3b/gffw3bl5rfz8xz1br3ut9ocmhnw.jpeg"><br><br>  Su caracter√≠stica sorprendente es que no es igual a s√≠ mismo.  Y este es nuestro primer truco: usar NaN para confundir a un amigo.  Pero NaN no es la √∫nica soluci√≥n para esta tarea. <br><br><h3>  Utilizamos constantes </h3><br><img src="https://habrastorage.org/webt/7c/hd/l1/7chdl1uranfz-cg9lbhc078ipnq.jpeg"><br><br>  El truco es que podemos declarar <code>false</code> como <code>true</code> para el <code>namespace</code> de <code>namespace</code> y comparar.  El desafortunado desarrollador se preguntar√° durante mucho tiempo por qu√© hay algo <code>true</code> y no <code>false</code> . <br><br><h3>  Manejador </h3><br>  El siguiente truco es una artiller√≠a m√°s poderosa que las dos opciones anteriores.  Veamos como funciona. <br><br><img src="https://habrastorage.org/webt/xj/3g/5j/xj3g5jvenlytadytgnqth9yb47c.jpeg"><br><br>  El truco se basa en <code>tick_function</code> y, como mencion√©, <code>declare(ticks=1)</code> . <br><br>  ¬øC√≥mo funciona todo fuera de la caja?  Primero, declaramos alguna funci√≥n, y por referencia toma el par√°metro <code>isMagic</code> , y luego trata de cambiar este valor a <code>true</code> .  Despu√©s de declarar <code>declare(ticks=1)</code> , el int√©rprete PHP llama a <code>register_tick_function</code> - callback despu√©s de cada operaci√≥n elemental.  En esta devoluci√≥n de llamada, podemos cambiar el valor que anteriormente era <code>false</code> a <code>true</code> .  La magia! <br><br><h2>  Truco # 2.  Expresiones m√°gicas </h2><br>  Tome un ejemplo en el que se declaran dos variables.  Uno de ellos es <code>false</code> , el otro es <code>true</code> .  Hacemos <code>isBlack</code> e <code>isWhite</code> y var_dump el resultado.  ¬øCu√°l crees que ser√° el resultado? <br><br><img src="https://habrastorage.org/webt/yy/5r/kx/yy5rkxfp5zdicpodqjrutq1diri.png"><br><br>  <b>Operadores prioritarios</b> .  La respuesta correcta es <code>false</code> , porque en PHP existe una ‚Äúprecedencia de operador‚Äù. <br><br><img src="https://habrastorage.org/webt/tm/8e/uf/tm8eufef1fi8j46c3fc3xbgl1z8.jpeg"><br><br>  Sorprendentemente, el operador l√≥gico <code>or</code> menos prioridad que la operaci√≥n de asignaci√≥n.  Por lo tanto, simplemente se asigna la asignaci√≥n de <code>false</code> .  En <code>isWhite</code> puede haber cualquier otra expresi√≥n que se ejecutar√° si falla la primera parte. <br><br><h3>  Expresiones m√°gicas </h3><br>  Echa un vistazo al c√≥digo a continuaci√≥n.  Hay alguna clase que contiene el constructor, y alguna f√°brica, cuyo c√≥digo ser√° m√°s adelante. <br><br><img src="https://habrastorage.org/webt/bk/md/w5/bkmdw5zdb6bxcpml7jzygu9vjhs.jpeg"><br><br>  Presta atenci√≥n a la √∫ltima l√≠nea. <br><br><pre> <code class="php hljs">$value = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $factory-&gt;build(Foo::class);</code> </pre> <br>  Hay varias opciones que pueden suceder. <br><br><ul><li>  <code>$factory</code> se usar√° como el nombre de clase <code>new</code> ; <br></li><li>  habr√° un error de an√°lisis; <br></li><li>  se usar√° la llamada <code>$factory-&gt;build()</code> , cuyo valor devolver√° esta funci√≥n, el resultado ser√° <code>new</code> ; <br></li><li>  el valor de la propiedad <code>$factory-&gt;build</code> se usar√° para construir la clase. <br></li></ul><br>  Veamos la √∫ltima idea.  En la clase <code>$factory</code> , declaramos una serie de funciones m√°gicas.  Escribir√°n lo que hacemos: llamar a la propiedad, llamar al m√©todo o incluso intentar <code>invoke</code> en el objeto. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Getting property {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name, $arg)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Calling method {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Invoking {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} }</code> </pre> <br>  La respuesta correcta: no estamos llamando a un m√©todo, sino a una propiedad.  Despu√©s de <code>$factory-&gt;build</code> hay un par√°metro para el constructor, que pasaremos a esta clase. <br><br>  Por cierto, en este marco he implementado una caracter√≠stica llamada "interceptar la creaci√≥n de nuevos objetos": puede "bloquear" este dise√±o. <br><br><h3>  Escapatoria del analizador </h3><br>  El siguiente ejemplo es para el analizador PHP en s√≠.  ¬øAlguna vez has intentado llamar a funciones o asignar variables dentro de llaves? <br><br><img src="https://habrastorage.org/webt/wi/b5/kb/wib5kbzb1j_0gzdurptouztvb7u.jpeg"><br><br>  Tengo este truco en Twitter, funciona extremadamente no est√°ndar. <br><br><pre> <code class="php hljs">$result = ${<span class="hljs-string"><span class="hljs-string">'_'</span></span> . !$_=getCallback()}(); $_=getCallback(); <span class="hljs-comment"><span class="hljs-comment">// string(5) "hello" !$_=getCallback()}(); // bool(false) '_'.!$_=getCallback()}(); // string(1) "_" ${'_'.!$_=getCallback()}(); // string(5) "hello"</span></span></code> </pre> <br>  Primero, asignamos el valor de la expresi√≥n a la variable llamada <code>_</code> (gui√≥n bajo).  Ya tenemos una variable, tratamos de invertir l√≥gicamente su valor y obtenemos <code>false</code> : la l√≠nea se convierte como <code>true</code> .  Luego lo pegamos todo en el nombre de la variable, a trav√©s del cual giramos dentro de las llaves. <br><br><blockquote>  Que es la magia  Este es un entretenimiento que nos permite sentirnos inspirados, inusuales, decir: ‚Äú¬øQu√©?  ¬øEntonces fue posible? ‚Äù </blockquote><br><h2>  Truco # 3.  Rompiendo las reglas </h2><br>  Lo que me gusta de PHP es que puedes romper las reglas que todos crean en un intento de ser s√∫per seguro.  Hay un dise√±o llamado "clase sellada" que tiene un constructor privado.  Su tarea como estudiante del mago es crear una instancia de esta clase. <br><br><img src="https://habrastorage.org/webt/rt/uw/h4/rtuwh49inyhecfbsbea1hvb6kq4.jpeg"><br><br>  Considere tres opciones sobre c√≥mo hacer esto. <br><br><h3>  Soluci√≥n alternativa </h3><br>  La primera forma es la m√°s obvia.  Debe ser familiar para todos los desarrolladores: esta es la API est√°ndar que nos ofrece el lenguaje. <br><br><img src="https://habrastorage.org/webt/w2/or/df/w2ordfmqdhs3qg-nnzbff9yiilc.png"><br><br>  La construcci√≥n <code>newInstanceWithoutConstructor</code> permite omitir las restricciones de idioma de que el constructor es privado y crear una instancia de la clase sin pasar por todas nuestras declaraciones de constructor privado. <br><br>  La opci√≥n est√° funcionando, simple, no requiere ninguna explicaci√≥n. <br><br><h3>  Cortocircuito </h3><br>  La segunda opci√≥n requiere m√°s atenci√≥n y habilidad.  Se crea una funci√≥n an√≥nima, que luego se une al √°guila pescadora de esa clase. <br><br><img src="https://habrastorage.org/webt/2z/6k/lz/2z6klzhpzlkbcglexaslmiu9ezo.png"><br><br>  Aqu√≠ estamos dentro de la clase y podemos llamar con seguridad a m√©todos privados.  Usamos esto llamando <code>new static</code> desde el contexto de nuestra clase. <br><br><img src="https://habrastorage.org/webt/fn/v5/ul/fnv5ulkueuayx56vd07u7tfk128.png"><br><br><h3>  Deserializaci√≥n </h3><br>  La tercera opci√≥n es la m√°s avanzada, en mi opini√≥n. <br><br><img src="https://habrastorage.org/webt/ky/qi/xb/kyqixbfapmoxxaisd6g3mlypuny.png"><br><br>  Si escribe una l√≠nea espec√≠fica en un formato espec√≠fico, sustituya ciertos valores all√≠; nuestra clase resultar√°. <br><br><img src="https://habrastorage.org/webt/d2/0k/fi/d20kfibw1fnqmmovhc90_mqb1sy.png"><br><br>  Despu√©s de la deserializaci√≥n, obtenemos nuestra <code>instance</code> . <br><br><h3>  paquete de doctrina / instanciador </h3><br>  La magia a menudo se convierte en un marco documentado o biblioteca, por ejemplo, en <b>doctrina / instanciador,</b> todo esto se implementa.  Podemos crear cualquier objeto con cualquier c√≥digo. <br><br><pre> <code class="plaintext hljs">composer show doctrine/instantiator --all name : doctrine/instantiator descrip. : A small, lightweight utility to instantiate objects in PHP without invoking their constructors keywords : constructor, instantiate type : library license : MIT License (MIT)</code> </pre> <br><h2>  Truco # 4.  Interceptar el acceso a la propiedad </h2><br>  Las nubes se est√°n acumulando: la clase es secreta, las propiedades y el constructor son privados, y tambi√©n la devoluci√≥n de llamada. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Secret</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $secret = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Secret is: '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;secret; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPropAccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Accessing property {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">100500</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">// How to create a secret instance and intercept the secret value?</span></span></code> </pre> <br>  Nuestra tarea, como magos, es de alguna manera llamar a una devoluci√≥n de llamada. <br><br><h3>  Agregando la magia ... getter </h3><br>  Agrega una pizca de magia para que funcione. <br><br><img src="https://habrastorage.org/webt/p7/ut/2w/p7ut2w699vysx99jnvmxvr0akfy.png"><br><br>  Esta pizca de magia es un <code>getter</code> m√°gico.  Llama a una funci√≥n, y hasta ahora no ha sucedido nada terrible.  Pero usaremos el truco anterior y crearemos una instancia de este objeto sin pasar por la construcci√≥n privada. <br><br><img src="https://habrastorage.org/webt/b0/oy/gu/b0oyguiksznuw3rzfn19rsz1s4y.jpeg"><br><br>  Ahora necesitamos llamar de alguna manera a la devoluci√≥n de llamada. <br><br><h3>  "Desarmado" dentro del circuito </h3><br>  Para hacer esto, cree un cierre.  Dentro del cierre que est√° dentro del alcance de la clase, eliminamos esta variable con la funci√≥n <code>unset()</code> . <br><br><img src="https://habrastorage.org/webt/-n/2l/md/-n2lmdkswrc0cgk6tcobilajlgk.jpeg"><br><br>  <code>unset</code> permite excluir temporalmente una variable, lo que permitir√° <code>get</code> a nuestro m√©todo magic <code>get</code> . <br><br><h3>  Llamamos al constructor privado </h3><br>  Como tenemos un constructor privado que muestra <code>echo</code> , puede obtener este constructor, hacerlo accesible llam√°ndolo. <br><br><img src="https://habrastorage.org/webt/1z/-g/vo/1z-gvohztwjnrbeujkiwecxdowi.jpeg"><br><br>  Entonces nuestra clase secreta se desmoron√≥ en pedazos. <br><br><img src="https://habrastorage.org/webt/om/cv/ef/omcvefwmkjdrmnvuepdf3mmvf5k.png"><br><br>  Recibimos un mensaje que nosotros: <br><br><ul><li>  interceptado <br></li><li>  devolvi√≥ algo completamente diferente. <br></li></ul><br><h3>  paquete leedavis / altr-ego </h3><br>  Mucha magia ya est√° documentada.  El paquete <b>altr-ego</b> solo pretende ser tu componente. <br><br><pre> <code class="plaintext hljs">composer show leedavis81/altr-ego --all name : leedavis81/altr-ego descrip. : Access an objects protected / private properties and methods keywords : php, break scope versions : dev-master, v1.0.2, v1.0.1, v1.0.0 type : library license : MIT License (MIT)</code> </pre> <br>  Puede crear uno de sus objetos y adjuntarle un segundo.  Esto permitir√° cambios en la instalaci√≥n.  √âl cambiar√° obedientemente y cumplir√° todos tus deseos. <br><br><h2>  Truco # 5.  Objetos inmutables en PHP </h2><br>  ¬øHay objetos inmutables en PHP?  S√≠, y mucho, mucho tiempo. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Magic</span></span> { $<span class="hljs-title"><span class="hljs-title">object</span></span> = (<span class="hljs-title"><span class="hljs-title">object</span></span>) [ "\0<span class="hljs-title"><span class="hljs-title">Secret</span></span>\0<span class="hljs-title"><span class="hljs-title">property</span></span>" =&gt; '<span class="hljs-title"><span class="hljs-title">test</span></span>' ]; var_dump($object); }</code> </pre> <br>  Solo cons√≠guelos de una manera interesante.  Lo interesante es que creamos una matriz que tiene una <b>clave especial</b> .  Comienza con la construcci√≥n <code>\0</code> : este es un car√°cter de cero bytes, y despu√©s de <code>Secret</code> tambi√©n vemos <code>\0</code> . <br><br>  La construcci√≥n se usa en PHP para declarar una propiedad privada dentro de una clase.  Si intentamos lanzar un objeto a una matriz, veremos las mismas claves.  No tendremos m√°s que <code>stdClass</code> .  Contiene una propiedad privada de la clase <code>Secret</code> , que es igual a <code>test</code> . <br><br><pre> <code class="php hljs">object(stdClass) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-string"><span class="hljs-string">'property'</span></span> (Secret) =&gt; string <span class="hljs-string"><span class="hljs-string">'test'</span></span> (length=<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre> <br>  El √∫nico problema es que no puede obtener esta propiedad desde all√≠.  Est√° creado, pero no est√° disponible. <br><br>  Pens√© que era bastante inconveniente: tenemos objetos inmutables, pero no puedes usarlo.  Por lo tanto, decid√≠ que era hora de presentar mi decisi√≥n.  Utilic√© todo mi conocimiento y magia que est√° disponible en PHP para crear una construcci√≥n basada en todos nuestros trucos de magia. <br><br>  <b>Comencemos con uno simple: cree un DTO</b> e intente interceptar todas las propiedades que contiene (consulte el truco anterior). <br><br>  <b>Guardamos en un lugar seguro los valores</b> que capturamos desde all√≠.  Ser√°n inaccesibles por cualquier m√©todo: ni <code>reflection</code> , ni cierres, ni otra magia.  Pero hay incertidumbre: ¬øexiste tal lugar en PHP que garantice guardar algunas variables para que ning√∫n programador joven astuto llegue all√≠? <br><br>  <b>Proporcionamos un m√©todo m√°gico</b> para que pueda leer este valor.  Para hacer esto, tenemos <code>isset</code> m√°gicos, m√©todos m√°gicos que nos permiten proporcionar API. <br><br>  Volvamos a un lugar confiable e intentemos buscar. <br><br><ul><li>  <code>Global variables</code> cancelan; cualquiera puede cambiarlas. <br></li><li>  <code>Public properties</code> tampoco <code>Public properties</code> adecuadas. <br></li><li>  <code>Protected properties</code> m√°s o menos, porque la clase secundaria pasar√°. <br></li><li>  <code>Private properties</code>  No hay confianza, porque a trav√©s del cierre o la <code>reflection</code> se puede cambiar. <br></li><li>  Se pueden probar <code>Private static properties</code> , pero la <code>reflection</code> tambi√©n se rompe. <br></li></ul><br>  Parece que no hay ning√∫n lugar para ocultar los valores de las variables.  Pero hab√≠a algo m√°gico: <code>Static variables in functions</code> , estas son variables que est√°n dentro de las funciones. <br><br><h3>  Almacenamiento seguro de valores </h3><br>  Le pregunt√© a <b>Nikita Popov</b> y <b>Jay Watkins</b> sobre esto en el canal especial Stack Overflow. <br><br><img src="https://habrastorage.org/webt/dz/lg/ev/dzlgevsl3qi9lwbi91sjwladbpu.png"><br><br>  Esta es una funci√≥n dentro de la cual se declara una variable est√°tica.  ¬øEs posible salir de alguna manera, cambiarlo?  La respuesta es no. <br><br>  Hemos encontrado un peque√±o vac√≠o en el otro mundo de variables protegidas y queremos usarlo. <br><br><h3>  Paso de valores por enlace </h3><br>  Lo usaremos de manera no est√°ndar como una propiedad del objeto.  Pero no puede pasar una propiedad, por lo que usamos la transferencia cl√°sica de valores por referencia. <br><br><img src="https://habrastorage.org/webt/xr/qe/vn/xrqevnya2a0a8mizylf8gbimfb8.jpeg"><br><br>  Resulta que hay una clase en la que hay un m√©todo m√°gico <code>callStatic</code> , y la variable <code>Static</code> se declara en √©l.  En cualquier llamada a alguna funci√≥n, pasamos el valor de la variable del objeto Inmutable por referencia a todos nuestros m√©todos anidados.  Entonces, de alguna manera proporcionamos contexto. <br><br><h3>  Guardar estado </h3><br>  Veamos c√≥mo se guarda el estado. <br><br><img src="https://habrastorage.org/webt/ef/5j/tm/ef5jtmjn0yuws-_nkbegq0neqag.png"><br><br>  Es muy simple  Para el objeto transferido, usamos la funci√≥n <code>spl_object_id</code> , que devuelve un identificador separado para cada instancia.  El <code>State</code> que ya obtuvimos del objeto est√° tratando de guardar all√≠.  Nada especial <br><br><h3>  Aplicar el estado del objeto </h3><br>  Aqu√≠ de nuevo hay una construcci√≥n para pasar valores por referencia y propiedades no <code>unset</code> .  Desarmamos todas las propiedades actuales, habi√©ndolas guardado previamente en la variable <code>State</code> , y configuramos este contexto para el objeto.  El objeto ya no contiene ninguna propiedad, sino solo su identificador, que se declara usando <code>spl_object_id</code> y se adjunta a este objeto mientras a√∫n est√° vivo. <br><br><img src="https://habrastorage.org/webt/tl/gp/b9/tlgpb9z5yi8ibnwqmod_kifacrq.jpeg"><br><br><h3>  Obtener estado </h3><br>  Entonces todo es simple. <br><br><img src="https://habrastorage.org/webt/2n/om/aq/2nomaqdui4jxeusbrlzucow9dck.png"><br><br>  Obtenemos este contexto en el <code>getter</code> m√°gico y llamamos a nuestra propiedad desde √©l.  Ahora nadie ni nada puede cambiar el valor despu√©s de que este <code>Trait</code> conectado. <br><br><img src="https://habrastorage.org/webt/m7/iu/_y/m7iu_yazwpqoc4hxhlg6rv4srbo.png"><br><br>  Todos los m√©todos m√°gicos se anulan e implementan la inmutabilidad del objeto. <br><br><img src="https://habrastorage.org/webt/jy/he/ht/jyheht4ncrsuwsh7ngerdnd5x4m.jpeg"><br><br><h3>  lisachenko / objeto inmutable </h3><br>  Como se esperaba, todo se formaliza inmediatamente en la biblioteca y est√° listo para usar. <br><br><pre> <code class="plaintext hljs">composer show /immutable-object --all name : /immutable-object descrip. : Immutable object library keywords : versions : * dev-master type : library license : MIT License (MIT)</code> </pre> <br>  La biblioteca se ve bastante simple.  Lo conectamos y creamos nuestra clase.  Tiene diferentes propiedades: privadas, protegidas y p√∫blicas.  Conectamos <code>ImmutableTrait</code> . <br><br><img src="https://habrastorage.org/webt/xj/gt/pe/xjgtpettshurwn257f51iaj5u78.jpeg"><br><br>  Despu√©s de eso, puede iniciar el objeto una vez, ver su valor.  Realmente se guarda all√≠ e incluso parece un verdadero DTO. <br><br><pre> <code class="php hljs">object (MagicObject) [<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; int <span class="hljs-number"><span class="hljs-number">200</span></span></code> </pre> <br>  Pero si tratamos de cambiarlo, por ejemplo, as√≠ ... <br><br><img src="https://habrastorage.org/webt/su/s2/dh/sus2dhhps9ts4gwpx5nxk9301m4.jpeg"><br><br>  ... entonces inmediatamente recibo una <code>fatal exception</code> .  No podemos cambiar una propiedad porque es inmutable.  ¬øC√≥mo es eso? <br><br><img src="https://habrastorage.org/webt/sh/iy/1c/shiy1cl8vmbfmwzbmah8whsbnyu.png"><br><br>  Si te involucras en un desaf√≠o emocionante e intentas degradarlo, obtienes lo siguiente. <br><br><img src="https://habrastorage.org/webt/ga/ym/l6/gayml6qurl3mr1o6qpvhzk1_rgi.png"><br><br>  Este es mi regalo  Tan pronto como intente fallar dentro de PHPStorm dentro de esta clase, se detendr√° instant√°neamente la ejecuci√≥n de su comando.  No quiero que profundices en este c√≥digo, es demasiado peligroso.  √âl advertir√° que no hay nada que hacer. <br><br><h2>  Truco # 6.  Procesamiento de hilos </h2><br>  Considera el dise√±o. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'php://filter/read=string.toupper/resource=magic.php'</span></span>;</code> </pre> <br>  Hay algo m√°gico: un filtro PHP, <code>read</code> , al final <b>est√° conectado</b> alg√∫n tipo de <b>archivo</b> magic.php.  Este archivo parece bastante simple. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Hello, world!'</span></span></code> </pre> <br>  Tenga en cuenta que el caso es diferente.  Sin embargo, si "llenamos" el archivo a trav√©s de nuestro dise√±o, obtenemos esto: <br><br><pre> <code class="php hljs">HELLO, WORLD!</code> </pre> <br>  ¬øQu√© pas√≥ en ese momento?  El uso de la construcci√≥n del filtro PHP en <code>include</code> permite conectar cualquier filtro, incluido el suyo, para analizar el c√≥digo fuente.  Est√° administrando todo en este c√≥digo fuente.  Puede eliminar el <code>final</code> de las clases y los m√©todos, hacer p√∫blicas las propiedades, cualquier cosa que pueda analizar. <br><br>  Parte de mi marco de aspecto se basa en esto.  Cuando su clase est√° conectada, la analiza y la transforma en lo que se ejecutar√°. <br><br>  Fuera de la caja en PHP ya hay un mont√≥n de filtros listos para usar. <br><br><pre> <code class="php hljs">var_dump(stream_get_filters()); <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (size=<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'zlib.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'bzip2.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'convert.iconv.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">' string.rotl3'</span></span> (length=<span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.toupper'</span></span> (length=<span class="hljs-number"><span class="hljs-number">14</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.tolower'</span></span> (length=<span class="hljs-number"><span class="hljs-number">14</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.strip_tags'</span></span> (length=<span class="hljs-number"><span class="hljs-number">17</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'convert.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'consumed'</span></span> (length=<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'dechunk'</span></span> (length=<span class="hljs-number"><span class="hljs-number">7</span></span>)</code> </pre> <br>  Le permiten "comprimir" el contenido, traducirlo a may√∫sculas o min√∫sculas. <br><br>  Los principales trucos que quer√≠a mostrar han terminado.  Ahora pasemos a la quintaesencia de todo lo que puedo hacer: programaci√≥n orientada a aspectos. <br><br><h2>  Truco # 7.  Programaci√≥n Orientada a Aspectos </h2><br>  Mire este c√≥digo y piense si es bueno o malo desde su punto de vista. <br><br><img src="https://habrastorage.org/webt/xx/za/wa/xxzawap4whyavczg4g5ptvsx6q0.jpeg"><br><br>  El c√≥digo parece ser bastante adecuado.  Comprueba los derechos de acceso, realiza el registro, crea un usuario, persiste, intenta detectar <code>exception</code> . <br><br>  Si observa todos estos fideos, se repite en cada uno de nuestros m√©todos, y lo √∫nico valioso aqu√≠ es que est√° marcado en verde. <br><br><img src="https://habrastorage.org/webt/uk/za/mo/ukzamorqli1-u6wijf7d7knpwu4.jpeg"><br><br>  Todo lo dem√°s: "preocupaciones secundarias" o "preocupaciones transversales" es una funcionalidad transversal. <br><br>  La OOP convencional hace que sea imposible copiar todas estas estructuras con copiar y pegar, eliminarlas y sacarlas en alguna parte.  Esto es malo porque tienes que repetirlo.  Deseo que el c√≥digo siempre se vea limpio y ordenado. <br><br><img src="https://habrastorage.org/webt/hg/vw/pm/hgvwpmdhsbhaeeh0uj5tdngunqo.jpeg"><br><br>  Para que no contenga registro (deje que se aplique de alguna manera) y no contenga <code>security</code> . <br><br><img src="https://habrastorage.org/webt/yz/-4/i2/yz-4i2yxrju_ti0839xg7idj5ua.jpeg"><br><br>  Eso es todo, incluido el registro ... <br><br><img src="https://habrastorage.org/webt/sb/g1/8u/sbg18ud79gi4fg2dhc4h__ojxie.jpeg"><br><br>  ... y un control de seguridad, ... <br><br><img src="https://habrastorage.org/webt/3p/-s/07/3p-s07k5zl65ze55vxs4iddkia8.jpeg"><br><br>  ... realizado por s√≠ mismo. <br><br>  Y es posible. <br><br><h3>  Glosario "Aspecto" </h3><br>  Hay una cosa llamada Aspecto.  Este es un ejemplo simple que verifica los permisos.  Gracias a √©l, puedes ver algunas anotaciones, que tambi√©n se resaltan con el complemento para PhpStorm.  "Aspecto" declara expresiones SQL a los puntos del c√≥digo para aplicar esta condici√≥n.  A continuaci√≥n, por ejemplo, queremos aplicar un cierre a todos los m√©todos p√∫blicos de la clase <code>UserService</code> . <br><br><img src="https://habrastorage.org/webt/jx/y_/g4/jxy_g4pvoli4gjezfp3w1vqpkpi.jpeg"><br><br>  Obtenemos el cierre utilizando el m√©todo de <code>$invocation</code> . <br><br><img src="https://habrastorage.org/webt/ym/ju/mp/ymjump3eozldipcvntd-lpo9zbi.jpeg"><br><br>  Este es alg√∫n tipo de contenedor sobre el m√©todo de <code>reflection</code> , que contiene m√°s argumentos. <br><br>  Adem√°s en esta devoluci√≥n de llamada para cada m√©todo, puede verificar los derechos de acceso necesarios, esto se llama el "Consejo". <br><br><img src="https://habrastorage.org/webt/i8/zz/pq/i8zzpqsvck05an3amyc8hihxj00.jpeg"><br><br>  Decimos el lenguaje: "Estimado PHP, aplique este m√©todo antes de cada llamada al m√©todo p√∫blico desde la clase <code>UserService</code> " <code>UserService</code>  Solo una l√≠nea, pero muy √∫til. <br><br><h3>  Aspecto vs oyente de eventos </h3><br>  Para hacerlo m√°s claro, hice una comparaci√≥n de Aspect con Event Listener.  Muchos trabajan en Symfony y saben qu√© es Event Dispatcher. <br><br><img src="https://habrastorage.org/webt/5v/8o/ge/5v8oge0pczc4pteufmb0bvxf-da.jpeg"><br><br>  Son similares en el sentido de que pasamos alg√∫n tipo de dependencia, por ejemplo, <code>AutorizationChecker</code> , y declaramos d√≥nde aplicar en este caso.  En el caso de Listener, este es un <code>SubscrabingEvent</code> llamado <code>UserCreate</code> , y en el caso de <code>Aspect</code> nos suscribimos a todas las llamadas a m√©todos p√∫blicos desde el <code>UserService</code> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al mismo tiempo, el contenido del controlador de devoluci√≥n de llamada en s√≠ es aproximadamente el mismo: simplemente verificamos algo y reaccionamos en consecuencia. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Considere c√≥mo funciona todo bajo el cap√≥. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El primer paso</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que requiere un marco de aspecto es el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registro</font></font></b> <code>Aspects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/-i/ae/iy/-iaeiyqqw4oar3tyxzbe4au38n8.jpeg"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Segunda etapa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Para manejar esto, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utiliza nuevamente el </font><b><font style="vertical-align: inherit;">truco</font></b><font style="vertical-align: inherit;"> anterior </font><b><font style="vertical-align: inherit;">con el filtro PHP</font></b><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/6z/sq/da/6zsqda5rxa9alxpilq57s0wyspc.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este es un componente especial que convierte el c√≥digo fuente. </font><font style="vertical-align: inherit;">Lo hace en secreto, pero funcionar√° bien en la producci√≥n, porque est√° integrado con OPcache. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La tercera etapa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Todo est√° integrado en un nivel </font></font><code>Composer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Una vez que Go est√° instalado! </font><font style="vertical-align: inherit;">AOP, comienza a comunicarse estrechamente con</font></font><code>Composer</code>    ,    . <br><br><img src="https://habrastorage.org/webt/or/v8/l9/orv8l9yh9swl-mxtzowmrzoomm4.jpeg"><br><br>         <code>Aspects</code> ,   <code>Aspects</code> .       . <br><br>     . <br><br> <b>PHP-Parser</b> .     ,   ,      <b></b> . ,      <b> </b> ,  <a href="https://github.com/nikic/PHP-Parser">PHP-Parser</a> .           . <br><br><img src="https://habrastorage.org/webt/eg/ys/dm/egysdmlqf0bbvkmnacewmrrx-bw.jpeg"><br><br> <b> </b> .     ,   <b>goaop/parser-reflection</b> . <br><br><img src="https://habrastorage.org/webt/b_/oc/6d/b_oc6dfphlk-dtq3jxoijxzmn3i.jpeg"><br><br>    AST-      ,     .    ,        ,       ,       . <br><br>      . <br><br><img src="https://habrastorage.org/webt/9p/lu/an/9pluanmjyprlie0muf8sndyudba.jpeg"><br><br> ,         ,     <code>Aspect</code> . <br><br><img src="https://habrastorage.org/webt/3u/36/3z/3u363ztvggoi6ugvvsunvuilvuy.jpeg"><br><br>            ,     . <br><br><img src="https://habrastorage.org/webt/7z/tv/8p/7ztv8pyc8zti-wlpidlp3fm2zqk.jpeg"><br><br>    ,             ,       .      ‚Äî     ,   -   ,      . <br><br><img src="https://habrastorage.org/webt/ea/o9/zn/eao9znftd3ywdjzd14acr-9w-fe.png"><br><br>      ,    .      ,   . <br><br>      Aspect MOCK.   ¬´¬ª,      ,   .     . <br><br>       ‚Äî   <code>joinPoint</code> .   -    <code>joinPoint</code> :  ,   ,    . <br><br><h3>  Que sigue </h3><br>    . <br><br> <b>OPcache preloading for AOP Core</b> .  AOP-      .          10   . Bootstrapping     ,       PHP. <br><br> <b>FFI integration to modify binary opcodes</b> . ,    ,    .     PHP-opcodes,        <code>.bin</code> .   FFI  . <br><br> <b>Modifying PHP engine internal callbacks</b>   PHP-   userland.  PHP   .   FFI  PHP     userland,       , , .     . <br><br>    ,   . <br><br><h2>  #8. goaop/framework </h2><br>   ,   <a href="https://github.com/goaop/framework"> GitHub</a>       . <br><br><pre> <code class="plaintext hljs">composer show goaop/framework --all name : goaop/framework descrip. : Framework for aspect-oriented programming in PHP. keywords : php, aop, library, aspect versions : dev-master, 3.0.x-dev, 2.x-dev, 2.3.1, ‚Ä¶ type : library license : MIT License</code> </pre> <br>    ,        PhpStorm. <br><br><img src="https://habrastorage.org/webt/ut/ah/rp/utahrp4yrgxj7ch2d0brjr_p7fk.jpeg"><br><br>   ,     Pointcuts.  ,    ,  .     ‚Äî    ,   ,     . <br><br><h2> Trick #9.   </h2><br>          . ,    . <br><br>   :  ,   -    .           <code>fastcgi_finish_request</code> .    ,      ,   , - callback  ‚Äî   . <br><br>         ? <br><br>   ,   <code>Deffered</code> ,  ,       . <br><br><img src="https://habrastorage.org/webt/yy/zh/7d/yyzh7dcpvv14sd3r75kroe07xky.jpeg"><br><br>    <code>Aspect</code> ,  ,    ,   <code>Deffered</code> ,    . <br><br><img src="https://habrastorage.org/webt/cc/y5/zj/ccy5zjad0olfwzemsxmnmo8mi_c.png"><br><br>   <code>Aspect</code>    :  ,  , ,      callback,  ,     callback.      . <br><br>  React ,     <code>promise</code> .     ,  -    ,  -     ,   . <br><br> ,       . <br><br><img src="https://habrastorage.org/webt/yp/zl/zp/ypzlzpf5k7tmuiculbcntozf0ga.png"><br><br>  <code>shutdown_function</code>   <code>Aspect</code> .     ,    callback,  ,   ,   ,   callback <code>onPhpTerminate</code> .     <code>fastcgi_finish_request</code>  : ¬´, , ,   ,  ¬ª.         . <br><br>   ,          <code>sendPushNotification</code> . <br><br><img src="https://habrastorage.org/webt/z4/4g/g0/z44gg0rpyaguh-rs8xge_tf6ync.jpeg"><br><br> , -       ‚Äî   2 . <br><br><img src="https://habrastorage.org/webt/v9/oa/rr/v9oarrwwsrifqgxpfpldsbezd4s.jpeg"><br><br>   ,  ,      ,  2   . <br><br>    ,  <code>Deferred</code> . <br><br><img src="https://habrastorage.org/webt/62/um/gw/62umgw3pjrqokgzk462oyhtlcpu.jpeg"><br><br>   ,    . -       ,  ,      . <br><br>  Eso es todo. ,          - .  ,   . <br><br><blockquote>    <a href="https://phprussia.ru/moscow/2020">PHP Russia 2020</a>   .        ‚Äî <a href="https://conf.ontico.ru/lectures/propose%3Fconference%3Dpc2020"> </a> .   <a href="http://eepurl.com/VYVaf"></a>  <a href="https://t.me/PHPRussiaConfChannel">telegram-</a> ,       PHP Russia 2020. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/478618/">https://habr.com/ru/post/478618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../478596/index.html">Funciones an√≥nimas de PHP: exposici√≥n de la sesi√≥n de Black Magic</a></li>
<li><a href="../478602/index.html">MVC en Unity con Objetos Scriptables. Parte 2</a></li>
<li><a href="../478604/index.html">De trabajadores a programadores de php. Carrera de desarrollo inusual</a></li>
<li><a href="../478606/index.html">"Buenas noches": c√≥mo los dispositivos inteligentes privan a las personas del sue√±o</a></li>
<li><a href="../478616/index.html">Windows UAC nunca deja de sorprender, o C√≥mo detectar una informaci√≥n privilegiada</a></li>
<li><a href="../478620/index.html">¬øPor qu√© deber√≠as probar FastAPI?</a></li>
<li><a href="../478622/index.html">Pruebas A / B, canalizaci√≥n y venta minorista: trimestre de marca para Big Data de GeekBrains y X5 Retail Group</a></li>
<li><a href="../478626/index.html">Depuraci√≥n de implementaci√≥n de software con strace</a></li>
<li><a href="../478628/index.html">Alto CRI en chino</a></li>
<li><a href="../478630/index.html">Pascal juega Go. Implementaci√≥n de m√©todos e interfaces en un compilador aficionado.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>