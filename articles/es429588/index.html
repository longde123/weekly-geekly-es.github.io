<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶Å üê∂ ü§¥ Toda la verdad sobre RTOS. Art√≠culo # 20. Sem√°foros: servicios auxiliares y estructuras de datos ‚õ∫Ô∏è üê§ üõéÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo contin√∫a la revisi√≥n de sem√°foros. 

 Servicios de sem√°foro auxiliar 
 Nucleus RTOS tiene cuatro llamadas API que proporcionan funcional...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toda la verdad sobre RTOS. Art√≠culo # 20. Sem√°foros: servicios auxiliares y estructuras de datos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429588/"><img src="https://habrastorage.org/webt/jd/m4/f3/jdm4f3ytpbghajx290do1pujcpa.jpeg"><br><br>  Este art√≠culo contin√∫a la revisi√≥n de sem√°foros. <br><br><h2>  Servicios de sem√°foro auxiliar </h2><br>  Nucleus RTOS tiene cuatro llamadas API que proporcionan funcionalidad relacionada con el sem√°foro: restablecer un sem√°foro, recuperar informaci√≥n de sem√°foro, recuperar el n√∫mero de sem√°foros en una aplicaci√≥n y recuperar punteros a todos los sem√°foros en una aplicaci√≥n.  Los tres primeros se implementan en Nucleus SE. <br><a name="habracut"></a><br>  Art√≠culos anteriores de la serie: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sem√°foros: introducci√≥n y servicios b√°sicos.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Grupos de banderas de eventos: servicios auxiliares y estructuras de datos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Grupos de banderas de eventos: Introducci√≥n y servicios b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Se√±ales</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Particiones de memoria: servicios y estructuras de datos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Secciones de memoria: introducci√≥n y servicios b√°sicos.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Estructuras de datos de tareas y llamadas de API no compatibles</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Servicios para trabajar con tareas.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tareas: configuraci√≥n e introducci√≥n a la API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Programador: funciones avanzadas y preservaci√≥n del contexto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Programador: implementaci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nucleus SE: dise√±o interno y despliegue</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">N√∫cleo SE: Introducci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Otros servicios RTOS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Interacci√≥n de tareas y sincronizaci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tareas, cambio de contexto e interrupciones</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tareas y planificaci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RTOS: estructura y modo en tiempo real</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RTOS: introducci√≥n.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><br></a> <br><h3>  Restablecer sem√°foro </h3><br>  Esta llamada a la API restablece el sem√°foro a su estado inicial no utilizado.  Esta funci√≥n de API es inusual en comparaci√≥n con las funciones de otros objetos del n√∫cleo, porque a pesar de que realiza un reinicio, no solo establece el contador en el valor inicial, sino que se pasa un nuevo valor de contador inicial en la llamada.  Cualquier tarea que se haya pausado en el sem√°foro se reanuda y devuelve el c√≥digo <b>NUSE_SEMAPHORE_WAS_RESET</b> en Nucleus SE y en Nucleus RTOS, <b>NU_SEMAPHORE_RESET</b> . <br><br>  <b><i>Llamada para restablecer el sem√°foro en Nucleus RTOS</i></b> <br><br>  Prototipo de llamada de servicio: <br><br>  <b>ESTADO NU_Reset_Semaphore (NU_SEMAPHORE * semaphore, UNSIGNED initial_count);</b> <br><br>  Par√°metros: <br><br>  <b>sem√°foro</b> : puntero al bloque de control de sem√°foro proporcionado por el usuario; <br>  <b>initial_count</b> : el valor al que se establecer√° el sem√°foro. <br><br>  Valor de retorno: <br><br>  <b>NU_SUCCESS</b> : la llamada se complet√≥ correctamente; <br>  <b>NU_INVALID_SEMAPHORE</b> : puntero de sem√°foro <b>no v√°lido</b> . <br><br>  <b><i>Llamada para restablecer un sem√°foro en Nucleus SE</i></b> <br>  Esta llamada a la API admite la funcionalidad principal de la API Nucleus RTOS. <br><br>  Prototipo de llamada de servicio: <br><br>  <b>ESTADO NUSE_Semaphore_Reset (NUSE_SEMAPHORE semaphore, U8 initial_count);</b> <br><br>  Par√°metros: <br><br>  <b>sem√°foro</b> - √≠ndice (ID) del sem√°foro objeto de dumping; <br>  <b>initial_count</b> : el valor al que se establecer√° el sem√°foro. <br><br>  Valor de retorno: <br><br>  <b>NUSE_SUCCESS</b> : la llamada se complet√≥ correctamente; <br>  <b>NUSE_INVALID_SEMAPHORE</b> : √≠ndice de sem√°foro no v√°lido. <br><br>  <b><i>Implementaci√≥n de un reinicio de sem√°foro en Nucleus SE</i></b> <br><br>  La tarea principal de la funci√≥n API <b>NUSE_Semaphore_Reset ()</b> es establecer el elemento <b>NUSE_Semaphore_Counter []</b> correspondiente en el valor especificado (despu√©s de verificar los par√°metros). <br><br>  Si se activa el bloqueo de tareas, se requiere el siguiente c√≥digo para desbloquear tareas: <br><br><pre><code class="plaintext hljs">while (NUSE_Semaphore_Blocking_Count[semaphore] != 0) { U8 index; /* check whether any tasks are blocked */ /* on this semaphore */ for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_SEMAPHORE_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == semaphore)) { NUSE_Task_Blocking_Return[index] = NUSE_SEMAPHORE_WAS_RESET; NUSE_Task_Status[index] = NUSE_READY; break; } } NUSE_Semaphore_Blocking_Count[semaphore]--; } #if NUSE_SCHEDULER_TYPE == NUSE_PRIORITY_SCHEDULER NUSE_Reschedule(NUSE_NO_TASK); #endif</code> </pre> <br>  Cada tarea suspendida en el sem√°foro se marca como "terminada" y el c√≥digo de suspensi√≥n de la tarea devuelve <b>NUSE_SEMAPHORE_WAS_RESET</b> .  Una vez completado este proceso, si se utiliza el planificador prioritario, la llamada inicializa <b>NUSE_Reschedule ()</b> , ya que una o m√°s tareas con una prioridad m√°s alta podr√≠an entrar en un estado listo y est√°n esperando para reanudarse. <br><br><h3>  Informaci√≥n del sem√°foro </h3><br>  Esta llamada de utilidad devuelve informaci√≥n de sem√°foro.  La implementaci√≥n de esta llamada en Nucleus SE difiere de Nucleus RTOS en que se devuelve menos informaci√≥n, ya que no se admite la denominaci√≥n de los objetos y el orden de la suspensi√≥n, y la suspensi√≥n de las tareas en s√≠ se puede deshabilitar. <br><br>  <b><i>Llame para obtener informaci√≥n sobre sem√°foros en Nucleus RTOS</i></b> <br><br>  Prototipo de llamada de servicio: <br><br>  <b>ESTADO NU_Semaphore_Information (NU_SEMAPHORE * semaphore, CHAR * name, UNSIGNED * current_count, OPTION * suspend_type, UNSIGNED * roles_waiting, NU_TASK ** first_task);</b> <br><br>  Par√°metros: <br><br>  <b>sem√°foro</b> : un puntero al bloque de control de sem√°foro sobre el que se requiere informaci√≥n; <br>  <b>nombre</b> : puntero al nombre de 8 caracteres del sem√°foro, con cero bytes de terminaci√≥n incluidos en esta √°rea; <br>  <b>current_count</b> : un puntero a una variable que tomar√° el valor actual del contador de sem√°foros; <br>  <b>suspend_type</b> : un puntero a una variable que aceptar√° el tipo de tarea de suspensi√≥n, puede tomar los valores <b>NU_FIFO</b> y <b>NU_PRIORITY</b> ; <br>  <b>task_waiting</b> : un puntero a una variable que tomar√° el n√∫mero de tareas suspendidas en el sem√°foro; <br>  <b>first_task</b> : un puntero a una variable de tipo <b>NU_TASK</b> , que llevar√° un puntero a la unidad de control de la primera tarea suspendida. <br><br>  Valor de retorno: <br><br>  <b>NU_SUCCESS</b> : la llamada se complet√≥ correctamente; <br>  <b>NU_INVALID_SEMAPHORE</b> : puntero de sem√°foro <b>no v√°lido</b> . <br><br>  <b><i>Llame para obtener informaci√≥n sobre sem√°foros en Nucleus SE</i></b> <br>  Esta llamada a la API admite la funcionalidad principal de la API Nucleus RTOS. <br><br>  Prototipo de llamada de servicio: <br><br>  <b>ESTADO NUSE_Semaphore_Information (NUSE_SEMAPHORE semaphore, U8 * current_count, U8 * tareas_waiting, NUSE_TASK * first_task);</b> <br><br>  Par√°metros: <br><br>  <b>sem√°foro</b> : un √≠ndice de un sem√°foro sobre el que se requiere proporcionar informaci√≥n; <br>  <b>current_count</b> : un puntero a una variable que tomar√° el valor actual del contador de sem√°foros; <br>  <b>task_waiting</b> : un puntero a una variable que tomar√° el n√∫mero de tareas suspendidas en este sem√°foro (no se devuelve nada si el soporte para suspender tareas est√° deshabilitado); <br>  <b>first_task</b> : un puntero a una variable de tipo <b>NUSE_TASK</b> , que tomar√° el √≠ndice de la primera tarea en pausa (no se devuelve nada si el soporte para las tareas en pausa est√° desactivado). <br><br>  Valor de retorno: <br><br>  <b>NUSE_SUCCESS</b> : la llamada se complet√≥ correctamente; <br>  <b>NUSE_INVALID_SEMAPHORE</b> : √≠ndice de sem√°foro no v√°lido; <br>  <b>NUSE_INVALID_POINTER</b> : uno o m√°s par√°metros de puntero son incorrectos. <br><br>  <b><i>Implementaci√≥n de informaci√≥n de sem√°foros en Nucleus SE</i></b> <br><br>  Implementar esta llamada a la API es bastante simple: <br><br><pre> <code class="plaintext hljs">NUSE_CS_Enter(); *current_count = NUSE_Semaphore_Counter[semaphore]; #if NUSE_BLOCKING_ENABLE *tasks_waiting = NUSE_Semaphore_Blocking_Count[semaphore]; if (NUSE_Semaphore_Blocking_Count[semaphore] != 0) { U8 index; for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_SEMAPHORE_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == semaphore)) { *first_task = index; break; } } } else { *first_task = 0; } #else *tasks_waiting = 0; *first_task = 0; #endif NUSE_CS_Exit(); return NUSE_SUCCESS;</code> </pre><br>  La funci√≥n devuelve el estado del sem√°foro.  Luego, si se activa la funcionalidad de bloqueo de llamadas API, se devuelve el n√∫mero de tareas pendientes y el √≠ndice de la primera (de lo contrario, estos par√°metros se establecen en 0). <br><br><h3>  Obtener el n√∫mero de sem√°foros </h3><br>  Esta llamada de utilidad devuelve el n√∫mero de sem√°foros en la aplicaci√≥n.  En Nucleus RTOS, este valor cambia con el tiempo y el valor de retorno corresponde al n√∫mero actual de sem√°foros, y en Nucleus SE, el valor de retorno se establece en la etapa de ensamblaje y ya no cambia. <br><br>  <b><i>Llamar a un contador de sem√°foros en Nucleus RTOS</i></b> <br><br>  Prototipo de llamada de servicio: <br><br>  <b>NU_SIGNED NU_Established_Semaphores (VOID);</b> <br><br>  Par√°metros: <br>  Est√°n ausentes <br><br>  Valor de retorno: <br>  El n√∫mero de sem√°foros creados en la aplicaci√≥n. <br><br>  <b><i>Llamar a un contador de sem√°foros en Nucleus SE</i></b> <br>  Esta llamada a la API admite la funcionalidad principal de la API Nucleus RTOS. <br><br>  Prototipo de llamada de servicio: <br><br>  <b>U8 NUSE_Semaphore_Count (nulo);</b> <br><br>  Par√°metros: <br>  Est√°n ausentes <br><br>  Valor de retorno: <br>  El n√∫mero de sem√°foros configurados en la aplicaci√≥n. <br><br>  <b><i>Implementaci√≥n de contadores de sem√°foros en Nucleus SE</i></b> <br>  La implementaci√≥n de esta llamada a la API es bastante simple: se <b>devuelve</b> el valor del s√≠mbolo <b>#define</b> <b>NUSE_SEMAPHORE_NUMBER</b> . <br><br><h2>  Estructuras de datos </h2><br>  Los sem√°foros usan dos o tres matrices de estructuras de datos (en RAM y ROM), que, como todos los dem√°s objetos de Nucleus SE, son un conjunto de tablas cuyo tama√±o depende del n√∫mero de sem√°foros en la aplicaci√≥n y los par√°metros seleccionados. <br><br>  Recomiendo encarecidamente que el c√≥digo de la aplicaci√≥n no utilice el acceso directo a estas estructuras de datos, sino que se refiera a ellas a trav√©s de las funciones API proporcionadas.  Esto evitar√° la incompatibilidad con futuras versiones de Nucleus SE y los efectos secundarios no deseados, adem√°s de simplificar la transferencia de la aplicaci√≥n a Nucleus RTOS.  Para una mejor comprensi√≥n de c√≥mo funciona el c√≥digo de llamada de servicio y para la depuraci√≥n, a continuaci√≥n se ofrece una descripci√≥n detallada de las estructuras de datos. <br><br><h3>  Datos de RAM </h3><br>  Estos datos tienen la siguiente estructura: <br>  <b>NUSE_Semaphore_Counter []</b> : una matriz de tipo <b>U8</b> que tiene una entrada para cada sem√°foro configurado, almacena el valor del contador. <br>  <b>NUSE_Semaphore_Blocking_Count []</b> : una matriz de tipo <b>U8</b> , contiene contadores de tareas bloqueadas en cada sem√°foro.  Esta matriz existe solo si la funcionalidad de bloqueo de llamadas API est√° activada. <br>  <b>NUSE_Semaphore_Counter [] se</b> inicializa al valor inicial (consulte "Datos en ROM" a continuaci√≥n), y <b>NUSE_Semaphore_Blocking_Count [] se</b> <b>restablece</b> usando <b>NUSE_Init_Semaphore ()</b> cuando se inicia Nucleus SE.  Uno de los siguientes art√≠culos proporcionar√° una descripci√≥n completa de los procedimientos de inicio de Nucleus SE. <br><br>  Las siguientes son las definiciones de estas estructuras de datos en el archivo <b>nuse_init.c</b> . <br><br><pre> <code class="plaintext hljs">RAM U8 NUSE_Semaphore_Counter[NUSE_SEMAPHORE_NUMBER]; #if NUSE_BLOCKING_ENABLE RAM U8 NUSE_Semaphore_Blocking_Count[NUSE_SEMAPHORE_NUMBER]; #endif</code> </pre><br><h3>  Datos ROM </h3><br>  Estructura de datos: <br>  <b>NUSE_Semaphore_Initial_Value []</b> : una matriz de tipo <b>U8</b> , que tiene un registro para cada sem√°foro, estos son los valores iniciales de los sem√°foros. <br><br>  Esta estructura de datos se declara e inicializa (est√°ticamente) en <b>nuse_config.c</b> : <br><br><pre> <code class="plaintext hljs">ROM U8 NUSE_Semaphore_Initial_Value[NUSE_SEMAPHORE_NUMBER] = { /* semaphore initial count values */ };</code> </pre><br><h3>  La cantidad de memoria para los sem√°foros. </h3><br>  Como todos los objetos del n√∫cleo de Nucleus SE, la cantidad de datos necesarios para los sem√°foros es predecible. <br><br>  La cantidad de memoria en ROM (en bytes) para todos los sem√°foros en la aplicaci√≥n es <b>NUSE_SEMAPHORE_NUMBER</b> . <br><br>  La cantidad de memoria en RAM (en bytes) para todos los sem√°foros en la aplicaci√≥n con llamadas activadas a la API de bloqueo se puede calcular de la siguiente manera: <br> <code>NUSE_SEMAPHORE_NUMBER * 2</code> <br> <br>  De lo contrario, es <b>NUSE_SEMAPHORE_NUMBER</b> . <br><br><h2>  Llamadas API no realizadas </h2><br>  Tres llamadas API para sem√°foros que est√°n presentes en Nucleus RTOS no se implementan en Nucleus SE. <br><br><h3>  Crear sem√°foros </h3><br>  Esta llamada a la API crea un sem√°foro.  No hay necesidad de Nucleus SE porque los sem√°foros se crean est√°ticamente. <br><br>  Prototipo de llamada de servicio: <br>  <b>ESTADO NU_Create_Semaphore (NU_SEMAPHORE * semaphore, CHAR * name, UNSIGNED initial_count, OPTION suspend_type);</b> <br><br>  Par√°metros: <br><br>  <b>sem√°foro</b> : un puntero a un bloque de control de sem√°foro proporcionado por el usuario; se utiliza para controlar sem√°foros en otras llamadas API; <br>  <b>nombre</b> : un puntero al nombre del sem√°foro de 8 caracteres, con el byte nulo de terminaci√≥n activado; <br>  <b>initial_count</b> : el valor inicial del sem√°foro; <br>  <b>suspend_type</b> : indica el principio de pausar una tarea en un sem√°foro.  Puede tomar los valores <b>NU_FIFO</b> y <b>NU_PRIORITY</b> , correspondientes al principio de FIFO (Primero en <b>entrar</b> , primero en salir) y el orden de prioridad de la suspensi√≥n de tareas. <br><br>  Valor de retorno: <br><br>  <b>NU_SUCCESS</b> : la llamada se complet√≥ correctamente; <br>  <b>NU_INVALID_SEMAPHORE</b> : dice que el puntero al bloque de control del sem√°foro es <b>NULL</b> o ya est√° en uso; <br>  <b>NU_INVALID_SUSPEND</b> : par√°metro inv√°lido <b>suspend_type</b> . <br><br><h3>  Eliminaci√≥n de sem√°foros </h3><br>  Esta llamada a la API elimina el sem√°foro creado previamente.  Nucleus SE no es necesario porque los sem√°foros se crean est√°ticamente y no se pueden eliminar. <br><br>  Prototipo de llamada de servicio: <br><br>  <b>ESTADO NU_Delete_Semaphore (NU_SEMAPHORE * semaphore);</b> <br><br>  Par√°metros: <br><br>  <b>sem√°foro</b> : puntero al bloque de control de sem√°foro. <br><br>  Valor de retorno: <br><br>  <b>NU_SUCCESS</b> : la llamada se complet√≥ correctamente; <br>  <b>NU_INVALID_SEMAPHORE</b> : puntero de sem√°foro <b>no v√°lido</b> . <br><br><h3>  Punteros a sem√°foros </h3><br>  Esta llamada a la API forma una lista secuencial de punteros a todos los sem√°foros del sistema.  No necesita Nucleus SE, ya que los sem√°foros se identifican mediante un √≠ndice simple, no un puntero. <br><br>  Prototipo de llamada de servicio: <br><br>  <b>UNSIGNED NU_Semaphore_Pointers (NU_SEMAPHORE ** pointer_list, UNSIGNED maximum_pointers);</b> <br><br>  Par√°metros: <br><br>  <b>pointer_list</b> : un puntero a una matriz de punteros <b>NU_SEMAPHORE</b> , esta matriz est√° llena de punteros a sem√°foros; <br>  <b>maximum_pointers</b> : el n√∫mero m√°ximo de punteros en la matriz. <br><br>  Valor de retorno: <br>  El n√∫mero de punteros <b>NU_SEMAPHORE</b> en la matriz. <br><br><h2>  Nucleus RTOS Compatible </h2><br>  Al igual que con todos los dem√°s objetos de Nucleus SE, el objetivo era maximizar la compatibilidad del c√≥digo de la aplicaci√≥n con Nucleus RTOS.  Los sem√°foros no son una excepci√≥n y, desde el punto de vista del usuario, se implementan de la misma manera que en Nucleus RTOS.  Tambi√©n hay una cierta incompatibilidad, que consider√© aceptable dado que el c√≥digo final ser√° m√°s comprensible y m√°s eficiente en t√©rminos de la cantidad de memoria requerida.  De lo contrario, las llamadas a la API Nucleus RTOS se pueden usar casi directamente como llamadas a Nucleus SE. <br><br><h3>  Identificadores de objetos </h3><br>  En Nucleus RTOS, todos los objetos se describen mediante estructuras de datos (unidades de control) de un tipo espec√≠fico.  Un puntero a esta unidad de control sirve como un identificador para el sem√°foro.  Decid√≠ que en Nucleus SE, se necesita un enfoque diferente para el uso eficiente de la memoria: todos los objetos del n√∫cleo se describen mediante un conjunto de tablas en RAM y / o ROM.  El tama√±o de estas tablas est√° determinado por el n√∫mero de objetos configurados de cada tipo.  El identificador de un objeto particular es el √≠ndice en esta tabla.  As√≠ que <b>defin√≠ NUSE_SEMAPHORE</b> como el equivalente de <b>U8</b> , una variable (no un puntero) de este tipo sirve como identificador para el sem√°foro.  Esta ligera incompatibilidad es f√°cil de manejar si el c√≥digo se transfiere de Nucleus SE a Nucleus RTOS y viceversa.  Por lo general, no se realizan operaciones en identificadores de objetos que no sean mover y almacenar. <br><br>  Nucleus RTOS tambi√©n admite nombres de sem√°foros.  Estos nombres se usan solo para la depuraci√≥n.  Los exclu√≠ de Nucleus SE para ahorrar memoria. <br><br><h3>  Tama√±o de mostrador </h3><br>  En Nucleus RTOS, el contador de sem√°foro es de tipo <b>sin signo</b> , que suele ser una variable de 32 bits.  Nucleus SE tiene un contador de 8 bits, pero esto se puede cambiar f√°cilmente.  Normalmente, Nucleus RTOS no verifica el desbordamiento del sem√°foro.  Llamar a la API de Nucleus SE no permitir√° que al contador se le asignen valores superiores a 255. <br><br><h3>  Llamadas API no realizadas </h3><br>  Nucleus RTOS admite ocho llamadas de servicios p√∫blicos para trabajar con sem√°foros.  De estos, tres no se implementan en Nucleus SE.  Los detalles de estos desaf√≠os, as√≠ como la decisi√≥n de excluirlos de Nucleus SE, se han descrito anteriormente. <br><br>  El siguiente art√≠culo examinar√° los buzones. <br><br>  <b>Sobre el autor:</b> Colin Walls ha trabajado en la industria electr√≥nica durante m√°s de treinta a√±os, dedicando la mayor parte de su tiempo al firmware.  Ahora es ingeniero de firmware en Mentor Embedded (una divisi√≥n de Mentor Graphics).  Colin Walls a menudo habla en conferencias y seminarios, autor de numerosos art√≠culos t√©cnicos y dos libros sobre firmware.  Vive en el Reino Unido.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Blog</a> profesional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de Colin</a> , correo electr√≥nico: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429588/">https://habr.com/ru/post/es429588/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429574/index.html">Curso gratuito de Check Point para principiantes en CheckMates</a></li>
<li><a href="../es429578/index.html">¬øQu√© errores est√°n ocultos en el c√≥digo Infer.NET?</a></li>
<li><a href="../es429580/index.html">Microinteracciones en iOS. Conferencia de Yandex</a></li>
<li><a href="../es429582/index.html">Indicador anal√≥gico de carga de la computadora</a></li>
<li><a href="../es429586/index.html">C√≥mo determinar el mejor momento para operar en el intercambio</a></li>
<li><a href="../es429590/index.html">An√°lisis de voz para centros de llamadas basados ‚Äã‚Äãen SOLR</a></li>
<li><a href="../es429592/index.html">C√≥mo las tarjetas bancarias afectan la econom√≠a y por qu√© la bola blanca no despega</a></li>
<li><a href="../es429594/index.html">An√°lisis de velocidad micromotor molecular para diagn√≥stico de VIH</a></li>
<li><a href="../es429596/index.html">Lo que debe hacer en Java para admitir completamente el aprendizaje autom√°tico</a></li>
<li><a href="../es429598/index.html">Inventario RFID UHF. ¬øC√≥mo encontrar todas las etiquetas?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>