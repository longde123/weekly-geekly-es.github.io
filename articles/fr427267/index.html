<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¶üèæ ü•ù üë©üèΩ‚Äçüé® SNMP + Java - exp√©rience personnelle. √âcriture d'un analyseur de fichiers MIB ‚ùå üîµ üçò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SNMP n'est pas le protocole le plus convivial: les fichiers MIB sont trop longs et d√©routants, et les OID sont tout simplement impossibles √† retenir. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SNMP + Java - exp√©rience personnelle. √âcriture d'un analyseur de fichiers MIB</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427267/">  SNMP n'est pas le protocole le plus convivial: les fichiers MIB sont trop longs et d√©routants, et les OID sont tout simplement impossibles √† retenir.  Mais que faire si vous devez travailler avec SNMP en Java?  Par exemple, √©crivez des autotests pour v√©rifier l'API du serveur SNMP. <br><br>  Par essais et erreurs, s'il y a une quantit√© plut√¥t maigre d'informations sur le sujet, nous avons quand m√™me trouv√© comment se faire des amis Java et SNMP. <br><br>  Dans cette s√©rie d'articles, je vais essayer de partager l'exp√©rience acquise avec le protocole.  Le premier article de la s√©rie sera consacr√© √† l'impl√©mentation de l'analyseur de fichiers MIB en Java.  Dans la deuxi√®me partie, je parlerai de l'√©criture d'un client SNMP.  Dans la troisi√®me partie, nous parlerons d'un exemple r√©el d'utilisation d'une biblioth√®que √©crite: les autotests pour v√©rifier l'interaction avec un p√©riph√©rique via SNMP. <br><br><img src="https://habrastorage.org/webt/tv/lq/ai/tvlqaihbpnaqtlie8wr7hulxyhg.jpeg"><br><a name="habracut"></a><br><h2>  Entr√©e </h2><br>  Tout a commenc√© avec la t√¢che d'√©crire des autotests pour v√©rifier le fonctionnement de l'enregistreur audio-vid√©o via SNMP.  Pour compliquer la situation, il n'y a pas beaucoup d'informations sur l'interaction avec SNMP en Java, en particulier en ce qui concerne le segment russe de l'Internet.  Bien s√ªr, on pourrait regarder vers C # ou Python.  Mais en C #, la situation du protocole est √† peu pr√®s aussi compliqu√©e qu'en Java.  Il existe quelques bonnes biblioth√®ques en python, mais nous avions d√©j√† une infrastructure pr√™te √† l'emploi pour les autotests de l'API REST de ce p√©riph√©rique en Java. <br><br>  Comme pour tout autre protocole de communication r√©seau, nous avions besoin d'un client SNMP pour travailler avec diff√©rents types de demandes.  Les autotests devraient √™tre en mesure de v√©rifier le succ√®s des demandes GET et SET pour les param√®tres scalaires et de table.  Pour les tables, il √©tait √©galement n√©cessaire de pouvoir v√©rifier l'ajout et la suppression d'enregistrements, si la table elle-m√™me autorise ces op√©rations. <br><br>  Mais en plus du client, la biblioth√®que devait contenir une classe pour travailler avec les fichiers MIB.  Cette classe aurait d√ª √™tre capable d'analyser le fichier MIB pour obtenir les types de donn√©es, les limites des valeurs acceptables, etc., afin de ne pas coder en dur ce qui peut toujours changer. <br><br>  Lors de la recherche de biblioth√®ques appropri√©es pour Java, nous n'avons trouv√© aucune biblioth√®que permettant de travailler √† la fois avec les requ√™tes et les fichiers MIB.  Par cons√©quent, nous nous sommes install√©s sur deux biblioth√®ques diff√©rentes.  Pour le client, le choix de la tr√®s utilis√©e org.snmp4j.snmp4j (https://www.snmp4j.org) semblait tout √† fait logique, et pour l'analyseur de fichiers MIB, le choix a √©t√© fait pour la biblioth√®que net.percederberg.mibble, peu connue (https: // www. mibble.org).  Si avec snmp4j le choix √©tait √©vident, alors mibble a √©t√© choisi pour la disponibilit√© d'une documentation suffisamment d√©taill√©e (quoique en anglais) avec des exemples.  Commen√ßons donc. <br><br><h2>  √âcriture d'un analyseur de fichiers MIB </h2><br>  Tous ceux qui ont d√©j√† vu des fichiers MIB savent que c'est p√©nible.  Essayons de r√©soudre ce probl√®me √† l'aide d'un analyseur simple, ce qui facilitera consid√©rablement la recherche d'informations √† partir d'un fichier, en le r√©duisant √† appeler une m√©thode particuli√®re. <br><br>  Un tel analyseur peut √™tre utilis√© comme un utilitaire distinct pour travailler avec des fichiers MIB ou inclus dans tout autre projet sous SNMP, par exemple, lors de l'√©criture d'un client SNMP ou du test d'automatisation. <br><br><h4>  Pr√©paration du projet </h4><br>  Pour faciliter le montage, nous utilisons Maven.  En fonction de la biblioth√®que add net.percederberg.mibble (https://www.mibble.org), ce qui nous permettra de travailler plus facilement avec les fichiers MIB: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>net.percederberg.mibble<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>mibble<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.9.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Comme il ne se trouve pas dans le r√©f√©rentiel Maven central, nous ajoutons le code suivant √† pom.xml: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repositories</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repository</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>opennms<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>OpenNMS<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://repo.opennms.org/maven2/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repository</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repositories</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Si le projet est assembl√© sans erreur avec le Maven, tout est pr√™t pour le travail.  Il ne reste plus qu'√† cr√©er une classe d'analyseur (appelons-la MIBParser) et √† importer tout ce dont nous avons besoin, √† savoir: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> net.percederberg.mibble.*;</code> </pre> <br><h4>  T√©l√©chargez et validez un fichier MIB </h4><br>  √Ä l'int√©rieur de la classe, il n'y aura qu'un seul champ - un objet de type net.percederberg.mibble.Mib pour stocker le fichier MIB t√©l√©charg√©: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Mib mib;</code> </pre><br>  Pour t√©l√©charger un fichier, nous √©crivons cette m√©thode: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Mib </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadMib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MibLoaderException, IOException </span></span>{ MibLoader loader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MibLoader(); Mib mib; file = file.getAbsoluteFile(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { loader.addDir(file.getParentFile()); mib = loader.load(file); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MibLoaderException e) { e.getLog().printTo(System.err); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { e.printStackTrace(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mib; }</code> </pre><br>  La classe net.percederberg.mibble.MIBLoader valide le fichier que nous essayons de charger et l√®ve une exception net.percederberg.mibble.MibLoaderException si elle y trouve des erreurs, y compris des erreurs d'importation √† partir d'autres fichiers MIB, si elles ne se trouvent pas dans le m√™me r√©pertoire ou ne contiennent pas de caract√®res MIB import√©s. <br><br>  Dans la m√©thode loadMib, nous interceptons toutes les exceptions, les √©crivons dans le journal et les transmettons plus loin, car  √† ce stade, la poursuite du travail est impossible - le dossier n'est pas valide. <br><br>  Nous appelons la m√©thode √©crite dans le constructeur de l'analyseur: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MIBParser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MibLoaderException, IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.exists()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(<span class="hljs-string"><span class="hljs-string">"File not found in location: "</span></span> + file.getAbsolutePath()); mib = loadMib(file.getAbsoluteFile()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mib.isLoaded()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MibLoaderException(file, <span class="hljs-string"><span class="hljs-string">"Not loaded."</span></span>); }</code> </pre><br>  Si le fichier a √©t√© t√©l√©charg√© et analys√© avec succ√®s, continuez √† travailler. <br><br><h4>  M√©thodes de r√©cup√©ration des informations d'un fichier MIB </h4><br>  En utilisant les m√©thodes de la classe net.percederberg.mibble.Mib, vous pouvez rechercher des caract√®res individuels d'un fichier MIB par nom ou OID en appelant respectivement les m√©thodes getSymbol (String name) ou getSymbolByOid (String oid).  Ces m√©thodes renvoient l'objet net.percederberg.mibble.MibSymbol, dont nous utiliserons les m√©thodes pour obtenir les informations n√©cessaires sur un symbole MIB sp√©cifique. <br><br>  Commen√ßons par les m√©thodes d'√©criture les plus simples pour obtenir le nom d'un symbole par son OID et, inversement, l'OID par son nom: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String oid)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mib.getSymbolByOid(oid).getName(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ String oid = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; MibSymbol s = mib.getSymbol(name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> MibValueSymbol) { oid = ((MibValueSymbol) s).getValue().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((MibValueSymbol) s).isScalar()) oid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OID(oid).append(<span class="hljs-number"><span class="hljs-number">0</span></span>).toDottedString(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> oid; }</code> </pre><br>  Ce sont peut-√™tre les caract√©ristiques d'un fichier MIB sp√©cifique, avec lequel je devais travailler, mais pour une raison quelconque, les param√®tres scalaires ont renvoy√© un OID sans z√©ro √† la fin, donc un code a √©t√© ajout√© √† la m√©thode d'obtention de l'OID, qui, si le MIB le caract√®re est scalaire, il ajoute simplement ".0" √† l'OID re√ßu en utilisant la m√©thode append (int index) de la classe net.percederberg.mibble.OID.  Si cela fonctionne pour vous sans b√©quille, f√©licitations :) <br><br>  Pour obtenir le reste des donn√©es sur le symbole, nous √©crivons une m√©thode auxiliaire, o√π nous obtenons l'objet net.percederberg.mibble.snmp.SnmpObjectType, qui contient toutes les informations n√©cessaires sur le symbole MIB √† partir duquel il a √©t√© obtenu. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> SnmpObjectType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSnmpObjectType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MibSymbol symbol)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (symbol <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> MibValueSymbol) { MibType type = ((MibValueSymbol) symbol).getType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> SnmpObjectType) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (SnmpObjectType) type; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Par exemple, nous pouvons obtenir le type du symbole MIB: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getSnmpObjectType(s).getSyntax().getReferenceSymbol() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getSnmpObjectType(s).getSyntax().getName(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getSnmpObjectType(s).getSyntax().getReferenceSymbol().getName(); }</code> </pre><br>  Il y a 2 fa√ßons d'obtenir du type, car  pour les types primitifs, la premi√®re option fonctionne: <br><br><pre> <code class="java hljs">getSnmpObjectType(s).getSyntax().getName();</code> </pre><br>  et pour les import√©s, le second: <br><br><pre> <code class="java hljs">getSnmpObjectType(s).getSyntax().getReferenceSymbol().getName();</code> </pre><br>  Vous pouvez obtenir le niveau d'acc√®s d'un personnage: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getSnmpObjectType(s).getAccess().toString(); }</code> </pre><br>  Valeur minimale valide pour un param√®tre num√©rique: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDigitMinValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); String syntax = getSnmpObjectType(s).getSyntax().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m.find()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Valeur maximale autoris√©e d'un param√®tre num√©rique: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDigitMaxValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); String syntax = getSnmpObjectType(s).getSyntax().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m.find()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">2</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Longueur de cha√Æne minimale autoris√©e (d√©pend du type de cha√Æne): <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStringMinLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mib.getSymbol(name); String syntax = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getSnmpObjectType(s).getSyntax().toString(); Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>) &amp;&amp; m.find()?Integer.valueOf(Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>))):<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Longueur de cha√Æne maximale autoris√©e (d√©pend du type de cha√Æne): <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStringMaxLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); String syntax = getSnmpObjectType(s).getSyntax().toString(); Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>) &amp;&amp; m.find()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">2</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Vous pouvez √©galement obtenir les noms de toutes les colonnes du tableau par son nom: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ArrayList&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTableColumnNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String tableName)</span></span></span><span class="hljs-function"> </span></span>{ ArrayList&lt;String&gt; mibSymbolNamesList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); MibValueSymbol table = (MibValueSymbol) mib.findSymbol(tableName, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (table.isTable() &amp;&amp; table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).isTableRow()) { MibValueSymbol[] symbols = table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).getChildren(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (MibValueSymbol mvs : symbols) { mibSymbolNamesList.add(mvs.getName()); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mibSymbolNamesList; }</code> </pre><br>  Tout d'abord, de mani√®re standard, nous obtenons un symbole MIB par son nom: <br><br><pre> <code class="java hljs">MibValueSymbol table = (MibValueSymbol) mib.findSymbol(tableName, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br>  Ensuite, nous v√©rifions s'il s'agit d'une table et que le symbole MIB enfant est une ligne de cette table et, si la condition renvoie true, dans la boucle, nous parcourons les enfants de la ligne de la table et ajoutons le nom de l'√©l√©ment au tableau r√©sultant: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (table.isTable() &amp;&amp; table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).isTableRow()) { MibValueSymbol[] symbols = table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).getChildren(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (MibValueSymbol mvs : symbols) { mibSymbolNamesList.add(mvs.getName()); } }</code> </pre><br><h2>  R√©sum√© </h2><br>  Ces m√©thodes sont suffisantes pour obtenir des informations du fichier MIB pour chaque caract√®re sp√©cifique, ne connaissant que son nom.  Par exemple, lors de l'√©criture d'un client SNMP, vous pouvez y inclure un analyseur afin que les m√©thodes client n'acceptent pas les OID, mais les noms de symboles MIB.  Cela augmentera la fiabilit√© du code, car  une faute de frappe dans OID peut ne pas conduire au caract√®re auquel nous voulons faire r√©f√©rence.  Et pas d'OID - pas de probl√®mes. <br><br>  Le plus est la lisibilit√© du code, ce qui signifie sa maintenabilit√©.  Il est plus facile de comprendre l'essence du projet si le code fonctionne avec des noms humains. <br><br>  Une autre application est l'automatisation des tests.  Dans les donn√©es de test, on peut obtenir dynamiquement des valeurs limites de param√®tres num√©riques √† partir d'un fichier MIB.  Ainsi, si les valeurs limites de certains symboles MIB dans la nouvelle version du composant test√© changent, vous n'aurez pas √† modifier le code d'autotest. <br><br>  En g√©n√©ral, en utilisant un analyseur, travailler avec des fichiers MIB devient beaucoup plus agr√©able, et ils cessent d'√™tre une telle douleur. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr427267/">https://habr.com/ru/post/fr427267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr427255/index.html">Cowon D2: Musical Long-Liver</a></li>
<li><a href="../fr427257/index.html">Cameron Craig: sept le√ßons tir√©es de 10 ans de gestion des relations publiques d'Apple</a></li>
<li><a href="../fr427259/index.html">Ce que le test de Turing v√©rifie vraiment</a></li>
<li><a href="../fr427263/index.html">Soyez un ninja de la s√©curit√©: enregistrement de webinaire et niveau bonus</a></li>
<li><a href="../fr427265/index.html">Les protobuffers ont tort</a></li>
<li><a href="../fr427269/index.html">Vid√©o Google OKR cinq ans plus tard - Un examen de l'exp√©rience de Google Ventures dans la mise en ≈ìuvre d'OKR (2012-2017)</a></li>
<li><a href="../fr427271/index.html">Histoire et exp√©rience de l'utilisation de la traduction automatique. Conf√©rence Yandex</a></li>
<li><a href="../fr427273/index.html">L'intelligence artificielle peut-elle laisser les bookmakers sans travail?</a></li>
<li><a href="../fr427275/index.html">Architecture de l'information Internet, partie 3</a></li>
<li><a href="../fr427277/index.html">Un sch√©ma de diffraction se retrouve dans la distribution des nombres premiers, similaire √† celui des quasi-cristaux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>