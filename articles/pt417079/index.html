<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶è üíÜüèΩ üßìüèª Gerenciador de Pacotes para Kubernetes - Helm: Passado, Presente, Futuro üë©üèº ‚òÉÔ∏è üë®üèª‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nota perev. : Com este artigo, abrimos uma s√©rie de publica√ß√µes sobre o gerenciador de pacotes do Kubernetes, que usamos ativamente no trabalho di√°rio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gerenciador de Pacotes para Kubernetes - Helm: Passado, Presente, Futuro</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/417079/">  <i><b>Nota</b></i>  <i><b>perev.</b></i>  <i>: Com este artigo, abrimos uma s√©rie de publica√ß√µes sobre o gerenciador de pacotes do Kubernetes, que usamos ativamente no trabalho di√°rio - Helm.</i>  <i>O autor original do material √© Matt Butcher, um dos fundadores do projeto Helm, trabalhando em projetos de c√≥digo aberto na Microsoft e escrevendo 8 livros t√©cnicos (em particular, ‚ÄúGo in Practice‚Äù).</i>  <i>No entanto, o artigo √© complementado por nossos coment√°rios (√†s vezes extensos) e em breve ser√° expandido com novas notas sobre o Helm, com um foco mais pr√°tico.</i>  <i><b>ATUALIZA√á√ÉO</b> (03/03/2018): saiu a sequ√™ncia - " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conhecimento pr√°tico do gerenciador de pacotes do Kubernetes - Helm</a> ".</i> <br><br><img src="https://habrastorage.org/webt/ff/1x/js/ff1xjsnvdlnfinirlwb-0p42tlo.png"><br><br>  Em junho, Helm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mudou</a> do status de projeto l√≠der do Kubernetes para a Cloud Native Computing Foundation (CNCF).  O CNCF est√° se tornando a organiza√ß√£o pai das melhores ferramentas nativas de nuvem de c√≥digo aberto.  Portanto, √© uma grande honra para Helm se tornar parte desse fundamento.  E nosso primeiro projeto significativo sob os ausp√≠cios do CNCF √© verdadeiramente em larga escala: criamos o Helm 3. <a name="habracut"></a><br><br><h2>  Uma Breve Hist√≥ria do Leme </h2><br>  Helm apareceu originalmente como um projeto Deis Open Source.  Foi modelado com base no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Homebrew</a> <i>(o gerenciador de pacotes do macOS - <b>aprox. Transl.</b> )</i> , E a tarefa que o Helm 1 teve foi uma oportunidade facilitada para os usu√°rios instalarem rapidamente suas primeiras cargas de trabalho no Kubernetes.  O an√∫ncio oficial do Helm ocorreu na primeira confer√™ncia da KubeCon em S√£o Francisco em 2015. <br><br>  <i><b>Nota</b></i>  <i><b>trans.: a</b> partir da primeira vers√£o, chamada dm (Deployment Manager), a sintaxe YAML foi escolhida para descrever os recursos do Kubernetes, e os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">modelos Jinja</a> e scripts Python foram suportados ao escrever configura√ß√µes.</i> <br><br>  <i>Um modelo de aplicativo da web simples pode ser assim:</i> <br><br><div class="spoiler">  <b class="spoiler_title">Yaml</b> <div class="spoiler_text"><pre><code class="plaintext hljs">resources: - name: frontend type: github.com/kubernetes/application-dm-templates/common/replicatedservice:v1 properties: service_port: 80 container_port: 80 external_service: true replicas: 3 image: gcr.io/google_containers/example-guestbook-php-redis:v3 - name: redis type: github.com/kubernetes/application-dm-templates/storage/redis:v1 properties: null</code> </pre> </div></div><br>  <i>Ao descrever os componentes do aplicativo implementado, s√£o indicados o nome, o modelo usado e tamb√©m os par√¢metros necess√°rios desse modelo.</i>  <i>No exemplo acima, os <code>redis</code> <code>frontend</code> e <code>redis</code> usam modelos do reposit√≥rio oficial.</i> <br><br>  <i>J√° nesta vers√£o, voc√™ pode usar recursos de uma base de conhecimento comum, criar seus pr√≥prios reposit√≥rios de modelos e criar aplicativos complexos devido aos par√¢metros e aninhamento de modelos.</i> <br><br>  <i>A arquitetura Helm 1 consiste em tr√™s componentes.</i>  <i>O diagrama a seguir ilustra o relacionamento entre eles:</i> <br><br><img src="https://habrastorage.org/webt/66/f8/l_/66f8l_blo_rfzohvo1wpobchuzg.png"><br><br><ol><li>  <i><code>Manager</code> desempenha a fun√ß√£o de um servidor Web (a comunica√ß√£o com os clientes ocorre por meio da API REST), gerencia as implanta√ß√µes no cluster Kubernetes e √© usado como um data warehouse.</i> </li><li>  <i>O componente <code>expandybird</code> traz as configura√ß√µes do usu√°rio para uma forma plana, ou seja,</i>  <i>aplica modelos Jinja e executa scripts Python.</i> </li><li>  <i>Depois de receber uma configura√ß√£o simples, o <code>resourcifier</code> faz as chamadas necess√°rias para o kubectl e retorna as mensagens de status e de erro, se houver, ao <code>manager</code> .</i> </li></ol><br>  <i>Para entender os recursos da primeira vers√£o do Helm, darei ajuda no comando <code>dm</code></i> : <div class="spoiler">  <b class="spoiler_title">Ajuda da sa√≠da do dm</b> <div class="spoiler_text"><pre> <code class="bash hljs">Usage: ./dm [&lt;flags&gt;] &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; [(&lt;template-name&gt; | &lt;deployment-name&gt; | (&lt;configuration&gt; [&lt;import1&gt;...&lt;importN&gt;]))] Commands: expand Expands the supplied configuration(s) deploy Deploys the named template or the supplied configuration(s) list Lists the deployments <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the cluster get Retrieves the supplied deployment manifest Lists manifests <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deployment or retrieves the supplied manifest <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the form (deployment[/manifest]) delete Deletes the supplied deployment update Updates a deployment using the supplied configuration(s) deployed-types Lists the types deployed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the cluster deployed-instances Lists the instances of the named <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> deployed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the cluster templates Lists the templates <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a given template registry (specified with --registry) registries Lists the registries available describe Describes the named template <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a given template registry getcredential Gets the named credential used by a registry setcredential Sets a credential used by a registry createregistry Creates a registry that holds charts Flags: -apitoken string Github api token that overrides GITHUB_API_TOKEN environment variable -binary string Path to template expansion binary (default <span class="hljs-string"><span class="hljs-string">"../expandybird/expansion/expansion.py"</span></span>) -httptest.serve string <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> non-empty, httptest.NewServer serves on this address and blocks -name string Name of deployment, used <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deploy and update commands (defaults to template name) -password string Github password that overrides GITHUB_PASSWORD environment variable -properties string Properties to use when deploying a template (eg, --properties k1=v1,k2=v2) -regex string Regular expression to filter the templates listed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a template registry -registry string Registry name (default <span class="hljs-string"><span class="hljs-string">"application-dm-templates"</span></span>) -registryfile string File containing registry specification -service string URL <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deployment manager (default <span class="hljs-string"><span class="hljs-string">"http://localhost:8001/api/v1/proxy/namespaces/dm/services/manager-service:manager"</span></span>) -serviceaccount string Service account file containing JWT token -stdin Reads a configuration from the standard input -timeout int Time <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> seconds to <span class="hljs-built_in"><span class="hljs-built_in">wait</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> response (default 20) -username string Github user name that overrides GITHUB_USERNAME environment variable --stdin requires a file name and either the file contents or a tar archive containing the named file. a tar archive may include any additional files referenced directly or indirectly by the named file.</code> </pre></div></div><br>  <i>E agora, de volta ao texto original sobre a hist√≥ria de Helm ...</i> <br><br>  Alguns meses depois, unimos for√ßas √† equipe do Kubernetes Deployment Manager do Google e come√ßamos a trabalhar no Helm 2. O objetivo era manter o Helm f√°cil de usar, adicionando o seguinte: <br><br><ol><li>  modelos de gr√°fico <i>(‚Äúgr√°fico‚Äù - um an√°logo de um pacote no ecossistema Helm - <b>aprox. transl.</b> )</i> para personaliza√ß√£o; </li><li>  gerenciamento de cluster para equipes; </li><li>  reposit√≥rio completo de gr√°ficos; </li><li>  formato de pacote est√°vel e assinado; </li><li>  forte compromisso com o controle de vers√£o sem√¢ntico e manuten√ß√£o da compatibilidade com vers√µes anteriores de vers√£o para vers√£o. </li></ol><br>  Para atingir esses objetivos, um segundo componente foi adicionado ao ecossistema Helm.  Tornou-se o cluster interno do Tiller, que fornecia a instala√ß√£o dos gr√°ficos Helm e seu gerenciamento. <br><br>  <i><b>Nota</b></i>  <i><b>perev.:</b> Portanto, na segunda vers√£o do Helm, o √∫nico componente restante no cluster √© respons√°vel pelo ciclo de vida da instala√ß√£o ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">release</a> ) e a prepara√ß√£o da configura√ß√£o √© enviada ao cliente Helm.</i> <br><br>  <i>Se a reinicializa√ß√£o do cluster ao usar a primeira vers√£o do Helm levar a uma perda completa dos dados de servi√ßo (desde que eles foram armazenados na RAM), no Helm 2 todos os dados ser√£o armazenados no <code>ConfigMaps</code> , ou seja,</i>  <i>recursos dentro do Kubernetes.</i>  <i>Outra etapa importante foi a transi√ß√£o de uma API s√≠ncrona (onde todas as solicita√ß√µes estavam bloqueando) para o uso de gRPC ass√≠ncrono.</i> <br><br>  Desde o lan√ßamento do Helm 2 em 2016, o projeto Kubernetes experimentou um crescimento explosivo e novas oportunidades significativas.  O Controle de Acesso Baseado em Fun√ß√£o (RBAC) foi adicionado.  Muitos novos tipos de recursos s√£o introduzidos.  Recursos de terceiros inventados (Defini√ß√µes de Recursos Personalizados, CRD).  E o mais importante, existem pr√°ticas recomendadas.  Passando por todas essas mudan√ßas, Helm continuou a atender √†s necessidades dos usu√°rios do Kubernetes.  Mas ficou claro para n√≥s que era hora de fazer grandes mudan√ßas para que as necessidades desse ecossistema em desenvolvimento continuassem sendo atendidas. <br><br>  Chegamos ao Helm 3. A seguir, falarei sobre algumas das inova√ß√µes apresentadas no roteiro do projeto. <br><br><h2>  Sauda√ß√µes Lua </h2><br>  No Helm 2, introduzimos modelos.  No est√°gio inicial do desenvolvimento do Helm 2, apoiamos modelos Go, Jinja, c√≥digo Python limpo e at√© t√≠nhamos um prot√≥tipo de suporte ao ksonnet.  Mas a presen√ßa de muitos mecanismos de modelos deu origem a mais problemas do que resolveu.  Portanto, chegamos ao ponto de escolher um. <br><br>  Os modelos Go t√™m quatro vantagens: <br><br><ol><li>  a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">est√° embutida no Go</a> ; </li><li>  os modelos s√£o executados em um ambiente sandbox estritamente limitado; </li><li>  poder√≠amos inserir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fun√ß√µes e objetos arbitr√°rios</a> no mecanismo; </li><li>  eles trabalharam bem com o YAML. </li></ol><br>  Embora tenhamos mantido a interface no Helm para oferecer suporte a outros mecanismos de modelo, os modelos Go se tornaram nosso padr√£o padr√£o.  E os pr√≥ximos anos de experi√™ncia mostraram como engenheiros de muitas empresas criaram milhares de gr√°ficos usando modelos Go. <br><br>  E n√≥s aprendemos sobre suas decep√ß√µes: <br><br><ol><li>  A sintaxe √© dif√≠cil de ler e mal documentada. </li><li>  Problemas de linguagem, como vari√°veis ‚Äã‚Äãimut√°veis, tipos de dados complexos e regras de visibilidade restritivas, transformaram coisas simples em complexas. </li><li>  A incapacidade de definir fun√ß√µes nos modelos tornou a cria√ß√£o de bibliotecas reutiliz√°veis ‚Äã‚Äãainda mais dif√≠cil. </li></ol><br>  Mais importante ainda, usando a linguagem de modelo, "truncamos" os objetos Kubernetes para sua representa√ß√£o de linha.  (Em outras palavras, os desenvolvedores de modelos precisavam gerenciar os recursos do Kubernetes como documentos de texto no formato YAML.) <br><br><h2>  Trabalhar em objetos, n√£o em peda√ßos de YAML </h2><br>  Repetidamente, ouvimos dos usu√°rios uma solicita√ß√£o para a capacidade de inspecionar e modificar os recursos do Kubernetes como objetos, n√£o como strings.  Ao mesmo tempo, eles afirmaram que, independentemente da forma de implementa√ß√£o que escolhemos para isso, deve ser f√°cil aprender e bem mantido no ecossistema. <br><br>  Ap√≥s meses de pesquisa, decidimos fornecer uma linguagem de script integrada que pode ser empacotada em uma sandbox e personalizada.  Entre os 20 principais idiomas, havia apenas um candidato que atendeu aos requisitos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lua</a> . <br><br>  Em 1993, um grupo de engenheiros de TI brasileiros criou uma linguagem de script leve para incorporar em suas ferramentas.  Lua possui uma sintaxe simples, √© amplamente suportado e tem sido destaque na lista dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">20 principais idiomas</a> por um longo tempo.  √â suportado pelo IDE e editores de texto, existem muitos manuais e tutoriais.  Em um ecossistema existente, gostar√≠amos de desenvolver nossa solu√ß√£o. <br><br>  Nosso trabalho no Helm Lua ainda est√° na fase de prova conceitual, e esperamos uma sintaxe que seja familiar e flex√≠vel.  Comparando as abordagens antiga e nova, voc√™ pode ver para onde estamos nos movendo. <br><br>  Aqui est√° <a href="">um exemplo</a> de um modelo de lareira com Alpine no Helm 2: <br><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Pod metadata: name: {{ template "alpine.fullname" . }} labels: heritage: {{ .Release.Service }} release: {{ .Release.Name }} chart: {{ .Chart.Name }}-{{ .Chart.Version }} app: {{ template "alpine.name" . }} spec: restartPolicy: {{ .Values.restartPolicy }} containers: - name: waiter image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}" imagePullPolicy: {{ .Values.image.pullPolicy }} command: ["/bin/sleep", "9000"]</code> </pre> <br>  Nesse modelo simples, voc√™ pode ver imediatamente todas as diretivas <code>{{ .Chart.Name }}</code> modelo, como <code>{{ .Chart.Name }}</code> . <br><br>  E aqui est√° a defini√ß√£o da mesma lareira na vers√£o preliminar do c√≥digo Lua: <br><br><pre> <code class="lua hljs">unction create_alpine_pod(_) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> pod = { apiVersion = <span class="hljs-string"><span class="hljs-string">"v1"</span></span>, kind = <span class="hljs-string"><span class="hljs-string">"Pod"</span></span>, metadata = { name = alpine_fullname(_), labels = { heritage = _.Release.Service <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">"helm"</span></span>, release = _.Release.Name, chart = _.Chart.Name .. <span class="hljs-string"><span class="hljs-string">"-"</span></span> .. _.Chart.Version, app = alpine_name(_) } }, spec = { restartPolicy = _.Values.restartPolicy, containers = { { name = waiter, image = _.Values.image.repository .. <span class="hljs-string"><span class="hljs-string">":"</span></span> .. _.Values.image.tag, imagePullPolicy = _.Values.image.pullPolicy, command = { <span class="hljs-string"><span class="hljs-string">"/bin/sleep"</span></span>, <span class="hljs-string"><span class="hljs-string">"9000"</span></span> } } } } } _.resources.add(pod) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  N√£o h√° necessidade de examinar todas as linhas deste exemplo para entender o que est√° acontecendo.  √â imediatamente √≥bvio que no c√≥digo est√° definido em.  Mas, em vez de usar cadeias YAML com diretivas de modelo internas, n√≥s a definimos como um objeto em Lua. <br><br><h2>  Vamos encurtar esse c√≥digo </h2><br>  Como trabalhamos diretamente com objetos (em vez de manipular uma grande quantidade de texto), podemos tirar o m√°ximo proveito do script.  As oportunidades para criar bibliotecas compartilhadas que aparecem aqui parecem realmente atraentes.  E esperamos que, introduzindo bibliotecas especializadas (ou permitindo que a comunidade as crie), possamos reduzir o c√≥digo acima para algo como isto: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> pods = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"mylib.pods"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_alpine_pod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_)</span></span></span></span> myPod = pods.new(<span class="hljs-string"><span class="hljs-string">"alpine:3.7"</span></span>, _) myPod.spec.restartPolicy = <span class="hljs-string"><span class="hljs-string">"Always"</span></span> <span class="hljs-comment"><span class="hljs-comment">-- set any other properties _.Manifests.add(myPod) end</span></span></code> </pre> <br>  Neste exemplo, usamos a capacidade de trabalhar com a defini√ß√£o de um recurso como um objeto, o que √© f√°cil de definir propriedades, mantendo a concis√£o e a legibilidade do c√≥digo. <br><br><h2>  Modelos ... Lua ... Por que n√£o todos juntos? </h2><br>  Embora os modelos n√£o sejam t√£o maravilhosos para todas as tarefas, eles ainda t√™m certas vantagens.  O Templates in Go √© uma tecnologia est√°vel, com uma base de usu√°rios estabelecida e muitos gr√°ficos existentes.  Muitos desenvolvedores de gr√°ficos afirmam gostar de escrever modelos.  Portanto, n√£o vamos remover o suporte ao modelo. <br><br>  Em vez disso, queremos permitir que os modelos e Lua sejam usados ‚Äã‚Äãao mesmo tempo.  Os scripts Lua ter√£o acesso aos modelos do Helm antes e depois da renderiza√ß√£o, o que permitir√° que desenvolvedores avan√ßados de gr√°ficos realizem transforma√ß√µes complexas nos gr√°ficos existentes, mantendo a capacidade simples de criar gr√°ficos do Helm com modelos. <br><br>  Somos muito encorajados pelo suporte de scripts em Lua, mas ao mesmo tempo estamos nos livrando de uma parte significativa da arquitetura Helm ... <br><br><h2>  Dizer adeus a Tiller </h2><br>  Durante o desenvolvimento do Helm 2, apresentamos o Tiller como um componente de integra√ß√£o com o Deployment Manager.  O Tiller desempenhou um papel importante para as equipes que trabalham no mesmo cluster: tornou poss√≠vel interagir com o mesmo conjunto de releases para muitos administradores diferentes. <br><br>  No entanto, o Tiller atuou como um servidor sudo gigante, concedendo uma ampla gama de direitos a todos que t√™m acesso ao Tiller.  E nosso esquema de instala√ß√£o padr√£o era a configura√ß√£o permissiva.  Portanto, os engenheiros do DevOps e do SRE precisaram aprender as etapas adicionais para instalar o Tiller em clusters de v√°rios inquilinos. <br><br>  Al√©m disso, com o advento do CRD, n√£o pod√≠amos mais confiar no Tiller para manter o estado ou a fun√ß√£o como um hub central para as informa√ß√µes de libera√ß√£o do Helm.  S√≥ poder√≠amos armazenar essas informa√ß√µes como entradas separadas no Kubernetes. <br><br>  O principal objetivo do Tiller pode ser alcan√ßado sem o pr√≥prio Tiller.  Portanto, uma das primeiras decis√µes tomadas durante a fase de planejamento do Helm 3 foi abandonar completamente o Tiller. <br><br><h2>  Melhoria de seguran√ßa </h2><br>  Sem o Tiller, o modelo de seguran√ßa Helm √© radicalmente simplificado.  A autentica√ß√£o do usu√°rio √© delegada pelo Kubernetes.  E autoriza√ß√£o tamb√©m.  Os direitos do leme s√£o definidos como direitos do Kubernetes (via RBAC), e os administradores de cluster podem restringir os direitos do leme em qualquer n√≠vel de detalhe necess√°rio. <br><br><h2>  Vers√µes, vers√µes de libera√ß√£o e armazenamento de estado </h2><br>  Na aus√™ncia do Tiller, para manter o estado de v√°rias libera√ß√µes dentro do cluster, precisamos de uma nova maneira para todos os clientes interagirem (no gerenciamento de libera√ß√µes). <br><br>  Para isso, introduzimos duas novas entradas: <br><br><ol><li>  <code>Release</code> - para uma instala√ß√£o espec√≠fica de um gr√°fico espec√≠fico.  Se rodarmos <code>helm install my-wordpress stable/wordpress</code> , uma vers√£o chamada <code>my-wordpress</code> ser√° criada e mantida ao longo da vida desta instala√ß√£o do WordPress. </li><li>  <code>ReleaseVersion</code> - sempre que voc√™ atualiza o gr√°fico Helm, √© necess√°rio considerar o que mudou e se a altera√ß√£o foi bem-sucedida.  <code>ReleaseVersion</code> vinculado a uma libera√ß√£o e armazena apenas registros com informa√ß√µes sobre atualiza√ß√£o, <code>ReleaseVersion</code> e exclus√£o.  Quando executamos o <code>helm upgrade my-wordpress stable/wordpress</code> , o objeto <code>Release</code> original permanece o mesmo, mas um objeto filho <code>ReleaseVersion</code> com informa√ß√µes sobre a opera√ß√£o de atualiza√ß√£o. </li></ol><br>  <code>Releases</code> e <code>Releases</code> <code>ReleaseVersions</code> ser√£o armazenadas nos mesmos espa√ßos de nomes que os objetos de gr√°fico. <br><br>  Com esses recursos, as equipes de usu√°rios do Helm poder√£o rastrear os registros das instala√ß√µes do Helm no cluster sem a necessidade do Tiller. <br><br><h2>  Mas espere, isso n√£o √© tudo! </h2><br>  Neste artigo, tentei falar sobre algumas das principais altera√ß√µes no Helm 3. No entanto, esta lista n√£o est√° completa.  <a href="">O plano Helm 3 tamb√©m</a> inclui outras altera√ß√µes, como melhorias no formato do gr√°fico, aprimoramentos de desempenho para reposit√≥rios de gr√°ficos e um novo sistema de eventos que os desenvolvedores de gr√°ficos podem usar.  Tamb√©m estamos tornando Eric Raymond chamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arqueologia de c√≥digo,</a> limpando a base de c√≥digo e atualizando componentes que perderam relev√¢ncia nos √∫ltimos tr√™s anos. <br><br>  <i><b>Nota</b></i>  <i><b>perev.</b></i>  <i>: √â um paradoxo, mas o gerenciador de pacotes do Helm 2, quando a <code>install</code> ou <code>upgrade</code> bem <code>upgrade</code> sucedida, ou seja,</i>  <i>ter libera√ß√£o no estado de <code>success</code> n√£o garante que os recursos do aplicativo tenham sido implementados com √™xito (por exemplo, n√£o h√° erros como <code>ImagePullError</code> ).</i>  <i>Talvez o novo modelo de evento permita adicionar ganchos adicionais para recursos e controlar melhor o processo de lan√ßamento - descobriremos em breve.</i> <br><br>  Com a ades√£o do Helm ao CNCF, n√£o apenas o Helm 3, mas tamb√©m o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Chart Museum</a> , o maravilhoso utilit√°rio de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">teste de gr√°ficos</a> , o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio oficial de gr√°ficos</a> e outros projetos sob os ausp√≠cios do Helm no CNCF nos inspiram.  Estamos confiantes de que o bom gerenciamento de pacotes do Kubernetes √© t√£o importante para o ecossistema nativo da nuvem quanto os bons gerenciadores de pacotes do Linux. <br><br><h2>  PS do tradutor </h2><br>  Leia tamb√©m em nosso blog: <br><br><ul><li>  ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Uma introdu√ß√£o pr√°tica ao gerenciador de pacotes do Kubernetes - Helm</a> ‚Äù; </li><li>  ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pratique com dapp.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2. Implanta√ß√£o de imagens do Docker no Kubernetes usando Helm</a> "; </li><li>  ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Construa e instale aplicativos no Kubernetes usando dapp e GitLab CI</a> ‚Äù; </li><li>  ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Melhores pr√°ticas de CI / CD com Kubernetes e GitLab</a> ‚Äù <i>(revis√£o e relat√≥rio de v√≠deo)</i> ; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nossa experi√™ncia com o Kubernetes em pequenos projetos</a> " <i>(reportagem em v√≠deo, que inclui uma introdu√ß√£o ao dispositivo t√©cnico do Kubernetes).</i> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt417079/">https://habr.com/ru/post/pt417079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt417065/index.html">Instru√ß√µes do Splunk, ou Como e Onde Aprender o Splunk</a></li>
<li><a href="../pt417069/index.html">Mais uma vez sobre o OpenSSL</a></li>
<li><a href="../pt417071/index.html">Sexta-feira PHP: Webinars gratuitos do Skillbox</a></li>
<li><a href="../pt417073/index.html">Dia do desenvolvedor do Uber Mobile</a></li>
<li><a href="../pt417075/index.html">API de pintura CSS</a></li>
<li><a href="../pt417081/index.html">Norte, vontade, pa√≠s sem fronteiras, ou Como os projetos s√£o feitos em condi√ß√µes siberianas severas</a></li>
<li><a href="../pt417083/index.html">Cargas altas da Copa do Mundo de 2018</a></li>
<li><a href="../pt417085/index.html">Os navegadores silenciam o som no seu aplicativo WebRTC. Parar o que?</a></li>
<li><a href="../pt417087/index.html">HPE Digitize 2018: evento e transmiss√£o ao vivo</a></li>
<li><a href="../pt417089/index.html">Computador qu√¢ntico: um f√≥ton para dominar tudo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>