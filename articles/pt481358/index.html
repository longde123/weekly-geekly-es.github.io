<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõåüèΩ üëåüèæ ü§≥üèº C ++ R√∫ssia: como foi üêì ü¶ë üë©‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se, no in√≠cio da pe√ßa, voc√™ diz que o c√≥digo C ++ est√° pendurado na parede, ent√£o, no final, ele certamente deve lhe dar um tiro no p√©. 

 Bjarne Stro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C ++ R√∫ssia: como foi</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hsespb/blog/481358/">  <i>Se, no in√≠cio da pe√ßa, voc√™ diz que o c√≥digo C ++ est√° pendurado na parede, ent√£o, no final, ele certamente deve lhe dar um tiro no p√©.</i> <i><br><br></i>  <i>Bjarne Stroustrup</i> <i><br></i> <br>  De 31 de outubro a 1 de novembro, S√£o Petersburgo sediou a C ++ Russia Piter Conference, uma das maiores confer√™ncias de programa√ß√£o na R√∫ssia, organizada pelo JUG Ru Group.  Entre os palestrantes convidados est√£o membros do comit√™ de padroniza√ß√£o do C ++, palestrantes do CppCon, autores de livros de O'Reilly, al√©m de mantenedores de projetos como LLVM, libc ++ e Boost.  A confer√™ncia √© destinada a desenvolvedores experientes em C ++ que desejam aprofundar seus conhecimentos e trocar experi√™ncias em comunica√ß√£o ao vivo.  Estudantes, estudantes de gradua√ß√£o e professores universit√°rios recebem descontos muito agrad√°veis. <br><br>  A edi√ß√£o de Moscou da confer√™ncia j√° pode ser visitada em abril do pr√≥ximo ano, mas, por enquanto, nossos alunos contar√£o as coisas interessantes que aprenderam no √∫ltimo evento. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a73/7bf/78f/a737bf78fa7a626dc60d87aae2d2ce88.png"><br><a name="habracut"></a><br>  <i>Foto do <a href="https://vk.com/album-77278886_270140987">√°lbum da confer√™ncia</a></i> <br><br><h2>  Sobre n√≥s </h2><br>  Dois alunos da Escola Superior de Economia - S√£o Petersburgo, trabalharam neste post: <br><br><ul><li>  Lisa Vasilenko √© uma aluna do 4¬∫ ano que estuda a dire√ß√£o de "Linguagens de Programa√ß√£o" como parte do programa "Matem√°tica Aplicada e Ci√™ncia da Computa√ß√£o".  Familiarizado com a linguagem C ++ no primeiro ano da universidade, posteriormente adquiriu experi√™ncia trabalhando com ela em est√°gios na ind√∫stria.  A paix√£o pelas linguagens de programa√ß√£o em geral e pela programa√ß√£o funcional em particular deixou sua marca na escolha dos relat√≥rios na confer√™ncia. <br></li><li>  Danya Smirnov √© uma aluna do primeiro ano do programa de mestrado ‚ÄúPrograma√ß√£o e An√°lise de Dados‚Äù.  Enquanto ainda estava na escola, ele escreveu problemas das Olimp√≠adas em C ++ e, de alguma forma, aconteceu que o idioma aparecia constantemente nas atividades educacionais e, como resultado, tornou-se o principal trabalho.  Decidi participar da confer√™ncia para aprimorar meu conhecimento e aprender sobre novas oportunidades. <br></li></ul><br>  No boletim, os l√≠deres do corpo docente costumam compartilhar informa√ß√µes sobre eventos educacionais relacionados √† nossa especialidade.  Em setembro, vimos informa√ß√µes sobre C ++ R√∫ssia e decidimos nos registrar como ouvintes.  Esta √© a nossa primeira experi√™ncia de participa√ß√£o em tais confer√™ncias. <br><br><h2>  Estrutura da Confer√™ncia </h2><br><ul><li><h3>  Relat√≥rios </h3></li></ul><br>  Ao longo de dois dias, os especialistas leram 30 relat√≥rios destacando muitos t√≥picos importantes: aplicativos espirituosos de recursos de linguagem para resolver problemas aplicados, atualiza√ß√µes futuras de idiomas devido ao novo padr√£o, comprometimentos no design e precau√ß√µes em C ++ ao trabalhar com suas consequ√™ncias, exemplos de arquitetura de projeto interessante, bem como algumas partes do mecanismo da infraestrutura de idiomas.  Ao mesmo tempo, ocorreram tr√™s apresenta√ß√µes, na maioria das vezes duas em russo e uma em ingl√™s. <br><br><ul><li><h3>  Zonas de discuss√£o </h3></li></ul><br>  Ap√≥s o discurso, todas as perguntas n√£o respondidas e discuss√µes incompletas foram transferidas para √°reas de comunica√ß√£o especialmente designadas com alto-falantes equipados com placas de identifica√ß√£o.  Uma boa maneira de passar o intervalo entre as apresenta√ß√µes para uma conversa agrad√°vel. <br><br><ul><li><h3>  Lightning Talks e discuss√µes informais </h3></li></ul><br>  Se voc√™ quiser fazer um breve relat√≥rio, poder√° se inscrever para uma Lightning Talk √† noite em um quadro de marcadores e ter cinco minutos para conversar sobre qualquer assunto sobre o t√≥pico da confer√™ncia.  Por exemplo, uma r√°pida introdu√ß√£o aos desinfetantes para C ++ (que acabou sendo nova para alguns) ou uma hist√≥ria sobre um bug na gera√ß√£o de um sinus√≥ide que voc√™ s√≥ pode ouvir, mas n√£o v√™. <br><br>  Outro formato √© o painel de discuss√£o ‚ÄúCom o Comit√™ da Alma‚Äù.  No palco, h√° alguns membros do comit√™ de padroniza√ß√£o; no projetor, h√° uma lareira (oficialmente - para criar uma atmosfera de alma, mas a raz√£o "porque TUDO EM FOGO" parece mais engra√ßado), as perguntas s√£o sobre a vis√£o geral e padr√£o do C ++, sem discuss√µes t√©cnicas e holivars acalorados.  Verificou-se que as pessoas vivas tamb√©m fazem parte do comit√™, que pode n√£o estar completamente certo de algo ou pode n√£o saber de nada. <br><br>  Para os entusiastas do holivar, o terceiro evento permaneceu - a sess√£o do BOF "Go against C ++".  Levamos um amante do Go, um amante do C ++, antes do in√≠cio da sess√£o, eles preparam 100500 slides sobre o t√≥pico juntos (como problemas com pacotes em C ++ ou falta de gen√©ricos no Go) e depois discutem animadamente entre si e o p√∫blico, e o p√∫blico tenta entender dois pontos de vista ao mesmo tempo .  Se o holivar n√£o iniciar os neg√≥cios, o moderador interv√©m e reconcilia as partes.  Esse formato √© viciante: algumas horas ap√≥s o in√≠cio, apenas metade dos slides foi conclu√≠da.  O fim teve que ser muito acelerado. <br><br><ul><li><h3>  Stands de parceiros </h3></li></ul><br>  Os parceiros da confer√™ncia estavam representados nos corredores - eles conversaram sobre projetos atuais nas estandes, ofereceram est√°gios e empregos, realizaram quizzes e pequenas competi√ß√µes e tamb√©m tiveram √≥timos pr√™mios.  No entanto, algumas empresas at√© se ofereceram para passar pelas etapas iniciais das entrevistas, o que pode ser √∫til para aqueles que vieram n√£o apenas ouvir os relat√≥rios. <br><br><h2>  Detalhes t√©cnicos dos relat√≥rios </h2><br>  Ouvimos relat√≥rios nos dois dias.  √Äs vezes, era dif√≠cil escolher um relat√≥rio entre os que estavam sendo executados em paralelo - concordamos em compartilhar e trocar o conhecimento adquirido durante os intervalos.  E mesmo assim, parece que muito se perdeu.  Aqui gostar√≠amos de falar sobre o conte√∫do de alguns relat√≥rios que nos pareceram os mais interessantes <br><br><h3>  Exce√ß√µes em C ++ atrav√©s do prisma das otimiza√ß√µes do compilador, Roman Rusyaev </h3><br><br><img src="https://habrastorage.org/webt/dc/0q/rl/dc0qrlgt1peqimzact93fvh8zb0.png"><br>  <i>Slide de <a href="https://assets.ctfassets.net/oxjq45e8ilak/3zTOtMpTyFdmP3vxsQ9xoc/40e5a0892609b16f822120813f5f0823/100554_1921552449_Adi_Shavit_Generators_coroutines_and_other_brain-unrolling_sweetness.pdf">apresenta√ß√£o</a></i> <br><br>  Como o nome indica, Roman procurou trabalhar com exce√ß√µes usando o LLVM como exemplo.  Ao mesmo tempo, para aqueles que n√£o usam o Clang em seus trabalhos, o relat√≥rio ainda pode dar uma id√©ia de como o c√≥digo pode ser otimizado.  Isso ocorre porque os desenvolvedores de compiladores e as bibliotecas padr√£o correspondentes se comunicam entre si e muitas solu√ß√µes bem-sucedidas podem coincidir. <br><br>  Portanto, para lidar com a exce√ß√£o, √© necess√°rio executar v√°rias a√ß√µes: chame o c√≥digo de processamento (se houver) ou libere recursos no n√≠vel atual e relaxe a pilha mais alto.  Tudo isso leva ao fato de que o compilador adiciona instru√ß√µes adicionais para lan√ßar chamadas em potencial.  Portanto, se uma exce√ß√£o de fato n√£o for causada, o programa ainda come√ßar√° a executar a√ß√µes desnecess√°rias.  Para reduzir de alguma forma os custos indiretos, o LLVM possui v√°rias heur√≠sticas para determinar situa√ß√µes em que voc√™ n√£o precisa adicionar um c√≥digo de tratamento de exce√ß√£o ou pode reduzir o n√∫mero de instru√ß√µes "desnecess√°rias". <br><br>  O palestrante considera cerca de uma d√∫zia deles e mostra as situa√ß√µes em que eles ajudam a acelerar a execu√ß√£o do programa e aquelas em que esses m√©todos n√£o s√£o aplic√°veis. <br><br>  Assim, Roman Rusyaev leva o p√∫blico √† conclus√£o de que o c√≥digo que cont√©m o trabalho com exce√ß√µes nem sempre pode ser executado com zero de sobrecarga e fornece as seguintes dicas: <br><br><ul><li>  ao desenvolver bibliotecas, voc√™ deve abandonar as exce√ß√µes em princ√≠pio; </li><li>  se voc√™ ainda precisar de exce√ß√µes, sempre que poss√≠vel, vale a pena adicionar modificadores noexcept (e const) para que o compilador possa otimizar o m√°ximo poss√≠vel. </li></ul><br>  Em geral, o orador reiterou a vis√£o de que as exce√ß√µes s√£o melhor usadas ao m√≠nimo, ou mesmo as abandonam. <br><br>  Os slides do relat√≥rio est√£o dispon√≠veis em: <a href="https://assets.ctfassets.net/oxjq45e8ilak/6Q09SPvX2Rsveiayc1VkcC/ce9e2b8eb22d6693eb4c3b06968bedc0/100693_477384438_Roman_Rusyayev_Isklyucheniya_C_cherez_prizmu_kompilyatornykh_optimizatsiy.pdf">["Exce√ß√µes em C ++ atrav√©s do prisma da otimiza√ß√£o do compilador LLVM"]</a> <br><br><h3>  Geradores, corotinas e outras do√ßuras que desenrolam o c√©rebro, Adi Shavit </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/d20/0c4/4a6/d200c44a65058c3b50a29d0b551a9cc0.png"><br>  <i>Slide de <a href="https://assets.ctfassets.net/oxjq45e8ilak/3zTOtMpTyFdmP3vxsQ9xoc/40e5a0892609b16f822120813f5f0823/100554_1921552449_Adi_Shavit_Generators_coroutines_and_other_brain-unrolling_sweetness.pdf">apresenta√ß√£o</a></i> <br><br>  Um dos muitos relat√≥rios desta confer√™ncia dedicados √†s inova√ß√µes do C ++ 20 foi lembrado n√£o apenas por sua apresenta√ß√£o colorida, mas tamb√©m por sua clara designa√ß√£o dos problemas com a l√≥gica de processamento de cole√ß√µes (para loop de retorno de chamada). <br><br>  Adi Shavit destaca o seguinte: os m√©todos atualmente dispon√≠veis percorrem toda a cole√ß√£o e n√£o d√£o acesso a algum estado intermedi√°rio interno (ou no caso de retornos de chamada, mas com muitos efeitos colaterais desagrad√°veis, como o mesmo inferno de retorno de chamada).  Parece que existem iteradores, mas nem tudo √© t√£o f√°cil com eles: n√£o h√° pontos de entrada e sa√≠da comuns (come√ßo ‚Üí fim versus rbegin ‚Üí rend e assim por diante), n√£o est√° claro quanto vamos iterar.  Come√ßando com C ++ 20, esses problemas foram resolvidos! <br><br>  A primeira op√ß√£o: intervalos.  Devido ao wrapper na parte superior dos iteradores, obtemos uma interface comum para o in√≠cio e o final da itera√ß√£o, al√©m da possibilidade de composi√ß√£o.  Tudo isso facilita a constru√ß√£o de pipelines completos de processamento de dados.  Mas nem tudo √© t√£o tranquilo: parte da l√≥gica dos c√°lculos est√° na implementa√ß√£o de um iterador espec√≠fico, que pode complicar o c√≥digo de percep√ß√£o e depura√ß√£o. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f41/a7d/09d/f41a7d09d24a823a3397aa27a552f254.png"><br>  <i>Slide de <a href="https://assets.ctfassets.net/oxjq45e8ilak/3zTOtMpTyFdmP3vxsQ9xoc/40e5a0892609b16f822120813f5f0823/100554_1921552449_Adi_Shavit_Generators_coroutines_and_other_brain-unrolling_sweetness.pdf">apresenta√ß√£o</a></i> <br><br>  Bem, neste caso, foram adicionadas corotinas no C ++ 20 (fun√ß√µes cujo comportamento √© semelhante aos geradores em Python): a execu√ß√£o pode ser adiada retornando algum valor atual, mantendo o estado intermedi√°rio.  Assim, conseguimos n√£o apenas trabalhar com dados como eles aparecem, mas tamb√©m encapsular toda a l√≥gica dentro de uma determinada rotina. <br><br>  Mas h√° uma mosca na pomada: no momento, eles s√£o apenas parcialmente suportados pelos compiladores existentes e tamb√©m n√£o s√£o implementados com a precis√£o que gostar√≠amos: por exemplo, links e objetos tempor√°rios n√£o devem ser usados ‚Äã‚Äãem corotinas.  Al√©m disso, existem algumas restri√ß√µes sobre o que podem ser corotinas, e as fun√ß√µes constexpr, construtores / destruidores e tamb√©m as principais n√£o est√£o inclu√≠das nesta lista. <br><br>  Assim, as corotinas resolvem uma parte significativa dos problemas com a simplicidade da l√≥gica de processamento de dados, mas suas implementa√ß√µes atuais exigem refinamento. <br><br>  Materiais: <br><br><ul><li>  Slides com C ++ Russia - <a href="https://assets.ctfassets.net/oxjq45e8ilak/3zTOtMpTyFdmP3vxsQ9xoc/40e5a0892609b16f822120813f5f0823/100554_1921552449_Adi_Shavit_Generators_coroutines_and_other_brain-unrolling_sweetness.pdf">["Geradores, corotinas e outras do√ßuras que desenrolam o c√©rebro"]</a> </li><li>  <a href="https://youtu.be/qYHDERleSL8">Relat√≥rio de v√≠deo do CppCon 2019</a> </li></ul><br><h3>  Truques em C ++ de Yandex.Taxi, Anton Polukhin </h3><br>  Em sua atividade profissional, √†s vezes voc√™ precisa implementar coisas puramente auxiliares: um inv√≥lucro entre a interface interna e a API de alguma biblioteca, registrando ou analisando.  No entanto, geralmente n√£o h√° necessidade de qualquer otimiza√ß√£o adicional.  Mas e se esses componentes forem usados ‚Äã‚Äãem alguns dos servi√ßos mais populares do Runet?  Em tal situa√ß√£o, voc√™ ter√° que processar apenas terabytes por hora de logs!  Cada milissegundo conta e, portanto, voc√™ precisa recorrer a v√°rios truques - Anton Polukhin falou sobre eles. <br><br>  Talvez o exemplo mais interessante tenha sido a implementa√ß√£o do padr√£o ponteiro para implementa√ß√£o (pimpl). <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;third_party/json.hpp&gt; //PROBLEMS! struct Value { Value() = default; Value(Value&amp;&amp; other) = default; Value&amp; operator=(Value&amp;&amp; other) = default; ~Value() = default; std::size_t Size() const { return data_.size(); } private: third_party::Json data_; };</span></span></span></span></code> </pre> <br>  Neste exemplo, primeiro voc√™ deseja se livrar dos arquivos de cabe√ßalho das bibliotecas externas - eles ser√£o compilados mais rapidamente e voc√™ pode se proteger de poss√≠veis conflitos de nome e outros erros semelhantes. <br><br>  Ok, movemos #include para o arquivo .cpp: voc√™ precisa da declara√ß√£o de encaminhamento da API agrupada, al√©m de std :: unique_ptr.  Agora, temos aloca√ß√µes din√¢micas e outras coisas desagrad√°veis, como dados espalhados por uma pilha e garantias reduzidas.  Com tudo isso, std :: align_storage pode ajudar. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Value</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... private: using JsonNative = third_party::Json; const JsonNative* Ptr() const noexcept; JsonNative* Ptr() noexcept; constexpr std::size_t kImplSize = 32; constexpr std::size_t kImplAlign = 8; std::aligned_storage_t&lt;kImplSize, kImplAlign&gt; data_; };</span></span></code> </pre> <br>  O √∫nico problema: voc√™ precisa especificar o tamanho e o alinhamento de cada inv√≥lucro - criaremos nosso modelo pimpl com os par√¢metros &lt;T, SizeT, AlignmentT&gt;, usaremos alguns valores arbitr√°rios e adicionaremos ao destruidor uma verifica√ß√£o para adivinhar tudo: <br><br><pre> <code class="cpp hljs">~FastPimpl() <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { validate&lt;<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(T), <span class="hljs-keyword"><span class="hljs-keyword">alignof</span></span>(T)&gt;(); Ptr()-&gt;~T(); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> ActualSize, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> ActualAlignment&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span>( Size == ActualSize, <span class="hljs-string"><span class="hljs-string">"Size and sizeof(T) mismatch"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span>( Alignment == ActualAlignment, <span class="hljs-string"><span class="hljs-string">"Alignment and alignof(T) mismatch"</span></span> ); }</code> </pre> <br>  Como T j√° foi determinado durante o processamento do destruidor, esse c√≥digo ser√° desmontado corretamente e, no est√°gio de compila√ß√£o na forma de erros, exibir√° os valores de tamanho e alinhamento necess√°rios que precisam ser inseridos.  Assim, ao custo de um in√≠cio adicional de compila√ß√£o, nos livramos da aloca√ß√£o din√¢mica de classes agrupadas, ocultamos a API em um arquivo .cpp com a implementa√ß√£o e tamb√©m obtemos um design mais adequado para armazenamento em cache pelo processador. <br><br>  O registro e a an√°lise pareciam menos impressionantes e, portanto, n√£o ser√£o mencionados nesta revis√£o. <br><br>  Os slides do relat√≥rio est√£o dispon√≠veis no link: <a href="https://assets.ctfassets.net/oxjq45e8ilak/4rkoaQV6ancsfvzYx1fOCF/087dda7d63101cc225d706d03d7c5075/100566_2093066332_Anton_Polukhin_C_tryuki_iz_Taksi.pdf">["C ++ Taxi Tricks"]</a> <br><br><h3>  T√©cnicas modernas para manter seu c√≥digo SECO, Bj√∂rn Fahller </h3><br>  Nesta palestra, Bj√∂rn Fahller mostra v√°rias maneiras diferentes de lidar com falhas estil√≠sticas, como repetidas verifica√ß√µes condicionais: <br><br><pre> <code class="cpp hljs">assert(a == IDLE || a == CONNECTED || a == DISCONNECTED);</code> </pre> <br>  Isso √© familiar?  Usando v√°rias t√©cnicas C ++ poderosas que apareceram nos padr√µes recentes, voc√™ pode implementar normalmente a mesma funcionalidade sem a menor perda de desempenho.  Compare: <br><br><pre> <code class="cpp hljs">assert(a == any_of(IDLE, CONNECTED, DISCONNECTED));</code> </pre> <br>  Para processar um n√∫mero ilimitado de verifica√ß√µes, voc√™ √© solicitado imediatamente a usar modelos variados e express√µes de dobra.  Suponha que desejamos verificar a igualdade de v√°rias vari√°veis ‚Äã‚Äãcom o elemento enum'a state_type.  A primeira coisa que vem √† mente √© escrever a fun√ß√£o auxiliar is_any_of: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> state_type { IDLE, CONNECTED, DISCONNECTED }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ... Ts&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_any_of</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state_type s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Ts&amp; ... ts)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((s == ts) || ...); }</code> </pre><br>  Um resultado t√£o intermedi√°rio √© decepcionante.  At√© agora, o c√≥digo n√£o est√° se tornando leg√≠vel: <br><br><pre> <code class="cpp hljs">assert(is_any_of(state, IDLE, DISCONNECTING, DISCONNECTED));</code> </pre> <br>  Par√¢metros de modelo n√£o-tipo ajudar√£o a melhorar um pouco a situa√ß√£o.  Com a ajuda deles, transferimos os elementos enumerados para a lista de par√¢metros do modelo: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;state_type ... states&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_any_of</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state_type t)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((t == states) | ...); } assert(is_any_of&lt;IDLE, DISCONNECTING, DISCONNECTED&gt;(state));</code> </pre> <br>  Usando auto em um par√¢metro de modelo n√£o t√≠pico (C ++ 17), a abordagem √© simplesmente generalizada para compara√ß√µes n√£o apenas com elementos state_type, mas tamb√©m com tipos primitivos que podem ser usados ‚Äã‚Äãcomo par√¢metros de modelo n√£o-tipo: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> ... alternatives, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_any_of</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; t)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((t == alternatives) | ...); }</code> </pre> <br>  Por meio dessas melhorias incrementais, √© alcan√ßada a sintaxe superficial desejada para verifica√ß√£o: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> ... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">any_of</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::tuple&lt;Ts ...&gt; { <span class="hljs-comment"><span class="hljs-comment">//      tuple        using std::tuple&lt;Ts ...&gt;::tuple;        template &lt;typename T&gt;        bool operator ==(const T&amp; t) const {                return std::apply(                        [&amp;t](const auto&amp; ... ts) {                                return ((ts == t) || ...);                        },                        static_cast&lt;const std::tuple&lt;Ts ...&gt;&amp;&gt;(*this));        } }; template &lt;class ... Ts&gt; any_of(Ts ...) -&gt; any_of&lt;Ts ... &gt;; assert(any_of(IDLE, DISCONNECTING, DISCONNECTED) == state);</span></span></code> </pre><br>  Neste exemplo, o guia de dedu√ß√£o serve para solicitar os par√¢metros desejados da estrutura do modelo para um compilador que conhece os tipos de argumentos do construtor. <br><br>  Mais interessante.  Bjorn ensina a generalizar o c√≥digo resultante para operadores de compara√ß√£o, al√©m de == e, em seguida, para opera√ß√µes arbitr√°rias.  Juntamente com o exemplo de uso, s√£o explicados recursos como o atributo no_unique_address (C ++ 20) e par√¢metros de modelo nas fun√ß√µes lambda (C ++ 20).  (Sim, agora a sintaxe lambda √© ainda mais f√°cil de lembrar - s√£o quatro pares consecutivos de colchetes de todos os tipos.) A solu√ß√£o final usando fun√ß√µes como partes construtoras realmente aquece minha alma, sem mencionar a express√£o de tupla nas melhores tradi√ß√µes do c√°lculo lambda. <br><br>  No final, n√£o esque√ßa de colocar um gloss: <br><br><ul><li>  Lembre-se de que as lambdas s√£o gratuitas; </li><li>  Adicione encaminhamento perfeito e observe sua sintaxe feia aplicada ao pacote de par√¢metros no fechamento lambda; </li><li>  Vamos dar ao compilador mais op√ß√µes para otimiza√ß√µes com exce√ß√£o condicional; </li><li>  N√≥s cuidaremos de uma sa√≠da de erro mais clara nos modelos devido aos valores de retorno expl√≠citos das lambdas.  Isso for√ßar√° o compilador a fazer mais verifica√ß√µes antes de realmente chamar a fun√ß√£o de modelo - no est√°gio de verifica√ß√£o de tipo. </li></ul><br>  Para detalhes, consulte os materiais da palestra: <br><br><ul><li>  Slides do relat√≥rio: <a href="https://assets.ctfassets.net/oxjq45e8ilak/7lP3ueTFEJnmdVjGGjrgHI/e30dfcbff0630fb63389f3f3e734a1a3/100644_2039674689_Bjrn_Fahller_Modern_techniques_for_keeping_your_code_dry.pdf">[T√©cnicas modernas para manter seu c√≥digo seco]</a> </li><li>  <a href="https://github.com/rollbear/dry-comparisons">C√≥digo fonte do Github</a> </li><li>  <a href="https://playfulprogramming.blogspot.com/2018/07/dry-multicomparisons.html">Artigo do blog do autor</a> </li></ul><br><h2>  Nossas impress√µes </h2><br>  Nossa primeira participa√ß√£o no C ++ Russia foi lembrada por sua riqueza.  Havia uma impress√£o de C ++ R√∫ssia como um evento emocional, onde a linha entre aprendizado e comunica√ß√£o ao vivo quase n√£o √© percept√≠vel.  Tudo, desde o humor dos palestrantes at√© as competi√ß√µes dos parceiros do evento, √© prop√≠cio para discuss√µes acaloradas.  O conte√∫do da confer√™ncia, que consiste em relat√≥rios, abrange uma ampla gama de t√≥picos, incluindo inova√ß√µes em C ++, exemplos da pr√°tica de grandes projetos e considera√ß√µes ideol√≥gicas da arquitetura.  Mas seria injusto privar a aten√ß√£o do componente social do evento, o que ajuda a superar barreiras lingu√≠sticas em rela√ß√£o n√£o apenas ao C ++. <br><br>  Agradecemos aos organizadores da confer√™ncia pela oportunidade de participar de um evento como esse! <br>  Voc√™ pode ver a postagem dos organizadores sobre o passado, presente e futuro do C ++ Russia <a href="https://habr.com/ru/company/jugru/blog/480584/">no blog JUG Ru</a> . <br><br>  Obrigado pela leitura e esperamos que nossa recontagem dos eventos tenha sido √∫til! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt481358/">https://habr.com/ru/post/pt481358/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt481348/index.html">Pentest Active Directory. Parte 1</a></li>
<li><a href="../pt481350/index.html">Quem trabalha no cosm√≥dromo de Plesetsk</a></li>
<li><a href="../pt481352/index.html">DBA: limpando registros de clones de uma tabela sem PK</a></li>
<li><a href="../pt481354/index.html">TelegramBot. A funcionalidade b√°sica. Voa separadamente, costeletas separadamente. (Parte 2)</a></li>
<li><a href="../pt481356/index.html">Obrigado, 2019</a></li>
<li><a href="../pt481360/index.html">Os resultados da semana: Rambler e Twitch concordaram, o trabalho eletr√¥nico ser√° introduzido na Federa√ß√£o Russa e o Facebook criar√° seu pr√≥prio sistema operacional</a></li>
<li><a href="../pt481362/index.html">Certificado SSL para aplicativo da web Docker</a></li>
<li><a href="../pt481364/index.html">Casa sens√≠vel est√° substituindo casas inteligentes</a></li>
<li><a href="../pt481366/index.html">RICE: F√°cil Prioriza√ß√£o para Gerentes de Produto</a></li>
<li><a href="../pt481368/index.html">Teste cego da c√¢mera: iPhone, Pixel, Samsung e Huawei</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>