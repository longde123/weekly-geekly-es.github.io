<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßîüèø üìï üéôÔ∏è Operador de kubernetes de Tarantool ‚ñ™Ô∏è ‚ò¶Ô∏è üé≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kubernetes se est√° convirtiendo en el est√°ndar de facto para ejecutar aplicaciones sin estado. Principalmente porque puede reducir significativamente ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Operador de kubernetes de Tarantool</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/465823/"><img src="https://habrastorage.org/webt/pm/mm/lk/pmmmlkexzrcniami66ljv1ynirg.jpeg"><br><br>  Kubernetes se est√° convirtiendo en el est√°ndar de facto para ejecutar aplicaciones sin estado.  Principalmente porque puede reducir significativamente el tiempo de comercializaci√≥n para la entrega de nuevas funciones.  El lanzamiento de aplicaciones con estado (bases de datos, microservicios con estado) sigue siendo una tarea dif√≠cil, pero la necesidad de resistir la competencia y mantener una alta tasa de entrega empuja a las empresas a experimentar en esta √°rea y crea una demanda de tales soluciones. <br><br>  Le presentamos nuestra soluci√≥n para el lanzamiento de cl√∫steres con estado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">. Cartucho de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tarantool</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Operador de Tarantool Kubernetes</a> , para obtener m√°s detalles, pido en cat. <br><a name="habracut"></a><br>  Tabla de contenido: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En lugar de mil palabras</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øQu√© hace el operador?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Un poco sobre los matices.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo funciona el operador</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lo que el operador expande</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Resumen</a> </li></ol><br><br>  Tarantool es una base de datos de c√≥digo abierto y un servidor de aplicaciones en un solo paquete.  Como base de datos, tiene una serie de caracter√≠sticas √∫nicas: alta eficiencia de utilizaci√≥n de hierro, esquema de datos flexible, soporte para almacenamiento en disco y en memoria, y la posibilidad de expansi√≥n mediante el uso del lenguaje Lua.  Como servidor de aplicaciones, le permite mover el c√≥digo de la aplicaci√≥n lo m√°s cerca posible de los datos, al tiempo que logra un tiempo de respuesta m√≠nimo y un rendimiento m√°ximo.  Adem√°s, Tarantool tiene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un extenso ecosistema</a> , que proporciona m√≥dulos listos para resolver problemas de aplicaci√≥n: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fragmentaci√≥n</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cola</a> , m√≥dulos para facilitar el desarrollo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cartucho</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">luatest</a> ), soluciones para la operaci√≥n ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√©trica</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ansible</a> ): estos son solo algunos ejemplos. <br><br>  Por todos sus m√©ritos, las posibilidades de una instancia de Tarantool no son ilimitadas: para almacenar terabytes de datos y procesar millones de solicitudes, debe generar decenas y cientos de instancias, y este es un sistema distribuido con todos sus problemas inherentes.  Para resolverlos, tenemos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tarantool Cartridge</a> , un marco cuya tarea principal es ocultar todo tipo de dificultades para escribir aplicaciones distribuidas y permitir a los desarrolladores centrarse en el valor comercial de la aplicaci√≥n.  Cartridge proporciona un poderoso conjunto de componentes para la organizaci√≥n autom√°tica de cl√∫steres, distribuci√≥n autom√°tica de datos, webui para operaci√≥n y herramientas de desarrollo. <br><br>  Tarantool no es solo tecnolog√≠a, sino tambi√©n un equipo de ingenieros que se dedican al desarrollo de sistemas empresariales llave en mano, soluciones de caja y soporte para componentes de c√≥digo abierto. <br><br>  A nivel mundial, nuestras tareas se pueden dividir en dos √°reas: el desarrollo de nuevos sistemas y el aumento de las soluciones existentes.  Por ejemplo, hay una gran base de un vendedor famoso.  Para escalarlo para leer, pusieron un cach√© finalmente consistente en Tarantool detr√°s de √©l.  O viceversa: para escalar la grabaci√≥n, ponen Tarantool en la configuraci√≥n fr√≠o / calor, donde a medida que se "enfr√≠an" los datos se vuelcan al almacenamiento en fr√≠o y en paralelo a la cola de an√°lisis.  O para realizar una copia de seguridad de un sistema existente, se escribe una versi√≥n ligera de este sistema (reserva funcional), que reserva el principal "activo" con la replicaci√≥n de datos del sistema principal.  Se puede encontrar m√°s informaci√≥n en los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informes de T + 2019</a> . <br><br>  Todos estos sistemas tienen una cosa en com√∫n: son bastante dif√≠ciles de operar.  Implemente r√°pidamente un cl√∫ster de m√°s de 100 instancias con redundancia en 3 centros de datos, actualice una aplicaci√≥n que almacene datos sin tiempo de inactividad y reducciones de mantenimiento, realice una restauraci√≥n de respaldo en caso de cat√°strofe o errores provocados por el hombre, garantice una conmutaci√≥n por error discreta de los componentes, organice la administraci√≥n de la configuraci√≥n ... En general, hay mucho interesante <br><br>  Y ser√≠a genial si todo esto se operara tan simplemente como se est√° desarrollando.  Kubernetes hace posible lograr el resultado deseado, pero el uso de un operador especializado facilita a√∫n m√°s la vida. <br><br><a name="1"></a><h2>  En lugar de mil palabras </h2><br>  Hemos preparado un peque√±o ejemplo basado en el cartucho de Tarantool, y trabajaremos con √©l.  Una aplicaci√≥n simple como "almacenamiento de valor clave distribuido con interfaz HTTP".  Despu√©s del lanzamiento, obtenemos esta imagen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c24/235/2c7/c242352c708a0e0dfa8fc0896bbb986d.png"><br><br>  Donde: <br><br><ul><li>  Enrutadores: la parte del cl√∫ster responsable de aceptar y procesar las solicitudes HTTP entrantes; <br></li><li>  Los almacenamientos son la parte del cl√∫ster que es responsable del almacenamiento y el procesamiento de datos, 3 fragmentos se levantan de la caja, en cada maestro y r√©plica. <br></li></ul><br>  Para equilibrar el tr√°fico HTTP entrante en los enrutadores, se utiliza el Ingreso Kubernetian.  Los datos se distribuyen en el almacenamiento al nivel de Tarantool utilizando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el componente vshard</a> . <br><br>  Necesitamos kubernetes 1.14+, minikube <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">funcionar√°</a> .  Adem√°s, la disponibilidad de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">kubectl</a> no afectar√°.  Para iniciar el operador, debe crear una cuenta de servicio, rol y enlace de rol para √©l: <br><br><pre><code class="bash hljs">$ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/service_account.yaml $ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/role.yaml $ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/role_binding.yaml</code> </pre> <br>  Tarantool Operator extiende la API de Kubernetes con sus definiciones de recursos, las crearemos: <br><br><pre> <code class="bash hljs">$ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/crds/tarantool_v1alpha1_cluster_crd.yaml $ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/crds/tarantool_v1alpha1_role_crd.yaml $ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/crds/tarantool_v1alpha1_replicasettemplate_crd.yaml</code> </pre> <br>  Todo est√° listo para lanzar el operador, vamos: <br><br><pre> <code class="bash hljs">$ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/operator.yaml</code> </pre> <br>  Estamos esperando que comience el operador y podemos proceder a iniciar la aplicaci√≥n: <br><br><pre> <code class="bash hljs">$ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/examples/kv/deployment.yaml</code> </pre> <br>  En el archivo yaml con el ejemplo, Ingress se declara en la interfaz de usuario web;  Est√° disponible en <code>cluster_ip/admin/cluster</code> .  Cuando al menos un Pod de Ingress est√° activo, puede ir all√≠ y ver c√≥mo se agregan nuevas instancias al cl√∫ster y c√≥mo cambia su topolog√≠a. <br><br>  Estamos esperando que se use el cl√∫ster: <br><br><pre> <code class="bash hljs">$ kubectl describe clusters.tarantool.io examples-kv-cluster</code> </pre> <br>  Esperamos que en el estado del cl√∫ster haya lo siguiente: <br><br><pre> <code class="plaintext hljs">‚Ä¶ Status: State: Ready ‚Ä¶</code> </pre> <br>  ¬°Todo, la aplicaci√≥n est√° lista para usar! <br><br>  ¬øNecesitas m√°s espacio de almacenamiento?  Agregar fragmentos: <br><br><pre> <code class="bash hljs">$ kubectl scale roles.tarantool.io storage --replicas=3</code> </pre> <br>  Los fragmentos no pueden hacer frente a la carga?  Aumente el n√∫mero de instancias en el fragmento editando la plantilla de conjunto de r√©plicas: <br><br><pre> <code class="bash hljs">$ kubectl edit replicasettemplates.tarantool.io storage-template</code> </pre> <br>  Establezca <code>.spec.replicas</code> , por ejemplo 2, para aumentar el n√∫mero de instancias en cada conjunto de r√©plicas a dos. <br><br>  ¬øYa no se necesita un cl√∫ster?  Lo eliminamos junto con todos los recursos: <br><br><pre> <code class="bash hljs">$ kubectl delete clusters.tarantool.io examples-kv-cluster</code> </pre> <br>  ¬øAlgo sali√≥ mal?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Marque el boleto</a> , lo desmontaremos r√°pidamente.  :) <br><br><a name="2"></a><h2>  ¬øQu√© hace el operador? </h2><br>  El lanzamiento y la operaci√≥n del cl√∫ster de cartucho de Tarantool es la historia de realizar ciertas acciones, en un orden espec√≠fico, en un momento determinado. <br><br>  El cl√∫ster en s√≠ se administra principalmente a trav√©s de la API de administraci√≥n: GraphQL sobre HTTP.  Por supuesto, puede bajar un nivel y dirigir los comandos directamente a la consola, pero esto rara vez sucede.  Por ejemplo, as√≠ es como se inicia el cl√∫ster: <br><br><ol><li>  Elevamos el n√∫mero requerido de instancias de Tarantool, por ejemplo, en systemd. <br></li><li>  Fusionar instancias en membres√≠a: <br><br><pre> <code class="plaintext hljs">mutation { probe_instance: probe_server(uri: "storage:3301") }</code> </pre> <br></li><li>  Asigne roles a instancias, prescriba identificadores de instancias y conjuntos de r√©plicas.  La API GraphQL tambi√©n se usa para esto: <br><br><pre> <code class="plaintext hljs">mutation { join_server( uri:"storage:3301", instance_uuid: "cccccccc-cccc-4000-b000-000000000001", replicaset_uuid: "cccccccc-0000-4000-b000-000000000000", roles: ["storage"], timeout: 5 ) }</code> </pre> <br></li><li>  Realizamos bootstrap del componente responsable del fragmentaci√≥n.  Tambi√©n a trav√©s de la API: <br><br><pre> <code class="plaintext hljs">mutation { bootstrap_vshard cluster { failover(enabled:true) } }</code> </pre> <br></li></ol><br>  F√°cil, verdad? <br><br>  Todo se vuelve m√°s interesante cuando se trata de expandir un cl√∫ster.  La funci√≥n de los enrutadores del ejemplo se escala simplemente: generar m√°s instancias, conectarlas a un cl√∫ster existente: ¬°ya est√°!  El papel de los almacenes es algo m√°s complicado.  El almacenamiento est√° fragmentado, por lo que al agregar / eliminar instancias, es necesario reequilibrar los datos para pasar a nuevas instancias / para pasar de instancias eliminadas.  Si esto no se hace, entonces en un caso tenemos instancias subcargadas, en el segundo, perdemos datos.  ¬øY si no solo uno, sino una docena de cl√∫steres con diferentes topolog√≠as en funcionamiento? <br><br>  En general, el operador de Tarantool est√° ocupado con todo esto.  El usuario describe el estado deseado del cl√∫ster de cartucho de Tarantool, y el operador lo traduce en un conjunto de acciones en los recursos de k8s y en ciertas llamadas a las API del panel de administraci√≥n del cl√∫ster de Tarantool, en un orden espec√≠fico, en un momento determinado, y generalmente intenta ocultar todos los matices del usuario. <br><br><a name="3"></a><h2>  Un poco sobre los matices. </h2><br>  Cuando se trabaja con la API del cl√∫ster de administraci√≥n de Tarantool Cartridge, es importante tanto el orden de las llamadas como el lugar de donde provienen.  Por qu√© <br><br>  Tarantool Cartridge lleva su repositorio de topolog√≠a, su componente de descubrimiento de servicios y su componente de configuraci√≥n.  Cada instancia del cl√∫ster almacena una copia de la topolog√≠a y la configuraci√≥n en un archivo yaml. <br><br><pre> <code class="plaintext hljs">servers: d8a9ce19-a880-5757-9ae0-6a0959525842: uri: storage-2-0.examples-kv-cluster:3301 replicaset_uuid: 8cf044f2-cae0-519b-8d08-00a2f1173fcb 497762e2-02a1-583e-8f51-5610375ebae9: uri: storage-0-0.examples-kv-cluster:3301 replicaset_uuid: 05e42b64-fa81-59e6-beb2-95d84c22a435 ‚Ä¶ vshard: bucket_count: 30000 ...</code> </pre> <br>  La actualizaci√≥n ocurre en concierto usando el mecanismo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">confirmaci√≥n de dos fases</a> .  Una actualizaci√≥n exitosa requiere un qu√≥rum del 100%: cada instancia debe responder, de lo contrario, retroceder.  ¬øQu√© significa esto en t√©rminos de operaci√≥n?  Todas las solicitudes a la API de administrador que modifican el estado del cl√∫ster son m√°s confiables para enviar a una instancia, al l√≠der, de lo contrario corremos el riesgo de obtener diferentes configuraciones en diferentes instancias.  Tarantool Cartridge no sabe c√≥mo hacer una elecci√≥n de l√≠der (pero no sabe c√≥mo), pero el operador de Tarantool s√≠ puede, y usted solo puede saberlo como un hecho entretenido, porque el operador lo arruinar√° todo. <br><br>  Adem√°s, cada instancia debe tener una identidad fija, es decir, un conjunto de <code>instance_uuid</code> y <code>replicaset_uuid</code> , as√≠ como <code>advertise_uri</code> .  Si el almacenamiento se reinicia repentinamente y uno de estos par√°metros cambia, entonces corre el riesgo de romper el qu√≥rum; el operador tambi√©n lo hace. <br><br><a name="4"></a><h2>  C√≥mo funciona el operador </h2><br>  La tarea del operador es llevar el sistema al estado establecido por el usuario y mantener el sistema en este estado hasta que se reciban nuevas instrucciones.  Para que el operador pueda llevar a cabo su trabajo, necesita: <br><br><ol><li>  Descripci√≥n del estado del sistema. <br></li><li>  El c√≥digo que lleva al sistema a este estado. <br></li><li>  Un mecanismo para integrar este c√≥digo en k8 (por ejemplo, para recibir notificaciones de cambios de estado). <br></li></ol><br>  El grupo de cartuchos de Tarantool se describe en t√©rminos de k8 a trav√©s de una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Definici√≥n de recursos personalizados (CRD)</a> ;  el operador necesita 3 de estos recursos personalizados, unidos bajo el grupo tarantool.io/v1alpha: <br><br><ul><li>  El cl√∫ster es un recurso de nivel superior que corresponde a un cl√∫ster de cartucho de Tarantool. <br></li><li>  Rol: en t√©rminos de cartucho de Tarantool, este es un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rol de usuario</a> . <br></li><li>  ReplicasetTemplate: una plantilla mediante la cual se crear√°n StatefulSets (por qu√© con estado: te lo dir√© un poco m√°s tarde; no debes confundirlo con k8s ReplicaSet). <br></li></ul><br>  Todos estos recursos reflejan directamente el modelo de descripci√≥n del cl√∫ster de cartucho de Tarantool.  Al tener un diccionario com√∫n, es m√°s f√°cil para un operador comunicarse con los desarrolladores y comprender lo que quieren ver en el producto. <br><br>  El c√≥digo que lleva el sistema al estado dado: en t√©rminos de k8, este es el controlador.  En el caso del operador Tarantool, hay varios controladores: <br><br><ul><li>  ClusterController: es responsable de interactuar con el cl√∫ster de cartucho de Tarantool, conecta instancias al cl√∫ster, desconecta instancias del cl√∫ster. <br></li><li>  RoleController es un controlador de roles de usuario, es responsable de implementar StatefulSets desde una plantilla y mantener su n√∫mero en un n√∫mero determinado. <br></li></ul><br>  ¬øC√≥mo es un controlador?  Un conjunto de c√≥digos que gradualmente pone en orden el mundo que te rodea.  ClusterController se puede representar esquem√°ticamente de esta manera: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/132/1d2/317/1321d23173a37f65743fcc0ee4d48ad2.png"><br><br>  Un punto de entrada es una verificaci√≥n para ver si existe un recurso Cluster con respecto al cual ocurri√≥ el evento.  No existe?  Nos vamos  ¬øHay?  Pasamos al siguiente bloque: tomar la propiedad sobre los roles de los usuarios.  Capturado uno - izquierda, en el segundo c√≠rculo capturamos el segundo.  Y as√≠ sucesivamente, hasta que capturemos todo.  ¬øSe capturan todos los roles?  As√≠ que ve al siguiente bloque de operaciones.  Y as√≠, hasta llegar al final;  entonces podemos suponer que el sistema controlado est√° en un estado dado. <br><br>  En general, todo es simple.  Es importante determinar los criterios de √©xito para pasar cada etapa.  Por ejemplo, consideramos exitosa la operaci√≥n de unir un cl√∫ster no cuando devuelve √©xito condicional = verdadero, sino cuando devuelve un error como "ya se uni√≥". <br><br>  Y la √∫ltima parte de este mecanismo es la integraci√≥n del controlador con k8s.  Vista a√©rea, todo el k8 consiste en un conjunto de controladores que generan eventos y responden a ellos.  Los eventos pasan por colas a las que podemos suscribirnos.  Esquem√°ticamente, esto se puede representar de la siguiente manera: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/094/d57/3fb/094d573fbcf511ba2eea8e707a575423.jpg"><br><br>  El usuario llama a <code>kubectl create -f tarantool_cluster.yaml</code> , se crea el recurso Cluster correspondiente.  ClusterController es notificado de la creaci√≥n de un recurso Cluster.  Y lo primero que intenta hacer es encontrar todos los recursos de rol que deber√≠an formar parte de este cl√∫ster.  Si encuentra, asigna el Cl√∫ster como Propietario para el Rol y actualiza el recurso del Rol.  RoleController recibe una notificaci√≥n de actualizaci√≥n de roles, ve que el recurso tiene un propietario y comienza a crear StatefulSets.  Y as√≠ sucesivamente en un c√≠rculo: el primer tirador del segundo, el segundo tirador del tercero, y as√≠ sucesivamente hasta que alguien se detenga.  Y tambi√©n puede disparar a tiempo, por ejemplo, cada 5 segundos, lo que a veces es √∫til. <br><br>  Ese es todo el operador: crear un recurso personalizado y escribir c√≥digo que responda a eventos en los recursos. <br><br><a name="5"></a><h2>  Lo que el operador expande </h2><br>  Las acciones del operador finalmente conducen a que los k8 creen Pods y contenedores.  En el cl√∫ster de cartucho de Tarantool implementado en k8s, todos los pods se fusionan en StatefulSets. <br><br>  ¬øPor qu√© StatefulSet?  Como escrib√≠ anteriormente, cada instancia de Tarantool Cluster mantiene una copia de la topolog√≠a y la configuraci√≥n del cl√∫ster, y a menudo en el servidor de aplicaciones no, no, y usan alg√∫n tipo de espacio, por ejemplo, a su vez o datos de referencia, y esto ya es un estado completo .  Y StatefulSet tambi√©n garantiza la preservaci√≥n de los pods de identidad, lo cual es importante cuando se agrupan instancias en un cl√∫ster: la identidad de las instancias debe repararse; de ‚Äã‚Äãlo contrario, corremos el riesgo de perder el qu√≥rum al reiniciar. <br><br>  Cuando todos los recursos del cl√∫ster se crean y se llevan al estado deseado, forman la siguiente jerarqu√≠a: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e27/89f/f7e/e2789ff7e8bf174c20baf8cc077bdad2.png"><br><br>  Las flechas indican la relaci√≥n dependiente del propietario entre los recursos.  Es necesario que el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">recolector de basura</a> limpie despu√©s de nosotros en el caso de, por ejemplo, la eliminaci√≥n de Cluster. <br><br>  Adem√°s de StatefulSets, el operador de Tarantool crea el servicio sin cabeza, que es necesario para la elecci√≥n del l√≠der y, a trav√©s de √©l, las instancias se comunican entre s√≠. <br><br>  Bajo el cap√≥ del operador de Tarantool se encuentra el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">marco</a> del operador, el c√≥digo del operador en s√≠ est√° en golang, nada extraordinario aqu√≠. <br><br><a name="6"></a><h2>  Resumen </h2><br>  ¬°Eso es todo, en general!  Estamos esperando sus comentarios y boletos, donde sin ellos, la versi√≥n alfa es la misma.  Que sigue  Y luego hay mucho trabajo para recordar todo esto: <br><br><ul><li>  Unidad, prueba E2E; <br></li><li>  Prueba del mono del caos <br></li><li>  prueba de esfuerzo; <br></li><li>  copia de seguridad / restauraci√≥n; <br></li><li>  proveedor de topolog√≠a externo. <br></li></ul><br>  Cada uno de estos temas es extenso en s√≠ mismo y merece un material separado, ¬°espere actualizaciones! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/465823/">https://habr.com/ru/post/465823/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../465811/index.html">14 consejos para escribir c√≥digo de React limpio. Parte 1</a></li>
<li><a href="../465813/index.html">14 consejos para escribir c√≥digo de React limpio. Parte 2</a></li>
<li><a href="../465815/index.html">Los cient√≠ficos cultivaron grupos de c√©lulas nerviosas y las enviaron a la EEI</a></li>
<li><a href="../465817/index.html">C√≥mo la incomodidad nos ayuda a mejorar el proceso de desarrollo.</a></li>
<li><a href="../465819/index.html">LAN ideal</a></li>
<li><a href="../465825/index.html">Directorio telef√≥nico de Asterisk FreePBX desde tablas SQL (directorio basado en la web, subir al archivo xml para tel√©fonos Grandstream)</a></li>
<li><a href="../465829/index.html">[Tutorial] C√≥mo crear tu primer juego incremental de JavaScript IDLE</a></li>
<li><a href="../465833/index.html">TOKEN2 Molto-1, el primer token de hardware TOTP multi-perfil del mundo</a></li>
<li><a href="../465835/index.html">F√°brica abstracta en los dedos</a></li>
<li><a href="../465839/index.html">Todo lo que necesita saber sobre el margen de CSS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>