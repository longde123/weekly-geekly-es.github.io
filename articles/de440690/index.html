<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🔬 👨‍🍳 💃🏾 Funktionen zum Arbeiten mit Mesh in Unity 👧🏽 🤩 🅰️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wie Sie wissen, ist Computergrafik die Basis der Spielebranche. Bei der Erstellung von Grafikinhalten stoßen wir unweigerlich auf Schwierigkeiten, die...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Funktionen zum Arbeiten mit Mesh in Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/plarium/blog/440690/">  Wie Sie wissen, ist Computergrafik die Basis der Spielebranche.  Bei der Erstellung von Grafikinhalten stoßen wir unweigerlich auf Schwierigkeiten, die mit der unterschiedlichen Darstellung in der Erstellungsumgebung und in der Anwendung verbunden sind.  Zu diesen Schwierigkeiten kommen die Risiken einer einfachen menschlichen Nachlässigkeit hinzu.  Angesichts des Umfangs der Spieleentwicklung treten solche Probleme entweder häufig oder in großer Zahl auf. <br><br>  Der Kampf gegen solche Schwierigkeiten veranlasste uns, über Automatisierung nachzudenken und Artikel zu diesem Thema zu schreiben.  Der größte Teil des Materials befasst sich mit der Arbeit mit <b>Unity 3D</b> , da dies das Hauptentwicklungswerkzeug in Plarium Krasnodar ist.  Im Folgenden werden 3D-Modelle und Texturen als grafischer Inhalt betrachtet. <br><br>  In diesem Artikel werden wir über die Funktionen des Zugriffs auf Daten sprechen, die 3D-Objekte in <b>Unity darstellen</b> .  Das Material ist in erster Linie für Anfänger sowie für Entwickler nützlich, die selten mit der internen Darstellung solcher Modelle interagieren. <br><br><img src="https://habrastorage.org/webt/sh/4a/ou/sh4aousvny7jcs3jpcplosm9tbw.jpeg"><a name="habracut"></a><br><br><h3>  Über 3D-Modelle in Unity - für die Kleinsten </h3><br><img src="https://habrastorage.org/webt/_f/ir/tm/_firtmofn97mha8zhd0mxrhoigw.png"><br><br>  Im Standardansatz verwendet <b>Unity</b> die Komponenten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MeshFilter</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MeshRenderer</a> , um das Modell zu rendern.  MeshFilter bezieht sich auf das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mesh-</a> Asset, das das Modell darstellt.  Für die meisten Shader sind Geometrieinformationen eine obligatorische Mindestkomponente zum Rendern eines Modells auf dem Bildschirm.  Textur-Scan-Daten und Animationsknochen sind möglicherweise nicht verfügbar, wenn sie nicht beteiligt sind.  Wie diese Klasse im Inneren implementiert ist und wie alles dort gespeichert ist, ist ein Rätsel für den <s>n-ten Geldbetrag in</s> sieben Siegeln. <br><br>  Außerhalb bietet das Netz als Objekt Zugriff auf die folgenden Datensätze: <br><br><ul><li>  <b>Scheitelpunkte</b> - eine Reihe von Positionen von Geometriescheitelpunkten im dreidimensionalen Raum mit eigenem Ursprung; </li><li>  <b>Normalen, Tangenten</b> - Sätze von Normal- und Tangentenvektoren zu Eckpunkten, die üblicherweise zur Berechnung der Beleuchtung verwendet werden; </li><li>  <b>uv, uv2, uv3, uv4, uv5, uv6, uv7, uv8</b> - Koordinatensätze für das Scannen von Texturen; </li><li>  <b>Farben, Farben32</b> - Sätze von Farbwerten von Eckpunkten, von denen ein Lehrbuchbeispiel darin besteht, Textur nach Maske zu mischen; </li><li>  <b>bindposes</b> - Sätze von Matrizen zum Positionieren von Eckpunkten relativ zu Knochen; </li><li>  <b>Knochengewichte</b> - Einflusskoeffizienten von Knochen auf Spitzen; </li><li>  <b>Dreiecke</b> - eine Reihe von Scheitelpunktindizes, die jeweils 3 Mal verarbeitet werden;  Jedes dieser Tripel repräsentiert ein Polygon (in diesem Fall ein Dreieck) des Modells. </li></ul><br>  Der Zugriff auf Informationen zu Scheitelpunkten und Polygonen wird über die entsprechenden Eigenschaften implementiert, von denen jede ein Array von Strukturen zurückgibt.  Für eine Person, <s>die keine Dokumentation liest, die</s> selten mit Netzen in <b>Unity arbeitet</b> , ist es möglicherweise nicht offensichtlich, dass bei jedem Zugriff auf einen Scheitelpunkt im Speicher eine Kopie der entsprechenden Menge in Form eines Arrays mit einer Länge erstellt wird, die der Anzahl der Scheitelpunkte entspricht.  Diese Nuance wird in einem kleinen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentationsblock betrachtet</a> .  Auch Kommentare zu den oben genannten Eigenschaften der <b>Mesh-</b> Klasse warnen davor.  Der Grund für dieses Verhalten ist das <b>Unity-</b> Architekturmerkmal im Kontext der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mono-</a> Laufzeit.  Schematisch kann dies wie folgt dargestellt werden: <br><br><img src="https://habrastorage.org/webt/wn/xp/0y/wnxp0y08-wuonzrdzmf6defkzac.jpeg"><br><br>  Der Engine-Core (UnityEngine (native)) ist von den Skripten des Entwicklers isoliert, und der Zugriff auf seine Funktionalität wird über die UnityEngine-Bibliothek (C #) implementiert.  Tatsächlich handelt es sich um einen Adapter, da die meisten Methoden als Schicht zum Empfangen von Daten vom Kernel dienen.  Gleichzeitig drehen sich der Kernel und der Rest davon, einschließlich Ihrer Skripte, unter verschiedenen Prozessen, und der Skriptteil kennt nur die Liste der Befehle.  Daher gibt es keinen direkten Zugriff auf den vom Kernel verwendeten Speicher aus dem Skript. <br><br><h3>  Über den Zugriff auf interne Daten oder wie schlimm Dinge sein können </h3><br>  Um zu demonstrieren, wie schlimm Dinge sein können, analysieren wir die Menge des von Garbage Collector gelöschten Speichers anhand eines Beispiels aus der Dokumentation.  Um die Profilerstellung zu vereinfachen, schließen Sie denselben Code in die Update-Methode ein. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MemoryTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Mesh Mesh; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; Mesh.vertexCount; i++) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = Mesh.vertices[i].x; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = Mesh.vertices[i].y; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> z = Mesh.vertices[i].z; DoSomething(x, y, z); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//nothing to do } }</span></span></code> </pre> <br>  Wir haben dieses Skript mit einem Standardprimitiv ausgeführt - einer Kugel (515 Eckpunkte).  Mit dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Profiler-</a> Tool können Sie auf der Registerkarte Speicher sehen, wie viel Speicher für die Speicherbereinigung in jedem Frame markiert wurde.  Auf unserer Arbeitsmaschine betrug dieser Wert ~ 9,2 MB. <br><br><img src="https://habrastorage.org/webt/fy/v0/zl/fyv0zl3ooi-u6vn5nmvyskzbrrg.png"><br><br>  Dies ist selbst für eine geladene Anwendung ziemlich viel, und hier haben wir eine Szene mit einem Objekt gestartet, auf dem das einfachste Skript bereitgestellt ist. <br><br>  Es ist wichtig, die Funktionen des <b>.Net-</b> Compilers und die Codeoptimierung zu erwähnen.  Wenn Sie die Aufrufkette durchlaufen, werden Sie feststellen, dass beim Aufrufen von <b>Mesh.vertices</b> die <b>externe</b> Methode der Engine <b>aufgerufen wird</b> .  Dies verhindert, dass der Compiler den Code in unserer <b>Update ()</b> -Methode optimiert, obwohl <b>DoSomething ()</b> leer ist und die Variablen <b>x, y, z</b> aus diesem Grund nicht verwendet werden. <br><br>  Jetzt zwischenspeichern wir das Array von Positionen am Anfang. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MemoryTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Mesh Mesh; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3[] _vertices; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _vertices = Mesh.vertices; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; _vertices.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = _vertices[i].x; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = _vertices[i].y; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> z = _vertices[i].z; DoSomething(x, y, z); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//nothing to do } }</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/sf/fr/fd/sffrfdqcfcx_3ybl9eg94rd1vhm.png"><br><br>  Im Durchschnitt 6 Kb.  Eine andere Sache! <br><br>  Diese Funktion wurde zu einem der Gründe, warum wir unsere eigene Struktur zum Speichern und Verarbeiten von Netzdaten implementieren mussten. <br><br><h3>  Wie machen wir das? </h3><br>  Während der Arbeit an großen Projekten entstand die Idee, ein Tool zur Analyse und Bearbeitung importierter Grafikinhalte zu erstellen.  Wir werden die Methoden der Analyse und Transformation in den folgenden Artikeln diskutieren.  Schauen wir uns nun die Datenstruktur an, die wir zur Vereinfachung der Implementierung von Algorithmen geschrieben haben, wobei die Merkmale des Zugriffs auf Informationen über das Netz berücksichtigt werden. <br><br>  Anfangs sah diese Struktur so aus: <br><br><img src="https://habrastorage.org/webt/ep/2f/jx/ep2fjx87onpgda5ogkqgkg-u_ri.jpeg"><br><br>  Hier repräsentiert die <b>CustomMesh-</b> Klasse das Netz selbst.  Separat haben wir in Form von <b>Utility</b> die Konvertierung von <b>UntiyEngine.Mesh implementiert</b> und umgekehrt.  Ein Netz wird durch seine Anordnung von Dreiecken definiert.  Jedes Dreieck enthält genau drei Kanten, die wiederum durch zwei Eckpunkte definiert sind.  Wir haben beschlossen, den Scheitelpunkten nur die Informationen hinzuzufügen, die wir für die Analyse benötigen, nämlich: Position, Normal, zwei Textur-Scan-Kanäle ( <b>uv0</b> für die <b>Haupttextur</b> , <b>uv2</b> für die Beleuchtung) und Farbe. <br><br>  Nach einiger Zeit entstand die Notwendigkeit, die Hierarchie nach oben zu verschieben.  Zum Beispiel, um aus einem Dreieck herauszufinden, zu welchem ​​Netz es gehört.  Darüber hinaus sah ein <b>Downgrade</b> von <b>CustomMesh</b> auf <b>Vertex</b> prätentiös aus, und die unvernünftige und erhebliche Menge an doppelten Werten ging mir auf die Nerven.  Aus diesen Gründen musste die Struktur neu gestaltet werden. <br><br><img src="https://habrastorage.org/webt/m5/8_/0p/m58_0pneh5z97etazjao0yofeli.jpeg"><br><br>  <b>CustomMeshPool</b> implementiert Methoden für die bequeme Verwaltung und den Zugriff auf alle verarbeiteten <b>CustomMesh</b> .  Aufgrund des <b>Felds MeshId</b> hat jede Entität Zugriff auf die Informationen des gesamten Netzes.  Diese Datenstruktur erfüllt die Anforderungen für die ersten Aufgaben.  Es ist einfach zu erweitern, indem Sie <b>CustomMesh</b> den entsprechenden Datensatz und <b>Vertex</b> die erforderlichen Methoden hinzufügen. <br><br>  Es ist anzumerken, dass dieser Ansatz in der Leistung nicht optimal ist.  Gleichzeitig konzentrieren sich die meisten von uns implementierten Algorithmen auf die Analyse von Inhalten im <b>Unity-</b> Editor, weshalb Sie nicht oft über die verwendete Speichermenge nachdenken müssen.  Aus diesem Grund zwischenspeichern wir buchstäblich alles, was möglich ist.  Wir testen zuerst den implementierten Algorithmus, überarbeiten dann seine Methoden und vereinfachen in einigen Fällen Datenstrukturen, um die Laufzeit zu optimieren. <br><br>  Das ist alles für jetzt.  Im nächsten Artikel werden wir darüber sprechen, wie 3D-Modelle bearbeitet werden, die bereits zum Projekt hinzugefügt wurden, und wir werden die berücksichtigte Datenstruktur verwenden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de440690/">https://habr.com/ru/post/de440690/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de440676/index.html">Der Tag, an dem Dodo aufgehört hat. Synchrones Skript</a></li>
<li><a href="../de440678/index.html">DIY Hobby CNC Fräser. Geisteswissenschaften für die Geisteswissenschaften. Teil 2</a></li>
<li><a href="../de440680/index.html">Wie man morgen igrofikuyuchi sieht</a></li>
<li><a href="../de440682/index.html">- Und Sie machen dort in der petrochemischen Industrie Gas, oder?</a></li>
<li><a href="../de440688/index.html">PR in der IT: Wie leben, wohin?</a></li>
<li><a href="../de440696/index.html">Datenbank-Refactoring-Toolkit: Flyway vs. Liquibase</a></li>
<li><a href="../de440700/index.html">Data Science "Spezialeinheiten" im eigenen Haus</a></li>
<li><a href="../de440702/index.html">Achtung - GAS! oder wie wir intelligente Verträge ohne Kohlensäure abgeschlossen haben</a></li>
<li><a href="../de440706/index.html">InoThings ++ Professional IoT-Konferenz - Was war und was wird</a></li>
<li><a href="../de440708/index.html">Offenes Webinar "Arbeit: das eigene und das eines anderen"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>