<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📘 🏰 🤴 队列的设计和命名 ⛏️ 👔 🎟️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="有关如何组织点，队列以及如何正确命名它们的一些规则，以方便使用。 



| exchange | type | binding_queue | binding_key | |-------------------------------------------------------| | use...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>队列的设计和命名</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443722/"> 有关如何组织点，队列以及如何正确命名它们的一些规则，以方便使用。 <br><br><pre><code class="plaintext hljs">| exchange | type | binding_queue | binding_key | |-------------------------------------------------------| | user.write | topic | user.created.app2 | user.created |</code> </pre> <a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">概念</b> <div class="spoiler_text">  <b>AMQP</b> （高级消息队列协议）是一种开放协议，用于在系统组件之间传输消息。 <br>  <b>提供者</b> （发布者/生产者）-发送消息的程序。 <br>  <b>订户</b> （消费者）-接受消息的程序。 通常，订户处于消息等待状态。 <br>  <b>队列</b> -消息队列。 <br>  <b>交换点</b> （Exchange）-队列的初始交换点，用于路由。 <br></div></div><br><h3> 规则一 </h3><br> 每个队列仅代表一种类型的作业。 不要在同一队列中混合使用不同类型的消息。 当遵守此规则时，我们可以清楚地命名呈现给他们的任务队列。 <br><br><h3> 规则二 </h3><br> 避免将邮件重新提交到队列。 如果您发现您的订户试图将任何消息重新发送到其他队列而不进行实际处理，则很可能是某些内容的设计不正确。 路由是交换点而不是队列的责任。 <br><br><h3> 规则三 </h3><br> 供应商无需了解任何有关队列的知识。  AMQP的主要思想之一是在点和队列之间划分责任，因此供应商无需担心将消息传递给订户。 <br><br><h3> 示例和解决方案 </h3><br> 假设您要设计与“自定义”相关的记录事件的点和队列。 记录事件将在一个或多个应用程序中触发，而这些消息将由其他一些应用程序使用。 <br><br><pre> <code class="plaintext hljs">| object | event | |------------------| | user | created | | user | updated | | user | deleted |</code> </pre><br> 通常要问的第一个问题是一个对象的各种事件（在此示例中为“用户”对象），应该使用一个交换点来发布所有三个事件，还是应该对每个事件使用3个单独的点？ 或者，简而言之，一个或多个交换点？ <br><br> 在回答这个问题之前，我想再问一个问题：在这种情况下，我们真的需要一个单独的观点吗？ 如果我们将所有三种类型的事件抽象为“创建”事件，其子类型为“创建”，“更新”和“删除”，该怎么办？ <br><br><pre> <code class="plaintext hljs">| object | event | sub-type | |-----------------------------| | user | write | created | | user | write | updated | | user | write | deleted |</code> </pre><br><h3> 解决方案1 </h3><br> 最简单的解决方案是创建“ user.write”队列，并通过全局交换点将用户记录事件中的所有消息发布到此队列。 <br><br><h3> 决定2 </h3><br> 当第二个应用程序（具有不同的处理逻辑）想要订阅队列中发布的任何消息时，最简单的解决方案将无法工作。 对多个应用程序进行签名后，我们至少需要一个“ fanout”类型的点，并绑定到多个队列。 因此，消息被发送到该点，并在每个队列中复制消息。 每个队列代表每个应用程序的处理作业。 <br><br><pre> <code class="plaintext hljs">| queue | subscriber | |-------------------------------| | user.write.app1 | app1 | | user.write.app2 | app2 | | exchange | type | binding_queue | |---------------------------------------| | user.write | fanout | user.write.app1 | | user.write | fanout | user.write.app2 |</code> </pre><br> 如果每个订阅者都确实想处理“ user.write”事件的所有子类型，则第二种解决方案可以正常工作。 例如，如果订户的应用程序设计为仅存储事务日志。 <br><br> 另一方面，当某些订阅者不在您的组织范围内并且您只希望将某些特定事件通知给他们时，这不是很好，例如，app2应该收到有关用户创建的消息，而不应该知道更新和删除事件。 <br><br><h3> 决定3 </h3><br> 为了解决上述问题，我们必须从“ user.write”类型中提取“ user.created”事件。 具有主题类型的交换点可以为我们提供帮助。 发布消息时，我们将使用user.created / user.updated / user.deleted作为某个点的路由密钥，因此我们可以将通信密钥“ user。*”放入队列“ user.write.app1”和通信密钥“ user.created”在队列“ user.created.app2”中。 <br><br><pre> <code class="plaintext hljs">| queue | subscriber | |---------------------------------| | user.write.app1 | app1 | | user.created.app2 | app2 | | exchange | type | binding_queue | binding_key | |-------------------------------------------------------| | user.write | topic | user.write.app1 | user.* | | user.write | topic | user.created.app2 | user.created |</code> </pre><br><h3> 决定4 </h3><br> 如果可能存在更多事件类型，则交换点的主题主题类型更为灵活。 但是，如果您清楚地知道事件的确切数量，则也可以使用“直接”类型来提高性能。 <br><br><pre> <code class="plaintext hljs">| queue | subscriber | |---------------------------------| | user.write.app1 | app1 | | user.created.app2 | app2 | | exchange | type | binding_queue | binding_key | |--------------------------------------------------------| | user.write | direct | user.write.app1 | user.created | | user.write | direct | user.write.app1 | user.updated | | user.write | direct | user.write.app1 | user.deleted | | user.write | direct | user.created.app2 | user.created |</code> </pre><br> 我们回到“一点还是很多？”这个问题。 只要所有解决方案都只使用一点，它就可以正常工作，没什么不好。 在什么情况下我们需要几点？ <br><br><h3> 决定5 </h3><br> 让我们看一个示例，除了上述创建，更新和删除的事件之外，我们还有另一组事件：输入和输出-一组描述“用户行为”而不是“数据记录”的事件。 对于不同的事件组，可能需要完全不同的路由策略以及队列的键和名称的约定，为此，需要单独的交换点。 <br><br><pre> <code class="plaintext hljs">| queue | subscriber | |----------------------------------| | user.write.app1 | app1 | | user.created.app2 | app2 | | user.behavior.app3 | app3 | | exchange | type | binding_queue | binding_key | |--------------------------------------------------------------| | user.write | topic | user.write.app1 | user.* | | user.write | topic | user.created.app2 | user.created | | user.behavior | topic | user.behavior.app3 | user.* |</code> </pre><br> 文章<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RabbitMQ交换和队列设计权衡的</a>免费翻译。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN443722/">https://habr.com/ru/post/zh-CN443722/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN443710/index.html">Java Challengers＃4：将对象与equals（）和hashCode（）进行比较</a></li>
<li><a href="../zh-CN443714/index.html">ControlValueAccessor和可在Angular中编辑的内容</a></li>
<li><a href="../zh-CN443716/index.html">“我的磁带上有备份。” 第一人称故事</a></li>
<li><a href="../zh-CN443718/index.html">30万场比赛的奇幻游戏</a></li>
<li><a href="../zh-CN443720/index.html">详细资料</a></li>
<li><a href="../zh-CN443724/index.html">AMD Radeon VII：高端芯片（第1部分）</a></li>
<li><a href="../zh-CN443726/index.html">Palo Alto Networks设置功能：SSL VPN</a></li>
<li><a href="../zh-CN443728/index.html">Google Plus停止工作。 那又怎样</a></li>
<li><a href="../zh-CN443730/index.html">Ctrl-Alt-Del：计划中的程序员淘汰</a></li>
<li><a href="../zh-CN443734/index.html">神经网络具有非常简单的图像分类策略。</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>