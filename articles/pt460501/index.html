<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛹🏿 🎩 🐑 Exemplo de implementação de integração contínua usando o BuildBot 🛰️ 🦒 👩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(Imagem por Computerizer por Pixabay) 
 
 Oi 

 Meu nome é Evgeny Cherkin , sou o programador da equipe de desenvolvimento da empresa de mineração Pol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Exemplo de implementação de integração contínua usando o BuildBot</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460501/"><img src="https://habrastorage.org/webt/jj/-4/-g/jj-4-gindpovkdi6rbmzxax4yqu.jpeg" alt="Configuração de avaliação do BuildBot"><br>  <i>(Imagem por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Computerizer</a> por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pixabay)</a></i> <i><br></i> <br>  Oi <br><br>  Meu nome é <b>Evgeny Cherkin</b> , sou o programador da equipe de desenvolvimento da empresa de mineração <b>Polymetal</b> . <br><br>  Ao iniciar qualquer projeto importante, você começa a pensar: “Qual software é melhor usar para sua manutenção?”.  Um projeto de TI antes do lançamento da próxima versão passa por uma série de estágios.  É bom quando a cadeia dessas etapas é automatizada.  O processo automatizado de lançamento de uma nova versão de um projeto de TI é chamado de <i>Integração Contínua</i> .  <b>O BuildBot</b> acabou sendo um bom ajudante para nós, implementando esse processo. <br><br>  Neste artigo, decidi fornecer uma visão geral dos recursos do <b>BuildBot</b> .  Do que esse software é capaz?  Como abordá-lo e como construir um RELACIONAMENTO DE TRABALHO EFICAZ normal com ele?  Você também pode aplicar nossa experiência criando em sua máquina um serviço funcional para montar e testar seu projeto. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Conteúdo</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td colspan="4" align="center"><h3>  Conteúdo </h3></td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1. Por que o BuildBot?</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2. Conceito liderado pelo BuildMaster</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3. Instalação</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4. Primeiros passos</a> </td></tr><tr><td colspan="4" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5. Configuração.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Receita passo a passo</a> </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5.1 BuildmasterConfig</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5.2 trabalhadores</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5.3 change_source</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5.4 shedulers</a> </td></tr><tr><td colspan="2" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5.5 BuildFactory</a> </td><td colspan="2" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5.6 construtores</a> </td></tr><tr><td colspan="4" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">6. Exemplo de configuração própria</a> </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">6.1 A caminho do seu master.cfg</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">6.2 Trabalhar com svn</a> </td><td colspan="2">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">6.3 Uma carta para você: os repórteres estão autorizados a declarar</a> </td></tr><tr><td colspan="4" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nós conseguimos!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Meus parabéns</a> </td></tr></tbody></table></div><br></div></div><br><a name="Why"></a><h3>  1. Por que o BuildBot? </h3><hr><br>  Anteriormente, encontrei artigos sobre a implementação da <i>Integração Contínua</i> usando o <b>BuildBot</b> .  Por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este</a> me pareceu o mais informativo.  Há outro exemplo - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mais simples</a> .  Esses artigos podem ser temperados com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um exemplo do manual</a> , e depois em inglês.  O cupê é um bom ponto de partida.  Depois de ler esses artigos, você provavelmente desejará fazer algo no <b>BuildBot imediatamente</b> . <br><br>  Pare com isso!  Alguém o usou em seus projetos?  Acontece que sim, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">muitos o</a> aplicaram em suas tarefas.  Você pode encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">exemplos de</a> uso do <b>BuildBot</b> nos arquivos de código do Google. <br><br>  Então, qual é a lógica das pessoas que usam o <b>buildbot</b> ?  Afinal, existem outras ferramentas: <b>CruiseControl</b> e <b>Jenkins</b> .  Eu vou responder dessa maneira.  Para a maioria das tarefas, <b>Jenkins</b> realmente será suficiente.  <b>O BuildBot</b> , por sua vez, é mais adaptável e as tarefas são resolvidas com a mesma facilidade que no <b>Jenkins</b> .  Escolha você.  Mas como estamos procurando uma ferramenta para um projeto de destino em desenvolvimento, por que não escolher a que nos permite, a partir de etapas simples, obter um sistema de compilação que tenha interatividade e uma interface exclusiva. <br><br>  Para aqueles cujo projeto de destino está escrito em python, surge a pergunta: “Por que não escolher um sistema de integração que tenha uma interface clara em termos da linguagem usada no projeto?”.  E então é hora de apresentar os benefícios do <b>BuildBot</b> . <br><blockquote>  Então, nosso "quarteto instrumental".  Para mim, defini os quatro recursos do <b>BuildBot</b> : <br><ol><li>  Esta é uma estrutura de código aberto sob a GPL </li><li>  Isso está usando python como uma ferramenta de configuração e descrevendo as ações necessárias. </li><li>  Esta é uma oportunidade para receber uma resposta da máquina na qual a montagem ocorre. </li><li>  Estes são finalmente os requisitos mínimos para o Host.  A implantação requer python e twisted, e nenhuma máquina virtual ou máquina java é necessária. </li></ol><br></blockquote><a name="Concepts"></a><h3>  2. Conceito liderado pelo BuildMaster </h3><hr><br><img src="https://habrastorage.org/webt/so/qs/u1/soqsu1skae_0xuktzdemfv-n3yq.png" alt="BuildBot BuildMaster"><br><br>  O ponto central da arquitetura de distribuição de tarefas é o <b>BuildMaster</b> .  É um serviço que: <br><br><ul><li>  <b>rastreia</b> alterações na árvore de origem do projeto </li><li>  <b>envia os</b> comandos que o serviço Worker deve executar para criar um projeto e testá-lo </li><li>  <b>notifica os</b> usuários dos resultados das ações tomadas </li></ul><br>  <b>O BuildMaster é</b> configurado através do arquivo <i>master.cfg</i> .  Este arquivo está na raiz do <b>BuildMaster</b> .  Mais tarde mostrarei como essa raiz é criada.  O <i>próprio</i> arquivo <i>master.cfg</i> contém python, um script que usa chamadas <b>BuildBot</b> . <br><br>  O próximo <b>BuildBot</b> mais importante é chamado <b>Worker</b> .  Este serviço pode ser executado em um host diferente com um sistema operacional diferente ou talvez onde o <b>BuildMaster esteja</b> .  Também pode existir em um ambiente virtual especialmente preparado com seus próprios pacotes e variáveis.  Esses ambientes virtuais podem ser preparados usando utilitários python como <i>vertualenv, venv</i> . <br><br>  <b>O BuildMaster</b> transmite comandos para cada <b>Trabalhador</b> , que, por sua vez, os executa.  Ou seja, acontece que o processo de construção e teste do projeto pode ir para o <b>Worker</b> no Windows e em outro Worker no linux. <br><br>  <i>A verificação</i> do código-fonte do projeto ocorre em todos os <b>trabalhadores</b> . <br><br><a name="Install"></a><h3>  3. Instalação </h3><hr><br>  Então vamos lá.  Vou usar o Ubuntu 18.04 como host.  Nele colocarei um <b>BuildMaster</b> -a e um <b>Worker</b> -a.  Mas primeiro você precisará instalar o python3.7: <br><br><pre><code class="bash hljs">sudo apt-get update sudo apt-get install python3.7</code> </pre> <br>  Para aqueles que precisam de python3.7.2 em vez de 3.7.1, você pode fazer o seguinte: <br><br><pre> <code class="bash hljs">sudo apt-get update sudo apt-get software-properties-common sudo add-apt-repository ppa:deadsnakes/ppa sudo apt-get install python3.7 sudo ln -fs /usr/bin/python3.7 /usr/bin/python3 pip3 install --upgrade pip</code> </pre><br>  O próximo passo é instalar o <i>Twited</i> e o <b>BuildBot</b> , além de pacotes que permitem a funcionalidade adicional do <b>BuildBot</b> -a. <br><br><pre> <code class="bash hljs">/*   sudo        /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib/python3.7/dist-packages*/ <span class="hljs-comment"><span class="hljs-comment">#     Worker- sudo pip install twisted # twisted sudo pip install buildbot #BuildMaster #  pip install pysqlite3 #  sqllite    pip install jinja2 #framework  django,  web     pip install autobahn #Web c   BuildMaster-&gt;Worker pip install sqlalchemy sqlalchemy-migrate #     # Web  BuildBot-a pip install buildbot-www buildbot-grid-view buildbot-console-view buildbot-waterfall-view pip install python-dateutil #   web #         pip install buildbot-worker #Worker #  sudo pip install virtualenv # </span></span></code> </pre><br><a name="master"></a><h3>  4. Primeiros passos </h3><hr><br>  Hora de criar um <b>BuildMaster</b> .  Nós o teremos na pasta <i>/ home / habr / master</i> . <br><pre> <code class="bash hljs">mkdir master buildbot create-master master <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre> <br><a name="createworker"></a>  O próximo passo.  Crie um <b>trabalhador</b> .  Nós o teremos na pasta <i>/ home / habr / worker</i> . <br><pre> <code class="bash hljs">mkdir worker buildbot-worker create-worker --<span class="hljs-built_in"><span class="hljs-built_in">umask</span></span>=0o22 --keepalive=60 worker localhost:4000 yourWorkerName password</code> </pre><br>  Quando você inicia o <b>Worker</b> , por padrão, ele cria uma pasta em <i>/ home / habr / worker</i> com o nome do projeto, especificado em <i>master.cfg</i> .  E na pasta com o nome do projeto, ele criará o diretório de <i>compilação</i> e o <i>checkout</i> será feito nele.  O diretório de trabalho do <b>Worker</b> será o diretório <i>/ home / habr / yourProject / build</i> . <br><br>  <b>Chave de Ouro</b> <br>  E agora, para o que escrevi no parágrafo anterior: o script que o <b>Master</b> exigirá que o <b>Worker</b> faça remotamente neste diretório não será executado, pois o script não tem permissão para executar.  Para corrigir a situação, você precisa de uma chave <a name="umask"></a>  <i>--umask = 0o22</i> , que impõe uma proibição de gravação neste diretório, mas deixa direitos de inicialização.  E nós só precisamos disso. <br><br>  <b>BuildMaster</b> e <b>Worker</b> estabelecem uma conexão entre si.  Acontece que ele é interrompido e o <b>Worker</b> aguarda uma resposta do <b>BuildMaster</b> por algum tempo.  Se nenhuma resposta for recebida, a conexão será reiniciada.  A chave <b>--keepalive = 60</b> é exatamente o que você precisa para indicar o tempo após o qual a <i>conexão é</i> reiniciada. <br><br><a name="Recept"></a><h3>  5. Configuração.  Receita passo a passo </h3><hr><br>  <b>A</b> configuração do <b>BuildMaster</b> é feita no lado da máquina, onde executamos o comando <i>create-master</i> .  No nosso caso, este é o diretório <i>/ home / habr / master</i> .  O arquivo de configuração <i>master.cfg ainda</i> não existe, mas o próprio comando já criou o arquivo <i>master.cmg.sample</i> .  Você precisa renomeá-lo em <i>master.cfg.sample</i> para <i>master.cfg</i> <br><pre> <code class="bash hljs">mv master.cfg.sample master.cfg</code> </pre> <br>  <i>Vamos</i> abrir este <i>master.cfg</i> .  E vamos analisar em que consiste.  E depois disso, tentaremos criar nosso próprio arquivo de configuração. <br><br><div class="spoiler">  <b class="spoiler_title">master.cfg</b> <div class="spoiler_text"><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>].append(changes.GitPoller( <span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, workdir=<span class="hljs-string"><span class="hljs-string">'gitpoller-workdir'</span></span>, branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>, pollInterval=<span class="hljs-number"><span class="hljs-number">300</span></span>)) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"all"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>), treeStableTimer=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>])) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.ForceScheduler( name=<span class="hljs-string"><span class="hljs-string">"force"</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>])) factory = util.BuildFactory() factory.addStep(steps.Git(repourl=<span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'incremental'</span></span>)) factory.addStep(steps.ShellCommand(command=[<span class="hljs-string"><span class="hljs-string">"trial"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>], env={<span class="hljs-string"><span class="hljs-string">"PYTHONPATH"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>})) c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>].append( util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>, workernames=[<span class="hljs-string"><span class="hljs-string">"example-worker"</span></span>], factory=factory)) c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] = <span class="hljs-string"><span class="hljs-string">"Hello World CI"</span></span> c[<span class="hljs-string"><span class="hljs-string">'titleURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"https://buildbot.github.io/hello-world/"</span></span> c[<span class="hljs-string"><span class="hljs-string">'buildbotURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"http://localhost:8010/"</span></span> c[<span class="hljs-string"><span class="hljs-string">'www'</span></span>] = dict(port=<span class="hljs-number"><span class="hljs-number">8010</span></span>, plugins=dict(waterfall_view={}, console_view={}, grid_view={})) c[<span class="hljs-string"><span class="hljs-string">'db'</span></span>] = { <span class="hljs-string"><span class="hljs-string">'db_url'</span></span> : <span class="hljs-string"><span class="hljs-string">"sqlite:///state.sqlite"</span></span>, }</code> </pre><br></div></div><br><a name="BC"></a><h4>  <u>5.1 BuildmasterConfig</u> </h4><br><pre> <code class="python hljs">c = BuildmasterConfig = {}</code> </pre> <br>  <i>BuildmasterConfig</i> - o dicionário básico do arquivo de configuração.  Ele deve estar envolvido no arquivo de configuração.  Para facilitar o uso, seu apelido <i>"c"</i> é inserido no código de configuração.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Os</a> nomes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chave</a> em <i>c ["keyFromDist"]</i> são elementos fixos para interagir com o <b>BuildMaster</b> .  Sob cada chave, o objeto correspondente é substituído como um valor. <br><br><a name="Worker"></a><h4>  <u>5.2 trabalhadores</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'workers'</span></span>] = [worker.Worker(<span class="hljs-string"><span class="hljs-string">"example-worker"</span></span>, <span class="hljs-string"><span class="hljs-string">"pass"</span></span>)]</code> </pre> <br>  Desta vez, apontamos a lista de <b>trabalhadores</b> do <b>BuildMaster</b> .  Criamos <b>Worker</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">acima</a> especificando <i>você-worker-name</i> e a <i>senha</i> .  Agora eles devem ser especificados em vez de <i>exemplo-worker</i> e <i>passar</i> . <br><br><a name="CS"></a><h4>  <u>5.3 change_source</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>].append(changes.GitPoller( <span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, workdir=<span class="hljs-string"><span class="hljs-string">'gitpoller-workdir'</span></span>, branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>, pollInterval=<span class="hljs-number"><span class="hljs-number">300</span></span>))</code> </pre><br>  <i>Usando a</i> chave <i>change_source</i> do dicionário <i>c</i> , obtemos acesso à lista em que você deseja colocar o objeto que consulta o repositório com o código-fonte do projeto.  O exemplo usa o repositório Git, que é pesquisado em alguma periodicidade. <br><br>  O primeiro argumento é o caminho para o seu repositório. <br><br>  <i>workdir</i> é o caminho para a pasta onde, no lado <b>do trabalhador</b> , em relação ao caminho <i>/ home / habr / worker / yourProject / build, o</i> git armazenará a versão local do repositório. <br><br>  <i>branch</i> contém uma ramificação específica no repositório que deve ser monitorada. <br><br>  <i>pollInterval</i> contém o número de segundos após os quais o <b>BuildMaster</b> pesquisará o repositório em busca de alterações. <br><br>  Existem vários métodos para rastrear alterações em um repositório de projeto. <br><br>  O método mais fácil é <i>Polling</i> , o que implica que o <b>BuildMaster realiza</b> pesquisas periodicamente no servidor com o repositório.  Se a <i>confirmação</i> refletiu as alterações no repositório, o <b>BuildMaster,</b> com algum atraso, criará um objeto <i>Change</i> interno e o enviará ao manipulador de eventos do <i>Scheduler</i> , que iniciará as etapas para criar e testar o projeto no <i>Worker</i> .  Entre essas etapas, a <i>atualização do</i> repositório será indicada.  É no <b>Worker que</b> uma cópia local do repositório será criada.  Os detalhes desse processo serão divulgados abaixo nas próximas duas seções <b>( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5.4</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5.5</a> )</b> . <br><br>  Um método ainda mais elegante de rastrear alterações no repositório é enviar mensagens diretamente do servidor no qual está localizado ao <b>BuildMaster</b> sobre a alteração dos códigos-fonte do projeto.  Nesse caso, assim que o desenvolvedor fizer uma <i>confirmação</i> , o servidor com o repositório do projeto enviará uma mensagem ao <b>BuildMaster</b> .  E isso, por sua vez, será interceptado através da criação de um objeto <i>PBChangeSource</i> .  Além disso, esse objeto será transferido para o <i>Agendador</i> , que ativa as etapas para a montagem do projeto e seus testes.  Uma parte importante desse método é trabalhar com scripts de <i>gancho do</i> servidor no repositório.  No script de <i>gancho</i> responsável por manipular ações durante a <i>confirmação</i> , você precisa chamar o utilitário <i>sendchange</i> e especificar o endereço de rede do <b>BuildMaster</b> .  Você deve <i>especificar a</i> porta de rede que escutará o <i>PBChangeSource</i> .  <i>PBChangeSource</i> , a propósito, faz parte do <b>BuildMaster</b> .  Este método exigirá um privilégio de <i>administrador</i> no servidor em que o repositório do projeto está localizado.  Primeiro você precisa criar um repositório de backup. <br><br><a name="shedulers"></a><h4>  <u>5.4 shedulers</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"all"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>), treeStableTimer=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>])) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.ForceScheduler( name=<span class="hljs-string"><span class="hljs-string">"force"</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>]))</code> </pre><br>  <i>agendadores</i> é um elemento que atua como um gatilho que executa toda a cadeia de montagem e teste de um projeto. <br><img src="https://habrastorage.org/webt/sh/1j/jo/sh1jjoo3rog47fsyjgqgorizyfs.png" alt="Shedulers do buildbot"><br><br>  Essas mudanças que foram registradas por <i>change_source</i> foram convertidas durante a operação do <b>BuildBot</b> -a no objeto <i>Change</i> e agora cada <i>Sheduler</i> baseado nelas cria solicitações para iniciar o processo de criação do projeto.  No entanto, também determina quando enviar essas solicitações para a fila.  Object <a name="builder"></a>  <i>O Builder</i> mantém uma fila de pedidos e monitora o status da montagem atual em um <b>Worker</b> -e separado.  <i>O Builder</i> existe no <b>BuildMaster</b> -e e <b>Worker</b> -e.  Ele envia uma <i>compilação</i> específica do <b>BuildMaster</b> para <b>Worker</b> , uma série de etapas que devem ser seguidas. <br>  Vemos que no exemplo atual de tais <i>agendadores</i> , 2 partes são criadas.  Além disso, cada um tem seu próprio tipo. <br><br>  <i>SingleBranchScheduler</i> é uma das classes de agendamento mais populares.  Ele monitora uma ramificação e é acionado por uma alteração registrada nela.  Quando ele vê as alterações, ele pode adiar o envio de uma solicitação de construção (adiar pelo período especificado no parâmetro especial <i>treeStableTimer</i> ).  O <i>nome</i> especifica o nome do agendamento que será exibido na interface <b>BuildBot</b> -web.  Um <i>filtro</i> é definido no <i>ChangeFilter</i> , depois de passar pelas alterações na ramificação que solicitam que o agendamento envie uma solicitação de construção.  O nome <i>construtor</i> -a é especificado em <i>builderNames</i> , que especificaremos um pouco mais tarde.  O nome no nosso caso será o mesmo que o nome do projeto: <i>yourProject</i> . <br><br>  <i>ForceScheduler é uma</i> coisa muito simples.  Esse tipo de agendamento é acionado por um clique do mouse na interface <b>BuildBot</b> -web.  Os parâmetros têm a mesma essência que em <i>SingleBranchScheduler</i> . <br><br>  <b>PS No. 3.</b>  <b>De repente, vem a calhar</b> <br>  <i>Periódico</i> é um planejamento que é acionado em uma frequência específica de tempo determinado.  Parece uma chamada como esta <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> buildbot.plugins <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> schedulers nightly = schedulers.Periodic(name=<span class="hljs-string"><span class="hljs-string">"daily"</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"full-solaris"</span></span>], periodicBuildTimer=<span class="hljs-number"><span class="hljs-number">24</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [nightly]</code> </pre><br><a name="buildfactory"></a><h4>  <u>5.5 BuildFactory</u> </h4><br><pre> <code class="python hljs">factory = util.BuildFactory() factory.addStep(steps.Git(repourl=<span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'incremental'</span></span>)) factory.addStep(steps.ShellCommand(command=[<span class="hljs-string"><span class="hljs-string">"trial"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>], env={<span class="hljs-string"><span class="hljs-string">"PYTHONPATH"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>}))</code> </pre><br>  <i>periodicBuildTimer</i> define o tempo dessa periodicidade em segundos. <br><br>  <i>BuildFactory</i> cria uma <i>construção</i> concreta, que o <i>construtor</i> envia ao <b>Trabalhador</b> .  <i>BuildFactory</i> indica as etapas que um <b>trabalhador</b> deve seguir.  As etapas são adicionadas chamando o método <i>addStep.</i> <i><br></i> <br><br>  A primeira etapa adicionada neste exemplo é <i>git clean -d -f -f –x e</i> , em seguida, <i>git checkout</i> .  Essas ações são incorporadas no parâmetro <i>method</i> , que não é claramente indicado, mas implica o valor padrão de <i>fresh</i> .  O parâmetro <i>mode = 'incremental'</i> indica que os arquivos do diretório em que o <i>chechout</i> é feito, embora ausentes no repositório, permanecem intocados. <br><br>  A segunda etapa adicionada é chamar o script de <i>avaliação</i> com o parâmetro <i>hello</i> no lado <b>Worker</b> do diretório <i>/ home / habr / worker / yourProject / build</i> com a variável de ambiente PATHONPATH = ... Para que você possa escrever seus próprios scripts e executá-los no lado <b>Worker</b> -a através da etapa <i>util.ShellCommand</i> .  Esses scripts podem ser colocados diretamente no repositório.  Depois, durante o <i>chechout,</i> eles irão para <i>/ home / habr / worker / yourProject / build</i> .  No entanto, existem dois "buts": <br><ol><li>  <b>O trabalhador</b> deve ser criado com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><i>opção --umask</i></a> para que não bloqueie os direitos de execução após o <i>checkout</i> -a. </li><li>  Quando o <i>git</i> <i>envia</i> esses scripts, é necessário especificar a propriedade <i>exacutável</i> , para que, com <i>chechout</i> -e, o Git não perca o direito de executar o script. </li></ol><br><br><a name="builders"></a><h4>  <u>5.6 construtores</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>].append(util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>, workernames=[<span class="hljs-string"><span class="hljs-string">"example-worker"</span></span>], factory=factory))</code> </pre><br>  Sobre o que o <i>Builder</i> foi descrito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Agora vou falar com mais detalhes sobre como criá-lo.  <i>BuilderConfig</i> é um construtor de <i>construtores</i> .  Você pode especificar vários desses construtores em <i>c ['builders']</i> , pois esta é uma lista de objetos do tipo <i>construtor</i> .  Agora vamos reescrever um pouco o exemplo do <b>BuildBot</b> , aproximando-o da nossa tarefa. <br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>].append(util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>, workernames=[<span class="hljs-string"><span class="hljs-string">"yourWorkerName"</span></span>], factory=factory))</code> </pre><br>  Agora vou falar sobre os parâmetros <i>BuilderConfig</i> . <br><br>  <i>nome</i> define o <i>construtor de</i> nomes -a.  Aqui chamamos de seu <i>projeto</i> .  Isso significa que no <b>Worker</b> esse mesmo caminho <i>/ home / habr / worker / yourProject / build</i> será criado.  <i>Sheduler</i> procura um <i>construtor</i> com esse nome. <br><br>  <i>nomes de trabalho</i> contém uma lista de <b>trabalhadores</b> .  Cada um dos quais deve ser adicionado a <i>c ['trabalhadores']</i> . <br><br>  <i>factory</i> é a <i>construção</i> específica à qual o <i>construtor está</i> associado.  Ele enviará um objeto de <i>construção</i> ao <b>Worker</b> para concluir todas as etapas que compõem essa <i>construção</i> -a. <br><br><a name="myconfig"></a><h3>  6. Exemplo de configuração própria </h3><hr><br>  Aqui está um exemplo de arquitetura de projeto que proponho implementar através do <b>BuildBot</b> <b><br></b>  . <br><br>  Usaremos o <i>svn</i> como um sistema de controle de versão.  O próprio repositório estará em uma determinada nuvem.  Aqui está o endereço dessa nuvem <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">svn.host/svn/yourProject/trunk</a></i> .  Na nuvem em <i>svn,</i> existe um nome de <i>usuário</i> : <i>user</i> , passwd: <i>password</i> account.  Os scripts que são as etapas de <i>construção</i> -a também estarão no ramo <i>svn</i> , em uma <i>pasta buildbot / worker_linux</i> separada.  Esses scripts estão no repositório com a propriedade <i>executável</i> salva. <br><br>  <b>BuildMaster</b> e <b>Worker</b> trabalham no mesmo host <i>project.host</i> .  <b>O BuildMaster</b> armazena seus arquivos na pasta <i>/ home / habr / master</i> .  <b>Worker</b> armazena o seguinte caminho <i>/ home / habr / worker</i> .  A comunicação entre os processos <b>BuildMaster</b> e <b>Worker</b> é <b>realizada</b> através da porta 4000 usando o protocolo <b>BuildBot</b> -a, ou seja, o protocolo <i>'pb'</i> . <br><br>  O projeto de destino é inteiramente escrito em python.  A tarefa é rastrear suas alterações, criar um arquivo executável, gerar documentação, realizar testes.  Em caso de falha, todos os desenvolvedores precisam enviar uma mensagem para o e-mail informando que há uma ação com falha. <br><br>  Vamos conectar o mapeamento da Web <b>BuildBot</b> à porta 80 para <i>project.host</i> .  O Apatch é opcional.  A biblioteca <i>distorcida</i> já possui um servidor web, o <b>BuildBot a</b> utiliza. <br><br>  <b>Usaremos</b> o <i>sqlite</i> para armazenar informações internas para o <b>BuildBot</b> . <br><br>  Para enviar correio, você precisa do host <i>smtp.seu.domínio</i> - ele permite enviar e-mails de <i>projectHost@seu.domínio</i> sem autenticação.  Também no host ' <i>smtp</i> ', o protocolo é escutado em 1025. <br><br>  Há duas pessoas envolvidas no processo: <i>administrador</i> e <i>usuário</i> .  admin administra o <b>BuildBot</b> .  usuário é a pessoa que confirma o <i>commit</i> . <br><br>  Um arquivo exacutável é gerado através do <i>pyinstaller</i> .  A documentação é gerada através do <i>doxygen</i> . <br><br>  Para esta arquitetura, escrevi este <i>master.cfg</i> : <br><br><div class="spoiler">  <b class="spoiler_title">master.cfg</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os, re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> buildbot.plugins <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> steps, util, schedulers, worker, changes, reporters c= BuildmasterConfig ={} c[<span class="hljs-string"><span class="hljs-string">'workers'</span></span>] = [ worker.Worker(<span class="hljs-string"><span class="hljs-string">'yourWorkerName'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>) ] c[<span class="hljs-string"><span class="hljs-string">'protocols'</span></span>] = {<span class="hljs-string"><span class="hljs-string">'pb'</span></span>: {<span class="hljs-string"><span class="hljs-string">'port'</span></span>: <span class="hljs-number"><span class="hljs-number">4000</span></span>}} svn_poller = changes.SVNPoller(repourl=<span class="hljs-string"><span class="hljs-string">"https://svn.host/svn/yourProject/trunk"</span></span>, svnuser=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, svnpasswd=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, pollinterval=<span class="hljs-number"><span class="hljs-number">60</span></span>, split_file=util.svn.split_file_alwaystrunk ) c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = svn_poller hourlyscheduler = schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"your-project-schedulers"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>), builderNames=[<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>], properties = {<span class="hljs-string"><span class="hljs-string">'owner'</span></span>: <span class="hljs-string"><span class="hljs-string">'admin'</span></span>} ) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [hourlyscheduler] checkout = steps.SVN(repourl=<span class="hljs-string"><span class="hljs-string">'https://svn.host/svn/yourProject/trunk'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'full'</span></span>, method=<span class="hljs-string"><span class="hljs-string">'fresh'</span></span>, username=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, password=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, haltOnFailure=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) projectHost_build = util.BuildFactory() cleanProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Clean"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"buildbot/worker_linux/pyinstaller_project"</span></span>, <span class="hljs-string"><span class="hljs-string">"clean"</span></span>] ) buildProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Build"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"buildbot/worker_linux/pyinstaller_project"</span></span>, <span class="hljs-string"><span class="hljs-string">"build"</span></span>] ) doxyProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Update Docs"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"buildbot/worker_linux/gendoc"</span></span>, []] ) testProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Tests"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"python"</span></span>,<span class="hljs-string"><span class="hljs-string">"tests/utest.py"</span></span>], env={<span class="hljs-string"><span class="hljs-string">'PYTHONPATH'</span></span>: <span class="hljs-string"><span class="hljs-string">'.'</span></span>} ) projectHost_build.addStep(checkout) projectHost_build.addStep(cleanProject) projectHost_build.addStep(buildProject) projectHost_build.addStep(doxyProject) projectHost_build.addStep(testProject) c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [ util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>, workername=<span class="hljs-string"><span class="hljs-string">'yourWorkerName'</span></span>, factory=projectHost_build) ] template_html=<span class="hljs-string"><span class="hljs-string">u'''\ &lt;h4&gt;  : {{ summary }}&lt;/h4&gt; &lt;p&gt;   : {{ workername }}&lt;/p&gt; &lt;p&gt;: {{ projects }}&lt;/p&gt; &lt;p&gt;         : {{ buildbot_url }}&lt;/p&gt; &lt;p&gt;         : {{ build_url }}&lt;/p&gt; &lt;p&gt; WinSCP     c ip:xxx.xx.xxx.xx.   habr/password,   executable    ~/worker/yourProject/build/dist.&lt;/p&gt; &lt;p&gt;&lt;b&gt;    Buildbot&lt;/b&gt;&lt;/p&gt; '''</span></span> sendMessageToAll = reporters.MailNotifier(fromaddr=<span class="hljs-string"><span class="hljs-string">"projectHost@your.domain"</span></span>, sendToInterestedUsers=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, lookup=<span class="hljs-string"><span class="hljs-string">"your.domain"</span></span>, relayhost=<span class="hljs-string"><span class="hljs-string">"smtp.your.domain"</span></span>, smtpPort=<span class="hljs-number"><span class="hljs-number">1025</span></span>, mode=<span class="hljs-string"><span class="hljs-string">"warnings"</span></span>, extraRecipients=[<span class="hljs-string"><span class="hljs-string">'user@your.domain'</span></span>], messageFormatter=reporters.MessageFormatter( template=template_html, template_type=<span class="hljs-string"><span class="hljs-string">'html'</span></span>, wantProperties=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, wantSteps=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ) c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>] = [sendMessageToAll] c[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] = <span class="hljs-string"><span class="hljs-string">"The process of bulding"</span></span> c[<span class="hljs-string"><span class="hljs-string">'titleURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"http://project.host:80/"</span></span> c[<span class="hljs-string"><span class="hljs-string">'buildbotURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"http://project.host"</span></span> c[<span class="hljs-string"><span class="hljs-string">'www'</span></span>] = dict(port=<span class="hljs-number"><span class="hljs-number">80</span></span>, plugins=dict(waterfall_view={}, console_view={}, grid_view={})) c[<span class="hljs-string"><span class="hljs-string">'db'</span></span>] = { <span class="hljs-string"><span class="hljs-string">'db_url'</span></span> : <span class="hljs-string"><span class="hljs-string">"sqlite:///state.sqlite"</span></span> }</code> </pre><br></div></div><br>  Primeiro você precisa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">criar</a> <b>BuildMaster</b> e <b>Worker</b> -a.  Em seguida, cole este arquivo <i>master.cfg</i> em <i>/ home / habr / master</i> . <br><br>  O próximo passo é iniciar o serviço <b>BuildMaster</b> <br><pre> <code class="bash hljs">sudo buildbot start /home/habr/master</code> </pre><br>  Em seguida, inicie o serviço <b>Worker-a</b> <br><pre> <code class="bash hljs">buildbot-worker start /home/habr/worker</code> </pre><br>  Feito!  Agora o <b>Buildbot</b> rastreia as alterações e <b>executa</b> no <i>commit</i> no <i>svn</i> , seguindo as etapas de criação e teste do projeto com a arquitetura acima. <br><br>  Abaixo, descreverei alguns recursos do <i>master.cfg</i> acima <i>.</i> <i><br></i> <br><br><a name="fails"></a><h4>  <u>6.1 A caminho do seu master.cfg</u> </h4><br>  Ao escrever seu <i>master.cfg,</i> muitos erros serão cometidos; portanto, você precisará ler o arquivo de log.  Ele é armazenado no caminho absoluto BuildMaster <b>-ec</b> /home/habr/master/twistd.log e no lado <b>Worker-a</b> com o caminho absoluto <i>/home/habr/worker/twistd.log</i> .  Ao ler o erro e corrigi-lo, você precisará reiniciar o serviço <b>BuildMaster</b> -a.  Veja como fazê-lo: <br><pre> <code class="bash hljs">sudo buildbot stop /home/habr/master sudo buildbot upgrade-master /home/habr/master sudo buildbot start /home/habr/master</code> </pre><br><a name="svn"></a><h4>  <u>6.2 Trabalhar com svn</u> </h4><br><pre> <code class="python hljs">svn_poller = changes.SVNPoller(repourl=<span class="hljs-string"><span class="hljs-string">"https://svn.host/svn/yourProject/trunk"</span></span>, svnuser=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, svnpasswd=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, pollinterval=<span class="hljs-number"><span class="hljs-number">60</span></span>, split_file=util.svn.split_file_alwaystrunk ) c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = svn_poller hourlyscheduler = schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"your-project-schedulers"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>), builderNames=[<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>], properties = {<span class="hljs-string"><span class="hljs-string">'owner'</span></span>: <span class="hljs-string"><span class="hljs-string">'admin'</span></span>} ) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [hourlyscheduler] checkout = steps.SVN(repourl=<span class="hljs-string"><span class="hljs-string">'https://svn.host/svn/yourProject/trunk'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'full'</span></span>, method=<span class="hljs-string"><span class="hljs-string">'fresh'</span></span>, username=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, password=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, haltOnFailure=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre><br>  Primeiro, dê uma olhada no <i>svn_poller</i> .  Essa é a mesma interface que consulta regularmente o repositório uma vez por minuto.  Nesse caso, <i>svn_poller</i> acessa apenas a ramificação do <i>tronco</i> .  O misterioso parâmetro <i>split_file = util.svn.split_file_alwaystrunk</i> define as regras: como dividir a estrutura das pastas <i>svn</i> em ramificações.  Ele lhes oferece maneiras relativas.  Por sua vez, <i>split_file_alwaystrunk</i> simplifica o processo dizendo que apenas o <i>tronco está</i> no repositório. <br><br>  Nos <i>Agendadores</i> , o <i>ChangeFilter</i> é <i>especificado</i> , que vê <i>None</i> e associa a ramificação do <i>tronco</i> a ela de acordo com a associação especificada por meio de <i>split_file_alwaystrunk</i> .  Respondendo a alterações no <i>tronco</i> , inicia o <i>construtor</i> chamado <i>yourProject</i> . <br><br>  aqui as <i>propriedades</i> são necessárias para que o administrador receba o boletim da montagem e teste os resultados como o proprietário do processo. <br><br>  A etapa <i>build</i> -a <i>checkout</i> é capaz de excluir completamente todos os arquivos que estão na versão local do repositório <b>Worker</b> .  A então faça a <i>atualização</i> completa do <i>svn</i> .  O modo é configurado através do parâmetro <i>mode = full</i> , <i>method = fresh</i> .  O parâmetro <i>haltOnTailure</i> indica que, se o <i>svn update</i> <i>não</i> for <i>bem</i> - <i>sucedido</i> , todo o processo de montagem e teste deverá ser suspenso, pois etapas adicionais não fazem sentido. <br><br><a name="reporter"></a><h4>  <u>6.3 Uma carta para você: os repórteres estão autorizados a declarar</u> </h4><br>  <i>repórteres</i> é um serviço de notificação por correio. <br><pre> <code class="python hljs">template_html=<span class="hljs-string"><span class="hljs-string">u'''\ &lt;h4&gt;  : {{ summary }}&lt;/h4&gt; &lt;p&gt;   : {{ workername }}&lt;/p&gt; &lt;p&gt;: {{ projects }}&lt;/p&gt; &lt;p&gt;         : {{ buildbot_url }}&lt;/p&gt; &lt;p&gt;         : {{ build_url }}&lt;/p&gt; &lt;p&gt; WinSCP     c ip:xxx.xx.xxx.xx.   habr/password,   executable    ~/worker/yourProject/build/dist.&lt;/p&gt; &lt;p&gt;&lt;b&gt;    Buildbot&lt;/b&gt;&lt;/p&gt; '''</span></span> sendMessageToAll = reporters.MailNotifier(fromaddr=<span class="hljs-string"><span class="hljs-string">"projectHost@your.domain"</span></span>, sendToInterestedUsers=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, lookup=<span class="hljs-string"><span class="hljs-string">"your.domain"</span></span>, relayhost=<span class="hljs-string"><span class="hljs-string">"smtp.your.domain"</span></span>, smtpPort=<span class="hljs-number"><span class="hljs-number">1025</span></span>, mode=<span class="hljs-string"><span class="hljs-string">"warnings"</span></span>, extraRecipients=[<span class="hljs-string"><span class="hljs-string">'user@your.domain'</span></span>], messageFormatter=reporters.MessageFormatter( template=template_html, template_type=<span class="hljs-string"><span class="hljs-string">'html'</span></span>, wantProperties=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, wantSteps=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ) c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>] = [sendMessageToAll]</code> </pre><br>  Pode enviar mensagens de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">várias maneiras</a> . <br><br>  <i>MailNotifier</i> usa email para enviar notificações. <br><br>  <i>template_html</i> define o modelo de texto para o boletim.  Para criar marcação, use html.  É modificado pelo mecanismo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><i>jinja2</i></a> (pode ser comparado com o <i>django</i> ).  <b>O BuildBot</b> possui um conjunto de variáveis, cujos valores são substituídos no modelo no processo de formação do texto da mensagem.  Essas variáveis ​​são inscritas em {{double curly chaves}}.  Assim, por exemplo, o <i>resumo</i> exibe o status das operações concluídas, ou seja, sucesso ou falha.  E os <i>projetos</i> produzirão o seu <i>projeto</i> .  Portanto, usando comandos de controle no <i>jinja2</i> , variáveis <i>BuildBot</i> e formatadores de string python, você pode criar uma mensagem muito informativa. <br><br>  <i>MailNotifier</i> contém os seguintes argumentos. <br><br>  <i>fromaddr</i> - o endereço do qual todos receberão o boletim. <br><br>  <i>sendToInterestedUsers</i> = True envia uma mensagem ao proprietário e usuário que efetuou a <i>confirmação</i> . <br><br>  <i>lookup</i> - sufixo a ser adicionado aos nomes dos usuários que recebem o boletim.  Portanto, o <i>administrador</i> como usuário receberá a newsletter em admin@seu.domínio. <br><br>  <i>relayhost</i> especifica o nome do host no qual o servidor <i>smtp</i> está aberto e <i>smptPort</i> especifica o número da porta na qual o servidor <i>smtp</i> atende. <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mode = "warning"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diz que a correspondência deve ser feita apenas se houver pelo menos uma etapa de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">construção</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que terminou com falha ou status de aviso. Em caso de sucesso, a correspondência não é necessária. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extraRecipients</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contém uma lista de indivíduos para quem a correspondência deve ser feita, além do proprietário e da pessoa que fez o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">messageFormatter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é um objeto que define o formato da mensagem, seu modelo e o conjunto de variáveis ​​disponíveis no </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jinja2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Parâmetros como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wantProperties = True</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wantSteps = True</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> especificam este conjunto de variáveis ​​disponíveis. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with ['services'] = [sendMessageToAll]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fornece uma lista de serviços, entre os quais estarão nossos</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repórter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="goodboy"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós conseguimos! </font><font style="vertical-align: inherit;">Meus parabéns</font></font></h3><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criamos nossa própria configuração e vimos a funcionalidade que o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BuildBot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é </font><b><font style="vertical-align: inherit;">capaz</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Acho que isso é suficiente para entender se essa ferramenta é necessária para criar seu projeto. </font><font style="vertical-align: inherit;">Ele é interessante para você? </font><font style="vertical-align: inherit;">Será útil para você? </font><font style="vertical-align: inherit;">É conveniente trabalhar? </font><font style="vertical-align: inherit;">Então escrevo este artigo por um bom motivo.</font></font><br><br>  E mais uma coisa.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gostaria que a comunidade profissional usando o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BuildBot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se tornasse mais ampla, os manuais sejam traduzidos e há ainda mais exemplos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obrigado a todos pela atenção.</font></font> Boa sorte </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460501/">https://habr.com/ru/post/pt460501/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460491/index.html">Sensor de temperatura e umidade do Arduino com envio e plotagem (Parte 1)</a></li>
<li><a href="../pt460493/index.html">"Aplicativos matadores" para PC dos anos 80: VisiCalc e WordStar</a></li>
<li><a href="../pt460495/index.html">Container-to-pipeline: CRI-O agora é o padrão no OpenShift Container Platform 4</a></li>
<li><a href="../pt460497/index.html">Uso intuitivo dos métodos de Monte Carlo com cadeias de Markov</a></li>
<li><a href="../pt460499/index.html">Três vencedores do Prêmio Dijkstra: como foram o Hydra 2019 e o SPTDC 2019</a></li>
<li><a href="../pt460503/index.html">Configuração sem fio do Raspberry PI 3 B +</a></li>
<li><a href="../pt460505/index.html">Seduza três cruzamentos, ou por que os projetos são tão difíceis de terminar a tempo</a></li>
<li><a href="../pt460507/index.html">XEN e o futuro do setor automotivo: como um hipervisor de código aberto se torna um concorrente de soluções automotivas comerciais</a></li>
<li><a href="../pt460509/index.html">Como os proxies residentes ajudam nos negócios: um caso real do uso do Infatica no Data Mining</a></li>
<li><a href="../pt460511/index.html">Ajuste do PHP-FPM: usando pm static para desempenho máximo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>