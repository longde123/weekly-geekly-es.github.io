<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ö±Ô∏è üëáüèª üéñÔ∏è Qu√© hacer el fin de semana: control remoto por intercomunicador, reasignaci√≥n sin presupuesto de Nextion, enfrentamiento con Onlaym üïâÔ∏è ü§£ ü•Å</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A veces los viernes la ficci√≥n se considera aceptable aqu√≠. Hoy, por supuesto, no es viernes, pero no es del todo ficci√≥n, sino tres mini novelas que ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Qu√© hacer el fin de semana: control remoto por intercomunicador, reasignaci√≥n sin presupuesto de Nextion, enfrentamiento con Onlaym</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/400367/"><img src="https://habrastorage.org/files/044/f5f/30d/044f5f30df86463087940fff4fc4ba92.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces los viernes la ficci√≥n se considera aceptable aqu√≠. </font><font style="vertical-align: inherit;">Hoy, por supuesto, no es viernes, pero no es del todo ficci√≥n, sino tres mini novelas que tienen algo que ver con mi vida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un lector apresurado tambi√©n puede preguntarse qu√© relaciones pueden realmente conectar el intercomunicador y el proveedor de Internet. </font><font style="vertical-align: inherit;">Y ser√° correcto, porque yo tampoco llegu√© inmediatamente a esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero sobre todo (Arduino, trucos de vida banales, disputas telef√≥nicas) en orden.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim-sim, abre!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ser honesto, el control remoto del intercomunicador seg√∫n mi versi√≥n es casi in√∫til, y me di cuenta de esto antes de comenzar. Por lo tanto, para justificar la empresa, tuve que usar todo el poder de la imaginaci√≥n para llegar a un par de casos, como dicen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para empezar, decid√≠ que de esta manera dejar√≠a que los invitados se calentaran en el porche, si a√∫n no hab√≠a logrado correr a casa. O no me molestar√© especialmente en obtener las llaves con anticipaci√≥n; despu√©s de todo, puede configurar el tel√©fono para que me d√© la orden de abrir la puerta cuando llegue a la casa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la gente com√∫n suena bastante salvaje, pero como dicen, por aspera ad astra.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y realmente quer√≠a usar de alguna manera un par de rel√©s en el caso, que han estado inactivos en el controlador central desde el comienzo de su operaci√≥n. La situaci√≥n, de hecho, es rid√≠cula: en ese momento solo hab√≠a un bloqueo para 4 rel√©s disponibles, de los cuales solo se necesitaban dos. Y no quer√≠a esperar otro mes para el bloqueo de dos rel√©s, as√≠ que deduje lo que ten√≠a a mano e inmediatamente comenc√© a preocuparme por la redundancia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, a los intercomunicadores. En general, la apertura autom√°tica de un sistema de intercomunicaci√≥n no es algo exclusivo. Por ejemplo, aqu√≠ en Geektimes, camarada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2013 (cuando el d√≥lar era 30), </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;">Cluster</font></a><font style="vertical-align: inherit;"> no solo hizo un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">control remoto, sino tambi√©n un contestador autom√°tico para los invitados</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es, con mucho, la cosa m√°s genial que he visto en esta clase. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero mucho antes, los visitantes de RadioKota y muchos otros foros tem√°ticos</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se divirti√≥ con dispositivos como "abridor"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - desbloquear el intercomunicador inmediatamente en una llamada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No iba a repetir ni lo uno ni lo otro. </font><font style="vertical-align: inherit;">El primero, porque es dif√≠cil y porque ya ten√≠a un controlador que funcionaba, que planeaba dar nuevos poderes. </font><font style="vertical-align: inherit;">El segundo por razones m√°s obvias: demasiados detalles y muy poco sentido, me disculpo si ofend√≠ a los autores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sentido, por supuesto, para m√≠, y para nada. </font><font style="vertical-align: inherit;">Es decir, categ√≥ricamente no me gusta el esquema, que hospitalariamente abre la puerta a cualquiera que marque un n√∫mero de apartamento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De ah√≠ los requisitos b√°sicos para mi abridor: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Uso de un controlador central para controlar a trav√©s de Internet y radio </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Protecci√≥n m√≠nima contra el acceso no autorizado</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) m√≠nima interferencia en el interior</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicio</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenc√© familiariz√°ndome con el principio de funcionamiento del intercomunicador, que tom√© prestado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tubo funciona de manera muy simple: cuando se coloca el tubo, tiene una resistencia de 50 ohmios, cuando se retira el tubo, la resistencia es de aprox. </font><font style="vertical-align: inherit;">400 ohmios, cuando se presiona el bot√≥n de desbloqueo, la resistencia se mide en kiloohmios ... Cuando no hay llamada, no hay voltaje en la l√≠nea. </font><font style="vertical-align: inherit;">Cuando entra una llamada y el tel√©fono pone una corriente grande y el voltaje resulta ser peque√±o 5-7V, cuando el tel√©fono est√° ausente y la resistencia se llama al infinito y el voltaje es m√°ximo aprox. </font><font style="vertical-align: inherit;">15 V cuando el tel√©fono est√° apagado, aproximadamente 10 V. </font><font style="vertical-align: inherit;">Cuando se presiona el bot√≥n de voltaje, el m√°ximo es de aprox. </font><font style="vertical-align: inherit;">15V: presionar el bot√≥n equivale al salto de l√≠nea.</font></font></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el caso de Digital, esto es ligeramente diferente, ya que la documentaci√≥n del tel√©fono, pero ten√≠a KM-2NO (por cierto, expreso mi gratitud a Digital por publicar el esquema) indica:</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Consumo de corriente en el modo "Talk" 18-22 mA </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Voltaje de l√≠nea con un tubo instalado en la carcasa 1.5‚Äì2.5 V </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Voltaje de l√≠nea con un tubo arriba 5.8-6.5 V</font></font><br>
</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, me familiaric√© con m√°s detalle con el diagrama de circuito de mi tuber√≠a: </font></font><br>
<br>
<img src="https://habrastorage.org/files/b76/591/c8f/b76591c8f87c4eaca7a8bfec1f652f39.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y descubr√≠ que todo es exactamente igual en t√©rminos de resistencia, y lo m√°s probable es que el resto de la l√≥gica de la Digital no sea diferente de la Visita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Llamo la atenci√≥n sobre el hecho de que mi modificaci√≥n es sin un LED. Pero esto result√≥ ser correcto, ya que este hecho hace que sea muy f√°cil transmitir informaci√≥n de llamadas al controlador central. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A saber: la llamada suena, el LED "se enciende", el optoacoplador se enciende, en el pin del controlador tenemos un cambio de nivel de mayor a menor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, en lugar del LED, instal√© mi optoacoplador 4N35, cuya salida envi√© directamente al Arduino. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De acuerdo con el esquema est√°ndar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la misma Internet:</font></font><br>
<br>
<img src="https://habrastorage.org/files/a7f/c39/9f8/a7fc399f840e4931b225370b2f21c3cd.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y como quer√≠a sobrevivir con un m√≠nimo de detalles y recursos de controlador disponibles, de los cuales los pines digitales eran los m√°s valiosos (Uno no era suficiente para ellos), en lugar de una resistencia pull-up de 10K, utilic√© la resistencia pull-up incorporada de Arduino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se conecta a un pin digital, se ve as√≠:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _</span></span><font></font>
<font></font>
pinMode(ringPin, INPUT_PULLUP);<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se conecta a un pin anal√≥gico:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _</span></span><font></font>
<font></font>
pinMode(ringPin, INPUT);<font></font>
digitalWrite(ringPin, HIGH);<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decid√≠ colocar el optron del microcontrolador. </font><font style="vertical-align: inherit;">No puedo justificarlo, pero pens√© que hay menos riesgo de falsos positivos por posibles recogidas. </font><font style="vertical-align: inherit;">Es posible que est√© equivocado, pero hasta ahora todo es normal con consejos. </font><font style="vertical-align: inherit;">No lo son. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cuanto a la tierra en el ejemplo anterior, debe comprender: aunque la tierra parece ser com√∫n en el diagrama, esto no es as√≠; de hecho, en realidad hay un aislamiento optoelectr√≥nico. </font><font style="vertical-align: inherit;">Bueno, para eso √©l es un ejemplo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Deshazte de m√≠!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La decisi√≥n de deshacerse por completo de los circuitos de intercomunicaci√≥n no lleg√≥ de inmediato, sino inevitablemente. Por cierto, record√© mucho el caso de hace seis a√±os, cuando vi c√≥mo se form√≥ un momento inc√≥modo con una cerradura electromagn√©tica durante la instalaci√≥n de un ACS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No s√© c√≥mo sucedi√≥, pero result√≥ que el castillo funcionaba de alguna manera. Ese "arrastre", luego nada en absoluto, y los propios instaladores ya se rompieron la cabeza. Pero al final se sugiri√≥ que ten√≠an un cortocircuito inesperado en alg√∫n lugar (o algo as√≠) en los circuitos de control. Por supuesto, verificamos todo, por supuesto, sin mucho √©xito, ya que se configuraron claramente de acuerdo con las instrucciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se agreg√≥ aceite al fuego por el hecho de que exactamente la misma cerradura ten√≠a exactamente la misma configuraci√≥n, pero funcion√≥ bien en el otro piso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cu√°nto tiempo, brevemente, decidieron que el asunto estaba en la puerta misma, en la cual est√° conectada la cerradura. En mi opini√≥n, sugirieron que cuando se instal√≥, se clavaron en la armadura, que, a su vez, estaba conectada a tierra, lo que provoc√≥ efectos inesperados en la cerradura (que, posiblemente, ten√≠a una cerradura de control en la carcasa). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, resolvieron bastante tiempo y tediosamente. Y no quer√≠a repetir lo mismo en casa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, no guard√© cables y conect√© los contactos del rel√© de la manera m√°s simple: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Normalmente cerrado un rel√© - en serie con el bot√≥n arriba SW1 (porque este bot√≥n est√° cerrado en el estado normal) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Normalmente abierto otro rel√© - en paralelo con el bot√≥n de apertura de la puerta SB1 ( porque este bot√≥n normalmente est√° abierto)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los contactos de control de rel√©, por supuesto, conectados a los pines digitales libres (hurra, todav√≠a eran) del microcontrolador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En total, es f√°cil imaginar que se necesitaron seis cables: dos para el optoacoplador y cuatro m√°s para el rel√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pido disculpas por el primitivismo de la ilustraci√≥n:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desde el intercomunicador</font></font></h4><br>
<img src="https://habrastorage.org/files/cfe/2f2/23c/cfe2f223cb2b4d49ad1b853482b3895a.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por arduino</font></font></h4><br>
<img src="https://habrastorage.org/files/c99/84f/e4b/c9984fe4be554b13b2ec17915ca86474.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los rel√©s aqu√≠ se muestran exclusivamente esquem√°ticamente. </font><font style="vertical-align: inherit;">Desde entonces, repito, utilic√© m√≥dulos de rel√©s listos para usar con relleno completo: optoacopladores, transistores, diodos, etc. </font><font style="vertical-align: inherit;">Recomiendo no conectar rel√©s desnudos a Arduino.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... y no me llames m√°s!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya en esta etapa, pude abrir f√°cilmente el tel√©fono de </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
la puerta a </font><font style="vertical-align: inherit;">trav√©s de Internet o la red de √°rea local desde una computadora o tel√©fono inteligente de acuerdo con el siguiente principio: </font><font style="vertical-align: inherit;">1) En el momento en que suena el </font><font style="vertical-align: inherit;">tel√©fono de </font><font style="vertical-align: inherit;">la puerta, el controlador entra en modo de permiso para abrir la puerta durante 40 segundos. El tiempo se selecciona en funci√≥n de la documentaci√≥n del interfono digital, donde se indica que la duraci√≥n de la se√±al de llamada es exactamente 40 segundos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es decir durante m√°s tiempo, no tiene sentido permanecer condicionalmente abierto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Al recibir un comando abierto a trav√©s de Internet (HTTP POST), el controlador conmuta secuencialmente el rel√©. Primero, abre el rel√© de tubo, que simula su ascenso. Luego, despu√©s de una breve pausa, el rel√© del bot√≥n de apertura se cierra, simulando as√≠ su presi√≥n. Despu√©s: "suelta" el bot√≥n y "cuelga" el tel√©fono. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El banco de pruebas fue muy primitivo:</font></font><br>
<br>
<img src="https://habrastorage.org/files/3b5/44c/db1/3b544cdb17ab4f67953d7643d98e0156.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ser√≠a posible detener esto si yo, como orgulloso propietario de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KTsDV-12-2,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no fuera consciente de lo inconveniente que es, correr por el control remoto o el tel√©fono cada vez que necesite encender / apagar algo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y, en particular, si no hubiera terminado recientemente una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estaci√≥n meteorol√≥gica de escritorio con una pantalla t√°ctil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y, al parecer, no tiene un potencial completamente desarrollado. </font></font><br>
<br>
<img src="https://habrastorage.org/files/90a/d36/f45/90ad36f45757421295f332c7425578fa.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En resumen, r√°pidamente (en realidad no) agregu√© a la estaci√≥n meteorol√≥gica el transmisor de 433 MHz m√°s com√∫n y vulgar con modulaci√≥n de amplitud, cuyas toneladas se venden en Aliexpress por dinero rid√≠culo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, la estaci√≥n meteorol√≥gica se ha convertido en otro punto de control para el intercomunicador y, por lo tanto, si suena una campana y te sientas a su lado, no tiene sentido romper el tel√©fono, porque desde la pantalla puedes:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Abra la cerradura </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Levante el auricular y lentamente (de acuerdo con la documentaci√≥n, la conversaci√≥n dura 1.5 minutos versus 40 segundos de la llamada), vaya al intercomunicador, responda y decida si abrir o no </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Contestar la llamada (el controlador contesta e inmediatamente "Cuelga") </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para esto, por supuesto, tuve que modificar ligeramente el c√≥digo y la interfaz de la estaci√≥n meteorol√≥gica, pero en el camino descubr√≠ que hay errores molestos en la visualizaci√≥n de gr√°ficos (como result√≥, tengo ADN, pero esta es una historia diferente). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La nueva interfaz, por cierto, ahora no se parece a HAL en absoluto. Ahora, todo es tan colorido y divertido que solo tienes que re√≠r. Y ya ves, entiendo: no beb√≠ batidos, los hipsters no me mordieron, no hab√≠a lamberseks en la familia, y el material me atrae como nunca antes en mi vida:</font></font><br>
<br>
<img src="https://habrastorage.org/files/71a/154/0d4/71a1540d420441d3aa62d3ca673f3a43.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta pantalla reemplaza los datos clim√°ticos cuando suena el intercomunicador: en este momento, el controlador central emite un comando de radio, al que responde la pantalla meteorol√≥gica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede ser un poco il√≥gico aqu√≠, pero la campana en el centro le informa principalmente sobre la llamada de intercomunicador. </font><font style="vertical-align: inherit;">Al presionarlo (il√≥gico aqu√≠) se silencia el sonido del intercomunicador de la manera m√°s b√°rbara, al imitar el proceso de subir y bajar el auricular. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El castillo de la izquierda es la apertura del castillo. </font><font style="vertical-align: inherit;">Auricular a la derecha: levantar el auricular para simular el inicio de una conversaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pantalla cambia a la principal despu√©s de 40 segundos desde el inicio de la llamada, y no inmediatamente presionando el bot√≥n de icono. </font><font style="vertical-align: inherit;">Esto le permite presionar varias veces si el controlador repentinamente no "escuch√≥" un comando, lo que no es raro dado el tipo de canal de radio utilizado.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritmos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencion√©, al principio era modesto y solo quer√≠a una cosa: abrir el intercomunicador por comando desde el tel√©fono y en el momento de la llamada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero despu√©s de jugar un par de d√≠as, me di cuenta de que pararse frente al intercomunicador y tocar la pantalla es una tarea bastante aburrida, y es mucho m√°s interesante permitir una apertura "retrasada" cuando te acercas a la entrada. Luego solo queda marcar el n√∫mero del apartamento en el panel del interfono y listo, la puerta est√° abierta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, pens√© que en esta situaci√≥n, probablemente tenga sentido prohibir la apertura, en general. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero luego se recuper√≥, luego se solt√≥, tom√≥ una herramienta m√°s √∫til, popularmente llamada navaja de afeitar de Occam, y r√°pidamente se deshizo de entidades adicionales. A saber: como estaba haciendo el control remoto, no era para apagarlo. Por lo tanto, el apagado no es necesario en absoluto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En segundo lugar, de acuerdo con el pensamiento sobrio (y no como de costumbre), result√≥ que no hab√≠a una diferencia especial entre abrir por un comando inmediatamente en el momento de la llamada o por un comando dado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, volviendo a la ergonom√≠a del control, quiero decir que cuantos m√°s modos, menos gente com√∫n los usar√°. S√≠, soy aburrido, pero cuando imagin√© que ten√≠a tres modos para diferentes ocasiones, me di cuenta de que todav√≠a estar√≠a usando uno. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, el modo es uno y el comando es uno, y hay dos procesadores: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Si suena el intercomunicador, el controlador permite la apertura dentro de los 40 segundos desde el inicio de la llamada</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Si el comando de apertura se recibe primero, el controlador permite la apertura y espera una llamada dentro de N minutos desde el momento en que se recibi√≥ el comando (esto es para preparar el intercomunicador para abrir en el camino a la casa) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede haber dos fuentes del comando de apertura: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) HTTP POST- una solicitud a trav√©s de una red local o Internet (por ejemplo: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myserver.com/?sim-sim-openup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), es decir puede abrir al menos desde Kuala Lumpur </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) El comando de radio desde los paneles o botones de la casa (en mi implementaci√≥n, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trav√©s de la biblioteca RC-Switch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y dado que toda la estructura est√° conectada al tel√©fono sin afectar su funcionamiento, el intercomunicador puede continuar us√°ndose de la manera habitual (bot√≥n de timbre-auricular-hola-hola), es decir. </font><font style="vertical-align: inherit;">nacionales, no pueden apreciar los m√©ritos del progreso tecnol√≥gico, y no est√°n obligados a profundizar en los detalles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonos repentinos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso si no utiliza la funci√≥n de apertura de puerta, ahora resulta que el controlador notifica regularmente que alguien est√° rascando la puerta de la entrada a trav√©s del intercomunicador. </font><font style="vertical-align: inherit;">Para m√≠, como persona curiosa, esta informaci√≥n no carece de inter√©s, y ahora la recibo regularmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√°s importante a√∫n, esta funci√≥n contin√∫a funcionando incluso si apaga el auricular con su interruptor. </font><font style="vertical-align: inherit;">Potencialmente, esto significa que ahora hay menos posibilidades de dejar el intercomunicador desactivado, si de repente necesita excluir temporalmente la posibilidad de sus llamadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, el circuito de intercomunicaci√≥n es tal que cuando se apaga, se hace imposible controlar remotamente el bloqueo (parece que la unidad central cree que en este caso el tel√©fono est√° "colgado", independientemente de su posici√≥n real).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y paisajismo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como me esforc√© por lograr una interferencia m√≠nima en el interior, tuve que tomar una decisi√≥n sobre c√≥mo conectarme al controlador central, sobre la base de que el controlador y el interfono estaban en diferentes lados de la puerta, y el controlador ten√≠a electricidad, pero el interfono no. </font></font><br>
<br>
<img src="https://habrastorage.org/files/7b6/8e8/6c3/7b68e86c3aab453e8fcbc579149f4e2a.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al final, decid√≠ que ser√≠a mejor estirar el cable detr√°s del marco de la puerta y cerrar sus fragmentos con paneles decorativos impresos en una impresora 3D que ocupar otro tomacorriente con una fuente de alimentaci√≥n, no est√° claro c√≥mo tirar de su cable al auricular del tel√©fono y bloquear el canal de radio entre el auricular y el controlador. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e65/a91/84a/e65a9184ab9d4cb29e84e515689e607e.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y creo que en mis condiciones esta es la mejor opci√≥n. </font><font style="vertical-align: inherit;">S√≠, y el relevo se puso en marcha, pero con un canal de radio, nuevamente habr√≠a permanecido en reserva.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reasignaci√≥n de Nextion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hablando de la pantalla del clima de escritorio (estaci√≥n meteorol√≥gica, si lo desea), mencion√© que durante el proceso de acabado logr√© da√±ar el componente principal: la pantalla t√°ctil Nextion. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El desglose no afect√≥ el funcionamiento de su microcontrolador y pantalla de datos a bordo, pero el panel t√°ctil casi fall√≥. Sin embargo, experimentalmente, descubr√≠ que incluso si no presiona demasiado la placa Nextion en un lugar determinado, de esta manera puede restaurar la sensibilidad de la mitad izquierda (aproximadamente) de la pantalla. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este truco funciona inestable y no siempre, pero con la frecuencia suficiente para que pueda soportarlo, pensando en pedir una nueva pantalla.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, esto me hizo feliz y triste. Por un lado, fue posible lograr una operabilidad parcial. Por otro lado, me gustar√≠a jugar un poco m√°s con las listas. Y de repente me di cuenta de la est√∫pida trampa en la que ca√≠: por alguna raz√≥n estaba obsesionada con el uso de toda el √°rea de la pantalla, cuando pod√≠a transferir libremente los botones de "no funciona" al √°rea de trabajo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entiendo que para muchos esta es realmente una decisi√≥n banal. Pero me gustar√≠a compartir alegr√≠a inocente con aquellos que, como yo, aman ir a los extremos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, lo descubr√≠, cambi√© ligeramente el tama√±o de los botones, dibuj√© un nuevo circuito de control virtual en mi cabeza y ¬°listo! Hemos restaurado casi por completo la funcionalidad de una pantalla parcialmente eliminada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fue: se </font></font><br>
<br>
<img src="https://habrastorage.org/files/8cb/774/fc0/8cb774fc06b444ce994ad1470e7319d8.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
convirti√≥ en:</font></font><br>
<br>
<img src="https://habrastorage.org/files/202/2b8/82f/2022b882fd2245a79cc4fae8514ddde5.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el camino, sin embargo, tuve que matar a un perfeccionista en m√≠ mismo y rehacer la pantalla de control de entrada del tel√©fono original a una m√≠nimamente funcional:</font></font><br>
<br>
<img src="https://habrastorage.org/files/bd2/bec/a58/bd2beca5810346c5a99099e1ac046288.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vivir</font></font></h4><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/P6Iqh6SYVRU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando el soporte t√©cnico no es ale</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parecer√≠a que en todos estos altibajos ser√≠a posible terminar, si no fuera por un detalle: de repente descubr√≠ que el intercomunicador (y detr√°s de √©l el resto de la automatizaci√≥n) dej√≥ de controlarse al acceder desde redes externas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es decir, todos los comandos funcionaron sin problemas cuando se conectaron a Internet a trav√©s de la red dom√©stica y a direcciones externas (y no de acuerdo con el tipo interno 192.xxx.xxx.xxx), pero igualmente se negaron sin problemas a ser ejecutados desde las redes de otros operadores (prob√© dos). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debe comprender de inmediato que los comandos se transmiten a trav√©s de una solicitud HTTP a un puerto externo espec√≠fico del enrutador, y desde all√≠ ya se redirigen a la IP interna y al puerto necesarios.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y este esquema ha funcionado sin los m√°s m√≠nimos problemas desde su lanzamiento en 2013 hasta que algo se rompi√≥ en el actual. Y todav√≠a estoy seguro de que no es mi culpa. Pero no s√© c√≥mo verificarlo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, al principio quer√≠a jurar con Beeline, porque inicialmente pens√© que el problema estaba en Internet m√≥vil. Pero luego me recuper√©, encontr√© otro proveedor, lo prob√© y descubr√≠ que a trav√©s de √©l el mismo problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego llam√© a Onlaym y, como pude, le expliqu√© la esencia de las afirmaciones. Y en respuesta, me explicaron popularmente que:</font></font><br>
<br>
<blockquote>               :<br>
TCP/25 ‚Äì  -;<br>
TCP/135-139, TCP/445  UDP/135-139 ‚Äì   ,    MS Windows;<br>
TCP/23, TCP/161, UDP/69  UDP/161‚Äì   .<br>
 <br>
  ,  ,  .</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yo, a su vez, insist√≠ en que mi puerto a) no entra en este rango, b) no funciona, como se esperaba yc) no cambi√© nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© tal una pared de guisantes? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, ¬øqu√© debo hacer? Entonces, cort√©smente, le expliqu√© que, aunque entiendo que mis desafortunados 450 rublos al mes no les har√°n el mal tiempo, pasar√© de ese sinsentido a buscar el mismo sinsentido, pero al menos funciona. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En respuesta, murmuraron nuevamente que me estaban proporcionando IP y luego todos mis problemas. Bueno m√≠o, decid√≠, luego m√≠o. Y por una decisi√≥n decidida, primero verifiqu√© la operabilidad del sistema en otro puerto (cambiado a una unidad): funciona. Y luego realiz√≥ una configuraci√≥n flexible del n√∫mero de puerto en Tasker, a trav√©s del cual, de hecho, el volante es autom√°tico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, a lo que describo mis sufrimientos: objetivamente realmente quer√≠a entender qui√©n estaba equivocado en tal situaci√≥n. </font><font style="vertical-align: inherit;">Porque me siento como un completo idiota: reinici√© el enrutador y verifiqu√© la configuraci√≥n (adem√°s, por iniciativa propia y no por indicaci√≥n de "especialistas"), y a√∫n as√≠ me enviaron al infierno, insinuando mis manos torcidas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuera de la pantalla</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusi√≥n, que utilic√© para la construcci√≥n del siglo: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KTSDV-12-2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Auricular digital KM-2NO - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Optoacoplador 4N35 - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) Cable plano de 10 n√∫cleos (se usaron seis, pero p√≥ngalo todo, por si acaso) - 3 m.5 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
) Conectores al cable - 2 piezas. </font><font style="vertical-align: inherit;">pap√°s y mam√°s </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pantalla meteorol√≥gica</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> casera </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">con pantalla t√°ctil Nextion</font></a><font style="vertical-align: inherit;"> - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7) Transmisor de 433 MHz ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de un kit como este</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) para modificar la pantalla del clima - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8) resistencia de 1 kŒ© para optoacoplador - 1 pc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opciones: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interfaz actualizada para Nextion</font></font></a><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de prueba (antes de la integraci√≥n con KTSDV-12-2 y un conjunto completo de funciones de servicio, solo para comprender el tren de pensamiento)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;RCSwitch.h&gt; //   http://code.google.com/p/rc-switch/</span></span></span></span><font></font>
<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringTimeOut 40000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//       2094</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openTimeOut 300000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    allowOpen        </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> handsetPin A3 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    0</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openPin A4 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    (1)</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin 7 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   (3)</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringCode 360500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//        </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> doorBell 3395840 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//       </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openCode 255899 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//     </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openDelay 1500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> handsetDelay 2500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> txPin 8</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ringTime, openTime; <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
boolean ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
boolean ringRepeat = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       </span></span>
boolean allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     </span></span><font></font>
<font></font>
RCSwitch mySwitch = RCSwitch();<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDoor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
    <font></font>
    digitalWrite(handsetPin, LOW);<font></font>
    delay(handsetDelay);<font></font>
    digitalWrite(openPin, LOW);<font></font>
    delay(openDelay);<font></font>
    digitalWrite(openPin, HIGH);<font></font>
    digitalWrite(handsetPin, HIGH);<font></font>
    ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
    allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      </span></span>
    <span class="hljs-comment"><span class="hljs-comment">// sendMail(37); //           </span></span><font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  mySwitch.enableTransmit(txPin); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  mySwitch.enableReceive(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  pinMode(handsetPin, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">//    </span></span><font></font>
  pinMode(openPin, OUTPUT);<font></font>
  pinMode(ringPin, INPUT_PULLUP  );<font></font>
  digitalWrite(handsetPin, HIGH); <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
  digitalWrite(openPin, HIGH);<font></font>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Ready"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(ringPin) == LOW &amp;&amp; ring == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//            </span></span>
    ring = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    </span></span><font></font>
    ringTime = millis();<font></font>
    <span class="hljs-comment"><span class="hljs-comment">// sendMail(36); //     </span></span>
    mySwitch.send(ringCode, <span class="hljs-number"><span class="hljs-number">24</span></span>);<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"Sent ringCode"</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ringRepeat == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//      </span></span>
      mySwitch.send(doorBell, <span class="hljs-number"><span class="hljs-number">24</span></span>);<font></font>
      Serial.println(<span class="hljs-string"><span class="hljs-string">"DoorBell repeat"</span></span>);<font></font>
    }<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"Ring-ring!"</span></span>);<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - ringTime) &gt; ringTimeOut &amp;&amp; ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   40  (   )    </span></span>
  ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Ring reset"</span></span>);
  <span class="hljs-comment"><span class="hljs-comment">// sendMail(38); //      </span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span> &amp;&amp; allowOpen == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
  openDoor(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Door opened via net"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">false</span></span> &amp;&amp; allowOpen == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//  ""   </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - openTime) &gt; openTimeOut) { <span class="hljs-comment"><span class="hljs-comment">//       </span></span>
   allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; 
   <span class="hljs-comment"><span class="hljs-comment">// sendMail(39); //     </span></span><font></font>
  }<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mySwitch.available()) { <span class="hljs-comment"><span class="hljs-comment">//</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value = mySwitch.getReceivedValue();
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value != <span class="hljs-number"><span class="hljs-number">0</span></span>) {<font></font>
      Serial.println(mySwitch.getReceivedValue());<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (mySwitch.getReceivedValue()) {<font></font>
        <font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> openCode: <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
          <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
            mySwitch.disableReceive();<font></font>
            openDoor(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
            Serial.println(<span class="hljs-string"><span class="hljs-string">"Door opened via radio"</span></span>);<font></font>
            mySwitch.enableReceive(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
          }<font></font>
          <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
    }<font></font>
    mySwitch.resetAvailable();<font></font>
  }<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
}<font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tom√© las fotos para la interfaz en el maravilloso sitio web de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pixabay</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es400367/">https://habr.com/ru/post/es400367/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es400357/index.html">Google muestra un patr√≥n de caridad de triple beneficio</a></li>
<li><a href="../es400359/index.html">–ü—Ä–æ–ø—Ä–∏–æ—Ü–µ–ø—Ü–∏—è –¥–ª—è –Ω–µ—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤. –ß–∞—Å—Ç—å 3. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–∏–¥–µ–Ω–∏–µ –Ω–∞ —Å—Ç—É–ª–µ</a></li>
<li><a href="../es400361/index.html">Foreve Elon 2016/2017 (Nochevieja en l√≠nea)</a></li>
<li><a href="../es400363/index.html">Buceo profundo: de CSS a transistor</a></li>
<li><a href="../es400365/index.html">Qu√© prometen los usuarios de VKontakte en 2017</a></li>
<li><a href="../es400371/index.html">2017 no es solo una primicia ...</a></li>
<li><a href="../es400377/index.html">Descripci√≥n general de los materiales 3D actuales</a></li>
<li><a href="../es400379/index.html">C√≥mo organizamos la b√∫squeda en Telegram, y qu√© surgi√≥ de ella. UPD: resumimos los resultados de la competencia</a></li>
<li><a href="../es400381/index.html">–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–ø—É–ª—å—Å–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è —Å –∞–∫—Ç–∏–≤–Ω—ã–º –ö–ö–ú. –≠–ø–∏–∑–æ–¥ I</a></li>
<li><a href="../es400383/index.html">Muestreo Pared de ladrillo digital contra la teor√≠a de la conspiraci√≥n. Cuento navide√±o para amantes del sonido claro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>