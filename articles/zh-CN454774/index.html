<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕸️ ☮️ 👂🏽 我们编写了生命中最有用的代码，但将其扔进了垃圾箱。 和我们一起 👂 🆘 👨🏼‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我在地下室里挂了一个出气筒，在上面贴着一位典型经理的照片，然后把演讲者塞进里面玩一些让我生气的短语。 例如，一个梨说：“业务不需要您的完美代码。 他需要解决问题，以使利润涵盖成本。 如果您需要govnokod，那么就会有govnokod。” 我开始拥抱。 

 最近，我在梨子上加了一条字：“类型很困...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我们编写了生命中最有用的代码，但将其扔进了垃圾箱。 和我们一起</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454774/"><img src="https://habrastorage.org/webt/va/e3/mo/vae3moqi-aj-wga-1pj1rqdujdo.jpeg"><br><br> 我在地下室里挂了一个出气筒，在上面贴着一位典型经理的照片，然后把演讲者塞进里面玩一些让我生气的短语。 例如，一个梨说：“业务不需要您的完美代码。 他需要解决问题，以使利润涵盖成本。 如果您需要govnokod，那么就会有govnokod。” 我开始拥抱。 <br><br> 最近，我在梨子上加了一条字：“类型很困难，没有必要。” 这时，我打得很厉害，手几乎断了。 因为我足够了。 几个月前，我经历了职业生涯中最严重的案例之一。 <br><br> 我的朋友安托卡（Antokha）要求我为一家大型公司提供解决方案。 我同意了，我们陷入了公司荒谬，紧缩，与不可理解的同事之间的战争以及各种不公正的深渊。 我们什么也不能说，因此我们将讨论类型，以使此类垃圾永远不会重复出现。 <br><a name="habracut"></a><br><h4>  1个 </h4><br>  <b>-（Antokha <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">rcanedu</a> ）</b>我受委托开发了一个内部平台工具-一个以面向对象模型的形式表示软件实体并与API服务统一工作的库。 即，一种用于与从源传播到显示器，反之亦然的数据进行交互的工具。 <br><br> 这样，大量的格式化，转换，计算和转换。 庞大的结构，复杂的层次结构，万物之间的无数联系。 在这样的网络中，很容易迷路。 您看到的是数据，却不知道可以做什么和不能做什么。 花很多时间来解决它。 这是很容易上瘾的。 只有很好地描述类型才能解决问题。 <br><br> 由于许多解决方案中缺少合适的类型，因此在运行时和编译时实现相同的程序行为变得更加困难。 类型应该完全确保所有内容都是相同的，并且在执行期间也会发生。 测试可以做同样的事情。 最好两者都依靠。 但是，如果您在类型和测试之间进行选择-类型会更可靠，更便宜。 <br><br> 当您成为前台时，有两个问题的根源-用户和后端。 对用户而言，一切都很简单-有许多方便的库和框架从用户I / O中抽象出来（反应，角度，Vue等）。 <br><br> 与后端交互还有另一个故事。 它的种类很多，而实现却是黑暗。 您无法定义一种描述数据的标准方法。 因此，发明了诸如“数据结构规范化”之类的拐杖，当所有传入数据都简化为刚性结构时，如果出现问题，则异常或异常操作就会开始。 这样可以加快并简化开发，但是实际上，它需要大量文档，UML图和功能描述。 <br><br> 由于前端已经成熟，因此在客户端和服务器部分的交互中出现了体系结构问题。 它变成了成熟的业务，而不仅仅是后端之上的布局。 以前，只有服务器端开发人员要求客户端-服务器交互。 现在，正反双方被迫谈判和密切合作。 我们需要一个工具，该工具将使我们能够与API数据源服务一起构建工作，避免丢失数据真实性，同时简化进一步的转换。 整个社区必须解决这个问题。 <br><br>  <b>-（Phil）</b>如果您是后端用户，则有很多针对该应用程序的成人解决方案和数据建模实践。 例如，在C＃中，您具有数据模型类。 您需要一些EntityFramework，它为您提供了用来覆盖模型的属性。 您告诉Lib如何到达基地。 然后，您可以使用其界面来处理此数据。 这个东西叫做ORM。 <br><br> 在前端，我们并没有决定如何做到最好-我们搜索，尝试，撰写荒谬的文章，然后我们驳斥一切，重新开始，我们仍然不会做出一个决定。 <br><br>  <b>-（Antoha）</b>我之前写的所有内容都有一个大问题-狭义的专业化。 每次从头开始开发该库，并且每次针对一种客户端-服务器交互来对其进行优化。 所有这些都是由于缺少适当的键入而发生的。 <br><br> 我相信，如果没有静态输入，就很难想象有一个通用的库可以使用API​​和域表达式。 其中会有很多反思，它将包含大量文档，并且将被不同的应用程序围绕，并指明一种或另一种形式的实践。 这不是简化。 <br><br> 一个好的通用工具应该可以在任何切片上提供完整的数据图，以便您始终准确地知道如何使用该数据以及为什么需要它。 <br><br>  <b>-（Phil）</b>我们需要一个库，使我们能够为每个实体提供详细的描述和控制，以便从具有不同接口的不同资源（从REST API和json-rpc到graphQL和NQL）获取该实体的数据。 这将使不断增长的代码库和结构保持严格和有序。 使用简单直观。 随时提供完整，准确的实体状态描述。 我们想尽可能地从数据层抽象用户的模块。 <br><br> 首先，我们看一下现有的。 我们什么都不喜欢。 出于某种原因，所有用于处理数据的库都是在js上创建的，或者都是由js制成的。 这些都破坏了一切。 他们对开发人员视而不见，说这样的库对您没有多大帮助，您将无法浏览数据的类型，也将无法表达他们的联系。 当使用不同类型的多个API或异构API时，情况会变得更糟。 <br><br> 所有这些库都没有受到类型的充分保护。 因此，它们产生的问题多于解决的问题。 不使用它们，而是根据您的特定领域做出决定会更容易。 <br><br> 因此，我们决定创建一个更强大，更抽象的库-适用于所有事物，而不是紧握任务的狭lib库，并且我们坚信自己的正确性，因为只有这样，才能创造出真正的好东西。 <br><br><hr><br><h4>  2 </h4><br>  <b>-（Antoha）</b>通常，我正在等待各种访问权限，这样我就可以进入公司资源库。 这可能持续数周。 就我而言，只用了一个。 这时，根据我在创建类似库中的经验，我分解了任务，估计了时间表。 <br><br> 问题是，在像其他所有人一样，我做出非常专业的决定之前。 使用通用工具会带来其他问题。 类型系统非常复杂，我和其他任何人都没有设计经验。 更糟糕的是，我周围的开发人员根本不了解静态类型。 <br><br> 但是我开始做我认为正确的事。 在日报上，我告诉您我在做什么以及为什么这样做，但是原则上没有人了解我。 我向团队提出的有关该问题的问题始终没有得到解答。 好像我不存在。 杜德（Dude），他做的事情非常复杂和难以理解。 <br><br> 我知道javaScript不能以任何方式在这里工作。 我需要一个具有强大的输入模型，与javaScript的出色交互，具有大型社区和严肃的生态系统的PL。 <br><br>  <b>-（Phil）</b>我已经等了很长时间了，Antoha才了解TypeScript的魅力。 <br><br>  <b>-（Antoha）</b>但是其中有许多问题使您发疯。 有输入，但是在程序的执行和用户的执行之间仍然没有完美的对应关系。 一开始打字稿似乎很复杂。 他必须忍受。 您总是想拿东西或扔东西。 逐渐地，您深入研究了语言，进入了语言的类型系统，在这里开始发生了一件有趣的事情。 它变得神奇。 一切都可以键入。 <br><br>  <b>-（Phil）</b>我们有生以来第一次在一起，开始了一些事情。 <br><br> 第一步是让用户描述数据方案。 我们想知道它的外观。 像这样： <br><br><pre><code class="javascript">type CustomerSchema = { 
  id: number;
  name: string;
}
const Customer = new Model&lt;CustomerSchema&gt;(‘Customer’);
</code></pre><br>
  ,    ,  .     id,     ,  ,   .<br>
     ,  .      ,        ,   -.   ,       ,    . <br>
<br>
,      .   —   -   ,  .    ,      ,    .     :      ,    ,  .  .      :<br>
<br>
<pre><code class="javascript"> /**
   name: String
   String -   js -: StringConstructor
              
        
*/
const customerSchema = Schema.create({
  id: Number,
  name: String,
});
</code></pre><br>
    .    ,     ,    .   , Number  String   .     :     ,   . :<br>
<br>
<pre><code class="javascript">const customerSchema = Schema.create({
  id: 1,
  name: 2,
});
</code></pre><br>
     .     `Schema.create` ,      .  `if (!(property instanceof String)) throw new Error(« , »)`.    . <br>
<br>
-,    , -,      .   ,       .   <abbr title=", , , , , , , - —        ,       ."></abbr>   ,   ,        .<br>
<br>
    .         ,   Schema.create.<br>
<br>
 :<br>
<br>
<pre><code class="javascript">//      
type Map&lt;T&gt; = {
  [key: string]: T | Map&lt;T&gt;; 
};

/**
      ,
      ,
     .
*/
type NumberType = Template&lt;NumberConstructor, number, 'number'&gt;;
type StringType = Template&lt;StringConstructor, string, 'string'&gt;;
type SymbolType = Template&lt;SymbolConstructor, symbol, 'symbol'&gt;;
type BooleanType = Template&lt;BooleanConstructor, boolean, 'boolean'&gt;;
type DateType = Template&lt;DateConstructor, Date, 'date'&gt;;

interface ArrayType extends Array&lt;ExtractTypeValues&lt;Types&gt;&gt; {};

type Types = {
  Number: NumberType;
  String: StringType;
  Symbol: SymbolType;
  Boolean: BooleanType;
  Date: DateType;
  Array: ArrayType;
};
//    
type MapTypes= Map&lt;ApplyTemplate&lt;Types&gt;&gt;;
//     - 
type Declaration = ExtractInputTypes&lt;MapTypes&gt;;
interface Schema&lt;...&gt; {
 //   ,   .
 create: &lt;T extends Declaration&gt;(
    declaration: ConvertInstanceTypesToConstructorTypes&lt;T&gt;
  ) =&gt; Schema&lt;T&gt;;
};
</code></pre><br>
         ,        .      , ,   ,           ,    . <br>
<br>
<i>     ,          </i><br>
<br>
<pre><code class="javascript">type CustomerSchema = {
  id: number;
  name: string;
};
const customerSchema: CustomerSchema = Schema.create({
  id: Number,
  name: String,
});
</code></pre><br>
         . ,     ,       .<br>
<br>
          .      any.     —    any,     100%,   ,    . <br>
<br>
   ,       ,    ,     .        .    `Schema.create`    .  99%      ,     .   ,    .   —   !   ,    .<br>
<br>
 .    ,    ,     ,   .   .      :<br>
<br>
<pre><code class="javascript">const customerSchema = Schema.create({
 id: Number,
 name: String,
});

//   vscode  : id, name 
Schema.raw(customerSchema). 

//   
//    .
Schema.raw(customerSchema).id;

//        .
Schema.raw(customerSchema).neId;
</code></pre><br>
.             :<br>
<pre><code class="javascript">const customerSchema = Schema.create({
 id: Number,
 name: String,
});

if (true) {
  customerSchema.add({gender: String});
} 

//        ,
//      gender.
//  ,           
// .
Schema.raw(customerSchema).
</code></pre><br>
 ,      ,      ,      .        gender, ,       (,    ,   this  !).      -        .     ,        ,       .<br>
<br>
    ,     .      , ,     .    ,    .     .<br>
<br>
 :<br>
<br>
<pre><code class="javascript">const customerSchema = Schema.create({
 id: Number,
 name: String,
});

// customerSchema.add({gender: String});
//      ,    .
//  :
const customerWithGenderSchema = customerSchema.add({gender: String});

//   .
// :
Schema.raw(customerWithGenderSchema).
//  id, name, gender

// 
Schema.raw(customerSchema).
//  id, name
</code></pre><br>
    ,        ,    .    ,     .<br>
<br>
           :<br>
<br>
<pre><code class="javascript">const customerSchema = Schema.create({
 id: Number,
 name: String,
});

const repository = RepositoryManager.create(openApiDriver, { 
 // config
});
const Customer = Model.create(repository, customerSchema);

Customer.getAll().first().
//   ide  ,       id, name  gender.
//    ,   
Customer.getAll().first().age;
//   .    ,     , 
//   .
</code></pre><br>
   getAll   . <br>
 :<br>
<br>
<pre><code class="javascript">type MapSchemaToDriver&lt;S extends Schema, D extends Driver&gt; = 
  InferSchemaDeclaration&lt;S&gt; extends SchemaDeclaration
    ? InferDriverMethods&lt;D&gt; extends DriverTemplate&lt;IMRReader, IMRWriter&gt;
      ? Repository&lt;InferSchemaDeclaration&lt;S&gt;, InferDriverMethods&lt;D&gt;&gt;
      : never
    : never;

interface Repository&lt;D extends Driver, S extends Schema&gt; {
  get: &lt;T extends DSLTerm&gt;(dsl: ParseDSLTerm&lt;T&gt;) =&gt; MapSchemaToDriver&lt;S, D&gt; extends RepositoryTemplate ? ApplyDSLTerm&lt;MapSchemaToDriver&lt;S, D&gt;, T&gt; : Error&lt;’type’, ‘Type error’&gt;;
}
</code></pre><br>
 ,   : <br>
<br>
«,  B,      A,         ,   ,       ,      A.  . -     ». <br>
<br>
 .     .<br>
<br>
    «»  ,  ,             .    ,    .<br>
<br>
  .     ,          .   : <br>
<br>
« ,       *--.*,      .  ,     id  . -     ,    ,    ».<br>
<br>
 .<br>
<br>
<hr><br>
<h4>2.5</h4><br>
   ,    ,  ,       .    .<br>
<br>
  ,      — , ,    ,    .        .     ,     ,    .<br>
<br>
    ,        .        ,      ,     ,     ,     .          ,    ,      .<br>
<br>
<h3>   ODM   ORM —  IMR (Isomorphic Model Representation) </h3><br>
 ,      ,  API    .  ,   .    ,    select-where ,    . <br>
<br>
  —   ,       ,          . <br>
<br>
 .         .     .   ,   ,         ,  .  ,     ,         ,    ,   . <br>
<br>
   ,   —      ,        —   ,       -    . <br>
<br>
   .<br>
<br>
<hr><br>
<h4>3</h4><br>
<b>— ()</b>    ,   ,    .   ,  ,    ,   .     .     ,  ,   ,            . <br>
<br>
   -   ,    , «     ».       ,     .        ,     —    .     ,     , ,      <br>
<br>
 ,     .<br>
<br>
   . ,     ,   .   ,       ,   ,     .     .       .     ,      . ,     ,     ,   ,    .<br>
<br>
<b>— ()</b>      ,      ,   .     .    ,    ,     ,  . <br>
<br>
      ,   ,  .     .     ,   .<br>
 <br>
<b>— ()</b>    ,    .    ,        ,    .    .   ,           .       -   , , ,    ,      .<br>
<br>
     ,       -  .          ,        .   ,    .<br>
<br>
     , ,     .    ,       .      .<br>
<br>
<hr><br>
<h4>4</h4><br>
<b>— ()</b>    ,    —  .   ! ?!      ,     ,     ,    ,  ,          ODM/ORM   - ,     .   ,      . ,         ,   «-    , ».<br>
<br>
,    ,   .        .   ,  ,         .   . <br>
<br>
      ,   ,  -  ,  .    —  ,    .<br>
<br>
       ,   .      -:<br>
<br>
<pre><code class="javascript">/*
     .
    — .
       .
     
*/

import { View } from '@view';
import { Logger } from '@utils';

//   —  ,    .
//         .
import { Robot } from '@domain/models';

// ,       
//   
function foo() {
 Robot.fetch({
   location: {
     area: 2,
     free: true,
     key: 'f49a6712', //    - compile-time checked
   }
 })
 .then(View.Grid.display)
 .catch(Logger.error);
}
</code></pre><br>
       ,     .    ,  —    js/ts .       ,       . - -       ,       ,       ,    —   Result .<br>
 <br>
           .       - Logger.Error,       .<br>
<br>
<pre><code class="javascript">/*
   :
       ,
         -  .
     - 
             .
     :
*/
import { Schema, Model } from 'imr';
import { Logger } from '@utils';
import { View } from '@view';
import { robotSchema } from '@domain/schemas';
import { batteryStationService } from '@domain/infrastructure/services/batteryStation';
import { Robot } from '@domain/models';
import { batteryNode } from '../services/nodeNames';

//       
// ,       ,       ,
//  ,        «»
const robotSchemaWithBattery =
  robotSchema
    .add('battery', Schema.union('li-ion', 'silicon'))
    .remove('speed');

// ,       
//     :
function foo(nodeName) {

 //   -:   -,      
 if (nodeName === batteryNode) {
   //   ,      
   const CustomerRobot = Model.create(robotSchemaWithBattery, batteryStationService);

   CustomerRobot
     //        .
     // , , 'li-notIon'  
     .fetch({ filter: { battery: 'li-ion' } })
    
     //   .
     //   ,      ,     ,   .
     //  ,      ,
     //      ,      .
     .then(View.Grid.display)
     .catch(Logger.error)

 } else {
   Robot
     .fetch()
     .then(View.Grid.display)
     .catch(Logger.error)
 }
}
</code></pre><br>
<hr><br>
<h4>5</h4><br>
<b>— ()</b>   ,   ,   ,   -  ,   .      ,  - ,   ,              . <br>
<br>
       .<br>
<br>
  ,  ,  —  .    .      ,        —    ,     ,   .       . ,    ,     —    ,  .<br>
 <br>
        ,   :         .    .            . <br>
<br>
    —        .       ,   .<br>
<blockquote>   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">rcanedu</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">arttom</a> </blockquote></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN454774/">https://habr.com/ru/post/zh-CN454774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN454756/index.html">检查网站的有效性和广告设置，吸引批发公司客户的成本</a></li>
<li><a href="../zh-CN454758/index.html">廉价而愉快地绕过Windows Defender：混淆Mimikatz</a></li>
<li><a href="../zh-CN454760/index.html">英特尔傲腾内存M15-比M10快</a></li>
<li><a href="../zh-CN454766/index.html">HBO，感谢您提醒我...白俄罗斯药剂师的“切尔诺贝利急救箱”</a></li>
<li><a href="../zh-CN454770/index.html">三星启动会员资格-俄罗斯创业公司的新计划</a></li>
<li><a href="../zh-CN454776/index.html">自由职业者还是办公室？ 自由职业者的回应</a></li>
<li><a href="../zh-CN454778/index.html">《机器学习：业务算法》一书</a></li>
<li><a href="../zh-CN454780/index.html">我们对微服务的了解</a></li>
<li><a href="../zh-CN454788/index.html">谨慎投资者的武器：我们考虑投资债券的公允价值</a></li>
<li><a href="../zh-CN454790/index.html">Java本机映像：可用性检查</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>