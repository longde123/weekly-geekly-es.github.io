<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’¼ ğŸ‘¨ğŸ¾â€ğŸ’¼ ğŸ’‡ğŸ¼ La surveillance est-elle morte? - Surveillance longue durÃ©e ğŸ§‘ğŸ¾â€ğŸ¤â€ğŸ§‘ğŸ» ğŸ‘©ğŸ»â€ğŸ« ğŸ”ª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Depuis 2008, notre entreprise est principalement engagÃ©e dans la gestion des infrastructures et le support technique 24h / 24 pour les projets web: no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La surveillance est-elle morte? - Surveillance longue durÃ©e</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/448602/"><img src="https://habrastorage.org/webt/rb/6a/wf/rb6awfy_oiasqde7kja4h39oczm.jpeg"><br><br>  Depuis 2008, notre entreprise est principalement engagÃ©e dans la gestion des infrastructures et le support technique 24h / 24 pour les projets web: nous avons plus de 400 clients, soit environ 15% du e-commerce en Russie.  En consÃ©quence, une architecture trÃ¨s diversifiÃ©e est prise en charge.  Si quelque chose tombe, nous devons le rÃ©parer dans les 15 minutes.  Mais pour comprendre qu'un accident est survenu, vous devez surveiller le projet et rÃ©pondre aux incidents.  Comment faire <br><br>  Je pense que l'organisation du bon systÃ¨me de surveillance est en difficultÃ©.  S'il n'y a pas eu de problÃ¨me, mon discours a consistÃ© en une thÃ¨se: "Veuillez installer Prometheus + Grafana et les plugins 1, 2, 3."  Malheureusement, cela ne fonctionne pas maintenant.  Et le principal problÃ¨me est que tout le monde continue de croire en quelque chose qui existait en 2008, en termes de composants logiciels. <br><br>  Concernant l'organisation du systÃ¨me de suivi, je risque de dire que ... des projets avec un suivi compÃ©tent n'existent pas.  Et la situation est si mauvaise si quelque chose tombe, il y a un risque qu'elle passe inaperÃ§ue - tout le monde est sÃ»r que Â«tout est surveillÃ©Â». <br>  Peut-Ãªtre que tout est surveillÃ©.  Mais comment? <br><br>  Nous sommes tous tombÃ©s sur une histoire similaire Ã  la suivante: un certain devoop, un certain administrateur travaille, une Ã©quipe de dÃ©veloppement vient vers eux et dit: Â«nous l'avons, maintenant c'est surveillÃ©.Â»  Quel moniteur?  Comment Ã§a marche? <br><br>  Ok  Nous surveillons Ã  l'ancienne.  Mais cela est dÃ©jÃ  en train de changer, et il s'avÃ¨re que vous avez surveillÃ© le service A, devenu le service B, qui interagit avec le service C. Mais l'Ã©quipe de dÃ©veloppement vous dit: "Installez le logiciel, il faut tout surveiller!" <br><br>  Alors qu'est-ce qui a changÃ©?  - Tout a changÃ©! <br><a name="habracut"></a><br><h4>  2008 annÃ©e.  Tout va bien </h4><br>  Il y a deux dÃ©veloppeurs, un serveur, un serveur de base de donnÃ©es.  De lÃ , tout se passe.  Nous avons quelques INFA, nous mettons zabbix, Nagios, cactus.  Et puis nous avons dÃ©fini des alertes claires sur le CPU, sur le fonctionnement des disques, sur la place sur les disques.  Nous effectuons Ã©galement quelques vÃ©rifications manuelles que le site rÃ©pond que les commandes arrivent dans la base de donnÃ©es.  Et c'est tout - nous sommes plus ou moins protÃ©gÃ©s. <br><br>  Si nous comparons la quantitÃ© de travail que l'administrateur a fait pour assurer la surveillance, alors c'Ã©tait 98% automatique: la personne qui surveille devrait comprendre comment installer Zabbix, comment le configurer et configurer les alertes.  Et 2% - pour les contrÃ´les externes: que le site rÃ©ponde et demande Ã  la base de donnÃ©es que de nouvelles commandes sont arrivÃ©es. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/846/5ae/a65/8465aea65cdf10015bb2aad7eff7ebf6.png"><br><br><h4>  2010 annÃ©e.  La charge augmente </h4><br>  Nous commenÃ§ons Ã  faire Ã©voluer le Web, Ã  ajouter un moteur de recherche.  Nous voulons Ãªtre sÃ»rs que le catalogue de produits contient tous les produits.  Et cette recherche de produit fonctionne.  Que la base de donnÃ©es fonctionne, que des commandes sont en cours, que le site rÃ©pond en externe et rÃ©pond Ã  partir de deux serveurs, et que l'utilisateur n'est pas expulsÃ© du site pendant qu'il se rÃ©Ã©quilibre vers un autre serveur, etc.  Il y a plus d'entitÃ©s. <br><br>  De plus, lâ€™entitÃ© associÃ©e Ã  lâ€™infrastructure reste la plus importante de la tÃªte du gestionnaire.  L'idÃ©e me vient encore Ã  l'esprit que la personne qui surveille est la personne qui va installer zabbix et pouvoir le configurer. <br><br>  Mais en mÃªme temps, il y a des travaux sur la rÃ©alisation de contrÃ´les externes, sur la crÃ©ation d'un ensemble de scripts pour interroger l'indexeur de recherche, un ensemble de scripts pour vÃ©rifier que la recherche change au cours du processus d'indexation, un ensemble de scripts qui vÃ©rifient que les marchandises sont transfÃ©rÃ©es au service de livraison, etc.  etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/45c/974/24c/45c97424c842cf539e79b900b903437d.png"><br><br>  Remarque: j'ai Ã©crit un Â«ensemble de scriptsÂ» 3 fois.  Autrement dit, la personne responsable de la surveillance n'est plus celle qui installe simplement zabbix.  C'est la personne qui commence Ã  coder.  Mais rien n'a encore changÃ© dans l'esprit de l'Ã©quipe. <br><br>  Mais le monde change, devenant de plus en plus compliquÃ©.  Une couche de virtualisation, plusieurs nouveaux systÃ¨mes sont ajoutÃ©s.  Ils commencent Ã  interagir les uns avec les autres.  Qui a dit "Ã§a sent bon les microservices?"  Mais chaque service ressemble toujours individuellement Ã  un site.  Nous pouvons nous tourner vers lui et comprendre qu'il donne les informations nÃ©cessaires et travaille seul.  Et si vous Ãªtes un administrateur qui est constamment engagÃ© dans un projet qui se dÃ©veloppe depuis 5-7-10 ans, vous avez accumulÃ© cette connaissance: un nouveau niveau apparaÃ®t - vous vous en Ãªtes rendu compte, un autre niveau apparaÃ®t - vous l'avez rÃ©alisÃ© ... <br><br><img src="https://habrastorage.org/webt/tc/we/qe/tcweqem6jjpldcpovhhoklgt3kq.png"><br><br>  Mais rarement quelqu'un accompagne le projet pendant 10 ans. <br><br><h3>  RÃ©sumÃ© de surveillance de l'homme </h3><br>  Supposons que vous soyez arrivÃ© Ã  une nouvelle startup qui a immÃ©diatement marquÃ© 20 dÃ©veloppeurs, Ã©crit 15 microservices et que vous Ãªtes l'administrateur Ã  qui on a dit: Â«CrÃ©ez un CI / CD.  S'il te plait. "  Vous avez construit un CI / CD et soudain vous entendez: "Il est difficile pour nous de travailler avec la production dans le" cube "sans comprendre comment l'application fonctionnera.  Faites-nous un bac Ã  sable dans le mÃªme "cube". <br>  Vous faites un bac Ã  sable dans ce cube.  Ils vous disent immÃ©diatement: Â«Nous voulons une base de donnÃ©es de scÃ¨ne, qui est mise Ã  jour quotidiennement Ã  partir de la production, afin de comprendre qu'elle fonctionne sur la base de donnÃ©es, mais en mÃªme temps ne pas gÃ¢cher la base de donnÃ©es de production.Â» <br><br>  Vous vivez dans tout cela.  Il reste 2 semaines avant la sortie, ils vous disent: "Maintenant, tout serait surveillÃ© ..."  surveiller l'infrastructure de cluster, surveiller l'architecture des microservices, surveiller le travail avec les services externes ... <br><br>  Et des collÃ¨gues leur sortent un schÃ©ma si familier et disent: Â«Alors ici, tout est clair!  Installez un programme qui surveille tout. Â»  Oui: Prometheus + Grafana + plugins. <br>  Et ils ajoutent en mÃªme temps: "Vous avez deux semaines, assurez-vous que tout est fiable." <br><br>  Dans le tas de projets que nous voyons, une personne est affectÃ©e au suivi.  Imaginez que nous voulons embaucher une personne pendant 2 semaines pour surveiller, et nous lui rÃ©digerons un curriculum vitae.  Quelles compÃ©tences cette personne devrait-elle possÃ©der - compte tenu de tout ce que nous avons dit auparavant? <br><br><ul><li>  Il doit comprendre le suivi et les spÃ©cificitÃ©s du travail de l'infrastructure sidÃ©rurgique. </li><li>  Il doit comprendre les spÃ©cificitÃ©s de la surveillance de Kubernetes (et tout le monde veut un Â«cubeÂ», car vous pouvez tout ignorer, vous cacher, car l'administrateur le comprendra) - en lui-mÃªme, son infrastructure et comprendre comment surveiller les applications Ã  l'intÃ©rieur. </li><li>  Il doit comprendre que les services communiquent entre eux de faÃ§on particuliÃ¨re et connaÃ®tre les spÃ©cificitÃ©s de l'interaction des services entre eux.  Il est assez rÃ©aliste de voir un projet dans lequel certains services communiquent de maniÃ¨re synchrone, car il n'y a pas d'autre moyen.  Par exemple, le backend passe sur REST, sur gRPC au service de catalogue, reÃ§oit une liste de marchandises et retourne.  Vous ne pouvez pas attendre ici.  Et avec d'autres services, il fonctionne de maniÃ¨re asynchrone.  TransfÃ©rer la commande au service de livraison, envoyer une lettre, etc. <br>  Vous avez probablement dÃ©jÃ  naviguÃ© de tout cela?  Et l'administrateur, qui doit surveiller cela, a nagÃ© encore plus. </li><li>  Il doit Ãªtre capable de planifier et de planifier correctement - car le travail devient de plus en plus. </li><li>  Il doit donc crÃ©er une stratÃ©gie Ã  partir du service crÃ©Ã© afin de comprendre comment le surveiller spÃ©cifiquement.  Il a besoin d'une comprÃ©hension de l'architecture du projet et de son dÃ©veloppement + comprÃ©hension des technologies utilisÃ©es dans le dÃ©veloppement. </li></ul><br>  Rappelons un cas tout Ã  fait normal: une partie des services en php, une partie des services en Go, une partie des services en JS.  Ils travaillent en quelque sorte entre eux.  C'est de lÃ  que vient le terme Â«microserviceÂ»: il y a tellement de systÃ¨mes sÃ©parÃ©s que les dÃ©veloppeurs ne peuvent pas comprendre le projet dans son ensemble.  Une partie de l'Ã©quipe Ã©crit des services dans JS qui fonctionnent seuls et ne savent pas comment fonctionne le reste du systÃ¨me.  L'autre partie Ã©crit des services en Python et n'entre pas dans le fonctionnement des autres services, ils sont isolÃ©s dans leur domaine.  TroisiÃ¨me - Ã©crit des services en php ou autre chose. <br>  Toutes ces 20 personnes sont divisÃ©es en 15 services, et il n'y a qu'un seul administrateur qui devrait comprendre tout cela.  ArrÃªte Ã§a!  nous venons de diviser le systÃ¨me en 15 microservices, car 20 personnes ne peuvent pas comprendre l'ensemble du systÃ¨me. <br><br>  Mais cela doit Ãªtre surveillÃ© d'une maniÃ¨re ou d'une autre ... <br><br>  Quel est le rÃ©sultat?  En consÃ©quence, il y a une personne qui comprend tout ce que toute une Ã©quipe de dÃ©veloppeurs ne peut pas comprendre, et pourtant il doit Ã©galement savoir et Ãªtre en mesure de ce que nous avons indiquÃ© ci-dessus - infrastructure de fer, infrastructure de Kubernetes, etc. <br><br>  Que puis-je dire ... Houston, nous avons des problÃ¨mes. <br><br><h3>  Le suivi d'un projet logiciel moderne est un projet logiciel en soi </h3><br>  Partant d'une fausse croyance selon laquelle la surveillance est un logiciel, nous croyons aux miracles.  Mais les miracles, hÃ©las, ne se produisent pas.  Vous ne pouvez pas installer zabbix et attendre que tout fonctionne.  Cela n'a aucun sens de mettre Grafana et d'espÃ©rer que tout ira bien.  La plupart du temps sera consacrÃ© Ã  l'organisation de contrÃ´les sur le fonctionnement des services et leur interaction les uns avec les autres, sur le fonctionnement des systÃ¨mes externes.  En fait, 90% du temps sera consacrÃ© non pas Ã  l'Ã©criture de scripts, mais au dÃ©veloppement de logiciels.  Et ce devrait Ãªtre une Ã©quipe qui comprend le travail du projet. <br>  Si, dans cette situation, une personne est renvoyÃ©e pour surveillance, des problÃ¨mes se produiront.  Ce qui se passe partout. <br><br>  Par exemple, il existe plusieurs services qui communiquent entre eux via Kafka.  Une commande est arrivÃ©e, nous avons envoyÃ© un message sur la commande Ã  Kafka.  Il existe un service qui Ã©coute les informations sur la commande et effectue l'expÃ©dition des marchandises.  Il existe un service qui Ã©coute les informations sur la commande et envoie une lettre Ã  l'utilisateur.  Et puis il y a encore un tas de services, et on commence Ã  se confondre. <br><br>  Et si vous le donnez toujours Ã  l'administrateur et aux dÃ©veloppeurs Ã  un stade oÃ¹ il reste peu de temps avant la sortie, une personne devra comprendre tout ce protocole.  C'est-Ã -dire  un projet de cette envergure prend beaucoup de temps et doit Ãªtre intÃ©grÃ© dans le dÃ©veloppement du systÃ¨me. <br>  Mais trÃ¨s souvent, en particulier lors de la gravure, dans les startups, nous voyons comment la surveillance est remise Ã  plus tard.  Â«Maintenant, nous allons faire la preuve de concept, nous allons commencer avec elle, la laisser tomber - nous sommes prÃªts Ã  sacrifier.  Et puis nous surveillerons tout cela. Â»  Quand (ou si) le projet commence Ã  gagner de l'argent, l'entreprise veut rÃ©duire encore plus de fonctionnalitÃ©s - car il a commencÃ© Ã  fonctionner, vous devez donc aller plus loin!  Et vous Ãªtes au point oÃ¹ au dÃ©but vous devez surveiller tout ce qui prÃ©cÃ¨de, ce qui ne prend pas 1% du temps, mais beaucoup plus.  Et en passant, les dÃ©veloppeurs auront besoin d'une surveillance, et il est plus facile de les intÃ©grer dans de nouvelles fonctionnalitÃ©s.  En consÃ©quence, de nouvelles fonctionnalitÃ©s sont Ã©crites, tout est terminÃ© et vous Ãªtes dans une impasse sans fin. <br><br>  Alors, comment contrÃ´lez-vous un projet depuis le dÃ©but, et si vous avez un projet que vous devez surveiller, mais vous ne savez pas par oÃ¹ commencer? <br><br>  Tout d'abord, vous devez planifier. <br><br>  <i>Digression lyrique: commence trÃ¨s souvent par la surveillance des infrastructures.</i>  <i>Par exemple, nous avons Kubernetes.</i>  <i>Pour commencer, nous mettons Prometheus avec Grafana, mettons les plugins sous la surveillance du "cube".</i>  <i>Non seulement les dÃ©veloppeurs, mais aussi les administrateurs ont une pratique malheureuse: "Nous allons installer ce plug-in, et le plug-in sait probablement comment le faire."</i>  <i>Les gens aiment commencer par des actions simples et comprÃ©hensibles, plutÃ´t que des actions importantes.</i>  <i>Et la surveillance de l'infrastructure est facile.</i> <br><br>  D'abord, dÃ©cidez quoi et comment vous voulez surveiller, puis prenez l'instrument, car les autres ne peuvent pas penser Ã  votre place.  Oui, et devraient-ils?  D'autres personnes ont pensÃ© au systÃ¨me universel - ou n'ont pas pensÃ© du tout quand ce plugin a Ã©tÃ© Ã©crit.  Et le fait que ce plugin compte 5 000 utilisateurs ne signifie pas qu'il apporte un quelconque avantage.  Peut-Ãªtre deviendrez-vous le 5001e simplement parce qu'il y avait dÃ©jÃ  5 000 personnes auparavant. <br><br>  Si vous avez commencÃ© Ã  surveiller l'infrastructure et que le backend de votre application a cessÃ© de rÃ©pondre, tous les utilisateurs perdront le contact avec l'application mobile.  Une erreur s'envolera.  Ils viendront vers vous et vous diront: "L'application ne fonctionne pas, que faites-vous ici?"  "Nous surveillons."  - "Comment surveillez-vous si vous ne voyez pas que l'application ne fonctionne pas?!" <br><br><ol><li>  Je pense qu'il est nÃ©cessaire de commencer la surveillance Ã  partir du point d'entrÃ©e de l'utilisateur.  Si l'utilisateur ne voit pas que l'application fonctionne - c'est tout, c'est un Ã©chec.  Et le systÃ¨me de surveillance devrait en avertir en premier lieu. </li><li>  Et ce n'est qu'alors que nous pourrons surveiller l'infrastructure.  Ou faites-le en parallÃ¨le.  L'infrastructure est plus simple - ici, nous pouvons enfin simplement installer zabbix. </li><li>  Et maintenant, vous devez aller aux racines de l'application pour comprendre oÃ¹ cela ne fonctionne pas. </li></ol><br>  Ma principale pensÃ©e est que le suivi devrait aller en parallÃ¨le avec le processus de dÃ©veloppement.  Si vous dÃ©tachez l'Ã©quipe de surveillance pour d'autres tÃ¢ches (crÃ©ation d'un CI / CD, bacs Ã  sable, rÃ©organisation de l'infrastructure), la surveillance commencera Ã  Ãªtre Ã  la traÃ®ne et vous ne pourrez jamais rattraper le dÃ©veloppement (ou tÃ´t ou tard, il devra Ãªtre arrÃªtÃ©). <br><br><h3>  Tout par niveaux </h3><br>  C'est ainsi que je vois l'organisation du systÃ¨me de surveillance. <br><br>  1) Niveau d'application: <br><ul><li>  surveiller la logique mÃ©tier de l'application; </li><li>  surveiller les paramÃ¨tres de santÃ© des services; </li><li>  surveillance de l'intÃ©gration. </li></ul><br>  2) Niveau d'infrastructure: <br><ul><li>  surveiller le niveau d'orchestration; </li><li>  logiciel de systÃ¨me de surveillance; </li><li>  surveiller le niveau de "fer". </li></ul><br>  3) Encore une fois, le niveau d'application - mais en tant que produit d'ingÃ©nierie: <br><ul><li>  collecte et surveillance des journaux d'application; </li><li>  APM </li><li>  traÃ§age. </li></ul><br>  4) Alerte: <br><ul><li>  organisation d'un systÃ¨me d'alerte; </li><li>  organisation d'un systÃ¨me de veille; </li><li>  organisation d'une "base de connaissances" et traitement des incidents de workflow. </li></ul><br>  <b>Important</b> : nous arrivons Ã  l'alerte non pas aprÃ¨s, mais immÃ©diatement!  Il n'est pas nÃ©cessaire de commencer la surveillance et Â«en quelque sorte plus tardÂ» de penser Ã  qui recevra les alertes.  AprÃ¨s tout, quelle est la tÃ¢che de surveillance: comprendre oÃ¹ quelque chose ne fonctionne pas dans le systÃ¨me et en informer les bonnes personnes.  Si cela est laissÃ© Ã  la fin, les bonnes personnes dÃ©couvriront que quelque chose ne va pas, seulement en appelant "rien ne fonctionne pour nous". <br><br><h3>  Couche d'application - Surveillance de la logique mÃ©tier </h3><br>  Ici, nous parlons de vÃ©rifier le fait que l'application fonctionne pour l'utilisateur. <br><br>  Ce niveau doit Ãªtre effectuÃ© au stade de la conception.  Par exemple, nous avons un PromÃ©thÃ©e conditionnel: il rampe vers le serveur qui est engagÃ© dans les vÃ©rifications, extrait le point de terminaison et le point de terminaison va vÃ©rifier l'API. <br><br>  Lorsqu'on leur demande souvent de surveiller la page principale pour s'assurer que le site fonctionne, les programmeurs donnent un stylo qui peut Ãªtre tirÃ© Ã  chaque fois que vous devez vous assurer que l'API fonctionne.  Et les programmeurs en ce moment prennent et Ã©crivent toujours / api / test / helloworld <br>  La seule faÃ§on de vous assurer que tout fonctionne?  - Non! <br><br><ul><li>  La crÃ©ation de tels contrÃ´les est essentiellement la tÃ¢che des dÃ©veloppeurs.  Les tests unitaires doivent Ãªtre Ã©crits par des programmeurs qui Ã©crivent du code.  Parce que si vous fusionnez cela dans l'admin "Mec, voici une liste de protocoles API pour les 25 fonctions, veuillez tout surveiller!"  - rien ne fonctionnera. </li><li>  Si vous imprimez Â«bonjour le mondeÂ», personne ne saura jamais que l'API devrait et fonctionne vraiment.  Chaque modification de l'API doit entraÃ®ner une modification des contrÃ´les. </li><li>  Si vous avez dÃ©jÃ  une telle catastrophe, arrÃªtez les fonctionnalitÃ©s et sÃ©lectionnez les dÃ©veloppeurs qui Ã©criront ces chÃ¨ques, ou conciliez avec les pertes, conciliez que rien n'est vÃ©rifiÃ© et tombera. </li></ul><br>  Conseils techniques: <br><br><ul><li>  Assurez-vous d'organiser un serveur externe pour organiser les inspections - vous devez Ãªtre sÃ»r que votre projet est accessible au monde extÃ©rieur. </li><li>  Organisez la validation sur l'ensemble du protocole API, pas seulement sur les points de terminaison individuels. </li><li>  CrÃ©ez un point final prometheus avec les rÃ©sultats des tests. </li></ul><br><h3>  Niveau d'application - Surveillance des mÃ©triques d'intÃ©gritÃ© </h3><br>  Nous parlons maintenant de mesures de santÃ© externes des services. <br><br>  Nous avons dÃ©cidÃ© de surveiller tous les Â«stylosÂ» de l'application Ã  l'aide de vÃ©rifications externes que nous appelons Ã  partir d'un systÃ¨me de surveillance externe.  Mais ce sont prÃ©cisÃ©ment les Â«stylosÂ» que l'utilisateur Â«voitÂ».  Nous voulons Ãªtre sÃ»rs que les services eux-mÃªmes fonctionnent pour nous.  Voici une meilleure histoire: K8s a des contrÃ´les de santÃ© afin qu'au moins le cube s'assure que le service fonctionne.  Mais la moitiÃ© des chÃ¨ques que j'ai vus sont la mÃªme impression Â«bonjour le mondeÂ».  C'est-Ã -dire  ici il tire une fois aprÃ¨s le dÃ©ploiement, il lui a rÃ©pondu que tout allait bien - et c'est tout.  Et le service, s'il repose sur sa propre API, possÃ¨de un grand nombre de points d'entrÃ©e pour la mÃªme API, qui doit Ã©galement Ãªtre surveillÃ©e, car nous voulons savoir qu'elle fonctionne.  Et nous le surveillons dÃ©jÃ  Ã  l'intÃ©rieur. <br><br>  Comment l'implÃ©menter correctement techniquement: chaque service dÃ©finit un point de terminaison sur ses performances actuelles, et dans les graphiques de Grafana (ou de toute autre application), nous voyons l'Ã©tat de tous les services. <br><br><ul><li>  Chaque modification de l'API doit entraÃ®ner une modification des contrÃ´les. </li><li>  CrÃ©ez immÃ©diatement un nouveau service avec des mesures de santÃ©. </li><li>  L'administrateur peut s'adresser aux dÃ©veloppeurs et demander "ajoutez-moi quelques fonctionnalitÃ©s pour que je comprenne tout et ajoute des informations Ã  ce sujet Ã  mon systÃ¨me de surveillance".  Mais les dÃ©veloppeurs rÃ©pondent gÃ©nÃ©ralement: Â«Nous nâ€™ajouterons rien deux semaines avant la sortie.Â» <br>  Faites savoir aux responsables du dÃ©veloppement qu'il y aura de telles pertes, informez Ã©galement les patrons des responsables du dÃ©veloppement.  Parce que quand tout tombera, quelqu'un continuera d'appeler et d'exiger de surveiller le "service en baisse constante" (c) </li><li>  Soit dit en passant, sÃ©lectionnez les dÃ©veloppeurs pour Ã©crire des plugins pour Grafana - ce sera une bonne aide pour les administrateurs. </li></ul><br><h3>  Couche d'application - Surveillance de l'intÃ©gration </h3><br>  La surveillance de l'intÃ©gration se concentre sur la surveillance de la communication entre les systÃ¨mes critiques de l'entreprise. <br><br>  Par exemple, 15 services communiquent entre eux.  Ce ne sont plus des sites individuels.  C'est-Ã -dire  nous ne pouvons pas tirer le service seul, obtenir / helloworld et comprendre que le service fonctionne.  Parce que le service Web pour passer une commande doit envoyer des informations sur la commande au bus - le service d'entrepÃ´t doit recevoir ce message du bus et travailler avec lui.  Et le service de distribution de courrier Ã©lectronique devrait gÃ©rer cela d'une maniÃ¨re ou d'une autre, etc. <br><br>  En consÃ©quence, nous ne pouvons pas comprendre, en poussant Ã  chaque service individuel, que tout cela fonctionne.  Parce que nous avons un certain bus Ã  travers lequel tout communique et interagit. <br>  Par consÃ©quent, cette Ã©tape doit indiquer l'Ã©tape de test des services pour interagir avec d'autres services.  AprÃ¨s avoir surveillÃ© un courtier de messages, vous ne pouvez pas organiser la surveillance de la communication.  S'il existe un service qui Ã©met des donnÃ©es et un service qui les reÃ§oit, lors de la surveillance d'un courtier, nous ne verrons que les donnÃ©es qui volent d'un cÃ´tÃ© Ã  l'autre.  MÃªme si nous avons rÃ©ussi Ã  surveiller l'interaction de ces donnÃ©es Ã  l'intÃ©rieur - que certains producteurs publient les donnÃ©es, quelqu'un les lit, ce flux continue Ã  aller Ã  Kafka - il ne nous donnera toujours pas d'informations si un service a donnÃ© un message dans une version, mais un autre service ne s'attendait pas Ã  cette version et l'a sautÃ©e.  Nous ne le saurons pas, car les services nous diront que tout fonctionne. <br><br>  Comme je le recommande: <br><br><ul><li>  Pour la communication synchrone: le point d'extrÃ©mitÃ© exÃ©cute les demandes de services associÃ©s.  C'est-Ã -dire  nous prenons ce point de terminaison, tirons le script Ã  l'intÃ©rieur du service, qui va Ã  tous les points et dit "Je peux y tirer et tirer lÃ , je peux tirer ..." </li><li>  Pour la communication asynchrone: messages entrants - le point final vÃ©rifie le bus pour les messages de test et affiche l'Ã©tat du traitement. </li><li>  Pour la communication asynchrone: messages sortants - le point d'extrÃ©mitÃ© envoie des messages de test au bus. </li></ul><br>  Comme d'habitude: nous avons un service qui envoie des donnÃ©es sur le bus.  Nous venons Ã  ce service et vous demandons de parler de sa santÃ© d'intÃ©gration.  Et si le service doit vendre un message quelque part plus loin (WebApp), il produira ce message de test.  Et si nous tirons le service du cÃ´tÃ© du traitement des commandes, il publie d'abord quelque chose qu'il peut publier indÃ©pendamment, et s'il y a des choses dÃ©pendantes, il lit ensuite un ensemble de messages de test Ã  partir du bus, comprend qu'il peut les traiter, le signaler et , si nÃ©cessaire, postez-les plus loin, et Ã  ce sujet, il dit - tout va bien, je suis vivant. <br><br>  TrÃ¨s souvent, nous entendons la question "comment pouvons-nous tester cela sur les donnÃ©es de combat?"  Par exemple, nous parlons du mÃªme service de commande.  La commande envoie des messages Ã  l'entrepÃ´t oÃ¹ les marchandises sont dÃ©bitÃ©es: nous ne pouvons pas tester cela sur les donnÃ©es de combat, car "mes marchandises seront dÃ©bitÃ©es!"  Quitter: au stade initial, planifier tout ce test.  Vous avez des tests unitaires qui se moquent.  Alors, faites-le Ã  un niveau plus profond, oÃ¹ vous aurez un canal de communication qui ne nuira pas Ã  l'entreprise. <br><br><h3>  Niveau infrastructure </h3><br>  La surveillance des infrastructures est ce qui a longtemps Ã©tÃ© considÃ©rÃ© comme la surveillance elle-mÃªme. <br><br><ul><li>  La surveillance des infrastructures peut et doit Ãªtre lancÃ©e en tant que processus distinct. </li><li>  Vous ne devez pas commencer par surveiller l'infrastructure d'un projet en cours, mÃªme si vous le souhaitez vraiment.  C'est une plaie pour tous les devops.  Â«Je surveille d'abord le cluster, je surveille l'infrastructureÂ» - c'est-Ã -dire  Tout d'abord, il surveillera ce qui se trouve en dessous, mais il ne montera pas dans l'application.  Parce que l'application est une chose incomprÃ©hensible pour la devopa.  Ils lui ont divulguÃ© cette information et il ne comprend pas comment cela fonctionne.  Et il comprend l'infrastructure et commence par elle.  Mais non - vous devez toujours surveiller l'application en premier. </li><li>     .    ,   ,       - .   on-call,     ,  Â«    Â».       . </li></ul><br><h3>    - </h3><br>  : <br><br><ul><li> ELK.   .   -     ,    . </li><li> APM.  APM       (NewRelic, BlackFire, Datadog).      ,   - ,    . </li><li> Tracing.       ,         .    ,     tracing   â€”     .     â€“ ! . Jaeger/Zipkin </li></ul><br><h3>  </h3><br><ul><li>   :           .   Grafana.     PagerDuty.     (,   â€¦).   ,     </li><li>   :      (    ,     ). Oncall    :    ,       ,       ,   â€”     (          â€”  , :         ,  ).  ,     â€”    (Â«   â€”    Â»),    . </li><li>  Â« Â»  workflow  :        ,        ,   .   ,    â€”  ;        . </li></ul><br><h3>   </h3><br>  ,     : <br><br><ul><li>   â€” Prometheus + Grafana; </li><li>   â€” ELK; </li><li>  APM  Tracing â€” Jaeger (Zipkin). </li></ul><br><img src="https://habrastorage.org/webt/tv/xl/3i/tvxl3isq0zhn8tfkeqermj9tuko.png"><br><br>   .  ,     ,      ,         .   ,     .  , , ,     â€”       . <br><br>   ,       : <br><br> <i>Prometheus   Kubernetes â€”   ?!</i>     ,    ?      ,        ,   â€” ,      . <br><br> <i>       .</i>      .    ,   Promtheus,   ,    ,      .             ? ,     ,      . <br><br><h3>  Conclusions </h3><br><ul><li>   â€”   ,    . 98%   â€”  .   ,   ,   ,  --. </li><li>      :     30%  ,   . </li><li> ,  ,      - ,     â€”     .    ,    â€”   . </li><li>        (  ) â€”    . </li><li>     ,   ,   Â« Â» â€”    ,      . </li></ul><br> <i>      Saint Highload++.</i> <br><br> UPD (       ): <br><br> 1.  ,   ,  ,   Â«,  ,    ,   Â». ,   :  DevOps    ,     â€”   , ,  ,  . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Je n'essaie pas d'indiquer, disent-ils, "tout est mauvais partout, mais nous pouvons vous surveiller - venez Ã  ITSumma." </font><font style="vertical-align: inherit;">Non, si le projet est lancÃ©, le suivi ne peut pas Ãªtre effectuÃ© par une sociÃ©tÃ© tierce. </font><font style="vertical-align: inherit;">Bien sÃ»r, nous avons Ã©galement des objectifs commerciaux, et ce que nous pensons vraiment faire est d'introduire la consultation pour soutenir le projet dans le processus de son dÃ©veloppement afin de transmettre comment mener correctement la partie de suivi du dÃ©veloppement.</font></font><br><br>  Si vous Ãªtes intÃ©ressÃ© par mes idÃ©es et rÃ©flexions Ã  ce sujet et ainsi de suite, alors vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lire la chaÃ®ne</a> :-) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448602/">https://habr.com/ru/post/fr448602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448588/index.html">L'architecture de l'Ã©quilibreur de charge rÃ©seau dans Yandex.Cloud</a></li>
<li><a href="../fr448590/index.html">Des inconnus familiers ou encore une fois sur l'utilisation de modÃ¨les de conception</a></li>
<li><a href="../fr448594/index.html">Antivirus et pare-feu gratuits (UTM, NGFW) de Sophos</a></li>
<li><a href="../fr448596/index.html">Porte-tablette sur tapis roulant ou recherchez des Ã©tapes gratuites</a></li>
<li><a href="../fr448600/index.html">Comment Windows 10 Explore une vulnÃ©rabilitÃ© critique DHCP dÃ©tecte deux autres erreurs de sÃ©curitÃ©</a></li>
<li><a href="../fr448606/index.html">Sidorin: KnowledgeConf est sur la faÃ§on de maintenir les connaissances avec une durÃ©e moyenne de travail en un seul endroit en 2-3 ans</a></li>
<li><a href="../fr448608/index.html">Comment faire les premiers pas en robotique?</a></li>
<li><a href="../fr448610/index.html">DIY: Comment nous avons crÃ©Ã© un programme en direct pour Codefest X</a></li>
<li><a href="../fr448612/index.html">Ce qui a Ã©tÃ© gelÃ© au gel des fonctionnalitÃ©s 2019. Partie I. JSONPath</a></li>
<li><a href="../fr448618/index.html">Algorithme Douglas-Pecker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>