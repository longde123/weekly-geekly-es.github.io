<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💼 👨🏾‍💼 💇🏼 La surveillance est-elle morte? - Surveillance longue durée 🧑🏾‍🤝‍🧑🏻 👩🏻‍🏫 🔪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Depuis 2008, notre entreprise est principalement engagée dans la gestion des infrastructures et le support technique 24h / 24 pour les projets web: no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La surveillance est-elle morte? - Surveillance longue durée</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/448602/"><img src="https://habrastorage.org/webt/rb/6a/wf/rb6awfy_oiasqde7kja4h39oczm.jpeg"><br><br>  Depuis 2008, notre entreprise est principalement engagée dans la gestion des infrastructures et le support technique 24h / 24 pour les projets web: nous avons plus de 400 clients, soit environ 15% du e-commerce en Russie.  En conséquence, une architecture très diversifiée est prise en charge.  Si quelque chose tombe, nous devons le réparer dans les 15 minutes.  Mais pour comprendre qu'un accident est survenu, vous devez surveiller le projet et répondre aux incidents.  Comment faire <br><br>  Je pense que l'organisation du bon système de surveillance est en difficulté.  S'il n'y a pas eu de problème, mon discours a consisté en une thèse: "Veuillez installer Prometheus + Grafana et les plugins 1, 2, 3."  Malheureusement, cela ne fonctionne pas maintenant.  Et le principal problème est que tout le monde continue de croire en quelque chose qui existait en 2008, en termes de composants logiciels. <br><br>  Concernant l'organisation du système de suivi, je risque de dire que ... des projets avec un suivi compétent n'existent pas.  Et la situation est si mauvaise si quelque chose tombe, il y a un risque qu'elle passe inaperçue - tout le monde est sûr que «tout est surveillé». <br>  Peut-être que tout est surveillé.  Mais comment? <br><br>  Nous sommes tous tombés sur une histoire similaire à la suivante: un certain devoop, un certain administrateur travaille, une équipe de développement vient vers eux et dit: «nous l'avons, maintenant c'est surveillé.»  Quel moniteur?  Comment ça marche? <br><br>  Ok  Nous surveillons à l'ancienne.  Mais cela est déjà en train de changer, et il s'avère que vous avez surveillé le service A, devenu le service B, qui interagit avec le service C. Mais l'équipe de développement vous dit: "Installez le logiciel, il faut tout surveiller!" <br><br>  Alors qu'est-ce qui a changé?  - Tout a changé! <br><a name="habracut"></a><br><h4>  2008 année.  Tout va bien </h4><br>  Il y a deux développeurs, un serveur, un serveur de base de données.  De là, tout se passe.  Nous avons quelques INFA, nous mettons zabbix, Nagios, cactus.  Et puis nous avons défini des alertes claires sur le CPU, sur le fonctionnement des disques, sur la place sur les disques.  Nous effectuons également quelques vérifications manuelles que le site répond que les commandes arrivent dans la base de données.  Et c'est tout - nous sommes plus ou moins protégés. <br><br>  Si nous comparons la quantité de travail que l'administrateur a fait pour assurer la surveillance, alors c'était 98% automatique: la personne qui surveille devrait comprendre comment installer Zabbix, comment le configurer et configurer les alertes.  Et 2% - pour les contrôles externes: que le site réponde et demande à la base de données que de nouvelles commandes sont arrivées. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/846/5ae/a65/8465aea65cdf10015bb2aad7eff7ebf6.png"><br><br><h4>  2010 année.  La charge augmente </h4><br>  Nous commençons à faire évoluer le Web, à ajouter un moteur de recherche.  Nous voulons être sûrs que le catalogue de produits contient tous les produits.  Et cette recherche de produit fonctionne.  Que la base de données fonctionne, que des commandes sont en cours, que le site répond en externe et répond à partir de deux serveurs, et que l'utilisateur n'est pas expulsé du site pendant qu'il se rééquilibre vers un autre serveur, etc.  Il y a plus d'entités. <br><br>  De plus, l’entité associée à l’infrastructure reste la plus importante de la tête du gestionnaire.  L'idée me vient encore à l'esprit que la personne qui surveille est la personne qui va installer zabbix et pouvoir le configurer. <br><br>  Mais en même temps, il y a des travaux sur la réalisation de contrôles externes, sur la création d'un ensemble de scripts pour interroger l'indexeur de recherche, un ensemble de scripts pour vérifier que la recherche change au cours du processus d'indexation, un ensemble de scripts qui vérifient que les marchandises sont transférées au service de livraison, etc.  etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/45c/974/24c/45c97424c842cf539e79b900b903437d.png"><br><br>  Remarque: j'ai écrit un «ensemble de scripts» 3 fois.  Autrement dit, la personne responsable de la surveillance n'est plus celle qui installe simplement zabbix.  C'est la personne qui commence à coder.  Mais rien n'a encore changé dans l'esprit de l'équipe. <br><br>  Mais le monde change, devenant de plus en plus compliqué.  Une couche de virtualisation, plusieurs nouveaux systèmes sont ajoutés.  Ils commencent à interagir les uns avec les autres.  Qui a dit "ça sent bon les microservices?"  Mais chaque service ressemble toujours individuellement à un site.  Nous pouvons nous tourner vers lui et comprendre qu'il donne les informations nécessaires et travaille seul.  Et si vous êtes un administrateur qui est constamment engagé dans un projet qui se développe depuis 5-7-10 ans, vous avez accumulé cette connaissance: un nouveau niveau apparaît - vous vous en êtes rendu compte, un autre niveau apparaît - vous l'avez réalisé ... <br><br><img src="https://habrastorage.org/webt/tc/we/qe/tcweqem6jjpldcpovhhoklgt3kq.png"><br><br>  Mais rarement quelqu'un accompagne le projet pendant 10 ans. <br><br><h3>  Résumé de surveillance de l'homme </h3><br>  Supposons que vous soyez arrivé à une nouvelle startup qui a immédiatement marqué 20 développeurs, écrit 15 microservices et que vous êtes l'administrateur à qui on a dit: «Créez un CI / CD.  S'il te plait. "  Vous avez construit un CI / CD et soudain vous entendez: "Il est difficile pour nous de travailler avec la production dans le" cube "sans comprendre comment l'application fonctionnera.  Faites-nous un bac à sable dans le même "cube". <br>  Vous faites un bac à sable dans ce cube.  Ils vous disent immédiatement: «Nous voulons une base de données de scène, qui est mise à jour quotidiennement à partir de la production, afin de comprendre qu'elle fonctionne sur la base de données, mais en même temps ne pas gâcher la base de données de production.» <br><br>  Vous vivez dans tout cela.  Il reste 2 semaines avant la sortie, ils vous disent: "Maintenant, tout serait surveillé ..."  surveiller l'infrastructure de cluster, surveiller l'architecture des microservices, surveiller le travail avec les services externes ... <br><br>  Et des collègues leur sortent un schéma si familier et disent: «Alors ici, tout est clair!  Installez un programme qui surveille tout. »  Oui: Prometheus + Grafana + plugins. <br>  Et ils ajoutent en même temps: "Vous avez deux semaines, assurez-vous que tout est fiable." <br><br>  Dans le tas de projets que nous voyons, une personne est affectée au suivi.  Imaginez que nous voulons embaucher une personne pendant 2 semaines pour surveiller, et nous lui rédigerons un curriculum vitae.  Quelles compétences cette personne devrait-elle posséder - compte tenu de tout ce que nous avons dit auparavant? <br><br><ul><li>  Il doit comprendre le suivi et les spécificités du travail de l'infrastructure sidérurgique. </li><li>  Il doit comprendre les spécificités de la surveillance de Kubernetes (et tout le monde veut un «cube», car vous pouvez tout ignorer, vous cacher, car l'administrateur le comprendra) - en lui-même, son infrastructure et comprendre comment surveiller les applications à l'intérieur. </li><li>  Il doit comprendre que les services communiquent entre eux de façon particulière et connaître les spécificités de l'interaction des services entre eux.  Il est assez réaliste de voir un projet dans lequel certains services communiquent de manière synchrone, car il n'y a pas d'autre moyen.  Par exemple, le backend passe sur REST, sur gRPC au service de catalogue, reçoit une liste de marchandises et retourne.  Vous ne pouvez pas attendre ici.  Et avec d'autres services, il fonctionne de manière asynchrone.  Transférer la commande au service de livraison, envoyer une lettre, etc. <br>  Vous avez probablement déjà navigué de tout cela?  Et l'administrateur, qui doit surveiller cela, a nagé encore plus. </li><li>  Il doit être capable de planifier et de planifier correctement - car le travail devient de plus en plus. </li><li>  Il doit donc créer une stratégie à partir du service créé afin de comprendre comment le surveiller spécifiquement.  Il a besoin d'une compréhension de l'architecture du projet et de son développement + compréhension des technologies utilisées dans le développement. </li></ul><br>  Rappelons un cas tout à fait normal: une partie des services en php, une partie des services en Go, une partie des services en JS.  Ils travaillent en quelque sorte entre eux.  C'est de là que vient le terme «microservice»: il y a tellement de systèmes séparés que les développeurs ne peuvent pas comprendre le projet dans son ensemble.  Une partie de l'équipe écrit des services dans JS qui fonctionnent seuls et ne savent pas comment fonctionne le reste du système.  L'autre partie écrit des services en Python et n'entre pas dans le fonctionnement des autres services, ils sont isolés dans leur domaine.  Troisième - écrit des services en php ou autre chose. <br>  Toutes ces 20 personnes sont divisées en 15 services, et il n'y a qu'un seul administrateur qui devrait comprendre tout cela.  Arrête ça!  nous venons de diviser le système en 15 microservices, car 20 personnes ne peuvent pas comprendre l'ensemble du système. <br><br>  Mais cela doit être surveillé d'une manière ou d'une autre ... <br><br>  Quel est le résultat?  En conséquence, il y a une personne qui comprend tout ce que toute une équipe de développeurs ne peut pas comprendre, et pourtant il doit également savoir et être en mesure de ce que nous avons indiqué ci-dessus - infrastructure de fer, infrastructure de Kubernetes, etc. <br><br>  Que puis-je dire ... Houston, nous avons des problèmes. <br><br><h3>  Le suivi d'un projet logiciel moderne est un projet logiciel en soi </h3><br>  Partant d'une fausse croyance selon laquelle la surveillance est un logiciel, nous croyons aux miracles.  Mais les miracles, hélas, ne se produisent pas.  Vous ne pouvez pas installer zabbix et attendre que tout fonctionne.  Cela n'a aucun sens de mettre Grafana et d'espérer que tout ira bien.  La plupart du temps sera consacré à l'organisation de contrôles sur le fonctionnement des services et leur interaction les uns avec les autres, sur le fonctionnement des systèmes externes.  En fait, 90% du temps sera consacré non pas à l'écriture de scripts, mais au développement de logiciels.  Et ce devrait être une équipe qui comprend le travail du projet. <br>  Si, dans cette situation, une personne est renvoyée pour surveillance, des problèmes se produiront.  Ce qui se passe partout. <br><br>  Par exemple, il existe plusieurs services qui communiquent entre eux via Kafka.  Une commande est arrivée, nous avons envoyé un message sur la commande à Kafka.  Il existe un service qui écoute les informations sur la commande et effectue l'expédition des marchandises.  Il existe un service qui écoute les informations sur la commande et envoie une lettre à l'utilisateur.  Et puis il y a encore un tas de services, et on commence à se confondre. <br><br>  Et si vous le donnez toujours à l'administrateur et aux développeurs à un stade où il reste peu de temps avant la sortie, une personne devra comprendre tout ce protocole.  C'est-à-dire  un projet de cette envergure prend beaucoup de temps et doit être intégré dans le développement du système. <br>  Mais très souvent, en particulier lors de la gravure, dans les startups, nous voyons comment la surveillance est remise à plus tard.  «Maintenant, nous allons faire la preuve de concept, nous allons commencer avec elle, la laisser tomber - nous sommes prêts à sacrifier.  Et puis nous surveillerons tout cela. »  Quand (ou si) le projet commence à gagner de l'argent, l'entreprise veut réduire encore plus de fonctionnalités - car il a commencé à fonctionner, vous devez donc aller plus loin!  Et vous êtes au point où au début vous devez surveiller tout ce qui précède, ce qui ne prend pas 1% du temps, mais beaucoup plus.  Et en passant, les développeurs auront besoin d'une surveillance, et il est plus facile de les intégrer dans de nouvelles fonctionnalités.  En conséquence, de nouvelles fonctionnalités sont écrites, tout est terminé et vous êtes dans une impasse sans fin. <br><br>  Alors, comment contrôlez-vous un projet depuis le début, et si vous avez un projet que vous devez surveiller, mais vous ne savez pas par où commencer? <br><br>  Tout d'abord, vous devez planifier. <br><br>  <i>Digression lyrique: commence très souvent par la surveillance des infrastructures.</i>  <i>Par exemple, nous avons Kubernetes.</i>  <i>Pour commencer, nous mettons Prometheus avec Grafana, mettons les plugins sous la surveillance du "cube".</i>  <i>Non seulement les développeurs, mais aussi les administrateurs ont une pratique malheureuse: "Nous allons installer ce plug-in, et le plug-in sait probablement comment le faire."</i>  <i>Les gens aiment commencer par des actions simples et compréhensibles, plutôt que des actions importantes.</i>  <i>Et la surveillance de l'infrastructure est facile.</i> <br><br>  D'abord, décidez quoi et comment vous voulez surveiller, puis prenez l'instrument, car les autres ne peuvent pas penser à votre place.  Oui, et devraient-ils?  D'autres personnes ont pensé au système universel - ou n'ont pas pensé du tout quand ce plugin a été écrit.  Et le fait que ce plugin compte 5 000 utilisateurs ne signifie pas qu'il apporte un quelconque avantage.  Peut-être deviendrez-vous le 5001e simplement parce qu'il y avait déjà 5 000 personnes auparavant. <br><br>  Si vous avez commencé à surveiller l'infrastructure et que le backend de votre application a cessé de répondre, tous les utilisateurs perdront le contact avec l'application mobile.  Une erreur s'envolera.  Ils viendront vers vous et vous diront: "L'application ne fonctionne pas, que faites-vous ici?"  "Nous surveillons."  - "Comment surveillez-vous si vous ne voyez pas que l'application ne fonctionne pas?!" <br><br><ol><li>  Je pense qu'il est nécessaire de commencer la surveillance à partir du point d'entrée de l'utilisateur.  Si l'utilisateur ne voit pas que l'application fonctionne - c'est tout, c'est un échec.  Et le système de surveillance devrait en avertir en premier lieu. </li><li>  Et ce n'est qu'alors que nous pourrons surveiller l'infrastructure.  Ou faites-le en parallèle.  L'infrastructure est plus simple - ici, nous pouvons enfin simplement installer zabbix. </li><li>  Et maintenant, vous devez aller aux racines de l'application pour comprendre où cela ne fonctionne pas. </li></ol><br>  Ma principale pensée est que le suivi devrait aller en parallèle avec le processus de développement.  Si vous détachez l'équipe de surveillance pour d'autres tâches (création d'un CI / CD, bacs à sable, réorganisation de l'infrastructure), la surveillance commencera à être à la traîne et vous ne pourrez jamais rattraper le développement (ou tôt ou tard, il devra être arrêté). <br><br><h3>  Tout par niveaux </h3><br>  C'est ainsi que je vois l'organisation du système de surveillance. <br><br>  1) Niveau d'application: <br><ul><li>  surveiller la logique métier de l'application; </li><li>  surveiller les paramètres de santé des services; </li><li>  surveillance de l'intégration. </li></ul><br>  2) Niveau d'infrastructure: <br><ul><li>  surveiller le niveau d'orchestration; </li><li>  logiciel de système de surveillance; </li><li>  surveiller le niveau de "fer". </li></ul><br>  3) Encore une fois, le niveau d'application - mais en tant que produit d'ingénierie: <br><ul><li>  collecte et surveillance des journaux d'application; </li><li>  APM </li><li>  traçage. </li></ul><br>  4) Alerte: <br><ul><li>  organisation d'un système d'alerte; </li><li>  organisation d'un système de veille; </li><li>  organisation d'une "base de connaissances" et traitement des incidents de workflow. </li></ul><br>  <b>Important</b> : nous arrivons à l'alerte non pas après, mais immédiatement!  Il n'est pas nécessaire de commencer la surveillance et «en quelque sorte plus tard» de penser à qui recevra les alertes.  Après tout, quelle est la tâche de surveillance: comprendre où quelque chose ne fonctionne pas dans le système et en informer les bonnes personnes.  Si cela est laissé à la fin, les bonnes personnes découvriront que quelque chose ne va pas, seulement en appelant "rien ne fonctionne pour nous". <br><br><h3>  Couche d'application - Surveillance de la logique métier </h3><br>  Ici, nous parlons de vérifier le fait que l'application fonctionne pour l'utilisateur. <br><br>  Ce niveau doit être effectué au stade de la conception.  Par exemple, nous avons un Prométhée conditionnel: il rampe vers le serveur qui est engagé dans les vérifications, extrait le point de terminaison et le point de terminaison va vérifier l'API. <br><br>  Lorsqu'on leur demande souvent de surveiller la page principale pour s'assurer que le site fonctionne, les programmeurs donnent un stylo qui peut être tiré à chaque fois que vous devez vous assurer que l'API fonctionne.  Et les programmeurs en ce moment prennent et écrivent toujours / api / test / helloworld <br>  La seule façon de vous assurer que tout fonctionne?  - Non! <br><br><ul><li>  La création de tels contrôles est essentiellement la tâche des développeurs.  Les tests unitaires doivent être écrits par des programmeurs qui écrivent du code.  Parce que si vous fusionnez cela dans l'admin "Mec, voici une liste de protocoles API pour les 25 fonctions, veuillez tout surveiller!"  - rien ne fonctionnera. </li><li>  Si vous imprimez «bonjour le monde», personne ne saura jamais que l'API devrait et fonctionne vraiment.  Chaque modification de l'API doit entraîner une modification des contrôles. </li><li>  Si vous avez déjà une telle catastrophe, arrêtez les fonctionnalités et sélectionnez les développeurs qui écriront ces chèques, ou conciliez avec les pertes, conciliez que rien n'est vérifié et tombera. </li></ul><br>  Conseils techniques: <br><br><ul><li>  Assurez-vous d'organiser un serveur externe pour organiser les inspections - vous devez être sûr que votre projet est accessible au monde extérieur. </li><li>  Organisez la validation sur l'ensemble du protocole API, pas seulement sur les points de terminaison individuels. </li><li>  Créez un point final prometheus avec les résultats des tests. </li></ul><br><h3>  Niveau d'application - Surveillance des métriques d'intégrité </h3><br>  Nous parlons maintenant de mesures de santé externes des services. <br><br>  Nous avons décidé de surveiller tous les «stylos» de l'application à l'aide de vérifications externes que nous appelons à partir d'un système de surveillance externe.  Mais ce sont précisément les «stylos» que l'utilisateur «voit».  Nous voulons être sûrs que les services eux-mêmes fonctionnent pour nous.  Voici une meilleure histoire: K8s a des contrôles de santé afin qu'au moins le cube s'assure que le service fonctionne.  Mais la moitié des chèques que j'ai vus sont la même impression «bonjour le monde».  C'est-à-dire  ici il tire une fois après le déploiement, il lui a répondu que tout allait bien - et c'est tout.  Et le service, s'il repose sur sa propre API, possède un grand nombre de points d'entrée pour la même API, qui doit également être surveillée, car nous voulons savoir qu'elle fonctionne.  Et nous le surveillons déjà à l'intérieur. <br><br>  Comment l'implémenter correctement techniquement: chaque service définit un point de terminaison sur ses performances actuelles, et dans les graphiques de Grafana (ou de toute autre application), nous voyons l'état de tous les services. <br><br><ul><li>  Chaque modification de l'API doit entraîner une modification des contrôles. </li><li>  Créez immédiatement un nouveau service avec des mesures de santé. </li><li>  L'administrateur peut s'adresser aux développeurs et demander "ajoutez-moi quelques fonctionnalités pour que je comprenne tout et ajoute des informations à ce sujet à mon système de surveillance".  Mais les développeurs répondent généralement: «Nous n’ajouterons rien deux semaines avant la sortie.» <br>  Faites savoir aux responsables du développement qu'il y aura de telles pertes, informez également les patrons des responsables du développement.  Parce que quand tout tombera, quelqu'un continuera d'appeler et d'exiger de surveiller le "service en baisse constante" (c) </li><li>  Soit dit en passant, sélectionnez les développeurs pour écrire des plugins pour Grafana - ce sera une bonne aide pour les administrateurs. </li></ul><br><h3>  Couche d'application - Surveillance de l'intégration </h3><br>  La surveillance de l'intégration se concentre sur la surveillance de la communication entre les systèmes critiques de l'entreprise. <br><br>  Par exemple, 15 services communiquent entre eux.  Ce ne sont plus des sites individuels.  C'est-à-dire  nous ne pouvons pas tirer le service seul, obtenir / helloworld et comprendre que le service fonctionne.  Parce que le service Web pour passer une commande doit envoyer des informations sur la commande au bus - le service d'entrepôt doit recevoir ce message du bus et travailler avec lui.  Et le service de distribution de courrier électronique devrait gérer cela d'une manière ou d'une autre, etc. <br><br>  En conséquence, nous ne pouvons pas comprendre, en poussant à chaque service individuel, que tout cela fonctionne.  Parce que nous avons un certain bus à travers lequel tout communique et interagit. <br>  Par conséquent, cette étape doit indiquer l'étape de test des services pour interagir avec d'autres services.  Après avoir surveillé un courtier de messages, vous ne pouvez pas organiser la surveillance de la communication.  S'il existe un service qui émet des données et un service qui les reçoit, lors de la surveillance d'un courtier, nous ne verrons que les données qui volent d'un côté à l'autre.  Même si nous avons réussi à surveiller l'interaction de ces données à l'intérieur - que certains producteurs publient les données, quelqu'un les lit, ce flux continue à aller à Kafka - il ne nous donnera toujours pas d'informations si un service a donné un message dans une version, mais un autre service ne s'attendait pas à cette version et l'a sautée.  Nous ne le saurons pas, car les services nous diront que tout fonctionne. <br><br>  Comme je le recommande: <br><br><ul><li>  Pour la communication synchrone: le point d'extrémité exécute les demandes de services associés.  C'est-à-dire  nous prenons ce point de terminaison, tirons le script à l'intérieur du service, qui va à tous les points et dit "Je peux y tirer et tirer là, je peux tirer ..." </li><li>  Pour la communication asynchrone: messages entrants - le point final vérifie le bus pour les messages de test et affiche l'état du traitement. </li><li>  Pour la communication asynchrone: messages sortants - le point d'extrémité envoie des messages de test au bus. </li></ul><br>  Comme d'habitude: nous avons un service qui envoie des données sur le bus.  Nous venons à ce service et vous demandons de parler de sa santé d'intégration.  Et si le service doit vendre un message quelque part plus loin (WebApp), il produira ce message de test.  Et si nous tirons le service du côté du traitement des commandes, il publie d'abord quelque chose qu'il peut publier indépendamment, et s'il y a des choses dépendantes, il lit ensuite un ensemble de messages de test à partir du bus, comprend qu'il peut les traiter, le signaler et , si nécessaire, postez-les plus loin, et à ce sujet, il dit - tout va bien, je suis vivant. <br><br>  Très souvent, nous entendons la question "comment pouvons-nous tester cela sur les données de combat?"  Par exemple, nous parlons du même service de commande.  La commande envoie des messages à l'entrepôt où les marchandises sont débitées: nous ne pouvons pas tester cela sur les données de combat, car "mes marchandises seront débitées!"  Quitter: au stade initial, planifier tout ce test.  Vous avez des tests unitaires qui se moquent.  Alors, faites-le à un niveau plus profond, où vous aurez un canal de communication qui ne nuira pas à l'entreprise. <br><br><h3>  Niveau infrastructure </h3><br>  La surveillance des infrastructures est ce qui a longtemps été considéré comme la surveillance elle-même. <br><br><ul><li>  La surveillance des infrastructures peut et doit être lancée en tant que processus distinct. </li><li>  Vous ne devez pas commencer par surveiller l'infrastructure d'un projet en cours, même si vous le souhaitez vraiment.  C'est une plaie pour tous les devops.  «Je surveille d'abord le cluster, je surveille l'infrastructure» - c'est-à-dire  Tout d'abord, il surveillera ce qui se trouve en dessous, mais il ne montera pas dans l'application.  Parce que l'application est une chose incompréhensible pour la devopa.  Ils lui ont divulgué cette information et il ne comprend pas comment cela fonctionne.  Et il comprend l'infrastructure et commence par elle.  Mais non - vous devez toujours surveiller l'application en premier. </li><li>     .    ,   ,       - .   on-call,     ,  «    ».       . </li></ul><br><h3>    - </h3><br>  : <br><br><ul><li> ELK.   .   -     ,    . </li><li> APM.  APM       (NewRelic, BlackFire, Datadog).      ,   - ,    . </li><li> Tracing.       ,         .    ,     tracing   —     .     – ! . Jaeger/Zipkin </li></ul><br><h3>  </h3><br><ul><li>   :           .   Grafana.     PagerDuty.     (,   …).   ,     </li><li>   :      (    ,     ). Oncall    :    ,       ,       ,   —     (          —  , :         ,  ).  ,     —    («   —    »),    . </li><li>  « »  workflow  :        ,        ,   .   ,    —  ;        . </li></ul><br><h3>   </h3><br>  ,     : <br><br><ul><li>   — Prometheus + Grafana; </li><li>   — ELK; </li><li>  APM  Tracing — Jaeger (Zipkin). </li></ul><br><img src="https://habrastorage.org/webt/tv/xl/3i/tvxl3isq0zhn8tfkeqermj9tuko.png"><br><br>   .  ,     ,      ,         .   ,     .  , , ,     —       . <br><br>   ,       : <br><br> <i>Prometheus   Kubernetes —   ?!</i>     ,    ?      ,        ,   — ,      . <br><br> <i>       .</i>      .    ,   Promtheus,   ,    ,      .             ? ,     ,      . <br><br><h3>  Conclusions </h3><br><ul><li>   —   ,    . 98%   —  .   ,   ,   ,  --. </li><li>      :     30%  ,   . </li><li> ,  ,      - ,     —     .    ,    —   . </li><li>        (  ) —    . </li><li>     ,   ,   « » —    ,      . </li></ul><br> <i>      Saint Highload++.</i> <br><br> UPD (       ): <br><br> 1.  ,   ,  ,   «,  ,    ,   ». ,   :  DevOps    ,     —   , ,  ,  . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Je n'essaie pas d'indiquer, disent-ils, "tout est mauvais partout, mais nous pouvons vous surveiller - venez à ITSumma." </font><font style="vertical-align: inherit;">Non, si le projet est lancé, le suivi ne peut pas être effectué par une société tierce. </font><font style="vertical-align: inherit;">Bien sûr, nous avons également des objectifs commerciaux, et ce que nous pensons vraiment faire est d'introduire la consultation pour soutenir le projet dans le processus de son développement afin de transmettre comment mener correctement la partie de suivi du développement.</font></font><br><br>  Si vous êtes intéressé par mes idées et réflexions à ce sujet et ainsi de suite, alors vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lire la chaîne</a> :-) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448602/">https://habr.com/ru/post/fr448602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448588/index.html">L'architecture de l'équilibreur de charge réseau dans Yandex.Cloud</a></li>
<li><a href="../fr448590/index.html">Des inconnus familiers ou encore une fois sur l'utilisation de modèles de conception</a></li>
<li><a href="../fr448594/index.html">Antivirus et pare-feu gratuits (UTM, NGFW) de Sophos</a></li>
<li><a href="../fr448596/index.html">Porte-tablette sur tapis roulant ou recherchez des étapes gratuites</a></li>
<li><a href="../fr448600/index.html">Comment Windows 10 Explore une vulnérabilité critique DHCP détecte deux autres erreurs de sécurité</a></li>
<li><a href="../fr448606/index.html">Sidorin: KnowledgeConf est sur la façon de maintenir les connaissances avec une durée moyenne de travail en un seul endroit en 2-3 ans</a></li>
<li><a href="../fr448608/index.html">Comment faire les premiers pas en robotique?</a></li>
<li><a href="../fr448610/index.html">DIY: Comment nous avons créé un programme en direct pour Codefest X</a></li>
<li><a href="../fr448612/index.html">Ce qui a été gelé au gel des fonctionnalités 2019. Partie I. JSONPath</a></li>
<li><a href="../fr448618/index.html">Algorithme Douglas-Pecker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>