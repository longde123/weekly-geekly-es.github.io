<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüî¨ üèóÔ∏è ‚ò™Ô∏è Un, deux, trois! Chatbot de Google Sheets utilisant l'exemple d'un jeu PvP pour Alice ü§∑üèΩ üíÜüèø üë©üèæ‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apparaissant, Alice a captiv√© les utilisateurs avec une synth√®se vocale de qualit√© inattendue et un chat bot. Aujourd'hui, elle devrait avoir des comp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un, deux, trois! Chatbot de Google Sheets utilisant l'exemple d'un jeu PvP pour Alice</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414213/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/je/rg/em/jergemafxw-e_63-gibe4edxyie.png"></div><br>  Apparaissant, Alice a captiv√© les utilisateurs avec une synth√®se vocale de qualit√© inattendue et un chat bot.  Aujourd'hui, elle devrait avoir des comp√©tences utiles et des jeux int√©ressants avec un backend qui peut prendre en compte le contexte de l'utilisateur et mettre en ≈ìuvre un large √©ventail de sc√©narios.  Cet article traite de la cr√©ation d'une comp√©tence bas√©e sur Google Sheets, un outil familier √† beaucoup avec un grand potentiel pour les petits chatbots. <br><br>  Jouer avec une vraie personne peut √™tre plus int√©ressant que de jouer avec un personnage virtuel, donc √† titre d'exemple, nous allons d√©velopper un jeu multijoueur pour Alice. <br><a name="habracut"></a><br><h2>  Un!  Dialogue </h2><br>  Le jeu commence par les r√®gles.  Je suis venu avec ces derniers: chacun des deux joueurs place d'abord un tr√©sor et un pi√®ge derri√®re trois portes, puis ouvre l'une des portes de l'adversaire.  Ouvrez le tr√©sor - r√©cup√©rez les pi√®ces de l'adversaire, ouvrez le pi√®ge - donnez-lui les pi√®ces.  Le nombre de pi√®ces, de 1 √† 3, est d√©termin√© par le joueur lui-m√™me.  Derri√®re la porte restante se trouve une bo√Æte de Pandore, ouverture dans laquelle vous pouvez trouver / perdre une quantit√© al√©atoire de pi√®ces.  Vous pouvez jouer √† la fois avec Alice et contre d'autres utilisateurs. <br><br>  L'interface d'Alice est r√©solue sous la forme d'un dialogue, et toute interaction avec le jeu doit √™tre impl√©ment√©e via la messagerie.  Le traitement de chaque message par le serveur de jeu est repr√©sent√© par les √©tapes suivantes: <br><br><ol><li>  restaurer le contexte utilisateur; </li><li>  l'interpr√©tation des requ√™tes dans un contexte restaur√©; </li><li>  former un message de r√©ponse; </li><li>  Enregistrement d'un contexte utilisateur modifi√©. </li></ol><br><h3>  R√©cup√©rer et enregistrer le contexte utilisateur </h3><br>  Le contexte de l'utilisateur comprend son √©tat dans le jeu, y compris les r√©sultats pr√©c√©dents, une √©tape dans le script et l'adversaire actuel, ainsi que le nom d'utilisateur et d'autres informations n√©cessaires √† la logique du jeu. <br><br>  Dans chaque demande, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">selon le protocole</a> , Alice transmet l'ID utilisateur.  Cela suffit pour sauvegarder puis restaurer son contexte. <br><br>  En tant qu'entrep√¥t de donn√©es, utilisez Google Sheets.  Les avantages objectifs de cette solution incluent l'utilisation gratuite, la visibilit√© et la facilit√© d'utilisation.  L'√©diteur de script int√©gr√© vous permet de d√©crire la logique du jeu dans Apps Script (bas√© sur JavaScript), en vous r√©f√©rant aux tables d'API et de le publier en tant qu'application Web. <br><br>  Apr√®s avoir cr√©√© le tableau avec les en-t√™tes n√©cessaires, vous pouvez aller dans l'√©diteur de script: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jd/rh/bo/jdrhbosnzge_mq5ms5h0oqnsnqo.png"></div><br>  La logique du jeu peut √™tre d√©crite dans un projet sur Apps Script, en l'organisant comme un ensemble de fichiers gs, et proc√©der √† la publication: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nk/w0/kn/nkw0kn0ghmmskohgbtk_nefgc3o.png"></div><br>  Lors de la publication, vous devez sp√©cifier la disponibilit√© de l'application pour les utilisateurs anonymes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g1/sw/fq/g1swfqcp998ufhh96b6lvqb64x0.png"></div><br>  En sortie, vous obtiendrez l'URL de l'application Web publi√©e.  Les fonctions doGet () et doPost () du script traiteront les requ√™tes des types correspondants afin de recevoir et d'enregistrer les contextes utilisateur. <br><br>  Vous trouverez ci-dessous un sch√©ma de travail avec les tables API pour la manipulation des donn√©es: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  var sheet = SpreadsheetApp.openById("&lt;id &gt;").getSheetByName("&lt; &gt;"); //  var range = sheet.getRange(&lt; &gt;); //   var values = range.getValues(); //    range.setValues(&lt; &gt;);</span></span></code> </pre> <br><h3>  Interpr√©ter une demande dans un contexte restaur√© </h3><br>  Dans le cas g√©n√©ral, l'interpr√©tation correcte des requ√™tes de texte n√©cessite l'utilisation d'algorithmes NLU intelligents.  Et bien que de tels algorithmes soient disponibles dans des outils simples comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">celui que j'ai d√©crit par Aimylogic</a> , dans ce cas, j'ai d√©cid√© d'abandonner le traitement du langage naturel au profit de la simplicit√©. <br><br>  Dans le jeu propos√©, l'interaction du joueur avec Alice est limit√©e √† une douzaine d'√©tats possibles et peut √™tre r√©duite √† un petit ensemble d'intentions.  Par souci de simplicit√©, je propose toujours au joueur trois actions possibles: envoyer ¬´Un¬ª, ¬´Deux¬ª ou ¬´Trois¬ª.  Pour toute autre demande, Alice demande de clarifier l'action. <br><br>  Le sc√©nario dans ce cas se r√©sume au code Apps Script suivant: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     switch(user.state){ case "start": //       switch(utterance){ case ‚Äú1Ô∏è‚É£ ‚Äù: case ‚Äú2Ô∏è‚É£ ‚Äù: case ‚Äú3Ô∏è‚É£ ‚Äù: //     default: //     } break; //    default: //      }</span></span></code> </pre><br>  Pour l'utilisateur, l'interaction ainsi r√©solue est repr√©sent√©e comme le choix de l'une des trois options, dont la signification est clairement d√©finie dans chaque r√©ponse d'Alice.  Les options elles-m√™mes sont repr√©sent√©es par les boutons ¬´Un¬ª, ¬´Deux¬ª, ¬´Trois¬ª, qui acc√©l√®rent consid√©rablement le gameplay. <br><br><h3>  G√©n√©ration de messages de r√©ponse </h3><br>  La r√©ponse d'Alice se compose de plusieurs parties, chacune devant √™tre form√©e, notamment: <br><br><ul><li>  texte √† afficher √† l'√©cran; </li><li>  texte pour la synth√®se vocale; </li><li>  ensemble de boutons d'indication. </li></ul><br>  R√©cemment, j'ai formul√© le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">concept d'un dialogue FACILE</a> qui d√©crit les principes de conception d'une interface conversationnelle, y compris pour Alice.  Le format de r√©ponse d'Alice permet de mettre en ≈ìuvre ces principes. <br><br>  Ainsi, la s√©paration du texte affich√© et du texte parl√© vous permet de rendre les r√©ponses plus concises et naturelles.  Vous ne pouvez pas forcer Alice √† synth√©tiser un texte long que l'utilisateur conna√Æt d√©j√†, ainsi qu'√† utiliser des emoji dans le texte du message et le nom des boutons. <br><br>  Les boutons d'indication mettent en ≈ìuvre le principe d'initiative: Alice indique et sugg√®re toujours des actions possibles pour poursuivre le dialogue.  Dans le sc√©nario du jeu propos√©, la liste des boutons ne d√©pend pas du contexte et est ajout√©e √† chaque message. <br><br>  Nous avons donc une table Google avec des donn√©es utilisateur qui sont stock√©es et r√©cup√©r√©es via l'URL de l'application Web.  L'application est √©crite en Apps Script, elle interpr√®te l'action de l'utilisateur en fonction de son contexte et g√©n√®re des donn√©es pour le message de r√©ponse. <br><br>  Reste √† se connecter √† Alice ... <br><br><h2>  Deux!  Int√©gration </h2><br>  Yandex.Dialogs permet aux d√©veloppeurs d'ajouter leurs comp√©tences √† Alice.  Connecter une comp√©tence se r√©sume √† trois choses principales: <br><br><ul><li>  activation; </li><li>  conception; </li><li>  crochet Web. </li></ul><br><h3>  Activation et conception </h3><br>  Pour l'activation, il est important de choisir une phrase que Alice reconna√Æt bien, qui r√©pond aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exigences formelles de</a> Yandex.  S'il y a des num√©ros dans le nom d'activation, v√©rifiez s√©par√©ment l'activation lorsque vous entrez √† partir du clavier et de la voix. <br><br>  La conception des comp√©tences comprend un nom, une description, une ic√¥ne, une cat√©gorie, etc. <br>  Il convient de noter que dans la liste des comp√©tences du catalogue, seule l'ic√¥ne et la phrase d'activation sont affich√©es, et la recherche dans le catalogue s'effectue principalement en fonction de la description. <br><br><h3>  Obtenir un crochet Web </h3><br>  Un hook Web est l'adresse o√π Alice enverra des messages √† votre comp√©tence et attendra une r√©ponse JSON dans le format d√©crit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/za/zy/4t/zazy4tve59hnchb4quwuokqv6ju.png"></div><br><br>  L'application Web cr√©√©e sur Apps Script renvoie une r√©ponse sous la forme d'une page html par d√©faut, mais en utilisant ContentService, elle peut √©galement √™tre forc√©e de renvoyer JSON: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ContentService.createTextOutput(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">JSON</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml">)) .setMimeType(ContentService.MimeType.JSON);</span></span></code> </pre> <br>  Cependant, lors de l'utilisation de ContentService, Google redirige la demande de l'utilisateur vers une URL temporaire, √† laquelle Yandex.Dialogs n'est pas pr√™t.  Par cons√©quent, l'adresse de l'application Web en tant que hook Web n'est pas appropri√©e. <br><br>  Il existe des services gratuits qui offrent un crochet Web adapt√© √† Alice, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme Zenbot</a> .  Dans Zenbot, pour le jeu propos√©, vous pouvez √©crire un court script qui acc√®de √† une application Web Google et renvoie une r√©ponse ainsi que des boutons.  Soit dit en passant, de cette fa√ßon, le jeu peut √™tre int√©gr√© non seulement avec Alice, mais aussi avec d'autres canaux. <br><br>  Voici un exemple de script qui fournit le jeu ¬´Un, deux, trois!¬ª  dans le bot Telegram @RazDvaTriBot: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Text"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">var</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Utterance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scope</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">get</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://script.google.com/macros/s/&lt;id -&gt;/exec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">var</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Result"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"userId"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$req_telegram_chat"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utterance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Utterance"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"channel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"telegram"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">get</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">var</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Answer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'javascript: $Result.text'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Answer"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sample</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sample</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Pour une plus grande flexibilit√© dans le traitement des demandes, vous pouvez √©crire votre propre serveur en utilisant, par exemple, Google App Engine.  Cet outil peut √©galement √™tre utilis√© gratuitement. <br><br>  Apr√®s avoir cr√©√© un projet dans Google App Engine, l'interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cloud Shell</a> vous permet d'√©crire le code du serveur sur une page Web et de le d√©ployer √† l'URL souhait√©e du formulaire https: // &lt;id projet&gt; .appspot.com, qui sera l'adresse du hook Web. <br><br>  Le fonctionnement du serveur comprend les √©tapes suivantes: <br><br><ol><li>  recevoir les donn√©es de demande d'Alice; </li><li>  interaction avec l'application Web du jeu; </li><li>  envoyer une r√©ponse au format d'Alice. </li></ol><br><h4>  Recevoir / envoyer des donn√©es Alice </h4><br>  D'Alice, il est important d'obtenir les identifiants de la session, de l'utilisateur, du message, ainsi que le texte de la demande.  Voici un exemple en PHP: <br><br><pre> <code class="php hljs"> $data = json_decode(file_get_contents(<span class="hljs-string"><span class="hljs-string">"php://input"</span></span>)); $session_id = $data-&gt;session-&gt;session_id; $user_id = $data-&gt;session-&gt;user_id; $utterance = $data-&gt;request-&gt;original_utterance; $messageId = $data-&gt;session-&gt;message_id;</code> </pre><br>  En guise de r√©ponse, des boutons et des textes d'indication sont renvoy√©s au jeu pour l'affichage et la prononciation: <br><br><pre> <code class="php hljs"> $button1 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1Ô∏è‚É£ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $button2 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'2Ô∏è‚É£ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $button3 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3Ô∏è‚É£ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $yaButtons = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($button1, $button2, $button3); $yaResponse = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'text'</span></span> =&gt; $text, <span class="hljs-string"><span class="hljs-string">'tts'</span></span> =&gt; $tts, <span class="hljs-string"><span class="hljs-string">'buttons'</span></span> =&gt; $yaButtons, <span class="hljs-string"><span class="hljs-string">'end_session'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $yaSession = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'session_id'</span></span> =&gt; $session_id, <span class="hljs-string"><span class="hljs-string">'message_id'</span></span> =&gt; $messageId, <span class="hljs-string"><span class="hljs-string">'user_id'</span></span> =&gt; $user_id); $yaResult = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'response'</span></span> =&gt; $yaResponse, <span class="hljs-string"><span class="hljs-string">'session'</span></span> =&gt; $yaSession, <span class="hljs-string"><span class="hljs-string">'version'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1.0'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($yaResult);</code> </pre><br><h2>  Trois!  Sync </h2><br>  L'envoi / r√©ception de donn√©es √† partir d'une application Web prend du temps, et Alice est impatiente de donner une r√©ponse √† l'utilisateur, donc les probl√®mes de synchronisation interf√®rent avec le probl√®me. <br><br>  Naturellement, pour les grands projets, les feuilles de calcul Google ne conviennent pas comme backend pour les comp√©tences d'Alice: le temps de r√©ponse augmente avec un grand nombre de demandes parall√®les.  N√©anmoins, il existe des recommandations pour l'optimisation du chatbot, qui permettent de rendre un petit projet viable dans un syst√®me de dialogue interactif en temps r√©el. <br><br>  D√©lai d'expiration du protocole synchrone d'Alice - 1,5 seconde par r√©ponse.  Si le serveur n'a pas le temps de r√©pondre pendant cette p√©riode, l'utilisateur voit un triste message dans l'esprit ¬´D√©sol√©, &lt;nom du dialogue&gt; ne r√©pond pas¬ª.  Le syst√®me ne donne aucun indice sur la marche √† suivre. <br><br>  Pour √©viter une telle situation, vous pouvez et devez acc√©l√©rer le service, ainsi que suivre et traiter les d√©lais.  Les op√©rations les plus longues pendant le fonctionnement du script de jeu sont la lecture et l'√©criture de donn√©es de table.  Par cons√©quent, d'une part, le nombre de ces op√©rations doit √™tre minimis√©, et d'autre part, il est souhaitable de les parall√©liser. <br><br>  Lisez suffisamment les donn√©es du tableau.  Apr√®s avoir ex√©cut√© la logique, le script est pr√™t √† donner √† l'utilisateur une r√©ponse imm√©diatement, avant la fin de l'enregistrement des r√©sultats. <br><br>  Un temps limit√© doit √™tre accord√© pour recevoir une r√©ponse - par exemple, 1100 ms: <br><br><pre> <code class="php hljs"> $request_params = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'userId'</span></span> =&gt; $user_id, <span class="hljs-string"><span class="hljs-string">'utterance'</span></span> =&gt; $utterance, <span class="hljs-string"><span class="hljs-string">'channel'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'alice'</span></span> ); $get_params = http_build_query($request_params); $ctx = stream_context_create(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>=&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'timeout'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1.1</span></span> ) )); $answer = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://script.google.com/macros/s/&lt;id -&gt;/exec?'</span></span>. $get_params, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, $ctx);</code> </pre><br>  Si la r√©ponse est re√ßue par la requ√™te GET √† temps, nous pouvons l'envoyer √† l'utilisateur et lancer l'enregistrement des r√©sultats par la requ√™te POST en arri√®re-plan.  Sinon, nous donnons √† l'utilisateur un stub avec des boutons pour continuer et ignorons les r√©sultats du script afin que l'utilisateur puisse r√©p√©ter sa demande dans le contexte actuel. <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($answer === <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) { $text = <span class="hljs-string"><span class="hljs-string">' ,   .'</span></span>; $tts = <span class="hljs-string"><span class="hljs-string">',   .'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $answer = json_decode($answer); $text = $answer-&gt;text; $tts = $answer-&gt;tts; <span class="hljs-comment"><span class="hljs-comment">//   $data2store = $answer-&gt;data; $postdata = json_encode(array( 'data' =&gt; $data2store )); $opts = array('http' =&gt; array( 'method' =&gt; 'POST', 'header' =&gt; 'Content-Type: application/json', 'content' =&gt; $postdata, 'timeout' =&gt; 0.1 ) ); $context = stream_context_create($opts); file_get_contents("https://script.google.com/macros/s/&lt;id -&gt;/exec", false, $context); }</span></span></code> </pre><br><img src="https://habrastorage.org/webt/a1/ez/od/a1ezodgm9tqdt2gudd7vfes9bn0.png" width="320" align="right"><br>  Dans un jeu multijoueur pour Alice, les t√¢ches de synchronisation doivent √™tre r√©solues √† la fois entre les serveurs de jeu et Yandex, et entre les joueurs.  Si un joueur veut jouer contre un autre utilisateur, le jeu lui-m√™me s√©lectionne un adversaire - parmi ceux qui voulaient jouer r√©cemment.  Les utilisateurs doivent confirmer leur volont√© de jouer ensemble pour que le jeu commence. <br><br>  Actuellement, la comp√©tence ne peut pas lancer l'envoi d'un message √† l'utilisateur d'Alice.  Par cons√©quent, le script du jeu pr√©voit de v√©rifier l'√©tat de pr√©paration de l'adversaire et les minutes allou√©es pour le tour de jeu.  Si l'adversaire retarde la partie, l'utilisateur est invit√© √† l'attendre: "Attendre un peu plus l'adversaire?"  En acceptant d'attendre, l'utilisateur lance une autre v√©rification.  Si la minute du jeu se termine, le jeu se termine. <br><br><h2>  Conclusion </h2><br>  Les avantages de Google Sheets en tant que backend pour un chat bot, sauf gratuitement, incluent le fait qu'il s'agit d'un outil de d√©bogage pendant le d√©veloppement, et apr√®s cela, il devient une console d'administrateur de comp√©tences avec tous les plaisirs de l'√©dition collaborative √† partir de n'importe quel appareil.  Par contre - retards dans le fonctionnement simultan√© d'un grand nombre d'utilisateurs. <br><br clear="right">  J'esp√®re que cet article aide les passionn√©s et les d√©veloppeurs √† cr√©er rapidement des comp√©tences utiles pour Alice ou d'autres cha√Ænes.  Le jeu propos√© est disponible dans le magasin de comp√©tences Yandex.Dialog appel√© ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">One, Two, Three!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jeu multijoueur</a> . " <br><br>  En plus des outils √† usage g√©n√©ral, il existe des solutions sp√©cialis√©es pour le d√©veloppement de chat bots.  J'invite les lecteurs √† participer √† une petite enqu√™te sur les services que je connais dans ce domaine.  La liste ne comprenait pas tous les produits existants - je serai reconnaissant pour les commentaires avec des noms et de courtes critiques si vous avez utilis√© d'autres outils. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr414213/">https://habr.com/ru/post/fr414213/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr414201/index.html">Code divin (code de DIEU)</a></li>
<li><a href="../fr414203/index.html">Arnaque ou non arnaque? Nous v√©rifions ICO par cinq m√©thodes</a></li>
<li><a href="../fr414207/index.html">Le probl√®me de l'innovateur, ou pourquoi vous devez vous tourner vers l'exp√©rience des autres</a></li>
<li><a href="../fr414209/index.html">IGNG - Algorithme incr√©mental incr√©mental de gaz neuronal</a></li>
<li><a href="../fr414211/index.html">D√©veloppement d'un serveur TELNET bas√© sur W5500 et ATMEGA8</a></li>
<li><a href="../fr414215/index.html">Blocs personnalis√©s dans les puces (Silicon IP): comment cela fonctionne</a></li>
<li><a href="../fr414217/index.html">Smartphones locaux Vertex: premiers en qualit√©, premiers en puces, premiers en design</a></li>
<li><a href="../fr414219/index.html">L'exp√©rience de l'utilisation de l'√©nergie solaire dans la r√©gion de Moscou: pour, contre et qui en a besoin</a></li>
<li><a href="../fr414221/index.html">Analyser et travailler avec Codable dans Swift 4</a></li>
<li><a href="../fr414223/index.html">C #: compatibilit√© descendante et surcharge</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>