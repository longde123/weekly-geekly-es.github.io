<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🍳 🏾 🥒 项目构建时间优化 🍮 🛍️ 👩🏿‍⚕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在我工作的地方（在启动Spot.IM中 ，它的大小在中小型之间），Webpack用于构建各种项目。 在对我们的主要产品进行了4年的努力之后，当有太多人为它的代码做出贡献而无法计算时，其初始组装时间达到了90秒，而重新组装的时间达到了14。 

 每次单击“保存”按钮后，大约需要等待14秒。 

 借...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>项目构建时间优化</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/484612/"> 在我工作的地方（在启动<a href="https://www.spot.im/">Spot.IM中</a> ，它的大小在中小型之间），Webpack用于构建各种项目。 在对我们的主要产品进行了4年的努力之后，当有太多人为它的代码做出贡献而无法计算时，其初始组装时间达到了90秒，而重新组装的时间达到了14。 <br><br> 每次单击“保存”按钮后，大约需要等待14秒。 <br><br> 借助一些简单的优化（例如任何人都可以在他们的项目中应用），我们能够将上述数字减少到20秒（组装）和1秒（重建项目）。 <br><br> <a href="https://habr.com/ru/company/ruvds/blog/484612/"><img src="https://habrastorage.org/webt/d9/jb/sc/d9jbscezozngccwtdz8pkqlvmh8.png"></a> <br><br> 在本文中，我想谈谈一些简单的更改，使项目可以大大缩短其组装时间。 请注意，如果您使用<a href="https://github.com/facebook/create-react-app">CreateReactApp</a> （或其他一些流行的应用程序生成器），那么本文可能对您并不是特别有用。 但是，如果您不使用任何类似方法，那么此处所讨论的内容可能对您非常有用。 <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">测量构建项目所花费的时间</font> </h2><br> 在进行任何类型的优化之前，让我们建立一个指标度量标准，通过它我们可以判断工作结果。 为此，请使用包<a href="https://www.npmjs.com/package/speed-measure-webpack-plugin">speed-measure-webpack-plugin</a> （SMP）： <br><br><pre><code class="plaintext hljs">const webpackConfig = require('./webpack.config') const SpeedMeasurePlugin = require('speed-measure-webpack-plugin') const smp = new SpeedMeasurePlugin({   disable: !process.env.MEASURE, }) module.exports = smp.wrap(webpackConfig)</code> </pre> <br> 我们将Webpack配置文件放入SMP包装器中（启动使用环境变量进行性能测量的机制），然后传递Webpack配置对象。 之后，我们可以使用一份令人愉悦的报告，该报告使我们能够了解构建过程中每个引导加载程序完成所需的时间。 使用SMP，我们可以获得双重好处。 首先，在进行了一定的改进之后，我们可以立即了解它如何影响项目的构建时间。 其次，我们可以立即获得一份完整的报告，以了解每个引导加载程序所花费的时间（或更准确地说，是“引导加载程序链”）。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f15/e08/8ee/f15e088ee6791f9b4cc0d2449773cf10.png"></div><br>  <i><font color="#999999">使用speed-measure-webpack-plugin生成的报告</font></i> <br><br><h2>  <font color="#3AC1EF">缩短项目的初始构建时间</font> </h2><br> 在开始使用SMP之后，我们获得了有关在改进构建过程时项目的构建时间如何变化的信息。 我们开始优化的第一件事是初始构建时间（即Webpack在初始化之后构建软件包所花费的时间）。 为了加快初始构建过程，我们决定使用<code>cache-loader</code> bootloader。 <br><br>  <a href="https://github.com/webpack-contrib/cache-loader">Cache-loader</a>是一种加载程序，它会将其后的加载程序的工作结果缓存并保存到磁盘（或数据库）中。 这意味着下次启动Webpack时，可以看到构建速度有了显着提高，或者至少可以希望如此。 <br><br> 这是一个例子： <br><br><pre> <code class="plaintext hljs">{  rules: [    {      test: /\.jsx?$/,      use: [        'cache-loader',        'babel-loader',      ],    },    {      test: /\.scss$/,      use: [        'style-loader',        'cache-loader',        'css-loader',        'postcss-loader',        'sass-loader',      ],    },  ] }</code> </pre> <br> 在<a href="https://www.npmjs.com/package/css-loader">css-loader</a> （对于CSS）之前和<a href="https://www.npmjs.com/package/babel-loader/">babel-loader</a> （对于JS）之前添加<code>cache-loader</code> ，可以使我们从项目的初始构建时间中节省大约75秒。 <br><br> 现在让我们开始重新组装。 我们将尝试通过更改<code>devtool</code>属性来改善这一时间。 <br><br><h2>  <font color="#3AC1EF">Webpack代码卡</font> </h2><br> 在Webpack设置中，您可以找到<a href="https://webpack.js.org/configuration/devtool/">devtool</a>属性，根据文档所述，该属性“使您可以选择创建用于改进调试功能的代码卡的样式。 设定点会极大地影响组装和重新组装的速度。” <br><br> 换句话说，修改<code>devtool</code>属性会影响在构建项目后开发人员可以使用哪个代码卡。 而这又取决于创建这种代码卡所花费的时间。 <br><br> 具有此属性的实验来自于现场，可以永久改变程序员的寿命。 这对项目的构建速度有很大的影响。 也就是说，我们将<code>devtool</code>值从<code>source-map</code> （可能是最慢的模式）更改为<code>eval-source-map</code>并且能够将项目重组时间从14秒减少到3.5秒： <br><br><pre> <code class="plaintext hljs">{  devtool: process.env.NODE_ENV === 'development'    ? 'eval-source-map'    : 'source-map' }</code> </pre> <br>  <code>devtool</code>属性可以接受12个值的变体。 例如，CreateReactApp使用<a href="">cheap-module-source-map</a> 。 因此，如果要配置此属性，请进行实验并找到最适合您的值。 <br><br> 应当注意，当使用快速方法来创建代码卡时，所得到的卡的质量会下降。 通过启动调试可以感觉到这些恶化。 幸运的是，现代浏览器紧随TC39。 结果（至少在开发过程中）真正不需要大量代码的转译。 如果配置Babel以便此工具将JavaScript传输到浏览器的最新版本可以理解的水平（如<a href="">CRA中</a>所做的那样），则使用代码调试一切都应该没问题，因为代码映射与代码本身不会有太大差异。 <br><br> 如果您决定将代码转置为各种浏览器的最新版本都清楚的状态，则<code>babel.config.js</code>外观应如下所示： <br><br><pre> <code class="plaintext hljs">module.exports = {  presets: [    [      '@babel/preset-env',      {        targets: [          'last 1 chrome version',          'last 1 safari version',          'last 1 firefox version',        ].join(', '),      },    ],  ],  // ... }</code> </pre> <br> 仅此而已。 三个简单的步骤，大大减少了我们项目的构建时间。 <br><br> 我想指出，一个开始解决类似问题的人可能希望首先阅读Webpack文档并正确阅读。 但是，这不是唯一的知识来源。 <br><br> 我找到了另一种方法来查找有关构建项目的有价值的信息。 这种方法已经在实践中证明了自己。 它包括分析现有开源项目的<code>webpack.config</code>文件。 特别是<a href="">CreateReactApp</a>项目文件。 彻底阅读此文件，您会发现很多有用的东西。 <br><br><h2>  <font color="#3AC1EF">总结</font> </h2><br> 细心的读者可能会注意到，从一开始，这就是将重新组装时间减少到1秒的问题。 文中提到的该指标的最佳值为3.5秒。 显然，在描述装配过程的优化进度时，省略了一些内容。 就是这样 得益于微妙的优化，这又有可能使项目重新组装的时间缩短到1秒，这又是2.5秒，这很大程度上取决于特定项目（即Spot.IM）的功能。 因此，这里不提供这些改进的描述。 <br><br>  <b>亲爱的读者们！</b> 您是否优化了项目的构建时间？ <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN484612/">https://habr.com/ru/post/zh-CN484612/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN484596/index.html">Blazor客户端在线商店：第1部分-授权oidc（oauth2）+ Identity Server4</a></li>
<li><a href="../zh-CN484600/index.html">Microsoft点燃巡回布拉格技术会议</a></li>
<li><a href="../zh-CN484602/index.html">书籍“在iOS和Android中使用C＃开发移动应用程序”</a></li>
<li><a href="../zh-CN484604/index.html">新年，新浏览器：Microsoft Edge超出初步评估，现在可以下载</a></li>
<li><a href="../zh-CN484610/index.html">再见干净的代码</a></li>
<li><a href="../zh-CN484614/index.html">开发安全Go应用程序的6条建议</a></li>
<li><a href="../zh-CN484616/index.html">从Node.js服务性能优化经验中学到的6课</a></li>
<li><a href="../zh-CN484618/index.html">Angular 9和Ivy：惰性组件加载</a></li>
<li><a href="../zh-CN484620/index.html">适用于Omega Red Emulator的新PS1图形渲染器</a></li>
<li><a href="../zh-CN484624/index.html">间隔禁食和Lifext寿命延长模式</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>