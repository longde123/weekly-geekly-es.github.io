<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš” ğŸ‘©ğŸ¿â€ğŸ¤ ğŸ‘©ğŸ½â€ğŸ“ Comment j'ai crÃ©Ã© des cartes des continents pour mon jeu ğŸ‘¨ğŸ» ğŸ§’ğŸ» ğŸ¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Partie 1. SVG et systÃ¨mes de coordonnÃ©es 
 Jusqu'Ã  rÃ©cemment, les tailles de carte dans mon jeu Dragons Abound Ã©taient fixes et quelque peu non dÃ©term...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment j'ai crÃ©Ã© des cartes des continents pour mon jeu</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429620/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png" alt="image"></div><br><h2>  Partie 1. SVG et systÃ¨mes de coordonnÃ©es </h2><br>  Jusqu'Ã  rÃ©cemment, les tailles de carte dans mon jeu <i>Dragons Abound</i> Ã©taient fixes et quelque peu non dÃ©terministes.  Je les considÃ©rais comme Â«rÃ©gionalesÂ» - pas des cartes du monde entier, mais ses parties importantes, comme, par exemple, la cÃ´te ouest des Ã‰tats-Unis ou une partie de l'Europe.  J'Ã©tais assez satisfait de cette Ã©chelle, mais je voulais expÃ©rimenter un peu avec le jeu pour voir si je pouvais gÃ©nÃ©rer des cartes du monde entier (ou au moins une plus grande).  Mais avant de commencer, parlons un peu des cartes du monde fantastique. <br><br>  Le monde est un grand espace.  La plupart des cartes Â«mondeÂ» fantastiques ne ressemblent mÃªme pas Ã  la vraie taille.  Prenons, par exemple, la Terre du Milieu, dans laquelle se dÃ©roule l'action du Seigneur des Anneaux: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90f/bc8/9f3/90fbc89f36ab284a974be18c66909558.jpg"></div><br>  Bien qu'il semble qu'un immense monde y soit capturÃ©, en fait, la Terre du Milieu a Ã©tÃ© crÃ©Ã©e sur la base de l'Europe. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a0/e6d/d95/7a0e6dd9576841e7ecf87babf2a66b93.webp"></div><br>  Autrement dit, la vraie carte du Â«mondeÂ» pour le monde de Tolkien sera environ 50 fois plus grande que la carte de la Terre du Milieu (!).  En fait, la plupart des cartes du monde fantastique que j'ai vues reflÃ¨tent un territoire de la taille d'un continent: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c95/17a/90e/c9517a90ef51440cda257b2300ba591e.png"></div><br>  Cela semble Ãªtre la plus grande zone bien visualisÃ©e dans un style de carte fantastique. <br><br>  Autrement dit, la tÃ¢che de gÃ©nÃ©rer de vÃ©ritables Â«cartes du mondeÂ» est probablement trop ambitieuse.  Il vaut mieux viser Ã  crÃ©er une carte du continent (ou d'une partie du continent).  (Cependant, il est encore plus pratique de considÃ©rer la carte comme la taille du "monde".) Alors, quelle taille doit avoir la carte?  Si les <i>cartes Dragons Abound</i> actuelles ont une taille Â«subcontinentaleÂ», nous pouvons supposer que vous devez gÃ©nÃ©rer des cartes 8 Ã  10 fois plus grandes. <br><br>  Avant de passer Ã  la tÃ¢che de gÃ©nÃ©rer de grandes cartes, je dois mieux comprendre les diffÃ©rents systÃ¨mes de coordonnÃ©es utilisÃ©s dans mon jeu.  J'ai empruntÃ© beaucoup de systÃ¨mes de coordonnÃ©es au code source de Martin O'Leary, et leurs interactions peuvent Ãªtre dÃ©routantes mÃªme lorsque vous travaillez avec eux pendant deux ans.  Habituellement, je pouvais le faire sans les expÃ©rimenter, mais il est Ã©vident que je devrai le faire pour gÃ©nÃ©rer de grandes cartes. <br><br>  Pour commencer, le Â«mondeÂ» de la carte rÃ©gionale est en cours de gÃ©nÃ©ration dans un carrÃ© unitaire.  Chaque carte rÃ©gionale a des coordonnÃ©es de (-0,5, -0,5) Ã  (0,5, 0,5), et l'origine (0,0) se trouve au milieu de la rÃ©gion. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/201/c65/c30/201c65c30244efe1e6cd4bd47e07b901.png"></div><br>  L'une des bizarreries ici est que l'axe Y est inversÃ© par rapport Ã  ce que nous avons Ã©tudiÃ© en gÃ©omÃ©trie scolaire.  -0,5 est en haut de la carte et 0,5 en bas.  En infographie, l'axe Y est souvent inversÃ©.  J'ai entendu que cela s'explique par la faÃ§on dont les premiers moniteurs (tÃ©lÃ©viseurs) ont effectuÃ© un balayage de haut en bas, c'est-Ã -dire que la premiÃ¨re ligne de balayage Ã©tait en haut, la suivante immÃ©diatement en dessous, et ainsi de suite, c'est-Ã -dire que l'index Y des lignes de balayage est passÃ© de zÃ©ro en haut Ã  un certain nombre positif en bas.  Quoi qu'il en soit, le mÃªme systÃ¨me de coordonnÃ©es est utilisÃ© au format SVG (Scalable Vector Graphics), c'est pourquoi <i>Dragons Abound</i> aussi. <br><br>  Ce systÃ¨me de coordonnÃ©es est indÃ©pendant de la faÃ§on dont la carte est affichÃ©e.  C'est juste un systÃ¨me sans dimension pour crÃ©er le monde - la ville est situÃ©e Ã  (0,12875, -0,223), la frontiÃ¨re passe de (0,337, 0,010) Ã  (0,333, 0,017), etc.  Et bien que mes cartes rÃ©gionales actuelles soient limitÃ©es Ã  une plage de 0,5 Ã  -0,5, ce n'est pas la limite du systÃ¨me de coordonnÃ©es.  Je peux crÃ©er un monde au-delÃ  de ces frontiÃ¨res. <br><br>  Le prochain systÃ¨me de coordonnÃ©es est ce que SVG appelle viewbox.  Il dÃ©finit les vraies coordonnÃ©es qui seront utilisÃ©es pour dessiner les graphiques.  Par exemple, <i>Dragons Abound</i> au dÃ©but dÃ©finit la zone de visualisation sur les coordonnÃ©es (-500, -500) et elle a une largeur de 1000 et une hauteur de 1000: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/509/4f4/e4f/5094f4e4f04889dcc9f389fba59d2b24.png"></div><br>  (Il y a une faute de frappe dans l'image, le haut de l'axe Y doit Ãªtre -500, dÃ©solÃ©.) <br><br>  Vous pouvez remarquer que dans ce cas, la transformation entre le premier et le deuxiÃ¨me systÃ¨me de coordonnÃ©es consiste uniquement Ã  multiplier le tout par 1000. C'est-Ã -dire.  afin de dessiner quelque chose, le jeu trouve les coordonnÃ©es de cet objet, les multiplie par 1000 et dessine SVG dans ces coordonnÃ©es. <br><br>  Autrement dit, je peux utiliser les coordonnÃ©es de la fenÃªtre d'affichage pour me permettre de tracer une ligne de (0, 0) Ã  (250, 250).  Mais en fait, je ne veux pas tracer une ligne de (0, 0) Ã  (250, 250) sur l'Ã©cran de l'ordinateur.  Cela signifierait que si je veux afficher la carte Ã  un autre endroit de l'Ã©cran, je devrai changer les coordonnÃ©es de tous les objets de la carte et les redessiner.  Ce serait un travail Ã©norme. <br><br>  Pour contrÃ´ler les coordonnÃ©es d'affichage des graphiques Ã  l'Ã©cran, SVG dispose d'un troisiÃ¨me systÃ¨me de coordonnÃ©es appelÃ© viewport.  La fenÃªtre d'affichage est la partie de la page dans laquelle les graphiques doivent Ãªtre dessinÃ©s (sur la page Web, il s'agit de l'Ã©lÃ©ment &lt;svg&gt;).  Il a une largeur, une hauteur et un emplacement.  L'emplacement correspond aux coordonnÃ©es du coin supÃ©rieur gauche de la fenÃªtre.  Autrement dit, si je devais afficher la carte dans la fenÃªtre avec les coordonnÃ©es (30, 100), qui a une hauteur et une largeur de 800, le systÃ¨me de coordonnÃ©es de la fenÃªtre ressemblerait Ã  ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/746/73e/f51/74673ef51f001d21b7871382c5dc0638.png"></div><br>  Dans SVG, la boÃ®te de vue et la fenÃªtre des systÃ¨mes de coordonnÃ©es sont connectÃ©es l'une Ã  l'autre, et SVG s'occupe lui-mÃªme de la transition entre elles.  Nous dessinons simplement dans le systÃ¨me de coordonnÃ©es de la fenÃªtre d'affichage et tout le rendu est affichÃ© Ã  l'emplacement de la fenÃªtre correspondante.  (Il y a quelques problÃ¨mes lors de la crÃ©ation d'une fenÃªtre et d'une fenÃªtre avec des proportions diffÃ©rentes. Ensuite, les objets sont soit tronquÃ©s, soit Ã©tirÃ©s, selon la valeur de l'attribut <code>preserveAspectRatio</code> . Je recommande de ne pas le faire du tout.) <br><br>  Pour rÃ©sumer: une ville situÃ©e dans les coordonnÃ©es mondiales (0,10, 0,33) est dessinÃ©e en coordonnÃ©es (100, 330) et affichÃ©e Ã  l'Ã©cran en (110, 764). <br><br>  Vous pouvez maintenant comprendre pourquoi cela peut prÃªter Ã  confusion! <br><br>  Que se passe-t-il si je modifie chacun de ces systÃ¨mes de coordonnÃ©es?  Supposons que dans le premier systÃ¨me de coordonnÃ©es, je vais gÃ©nÃ©rer un monde allant de -0,25 Ã  0,25 sur chaque axe.  Le monde rÃ©sultant sera alors quatre fois plus petit que le monde habituel et ne remplira que la partie centrale de la fenÃªtre: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/894/11c/6c2/89411c6c2b1975f8512548a487191648.png"></div><br>  (Vous pouvez Ã©galement remarquer des artefacts sur les bords, qui sont gÃ©nÃ©ralement cachÃ©s.) De mÃªme, si je double la taille du premier systÃ¨me de coordonnÃ©es (SK), nous ne verrons pas la majeure partie de la carte, car elle sera situÃ©e Ã  l'extÃ©rieur des bords de la fenÃªtre. <br><br>  Que se passe-t-il si je double la taille de la fenÃªtre d'affichage?  Eh bien, si je double Ã©galement le rapport entre le premier SC et la viewbox (de 1000 Ã  2000), alors rien ne changera beaucoup.  Si le rapport reste Ã©gal Ã  1000, la carte sera Ã  nouveau divisÃ©e par deux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/859/f79/dfe/859f79dfe453741087cedce2d6918e16.png"></div><br>  Cependant, cette fois, la carte a une zone initiale de 1x1.  Nous pouvons Ã  nouveau remarquer des artefacts aux bords qui sont gÃ©nÃ©ralement cachÃ©s (par exemple, des parties convexes de forÃªts).  Vous pouvez Ã©galement voir que le modÃ¨le de l'ocÃ©an est incorrect - je dois avoir cÃ¢blÃ© certaines hypothÃ¨ses sur la taille de la fenÃªtre d'affichage.  De plus, il semble que la boussole ne se trouve pas sur le coin de la carte, mais sur le coin de la fenÃªtre d'affichage. <br><br>  Et vice versa, si je rÃ©duis de moitiÃ© la taille de la fenÃªtre d'affichage, cela crÃ©era un effet de zoom sur la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26e/f0e/f8e/26ef0ef8e0a2db5298de4720d12193fe.png"></div><br>  Ici, nous ne voyons que le quart mÃ©dian de la carte.  Ce n'est pas un moyen trÃ¨s pratique de zoomer, car seule la moitiÃ© de la carte affiche des problÃ¨mes - par exemple, le marqueur de ville Â«South OwensonÂ» est allÃ© au-delÃ  de l'Ã©cran.  De plus, cela double la taille des polices et d'autres choses dont je n'ai pas besoin. <br><br>  Un aspect plus utile de la fenÃªtre d'affichage est de modifier l'origine.  Jusqu'Ã  prÃ©sent, la fenÃªtre d'affichage Ã©tait centrÃ©e sur la carte, mais ce n'est pas nÃ©cessaire.  Par exemple, je peux dÃ©placer la carte vers la droite en centrant la fenÃªtre d'affichage sur un point sur le cÃ´tÃ© gauche de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/970/bbf/662/970bbf662eb73852a4140af450c48fb8.png"></div><br>  Nous pouvons Ã  nouveau remarquer les effets sur les frontiÃ¨res et certains autres problÃ¨mes, mais essentiellement la carte s'est dÃ©placÃ©e vers la droite.  L'utilitÃ© de cela peut ne pas Ãªtre Ã©vidente, mais imaginez que je vais gÃ©nÃ©rer une carte dont la largeur est le double de la largeur d'une carte normale.  Par dÃ©faut, cela ressemble Ã  ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/fee/3ad/327fee3add9790b0a73a32d7e1ee04cf.png"></div><br>  Cela ressemble Ã  n'importe quelle autre carte, mais en rÃ©alitÃ© ce n'est que la partie centrale d'une carte plus grande.  Autrement dit, je peux maintenant modifier la fenÃªtre d'affichage pour transfÃ©rer d'autres parties de la carte dans la fenÃªtre de vue d'ensemble: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png"></div><br>  Ici, j'ai dÃ©placÃ© le point de vue vers la gauche, nous voyons donc une partie du monde Ã  l'est de la vue d'origine.  Certains noms sur la carte ont changÃ© car <i>Dragons Abound</i> remplit certaines fonctions (par exemple, donne des noms aux objets) selon qu'ils sont visibles.  Je vais devoir changer cela pour que lors du dÃ©placement de la fenÃªtre d'affichage, la carte reste constante.  Cependant, plus tard, je pourrai dÃ©placer la fenÃªtre d'affichage sur une grande carte et gÃ©nÃ©rer des cartes rÃ©gionales de toute zone souhaitÃ©e.  Autrement dit, je peux gÃ©nÃ©rer et afficher de grandes cartes de la taille d'un continent, mais je peux Ã©galement gÃ©nÃ©rer des cartes rÃ©gionales de zones au sein d'une grande carte. <br><br>  Pour rÃ©sumer: le jeu utilise trois systÃ¨mes de coordonnÃ©es.  Le premier est un SC abstrait pour les objets du monde.  La seconde est la fenÃªtre de visualisation, elle dÃ©finit la zone visible du monde.  La troisiÃ¨me est la fenÃªtre, elle contrÃ´le oÃ¹ la carte sera dessinÃ©e Ã  l'Ã©cran.  Pour dessiner un monde plus grand, j'ai besoin d'Ã©tendre le premier SC.  Pour afficher plus Ã  l'Ã©cran, vous devez agrandir la fenÃªtre d'affichage.  Je peux Ã©galement dÃ©placer la fenÃªtre d'affichage pour afficher diffÃ©rentes parties du grand monde. <br><br><h2>  Partie 2. Rendre les cartes permanentes </h2><br>  Dans la partie prÃ©cÃ©dente, j'ai explorÃ© les systÃ¨mes de coordonnÃ©es et appris Ã  dÃ©placer la fenÃªtre SVG pour n'afficher que des parties individuelles du grand monde.  Cependant, cette approche a quelques problÃ¨mes, car plus tÃ´t j'ai supposÃ© que tout ce qui nous Ã©tait invisible n'a pas d'importance.  Dans cette partie, je vais Ã©liminer ces hypothÃ¨ses afin qu'il soit possible de gÃ©nÃ©rer et de visualiser diffÃ©rentes parties de grandes cartes immuables. <br><br>  Le problÃ¨me du placement des noms, que j'ai dÃ©crit dans la partie prÃ©cÃ©dente, est Ã©videmment perceptible sur ces deux types de carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/fee/3ad/327fee3add9790b0a73a32d7e1ee04cf.png"></div><br>  Voici le mÃªme monde, seule la vue est dÃ©calÃ©e vers la gauche: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png"></div><br>  Vous remarquerez peut-Ãªtre que la gÃ©ographie est la mÃªme, mais de nombreux noms ont changÃ©.  Ã‰tant donnÃ© que dans deux types diffÃ©rents objets sont visibles et que le processus de crÃ©ation de noms est contrÃ´lÃ© par des nombres alÃ©atoires, des noms diffÃ©rents sont obtenus. <br><br>  En regardant le code, j'ai constatÃ© que presque tous les objets sont nommÃ©s en fonction de leur visibilitÃ©.  Mais il n'y a qu'une seule exception qui rend difficile de donner des noms Ã  tous les objets suivants.  Dans notre cas, l'exception est que <i>Dragons Abound</i> ne gÃ©nÃ¨re que des cÃ´tes visibles.  Les raisons de cela sont trÃ¨s dÃ©routantes.  En fait, il y a un Â«littoralÂ» le long du bord entier du monde, mais la crÃ©ation de cette ligne dÃ©truit une partie de la logique du programme, car elle embrasse le monde entier.  Pour Ã©viter cela, je viens de gÃ©nÃ©rer uniquement le littoral visible.  Maintenant que la carte peut s'Ã©tendre bien au-delÃ  de la fenÃªtre, cette solution ne semble pas bonne.  Au lieu de cela, je dois arrÃªter de gÃ©nÃ©rer des cÃ´tes lorsque je me rapproche du bord rÃ©el de la carte.  (Ce que je laisse toujours hors Ã©cran pour masquer les problÃ¨mes sur les bords.) <br><br>  AprÃ¨s avoir Ã©liminÃ© ce problÃ¨me, les noms sur les deux cartes restent constants: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/39b/908/a83/39b908a83146f3161397cda6fbcba045.png"></div><br>  et: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6af/322/ad4/6af322ad4cb57591a51748243a8ac02e.png"></div><br>  Autre remarque pour l'avenir: si j'utilise la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonction d'interactivitÃ©</a> pour changer les noms des objets de carte, ce changement ne sera pas recrÃ©Ã© sous sa forme actuelle, et ne sera probablement mÃªme pas reproductible.  Ã‡a vaut la peine dâ€™y penser. <br><br>  Si vous regardez attentivement la carte prÃ©cÃ©dente, vous pouvez voir que la zone ocÃ©anique prÃ¨s de la partie centrale infÃ©rieure de la carte a une Ã©tiquette suspendue Â«Meb IslandÂ».  Cela est arrivÃ© parce que <i>Dragons Abound</i> croit rÃ©ellement que la rÃ©gion de l'ocÃ©an est une Ã®le.  Je n'entrerai pas dans les dÃ©tails techniques, mais il est Ã©tonnamment difficile de distinguer les Ã®les des lacs lorsqu'ils dÃ©passent la carte.  L'algorithme porte Ã  confusion avec le changement que j'ai apportÃ© Ã  la gÃ©nÃ©ration de cÃ´tes invisibles, et pour Ã©viter de tels problÃ¨mes, cela doit Ãªtre corrigÃ©. <br><br>  Maintenant, quadruplons la taille de la carte et n'en affichons qu'un quart dans la fenÃªtre de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f40/81f/8d4/f4081f8d4d2ac9dd3d7d35077ba23450.png"></div><br>  En gÃ©nÃ©ral, tout semble bon (il y a un systÃ¨me de riviÃ¨res intÃ©ressant sur la carte, un grand lac, mais vous pouvez voir que les villes sont trÃ¨s rares. C'est arrivÃ© parce que <i>Dragons Abound</i> gÃ©nÃ¨re 10-20 villes. Cet intervalle est bien adaptÃ© pour un monde de taille normale, mais mauvais, lorsque la taille est quatre fois plus grande. Par consÃ©quent, l'intervalle doit Ãªtre modifiÃ© en fonction de la taille relative du monde. Probablement, cela doit Ãªtre fait Ã  plusieurs endroits. <br><br>  Voici la mÃªme carte aprÃ¨s avoir rÃ©solu le problÃ¨me: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/821/113/b40/821113b400ab683c8fdfad87bccf3213.png"></div><br>  Maintenant, sur la carte, il y a un nombre plus logique de villes et villages, mais cela nous montre un autre problÃ¨me.  Vous pouvez voir beaucoup de noms supplÃ©mentaires sur les bords de la carte, par exemple, Nanmrummombrook, Marwynnley et Noyewood dans le coin infÃ©rieur gauche.  Cela se produit car la mÃ©thode du code de placement essaie de les placer lÃ  oÃ¹ ils sont visibles.  Auparavant, cette procÃ©dure n'avait jamais Ã  se soucier des Ã©tiquettes en dehors de l'Ã©cran, car dans les cartes de taille rÃ©gionale, le monde entier est gÃ©nÃ©ralement visible.  Mais maintenant, il peut y avoir des villes et d'autres objets situÃ©s hors de l'Ã©cran.  Par consÃ©quent, je dois ajouter une logique Ã  la procÃ©dure de placement d'Ã©tiquette qui n'essaie pas de crÃ©er des Ã©tiquettes pour les objets de carte invisibles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b9d/022/b5a/b9d022b5a3c22d9f7e1f4c5e7c24771e.png"></div><br>  Maintenant, l'image est plus logique.  Ã€ droite, Cumden est Ã  peine visible sur la carte, mais l'Ã©tiquette est toujours situÃ©e lÃ  oÃ¹ elle est visible. <br><br>  Il y a un aspect qui n'est pas immÃ©diatement perceptible sur les grandes cartes: le nombre d'emplacements dans le monde n'a pas changÃ©.  Bien que la carte (dans un sens) soit devenue 4 fois plus grande, sa superficie totale est toujours limitÃ©e par le mÃªme nombre d'emplacements.  L'Ã©tape initiale de la gÃ©nÃ©ration de la carte Ã©tait de couvrir le monde avec un diagramme de Voronoi avec un nombre constant d'emplacements.  Autrement dit, lorsque la carte devient plus grande, les cellules de Voronoi deviennent Ã©galement plus grandes. <br><br>  Il serait logique de mettre Ã  l'Ã©chelle le nombre d'emplacements en fonction de la taille de la carte, mais malheureusement, la dÃ©pendance de la vitesse d'exÃ©cution de <i>Dragons Abound</i> sur le nombre d'emplacements est bien pire que linÃ©aire, c'est-Ã -dire que gÃ©nÃ©rer une carte avec un grand nombre d'emplacements peut prendre beaucoup de temps.  Voici un exemple de carte avec une rÃ©solution quadruple (nombre d'emplacements): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4bc/faa/7a6/4bcfaa7a64abf56cb1cf4aab84651215.png"></div><br>  Les emplacements ajoutÃ©s modifient le processus de gÃ©nÃ©ration, le terrain est donc diffÃ©rent des cartes illustrÃ©es ci-dessus, mais vous pouvez y voir les dÃ©tails supplÃ©mentaires sur les cÃ´tes. <br><br>  Heureusement, lors du profilage des performances de gÃ©nÃ©ration de grandes cartes, j'ai remarquÃ© que la majeure partie du temps processeur est occupÃ©e par des problÃ¨mes Ã©vidents.  AprÃ¨s le dÃ©bogage, j'ai Ã©liminÃ© les plus dÃ©rangeants, ce qui m'a permis de crÃ©er encore plus de cartes.  Voici la carte 4x entiÃ¨re: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/149/6f4/600/1496f4600dc18c1ffa955580e07d7161.png"></div><br>  Zoom de 25% effectuÃ©.  Cela ressemble Ã  peu prÃ¨s Ã  la taille maximale de la carte que Chrome peut afficher.  La procÃ©dure de gÃ©nÃ©ration mondiale peut traiter des cartes plus grandes, mais en essayant de les afficher, le navigateur se bloque.  En ce sens, Firefox semble Ãªtre plus fonctionnel;  Il peut afficher des cartes 9 fois plus grandes que la taille d'origine.  Voici une partie d'une telle carte - je l'ai laissÃ©e en taille rÃ©elle, vous pouvez donc l'ouvrir dans une fenÃªtre sÃ©parÃ©e pour mieux comprendre la taille et les dÃ©tails. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/1a2/c98/15f1a2c98b85e749101f0a379e7b9937.png"></div><br>  Firefox est capable de gÃ©nÃ©rer des cartes de cette taille, mais je ne peux prendre des captures d'Ã©cran qu'Ã  la taille maximale de la fenÃªtre du navigateur.  J'ai une fonction pour enregistrer la carte en tant que fichier PNG, mais elle ne peut enregistrer que la partie affichÃ©e de la carte.  Je pense que vous pouvez faire dÃ©filer la carte, capturer des Ã©crans individuels et les connecter ensemble, mais cela prendra du temps. <br><br>  La meilleure solution consiste Ã  enregistrer le SVG lui-mÃªme afin qu'il puisse Ãªtre ouvert dans un programme comme Inkscape. <br><br>  Auparavant, je pouvais couper et coller des cartes SVG dans Inkscape, mais les SVG pour les cartes du monde sont si gros que lorsque j'essaie de couper le navigateur, il se bloque!  Heureusement, j'ai trouvÃ© <a href="">FileSaver.js</a> et vous pouvez l'utiliser pour enregistrer le SVG directement dans un fichier, puis l'ouvrir dans Inkscape, crÃ©ant ainsi une trÃ¨s grande image. <br><br>  Du moins thÃ©oriquement.  Lorsque j'essaie d'ouvrir ces cartes dans Inkscape, je rencontre quelques problÃ¨mes. <br><br>  Le premier problÃ¨me est que les hypothÃ¨ses d'Inkscape sont diffÃ©rentes des hypothÃ¨ses de Chrome et Firefox sur la faÃ§on d'ouvrir SVG.  En particulier, si la couleur de remplissage n'est pas spÃ©cifiÃ©e dans le chemin, les navigateurs supposent qu'il n'y a pas de remplissage;  Inkscape suppose que le contour est rempli de noir.  Par consÃ©quent, lorsque j'ouvre le SVG enregistrÃ© dans Inkscape, il est presque entiÃ¨rement noir, car la couche supÃ©rieure de la carte ne contient pas de couleur de remplissage.  Cela peut Ãªtre rÃ©solu en spÃ©cifiant Â«fill: noneÂ» aux endroits nÃ©cessaires afin que les contours apparaissent Ã©galement dans le navigateur et Inkscape. <br><br>  Le deuxiÃ¨me problÃ¨me est qu'Inkscape a des erreurs dans le traitement des masques.  Inkscape semble crÃ©er des masques avec un seul Ã©lÃ©ment et gÃ¨re mal les masques avec plusieurs Ã©lÃ©ments.  <i>Dragons Abound</i> crÃ©e de nombreux masques avec plusieurs Ã©lÃ©ments.  Vous pouvez contourner ce problÃ¨me en regroupant tous les Ã©lÃ©ments de chaque masque de jeu en un seul Ã©lÃ©ment de groupe (facultatif). <br><br>  Le troisiÃ¨me problÃ¨me est liÃ© aux images et autres ressources tÃ©lÃ©chargeables.  Dans le SVG d'origine, les rÃ©fÃ©rences Ã  celles-ci sont indiquÃ©es sous une forme relative, par exemple, Â«images / background0.pngÂ».  Mes sources sont organisÃ©es de maniÃ¨re Ã  ce que le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">serveur Web distinct que j'utilise</a> puisse trouver ces ressources aux endroits spÃ©cifiÃ©s.  Lorsque je prends le mÃªme SVG et que je l'ouvre dans Inkscape, ces chemins relatifs sont traitÃ©s comme l'URL Â«fichier:Â» et Inkscape recherche des ressources par rapport au dossier dans lequel le SVG a Ã©tÃ© enregistrÃ©.  Ce problÃ¨me peut facilement Ãªtre contournÃ© en enregistrant le SVG dans un dossier dans lequel il existe dÃ©jÃ  des ressources aux bons endroits;  il peut s'agir du mÃªme dossier racine utilisÃ© par le serveur Web, ou d'un autre emplacement dans lequel se trouvent des copies de ressources sur les mÃªmes chemins (relatifs). <br><br>  Le quatriÃ¨me problÃ¨me concerne les polices.  <i>Dragons Abound</i> utilise Ã  la fois des polices Web et des polices stockÃ©es localement;  les deux au format WOFF2.  Dans le navigateur, elles sont appliquÃ©es au texte en utilisant le style de famille de polices CSS, et avant de gÃ©nÃ©rer la carte, toutes les polices possibles sont tÃ©lÃ©chargÃ©es sur la page Web pour Ãªtre prÃªtes Ã  l'emploi.  Lorsque le mÃªme fichier est ouvert dans le jeu, il recherche les polices dans le rÃ©pertoire des polices systÃ¨me et il semble qu'aucun autre rÃ©pertoire de polices ne puisse Ãªtre spÃ©cifiÃ© de quelque maniÃ¨re que ce soit.  Une solution simple (au moins sur la machine sur laquelle je dÃ©veloppe) consiste Ã  installer les polices utilisÃ©es par le jeu dans le rÃ©pertoire des polices systÃ¨me.  Cependant, ce n'est pas aussi simple qu'il y paraÃ®t, car les noms de police doivent correspondre, et sous Windows, il n'existe aucun moyen facile de modifier le nom de la police.  Mais, bien sÃ»r, un tel schÃ©ma ne fonctionnera pas sur les ordinateurs sur lesquels toutes les polices nÃ©cessaires ne sont pas installÃ©es.  Une solution plus portable consiste Ã  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">incorporer des polices SVG dans les cartes</a> .  Ce sera sur ma liste TODO. <br><br>  Ã€ la fin, je suis arrivÃ© Ã  cette interface de gÃ©nÃ©ration de carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/e69/c3b/88ee69c3b069b7c369cbf3921b6a3eba.png"></div><br>  Les champs de saisie Ã©tendus spÃ©cifient la taille totale du monde, oÃ¹ 1x1 est la taille des cartes sources.  La taille de vbx (viewbox) dÃ©termine la taille d'un fragment du monde affichÃ© sur la carte;  dans la capture d'Ã©cran, il a Ã©galement une valeur de 1x1, c'est-Ã -dire que la carte affichera le monde entier.  Les champs du centre vbx spÃ©cifient l'emplacement du centre de la carte dans le monde;  0, 0 est le centre du monde.  Enfin, les paramÃ¨tres SVG spÃ©cifient le nombre de pixels d'Ã©cran pour 1 unitÃ© de taille de zone de visualisation;  Ã  une valeur de 775, une carte 1x1 sera affichÃ©e Ã  l'Ã©cran au montant de 775x775 pixels.  C'est pratique lorsque je crÃ©e une trÃ¨s grande carte.  En dÃ©finissant le paramÃ¨tre sur une valeur faible (par exemple, 150 pixels), je peux adapter une grande carte Ã  l'Ã©cran dans son ensemble. <br><br>  En modifiant ces six paramÃ¨tres, je peux contrÃ´ler la taille du monde et la fraction du monde qui est affichÃ©e sur la carte.  Le bouton GÃ©nÃ©rer fonctionne exactement comme vous pouvez le deviner;  le bouton Afficher affiche simplement une partie du monde, c'est-Ã -dire que je peux gÃ©nÃ©rer un monde, puis afficher ses parties individuelles, en modifiant les paramÃ¨tres de la zone de visualisation sans avoir Ã  recrÃ©er le monde.  (Un programmeur implÃ©menterait mieux cela comme mise Ã  l'Ã©chelle et dÃ©filement.) Le bouton Enregistrer PNG enregistre la carte visible sous forme de fichier PNG;  Le bouton Enregistrer SVG enregistre le fichier SVG de la carte entiÃ¨re.  Le bouton Test It est utilisÃ© pour exÃ©cuter le code de test, qui change au cours du dÃ©veloppement de diverses fonctions. <br><br>  Maintenant que je peux gÃ©nÃ©rer et reflÃ©ter toutes les parties du grand monde, je peux passer Ã  l'adaptation de la forme du terrain Ã  des cartes plus grandes. <br><br><h2>  Partie 3. Formes de sushi </h2><br>  AprÃ¨s avoir apportÃ© diverses modifications dans la partie prÃ©cÃ©dente, je peux maintenant gÃ©nÃ©rer des mondes beaucoup plus grands que les prÃ©cÃ©dents (jusqu'Ã  8 fois plus) et les enregistrer en tant que grandes images graphiques: <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/963/31e/c94/96331ec940b59a6f349603f0024f5cc7.png"></a> </div><br>  (Ouvrez l'image dans une fenÃªtre sÃ©parÃ©e pour voir la carte en pleine rÃ©solution 4800x2400 sur Flickr.) <br><br>  Je gÃ©nÃ¨re ces cartes en utilisant la mÃªme gÃ©nÃ©ration procÃ©durale qui a crÃ©Ã© les cartes rÃ©gionales.  La carte ci-dessus a une forme continentale assez rÃ©guliÃ¨re et quelques Ã®les extÃ©rieures intÃ©ressantes.  Cependant, cela dÃ©pend principalement de la chance.  Voici une autre carte: <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/b03/406/fd1/b03406fd17f93c9e33cd8dd488b404c3.png"></a> </div><br>  Cette carte est juste le chaos des Ã®les et du fromage Ã  sushi suisse. <br><br>  Voici un autre exemple, quelque chose entre les deux cartes prÃ©cÃ©dentes.  Ce n'est pas complÃ¨tement rÃ©aliste, mais cela peut Ãªtre intÃ©ressant pour un environnement fantastique: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/7c3/c79/e98/7c3c79e98246dde23f7104428e9cf9b2.jpg"></a> </div><br>  Il s'agit d'une Ã©norme masse continentale de terres, mais il existe de nombreuses formes de terres Ã©tranges et, en gÃ©nÃ©ral, le monde ne semble pas tout Ã  fait Â«rÃ©elÂ».  (Bien que pour quelqu'un, un tel monde semble tout Ã  fait appropriÃ© pour la fantaisie.) Alors, quelles formes devrait avoir la carte du Â«mondeÂ»? <br><br>  La plupart des cartes du monde fantastique que j'ai vues reprÃ©sentent un grand continent insulaire (avec de petites Ã®les autour), par exemple, comme cette carte d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Andelen</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/926/3f4/fb8/9263f4fb80cf2899f48693c31aa2566a.png"></div><br>  Ou la pÃ©ninsule du continent, comme sur cette carte d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Angorun</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75c/ef4/bc1/75cef4bc1d0e698c2a76ee77bfc74bd0.png"></div><br>  De temps en temps, une carte est entiÃ¨rement composÃ©e de terres ou de plusieurs continents insulaires, mais ils sont plus susceptibles d'Ãªtre des exceptions Ã  la rÃ¨gle. <br><br>  Pour commencer, imaginons la gÃ©nÃ©ration des continents Â«insulairesÂ».  Comme il se trouve dans mon jeu, il y avait dÃ©jÃ  une fonction qui gÃ©nÃ¨re un grand Ã®lot central sur la carte en tenant compte de la taille de la carte, elle devrait donc Ãªtre adaptÃ©e pour gÃ©nÃ©rer la forme principale du continent.  Le bruit et les Ã®les supplÃ©mentaires s'occuperont du reste. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a7/86e/0b5/0a786e0b59241b451f3c225c23328a47.png"></div><br>  Je ne m'attendais pas Ã  une grande mer centrale sur cette carte, mais c'est une agrÃ©able surprise.  Voici un autre exemple: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f58/a14/788/f58a14788a7dbcd6fbaa25c9fb45457e.png"></div><br>  Le problÃ¨me avec la fonction de l'Ã®lot central est qu'il commence par un cercle qui convient aux cartes carrÃ©es que j'ai montrÃ©es, mais pas trÃ¨s bon pour les cartes rectangulaires.  (Vous trouverez ci-dessous des exemples avec une petite distorsion, afin que les formes de base soient plus clairement visibles.) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30b/b43/073/30bb430737122e671fb2f2067fafea08.png"></div><br>  Ceci est facilement corrigÃ© en masquant les sushis au lieu d'un cercle avec une ellipse (dÃ©formÃ©e) prise par la taille de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/393/7a9/2ea/3937a92ea08cd752739550bf59a89971.png"></div><br>  Ces Ã®les centrales sont dimensionnÃ©es pour remplir la carte, mais dans de nombreux cas, pour les cartes continentales, nous devons laisser une Â«frontiÃ¨reÂ» autour du continent.  Deux paramÃ¨tres contrÃ´lent la taille de la carte remplissant l'Ã®le le long des axes X et Y. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad4/b00/94e/ad4b0094e542930350a964377888a640.png"></div><br>  Voici le mÃªme systÃ¨me de gestion des frontiÃ¨res avec des distorsions plus logiques: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/357/9e1/121/3579e11217c879a587f11b30380e94b9.png"></a> </div><br>  On peut voir que les parties est et ouest de la carte restent l'ocÃ©an.  (Vous pouvez ouvrir la carte dans une fenÃªtre sÃ©parÃ©e pour l'Ã©tudier plus attentivement.) Cela signifie que la carte affiche le monde entier (et ses bords droit et gauche peuvent Ãªtre connectÃ©s) ou une partie du monde qui peut Ãªtre connectÃ©e Ã  une autre carte qui a Ã©galement un ocÃ©an Ã  partir du bord correspondant. <br><br>  Un lecteur attentif qui a Ã©tudiÃ© la carte prÃ©cÃ©dente a peut-Ãªtre remarquÃ© que les motifs de l'ocÃ©an et de la terre s'arrÃªtent au milieu de la carte.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auparavant, je n'avais que des cartes de taille 1x1, de sorte que les tailles des motifs de l'ocÃ©an et de la terre Ã©taient adaptÃ©es Ã  ces cartes. Sur les cartes plus grandes, j'ai besoin de carreler manuellement les motifs sur la carte, j'ai donc ajoutÃ© cette fonctionnalitÃ©. (Il existe un moyen en SVG pour effectuer un mosaÃ¯que de motifs, mais dans Chrome, il contient un bogue, donc je ne peux pas l'utiliser.) C'est une bonne fonctionnalitÃ©, car maintenant je peux utiliser des motifs terrestres et ocÃ©aniques plus petits qui se tuileront automatiquement. Je ne sais pas pourquoi je ne m'en Ã©tais pas rendu compte avant! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, maintenant les continents insulaires fonctionnent bien, et nous allons passer Ã  la mise en Å“uvre des continents Â«pÃ©ninsulairesÂ» - des cartes dans lesquelles le continent apparaÃ®t sur la carte depuis son bord.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9e/d75/914/d9ed75914bd6b4deaae08fb687b828e2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, le continent ne peut pas s'effondrer sur trois bords. </font><font style="vertical-align: inherit;">Mais la caractÃ©ristique principale de ces cartes est qu'elles ont une connexion terrestre significative entre le continent affichÃ© sur la carte et la terre en dehors de la carte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le moyen le plus simple de fournir une telle connexion en dehors de la carte est de dÃ©finir un niveau bas de la mer pendant la gÃ©nÃ©ration. </font><font style="vertical-align: inherit;">Nous allons donc augmenter la zone de terre affichÃ©e sur la carte, ce qui augmente la probabilitÃ© de grandes masses de terre et la prÃ©sence de terres (plutÃ´t que la mer) le long des bords de la carte.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/24d/adb/522/24dadb52258988326f096336470d97c3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bien sÃ»r, cela ne garantit pas que la masse de terre sera trÃ¨s intÃ©ressante, et en effet elle sera unifiÃ©e: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0b/c22/335/c0bc223356225dea02bfbd773495f36e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La similitude d'un seul continent peut Ãªtre crÃ©Ã©e en utilisant la mÃªme gÃ©nÃ©ration du continent insulaire, mais en dÃ©plaÃ§ant en mÃªme temps l'Ã®le au bord de la carte. </font><font style="vertical-align: inherit;">Vous obtenez quelque chose comme Ã§a:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/209/981/20e/20998120e01c4c48f53419855cf6f703.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On peut voir que le continent (principalement) est l'Ã®le centrale, dÃ©calÃ©e vers le haut et vers la droite. </font><font style="vertical-align: inherit;">Comme il s'agit d'un continent et qu'il n'est pas nÃ©cessaire de conserver une forme d'Ã®le stricte, vous pouvez ajouter plus de distorsion Ã  la forme.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5f/000/523/e5f00052339289e504ffcd82b7481545.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰videmment, il existe de nombreuses autres approches pour la gÃ©nÃ©ration de secours, mais ces deux, au moins, me donnent l'occasion de gÃ©nÃ©rer les formes de terres les plus courantes Ã  l'Ã©chelle continentale. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un lecteur attentif a pu remarquer les formes Ã©tranges de forÃªts sous forme de rayures sur de nombreuses cartes des continents. </font><font style="vertical-align: inherit;">La prochaine fois, je commencerai Ã  traiter les problÃ¨mes des modÃ¨les de vent et des biomes qui causent ces bizarreries.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Partie 4. ModÃ¨le de vent </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme indiquÃ©, la taille des continents sur les cartes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> commencÃ© Ã  montrer des modÃ¨les irrÃ©alistes de temps et de biomes. Cet exemple montre que la forÃªt est alignÃ©e le long de la direction du vent dominant:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/209/981/20e/20998120e01c4c48f53419855cf6f703.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La raison n'est pas dans le code cassÃ©; les modÃ¨les mÃ©tÃ©orologiques et de biome sont plutÃ´t trop simples, et Ã  grande Ã©chelle, cela devient apparent. Pour faire face Ã  ces problÃ¨mes, j'ai commencÃ© par rÃ©viser le modÃ¨le de vent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'aimerais que mon modÃ¨le de vent reflÃ¨te mieux la dynamique du vent de la Terre: les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellules de Hadley</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les alizÃ©s</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et autres. Une telle dynamique peut aider Ã  Ã©liminer les modÃ¨les mÃ©tÃ©orologiques Ã©tranges sur les cartes continentales. Cependant, quand ils ont Ã©tÃ© ajoutÃ©s, une insatisfaction douloureuse avec le modÃ¨le de vent </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lent et trop compliquÃ© </font><font style="vertical-align: inherit;">, a de nouveau Ã©tÃ© rÃ©vÃ©lÃ©e </font><font style="vertical-align: inherit;">. (Lisez ici la mise en Å“uvre initiale du modÃ¨le Ã©olien </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.) AprÃ¨s avoir rÃ©flÃ©chi Ã  cela pendant plusieurs jours, j'ai dÃ©cidÃ© que la plupart des problÃ¨mes se rÃ©sument au fait que la carte du jeu est prÃ©sentÃ©e sous forme de diagramme de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voronoi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . (Ou plutÃ´t, la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">triangulation de Delaunay du</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diagramme de Voronoi.) Il prÃ©sente de nombreux avantages lors de la gÃ©nÃ©ration de terrain - en combinaison avec le bruit, il peut crÃ©er des masses terrestres d'aspect naturel. C'est pourquoi il est si souvent utilisÃ© pour gÃ©nÃ©rer un soulagement. Mais comme les triangles individuels ont des tailles et des orientations diffÃ©rentes, tous les calculs, y compris les modÃ¨les de vent qui utilisent des cellules voisines voisines, deviennent assez compliquÃ©s. Il sera beaucoup plus facile de modÃ©liser le vent Ã  travers une grille de zones identiques rÃ©guliÃ¨rement espacÃ©es. De plus, le modÃ¨le Ã©olien n'a probablement pas Ã  Ãªtre aussi dÃ©taillÃ© que le terrain.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais je ne veux pas abandonner complÃ¨tement le diagramme de Voronoi qui sous-tend les </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . (Au minimum, cela nÃ©cessitera la rÃ©Ã©criture de presque tout le programme!) Au lieu de cela, je veux expÃ©rimenter avec la liaison de la carte Ã  une grille uniforme, exÃ©cuter le modÃ¨le de vent dedans, puis effectuer la liaison inverse. Si la perte de copie dans les deux sens n'est pas trop importante, cela peut rendre le modÃ¨le de vent plus rapide et plus facile. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle grille dois-je utiliser? IdÃ©alement, la grille devrait Ãªtre constituÃ©e de zones Ã©gales Ã  Ã©gale distance de ses voisins. Et cette description est comme une grille d'hexagones.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/720/948/12a/72094812ad2adea8d6d71fa795146c44.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, une grille d'hexagones est le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meilleur moyen de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diviser une surface plane en zones Ã©gales. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'Ã©tape suivante consiste Ã  dÃ©terminer comment reprÃ©senter la grille d'hexagones dans mon programme. J'ai cherchÃ© un peu sur le rÃ©seau pour obtenir de l'aide, et chaque lien me renvoyait Ã  la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page sur les grilles des hexagones d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Amit Patel ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traduction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en HabrÃ©). Probablement, il faut commencer par cela; Il est Ã©galement bon d'explorer d'abord le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site Web des jeux Red Blob</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si vous recherchez des informations sur la mise en Å“uvre des mÃ©canismes de jeu. Amit explique mieux que moi, donc si quelque chose n'est pas clair, alors lisez sa page.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le premier choix Ã  faire est la maniÃ¨re de stocker la grille d'hexagones. </font><font style="vertical-align: inherit;">Le moyen le plus simple consiste Ã  le stocker sous forme de tableau Ã  deux dimensions, puis j'ai besoin de pouvoir lier les cellules de la grille au tableau. </font><font style="vertical-align: inherit;">Il existe de nombreuses options ici (lire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la page d'Amit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mais j'utiliserai ce qu'il appelle odd-r:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e9c/a08/6bb/e9ca086bb2e5957db58d021c302c27f4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les nombres dans chaque cellule sont les indices de la cellule dans le tableau Ã  deux dimensions. </font><font style="vertical-align: inherit;">(L'image est volÃ©e sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la page</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Amit</font></a><font style="vertical-align: inherit;"> . Sur sa page, elles sont interactives, donc je vous conseille de les expÃ©rimenter.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AprÃ¨s avoir fait un choix, je dois maintenant apprendre Ã  attacher des index Ã  une grille d'hexagones. </font><font style="vertical-align: inherit;">Par exemple, si je recherche une cellule hexagonale (3, 3), quels seront ses voisins? </font><font style="vertical-align: inherit;">Si chaque cellule a une largeur de 5 pixels, alors quelles seront les coordonnÃ©es du centre de la cellule (3, 3)?</font></font> Et ainsi de suite.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GÃ©rer cela peut Ãªtre difficile, donc je suis content qu'Amit l'ait fait pour moi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En supposant que nous pouvons voler tout ce dont nous avons besoin Ã  Amit, je dois d'abord comprendre comment organiser les hexagones sur la carte. Ã€ ce stade, je n'ai pas encore besoin d'un tableau, je peux prÃ©tendre qu'il l'est et voir oÃ¹ seront les hexagones. Si je connais l'emplacement des hexagones, je divise simplement la largeur de la carte par la distance horizontale entre eux pour obtenir le nombre de colonnes, et je fais de mÃªme verticalement pour obtenir le nombre de lignes, aprÃ¨s quoi je dessine un hexagone Ã  chaque endroit:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ba/0e2/d39/7ba0e2d39d51e3ea0584734fbb584f19.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ces hexagones sont beaucoup plus grands que ceux que j'utiliserai pour le modÃ¨le de vent, mais ils me montrent que tout est correctement placÃ©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, j'ai ouvert les bords de la carte et dessinÃ© uniquement l'hexagone central et aux frontiÃ¨res pour vÃ©rifier si je ferme vraiment la carte entiÃ¨re:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f99/733/2a0/f997332a08696203af9e4cf044cf07cd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le haut et le bas sont en dehors de la carte, mais la prÃ©sence de plusieurs cellules Ã  l'Ã©tranger n'est pas importante si je ne manque pas une partie de la carte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'Ã©tape suivante consiste Ã  crÃ©er un tableau pour la grille d'hexagones et Ã  aligner tous les triangles de Delaunay sur les hexagones correspondants. Ã‰tant donnÃ© que Javascript ne prend pas en charge </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les index nÃ©gatifs des tableaux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , je dois dÃ©placer la cellule (0, 0) du centre de la carte vers le coin supÃ©rieur droit. Cela fait, je fais le tour de tous les triangles de Delaunay et je les ajoute aux cellules correspondantes de la grille hexagonale. Je peux le vÃ©rifier en coloriant les hexagones contenant du terrain:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/848/f2e/1b7/848f2e1b78edb9dbfb91abdbff1bcf56.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour dÃ©terminer si une cellule est un terrain, je fais la moyenne de la hauteur de tous les emplacements qui tombent dans cette cellule. </font><font style="vertical-align: inherit;">Vous remarquerez peut-Ãªtre que pour certains hexagones cÃ´tiers, la moyenne est infÃ©rieure Ã  zÃ©ro, mÃªme en prÃ©sence de terre. </font><font style="vertical-align: inherit;">Vous pouvez Ã©galement utiliser la hauteur maximale de tous les emplacements dans l'hexagone:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66b/041/254/66b0412544abda9d618ab32784bd9ec8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, la recherche a lieu dans la direction opposÃ©e - l'hexagone est marquÃ© comme terrain s'il y a du terrain dedans. </font><font style="vertical-align: inherit;">Ce qui est mieux dÃ©pend de ce dont vous avez besoin. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans tous les cas, je peux augmenter la prÃ©cision en rÃ©duisant la taille des hexagones:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c3b/0e7/1ec/c3b0e71ecf56429e04ea02a771b3a044.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, la cÃ´te s'est beaucoup amÃ©liorÃ©e, mais un nouveau problÃ¨me est apparu - de nombreux hexagones internes qui ne sont pas considÃ©rÃ©s comme des terres. Cela se produit parce que lorsque les hexagones deviennent suffisamment petits, Ã  l'intÃ©rieur de certains d'entre eux, il n'y a aucun triangle de Delaunay. Par consÃ©quent, ils n'ont pas de Â«hauteurÂ». (Cela montre Ã©galement l'inÃ©galitÃ© des triangles de Delaunay.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez utiliser cette solution - prendre la hauteur des triangles manquants comme la moyenne de leurs voisins, ou comme un maximum de leurs voisins.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d51/ad8/30f/d51ad830fd84fa509f8f47c40b730f07.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En gÃ©nÃ©ral, lorsque la liaison entre les hexagones et les emplacements n'est pas un Ã  un, des corrections sont nÃ©cessaires pour remplir les informations manquantes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant que j'ai posÃ© la grille d'hexagones sur la carte, nous pouvons commencer Ã  implÃ©menter le modÃ¨le de vent. L'idÃ©e principale du modÃ¨le de vent est de simuler certains vents (alizÃ©s) et de les rÃ©partir sur toute la carte jusqu'Ã  ce qu'ils atteignent un Ã©tat d'immobilitÃ©. Au niveau des hexagones (ou au niveau des emplacements, si je le fais sur les triangles de Delaunay), cela comprend deux Ã©tapes: (1) nous rÃ©sumons tous les vents entrant dans l'hexagone actuel, et (2) nous dÃ©terminons comment le vent sommÃ© quitte l'hexagone.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La premiÃ¨re Ã©tape est assez simple. </font><font style="vertical-align: inherit;">Chaque hexagone a six voisins et chacun de ces hexagones contribue. </font><font style="vertical-align: inherit;">Si nous considÃ©rons chacun des vents entrant dans l'hexagone comme un vecteur, alors le vent total dans la cellule sera la somme de ces vecteurs, c'est-Ã -dire </font><font style="vertical-align: inherit;">deux vents strictement opposÃ©s de force Ã©gale s'annulent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La deuxiÃ¨me Ã©tape (dÃ©terminer comment le vent total quitte l'hexagone) nÃ©cessite une rÃ©flexion. </font><font style="vertical-align: inherit;">Le cas le plus simple est le vent qui souffle directement Ã  travers l'hexagone:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e8a/982/d5a/e8a982d5af635e1fbee1e82f20c1990d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, nous nous attendons Ã  ce que le vent se dÃ©place vers la cellule suivante sans changements. </font><font style="vertical-align: inherit;">(Ici, le vecteur rouge est le vent d'origine et le bleu est le vecteur du vent se propageant.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais que se passe-t-il si le vent ne souffle pas directement sur la cellule voisine?</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cd/396/196/3cd3961960c15fa86e60cd421336e23d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, il semble logique qu'une partie du vent souffle dans l'hexagone directement au-dessus de lui, l'autre partie dans la cellule situÃ©e dans le sens antihoraire de celle-ci, et les proportions devraient dÃ©pendre de la direction dans laquelle la flÃ¨che pointe. </font><font style="vertical-align: inherit;">Dans notre cas, la partie principale du vent se dÃ©placera vers la cellule supÃ©rieure, et moins vers la cellule voisine. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est Ã©galement nÃ©cessaire de dÃ©cider de la direction du vent qui se propage. </font><font style="vertical-align: inherit;">Une option consiste Ã  maintenir la direction du vent d'origine:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e31/e3f/6ef/e31e3f6ef05e18991e2e48462e47a05b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il semble que ce soit l'option la plus rÃ©aliste, mais il y en a une autre - pour changer la direction du vent en fonction du bord de l'hexagone qu'il intersecte: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/96b/caa/11d/96bcaa11d738b2468eccd1ea758b9e8d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette approche est moins prÃ©cise, mais prÃ©sente un avantage: les vents entrants seront toujours dans l'une des six directions, ce qui peut simplifier les calculs. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre difficultÃ© survient lorsque l'on considÃ¨re le terrain. </font><font style="vertical-align: inherit;">Que doit-il se passer lorsqu'une montagne se lÃ¨ve dans le vent?</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a95/c03/492/a95c0349265fe5581df74ebb33bbd4f5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dans ce cas, une partie du vent passe au-dessus de la montagne (crÃ©ant Ã©ventuellement des prÃ©cipitations), mais une partie du vent se tourne sur les cÃ´tÃ©s. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5f4/e8b/fe3/5f4e8bfe34c0e0a8fd7a9bb784487ad9.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par consÃ©quent, la faÃ§on dont le vent sort de l'hexagone dÃ©pend de sa direction, ainsi que de la topographie des cellules voisines. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parlons maintenant de la faÃ§on de reprÃ©senter les vecteurs. </font><font style="vertical-align: inherit;">Il existe deux options principales. </font><font style="vertical-align: inherit;">Tout d'abord, un vecteur peut Ãªtre reprÃ©sentÃ© par des valeurs X et Y, par exemple comme ceci:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/253/4da/c67/2534dac673d43b8bf4d93f70254e540a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nous dessinons un vecteur commenÃ§ant Ã  (0, 0), alors (X, Y) sont les coordonnÃ©es des points finaux. </font><font style="vertical-align: inherit;">Un tel enregistrement facilite la somme des vecteurs. </font><font style="vertical-align: inherit;">Nous additionnons simplement toutes les valeurs (X, Y) et obtenons un nouveau vecteur:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9fd/b4c/427/9fdb4c427518523698ec72c34b854059.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une autre option consiste Ã  utiliser l'angle et la longueur du vecteur: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c43/421/9c9/c434219c9ba69e9a29b5d73b665d5e96.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sous cette forme, il est facile d'effectuer des opÃ©rations telles que la rotation de vecteurs ou la modification de sa longueur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour la majoritÃ© des opÃ©rations requises dans le modÃ¨le Ã©olien, la premiÃ¨re option est meilleure, mais dans certains cas, la seconde est meilleure, il serait donc pratique de basculer entre elles si nÃ©cessaire. </font><font style="vertical-align: inherit;">Afin de ne pas rÃ©inventer la roue, j'ai recherchÃ© une bibliothÃ¨que vectorielle pour Javascript et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Victor.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> complÃ¨tement </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">montÃ©e</font></a><font style="vertical-align: inherit;"> , alors j'en ai profitÃ©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je vais commencer par ajouter un vecteur vent Ã  chaque hexagone et voir si je peux le visualiser:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9e/1a2/b49/d9e1a2b49e115bbc4436a8e518164adb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il semble bon jusqu'Ã  prÃ©sent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'Ã©tape suivante consiste Ã  vÃ©rifier si je peux correctement diviser le vecteur vent et le distribuer Ã  la cellule suivante. Tout d'abord, vous devez calculer les angles menant aux autres cellules. J'ai retrouvÃ© la rÃ©ponse sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la page d'Amit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f2/f9d/4a9/9f2f9d4a9c349dbb47ff2dc32ede0ff8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est-Ã -dire qu'un vecteur Ã  0 degrÃ© pointe vers un hexagone Ã  droite, Ã  60 degrÃ©s - vers un hexagone en bas Ã  droite, et ainsi de suite. Un vecteur pointant entre ces deux directions est divisÃ© proportionnellement entre deux cellules - c'est-Ã -dire qu'un vecteur Ã  un angle de 30 degrÃ©s sera rÃ©parti Ã©galement entre la cellule Ã  droite et la cellule de bas Ã  droite. Chaque vecteur se situe quelque part entre les coins des faces de deux cellules voisines, alors regardez simplement l'angle du vecteur vent, dÃ©couvrez qu'il tombe entre les coins centraux de deux hexagones, puis divisez-le proportionnellement entre ces deux hexagones. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, si le vecteur vent a un angle de 22 degrÃ©s:</font></font><br><br><div style="text-align:center;"><img height="320" src="https://habrastorage.org/getpro/habr/post_images/147/fc8/add/147fc8add812755fa9abab8c5eb928aa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puis 38/60 de la valeur se propage Ã  la cellule de droite et 22/60 de la valeur vectorielle Ã  la cellule en bas Ã  droite. Si les vecteurs sont prÃ©sentÃ©s sous la forme d'une paire de valeurs X et Y, vous pouvez les distribuer en multipliant chaque valeur du vecteur d'origine par une fraction (par exemple, 22/60), puis en l'ajoutant au vecteur vent dans le nouvel hexagone. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour tester cela, je peux organiser les vents dans diffÃ©rentes directions et les placer en haut et sur le cÃ´tÃ© de la carte et voir s'ils peuvent se propager correctement sur la carte. Lorsque les vents entrent en collision, ils doivent Ãªtre combinÃ©s et choisir la direction moyenne avec une vitesse accrue:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/039/482/4ac/0394824ac970c0887bb100c515ea300e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, nous voyons que les vents se rencontrent le long de la diagonale et se combinent pour souffler vers le coin infÃ©rieur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'Ã©tape suivante consiste Ã  prendre en compte l'influence de la terre sur le vent. </font><font style="vertical-align: inherit;">Bien sÃ»r, les modÃ¨les de vent rÃ©els sont trÃ¨s complexes, mais je m'intÃ©resse principalement Ã  la faÃ§on dont la gÃ©ographie des terres affecte les vents de surface. </font><font style="vertical-align: inherit;">Au niveau le plus simple, il s'agit de l'influence des hauteurs et des basses terres sur la direction et la vitesse du vent. </font><font style="vertical-align: inherit;">J'ai expÃ©rimentÃ© de nombreuses approches diffÃ©rentes, mais en consÃ©quence je me suis fixÃ© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deux rÃ¨gles simples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le vent se dÃ©tourne des obstacles. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le vent ralentit quand il se lÃ¨ve et accÃ©lÃ¨re, tombant. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un obstacle se produit lorsque le vent souffle dans une cellule avec une hauteur plus Ã©levÃ©e, par exemple, dans une cellule avec une montagne. </font><font style="vertical-align: inherit;">Lorsque cela se produit, je regarde les deux cellules dans lesquelles le vent souffle, et change l'angle du vent pour qu'il pointe davantage vers le bas des deux hexagones. </font><font style="vertical-align: inherit;">L'amplitude des changements d'angle dÃ©pend de la diffÃ©rence de hauteur de deux cellules, donc lorsque le vent souffle dans deux cellules voisines avec des montagnes, sa direction change peu, mais s'il souffle dans une cellule avec une montagne et une cellule avec une plaine, alors il se tournera davantage vers la cellule vide:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6f/4cd/b90/e6f4cdb90eb194445cf21b3c5679e3ca.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La force du vent peut Ãªtre ajustÃ©e. </font><font style="vertical-align: inherit;">Sur la carte ci-dessus, il est trop fort, ce qui entraÃ®nera l'Ã©mergence de nombreux biomes irrÃ©alistes. </font><font style="vertical-align: inherit;">Voici une signification plus logique:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e70/676/6f8/e706766f8d1abfc1ad18b928b72d9c7e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une grande partie du mouvement du vent causÃ© par les reliefs subsiste, mais les grands Ã©carts et vallÃ©es du vent fort sont devenus plus petits. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre caractÃ©ristique qui amÃ©liore le rÃ©alisme est la dispersion du vent. Par exemple, la carte ci-dessus montre que le vent souffle vers l'ouest juste au-dessus de la ville de Breeches. Bien qu'il souffle sur de longues distances, il ne se dissipe jamais comme prÃ©vu. Lorsqu'un vent soufflant rencontre un autre air, il entraÃ®ne gÃ©nÃ©ralement le vent avec lui. Pour simuler cela, je peux prendre une petite partie du vent qui souffle dans chaque hexagone et le redistribuer Ã  toutes les cellules voisines. Voici Ã  quoi ressemblera la carte ci-dessus avec un petit nuage de points:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98d/53c/6d1/98d53c6d1659c068a8d36c58d692bd02.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous pouvez le voir, maintenant le vent sur la culotte a commencÃ© Ã  se dissiper un peu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette opÃ©ration dÃ©termine la majeure partie des directions du vent. La deuxiÃ¨me partie est la dÃ©cÃ©lÃ©ration du vent lors de la montÃ©e et l'accÃ©lÃ©ration lors de la descente. Je peux le rÃ©aliser en regardant la hauteur relative de la cellule d'oÃ¹ vient le vent, et la hauteur de la cellule dans laquelle le vent souffle, et en l'accÃ©lÃ©rant / le ralentissant si nÃ©cessaire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici Ã  quoi tout cela ressemble:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/633/2c0/d8b/6332c0d8b042591426238cceafaea5a8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous voyons maintenant qu'une partie du vent soufflant Ã  travers les hautes montagnes de la partie centrale de l'Ã®le a Ã©tÃ© coupÃ©e. Et vice versa - plusieurs nouveaux vents sont apparus dans la partie ouest de l'Ã®le, oÃ¹ l'air se dÃ©place depuis des terres relativement hautes vers la mer. (C'est une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">brise cÃ´tiÃ¨re</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! Bien que pas vraiment: le mÃ©canisme est diffÃ©rent lÃ -bas.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, je peux remplacer un nouveau vent dans l'algorithme de prÃ©cipitation existant. Voici une comparaison (vieux vents Ã  gauche, nouveaux vents Ã  droite):</font></font><br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/1e2/c41/3b4/1e2c413b436456e0964c50b794a402db.png"></a> </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Cliquez sur l'image pour voir une version plus grande.) Ã‰videmment, il existe des diffÃ©rences entre les modÃ¨les de vent. Sur les deux cartes, le vent souffle de l'est. Les montagnes proches du centre de la carte tournent le vent vers le sud, provoquent de fortes prÃ©cipitations et crÃ©ent un marÃ©cage et des forÃªts au sud des montagnes. Dans la partie infÃ©rieure, le vent souffle sans aucune interfÃ©rence, et des forÃªts se forment le long de la moitiÃ© orientale de l'Ã®le. Dans le modÃ¨le de vent d'origine, suffisamment de vent a traversÃ© les montagnes centrales et les marÃ©cages pour crÃ©er une forÃªt dans la partie ouest de l'Ã®le. Dans le nouveau modÃ¨le, la majeure partie du vent est coupÃ©e et des biomes herbeux se forment de l'autre cÃ´tÃ© des montagnes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ancien modÃ¨le a la variabilitÃ© des paramÃ¨tres alÃ©atoires (dans un intervalle donnÃ©), et il est probable qu'une certaine combinaison de ces paramÃ¨tres donnerait une image plus comme une nouvelle carte. Mais en fait, nous n'avons pas besoin de reproduire le comportement exact de l'ancien modÃ¨le, juste un modÃ¨le qui crÃ©e des rÃ©sultats probants.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le but de tout cela est d'accÃ©lÃ©rer et de simplifier la gÃ©nÃ©ration de vent afin que de nouveaux comportements de vent puissent Ãªtre ajoutÃ©s aux cartes continentales. </font><font style="vertical-align: inherit;">Je l'ai fait? </font><font style="vertical-align: inherit;">J'ai prÃ©sentÃ© le modÃ¨le de vent d'origine et le nouveau modÃ¨le Ã  base d'hexagone. </font><font style="vertical-align: inherit;">Il s'est avÃ©rÃ© que le nouveau modÃ¨le est 15 Ã  20 fois plus rapide que l'original (!). </font><font style="vertical-align: inherit;">Il s'agit d'une accÃ©lÃ©ration trÃ¨s importante qui a peu d'effet sur les cartes. </font><font style="vertical-align: inherit;">Les expÃ©riences montrent clairement que le modÃ¨le n'est pas particuliÃ¨rement sensible Ã  la taille des hexagones, donc si nÃ©cessaire, je peux accÃ©lÃ©rer encore plus l'algorithme en augmentant la taille des cellules. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La prochaine fois, nous travaillerons sur l'utilisation d'un nouveau modÃ¨le de vent pour mettre en Å“uvre des modÃ¨les de vent Ã  l'Ã©chelle continentale, puis nous les connecterons au modÃ¨le de prÃ©cipitations et aux biomes.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429620/">https://habr.com/ru/post/fr429620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429606/index.html">La putain de douzaine de PM: une liste de livres pour les chefs de projet</a></li>
<li><a href="../fr429610/index.html">L'histoire de la faÃ§on d'exÃ©cuter l'Ã©mulateur Android ou d'Ã©conomiser sur le processeur Intel</a></li>
<li><a href="../fr429612/index.html">Les Fulsteks sont des MIDL Ã©ternels. Ne suivez pas ce chemin si vous ne voulez pas souffrir</a></li>
<li><a href="../fr429616/index.html">Espace de travail numÃ©rique, partie 1: Citrix</a></li>
<li><a href="../fr429618/index.html">Jeu Ã©lectronique XO</a></li>
<li><a href="../fr429622/index.html">Les robots ont remplacÃ© Amazon avec 20 000 employÃ©s</a></li>
<li><a href="../fr429624/index.html">Comment la NASA utilisera des robots pour crÃ©er du carburant de fusÃ©e Ã  partir du sol martien</a></li>
<li><a href="../fr429626/index.html">Les crackers du gÃ©nome ont montrÃ© qu'aucun ADN ne sera plus anonyme</a></li>
<li><a href="../fr429628/index.html">Comment crÃ©er un bot de chat pour VKontakte en utilisant Python, Django et webhook</a></li>
<li><a href="../fr429630/index.html">"Monstres dans les jeux ou rendre la peur diversifiÃ©e"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>