<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚔 👩🏿‍🎤 👩🏽‍🎓 Comment j'ai créé des cartes des continents pour mon jeu 👨🏻 🧒🏻 🎶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Partie 1. SVG et systèmes de coordonnées 
 Jusqu'à récemment, les tailles de carte dans mon jeu Dragons Abound étaient fixes et quelque peu non déterm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment j'ai créé des cartes des continents pour mon jeu</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429620/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png" alt="image"></div><br><h2>  Partie 1. SVG et systèmes de coordonnées </h2><br>  Jusqu'à récemment, les tailles de carte dans mon jeu <i>Dragons Abound</i> étaient fixes et quelque peu non déterministes.  Je les considérais comme «régionales» - pas des cartes du monde entier, mais ses parties importantes, comme, par exemple, la côte ouest des États-Unis ou une partie de l'Europe.  J'étais assez satisfait de cette échelle, mais je voulais expérimenter un peu avec le jeu pour voir si je pouvais générer des cartes du monde entier (ou au moins une plus grande).  Mais avant de commencer, parlons un peu des cartes du monde fantastique. <br><br>  Le monde est un grand espace.  La plupart des cartes «monde» fantastiques ne ressemblent même pas à la vraie taille.  Prenons, par exemple, la Terre du Milieu, dans laquelle se déroule l'action du Seigneur des Anneaux: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90f/bc8/9f3/90fbc89f36ab284a974be18c66909558.jpg"></div><br>  Bien qu'il semble qu'un immense monde y soit capturé, en fait, la Terre du Milieu a été créée sur la base de l'Europe. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a0/e6d/d95/7a0e6dd9576841e7ecf87babf2a66b93.webp"></div><br>  Autrement dit, la vraie carte du «monde» pour le monde de Tolkien sera environ 50 fois plus grande que la carte de la Terre du Milieu (!).  En fait, la plupart des cartes du monde fantastique que j'ai vues reflètent un territoire de la taille d'un continent: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c95/17a/90e/c9517a90ef51440cda257b2300ba591e.png"></div><br>  Cela semble être la plus grande zone bien visualisée dans un style de carte fantastique. <br><br>  Autrement dit, la tâche de générer de véritables «cartes du monde» est probablement trop ambitieuse.  Il vaut mieux viser à créer une carte du continent (ou d'une partie du continent).  (Cependant, il est encore plus pratique de considérer la carte comme la taille du "monde".) Alors, quelle taille doit avoir la carte?  Si les <i>cartes Dragons Abound</i> actuelles ont une taille «subcontinentale», nous pouvons supposer que vous devez générer des cartes 8 à 10 fois plus grandes. <br><br>  Avant de passer à la tâche de générer de grandes cartes, je dois mieux comprendre les différents systèmes de coordonnées utilisés dans mon jeu.  J'ai emprunté beaucoup de systèmes de coordonnées au code source de Martin O'Leary, et leurs interactions peuvent être déroutantes même lorsque vous travaillez avec eux pendant deux ans.  Habituellement, je pouvais le faire sans les expérimenter, mais il est évident que je devrai le faire pour générer de grandes cartes. <br><br>  Pour commencer, le «monde» de la carte régionale est en cours de génération dans un carré unitaire.  Chaque carte régionale a des coordonnées de (-0,5, -0,5) à (0,5, 0,5), et l'origine (0,0) se trouve au milieu de la région. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/201/c65/c30/201c65c30244efe1e6cd4bd47e07b901.png"></div><br>  L'une des bizarreries ici est que l'axe Y est inversé par rapport à ce que nous avons étudié en géométrie scolaire.  -0,5 est en haut de la carte et 0,5 en bas.  En infographie, l'axe Y est souvent inversé.  J'ai entendu que cela s'explique par la façon dont les premiers moniteurs (téléviseurs) ont effectué un balayage de haut en bas, c'est-à-dire que la première ligne de balayage était en haut, la suivante immédiatement en dessous, et ainsi de suite, c'est-à-dire que l'index Y des lignes de balayage est passé de zéro en haut à un certain nombre positif en bas.  Quoi qu'il en soit, le même système de coordonnées est utilisé au format SVG (Scalable Vector Graphics), c'est pourquoi <i>Dragons Abound</i> aussi. <br><br>  Ce système de coordonnées est indépendant de la façon dont la carte est affichée.  C'est juste un système sans dimension pour créer le monde - la ville est située à (0,12875, -0,223), la frontière passe de (0,337, 0,010) à (0,333, 0,017), etc.  Et bien que mes cartes régionales actuelles soient limitées à une plage de 0,5 à -0,5, ce n'est pas la limite du système de coordonnées.  Je peux créer un monde au-delà de ces frontières. <br><br>  Le prochain système de coordonnées est ce que SVG appelle viewbox.  Il définit les vraies coordonnées qui seront utilisées pour dessiner les graphiques.  Par exemple, <i>Dragons Abound</i> au début définit la zone de visualisation sur les coordonnées (-500, -500) et elle a une largeur de 1000 et une hauteur de 1000: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/509/4f4/e4f/5094f4e4f04889dcc9f389fba59d2b24.png"></div><br>  (Il y a une faute de frappe dans l'image, le haut de l'axe Y doit être -500, désolé.) <br><br>  Vous pouvez remarquer que dans ce cas, la transformation entre le premier et le deuxième système de coordonnées consiste uniquement à multiplier le tout par 1000. C'est-à-dire.  afin de dessiner quelque chose, le jeu trouve les coordonnées de cet objet, les multiplie par 1000 et dessine SVG dans ces coordonnées. <br><br>  Autrement dit, je peux utiliser les coordonnées de la fenêtre d'affichage pour me permettre de tracer une ligne de (0, 0) à (250, 250).  Mais en fait, je ne veux pas tracer une ligne de (0, 0) à (250, 250) sur l'écran de l'ordinateur.  Cela signifierait que si je veux afficher la carte à un autre endroit de l'écran, je devrai changer les coordonnées de tous les objets de la carte et les redessiner.  Ce serait un travail énorme. <br><br>  Pour contrôler les coordonnées d'affichage des graphiques à l'écran, SVG dispose d'un troisième système de coordonnées appelé viewport.  La fenêtre d'affichage est la partie de la page dans laquelle les graphiques doivent être dessinés (sur la page Web, il s'agit de l'élément &lt;svg&gt;).  Il a une largeur, une hauteur et un emplacement.  L'emplacement correspond aux coordonnées du coin supérieur gauche de la fenêtre.  Autrement dit, si je devais afficher la carte dans la fenêtre avec les coordonnées (30, 100), qui a une hauteur et une largeur de 800, le système de coordonnées de la fenêtre ressemblerait à ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/746/73e/f51/74673ef51f001d21b7871382c5dc0638.png"></div><br>  Dans SVG, la boîte de vue et la fenêtre des systèmes de coordonnées sont connectées l'une à l'autre, et SVG s'occupe lui-même de la transition entre elles.  Nous dessinons simplement dans le système de coordonnées de la fenêtre d'affichage et tout le rendu est affiché à l'emplacement de la fenêtre correspondante.  (Il y a quelques problèmes lors de la création d'une fenêtre et d'une fenêtre avec des proportions différentes. Ensuite, les objets sont soit tronqués, soit étirés, selon la valeur de l'attribut <code>preserveAspectRatio</code> . Je recommande de ne pas le faire du tout.) <br><br>  Pour résumer: une ville située dans les coordonnées mondiales (0,10, 0,33) est dessinée en coordonnées (100, 330) et affichée à l'écran en (110, 764). <br><br>  Vous pouvez maintenant comprendre pourquoi cela peut prêter à confusion! <br><br>  Que se passe-t-il si je modifie chacun de ces systèmes de coordonnées?  Supposons que dans le premier système de coordonnées, je vais générer un monde allant de -0,25 à 0,25 sur chaque axe.  Le monde résultant sera alors quatre fois plus petit que le monde habituel et ne remplira que la partie centrale de la fenêtre: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/894/11c/6c2/89411c6c2b1975f8512548a487191648.png"></div><br>  (Vous pouvez également remarquer des artefacts sur les bords, qui sont généralement cachés.) De même, si je double la taille du premier système de coordonnées (SK), nous ne verrons pas la majeure partie de la carte, car elle sera située à l'extérieur des bords de la fenêtre. <br><br>  Que se passe-t-il si je double la taille de la fenêtre d'affichage?  Eh bien, si je double également le rapport entre le premier SC et la viewbox (de 1000 à 2000), alors rien ne changera beaucoup.  Si le rapport reste égal à 1000, la carte sera à nouveau divisée par deux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/859/f79/dfe/859f79dfe453741087cedce2d6918e16.png"></div><br>  Cependant, cette fois, la carte a une zone initiale de 1x1.  Nous pouvons à nouveau remarquer des artefacts aux bords qui sont généralement cachés (par exemple, des parties convexes de forêts).  Vous pouvez également voir que le modèle de l'océan est incorrect - je dois avoir câblé certaines hypothèses sur la taille de la fenêtre d'affichage.  De plus, il semble que la boussole ne se trouve pas sur le coin de la carte, mais sur le coin de la fenêtre d'affichage. <br><br>  Et vice versa, si je réduis de moitié la taille de la fenêtre d'affichage, cela créera un effet de zoom sur la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26e/f0e/f8e/26ef0ef8e0a2db5298de4720d12193fe.png"></div><br>  Ici, nous ne voyons que le quart médian de la carte.  Ce n'est pas un moyen très pratique de zoomer, car seule la moitié de la carte affiche des problèmes - par exemple, le marqueur de ville «South Owenson» est allé au-delà de l'écran.  De plus, cela double la taille des polices et d'autres choses dont je n'ai pas besoin. <br><br>  Un aspect plus utile de la fenêtre d'affichage est de modifier l'origine.  Jusqu'à présent, la fenêtre d'affichage était centrée sur la carte, mais ce n'est pas nécessaire.  Par exemple, je peux déplacer la carte vers la droite en centrant la fenêtre d'affichage sur un point sur le côté gauche de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/970/bbf/662/970bbf662eb73852a4140af450c48fb8.png"></div><br>  Nous pouvons à nouveau remarquer les effets sur les frontières et certains autres problèmes, mais essentiellement la carte s'est déplacée vers la droite.  L'utilité de cela peut ne pas être évidente, mais imaginez que je vais générer une carte dont la largeur est le double de la largeur d'une carte normale.  Par défaut, cela ressemble à ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/fee/3ad/327fee3add9790b0a73a32d7e1ee04cf.png"></div><br>  Cela ressemble à n'importe quelle autre carte, mais en réalité ce n'est que la partie centrale d'une carte plus grande.  Autrement dit, je peux maintenant modifier la fenêtre d'affichage pour transférer d'autres parties de la carte dans la fenêtre de vue d'ensemble: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png"></div><br>  Ici, j'ai déplacé le point de vue vers la gauche, nous voyons donc une partie du monde à l'est de la vue d'origine.  Certains noms sur la carte ont changé car <i>Dragons Abound</i> remplit certaines fonctions (par exemple, donne des noms aux objets) selon qu'ils sont visibles.  Je vais devoir changer cela pour que lors du déplacement de la fenêtre d'affichage, la carte reste constante.  Cependant, plus tard, je pourrai déplacer la fenêtre d'affichage sur une grande carte et générer des cartes régionales de toute zone souhaitée.  Autrement dit, je peux générer et afficher de grandes cartes de la taille d'un continent, mais je peux également générer des cartes régionales de zones au sein d'une grande carte. <br><br>  Pour résumer: le jeu utilise trois systèmes de coordonnées.  Le premier est un SC abstrait pour les objets du monde.  La seconde est la fenêtre de visualisation, elle définit la zone visible du monde.  La troisième est la fenêtre, elle contrôle où la carte sera dessinée à l'écran.  Pour dessiner un monde plus grand, j'ai besoin d'étendre le premier SC.  Pour afficher plus à l'écran, vous devez agrandir la fenêtre d'affichage.  Je peux également déplacer la fenêtre d'affichage pour afficher différentes parties du grand monde. <br><br><h2>  Partie 2. Rendre les cartes permanentes </h2><br>  Dans la partie précédente, j'ai exploré les systèmes de coordonnées et appris à déplacer la fenêtre SVG pour n'afficher que des parties individuelles du grand monde.  Cependant, cette approche a quelques problèmes, car plus tôt j'ai supposé que tout ce qui nous était invisible n'a pas d'importance.  Dans cette partie, je vais éliminer ces hypothèses afin qu'il soit possible de générer et de visualiser différentes parties de grandes cartes immuables. <br><br>  Le problème du placement des noms, que j'ai décrit dans la partie précédente, est évidemment perceptible sur ces deux types de carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/fee/3ad/327fee3add9790b0a73a32d7e1ee04cf.png"></div><br>  Voici le même monde, seule la vue est décalée vers la gauche: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png"></div><br>  Vous remarquerez peut-être que la géographie est la même, mais de nombreux noms ont changé.  Étant donné que dans deux types différents objets sont visibles et que le processus de création de noms est contrôlé par des nombres aléatoires, des noms différents sont obtenus. <br><br>  En regardant le code, j'ai constaté que presque tous les objets sont nommés en fonction de leur visibilité.  Mais il n'y a qu'une seule exception qui rend difficile de donner des noms à tous les objets suivants.  Dans notre cas, l'exception est que <i>Dragons Abound</i> ne génère que des côtes visibles.  Les raisons de cela sont très déroutantes.  En fait, il y a un «littoral» le long du bord entier du monde, mais la création de cette ligne détruit une partie de la logique du programme, car elle embrasse le monde entier.  Pour éviter cela, je viens de générer uniquement le littoral visible.  Maintenant que la carte peut s'étendre bien au-delà de la fenêtre, cette solution ne semble pas bonne.  Au lieu de cela, je dois arrêter de générer des côtes lorsque je me rapproche du bord réel de la carte.  (Ce que je laisse toujours hors écran pour masquer les problèmes sur les bords.) <br><br>  Après avoir éliminé ce problème, les noms sur les deux cartes restent constants: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/39b/908/a83/39b908a83146f3161397cda6fbcba045.png"></div><br>  et: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6af/322/ad4/6af322ad4cb57591a51748243a8ac02e.png"></div><br>  Autre remarque pour l'avenir: si j'utilise la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonction d'interactivité</a> pour changer les noms des objets de carte, ce changement ne sera pas recréé sous sa forme actuelle, et ne sera probablement même pas reproductible.  Ça vaut la peine d’y penser. <br><br>  Si vous regardez attentivement la carte précédente, vous pouvez voir que la zone océanique près de la partie centrale inférieure de la carte a une étiquette suspendue «Meb Island».  Cela est arrivé parce que <i>Dragons Abound</i> croit réellement que la région de l'océan est une île.  Je n'entrerai pas dans les détails techniques, mais il est étonnamment difficile de distinguer les îles des lacs lorsqu'ils dépassent la carte.  L'algorithme porte à confusion avec le changement que j'ai apporté à la génération de côtes invisibles, et pour éviter de tels problèmes, cela doit être corrigé. <br><br>  Maintenant, quadruplons la taille de la carte et n'en affichons qu'un quart dans la fenêtre de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f40/81f/8d4/f4081f8d4d2ac9dd3d7d35077ba23450.png"></div><br>  En général, tout semble bon (il y a un système de rivières intéressant sur la carte, un grand lac, mais vous pouvez voir que les villes sont très rares. C'est arrivé parce que <i>Dragons Abound</i> génère 10-20 villes. Cet intervalle est bien adapté pour un monde de taille normale, mais mauvais, lorsque la taille est quatre fois plus grande. Par conséquent, l'intervalle doit être modifié en fonction de la taille relative du monde. Probablement, cela doit être fait à plusieurs endroits. <br><br>  Voici la même carte après avoir résolu le problème: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/821/113/b40/821113b400ab683c8fdfad87bccf3213.png"></div><br>  Maintenant, sur la carte, il y a un nombre plus logique de villes et villages, mais cela nous montre un autre problème.  Vous pouvez voir beaucoup de noms supplémentaires sur les bords de la carte, par exemple, Nanmrummombrook, Marwynnley et Noyewood dans le coin inférieur gauche.  Cela se produit car la méthode du code de placement essaie de les placer là où ils sont visibles.  Auparavant, cette procédure n'avait jamais à se soucier des étiquettes en dehors de l'écran, car dans les cartes de taille régionale, le monde entier est généralement visible.  Mais maintenant, il peut y avoir des villes et d'autres objets situés hors de l'écran.  Par conséquent, je dois ajouter une logique à la procédure de placement d'étiquette qui n'essaie pas de créer des étiquettes pour les objets de carte invisibles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b9d/022/b5a/b9d022b5a3c22d9f7e1f4c5e7c24771e.png"></div><br>  Maintenant, l'image est plus logique.  À droite, Cumden est à peine visible sur la carte, mais l'étiquette est toujours située là où elle est visible. <br><br>  Il y a un aspect qui n'est pas immédiatement perceptible sur les grandes cartes: le nombre d'emplacements dans le monde n'a pas changé.  Bien que la carte (dans un sens) soit devenue 4 fois plus grande, sa superficie totale est toujours limitée par le même nombre d'emplacements.  L'étape initiale de la génération de la carte était de couvrir le monde avec un diagramme de Voronoi avec un nombre constant d'emplacements.  Autrement dit, lorsque la carte devient plus grande, les cellules de Voronoi deviennent également plus grandes. <br><br>  Il serait logique de mettre à l'échelle le nombre d'emplacements en fonction de la taille de la carte, mais malheureusement, la dépendance de la vitesse d'exécution de <i>Dragons Abound</i> sur le nombre d'emplacements est bien pire que linéaire, c'est-à-dire que générer une carte avec un grand nombre d'emplacements peut prendre beaucoup de temps.  Voici un exemple de carte avec une résolution quadruple (nombre d'emplacements): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4bc/faa/7a6/4bcfaa7a64abf56cb1cf4aab84651215.png"></div><br>  Les emplacements ajoutés modifient le processus de génération, le terrain est donc différent des cartes illustrées ci-dessus, mais vous pouvez y voir les détails supplémentaires sur les côtes. <br><br>  Heureusement, lors du profilage des performances de génération de grandes cartes, j'ai remarqué que la majeure partie du temps processeur est occupée par des problèmes évidents.  Après le débogage, j'ai éliminé les plus dérangeants, ce qui m'a permis de créer encore plus de cartes.  Voici la carte 4x entière: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/149/6f4/600/1496f4600dc18c1ffa955580e07d7161.png"></div><br>  Zoom de 25% effectué.  Cela ressemble à peu près à la taille maximale de la carte que Chrome peut afficher.  La procédure de génération mondiale peut traiter des cartes plus grandes, mais en essayant de les afficher, le navigateur se bloque.  En ce sens, Firefox semble être plus fonctionnel;  Il peut afficher des cartes 9 fois plus grandes que la taille d'origine.  Voici une partie d'une telle carte - je l'ai laissée en taille réelle, vous pouvez donc l'ouvrir dans une fenêtre séparée pour mieux comprendre la taille et les détails. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/1a2/c98/15f1a2c98b85e749101f0a379e7b9937.png"></div><br>  Firefox est capable de générer des cartes de cette taille, mais je ne peux prendre des captures d'écran qu'à la taille maximale de la fenêtre du navigateur.  J'ai une fonction pour enregistrer la carte en tant que fichier PNG, mais elle ne peut enregistrer que la partie affichée de la carte.  Je pense que vous pouvez faire défiler la carte, capturer des écrans individuels et les connecter ensemble, mais cela prendra du temps. <br><br>  La meilleure solution consiste à enregistrer le SVG lui-même afin qu'il puisse être ouvert dans un programme comme Inkscape. <br><br>  Auparavant, je pouvais couper et coller des cartes SVG dans Inkscape, mais les SVG pour les cartes du monde sont si gros que lorsque j'essaie de couper le navigateur, il se bloque!  Heureusement, j'ai trouvé <a href="">FileSaver.js</a> et vous pouvez l'utiliser pour enregistrer le SVG directement dans un fichier, puis l'ouvrir dans Inkscape, créant ainsi une très grande image. <br><br>  Du moins théoriquement.  Lorsque j'essaie d'ouvrir ces cartes dans Inkscape, je rencontre quelques problèmes. <br><br>  Le premier problème est que les hypothèses d'Inkscape sont différentes des hypothèses de Chrome et Firefox sur la façon d'ouvrir SVG.  En particulier, si la couleur de remplissage n'est pas spécifiée dans le chemin, les navigateurs supposent qu'il n'y a pas de remplissage;  Inkscape suppose que le contour est rempli de noir.  Par conséquent, lorsque j'ouvre le SVG enregistré dans Inkscape, il est presque entièrement noir, car la couche supérieure de la carte ne contient pas de couleur de remplissage.  Cela peut être résolu en spécifiant «fill: none» aux endroits nécessaires afin que les contours apparaissent également dans le navigateur et Inkscape. <br><br>  Le deuxième problème est qu'Inkscape a des erreurs dans le traitement des masques.  Inkscape semble créer des masques avec un seul élément et gère mal les masques avec plusieurs éléments.  <i>Dragons Abound</i> crée de nombreux masques avec plusieurs éléments.  Vous pouvez contourner ce problème en regroupant tous les éléments de chaque masque de jeu en un seul élément de groupe (facultatif). <br><br>  Le troisième problème est lié aux images et autres ressources téléchargeables.  Dans le SVG d'origine, les références à celles-ci sont indiquées sous une forme relative, par exemple, «images / background0.png».  Mes sources sont organisées de manière à ce que le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">serveur Web distinct que j'utilise</a> puisse trouver ces ressources aux endroits spécifiés.  Lorsque je prends le même SVG et que je l'ouvre dans Inkscape, ces chemins relatifs sont traités comme l'URL «fichier:» et Inkscape recherche des ressources par rapport au dossier dans lequel le SVG a été enregistré.  Ce problème peut facilement être contourné en enregistrant le SVG dans un dossier dans lequel il existe déjà des ressources aux bons endroits;  il peut s'agir du même dossier racine utilisé par le serveur Web, ou d'un autre emplacement dans lequel se trouvent des copies de ressources sur les mêmes chemins (relatifs). <br><br>  Le quatrième problème concerne les polices.  <i>Dragons Abound</i> utilise à la fois des polices Web et des polices stockées localement;  les deux au format WOFF2.  Dans le navigateur, elles sont appliquées au texte en utilisant le style de famille de polices CSS, et avant de générer la carte, toutes les polices possibles sont téléchargées sur la page Web pour être prêtes à l'emploi.  Lorsque le même fichier est ouvert dans le jeu, il recherche les polices dans le répertoire des polices système et il semble qu'aucun autre répertoire de polices ne puisse être spécifié de quelque manière que ce soit.  Une solution simple (au moins sur la machine sur laquelle je développe) consiste à installer les polices utilisées par le jeu dans le répertoire des polices système.  Cependant, ce n'est pas aussi simple qu'il y paraît, car les noms de police doivent correspondre, et sous Windows, il n'existe aucun moyen facile de modifier le nom de la police.  Mais, bien sûr, un tel schéma ne fonctionnera pas sur les ordinateurs sur lesquels toutes les polices nécessaires ne sont pas installées.  Une solution plus portable consiste à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">incorporer des polices SVG dans les cartes</a> .  Ce sera sur ma liste TODO. <br><br>  À la fin, je suis arrivé à cette interface de génération de carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/e69/c3b/88ee69c3b069b7c369cbf3921b6a3eba.png"></div><br>  Les champs de saisie étendus spécifient la taille totale du monde, où 1x1 est la taille des cartes sources.  La taille de vbx (viewbox) détermine la taille d'un fragment du monde affiché sur la carte;  dans la capture d'écran, il a également une valeur de 1x1, c'est-à-dire que la carte affichera le monde entier.  Les champs du centre vbx spécifient l'emplacement du centre de la carte dans le monde;  0, 0 est le centre du monde.  Enfin, les paramètres SVG spécifient le nombre de pixels d'écran pour 1 unité de taille de zone de visualisation;  à une valeur de 775, une carte 1x1 sera affichée à l'écran au montant de 775x775 pixels.  C'est pratique lorsque je crée une très grande carte.  En définissant le paramètre sur une valeur faible (par exemple, 150 pixels), je peux adapter une grande carte à l'écran dans son ensemble. <br><br>  En modifiant ces six paramètres, je peux contrôler la taille du monde et la fraction du monde qui est affichée sur la carte.  Le bouton Générer fonctionne exactement comme vous pouvez le deviner;  le bouton Afficher affiche simplement une partie du monde, c'est-à-dire que je peux générer un monde, puis afficher ses parties individuelles, en modifiant les paramètres de la zone de visualisation sans avoir à recréer le monde.  (Un programmeur implémenterait mieux cela comme mise à l'échelle et défilement.) Le bouton Enregistrer PNG enregistre la carte visible sous forme de fichier PNG;  Le bouton Enregistrer SVG enregistre le fichier SVG de la carte entière.  Le bouton Test It est utilisé pour exécuter le code de test, qui change au cours du développement de diverses fonctions. <br><br>  Maintenant que je peux générer et refléter toutes les parties du grand monde, je peux passer à l'adaptation de la forme du terrain à des cartes plus grandes. <br><br><h2>  Partie 3. Formes de sushi </h2><br>  Après avoir apporté diverses modifications dans la partie précédente, je peux maintenant générer des mondes beaucoup plus grands que les précédents (jusqu'à 8 fois plus) et les enregistrer en tant que grandes images graphiques: <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/963/31e/c94/96331ec940b59a6f349603f0024f5cc7.png"></a> </div><br>  (Ouvrez l'image dans une fenêtre séparée pour voir la carte en pleine résolution 4800x2400 sur Flickr.) <br><br>  Je génère ces cartes en utilisant la même génération procédurale qui a créé les cartes régionales.  La carte ci-dessus a une forme continentale assez régulière et quelques îles extérieures intéressantes.  Cependant, cela dépend principalement de la chance.  Voici une autre carte: <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/b03/406/fd1/b03406fd17f93c9e33cd8dd488b404c3.png"></a> </div><br>  Cette carte est juste le chaos des îles et du fromage à sushi suisse. <br><br>  Voici un autre exemple, quelque chose entre les deux cartes précédentes.  Ce n'est pas complètement réaliste, mais cela peut être intéressant pour un environnement fantastique: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/7c3/c79/e98/7c3c79e98246dde23f7104428e9cf9b2.jpg"></a> </div><br>  Il s'agit d'une énorme masse continentale de terres, mais il existe de nombreuses formes de terres étranges et, en général, le monde ne semble pas tout à fait «réel».  (Bien que pour quelqu'un, un tel monde semble tout à fait approprié pour la fantaisie.) Alors, quelles formes devrait avoir la carte du «monde»? <br><br>  La plupart des cartes du monde fantastique que j'ai vues représentent un grand continent insulaire (avec de petites îles autour), par exemple, comme cette carte d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Andelen</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/926/3f4/fb8/9263f4fb80cf2899f48693c31aa2566a.png"></div><br>  Ou la péninsule du continent, comme sur cette carte d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Angorun</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75c/ef4/bc1/75cef4bc1d0e698c2a76ee77bfc74bd0.png"></div><br>  De temps en temps, une carte est entièrement composée de terres ou de plusieurs continents insulaires, mais ils sont plus susceptibles d'être des exceptions à la règle. <br><br>  Pour commencer, imaginons la génération des continents «insulaires».  Comme il se trouve dans mon jeu, il y avait déjà une fonction qui génère un grand îlot central sur la carte en tenant compte de la taille de la carte, elle devrait donc être adaptée pour générer la forme principale du continent.  Le bruit et les îles supplémentaires s'occuperont du reste. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a7/86e/0b5/0a786e0b59241b451f3c225c23328a47.png"></div><br>  Je ne m'attendais pas à une grande mer centrale sur cette carte, mais c'est une agréable surprise.  Voici un autre exemple: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f58/a14/788/f58a14788a7dbcd6fbaa25c9fb45457e.png"></div><br>  Le problème avec la fonction de l'îlot central est qu'il commence par un cercle qui convient aux cartes carrées que j'ai montrées, mais pas très bon pour les cartes rectangulaires.  (Vous trouverez ci-dessous des exemples avec une petite distorsion, afin que les formes de base soient plus clairement visibles.) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30b/b43/073/30bb430737122e671fb2f2067fafea08.png"></div><br>  Ceci est facilement corrigé en masquant les sushis au lieu d'un cercle avec une ellipse (déformée) prise par la taille de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/393/7a9/2ea/3937a92ea08cd752739550bf59a89971.png"></div><br>  Ces îles centrales sont dimensionnées pour remplir la carte, mais dans de nombreux cas, pour les cartes continentales, nous devons laisser une «frontière» autour du continent.  Deux paramètres contrôlent la taille de la carte remplissant l'île le long des axes X et Y. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad4/b00/94e/ad4b0094e542930350a964377888a640.png"></div><br>  Voici le même système de gestion des frontières avec des distorsions plus logiques: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/357/9e1/121/3579e11217c879a587f11b30380e94b9.png"></a> </div><br>  On peut voir que les parties est et ouest de la carte restent l'océan.  (Vous pouvez ouvrir la carte dans une fenêtre séparée pour l'étudier plus attentivement.) Cela signifie que la carte affiche le monde entier (et ses bords droit et gauche peuvent être connectés) ou une partie du monde qui peut être connectée à une autre carte qui a également un océan à partir du bord correspondant. <br><br>  Un lecteur attentif qui a étudié la carte précédente a peut-être remarqué que les motifs de l'océan et de la terre s'arrêtent au milieu de la carte.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auparavant, je n'avais que des cartes de taille 1x1, de sorte que les tailles des motifs de l'océan et de la terre étaient adaptées à ces cartes. Sur les cartes plus grandes, j'ai besoin de carreler manuellement les motifs sur la carte, j'ai donc ajouté cette fonctionnalité. (Il existe un moyen en SVG pour effectuer un mosaïque de motifs, mais dans Chrome, il contient un bogue, donc je ne peux pas l'utiliser.) C'est une bonne fonctionnalité, car maintenant je peux utiliser des motifs terrestres et océaniques plus petits qui se tuileront automatiquement. Je ne sais pas pourquoi je ne m'en étais pas rendu compte avant! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, maintenant les continents insulaires fonctionnent bien, et nous allons passer à la mise en œuvre des continents «péninsulaires» - des cartes dans lesquelles le continent apparaît sur la carte depuis son bord.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9e/d75/914/d9ed75914bd6b4deaae08fb687b828e2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, le continent ne peut pas s'effondrer sur trois bords. </font><font style="vertical-align: inherit;">Mais la caractéristique principale de ces cartes est qu'elles ont une connexion terrestre significative entre le continent affiché sur la carte et la terre en dehors de la carte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le moyen le plus simple de fournir une telle connexion en dehors de la carte est de définir un niveau bas de la mer pendant la génération. </font><font style="vertical-align: inherit;">Nous allons donc augmenter la zone de terre affichée sur la carte, ce qui augmente la probabilité de grandes masses de terre et la présence de terres (plutôt que la mer) le long des bords de la carte.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/24d/adb/522/24dadb52258988326f096336470d97c3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bien sûr, cela ne garantit pas que la masse de terre sera très intéressante, et en effet elle sera unifiée: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0b/c22/335/c0bc223356225dea02bfbd773495f36e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La similitude d'un seul continent peut être créée en utilisant la même génération du continent insulaire, mais en déplaçant en même temps l'île au bord de la carte. </font><font style="vertical-align: inherit;">Vous obtenez quelque chose comme ça:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/209/981/20e/20998120e01c4c48f53419855cf6f703.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On peut voir que le continent (principalement) est l'île centrale, décalée vers le haut et vers la droite. </font><font style="vertical-align: inherit;">Comme il s'agit d'un continent et qu'il n'est pas nécessaire de conserver une forme d'île stricte, vous pouvez ajouter plus de distorsion à la forme.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5f/000/523/e5f00052339289e504ffcd82b7481545.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Évidemment, il existe de nombreuses autres approches pour la génération de secours, mais ces deux, au moins, me donnent l'occasion de générer les formes de terres les plus courantes à l'échelle continentale. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un lecteur attentif a pu remarquer les formes étranges de forêts sous forme de rayures sur de nombreuses cartes des continents. </font><font style="vertical-align: inherit;">La prochaine fois, je commencerai à traiter les problèmes des modèles de vent et des biomes qui causent ces bizarreries.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Partie 4. Modèle de vent </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme indiqué, la taille des continents sur les cartes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> commencé à montrer des modèles irréalistes de temps et de biomes. Cet exemple montre que la forêt est alignée le long de la direction du vent dominant:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/209/981/20e/20998120e01c4c48f53419855cf6f703.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La raison n'est pas dans le code cassé; les modèles météorologiques et de biome sont plutôt trop simples, et à grande échelle, cela devient apparent. Pour faire face à ces problèmes, j'ai commencé par réviser le modèle de vent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'aimerais que mon modèle de vent reflète mieux la dynamique du vent de la Terre: les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cellules de Hadley</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les alizés</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et autres. Une telle dynamique peut aider à éliminer les modèles météorologiques étranges sur les cartes continentales. Cependant, quand ils ont été ajoutés, une insatisfaction douloureuse avec le modèle de vent </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lent et trop compliqué </font><font style="vertical-align: inherit;">, a de nouveau été révélée </font><font style="vertical-align: inherit;">. (Lisez ici la mise en œuvre initiale du modèle éolien </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.) Après avoir réfléchi à cela pendant plusieurs jours, j'ai décidé que la plupart des problèmes se résument au fait que la carte du jeu est présentée sous forme de diagramme de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voronoi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . (Ou plutôt, la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">triangulation de Delaunay du</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diagramme de Voronoi.) Il présente de nombreux avantages lors de la génération de terrain - en combinaison avec le bruit, il peut créer des masses terrestres d'aspect naturel. C'est pourquoi il est si souvent utilisé pour générer un soulagement. Mais comme les triangles individuels ont des tailles et des orientations différentes, tous les calculs, y compris les modèles de vent qui utilisent des cellules voisines voisines, deviennent assez compliqués. Il sera beaucoup plus facile de modéliser le vent à travers une grille de zones identiques régulièrement espacées. De plus, le modèle éolien n'a probablement pas à être aussi détaillé que le terrain.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais je ne veux pas abandonner complètement le diagramme de Voronoi qui sous-tend les </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . (Au minimum, cela nécessitera la réécriture de presque tout le programme!) Au lieu de cela, je veux expérimenter avec la liaison de la carte à une grille uniforme, exécuter le modèle de vent dedans, puis effectuer la liaison inverse. Si la perte de copie dans les deux sens n'est pas trop importante, cela peut rendre le modèle de vent plus rapide et plus facile. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle grille dois-je utiliser? Idéalement, la grille devrait être constituée de zones égales à égale distance de ses voisins. Et cette description est comme une grille d'hexagones.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/720/948/12a/72094812ad2adea8d6d71fa795146c44.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, une grille d'hexagones est le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meilleur moyen de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diviser une surface plane en zones égales. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'étape suivante consiste à déterminer comment représenter la grille d'hexagones dans mon programme. J'ai cherché un peu sur le réseau pour obtenir de l'aide, et chaque lien me renvoyait à la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page sur les grilles des hexagones d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Amit Patel ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traduction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en Habré). Probablement, il faut commencer par cela; Il est également bon d'explorer d'abord le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site Web des jeux Red Blob</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si vous recherchez des informations sur la mise en œuvre des mécanismes de jeu. Amit explique mieux que moi, donc si quelque chose n'est pas clair, alors lisez sa page.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le premier choix à faire est la manière de stocker la grille d'hexagones. </font><font style="vertical-align: inherit;">Le moyen le plus simple consiste à le stocker sous forme de tableau à deux dimensions, puis j'ai besoin de pouvoir lier les cellules de la grille au tableau. </font><font style="vertical-align: inherit;">Il existe de nombreuses options ici (lire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la page d'Amit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mais j'utiliserai ce qu'il appelle odd-r:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e9c/a08/6bb/e9ca086bb2e5957db58d021c302c27f4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les nombres dans chaque cellule sont les indices de la cellule dans le tableau à deux dimensions. </font><font style="vertical-align: inherit;">(L'image est volée sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la page</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Amit</font></a><font style="vertical-align: inherit;"> . Sur sa page, elles sont interactives, donc je vous conseille de les expérimenter.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Après avoir fait un choix, je dois maintenant apprendre à attacher des index à une grille d'hexagones. </font><font style="vertical-align: inherit;">Par exemple, si je recherche une cellule hexagonale (3, 3), quels seront ses voisins? </font><font style="vertical-align: inherit;">Si chaque cellule a une largeur de 5 pixels, alors quelles seront les coordonnées du centre de la cellule (3, 3)?</font></font> Et ainsi de suite.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gérer cela peut être difficile, donc je suis content qu'Amit l'ait fait pour moi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En supposant que nous pouvons voler tout ce dont nous avons besoin à Amit, je dois d'abord comprendre comment organiser les hexagones sur la carte. À ce stade, je n'ai pas encore besoin d'un tableau, je peux prétendre qu'il l'est et voir où seront les hexagones. Si je connais l'emplacement des hexagones, je divise simplement la largeur de la carte par la distance horizontale entre eux pour obtenir le nombre de colonnes, et je fais de même verticalement pour obtenir le nombre de lignes, après quoi je dessine un hexagone à chaque endroit:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ba/0e2/d39/7ba0e2d39d51e3ea0584734fbb584f19.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ces hexagones sont beaucoup plus grands que ceux que j'utiliserai pour le modèle de vent, mais ils me montrent que tout est correctement placé. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, j'ai ouvert les bords de la carte et dessiné uniquement l'hexagone central et aux frontières pour vérifier si je ferme vraiment la carte entière:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f99/733/2a0/f997332a08696203af9e4cf044cf07cd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le haut et le bas sont en dehors de la carte, mais la présence de plusieurs cellules à l'étranger n'est pas importante si je ne manque pas une partie de la carte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'étape suivante consiste à créer un tableau pour la grille d'hexagones et à aligner tous les triangles de Delaunay sur les hexagones correspondants. Étant donné que Javascript ne prend pas en charge </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les index négatifs des tableaux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , je dois déplacer la cellule (0, 0) du centre de la carte vers le coin supérieur droit. Cela fait, je fais le tour de tous les triangles de Delaunay et je les ajoute aux cellules correspondantes de la grille hexagonale. Je peux le vérifier en coloriant les hexagones contenant du terrain:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/848/f2e/1b7/848f2e1b78edb9dbfb91abdbff1bcf56.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour déterminer si une cellule est un terrain, je fais la moyenne de la hauteur de tous les emplacements qui tombent dans cette cellule. </font><font style="vertical-align: inherit;">Vous remarquerez peut-être que pour certains hexagones côtiers, la moyenne est inférieure à zéro, même en présence de terre. </font><font style="vertical-align: inherit;">Vous pouvez également utiliser la hauteur maximale de tous les emplacements dans l'hexagone:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66b/041/254/66b0412544abda9d618ab32784bd9ec8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, la recherche a lieu dans la direction opposée - l'hexagone est marqué comme terrain s'il y a du terrain dedans. </font><font style="vertical-align: inherit;">Ce qui est mieux dépend de ce dont vous avez besoin. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans tous les cas, je peux augmenter la précision en réduisant la taille des hexagones:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c3b/0e7/1ec/c3b0e71ecf56429e04ea02a771b3a044.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, la côte s'est beaucoup améliorée, mais un nouveau problème est apparu - de nombreux hexagones internes qui ne sont pas considérés comme des terres. Cela se produit parce que lorsque les hexagones deviennent suffisamment petits, à l'intérieur de certains d'entre eux, il n'y a aucun triangle de Delaunay. Par conséquent, ils n'ont pas de «hauteur». (Cela montre également l'inégalité des triangles de Delaunay.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez utiliser cette solution - prendre la hauteur des triangles manquants comme la moyenne de leurs voisins, ou comme un maximum de leurs voisins.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d51/ad8/30f/d51ad830fd84fa509f8f47c40b730f07.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En général, lorsque la liaison entre les hexagones et les emplacements n'est pas un à un, des corrections sont nécessaires pour remplir les informations manquantes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant que j'ai posé la grille d'hexagones sur la carte, nous pouvons commencer à implémenter le modèle de vent. L'idée principale du modèle de vent est de simuler certains vents (alizés) et de les répartir sur toute la carte jusqu'à ce qu'ils atteignent un état d'immobilité. Au niveau des hexagones (ou au niveau des emplacements, si je le fais sur les triangles de Delaunay), cela comprend deux étapes: (1) nous résumons tous les vents entrant dans l'hexagone actuel, et (2) nous déterminons comment le vent sommé quitte l'hexagone.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La première étape est assez simple. </font><font style="vertical-align: inherit;">Chaque hexagone a six voisins et chacun de ces hexagones contribue. </font><font style="vertical-align: inherit;">Si nous considérons chacun des vents entrant dans l'hexagone comme un vecteur, alors le vent total dans la cellule sera la somme de ces vecteurs, c'est-à-dire </font><font style="vertical-align: inherit;">deux vents strictement opposés de force égale s'annulent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La deuxième étape (déterminer comment le vent total quitte l'hexagone) nécessite une réflexion. </font><font style="vertical-align: inherit;">Le cas le plus simple est le vent qui souffle directement à travers l'hexagone:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e8a/982/d5a/e8a982d5af635e1fbee1e82f20c1990d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, nous nous attendons à ce que le vent se déplace vers la cellule suivante sans changements. </font><font style="vertical-align: inherit;">(Ici, le vecteur rouge est le vent d'origine et le bleu est le vecteur du vent se propageant.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais que se passe-t-il si le vent ne souffle pas directement sur la cellule voisine?</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cd/396/196/3cd3961960c15fa86e60cd421336e23d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, il semble logique qu'une partie du vent souffle dans l'hexagone directement au-dessus de lui, l'autre partie dans la cellule située dans le sens antihoraire de celle-ci, et les proportions devraient dépendre de la direction dans laquelle la flèche pointe. </font><font style="vertical-align: inherit;">Dans notre cas, la partie principale du vent se déplacera vers la cellule supérieure, et moins vers la cellule voisine. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est également nécessaire de décider de la direction du vent qui se propage. </font><font style="vertical-align: inherit;">Une option consiste à maintenir la direction du vent d'origine:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e31/e3f/6ef/e31e3f6ef05e18991e2e48462e47a05b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il semble que ce soit l'option la plus réaliste, mais il y en a une autre - pour changer la direction du vent en fonction du bord de l'hexagone qu'il intersecte: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/96b/caa/11d/96bcaa11d738b2468eccd1ea758b9e8d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette approche est moins précise, mais présente un avantage: les vents entrants seront toujours dans l'une des six directions, ce qui peut simplifier les calculs. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre difficulté survient lorsque l'on considère le terrain. </font><font style="vertical-align: inherit;">Que doit-il se passer lorsqu'une montagne se lève dans le vent?</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a95/c03/492/a95c0349265fe5581df74ebb33bbd4f5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dans ce cas, une partie du vent passe au-dessus de la montagne (créant éventuellement des précipitations), mais une partie du vent se tourne sur les côtés. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5f4/e8b/fe3/5f4e8bfe34c0e0a8fd7a9bb784487ad9.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par conséquent, la façon dont le vent sort de l'hexagone dépend de sa direction, ainsi que de la topographie des cellules voisines. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parlons maintenant de la façon de représenter les vecteurs. </font><font style="vertical-align: inherit;">Il existe deux options principales. </font><font style="vertical-align: inherit;">Tout d'abord, un vecteur peut être représenté par des valeurs X et Y, par exemple comme ceci:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/253/4da/c67/2534dac673d43b8bf4d93f70254e540a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nous dessinons un vecteur commençant à (0, 0), alors (X, Y) sont les coordonnées des points finaux. </font><font style="vertical-align: inherit;">Un tel enregistrement facilite la somme des vecteurs. </font><font style="vertical-align: inherit;">Nous additionnons simplement toutes les valeurs (X, Y) et obtenons un nouveau vecteur:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9fd/b4c/427/9fdb4c427518523698ec72c34b854059.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une autre option consiste à utiliser l'angle et la longueur du vecteur: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c43/421/9c9/c434219c9ba69e9a29b5d73b665d5e96.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sous cette forme, il est facile d'effectuer des opérations telles que la rotation de vecteurs ou la modification de sa longueur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour la majorité des opérations requises dans le modèle éolien, la première option est meilleure, mais dans certains cas, la seconde est meilleure, il serait donc pratique de basculer entre elles si nécessaire. </font><font style="vertical-align: inherit;">Afin de ne pas réinventer la roue, j'ai recherché une bibliothèque vectorielle pour Javascript et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Victor.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> complètement </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">montée</font></a><font style="vertical-align: inherit;"> , alors j'en ai profité. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je vais commencer par ajouter un vecteur vent à chaque hexagone et voir si je peux le visualiser:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9e/1a2/b49/d9e1a2b49e115bbc4436a8e518164adb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il semble bon jusqu'à présent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'étape suivante consiste à vérifier si je peux correctement diviser le vecteur vent et le distribuer à la cellule suivante. Tout d'abord, vous devez calculer les angles menant aux autres cellules. J'ai retrouvé la réponse sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la page d'Amit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f2/f9d/4a9/9f2f9d4a9c349dbb47ff2dc32ede0ff8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est-à-dire qu'un vecteur à 0 degré pointe vers un hexagone à droite, à 60 degrés - vers un hexagone en bas à droite, et ainsi de suite. Un vecteur pointant entre ces deux directions est divisé proportionnellement entre deux cellules - c'est-à-dire qu'un vecteur à un angle de 30 degrés sera réparti également entre la cellule à droite et la cellule de bas à droite. Chaque vecteur se situe quelque part entre les coins des faces de deux cellules voisines, alors regardez simplement l'angle du vecteur vent, découvrez qu'il tombe entre les coins centraux de deux hexagones, puis divisez-le proportionnellement entre ces deux hexagones. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, si le vecteur vent a un angle de 22 degrés:</font></font><br><br><div style="text-align:center;"><img height="320" src="https://habrastorage.org/getpro/habr/post_images/147/fc8/add/147fc8add812755fa9abab8c5eb928aa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puis 38/60 de la valeur se propage à la cellule de droite et 22/60 de la valeur vectorielle à la cellule en bas à droite. Si les vecteurs sont présentés sous la forme d'une paire de valeurs X et Y, vous pouvez les distribuer en multipliant chaque valeur du vecteur d'origine par une fraction (par exemple, 22/60), puis en l'ajoutant au vecteur vent dans le nouvel hexagone. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour tester cela, je peux organiser les vents dans différentes directions et les placer en haut et sur le côté de la carte et voir s'ils peuvent se propager correctement sur la carte. Lorsque les vents entrent en collision, ils doivent être combinés et choisir la direction moyenne avec une vitesse accrue:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/039/482/4ac/0394824ac970c0887bb100c515ea300e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, nous voyons que les vents se rencontrent le long de la diagonale et se combinent pour souffler vers le coin inférieur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'étape suivante consiste à prendre en compte l'influence de la terre sur le vent. </font><font style="vertical-align: inherit;">Bien sûr, les modèles de vent réels sont très complexes, mais je m'intéresse principalement à la façon dont la géographie des terres affecte les vents de surface. </font><font style="vertical-align: inherit;">Au niveau le plus simple, il s'agit de l'influence des hauteurs et des basses terres sur la direction et la vitesse du vent. </font><font style="vertical-align: inherit;">J'ai expérimenté de nombreuses approches différentes, mais en conséquence je me suis fixé </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deux règles simples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le vent se détourne des obstacles. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le vent ralentit quand il se lève et accélère, tombant. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un obstacle se produit lorsque le vent souffle dans une cellule avec une hauteur plus élevée, par exemple, dans une cellule avec une montagne. </font><font style="vertical-align: inherit;">Lorsque cela se produit, je regarde les deux cellules dans lesquelles le vent souffle, et change l'angle du vent pour qu'il pointe davantage vers le bas des deux hexagones. </font><font style="vertical-align: inherit;">L'amplitude des changements d'angle dépend de la différence de hauteur de deux cellules, donc lorsque le vent souffle dans deux cellules voisines avec des montagnes, sa direction change peu, mais s'il souffle dans une cellule avec une montagne et une cellule avec une plaine, alors il se tournera davantage vers la cellule vide:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6f/4cd/b90/e6f4cdb90eb194445cf21b3c5679e3ca.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La force du vent peut être ajustée. </font><font style="vertical-align: inherit;">Sur la carte ci-dessus, il est trop fort, ce qui entraînera l'émergence de nombreux biomes irréalistes. </font><font style="vertical-align: inherit;">Voici une signification plus logique:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e70/676/6f8/e706766f8d1abfc1ad18b928b72d9c7e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une grande partie du mouvement du vent causé par les reliefs subsiste, mais les grands écarts et vallées du vent fort sont devenus plus petits. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre caractéristique qui améliore le réalisme est la dispersion du vent. Par exemple, la carte ci-dessus montre que le vent souffle vers l'ouest juste au-dessus de la ville de Breeches. Bien qu'il souffle sur de longues distances, il ne se dissipe jamais comme prévu. Lorsqu'un vent soufflant rencontre un autre air, il entraîne généralement le vent avec lui. Pour simuler cela, je peux prendre une petite partie du vent qui souffle dans chaque hexagone et le redistribuer à toutes les cellules voisines. Voici à quoi ressemblera la carte ci-dessus avec un petit nuage de points:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98d/53c/6d1/98d53c6d1659c068a8d36c58d692bd02.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous pouvez le voir, maintenant le vent sur la culotte a commencé à se dissiper un peu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette opération détermine la majeure partie des directions du vent. La deuxième partie est la décélération du vent lors de la montée et l'accélération lors de la descente. Je peux le réaliser en regardant la hauteur relative de la cellule d'où vient le vent, et la hauteur de la cellule dans laquelle le vent souffle, et en l'accélérant / le ralentissant si nécessaire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici à quoi tout cela ressemble:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/633/2c0/d8b/6332c0d8b042591426238cceafaea5a8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous voyons maintenant qu'une partie du vent soufflant à travers les hautes montagnes de la partie centrale de l'île a été coupée. Et vice versa - plusieurs nouveaux vents sont apparus dans la partie ouest de l'île, où l'air se déplace depuis des terres relativement hautes vers la mer. (C'est une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">brise côtière</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! Bien que pas vraiment: le mécanisme est différent là-bas.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, je peux remplacer un nouveau vent dans l'algorithme de précipitation existant. Voici une comparaison (vieux vents à gauche, nouveaux vents à droite):</font></font><br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/1e2/c41/3b4/1e2c413b436456e0964c50b794a402db.png"></a> </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Cliquez sur l'image pour voir une version plus grande.) Évidemment, il existe des différences entre les modèles de vent. Sur les deux cartes, le vent souffle de l'est. Les montagnes proches du centre de la carte tournent le vent vers le sud, provoquent de fortes précipitations et créent un marécage et des forêts au sud des montagnes. Dans la partie inférieure, le vent souffle sans aucune interférence, et des forêts se forment le long de la moitié orientale de l'île. Dans le modèle de vent d'origine, suffisamment de vent a traversé les montagnes centrales et les marécages pour créer une forêt dans la partie ouest de l'île. Dans le nouveau modèle, la majeure partie du vent est coupée et des biomes herbeux se forment de l'autre côté des montagnes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ancien modèle a la variabilité des paramètres aléatoires (dans un intervalle donné), et il est probable qu'une certaine combinaison de ces paramètres donnerait une image plus comme une nouvelle carte. Mais en fait, nous n'avons pas besoin de reproduire le comportement exact de l'ancien modèle, juste un modèle qui crée des résultats probants.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le but de tout cela est d'accélérer et de simplifier la génération de vent afin que de nouveaux comportements de vent puissent être ajoutés aux cartes continentales. </font><font style="vertical-align: inherit;">Je l'ai fait? </font><font style="vertical-align: inherit;">J'ai présenté le modèle de vent d'origine et le nouveau modèle à base d'hexagone. </font><font style="vertical-align: inherit;">Il s'est avéré que le nouveau modèle est 15 à 20 fois plus rapide que l'original (!). </font><font style="vertical-align: inherit;">Il s'agit d'une accélération très importante qui a peu d'effet sur les cartes. </font><font style="vertical-align: inherit;">Les expériences montrent clairement que le modèle n'est pas particulièrement sensible à la taille des hexagones, donc si nécessaire, je peux accélérer encore plus l'algorithme en augmentant la taille des cellules. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La prochaine fois, nous travaillerons sur l'utilisation d'un nouveau modèle de vent pour mettre en œuvre des modèles de vent à l'échelle continentale, puis nous les connecterons au modèle de précipitations et aux biomes.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429620/">https://habr.com/ru/post/fr429620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429606/index.html">La putain de douzaine de PM: une liste de livres pour les chefs de projet</a></li>
<li><a href="../fr429610/index.html">L'histoire de la façon d'exécuter l'émulateur Android ou d'économiser sur le processeur Intel</a></li>
<li><a href="../fr429612/index.html">Les Fulsteks sont des MIDL éternels. Ne suivez pas ce chemin si vous ne voulez pas souffrir</a></li>
<li><a href="../fr429616/index.html">Espace de travail numérique, partie 1: Citrix</a></li>
<li><a href="../fr429618/index.html">Jeu électronique XO</a></li>
<li><a href="../fr429622/index.html">Les robots ont remplacé Amazon avec 20 000 employés</a></li>
<li><a href="../fr429624/index.html">Comment la NASA utilisera des robots pour créer du carburant de fusée à partir du sol martien</a></li>
<li><a href="../fr429626/index.html">Les crackers du génome ont montré qu'aucun ADN ne sera plus anonyme</a></li>
<li><a href="../fr429628/index.html">Comment créer un bot de chat pour VKontakte en utilisant Python, Django et webhook</a></li>
<li><a href="../fr429630/index.html">"Monstres dans les jeux ou rendre la peur diversifiée"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>