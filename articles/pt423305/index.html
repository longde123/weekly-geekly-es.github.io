<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôáüèª üë©üèæ‚Äçüî¨ üêÄ Arruinar o desempenho üê¥ üê∂ üòç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta nota √© uma vers√£o escrita do meu relat√≥rio "Como arruinar o desempenho com c√≥digo ineficiente" da confer√™ncia JPoint 2018. Voc√™ pode assistir a v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arruinar o desempenho</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423305/"><p>  Esta nota √© uma vers√£o escrita do meu relat√≥rio "Como arruinar o desempenho com c√≥digo ineficiente" da confer√™ncia JPoint 2018. Voc√™ pode assistir a v√≠deos e slides na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina da confer√™ncia</a> .  No cronograma, o relat√≥rio √© marcado com um copo ofensivo de smoothies; portanto, n√£o haver√° nada super complicado, √© mais prov√°vel para iniciantes. </p><br><p>  Assunto do relat√≥rio: </p><br><ul><li>  como olhar o c√≥digo para encontrar gargalos nele </li><li>  antipadr√µes comuns </li><li>  ancinho n√£o √≥bvio </li><li>  desvio de ancinho </li></ul><br><p>  √Ä margem, eles apontaram algumas imprecis√µes / omiss√µes no relat√≥rio, s√£o anotadas aqui.  Coment√°rios tamb√©m s√£o bem-vindos. </p><a name="habracut"></a><br><h2 id="vliyanie-poryadka-ispolneniya-na-proizvoditelnost">  Impacto no desempenho </h2><br><p>  Existe uma classe de usu√°rio: </p><br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ String name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> age; }</code> </pre> <br><p>  Como precisamos comparar os objetos, declaramos os m√©todos <code>equals</code> e <code>hashCode</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.EqualsAndHashCode; <span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ String name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> age; }</code> </pre> <br><p>  O c√≥digo √© vi√°vel, a quest√£o √© diferente: o desempenho desse c√≥digo ser√° o melhor?  Para responder, vamos relembrar os recursos do m√©todo <code>Object::equals</code> : ele retorna um resultado positivo apenas quando todos os campos comparados s√£o iguais, caso contr√°rio, o resultado ser√° negativo.  Em outras palavras, uma diferen√ßa j√° √© suficiente para um resultado negativo. </p><br><p>  Depois de analisar o c√≥digo gerado para <code>@EqualsAndHashCode</code> veremos algo assim: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object that)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... if (name == null &amp;&amp; that.name != null) { return false; } if (name != null &amp;&amp; !name.equals(that.name)) { return false; } return age == that.age; }</span></span></code> </pre> <br><p>  A ordem de verifica√ß√£o dos campos corresponde √† ordem de sua declara√ß√£o, que no nosso caso n√£o √© a melhor solu√ß√£o, porque comparar objetos usando <code>equals</code> "mais dif√≠cil" do que comparar tipos simples. </p><br><p>  Ok, vamos tentar criar m√©todos <code>equals/hashCode</code> usando a id√©ia: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == o) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || getClass() != o.getClass()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } User that = (User) o; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> age == that.age &amp;&amp; Objects.equals(name, that.name); }</code> </pre> <br><p>  Uma id√©ia cria um c√≥digo mais inteligente que conhece a complexidade da compara√ß√£o de diferentes tipos de dados.  Bem, <code>@EqualsAndHashCode</code> e escreveremos explicitamente <code>equals/hashCode</code> .  Agora vamos ver o que acontece quando a classe se estende: </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ List&lt;T&gt; props; String name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> age; }</code> </pre> <br><p>  Recriando <code>equals/hashCode</code> : </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == o) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || getClass() != o.getClass()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } User that = (User) o; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> age == that.age &amp;&amp; Objects.equals(props, that.props) <span class="hljs-comment"><span class="hljs-comment">// &lt;---- &amp;&amp; Objects.equals(name, that.name); }</span></span></code> </pre> <br><p>  As listas s√£o comparadas antes das cadeias, o que n√£o faz sentido quando as cadeias s√£o diferentes.  √Ä primeira vista, n√£o h√° muita diferen√ßa, porque cadeias de comprimento igual s√£o comparadas por sinais (ou seja, o tempo de compara√ß√£o cresce junto com o comprimento da cadeia): </p><br><div class="spoiler">  <b class="spoiler_title">Houve uma imprecis√£o</b> <div class="spoiler_text"><p>  O <a href="">m√©todo</a> <code>java.lang.String::equals</code> <a href="">√© invasivo</a> , portanto, n√£o h√° compara√ß√£o de logon na execu√ß√£o. </p></div></div><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//java.lang.String public boolean equals(Object anObject) { if (this == anObject) { return true; } if (anObject instanceof String) { String anotherString = (String) anObject; int n = value.length; if (n == anotherString.value.length) { char v1[] = value; char v2[] = anotherString.value; int i = 0; while (n-- != 0) { // &lt;---- if (v1[i] != v2[i]) return false; i++; } return true; } } return false; }</span></span></code> </pre> <br><p>  Agora considere comparar duas <code>ArrayList</code> (como a implementa√ß√£o de lista mais usada).  Examinando <code>ArrayList</code> , ficamos surpresos ao descobrir que ele n√£o possui sua pr√≥pria implementa√ß√£o de <code>equals</code> , mas usa uma implementa√ß√£o herdada: </p><br><p><img src="https://habrastorage.org/webt/d4/hn/yg/d4hnyguezlpyxz3pgunk22ha1cm.png"></p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//AbstractList::equals public boolean equals(Object o) { if (o == this) { return true; } if (!(o instanceof List)) { return false; } ListIterator&lt;E&gt; e1 = listIterator(); ListIterator&lt;?&gt; e2 = ((List&lt;?&gt;) o).listIterator(); while (e1.hasNext() &amp;&amp; e2.hasNext()) { // &lt;---- E o1 = e1.next(); Object o2 = e2.next(); if (!(o1 == null ? o2 == null : o1.equals(o2))) { return false; } } return !(e1.hasNext() || e2.hasNext()); }</span></span></code> </pre> <br><p>  Importante aqui √© a cria√ß√£o de dois iteradores e a passagem aos pares atrav√©s deles.  Suponha que haja duas <code>ArrayList</code> : </p><br><ul><li>  em um n√∫mero de 1 a 99 </li><li>  no segundo n√∫mero de 1 a 100 </li></ul><br><p>  Idealmente, seria suficiente comparar os tamanhos das duas listas e, se n√£o coincidirem, retornar imediatamente um resultado negativo (como o <code>AbstractSet</code> ), na realidade, 99 compara√ß√µes ser√£o realizadas e somente no cent√©simo ficar√° claro que as listas s√£o diferentes. </p><br><h4 id="chyo-tam-u-kotlinovcev">  O que h√° com os kotlinitas? </h4><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> age: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>);</code> </pre> <br><p>  Aqui tudo √© como um Lombok - a ordem de compara√ß√£o corresponde √† ordem do an√∫ncio: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == o) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> User) { User u = (User) o; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Intrinsics.areEqual(name, u.name) &amp;&amp; age == u.age) { <span class="hljs-comment"><span class="hljs-comment">// &lt;---- return true; } } return false; }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Como melhorar a situa√ß√£o?</b>  <b class="spoiler_title">- reclama!</b> <div class="spoiler_text"><p>  IDEA-170178 A compara√ß√£o de cole√ß√µes deve ser executada no final de iguais gerados pela IDEA () <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtrack.jetbrains.com/issue/IDEA-170178</a> </p><br><p>  Reordena√ß√£o da compara√ß√£o no @EqualsAndHashCode para obter melhor desempenho # 1543 <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/rzwitserloot/lombok/issues/1543</a> </p><br><p>  KT-23184 Os iguais gerados automaticamente () da classe de dados n√£o s√£o ideais <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtrack.jetbrains.com/issue/KT-23184</a> </p></div></div><br><p>  Como solu√ß√£o alternativa, voc√™ pode organizar manualmente as declara√ß√µes de campo. </p><br><h4 id="uslozhnim-zadachu">  Vamos complicar a tarefa </h4><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dto dto)</span></span></span><span class="hljs-function"> </span></span>{ SomeEntity entity = jpaRepository.findOne(dto.getId()); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> valid = dto.isValid(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (valid &amp;&amp; entity.hasGoodRating()) { <span class="hljs-comment"><span class="hljs-comment">// &lt;---- //do smth } }</span></span></code> </pre> <br><p>  O c√≥digo envolve o acesso ao banco de dados, mesmo quando o resultado da verifica√ß√£o das condi√ß√µes indicadas pela seta √© previs√≠vel com anteced√™ncia.  Se o valor da vari√°vel <code>valid</code> for falso, o c√≥digo no bloco <code>if</code> nunca ser√° executado, o que significa que voc√™ pode fazer sem uma solicita√ß√£o: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dto dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> valid = dto.isValid(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (valid &amp;&amp; hasGoodRating(dto)) { <span class="hljs-comment"><span class="hljs-comment">//do smth } } //       ,    boolean hasGoodRating(Dto dto) { SomeEntity entity = jpaRepository.findOne(dto.getId()); return entity.hasGoodRating(); }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Nota do lado de fora</b> <div class="spoiler_text"><p>  O afundamento pode ser insignificante quando a entidade retornada de <code>JpaRepository::findOne</code> j√° <code>JpaRepository::findOne</code> no cache do primeiro n√≠vel - ent√£o n√£o haver√° solicita√ß√£o. </p></div></div><br><p>  Um exemplo semelhante sem ramifica√ß√£o expl√≠cita: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkChild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dto dto)</span></span></span><span class="hljs-function"> </span></span>{ Long id = dto.getId(); Entity entity = jpaRepository.findOne(id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dto.isValid() &amp;&amp; entity.hasChild(); }</code> </pre> <br><p>  Um retorno r√°pido permite adiar a solicita√ß√£o: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkChild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dto dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dto.isValid()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jpaRepository.findOne(dto.getId()).hasChild(); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Uma adi√ß√£o bastante √≥bvia que n√£o apareceu no relat√≥rio</b> <div class="spoiler_text"><p>  Imagine que uma determinada verifica√ß√£o usa uma entidade semelhante: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParentEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(fetch = LAZY) <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"CHILD_ID"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ChildEntity child; <span class="hljs-meta"><span class="hljs-meta">@Enumerated</span></span>(EnumType.String) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SomeType type;</code> </pre> <br><p>  Se a verifica√ß√£o usar a mesma entidade, verifique se a chamada para as entidades / cole√ß√µes filho "pregui√ßosas" √© executada ap√≥s a chamada para os campos que j√° est√£o carregados.  √Ä primeira vista, uma solicita√ß√£o adicional n√£o ter√° um impacto significativo na imagem geral, mas tudo pode mudar quando uma a√ß√£o √© executada em um loop. </p></div></div><br><p>  Conclus√£o: as cadeias de a√ß√µes / verifica√ß√µes devem ser ordenadas em ordem crescente de complexidade das opera√ß√µes individuais, talvez algumas delas n√£o precisem ser executadas. </p><br><h2 id="cikly-i-massovaya-obrabotka">  Ciclos e processamento em massa </h2><br><p>  O exemplo a seguir n√£o precisa de explica√ß√µes especiais: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enrollStudents</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Set&lt;Long&gt; ids)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Long id : ids) { Student student = jpaRepository.findOne(id); <span class="hljs-comment"><span class="hljs-comment">// &lt;---- O(n) enroll(student); } }</span></span></code> </pre> <br><p>  Devido a v√°rias consultas ao banco de dados, o c√≥digo √© lento. </p><br><div class="spoiler">  <b class="spoiler_title">Observa√ß√£o</b> <div class="spoiler_text"><p>  O desempenho pode <code>enrollStudents</code> ainda mais se o m√©todo <code>enrollStudents</code> executado fora de uma transa√ß√£o: <strong>cada</strong> chamada para <code>osdjrJpaRepository::findOne</code> ser√° executada em uma nova transa√ß√£o (consulte <a href="">SimpleJpaRepository</a> ), o que significa receber e retornar uma conex√£o ao banco de dados, al√©m de criar e liberar o cache de primeiro n√≠vel. </p></div></div><br><p>  Fix: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enrollStudents</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Set&lt;Long&gt; ids)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ids.isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Student student : jpaRepository.findAll(ids)) { enroll(student); } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Vamos medir o tempo de execu√ß√£o (em microssegundos) para uma cole√ß√£o de chaves (10 e 100 pe√ßas)</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/p2/0b/zq/p20bzq2tlnp3-mj8zlx8c96411e.png"></p></div></div><br><p>  <a href="">Refer√™ncia</a> </p><br><div class="spoiler">  <b class="spoiler_title">Observa√ß√£o</b> <div class="spoiler_text"><p>  Se voc√™ usa Oracle e passa mais de 1000 chaves para <code>findAll</code> , a exce√ß√£o <code>ORA-01795: maximum number of expressions in a list is 1000</code> . <br>  Al√©m disso, executar uma consulta pesada (com muitas chaves) <code>in</code> consultas pode ser pior que n consultas.  Tudo depende da aplica√ß√£o espec√≠fica, portanto a substitui√ß√£o mec√¢nica do ciclo para o processamento em massa pode prejudicar o desempenho. </p></div></div><br><h4 id="bolee-slozhnyy-primer-na-tu-zhe-temu">  Um exemplo mais complexo sobre o mesmo t√≥pico </h4><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Long id : ids) { Region region = jpaRepository.findOne(id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (region == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;----  region = new Region(); region.setId(id); } use(region); }</span></span></code> </pre> <br><p>  Nesse caso, n√£o podemos substituir o ciclo por <code>JpaRepository::findAll</code> , <code>JpaRepository::findAll</code> isso quebrar√° a l√≥gica: todos os valores obtidos de <code>JpaRepository::findAll</code> n√£o ser√£o <code>null</code> e o bloco <code>if</code> n√£o funcionar√°. </p><br><p>  O fato de que para cada chave de banco de dados nos ajudar√° a resolver essa dificuldade <br>  retorna o valor real ou sua aus√™ncia.  Ou seja, em certo sentido, um banco de dados √© um dicion√°rio.  O Java da caixa nos fornece uma implementa√ß√£o pronta do dicion√°rio - <code>HashMap</code> - sobre a qual construiremos a l√≥gica para substituir o banco de dados: </p><br><pre> <code class="java hljs">Map&lt;Long, Region&gt; regionMap = jpaRepository.findAll(ids) .stream() .collect(Collectors.toMap(Region::getId, Function.identity())); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Long id : ids) { Region region = map.get(id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (region == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { region = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Region(); region.setId(id); } use(region); }</code> </pre> <br><h4 id="primer-v-obratnuyu-storonu">  Exemplo reverso </h4><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// class Saver @Transactional(propagation = Propagation.REQUIRES_NEW) public void save(List&lt;AuditEntity&gt; entities) { jpaRepository.save(entities); }</span></span></code> </pre> <br><p>  Esse c√≥digo sempre cria uma nova transa√ß√£o para salvar uma lista de entidades.  A flacidez come√ßa com v√°rias chamadas para um m√©todo que abre uma nova transa√ß√£o: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   @Transactional public void audit(List&lt;AuditDto&gt; inserts) { inserts.map(this::toEntities).forEach(saver::save); // &lt;---- } // class Saver @Transactional(propagation = Propagation.REQUIRES_NEW) // &lt;---- public void save(List&lt;AuditEntity&gt; entities) { jpaRepository.save(entities); }</span></span></code> </pre> <br><p>  Solu√ß√£o: aplique o m√©todo <code>Saver::save</code> imediatamente para todo o conjunto de dados: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">audit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;AuditDto&gt; inserts)</span></span></span><span class="hljs-function"> </span></span>{ List&lt;AuditEntity&gt; bulk = inserts .map(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::toEntities) .flatMap(List::stream) <span class="hljs-comment"><span class="hljs-comment">// &lt;---- .collect(toList()); saver.save(bulk); }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Muitas transa√ß√µes se fundem em uma, o que fornece um aumento tang√≠vel (tempo em microssegundos):</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/f7/3r/n9/f73rn9gtjw7fdgiqrfwkq7tfme4.png"></p></div></div><br><p>  <a href="">Refer√™ncia</a> </p><br><p>  √â dif√≠cil formalizar um exemplo com v√°rias transa√ß√µes, o que n√£o pode ser dito sobre a chamada de <code>JpaRepository::findOne</code> em um loop. </p><br><div class="spoiler">  <b class="spoiler_title">Portanto, vamos tomar medidas</b> <div class="spoiler_text"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtrack.jetbrains.com/issue/IDEA-165730</a> <br>  IDEA-165730 Avisar sobre o uso ineficiente do JpaRepository </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtrack.jetbrains.com/issue/IDEA-165942</a> <br><del>  IDEA-165942 </del>  Inspe√ß√£o para substituir a chamada de m√©todo em um loop com opera√ß√£o em massa <br>  <strong>Corrigido em 2017.1</strong> </p></div></div><br><p>  A abordagem √© aplic√°vel n√£o apenas ao banco de dados, ent√£o Tagir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">lany</a> Valeev foi al√©m.  E se anteriormente escrevemos assim: </p><br><pre> <code class="java hljs">List&lt;Long&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Long id : items) { list.add(id); }</code> </pre> <br><p>  e estava tudo bem, agora a "Id√©ia" sugere se corrigir: </p><br><pre> <code class="java hljs">List&lt;Long&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); list.addAll(items);</code> </pre> <br><p>  Mas mesmo essa op√ß√£o nem sempre a satisfaz, porque voc√™ pode torn√°-la ainda mais curta e mais r√°pida: </p><br><pre> <code class="java hljs">List&lt;Long&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(items);</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Compare (tempo em ns)</b> <div class="spoiler_text"><p>  Para ArrayList, essa melhoria oferece um aumento not√°vel: </p><br><p><img src="https://habrastorage.org/webt/gi/6j/o8/gi6jo8xwigpdckqz6jtuw4cmane.png"></p><br><p>  Para o HashSet, n√£o √© t√£o otimista: </p><br><p><img src="https://habrastorage.org/webt/u9/lo/fy/u9lofyf2wy2hffk8gd0uwvrmmke.png"></p></div></div><br><p>  <a href="">Refer√™ncia</a> </p><br><div class="spoiler">  <b class="spoiler_title">√ötil para o desenvolvedor:</b> <div class="spoiler_text"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtrack.jetbrains.com/issue/IDEA-138456</a> <br><del>  IDEA-138456 </del>  Nova inspe√ß√£o: Collection.addAll () substitu√≠vel pelo construtor parametrizado <br>  <strong>Corrigido em 142.1217</strong> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtrack.jetbrains.com/issue/IDEA-178761</a> <br><del>  IDEA-178761 </del>  A inspe√ß√£o 'Collection.addAll () substitu√≠vel pelo construtor parametrizado' deve estar ativada por padr√£o <br>  <strong>Corrigido em 2017.3</strong> </p></div></div><br><h4 id="udalenie-iz-arraylist-a">  Removendo do <code>ArrayList</code> </h4><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = from; i &lt; to; i++) { list.remove(from); }</code> </pre> <br><p>  O problema est√° na implementa√ß√£o do m√©todo <code>List::remove</code> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> E </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span></span>{ Objects.checkIndex(index, size); modCount++; E oldValue = elementData(index); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numMoved = size - index - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (numMoved &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { System.arraycopy(array, index + <span class="hljs-number"><span class="hljs-number">1</span></span>, array, index, numMoved); <span class="hljs-comment"><span class="hljs-comment">// &lt;---- } array[--size] = null; // clear to let GC do its work return oldValue; }</span></span></code> </pre> <br><p>  Solu√ß√£o: </p><br><pre> <code class="java hljs">list.subList(from, to).clear();</code> </pre> <br><p>  Mas e se o valor remoto for usado no c√≥digo-fonte? </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = from; i &lt; to; i++) { E removed = list.remove(from); use(removed); }</code> </pre> <br><p>  Agora voc√™ precisa primeiro passar pela lista limpa: </p><br><pre> <code class="java hljs">List&lt;String&gt; removed = list.subList(from, to); removed.forEach(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::use); removed.clear();</code> </pre> <br><p>  Se voc√™ realmente deseja excluir o ciclo, uma mudan√ßa na dire√ß√£o da passagem pela lista ajudar√° a aliviar a dor.  Seu significado √© mudar um n√∫mero menor de elementos ap√≥s a limpeza da c√©lula: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   , . .       for (int i = from; i &lt; to; i++) { E removed = list.remove(from); use(removed, i); } //  , . .    for (int i = to - 1; i &gt;= from; i--) { E removed = list.remove(i); use(removed, reverseIndex(i)); }</span></span></code> </pre> <br><p>  Compare todos os tr√™s m√©todos (nas colunas est√£o% itens removidos de uma lista de tamanho 100): </p><br><div class="spoiler">  <b class="spoiler_title">Java 8</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/4h/ii/tq/4hiitqg5a7d3bk6lxi8od422yky.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Java 9</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ow/mo/ty/owmotysgwdqquagklf1yhlrquz0.png"></p></div></div><br><p>  A prop√≥sito, algu√©m notou a anomalia? </p><br><div class="spoiler">  <b class="spoiler_title">Ver</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xm/ni/s9/xmnis9jllk8rozgh8xacdneyhd8.png"></p><br><p>  Se excluirmos metade de todos os dados movidos do final, o √∫ltimo elemento ser√° sempre exclu√≠do e n√£o haver√° mudan√ßa: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// ArrayList public E remove(int index) { rangeCheck(index); modCount++; E oldValue = elementData(index); int numMoved = size - index - 1; if (numMoved &gt; 0) { // &lt;----     System.arraycopy(elementData, index+1, elementData, index, numMoved); } elementData[--size] = null; // clear to let GC do its work return oldValue; }</span></span></code> </pre> </div></div><br><p>  <a href="">Refer√™ncia</a> </p><br><div class="spoiler">  <b class="spoiler_title">√ötil para o desenvolvedor</b> <div class="spoiler_text"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtrack.jetbrains.com/issue/IDEA-177466</a> <br><del>  IDEA-177466 </del>  Detectar List.remove (index) chamado em um loop <br>  <strong>Corrigido em 2018.2</strong> </p></div></div><br><p>  Conclus√£o: opera√ß√µes em massa geralmente s√£o mais r√°pidas que opera√ß√µes √∫nicas. </p><br><h2 id="oblast-vidimosti-i-proizvoditelnost">  Escopo e desempenho </h2><br><p>  Este c√≥digo n√£o precisa de explica√ß√µes especiais: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">leaveForTheSecondYear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Student&gt; naughty = repository.findNaughty(); List&lt;Student&gt; underAchieving = repository.findUnderAchieving(); <span class="hljs-comment"><span class="hljs-comment">// &lt;---- if (settings.leaveBothCategories()) { leaveForTheSecondYear(naughty, underAchieving); // &lt;---- return; } leaveForTheSecondYear(naughty); }</span></span></code> </pre> <br><p>  Limitamos o escopo, o que fornece menos 1 consulta: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">leaveForTheSecondYear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Student&gt; naughty = repository.findNaughty(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Settings.leaveBothCategories()) { List&lt;Student&gt; underAchieving = repository.findUnderAchieving(); <span class="hljs-comment"><span class="hljs-comment">// &lt;---- leaveForTheSecondYear(naughty, underAchieving); // &lt;---- return; } leaveForTheSecondYear(naughty); }</span></span></code> </pre> <br><p>  E aqui o leitor atento deve perguntar: e a an√°lise est√°tica?  Por que a Idea n√£o nos contou sobre a melhoria que est√° na superf√≠cie? </p><br><p>  O fato √© que as possibilidades de an√°lise est√°tica s√£o limitadas: se o m√©todo √© complexo (principalmente interagindo com o banco de dados) e afeta o estado geral, a transfer√™ncia de sua execu√ß√£o pode interromper o aplicativo.  O analisador est√°tico √© capaz de relatar execu√ß√µes muito simples, cuja transfer√™ncia, digamos, dentro do bloco n√£o quebrar√° nada. </p><br><p>  Voc√™ pode usar o destaque vari√°vel como uma ersatz, mas novamente, use-o com cuidado, pois os efeitos colaterais s√£o sempre poss√≠veis.  Voc√™ pode usar a anota√ß√£o <code>@org.jetbrains.annotations.Contract(pure = true)</code> , dispon√≠vel na biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">jetbrains-annotations</a> para indicar m√©todos que n√£o mudam de estado: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// com.intellij.util.ArrayUtil @Contract(pure = true) public static int find(@NotNull int[] src, int obj) { return indexOf(src, obj); }</span></span></code> </pre> <br><p>  Conclus√£o: na maioria das vezes, o excesso de trabalho s√≥ piora o desempenho. </p><br><h2 id="samyy-neobychnyy-primer">  Exemplo mais incomum </h2><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RemoteService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ContractCounter contractCounter; <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span>(readOnly = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;---- public int countContracts(Dto dto) { if (dto.isInvalid()) { return -1; // &lt;---- } return contractCounter.countContracts(dto); } }</span></span></code> </pre> <br><p>  Essa implementa√ß√£o abre uma transa√ß√£o mesmo quando a transa√ß√£o n√£o √© necess√°ria (retorno r√°pido -1 do m√©todo). </p><br><p>  Tudo que voc√™ precisa fazer √© remover a transacionalidade dentro do <code>ContractCounter::countContracts</code> , onde for necess√°rio, e remov√™-la do m√©todo "externo". </p><br><div class="spoiler">  <b class="spoiler_title">Compare o tempo de execu√ß√£o para o caso quando -1 (ns) for retornado:</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/8k/uu/lp/8kuulppcl4vli1c5ir-txozcemi.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Compare o consumo de mem√≥ria (bytes):</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xp/du/ke/xpdukewr4nnooj2vtaktok4ngnm.png"></p></div></div><br><p>  <a href="">Refer√™ncia</a> </p><br><p>  Conclus√£o: controladores e servi√ßos "externos" precisam ser liberados da transacionalidade (essa n√£o √© sua responsabilidade) e toda a l√≥gica da verifica√ß√£o de dados de entrada, que n√£o requer acesso ao banco de dados e aos componentes transacionais, deve ser executada l√°. </p><br><h2 id="preobrazovanie-datyvremeni-v-stroku">  Converter data / hora em string </h2><br><p>  Uma das tarefas eternas √© transformar data / hora em uma sequ√™ncia.  Antes do G8, fizemos o seguinte: </p><br><pre> <code class="java hljs">SimpleDateFormat formatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleDateFormat(<span class="hljs-string"><span class="hljs-string">"dd.MM.yyyy"</span></span>); String dateAsStr = formatter.format(date);</code> </pre> <br><p>  Com o lan√ßamento do JDK 8, obtivemos <code>LocalDate/LocalDateTime</code> e, portanto, <code>DateTimeFormatter</code> </p><br><pre> <code class="java hljs">DateTimeFormatter formatter = ofPattern(<span class="hljs-string"><span class="hljs-string">"dd.MM.yyyy"</span></span>); String dateAsStr = formatter.format(localDate);</code> </pre> <br><p>  Vamos medir o seu desempenho: </p><br><pre> <code class="java hljs">Date date = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date(); LocalDate localDate = LocalDate.now(); SimpleDateFormat sdf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleDateFormat(<span class="hljs-string"><span class="hljs-string">"dd.MM.yyyy"</span></span>); DateTimeFormatter dtf = DateTimeFormatter.ofPattern(<span class="hljs-string"><span class="hljs-string">"dd.MM.yyyy"</span></span>); <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">simpleDateFormat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sdf.format(date); } <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dateTimeFormatter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dtf.format(localDate); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Tempo (ns):</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/zq/jq/sx/zqjqsxjevqpmuckdddvu4gysaoa.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Mem√≥ria (bytes):</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/9j/yq/sw/9jyqswjtyiwq3i8fkutenvyuj7g.png"></p></div></div><br><p>  Pergunta: digamos que nosso servi√ßo receba dados de fora e n√£o possamos recusar o <code>java.util.Date</code> .  Seria vantajoso converter <code>Date</code> em <code>LocalDate</code> se o √∫ltimo for convertido mais rapidamente em uma string?  Calcular: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">measureDateConverted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Data data)</span></span></span><span class="hljs-function"> </span></span>{ LocalDate localDate = toLocalDate(data.date); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data.dateTimeFormatter.format(localDate); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> LocalDate </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toLocalDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date date)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> date.toInstant().atZone(ZoneId.systemDefault()).toLocalDate(); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Tempo (ns):</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/j5/ob/mf/j5obmfec_kvfivo46wat9rmf8e8.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Mem√≥ria (bytes):</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/hx/hm/on/hxhmon8ss12qyv9s4is6byoy164.png"></p></div></div><br><p>  Portanto, a convers√£o <code>Date</code> -&gt; <code>LocalDate</code> ben√©fica ao usar o "nove".  No G8, os custos de convers√£o absorvem todos os benef√≠cios do <code>DateTimeFormatter</code> -a. </p><br><p>  <a href="">Refer√™ncia</a> </p><br><p>  Conclus√£o: tire proveito de novas solu√ß√µes. </p><br><h2 id="eschyo-vosmyorka">  Outro "oito" </h2><br><p>  Neste c√≥digo, vemos redund√¢ncia √≥bvia: </p><br><pre> <code class="java hljs">Iterator&lt;Long&gt; iterator = items <span class="hljs-comment"><span class="hljs-comment">// ArrayList&lt;Integer&gt; .stream() .map(Long::valueOf) .collect(toList()) // &lt;----    ? .iterator(); while (iterator.hasNext()) { bh.consume(iterator.next()); }</span></span></code> </pre> <br><p>  N√≥s o removemos: </p><br><pre> <code class="java hljs">Iterator&lt;Long&gt; iterator = items <span class="hljs-comment"><span class="hljs-comment">// ArrayList&lt;Integer&gt; .stream() .map(Long::valueOf) .iterator(); while (iterator.hasNext()) { bh.consume(iterator.next()); }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Vamos ver quanto desempenho melhorou:</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/un/mp/pf/unmppfr6sd8ybi3k7r7jrdsdfty.png"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Compare com os nove:</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/hc/rb/p9/hcrbp98qezjcm5fegv27cywcadu.png"></p></div></div><br><p>  Incr√≠vel n√©?  Argumentei acima que o excesso de trabalho prejudica o desempenho.  Mas aqui removemos o excesso - e (de repente) fica pior.  Para entender o que est√° acontecendo, pegue dois iteradores e olhe para eles sob uma lupa: </p><br><div class="spoiler">  <b class="spoiler_title">Divulgar</b> <div class="spoiler_text"><pre> <code class="java hljs">Iterator iterator1 = items.stream().collect(toList()).iterator(); Iterator iterator2 = items.stream().iterator();</code> </pre> <br><p><img src="https://habrastorage.org/webt/rn/ah/kf/rnahkfz2qdyuw0k_cjeorqawqki.png"></p></div></div><br><p>  O primeiro iterador √© o <code>ArrayList$Itr</code> regular. </p><br><div class="spoiler">  <b class="spoiler_title">A passagem por ele √© simples:</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cursor != size; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> E </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ checkForComodification(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = cursor; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &gt;= size) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoSuchElementException(); } Object[] elementData = ArrayList.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementData; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &gt;= elementData.length) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentModificationException(); } cursor = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (E) elementData[lastRet = i]; }</code> </pre> <br><p><img src="https://habrastorage.org/webt/ug/yb/pi/ugybpiiwmjj5-fbcazvmfdjd2tq.png"></p></div></div><br><p>  O segundo √© mais interessante, √© o <code>Spliterators$Adapter</code> , que √© baseado em <code>ArrayList$ArrayListSpliterator</code> . </p><br><div class="spoiler">  <b class="spoiler_title">Passando por isso √© mais dif√≠cil</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// java.util.Spliterators$Adapter public boolean hasNext() { if (!valueReady) spliterator.tryAdvance(this); return valueReady; } public T next() { if (!valueReady &amp;&amp; !hasNext()) throw new NoSuchElementException(); else { valueReady = false; return nextElement; } }</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/pf/5p/gj/pf5pgjkfhhfw__h8ie7m6oflxqq.png"></p></div></div><br><p>  Vejamos a itera√ß√£o do iterador atrav√©s do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">async-profiler</a> : </p><br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">15.64</span></span>% juArrayList$ArrayListSpliterator.tryAdvance <span class="hljs-number"><span class="hljs-number">10.67</span></span>% jusSpinedBuffer.<span class="hljs-keyword"><span class="hljs-keyword">clear</span></span> <span class="hljs-number"><span class="hljs-number">9.86</span></span>% juSpliterators$1Adapter.hasNext <span class="hljs-number"><span class="hljs-number">8.81</span></span>% jusStreamSpliterators$AbstractWrappingSpliterator.fillBuffer <span class="hljs-number"><span class="hljs-number">6.01</span></span>% oojiBlackhole.consume <span class="hljs-number"><span class="hljs-number">5.71</span></span>% jusReferencePipeline$3$1.accept <span class="hljs-number"><span class="hljs-number">5.57</span></span>% jusSpinedBuffer.accept <span class="hljs-number"><span class="hljs-number">5.06</span></span>% cllbir.IteratorFromStreamBenchmark.iteratorFromStream <span class="hljs-number"><span class="hljs-number">4.80</span></span>% jlLong.valueOf <span class="hljs-number"><span class="hljs-number">4.53</span></span>% cllbiIteratorFromStreamBenchmark$$Lambda$8<span class="hljs-number"><span class="hljs-number">.885721577</span></span>.apply</code> </pre> <br><p>  Pode-se observar que a maior parte do tempo √© gasta passando pelo iterador, embora em geral n√£o seja necess√°rio, pois a pesquisa pode ser feita assim: </p><br><pre> <code class="java hljs">items .stream() .map(Long::valueOf) .forEach(bh::consume);</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Compare com o resto:</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/rf/is/i0/rfisi0vsfoezlcvtd43h2lhlvfi.png"></p></div></div><br><p>  <code>Stream::forEach</code> claramente um vencedor, mas isso √© estranho: ainda √© baseado no <code>ArrayListSpliterator</code> , mas seu uso melhorou significativamente. </p><br><div class="spoiler">  <b class="spoiler_title">Vamos ver o perfil:</b> <div class="spoiler_text"><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">29.04</span></span>% oojiBlackhole.consume <span class="hljs-number"><span class="hljs-number">22.92</span></span>% juArrayList<span class="hljs-variable"><span class="hljs-variable">$ArrayListSpliterator</span></span>.forEachRemaining <span class="hljs-number"><span class="hljs-number">14.47</span></span>% jusReferencePipeline<span class="hljs-variable"><span class="hljs-variable">$3</span></span><span class="hljs-variable"><span class="hljs-variable">$1</span></span>.accept <span class="hljs-number"><span class="hljs-number">8.79</span></span>% jlLong.valueOf <span class="hljs-number"><span class="hljs-number">5.37</span></span>% cllbiIteratorFromStreamBenchmark<span class="hljs-variable"><span class="hljs-variable">$</span></span><span class="hljs-variable"><span class="hljs-variable">$Lambda</span></span><span class="hljs-variable"><span class="hljs-variable">$9</span></span>.<span class="hljs-number"><span class="hljs-number">617691115</span></span>.accept <span class="hljs-number"><span class="hljs-number">4.84</span></span>% cllbiIteratorFromStreamBenchmark<span class="hljs-variable"><span class="hljs-variable">$</span></span><span class="hljs-variable"><span class="hljs-variable">$Lambda</span></span><span class="hljs-variable"><span class="hljs-variable">$8</span></span>.<span class="hljs-number"><span class="hljs-number">1964917002</span></span>.apply <span class="hljs-number"><span class="hljs-number">4.43</span></span>% jusForEachOps<span class="hljs-variable"><span class="hljs-variable">$ForEachOp</span></span><span class="hljs-variable"><span class="hljs-variable">$OfRef</span></span>.accept <span class="hljs-number"><span class="hljs-number">4.17</span></span>% jusSink<span class="hljs-variable"><span class="hljs-variable">$ChainedReference</span></span>.end <span class="hljs-number"><span class="hljs-number">1.27</span></span>% jlInteger.longValue <span class="hljs-number"><span class="hljs-number">0.53</span></span>% jusReferencePipeline.map</code> </pre> </div></div><br><p>  Nesse perfil, a maior parte do tempo √© gasta ‚Äúengolindo‚Äù os valores dentro do <code>Blackhole</code> .  Comparado a um iterador, uma parte significativamente maior do tempo √© gasta diretamente na execu√ß√£o do c√≥digo Java.  Pode-se supor que o motivo seja o menor peso espec√≠fico da coleta de lixo, comparado com a for√ßa bruta do iterador.  Verifique: </p><br><pre> <code class="java hljs">forEach:¬∑gc.alloc.rate.norm <span class="hljs-number"><span class="hljs-number">100</span></span> avgt <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">216</span></span>,<span class="hljs-number"><span class="hljs-number">001</span></span> ¬± <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">002</span></span> B/op iteratorFromStream:¬∑gc.alloc.rate.norm <span class="hljs-number"><span class="hljs-number">100</span></span> avgt <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">416</span></span>,<span class="hljs-number"><span class="hljs-number">004</span></span> ¬± <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">006</span></span> B/op</code> </pre> <br><p>  De fato, o <code>Stream::forEach</code> fornece metade do consumo de mem√≥ria. </p><br><div class="spoiler">  <b class="spoiler_title">Por que √© mais r√°pido?</b> <div class="spoiler_text"><p>  A cadeia de chamadas do come√ßo ao buraco negro √© assim: </p><br><p><img src="https://habrastorage.org/webt/2f/5w/1y/2f5w1ydxlo5oomf8bfmhbqtynze.png"></p><br><p>  Como voc√™ pode ver, a chamada para <code>ArrayListSpliterator::tryAdvance</code> desapareceu da cadeia e <code>ArrayListSpliterator::forEachRemaining</code> apareceu: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// ArrayListSpliterator public void forEachRemaining(Consumer&lt;? super E&gt; action) { int i, hi, mc; // hoist accesses and checks from loop ArrayList&lt;E&gt; lst; Object[] a; if (action == null) throw new NullPointerException(); if ((lst = list) != null &amp;&amp; (a = lst.elementData) != null) { if ((hi = fence) &lt; 0) { mc = lst.modCount; hi = lst.size; } else mc = expectedModCount; if ((i = index) &gt;= 0 &amp;&amp; (index = hi) &lt;= a.length) { for (; i &lt; hi; ++i) { @SuppressWarnings("unchecked") E e = (E) a[i]; // &lt;---- action.accept(e); } if (lst.modCount == mc) return; } } throw new ConcurrentModificationException(); }</span></span></code> </pre> <br><p>  <code>ArrayListSpliterator::forEachRemaining</code> alta velocidade <code>ArrayListSpliterator::forEachRemaining</code> obtido usando uma passagem por toda a matriz em uma chamada de m√©todo.  Ao usar um iterador, a passagem √© limitada a um elemento, portanto, sempre nos <code>ArrayListSpliterator::tryAdvance</code> . <br>  <code>ArrayListSpliterator::forEachRemaining</code> tem acesso a toda a matriz e a <code>ArrayListSpliterator::forEachRemaining</code> com um ciclo de contagem sem chamadas adicionais. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">Aviso importante</b> <div class="spoiler_text"><p>  Observe que a substitui√ß√£o mec√¢nica </p><br><pre> <code class="java hljs">Iterator&lt;Long&gt; iterator = items .stream() .map(Long::valueOf) .collect(toList()) .iterator(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (iterator.hasNext()) { bh.consume(iterator.next()); }</code> </pre> <br><p>  em </p><br><pre> <code class="java hljs">items .stream() .map(Long::valueOf) .forEach(bh::consume);</code> </pre> <br><p>  Nem sempre √© equivalente, porque no primeiro caso usamos uma c√≥pia dos dados para a passagem sem afetar o pr√≥prio fluxo e, no segundo caso, os dados s√£o coletados diretamente do fluxo. </p></div></div><br><p>  <a href="">Refer√™ncia</a> </p><br><p>  Conclus√£o: ao lidar com representa√ß√µes complexas de dados, esteja preparado para o fato de que mesmo as regras "de ferro" (trabalho extra prejudicial) param de funcionar.  O exemplo acima mostra que a lista intermedi√°ria aparentemente sup√©rflua oferece a vantagem de uma implementa√ß√£o mais r√°pida da enumera√ß√£o. </p><br><h4 id="dva-podvoha">  Dois truques </h4><br><pre> <code class="java hljs">StackTraceElement[] trace = th.getStackTrace(); StackTraceElement[] newTrace = Arrays .asList(trace) .subList(<span class="hljs-number"><span class="hljs-number">0</span></span>, depth) .toArray(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StackTraceElement[newDepth]); <span class="hljs-comment"><span class="hljs-comment">// &lt;----</span></span></code> </pre> <br><p>  A primeira coisa que chama sua aten√ß√£o √© uma "melhoria" podre, a saber, passar uma matriz de comprimento diferente de zero para o m√©todo <code>Collection::toArray</code> .  Explica detalhadamente por que isso √© prejudicial. </p><br><p>  O segundo problema n√£o √© t√£o √≥bvio e, para sua compreens√£o, podemos tra√ßar um paralelo entre o trabalho do revisor e o historiador. </p><br><div class="spoiler">  <b class="spoiler_title">Isto √© o que Robin Collingwood escreve sobre isso:</b> <div class="spoiler_text"><p> , ,   []       ‚Äì  . <strong>             </strong> .   , <strong>    ,    </strong> ... </p></div></div><br><p>       <strong></strong>      .      : </p><br><p> 1)     <br> 2)    <br> 3)       </p><br><p>      ,      : </p><br><pre> <code class="java hljs">StackTraceElement[] trace = th.getStackTrace(); StackTraceElement[] newTrace = Arrays.copyOf(trace, depth); <span class="hljs-comment"><span class="hljs-comment">//    0 //  StackTraceElement[] newTrace = Arrays.copyOfRange(trace, 0, depth); //   0</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title"> ():</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xg/ia/-8/xgia-8mdesgh-cpqm1cla0n8zz4.png"></p></div></div><br><p> <a href=""></a> </p><br><h4 id="strimoz-golovnogo-mozga">    </h4><br><pre> <code class="java hljs">List&lt;T&gt; list = getList(); Set&lt;T&gt; set = getSet(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list.stream().allMatch(set::contains); <span class="hljs-comment"><span class="hljs-comment">//     ?</span></span></code> </pre> <br><p>       ,      ,    : </p><br><pre> <code class="java hljs">List&lt;T&gt; list = getList(); Set&lt;T&gt; set = getSet(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> set.containsAll(list);</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"> ():</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/3c/tc/pr/3ctcprq3scexhaaifc9hiywbj98.png"></p></div></div><br><p> <a href=""></a> </p><br><h4 id="nenuzhnye-obyortki">   </h4><br><p>  : </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FileNameLoader</span></span></span><span class="hljs-class"> </span></span>{ String[] loadFileNames(); }</code> </pre> <br><p>     : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FileNameLoader loader; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String str : asList(loader.loadFileNames())) { <span class="hljs-comment"><span class="hljs-comment">// &lt;----   use(str); } }</span></span></code> </pre> <br><p>   ,   <code>forEach</code>    ,      : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FileNameLoader loader; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String str : loader.loadFileNames()) { <span class="hljs-comment"><span class="hljs-comment">// &lt;----    use(str); } }</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title"> ():</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/pa/kn/hc/paknhcvrp1cf7g-fw3cn4euxrse.png"></p></div></div><br><p> <a href=""></a> </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtrack.jetbrains.com/issue/IDEA-182206</a> <br><del> IDEA-182206 </del> Simplification for Arrays.asList().subList().toArray() <br> <strong>  2018.1</strong> </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtrack.jetbrains.com/issue/IDEA-180847</a> <br><del> IDEA-180847 </del> Inspection 'Call to Collection.toArray with zero-length array argument' brings pessimization <br> <strong>  2018.1</strong> </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtrack.jetbrains.com/issue/IDEA-181928</a> <br><del> IDEA-181928 </del> Stream.allMatch(Collection::contains) can be simplified to Collection.containsAll() <br> <strong>  2018.1</strong> </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://youtrack.jetbrains.com/issue/IDEA-184240</a> <br><del> IDEA-184240 </del> Unnecessary array-to-collection wrapping should be detected <br> <strong>  2018.1</strong> </p></div></div><br><p> :       : </p><br><ul><li>  </li><li>  </li><li>    </li></ul><br><p>       ,   ,         ,     .  ,   :         "" (        ),       ""     (      ),        . </p><br><p> ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a> </p><br><p> ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt423305/">https://habr.com/ru/post/pt423305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt423293/index.html">Como n√£o dar um tiro na perna com uma m√°quina de estado</a></li>
<li><a href="../pt423295/index.html">Confer√™ncia de Desenvolvimento M√≥vel Mais √ötil</a></li>
<li><a href="../pt423297/index.html">Do desenvolvedor Android ao DevOps</a></li>
<li><a href="../pt423299/index.html">Coordenador de aplicativos em aplicativos iOS</a></li>
<li><a href="../pt423303/index.html">AI, curso pr√°tico. Transforma√ß√£o da M√∫sica Baseada na Emo√ß√£o</a></li>
<li><a href="../pt423307/index.html">Solicita√ß√µes pull do GitHub no c√≥digo do Visual Studio</a></li>
<li><a href="../pt423309/index.html">Transa√ß√µes DBMS</a></li>
<li><a href="../pt423311/index.html">Naviaddress de parceria e ACTUM</a></li>
<li><a href="../pt423313/index.html">Toque no I2C. Fa√ßa um analisador l√≥gico simples</a></li>
<li><a href="../pt423315/index.html">Teoria dos Links Universais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>