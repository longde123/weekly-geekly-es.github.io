<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëêüèº „äóÔ∏è ‚õÑÔ∏è Tarification dynamique ou comment Yandex.Taxi pr√©dit une forte demande üå®Ô∏è üßëüèø üòá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Auparavant, pour appeler un taxi, ils devaient appeler diff√©rents num√©ros des services de r√©partition et attendre que la voiture soit livr√©e pendant u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tarification dynamique ou comment Yandex.Taxi pr√©dit une forte demande</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/429226/"><img src="https://habrastorage.org/webt/6p/yq/tr/6pyqtrc3l2zveuaglelsme4xphg.png"><br><br>  Auparavant, pour appeler un taxi, ils devaient appeler diff√©rents num√©ros des services de r√©partition et attendre que la voiture soit livr√©e pendant une demi-heure ou plus.  D√©sormais, les services de taxi sont bien automatis√©s et le d√©lai moyen de livraison d'une voiture Yandex.Taxi √† Moscou est d'environ 3-4 minutes.  Mais cela vaut la peine de pleuvoir ou de mettre fin √† un √©v√©nement de masse, et encore une fois, nous risquons de manquer de voitures gratuites. <br><br>  Je m'appelle Anton Skogorev, je dirige le groupe de d√©veloppement des performances de la plateforme Yandex.Taxi.  Aujourd'hui, je dirai aux lecteurs de Habr comment nous avons appris √† pr√©dire la forte demande et √† attirer en outre des conducteurs afin que les utilisateurs puissent trouver une voiture gratuite √† tout moment.  Vous apprendrez comment se forme un coefficient qui affecte la valeur de la commande.  Tout y est loin d'√™tre aussi simple que cela puisse para√Ætre √† premi√®re vue. <br><br><a name="habracut"></a><br><h3>  D√©fi de tarification dynamique </h3><br>  La t√¢che la plus importante de la tarification dynamique est de toujours offrir la possibilit√© de commander un taxi.  Il est obtenu en utilisant le coefficient de surtension, par lequel le prix calcul√© est multipli√©.  Nous appelons cela simplement une mont√©e subite.  Il est important de dire que la surtension non seulement r√©gule la demande de taxis, mais contribue √©galement √† attirer de nouveaux conducteurs pour augmenter l'offre. <br><br>  Si la pouss√©e est trop importante, nous r√©duirons trop la demande, il y aura un exc√®s de voitures gratuites.  S'il est trop bas, les utilisateurs verront "pas de voitures gratuites".  Vous devez √™tre en mesure de choisir un coefficient auquel nous marcherons sur une glace mince entre le manque de voitures gratuites et la faible demande. <br><br>  De quoi devrait d√©pendre ce coefficient?  Il vient imm√©diatement √† l'esprit la d√©pendance √† l'√©gard du nombre de voitures et de commandes autour de l'utilisateur.  Maintenant, vous pouvez simplement diviser le nombre de commandes par le nombre de pilotes, obtenir le coefficient et le transformer en augmentation avec une formule (√©ventuellement lin√©aire). <br><br>  Mais il y a un petit probl√®me dans cette t√¢che - il peut √™tre trop tard pour compter les commandes autour de l'utilisateur.  Apr√®s tout, une commande est presque toujours une machine d√©j√† occup√©e, ce qui signifie qu'une augmentation de notre coefficient sera toujours en retard.  Par cons√©quent, nous ne consid√©rons pas les commandes cr√©√©es, mais les <b>intentions de</b> commander des √©pingles de voiture.  Une √©pingle est une √©tiquette ¬´A¬ª sur une carte qu'un utilisateur met lors du lancement de notre application. <br><br><img src="https://habrastorage.org/webt/8t/du/0a/8tdu0aql7pjzmgqgqerbnso7zuw.png"><br><br>  Formulons le probl√®me: nous devons lire les valeurs <b>instantan√©es</b> des machines et des broches √† un moment donn√© de l'utilisateur. <br><br><h3>  Nous comptons le nombre de broches et de voitures autour </h3><br>  Lorsque la position de la broche change (l'utilisateur s√©lectionne le point ¬´A¬ª), l'application utilisateur envoie de nouvelles coordonn√©es et une petite feuille d'informations suppl√©mentaires au backend, ce qui permet d'√©valuer la broche plus pr√©cis√©ment (par exemple, le tarif s√©lectionn√©). <br><br>  Nous essayons d'adh√©rer √† l'architecture de microservice, o√π chaque microservice est engag√© dans des t√¢ches distinctes.  Le microservice Surger est engag√© dans le calcul des surtensions.  Il enregistre les broches, les enregistre dans la base de donn√©es et met √©galement √† jour le nugget des broches dans la RAM, dans lequel elles s'int√®grent assez bien.  Le d√©calage du cache pendant un tel travail n'est que de quelques secondes, ce qui est acceptable dans notre cas. <br><br><div class="spoiler">  <b class="spoiler_title">Quelques mots sur la base de donn√©es</b> <div class="spoiler_text">  Lors de l'enregistrement, chaque broche est ajout√©e de mani√®re asynchrone √† MongoDb avec l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">indice TTL</a> , o√π TTL est la ¬´dur√©e de vie¬ª de la broche, √† laquelle nous consid√©rons qu'il est actif pour calculer le coefficient de mont√©e.  L'utilisateur n'attend pas pendant que nous effectuons ces actions.  M√™me si quelque chose ne va pas, perdre une √©pingle n'est pas une si grande trag√©die. <br><br><img src="https://habrastorage.org/webt/7g/u0/f6/7gu0f6uercnenpw3c4h2xyu4tls.jpeg"><br></div></div><br>  Un cache chaud est construit avec un index de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hachage g√©ographique</a> .  Nous regroupons toutes les broches par geohash, puis collectons les broches pour le rayon souhait√© autour du point de commande. <br><br>  Nous faisons de m√™me avec les voitures, mais dans un autre service appel√© Tracker, auquel le Surger r√©pond simplement par la question "combien de conducteurs se trouvent dans ce rayon". <br><br>  Nous consid√©rons donc les valeurs instantan√©es du coefficient. <br><br><img src="https://habrastorage.org/webt/mi/r7/y7/mir7y77n8i0b_dh8-w9vaxtex9k.jpeg"><br><br><h3>  Mise en cache </h3><br>  <b>Cas</b> : vous vous trouvez dans le Garden Ring √† Moscou et vous souhaitez r√©server une voiture.  Dans le m√™me temps, le prix grimpe assez souvent et c'est g√™nant. <br><br>  Connaissant d√©j√† la m√©canique, on peut comprendre que cela peut √™tre d√ª au fait que les conducteurs s'accumulent √† un feu de circulation conditionnel au moment de la demande de surtension et partent √©galement rapidement.  Pour cette raison, la flamb√©e et le prix peuvent sensiblement ¬´sauter¬ª. <br><br>  Pour √©viter cela, nous mettons en cache la valeur de surtension par utilisateur.  Lorsqu'un utilisateur vient pour une surtension, nous cherchons √† voir s'il existe une valeur de surtension enregistr√©e pour cet utilisateur dans un rayon acceptable (un tour lin√©aire de toutes les surtensions enregistr√©es de l'utilisateur).  S'il y en a, nous le restituons, sinon nous comptons sur un nouveau et le sauvegardons √©galement. <br><br>  Cela a bien fonctionn√©, mais il existe d'autres situations. <br><br>  <b>Cas</b> : 2 utilisateurs demandent une surtension.  L'un commande 30 secondes plus tard que l'autre lorsque des voitures d'un feu de circulation d'un cas pass√© sont d√©j√† parties.  Nous obtenons une image o√π 2 utilisateurs commandant presque simultan√©ment peuvent avoir des surtensions sensiblement diff√©rentes. <br><br>  Et ici, nous passons du cache par utilisateur au cache par position.  Maintenant, au lieu de mettre en cache la valeur de surtension uniquement par utilisateur, nous commen√ßons √† la mettre en cache par le hachage g√©ographique que nous connaissons d√©j√†.  Nous avons donc presque r√©solu le probl√®me.  Pourquoi presque?  Parce qu'il peut y avoir des diff√©rences aux fronti√®res des geoheshes.  Mais le probl√®me n'est pas si important, car nous avons un lissage. <br><br><h3>  Lissage </h3><br>  Peut-√™tre, √† la lecture d'un cas concernant un feu de circulation, vous avez pens√© qu'il √©tait en quelque sorte injuste d'envisager une surtension instantan√©e, en fonction du feu de circulation.  Nous le pensons √©galement, nous avons donc trouv√© un moyen de r√©gler la situation. <br><br>  Nous avons d√©cid√© d'emprunter la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©thode des voisins</a> les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus proches √† l'</a> apprentissage automatique pour le probl√®me de r√©gression afin de d√©terminer √† quel point la valeur de la surtension instantan√©e est diff√©rente de ce qui se passe autour. <br><br>  L'√©tape de formation, comme dans la description formelle de la m√©thode, consiste √† stocker tous les objets - dans notre cas, les valeurs calcul√©es de la surtension dans la broche, nous faisons d√©j√† tout cela au moment de charger toutes les broches dans le cache.  La petite chose est de calculer la valeur instantan√©e, de la comparer avec la valeur de la zone et de convenir que l'on ne peut pas trop s'√©carter de la valeur de la zone. <br><br>  Nous obtenons donc un syst√®me avec une r√©ponse rapide aux √©v√©nements et vous permettant de lire rapidement la valeur du coefficient croissant. <br><br><h3>  Carte de conduite Surge </h3><br>  Pour communiquer avec le conducteur, nous devons √™tre en mesure d'afficher la carte de surtension dans l'application du conducteur - un taxim√®tre.  Cela permet au conducteur de savoir s'il existe une demande dans la r√©gion o√π il se trouve actuellement et o√π il doit se d√©placer pour obtenir les commandes les plus ch√®res.  Pour nous, cela signifie que davantage de conducteurs arriveront dans la zone √† forte demande et la r√©gleront. <br><br><img src="https://habrastorage.org/webt/q8/89/m-/q889m-nye_deix_n6i5tqkbnoba.png"><br><br>  Nous vivons avec le paradigme que l'appareil du pilote est un appareil plut√¥t faible.  Par cons√©quent, le rendu de la grille hexagonale de surtension se trouve sur le c√¥t√© backend.  Le client vient au backend pour les tuiles.  Ce sont des images tram√©es d√©coup√©es pour un affichage direct sur la carte. <br><br>  Nous avons un service s√©par√© qui r√©cup√®re p√©riodiquement les moulages de broches du microservice Surger et calcule toutes les m√©ta-informations n√©cessaires pour rendre la grille hexagonale: o√π est quel hex et quelle surtension se trouve dans chacun. <br><br><h3>  Conclusion </h3><br>  La tarification dynamique est une recherche constante d'un √©quilibre entre l'offre et la demande, afin que les utilisateurs disposent toujours de voitures gratuites, y compris par le biais du m√©canisme visant √† attirer des conducteurs suppl√©mentaires dans les zones √† forte demande.  Par exemple, nous travaillons actuellement sur une utilisation plus approfondie de l'apprentissage automatique pour calculer la surtension.  Dans le cadre de l'une des t√¢ches dans ce domaine, nous apprenons √† d√©terminer la probabilit√© de conversion d'une broche en commande et √† prendre en compte ces informations.  Il y a assez de travail ici, nous sommes donc toujours ravis des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouveaux sp√©cialistes</a> de l'√©quipe. <br><br>  Si vous souhaitez en savoir plus sur une partie de ce grand sujet, √©crivez dans les commentaires.  Vos commentaires et id√©es sont √©galement les bienvenus! <br><br>  PS Dans la prochaine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publication,</a> mon coll√®gue parlera de l'utilisation du machine learning pour pr√©dire l'heure d'arriv√©e pr√©vue d'un taxi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429226/">https://habr.com/ru/post/fr429226/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429216/index.html">V√©rifiez les ventes sur Google Play - cela vaut-il la peine?</a></li>
<li><a href="../fr429218/index.html">Julia et √©quations aux d√©riv√©es partielles</a></li>
<li><a href="../fr429220/index.html">FSIN contre les lois de la physique ou les abeilles contre le miel</a></li>
<li><a href="../fr429222/index.html">La Douma d'√âtat rendra le projet de loi sur les m√©gadonn√©es pour r√©vision</a></li>
<li><a href="../fr429224/index.html">Mod√®les de formulaire Web sombre ou quel serait le formulaire de conversion le plus</a></li>
<li><a href="../fr429228/index.html">PMP R√©ussir l'examen. Ce qu'il faut consid√©rer et pourquoi vous en avez besoin</a></li>
<li><a href="../fr429230/index.html">Rapport: des projecteurs Epson √† Integrated Systems Russia 2018</a></li>
<li><a href="../fr429232/index.html">St√©ro√Ødes de carri√®re. Les chiens</a></li>
<li><a href="../fr429234/index.html">Cr√©ation du jeu "Like coins" sur Godot Engine. Partie 1</a></li>
<li><a href="../fr429236/index.html">De combien de Data Scientists avez-vous besoin pour allumer une ampoule (ou quelle √©quipe fera fonctionner les donn√©es pour l'entreprise)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>