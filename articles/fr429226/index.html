<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👐🏼 ㊗️ ⛄️ Tarification dynamique ou comment Yandex.Taxi prédit une forte demande 🌨️ 🧑🏿 😇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Auparavant, pour appeler un taxi, ils devaient appeler différents numéros des services de répartition et attendre que la voiture soit livrée pendant u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tarification dynamique ou comment Yandex.Taxi prédit une forte demande</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/429226/"><img src="https://habrastorage.org/webt/6p/yq/tr/6pyqtrc3l2zveuaglelsme4xphg.png"><br><br>  Auparavant, pour appeler un taxi, ils devaient appeler différents numéros des services de répartition et attendre que la voiture soit livrée pendant une demi-heure ou plus.  Désormais, les services de taxi sont bien automatisés et le délai moyen de livraison d'une voiture Yandex.Taxi à Moscou est d'environ 3-4 minutes.  Mais cela vaut la peine de pleuvoir ou de mettre fin à un événement de masse, et encore une fois, nous risquons de manquer de voitures gratuites. <br><br>  Je m'appelle Anton Skogorev, je dirige le groupe de développement des performances de la plateforme Yandex.Taxi.  Aujourd'hui, je dirai aux lecteurs de Habr comment nous avons appris à prédire la forte demande et à attirer en outre des conducteurs afin que les utilisateurs puissent trouver une voiture gratuite à tout moment.  Vous apprendrez comment se forme un coefficient qui affecte la valeur de la commande.  Tout y est loin d'être aussi simple que cela puisse paraître à première vue. <br><br><a name="habracut"></a><br><h3>  Défi de tarification dynamique </h3><br>  La tâche la plus importante de la tarification dynamique est de toujours offrir la possibilité de commander un taxi.  Il est obtenu en utilisant le coefficient de surtension, par lequel le prix calculé est multiplié.  Nous appelons cela simplement une montée subite.  Il est important de dire que la surtension non seulement régule la demande de taxis, mais contribue également à attirer de nouveaux conducteurs pour augmenter l'offre. <br><br>  Si la poussée est trop importante, nous réduirons trop la demande, il y aura un excès de voitures gratuites.  S'il est trop bas, les utilisateurs verront "pas de voitures gratuites".  Vous devez être en mesure de choisir un coefficient auquel nous marcherons sur une glace mince entre le manque de voitures gratuites et la faible demande. <br><br>  De quoi devrait dépendre ce coefficient?  Il vient immédiatement à l'esprit la dépendance à l'égard du nombre de voitures et de commandes autour de l'utilisateur.  Maintenant, vous pouvez simplement diviser le nombre de commandes par le nombre de pilotes, obtenir le coefficient et le transformer en augmentation avec une formule (éventuellement linéaire). <br><br>  Mais il y a un petit problème dans cette tâche - il peut être trop tard pour compter les commandes autour de l'utilisateur.  Après tout, une commande est presque toujours une machine déjà occupée, ce qui signifie qu'une augmentation de notre coefficient sera toujours en retard.  Par conséquent, nous ne considérons pas les commandes créées, mais les <b>intentions de</b> commander des épingles de voiture.  Une épingle est une étiquette «A» sur une carte qu'un utilisateur met lors du lancement de notre application. <br><br><img src="https://habrastorage.org/webt/8t/du/0a/8tdu0aql7pjzmgqgqerbnso7zuw.png"><br><br>  Formulons le problème: nous devons lire les valeurs <b>instantanées</b> des machines et des broches à un moment donné de l'utilisateur. <br><br><h3>  Nous comptons le nombre de broches et de voitures autour </h3><br>  Lorsque la position de la broche change (l'utilisateur sélectionne le point «A»), l'application utilisateur envoie de nouvelles coordonnées et une petite feuille d'informations supplémentaires au backend, ce qui permet d'évaluer la broche plus précisément (par exemple, le tarif sélectionné). <br><br>  Nous essayons d'adhérer à l'architecture de microservice, où chaque microservice est engagé dans des tâches distinctes.  Le microservice Surger est engagé dans le calcul des surtensions.  Il enregistre les broches, les enregistre dans la base de données et met également à jour le nugget des broches dans la RAM, dans lequel elles s'intègrent assez bien.  Le décalage du cache pendant un tel travail n'est que de quelques secondes, ce qui est acceptable dans notre cas. <br><br><div class="spoiler">  <b class="spoiler_title">Quelques mots sur la base de données</b> <div class="spoiler_text">  Lors de l'enregistrement, chaque broche est ajoutée de manière asynchrone à MongoDb avec l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">indice TTL</a> , où TTL est la «durée de vie» de la broche, à laquelle nous considérons qu'il est actif pour calculer le coefficient de montée.  L'utilisateur n'attend pas pendant que nous effectuons ces actions.  Même si quelque chose ne va pas, perdre une épingle n'est pas une si grande tragédie. <br><br><img src="https://habrastorage.org/webt/7g/u0/f6/7gu0f6uercnenpw3c4h2xyu4tls.jpeg"><br></div></div><br>  Un cache chaud est construit avec un index de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hachage géographique</a> .  Nous regroupons toutes les broches par geohash, puis collectons les broches pour le rayon souhaité autour du point de commande. <br><br>  Nous faisons de même avec les voitures, mais dans un autre service appelé Tracker, auquel le Surger répond simplement par la question "combien de conducteurs se trouvent dans ce rayon". <br><br>  Nous considérons donc les valeurs instantanées du coefficient. <br><br><img src="https://habrastorage.org/webt/mi/r7/y7/mir7y77n8i0b_dh8-w9vaxtex9k.jpeg"><br><br><h3>  Mise en cache </h3><br>  <b>Cas</b> : vous vous trouvez dans le Garden Ring à Moscou et vous souhaitez réserver une voiture.  Dans le même temps, le prix grimpe assez souvent et c'est gênant. <br><br>  Connaissant déjà la mécanique, on peut comprendre que cela peut être dû au fait que les conducteurs s'accumulent à un feu de circulation conditionnel au moment de la demande de surtension et partent également rapidement.  Pour cette raison, la flambée et le prix peuvent sensiblement «sauter». <br><br>  Pour éviter cela, nous mettons en cache la valeur de surtension par utilisateur.  Lorsqu'un utilisateur vient pour une surtension, nous cherchons à voir s'il existe une valeur de surtension enregistrée pour cet utilisateur dans un rayon acceptable (un tour linéaire de toutes les surtensions enregistrées de l'utilisateur).  S'il y en a, nous le restituons, sinon nous comptons sur un nouveau et le sauvegardons également. <br><br>  Cela a bien fonctionné, mais il existe d'autres situations. <br><br>  <b>Cas</b> : 2 utilisateurs demandent une surtension.  L'un commande 30 secondes plus tard que l'autre lorsque des voitures d'un feu de circulation d'un cas passé sont déjà parties.  Nous obtenons une image où 2 utilisateurs commandant presque simultanément peuvent avoir des surtensions sensiblement différentes. <br><br>  Et ici, nous passons du cache par utilisateur au cache par position.  Maintenant, au lieu de mettre en cache la valeur de surtension uniquement par utilisateur, nous commençons à la mettre en cache par le hachage géographique que nous connaissons déjà.  Nous avons donc presque résolu le problème.  Pourquoi presque?  Parce qu'il peut y avoir des différences aux frontières des geoheshes.  Mais le problème n'est pas si important, car nous avons un lissage. <br><br><h3>  Lissage </h3><br>  Peut-être, à la lecture d'un cas concernant un feu de circulation, vous avez pensé qu'il était en quelque sorte injuste d'envisager une surtension instantanée, en fonction du feu de circulation.  Nous le pensons également, nous avons donc trouvé un moyen de régler la situation. <br><br>  Nous avons décidé d'emprunter la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">méthode des voisins</a> les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus proches à l'</a> apprentissage automatique pour le problème de régression afin de déterminer à quel point la valeur de la surtension instantanée est différente de ce qui se passe autour. <br><br>  L'étape de formation, comme dans la description formelle de la méthode, consiste à stocker tous les objets - dans notre cas, les valeurs calculées de la surtension dans la broche, nous faisons déjà tout cela au moment de charger toutes les broches dans le cache.  La petite chose est de calculer la valeur instantanée, de la comparer avec la valeur de la zone et de convenir que l'on ne peut pas trop s'écarter de la valeur de la zone. <br><br>  Nous obtenons donc un système avec une réponse rapide aux événements et vous permettant de lire rapidement la valeur du coefficient croissant. <br><br><h3>  Carte de conduite Surge </h3><br>  Pour communiquer avec le conducteur, nous devons être en mesure d'afficher la carte de surtension dans l'application du conducteur - un taximètre.  Cela permet au conducteur de savoir s'il existe une demande dans la région où il se trouve actuellement et où il doit se déplacer pour obtenir les commandes les plus chères.  Pour nous, cela signifie que davantage de conducteurs arriveront dans la zone à forte demande et la régleront. <br><br><img src="https://habrastorage.org/webt/q8/89/m-/q889m-nye_deix_n6i5tqkbnoba.png"><br><br>  Nous vivons avec le paradigme que l'appareil du pilote est un appareil plutôt faible.  Par conséquent, le rendu de la grille hexagonale de surtension se trouve sur le côté backend.  Le client vient au backend pour les tuiles.  Ce sont des images tramées découpées pour un affichage direct sur la carte. <br><br>  Nous avons un service séparé qui récupère périodiquement les moulages de broches du microservice Surger et calcule toutes les méta-informations nécessaires pour rendre la grille hexagonale: où est quel hex et quelle surtension se trouve dans chacun. <br><br><h3>  Conclusion </h3><br>  La tarification dynamique est une recherche constante d'un équilibre entre l'offre et la demande, afin que les utilisateurs disposent toujours de voitures gratuites, y compris par le biais du mécanisme visant à attirer des conducteurs supplémentaires dans les zones à forte demande.  Par exemple, nous travaillons actuellement sur une utilisation plus approfondie de l'apprentissage automatique pour calculer la surtension.  Dans le cadre de l'une des tâches dans ce domaine, nous apprenons à déterminer la probabilité de conversion d'une broche en commande et à prendre en compte ces informations.  Il y a assez de travail ici, nous sommes donc toujours ravis des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouveaux spécialistes</a> de l'équipe. <br><br>  Si vous souhaitez en savoir plus sur une partie de ce grand sujet, écrivez dans les commentaires.  Vos commentaires et idées sont également les bienvenus! <br><br>  PS Dans la prochaine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publication,</a> mon collègue parlera de l'utilisation du machine learning pour prédire l'heure d'arrivée prévue d'un taxi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429226/">https://habr.com/ru/post/fr429226/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429216/index.html">Vérifiez les ventes sur Google Play - cela vaut-il la peine?</a></li>
<li><a href="../fr429218/index.html">Julia et équations aux dérivées partielles</a></li>
<li><a href="../fr429220/index.html">FSIN contre les lois de la physique ou les abeilles contre le miel</a></li>
<li><a href="../fr429222/index.html">La Douma d'État rendra le projet de loi sur les mégadonnées pour révision</a></li>
<li><a href="../fr429224/index.html">Modèles de formulaire Web sombre ou quel serait le formulaire de conversion le plus</a></li>
<li><a href="../fr429228/index.html">PMP Réussir l'examen. Ce qu'il faut considérer et pourquoi vous en avez besoin</a></li>
<li><a href="../fr429230/index.html">Rapport: des projecteurs Epson à Integrated Systems Russia 2018</a></li>
<li><a href="../fr429232/index.html">Stéroïdes de carrière. Les chiens</a></li>
<li><a href="../fr429234/index.html">Création du jeu "Like coins" sur Godot Engine. Partie 1</a></li>
<li><a href="../fr429236/index.html">De combien de Data Scientists avez-vous besoin pour allumer une ampoule (ou quelle équipe fera fonctionner les données pour l'entreprise)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>