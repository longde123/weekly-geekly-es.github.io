<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•‘ ğŸ‘ğŸ¿ ğŸ… å•ä¸€ç®—æ³•çš„å‘å±• ğŸ—¯ï¸ ğŸ§‘ğŸ¼â€ğŸ¤â€ğŸ§‘ğŸ» ğŸ‘‘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å‰æ®µæ—¶é—´ï¼Œæˆ‘çš„åŒäº‹è¦æˆ‘å¸®åŠ©ä»–è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚ æˆ‘ä¸ºä»–è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥è§£é‡Šå‡ ç§ç¼–ç¨‹ç®—æ³•å’ŒæŠ€æœ¯ã€‚ å¹¶ä¸”è¿˜æ˜¾ç¤ºäº†ç®—æ³•æ‰§è¡Œæ—¶é—´ä»25ç§’åŠ é€Ÿåˆ°40 msã€‚ 
 é—®é¢˜é™ˆè¿° 


 å¯¹äºä¸ªäººé¡¹ç›®ï¼Œæˆ‘çš„åŒäº‹éœ€è¦ä¸€ç§ç®—æ³•ï¼Œä»¥æ‰¾åˆ°ç»™å®šè§†é¢‘çš„äº”åä¸ªæœ€ç›¸ä¼¼çš„è§†é¢‘ã€‚ å¯ä»¥é€šè¿‡åŒ¹é…æš´éœ²æ ‡ç­¾çš„...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å•ä¸€ç®—æ³•çš„å‘å±•</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454850/"><p>å‰æ®µæ—¶é—´ï¼Œæˆ‘çš„åŒäº‹è¦æˆ‘å¸®åŠ©ä»–è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚ æˆ‘ä¸ºä»–è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥è§£é‡Šå‡ ç§ç¼–ç¨‹ç®—æ³•å’ŒæŠ€æœ¯ã€‚ å¹¶ä¸”è¿˜æ˜¾ç¤ºäº†ç®—æ³•æ‰§è¡Œæ—¶é—´ä»25ç§’åŠ é€Ÿåˆ°40 msã€‚ </p><a name="habracut"></a><br><h1 id="postanovka-zadachi"> é—®é¢˜é™ˆè¿° </h1><br><p> å¯¹äºä¸ªäººé¡¹ç›®ï¼Œæˆ‘çš„åŒäº‹éœ€è¦ä¸€ç§ç®—æ³•ï¼Œä»¥æ‰¾åˆ°ç»™å®šè§†é¢‘çš„äº”åä¸ªæœ€ç›¸ä¼¼çš„è§†é¢‘ã€‚ å¯ä»¥é€šè¿‡åŒ¹é…æš´éœ²æ ‡ç­¾çš„æ•°é‡æ¥ä¼°è®¡ç›¸ä¼¼æ€§ã€‚ è§†é¢‘åŒ¹é…çš„æ ‡ç­¾è¶Šå¤šï¼Œå®ƒä»¬è¶Šç›¸ä¼¼ã€‚ ç”±æ­¤æˆ‘ä»¬å¯ä»¥ç«‹å³å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š </p><br><ul><li> è§†é¢‘ä¸‹çš„æ‰€æœ‰æ ‡ç­¾å¯ä»¥åˆå¹¶ä¸ºä¸€ç»„ï¼› </li><li> è¿™æ ·çš„ç¾¤ç»„ç»å¯¹ä¸ä¼šæ¯”è§†é¢‘æœ¬èº«å¤šï¼› </li><li> å¦‚æœè¯¥è§†é¢‘ä¸æŸä¸ªæ ‡ç­¾ç»„ä¸­çš„å¦ä¸€è§†é¢‘ç›¸ä¼¼ï¼Œåˆ™è¯¥è§†é¢‘ä¸è¯¥ç»„ä¸­çš„å…¶ä»–è§†é¢‘åŒæ ·ç›¸ä¼¼ï¼› </li></ul><br><p> äº‹å®è¯æ˜ï¼Œä»…ä½¿ç”¨æ ‡ç­¾ç»„å°±è¶³å¤Ÿäº†ã€‚ åœ¨ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸­ï¼Œä¸€ä½åŒäº‹å†³å®šå°†æ ‡ç­¾å­˜å‚¨åœ¨æ ‡ç­¾è¡¨ä¸­ï¼šæ¯ä¸ªè§†é¢‘éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘æ ‡ç­¾ç»„IDçš„é“¾æ¥ï¼Œå¹¶ä¸”ç»„æœ¬èº«æ˜¯ä¸€ç³»åˆ—å¸ƒå°”å€¼ï¼Œå®ƒä»¬æŒ‡ç¤ºæ˜¯å¦è®¾ç½®äº†ç›¸åº”çš„æ ‡ç­¾ã€‚ åœ¨Cï¼ƒä¸­ï¼Œæ ‡è®°ç»„å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TagsGroup</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[] InnerTags { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><p> ä¸€ä½åŒäº‹å»ºè®®ï¼Œåœ¨è¯¥ç½‘ç«™ä¸Šï¼Œä»–çš„è§†é¢‘ä¸è¶…è¿‡ä¸€ç™¾ä¸‡ä¸ªï¼Œå„ç§æ ‡ç­¾ä¸è¶…è¿‡4000ä¸ªï¼Œå¯¹äºä¸€ä¸ªå…¨é¢çš„å¸æˆ·ï¼Œæ‚¨å¯ä»¥å–4096 = 2 ^ 12ã€‚ <br> ç„¶åï¼Œ <code>TagsGroup</code>ç±»å¯ä»¥è¿™æ ·è¡¨ç¤ºï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TagsGroup</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TagsGroupLength = <span class="hljs-number"><span class="hljs-number">4096</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[] InnerTags { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TagsGroup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] innerTags</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (innerTags == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(innerTags)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (innerTags.Length != TagsGroupLength) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(innerTags)); } InnerTags = innerTags; } }</code> </pre> <br><p> ç°åœ¨ï¼Œæ‚¨éœ€è¦æ£€æŸ¥ä¸¤ç»„æ ‡ç­¾çš„ç›¸ä¼¼æ€§ã€‚ åœ¨å½“å‰æ¡ä»¶ä¸‹ï¼Œè¿™å°†å˜æˆå¯¹ä¸¤ç»„æ ‡ç­¾çš„<code>InnerTags</code>æ•°ç»„çš„ç›¸åº”å…ƒç´ ä¸­çš„trueçš„ç®€å•æ£€æŸ¥ï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeasureSimilarity</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup a, TagsGroup b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; TagsGroupLength; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a.InnerTags[i] &amp;&amp; a.InnerTags[i] == b.InnerTags[i]) result++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p> ç°åœ¨ä»…éœ€è®¡ç®—æ‰€éœ€æ ‡ç­¾ç»„ä¸æ¯ä¸ªç°æœ‰ç»„çš„ç›¸ä¼¼åº¦å¹¶é€‰æ‹©äº”åä¸ªæœ€ç›¸ä¼¼çš„æ ‡ç­¾ç»„ã€‚ æˆ‘ä¸ºç¡®ä¿æ ·å“ç¨³å®šæ€§è®¾å®šäº†å¦ä¸€ä¸ªæ¡ä»¶ï¼Œå³ åœ¨æœ€ç»ˆæ ·æœ¬ä¸­ï¼Œå°†æœ‰äº”åä¸ªæ ‡ç­¾ç»„çš„<code>MeasureSimilarity</code>ç»™å‡ºæœ€é«˜ç»“æœï¼Œè€Œå…·æœ‰ç›¸åŒ<code>MeasureSimilarity</code>æ ‡ç­¾ç»„çš„ç´¢å¼•å°†ç›¸å¯¹äºé‚£äº›åœ¨åŸå§‹ç°æœ‰ç»„ä¸­<code>MeasureSimilarity</code>è¾ƒä½ç´¢å¼•çš„æ ‡ç­¾ç»„å…·æœ‰è¾ƒä½çš„ç´¢å¼•ã€‚ å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//ru.wikipedia.org/wiki/Sustainable_Sort</a> ã€‚ <br> ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å†³å®šåˆ¶ä½œ<code>SimilarTagsCalculator</code>ç±»<code>SimilarTagsCalculator</code> ï¼Œè¿™æ˜¯å®ƒçš„ä»£ç ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">ç›¸ä¼¼æ ‡ç­¾</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimilarTagsCalculator</span></span> { TagsGroup[] Groups { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SimilarTagsCalculator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup[] groups</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (groups == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(groups)); Groups = groups; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TagsGroup[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFiftyMostSimilarGroups</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> resultLength = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-comment"><span class="hljs-comment">//,          var list = new List&lt;TagsSimilarityInfo&gt;(resultLength); //      for (int groupIndex = 0; groupIndex &lt; Groups.Length; groupIndex++) { TagsGroup tagsGroup = Groups[groupIndex]; //      int similarityValue = TagsGroup.MeasureSimilarity(value, tagsGroup); // -  TagsSimilarityInfo newInfo = new TagsSimilarityInfo(groupIndex, similarityValue); //    ,     , if (list.Count == resultLength &amp;&amp; list[resultLength - 1].CompareTo(newInfo) == -1) { continue; //     } //   ,    -  int index = ~list.BinarySearch(newInfo); list.Insert(index, newInfo); // if (list.Count &gt; resultLength) { //    , //   , ..    list.RemoveAt(resultLength); } } // -   TagsGroup[] result = new TagsGroup[resultLength]; for (int i = 0; i &lt; resultLength; i++) { result[i] = Groups[list[i].Index]; } return result; } }</span></span></code> </pre> </div></div><br><p> å’Œ<code>TagsSimilarityInfo</code>ç»“æ„ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">æ ‡ç­¾ç›¸ä¼¼ä¿¡æ¯</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> TagsSimilarityInfo : IComparable&lt;TagsSimilarityInfo&gt;, IComparable { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Index { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Similarity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TagsSimilarityInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> similarity</span></span></span><span class="hljs-function">)</span></span> { Index = index; Similarity = similarity; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsSimilarityInfo other</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Index == other.Index &amp;&amp; Similarity == other.Similarity; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> TagsSimilarityInfo other &amp;&amp; Equals(other); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHashCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">unchecked</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Index * <span class="hljs-number"><span class="hljs-number">397</span></span>) ^ Similarity; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CompareTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsSimilarityInfo other</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> similarityComparison = other.Similarity.CompareTo(Similarity); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> similarityComparison != <span class="hljs-number"><span class="hljs-number">0</span></span> ? similarityComparison : Index.CompareTo(other.Index); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CompareTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ReferenceEquals(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, obj)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> TagsSimilarityInfo other ? CompareTo(other) : <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">$"Object must be of type </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">nameof</span></span></span></span><span class="hljs-string"><span class="hljs-subst">(TagsSimilarityInfo)}</span></span></span><span class="hljs-string">"</span></span>); } }</code> </pre> </div></div><br><p> æˆ‘ä¸ºæ­¤ç®—æ³•å‡†å¤‡äº†ä¸‰ä¸ªåŸºå‡†ï¼š </p><br><ul><li> å®Œå…¨éšæœºçš„åŸºå‡†ï¼Œå³ ç»„ä¸­å·²è®¾ç½®æ ‡ç­¾çš„æ•°é‡æ˜¯éšæœºçš„ï¼Œæˆ‘ä»¬å°†ä¸ä¹‹æ¯”è¾ƒçš„æ ‡ç­¾ç»„ä¹Ÿæ˜¯éšæœºçš„ï¼› </li><li> ç»„ä¸­è®¾ç½®çš„æ ‡ç­¾æ•°é‡åœ¨å¢åŠ ï¼Œæˆ‘ä»¬å°†ä¸è®¾ç½®æ‰€æœ‰æ ‡ç­¾çš„ç»„è¿›è¡Œæ¯”è¾ƒã€‚ äº‹å®è¯æ˜ï¼Œæœ€åä¸€äº›æ ‡ç­¾ç»„åº”è¯¥æ˜¯æœ€åˆé€‚çš„ã€‚ </li><li> ä¸ä¸Šè¿°ç›¸åŒï¼Œä½†å…¬å¼€æ ‡ç­¾çš„æ•°é‡æ­£åœ¨å‡å°‘ã€‚ å‰50ç»„æ ‡ç­¾æœ€åˆé€‚ï¼› </li></ul><br><p> ä»¥ä¸‹æ˜¯ä¸€ç™¾ä¸‡ä¸ªå°ç»„çš„åŸºå‡†æµ‹è¯•ç»“æœï¼š </p><br><p>  BenchmarkDotNet = v0.11.5ï¼Œæ“ä½œç³»ç»Ÿ= Windows 10.0.17134.765ï¼ˆ1803 / April 2018Update / Redstone4ï¼‰ <br> è‹±ç‰¹å°”é…·ç¿i7-6700 CPU 3.40GHzï¼ˆSkylakeï¼‰ï¼Œ1ä¸ªCPUï¼Œ8ä¸ªé€»è¾‘å’Œ4ä¸ªç‰©ç†æ ¸å¿ƒ <br> é¢‘ç‡= 3328126 Hzï¼Œåˆ†è¾¨ç‡= 300.4694 nsï¼Œè®¡æ—¶å™¨= TSC <br>  .NET Core SDK = 3.0.100-preview5-011568 <br>  [ä¸»æœº]ï¼š.NET Core 3.0.0-preview5-27626-15ï¼ˆCoreCLR 4.6.27622.75ï¼ŒCoreFX 4.700.19.22408ï¼‰ï¼Œ64ä½RyuJIT </p><br><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> å‡å€¼ </th><th> å¤±è¯¯ </th><th> æ ‡å‡†å·® </th><th> å·²åˆ†é… </th></tr></thead><tbody><tr><td> éšæœºæµ‹è¯• </td><td>  25.054ç§’ </td><td>  0.1786ç§’ </td><td>  0.1670ç§’ </td><td>  1.53 KB </td></tr><tr><td> ä¸Šå‡æµ‹è¯• </td><td>  4.180ç§’ </td><td>  0.0174ç§’ </td><td>  0.0162 s </td><td>  1.53 KB </td></tr><tr><td> åä»£æµ‹è¯• </td><td>  4.147ç§’ </td><td>  0.0118ç§’ </td><td>  0.0104ç§’ </td><td>  1.53 KB </td></tr></tbody></table></div><br><p> æ‰§è¡Œæ—¶é—´çš„è·¨åº¦å¾ˆå¤§ï¼Œé™¤äº†25ç§’æ˜¯å¾ˆé•¿çš„æ—¶é—´ï¼Œæˆ‘çš„åŒäº‹ä¸åŒæ„ç­‰å¾…é‚£ä¹ˆé•¿æ—¶é—´ã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬è¿›è¡Œä¼˜åŒ–ã€‚ ç°åœ¨ï¼Œæœ‰ä¸‰ä¸ªä¸»è¦æ–¹é¢å¯ä»¥åŠ å¿«ç¨‹åºçš„é€Ÿåº¦ï¼š </p><br><ul><li>  <code>MeasureSimilarity</code>æ–¹æ³•ï¼› </li><li>  <code>GetFiftyMostSimilarGroups</code>å¾ªç¯ä¸»ä½“ä¸­çš„ä¸€ç§ç®—æ³•; </li><li>  <code>GetFiftyMostSimilarGroups</code>çš„å¾ªç¯æœ¬èº«ï¼› </li></ul><br><p> æˆ‘ä»¬å°†ä¾æ¬¡è€ƒè™‘ä¸‰ä¸ªæ–¹å‘ã€‚ </p><br><h1 id="predskazanie-vetvleniy"> åˆ†æ”¯é¢„æµ‹ </h1><br><p> é¦–å…ˆï¼Œè€ƒè™‘<code>MeasureSimilarity</code>æ–¹æ³•ã€‚ </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeasureSimilarity</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup a, TagsGroup b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; TagsGroupLength; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a.InnerTags[i] &amp;&amp; a.InnerTags[i] == b.InnerTags[i]) result++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p> åœ¨ä»¥å‰çš„åŸºå‡†æµ‹è¯•ä¸­ï¼Œéšæœºæµ‹è¯•å’Œä»»ä½•é¡ºåºæµ‹è¯•ä¹‹é—´çš„è¿è¡Œæ—¶å·®å¼‚éƒ½å¾ˆå¤§ã€‚ é¡ºåºæµ‹è¯•çš„æ ‡ç­¾ç»„æ˜¯æ ¹æ®ä»¥ä¸‹åŸç†åˆ›å»ºçš„ï¼š </p><br><ul><li> å°†æ‰€éœ€æ•°é‡çš„ç»„åˆ†ä¸ºå¤šä¸ªåŒ…ã€‚ æ•°æ®åŒ…æ•°é‡-ç»„ä¸­æ ‡ç­¾çš„æœ€å¤§æ•°é‡ï¼› </li><li> å¯¹äºç¬¬iä¸ªæ•°æ®åŒ…ä¸­çš„æ¯ä¸ªç»„ï¼Œéƒ½è®¾ç½®äº†ç¬¬ä¸€ä¸ªiæ ‡ç­¾ï¼› </li></ul><br><p> äº‹å®è¯æ˜ï¼Œè¿™äº›æµ‹è¯•ä¸­çš„æ¯ç»„æ ‡ç­¾éƒ½ç”±â€‹â€‹æš´éœ²å’Œæœªæš´éœ²æ ‡ç­¾çš„ä¸¤ä¸ªè¿ç»­éƒ¨åˆ†ç»„æˆã€‚  <code>MeasureSimilarity</code>å…·æœ‰å¤„ç†å™¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ†æ”¯é¢„æµ‹</a>åœ¨å½“å‰æ¡ä»¶ä¸‹å…·æœ‰æ˜¾è‘—ä½œç”¨çš„æ‰€æœ‰å…ˆå†³æ¡ä»¶ã€‚ è¦æ£€æŸ¥è¿™ä¸€ç‚¹ï¼Œåªéœ€ç¼–å†™ä¸€ä¸ªåŸºå‡†ï¼Œæ¯”è¾ƒéšæœºæ•°æ®å’Œé¡ºåºæ•°æ®çš„MeasureSimilarityè¿è¡Œæ—¶ï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSimilaritySum</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup[] tagsGroups</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (TagsGroup tagsGroup <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tagsGroups) { result += TagsGroup.MeasureSimilarity(tagsGroup, etalon); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } [Benchmark] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sorted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; GetSimilaritySum(sortedGroups); [Benchmark] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Unsorted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; GetSimilaritySum(unsortedGroups);</code> </pre> <br><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> å‡å€¼ </th><th> å¤±è¯¯ </th><th> æ ‡å‡†å·® </th></tr></thead><tbody><tr><td> å·²æ’åº </td><td>  3.704ç§’ </td><td>  0.0411ç§’ </td><td>  0.0364ç§’ </td></tr><tr><td> æœªåˆ†ç±» </td><td>  8.211ç§’ </td><td>  0.0381ç§’ </td><td>  0.0338ç§’ </td></tr></tbody></table></div><br><p> æµ‹è¯•äº†100ä¸‡ä¸ªæ ‡ç­¾ç»„ï¼Œä½†é¦–å…ˆåœ¨æ¯ä¸ªç»„ä¸­è¿›è¡Œ<code>Sorted</code> ï¼Œç„¶åæœ‰å‡ ä¸ªæš´éœ²çš„æ ‡ç­¾ï¼Œç„¶åæ˜¯æœªæš´éœ²çš„æ ‡ç­¾ï¼Œåœ¨æœªåˆ†ç±»çš„ä¸­ï¼Œç›¸åŒæ•°é‡çš„æš´éœ²æ ‡ç­¾è¢«éšæœºæ•£å¸ƒåœ¨æ•´ä¸ªç»„ä¸­ã€‚ <br>  5ç§’çš„é—´éš”ä»¤äººå°è±¡æ·±åˆ»ï¼Œéœ€è¦åšä¸€äº›äº‹æƒ…ã€‚ ä¸ºäº†æ‘†è„±åˆ†æ”¯é¢„æµ‹çš„å½±å“å¹¶æ€»ä½“ä¸ŠåŠ å¿«è¯¥æ–¹æ³•çš„é€Ÿåº¦ï¼Œæ‚¨éœ€è¦æ‘†è„±åˆ†æ”¯æœ¬èº«ã€‚  <code>MeasureSimilarity</code>åªæœ‰ä¸€ä¸ªåˆ†æ”¯-æ£€æŸ¥æ˜¯å¦å°†ç›¸åº”æ ‡ç­¾è®¾ç½®ä¸ºä¸¤ç»„ã€‚ è®©æˆ‘ä»¬ä¼°è®¡ä¸€ä¸‹åœ¨å“ªç§æƒ…å†µä¸‹è¯¥æ¡ä»¶ä¸ºçœŸï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ¶ä½œä¸€ä¸ªè¡¨ä»¥æ˜¾ç¤ºè¯¥æ¡ä»¶çš„çœŸç›¸ï¼š </p><br><div class="scrollable-table"><table><thead><tr><th>  a.InnerTags [i] </th><th>  b.InnerTags [i] </th><th> ç»“æœ </th></tr></thead><tbody><tr><td> é”™è¯¯çš„ </td><td> é”™è¯¯çš„ </td><td> é”™è¯¯çš„ </td></tr><tr><td> é”™è¯¯çš„ </td><td> æ˜¯çš„ </td><td> é”™è¯¯çš„ </td></tr><tr><td> æ˜¯çš„ </td><td> é”™è¯¯çš„ </td><td> é”™è¯¯çš„ </td></tr><tr><td> æ˜¯çš„ </td><td> æ˜¯çš„ </td><td> æ˜¯çš„ </td></tr></tbody></table></div><br><p> çœŸå€¼è¡¨ä¸é€»è¾‘â€œä¸â€å®Œå…¨é‡åˆï¼Œå³ å½“ä¸”ä»…å½“ä¸¤ä¸ªæ ‡ç­¾éƒ½ä¸ºtrueæ—¶ï¼Œç»“æœæ‰ä¸ºtrueï¼Œåˆ™æ¡ä»¶å¯ä»¥ç®€åŒ–ä¸ºï¼š <code>if (a.InnerTags[i] &amp;&amp; b.InnerTags[i])</code> ã€‚ ä½†æ˜¯ï¼Œè¿™ç§æƒ…å†µä»ç„¶å­˜åœ¨ã€‚ åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†ç¡®ä¿å§‹ç»ˆæ‰§è¡Œå¯¹ç»“æœçš„åŠ æ³•æ“ä½œï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†é‡å†™å¾ªç¯ä¸»ä½“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = a.InnerTags[i] &amp;&amp; b.InnerTags[i] ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; result += t;</code> </pre> <br><p> æˆ‘ä»¬ä»ç„¶æ²¡æœ‰æ‘†è„±è¿™ç§æƒ…å†µï¼Œå®é™…ä¸Šç”šè‡³ä½¿æ–¹æ³•å˜æ…¢äº†ã€‚ ä½†æ˜¯ç°åœ¨å¾ˆæ˜æ˜¾çš„æ˜¯ï¼Œå¦‚æœå°†<code>InnerTags</code>çš„ç±»å‹ä»boolæ›´æ”¹ä¸ºå­—èŠ‚ï¼ˆ1è¡¨ç¤ºtrueï¼Œ0è¡¨ç¤ºfalseï¼‰ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥æ‘†è„±ä¸‰å…ƒè¿ç®—ç¬¦ä¸­çš„æ¡ä»¶ã€‚ ç„¶åï¼Œ <code>TagsGroup</code>ç±»å°†å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><div class="spoiler">  <b class="spoiler_title">æ ‡ç­¾ç»„</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TagsGroup</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TagsGroupLength = <span class="hljs-number"><span class="hljs-number">4096</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] InnerTags { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeasureSimilarity</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup a, TagsGroup b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; TagsGroupLength; i++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = a.InnerTags[i] &amp; b.InnerTags[i]; result += t; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TagsGroup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] innerTags</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (innerTags == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(innerTags)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (innerTags.Length != TagsGroupLength) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(innerTags)); } InnerTags = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[TagsGroupLength]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; TagsGroupLength; i++) { InnerTags[i] = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) (innerTags[i] ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>); } } }</code> </pre> </div></div><br><p> ä»¥ä¸‹æ˜¯æ›´æ–°åçš„<code>MeasureSimilarity</code>çš„åŸºå‡†æµ‹è¯•ç»“æœï¼š </p><br><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> å‡å€¼ </th><th> å¤±è¯¯ </th><th> æ ‡å‡†å·® </th></tr></thead><tbody><tr><td> å·²æ’åº </td><td>  3.180ç§’ </td><td>  0.0118ç§’ </td><td>  0.0111ç§’ </td></tr><tr><td> æœªåˆ†ç±» </td><td>  3.236ç§’ </td><td>  0.0622ç§’ </td><td>  0.0764ç§’ </td></tr></tbody></table></div><br><div class="spoiler">  <b class="spoiler_title">åŸä¸ºï¼š</b> <div class="spoiler_text"><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> å‡å€¼ </th><th> å¤±è¯¯ </th><th> æ ‡å‡†å·® </th></tr></thead><tbody><tr><td> å·²æ’åº </td><td>  3.704ç§’ </td><td>  0.0411ç§’ </td><td>  0.0364ç§’ </td></tr><tr><td> æœªåˆ†ç±» </td><td>  8.211ç§’ </td><td>  0.0381ç§’ </td><td>  0.0338ç§’ </td></tr></tbody></table></div></div></div><br><p> ä½†å¯¹äºæ›´æ–°åçš„ä¸»è¦æ ‡è®°ï¼š </p><br><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> å‡å€¼ </th><th> å¤±è¯¯ </th><th> æ ‡å‡†å·® </th><th> å·²åˆ†é… </th></tr></thead><tbody><tr><td> éšæœºæµ‹è¯• </td><td>  3.219ç§’ </td><td>  0.0492ç§’ </td><td>  0.0436ç§’ </td><td>  1.53 KB </td></tr><tr><td> ä¸Šå‡æµ‹è¯• </td><td>  3.223ç§’ </td><td>  0.0117ç§’ </td><td>  0.0110ç§’ </td><td>  1.53 KB </td></tr><tr><td> åä»£æµ‹è¯• </td><td>  3.422ç§’ </td><td>  0.0697ç§’ </td><td>  0.0999ç§’ </td><td>  1.53 KB </td></tr></tbody></table></div><br><div class="spoiler">  <b class="spoiler_title">åŸä¸ºï¼š</b> <div class="spoiler_text"><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> å‡å€¼ </th><th> å¤±è¯¯ </th><th> æ ‡å‡†å·® </th><th> å·²åˆ†é… </th></tr></thead><tbody><tr><td> éšæœºæµ‹è¯• </td><td>  25.054ç§’ </td><td>  0.1786ç§’ </td><td>  0.1670ç§’ </td><td>  1.53 KB </td></tr><tr><td> ä¸Šå‡æµ‹è¯• </td><td>  4.180ç§’ </td><td>  0.0174ç§’ </td><td>  0.0162 s </td><td>  1.53 KB </td></tr><tr><td> åä»£æµ‹è¯• </td><td>  4.147ç§’ </td><td>  0.0118ç§’ </td><td>  0.0104ç§’ </td><td>  1.53 KB </td></tr></tbody></table></div></div></div><br><p> æˆ‘è®¤ä¸ºè¿™å·²ç»å¾ˆæ£’ã€‚ å¯¹äºé‚£äº›ç¡®ä¿¡æ‰€æœ‰åŠ é€Ÿä»…æ˜¯å› ä¸ºå¸ƒå°”ç±»å‹è¢«æ›¿æ¢ä¸ºå­—èŠ‚æ‰å‘ç”Ÿçš„é‚£äº›äººï¼Œæˆ‘ä¸ºè¿™æ ·çš„å¾ªç¯ä½“å¯åŠ¨äº†ä¸€ä¸ªåŸºå‡†ï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = a.InnerTags[i] &amp; b.InnerTags[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t == <span class="hljs-number"><span class="hljs-number">1</span></span>) result += t;</code> </pre> <br><p> ç»“æœå¦‚ä¸‹ï¼š </p><br><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> å‡å€¼ </th><th> å¤±è¯¯ </th><th> æ ‡å‡†å·® </th></tr></thead><tbody><tr><td> å·²æ’åº </td><td>  3.760ç§’ </td><td>  0.0746ç§’ </td><td>  0.1541ç§’ </td></tr><tr><td> æœªåˆ†ç±» </td><td>  8.628ç§’ </td><td>  0.1699ç§’ </td><td>  0.2382ç§’ </td></tr></tbody></table></div><br><h1 id="upakovyvanie-dannyh"> æ•°æ®æ‰“åŒ… </h1><br><p> æ¯ä¸ªç»„éƒ½æœ‰è®¸å¤šæ ‡ç­¾ï¼Œå¹¶ä¸”ä¸èƒ½ä»¥ä»»ä½•æ–¹å¼å‡å°‘å…¶æ•°é‡ã€‚ å¦å¤–ï¼Œå¿…é¡»æ¯”è¾ƒå…·æœ‰ç›¸åŒç´¢å¼•çš„æ ‡ç­¾ï¼Œå¹¶ä¸”ä¸æ£€æŸ¥æ‰€æœ‰æ ‡ç­¾å°±ä¸èƒ½ç»™å‡ºæœ€ç»ˆç­”æ¡ˆã€‚ å› æ­¤ï¼Œæ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸éå†æ•´ä¸ªæ ‡ç­¾ç»„ã€‚ èƒ½å¤Ÿä»¥æŸç§æ–¹å¼å¹¶è¡ŒåŒ–æ­¤ä»»åŠ¡éå¸¸å¥½ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸€ä¸ªæ¡ä»¶æ“ä½œä¸­å¤„ç†å¤šä¸ªæ ‡ç­¾ã€‚ æ‚¨å¯ä»¥é€šè¿‡çœŸæ­£çš„å¹¶è¡ŒåŒ–æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç‰¹æ®Šçš„æ•°æ®æ‰“åŒ…æ¥å®ç°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒä»¬ã€‚ ç°åœ¨ï¼Œæ¯ä¸ªæ ‡ç­¾è¡¨ç¤º1æˆ–0ã€‚åœ¨ç»“æœä¸­ï¼Œä»…å¯¹â€œ ANDâ€è¿ç®—<code>result</code>ç»“æœè¿›è¡Œç´¯åŠ ã€‚ ä½†æ˜¯ï¼Œç›¸åŒçš„é€»è¾‘è¿ç®—ä¸ä»…å¯ä»¥åº”ç”¨äºå•ä½æ•°å­—ã€‚  Cï¼ƒå…è®¸æ‚¨åšåˆ°è¿™ä¸€ç‚¹è€Œä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ï¼ˆæœ€å¤š64ä½æ•°å­—ï¼‰ï¼ˆæ‚¨å¯ä»¥é€šè¿‡<code>BitArray</code>è¿›è¡Œæ›´å¤šæ“ä½œï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ï¼‰ã€‚ å¦‚æœæˆ‘ä»¬å°†ä¸¤ç»„æ ‡ç­¾è¡¨ç¤ºä¸ºä¸€ç»„64ä½æ•°å­—ï¼Œå¹¶è®¾ç½®äº†ç›¸åº”çš„ä½ï¼Œåˆ™å¯ä»¥å¯¹æ¯ç»„è¿™æ ·çš„64ä½æ•°å­—æ‰§è¡Œâ€œä¸â€è¿ç®—ã€‚ ç›®å‰å°šä¸æ¸…æ¥šè¯¥å¦‚ä½•å¤„ç†ç»“æœã€‚ è®©æˆ‘ä»¬å†æ¬¡çœ‹ä¸€ä¸‹å¾ªç¯çš„ä¸»ä½“ï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = a.InnerTags[i] &amp; b.InnerTags[i]; result += t;</code> </pre> <br><p> æ¯å½“t == 1æ—¶ç»“æœå¢åŠ 1ï¼Œè€Œå½“t == 0æ—¶ç»“æœä¸å˜ã€‚ç»“æœå°†ç­‰äº<code>a.InnerTags[i] &amp; b.InnerTags[i]</code>çš„ç»“æœç­‰äº1çš„æ¬¡æ•°ã€‚ å› æ­¤ï¼Œå¯ä»¥å°†<code>a.InnerTags[i] &amp; b.InnerTags[i]</code>æ‰€æœ‰ç»“æœä¿å­˜åœ¨æŸä¸ªæ•°ç»„ä¸­ï¼Œå¹¶ä¸”åœ¨ç»“æœä¸­ä»…å†™å…¥è¯¥æ•°ç»„ä¸­çš„å•å…ƒæ•°ã€‚ å½“å¯¹å¤šäºnä½çš„æ•°å­—æ‰§è¡ŒANDæ“ä½œæ—¶ï¼Œå°†å¾—åˆ°nä½çš„ç»“æœï¼Œä»…çŸ¥é“nä¸­è®¾ç½®äº†å¤šå°‘ä½å°±è¶³å¤Ÿäº†ã€‚ æ•°å­—ä¸­è®¾ç½®çš„ä½æ•°ä¸å˜ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥è®¡ç®—è¿™äº›æ•°å­—ã€‚ è®¡ç®—64ä½æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸º æˆ‘ä»¬ä¸ä¼šæ‰¾åˆ°å¤ªå¤šçš„RAMã€‚ å¯¹äº32ä½ï¼Œæ‚¨å·²ç»å¯ä»¥åœ¨ç°ä»£è®¡ç®—æœºä¸Šæ‰¾åˆ°ç©ºé—´ï¼Œä½†è¿™ä»ç„¶å¾ˆå¤šã€‚  16ä½ä»¥ä¸‹çš„å†…å­˜å¹¶ä¸éš¾æ‰¾åˆ°ï¼Œä½†è®¡ç®—ä¼šç›¸å¯¹è¾ƒé•¿ã€‚ ä½œä¸ºæŠ˜è¡·æ–¹æ¡ˆï¼Œè®©æˆ‘ä»¬è®¡ç®—8ä½æ•°å­—ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">GenerateCountOfSettedBits</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] CountOfSettedBits = GenerateCountOfSettedBits(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">byte</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateCountOfSettedBits</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  result   i      i- . byte[] result = new byte[256]; //  ,      i   , //        int[] b = new int[8]; //     for (int i = 1; i &lt; 256; i++) { //       int settedBitsCount = 0; //,       int m = 1; //   for (int j = 0; j &lt; 8; j++) { //     b[j] += m; //  ,       2. m = b[j] &gt;&gt; 1; //        b[j] = b[j] &amp; 1; //,        settedBitsCount += b[j]; } result[i] = (byte) settedBitsCount; //   } return result; }</span></span></code> </pre> </div></div><br><p> ç°åœ¨ï¼ŒTagsGroupæ„é€ å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> BucketSize = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TagsGroup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] innerTags</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (innerTags == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(innerTags)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (innerTags.Length != TagsGroupLength) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(innerTags)); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    InnerTags = new byte[TagsGroupLength / BucketSize]; //   for (int i = 0; i &lt; TagsGroupLength / BucketSize; i++) { //     for (int j = 0; j &lt; BucketSize; j++, index++) { //    2,      InnerTags[i] &lt;&lt;= 1; //    InnerTags[i] += (byte) (innerTags[index] ? 1 : 0); } } }</span></span></code> </pre> <br><p>  <code>MeasureSimilarity</code>å¼€å§‹çœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeasureSimilarity</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup a, TagsGroup b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; TagsGroupLength / BucketSize; i++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = a.InnerTags[i] &amp; b.InnerTags[i]; result += CountOfSettedBits[t]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p> æ‚¨å¯ä»¥è¿è¡Œå¤§å‹åŸºå‡†æµ‹è¯•ï¼Œå¹¶ç¡®ä¿ä¸€åˆ‡éƒ½æ›´å¥½ï¼š </p><br><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> å‡å€¼ </th><th> å¤±è¯¯ </th><th> æ ‡å‡†å·® </th><th> å·²åˆ†é… </th></tr></thead><tbody><tr><td> éšæœºæµ‹è¯• </td><td>  560.5æ¯«ç§’ </td><td>  8.285æ¯«ç§’ </td><td>  7.344æ¯«ç§’ </td><td>  1.53 KB </td></tr><tr><td> ä¸Šå‡æµ‹è¯• </td><td>  570.1æ¯«ç§’ </td><td>  4.108æ¯«ç§’ </td><td>  3.431æ¯«ç§’ </td><td>  1.53 KB </td></tr><tr><td> åä»£æµ‹è¯• </td><td>  608.1æ¯«ç§’ </td><td>  5.691æ¯«ç§’ </td><td>  5.324æ¯«ç§’ </td><td>  1.53 KB </td></tr></tbody></table></div><br><p> æ˜¯å¦å¯ä»¥ä½¿<code>MeasureSimilarity</code>æ–¹æ³•æ›´å¿«ï¼Ÿ å½“ç„¶å¯ä»¥ï¼ ä¸ºæ­¤ï¼Œè¶³ä»¥è®¤è¯†åˆ°é€šç”¨å¯„å­˜å™¨ç°åœ¨å¤§å¤šæ•°éƒ½æ˜¯64ä½ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨å…¶ä¸­é©±åŠ¨äº†8ä½æ•°æ®ã€‚ ä¸ºæ­¤ï¼Œè¯·å¢åŠ å°†åŸå§‹æ ‡ç­¾æ‰“åŒ…åˆ°çš„æ•°æ®åŒ…å¤§å°ï¼Œå°†å…¶å¢åŠ åˆ°64ä½ï¼Œç„¶åé‡å†™å¿…è¦çš„æ–¹æ³•ï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> BucketSize = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span>[] InnerTags { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeasureSimilarity</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup a, TagsGroup b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; TagsGroupLength / BucketSize; i++) { <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> t = a.InnerTags[i] &amp; b.InnerTags[i]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; BucketSize / <span class="hljs-number"><span class="hljs-number">8</span></span>; j++) { result += CountOfSettedBits[t &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>]; t &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p> ç»“æœæ˜¯ï¼š </p><br><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> å‡å€¼ </th><th> å¤±è¯¯ </th><th> æ ‡å‡†å·® </th><th> å·²åˆ†é… </th></tr></thead><tbody><tr><td> éšæœºæµ‹è¯• </td><td>  533.3æ¯«ç§’ </td><td>  4.802æ¯«ç§’ </td><td>  4.492æ¯«ç§’ </td><td>  1.53 KB </td></tr><tr><td> ä¸Šå‡æµ‹è¯• </td><td>  550.9æ¯«ç§’ </td><td>  5.435æ¯«ç§’ </td><td>  5.084æ¯«ç§’ </td><td>  1.53 KB </td></tr><tr><td> åä»£æµ‹è¯• </td><td>  567.6æ¯«ç§’ </td><td>  3.879æ¯«ç§’ </td><td>  3.439æ¯«ç§’ </td><td>  1.53 KB </td></tr></tbody></table></div><br><p> ç„¶åï¼Œæ‚¨å¯ä»¥å±•å¼€å†…éƒ¨å¾ªç¯ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">åº¦é‡ç›¸ä¼¼åº¦</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeasureSimilarity</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup a, TagsGroup b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; TagsGroupLength / BucketSize; i++) { <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> t = a.InnerTags[i] &amp; b.InnerTags[i]; result += CountOfSettedBits[t &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>]; t &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; result += CountOfSettedBits[t &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>]; t &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; result += CountOfSettedBits[t &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>]; t &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; result += CountOfSettedBits[t &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>]; t &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; result += CountOfSettedBits[t &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>]; t &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; result += CountOfSettedBits[t &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>]; t &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; result += CountOfSettedBits[t &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>]; t &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; result += CountOfSettedBits[t &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> </div></div><br><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> å‡å€¼ </th><th> å¤±è¯¯ </th><th> æ ‡å‡†å·® </th><th> å·²åˆ†é… </th></tr></thead><tbody><tr><td> éšæœºæµ‹è¯• </td><td>  370.5æ¯«ç§’ </td><td>  2.802æ¯«ç§’ </td><td>  2.484æ¯«ç§’ </td><td>  1.53 KB </td></tr><tr><td> ä¸Šå‡æµ‹è¯• </td><td>  395.8æ¯«ç§’ </td><td>  2.682æ¯«ç§’ </td><td>  2.509æ¯«ç§’ </td><td>  1.53 KB </td></tr><tr><td> åä»£æµ‹è¯• </td><td>  419.5æ¯«ç§’ </td><td>  3.352æ¯«ç§’ </td><td>  2.971æ¯«ç§’ </td><td>  1.53 KB </td></tr></tbody></table></div><br><p> å®ƒæ›´å¿«å—ï¼Ÿ æ˜¯çš„ å¦‚æœæ‚¨ä½¿ç”¨.NET Core 3.0çš„åˆ›æ–°åŠŸèƒ½ã€‚ å°½ç®¡æ­¤ç‰ˆæœ¬ä»åœ¨é¢„è§ˆä¸­ï¼Œä½†æ˜¯ä»ä¸€å¼€å§‹å°±å­˜åœ¨ä¸€äº›å†…éƒ¨å‡½æ•°çš„å®ç°ã€‚ è‹±ç‰¹å°”å†…éƒ¨æŒ‡å—å…·æœ‰å†…éƒ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>_mm_popcnt_u64</code></a> ã€‚ å¦‚å‰æ‰€è¿°ï¼šâ€œ <em>å¯¹æ— ç¬¦å·64ä½æ•´æ•°aä¸­è®¾ç½®ä¸º1çš„ä½æ•°è¿›è¡Œè®¡æ•°ï¼Œå¹¶åœ¨dstä¸­è¿”å›è¯¥è®¡æ•°ã€‚</em> â€ã€‚ è¿™æ­£æ˜¯æˆ‘ä»¬æ­£åœ¨åŠªåŠ›å®ç°çš„ç›®æ ‡ï¼ åœ¨.NET Core 3.0 Preview 5ä¸­ï¼Œæ­¤å†…åœ¨å‡½æ•°åœ¨<code>System.Runtime.Intrinsics.X86.Popcnt.X64.PopCount</code>å®ç°ï¼ˆå¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">a-tk</a>æ³¨é‡Šä¸­æ­£ç¡®æŒ‡å‡ºçš„é‚£æ ·ï¼Œåœ¨ä½¿ç”¨å†…åœ¨å‡½æ•°ä¹‹å‰ï¼Œæ‚¨å¿…é¡»éªŒè¯å¤„ç†å™¨æ˜¯å¦æ”¯æŒå®ƒä»¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·æ£€æŸ¥<code>System.Runtime.Intrinsics.X86.Popcnt.X64.IsSupported</code>çŠ¶å†µ<code>System.Runtime.Intrinsics.X86.Popcnt.X64.IsSupported</code> ï¼‰ã€‚ ä½¿ç”¨å®ƒï¼Œ <code>MeasureSimilarity</code>æ–¹æ³•çš„ä»£ç å°†å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MeasureSimilarity</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup a, TagsGroup b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; TagsGroupLength / BucketSize; i++) { <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> t = a.InnerTags[i] &amp; b.InnerTags[i]; result += (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) System.Runtime.Intrinsics.X86.Popcnt.X64.PopCount(t); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p> å’Œæ‰§è¡Œæ—¶é—´ï¼š </p><br><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> å‡å€¼ </th><th> å¤±è¯¯ </th><th> æ ‡å‡†å·® </th><th> å·²åˆ†é… </th></tr></thead><tbody><tr><td> éšæœºæµ‹è¯• </td><td>  59.33æ¯«ç§’ </td><td>  1.148æ¯«ç§’ </td><td>  0.9585æ¯«ç§’ </td><td>  1.53 KB </td></tr><tr><td> ä¸Šå‡æµ‹è¯• </td><td>  74.87æ¯«ç§’ </td><td>  1.479æ¯«ç§’ </td><td>  1.9748æ¯«ç§’ </td><td>  1.53 KB </td></tr><tr><td> åä»£æµ‹è¯• </td><td>  119.46æ¯«ç§’ </td><td>  2.321æ¯«ç§’ </td><td>  2.8509æ¯«ç§’ </td><td>  1.53 KB </td></tr></tbody></table></div><br><p> ä»¤äººå°è±¡æ·±åˆ»ã€‚ <br> æˆ‘ä¸çŸ¥é“å¯ä»¥æ˜¾ç€æé«˜<code>MeasureSimilarity</code>çš„æ–¹å¼ï¼ŒåŒæ—¶åˆä¸ä¼šæå¤§åœ°æŸå®³å¯è¯»æ€§ã€‚ æˆ‘è®¤ä¸ºæ‚¨å¯ä»¥ç»“æŸè¿™ç§æ–¹æ³•ã€‚ </p><br><h1 id="struktury-dannyh"> èµ„æ–™ç»“æ„ </h1><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å°†åœ¨<code>GetFiftyMostSimilarGroups</code>æ–¹æ³•ä¸­<code>GetFiftyMostSimilarGroups</code>å¾ªç¯çš„<code>GetFiftyMostSimilarGroups</code> ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">GetFiftyMostSimilarGroups</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TagsGroup[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFiftyMostSimilarGroups</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> resultLength = <span class="hljs-number"><span class="hljs-number">50</span></span>; List&lt;TagsSimilarityInfo&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;TagsSimilarityInfo&gt;(<span class="hljs-number"><span class="hljs-number">50</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> groupIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; groupIndex &lt; Groups.Length; groupIndex++) { TagsGroup tagsGroup = Groups[groupIndex]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> similarityValue = TagsGroup.MeasureSimilarity(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, tagsGroup); TagsSimilarityInfo newInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TagsSimilarityInfo(groupIndex, similarityValue); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list.Count == resultLength &amp;&amp; list[resultLength - <span class="hljs-number"><span class="hljs-number">1</span></span>].CompareTo(newInfo) == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = ~list.BinarySearch(newInfo); list.Insert(index, newInfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list.Count &gt; resultLength) { list.RemoveAt(resultLength); } } TagsGroup[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TagsGroup[resultLength]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; resultLength; i++) { result[i] = Groups[list[i].Index]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> </div></div><br><p> è®©æˆ‘ç®€è¦å›é¡¾ä¸€ä¸‹è¿™é‡Œå‘ç”Ÿçš„äº‹æƒ…ï¼š </p><br><ul><li> åœ¨åˆ—è¡¨ä¸­ï¼Œå¦‚æœæ¯”è¾ƒ<code>TagsSimilarityInfo</code> ï¼Œåˆ™ä¼šå­˜å‚¨äº”åä¸ªæœ€åˆé€‚çš„æ ‡ç­¾ç»„çš„æ’åºåˆ—è¡¨ï¼Œå®é™…ä¸Šæ˜¯ä»è¾ƒå°åˆ°è¾ƒå¤§ã€‚ </li><li> åœ¨ä¿ç•™æ’åºçš„åŒæ—¶å°†æœ‰é—®é¢˜çš„æ–°ç»„æ’å…¥åˆ—è¡¨ä¸­ï¼› </li><li> å¦‚æœåˆ—è¡¨ä¸­æœ‰50ä¸ªä»¥ä¸Šçš„å…ƒç´ ï¼Œåˆ™åˆ é™¤æœ€ä¸ç›¸ä¼¼çš„ç»„ï¼ˆå…¶ä¿¡æ¯å¯¹è±¡å°†æ˜¯æœ€å¤§çš„ï¼Œå¹¶ä¸”å°†åœ¨<code>list</code> ï¼‰ï¼› </li></ul><br><p> å³ äº‹å®è¯æ˜ï¼Œæˆ‘ä»¬éœ€è¦éå¸¸å¿«é€Ÿåœ°æ‰¾åˆ°é›†åˆä¸­æœ€å¤§çš„å…ƒç´ ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ’å…¥å’Œåˆ é™¤ã€‚ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæœ‰ç‰¹æ®Šçš„æ•°æ®ç»“æ„ã€‚ é¦–å…ˆæƒ³åˆ°çš„æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€å †</a> ã€‚ å¥¹çš„æ’å…¥åœ¨Oï¼ˆlog Nï¼‰ä¸­æ‰§è¡Œï¼Œåœ¨Oï¼ˆ1ï¼‰ä¸­è·å¾—æœ€å¤§å€¼ï¼Œåœ¨Oï¼ˆlog Nï¼‰ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ ã€‚ å”¯ä¸€çš„é—®é¢˜æ˜¯å¢åŠ çš„å…ƒç´ ä¸èƒ½ä¿®æ”¹å †è€Œä¸èƒ½å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚  BCLä¸­æ²¡æœ‰äºŒè¿›åˆ¶å †ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±å†™äº†å®ƒï¼š </p><br><div class="spoiler">  <b class="spoiler_title">äºŒè¿›åˆ¶å †</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BinaryHeap</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt;:<span class="hljs-title"><span class="hljs-title">IEnumerable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span> : <span class="hljs-title"><span class="hljs-title">IComparable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> List&lt;T&gt; innerList; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BinaryHeap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> capacity</span></span></span><span class="hljs-function">)</span></span> { innerList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;T&gt;(capacity); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Count =&gt; innerList.Count; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Max =&gt; innerList[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { innerList.Add(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> parent = (i - <span class="hljs-number"><span class="hljs-number">1</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; innerList[parent].CompareTo(innerList[i]) == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { Swap(i, parent); i = parent; parent = (i - <span class="hljs-number"><span class="hljs-number">1</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Swap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b</span></span></span><span class="hljs-function">)</span></span> { T temp = innerList[a]; innerList[a] = innerList[b]; innerList[b] = temp; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Heapify</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (;;) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> leftChild = (i &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) | <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rightChild = (i + <span class="hljs-number"><span class="hljs-number">1</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> largestChild = i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftChild &lt; Count &amp;&amp; innerList[leftChild].CompareTo(innerList[largestChild]) == <span class="hljs-number"><span class="hljs-number">1</span></span>) { largestChild = leftChild; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rightChild &lt; Count &amp;&amp; innerList[rightChild].CompareTo(innerList[largestChild]) == <span class="hljs-number"><span class="hljs-number">1</span></span>) { largestChild = rightChild; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (largestChild == i) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } Swap(i, largestChild); i = largestChild; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveMax</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { innerList[<span class="hljs-number"><span class="hljs-number">0</span></span>] = innerList[Count - <span class="hljs-number"><span class="hljs-number">1</span></span>]; innerList.RemoveAt(Count - <span class="hljs-number"><span class="hljs-number">1</span></span>); Heapify(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IEnumerator&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEnumerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> innerList.GetEnumerator(); } IEnumerator IEnumerable.GetEnumerator() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((IEnumerable) innerList).GetEnumerator(); } }</code> </pre> </div></div><br><p>  <code>GetFiftyMostSimilarGroups</code>æ–¹æ³•çš„ç›¸åº”å®ç°å¯ä»¥åœ¨æœ¬æ–‡çš„æºä»£ç ä¸­æ‰¾åˆ°ï¼ˆä¸‹é¢çš„é“¾æ¥ï¼‰ã€‚ <br> é™¤äº†å †ä¹‹å¤–ï¼Œå¯èƒ½è¿˜ä¼šå‡ºç°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äºŒå‰æœç´¢æ ‘</a> ã€‚ å¹³è¡¡çš„äºŒå‰æœç´¢æ ‘å¯ä»¥ä¸ºOï¼ˆlog Nï¼‰æä¾›æ’å…¥ï¼Œä¸ºOï¼ˆlog Nï¼‰æä¾›æœ€å¤§å€¼ï¼Œä¸ºOï¼ˆlog Nï¼‰é™¤å»å…ƒç´ ã€‚ è¿™ç§ç»“æ„çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æŒ‰å‡åºè¿›è¡Œè¿­ä»£ï¼Œæ­¤å¤–ï¼ŒBCLä¸­çš„çº¢é»‘æœç´¢æ ‘æ˜¯åœ¨SortedSetå†…éƒ¨å®ç°çš„ï¼ˆåœ¨å¤§å‹æ¡†æ¶ä¸­ï¼Œè·å¾—æœ€å¤§å€¼æ¯”.netcore 3.0ä¸­è¦æ…¢å¾—å¤šï¼Œå¹¶ä¸”è¦åˆ†é…å†…å­˜ï¼‰ã€‚ å¯ä»¥åœ¨æœ¬æ–‡çš„æºä»£ç ä¸­æ‰¾åˆ°SortedSetçš„<code>GetFiftyMostSimilarGroups</code>çš„å®ç°ã€‚ <br> æ‰€æœ‰ä¸‰ä¸ª<code>GetFiftyMostSimilarGroups</code>å®ç°çš„åŸºå‡†ç»“æœï¼š </p><br><div class="scrollable-table"><table><thead><tr><th> æ–¹æ³• </th><th> æ’åºç®—æ³• </th><th> å‡å€¼ </th><th> å·²åˆ†é… </th></tr></thead><tbody><tr><td> éšæœºæµ‹è¯• </td><td> æ¸…å• </td><td>  60.06æ¯«ç§’ </td><td>  1704ä¹™ </td></tr><tr><td> éšæœºæµ‹è¯• </td><td> æ’åºé›† </td><td>  65.46æ¯«ç§’ </td><td>  24384 B </td></tr><tr><td> éšæœºæµ‹è¯• </td><td> å † </td><td>  60.55æ¯«ç§’ </td><td>  2912ä¹™ </td></tr><tr><td> ä¸Šå‡æµ‹è¯• </td><td> æ¸…å• </td><td>  75.42æ¯«ç§’ </td><td>  1704ä¹™ </td></tr><tr><td> ä¸Šå‡æµ‹è¯• </td><td> æ’åºé›† </td><td>  161.12æ¯«ç§’ </td><td>  9833424 B </td></tr><tr><td> ä¸Šå‡æµ‹è¯• </td><td> å † </td><td>  86.87æ¯«ç§’ </td><td>  2912ä¹™ </td></tr><tr><td> åä»£æµ‹è¯• </td><td> æ¸…å• </td><td>  119.23æ¯«ç§’ </td><td>  880ä¹™ </td></tr><tr><td> åä»£æµ‹è¯• </td><td> æ’åºé›† </td><td>  125.03æ¯«ç§’ </td><td>  3024ä¹™ </td></tr><tr><td> åä»£æµ‹è¯• </td><td> å † </td><td>  118.62æ¯«ç§’ </td><td>  2088ä¹™ </td></tr></tbody></table></div><br><p> å¸¦æœ‰å¶å­çš„åŸå§‹å®ç°å‡ ä¹åœ¨ä»»ä½•æ—¶å€™éƒ½èµ¢äº†ï¼Œå½“ç„¶åœ¨å†…å­˜ä¸­ä¹Ÿèµ¢äº†ã€‚ å‘ç”Ÿè¿™ç§æƒ…å†µçš„åŸå› æ˜¯ï¼Œå¯¹äºå…·æœ‰å·¥ä½œè¡¨çš„ç®—æ³•ï¼Œå¯¹äºæœç´¢ï¼Œæ’å…¥æ“ä½œä»¥Oï¼ˆlog Nï¼‰æ‰§è¡Œï¼Œå¯¹äºæ’å…¥æ“ä½œï¼Œå‡ ä¹ä»¥Oï¼ˆ1ï¼‰æ‰§è¡Œæ“ä½œï¼Œå› ä¸º å¤åˆ¶è¿™ä¹ˆå°‘çš„å…ƒç´ å¾ˆå¿«å°±å‘ç”Ÿäº†ï¼Œè·å¾—Oï¼ˆ1ï¼‰çš„æœ€å¤§å€¼ï¼ŒåŒæ—¶ä¹Ÿåˆ é™¤Oï¼ˆ1ï¼‰çš„å…ƒç´ ï¼Œå› ä¸º åœ¨.netä¸­ï¼Œä»å·¥ä½œè¡¨ä¸­åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ çš„æ–¹æ³•æ˜¯ï¼Œå°†ä¸€ä¸ªç©ºå€¼å†™å…¥æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆåœ¨.netæ ¸å¿ƒä¸­ï¼Œæ²¡æœ‰ä»»ä½•å†…å®¹å†™å…¥ç»“æ„ï¼‰ã€‚ å¦‚æœè¦æ±‚ä¸ç»™å‡º50ä¸ªï¼Œè€Œæ˜¯è¯´1000ä¸ªæœ€ç›¸ä¼¼çš„ç»„ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½ï¼Œå¸¦æœ‰å·¥ä½œè¡¨çš„ç®—æ³•å°†ä¸èµ·ä½œç”¨ã€‚ å®é™…ä¸Šï¼Œæ‰€æœ‰è¿™äº›éƒ½æ˜¯ä¸€äº›æ¨æµ‹æ€§çš„æ¨ç†ï¼Œå› ä¸º æ‚¨ä»ç„¶å¯ä»¥è°ƒæ•´æ¯ç§ç®—æ³•ã€‚ </p><br><h1 id="mnogopotochnost"> å¤šçº¿ç¨‹ </h1><br><p> ç°åœ¨å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯å°è¯•æ”¹å–„<code>GetFiftyMostSimilarGroups</code>çš„å¾ªç¯æœ¬èº«ã€‚ åªæƒ³åˆ°å¤šçº¿ç¨‹ã€‚ æƒ³æ³•æ˜¯å°†æ•´ä¸ªç»„åˆ—è¡¨åˆ†æˆå‡ ä¸ªåŒ…ã€‚ åœ¨æ¯ä¸ªç¨‹åºåŒ…ä¸­ï¼Œæ‰¾åˆ°50ä¸ªæœ€ç›¸ä¼¼çš„æ ‡ç­¾ç»„ï¼Œç„¶ååœ¨å…¶ä¸­æ‰¾åˆ°æœ€å50ä¸ªæœ€ç›¸ä¼¼çš„æ ‡ç­¾ç»„ã€‚ <br>  <code>GetFiftyMostSimilarGroups</code>çš„å¤šçº¿ç¨‹ç‰ˆæœ¬å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><div class="spoiler">  <b class="spoiler_title">GetFiftyMostSimilarGroupsMultiThread</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TagsGroup[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFiftyMostSimilarGroupsMultiThread</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> resultLength = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ,     const int threadsCount = 4; //   int bucketSize = Groups.Length / threadsCount; var tasks = new Task&lt;List&lt;TagsSimilarityInfo&gt;&gt;[threadsCount]; for (int i = 0; i &lt; threadsCount; i++) { int leftIndex = i * bucketSize; //    int rightIndex = (i + 1) * bucketSize; //    //    tasks[i] = Task&lt;List&lt;TagsSimilarityInfo&gt;&gt;.Factory.StartNew(() =&gt; GetFiftyMostSimilarGroupsMultiThreadCore(value, leftIndex, rightIndex)); } Task.WaitAll(tasks); //    var taskResults = new List&lt;TagsSimilarityInfo&gt;[threadsCount]; for (int i = 0; i &lt; threadsCount; i++) { taskResults[i] = tasks[i].Result; } //      return MergeTaskResults(resultLength, threadsCount, taskResults); }</span></span></code> </pre> </div></div><br><p>  <code>GetFiftyMostSimilarGroupsMultiThreadCore</code>       <code>GetFiftyMostSimilarGroups</code> : </p><br><div class="spoiler"> <b class="spoiler_title">GetFiftyMostSimilarGroupsMultiThreadCore</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">List&lt;TagsSimilarityInfo&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFiftyMostSimilarGroupsMultiThreadCore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TagsGroup </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> leftIndex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rightIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> resultLength = <span class="hljs-number"><span class="hljs-number">50</span></span>; List&lt;TagsSimilarityInfo&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;TagsSimilarityInfo&gt;(resultLength); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> groupIndex = leftIndex; groupIndex &lt; rightIndex; groupIndex++) { TagsGroup tagsGroup = Groups[groupIndex]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> similarityValue = TagsGroup.MeasureSimilarity(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, tagsGroup); TagsSimilarityInfo newInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TagsSimilarityInfo(groupIndex, similarityValue); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list.Count == resultLength &amp;&amp; list[resultLength - <span class="hljs-number"><span class="hljs-number">1</span></span>].CompareTo(newInfo) == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = ~list.BinarySearch(newInfo); list.Insert(index, newInfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list.Count &gt; resultLength) { list.RemoveAt(resultLength); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; }</code> </pre> </div></div><br><p>     <code>MergeTaskResults</code> .   -    taskResults    . ,  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> .     ,  <code>threadsCount</code> ,     :         ,     ,    ,    : </p><br><div class="spoiler"> <b class="spoiler_title">MergeTaskResults</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">TagsGroup[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MergeTaskResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resultLength, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> threadsCount, List&lt;TagsSimilarityInfo&gt;[] taskResults</span></span></span><span class="hljs-function">)</span></span> { TagsGroup[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TagsGroup[resultLength]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] indices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[threadsCount]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; resultLength; i++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> minIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; TagsSimilarityInfo currentBest = taskResults[minIndex][indices[minIndex]]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; threadsCount; j++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current = taskResults[j][indices[j]]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current.CompareTo(currentBest) == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { minIndex = j; currentBest = taskResults[minIndex][indices[minIndex]]; } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> groupIndex = currentBest.Index; result[i] = Groups[groupIndex]; indices[minIndex]++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> </div></div><br><ul><li>  <code>indices</code>      <code>taskResults</code> ; </li><li> <code>minIndex</code> â€”   <code>taskResults</code> ,         ; </li><li> <code>currentBest</code> â€” -      ; </li><li> <code>current</code> â€” -    ; </li></ul><br><p>    : </p><br><div class="scrollable-table"><table><thead><tr><th> Method </th><th> Mean </th><th> Error </th><th> StdDev </th><th> Allocated </th></tr></thead><tbody><tr><td> RandomTest </td><td> 28.76 ms </td><td> 0.5677 ms </td><td> 1.414 ms </td><td> 1.4 KB </td></tr><tr><td> AscendantTest </td><td> 32.36 ms </td><td> 0.8930 ms </td><td> 2.591 ms </td><td> 1.4 KB </td></tr><tr><td> DescendantTest </td><td> 41.36 ms </td><td> 0.8908 ms </td><td> 2.626 ms </td><td> 1.4 KB </td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title">     :</b> <div class="spoiler_text"><div class="scrollable-table"><table><thead><tr><th> Method </th><th> Mean </th><th> Error </th><th> StdDev </th><th> Allocated </th></tr></thead><tbody><tr><td> RandomTest </td><td> 25054 ms </td><td> 1786 ms </td><td> 1670 ms </td><td> 1.53 KB </td></tr><tr><td> AscendantTest </td><td> 4180 ms </td><td> 174 ms </td><td> 162 ms </td><td> 1.53 KB </td></tr><tr><td> DescendantTest </td><td> 4147 ms </td><td> 118 ms </td><td> 104 ms </td><td> 1.53 KB </td></tr></tbody></table></div></div></div><br><p>            .   .    ,    ,       4  50. , ,   . </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    </a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN454850/">https://habr.com/ru/post/zh-CN454850/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN454830/index.html">æˆåŠŸçš„äº§å“ç»ç†çš„ä¸‰é¡¹å…³é”®ç´ è´¨ï¼šäºšå†å±±å¤§Â·åˆ«åˆ©äºšè€¶å¤«ï¼ˆAlexander Belyaevï¼‰</a></li>
<li><a href="../zh-CN454832/index.html">ä¸ºä»€ä¹ˆæ¯å‘¨å·¥ä½œå››å¤©æ˜¯ä¸€ä¸ªåæ•…äº‹</a></li>
<li><a href="../zh-CN454834/index.html">ä½åŠ¨åŠ›çš„è§¦æ‘¸æ‰“å­—ç ”ç©¶çš„çœŸæ­£æœ¯è¯­</a></li>
<li><a href="../zh-CN454840/index.html">å¸¦ç€å¦»å­å’ŒæŠµæŠ¼è´·æ¬¾å°å¿ƒåœ°æ¬åˆ°è·å…°ã€‚ ç¬¬2éƒ¨åˆ†ï¼šå‡†å¤‡æ–‡ä»¶å’Œç§»åŠ¨</a></li>
<li><a href="../zh-CN454844/index.html">Odigestï¼šæœ¬å‘¨çš„è®¾è®¡å¸ˆæ„Ÿå…´è¶£</a></li>
<li><a href="../zh-CN454856/index.html">æˆ‘ä»¬åˆ†æéæµè§ˆå™¨è½¯ä»¶ä¸­çš„SSL / TLSè¯ä¹¦éªŒè¯æ¼æ´</a></li>
<li><a href="../zh-CN454860/index.html">è®©æˆ‘ä»¬å¸®åŠ©QueryProviderå¤„ç†æ’å€¼å­—ç¬¦ä¸²</a></li>
<li><a href="../zh-CN454864/index.html">å„ä¸ªå…¬å¸çš„å‘å±•è¿‡ç¨‹å¦‚ä½•</a></li>
<li><a href="../zh-CN454868/index.html">åœ¨æ²¡æœ‰Emscriptençš„WebAssemblyä¸­ç¼–è¯‘C</a></li>
<li><a href="../zh-CN454872/index.html">å¤ªç©ºå…¥ä¾µè€…ï¼šç°åœ¨ä¸º512å­—èŠ‚ï¼ˆæ±‡ç¼–ç¨‹åºx86ï¼‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>