<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👲🏾 👨‍👨‍👦‍👦 🔔 Datenwiederherstellung aus XtraDB-Tabellen ohne Strukturdatei mithilfe der Byteanalyse der ibd-Datei ⛎ 🏩 🍋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hintergrund 


 So kam es, dass der Server von einem Ransomware-Virus angegriffen wurde, der durch einen "Zufall" .ibd-Dateien (innodb-Rohdatendateien...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Datenwiederherstellung aus XtraDB-Tabellen ohne Strukturdatei mithilfe der Byteanalyse der ibd-Datei</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453368/"><p><img src="https://habrastorage.org/getpro/habr/post_images/03c/9b3/e38/03c9b3e38fcb18bd367a89bfe4703e44.png" alt="Bild"></p><br><h3 id="predystoriya">  Hintergrund </h3><br><p>  So kam es, dass der Server von einem Ransomware-Virus angegriffen wurde, der durch einen "Zufall" .ibd-Dateien (innodb-Rohdatendateien), intakte, aber vollständig verschlüsselte .fpm-Dateien (Strukturdateien) teilweise beiseite legte.  Gleichzeitig könnte .idb unterteilt werden in: </p><br><ul><li>  vorbehaltlich der Wiederherstellung durch Standardwerkzeuge und -anleitungen.  Für solche Fälle gibt es einen großartigen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> ; </li><li>  teilweise verschlüsselte Tabellen.  Meist handelt es sich um große Tabellen, auf denen (wie ich verstanden habe) die Angreifer nicht über genügend RAM für eine vollständige Verschlüsselung verfügten. </li><li>  Nun, vollständig verschlüsselte Tabellen, die nicht wiederhergestellt werden können. <a name="habracut"></a></li></ul><br><p>  Es war möglich zu bestimmen, zu welcher Option die Tabellen gehören, indem man in einem beliebigen Texteditor unter der gewünschten Codierung (in meinem Fall UTF8) öffnete und einfach in der Datei nach Textfeldern suchte, zum Beispiel: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/174/210/7be/1742107bed20737a14746a046ae1f560.png" alt="Bild"></p><br><p>  Außerdem können Sie am Anfang der Datei eine große Anzahl von 0-Bytes beobachten, und Viren, die den Blockverschlüsselungsalgorithmus (den häufigsten) verwenden, wirken sich normalerweise auf sie aus. <br><img src="https://habrastorage.org/getpro/habr/post_images/22b/5bc/3e3/22b5bc3e34d8165ce204c646389297ec.png" alt="Bild"></p><br><p>  In meinem Fall haben die Angreifer am Ende jeder verschlüsselten Datei eine Zeichenfolge von 4 Byte (1, 0, 0, 0) hinterlassen, was die Aufgabe vereinfacht hat.  Ein Skript reichte aus, um nach nicht infizierten Dateien zu suchen: </p><cut text=""></cut><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">opened</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path)</span></span></span><span class="hljs-function">:</span></span> files = os.listdir(path) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isfile(path + f): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> path + f <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> full_path <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> opened(<span class="hljs-string"><span class="hljs-string">"C:\\some\\path"</span></span>): file = open(full_path, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>) last_string = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> file: last_string = line file.close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (last_string[len(last_string) <span class="hljs-number"><span class="hljs-number">-4</span></span>:len(last_string)]) != (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>): print(full_path)</code> </pre> <cut></cut><br><p>  So stellte sich heraus, dass Dateien des ersten Typs gefunden wurden.  Das zweite impliziert ein langes Handbuch, aber bereits gefunden war genug.  Alles wäre in Ordnung, aber es ist notwendig, die <strong>absolut genaue Struktur</strong> zu kennen <strong>,</strong> und (natürlich) es gab einen solchen Fall, dass ich mit einem häufig wechselnden Tisch arbeiten musste.  Niemand erinnerte sich daran, ob sich der Feldtyp änderte oder eine neue Spalte hinzugefügt wurde. </p><br><p>  Leider konnte Debri City in diesem Fall nicht helfen, daher wird dieser Artikel geschrieben. </p><br><h3 id="blizhe-k-delu">  Komm auf den Punkt </h3><br><p>  Es gibt eine Tabellenstruktur von vor 3 Monaten, die nicht mit der aktuellen übereinstimmt (vielleicht ein Feld, aber möglicherweise mehr).  Tabellenstruktur: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`table_1`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`date`</span></span> DATETIME , <span class="hljs-string"><span class="hljs-string">`description`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> , <span class="hljs-string"><span class="hljs-string">`id_point`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`id_user`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`date_start`</span></span> DATETIME , <span class="hljs-string"><span class="hljs-string">`date_finish`</span></span> DATETIME , <span class="hljs-string"><span class="hljs-string">`photo`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">`id_client`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`status`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">`lead__time`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span> , <span class="hljs-string"><span class="hljs-string">`sendstatus`</span></span> TINYINT (<span class="hljs-number"><span class="hljs-number">4</span></span>) );</code> </pre> <br><p>  In diesem Fall müssen Sie extrahieren: </p><br><ul><li>  <code>id_point</code> INT (11); </li><li>  <code>id_user</code> INT (11); </li><li>  <code>date_start</code> DATETIME; </li><li>  <code>date_finish</code> DATETIME. </li></ul><br><p>  Zur Wiederherstellung wird eine Byteanalyse der .ibd-Datei verwendet, gefolgt von deren Übersetzung in eine besser lesbare Form.  Da es ausreicht, um die erforderlichen Datentypen wie int und datatime zu analysieren, werden nur diese im Artikel beschrieben. Manchmal beziehen sie sich jedoch auch auf andere Datentypen, die bei ähnlichen Vorfällen hilfreich sein können. </p><br><p>  <strong>Problem 1</strong> : Felder mit den Typen DATETIME und TEXT hatten einen NULL-Wert und werden einfach in der Datei übersprungen. Aus diesem Grund war es in meinem Fall nicht möglich, die Struktur für die Wiederherstellung zu bestimmen.  In den neuen Spalten war der Standardwert null, und einige der Transaktionen konnten aufgrund der Einstellung innodb_flush_log_at_trx_commit = 0 verloren gehen, sodass zusätzliche Zeit für die Bestimmung der Struktur aufgewendet werden musste. </p><br><p>  <strong>Problem 2</strong> : Es ist zu beachten, dass sich die durch DELETE gelöschten Zeilen alle genau in der ibd-Datei befinden, ihre Struktur jedoch nicht mit ALTER TABLE aktualisiert wird.  Infolgedessen kann die Datenstruktur vom Anfang bis zum Ende der Datei variieren.  Wenn Sie häufig OPTIMIZE TABLE verwenden, ist es unwahrscheinlich, dass Sie auf ein ähnliches Problem stoßen. </p><br><p>  <strong>Beachten Sie,</strong> dass die DBMS-Version die Art und Weise beeinflusst, in der Daten gespeichert werden. Dieses Beispiel funktioniert möglicherweise nicht für andere Hauptversionen.  In meinem Fall wurde die Windows-Version mariadb 10.1.24 verwendet.  Auch wenn Sie in Mariadb mit InnoDB-Tabellen arbeiten, handelt es sich tatsächlich um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">XtraDB</a> , was die Anwendbarkeit der Methode mit InnoDB- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MySQL</a> ausschließt. </p><br><h3 id="analiz-fayla">  Dateianalyse </h3><br><p>  In Python zeigt der Datentyp <a href="">bytes ()</a> Daten in Unicode anstelle der üblichen Zahlen an.  Sie können die Datei zwar in dieser Form betrachten, aber der Einfachheit halber können Sie Bytes in eine numerische Form übersetzen, indem Sie das Byte-Array in ein reguläres Array übersetzen (list (example_byte_array)).  In jedem Fall sind beide Methoden für die Analyse nützlich. </p><br><p>  Nachdem Sie sich mehrere ibd-Dateien angesehen haben, finden Sie Folgendes: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d5d/2d6/512/d5d2d6512bd39fcb0d8d9764e23a5d91.png" alt="Bild"></p><br><p>  Wenn Sie die Datei durch diese Schlüsselwörter teilen, erhalten Sie außerdem meist flache Datenblöcke.  Wir werden infimum als Teiler verwenden. </p><br><pre> <code class="python hljs">table = table.split(<span class="hljs-string"><span class="hljs-string">"infimum"</span></span>.encode())</code> </pre> <br><p>  Eine interessante Beobachtung für Tabellen mit einer kleinen Datenmenge zwischen Infimum und Supremum ist ein Zeiger auf die Anzahl der Zeilen im Block. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c74/8f3/ec1/c748f3ec108e8bec2dec0c71c2ef2911.png" alt="Bild">  - Prüftisch mit 1. Reihe </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d89/f17/970/d89f179703c5e18456efcaaed194d8ee.png" alt="Bild">  - Testtabelle mit 2 Zeilen </p><br><p>  Das Array der Zeilentabelle [0] kann übersprungen werden.  Nachdem ich es mir angesehen hatte, konnte ich die Rohdaten der Tabellen immer noch nicht finden.  Dieser Block wird höchstwahrscheinlich zum Speichern von Indizes und Schlüsseln verwendet. <br>  Wenn Sie mit Tabelle [1] beginnen und diese in ein numerisches Array übersetzen, können Sie bereits einige Muster feststellen, nämlich: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/cf0/48f/44d/cf048f44d77573d0261cf58d79c8ee8b.png" alt="Bild"></p><br><p>  Dies sind int-Werte, die in einer Zeichenfolge gespeichert sind.  Das erste Byte gibt an, ob die Zahl positiv oder negativ ist.  In meinem Fall sind alle Zahlen positiv.  Aus den verbleibenden 3 Bytes können Sie die Anzahl mit der folgenden Funktion ermitteln.  Skript: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_int</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(val: str)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># example '128, 1, 2, 3' val = [int(v) for v in val.split(", ")] result_int = val[1]*256**2 + val[2]*256*1 + val[3] return result_int</span></span></code> </pre> <br><p>  Zum Beispiel <em>128, 0, 0, 1 = 1</em> oder <em>128, 0, 75, 108 = 19308</em> . <br>  Die Tabelle hatte einen Primärschlüssel mit automatischer Inkrementierung, und hier finden Sie ihn auch </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b3f/43b/70b/b3f43b70b07f22365ecef4b92934335b.png" alt="Bild"></p><br><p>  Beim Vergleich der Daten aus den Testtabellen wurde festgestellt, dass das DATETIME-Objekt aus 5 Bytes besteht, beginnend mit 153 (höchstwahrscheinlich unter Angabe von Jahresintervallen).  Da der DATTIME-Bereich von '1000-01-01' bis '9999-12-31' reicht, kann die Anzahl der Bytes variieren. In meinem Fall fallen die Daten jedoch in den Zeitraum von 2016 bis 2019, sodass wir davon ausgehen, dass 5 Bytes ausreichen . </p><br><p>  Um die Zeit ohne Sekunden zu bestimmen, wurden die folgenden Funktionen geschrieben.  Skript: </p><br><pre> <code class="python hljs">day_ = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x % <span class="hljs-number"><span class="hljs-number">64</span></span> // <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment"># {x,x,X,x,x } def hour_(x1, x2): # {x,x,X1,X2,x} if x1 % 2 == 0: return x2 // 16 elif x1 % 2 == 1: return x2 // 16 + 16 else: raise ValueError min_ = lambda x1, x2: (x1 % 16) * 4 + (x2 // 64) # {x,x,x,X1,X2}</span></span></code> </pre> <cut></cut><br><p>  Ein Jahr und einen Monat lang war es nicht möglich, eine gesunde Arbeitsfunktion zu schreiben, daher musste ich hart codieren.  Skript: </p><br><pre> <code class="python hljs">ym_list = {<span class="hljs-string"><span class="hljs-string">'2016, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 152, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 152, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 152, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 155, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 155, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 155, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 158, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 158, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 158, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 161, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 161, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 161, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 165, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 165, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 165, 192'</span></span>,<span class="hljs-string"><span class="hljs-string">'2020, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 166, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 166, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 1, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 166, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 64'</span></span>,<span class="hljs-string"><span class="hljs-string">'2020, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 168, 0'</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">year_month</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x1, x2)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># {x,X,X,x,x } for key, value in ym_list.items(): key = [int(k) for k in key.replace("'", "").split(", ")] value = [int(v) for v in value.split(", ")] if x1 == value[1] and x2 // 64 == value[2] // 64: return key return 0, 0</span></span></code> </pre> <br><p>  Ich bin sicher, dass dieses Missverständnis korrigiert werden kann, wenn Sie n die Zeit verbringen. <br>  Als Nächstes gibt die Funktion ein Datum / Uhrzeit-Objekt aus einer Zeichenfolge zurück.  Skript: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_data_time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(val:str)</span></span></span><span class="hljs-function">:</span></span> val = [int(v) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> val.split(<span class="hljs-string"><span class="hljs-string">", "</span></span>)] day = day_(val[<span class="hljs-number"><span class="hljs-number">2</span></span>]) hour = hour_(val[<span class="hljs-number"><span class="hljs-number">2</span></span>], val[<span class="hljs-number"><span class="hljs-number">3</span></span>]) minutes = min_(val[<span class="hljs-number"><span class="hljs-number">3</span></span>], val[<span class="hljs-number"><span class="hljs-number">4</span></span>]) year, month = year_month(val[<span class="hljs-number"><span class="hljs-number">1</span></span>], val[<span class="hljs-number"><span class="hljs-number">2</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> datetime(year, month, day, hour, minutes)</code> </pre> <cut></cut><br><p>  Es war möglich, häufig wiederholte Werte aus int, int, datetime, datetime zu erkennen <img src="https://habrastorage.org/getpro/habr/post_images/a2a/054/0dd/a2a0540dd230dc92ac1d8e6a5cfcdf51.png" alt="Bild">  Es scheint, dass dies das ist, was Sie brauchen.  Darüber hinaus wird eine solche Sequenz nicht zweimal pro Zeile wiederholt. </p><br><p>  Mit einem regulären Ausdruck finden wir die notwendigen Daten: </p><br><pre> <code class="python hljs">fined = re.findall(<span class="hljs-string"><span class="hljs-string">r'128, \d*, \d*, \d*, 128, \d*, \d*, \d*, 153, 1[6,5,4,3]\d, \d*, \d*, \d*, 153, 1[6,5,4,3]\d, \d*, \d*, \d*'</span></span>, int_array)</code> </pre> <br><p>  Bitte beachten Sie, dass bei der Suche nach diesem Ausdruck keine NULL-Werte in den erforderlichen Feldern ermittelt werden können. In meinem Fall ist dies jedoch nicht kritisch.  Nachdem wir das gefundene durchlaufen haben.  Skript: </p><br><pre> <code class="python hljs">result = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> val <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fined: pre_result = [] bd_int = re.findall(<span class="hljs-string"><span class="hljs-string">r"128, \d*, \d*, \d*"</span></span>, val) bd_date= re.findall(<span class="hljs-string"><span class="hljs-string">r"(153, 1[6,5,4,3]\d, \d*, \d*, \d*)"</span></span>, val) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> it <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bd_int: pre_result.append(find_int(bd_int[it])) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bd <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bd_date: pre_result.append(find_data_time(bd)) result.append(pre_result)</code> </pre> <br><p>  Eigentlich alles, Daten aus dem Ergebnisarray, das sind die Daten, die wir brauchen.  ### PS. ### <br>  Ich verstehe, dass diese Methode nicht für jeden geeignet ist, aber das Hauptziel des Artikels ist es, Maßnahmen zu veranlassen, anstatt alle Ihre Probleme zu lösen.  Ich denke, die richtigste Lösung wäre, den Quellcode von <a href="">Mariadb</a> selbst zu <a href="">studieren</a> , aber aufgrund der begrenzten Zeit schien die aktuelle Methode die schnellste zu sein. </p><br><p>  In einigen Fällen können Sie nach der Analyse der Datei die ungefähre Struktur ermitteln und eine der Standardmethoden über die obigen Links wiederherstellen.  Es wird viel korrekter sein und weniger Probleme verursachen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de453368/">https://habr.com/ru/post/de453368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de453356/index.html">Aktuelle Trends und Empfehlungen zur Agglomeration großer Finanzinstitute</a></li>
<li><a href="../de453360/index.html">Stadt ohne Stau</a></li>
<li><a href="../de453362/index.html">HabraConf # 1 - Rückwärts für Backend</a></li>
<li><a href="../de453364/index.html">Eine Rollout-Geschichte, die alles betraf</a></li>
<li><a href="../de453366/index.html">Verwendung von Kommas in Englisch: 15 Regeln und Fehlerbeispiele</a></li>
<li><a href="../de453370/index.html">Konfrontation 2019: Das Jet Security Team belegte den ersten Platz in der Verteidigung</a></li>
<li><a href="../de453374/index.html">Top 10 Chat-, Audio- und Videoanruf-API- und SDK-Anbieter für Unternehmen</a></li>
<li><a href="../de453376/index.html">Wie können Sie Ihre Zeit und Ihre SSD-Ressourcen vergeblich verschwenden? Leicht und einfach</a></li>
<li><a href="../de453380/index.html">Weltkrieg mit Privatwagen: MaaS geht um den Planeten</a></li>
<li><a href="../de453382/index.html">So erstellen Sie hochgradig anpassbares Caching in einem Projekt und ersparen Kollegen das Schreiben des gleichen Codetyps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>