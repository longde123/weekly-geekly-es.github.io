<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÜ üëÇüèæ üßóüèº Reagieren Sie auf Native- und C ++ - Integration f√ºr iOS und Android üî° üîõ üêæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="K√ºrzlich wurde mir angeboten, an einem interessanten Projekt zu arbeiten. Es war erforderlich, eine mobile Anwendung f√ºr den amerikanischen Start unte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reagieren Sie auf Native- und C ++ - Integration f√ºr iOS und Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439676/">  K√ºrzlich wurde mir angeboten, an einem interessanten Projekt zu arbeiten.  Es war erforderlich, eine mobile Anwendung f√ºr den amerikanischen Start unter iOS und Android mit React Native zu entwickeln.  Das wichtigste technische Merkmal und der Faktor, der meine Teilnahme an dem Projekt eindeutig entschieden hat, war die Integration einer in C ++ geschriebenen Bibliothek.  F√ºr mich k√∂nnte dies eine neue Erfahrung und ein neuer professioneller Test sein. <br><br><h4>  Warum musste die C ++ - Bibliothek integriert werden? </h4><br>  Diese Anwendung war f√ºr die Zwei-Faktor-Authentifizierung mit den Protokollen FIDO UAF und U2F unter Verwendung biometrischer Daten wie Face ID und Touch ID sowie √§hnlicher Technologien f√ºr die Android-Plattform erforderlich.  Der Client f√ºr die Authentifizierung war bereits bereit.  Es war eine in C ++ geschriebene Bibliothek, die von einigen anderen Clients zus√§tzlich zur mobilen Anwendung verwendet wurde.  Daher musste ich es auf √§hnliche Weise in eine mobile Anwendung auf React Native integrieren. <br><a name="habracut"></a><br><h4>  Wie ich es gemacht habe </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Es gibt einen Ansatz</a> zur Integration von C ++ in die React Native-App von Facebook.  Das Problem ist jedoch, dass es nur f√ºr die iOS-Plattform funktioniert und nicht klar ist, was in diesem Fall mit Android zu tun ist.  Ich wollte das Problem f√ºr zwei Plattformen gleichzeitig l√∂sen. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ein Zweig des Dropbox Djinni-Tools</a> , mit dem Sie plattform√ºbergreifende Typdeklarationen generieren k√∂nnen.  Im Wesentlichen handelt es sich um eine einfache mobile React Native-App mit einer benutzerdefinierten Verbindung zu Djinni.  Ich habe es als Grundlage genommen. <br><br>  Der Einfachheit halber ist der Anwendungscode in zwei Git-Repositorys unterteilt.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der erste</a> speichert den Quellcode der React Native-Anwendung und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der zweite</a> enth√§lt Djinni und die erforderlichen Abh√§ngigkeiten. <br><br><h4>  Weitere Schritte </h4><br>  Zuerst m√ºssen Sie eine Schnittstelle f√ºr die Interaktion von C ++ und React Native-Code deklarieren.  In Dschinn wird dies mithilfe von IDL-Dateien durchgef√ºhrt.  √ñffnen Sie die Datei <i>react-native-cpp-support / idl / main.Djinni</i> im Projekt und machen Sie sich mit deren Struktur vertraut. <br><br>  F√ºr unsere Bequemlichkeit wurden bereits einige JavaScript-Datentypen und Bindungen f√ºr diese im Projekt deklariert.  Daher k√∂nnen wir ohne zus√§tzliche Beschreibung mit den Typen String, Array, Map, Promise und anderen arbeiten. <br><br>  Im Beispiel sieht diese Datei folgenderma√üen aus: <br><br><pre><code class="javascript hljs">DemoModule = interface +r { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> EVENT_NAME: string = <span class="hljs-string"><span class="hljs-string">"DEMO_MODULE_EVENT"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STRING_CONSTANT: string = <span class="hljs-string"><span class="hljs-string">"STRING"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INT_CONSTANT: i32 = <span class="hljs-number"><span class="hljs-number">13</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DOUBLE_CONSTANT: f64 = <span class="hljs-number"><span class="hljs-number">13.123</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BOOL_CONSTANT: bool = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; testPromise(promise: JavascriptPromise); testCallback(callback: JavascriptCallback); testMap(map: JavascriptMap, <span class="hljs-attr"><span class="hljs-attr">promise</span></span>: JavascriptPromise); testArray(array: JavascriptArray, <span class="hljs-attr"><span class="hljs-attr">callback</span></span>: JavascriptCallback); testBool(value: bool, <span class="hljs-attr"><span class="hljs-attr">promise</span></span>: JavascriptPromise); testPrimitives(i: i32, <span class="hljs-attr"><span class="hljs-attr">d</span></span>: f64, <span class="hljs-attr"><span class="hljs-attr">callback</span></span>: JavascriptCallback); testString(value: string, <span class="hljs-attr"><span class="hljs-attr">promise</span></span>: JavascriptPromise); testEventWithArray(value: JavascriptArray); testEventWithMap(value: JavascriptMap); }</code> </pre> <br>  Nachdem Sie √Ñnderungen an der Schnittstellendatei vorgenommen haben, m√ºssen Sie die Java / Objective-C / C ++ - Schnittstellen neu generieren.  Dies ist einfach, indem Sie das Skript <i>generate_wrappers.sh</i> aus dem Ordner <i>react-native-cpp-support / idl / ausf√ºhren</i> .  Dieses Skript sammelt alle Anzeigen aus unserer IDL-Datei und erstellt die entsprechenden Schnittstellen f√ºr sie. Es ist sehr praktisch. <br><br>  Im Beispiel gibt es zwei C ++ - Dateien, die uns interessieren.  Die erste enth√§lt eine Beschreibung und die zweite Implementierung einfacher C ++ - Methoden: <br><br>  <i>react-native-cpp / cpp / DemoModuleImpl.hpp</i> <i><br></i>  <i>react-native-cpp / cpp / DemoModuleImpl.cpp</i> <br><br>  Betrachten Sie den Code einer der Methoden als Beispiel: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DemoModuleImpl::testString(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> std::string &amp;value, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> std::shared_ptr&lt;::JavascriptPromise&gt; &amp;promise) { promise-&gt;resolveObject(JavascriptObject::fromString(<span class="hljs-string"><span class="hljs-string">"Success!"</span></span>)); }</code> </pre><br>  Beachten Sie, dass das Ergebnis nicht mit dem <i>Schl√ºsselwort return zur√ºckgegeben wird</i> , sondern mit dem <i>JavaScriptPromise-</i> Objekt, das vom letzten Parameter √ºbergeben wurde, wie in der <i>IDL-</i> Datei beschrieben. <br><br>  Nun wurde klar, wie man den notwendigen Code in C ++ beschreibt.  Aber wie kann man in einer React Native-App damit interagieren?  Zum Verst√§ndnis √∂ffnen Sie einfach die Datei aus dem <i>Ordner "react-native-cpp / index.js"</i> , in dem alle im Beispiel beschriebenen Funktionen aufgerufen werden. <br><br>  Die Funktion aus unserem Beispiel wird in JavaScript wie folgt aufgerufen: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { NativeAppEventEmitter, NativeModules... } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-native'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DemoModule = NativeModules.DemoModule; .... async promiseTest() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendLine(<span class="hljs-string"><span class="hljs-string">"testPromise: "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> DemoModule.testPromise()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendLine(<span class="hljs-string"><span class="hljs-string">"testMap: "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> DemoModule.testMap({<span class="hljs-attr"><span class="hljs-attr">a</span></span>: DemoModule.INT_CONSTANT, <span class="hljs-attr"><span class="hljs-attr">b</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}))); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendLine(<span class="hljs-string"><span class="hljs-string">"testBool: "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> DemoModule.testBool(DemoModule.BOOL_CONSTANT)); <span class="hljs-comment"><span class="hljs-comment">// our sample function this.appendLine("testString: " + await DemoModule.testString(DemoModule.STRING_CONSTANT)); }</span></span></code> </pre><br>  Jetzt ist klar, wie die Testfunktionen auf der Seite von C ++ und JavaScript funktionieren.  Ebenso k√∂nnen Sie den Code anderer Funktionen hinzuf√ºgen.  Weiter werde ich √ºberlegen, wie Android- und iOS-Projekte mit C ++ zusammenarbeiten. <br><br><h4>  Reagiere auf Native und C ++ f√ºr Android </h4><br>  F√ºr die Interaktion von Android und C ++ m√ºssen Sie das NDK installieren.  Detaillierte Anweisungen dazu finden Sie unter <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">developer.android.com/ndk/guides</a></i> <br>  Anschlie√üend m√ºssen Sie in der <i>Datei react-native-cpp / android / app / build.gradle</i> die folgenden Einstellungen hinzuf√ºgen: <br><br><pre> <code class="javascript hljs">android { ... defaultConfig { ... ndk { abiFilters <span class="hljs-string"><span class="hljs-string">"armeabi-v7a"</span></span>, <span class="hljs-string"><span class="hljs-string">"x86"</span></span> } externalNativeBuild { cmake { cppFlags <span class="hljs-string"><span class="hljs-string">"-std=c++14 -frtti -fexceptions"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span> <span class="hljs-string"><span class="hljs-string">"-DANDROID_TOOLCHAIN=clang"</span></span>, <span class="hljs-string"><span class="hljs-string">"-DANDROID_STL=c++_static"</span></span> } } } externalNativeBuild { cmake { path <span class="hljs-string"><span class="hljs-string">"CMakeLists.txt"</span></span> } } sourceSets { main { java.srcDirs <span class="hljs-string"><span class="hljs-string">'src/main/java'</span></span>, <span class="hljs-string"><span class="hljs-string">'../../../react-native-cpp-support/support-lib/java'</span></span> } } splits { abi { reset() enable enableSeparateBuildPerCPUArchitecture universalApk <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-comment"><span class="hljs-comment">// If true, also generate a universal APK include "armeabi-v7a", "x86" } } ... }</span></span></code> </pre><br>  Wir haben gradle so konfiguriert, dass die Anwendung f√ºr die verwendeten Architekturen erstellt wird, und die erforderlichen Build-Flags f√ºr cmake hinzugef√ºgt, die <i>CMAkeLists-</i> Datei angegeben, die wir in Zukunft beschreiben werden, und auch die Java-Klassen von Djinni hinzugef√ºgt, die wir verwenden werden. <br>  Der n√§chste Schritt beim Einrichten eines Android-Projekts ist die Beschreibung der Datei <i>CMakeLists.txt</i> .  In fertiger Form kann es entlang des Pfades <i>react-native-cpp / android / app / CMakeLists.txt angezeigt werden</i> . <br><br><pre> <code class="javascript hljs">cmake_minimum_required(VERSION <span class="hljs-number"><span class="hljs-number">3.4</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>) set( PROJECT_ROOT <span class="hljs-string"><span class="hljs-string">"${CMAKE_SOURCE_DIR}/../.."</span></span> ) set( SUPPORT_LIB_ROOT <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/../react-native-cpp-support/support-lib"</span></span> ) file( GLOB JNI_CODE <span class="hljs-string"><span class="hljs-string">"src/main/cpp/*.cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"src/main/cpp/gen/*.cpp"</span></span> ) file( GLOB PROJECT_CODE <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/*.cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/gen/*.cpp"</span></span> ) file( GLOB PROJECT_HEADERS <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/*.hpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/gen/*.hpp"</span></span> ) file( GLOB DJINNI_CODE <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/cpp/*.cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/jni/*.cpp"</span></span> ) file( GLOB DJINNI_HEADERS <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/cpp/*.hpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/jni/*.hpp"</span></span> ) include_directories( <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/jni"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/gen"</span></span> ) add_library( # Sets the name <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the library. native-lib # Sets the library <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> a shared library. SHARED ${JNI_CODE} ${DJINNI_CODE} ${DJINNI_HEADERS} ${PROJECT_CODE} ${PROJECT_HEADERS} )</code> </pre><br>  Hier haben wir die relativen Pfade zur Unterst√ºtzungsbibliothek angegeben und Verzeichnisse mit dem erforderlichen C ++ - und JNI-Code hinzugef√ºgt. <br><br>  Ein weiterer wichtiger Schritt ist das Hinzuf√ºgen von <i>DjinniModulesPackage</i> zu unserem Projekt.  Dazu geben wir in der Datei <i>react-native-cpp / android / app / src / main / java / com / rncpp / jni / DjinniModulesPackage.java Folgendes</i> an: <br><br><pre> <code class="javascript hljs">... import com.rncpp.jni.DjinniModulesPackage; ... public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReactApplication</span></span></span><span class="hljs-class"> </span></span>{ ... @Override protected List&lt;ReactPackage&gt; getPackages() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Arrays.&lt;ReactPackage&gt;asList( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MainReactPackage(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DjinniModulesPackage() ); } ... }</code> </pre><br>  Das letzte wichtige Detail ist die Beschreibung der <i>DjinniModulesPackage-</i> Klasse, die wir gerade in der Hauptklasse unserer Anwendung verwendet haben.  Es befindet sich im <i>Pfad react-native-cpp / android / app / src / main / java / com / rncpp / jni / DjinniModulesPackage.java</i> und enth√§lt den folgenden Code: <br><br><pre> <code class="javascript hljs">package com.rncpp.jni; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.facebook.react.ReactPackage; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.facebook.react.bridge.NativeModule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.facebook.react.bridge.ReactApplicationContext; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.facebook.react.uimanager.ViewManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Collections; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DjinniModulesPackage</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReactPackage</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { System.loadLibrary(<span class="hljs-string"><span class="hljs-string">"native-lib"</span></span>); } @Override public List&lt;ViewManager&gt; createViewManagers(ReactApplicationContext reactContext) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Collections.emptyList(); } @Override public List&lt;NativeModule&gt; createNativeModules(ReactApplicationContext reactContext) { List&lt;NativeModule&gt; modules = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); modules.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DemoModule(reactContext)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> modules; } }</code> </pre><br>  Von gr√∂√ütem Interesse f√ºr die obige Klasse ist die Zeile <i>System.loadLibrary ("native-lib");</i>  Dank dessen laden wir die Bibliothek mit unserem nativen Code und Djinni-Code in die Android-Anwendung. <br><br>  Um zu verstehen, wie dies funktioniert, empfehle ich Ihnen, sich mit dem jni-Code aus dem <a href="">Ordner</a> vertraut zu machen, der ein jni-Wrapper f√ºr die Arbeit mit der Funktionalit√§t unseres Moduls ist. Die Benutzeroberfl√§che ist in der IDL-Datei beschrieben. <br><br>  Wenn die Android-Entwicklungsumgebung und React Native konfiguriert sind, k√∂nnen Sie das React Native-Projekt unter Android erstellen und ausf√ºhren.  F√ºhren Sie dazu zwei Befehle im Terminal aus: <br><br>  <i>npm installieren</i> <i><br></i>  <i>npm laufen android</i> <br><br>  Hurra!  Unser Projekt funktioniert! <br><br>  Und wir sehen das folgende Bild auf dem Bildschirm des Android-Emulators (anklickbar): <br><br> <a href=""><img width="100" src="https://habrastorage.org/webt/d2/_b/ku/d2_bkuu0d7wftpkmekwbpgxyod8.png"></a> <br><br>  Nun wollen wir sehen, wie iOS und React Native mit C ++ funktionieren. <br><br><h4>  Reagiere auf Native und C ++ f√ºr iOS </h4><br>  √ñffnen Sie das React-Native-CPP-Projekt in Xcode. <br><br>  F√ºgen Sie zun√§chst aus der Support-Bibliothek Links zu dem im Objective-C- und C ++ - Projekt verwendeten Code hinzu.  √úbertragen Sie dazu den Inhalt der Ordner " <i>react-native-cpp-support / support-lib / objc /"</i> und " <i>react-native-cpp-support / support-lib / cpp /"</i> in das <i>Xcode-</i> Projekt.  Infolgedessen werden Ordner mit der Codeunterst√ºtzungsbibliothek im Projektstrukturbaum angezeigt (die Bilder k√∂nnen angeklickt werden): <br><br> <a href=""><img width="200" src="https://habrastorage.org/webt/wc/yv/lw/wcyvlw_dev544my3-t0jebtkxkg.png"></a> <br><br> <a href=""><img width="200" src="https://habrastorage.org/webt/ym/da/_l/ymda_l6b2aypzuh6diwqgzkk624.png"></a> <br><br>  Daher haben wir dem Projekt Beschreibungen von JavaScript-Typen aus der Support-Bibliothek hinzugef√ºgt. <br><br>  Der n√§chste Schritt besteht darin, die generierten Objective-C-Wrapper f√ºr unser Test-C ++ - Modul hinzuzuf√ºgen.  Wir m√ºssen den Code aus dem Ordner <i>react-native-cpp / ios / rncpp / Generated /</i> in das Projekt √ºbertragen. <br><br>  Es bleibt noch der C ++ - Code unseres Moduls hinzuzuf√ºgen, f√ºr den wir den Code aus den Ordnern <i>react-native-cpp / cpp /</i> und <i>react-native-cpp / cpp / gen /</i> in das Projekt √ºbertragen. <br><br>  Infolgedessen sieht der Projektstrukturbaum wie folgt aus (das Bild kann angeklickt werden): <br><br> <a href=""><img width="200" src="https://habrastorage.org/webt/d9/ki/3i/d9ki3i1ni92_hjp2ez4bytyv5eq.png"></a> <br><br>  Sie m√ºssen sicherstellen, dass die hinzugef√ºgten Dateien in der Liste "Quellen kompilieren" auf der Registerkarte "Phasen erstellen" angezeigt werden. <br><br> <a href=""><img src="https://habrastorage.org/webt/29/hy/db/29hydbdi23jo_zntc8coqjpx5n0.png"><br></a> <br>  (das Bild ist anklickbar) <br><br>  Der letzte Schritt besteht darin, den Code der Datei AppDelegate.m zu √§ndern, um die Initialisierung des Djinni-Moduls beim Start der Anwendung zu starten.  Und daf√ºr m√ºssen Sie folgende Codezeilen √§ndern: <br><br><pre> <code class="javascript hljs">... #<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"RCDjinniModulesInitializer.h"</span></span> ... @implementation AppDelegate - (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions { ... id&lt;RCTBridgeDelegate&gt; moduleInitialiser = [[RCDjinniModulesInitializer alloc] initWithURL:jsCodeLocation]; RCTBridge *bridge = [[RCTBridge alloc] initWithDelegate:moduleInitialiser launchOptions:nil]; RCTRootView *rootView = [[RCTRootView alloc] initWithBridge:bridge moduleName:@<span class="hljs-string"><span class="hljs-string">"rncpp"</span></span> initialProperties: nil]; ... }</code> </pre><br>  Starten Sie jetzt unsere App auf iOS.  (das Bild ist anklickbar) <br><br> <a href=""><img width="100" src="https://habrastorage.org/webt/pz/lm/fc/pzlmfc65__a1eomgafobtt1z87y.png"><br></a> <br><br>  Die Anwendung funktioniert! <br><br><h4>  Hinzuf√ºgen einer C ++ - Bibliothek zu unserem Projekt. </h4><br>  Zum Beispiel verwenden wir die beliebte OpenSSL-Bibliothek. <br><br>  Und fangen wir mit Android an. <br><br>  Wir klonen das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> mit der bereits erstellten OpenSSL-Bibliothek f√ºr Android. <br><br>  F√ºgen Sie die OpenSSL-Bibliothek in die Datei CMakeLists.txt ein: <br><br><pre> <code class="javascript hljs">.... SET(OPENSSL_ROOT_DIR /Users/andreysaleba/projects/OpenSSL-<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>-Android-Prebuilt/openssl<span class="hljs-number"><span class="hljs-number">-1.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>) SET(OPENSSL_LIBRARIES_DIR <span class="hljs-string"><span class="hljs-string">"${OPENSSL_ROOT_DIR}/${ANDROID_ABI}/lib"</span></span>) SET(OPENSSL_INCLUDE_DIR ${OPENSSL_ROOT_DIR}/include) SET(OPENSSL_LIBRARIES <span class="hljs-string"><span class="hljs-string">"ssl"</span></span> <span class="hljs-string"><span class="hljs-string">"crypto"</span></span>) ... LINK_DIRECTORIES(${OPENSSL_LIBRARIES_DIR} ${ZLIB_LIBRARIES_DIR}) include_directories( <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/jni"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/gen"</span></span> <span class="hljs-string"><span class="hljs-string">"${OPENSSL_INCLUDE_DIR}"</span></span> ) add_library(libssl STATIC IMPORTED) add_library(libcrypto STATIC IMPORTED) ... set_target_properties( libssl PROPERTIES IMPORTED_LOCATION ${OPENSSL_LIBRARIES_DIR}/libssl.a ) set_target_properties( libcrypto PROPERTIES IMPORTED_LOCATION ${OPENSSL_LIBRARIES_DIR}/libcrypto.a ) target_link_libraries(native-lib PRIVATE libssl libcrypto)</code> </pre><br>  Anschlie√üend f√ºgen wir unserem C ++ - Modul einen einfachen Funktionscode hinzu, der die Version der OpenSSL-Bibliothek zur√ºckgibt. <br><br>  <i>F√ºgen</i> Sie in der Datei <i>react-native-cpp / cpp / DemoModuleImpl.hpp Folgendes</i> hinzu: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> getOpenSSLVersion(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> std::shared_ptr&lt;::JavascriptPromise&gt; &amp; promise) override;</code> </pre><br>  <i>F√ºgen</i> Sie in der Datei <i>react-native-cpp / cpp / DemoModuleImpl.cpp Folgendes</i> hinzu: <br><br><pre> <code class="javascript hljs">#include &lt;openssl/crypto.h&gt; ... void DemoModuleImpl::getOpenSSLVersion(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> std::shared_ptr&lt;::JavascriptPromise&gt; &amp;promise) { promise-&gt;resolveString(SSLeay_version(<span class="hljs-number"><span class="hljs-number">1</span></span>)); }</code> </pre><br>  Es bleibt die Schnittstelle der neuen Funktion in der IDL-Datei <i>"react-native-cpp-support / idl / main.djinni" zu beschreiben</i> : <br><br><pre> <code class="javascript hljs"> getOpenSSLVersion(promise: JavascriptPromise);</code> </pre><br>  Wir <i>rufen das</i> Skript <i>"generate_wrappers.sh"</i> aus dem <i>Ordner "react-native-cpp-support / idl /" auf</i> . <br><br>  Dann rufen wir in JavaScript die neu erstellte Funktion auf: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> promiseTest() { ... this.appendLine(<span class="hljs-string"><span class="hljs-string">"openSSL version: "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> DemoModule.getOpenSSLVersion()); }</code> </pre><br>  Alles ist bereit f√ºr Android. <br>  Fahren wir mit iOS fort. <br><br>  Wir klonen das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> mit der zusammengestellten Version der OpenSSL-Bibliothek f√ºr iOS. <br><br>  √ñffnen Sie das iOS-Projekt in Xcode und f√ºgen Sie in den Einstellungen auf der Registerkarte Build Settings den Pfad zur openssl-Bibliothek im Feld Other C Flags hinzu (ein Beispiel f√ºr den Pfad auf meinem Computer finden Sie unten): <br>  <i>-I / Users / andreysaleba / projects / prebuilt-openssl / dist / openssl-1.0.2d-ios / include</i> <br><br>  F√ºgen Sie im Feld Andere Linker-Flags die folgenden Zeilen hinzu: <br><br><pre> <code class="javascript hljs">-L/Users/andreysaleba/projects/prebuilt-openssl/dist/openssl<span class="hljs-number"><span class="hljs-number">-1.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>d-ios/lib -lcrypto -lssl</code> </pre><br>  Alles ist fertig.  OpenSSL-Bibliothek f√ºr beide Plattformen hinzugef√ºgt. <br><br>  Dank f√ºr das Ansehen! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439676/">https://habr.com/ru/post/de439676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439664/index.html">Bin√§re C ++ - Kompatibilit√§t und schmerzfreie Upgrades auf Visual Studio 2019</a></li>
<li><a href="../de439668/index.html">Skalieren eines Tech-Newsletters f√ºr 700.000 Abonnenten in 300 St√§dten: Die Geschichte von Techstars Startup Digest</a></li>
<li><a href="../de439670/index.html">Russisches KI-System zur Krebsdiagnose Botkin.AI. Jetzt auf dem Azure-Marktplatz</a></li>
<li><a href="../de439672/index.html">PowerShell-Grundlagen: Erkennen, ob eine Zeichenfolge mit einem bestimmten Zeichen endet</a></li>
<li><a href="../de439674/index.html">Reinforcement Deep Learning: Ping-Pong mit rohen Pixeln</a></li>
<li><a href="../de439678/index.html">Senden Sie an die Applied F # Challenge</a></li>
<li><a href="../de439680/index.html">Etwa 50% der Russen sind bereit, ihre pers√∂nlichen Daten zu verkaufen</a></li>
<li><a href="../de439682/index.html">Schulung Cisco 200-125 CCNA v3.0. Cisco Certified Network Specialist (CCNA). Tag 4. Gateway-Ger√§te</a></li>
<li><a href="../de439684/index.html">Bewerben Sie sich f√ºr die Applied F # Challenge</a></li>
<li><a href="../de439688/index.html">√úberblick √ºber AI & ML-L√∂sungen im Jahr 2018 und Prognosen f√ºr 2019: Teil 1 - NLP, Computer Vision</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>