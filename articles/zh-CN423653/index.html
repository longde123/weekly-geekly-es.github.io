<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🚀 😕 🚉 PsRealVehicle或装甲战中的开源坦克物理插件：突击 🙅🏽 ⛓️ 🙎🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="几年前，我们团队很荣幸创建了一个移动“阿拉木图”。 遵循“我们创造游戏而不是技术”的规则，我们根据引擎中已有的内容创建了原型。 它是基于物理模型PhysX Vehicles的UE 4.9，并且有很多痛苦（有和没有）。 


 此外，我们的团队创建了开源插件PsRealVehicle ，可在MIT许可...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PsRealVehicle或装甲战中的开源坦克物理插件：突击</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/423653/"><p><img src="https://habrastorage.org/webt/tp/k-/pp/tpk-ppd8uortedgcqdi0rzcqs-a.jpeg"></p><br><p> 几年前，我们团队很荣幸创建了一个移动“阿拉木图”。 遵循<strong>“我们创造游戏而不是技术”</strong>的规则，我们根据引擎中已有的内容创建了原型。 它是基于物理模型PhysX Vehicles的UE 4.9，并且有很多痛苦（有和没有）。 </p><br><p> 此外，我们的团队创建了开源插件<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PsRealVehicle</a> ，可在<strong>MIT许可</strong>下<strong>使用</strong> 。 该插件针对高负荷网络射击者的坦克和轮式车辆的物理特性进行了调整，您可以在我们的项目<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Armored Warfare：Assault中</a>随时观察其工作。 </p><a name="habracut"></a><br><h1 id="imena-yavki-paroli"> 名称，外观，密码。 </h1><br><p> 显然。 知道了 并且仅在业务上。 </p><br><p><img src="https://habrastorage.org/webt/ju/ry/-b/jury-bxmblc8rywoe28q2istiry.png"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">插件库</a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">主要配置文件</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><br></a> <br> 用于项目： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">装甲战：突击</a> </p><br><h2 id="nemnogo-istorii-ili-nazad-k-istokam"> 一段历史，或者回到根源 </h2><br><p> 我们开始<strong>在Unreal Engine 4.9</strong>上进行该项目。 当时，“开箱即用”的机器物理仅支持四轮车，而对于六轮“基准”（LAV-400，我们的第一款“战斗”原型车），我们不得不立即使用定制的发动机总成。 借助坦克的内置物理特性，情况变得更糟：必须逐点收集有关一切工作和配置方式的数据，以摆脱代码的束缚。 </p><br><p> 遵循<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“原型”</a>规则，我们为自己形成了以下要求： </p><br><ul><li> 物理学应该模拟坦克（最小程序）和轮式车辆的运动（非常需要-这是AW游戏系列的功能）。 </li><li>专用服务器必须<strong>每个联机会话最多</strong>承受<strong>20台计算机</strong> ，并且客户端必须处理它们。 </li><li> 所有车轮和履带均应遵循表面不平整规定， <strong>悬架应正常工作</strong> ，且油箱<strong>应</strong>摆动。 </li><li> 物理设置<strong>应由实际值</strong> （机器的质量，发动机功率）确定，并导致真实的行为（克服某些类型的地形的能力）。 </li><li> 我们编写的技术代码越少越好： <strong>Epic Games应该制造引擎，而不是我们</strong> 。 </li></ul><br><p><img src="https://habrastorage.org/webt/tu/gq/m2/tugqm20mytmfcwjgeh-rwe6vukg.png"></p><br><p> 因此，要求大致明确，可以开始工作。 很快，我们组装了第一个原型，坦克去了，汽车开了，但是我们遇到了两个麻烦： </p><br><ol><li> 所有这些都极大地困扰着处理器。 </li><li> 创建的世界图景不适合重型设备的实际行为框架。 在任何设置下，重达30吨的战车<strong>都无法上升15度</strong> （这是最简单的选择之一）。 我们花了很多时间修改景观的模拟和摩擦设置，但这导致功率提升到宇宙值（比实际值大20倍以上，结果，汽车的性能不稳定且不确定），或者导致大量设备（PhysX）可以在一辆半吨左右的车辆中正常工作。 </li></ol><br><p><img src="https://habrastorage.org/webt/lp/5u/_g/lp5u_gfun8xtmhelxt5wvvwlsjg.png"></p><br><p> 因此，游戏设计师们并没有热情。 程序员哭了，被刺了，但继续吃仙人掌（聚会需要有效的解决方案！）。 原型获得了领导层的批准并被发送来创建一个Alpha版本（顺便说一下，该原型的视频<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在Youtube上</a> 。但是时间流逝，人们对这种物理学的美好未来的希望越来越少。设置还不够，它们的行为看起来像是黑魔法。 “游戏，而不是技术”以自己的方式束手无策，至少在怀疑我们是否可以拉动它方面。 </p><br><p> 几天后，我在Wikipedia上静静地武装着残留的学校知识和在刺客信条上“浮桥”上从事物理学工作的经验，我创建了一个新的坦克物理原型，该原型构成了PsRealVehicle插件的基础。 在一周之内，概念验证就付诸实践，CTO团队受到了负载测试的演示并受到了保护。  <strong>数字说：做你的物理学。</strong> </p><br><h2 id="--i-v-prodakshn">  ...-...，以及在生产中 </h2><br><p> 从原型到销售的路径已经更长了。 如果一周的时间足以进行概念上的检查，则<strong>需要一个半月的时间才能获得适当的Beta版本</strong> 。 在项目的整个过程中，创建完整的“产品”版本大约花了六个月的时间，不断完善和修正。 在很多方面，我们都得归功于当时在团队中工作的技术游戏设计师伊戈尔（Igor）在项目中开发和实施物理学的速度，伊戈尔在数学模型方面的细致入微以及玩家对其的主观感知导致了目前的结果。  <strong>从技术上讲，</strong>我必须承认<strong>我是野蛮人</strong> ：砍斧砍伐森林是我的工作。 经过Igor与其他人的处理和模型的微调之后，我们得到了可立即投入生产的开放式解决方案，该解决方案可扩展并<strong>针对多人游戏的需求进行了</strong>高度<strong>优化</strong> 。 值得骄傲的是：市场上有很多插件（包括内置的PhysX Vehicles），我们最快，最透明的设置。 </p><br><p> 顺便说一句，有一些有趣的案例。 当我们使用PhysX车辆，而我们极滑的多轮车辆无法爬上小山丘时，我听到了不止一次的责难，说我们的团队无法进行安装，以致于人们无法忍受。 决定使用他的插件，包括在以下框架的影响下： </p><br><p><img src="https://habrastorage.org/webt/ll/x5/zy/llx5zyvm9un4kqbbptkutjkl-js.png"></p><br><p> 苏军最新发展！  <strong>可以爬到89度墙壁的</strong>蜘蛛罐。 根本没有什么要掩盖的：D </p><br><h2 id="osobennosti-nashego-resheniya"> 我们解决方案的特点 </h2><br><p> 在我继续以PsRealVehicle中的坦克和车辆的配置作为AW：突击的示例进行描述之前，我想先说几件事，它们构成了所使用的物理模型的基础。 </p><br><p><img src="https://habrastorage.org/webt/ct/jm/cz/ctjmczrjxmqlvxnq7vitxxo2wvg.gif"></p><br><p> 首先，我们明确地坚持这样一个事实，即<strong>我们不是在制造坦克物理模拟器，而是在开发一款</strong>足够街机的游戏。 很难过，但是很少有人需要真正的行为举止-这仅在演示视频上很酷，而不受控制，在射击游戏中更是如此。 玩家需要一种在其他重磅炸弹已经产生的意义上表现像坦克的坦克。 并且要在常规设备上工作，而不是某些Titan。 </p><br><p> 第一点有一个后果：游戏中的某些东西非常虚假。  <strong>如果某物看起来像一个坦克并且表现得像一个坦克，那么它就是一个坦克</strong> ，而里面的护卫舰是没有意义的，也可以用条件摩擦魔术来设置物理学的一部分。 这些约定之一是通过改变角速度而不是通过施加在车轮和悬架上的力来控制机器的旋转。 按照惯例，坦克会每秒旋转X度，这是因为我们是根据游戏玩法来决定的，而不是因为它的轨迹以这种速度旋转。 </p><br><p><img src="https://habrastorage.org/webt/vt/81/yc/vt81ycuavkjcezmuos42pkd3j5c.gif"></p><br><p> 顺便说一句，这并不能否定一个事实，那就是您可以在“引擎盖下”开启“真实的”旋转物理学， <strong>这是在第一个原型中使用的</strong> 。 很好的方法是固定角形悬架，车轮底部等的工作。 如果我们开始进行赛车模拟，那么我们肯定会回到这一点，但是现在这是可能改进列表中的一项。 </p><br><p><img src="https://habrastorage.org/webt/k8/l4/la/k8l4labeq23fkhmcxuyy9obujd8.gif"></p><br><h1 id="struktura-tanka-v-aw-assault">  AW的坦克结构：突击 </h1><br><h2 id="ierarhiya-klassov"> 类层次 </h2><br><p> <code>AAwmVehicle</code>是负责游戏中机器的主要C ++类，它<strong>分为许多组件</strong> （运动<code>UPsRealVehicleMovementComponent</code> ，声音，VFX，统计信息，装甲等）。  <code>BP_DefaultVehicle</code>继承自它，这是所有计算机<strong>的默认设置</strong>的附加<strong>层</strong> 。 所有其他都是游戏中每个设备的私人设置蓝图。 </p><br><p> 每台机器都是一组这样的数据： </p><br><ul><li> 蓝图，其中注册了<strong>所有外部资产</strong> ，声音，设置了“轮式/履带车”属性，并设置了物理。 </li><li> 网格骨架和与其相关的资产： <br>  -实物资产（没有魔术，一切都是标准）。 <br>  -动画树。 </li><li> 纹理（漫反射，法线贴图，RMM）。 </li><li> 实例材质（船体，航迹+破碎状况）。 </li><li> 一套用于穿透系统的装甲网。 </li><li> 相机，水位检查器和其他辅助碰撞。 </li></ul><br><h2 id="animaciya-tanka"> 坦克动画 </h2><br><p> 不管动画树多么复杂，设置一个坦克都是一件小事。 配置数十个这样的水箱并在更换骨骼，网格等时保持最新状态<strong>对于手动工作</strong>来说是<strong>完全不足的</strong> 。 幸运的是，在我们的案例中，我们所谈论的是一个相当标准化的“角色”：一个坦克可以分解成多个实体，并称其为原型。 当然，这与命名骨骼有关。 </p><br><p> 这种方法使我们可以使用基本相同的动画树，其中<strong>Ctrl + C / Ctrl + V乘以任意数量的坦克</strong> ，除了原始的质量检查外，不需要任何支持。 </p><br><p><img src="https://habrastorage.org/webt/jk/ac/3e/jkac3e9ehgqjpxomkep5uekdnoq.png"></p><br><p> 所有魔术都发生在自定义sipy-nodes内部。 这样不仅可以标准化树，还可以<strong>大大减少</strong>每个动画<strong>的计算数量</strong> （标准节点喜欢来回驱动坐标系）。 </p><br><h2 id="materialy-tanka"> 坦克材料 </h2><br><p> 对于储罐的所有部分，使用<strong>一种母材</strong> ，由一对Switch节点自定义。 </p><br><p><img src="https://habrastorage.org/webt/bl/az/c_/blazc_ihvsibh0upozkwha6c1ks.png"></p><br><p> 接下来我们得到一棵这样的树： </p><br><pre>  -M_Vehicles
  --MI_Vehicles_Clean_Body
  ---MI_Leopard2
  ----MI_Leopard2_LOD
  --MI_Vehicles_Clean_Treads（选中“ Treads”）
  ---MI_Leopard2_Treads
  ----MI_Leopard2_Treads_LOD </pre><br><p> 此处的实际“权重”仅为<strong>M_Vehicles</strong>和<strong>MI_Vehicles_Clean_Treads</strong> ，所有其他实例只是参数集，并且占用最少的内存和磁盘空间。 </p><br><p><img src="https://habrastorage.org/webt/sv/zd/zm/svzdzmbcm6u9zpycumfljxddrpo.png"></p><br><p> 通常，坦克的图形资产集对于任何游戏都是非常标准的。 </p><br><h2 id="rabota-broni"> 装甲工作 </h2><br><p> 与同事交流几次时，出现了一个问题，为什么每件装甲都有单独的网格，为什么我们不使用Anrilov碰撞系统？ </p><br><p><img src="https://habrastorage.org/webt/vl/5p/lj/vl5pljjj372kzdcxamm4tat4n2m.png"></p><br><p> 实际上，我们使用了通常的Anrilov碰撞，但<strong>仅仅是为了“抓住”子弹</strong> 。 弹丸推入坦克后，要考虑所有部件的特性，多层，弹丸的再反射，累积漏斗和其他有趣的力学原理，对所有装甲片进行多边形计算。 </p><br><p> 在这种情况下，最方便的方法是读取“裸”网格数据，我们不会剥离专用服务器的数据。 </p><br><h2 id="set-i-ekstra-optimizaciya"> 网络和额外优化 </h2><br><p> 我也想简短地提到几个“近箱”点。 </p><br><ul><li><p> 储罐的所有移动<strong>仅在服务器上进行</strong> ，客户端仅对收到的值进行插值。 不使用外推法。 同步频率是<strong>每秒10次</strong> 。 </p><br></li><li><p> 根据水箱的屏幕尺寸，我们跳过骨架网格物体的一次或多次滴答，其中包括所有动画的计算和一些物理交互。 如果无法在屏幕上看到坦克，则它是一个<strong>漂浮在太空中</strong>的愚蠢， <strong>没有动画的盒子</strong> 。 尽管有一个好主意，但内置的“更新速率优化”具有非常粗糙的实现方式，并没有明显提高性能。 特别是在手机方面。 </p><br></li><li><p> 对于所有储罐，除了其自身的储罐外，客户端都会切断除最基本组件之外的所有组件：照相机，检查器和其他组成储罐的物品。 实际上， <strong>它们只不过是外表而已</strong> 。 </p><br></li></ul><br><p><img src="https://habrastorage.org/webt/hs/96/z4/hs96z4mtindirtkklvghhlznocg.jpeg"></p><br><ul><li> 专用<strong>LOD1储罐</strong>在专用服务器上驱动。 峰值更少-CPU使用率更低。 而且，仅在射弹命中时才进行定制装甲件位置的更新：在每个滴答声中都没有更新零件状态的意义。 </li></ul><br><h1 id="me-myself--tanks"> 我，我自己和坦克 </h1><br><p> 在<strong>普希金工作室，</strong>我们认为开发经验的交流非常重要，包括对于团队内部专业水平的提升。 开源项目是这种方法的重要组成部分，我很高兴能够向社区介绍<strong>PsRealVehicle之</strong>类的技术。 </p><br><p> 我认为，我们自己每天使用我们发布的所有插件和实用程序非常重要。 毕竟，Epic Games自己清楚地表明<strong>，好的技术</strong>的<strong>成功在于开发商自己</strong>在自己的产品中<strong>使用它</strong> 。 现在我们已经在<strong>使用UE 4.20版本了</strong> ，我们的插件已经一路走了，而且我们不会停止！ </p><br><p><img src="https://habrastorage.org/webt/4m/lh/-k/4mlh-kvwjhjyci6vxtcoao45wu8.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN423653/">https://habr.com/ru/post/zh-CN423653/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN423643/index.html">银行越来越多地监视客户声誉：Business Insider调查</a></li>
<li><a href="../zh-CN423645/index.html">世界杯期间我们如何为Luzhniki IT基础架构提供服务</a></li>
<li><a href="../zh-CN423647/index.html">创建一个简单的神经网络</a></li>
<li><a href="../zh-CN423649/index.html">“ Kubernetes遍及所有领域！” -采访DevOops会议的程序委员会</a></li>
<li><a href="../zh-CN423651/index.html">我们邀请所有人参加hackathon SmartMail Hack：关于欢迎</a></li>
<li><a href="../zh-CN423655/index.html">泛型+春天：愿力量与您同在</a></li>
<li><a href="../zh-CN423657/index.html">我不尊重封装，也不尊重使用其他类型的方法表来快速调用私有方法</a></li>
<li><a href="../zh-CN423663/index.html">我们用Lisp-III写一个简单的翻译器</a></li>
<li><a href="../zh-CN423671/index.html">特斯拉竞争对手从沙特阿拉伯获得10亿美元投资</a></li>
<li><a href="../zh-CN423677/index.html">Jetpack飞行员：Frankie West</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>