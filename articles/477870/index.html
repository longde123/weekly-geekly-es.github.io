<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåä üë©üèΩ‚Äçüç≥ üå¨Ô∏è Tablero de Grafana para el sistema de cerveza BeerTender üéÑ üë©üèæ‚Äçü§ù‚Äçüë©üèΩ üöÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Explicaci√≥n BeerTender: un dispositivo para enfriar y embotellar cerveza de Krups y Heineken. Seg√∫n los fabricantes, mantiene la calidad de la cerveza...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tablero de Grafana para el sistema de cerveza BeerTender</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/477870/">  <i>Explicaci√≥n</i>  <i>BeerTender: un dispositivo para enfriar y embotellar cerveza de Krups y Heineken.</i>  <i>Seg√∫n los fabricantes, mantiene la calidad de la cerveza fresca durante 30 d√≠as despu√©s de la apertura del barril.</i>  <i>Por supuesto, es conveniente para los administradores de sistemas y desarrolladores controlar la temperatura y el nivel de cerveza en su barril utilizando los paneles habituales en l√≠nea.</i>  <i>El art√≠culo anterior describ√≠a <a href="https://blog.senx.io/connecting-a-beertender-to-warp-10-using-mqtt-on-lorawan-with-thethingsnetwork/">c√≥mo conectar BeerTender a Warp 10</a> , y ahora configuraremos el panel de Grafana</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/edf/3a3/ce5/edf3a3ce53ae1323eb8697358f0256bd.png"><br><br>  OVHcloud, el proveedor de alojamiento y nube m√°s grande de Europa, utiliza activamente la plataforma Warp 10. Todos sus datos de monitoreo fluyen en un cl√∫ster Warp 10.  ¬°Son 400,000 servidores, 27 centros de datos, un total de varios millones de m√©tricas por segundo! <br><br>  Tienen muchos paneles, y ahora OVHcloud es el encargado de mantener el <a href="https://github.com/ovh/ovh-warp10-datasource">plugin de</a> c√≥digo abierto <a href="https://github.com/ovh/ovh-warp10-datasource">Warp 10 Grafana</a> , que comenzamos a desarrollar hace alg√∫n tiempo.  Hablaremos de √©l.  Si desea probarlo usted mismo, los datos est√°n en el dominio p√∫blico; puede copiar WarpScript a continuaci√≥n. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d3/a63/100/1d3a631002ed21c5c17014adf259d785.png"></div><br>  <i><font color="gray"><a href="https://blog.senx.io/connecting-a-beertender-to-warp-10-using-mqtt-on-lorawan-with-thethingsnetwork/">Ya hablamos sobre</a> c√≥mo conectar BeerTender a Warp 10.</font></i> <br><br><h2>  Instalaci√≥n </h2><br>  Primero, instala Grafana.  Siga las <a href="https://grafana.com/grafana/download">instrucciones en su sitio web</a> . <br><br>  Nos conectamos a la <code>http://localhost:3000/</code> predeterminada <code>http://localhost:3000/</code> , vaya a la contrase√±a predeterminada admin / admin, luego cambie la contrase√±a del administrador. <br><br>  Para la √∫ltima versi√≥n de Grafana, el complemento deber√° instalarse manualmente.  El m√©todo con <code>grafana-cli</code> no funcionar√°.  Solo necesita clonar el repositorio de complementos en el directorio de complementos de Grafana y corregir los permisos en todas partes. <br><br><pre> <code class="bash hljs">sudo systemctl stop grafana-server.service sudo chown -R grafana:mygroup /var/lib/grafana/ sudo chmod g+rw /var/lib/grafana/plugins git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:ovh/ovh-warp10-datasource.git /var/lib/grafana/plugins/ovh-warp10-datasource sudo chown -R grafana:mygroup /var/lib/grafana/plugins sudo systemctl start grafana-server.service</code> </pre> <br><h2>  Configuracion </h2><br>  En la configuraci√≥n de Grafana, vaya a la secci√≥n Fuentes de datos y agregue una fuente de datos de tipo Warp 10. Aseg√∫rese de que apunte a la instancia requerida de Warp 10. Puede especificar la misma configuraci√≥n que la nuestra: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/458/542/267/458542267fe277be0e54ab6ac358df53.png"></div><br><br>  Es hora de tomar datos del BeerTender ... <br><br><h2>  Visualizaci√≥n de la temperatura </h2><br>  Cree un nuevo panel de control, agregue un panel con el tipo de visualizaci√≥n Graph e ingrese al modo Consultas: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/04c/4c2/c72/04c4c2c72c65f5ba669aca9d86f7c401.png"><br>  <i><font color="gray">Temperatura inicial (valores enteros del sensor)</font></i> <br><br><ul><li>  En la fuente de datos, seleccione Warp 10 (o el valor predeterminado) <br></li><li>  Encienda el editor WarpScript <br></li><li>  Copie WarpScript a continuaci√≥n <br></li><li>  En la esquina superior derecha, seleccione "√öltimos 30 d√≠as" <br></li><li>  Guarda el resultado </li></ul><br><pre> <code class="plaintext hljs">"gCA1SVjbDkaxtmTx9ydI4TI2iGc5hFgcbCWnzMRZSt45XW8dZ53Z7VK_if28i0kXwNDLazXHgLrXUKgxLK0RbS79eJmBCpyBlIxw9US7bPfdWH4Fta51.kXN.D4Hsk5OZOwl.vLRBzMpP7F2pAMfclMXSGtCOT6F" 'rt' STORE [ $rt 'beertender.rawtemperature' {} NOW 30 d ] FETCH 0 GET</code> </pre> <br>  Este script mostrar√° los valores iniciales del sensor ADC.  Tenga en cuenta que el editor WarpScript en Grafana no es tan poderoso como antes, no hay m√°s autocompletado aqu√≠.  Puede escribir un script en WarpStudio o VSCode, por lo que tendr√° resaltado de sintaxis y documentaci√≥n en l√≠nea, y luego copiar√° y pegar√° el resultado en Grafana. <br><br><h4>  Espaciado autom√°tico </h4><br>  En este ejemplo, seleccione el intervalo de 30 d√≠as y establezca el modo de visualizaci√≥n en gr√°fico durante los √∫ltimos 30 d√≠as.  Si seleccionamos el modo de vista para el √∫ltimo d√≠a o a√±o, WarpScript siempre solicitar√° datos cada 30 d√≠as.  El complemento resuelve este problema: hay dos variables disponibles para usar en WarpScript: <code>$end</code> e <code>$interval</code> . <br><br><pre> <code class="plaintext hljs">[ $rt 'beertender.rawtemperature' {} $end $interval ] FETCH 0</code> </pre> <br><h2>  Temperatura de la cerveza </h2><br>  Tom√© varias medidas de agua, hielo y agua caliente, compar√°ndolas con un sensor de referencia ... El resultado fue el siguiente: <br><br><pre>  T (¬∞ C) valor inicial
 18,3 680
 41,5 870
 37,6 841
 10 586
 11 596
 8 559
 1,467
 4,500
 6.5 535 </pre><br>  Inserte estos valores en la serie temporal de <a href="https://www.warp10.io/content/04_Tutorials/01_WarpScript/20_Master_GTS">GTS</a> y ordene el resultado por los valores iniciales del sensor: <br><br><pre> <code class="plaintext hljs">NEWGTS 'linearInterpolation' RENAME 680 NaN NaN NaN 18.3 ADDVALUE 870 NaN NaN NaN 41.5 ADDVALUE 841 NaN NaN NaN 37.6 ADDVALUE 586 NaN NaN NaN 10 ADDVALUE 596 NaN NaN NaN 11 ADDVALUE 559 NaN NaN NaN 8 ADDVALUE 467 NaN NaN NaN 1 ADDVALUE 500 NaN NaN NaN 4.5 ADDVALUE 535 NaN NaN NaN 6.5 ADDVALUE SORT</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/140/dcb/8ed/140dcb8ede7c3f8a3a7da87baeaa2ab6.png"><br>  <i><font color="gray">Interpolaci√≥n esperada</font></i> <br><br>  La fuente de datos del sensor viene en forma de enteros.  La forma m√°s f√°cil de interpolar es construir primero la curva, y luego usar la funci√≥n <a href="https://www.warp10.io/doc/ATTICK">ATTICK</a> para leer los valores en grados. <br><br>  La interpolaci√≥n en WarpScript es f√°cil.  <a href="https://www.warp10.io/doc/BUCKETIZE">Hacemos un cubo</a> para establecer el per√≠odo deseado, y luego comenzamos la interpolaci√≥n, completando los valores faltantes. <br><br><pre> <code class="plaintext hljs">[ $linearInterpolation bucketizer.last 0 1 0 ] BUCKETIZE 0 GET INTERPOLATE 'truthtableGTS' STORE</code> </pre> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f14/6d7/6a9/f146d76a90bca0b87a2b2c54779214e1.png"><br><br>  Genial  Ahora debe escribir su propio mapeador para reemplazar cada valor del sensor con un valor real de temperatura f√≠sica y llevar el resultado al formato utilizado por el grafano. <br><br>  <u>Advertencia</u> : los valores llegan cada 10 segundos.  En tres meses, se acumular√°n 270 mil valores.  Demasiado para Grafana ... Solo mant√©n el valor m√°ximo de cada hora.  En WarpScript, esto es <a href="https://www.warp10.io/doc/BUCKETIZE">BUCKETIZE</a> con el bucketizer.max <a href="">bucketizer</a> . <br><br>  Puede copiar este WarpScript en Grafana: <br><br><pre> <code class="plaintext hljs">// raw value interpolation "gCA1SVjbDkaxtmTx9ydI4TI2iGc5hFgcbCWnzMRZSt45XW8dZ53Z7VK_if28i0kXwNDLazXHgLrXUKgxLK0RbS79eJmBCpyBlIxw9US7bPfdWH4Fta51.kXN.D4Hsk5OZOwl.vLRBzMpP7F2pAMfclMXSGtCOT6F" 'rt' STORE NEWGTS 'linearInterpolation' RENAME 680 NaN NaN NaN 18.3 ADDVALUE 870 NaN NaN NaN 41.5 ADDVALUE 841 NaN NaN NaN 37.6 ADDVALUE 586 NaN NaN NaN 10 ADDVALUE 596 NaN NaN NaN 11 ADDVALUE 559 NaN NaN NaN 8 ADDVALUE 467 NaN NaN NaN 1 ADDVALUE 500 NaN NaN NaN 4.5 ADDVALUE 535 NaN NaN NaN 6.5 ADDVALUE SORT 'linearInterpolation' STORE [ $linearInterpolation bucketizer.last 0 1 0 ] BUCKETIZE 0 GET INTERPOLATE 'truthtableGTS' STORE [ $rt 'beertender.rawtemperature' {} NOW $end $interval ] FETCH // subsampling, keep max of every hour [ SWAP bucketizer.max 0 1 h 0 ] BUCKETIZE UNBUCKETIZE // do not try to interpolate missing buckets. // interpolation [ SWAP &lt;% 'l' STORE [ $l 0 GET //same tick NaN NaN NaN //no latitude/longitude/elevation $truthtableGTS $l 7 GET 0 GET ATTICK 4 GET //take the interpolated value ] %&gt; MACROMAPPER 0 0 0 ] MAP 'temperature (¬∞C)' RENAME</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/b90/1de/947/b901de94794350e3a1b01a04f24a69e4.png"><br>  <i><font color="gray">5 ¬∞ C, normal para cerveza</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7af/e0a/744/7afe0a744272dd6d75b6ea949b0d414e.png"><br>  <i><font color="gray">Tablero BeerTender, primera versi√≥n</font></i> <br><br><h2>  Nivel de barril </h2><br>  El medidor de tensi√≥n mide el nivel en el barril ... Pero este es un sensor de tres cables barato en un soporte de metal oxidado.  No es posible obtener informaci√≥n precisa de dicho equipo.  Por lo tanto, no es sorprendente que la salida sea realmente un resultado ruidoso y que no se pueda confiar en los valores absolutos.  Para nuestro BeerTender, encontr√© una f√≥rmula experimental para Grafana para mostrar el nivel actual como un porcentaje. <br><br>  <i>Consejo: El complemento Warp 10 solo recupera datos de GTS.</i>  <i>Incluso si desea mostrar un solo valor, debe presentarlo en un punto de los datos GTS.</i> <br><br>  Aqu√≠ est√° WarpScript, que toma el √∫ltimo punto de datos y lo convierte en un valor porcentual, y tambi√©n crea una serie de tiempo con un punto: <br><br><pre> <code class="plaintext hljs">"gCA1SVjbDkaxtmTx9ydI4TI2iGc5hFgcbCWnzMRZSt45XW8dZ53Z7VK_if28i0kXwNDLazXHgLrXUKgxLK0RbS79eJmBCpyBlIxw9US7bPfdWH4Fta51.kXN.D4Hsk5OZOwl.vLRBzMpP7F2pAMfclMXSGtCOT6F" 'rt' STORE //read for beer level [ $rt 'beertender.rawvalue' {} NOW -1 ] FETCH 0 GET VALUES 0 GET 'rawSensorValue' STORE //raw correction: // empty: 30.8e6 // full (and cold): 30.5e6 30.8e6 $rawSensorValue - 0 MAX 2800 / 100 MIN 'beerlevelPercent' STORE $beerlevelPercent NEWGTS 'Barre Level (%25)' RENAME 1 NaN NaN NaN $beerlevelPercent ADDVALUE</code> </pre> <br>  Utilice este WarpScript como solicitud de un panel con un tipo de visualizaci√≥n de indicador: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/576/5fc/72c/5765fc72c3dd8525d1174cb84eda5f43.png"><br>  <i><font color="gray">Buen indicador</font></i> <br><br>  Si est√° interesado, puede consultar los datos de origen ... ¬°Ahora tenemos un token para acceder a estad√≠sticas √∫nicas sobre el consumo de cerveza! <br><br><h2>  Conclusiones </h2><br><ul><li>  Si los datos de monitoreo han estado bajo su control recientemente, Grafana puede integrar f√°cilmente la fuente de datos Warp 10. <br></li><li>  El complemento Grafana espera una serie temporal GTS o una lista GTS. <br></li><li>  OVHcloud es el actual mantenedor de complementos.  <a href="https://github.com/ovh/ovh-warp10-datasource">¬°Si√©ntase libre de contribuir!</a> <br></li><li>  Lea la <a href="https://github.com/ovh/ovh-warp10-datasource/wiki/Make-a-simple-graph">documentaci√≥n</a> para m√°s informaci√≥n. <br></li><li>  Si desea enriquecer la visualizaci√≥n de datos, puede tomar <a href="https://blog.senx.io/warpview-introduction/">nuestros componentes web listos para usar</a> . </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/1d3/a63/100/1d3a631002ed21c5c17014adf259d785.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/477870/">https://habr.com/ru/post/477870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../477856/index.html">Aceleradores de flash PCI-E de 800GB a 6.4TB: desde el amanecer hasta la vida en una PC / servidor normal</a></li>
<li><a href="../477858/index.html">Trabajo fuera de la mesa: ¬øqu√© proyectos salieron a la luz despu√©s de la aceleraci√≥n previa?</a></li>
<li><a href="../477862/index.html">¬øY entonces fue posible? Ciencia y TI en una conferencia</a></li>
<li><a href="../477864/index.html">TabPy para trabajar con datos en ClickHouse de Tableau</a></li>
<li><a href="../477866/index.html">Seminario: Soluciones de TI h√≠bridas para empresas. 5 de diciembre, San Petersburgo</a></li>
<li><a href="../477872/index.html">c.tech: Data Sense # 4 Lanzamiento de a√±o nuevo</a></li>
<li><a href="../477874/index.html">CDN din√°mico para transmisi√≥n WebRTC con baja latencia y transcodificaci√≥n</a></li>
<li><a href="../477882/index.html">40 canales y chats para aquellos interesados ‚Äã‚Äãen DevOps</a></li>
<li><a href="../477886/index.html">Curr√≠culum escolar para crear realidad virtual y aumentada</a></li>
<li><a href="../477894/index.html">trabajo y desarrollo divertido (damentals) # 0. ¬øQu√© esperar y c√≥mo ayudar a que un desarrollador en pr√°cticas se convierta en un junior seguro?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>