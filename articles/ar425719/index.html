<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛠️ 👨🏻‍🔧 🈯️ الكرفس في المشاريع المزدحمة: القليل من الممارسة 💅🏻 👏🏻 👷🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="عشية مؤتمر Python Conf ++ الخاص بنا في موسكو ، تحدثنا لفترة وجيزة مع Oleg Churkin ، وهو متخصص في التقنية الناشئة ، حول خبرته الواسعة مع Celery: نصف مل...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>الكرفس في المشاريع المزدحمة: القليل من الممارسة</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/425719/" style=";text-align:right;direction:rtl"> عشية مؤتمر Python Conf ++ الخاص بنا في موسكو ، تحدثنا لفترة وجيزة مع Oleg Churkin ، وهو متخصص في التقنية الناشئة ، حول خبرته الواسعة مع Celery: نصف مليون مهمة في الخلفية ، وأخطاء واختبارات. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9e7/04b/f65/9e704bf65f55a3ee6007034fc9a38540.jpg"><br><a name="habracut"></a><br>  <b>- أخبرني ببعض التفاصيل حول المشروع الذي تعمل عليه حاليًا؟</b> <br><br>  في الوقت الحالي ، أشارك في شركة Statusmoney الناشئة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">للتكنولوجيا المالية</a> ، والتي تحلل البيانات المالية للمستخدم وتسمح للعملاء بمقارنة دخلهم ونفقاتهم مع مجموعات أخرى من الناس ، ووضع حدود للإنفاق ، ومراقبة كيفية نمو الثروة أو انخفاضها على الرسوم البيانية.  حتى الآن ، يركز المشروع فقط على سوق أمريكا الشمالية. <br><br>  لتحليل المعلومات المالية ، نقوم بتنزيل جميع معاملات المستخدم وتخزينها والتكامل مع مكاتب الائتمان للحصول على بيانات إضافية عن سجل الائتمان. <br><br>  لدينا الآن حوالي 200 ألف مستخدم و 1.5 تيرابايت من البيانات المالية المختلفة من موردينا.  حوالي مليون معاملة <br><br>  <b>- ما هو المكدس التكنولوجي؟</b> <br><br>  مجموعة المشروع الحالي هي Python 3.6 و Django / Celery و Amazon Web Services.  نستخدم بنشاط RDS و Aurora لتخزين البيانات العلائقية ، وذاكرة التخزين المؤقت المرنة لذاكرة التخزين المؤقت وقوائم انتظار الرسائل ، و CloudWatch ، و Prometheus و Grafana للتنبيه والمراقبة.  حسنا ، وبطبيعة الحال ، S3 لتخزين الملفات. <br><br>  نحن أيضًا نشيطون جدًا في استخدام الكرفس لمهام العمل المختلفة: إرسال الإشعارات وإرسال الرسائل الجماعية ، والتحديث الشامل للبيانات المختلفة من الخدمات الخارجية ، API غير المتزامن وما شابه ذلك. <br><br>  في الواجهة الأمامية ، لدينا React و Redux و TypeScript. <br><br>  <b>- ما هي الطبيعة الرئيسية للأحمال في مشروعك وكيف تتعامل معها</b> <b><br></b>  <b>هل تتأقلم</b> <br><br>  يقع العبء الرئيسي في المشروع على المهام الأساسية التي تؤديها الكرفس.  نطلق كل يوم حوالي نصف مليون مهمة مختلفة ، على سبيل المثال ، تحديث ومعالجة (ETL) البيانات المالية للمستخدمين من مختلف البنوك ومكاتب الائتمان ومؤسسات الاستثمار.  بالإضافة إلى ذلك ، نرسل العديد من الإشعارات ونحسب العديد من المعلمات لكل مستخدم. <br><br>  قمنا أيضًا بتطبيق واجهة برمجة تطبيقات غير متزامنة ، والتي "تنبض" النتائج من مصادر خارجية وتولد أيضًا العديد من المهام. <br><br>  في الوقت الحالي ، بعد ضبط البنية التحتية والكرفس ، يمكننا التأقلم بدون مشاكل ، ولكن قبل حدوثها ، سأخبرك بالتأكيد بذلك في تقريري. <br><br>  <b>- كيف يمكنك قياس كل شيء وتوفير التسامح مع الخطأ؟</b> <br><br>  للتحجيم ، نستخدم مجموعات التحجيم التلقائي ، وهي مجموعة أدوات توفرها منصة سحابة AWS الخاصة بنا.  يتم قياس Django و Celery بشكل أفقي بشكل جيد ، فنحن لا نضع الحدود إلا قليلاً على الحد الأقصى من الذاكرة المستخدمة من قبل عمال uWSGI / Celery. <br><br>  <b>- وترصد مع ماذا؟</b> <br><br>  لمراقبة استخدام وحدة المعالجة المركزية / الذاكرة وتوافر الأنظمة نفسها ، نستخدم Cloud Watch في AWS ، ونجمع مقاييس مختلفة من التطبيق ومن عمال الكرفس باستخدام Prometheus ، وننشئ الرسوم البيانية ونرسل التنبيهات إلى Grafana.  لبعض البيانات في Grafana نستخدم ELK كمصدر. <br><br>  <b>- لقد ذكرت واجهة برمجة التطبيقات غير المتزامنة.</b>  <b>أخبر المزيد عن كيفية الحصول عليها.</b> <b><br></b>  <b>مرتبة.</b> <br><br>  يتمتع مستخدمونا بفرصة "ربط" حساباتهم المصرفية (أو أي حسابات مالية أخرى) وتزويدنا بإمكانية الوصول إلى جميع معاملاتهم.  نعرض عملية "الربط" ومعالجة المعاملات ديناميكيًا على الموقع ، لذلك نستخدم التجميع المعتاد للنتائج الحالية من الواجهة الخلفية ، وتأخذ الخلفية البيانات ، بدء تشغيل خط أنابيب ETL من عدة مهام متكررة. <br><br>  <b>- الكرفس منتج مثير للجدل.</b>  <b>كيف تعيش معه؟</b> <br><br>  وفقًا لمشاعري ، أصبحت علاقتنا مع الكرفس الآن في مرحلة "القبول" - لقد اكتشفنا كيف يعمل الإطار في الداخل ، واخترنا الإعدادات لأنفسنا ، وفرزنا النشر ، و "مضافين" مع المراقبة وكتبنا العديد من المكتبات لأتمتة المهام الروتينية.  بعض الوظائف لم تكن كافية بالنسبة لنا "خارج الصندوق" ، وأضفناها بأنفسنا.  لسوء الحظ ، في وقت اختيار حزمة التكنولوجيا للمشروع ، لم يكن لدى Celery العديد من المنافسين ، وإذا استخدمنا حلولًا أبسط ، فسيتعين علينا إضافة المزيد. <br><br>  لم نواجه أي أخطاء في الإصدار الرابع من الكرفس.  كانت معظم المشاكل تتعلق إما بعدم فهمنا لكيفية عمل كل هذا ، أو بعوامل خارجية. <br><br>  سأتحدث عن بعض المكتبات المكتوبة في مشروعنا في عرضي التقديمي. <br><br>  <b>- سؤالي المفضل.</b>  <b>كيف تختبر كل هذه الموسيقى؟</b> <br><br>  يتم اختبار مهام الكرفس بشكل جيد من خلال الاختبارات الوظيفية.  نختبر التكامل بمساعدة الاختبارات التلقائية والاختبار اليدوي على حوامل ضمان الجودة والتدريج.  في الوقت الحالي ، لم نقرر بعد مشكلتين في اختبار المهام الدورية: كيفية السماح للمختبرين بتشغيلها وكيفية التحقق من صحة الجدول الزمني لهذه المهام (يلبي المتطلبات)؟ <br><br>  <b>- واختبارات الواجهة والتخطيط؟</b>  <b>ما هي نسبة الدليل إلى</b> <b><br></b>  <b>الاختبار الآلي؟</b> <br><br>  في المقدمة ، نستخدم Jest ونكتب اختبارات الوحدة فقط لمنطق الأعمال.  يتم تغطية 55٪ من الحالات الحرجة لأعمالنا من خلال الاختبارات الذاتية للسيلينيوم ، لدينا حاليًا حوالي 600 اختبار في TestRail و 3000 اختبار على الواجهة الخلفية. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/59f/40f/ad7/59f40fad7b54ad4abeb212461b6653a7.jpg"><br><br>  <b>- ماذا سيكون تقريرك عن موسكو Python Conf ++؟</b> <br><br>  في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">التقرير</a> سأخبرك بالتفصيل عن المهام وكيف يمكنك استخدام الكرفس ، ومقارنتها بالمنافسين الحاليين.  سأصف كيفية تجنب أشواط مختلفة عند تصميم نظام معقد يحتوي على عدد كبير من المهام: ما هي الإعدادات التي يجب تحديدها على الفور ، وأيها يمكن تركها في وقت لاحق ، وكيفية نشر نسخة جديدة من الشفرة حتى لا تفقد المهام عند تبديل حركة المرور ، سأشارك المكتبات المكتوبة لمراقبة المهام والرشقات. <br><br>  سوف أتطرق أيضًا إلى موضوع تنفيذ خطوط أنابيب ETL على الكرفس والإجابة على كيفية وصفها بشكل جميل ، وسياسة إعادة المحاولة التي يجب استخدامها ، وكيفية الحد من عدد المهام التي يتم تنفيذها في ظروف الموارد المحدودة.  بالإضافة إلى ذلك ، سأصف الأدوات التي نستخدمها لتنفيذ المعالجة المجمعة للمهام ، والتي تستهلك الذاكرة المتوفرة اقتصاديًا. <br><br>  بشكل عام ، إذا كنت ترغب في الحصول على تفاصيل لجميع النقاط المذكورة أعلاه ، تعال.  آمل أن تجد تقريري مفيدًا ومثيرًا للاهتمام. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar425719/">https://habr.com/ru/post/ar425719/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar425709/index.html">قدمنا ​​مذكرة للصينيين الذين جاءوا إليك</a></li>
<li><a href="../ar425711/index.html">فقدان خط غير متطابق</a></li>
<li><a href="../ar425713/index.html">دمج محرك HTML في تطبيق Windows الأصلي - الاختيار والبنية</a></li>
<li><a href="../ar425715/index.html">البرنامج التعليمي في الكيمياء: الانعكاس الحمضي للدوائر الدقيقة (كيفية فضح بلورة الدائرة الدقيقة لتصويرها اللاحق)</a></li>
<li><a href="../ar425717/index.html">الشبكة العصبية لمطوري C ++</a></li>
<li><a href="../ar425723/index.html">يعمل Facebook بنشاط على تطوير خدمة للعثور على عمل وتوظيف موظفين في شبكة اجتماعية</a></li>
<li><a href="../ar425725/index.html">نينتندو براءات الاختراع - لعبة الصبي</a></li>
<li><a href="../ar425727/index.html">حتى المرة القادمة</a></li>
<li><a href="../ar425729/index.html">Hackathon Pro Welcome: كيف كانت أول SmartMail Hack خيرية</a></li>
<li><a href="../ar425731/index.html">أسرار حوسبة GPU المستحيلة</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>