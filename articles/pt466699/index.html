<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìΩÔ∏è üôåüèæ üöß Domesticar protocolos de confian√ßa - autentica√ß√£o OAuth com o InterSystems IRIS üèéÔ∏è üó£Ô∏è üôç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como permitir que os computadores confiem um no outro na sua aus√™ncia, mantendo a seguran√ßa e a privacidade? 



 - Martini seco. Em um copo grande. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Domesticar protocolos de confian√ßa - autentica√ß√£o OAuth com o InterSystems IRIS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/intersystems/blog/466699/">  <b>Como permitir que os computadores confiem um no outro na sua aus√™ncia, mantendo a seguran√ßa e a privacidade?</b> <br><br><img src="https://habrastorage.org/webt/wn/au/eu/wnaueun6knwbjc4anclcexjbfwi.jpeg"><br><br>  - Martini seco.  Em um copo grande. <br>  - Oui, monsieur.  [Sim, Monsieur (Fr.)] <br>  "S√≥ um segundo, n√£o todos."  Tr√™s dedos de Gordon, um de vodka, meio dedo de Kina Lyklet.  Bata bem em uma coqueteleira e coloque uma fatia grande de lim√£o.  Voc√™ se lembra? <br><br>  Jan Fleming, Cassino Royale, 1953 <br><br><h2>  Parte 1. Hist√≥rias OAuth 2.0 e OpenID Connect </h2><br>  Universal e, ao que parece, hoje no s√©culo 21, o pacote favorito de todos dos protocolos de delega√ß√£o e autentica√ß√£o de acesso aberto √© chamado OAuth + OIDC.  Melhor para uso em massa, eles ainda n√£o inventaram nada.  Eles s√£o especialmente populares entre os fornecedores de front-end, porque seguem os protocolos HTTP (S) e usam o cont√™iner JWT ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JSON Web Token</a> ).  O OpenID Connect usa o OAuth para seu trabalho ou, em outras palavras, o OIDC √© um wrapper para o OAuth. <br><br>  OpenID - um padr√£o aberto para autentica√ß√£o e cria√ß√£o de sistemas de identifica√ß√£o digital n√£o √© novidade para os desenvolvedores.  Este ano, ele completa 14 anos.  Na terceira vers√£o atual, o nome completo √© OpenID Connect ou menor que OIDC.  √â popular no desenvolvimento web e m√≥vel e em sistemas corporativos. <br><a name="habracut"></a><br>  Seu parceiro, o Padr√£o de delega√ß√£o de acesso aberto OAuth, est√° completando 12 anos.  E 9 anos desde o surgimento do padr√£o RFC 5849. Contaremos com a vers√£o moderna do protocolo OAuth 2.0 e o atual <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 6749</a> .  Lembre-se de que o OAuth 2.0 n√£o √© compat√≠vel com o seu antecessor OAuth 1.0. <br><blockquote> OAuth - um protocolo aberto (esquema, transporte) para delegar acesso, que permite fornecer a terceiros acesso limitado aos recursos protegidos do usu√°rio sem a necessidade de transferir para eles (terceiros) o login e a senha do RFC 6749 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">oauth.net</a> √© o principal site do OAuth hospedado por Aaron Parecki <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">oauth.com</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tutorial do</a> OAuth e ambiente de teste <br><br>  O Open ID Connect (OIDC) √© um padr√£o aberto para sistemas de identifica√ß√£o descentralizados que permite ao usu√°rio criar uma conta √∫nica para identifica√ß√£o em uma variedade de recursos da Internet n√£o relacionados usando servi√ßos de terceiros, usa mensagens OAuth e um cont√™iner JWT para comunica√ß√£o segura. <br></blockquote>  Estritamente falando, o OAuth n√£o √© um protocolo, mas um conjunto de regras (esquema) para separar e transferir opera√ß√µes de identifica√ß√£o do usu√°rio para um servidor confi√°vel separado ao implementar a arquitetura de delimita√ß√£o do controle de acesso em sistemas de software. <br><br>  E aten√ß√£o, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OAuth n√£o pode dizer nada sobre um usu√°rio espec√≠fico</a> !  Nem quem ele √©, nem onde ele est√° agora, nem mesmo se ele trabalha no computador agora ou n√£o.  Por√©m, torna poss√≠vel interagir com sistemas sem interven√ß√£o do usu√°rio, usando tokens de acesso j√° emitidos.  Este √© um ponto importante. <br><blockquote>  Pode ser √∫til: <br><br><ul><li>  OAuth combina perfeitamente com o uso da linguagem de descri√ß√£o de acesso a atributos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">XACML</a> </li><li>  OAuth tamb√©m conta com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">acesso gerenciado pelo usu√°rio</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">UMA</a> ) </li></ul><br>  O uso conjunto do OAuth + OIDC + UMA permite implementar sistemas de identifica√ß√£o segura e controle de acesso (Gerenciamento de Identidade e Acesso - IdM, IAM) em diferentes √°reas, por exemplo: <br><br><ul><li>  usando o perfil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HEART</a> (Health Relationship Trust) dos dados pessoais de um paciente na medicina </li><li>  nas plataformas de identifica√ß√£o de clientes CIAM (Consumer Identity and Access Management) para empresas de manufatura e com√©rcio </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">personaliza√ß√£o de certificados digitais de dispositivos inteligentes</a> em sistemas IoT (Internet of Things) </li></ul></blockquote><img src="https://habrastorage.org/webt/pf/dt/vf/pfdtvf4d6obgfiom0tizekdsjis.png"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um novo Venn de controle de acesso para a economia da API</a> <br><br>  Mais importante ainda, n√£o armazene dados pessoais no mesmo local que o resto do sistema.  Separe fisicamente autentica√ß√£o e autoriza√ß√£o.  E melhor ainda - forne√ßa toda a identifica√ß√£o pessoalmente √† pessoa e nunca a mantenha com voc√™.  Confie no propriet√°rio do dispositivo. <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A Apple disse</a> que dados pessoais os russos armazenam na R√∫ssia.  Este √© o nome, endere√ßo, email, n√∫mero de telefone.  Mas mensagens, fotos, etc., as pr√≥prias pessoas confiam na nuvem do iCloud (que n√£o est√° na R√∫ssia). <br></blockquote><h2>  Parte 2. Reprodu√ß√£o curta ‚ÄúConfian√ßa e autentica√ß√£o‚Äù </h2><br>  Portanto, decidimos que n√£o era comum armazenar os dados pessoais de nossos queridos usu√°rios nem em nosso aplicativo, nem em um √∫nico armazenamento, juntamente com um banco de dados em funcionamento.  Ou seja, eles escolheram um administrador confi√°vel que fornecer√° esse servi√ßo para n√≥s.  E assim, quando Sua Majestade o Usu√°rio aparecer, forneceremos o seguinte di√°logo. <br><br>  Atores: <br><br><ul><li>  Usu√°rio </li><li>  Aplicativo Cliente </li><li>  Servi√ßo de identidade </li><li>  Servidor de Recursos </li></ul><br>  A a√ß√£o ocorre em um navegador no computador do usu√°rio.  Todos os personagens est√£o familiarizados h√° muito tempo.  O usu√°rio tem uma conta pessoal no servi√ßo de identidade.  O Aplicativo Cliente possui um contrato v√°lido assinado com o Servi√ßo de Identifica√ß√£o e interfaces m√∫tuas.  O Servidor de Recursos confia no Servi√ßo de Identidade na emiss√£o de chaves de acesso a qualquer paciente que ele possa identificar. <br><br>  Usu√°rio (P): (iniciando um aplicativo cliente baseado na Web) Caro aplicativo cliente, preciso desse "recurso". <br>  Aplicativo cliente (K): Caro usu√°rio, primeiro apresente a chave para "este recurso".  Sem uma chave, o acesso a "este recurso" est√° fechado. <br>  P: Eu n√£o tenho essa chave. <br>  K: Ent√£o, mudarei temporariamente voc√™ para um servi√ßo de identifica√ß√£o com o qual temos um acordo para emitir chaves para o servidor de recursos.  (redireciona P. ao servi√ßo de identifica√ß√£o) <br>  Servi√ßo de Identifica√ß√£o (I): Caro usu√°rio, diga-me quem voc√™ √© e quais chaves voc√™ precisa? <br>  P: Eu, usu√°rio usu√°rio do Ytsuken, a senha √© tal e qual, quero obter acesso a "este recurso". <br>  E: Obrigado, camarada Jtsuken.  A autentica√ß√£o foi bem-sucedida e sua identifica√ß√£o foi verificada.  Aqui est√° a chave para "este recurso" (P. redireciona de volta para K.) <br>  P: Cliente, eu trouxe a chave do "recurso" de que preciso. <br>  K: Obrigado usu√°rio.  A chave est√° correta.  Aqui est√° o "recurso" que voc√™ solicitou. <br><br>  A cortina.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A sinfonia de abertura de Richard Strauss</a> do filme "Space Odyssey of 2001" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">toca</a> <br><br><h2>  Parte 3. Servi√ßo de autoriza√ß√£o real </h2><br>  Agora vamos ao que interessa.  Temos tr√™s tarefas na agenda: nomear os personagens, preparar o palco e tocar a pe√ßa.  E tudo √© decidido de uma vez na plataforma IRIS da InterSystems.  Mas isso n√£o √© necess√°rio, voc√™ pode montar um design a partir de diferentes plataformas, a seu crit√©rio.  Por exemplo, nesta combina√ß√£o: servidor OAuth Keycloak + cliente OAuth e recurso OAuth no IRIS.  Em outras palavras: <br><br><ol><li>  Configure e inicie o servidor OAuth com o registro do nosso cliente de demonstra√ß√£o. </li><li>  Configure um cliente OAuth de demonstra√ß√£o conectando-o ao servidor OAuth e aos recursos da Web. </li><li>  Desenvolva aplicativos clientes que podem usar o OAuth.  Voc√™ pode usar Java, Python, C #, NodeJS.  A seguir, √© apresentado um c√≥digo de aplicativo de amostra no ObjectScript. </li></ol><br><blockquote>  O site da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">comunidade de desenvolvedores</a> tem instru√ß√µes detalhadas de Daniel Kutak em tr√™s partes, com exemplos de uso do OAuth no IRIS para diferentes aplicativos baseados no CSP ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">parte 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">parte 2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">parte 3</a> ). </blockquote>  Existem muitas configura√ß√µes no OAuth.  Portanto, escreva listas de verifica√ß√£o - esta √© a aplica√ß√£o mais correta para elas.  Exemplos e espa√ßos em branco abaixo. <br><blockquote>  Onde obter o InterSystems IRIS pronto para uma amostra?  H√° pelo menos duas op√ß√µes dispon√≠veis para todos: <br><br>  Obtenha um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">servidor IRIS</a> na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nuvem pr√©-configurado e pronto</a> na plataforma de treinamento do InterSystems Learning Services na se√ß√£o InterSystems Learning Labs. <br><br>  Instale um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cont√™iner de encaixe pronto para uso</a> .  Leia mais no artigo - uma instru√ß√£o passo a passo para iniciantes em desenvolvedores do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Iniciando IRIS Using Docker</a> ou, se preferir um v√≠deo, uma instru√ß√£o de screencast de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Developing Solutions with InterSystems IRIS Using Docker and VSCode</a> </blockquote><h3>  1-1 Configurando o servidor OAuth </h3><br>  Entramos no portal de gerenciamento IRIS e selecionamos a se√ß√£o: <br><br>  Administra√ß√£o do sistema &gt;&gt; Seguran√ßa &gt;&gt; OAuth 2.0 &gt;&gt; Servidor <br><br>  Em seguida, em cada par√°grafo, haver√° um nome para a linha de configura√ß√µes e, atrav√©s dos dois pontos, um exemplo ou explica√ß√£o, se necess√°rio. <br><br><img src="https://habrastorage.org/webt/9g/k4/by/9gk4bywq0a0dkkkprpu5wbnempo.png"><br><br>  <b>Guia Configura√ß√µes Gerais:</b> <br>  Descri√ß√£o: opcional, por exemplo, "Servidor de autoriza√ß√£o" <br>  O terminal do gerador (doravante CTG) √© o nome do host: nome DNS do seu servidor <br>  Tipos de permiss√£o suportados (selecione pelo menos um): <br>  C√≥digo de autoriza√ß√£o <br>  Impl√≠cito <br>  Credenciais: recurso, propriet√°rio, senha <br>  Credenciais do cliente <br>  Configura√ß√£o SSL / TLS: oauthserver <br><br>  <b>Guia Permiss√µes:</b> <br>  adicionar volumes suportados: por exemplo, scope1 e scope2 <br><br>  <b>Guia Intervalos:</b> <br>  Intervalo da chave de acesso: 3600 <br>  Intervalo do c√≥digo de autoriza√ß√£o: 60 <br>  Intervalo de atualiza√ß√£o: 86400 <br>  Intervalo de interrup√ß√£o de sess√£o: 86400 <br>  Per√≠odo de validade da chave do cliente: 0 <br><br>  <b>Guia Configura√ß√µes do JWT:</b> <br>  Algoritmo de entrada: RS512 <br>  Algoritmo de gerenciamento de chaves: RSA-OAEP <br>  Algoritmo de criptografia de conte√∫do: A256CBC-HS512 <br><br>  <b>Guia Customizing:</b> <br>  Identifique a classe:% OAuth2.Server.Authenticate <br>  Verifique a classe do usu√°rio:% OAuth2.Server.Validate <br>  Classe de servi√ßo de sess√£o: OAuth2.Server.Session <br>  Gerar classe de chave:% OAuth2.Server.JWT <br>  Namespace de personaliza√ß√£o:% SYS <br>  Fun√ß√µes de personaliza√ß√£o (selecione pelo menos uma):% DB_IRISSYS e% Manager <br><br>  Salve. <br><br><h3>  1-2 Registrar o cliente no servidor OAuth </h3><br><img src="https://habrastorage.org/webt/ae/gu/pz/aegupzlmpoucnqfa4vu-f2gcgq0.png"><br><br>  Bot√£o Descri√ß√£o do cliente &gt;&gt; bot√£o Criar descri√ß√£o do cliente: <br><br>  <b>Guia Configura√ß√µes Gerais:</b> <br>  Nome: CLIENT <br>  Descri√ß√£o: arbitr√°rio <br>  Tipo de Cliente: Confidencial <br>  URLs de redirecionamento: o endere√ßo do ponto de retorno em nosso aplicativo ap√≥s a autentica√ß√£o <br>  Tipos de permiss√£o suportados <br>  C√≥digo de autoriza√ß√£o: sim <br>  Impl√≠cito <br>  Credenciais: recurso, propriet√°rio, senha <br>  Credenciais do cliente <br>  Autoriza√ß√£o JWT <br>  Tipos de resposta suportados <br>  c√≥digo <br>  id_token <br>  chave id_token <br>  token <br>  Tipo de autoriza√ß√£o: Simples <br><br>  <b>Guia Credenciais do cliente:</b> preenchida automaticamente <br><br>  <b>Guia Informa√ß√µes do cliente:</b> <br>  URL de lan√ßamento: <br>  Tela de login <br>  Nome do cliente <br>  URL do logotipo <br>  URL da p√°gina inicial do cliente <br>  URL da pol√≠tica <br>  Termos de URL de servi√ßo <br><br><h3>  2-1 Configurando a liga√ß√£o no cliente do servidor OAuth </h3><br>  Administra√ß√£o do sistema &gt;&gt; Seguran√ßa &gt;&gt; OAuth 2.0 &gt;&gt; Cliente <br><br><img src="https://habrastorage.org/webt/xq/hu/3r/xqhu3rquzsfni1tsfgwtfkhzvew.png"><br><br>  Crie uma descri√ß√£o do servidor: <br>  Ponto de extremidade do gerador: obtenha dos par√¢metros gerais do servidor, veja acima <br>  Configura√ß√£o SSL / TLS: selecione na lista de configura√ß√µes pr√©-configuradas <br><br>  O conte√∫do dos campos restantes ser√° baixado automaticamente do servidor, mas voc√™ tamb√©m pode configur√°-los manualmente: <br><br>  Servidor de autoriza√ß√£o <br>  Terminal de Autoriza√ß√£o: CTG + / authorize <br>  Ponto final principal: CTG + / token <br>  Terminal de informa√ß√µes do usu√°rio: CTG + / userinfo <br>  Ponto final principal de autodiagn√≥stico: CTG + / revoga√ß√£o <br>  Ponto final de revoga√ß√£o de chaves: CTG + / introspec√ß√£o <br>  Configura√ß√µes de token da Web JSON (JWT) <br>  Outra fonte al√©m do registro din√¢mico: selecione JWKS na URL <br>  URL: CTG + / jwks <br><br><img src="https://habrastorage.org/webt/ic/7e/x4/ic7ex4khfgskgdqf_jpsdivgj_o.png"><br><br>  Nessa lista, por exemplo, pode ser visto (scopes_supported e claim_supported) que o servidor pode fornecer informa√ß√µes diferentes sobre o usu√°rio ao cliente OAuth.  E vale a pena prestar aten√ß√£o que, ao implementar seu aplicativo, voc√™ precisar√° perguntar ao usu√°rio quais dados ele est√° pronto para compartilhar.  Al√©m disso, em nosso exemplo, apenas seremos solicitados com permiss√£o pelo escopo1. <br><br>  Salve. <br><br>  Se houver um erro indicando SSL, v√° para as configura√ß√µes: <br>  Administra√ß√£o do sistema &gt;&gt; Seguran√ßa &gt;&gt; Configura√ß√£o de SSL / TSL <br><br><h3>  2-2 Configurando o cliente OAuth </h3><br>  Administra√ß√£o do sistema &gt;&gt; Seguran√ßa &gt;&gt; OAuth 2.0 &gt;&gt; Cliente &gt;&gt; Configura√ß√£o do cliente &gt;&gt; Criar configura√ß√£o do cliente <br><br><img src="https://habrastorage.org/webt/kd/e_/4w/kde_4wyvqd60yomyyudfzdotu_q.png"><br><br>  <b>Guia Geral:</b> <br>  Nome do aplicativo: cliente de demonstra√ß√£o <br>  Nome do cliente: demo client <br>  Descri√ß√£o: opcional <br>  Ativado: Sim <br>  Tipo de Cliente: Confidencial <br>  Configura√ß√£o SSL / TCL: oauthclient <br>  URL de redirecionamento do cliente: nome DNS do seu servidor <br>  Tipos de permiss√£o necess√°rios <br>  C√≥digo de autoriza√ß√£o: sim <br>  Impl√≠cito <br>  Credenciais: recurso, propriet√°rio, senha <br>  Credenciais do cliente <br>  Autoriza√ß√£o JWT <br>  Tipo de autoriza√ß√£o: Simples <br><br>  <b>Guia Informa√ß√µes do cliente:</b> <br>  Tela de login <br>  URL do logotipo <br>  URL da p√°gina inicial do cliente <br>  URL da pol√≠tica <br>  Termos de URL de servi√ßo <br>  Volume padr√£o: usamos os especificados anteriormente no servidor, por exemplo, scope1 <br>  Endere√ßos de email de contato (separados por v√≠rgula) <br>  Idade padr√£o m√°xima (em segundos) <br><br>  <b>Guia Configura√ß√µes do JWT:</b> <br>  Configura√ß√µes de token da Web JSON (JWT) <br>  Criando configura√ß√µes de JWT a partir de credenciais X509 <br>  Algoritmos do IDToken <br>  Assinatura: RS256 <br>  Criptografia: A256CBC <br>  Chave: RSA-OAEP <br>  Algoritmos de informa√ß√µes do usu√°rio <br>  Algoritmos de token de acesso <br>  Algoritmos de consulta <br><br>  <b>Guia Credenciais do cliente:</b> <br>  Id  cliente: daquele emitido no registro do cliente no servidor (veja acima) <br>  ID do cliente emitida <br>  Segredo do cliente: daquele emitido ao registrar o cliente no servidor (veja acima) <br>  O segredo do cliente expira <br>  URI de registro do cliente <br><br>  Salve. <br><br><h2>  Parte 4. C√≥digo </h2><br>  Vamos criar um aplicativo da web minimalista com autoriza√ß√£o OAuth e REST. <br><blockquote>  Ao trabalhar, o OAuth conta com o fato de que os canais de comunica√ß√£o entre os participantes da intera√ß√£o (servidor, clientes, aplicativo da web, navegador do usu√°rio, servidor de recursos) s√£o protegidos de alguma forma.  Na maioria das vezes, esse papel √© desempenhado pelo SSL / TLS.  Mas o OAuth tamb√©m funcionar√° em canais inseguros.  Por exemplo, o servidor Keycloak, por padr√£o, usa o protocolo HTTP e fica sem prote√ß√£o.  Isso simplifica o desenvolvimento e a depura√ß√£o durante o desenvolvimento.  Com o uso real dos servi√ßos OAuth, a prote√ß√£o de canal deve ser estritamente ativada - isso √© registrado na documenta√ß√£o do Keycloak.  Os desenvolvedores do InterSystems IRIS adotam uma abordagem mais rigorosa para o OAuth - √© necess√°rio SSL / TSL.  A √∫nica simplifica√ß√£o √© que voc√™ pode usar certificados autoassinados ou usar o servi√ßo PKI embutido no IRIS (Sistema de Administra√ß√£o &gt;&gt; Seguran√ßa &gt;&gt; Sistema de Chave P√∫blica). </blockquote>  A autoriza√ß√£o do usu√°rio √© verificada com a indica√ß√£o expl√≠cita de dois par√¢metros - o nome do seu aplicativo e o volume suportado pelo servidor OAuth e no cliente OAuth (escopo - gostaria de saber como nome√°-lo corretamente em russo?): <br><br><pre><code class="plaintext hljs">Parameter OAUTH2APPNAME = "OAuthClient"; set isAuthorized = ##class(%SYS.OAuth2.AccessToken).IsAuthorized( ..#OAUTH2APPNAME, .sessionId, "scope1", .accessToken, .idtoken, .responseProperties, .error)</code> </pre> <br>  Na falta de autoriza√ß√£o, estamos preparando um link para uma solicita√ß√£o de identifica√ß√£o do usu√°rio e obtendo permiss√£o dele para trabalhar com nosso aplicativo.  Aqui, precisamos indicar n√£o apenas o nome do aplicativo e o volume (escopo) solicitado registrados no servidor OAuth e no cliente OAuth, mas tamb√©m um link para o ponto em que o aplicativo Web deve retornar o usu√°rio. <br><br><pre> <code class="plaintext hljs">Parameter OAUTH2CLIENTREDIRECTURI = "https://52773b-76230063.labs.learning.intersystems.com/oauthclient/" set url = ##class(%SYS.OAuth2.Authorization).GetAuthorizationCodeEndpoint( ..#OAUTH2APPNAME, "scope1", ..#OAUTH2CLIENTREDIRECTURI, .properties, .isAuthorized, .sc)</code> </pre><br>  Usamos o servi√ßo de autentica√ß√£o IRIS embutido e, portanto, registramos usu√°rios no servidor OAuth IRIS.  Por exemplo, basta definir o usu√°rio apenas com um nome de usu√°rio e senha, n√£o ser√° necess√°rio fazer outras configura√ß√µes na conta. <br><br>  Ao transferir o usu√°rio usando o link recebido, o servidor executar√° o procedimento de identifica√ß√£o do usu√°rio e solicitar√° permiss√£o para operar com credenciais no aplicativo Web, al√©m de salvar o resultado em seu OAuth2.Server.Session global na √°rea% SYS: <br><br><img src="https://habrastorage.org/webt/dj/ih/ve/djihveewmoifbr9knths77mq-vi.png"><br><br><img src="https://habrastorage.org/webt/jb/ib/qz/jbibqzzejdf-gzo03bfcxdlkjjg.png"><br><br>  3. Demonstre os dados de um usu√°rio autorizado.  Ap√≥s a conclus√£o bem-sucedida dos procedimentos, temos, por exemplo, um token de acesso.  Vamos entender: <br><br><pre> <code class="plaintext hljs">set valid = ##class(%SYS.OAuth2.Validation).ValidateJWT( .#OAUTH2APPNAME, accessToken, "scope1", .aud, .JWTJsonObject, .securityParameters, .sc )</code> </pre><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de trabalho completo de um exemplo de trabalho com OAuth:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Class OAuthClient.REST Extends %CSP.REST { Parameter OAUTH2APPNAME = "OAuthClient"; Parameter OAUTH2CLIENTREDIRECTURI = "https://52773b-76230063.labs.learning.intersystems.com/oauthclient/"; // to keep sessionId Parameter UseSession As Integer = 1; XData UrlMap [ XMLNamespace = "http://www.intersystems.com/urlmap" ] { &lt;Routes&gt; &lt;Route Method="GET" Url = "/" Call = "Do" /&gt; &lt;/Routes&gt; } ClassMethod Do() As %Status { // Check for accessToken set isAuthorized = ##class(%SYS.OAuth2.AccessToken).IsAuthorized( ..#OAUTH2APPNAME, .sessionId, "scope1", .accessToken, .idtoken, .responseProperties, .error) // to show accessToken if isAuthorized { set valid = ##class(%SYS.OAuth2.Validation).ValidateJWT( ..#OAUTH2APPNAME, accessToken, "scope1", .aud, .JWTJsonObject, .securityParameters, .sc ) &amp;html&lt; Hello!&lt;br&gt; &gt; w "You access token = ", JWTJsonObject.%ToJSON() &amp;html&lt; &lt;/html&gt; &gt; quit $$$OK } // perform the process of user and client identification and get accessToken set url = ##class(%SYS.OAuth2.Authorization).GetAuthorizationCodeEndpoint( ..#OAUTH2APPNAME, "scope1", ..#OAUTH2CLIENTREDIRECTURI, .properties, .isAuthorized, .sc) if $$$ISERR(sc) { w "error handling here" quit $$$OK } // url magic correction: change slashes in the query parameter to its code set urlBase = $PIECE(url, "?") set urlQuery = $PIECE(url, "?", 2) set urlQuery = $REPLACE(urlQuery, "/", "%2F") set url = urlBase _ "?" _ urlQuery &amp;html&lt; &lt;html&gt; &lt;h1&gt;  IRIS   OAuth2&lt;/h1&gt; &lt;a href = "#(url)#"&gt;  &lt;b&gt;IRIS&lt;/b&gt;&lt;/a&gt; &lt;/html&gt; &gt; quit $$$OK } }</code> </pre><br></div></div><br>  Se necess√°rio, ative as mensagens de depura√ß√£o estendidas no servidor OAuth e no cliente OAuth.  As mensagens s√£o gravadas no ISCLOG global na √°rea% SYS.  Digite seu terminal IRIS (ou instale e use um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">terminal da Web</a> ): <br><br><pre> <code class="plaintext hljs">set ^%ISCLOG = 5 set ^%ISCLOG("Category", "OAuth2") = 5 set ^%ISCLOG("Category", "OAuth2Server") = 5</code> </pre><br>  Consulte a documenta√ß√£o do IRIS <a href="">Using OAuth 2.0 e OpenID Connect para obter mais informa√ß√µes</a> . <br><br>  Conclus√µes: <br><br><ol><li>  O OAuth ajuda a separar f√≠sica e geograficamente os servi√ßos com credenciais de usu√°rio e bancos de dados "funcionais".  E, assim, fortalecer a prote√ß√£o dos dados de identifica√ß√£o e, se necess√°rio, cumprir os requisitos das leis de prote√ß√£o de dados pessoais de diferentes pa√≠ses. </li><li>  Usando o OAuth, voc√™ pode fornecer ao usu√°rio a capacidade de trabalhar com seguran√ßa simultaneamente a partir de v√°rios dispositivos e "transmitir" seus dados pessoais minimamente a v√°rios servi√ßos e aplicativos.  Al√©m de n√£o receber informa√ß√µes "redundantes" sobre os usu√°rios em seus servi√ßos, ou seja, para conduzir o processamento de dados despersonalizados em seus servi√ßos. </li><li>  Ao usar o InterSystems IRIS, voc√™ tem um conjunto completo de ferramentas prontas para testar e implantar servi√ßos OAuth e OIDC, de maneira independente e em coopera√ß√£o com produtos de software de terceiros. </li></ol><br><blockquote>  Quais setores costumam usar a plataforma IRIS da InterSystems? <br>  Para automa√ß√£o de assist√™ncia m√©dica, no setor financeiro, para projetos de governo eletr√¥nico, em log√≠stica, varejo e muitas outras ind√∫strias. <br><br>  Se voc√™ estiver interessado nas tarefas de automa√ß√£o de assist√™ncia m√©dica, preste aten√ß√£o ao padr√£o FHIR.  O InterSystems IRIS for Health (uma vers√£o especial da plataforma InterSystems IRIS) oferece suporte ao padr√£o FHIR para integra√ß√£o e desenvolvimento de aplicativos </blockquote>  Como voc√™ pode ver acima, todos os recursos do OAuth s√£o facilmente acess√≠veis e totalmente prontos para uso.  Se necess√°rio, voc√™ pode substituir as classes de manipulador e as interfaces de usu√°rio pelas suas.  As configura√ß√µes do servidor e do cliente OAuth podem ser feitas a partir dos arquivos de configura√ß√£o, em vez de usar o portal de gerenciamento. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt466699/">https://habr.com/ru/post/pt466699/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt466685/index.html">Vendo dinheiro</a></li>
<li><a href="../pt466689/index.html">Como criar classes de caracteres no MMO m√≥vel</a></li>
<li><a href="../pt466691/index.html">Ent√£o, todos da mesma RAML ou OEA (Swagger)?</a></li>
<li><a href="../pt466693/index.html">Se voc√™ n√£o entrar no departamento de TI</a></li>
<li><a href="../pt466697/index.html">M√¥nadas em Erlang</a></li>
<li><a href="../pt466701/index.html">Let's Encrypt serve quase 30% dos dom√≠nios</a></li>
<li><a href="../pt466705/index.html">Vivaldi Beta para Android - Navegador Real</a></li>
<li><a href="../pt466709/index.html">Desenvolvendo um sistema operacional monol√≠tico semelhante a Unix - C Library (2)</a></li>
<li><a href="../pt466711/index.html">Vulnerabilidade O DaOffice permitiu remover qualquer usu√°rio da rede social</a></li>
<li><a href="../pt466713/index.html">√â poss√≠vel em 1C n√£o observar a tecnologia de componentes externos? Ou como parabenizar os colegas usando o 1C?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>