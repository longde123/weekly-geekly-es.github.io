<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äç‚öïÔ∏è üôÑ üîÆ Sonata - Serveur d'approvisionnement SIP üèáüèº üë©‚Äç‚ù§Ô∏è‚Äçüë© üîª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je ne sais pas avec quoi comparer l'approvisionnement. Peut-√™tre avec un chat? Cela semble possible sans lui, mais avec lui un peu mieux. Surtout si √ß...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sonata - Serveur d'approvisionnement SIP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445350/"><p>  Je ne sais pas avec quoi comparer l'approvisionnement.  Peut-√™tre avec un chat?  Cela semble possible sans lui, mais avec lui un peu mieux.  Surtout si √ßa marche)) </p><br><p>  √ânonc√© du probl√®me: </p><br><ol><li>  Je souhaite configurer les t√©l√©phones SIP rapidement, simplement et en toute s√©curit√©.  Lors de l'installation du t√©l√©phone, et plus encore lors de sa reconfiguration. </li><li>  De nombreux fournisseurs ont leurs propres formats de configuration, leurs utilitaires pour g√©n√©rer des configurations, leurs propres fa√ßons de prot√©ger les configurations.  Mais je ne veux pas vraiment traiter avec tout le monde. </li><li>  De nombreuses solutions de provisioning, a) sont ax√©es sur un fournisseur ou un syst√®me t√©l√©phonique, b) elles sont plut√¥t lourdes √† mettre en ≈ìuvre, un tas de scripts, de param√®tres, de br ... </li></ol><br><p>  Au point 3, je ferai un commentaire qu'il existe d'excellents syst√®mes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pour FreePBX</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FusionPBX</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kazoo</a> , o√π il existe des mod√®les accessibles au public pour les t√©l√©phones de divers fournisseurs.  Il existe des solutions commerciales o√π il est √©galement possible de configurer dans le module les performances des t√©l√©phones de diff√©rents fabricants, par exemple Yeastar PBX. </p><br><p> Sur Habr√© est √©galement plein de recettes sur la fa√ßon de configurer les appareils de diff√©rents fournisseurs: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deux</a> .  Mais comme on dit, tous les syst√®mes ont une faille fatale.  Faites donc votre v√©lo. </p><a name="habracut"></a><br><h2 id="svoy-format">  propre format </h2><br><p>  Comme on dit dans xkcd, je ne veux pas traiter avec 14 formats - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">imaginez le 15</a> .  Par cons√©quent, nous utilisons les param√®tres g√©n√©raux de n'importe quel t√©l√©phone et cr√©ons notre propre configuration au format json. </p><br><p>  Quelque chose comme √ßa: </p><br><pre><code class="plaintext hljs">{ "key": "sdgjdeu9443908", "token": "590sfdsf8u984", "model": "gxp1620", "vendor": "grandstream", "mac": "001565113af8", "timezone_offset": "GMT+03", "ntp_server": "pool.ntp.org", "status": true, "accounts": [ { "name": "", "line": 1, "sip_register": "sip.mobilonsip.ru", "sip_name": "sip102", "sip_user": "sip102", "sip_password": "4321", "sip_auth": "sip102" } ] }</code> </pre> <br><p>  Donc, dans n'importe quel t√©l√©phone, vous devez configurer l'heure locale, les lignes de gorg√©e.  Ici, tout est simple.  Plus d'exemples peuvent √™tre trouv√©s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><h2 id="cvoy-server-provizhna">  propre serveur </h2><br><p>  Dans les manuels du fabricant, il y a g√©n√©ralement un point o√π il est dit: prenez csv, √©crivez l'adresse login-password-poppy-l√†, g√©n√©rez des fichiers avec notre script d'entreprise, mettez-les sous le serveur Web Apache et √ßa ira. </p><br><p>  Le paragraphe suivant du manuel vous indique g√©n√©ralement quoi d'autre vous pouvez crypter le fichier de configuration g√©n√©r√©. </p><br><p>  Mais tout cela est un classique.  L'approche moderne avec des smoothies et Twitter dit que vous devez cr√©er un serveur Web pr√™t √† l'emploi qui ne sera pas aussi puissant qu'Apache, mais ne fera qu'une petite chose.  Formez et donnez des configurations par r√©f√©rence. </p><br><p>  Ici, nous nous arr√™tons et rappelons que presque tous les t√©l√©phones SIP peuvent d√©sormais recevoir des configurations via http / https, donc nous ne consid√©rons pas d'autres impl√©mentations (ftp, tftp, ftps).  Ensuite, chaque t√©l√©phone conna√Æt sa propre adresse de pavot.  Par cons√©quent, nous allons cr√©er deux liens: un personnel - sur la cl√© de l'appareil, le deuxi√®me g√©n√©ral, qui fonctionne sur un tas d'adresses de jeton et de pavot communes. </p><br><p>  De plus, je ne m'attarderai pas sur la configuration z√©ro, c'est-√†-dire  configurer le t√©l√©phone √† partir de z√©ro, c.-√†-d.  Vous l'avez coinc√© dans le r√©seau et cela a gagn√© un bond.  Non, dans mon sc√©nario, vous l'avez coinc√© dans le r√©seau, effectu√© une configuration pr√©liminaire (configur√© pour recevoir la configuration du serveur), puis buvez du chocolat et reconfigurez le t√©l√©phone au besoin via le service.  La distribution de l'option 66 est la pr√©occupation du serveur DHCP. </p><br><p>  Soit dit en passant, je suis compl√®tement tortur√© de dire "ravitaillement", donc le mot a √©t√© r√©duit √† "ravitaillement", ne donnez pas de coup de pied, s'il vous pla√Æt, avec vos pieds. </p><br><p>  Et encore une chose: notre serveur n'a pas d'interface utilisateur, c'est-√†-dire  interface utilisateur.  Peut-√™tre pour l'instant, mais pas s√ªr, car  Je n'en ai pas besoin.  Mais il existe une API pour enregistrer / supprimer les param√®tres, obtenir une liste des fournisseurs pris en charge, des mod√®les, tout est d√©crit selon les canons de la sp√©cification swagger. </p><br><p>  Pourquoi une API, pas une interface utilisateur?  Parce que  J'ai d√©j√† mon propre syst√®me t√©l√©phonique, alors, j'ai une source d'informations d'identification, o√π j'ai juste besoin de prendre ces donn√©es, de composer le json n√©cessaire et de le publier sur le serveur.  Et d√©j√† le serveur est s√©curis√© selon les r√®gles sp√©cifi√©es dans le fichier json, il distribuera la configuration au p√©riph√©rique n√©cessaire ou ne donnera pas si le p√©riph√©rique est incorrect, ou ne r√©pond pas aux crit√®res sp√©cifi√©s dans ce json √©galement. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0a3/d32/998/0a3d3299831402ac43dc63a3487c826f.png"></p><br><p>  Voici une telle disposition de microservice.  Cela s'appelle la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sonate</a> , le code source est disponible sur le github, il y a aussi une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">image docker pr√™te √† l'emploi</a> , un exemple d'utilisation de docker <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><h3 id="klyuchevye-fishki">  Caract√©ristiques cl√©s: </h3><br><ul><li><p>  en tout cas, acc√®s limit√© √† la config √† l'heure, par d√©faut 10 minutes.  Si vous souhaitez rendre la configuration √† nouveau disponible, republiez la configuration √† nouveau. </p><br></li><li><p>  un seul format pour tous les fournisseurs, tous les r√©glages sont supprim√©s en sonate, vous envoyez des json standardis√©s, vous configurez tout √©quipement disponible. </p><br></li><li><p>  toutes les configurations √©mises vers les appareils sont enregistr√©es, toutes les zones probl√©matiques peuvent √™tre consult√©es dans le journal et voir les erreurs </p><br></li><li><p>  il est possible d'utiliser un lien commun avec token, chaque t√©l√©phone re√ßoit sa propre configuration en sp√©cifiant l'adresse mac.  Ou un lien personnel sur cl√©. </p><br></li><li><p>  Les API de gestion et d'approvisionnement sont r√©parties entre les ports </p><br></li><li><p>  Tests.  Il √©tait tr√®s important pour moi de fixer le format de la configuration √©mise et de couvrir toutes les situations habituelles d'√©mission de la configuration avec des tests.  Pour que tout fonctionne clairement. </p><br></li></ul><br><h3 id="minusy">  Inconv√©nients: </h3><br><p>  Jusqu'√† pr√©sent, le cryptage sonata n'a pas √©t√© utilis√©.  C'est-√†-dire  Bien s√ªr, vous pouvez commencer √† utiliser https en mettant nginx, par exemple, avant la sonate.  Mais voici les m√©thodes propri√©taires non encore impliqu√©es.  Pourquoi?  Le projet est encore jeune, a presque renvers√© ses cent premiers appareils.  Et, bien s√ªr, je recueille des id√©es, des commentaires.  De plus, afin de tout s√©curiser afin que les configurations ne puissent pas √™tre d√©tect√©es sur le r√©seau, cela vaut probablement la peine de se soucier des cl√©s de chiffrement, des tls et d'un h√©risson avec elles, mais ce sera une continuation. </p><br><p>  Manque d'interface.  C'est peut-√™tre un inconv√©nient important pour l'utilisateur final, mais pour l'administrateur syst√®me, l'utilitaire de console est plus important qu'une application √† part enti√®re.  Il √©tait pr√©vu de cr√©er un utilitaire de console, mais vous ne savez pas s'il est n√©cessaire? </p><br><h3 id="chto-v-itoge">  Quel est le r√©sultat? </h3><br><p>  Petit serveur Web simple pour provisionner plusieurs mod√®les de t√©l√©phones avec API pour la gestion. </p><br><h3 id="esche-raz-kak-eto-dolzhno-rabotat">  Encore une fois, comment cela devrait-il fonctionner? </h3><br><ol><li>  Installez la sonate. </li><li>  Nous formons json-config et le publions en sonate. </li><li>  Ensuite, nous obtenons un lien de la sonate pour l'approvisionnement. </li><li>  Ensuite, nous indiquons ce lien dans le t√©l√©phone. </li><li>  L'appareil resserre la config </li></ol><br><p>  l'op√©ration suivante ne comporte que deux √©tapes: </p><br><ol><li>  Nous formons une config json et la publions en sonate </li><li>  L'appareil resserre la config </li></ol><br><h3 id="kakie-telefony-provizhnyatsya">  Quels types de t√©l√©phones sont t√©l√©charg√©s? </h3><br><p>  Vendeurs Grandstream, Fanvil, Yealink.  Les configurations au sein du fournisseur sont plus ou moins les m√™mes, mais peuvent diff√©rer selon le firmware - il peut √™tre n√©cessaire de tester en plus. </p><br><h3 id="kakie-pravila-mozhno-zadavat">  Quelles r√®gles peuvent √™tre fix√©es? </h3><br><p>  Par le temps.  Vous pouvez sp√©cifier la dur√©e jusqu'√† laquelle la configuration sera disponible. <br>  Par adresse mac.  Lorsque vous envoyez la configuration via le lien personnel de l'appareil, l'adresse mac sera √©galement v√©rifi√©e. <br>  Par ip.  Par adresse IP, d'o√π la demande a √©t√© faite. </p><br><h3 id="kak-vzaimodeystvovat-c-sonata">  Comment interagir avec la sonate? </h3><br><p>  Via l'API, faire des requ√™tes http.  L'API sera disponible dans votre installation.  Parce que  √âtant donn√© que l'API prend en charge la sp√©cification Swagger, vous pouvez utiliser l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilitaire en ligne</a> pour les demandes de test √† l'API. </p><br><h3 id="ok-otlichno-vesch-prikolnaya-kak-poprobovat">  Ok, super.  Chose sympa, comment essayer? </h3><br><p>  Le moyen le plus simple consiste √† d√©ployer une image Docker bas√©e sur le r√©f√©rentiel d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©chantillons de sonates</a> .  Le r√©f√©rentiel contient des instructions d'installation. </p><br><h3 id="a-esli-znayu-nodejs">  Et si je connais node.js? </h3><br><p>  Si vous avez de l'exp√©rience avec JavaScript, vous d√©couvrirez rapidement comment tout fonctionne ici. </p><br><h3 id="budet-li-razvitie-sonata">  La sonate va-t-elle se d√©velopper? </h3><br><p>  J'ai partiellement atteint mes objectifs.  La poursuite du d√©veloppement est une question de mes t√¢ches sur le th√®me de l'automatisation des param√®tres du t√©l√©phone.  Il y a toujours la possibilit√© d'√©tendre les configurations pour personnaliser les boutons du t√©l√©phone, d'ajouter les fonctionnalit√©s du carnet d'adresses, peut-√™tre autre chose, d'√©crire dans les commentaires. </p><br><h3 id="rezyume-i-blagodarnosti">  R√©sum√© et remerciements </h3><br><p>  Je me ferai un plaisir de formuler des suggestions / objections / commentaires et questions constructifs,  cela pourrait bien √™tre quelque chose d'incompr√©hensible d√©crit. </p><br><p>  Je remercie √©galement tous les coll√®gues qui ont aid√©, conseill√©, test√©, fourni / donn√© des t√©l√©phones pour les tests.  En fait, beaucoup de gens avec qui j'ai parl√© au travail, dans les bavardoirs et les courriels ont √©t√© impliqu√©s dans le projet dans une mesure diff√©rente.  Merci pour les id√©es et les r√©flexions. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr445350/">https://habr.com/ru/post/fr445350/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr445338/index.html">Serveur DHCP + Mysql en Python</a></li>
<li><a href="../fr445340/index.html">Augmentez la s√©curit√© du r√©seau en utilisant un analyseur cloud</a></li>
<li><a href="../fr445344/index.html">Plateforme de communications unifi√©es OpenVox</a></li>
<li><a href="../fr445346/index.html">Comment √©crire une mauvaise API</a></li>
<li><a href="../fr445348/index.html">SNA Hackathon 2019: Simplify Architecture - Simplify Features</a></li>
<li><a href="../fr445352/index.html">Spark Structured Streaming Applications sur Kubernetes. D√©couvrez FASTEN RUS</a></li>
<li><a href="../fr445354/index.html">Trouver des objets en images</a></li>
<li><a href="../fr445356/index.html">Aper√ßu de la section mobile √† DUMP-2019: maximum appliqu√© et utile dans le travail quotidien</a></li>
<li><a href="../fr445358/index.html">Organisation du syst√®me d'√©v√©nements dans Unity - √† travers les yeux d'un game designer</a></li>
<li><a href="../fr445360/index.html">5 t√¢ches typiques pour les interviews JavaScript: analyse et solutions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>