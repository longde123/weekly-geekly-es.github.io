<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óΩÔ∏è üëä üëãüèª [Resumen del administrador] C√≥mo hacer amigos con DHCP y no tener miedo de APIPA üë©üèø‚Äçüéì üëµüèº üëò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El servicio que emite direcciones IP a dispositivos en la red local parece ser uno de los m√°s simples y familiares. Sin embargo, mis colegas m√°s j√≥ven...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>[Resumen del administrador] C√≥mo hacer amigos con DHCP y no tener miedo de APIPA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pc-administrator/blog/467333/"><p><img src="https://habrastorage.org/getpro/habr/post_images/9c9/795/e15/9c9795e155e62808327ad29e2e964e7a.jpg"></p><br><p>  El servicio que emite direcciones IP a dispositivos en la red local parece ser uno de los m√°s simples y familiares.  Sin embargo, mis colegas m√°s j√≥venes todav√≠a ocasionalmente tienen preguntas como "la computadora est√° recibiendo una direcci√≥n extra√±a", y la aparici√≥n de un segundo servidor DHCP en un segmento de red causa algunos problemas de emoci√≥n o de red. </p><br><p>  Para que quienes lean este material no tengan esas preguntas, me gustar√≠a reunir una gran cantidad de informaci√≥n b√°sica sobre el funcionamiento de los mecanismos de emisi√≥n de direcciones IP, caracter√≠sticas y ejemplos de configuraci√≥n de configuraciones a prueba de fallas.  S√≠, y quiz√°s especialistas inexpertos est√©n interesados ‚Äã‚Äãen refrescar las conexiones neuronales. </p><br><p>  Un poco de teor√≠a y soluciones a problemas interesantes y no muy pr√°cticos, debajo del corte. </p><a name="habracut"></a><br><p>  En una red de √°rea local moderna, la emisi√≥n de direcciones generalmente se realiza mediante servicios especializados con soporte de protocolo.  El m√°s popular de estos es DHCP (Protocolo de configuraci√≥n din√°mica de host). </p><br><h1 id="zeroconf-ili-zachem-nam-voobsche-kakoy-to-dhcp">  Zeroconf o por qu√© necesitamos alg√∫n tipo de DHCP </h1><br><p> En principio, se cre√≥ una pila de tecnolog√≠a llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Zeroconf</a> espec√≠ficamente para redes peque√±as.  Le permite prescindir de los servicios y servidores centralizados, incluidos, entre otros, la emisi√≥n de direcciones IP.  Cierran (bueno, o casi cierran) las siguientes preguntas: </p><br><p>  <strong>Obtenci√≥n de una direcci√≥n IP</strong> (direccionamiento IP privado autom√°tico o APIPA).  El sistema mismo asigna una IP de la red 169.254.0.0/16 (excepto las cuadr√≠culas / 24 al principio y al final del rango), en funci√≥n de la direcci√≥n MAC y el generador de n√∫meros pseudoaleatorios.  Este sistema le permite evitar conflictos, y la direcci√≥n de esta red se llama link-local, incluso porque estas direcciones no est√°n enrutadas. </p><br><p>  <strong>Busca por nombre</strong> .  El sistema anuncia su nombre de red, y cada computadora trabaja con √©l como con DNS, almacenando entradas en su cach√©.  Apple usa la tecnolog√≠a mDNS (DNS de multidifusi√≥n), y Microsoft usa LLMNR (Resoluci√≥n de nombre de multidifusi√≥n local de enlace), mencionada en el art√≠culo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dominios, direcciones y Windows: mezclar, pero no agitar</a> ". </p><br><p>  <strong>Busca servicios de red</strong> .  Por ejemplo, impresoras.  Quiz√°s el protocolo m√°s famoso es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UPnP</a> , que, entre otras cosas, puede abrir puertos en los enrutadores.  El protocolo es bastante complicado, usa un conjunto completo de complementos como el uso de http, a diferencia del segundo protocolo conocido: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DNS-SD</a> (DNS Service Discovery), que simplemente usa registros SRV, incluso cuando se trabaja con mDNS. </p><br><p>  Con todas las ventajas de Zeroconf, sin ning√∫n conocimiento sagrado, puede construir una red que funcione simplemente conectando computadoras en el nivel f√≠sico, incluso puede interferir con los especialistas de TI. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d5b/71d/a7e/d5b71da7ea5fe5493e9881ee71272394.jpg"></p><br><p>  <em>Un poco molesto, ¬øno?</em> </p><br><p>  En los sistemas Windows, para deshabilitar el autoajuste en todos los adaptadores de red, debe crear un par√°metro DWORD con el nombre <em>IPAutoconfigurationEnabled</em> en la <em>secci√≥n HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ Tcpip \ Parameters</em> y establecerlo en 0. </p><br><p>  Por supuesto, Zeroconf es adecuado solo para redes peque√±as y aisladas (por ejemplo, conociste a un amigo con computadoras port√°tiles, las conectaste a trav√©s de Wi-Fi y juguemos a Diablo II, sin perder tiempo en ning√∫n servidor), y tambi√©n quiero obtener una red local para Internet .  Para no sufrir con la configuraci√≥n est√°tica de cada computadora, se crearon protocolos especiales, incluido el h√©roe del d√≠a: DHCP. </p><br><h1 id="dhcp-i-ego-praroditeli">  DHCP y sus progenitores </h1><br><p>  Una de las primeras implementaciones del protocolo para emitir direcciones IP apareci√≥ hace m√°s de 30 a√±os y se llam√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RARP</a> (Protocolo de resoluci√≥n de direcciones inversas).  Si simplificamos un poco el principio de su funcionamiento, se ve√≠a as√≠: el cliente hizo una solicitud a la direcci√≥n de transmisi√≥n de la red, el servidor la acept√≥, encontr√≥ el enlace de la direcci√≥n MAC e IP del cliente en su base de datos y envi√≥ una respuesta IP. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6a/53f/109/e6a53f1099a79a913500b6dea05b1dfd.jpg"></p><br><p>  <em>Esquema del protocolo RARP.</em> </p><br><p>  Y todo parec√≠a funcionar.  Pero el protocolo ten√≠a sus inconvenientes: era necesario configurar el servidor en cada segmento de la red local, registrar las direcciones MAC en este servidor y no hab√≠a forma de transmitir informaci√≥n adicional al cliente.  Por lo tanto, para reemplazarlo, se cre√≥ el protocolo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BOOTP</a> (Protocolo Bootstrap). </p><br><p>  Inicialmente, se usaba para estaciones de trabajo sin disco, que necesitaban no solo dar una direcci√≥n IP, sino tambi√©n transmitir informaci√≥n adicional al cliente, como la direcci√≥n del servidor TFTP y el nombre del archivo de descarga.  A diferencia de RARP, el protocolo ya admit√≠a retransmisi√≥n: peque√±os servicios que reenviaban solicitudes al servidor "principal".  Esto hizo posible utilizar un servidor en varias redes simult√°neamente.  Solo quedaba la necesidad de configurar manualmente las tablas y el l√≠mite de tama√±o para obtener informaci√≥n adicional.  Como resultado, el protocolo DHCP moderno ha entrado en escena, que es una extensi√≥n compatible de BOOTP (el servidor DHCP admite clientes heredados, pero no al rev√©s). </p><br><p>  Una diferencia importante de los protocolos obsoletos es la capacidad de emitir temporalmente una direcci√≥n (arrendamiento) y transferir una gran cantidad de informaci√≥n diferente al cliente.  Esto se logra debido al procedimiento menos trivial para obtener la direcci√≥n.  Si en los antiguos protocolos el esquema era simple, del tipo de solicitud-respuesta, entonces el esquema es el siguiente: </p><br><ul><li>  El cliente busca el servidor con una solicitud de difusi√≥n, solicitando tambi√©n configuraciones adicionales. </li><li>  El servidor responde al cliente ofreci√©ndole una direcci√≥n IP y otras configuraciones. </li><li>  El cliente confirma la informaci√≥n recibida por solicitud de difusi√≥n, indicando en la confirmaci√≥n la direcci√≥n IP del servidor seleccionado. </li><li>  El servidor acuerda con el cliente envi√°ndole una solicitud, una vez recibido, el cliente ya configura la interfaz de red o la rechaza. </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b55/510/aa5/b55510aa54fa43c6b42e109826ec02a5.jpg"></p><br><p>  <em>El esquema de comunicaci√≥n del cliente con el servidor de reenv√≠o y el servidor.</em> </p><br><p>  Puede leer m√°s sobre el esquema de interacci√≥n servidor-cliente y la estructura de las solicitudes y respuestas, por ejemplo, en el material " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Estructura, formato y prop√≥sito de los paquetes DHCP</a> ". </p><br><blockquote>  En varias entrevistas me preguntaron: "¬øQu√© transporte y puerto utiliza DHCP?"  Por si acaso, respondemos: "Servidor UDP: 67, cliente UDP: 68". </blockquote><p>  Muchas implementaciones de un servidor DHCP han sido encontradas por muchos, incluso al configurar una red dom√©stica.  De hecho, ahora el servidor es: </p><br><ul><li>  En casi cualquier enrutador, especialmente SOHO. </li><li>  En sistemas Windows Server.  Puede leer sobre el servidor y su configuraci√≥n en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> oficial. </li><li>  En sistemas * nix.  Quiz√°s el software m√°s popular es el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">servidor DHCP ISC</a> (dhcpd) y el "cosechador" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dnsmasq</a> . </li></ul><br><p>  Hay muchas implementaciones espec√≠ficas, pero, por ejemplo, la configuraci√≥n del servidor est√° limitada en los enrutadores SOHO.  Esto se refiere principalmente a configuraciones adicionales, adem√°s de la cl√°sica "direcci√≥n IP, m√°scara, puerta de enlace, servidor DNS".  Y son precisamente estas opciones adicionales las que causan el mayor inter√©s en el funcionamiento del protocolo.  La lista completa se puede encontrar en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC</a> correspondiente, pero analizar√© algunos ejemplos interesantes. </p><br><h1 id="udivitelnye-opcii-dhcp">  Incre√≠bles opciones de DHCP </h1><br><p>  En esta secci√≥n, analizar√© el uso pr√°ctico de las opciones de DHCP en los equipos MikroTik.  Inmediatamente llamar√© la atenci√≥n sobre el hecho de que no todas las opciones est√°n configuradas obviamente, el formato de los par√°metros se describe en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki</a> .  Tambi√©n debe tenerse en cuenta que el cliente aplica las opciones solo cuando las solicita.  En algunos servidores, puede forzar el env√≠o de la configuraci√≥n: por ejemplo, en el servidor ISC DHCP, la directiva <strong><em>dhcp-parameter-request-list</em></strong> es responsable de esto, y en Dnsmasq - * * <strong><em>--dhcp-option-force</em></strong> .  MikroTik y Windows no saben c√≥mo. </p><br><p>  <strong>Opci√≥n 6</strong> y <strong>Opci√≥n 15.</strong> Comencemos con una simple.  La configuraci√≥n n√∫mero 6 son los servidores DNS asignados a los clientes, 15 es el sufijo DNS.  Asignar un sufijo DNS puede ser √∫til cuando se trabaja con recursos de dominio en una red que no es de dominio, como describ√≠ en el art√≠culo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo redujimos el personal a trav√©s de Wi-Fi</a> ".  Configure MikroTik bajo el spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Configurar MikroTik, opci√≥n 15</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  15.  ‚Äî   HEX . /ip dhcp-server option add code=15 name=dns-suffix value=0x57687920616c6c207468697320736869743f #   /ip dhcp-server option sets add name=dns option=dns-suffix #   DHCP-  . /ip dhcp-server network set [find comment="wi-fi client dhcp"] dhcp-option-set=dns</span></span></code> </pre> </div></div><br><p>  Saber que un servidor DNS tambi√©n es una opci√≥n recientemente ha sido √∫til cuando diferentes clientes tuvieron que emitir diferentes servidores DNS.  La decisi√≥n del formulario "emitir un servidor y hacer diferentes reglas dst-nat para el puerto 53" no encajaba por varias razones.  Parte de la configuraci√≥n est√° nuevamente bajo el spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Configurar MikroTik, opci√≥n 6</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ,  ,  ip    /ip dhcp-server option add code=6 name=google value="'8.8.8.8'" add code=6 name=cloudflare value="'1.1.1.1'" #  /ip dhcp-server lease add address=10.0.0.2 dhcp-option=google mac-address=11:11:11:11:11:11 server=dhcp add address=10.0.0.3 dhcp-option=cloudflare mac-address=22:22:22:22:22:22 server=dhcp</span></span></code> </pre></div></div><br><p>  <strong>Opci√≥n 66</strong> y <strong>Opci√≥n 67</strong> .  Estas configuraciones regresaron de BOOTP y le permiten especificar el servidor TFTP y la imagen para el arranque de la red.  Para una sucursal peque√±a, es bastante conveniente instalar Mikrotik y estaciones de trabajo sin disco all√≠ y lanzar una imagen preparada de alguna <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ThinStation en el enrutador</a> .  Ejemplo de configuraci√≥n de DHCP: </p><br><pre> <code class="bash hljs">/ip dhcp-server option add name=<span class="hljs-string"><span class="hljs-string">"option66"</span></span> code=66 value=<span class="hljs-string"><span class="hljs-string">"s'192.168.88.1'"</span></span> add name=<span class="hljs-string"><span class="hljs-string">"option67"</span></span> code=67 value=<span class="hljs-string"><span class="hljs-string">"'pxelinux.0'"</span></span> /ip dhcp-server option sets add name=<span class="hljs-string"><span class="hljs-string">"set-pxe"</span></span> options=option66,option67</code> </pre><br><p>  <strong>Opci√≥n 121</strong> y <strong>Opci√≥n 249</strong> .  Se utilizan para transferir rutas adicionales al cliente, que en algunos casos puede ser m√°s conveniente que registrar rutas en la puerta de enlace predeterminada.  La configuraci√≥n es casi id√©ntica, excepto que los clientes de Windows prefieren la √∫ltima.  Para configurar el par√°metro, las rutas deben convertirse a hexadecimales, recogiendo la m√°scara de red de destino, la direcci√≥n de red y la puerta de enlace en una l√≠nea.  Adem√°s, por RFC, debe agregar una ruta predeterminada.  La opci√≥n de ajuste est√° debajo del spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Configuraci√≥n de ruta</b> <div class="spoiler_text"><p>  Supongamos que necesitamos agregar una ruta como dst-address = 10.0.0.0 / 24 gateway = 192.168.88.2 a los clientes, y la puerta de enlace principal ser√° 192.168.88.1.  Traig√°moslo todo en HEX: </p><br><div class="scrollable-table"><table><tbody><tr><td>  Datos de configuraci√≥n </td><td>  Dic </td><td>  Maleficio </td></tr><tr><td>  Mascara </td><td>  24 </td><td>  0x18 </td></tr><tr><td>  Red de destino </td><td>  10.0.0.0 </td><td>  0x0A 00 00 </td></tr><tr><td>  Puerta de enlace </td><td>  192.168.88.2 </td><td>  0xc0 a8 58 02 </td></tr><tr><td>  Red predeterminada </td><td>  0.0.0.0/0 </td><td>  0x00 </td></tr><tr><td>  Gateway predeterminado </td><td>  192.168.88.1 </td><td>  0xc0 a8 58 01 </td></tr></tbody></table></div><br><p>  Recolectemos toda esta felicidad en una l√≠nea y obtengamos la configuraci√≥n: </p><br><pre> <code class="bash hljs">/ip dhcp-server option add code=121 name=classless value=0x0A0000c0a8580200c0a85801</code> </pre></div></div><br><p>  Lea m√°s en el art√≠culo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mikrotik, DHCP Classless Route</a> ". </p><br><p>  <strong>Opci√≥n 252.</strong> Configuraci√≥n autom√°tica del servidor proxy.  Si por alguna raz√≥n la organizaci√≥n usa un proxy opaco, ser√° conveniente configurarlo con los clientes a trav√©s de un archivo especial wpad (pac).  Un ejemplo de configuraci√≥n de dicho archivo se describe en el material de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Proxy Auto Configuration (PAC)</a> .  Desafortunadamente, MiroTik no tiene un servidor web incorporado para alojar este archivo.  Puede usar el paquete de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">puntos de acceso</a> o las funciones de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">metarouter</a> para esto, pero es mejor colocar el archivo en otro lugar. </p><br><p>  <strong>Opci√≥n 82</strong> .  Una de las opciones m√°s √∫tiles no es solo para el cliente, sino tambi√©n para el rel√© DHCP.  Le permite transferir informaci√≥n sobre el puerto del conmutador al que est√° conectado el cliente y la identificaci√≥n del propio conmutador.  En base a esta informaci√≥n, el servidor, a su vez, ya puede emitir un determinado conjunto de configuraciones para el cliente o simplemente iniciar sesi√≥n; para encontrar el puerto de conexi√≥n del cliente, no era necesario ir a todos los conmutadores en una fila (especialmente si no est√°n en la pila). </p><br><p>  Despu√©s de que se configura DHCP-Relay en el enrutador, los campos <strong>ID del circuito</strong> del <strong>agente</strong> e <strong>ID</strong> <strong>remota del agente</strong> aparecer√°n en la informaci√≥n del cliente, donde el primero es el identificador de puerto del conmutador y el segundo es el identificador del conmutador. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9c3/350/fb7/9c3350fb7d11ac6f57f28c21eb58489f.jpg"></p><br><p>  <em>Emisi√≥n de direcciones con la opci√≥n 82.</em> </p><br><p>  La informaci√≥n se proporciona en formato hexadecimal.  Para mayor comodidad, puede usar scripts para analizar el registro de DHCP.  Por ejemplo, una soluci√≥n para una soluci√≥n de Microsoft se publica en la galer√≠a de scripts de Technet llamada " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Decoraci√≥n de las opciones de DHCP 82</a> ". </p><br><p>  <strong>La opci√≥n 82 tambi√©n</strong> se usa activamente en el sistema de facturaci√≥n de los proveedores y en la protecci√≥n de la red de interferencias externas.  Esto es un poco m√°s detallado. </p><br><h1 id="dobavim-seti-nadezhnosti-i-bezopasnosti">  Agregue redes de confiabilidad y seguridad </h1><br><p>  Debido a la simplicidad del protocolo y la presencia de solicitudes de difusi√≥n, existen ataques efectivos a la infraestructura, principalmente del tipo MITM ("hombre en el medio").  Los ataques se llevan a cabo elevando su servidor o retransmisor DHCP: despu√©s de todo, si controla la emisi√≥n de la configuraci√≥n de red, puede redirigir f√°cilmente el tr√°fico a una puerta de enlace comprometida.  Para facilitar el ataque, se utiliza el hambre DHCP (pretendiendo ser un cliente o un retransmisor, el atacante obliga al servidor DHCP "nativo" a agotar sus direcciones IP).  Puede leer m√°s sobre la implementaci√≥n del ataque en el art√≠culo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Atacar a DHCP</a> ", mientras que <strong>DHCP Snooping</strong> es el m√©todo de protecci√≥n. </p><br><p>  Esta es una funci√≥n de conmutaci√≥n que le permite "vincular" un servidor DHCP a un puerto espec√≠fico.  Se bloquear√°n las respuestas de DHCP en otros puertos.  En algunos conmutadores, puede configurar el trabajo con la Opci√≥n 82 cuando se detecta en el paquete (lo que indica la presencia de un rel√©): descartar, reemplazar, dejarlo sin cambios. </p><br><p>  En los conmutadores MikroTik, la inspecci√≥n DHCP est√° habilitada en la configuraci√≥n del puente: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># dhcp-snooping  option 82 /interface bridge add name=bridge set [find where name="bridge"] dhcp-snooping=yes add-dhcp-option82=yes #    /interface bridge port add bridge=bridge interface=ether1 add bridge=bridge interface=ether2 trusted=yes</span></span></code> </pre><br><p>  La configuraci√≥n en otros conmutadores es similar. </p><br><blockquote>  Vale la pena se√±alar que no todos los modelos MikroTik tienen soporte completo de hardware para DHCP Snooping, solo CRS3xx lo tiene. </blockquote><p>  Adem√°s de la protecci√≥n contra piratas inform√°ticos malintencionados, esta funci√≥n aliviar√° los dolores de cabeza cuando aparezca otro servidor DHCP en la red, por ejemplo, cuando un enrutador SOHO utilizado como un interruptor con un punto de acceso restablece su configuraci√≥n.  Desafortunadamente, en redes donde se encuentran equipos SOHO, no siempre existe una estructura de red de cable competente con enrutadores administrados.  Pero esa es otra pregunta. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/058/801/3c3/0588013c3a7595d350ee0f207dcd7b83.jpg"></p><br><p>  <em>Hermoso cambio es la clave para la salud.</em> </p><br><p>  Otros m√©todos de protecci√≥n incluyen la <strong>Seguridad del puerto</strong> ("vincular" una direcci√≥n MAC espec√≠fica al puerto del enrutador; si se detecta tr√°fico de otras direcciones, se bloquear√° el puerto), <strong>An√°lisis de</strong> tr√°fico para la cantidad de solicitudes y respuestas de DHCP o limitar su n√∫mero y, por supuesto, varios sistemas <strong>IPS \ IDS</strong> . </p><br><p>  Si hablamos no solo de protecci√≥n de red, sino tambi√©n de confiabilidad, no estar√° fuera de lugar mencionar las capacidades de DHCP a prueba de fallas.  De hecho, con su simplicidad, DHCP es a menudo uno de los servicios clave, y si falla, el trabajo de la organizaci√≥n puede paralizarse.  Pero si solo instala dos servidores con configuraciones id√©nticas, entonces nada m√°s que un conflicto de direcciones IP conducir√° a esto. </p><br><p>  Parece que puede dividir el √°rea de distribuci√≥n entre dos servidores y dejar que uno proporcione la mitad de las direcciones y el otro proporcione el otro.  Aqu√≠ hay solo una mitad paralizada de la infraestructura que es ligeramente mejor que la totalidad. </p><br><p>  Analizaremos opciones m√°s pr√°cticas. </p><br><p>  En <strong>los</strong> sistemas <strong>Windows Server a</strong> partir de 2012, el sistema de redundancia DHCP funciona de inmediato, en modo de equilibrio de carga (activo-activo) o en modo de tolerancia a fallas (activo-pasivo).  Puede encontrar una descripci√≥n detallada de la tecnolog√≠a y la configuraci√≥n en la <a href="">documentaci√≥n</a> oficial.  Observo que la tolerancia a fallas se configura a nivel de zona, por lo que diferentes zonas pueden funcionar en diferentes modos. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ced/b26/26d/cedb2626dd463700eed59152438a6a60.jpg"></p><br><p>  <em>Configuraci√≥n de la conmutaci√≥n por error del servidor DHCP en Windows.</em> </p><br><p>  <strong>El servidor DHCP de ISC</strong> utiliza la directiva de <strong><em>conmutaci√≥n por error</em></strong> para configurar la tolerancia a fallos; se propone sincronizar los datos de forma independiente, por ejemplo, utilizando rsync.  Lea m√°s en el art√≠culo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dos servidores DHCP en Centos7 ...</a> " </p><br><p>  Si crea una soluci√≥n tolerante a fallas basada en MikroTik, entonces no puede prescindir de trucos.  Una de las opciones para resolver el problema se anunci√≥ en MUM RU 18, y luego se public√≥ en el blog <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">del autor</a> .  En resumen: dos servidores est√°n configurados, pero con un par√°metro de umbral de retardo diferente (retardo de respuesta).  Luego, el servidor emitir√° la direcci√≥n con menos demora y con una demora m√°s larga, solo cuando la primera falla.  La sincronizaci√≥n de la informaci√≥n nuevamente debe hacerse con scripts. </p><br><p>  Personalmente, en un momento palme√© mis nervios cuando un enrutador apareci√≥ en la red "accidentalmente" y se conect√≥ a la red de √°rea local, tanto a las interfaces WAN como a la LAN. </p><br><p>  <strong>Dime, ¬øtuviste que lidiar con la lepra DHCP?</strong> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/467333/">https://habr.com/ru/post/467333/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../467317/index.html">C√≥mo SoftBank se trag√≥ el mundo</a></li>
<li><a href="../467323/index.html">Descripci√≥n general de las caracter√≠sticas de programaci√≥n del microcontrolador Qt Creator 4.10 y QBS 1.14</a></li>
<li><a href="../467327/index.html">C√≥mo me convert√≠ en programador a los 35 a√±os</a></li>
<li><a href="../467329/index.html">Los mejores productos parten de problemas reales: Intercomunicador sobre trabajos por hacer. Parte 1</a></li>
<li><a href="../467331/index.html">Vender + una hermosa tienda en l√≠nea en WordPress por $ 269 "desde cero" - nuestra experiencia</a></li>
<li><a href="../467335/index.html">Aqu√≠ se explica c√≥mo actualizar Node.js a trav√©s de Visual Studio, NPM, Windows / Mac</a></li>
<li><a href="../467337/index.html">El juego m√≥vil m√°s popular: c√≥mo se cre√≥ la "Serpiente" para los tel√©fonos Nokia</a></li>
<li><a href="../467339/index.html">Y de nuevo, el d√≠a 256 del a√±o.</a></li>
<li><a href="../467343/index.html">Por qu√© dej√© de trabajar como freelance: impresiones del desarrollador de backend despu√©s de 2 a√±os de "libertad"</a></li>
<li><a href="../467345/index.html">Visite los blogs de TI y las 4 capas de capacitaci√≥n: una entrevista con Sergei Abdulmanov de Mosigra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>