<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüåæ ‚òÅÔ∏è üö£üèª Portefeuille Apple Qu'est-ce que c'est et comment y int√©grer votre carte ü§ûüèΩ ü§∑üèª üéÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il est g√©n√©ralement admis que Wallet n'est pas le service le plus populaire dans la CEI. Mais d√©j√† dans le deuxi√®me projet cons√©cutif, le client d√©fin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Portefeuille Apple Qu'est-ce que c'est et comment y int√©grer votre carte</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/agima/blog/428437/"><p>  Il est g√©n√©ralement admis que Wallet n'est pas le service le plus populaire dans la CEI.  Mais d√©j√† dans le deuxi√®me projet cons√©cutif, le client d√©finit la t√¢che "Faire l'int√©gration avec Wallet".  J'ai donc d√©cid√© d'√©crire cet article pour parler du service dans son ensemble et montrer comment y int√©grer mon produit. </p><br><p>  Qu'est-ce qu'un portefeuille?  Il vous permet de conserver diff√©rents types de cartes dans votre t√©l√©phone (tickets, cartes de r√©duction, etc.), facilitant ainsi la vie des utilisateurs du produit.  De plus, il est possible de mettre √† jour les informations sur la carte via des notifications push, mais c'est un sujet pour un article s√©par√©.  Mais si vous avez une carte / ticket / abonnement qui peut √™tre int√©gr√© au t√©l√©phone, alors il y a une solution!  Comment le faire - lire ci-dessous. </p><a name="habracut"></a><br><p> En r√®gle g√©n√©rale, votre serveur est responsable de la cr√©ation de la carte.  L'application re√ßoit la carte sous la forme d'un fichier .pkpass et via l'application, l'utilisateur peut ajouter la carte √† Wallet. </p><br><h2 id="struktura-karty">  Structure de la carte </h2><br><p>  Quelle est la carte du point de vue du d√©veloppeur?  Une carte est une archive avec l'extension .pkpass.  Il contient toutes les donn√©es n√©cessaires √† l'affichage et au fonctionnement de la carte.  Le contenu de l'archive est dans le tableau ci-dessous. </p><br><table><tbody><tr><th>  Fichier </th><th>  Rendez-vous </th></tr><tr><td>  background.png </td><td>  Image de fond pour la carte. </td></tr><tr><td>  footer.png </td><td>  Image √† c√¥t√© du code-barres </td></tr><tr><td>  icon.png </td><td>  Ic√¥ne pour les notifications et les lettres </td></tr><tr><td>  logo.png </td><td>  Logo de la carte.  Affich√© en haut √† gauche </td></tr><tr><td>  manifest.json </td><td>  Registre de tous les fichiers inclus </td></tr><tr><td>  signature </td><td>  Signature PKCS7 </td></tr><tr><td>  pass.json </td><td>  Apparence et informations cartographiques </td></tr><tr><td>  strip.png </td><td>  Image situ√©e derri√®re la description principale de la carte </td></tr><tr><td>  thumbnail.png </td><td>  Image suppl√©mentaire (pr√©ciser) </td></tr></tbody></table><br><p>  Les types de cartes suivants sont disponibles: </p><br><ul><li>  <b>Billet d'embarquement:</b> en avion ou en train.  Habituellement, le coupon fonctionne pour un voyage; </li><li>  <b>Coupon:</b> pour les coupons et les offres sp√©ciales; </li><li>  <b>Ticket d'√©v√©nement:</b> peut fonctionner √† la fois pour un √©v√©nement et pour toute une saison; </li><li>  <b>Carte de r√©duction:</b> cartes de fid√©lit√©, cartes de r√©duction ou cartes-cadeaux; </li><li>  <b>Carte vue g√©n√©rale:</b> si aucune des conditions ci-dessus ne s'applique √† votre cas: par exemple, une carte pour voyager en m√©tro ou un laissez-passer pour la salle de sport. </li></ul><br><p>  Consid√©rez sch√©matiquement l'apparence des diff√©rentes cartes.  Les photos sont mieux nomm√©es comme indiqu√© dans le tableau ci-dessus. </p><br><h3>  Carte d'embarquement </h3><br><img src="https://habrastorage.org/webt/8m/s6/cy/8ms6cyz55rve1igxt_xfv2e034i.png"><br><h3>  Coupon </h3><br><img src="https://habrastorage.org/webt/-r/l-/dk/-rl-dknkbsqnkuim5-kqog6ceuu.png"><br><h3>  Ticket d'√©v√©nement </h3><br><img src="https://habrastorage.org/webt/rr/r9/jh/rrr9jh2ho29rfmht7xrf0z7pmes.png"><br><h3>  Carte communautaire </h3><br><img src="https://habrastorage.org/webt/az/zc/hg/azzchgo25cvpj_gcu_oof1vh1k8.png"><br><h3>  Carte de r√©duction </h3><br><img src="https://habrastorage.org/webt/zl/zt/ft/zlztft7igalmerx8rhabnxorwfc.png"><br><h1 id="struktura-passjson">  Structure Pass.json </h1><br><p>  Champs obligatoires.  Contient l'ID de type de passe, l'ID d'√©quipe, le nom de l'organisation, etc. <br>  Cl√©s pour les applications connexes.  N√©cessaire pour afficher les applications qui doivent √™tre "associ√©es" √† la carte. <br>  Cartes cl√©s "date d'expiration". <br>  Cl√©s de pertinence.  Par exemple, les coordonn√©es de la zone o√π la carte peut √™tre utilis√©e, ou le d√©but de l'√©v√©nement auquel elle est destin√©e. <br>  La cl√© est le style.  Au d√©but de l'article, 5 types de cartes pour Wallet √©taient r√©pertori√©s.  Chacun d'eux a son propre style.  Une telle cl√© doit √™tre strictement une. <br>  Cl√©s pour la conception visuelle de la carte.  En plus de l'√©vidence, ils contiennent des informations sur le code-barres affich√© sur la carte. <br>  Cl√©s de service Web.  Vous pouvez utiliser les services Web pour interagir avec la carte, par exemple, la mettre √† jour automatiquement. <br>  Cl√©s NFC.  Contiennent des informations suppl√©mentaires pour les transactions Apple Pay. </p><br><p>  Maintenant sur tout plus en d√©tail. </p><br><h2>  Champs obligatoires </h2><br><table><tbody><tr><th>  <nobr>Cl√© dans JSON</nobr> </th><th>  <nobr>Type de donn√©es</nobr> </th><th>  <nobr>La description</nobr> </th></tr><tr><td>  description </td><td>  String <br>  Localis√© </td><td>  Une br√®ve description de la carte.  Localis√©. </td></tr><tr><td>  formatVersion </td><td>  Int </td><td>  Version du format de fichier.  La valeur doit √™tre 1. </td></tr><tr><td>  <nobr>organizationName</nobr> </td><td>  String <br>  Localis√© </td><td>  Le nom de l'organisation qui d√©livre les cartes. </td></tr><tr><td>  <nobr>passTypeIdentifier</nobr> </td><td>  String </td><td>  Transmettez l'ID de type et le compte d√©veloppeur. </td></tr><tr><td>  <nobr>serialNumber</nobr> </td><td>  String </td><td>  Num√©ro de s√©rie d'une seule carte </td></tr><tr><td>  <nobr>teamIdentifier</nobr> </td><td>  String </td><td>  ID d'√©quipe de l'√©quipe de d√©veloppement </td></tr></tbody></table><br><h2>  Cl√©s pour les applications connexes </h2><br><table><tbody><tr><th>  <nobr>Cl√© dans JSON</nobr> </th><th>  <nobr>Type de donn√©es</nobr> </th><th>  <nobr>La description</nobr> </th></tr><tr><td>  <nobr>associatedStoreIdentifiers</nobr> </td><td>  [Int] </td><td>  En option.  L'ID des applications associ√©es √† la carte.  Le premier qui est compatible avec l'appareil actuel est toujours pris. </td></tr><tr><td>  <nobr>appLaunchURL</nobr> </td><td>  String </td><td>  URL transmise √† l'application √† l'ouverture </td></tr></tbody></table><br><h2>  Touches de style </h2><br><table><tbody><tr><th>  <nobr>Cl√© dans JSON</nobr> </th><th>  <nobr>Type de donn√©es</nobr> </th><th>  <nobr>La description</nobr> </th></tr><tr><td>  <nobr>primaryFields</nobr> </td><td>  [JSON] </td><td>  Informations de base sur la carte. </td></tr><tr><td>  <nobr>domaines secondaires</nobr> </td><td>  [JSON] </td><td>  Informations g√©n√©rales. </td></tr><tr><td>  <nobr>champs auxiliaires</nobr> </td><td>  [JSON] </td><td>  Champs pour des informations suppl√©mentaires.  En option </td></tr><tr><td>  <nobr>headerFields</nobr> </td><td>  [JSON] </td><td>  Le titre de la carte.  Il s'affiche m√™me lorsque les cartes sont visibles dans la liste. </td></tr><tr><td>  <nobr>champs auxiliaires</nobr> </td><td>  [JSON] </td><td>  Informations de base sur la carte. </td></tr><tr><td>  <nobr>transitType</nobr> </td><td>  String </td><td>  Type de transport pour les cartes de ticket.  Il peut prendre les valeurs suivantes: <br>  PKTransitTypeAir, <br>  PKTransitTypeBoat, <br>  PKTransitTypeBu`, <br>  PKTransitTypeGeneric, <br>  `PKTransitTypeTrain`. </td></tr><tr><td>  <nobr>backFields</nobr> </td><td>  [JSON] </td><td>  Tableau des champs responsables du verso de la carte </td></tr></tbody></table><br><p>  JSON dans ce cas a la forme suivante: </p><br><pre><code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"key"</span></span> : <span class="hljs-string"><span class="hljs-string">"value1"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span> : <span class="hljs-string"><span class="hljs-string">"value2"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : <span class="hljs-string"><span class="hljs-string">"value3"</span></span></code> </pre> <br><p>  La valeur par la cl√© de valeur peut √™tre num√©rique ou cha√Æne.  Cependant, currencyCode et la valeur de cha√Æne ne peuvent pas √™tre utilis√©s.  Comme pour les champs auxiliaires et les champs secondaires, il peut y en avoir plusieurs, et vous devez surveiller la longueur des lignes qui y sont utilis√©es. </p><br><h2>  Cl√©s pour la conception visuelle </h2><br><table><tbody><tr><th>  <nobr>Cl√© dans JSON</nobr> </th><th>  <nobr>Type de donn√©es</nobr> </th><th>  <nobr>La description</nobr> </th></tr><tr><td>  <nobr>codes √† barres</nobr> </td><td>  [JSON] </td><td>  Informations sur le code-barres (voir ci-dessous). </td></tr><tr><td>  <nobr>backgroundColor</nobr> </td><td>  couleur comme cha√Æne </td><td>  Couleur d'arri√®re-plan. (# Fa32e4) </td></tr><tr><td>  <nobr>foregroundColor</nobr> </td><td>  couleur comme cha√Æne </td><td>  Couleur d'√©tiquette avec valeurs </td></tr><tr><td>  <nobr>groupingIdentifier</nobr> </td><td>  String </td><td>  Facultatif pour les billets d'√©v√©nement et les billets de transport.  Les cartes du m√™me style - passTypeIdentifier et groupingIdentifier - seront regroup√©es </td></tr><tr><td>  <nobr>labelColor</nobr> </td><td>  couleur comme cha√Æne </td><td>  √âtiqueter le texte avec les noms de champ </td></tr><tr><td>  <nobr>logoText</nobr> </td><td>  Cha√Æne localisable </td><td>  Texte affich√© √† c√¥t√© du logo </td></tr></tbody></table><br><h2>  Code barre </h2><br><p>  La partie la plus importante de la carte.  Un num√©ro d'identification de carte y est cousu (par exemple, un num√©ro de carte physique ou un num√©ro de ticket).  Il est important que le scanner ou tout autre outil soit capable de lire les codes avec l'encodage correct. </p><br><table><tbody><tr><th>  <nobr>Cl√© dans JSON</nobr> </th><th>  <nobr>Type de donn√©es</nobr> </th><th>  <nobr>La description</nobr> </th></tr><tr><td>  <nobr>altText</nobr> </td><td>  String </td><td>  Texte facultatif affich√© √† c√¥t√© du code-barres si le code-barres n'est pas lu. </td></tr><tr><td>  <nobr>format</nobr> </td><td>  String </td><td>  Format de code-barres.  Peut prendre des valeurs: PKBarcodeFormatQR, <br>  PKBarcodeFormatPDF417, <br>  PKBarcodeFormatAztec, <br>  PKBarcodeFormatCode128 </td></tr><tr><td>  <nobr>message</nobr> </td><td>  String </td><td>  Code ou num√©ro de carte crypt√© en code-barres. </td></tr><tr><td>  <nobr>messageEncoding</nobr> </td><td>  String </td><td>  Encodage des messages.  G√©n√©ralement iso-8859-1 </td></tr></tbody></table><br><h2>  Emplacement </h2><br><p>  Ces cl√©s sont responsables de l'emplacement dans lequel la carte peut √™tre utilis√©e. </p><br><table><tbody><tr><th>  <nobr>Cl√© dans JSON</nobr> </th><th>  <nobr>Type de donn√©es</nobr> </th><th>  <nobr>La description</nobr> </th></tr><tr><td>  <nobr>altiture</nobr> </td><td>  String </td><td>  Texte facultatif affich√© √† c√¥t√© du code-barres si le code-barres n'est pas lu. </td></tr><tr><td>  <nobr>latitude</nobr> </td><td>  Longitude </td><td>  Latitude </td></tr><tr><td>  <nobr>longtitude</nobr> </td><td>  Double </td><td>  Latitude </td></tr><tr><td>  <nobr>relevantText</nobr> </td><td>  String </td><td>  Texte facultatif qui appara√Æt sur l'√©cran de verrouillage au moment o√π l'utilisateur entre dans la port√©e de la carte. </td></tr></tbody></table><br><h2>  Face arri√®re </h2><br><p>  Des informations suppl√©mentaires peuvent √™tre plac√©es sur la partie des informations invers√©es: conditions d'utilisation, politique de mise √† jour automatique, coordonn√©es et un lien vers l'application √† laquelle appartient la carte.  La figure montre la correspondance des champs dans pass.json et l'apparence du verso de la carte.  S'il y a des liens, des num√©ros de t√©l√©phone, etc. dans le champ de valeur, ils seront automatiquement mis en surbrillance. </p><br><p><img src="https://habrastorage.org/webt/er/gx/ow/ergxowmbtn08dmjnv2lkrqlo3ku.png"></p><br><h1 id="sozdanie-karty-chast-2">  Cr√©ez une carte.  2e partie </h1><br><p>  Alors, les photos sont pr√™tes, pass.json est form√©, il reste √† tout mettre ensemble.  Pour ce faire, remplissez manifest.json (voir tableau 1), o√π vous devez inclure toutes les images et pass.json.  Il s'av√®re quelque chose comme ceci: </p><br><pre> <code class="hljs go">. . . . . . <span class="hljs-string"><span class="hljs-string">"pass.json"</span></span> = <span class="hljs-number"><span class="hljs-number">303</span></span>c753abc39aa732ec74643d6db28348fe8a823; <span class="hljs-string"><span class="hljs-string">"strip.png"</span></span> = <span class="hljs-number"><span class="hljs-number">736d</span></span>01f84cb73d06e8a9932e43076d68f19461ff; <span class="hljs-string"><span class="hljs-string">"strip@2x.png"</span></span> = <span class="hljs-number"><span class="hljs-number">468f</span></span>a7bc93e6b55342b56fda09bdce7c829d7d46; . . . . . .</code> </pre> <br><p>  A partir de ce moment, rien ne doit √™tre chang√©, car le SHA sera incorrect; en cas de changement, il est n√©cessaire de r√©g√©n√©rer le SHA. </p><br><p>  Ensuite, vous devez cr√©er un ID de type de passe dans le bureau du d√©veloppeur et faire un certificat pour cela.  La proc√©dure doit √™tre plus ou moins famili√®re si vous avez cr√©√© pr√©c√©demment, par exemple, des profils de provisioning. </p><br><img src="https://habrastorage.org/webt/2b/um/hu/2bumhu9wgoawlz1lt-qhieildna.png"><br><p>  Ensuite, acc√©dez au trousseau et exportez √† partir de l√† le certificat de relation de d√©veloppeur Apple (WWDR) au format .pem. </p><br><p><img src="https://habrastorage.org/webt/jg/kk/sl/jgkksl_tfac4e23hz7bk1swxhtq.png"></p><br><p>  √Ä partir de l√†, nous exportons l'ID de type de passe cr√©√© au format .p12.  √Ä ce stade, la femme de m√©nage vous demandera de saisir le mot de passe du certificat.  Dans ce cas, un mot de passe est facultatif. <br>  Veuillez noter que toutes les autres actions doivent √™tre effectu√©es dans un dossier, o√π manifest.json, pass.json et les images doivent d√©j√† se trouver. </p><br><p>  Vous devez maintenant g√©n√©rer une signature, que nous signerons l'archive.  Tout d'abord, exportez l'ID de type de passe et la cl√© en tant que .pem. </p><br><pre> <code class="hljs powershell">openssl pkcs12 <span class="hljs-operator"><span class="hljs-operator">-in</span></span> certificate.p12 <span class="hljs-literal"><span class="hljs-literal">-clcerts</span></span> <span class="hljs-literal"><span class="hljs-literal">-nokeys</span></span> <span class="hljs-literal"><span class="hljs-literal">-out</span></span> passcertificate.pem <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass: your_password</code> </pre> <br><p>  et </p><br><pre> <code class="hljs powershell">openssl pkcs12 <span class="hljs-operator"><span class="hljs-operator">-in</span></span> certificates.p12 <span class="hljs-literal"><span class="hljs-literal">-nocerts</span></span> <span class="hljs-literal"><span class="hljs-literal">-out</span></span> passkey.pem <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass: <span class="hljs-literal"><span class="hljs-literal">-passout</span></span> pass:new_password</code> </pre> <br><p>  Nous sommes maintenant pr√™ts √† g√©n√©rer une signature.  Faisons-en une commande: </p><br><pre> <code class="hljs powershell">openssl smime <span class="hljs-literal"><span class="hljs-literal">-binary</span></span> <span class="hljs-literal"><span class="hljs-literal">-sign</span></span> <span class="hljs-literal"><span class="hljs-literal">-certfile</span></span> WWDR.pem <span class="hljs-literal"><span class="hljs-literal">-signer</span></span> passcertificate.pem <span class="hljs-literal"><span class="hljs-literal">-inkey</span></span> passkey.pem <span class="hljs-operator"><span class="hljs-operator">-in</span></span> manifest.json <span class="hljs-literal"><span class="hljs-literal">-out</span></span> signature <span class="hljs-literal"><span class="hljs-literal">-outform</span></span> DER <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass:___</code> </pre> <br><p>  Donc, tout est pr√™t pour nous, il ne reste plus qu'√† r√©cup√©rer l'archive, nous le faisons avec la commande: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">zip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nameOfPass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pkpass</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">manifest</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">signature</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.png</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span>@<span class="hljs-keyword"><span class="hljs-keyword">2x</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">png</span></span> logo@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png icon.png icon@<span class="hljs-number"><span class="hljs-number">2</span></span>x.png icon@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png</code> </pre> <br><p>  J'attire votre attention sur le fait que tous les fichiers dans lesquels vous souhaitez inclure l'archive de donn√©es pour la carte (.pkpass) doivent √™tre r√©pertori√©s ici. <br>  En cons√©quence, nous obtenons un fichier .pkpass qui peut √™tre ouvert sur l'ordinateur.  Nous verrons un aper√ßu de la carte, dont l'apparence peut diff√©rer de l'apparence sur le t√©l√©phone. <br>  Tout cela peut √™tre fait un peu plus facilement.  Apple fournit l'utilitaire <code>signpass</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemples de m√©triques Apple Wallet</a> ), qui prend en charge tous les calculs SHA (le fichier <code>manifest.json</code> peut √™tre laiss√© seul) et le travail de cr√©ation de signatures.  Pour l'utiliser, vous devez cr√©er un projet et placer le fichier <code>signpass</code> dans un dossier avec toutes les ressources n√©cessaires. </p><br><img src="https://habrastorage.org/webt/tj/jj/eo/tjjjeoqlhxzjumfr3nrg9ve8yhm.png"><br><p>  En g√©n√©ral, la structure devrait ressembler √† ceci: </p><br><img src="https://habrastorage.org/webt/qc/pb/lr/qcpblrbdaw7piffxdehwa1whlpw.png"><br><p>  Ensuite, ex√©cutez la commande: </p><br><pre> <code class="hljs powershell">./signpass <span class="hljs-literal"><span class="hljs-literal">-p</span></span> wallet</code> </pre> <br><p>  Wallet est le nom du dossier dans lequel se trouvent toutes les ressources.  La sortie est wallet.pkpass.  Son contenu peut √™tre consult√© en d√©compressant wallet.pkpass. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">unzip</span></span> wallet.pkpass</code> </pre> <br><p>  Il est possible que la cr√©ation de pkpass soit soumise au backend, auquel cas il sera n√©cessaire de transf√©rer aux d√©veloppeurs WWDR un certificat pour ID de type de passe sous la forme .p12 et un mot de passe pour celui-ci. </p><br><h1 id="integraciya-s-prilozheniem">  Int√©gration d'applications </h1><br><p>  Pour que l'application puisse ajouter des cartes √† Wallet, vous devez activer cette fonctionnalit√© dans l'ID d'application et √©galement activer cette fonctionnalit√© dans les capacit√©s du projet. </p><br><img src="https://habrastorage.org/webt/yq/wo/py/yqwopyfu9nhk-_klilrcoczwe3m.png"><br><img src="https://habrastorage.org/webt/o-/se/ek/o-seekf9zbohe4jmwtcvnzfwes4.png"><br><p>  Ceci est n√©cessaire pour un travail correct et complet avec Wallet.  Sinon, il ne sera pas possible de lire les cartes de Wallet et, par exemple, il ne sera pas possible de comprendre si notre carte est ajout√©e ou non.  Il est √©galement important de noter que l'ID de l'√©quipe dans pass.json doit correspondre √† l'ID de l'√©quipe, sinon vous devrez les ajouter manuellement aux droits d'acc√®s, ce qui peut r√©soudre le probl√®me, mais je n'ai pas v√©rifi√© cela. </p><br><p><img src="https://habrastorage.org/webt/82/ow/p9/82owp9rv4gyaldwm0si77b5nn8m.png"></p><br><h2 id="dobavlenie-karty">  Ajout d'une carte </h2><br><p>  L'ajout de cartes est tr√®s simple: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passPath = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.path(forResource: <span class="hljs-string"><span class="hljs-string">"wallet"</span></span>, ofType: <span class="hljs-string"><span class="hljs-string">"pkpass"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error: <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span> = <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span>(nilLiteral: ()) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passData = <span class="hljs-type"><span class="hljs-type">NSData</span></span>(contentsOfFile: passPath) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pass = <span class="hljs-type"><span class="hljs-type">PKPass</span></span>(data: passData <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">Data</span></span>, error: error) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() passLibrary.addPasses([pass]) { (status) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(passLibrary.containsPass(pass)) }</code> </pre> <br><p>  Cependant, encore une fois, le plus souvent, le fichier .pkpass devra √™tre t√©l√©charg√© √† partir de votre serveur. <br>  Il convient de noter que PassKit g√©n√®re des erreurs assez lisibles, vous pouvez donc facilement comprendre ce qui a √©t√© mal fait. </p><br><h2 id="poluchenie-informacii-o-dobavlennyh-kartah">  R√©cup√©ration d'informations sur les cartes ajout√©es </h2><br><p>  Pour obtenir des informations sur les cartes disponibles dans Wallet et li√©es √† votre application, vous devez vous tourner vers l'objet PKPassLibrary. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passes = passLibrary.passes()</code> </pre> <br><p>  Ainsi, vous pouvez comprendre si la carte est ajout√©e ou non, ainsi que mettre √† jour l'interface.  De plus, via PKPassLibrary, les cartes peuvent √™tre mises √† jour et supprim√©es.  Les cartes peuvent √©galement √™tre mises √† jour via des services Web, mais dans cet article, nous ne consid√©rerons pas une telle option. </p><br><h1 id="proverka-na-unikalnost">  Contr√¥le d'unicit√© </h1><br><p>  √âtant donn√© que dans votre service, en r√®gle g√©n√©rale, la carte est li√©e √† un compte, dans l'application, vous devrez probablement d√©terminer en quelque sorte si la carte appartient √† l'utilisateur actuel.  Je sugg√®re de le faire via <code>serialNumber</code> .  Par exemple, d√©finissez l'ID <code>serialNumber</code> de l'utilisateur ou du num√©ro de carte. </p><br><h1 id="testirovanie">  Test </h1><br><p>  Apple fournit des exemples de pkpass pour diff√©rents types, vous pouvez vous concentrer sur eux. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âchantillons de portefeuille Apple</a> <br>  Pour voir √† quoi ressemble la carte, vous pouvez ajouter pkpass au projet (voir ¬´Ajouter une carte¬ª).  Le processus d'ajout / suppression est d√©j√† discut√© ci-dessus, il ne reste plus qu'√† rappeler que l'application ne verra pas les cartes d√©j√† ajout√©es si la carte pour Wallet a √©t√© cr√©√©e sur le compte d'un d√©veloppeur et que le d√©veloppement lui-m√™me a √©t√© effectu√© √† partir d'un autre compte (pertinent pour les soci√©t√©s d'externalisation).  Dans ce cas, vous pouvez ajouter des cartes sans probl√®me. <br>  Vous pouvez v√©rifier si les informations du code-barres sont correctement encod√©es √† l'aide d'un scanner de code QR.  Et il est absolument n√©cessaire de v√©rifier l'exactitude du travail avec ce scanner. </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  L'article a examin√© le processus de cr√©ation et de conception d'une carte, ainsi que le processus d'int√©gration avec l'application et les probl√®mes qui peuvent survenir.  Je n'ai intentionnellement pas abord√© les probl√®mes d'int√©gration avec les services Web et les mises √† jour de cartes, et j'esp√®re le faire dans le prochain article. </p><br><h1 id="ispolzuemye-materialy">  Mat√©riaux utilis√©s: </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Creating.html</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Reference/PassKit_Bundle/Chapters/TopLevel.html#//apple_ref/doc/uid/TP40012026-CH2-SW3</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://itechroof.wordpress.com/2015/11/30/apple-wallet-part-13/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Updating.html</a> </p><br><p>  Un merci sp√©cial √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">mehdzor</a> pour le compte d√©veloppeur pour les tests. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428437/">https://habr.com/ru/post/fr428437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428423/index.html">Comment un accord de 34 milliards de dollars entre IBM et Red Hat va changer le march√© informatique: experts et analystes</a></li>
<li><a href="../fr428429/index.html">GOST R 34.10 signature √©lectronique de documents PDF dans la suite bureautique LibreOffice</a></li>
<li><a href="../fr428431/index.html">Plus que des couches concentriques</a></li>
<li><a href="../fr428433/index.html">Avocats testeurs priv√©s</a></li>
<li><a href="../fr428435/index.html">Que lire en PHP en russe?</a></li>
<li><a href="../fr428439/index.html">Sans ensemble</a></li>
<li><a href="../fr428441/index.html">Achat GitHub termin√©. Que se passera-t-il ensuite?</a></li>
<li><a href="../fr428443/index.html">R√©conciliation - v√©rification de l'int√©grit√© des donn√©es dans les syst√®mes distribu√©s</a></li>
<li><a href="../fr428445/index.html">Comment nous avons fait un hackathon √† Helsinki et perdu</a></li>
<li><a href="../fr428447/index.html">Cloud Data Protection: A Guide for Developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>