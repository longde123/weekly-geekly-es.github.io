<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë• üéÖüèΩ üÜé ShIoTiny: pequena automa√ß√£o, a Internet das coisas ou "seis meses antes das f√©rias" üëàüèΩ üóª ‚úãüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pontos principais ou sobre o que √© este artigo 


 Como os interesses das pessoas s√£o diferentes, e as pessoas t√™m pouco tempo, ent√£o brevemente sobre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ShIoTiny: pequena automa√ß√£o, a Internet das coisas ou "seis meses antes das f√©rias"</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463107/"><br><img src="https://habrastorage.org/webt/op/yn/2p/opyn2pdqpdygsj93bqeqbyhuv6i.jpeg"><br><br><h4 id="osnovnye-tezisy-ili-o-chem-eta-statya">  Pontos principais ou sobre o que √© este artigo </h4><br><p>  Como os interesses das pessoas s√£o diferentes, e as pessoas t√™m pouco tempo, ent√£o brevemente sobre o conte√∫do do artigo. </p><br><p>  <strong>Este</strong> artigo √© uma vis√£o geral do projeto do controlador com um pre√ßo m√≠nimo e a possibilidade de <strong>programa√ß√£o visual</strong> atrav√©s de um navegador WEB. </p><br><p>  Como este √© um artigo de revis√£o que visa mostrar "o que voc√™ pode extrair de um controlador centavo", n√£o deve procurar verdades profundas e algoritmos detalhados nele. </p><br><p>  <strong>A</strong> motiva√ß√£o, id√©ias e resultados da constru√ß√£o de um controlador baseado no chip Wi-Fi ESP8266 s√£o considerados. </p><a name="habracut"></a><br><h4 id="ipreduprezhdeniei">  <i>Advert√™ncia</i> </h4><br><p>  <i>Eu n√£o queria escrever este artigo.</i>  <i>N√£o sou f√£ de escrever artigos.</i>  <i>√â necess√°rio pensar e al√©m disso - muito.</i>  <i>Pensar em escrever para minimizar o n√∫mero de mal-entendidos.</i>  <i>Pensar em como n√£o ir ao extremo.</i>  <i>E muito mais para pensar.</i> <i><br></i>  <i>Mas os amigos disseram que, como meus esfor√ßos no campo da IoT e outras pequenas automa√ß√µes s√£o interessantes para eles, eles podem ser interessantes para outras pessoas para o p√∫blico em geral.</i>  <i>Bem, para onde vai o p√∫blico que est√° interessado nisso?</i>  <i>Claro, em um habr.</i>  <i>E aqui estou eu.</i>  <i>Leitor antigo e novo escritor.</i> <i><br><br></i>  <i>Por erros, imprecis√µes, erros de digita√ß√£o, estilo n√£o moderno de apresenta√ß√£o etc. que o leitor possa n√£o gostar, n√£o tenho nenhuma responsabilidade.</i>  <i>Leia por sua conta e risco.</i> <i><br><br></i>  <i>Tamb√©m aviso imediatamente que n√£o explicarei quais multicast MQTT, WiFi e UDP e outras coisas que n√£o est√£o diretamente relacionadas ao t√≥pico.</i>  <i>Alguns links est√£o no final do artigo.</i> </p><br><h4 id="rozhdenie-idei-ili-nemnogo-liriki">  O nascimento de uma ideia ou de algumas letras </h4><br><p>  Bem, a vida n√£o √© uma coisa simples, e Sua Majestade Chance desempenha um papel importante nela.  Ent√£o, quero compartilhar como eventos aleat√≥rios, multiplicados por pregui√ßa regular, resultaram em um design de controlador bastante interessante, baseado no ESP8266. </p><br><p>  Tudo come√ßou de maneira casual: eu queria construir um sistema de controle para o sistema de abastecimento de √°gua e regar os canteiros do pa√≠s. </p><br><p>  <strong>Mas</strong> , como eu posso me envolver totalmente em guindastes de tubos-tanque apenas nas f√©rias, antes dos quais houve mais de seis meses - tudo se limitava √† discuss√£o no trabalho com colegas e amigos-camaradas em um ambiente informal. </p><br><p>  <strong>O</strong> t√≥pico "pequena automa√ß√£o" ou, como √© habitual dizer "esses alunos da escola-hacker-hacker" - o t√≥pico da IoT - a Internet das coisas - tem sido interessante para mim h√° muito tempo.  Muito antes do advento da Internet, como tal, em uso generalizado. </p><br><p>  Mesmo na inf√¢ncia, eu queria que as coisas fizessem algo "elas mesmas".  E √© desej√°vel que eu possa control√°-los de alguma maneira √† dist√¢ncia.  Mas naquela √©poca (anos 80, in√≠cio dos anos 90 do √∫ltimo mil√™nio) isso era dif√≠cil.  A Internet n√£o estava amplamente dispon√≠vel em nenhum lugar do mundo, pois n√£o havia lugar algum, telefones celulares, tablets e at√© telas de LCD e unidades flash USB.  Ent√£o eu tive que me limitar a "interruptores de luz no aplauso" e aos mais simples controles remotos por r√°dio.  Mas para aqueles tempos e essa idade, era agrad√°vel e interessante. </p><br><p>  <strong>Mas</strong> este √© o passado.  Nonche no p√°tio do s√©culo XXI.  E todo mundo tem um smartphone no bolso, a Internet est√° quase em toda parte, onde √© necess√°rio e n√£o necess√°rio, e o banco de dados de componentes eletr√¥nicos dispon√≠veis agora √© tal que h√° 15 anos o habitante comum do planeta Terra nem sequer sonhava com isso. </p><br><p>  Portanto, tendo decidido moldar um controlador para assuntos de √°gua no pa√≠s, voltei meus olhos para o chip ESP8266. <br>  Primeiro, esse chip √© barato.  E se um controlador n√£o for suficiente - voc√™ pode colocar dois, tr√™s ou cinco.  Em segundo lugar, possui Wi-Fi a bordo.  Ou seja, voc√™ pode assistir o que acontece via Internet e at√© controlar o processo a partir de qualquer smartphone.  Obviamente, voc√™ precisa de um ponto de acesso com acesso √† Internet, mas isso n√£o √© um problema.  Enfim, est√° quase em todo lugar, ou est√° prestes a estar, inclusive - e na minha casa de campo. </p><br><p>  Tendo mergulhado no maravilhoso mundo dos projetos para o ESP8266, fiquei surpreso ao descobrir que, apesar das impressionantes capacidades deste chip, os projetos nele, com raras exce√ß√µes, s√£o divididos em dois tipos: programas extremamente primitivos como ‚Äúclique nos rolos de um smartphone e veja o estado‚Äù sensor de temperatura via Internet ‚Äù;  ou int√©rpretes bons e s√≥lidos de JavaScript ou Lua, mas, infelizmente, consomem quase toda a mem√≥ria e n√£o permitem que voc√™ fa√ßa algo s√©rio. </p><br><p>  Minha primeira ideia foi t√£o simples quanto uma panqueca - escrever um programa simples de controle de bomba com base no estado dos sensores e isso √© tudo.  Mas, como um kalach ralado em termos de introdu√ß√£o de sistemas diferentes, percebi que n√£o seria capaz de prever todas as curvas do algoritmo que gostaria ou precisaria endireitar durante a constru√ß√£o do sistema de irriga√ß√£o de abastecimento de √°gua. </p><br><p>  <strong>D</strong> elaborar o programa no pa√≠s, em um celeiro escuro - n√£o √© muito conveniente.  E voc√™ precisa. <br>  Qual √© a sa√≠da?  Obviamente, a primeira coisa que me veio √† mente foi tornar o algoritmo personaliz√°vel.  Um dos meus colegas deu muitos conselhos - o que configurar e como.  Com isso, ele cortou minha primeira ideia pela raiz.  Gra√ßas a ele.  Se ele n√£o tivesse implantado diante de meus olhos o n√∫mero de par√¢metros que eu precisaria configurar, provavelmente n√£o recusaria esta op√ß√£o: crie uma p√°gina de configura√ß√µes de algoritmos. </p><br><p>  <strong>Mas</strong> uma imagem aterradora do n√∫mero de par√¢metros de sintonia e at√© de influenciar uns aos outros me deixou s√≥bria.  Mais uma vez, percebi que nada poderia ser previsto ... </p><br><p>  Farei uma reserva imediatamente: sou pregui√ßoso.  Muito pregui√ßoso!  Estou francamente com pregui√ßa de reescrever o programa todas as vezes.  Portanto, surgiu a tarefa - como definir r√°pida e facilmente um algoritmo, de prefer√™ncia sem programa√ß√£o?  Al√©m disso, esse algoritmo ser√° bastante complicado;  ter√° muitos par√¢metros;  Ser√° individual para o meu caso e inadequado para outros.  E eu realmente quero tornar o dispositivo mais ou menos universal ... </p><br><p>  Como ainda faltavam seis meses para as f√©rias e todo o trabalho de canos, decidi dedicar um tempo para pensar: como torn√°-lo conveniente e bonito?  Como programar sem programa√ß√£o?  Como ficar sem um trilh√£o de par√¢metros que podem ser alterados durante a configura√ß√£o? </p><br><p>  Como sempre, tudo j√° foi pensado diante de n√≥s: percebi que desejo desenhar um algoritmo na forma de quadrados de a√ß√£o e conect√°-los a linhas de comunica√ß√£o que mostram de onde e de onde os dados est√£o vindo.  Bem, cutucando a caixa, quero poder configurar alguns de seus par√¢metros individuais. </p><br><p>  <strong>E o</strong> ato de definir o algoritmo, desenh√°-lo com quadrados, n√£o √© novo.  Tais sistemas estavam de volta nos anos 80;  existe um sistema NodeRed super popular que √© bem conhecido daqueles que j√° aderiram ao mundo da pequena automa√ß√£o / IoT. </p><br><p>  <strong>Mas</strong> isso √© azar: esses sistemas s√£o projetados para "PCs grandes".  Na pior das hip√≥teses, no PI de framboesa.  Mas de maneira alguma no ESP8266, que possui apenas algumas dezenas de kilobytes de RAM e n√£o existe sistema operacional! </p><br><p>  Como ser  E existem apenas duas maneiras: gravar um programa em um "PC grande" ou laptop e transferi-lo de alguma forma para o ESP8266 ou tentar "amontoar o indesej√°vel" no pr√≥prio controlador do ESP8266. </p><br><p>  Portanto, o programa m√°ximo que tive foi o seguinte: para programar seu controlador, n√£o h√° necessidade de nada, exceto um laptop com um navegador WEB!  Ou seja, um laptop com um navegador WEB e meu controlador - isso deve ser o suficiente para configurar totalmente e escrever e desenhar programas de controle. </p><br><p>  <strong>E</strong> , como se viu, era bem poss√≠vel perceber isso! <br>  N√£o vou aborrec√™-lo com todos os detalhes do desenvolvimento do projeto.  S√≥ posso dizer que, com base nas palavras que vieram √† minha mente e √† linguagem durante o processo de desenvolvimento, seria poss√≠vel compilar um ‚Äú <em>Dicion√°rio de Profana√ß√£o de Trabalhadores Eletr√¥nicos</em> ‚Äù separado.  Mas tudo est√° para tr√°s.  Mais precisamente, n√£o todos, mas o primeiro est√°gio mais dif√≠cil, quando n√£o est√° claro - sua id√©ia ser√° viver ou √© apenas um absurdo um castrado cinza em uma noite de luar. </p><br><p>  <strong>Vou</strong> compartilhar o resultado do que saiu e √© chamado de <b>"Controlador ShIoTiny"</b> . </p><br><h4 id="i-chto-zhe-vyshlo">  E o que aconteceu? </h4><br><p>  <b>O hardware do</b> controlador ShIoTiny √© padr√£o e simples: tr√™s entradas projetadas para sensores de contato seco (bot√µes, chaves reed, tamb√©m s√£o sensores de n√≠vel de √°gua no tanque), uma entrada ADC, uma entrada para conectar um sensor de temperatura e umidade como DHT22 ou similar .  E, finalmente, tr√™s sa√≠das na forma de rel√©s de comuta√ß√£o para 220V, 1 Amp.  O rel√© diz 10A, mas sou realista e n√£o os deixo passar pela placa de amplificador 10A.  E controlar as entradas das bombas e 1 Amp √© suficiente.  Tudo isso √© alimentado por uma fonte de energia com uma voltagem de 5 a 9 volts. </p><br><p>  Obviamente, adicionei o sensor de temperatura exatamente como ‚ÄúSchaub was‚Äù, mas no ADC havia esperan√ßas de medir a tens√£o da rede el√©trica.  Isso n√£o √© suficiente? </p><br><p>  Obviamente, todas as entradas, exceto a entrada para conectar o DHT22, t√™m prote√ß√£o contra resistores e diodos: eu n√£o desejava queimar o ESP8266, e os diodos e resistores custam apenas alguns centavos. </p><br><p>  <strong>Uma foto do</strong> produto final pode ser vista no in√≠cio do artigo.  Encomendei v√°rias dessas pranchas - e se eu a queimar ou terei que cortar os caminhos e as pernas? <br>  Mas, felizmente - n√£o precisava. </p><br><p>  <strong>O</strong> produto √©, obviamente, beleza e grandeza.  Mas, por conveni√™ncia, a seguir √© apresentado um diagrama da conex√£o com os simuladores de placa de sensores e atuadores. </p><br><br><img src="https://habrastorage.org/webt/_v/qm/_k/_vqm_kjyjzpgxqvsqzjte7ct6y8.jpeg"><br><br><p>  <strong>No</strong> lugar dos sensores de n√≠vel - bot√µes Entrada1..3, em vez de partidas - LEDs conectados ao rel√© Rel√©1..3.  Bem, um resistor vari√°vel no ADC para simular a tens√£o de entrada. <br>  Quando o rel√© est√° desligado, o LED vermelho acende.  E quando ligado - verde.  Ent√£o eu depurei na mesa. </p><br><p>  Al√©m de tudo isso, h√° um conector de alimenta√ß√£o √† esquerda da placa e dois bot√µes de servi√ßo √† direita: Reset e AP.  Bem, um interruptor DIP que coloca o dispositivo no modo de programa√ß√£o.  O conector de programa√ß√£o ESP8266 via adaptador USB-UART tamb√©m est√° dispon√≠vel. </p><br><p>  <strong>Algumas explica√ß√µes para os bot√µes.</strong>  O que √© <strong>Reset</strong> - e, portanto, fica claro.  Mas o bot√£o <strong>AP</strong> √© necess√°rio para colocar o <strong>ShIoTiny</strong> no modo de ponto de acesso aberto (modo de configura√ß√£o ou modo de configura√ß√£o).  Por que isso √© necess√°rio?  Bem, por exemplo, voc√™ estragou as configura√ß√µes de rede e deseja alter√°-las.  Pressione o bot√£o AP por alguns segundos (at√© que o lindo LED azul acenda).  Em seguida, pegue seu smartphone ou laptop, ligue o Wi-Fi e veja um ponto de acesso aberto com o nome esp_8266_xxxx e conecte-se a ele.  Em seguida, v√° para o navegador do seu smartphone ou laptop e digite a barra de endere√ßo: 192.168.4.1.  Se tudo estiver em ordem, voc√™ ser√° direcionado para a p√°gina do controlador ShIoTiny e poder√° configur√°-lo de uma nova maneira. </p><br><p>  <strong>Como</strong> vemos, o hardware n√£o √© nada complicado.  Portanto, sobre a <strong>parte</strong> do <strong>software</strong> . </p><br><p>  <strong>Em</strong> todos os saltos de implementa√ß√£o, descreverei, mas depois.  Algum dia.  E hoje vou considerar o software apenas "fora", ou seja, do ponto de vista do usu√°rio - eu ou outro, que se arriscou a usar o meu of√≠cio (existem acrobacias). </p><br><p>  <strong>Do</strong> ponto de vista do usu√°rio, o dispositivo √© um servidor HTTP acess√≠vel via WiFi.  Todas as configura√ß√µes, programa√ß√£o e assim por diante - s√£o feitas usando um navegador WEB. </p><br><p>  <strong>E</strong> assim, fomos para a p√°gina do controlador.  O que n√≥s vemos?  E vemos a aba ‚ÄúControle e status‚Äù, que mostra o status atual dos dispositivos utilizados: entradas, sa√≠das, ADC, DHT22.  Al√©m disso, os par√¢metros de conex√£o ao ponto de acesso s√£o mostrados (se trabalharmos no modo de uma esta√ß√£o WiFi);  configura√ß√µes do ponto de acesso (se trabalharmos no modo de ponto de acesso WiFi) ou ambos.  Al√©m disso, os par√¢metros de conex√£o com o broker MQTT s√£o mostrados se o protocolo MQTT for usado. </p><br><br><img src="https://habrastorage.org/webt/lm/02/tw/lm02twe6qzwhrrby1v9jhf8alb8.jpeg"><br><br><p>  <strong>Para</strong> ver, nada de especial e interessante.  N√£o h√° nada para pressionar!  Embora ... Existem mais duas abas!  Definindo as configura√ß√µes de rede A <strong>rede</strong> e os esquemas do diagrama do editor <strong>ElDraw</strong> . </p><br><p>  Voc√™ adivinhou, o <strong>Networking</strong> est√° configurando uma rede, mas n√£o apenas isso.  Tem alguns par√¢metros mais interessantes.  ‚ÄúPicar‚Äù na guia <strong>Rede</strong> e ver aproximadamente o que √© mostrado na figura. <br>  Configurando o nome e a senha do ponto de acesso para cada um dos modos - esta√ß√µes WiFi e pontos de acesso WiFi.  Tudo parece estar claro.  Assim como o objetivo do <strong>bot√£o Scan WiFi,</strong> √© totalmente transparente. <br>  <strong>Mas</strong> a lista suspensa <strong>"Modo ShIoTiny"</strong> requer esclarecimentos.  O fato √© que eu n√£o conseguia decidir em que modo seria mais conveniente trabalhar.  E, portanto, previsto para 5 modos de opera√ß√£o do dispositivo. </p><br><br><img src="https://habrastorage.org/webt/kd/s_/hh/kds_hhoiybre9ivtlr1kl1peh24.png"><br><br><p>  Listamos brevemente esses modos de opera√ß√£o. </p><br><p>  <strong>Modo de</strong> configura√ß√£o - modo de configura√ß√£o.  Este √© o modo de ponto de acesso aberto com um endere√ßo fixo 192.168.4.1 e o nome esp_8266_xxxx. </p><br><p>  <strong>Modo esta√ß√£o</strong> - o modo da esta√ß√£o WiFi conectada ao seu ponto de acesso. </p><br><p>  <strong>Modo AP</strong> - modo de ponto de acesso fechado.  Voc√™ mesmo define o nome e a senha. </p><br><p>  <strong>O modo AP + Esta√ß√£o</strong> √© a inclus√£o simult√¢nea do modo AP + modo Esta√ß√£o. </p><br><p>  <strong>Modo √∫nico</strong> - trabalhe sem conectar-se √† rede.  Um controlador solit√°rio carregando sua parte pesada ... </p><br><p>  <strong>Em</strong> qualquer um dos modos, exceto no <strong>"Modo de configura√ß√£o"</strong> , voc√™ pode bloquear a p√°gina WEB marcando a caixa de sele√ß√£o <strong>"Bloquear Web no modo de esta√ß√£o"</strong> .  Este √© um tipo por raz√µes de seguran√ßa. </p><br><p>  <strong>As</strong> configura√ß√µes s√£o √≥bvias para o MQTT: servidor, porta, senha, conex√£o aberta ou <strong>SSL</strong> .  N√£o vou morar aqui em detalhes. </p><br><p>  Al√©m de tudo o mais, o controlador ShIoTiny pode enviar e receber pacotes em um formato especial para multicast.  Suas configura√ß√µes tamb√©m s√£o √≥bvias: endere√ßo e porta do grupo. <br>  Obviamente, se voc√™ descrever todas as nuances das configura√ß√µes, receber√° um artigo separado, mas isso n√£o est√° inclu√≠do nos meus planos. </p><br><p>  <strong>E</strong> assim, com a guia <strong>Rede</strong> , tudo fica mais ou menos claro.  Vamos seguir para o recurso principal do controlador - o <strong>editor do</strong> programa <strong>ElDraw</strong> . </p><br><p>  Ao tocar na guia ElDraw, vemos algo como o seguinte.  Obviamente, se o dispositivo n√£o tiver um circuito carregado, o campo do circuito estar√° vazio. </p><br><br><img src="https://habrastorage.org/webt/hr/on/kc/hronkcmousbzptjr1olyag1whbk.png"><br><br><p>  <strong>√Ä</strong> esquerda, h√° uma paleta de elementos ou n√≥s (n√≥s). <br>  <strong>√Ä</strong> direita, um campo de diagrama ou simplesmente um "diagrama". <br>  <strong>Dos</strong> bot√µes superiores para carregar e descarregar no disco e no dispositivo, al√©m dos bot√µes para edi√ß√£o. </p><br><p>  <strong>Para</strong> quem trabalhou com editores, o gerenciamento geralmente √© √≥bvio.  Precisamos adicionar um elemento ao diagrama - pegue-o com o mouse e arraste-o da paleta para o diagrama.  √â necess√°rio remover o elemento ou link do diagrama - cutucar nele ou sobre ele com o mouse e pressionar a tecla <strong>DEL</strong> .  Precisamos conectar os elementos - pegamos a entrada de um elemento e a conectamos √† sa√≠da de outro. </p><br><p>  <strong>Ainda h√°</strong> redimensionamento (SHIFT + roda do mouse).  Infelizmente, n√£o h√° como copiar elementos e grupos de elementos.  Mas isso n√£o interfere muito. </p><br><p>  <strong>Al√©m</strong> disso, por raz√µes de l√≥gica, a entrada de um n√≥ pode ser conectada apenas a uma sa√≠da de outro n√≥.  Mas a sa√≠da do n√≥ √© com v√°rias entradas de outros n√≥s.  As entradas est√£o sempre √† esquerda dos n√≥s.  As sa√≠das est√£o sempre √† direita. </p><br><p>  <strong>Quais</strong> recursos temos para implementar algoritmos? <br>  <strong>Em</strong> oportunidades - bastante extensa.  A paleta cont√©m n√≥s que representam todo o hardware do controlador <strong>ShIoTiny</strong> : entradas, rel√©s, ADCs, DHT11 / 22. </p><br><p>  Existem n√≥s l√≥gicos e aritm√©ticos para processamento de dados. </p><br><p>  Para que possamos trabalhar com o dispositivo via Internet, existem n√≥s para assinar e publicar par√¢metros no broker do MQTT. </p><br><p>  Se quisermos que v√°rios controladores ShIoTiny troquem informa√ß√µes entre si - voc√™ pode usar os n√≥s para transmitir e receber par√¢metros usando o protocolo UDP multicast. </p><br><p>  <strong>Para</strong> este rum, existem n√≥s de timer;  n√≥s de controle de gerenciamento de eventos. </p><br><p>  <strong>Vou</strong> dar alguns exemplos.  Por exemplo, voc√™ deseja que os dados de temperatura e umidade sejam publicados a cada 30 minutos em um servidor MQTT?  N√£o h√° nada mais f√°cil.  Desenhe assim. </p><br><br><img src="https://habrastorage.org/webt/gf/bu/op/gfbuopoey6qqzbgtglgqm14otme.jpeg"><br><br><p>  <strong>Bem</strong> bot√£o meme "Upload".  Isso √© tudo! <br>  Se voc√™ configurou corretamente a conex√£o com o broker MQTT na guia Rede, √© tudo! <br>  A cada meia hora, a temperatura ser√° publicada no intermedi√°rio no t√≥pico / T e umidade - no t√≥pico / H.  Ou, se voc√™ perguntar os nomes dos t√≥picos, abaixo deles. <br>  Pergunta: Por que 18.000 30 minutos?  Porque todos os tempos s√£o medidos em d√©cimos de segundo. </p><br><p>  Agora voc√™ deseja adicionar a este circuito a capacidade de ativar o rel√© 1 via Internet, e mesmo por um certo tempo?  N√£o √© um problema.  Desenhe assim. </p><br><br><img src="https://habrastorage.org/webt/mb/ai/l6/mbail6skmkridba4jx6zhnvpjng.png"><br><br><p>  <strong>Cerca de</strong> cinco, clique no bot√£o "Upload".  Isso √© tudo!  Agora, al√©m do fato de que a cada meia hora, temperatura e umidade ser√£o publicadas no broker do MQTT, ser√° poss√≠vel ativar o rel√© Relay1.  Sim, n√£o apenas ligue-o, mas por exatamente 10 minutos.  Voc√™ pode ativar o rel√© publicando o t√≥pico / r1cmd, definido como 1. E o estado real do rel√© ser√° publicado no t√≥pico / r1status. </p><br><p>  Quero n√£o apenas ligar, mas tamb√©m desligar o rel√© antes do tempo?  Sim, como voc√™ diz.  A figura abaixo mostra como faz√™-lo! </p><br><br><img src="https://habrastorage.org/webt/nq/nm/qz/nqnmqznqcj9ia1tco5tumywbblg.png"><br><br><p>  O princ√≠pio est√° claro?  Voc√™ acabou de desenhar o algoritmo com o mouse!  E escreva algumas configura√ß√µes: hora, nome do t√≥pico e tudo.  Isso √© muito mais claro do que escrever um monte de c√≥digo. </p><br><p>  <strong>A prop√≥sito</strong> , destacar links em cores diferentes n√£o √© um "photoshop" - essa √© uma das fun√ß√µes do editor.  Voc√™ pode colorir os links como desejar, para n√£o confundi-los. </p><br><p>  <strong>Mas</strong> oh e isso n√£o √© tudo!  Para depurar o algoritmo, existe um bot√£o "Monitor start".  Por mais estranho que pare√ßa, ele liga o modo "monitor".  Nesse modo, o estado de todas as sa√≠das de todos os n√≥s √© lido periodicamente no controlador <strong>ShIoTiny</strong> e exibido no circuito.  Aproximadamente como na figura abaixo. </p><br><br><img src="https://habrastorage.org/webt/av/zo/ev/avzoevodxkpmwylcw2da2tzqicq.png"><br><br><p>  Ou seja, podemos ver em "quase tempo real" o que temos na entrada e na sa√≠da de cada n√≥.  Ajuda muito quando algo n√£o est√° claro. </p><br><p>  <strong>Ainda h√°</strong> muitos "chips e recursos" que gostaria de descrever, e minha consci√™ncia n√£o permitir√° que voc√™ gaste seu tempo com eles em um artigo.  A principal id√©ia realizada j√° est√° clara: um m√≠nimo de par√¢metros configur√°veis ‚Äã‚Äã- um m√°ximo de visibilidade. </p><br><h4 id="lozhka-degtya">  Voar na pomada </h4><br><p>  Claro, quero que n√£o haja mosca na pomada, mas o mundo n√£o √© perfeito.  Meu editor e meu controlador n√£o s√£o perfeitos.  Encontrei duas caracter√≠sticas principais que ainda n√£o consegui eliminar. </p><br><p>  Em primeiro lugar, √†s vezes ocorrem falhas durante o movimento de elementos do grupo.  Mas isso n√£o interfere muito no trabalho.  "",  "". </p><br><p> <strong></strong> , -,          ¬´Upload¬ª,  .    ,     . </p><br><h4 id="zaklyuchenie">  Conclus√£o </h4><br><p> <strong></strong> ,      ,  ,   .    ,         . </p><br><p> <strong></strong> , -,      .     . <br> <strong></strong>   ,                    ¬´ ¬ª. <br> <strong></strong>         ‚Äî   : <strong>shiotiny@yandex.ru</strong> </p><br><p> <strong></strong>      ,  , ,  . </p><br><p> <strong></strong>   ,   . </p><br><h4 id="ssylki-otsylki-i-posylki"> ,    </h4><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  ShIoTiny</a> </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ESP8266</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">WiFi</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MQTT</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">UDP Multicast</a> </p><br><h4 id="po-prosbam-trudyaschihsya">    </h4><br><p> <strong></strong>      (). </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/shiotiny/ShIoTinyBin</a> </p><br><p> : <a href="">https://github.com/shiotiny/ShIoTinyBin/blob/master/bin/esp-07-shiotiny.bin</a> </p><br><p> : <a href="">https://github.com/shiotiny/ShIoTinyBin/blob/master/doc/esp-07-shiotiny.png</a> </p><br><p>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/shiotiny/ShIoTinyBin/blob/master/doc/ShIoT-esp8266-01_obzor.pdf</a> </p><br><p>  " "  . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt463107/">https://habr.com/ru/post/pt463107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt463095/index.html">Por que n√£o SQL?</a></li>
<li><a href="../pt463097/index.html">Go Product Development: Um Hist√≥rico do Projeto</a></li>
<li><a href="../pt463099/index.html">1000 e 1 feedback. Como dar feedback e ensinar aos outros, a experi√™ncia Lamoda</a></li>
<li><a href="../pt463101/index.html">Gerenciando centenas de servidores para teste de carga: dimensionamento autom√°tico, monitoramento personalizado, cultura DevOps</a></li>
<li><a href="../pt463105/index.html">Meu quarto dia com o Haiku: problemas de instala√ß√£o e inicializa√ß√£o</a></li>
<li><a href="../pt463113/index.html">Controle de vers√£o de dados e modelos no encontro do Computer Vision</a></li>
<li><a href="../pt463115/index.html">A quest√£o das portas no design dos atiradores</a></li>
<li><a href="../pt463117/index.html">Pr√©-carregando no PHP 7.4</a></li>
<li><a href="../pt463121/index.html">N√≥s comemos o elefante em partes. Exemplo de estrat√©gia de monitoramento de integridade de aplicativos</a></li>
<li><a href="../pt463123/index.html">Biblioteca de gerador de c√≥digo Assembler para microcontroladores AVR. Parte 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>