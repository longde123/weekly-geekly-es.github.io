<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>тмЬя╕П ЁЯСйЁЯП╗тАНЁЯдЭтАНЁЯСиЁЯП╜ ЁЯП┤ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдпреВ-рдиреЗрдЯ рдХреЗ рдЧреБрдгреЛрдВ рдХрд╛ рдПрдХ рдЫреЛрдЯрд╛ рдЕрдзреНрдпрдпрди, рд╡рд┐рднрд╛рдЬрди рдХреЗ рд▓рд┐рдП рдПрдХ рдХреНрд▓рд╛рд╕рд┐рдХ рджреГрдврд╝ рдиреЗрдЯрд╡рд░реНрдХ ЁЯРЖ ЁЯЪ▓ тЫкя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд▓реЗрдЦ рд╕рдореБрджреНрд░ рдореЗрдВ рдЬрд╣рд╛рдЬреЛрдВ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдФрд░ рдЕрдзреНрдпрдпрди рдкрд░ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИред 



 рдЖрдЗрдП рд╕рдордЭрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХ рдХреИрд╕реЗ рдФрд░ рдХреНрдпрд╛ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдпреВ-рдиреЗрдЯ рдХреЗ рдЧреБрдгреЛрдВ рдХрд╛ рдПрдХ рдЫреЛрдЯрд╛ рдЕрдзреНрдпрдпрди, рд╡рд┐рднрд╛рдЬрди рдХреЗ рд▓рд┐рдП рдПрдХ рдХреНрд▓рд╛рд╕рд┐рдХ рджреГрдврд╝ рдиреЗрдЯрд╡рд░реНрдХ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ods/blog/431512/">  рд▓реЗрдЦ рд╕рдореБрджреНрд░ рдореЗрдВ рдЬрд╣рд╛рдЬреЛрдВ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдФрд░ рдЕрдзреНрдпрдпрди рдкрд░ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИред <br><br><img src="https://habrastorage.org/webt/mu/kx/gb/mukxgbd0ziyg5hpxyf_ijb06yz0.png" alt="рдЫрд╡рд┐"><br><br>  рдЖрдЗрдП рд╕рдордЭрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХ рдХреИрд╕реЗ рдФрд░ рдХреНрдпрд╛ рдЦреЛрдЬ рд░рд╣рд╛ рд╣реИ рдФрд░ рдпрд╣ рдХреНрдпрд╛ рдкрд╛рддрд╛ рд╣реИред  рдпрд╣ рд▓реЗрдЦ рдХреЗрд╡рд▓ рдЬрд┐рдЬреНрдЮрд╛рд╕рд╛ рдФрд░ рдирд┐рд╖реНрдХреНрд░рд┐рдп рд░реБрдЪрд┐ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реИ, рдЗрд╕рдХрд╛ рдХреБрдЫ рднреА рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ рдирд╣реАрдВ рдкрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЙрдкреА-рдкреЗрд╕реНрдЯ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рднреА рдирд╣реАрдВ рд╣реИред  рд▓реЗрдХрд┐рди рдкрд░рд┐рдгрд╛рдо рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдкреЗрдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реИред  рдЗрдВрдЯрд░рдиреЗрдЯ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд╡рд┐рд╡рд░рдгреЛрдВ рд╕реЗ рднрд░рд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд▓реЗрдЦрдХ рдЦреВрдмрд╕реВрд░рддреА рд╕реЗ рдФрд░ рдЪрд┐рддреНрд░реЛрдВ рдХреЗ рд╕рд╛рде рдмрддрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдХреИрд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдЖрджрд┐рдо - рдХреЛрдг, рдордВрдбрд▓рд┐рдпреЛрдВ, рдореВрдВрдЫ, рдкреВрдВрдЫ рдЖрджрд┐ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рддреЗ рд╣реИрдВ, рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рднрд╛рдЬрди / рд╡рд░реНрдЧреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЦреЛрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдХрдИ рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛рдУрдВ рдХреЛ рдЕрдиреНрдп рдмрдбрд╝реЗ рдФрд░ рд╡реНрдпрд╛рдкрдХ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ рд╡реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬреАрддрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рд╕рдордЭрдирд╛ рдФрд░ рджреЗрдЦрдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рдХреИрд╕реЗ рдФрд░ рдХреИрд╕реА рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рдмрдирд╛рддрд╛ рд╣реИред <br><a name="habracut"></a><br>  рд╣рдо рдПрдХ рдЫреЛрдЯрд╛ рдЕрдзреНрдпрдпрди рдХрд░реЗрдВрдЧреЗ рдФрд░ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗ - рд▓реЗрдЦрдХ рдХрд╛ рддрд░реНрдХ рдФрд░ рдХреЛрдб рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЖрдк рд╕реНрд╡рдпрдВ рд╕рдм рдХреБрдЫ рджреЗрдЦ / рдмрджрд▓ / рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдХрд╛рдЧрд▓ рд╕рдореБрджреНрд░реА рдЦреЛрдЬ рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реБрдИ рд╣реИред  рдПрдпрд░рдмрд╕ рдиреЗ рдЬрд╣рд╛рдЬреЛрдВ рдХреЗ рд╕рд╛рде рдФрд░ рдмрд┐рдирд╛ рд╕рдореБрджреНрд░ рдХреЗ рдЙрдкрдЧреНрд░рд╣ рдЪрд┐рддреНрд░реЛрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рд╕реНрддрд╛рд╡ рджрд┐рдпрд╛ред  рдХреБрд▓ 192555 рдЪрд┐рддреНрд░ 768x768x3 340 720 680 960 рдмрд╛рдЗрдЯреНрд╕ рд╣реИрдВ рдЕрдЧрд░ uint8 рдФрд░ рдЪрд╛рд░ рдЧреБрдирд╛ рдЬреНрдпрд╛рджрд╛ рдЕрдЧрд░ рдлреНрд▓реЛрдЯ 32 (рд╡реИрд╕реЗ рдлреНрд▓реЛрдЯ 32 рдлреНрд▓реЛрдЯ64 рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рддреЗрдЬ рд╣реИ, рдХрдо рдореЗрдореЛрд░реА рдПрдХреНрд╕реЗрд╕) рдФрд░ 15606 рдЪрд┐рддреНрд░реЛрдВ рдХреЛ рдвреВрдВрдврдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рд╕рднреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реНрдерд╛рдиреЛрдВ рдХреЛ рдУрдбреАрдПрд╕ (рдУрдбреЗрд╕рд╛рдИ) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд▓реЛрдЧреЛрдВ рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬреЛ рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рдФрд░ рдЕрдкреЗрдХреНрд╖рд┐рдд рд╣реИ, рдФрд░ рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рд╣рдо рдЬрд▓реНрдж рд╣реА рд╡рд┐рдЪрд╛рд░ рдХреА рдЯреНрд░реЗрди рдФрд░ рд╡рд┐рдЬреЗрддрд╛рдУрдВ рдФрд░ рдкреБрд░рд╕реНрдХрд╛рд░ рд╡рд┐рдЬреЗрддрд╛рдУрдВ рдХреЗ рдХреЛрдб рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░ рдкрд╛рдПрдВрдЧреЗред <br><br>  рд╣рдо рдПрдХ рд╕рдорд╛рди рд╕рдорд╕реНрдпрд╛ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕реЗ рдХрд╛рдлреА рд╕рд░рд▓ рдХрд░реЗрдВрдЧреЗ - рд╕рдореБрджреНрд░реА np.random.sample () * 0.5 рд▓реЗрдВ, рд╣рдореЗрдВ рд▓рд╣рд░реЛрдВ, рд╣рд╡рд╛, рддрдЯреЛрдВ рдФрд░ рдЕрдиреНрдп рдЫрд┐рдкреЗ рд╣реБрдП рдкреИрдЯрд░реНрди рдФрд░ рдЪреЗрд╣рд░реЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рдЖрд░рдЬреАрдмреА рд░реЗрдВрдЬ рдореЗрдВ 0.0 рд╕реЗ 0.5 рддрдХ рд╕рдореБрджреНрд░ рдХреА рдЫрд╡рд┐ рдХреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдмрдирд╛рддреЗ рд╣реИрдВред  рд╣рдо рдЬрд╣рд╛рдЬреЛрдВ рдХреЛ рдПрдХ рд╣реА рд░рдВрдЧ рдореЗрдВ рд░рдВрдЧреЗрдВрдЧреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╕рдореБрджреНрд░ рд╕реЗ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЙрдиреНрд╣реЗрдВ 0.5 рд╕реЗ 1.0 рддрдХ рдХреА рд╕реАрдорд╛ рдореЗрдВ рд░рдЦреЗрдВрдЧреЗ, рдФрд░ рд╡реЗ рд╕рднреА рдПрдХ рд╣реА рдЖрдХрд╛рд░ рдХреЗ рд╣реЛрдВрдЧреЗ - рд╡рд┐рднрд┐рдиреНрди рдЖрдХрд╛рд░реЛрдВ рдФрд░ рдЭреБрдХрд╛рд╡реЛрдВ рдХреЗ рджреАрд░реНрдШрд╡реГрддреНрддред <br><br><img src="https://habrastorage.org/webt/yb/3w/gt/yb3wgteawunrk3urgpsxpnxugm4.png" alt="рдЫрд╡рд┐"><br><br>  рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд╛рдорд╛рдиреНрдп рд╕рдВрд╕реНрдХрд░рдг рд▓реЗрдВ (рдЖрдк рдЕрдкрдирд╛ рдкрд╕рдВрджреАрджрд╛ рдиреЗрдЯрд╡рд░реНрдХ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ) рдФрд░ рд╣рдо рдЗрд╕рдХреЗ рд╕рд╛рде рд╕рднреА рдкреНрд░рдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред <br><br>  рдЕрдЧрд▓рд╛, рд╣рдо рдЪрд┐рддреНрд░ рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдмрджрд▓ рджреЗрдВрдЧреЗ, рд╣рд╕реНрддрдХреНрд╖реЗрдк рдкреИрджрд╛ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗ - рдЗрд╕рд▓рд┐рдП рд╣рдо рдЙрди рдореБрдЦреНрдп рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рдирдХреЗ рджреНрд╡рд╛рд░рд╛ рдиреЗрдЯрд╡рд░реНрдХ рджреАрд░реНрдШрд╡реГрддреНрдд рдкрд╛рддрд╛ рд╣реИред  рд╢рд╛рдпрдж рдкрд╛рдардХ рдЕрдкрдиреЗ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд╛рд▓реЗрдВрдЧреЗ рдФрд░ рд▓реЗрдЦрдХ рдХрд╛ рдЦрдВрдбрди рдХрд░реЗрдВрдЧреЗред <br><br><div class="spoiler">  <b class="spoiler_title">рд╣рдо рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ, рд╣рдо рдЪрд┐рддреНрд░реЛрдВ рдХреА рдПрдХ рд╕рд░рдгреА рдХрд╛ рдЖрдХрд╛рд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt %matplotlib inline <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> math <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tqdm <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tqdm_notebook, tqdm <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> skimage.draw <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ellipse, polygon <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Model <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.callbacks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> EarlyStopping, ModelCheckpoint, ReduceLROnPlateau <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> load_model <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.optimizers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Adam <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.layers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Input, Conv2D, Conv2DTranspose, MaxPooling2D, concatenate, Dropout <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.losses <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> binary_crossentropy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensorflow <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> keras <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> keras <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> backend <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> K <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tqdm <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tqdm_notebook w_size = <span class="hljs-number"><span class="hljs-number">256</span></span> train_num = <span class="hljs-number"><span class="hljs-number">8192</span></span> train_x = np.zeros((train_num, w_size, w_size,<span class="hljs-number"><span class="hljs-number">3</span></span>), dtype=<span class="hljs-string"><span class="hljs-string">'float32'</span></span>) train_y = np.zeros((train_num, w_size, w_size,<span class="hljs-number"><span class="hljs-number">1</span></span>), dtype=<span class="hljs-string"><span class="hljs-string">'float32'</span></span>) img_l = np.random.sample((w_size, w_size, <span class="hljs-number"><span class="hljs-number">3</span></span>))*<span class="hljs-number"><span class="hljs-number">0.5</span></span> img_h = np.random.sample((w_size, w_size, <span class="hljs-number"><span class="hljs-number">3</span></span>))*<span class="hljs-number"><span class="hljs-number">0.5</span></span> + <span class="hljs-number"><span class="hljs-number">0.5</span></span> radius_min = <span class="hljs-number"><span class="hljs-number">10</span></span> radius_max = <span class="hljs-number"><span class="hljs-number">30</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">рдиреБрдХрд╕рд╛рди рдФрд░ рд╕рдЯреАрдХрддрд╛ рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░реЗрдВ</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dice_coef</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(y_true, y_pred)</span></span></span><span class="hljs-function">:</span></span> y_true_f = K.flatten(y_true) y_pred = K.cast(y_pred, <span class="hljs-string"><span class="hljs-string">'float32'</span></span>) y_pred_f = K.cast(K.greater(K.flatten(y_pred), <span class="hljs-number"><span class="hljs-number">0.5</span></span>), <span class="hljs-string"><span class="hljs-string">'float32'</span></span>) intersection = y_true_f * y_pred_f score = <span class="hljs-number"><span class="hljs-number">2.</span></span> * K.sum(intersection) / (K.sum(y_true_f) + K.sum(y_pred_f)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dice_loss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(y_true, y_pred)</span></span></span><span class="hljs-function">:</span></span> smooth = <span class="hljs-number"><span class="hljs-number">1.</span></span> y_true_f = K.flatten(y_true) y_pred_f = K.flatten(y_pred) intersection = y_true_f * y_pred_f score = (<span class="hljs-number"><span class="hljs-number">2.</span></span> * K.sum(intersection) + smooth) / (K.sum(y_true_f) + K.sum(y_pred_f) + smooth) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1.</span></span> - score <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bce_dice_loss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(y_true, y_pred)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> binary_crossentropy(y_true, y_pred) + dice_loss(y_true, y_pred) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_iou_vector</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A, B)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Numpy version batch_size = A.shape[0] metric = 0.0 for batch in range(batch_size): t, p = A[batch], B[batch] true = np.sum(t) pred = np.sum(p) # deal with empty mask first if true == 0: metric += (pred == 0) continue # non empty mask case. Union is never empty # hence it is safe to divide by its number of pixels intersection = np.sum(t * p) union = true + pred - intersection iou = intersection / union # iou metrric is a stepwise approximation of the real iou over 0.5 iou = np.floor(max(0, (iou - 0.45)*20)) / 10 metric += iou # teake the average over all images in batch metric /= batch_size return metric def my_iou_metric(label, pred): # Tensorflow version return tf.py_func(get_iou_vector, [label, pred &gt; 0.5], tf.float64) from keras.utils.generic_utils import get_custom_objects get_custom_objects().update({'bce_dice_loss': bce_dice_loss }) get_custom_objects().update({'dice_loss': dice_loss }) get_custom_objects().update({'dice_coef': dice_coef }) get_custom_objects().update({'my_iou_metric': my_iou_metric })</span></span></code> </pre><br></div></div><br>  рд╣рдо рдЫрд╡рд┐ рд╡рд┐рднрд╛рдЬрди рдореЗрдВ рдХреНрд▓рд╛рд╕рд┐рдХ рдореАрдЯреНрд░рд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдмрд╣реБрдд рд╕рд╛рд░реЗ рд▓реЗрдЦ рд╣реИрдВ, рдЪрдпрдирд┐рдд рдореАрдЯреНрд░рд┐рдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдФрд░ рдкрд╛рда рдХреЗ рд╕рд╛рде рдХреЛрдб, рдЙрд╕реА рдХрдЧреНрдЧрд▓ рдкрд░ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдФрд░ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдХреЗ рд╕рд╛рде рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВред  рд╣рдо рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рдореБрдЦреМрдЯреЗ рдХреА рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдХрд░реЗрдВрдЧреЗ - рдпрд╣ "рд╕рдореБрджреНрд░" рдпрд╛ "рдирд╛рд╡" рд╣реИ рдФрд░ рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдХреА рд╕рдЪреНрдЪрд╛рдИ рдпрд╛ рдЭреВрда рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддрд╛ рд╣реИред  рдпрд╛рдиреА  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд╛рд░ рд╡рд┐рдХрд▓реНрдк рд╕рдВрднрд╡ рд╣реИрдВ - рд╣рдордиреЗ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдХреА рдХрд┐ рдПрдХ рдкрд┐рдХреНрд╕реЗрд▓ "рд╕рдореБрджреНрд░" рд╣реИ, рд╕рд╣реА рдврдВрдЧ рд╕реЗ рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдХреА рд╣реИ рдХрд┐ рдПрдХ рдкрд┐рдХреНрд╕реЗрд▓ "рдЬрд╣рд╛рдЬ" рд╣реИ рдпрд╛ "рд╕рдореБрджреНрд░" рдпрд╛ "рдЬрд╣рд╛рдЬ" рдХреА рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдХрд░рдиреЗ рдореЗрдВ рдЧрд▓рддреА рдХреА рд╣реИред  рдФрд░ рдЗрд╕рд▓рд┐рдП, рд╕рднреА рдЪрд┐рддреНрд░реЛрдВ рдФрд░ рд╕рднреА рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕рднреА рдЪрд╛рд░ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рддреЗ рд╣реИрдВ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ - рдпрд╣ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реЛрдЧрд╛ред  рдФрд░ рдХрдо рддреНрд░реБрдЯрд┐рдкреВрд░реНрдг рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгрд┐рдпрд╛рдВ рдФрд░ рдЕрдзрд┐рдХ рд╕рддреНрдп, рдкрд░рд┐рдгрд╛рдо рдЬрд┐рддрдирд╛ рд╕рдЯреАрдХ рдФрд░ рдмреЗрд╣рддрд░ рдиреЗрдЯрд╡рд░реНрдХред <br><br>  рдФрд░ рдЕрдиреБрд╕рдВрдзрд╛рди рдХреЗ рд▓рд┐рдП, рдЪрд▓реЛ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЕрдзреНрдпрдпрди рдХрд┐рдП рдЧрдП рдпреВ-рдиреЗрдЯ рд▓реЗрддреЗ рд╣реИрдВ, рдЬреЛ рдЫрд╡рд┐ рд╡рд┐рднрд╛рдЬрди рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрддреНрдХреГрд╖реНрдЯ рдиреЗрдЯрд╡рд░реНрдХ рд╣реИред  рдЗрд╕ рддрд░рд╣ рдХреА рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛рдУрдВ рдореЗрдВ рдиреЗрдЯрд╡рд░реНрдХ рдмрд╣реБрдд рдЖрдо рд╣реИ рдФрд░ рдХрдИ рд╡рд┐рд╡рд░рдг, рдЖрд╡реЗрджрди рдХреА рд╕реВрдХреНрд╖реНрдорддрд╛рдПрдВ рдЖрджрд┐ рд╣реИрдВред  рдХреНрд▓рд╛рд╕рд┐рдХ рдпреВ-рдиреЗрдЯ рдХрд╛ рдПрдХ рд╕рдВрд╕реНрдХрд░рдг рдЪреБрдирд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдЗрд╕реЗ рдЕрдкрдЧреНрд░реЗрдб рдХрд░рдирд╛, рдЕрд╡рд╢рд┐рд╖реНрдЯ рдмреНрд▓реЙрдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рдЖрджрд┐ рд╕рдВрднрд╡ рдерд╛ред  рд▓реЗрдХрд┐рди "рдЖрдк рдЕрдкрд░рд┐рдкрдХреНрд╡рддрд╛ рдХреЛ рдЧрд▓реЗ рдирд╣реАрдВ рд▓рдЧрд╛ рд╕рдХрддреЗ" рдФрд░ рдПрдХ рд╣реА рдмрд╛рд░ рдореЗрдВ рд╕рднреА рдкреНрд░рдпреЛрдЧреЛрдВ рдФрд░ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рдХрд░рддреЗ рд╣реИрдВ  рдпреВ-рдиреЗрдЯ рдЪрд┐рддреНрд░реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ рдСрдкрд░реЗрд╢рди рдХрд░рддрд╛ рд╣реИ - рдпрд╣ рддрд╕реНрд╡реАрд░ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдХреБрдЫ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рд╕рд╛рде рдХрджрдо рд╕реЗ рдХрдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рд╕рдВрдкреАрдбрд╝рд┐рдд рдЫрд╡рд┐ рд╕реЗ рдореБрдЦреМрдЯрд╛ рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред  рдпрд╛рдиреА  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЪрд┐рддреНрд░ рдХрд╛ рдЖрдпрд╛рдо 32x32 рддрдХ рд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рд╣рдо рдкрд┐рдЫрд▓реЗ рд╕рднреА рдХрдВрдкреНрд░реЗрд╢рди рд╕реЗ рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдорд╛рд╕реНрдХ рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред <br><br>  рддрд╕реНрд╡реАрд░ рдореЗрдВ, рдпреВ-рдиреЗрдЯ рдпреЛрдЬрдирд╛ рдореВрд▓ рд▓реЗрдЦ рд╕реЗ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕реЗ рдереЛрдбрд╝рд╛ рд╕рд╛ рдлрд┐рд░ рд╕реЗ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╕рд╛рд░ рдПрдХ рд╣реА рд░рд╣рддрд╛ рд╣реИ - рд╣рдо рдЫрд╡рд┐ рдХреЛ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд░рддреЗ рд╣реИрдВ тЖТ рдПрдХ рдореБрдЦреМрдЯрд╛ рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред <br><br><img src="https://habrastorage.org/webt/un/ay/gn/unaygnyzsdhk_2dbk4qq2-2m340.png" alt="рдЫрд╡рд┐"><br><br><div class="spoiler">  <b class="spoiler_title">рдмрд╕ рдпреВ-рдиреЗрдЯ</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(input_layer, start_neurons)</span></span></span><span class="hljs-function">:</span></span> conv1 = Conv2D(start_neurons*<span class="hljs-number"><span class="hljs-number">1</span></span>,(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>),activation=<span class="hljs-string"><span class="hljs-string">"relu"</span></span>, padding=<span class="hljs-string"><span class="hljs-string">"same"</span></span>)(input_layer) conv1 = Conv2D(start_neurons*<span class="hljs-number"><span class="hljs-number">1</span></span>,(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>),activation=<span class="hljs-string"><span class="hljs-string">"relu"</span></span>, padding=<span class="hljs-string"><span class="hljs-string">"same"</span></span>)(conv1) pool1 = MaxPooling2D((<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>))(conv1) pool1 = Dropout(<span class="hljs-number"><span class="hljs-number">0.25</span></span>)(pool1) conv2 = Conv2D(start_neurons*<span class="hljs-number"><span class="hljs-number">2</span></span>,(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>),activation=<span class="hljs-string"><span class="hljs-string">"relu"</span></span>, padding=<span class="hljs-string"><span class="hljs-string">"same"</span></span>)(pool1) conv2 = Conv2D(start_neurons*<span class="hljs-number"><span class="hljs-number">2</span></span>,(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>),activation=<span class="hljs-string"><span class="hljs-string">"relu"</span></span>, padding=<span class="hljs-string"><span class="hljs-string">"same"</span></span>)(conv2) pool2 = MaxPooling2D((<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>))(conv2) pool2 = Dropout(<span class="hljs-number"><span class="hljs-number">0.5</span></span>)(pool2) conv3 = Conv2D(start_neurons*<span class="hljs-number"><span class="hljs-number">4</span></span>,(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>),activation=<span class="hljs-string"><span class="hljs-string">"relu"</span></span>, padding=<span class="hljs-string"><span class="hljs-string">"same"</span></span>)(pool2) conv3 = Conv2D(start_neurons*<span class="hljs-number"><span class="hljs-number">4</span></span>,(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>),activation=<span class="hljs-string"><span class="hljs-string">"relu"</span></span>, padding=<span class="hljs-string"><span class="hljs-string">"same"</span></span>)(conv3) pool3 = MaxPooling2D((<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>))(conv3) pool3 = Dropout(<span class="hljs-number"><span class="hljs-number">0.5</span></span>)(pool3) conv4 = Conv2D(start_neurons*<span class="hljs-number"><span class="hljs-number">8</span></span>,(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>),activation=<span class="hljs-string"><span class="hljs-string">"relu"</span></span>, padding=<span class="hljs-string"><span class="hljs-string">"same"</span></span>)(pool3) conv4 = Conv2D(start_neurons*<span class="hljs-number"><span class="hljs-number">8</span></span>,(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>),activation=<span class="hljs-string"><span class="hljs-string">"relu"</span></span>, padding=<span class="hljs-string"><span class="hljs-string">"same"</span></span>)(conv4) pool4 = MaxPooling2D((<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>))(conv4) pool4 = Dropout(<span class="hljs-number"><span class="hljs-number">0.5</span></span>)(pool4) <span class="hljs-comment"><span class="hljs-comment"># Middle convm = Conv2D(start_neurons*16,(3,3),activation="relu", padding="same")(pool4) convm = Conv2D(start_neurons*16,(3,3),activation="relu", padding="same")(convm) deconv4 = Conv2DTranspose(start_neurons * 8, (3, 3), strides=(2, 2), padding="same")(convm) uconv4 = concatenate([deconv4, conv4]) uconv4 = Dropout(0.5)(uconv4) uconv4 = Conv2D(start_neurons*8,(3,3),activation="relu", padding="same")(uconv4) uconv4 = Conv2D(start_neurons*8,(3,3),activation="relu", padding="same")(uconv4) deconv3 = Conv2DTranspose(start_neurons*4,(3,3),strides=(2, 2), padding="same")(uconv4) uconv3 = concatenate([deconv3, conv3]) uconv3 = Dropout(0.5)(uconv3) uconv3 = Conv2D(start_neurons*4,(3,3),activation="relu", padding="same")(uconv3) uconv3 = Conv2D(start_neurons*4,(3,3),activation="relu", padding="same")(uconv3) deconv2 = Conv2DTranspose(start_neurons*2,(3,3),strides=(2, 2), padding="same")(uconv3) uconv2 = concatenate([deconv2, conv2]) uconv2 = Dropout(0.5)(uconv2) uconv2 = Conv2D(start_neurons*2,(3,3),activation="relu", padding="same")(uconv2) uconv2 = Conv2D(start_neurons*2,(3,3),activation="relu", padding="same")(uconv2) deconv1 = Conv2DTranspose(start_neurons*1,(3,3),strides=(2, 2), padding="same")(uconv2) uconv1 = concatenate([deconv1, conv1]) uconv1 = Dropout(0.5)(uconv1) uconv1 = Conv2D(start_neurons*1,(3,3),activation="relu", padding="same")(uconv1) uconv1 = Conv2D(start_neurons*1,(3,3),activation="relu", padding="same")(uconv1) uncov1 = Dropout(0.5)(uconv1) output_layer = Conv2D(1,(1,1), padding="same", activation="sigmoid")(uconv1) return output_layer</span></span></code> </pre><br></div></div><br><h3>  рдкрд╣рд▓рд╛ рдкреНрд░рдпреЛрдЧред  рд╕рд░рд▓рддрдо </h3><br>  рд╣рдорд╛рд░реЗ рдкреНрд░рдпреЛрдЧ рдХрд╛ рдкрд╣рд▓рд╛ рд╕рдВрд╕реНрдХрд░рдг рдмрд╣реБрдд рд╕рд░рд▓ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╛рджрдЧреА рдХреЗ рд▓рд┐рдП рдЪреБрдирд╛ рдЧрдпрд╛ рдерд╛ - рд╕рдореБрджреНрд░ рд╣рд▓реНрдХрд╛ рд╣реИ, рдЬрд╣рд╛рдЬ рдЧрд╣рд░реЗ рд╣реИрдВред  рд╕рдм рдХреБрдЫ рдмрд╣реБрдд рд╕рд░рд▓ рдФрд░ рд╕реНрдкрд╖реНрдЯ рд╣реИ, рд╣рдо рдЗрд╕ рдмрд╛рдд рдХреА рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕рдорд╕реНрдпрд╛ рдХреЗ рдФрд░ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕рдЯреАрдХрддрд╛ рдХреЗ рдЬрд╣рд╛рдЬреЛрдВ / рдПрд▓рд┐рдкреНрд╕ рдХреЛ рдЦреЛрдЬреЗрдЧрд╛ред  рдЕрдЧрд▓рд╛_рдкреЗрдпрд░ рдлрд╝рдВрдХреНрд╢рди рдЪрд┐рддреНрд░ / рдорд╛рд╕реНрдХ рдХреА рдПрдХ рдЬреЛрдбрд╝реА рдмрдирд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЬрдЧрд╣, рдЖрдХрд╛рд░, рд░реЛрдЯреЗрд╢рди рдХреЛрдг рдХреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЪреБрдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрди рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ - рд░рдВрдЧ, рдЖрдХрд╛рд░, рд╣рд╕реНрддрдХреНрд╖реЗрдк рдЖрджрд┐ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрдиред  рд▓реЗрдХрд┐рди рдЕрдм рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рд╡рд┐рдХрд▓реНрдк, рд╣рдо рдПрдХ рд╣рд▓реНрдХреЗ рдкреГрд╖реНрдарднреВрдорд┐ рдкрд░ рдЕрдВрдзреЗрд░реЗ рдиреМрдХрд╛рдУрдВ рдХреА рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next_pair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> p = np.random.sample() - <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-comment"><span class="hljs-comment">#    # r,c -    r = np.random.sample()*(w_size-2*radius_max) + radius_max c = np.random.sample()*(w_size-2*radius_max) + radius_max #      r_radius = np.random.sample()*(radius_max-radius_min) + radius_min c_radius = np.random.sample()*(radius_max-radius_min) + radius_min rot = np.random.sample()*360 #   rr, cc = ellipse( r, c, r_radius, c_radius, rotation=np.deg2rad(rot), shape=img_l.shape ) #     #   /    0.5  1.0 img = img_h.copy() #       0.0  0.5 img[rr, cc] = img_l[rr, cc] msk = np.zeros((w_size, w_size, 1), dtype='float32') msk[rr, cc] = 1. #     return img, msk</span></span></code> </pre><br>  рд╣рдо рдкреВрд░реА рдЯреНрд░реЗрди рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╣реБрдЖред  рдпрд╣ рд╕рдореБрджреНрд░ рдореЗрдВ рдирд╛рд╡реЛрдВ рдЬреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рд╕реЗ рдЬреНрдпрд╛рджрд╛ рдХреБрдЫ рдирд╣реАрдВред  рд╕рдм рдХреБрдЫ рд╕реНрдкрд╖реНрдЯ, рд╕реНрдкрд╖реНрдЯ рдФрд░ рд╕рдордЭрдиреЗ рдпреЛрдЧреНрдп рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред  рд╕реНрдерд╛рди рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╣реИ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдЪрд┐рддреНрд░ рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рджреАрд░реНрдШрд╡реГрддреНрдд рд╣реИред <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(train_num): <span class="hljs-comment"><span class="hljs-comment">#   img train img, msk = next_pair() train_x[k] = img train_y[k] = msk fig, axes = plt.subplots(2, 10, figsize=(20, 5)) #    10   for k in range(10): axes[0,k].set_axis_off() axes[0,k].imshow(train_x[k]) axes[1,k].set_axis_off() axes[1,k].imshow(train_y[k].squeeze())</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/pf/cl/wa/pfclwaca6lntxzgsiplghwevvzk.png" alt="рдЫрд╡рд┐"><br><br>  рдЗрд╕рдореЗрдВ рдХреЛрдИ рд╕рдВрджреЗрд╣ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╕реАрдЦреЗрдЧрд╛ рдФрд░ рджреАрд░реНрдШрд╡реГрддреНрдд рдвреВрдВрдвреЗрдЧрд╛ред  рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рд╣рдорд╛рд░реА рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рджреАрд░реНрдШрд╡реГрддреНрдд / рдЬрд╣рд╛рдЬреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдЙрдЪреНрдЪ рд╕рдЯреАрдХрддрд╛ рдХреЗ рд╕рд╛рдеред <br><br><pre> <code class="python hljs">input_layer = Input((w_size, w_size, <span class="hljs-number"><span class="hljs-number">3</span></span>)) output_layer = build_model(input_layer, <span class="hljs-number"><span class="hljs-number">16</span></span>) model = Model(input_layer, output_layer) model.compile(loss=bce_dice_loss, optimizer=Adam(lr=<span class="hljs-number"><span class="hljs-number">1e-3</span></span>), metrics=[my_iou_metric]) model.save_weights(<span class="hljs-string"><span class="hljs-string">'./keras.weights'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: history = model.fit(train_x, train_y, batch_size=<span class="hljs-number"><span class="hljs-number">32</span></span>, epochs=<span class="hljs-number"><span class="hljs-number">1</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">1</span></span>, validation_split=<span class="hljs-number"><span class="hljs-number">0.1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> history.history[<span class="hljs-string"><span class="hljs-string">'my_iou_metric'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0.75</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre> <br> <code>Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 55s 7ms/step - loss: 0.2272 - my_iou_metric: 0.7325 - val_loss: 0.0063 - val_my_iou_metric: 1.0000 <br> Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 53s 7ms/step - loss: 0.0090 - my_iou_metric: 1.0000 - val_loss: 0.0045 - val_my_iou_metric: 1.0000 <br></code> <br><br>  рдиреЗрдЯрд╡рд░реНрдХ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рджреАрд░реНрдШрд╡реГрддреНрдд рдкрд╛рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ рднреА рд╕рд┐рджреНрдз рдирд╣реАрдВ рд╣реИ рдХрд┐ рд╡рд╣ рдордиреБрд╖реНрдп рдХреА рд╕рдордЭ рдореЗрдВ рджреАрд░реНрдШрд╡реГрддреНрдд рдХреА рддрд▓рд╛рд╢ рдХрд░ рд░рд╣реА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдПрдХ рдХреНрд╖реЗрддреНрд░ рдЬреЛ рджреАрд░реНрдШрд╡реГрддреНрдд рд╕рдореАрдХрд░рдг рд╕реЗ рдШрд┐рд░рд╛ рд╣реИ рдФрд░ рдкреГрд╖реНрдарднреВрдорд┐ рд╕реЗ рдЕрд▓рдЧ рд╕рд╛рдордЧреНрд░реА рд╕реЗ рднрд░рд╛ рд╣реИ, рд╡рд╣рд╛рдБ рдХреЛрдИ рдирд┐рд╢реНрдЪрд┐рддрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рджреНрд╡рд┐рдШрд╛рдд рд╕рдореАрдХрд░рдг рдХреЗ рдЧреБрдгрд╛рдВрдХ рдХреЗ рд╕рдорд╛рди рдиреЗрдЯрд╡рд░реНрдХ рднрд╛рд░ рд╣реИрдВред  рдФрд░ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рджреАрд░реНрдШрд╡реГрддреНрдд рдХреА рдЪрдордХ рдкреГрд╖реНрдарднреВрдорд┐ рдХреА рдЪрдордХ рд╕реЗ рдХрдо рд╣реИ рдФрд░ рдХреЛрдИ рд░рд╣рд╕реНрдп рдпрд╛ рдкрд╣реЗрд▓реА рдирд╣реАрдВ рд╣реИ - рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╣рдордиреЗ рд╕рд┐рд░реНрдл рдХреЛрдб рдХреА рдЬрд╛рдВрдЪ рдХреА рд╣реИред  рдЪрд▓реЛ рд╕реНрдкрд╖реНрдЯ рдЪреЗрд╣рд░реЗ рдХреЛ рдареАрдХ рдХрд░рддреЗ рд╣реИрдВ, рджреАрд░реНрдШрд╡реГрддреНрдд рдХреА рдкреГрд╖реНрдарднреВрдорд┐ рдФрд░ рд░рдВрдЧ рдХреЛ рднреА рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдмрдирд╛рддреЗ рд╣реИрдВред <br><br><h3>  рджреВрд╕рд░рд╛ рд╡рд┐рдХрд▓реНрдк </h3><br>  рдЕрдм рдПрдХ рд╣реА рд╕рдореБрджреНрд░ рдкрд░ рдПрдХ рд╣реА рдЕрдВрдбрд╛рдХрд╛рд░ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╕рдореБрджреНрд░ рдХрд╛ рд░рдВрдЧ рдФрд░, рддрджрдиреБрд╕рд╛рд░, рдирд╛рд╡ рдХреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЪреБрдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рд╕рдореБрджреНрд░ рдЧрд╣рд░рд╛ рд╣реИ, рддреЛ рдЬрд╣рд╛рдЬ рд╣рд▓реНрдХрд╛ рдФрд░ рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд рд╣реЛрдЧрд╛ред  рдпрд╛рдиреА  рдЕрдВрдХреЛрдВ рдХреЗ рд╕рдореВрд╣ рдХреА рдЪрдордХ рд╕реЗ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рдЕрд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╡реЗ рджреАрд░реНрдШрд╡реГрддреНрдд рдХреЗ рдмрд╛рд╣рд░ рд╣реИрдВ, рдпрд╛рдиреА рд╕рдореБрджреНрд░ рдпрд╛ рдпреЗ рджреАрд░реНрдШрд╡реГрддреНрдд рдХреЗ рдЕрдВрджрд░ рдХреЗ рдмрд┐рдВрджреБ рд╣реИрдВред  рдлрд┐рд░, рд╣рдо рдЕрдкрдиреА рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рд░рдВрдЧ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ рджреАрд░реНрдШрд╡реГрддреНрдд рдорд┐рд▓реЗрдЧрд╛ред <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next_pair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> p = np.random.sample() - <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-comment"><span class="hljs-comment">#    / r = np.random.sample()*(w_size-2*radius_max) + radius_max c = np.random.sample()*(w_size-2*radius_max) + radius_max r_radius = np.random.sample()*(radius_max-radius_min) + radius_min c_radius = np.random.sample()*(radius_max-radius_min) + radius_min rot = np.random.sample()*360 rr, cc = ellipse( r, c, r_radius, c_radius, rotation=np.deg2rad(rot), shape=img_l.shape ) if p &gt; 0: #     img = img_l.copy() img[rr, cc] = img_h[rr, cc] else: #     img = img_h.copy() img[rr, cc] = img_l[rr, cc] msk = np.zeros((w_size, w_size, 1), dtype='float32') msk[rr, cc] = 1. return img, msk</span></span></code> </pre><br>  рдЕрдм, рдкрд┐рдХреНрд╕реЗрд▓ рдФрд░ рдЙрд╕рдХреЗ рдЖрд╕-рдкрд╛рд╕, рдкреГрд╖реНрдарднреВрдорд┐ рдпрд╛ рджреАрд░реНрдШрд╡реГрддреНрдд рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рдЕрд╕рдВрднрд╡ рд╣реИред  рд╣рдо рдЪрд┐рддреНрд░ рдФрд░ рдореБрдЦреМрдЯреЗ рднреА рдмрдирд╛рддреЗ рд╣реИрдВ рдФрд░ рд╕реНрдХреНрд░реАрди рдкрд░ рдкрд╣рд▓реЗ 10 рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред <br><br><div class="spoiler">  <b class="spoiler_title">рдмрд┐рд▓реНрдбрд┐рдВрдЧ рдорд╛рд╕реНрдХ</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(train_num): img, msk = next_pair() train_x[k] = img train_y[k] = msk fig, axes = plt.subplots(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">10</span></span>): axes[<span class="hljs-number"><span class="hljs-number">0</span></span>,k].set_axis_off() axes[<span class="hljs-number"><span class="hljs-number">0</span></span>,k].imshow(train_x[k]) axes[<span class="hljs-number"><span class="hljs-number">1</span></span>,k].set_axis_off() axes[<span class="hljs-number"><span class="hljs-number">1</span></span>,k].imshow(train_y[k].squeeze())</code> </pre><br></div></div><br><br><img src="https://habrastorage.org/webt/fj/rz/vs/fjrzvsnrryaba58fxxb08mlmayu.png" alt="рдЫрд╡рд┐"><br><pre> <code class="python hljs">input_layer = Input((w_size, w_size, <span class="hljs-number"><span class="hljs-number">3</span></span>)) output_layer = build_model(input_layer, <span class="hljs-number"><span class="hljs-number">16</span></span>) model = Model(input_layer, output_layer) model.compile(loss=bce_dice_loss, optimizer=Adam(lr=<span class="hljs-number"><span class="hljs-number">1e-3</span></span>), metrics=[my_iou_metric]) model.load_weights(<span class="hljs-string"><span class="hljs-string">'./keras.weights'</span></span>, by_name=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: history = model.fit(train_x, train_y, batch_size=<span class="hljs-number"><span class="hljs-number">32</span></span>, epochs=<span class="hljs-number"><span class="hljs-number">1</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">1</span></span>, validation_split=<span class="hljs-number"><span class="hljs-number">0.1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> history.history[<span class="hljs-string"><span class="hljs-string">'my_iou_metric'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0.75</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre> <br> <code>Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 56s 8ms/step - loss: 0.4652 - my_iou_metric: 0.5071 - val_loss: 0.0439 - val_my_iou_metric: 0.9005 <br> Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 55s 7ms/step - loss: 0.1418 - my_iou_metric: 0.8378 - val_loss: 0.0377 - val_my_iou_metric: 0.9206</code> <br> <br>  рдиреЗрдЯрд╡рд░реНрдХ рдЖрд╕рд╛рдиреА рд╕реЗ рдирдХрд▓ рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕рднреА рджреАрд░реНрдШрд╡реГрддреНрдд рдкрд╛рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ, рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдПрдХ рджреЛрд╖ рд╣реИ, рдФрд░ рд╕рдм рдХреБрдЫ рд╕реНрдкрд╖реНрдЯ рд╣реИ - рддрд╕реНрд╡реАрд░ рдореЗрдВ рджреЛ рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рд╕реЗ рдЫреЛрдЯрд╛ рдПрдХ рджреАрд░реНрдШрд╡реГрддреНрдд, рдПрдХ рдФрд░ рдкреГрд╖реНрдарднреВрдорд┐ рд╣реИред  рд╢рд╛рдпрдж рдпрд╣ рдПрдХ рдЧрд▓рдд рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдЗрд╕реЗ рдареАрдХ рдХрд░реЗрдВ, рджреАрд░реНрдШрд╡реГрддреНрдд рдХреЗ рд╕рдорд╛рди рд░рдВрдЧ рдХреА рддрд╕реНрд╡реАрд░ рдореЗрдВ рдПрдХ рдФрд░ рдмрд╣реБрднреБрдЬ рдЬреЛрдбрд╝реЗрдВред <br><br><h3>  рддреАрд╕рд░рд╛ рд╡рд┐рдХрд▓реНрдк </h3><br>  рдкреНрд░рддреНрдпреЗрдХ рддрд╕реНрд╡реАрд░ рдореЗрдВ, рд╣рдо рдмреЗрддрд░рддреАрдм рдврдВрдЧ рд╕реЗ рджреЛ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдореЗрдВ рд╕реЗ рд╕рдореБрджреНрд░ рдХреЗ рд░рдВрдЧ рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рджреАрд░реНрдШрд╡реГрддреНрдд рдФрд░ рдПрдХ рдЖрдпрдд рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЬреЛ рджреЛрдиреЛрдВ рд╕рдореБрджреНрд░ рдХреЗ рд░рдВрдЧ рд╕реЗ рдЕрд▓рдЧ рд╣реИрдВред  рдпрд╣ рдПрдХ рд╣реА "рд╕рдореБрджреНрд░", рдПрдХ рдЪрд┐рддреНрд░рд┐рдд "рдирд╛рд╡" рднреА рдирд┐рдХрд▓рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рд╣реА рддрд╕реНрд╡реАрд░ рдореЗрдВ рд╣рдо "рдирд╛рд╡" рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╣реА рд░рдВрдЧ рдХреА рдПрдХ рдЖрдпрдд рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЪрдпрдирд┐рдд рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде рднреАред  рдЕрдм рд╣рдорд╛рд░реА рдзрд╛рд░рдгрд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ, рддрд╕реНрд╡реАрд░ рдореЗрдВ рджреЛ рдкрд╣рдЪрд╛рди рдХреА рд░рдВрдЧреАрди рд╡рд╕реНрддреБрдПрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕ рдмрд╛рдд рдХреА рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХ рдЕрднреА рднреА рд╕рд╣реА рд╡рд╕реНрддреБ рдХрд╛ рдЪрдпрди рдХрд░рдирд╛ рд╕реАрдЦреЗрдЧрд╛ред <br><br><div class="spoiler">  <b class="spoiler_title">рджреАрд░реНрдШрд╡реГрддреНрдд рдФрд░ рдЖрдпрдд рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдпрдХреНрд░рдо</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next_pair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#        p = np.random.sample() - 0.5 r = np.random.sample()*(w_size-2*radius_max) + radius_max c = np.random.sample()*(w_size-2*radius_max) + radius_max r_radius = np.random.sample()*(radius_max-radius_min) + radius_min c_radius = np.random.sample()*(radius_max-radius_min) + radius_min rot = np.random.sample()*360 rr, cc = ellipse( r, c, r_radius, c_radius, rotation=np.deg2rad(rot), shape=img_l.shape ) p1 = np.rint(np.random.sample()*(w_size-2*radius_max) + radius_max) p2 = np.rint(np.random.sample()*(w_size-2*radius_max) + radius_max) p3 = np.rint(np.random.sample()*(2*radius_max - radius_min) + radius_min) p4 = np.rint(np.random.sample()*(2*radius_max - radius_min) + radius_min) #   /,    poly = np.array(( (p1, p2), (p1, p2+p4), (p1+p3, p2+p4), (p1+p3, p2), (p1, p2), )) rr_p, cc_p = polygon(poly[:, 0], poly[:, 1], img_l.shape) in_sc = list(set(rr) &amp; set(rr_p)) #   ,    #     #        if len(in_sc) &gt; 0: if np.mean(rr_p) &gt; np.mean(in_sc): poly += np.max(in_sc) - np.min(in_sc) else: poly -= np.max(in_sc) - np.min(in_sc) rr_p, cc_p = polygon(poly[:, 0], poly[:, 1], img_l.shape) if p &gt; 0: img = img_l.copy() img[rr, cc] = img_h[rr, cc] img[rr_p, cc_p] = img_h[rr_p, cc_p] else: img = img_h.copy() img[rr, cc] = img_l[rr, cc] img[rr_p, cc_p] = img_l[rr_p, cc_p] msk = np.zeros((w_size, w_size, 1), dtype='float32') msk[rr, cc] = 1. return img, msk</span></span></code> </pre><br></div></div><br>  рдкрд╣рд▓реЗ рдХреА рддрд░рд╣, рд╣рдо рдЪрд┐рддреНрд░реЛрдВ рдФрд░ рдореБрдЦреМрдЯреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдкрд╣рд▓реЗ 10 рдЬреЛрдбрд╝реЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред <br><br><div class="spoiler">  <b class="spoiler_title">рдореБрдЦреМрдЯрд╛ рдЪрд┐рддреНрд░реЛрдВ рдХреЛ рджреАрд░реНрдШрд╡реГрддреНрдд рдФрд░ рдЖрдпрддреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(train_num): img, msk = next_pair() train_x[k] = img train_y[k] = msk fig, axes = plt.subplots(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">10</span></span>): axes[<span class="hljs-number"><span class="hljs-number">0</span></span>,k].set_axis_off() axes[<span class="hljs-number"><span class="hljs-number">0</span></span>,k].imshow(train_x[k]) axes[<span class="hljs-number"><span class="hljs-number">1</span></span>,k].set_axis_off() axes[<span class="hljs-number"><span class="hljs-number">1</span></span>,k].imshow(train_y[k].squeeze())</code> </pre><br></div></div><br><br><img src="https://habrastorage.org/webt/cg/p3/ak/cgp3ak3qbhsiecrrr2ge3mjxovc.png" alt="рдЫрд╡рд┐"><br><pre> <code class="python hljs">input_layer = Input((w_size, w_size, <span class="hljs-number"><span class="hljs-number">3</span></span>)) output_layer = build_model(input_layer, <span class="hljs-number"><span class="hljs-number">16</span></span>) model = Model(input_layer, output_layer) model.compile(loss=bce_dice_loss, optimizer=Adam(lr=<span class="hljs-number"><span class="hljs-number">1e-3</span></span>), metrics=[my_iou_metric]) model.load_weights(<span class="hljs-string"><span class="hljs-string">'./keras.weights'</span></span>, by_name=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: history = model.fit(train_x, train_y, batch_size=<span class="hljs-number"><span class="hljs-number">32</span></span>, epochs=<span class="hljs-number"><span class="hljs-number">1</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">1</span></span>, validation_split=<span class="hljs-number"><span class="hljs-number">0.1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> history.history[<span class="hljs-string"><span class="hljs-string">'my_iou_metric'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0.75</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre><br> <code>Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 57s 8ms/step - loss: 0.7557 - my_iou_metric: 0.0937 - val_loss: 0.2510 - val_my_iou_metric: 0.4580 <br> Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 55s 7ms/step - loss: 0.0719 - my_iou_metric: 0.8507 - val_loss: 0.0183 - val_my_iou_metric: 0.9812</code> <br> <br>  рдиреЗрдЯрд╡рд░реНрдХ рдХреА рдЖрдпрддреЛрдВ рдХреЛ рднреНрд░рдорд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рдерд╛ рдФрд░ рд╣рдорд╛рд░реА рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рдХреА рдкреБрд╖реНрдЯрд┐ рдХреА рдЬрд╛рддреА рд╣реИред  рдЙрджрд╛рд╣рд░рдгреЛрдВ рдФрд░ рдЪрд░реНрдЪрд╛рдУрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдПрдпрд░рдмрд╕ рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рдореЗрдВ рд╕рднреА рдХреЗ рдкрд╛рд╕ рдПрдХрд▓ рдЬрд╣рд╛рдЬ рдереЗ, рдФрд░ рдХрдИ рдЬрд╣рд╛рдЬ рдмрд┐рд▓реНрдХреБрд▓ рд╕рдЯреАрдХ рдереЗред  рдЖрдпрдд рд╕реЗ рджреАрд░реНрдШрд╡реГрддреНрдд - i.e.  рдЬрд╣рд╛рдЬ рдШрд░ рд╕реЗ рдХрд┐рдирд╛рд░реЗ рдкрд░ рд╣реИ, рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рддрд┐рд╖реНрдард┐рдд рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдмрд╣реБрднреБрдЬ рджреАрд░реНрдШрд╡реГрддреНрддреЛрдВ рдХреЗ рд╕рдорд╛рди рд░рдВрдЧ рд╣реИрдВред  рдпрд╣ рд░рдВрдЧ рдХреА рдмрд╛рдд рдирд╣реАрдВ рд╣реИ, рджреАрд░реНрдШрд╡реГрддреНрдд рдФрд░ рдЖрдпрдд рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд░реВрдк рд╕реЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЪрд┐рддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br><h3>  рдЪреМрдерд╛ рд╡рд┐рдХрд▓реНрдк </h3><br>  рд╢рд╛рдпрдж рдиреЗрдЯрд╡рд░реНрдХ рдЖрдпрддреЛрдВ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╖реНрдард┐рдд рд╣реИ - рд╕рд╣реА, рдЙрдиреНрд╣реЗрдВ рд╡рд┐рдХреГрдд рдХрд░реЗрдВред  рдпрд╛рдиреА  рдиреЗрдЯрд╡рд░реНрдХ рдЖрд╕рд╛рдиреА рд╕реЗ рдЖрдХрд╛рд░ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ рджреЛрдиреЛрдВ рдмрдВрдж рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдвреВрдВрдврддрд╛ рд╣реИ рдФрд░ рдПрдХ рдЖрдпрдд рд╣реИ рдХрд┐ рдпрд╣ рдмрддрд╛рддрд╛ рд╣реИред  рдпрд╣ рд▓реЗрдЦрдХ рдХреА рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рд╣реИ - рд╣рдо рдЗрд╕рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВрдЧреЗ, рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рд╣рдо рдЖрдпрддреЗрдВ рдирд╣реАрдВ рдЬреЛрдбрд╝реЗрдВрдЧреЗ, рдмрд▓реНрдХрд┐ рдордирдорд╛рдиреЗ рдЖрдХрд╛рд░ рдХреЗ рдЪрддреБрд╖реНрдХреЛрдгреАрдп рдмрд╣реБрднреБрдЬ рднреА рд╣реЛрдВрдЧреЗред  рдФрд░ рдлрд┐рд░, рд╣рдорд╛рд░реА рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рдпрд╣ рд╣реИ рдХрд┐ рдиреЗрдЯрд╡рд░реНрдХ рдПрдХ рд╣реА рд░рдВрдЧ рдХреЗ рдПрдХ рдордирдорд╛рдиреЗ рдЪрддреБрд░реНрднреБрдЬ рдмрд╣реБрднреБрдЬ рд╕реЗ рдПрдХ рджреАрд░реНрдШрд╡реГрддреНрдд рдХреЛ рдЕрд▓рдЧ рдХрд░рддрд╛ рд╣реИред <br><br>  рдЖрдк рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЕрдВрджрд░реВрдиреА рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд╣рд╛рдВ рдкрд░рддреЛрдВ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рдЬрди рдФрд░ рдмрджрд▓рд╛рд╡ рдХреЗ рдЕрд░реНрде рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдЦрдХ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдкрд░рд┐рдгрд╛рдореА рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддрд╛ рд╣реИ, рдирд┐рд░реНрдгрдп рдХрд╛рд░реНрдп рдХреЗ рдкрд░рд┐рдгрд╛рдо рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реЛрдЧрд╛, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЕрдВрджрд░ рджреЗрдЦрдирд╛ рд╣рдореЗрд╢рд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрддрд╛ рд╣реИред <br><br><div class="spoiler">  <b class="spoiler_title">рдЫрд╡рд┐ рдирд┐рд░реНрдорд╛рдг рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░реЗрдВ</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next_pair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> p = np.random.sample() - <span class="hljs-number"><span class="hljs-number">0.5</span></span> r = np.random.sample()*(w_size<span class="hljs-number"><span class="hljs-number">-2</span></span>*radius_max) + radius_max c = np.random.sample()*(w_size<span class="hljs-number"><span class="hljs-number">-2</span></span>*radius_max) + radius_max r_radius = np.random.sample()*(radius_max-radius_min) + radius_min c_radius = np.random.sample()*(radius_max-radius_min) + radius_min rot = np.random.sample()*<span class="hljs-number"><span class="hljs-number">360</span></span> rr, cc = ellipse( r, c, r_radius, c_radius, rotation=np.deg2rad(rot), shape=img_l.shape ) p0 = np.rint(np.random.sample()*(radius_max-radius_min) + radius_min) p1 = np.rint(np.random.sample()*(w_size-radius_max)) p2 = np.rint(np.random.sample()*(w_size-radius_max)) p3 = np.rint(np.random.sample()*<span class="hljs-number"><span class="hljs-number">2.</span></span>*radius_min - radius_min) p4 = np.rint(np.random.sample()*<span class="hljs-number"><span class="hljs-number">2.</span></span>*radius_min - radius_min) p5 = np.rint(np.random.sample()*<span class="hljs-number"><span class="hljs-number">2.</span></span>*radius_min - radius_min) p6 = np.rint(np.random.sample()*<span class="hljs-number"><span class="hljs-number">2.</span></span>*radius_min - radius_min) p7 = np.rint(np.random.sample()*<span class="hljs-number"><span class="hljs-number">2.</span></span>*radius_min - radius_min) p8 = np.rint(np.random.sample()*<span class="hljs-number"><span class="hljs-number">2.</span></span>*radius_min - radius_min) poly = np.array(( (p1, p2), (p1+p3, p2+p4+p0), (p1+p5+p0, p2+p6+p0), (p1+p7+p0, p2+p8), (p1, p2), )) rr_p, cc_p = polygon(poly[:, <span class="hljs-number"><span class="hljs-number">0</span></span>], poly[:, <span class="hljs-number"><span class="hljs-number">1</span></span>], img_l.shape) in_sc = list(set(rr) &amp; set(rr_p)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(in_sc) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> np.mean(rr_p) &gt; np.mean(in_sc): poly += np.max(in_sc) - np.min(in_sc) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: poly -= np.max(in_sc) - np.min(in_sc) rr_p, cc_p = polygon(poly[:, <span class="hljs-number"><span class="hljs-number">0</span></span>], poly[:, <span class="hljs-number"><span class="hljs-number">1</span></span>], img_l.shape) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> p &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: img = img_l.copy() img[rr, cc] = img_h[rr, cc] img[rr_p, cc_p] = img_h[rr_p, cc_p] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: img = img_h.copy() img[rr, cc] = img_l[rr, cc] img[rr_p, cc_p] = img_l[rr_p, cc_p] msk = np.zeros((w_size, w_size, <span class="hljs-number"><span class="hljs-number">1</span></span>), dtype=<span class="hljs-string"><span class="hljs-string">'float32'</span></span>) msk[rr, cc] = <span class="hljs-number"><span class="hljs-number">1.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> img, msk</code> </pre><br></div></div><br>  рд╣рдо рдЪрд┐рддреНрд░реЛрдВ рдФрд░ рдореБрдЦреМрдЯреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдкрд╣рд▓реЗ 10 рдЬреЛрдбрд╝реЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред <br><br><div class="spoiler">  <b class="spoiler_title">рд╣рдо рдЪрд┐рддреНрд░ рдорд╛рд╕реНрдХ рджреАрд░реНрдШрд╡реГрддреНрдд рдФрд░ рдмрд╣реБрднреБрдЬ рдмрдирд╛рддреЗ рд╣реИрдВ</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(train_num): img, msk = next_pair() train_x[k] = img train_y[k] = msk fig, axes = plt.subplots(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">10</span></span>): axes[<span class="hljs-number"><span class="hljs-number">0</span></span>,k].set_axis_off() axes[<span class="hljs-number"><span class="hljs-number">0</span></span>,k].imshow(train_x[k]) axes[<span class="hljs-number"><span class="hljs-number">1</span></span>,k].set_axis_off() axes[<span class="hljs-number"><span class="hljs-number">1</span></span>,k].imshow(train_y[k].squeeze())</code> </pre><br></div></div><br><br><img src="https://habrastorage.org/webt/qc/hl/xu/qchlxu1uxvjmm5ooktztuw1ewbq.png" alt="рдЫрд╡рд┐"><br>  рд╣рдо рдЕрдкрдирд╛ рдиреЗрдЯрд╡рд░реНрдХ рд▓реЙрдиреНрдЪ рдХрд░рддреЗ рд╣реИрдВред  рдЖрдкрдХреЛ рдпрд╛рдж рджрд┐рд▓рд╛ рджреВрдВ рдХрд┐ рдпрд╣ рд╕рднреА рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд╣реИред <br><br><pre> <code class="python hljs">input_layer = Input((w_size, w_size, <span class="hljs-number"><span class="hljs-number">3</span></span>)) output_layer = build_model(input_layer, <span class="hljs-number"><span class="hljs-number">16</span></span>) model = Model(input_layer, output_layer) model.compile(loss=bce_dice_loss, optimizer=Adam(lr=<span class="hljs-number"><span class="hljs-number">1e-3</span></span>), metrics=[my_iou_metric]) model.load_weights(<span class="hljs-string"><span class="hljs-string">'./keras.weights'</span></span>, by_name=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: history = model.fit(train_x, train_y, batch_size=<span class="hljs-number"><span class="hljs-number">32</span></span>, epochs=<span class="hljs-number"><span class="hljs-number">1</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">1</span></span>, validation_split=<span class="hljs-number"><span class="hljs-number">0.1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> history.history[<span class="hljs-string"><span class="hljs-string">'my_iou_metric'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0.75</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre><br> <code>Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 56s 8ms/step - loss: 0.6815 - my_iou_metric: 0.2168 - val_loss: 0.2078 - val_my_iou_metric: 0.4983 <br> Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 53s 7ms/step - loss: 0.1470 - my_iou_metric: 0.6396 - val_loss: 0.1046 - val_my_iou_metric: 0.7784 <br> Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 53s 7ms/step - loss: 0.0642 - my_iou_metric: 0.8586 - val_loss: 0.0403 - val_my_iou_metric: 0.9354 <br></code> <br>  рдкрд░рд┐рдХрд▓реНрдкрдирд╛ рдХреА рдкреБрд╖реНрдЯрд┐ рдХреА рдЬрд╛рддреА рд╣реИ, рдмрд╣реБрднреБрдЬ рдФрд░ рджреАрд░реНрдШрд╡реГрддреНрдд рдЖрд╕рд╛рдиреА рд╕реЗ рднрд┐рдиреНрди рд╣реЛрддреЗ рд╣реИрдВред  рдПрдХ рдЪреМрдХрд╕ рдкрд╛рдардХ рдпрд╣рд╛рдБ рдзреНрдпрд╛рди рджреЗрдЧрд╛ - рдмреЗрд╢рдХ рд╡реЗ рдЕрд▓рдЧ рд╣реИрдВ, рдПрдХ рдмрдХрд╡рд╛рд╕ рд╕рд╡рд╛рд▓ рд╣реИ, рдХреЛрдИ рднреА рд╕рд╛рдорд╛рдиреНрдп рдПрдЖрдИ рдкрд╣рд▓реЗ рдХреА рд░реЗрдЦрд╛ рд╕реЗ рджреВрд╕рд░реЗ рдХреНрд░рдо рдХреЗ рдПрдХ рд╡рдХреНрд░ рдХреЛ рднреЗрдж рд╕рдХрддрд╛ рд╣реИред  рдпрд╛рдиреА  рдиреЗрдЯрд╡рд░реНрдХ рдЖрд╕рд╛рдиреА рд╕реЗ рджреВрд╕рд░реЗ рдХреНрд░рдо рдХреЗ рд╡рдХреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╕реАрдорд╛ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред  рд╣рдо рдмрд╣рд╕ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ, рдЕрдВрдбрд╛рдХрд╛рд░ рдХреЛ рдПрдХ рд╣реЗрдкреНрдЯрд╛рдЧрди рдФрд░ рдЪреЗрдХ рдХреЗ рд╕рд╛рде рдмрджрд▓реЗрдВред <br><br><h3>  рдкрд╛рдВрдЪрд╡рд╛рдВ рдкреНрд░рдпреЛрдЧ, рд╕рдмрд╕реЗ рдХрдард┐рди </h3><br>  рдХреЛрдИ рд╡рдХреНрд░ рдирд╣реАрдВ рд╣реИрдВ, рдХреЗрд╡рд▓ рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдЭреБрдХрд╛рд╡ рдФрд░ рдШреБрдорд╛рдП рдЧрдП рд╣реЗрдкреНрдЯреИрдЧреЛрди рдФрд░ рдордирдорд╛рдиреЗ рдврдВрдЧ рд╕реЗ рдЪрддреБрд╖реНрдХреЛрдгреАрдп рдмрд╣реБрднреБрдЬ рдХреЗ рдЪрд┐рдХрдиреА рдЪреЗрд╣рд░реЗ рд╣реИрдВред  рд╣рдо рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдЫрд╡рд┐ / рдореБрдЦреМрдЯрд╛ рдЬрдирд░реЗрдЯрд░ рдкрд░рд┐рд╡рд░реНрддрди рдХрд╛ рдкрд░рд┐рдЪрдп рджреЗрддреЗ рд╣реИрдВ - рдХреЗрд╡рд▓ рдПрдХ рд╣реА рд░рдВрдЧ рдХреЗ рдирд┐рдпрдорд┐рдд рд╣реЗрдкреНрдЯреИрдЧреЙрди рдФрд░ рдордирдорд╛рдиреЗ рдврдВрдЧ рд╕реЗ рдЪрддреБрд╖реНрдХреЛрдгреАрдп рдмрд╣реБрднреБрдЬ рдХреЗ рдЕрдиреБрдорд╛рдиред <br><br><div class="spoiler">  <b class="spoiler_title">рдЫрд╡рд┐ рдирд┐рд░реНрдорд╛рдг рд╕рдорд╛рд░реЛрд╣ рдХрд╛ рдЕрдВрддрд┐рдо рд╕рдВрд╢реЛрдзрди</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next_pair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_n = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">7</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> p = np.random.sample() - <span class="hljs-number"><span class="hljs-number">0.5</span></span> c_x = np.random.sample()*(w_size<span class="hljs-number"><span class="hljs-number">-2</span></span>*radius_max) + radius_max c_y = np.random.sample()*(w_size<span class="hljs-number"><span class="hljs-number">-2</span></span>*radius_max) + radius_max radius = np.random.sample()*(radius_max-radius_min) + radius_min d = np.random.sample()*<span class="hljs-number"><span class="hljs-number">0.5</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span> a_deg = np.random.sample()*<span class="hljs-number"><span class="hljs-number">360</span></span> a_rad = np.deg2rad(a_deg) poly = [] <span class="hljs-comment"><span class="hljs-comment">#    for k in range(_n): #     # _ _ -  poly.append(c_x+radius*math.sin(2.*k*math.pi/_n)) poly.append(c_y+radius*math.cos(2.*k*math.pi/_n)) # \  #    0.5  1.5  poly[-2] = (poly[-2]-c_x)/d +c_x poly[-1] = (poly[-1]-c_y) +c_y #     poly[-2] = ((poly[-2]-c_x)*math.cos(a_rad)\ - (poly[-1]-c_y)*math.sin(a_rad)) + c_x poly[-1] = ((poly[-2]-c_x)*math.sin(a_rad)\ + (poly[-1]-c_y)*math.cos(a_rad)) + c_y poly = np.rint(poly).reshape(-1,2) rr, cc = polygon(poly[:, 0], poly[:, 1], img_l.shape) p0 = np.rint(np.random.sample()*(radius_max-radius_min) + radius_min) p1 = np.rint(np.random.sample()*(w_size-radius_max)) p2 = np.rint(np.random.sample()*(w_size-radius_max)) p3 = np.rint(np.random.sample()*2.*radius_min - radius_min) p4 = np.rint(np.random.sample()*2.*radius_min - radius_min) p5 = np.rint(np.random.sample()*2.*radius_min - radius_min) p6 = np.rint(np.random.sample()*2.*radius_min - radius_min) p7 = np.rint(np.random.sample()*2.*radius_min - radius_min) p8 = np.rint(np.random.sample()*2.*radius_min - radius_min) poly = np.array(( (p1, p2), (p1+p3, p2+p4+p0), (p1+p5+p0, p2+p6+p0), (p1+p7+p0, p2+p8), (p1, p2), )) rr_p, cc_p = polygon(poly[:, 0], poly[:, 1], img_l.shape) in_sc = list(set(rr) &amp; set(rr_p)) if len(in_sc) &gt; 0: if np.mean(rr_p) &gt; np.mean(in_sc): poly += np.max(in_sc) - np.min(in_sc) else: poly -= np.max(in_sc) - np.min(in_sc) rr_p, cc_p = polygon(poly[:, 0], poly[:, 1], img_l.shape) if p &gt; 0: img = img_l.copy() img[rr, cc] = img_h[rr, cc] img[rr_p, cc_p] = img_h[rr_p, cc_p] else: img = img_h.copy() img[rr, cc] = img_l[rr, cc] img[rr_p, cc_p] = img_l[rr_p, cc_p] msk = np.zeros((w_size, w_size, 1), dtype='float32') msk[rr, cc] = 1. return img, msk</span></span></code> </pre><br></div></div><br>  рдкрд╣рд▓реЗ рдХреА рддрд░рд╣, рд╣рдо рдРрд░реЗ рдмрдирд╛рддреЗ рд╣реИрдВ рдФрд░ рдкрд╣рд▓реЗ 10 рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред <br><br><div class="spoiler">  <b class="spoiler_title">рдмрд┐рд▓реНрдбрд┐рдВрдЧ рдорд╛рд╕реНрдХ</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(train_num): img, msk = next_pair() train_x[k] = img train_y[k] = msk fig, axes = plt.subplots(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">10</span></span>): axes[<span class="hljs-number"><span class="hljs-number">0</span></span>,k].set_axis_off() axes[<span class="hljs-number"><span class="hljs-number">0</span></span>,k].imshow(train_x[k]) axes[<span class="hljs-number"><span class="hljs-number">1</span></span>,k].set_axis_off() axes[<span class="hljs-number"><span class="hljs-number">1</span></span>,k].imshow(train_y[k].squeeze())</code> </pre><br></div></div><br><img src="https://habrastorage.org/webt/ze/fs/lv/zefslv3lqpbtq2vuvk0usrvpua8.png" alt="рдЫрд╡рд┐"><br><pre> <code class="python hljs">input_layer = Input((w_size, w_size, <span class="hljs-number"><span class="hljs-number">3</span></span>)) output_layer = build_model(input_layer, <span class="hljs-number"><span class="hljs-number">16</span></span>) model = Model(input_layer, output_layer) model.compile(loss=dice_loss, optimizer=Adam(lr=<span class="hljs-number"><span class="hljs-number">1e-3</span></span>), metrics=[my_iou_metric]) model.load_weights(<span class="hljs-string"><span class="hljs-string">'./keras.weights'</span></span>, by_name=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: history = model.fit(train_x, train_y, batch_size=<span class="hljs-number"><span class="hljs-number">32</span></span>, epochs=<span class="hljs-number"><span class="hljs-number">1</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">1</span></span>, validation_split=<span class="hljs-number"><span class="hljs-number">0.1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> history.history[<span class="hljs-string"><span class="hljs-string">'my_iou_metric'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0.75</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre><br> <code>Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 54s 7ms/step - loss: 0.5005 - my_iou_metric: 0.1296 - val_loss: 0.1692 - val_my_iou_metric: 0.3722 <br> Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 52s 7ms/step - loss: 0.1287 - my_iou_metric: 0.4522 - val_loss: 0.0449 - val_my_iou_metric: 0.6833 <br> Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 52s 7ms/step - loss: 0.0759 - my_iou_metric: 0.5985 - val_loss: 0.0397 - val_my_iou_metric: 0.7215 <br> Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 52s 7ms/step - loss: 0.0455 - my_iou_metric: 0.6936 - val_loss: 0.0297 - val_my_iou_metric: 0.7304 <br> Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 52s 7ms/step - loss: 0.0432 - my_iou_metric: 0.7053 - val_loss: 0.0215 - val_my_iou_metric: 0.7846 <br> Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 53s 7ms/step - loss: 0.0327 - my_iou_metric: 0.7417 - val_loss: 0.0171 - val_my_iou_metric: 0.7970 <br> Train on 7372 samples, validate on 820 samples <br> Epoch 1/1 <br> 7372/7372 [==============================] - 52s 7ms/step - loss: 0.0265 - my_iou_metric: 0.7679 - val_loss: 0.0138 - val_my_iou_metric: 0.8280</code> <br> <br><h3>  рдкрд░рд┐рдгрд╛рдо </h3><br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдиреЗрдЯрд╡рд░реНрдХ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд╕реЗрдЯ рдкрд░ 0.828 рдХреА рд╕рдЯреАрдХрддрд╛ рдХреЗ рд╕рд╛рде рдирд┐рдпрдорд┐рдд рд╣реЗрдкреНрдЯреИрдЧрди рдФрд░ рдордирдорд╛рдиреЗ рдврдВрдЧ рд╕реЗ рдЪрддреБрд╖реНрдХреЛрдгреАрдп рдмрд╣реБрднреБрдЬреЛрдВ рдХреЗ рдЕрдиреБрдорд╛рдиреЛрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рддрд╛ рд╣реИред  рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЛ 0.75 рдХреЗ рдордирдорд╛рдиреЗ рдореВрд▓реНрдп рд╕реЗ рд░реЛрдХрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╕рдЯреАрдХрддрд╛ рдмреЗрд╣рддрд░ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред  рдпрджрд┐ рд╣рдо рдЙрд╕ рдереАрд╕рд┐рд╕ рд╕реЗ рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВ рдЬреЛ рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡реНрд╕ рдХреЛ рдвреВрдВрдврддрд╛ рд╣реИ рдФрд░ рдЙрдирдХреЗ рд╕рдВрдпреЛрдЬрди рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдкреГрд╖реНрдарднреВрдорд┐ рд╕реЗ рдПрдХ рдЕрд▓рдЧ рдФрд╕рдд рдХреЗ рд╕рд╛рде рджреЛ рдХреНрд╖реЗрддреНрд░ рд╣реИрдВ, рдордиреБрд╖реНрдп рдХреА рд╕рдордЭ рдореЗрдВ рдХреЛрдИ рдЖрджрд┐рдо рдирд╣реАрдВ рд╣реИрдВред  рдХреЛрдИ рд╕реНрдкрд╖реНрдЯ, рдПрдХ-рд░рдВрдЧ рдХреА рд░реЗрдЦрд╛рдПрдВ рдирд╣реАрдВ рд╣реИрдВ, рдФрд░ рдХреНрд░рдорд╢рдГ рдХреЛрдИ рдХреЛрдиреЗ рдирд╣реАрдВ рд╣реИрдВ, рдХреЗрд╡рд▓ рдмрд╣реБрдд рд╕рдорд╛рди рд╕реАрдорд╛рдУрдВ рд╡рд╛рд▓реЗ рдХреНрд╖реЗрддреНрд░ рд╣реИрдВред  рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЕрдЧрд░ рдЖрдк рд▓рд╛рдЗрдиреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рддрд╕реНрд╡реАрд░ рдореЗрдВ рджреЛрдиреЛрдВ рдСрдмреНрдЬреЗрдХреНрдЯ рдПрдХ рд╣реА рдЖрджрд┐рдо рд╕реЗ рдирд┐рд░реНрдорд┐рдд рд╣реЛрддреЗ рд╣реИрдВред <br><br>  рдкрд╛рд░рдЦреА рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рд╢реНрди - рдиреЗрдЯрд╡рд░реНрдХ рдХреНрдпрд╛ рд╕рдВрдХреЗрдд рдорд╛рдирддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╡рд╣ "рдиреМрдХрд╛рдУрдВ" рдХреЛ "рд╣рд╕реНрддрдХреНрд╖реЗрдк" рд╕реЗ рдЕрд▓рдЧ рдХрд░рддрд╛ рд╣реИ?  рдЬрд╛рд╣рд┐рд░ рд╣реИ, рдпрд╣ рдирд╛рд╡реЛрдВ рдХреА рд╕реАрдорд╛рдУрдВ рдХрд╛ рд░рдВрдЧ рдпрд╛ рдЖрдХрд╛рд░ рдирд╣реАрдВ рд╣реИред  рдмреЗрд╢рдХ, рд╣рдо рдЖрдЧреЗ "рд╕рдореБрджреНрд░реА" / "рдЬрд╣рд╛рдЬреЛрдВ" рдХреЗ рдЗрд╕ рдЕрдореВрд░реНрдд рдирд┐рд░реНрдорд╛рдг рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдо рд╡рд┐рдЬреНрдЮрд╛рди рдЕрдХрд╛рджрдореА рдирд╣реАрдВ рд╣реИрдВ рдФрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЬрд┐рдЬреНрдЮрд╛рд╕рд╛ рд╕реЗ рдЕрдиреБрд╕рдВрдзрд╛рди рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдо рд╣реЗрдкреНрдЯреИрдЧрдиреНрд╕ рдХреЛ рдСрдХреНрдЯрд╛рдЧреЙрди рдореЗрдВ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдирд┐рдпрдорд┐рдд рдкрд╛рдВрдЪ рдФрд░ рдЫрд╣ рдХреЛрдгреЛрдВ рд╕реЗ рдЪрд┐рддреНрд░ рднрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЙрдирдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдЕрд▓рдЧ рд╣реИ рдпрд╛ рдирд╣реАрдВред  рдореИрдВ рдЗрд╕реЗ рдкрд╛рдардХреЛрдВ рдХреЗ рд▓рд┐рдП рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реВрдВ - рд╣рд╛рд▓рд╛рдВрдХрд┐ рдореБрдЭреЗ рдпрд╣ рднреА рдЖрд╢реНрдЪрд░реНрдп рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдмрд╣реБрднреБрдЬ рдХреЗ рдХреЛрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП, рддрд╕реНрд╡реАрд░ рдореЗрдВ рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдмрд╣реБрднреБрдЬ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдЙрдирдХреЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЕрдиреБрдорд╛рдиреЛрдВ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░реЗрдВред <br><br>  рдРрд╕реА рдиреМрдХрд╛рдУрдВ рдХреЗ рдХреЛрдИ рдЕрдиреНрдп рджрд┐рд▓рдЪрд╕реНрдк рдЧреБрдг рдирд╣реАрдВ рд╣реИрдВ, рдФрд░ рдЗрд╕ рддрд░рд╣ рдХреЗ рдкреНрд░рдпреЛрдЧ рдЙрдкрдпреЛрдЧреА рд╣реИрдВ рдХрд┐ рд╣рдо рд╕реНрд╡рдпрдВ рдЕрдзреНрдпрдпрди рдХрд┐рдП рдЧрдП рд╕реЗрдЯ рдХреА рд╕рднреА рд╕рдВрднрд╛рд╡реНрдп рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЕрдзреНрдпрдпрди рдХрд┐рдП рдЧрдП рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд╡реНрдпрд╡рд╣рд╛рд░ рдЬреНрдЮрд╛рди рдХреЛ рдЬреЛрдбрд╝реЗрдВрдЧреЗ рдФрд░ рд▓рд╛рдн рд▓рд╛рдПрдВрдЧреЗред <br><br>  рдмреЗрддрд░рддреАрдм рдврдВрдЧ рд╕реЗ рдЪрдпрдирд┐рдд рдкреГрд╖реНрдарднреВрдорд┐, рд░рдВрдЧ рдХрд╛ рдЪрдпрди рдмреЗрддрд░рддреАрдм рдврдВрдЧ рд╕реЗ, рдирд╛рд╡ / рджреАрд░реНрдШрд╡реГрддреНрдд рд╕реНрдерд╛рди рдХреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЪреБрдирд╛ рдЧрдпрд╛ред  рддрд╕реНрд╡реАрд░реЛрдВ рдореЗрдВ рдХреЛрдИ рд░реЗрдЦрд╛рдПрдВ рдирд╣реАрдВ рд╣реИрдВ, рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рд╡рд╛рд▓реЗ рдХреНрд╖реЗрддреНрд░ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдПрдХ-рд░рдВрдЧ рдХреА рд░реЗрдЦрд╛рдПрдВ рдирд╣реАрдВ рд╣реИрдВ!  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рд╕рд░рд▓реАрдХрд░рдг рд╣реИрдВ рдФрд░ рдХрд╛рд░реНрдп рдЖрдЧреЗ рдЬрдЯрд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ - рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, 0.0 ... 0.9 рдФрд░ 0.1 ... 1.0 рдЬреИрд╕реЗ рд░рдВрдЧ рдЪреБрдиреЗрдВ - рд▓реЗрдХрд┐рди рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдЕрдВрддрд░ рдирд╣реАрдВ рд╣реИред  рдиреЗрдЯрд╡рд░реНрдХ рдЙрди рдкреИрдЯрд░реНрдиреЛрдВ рдХреЛ рдЦреЛрдЬ рдФрд░ рдвреВрдВрдв рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЙрди рд▓реЛрдЧреЛрдВ рд╕реЗ рдЕрд▓рдЧ рд╣реИрдВ рдЬреЛ рдПрдХ рд╡реНрдпрдХреНрддрд┐ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рджреЗрдЦрддрд╛ рд╣реИ рдФрд░ рдкрд╛рддрд╛ рд╣реИред <br><br>  рдпрджрд┐ рдкрд╛рдардХреЛрдВ рдореЗрдВ рд╕реЗ рдХреЛрдИ рднреА рджрд┐рд▓рдЪрд╕реНрдкреА рд░рдЦрддрд╛ рд╣реИ, рддреЛ рдЖрдк рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рд╢реЛрдз рдХрд░рдирд╛ рдФрд░ рдЪреБрдирдирд╛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдЧрд░ рд╡рд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдпрд╛ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ, рдпрд╛ рдпрджрд┐ рдХреЛрдИ рдирдпрд╛ рдФрд░ рдЕрдЪреНрдЫрд╛ рд╡рд┐рдЪрд╛рд░ рдкреНрд░рдХрдЯ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреА рд╕реБрдВрджрд░рддрд╛ рдХреЗ рд╕рд╛рде рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЖрдк рд╣рдореЗрд╢рд╛ рд╣рдорд╛рд░реЗ рд╕рд╛рде рд╕рд╛рдЭрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рд╕реНрд╡рд╛рдореА (рдФрд░ рджрд╛рджреА) рд╕реЗ рднреА рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ ODS рд╕рдореБрджрд╛рдп рдореЗрдВ рдпреЛрдЧреНрдп рдорджрдж рдХреЗ рд▓рд┐рдП рдкреВрдЫреЗрдВред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi431512/">https://habr.com/ru/post/hi431512/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi431502/index.html">IOS рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛрд▓реЗрд╕ рдореЛрдмрд╛рдЗрд▓ 3.0 рдХреЗ рд▓рд┐рдП рд╕рдореНрдореЗрд▓рдиред рд╡реАрдбрд┐рдпреЛ рд░рд┐рдкреЛрд░реНрдЯ</a></li>
<li><a href="../hi431504/index.html">рдлрд╝рд┐рд╢рд┐рдВрдЧ - рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред IPhone X рдХреА рдЪреЛрд░реА рдХреЗ рдХреНрд░реЙрдирд┐рдХрд▓ рдЙрд╕рдХреЗ рдмрд╛рдж рдЖрдИрдХреНрд▓рд╛рдЙрдб рдбреЗрдЯрд╛ рдЪреЛрд░реА</a></li>
<li><a href="../hi431506/index.html">LLDB рдореЗрдВ Xcode рдФрд░ рдЙрдиреНрдирдд рдбрд┐рдмрдЧрд┐рдВрдЧ: рднрд╛рдЧ 1</a></li>
<li><a href="../hi431508/index.html">рд╡рд╕рдВрдд рдореЗрдВ рдХреБрд╢рд▓ рд▓реЗрдирджреЗрди рдкреНрд░рдмрдВрдзрди</a></li>
<li><a href="../hi431510/index.html">рдХрдВрдЯреВрд░ рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдХреИрд╕реЗ рдПрдХрддреНрд░ рдХрд░реЗрдВред рд╕реЗрд▓реЗрдирд┐рдпрдо рдХреЗ рд╕рд╛рде рдЦрд░реАрдж</a></li>
<li><a href="../hi431514/index.html">рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░рдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░</a></li>
<li><a href="../hi431516/index.html">рдПрдХ рджрд┐рди рд╡рд┐рддреНрддреАрдп рд╕рд▓рд╛рд╣рдХрд╛рд░ рдХреЗ рдЬреАрд╡рди рдореЗрдВ</a></li>
<li><a href="../hi431518/index.html">Microsoft рдХрдиреЗрдХреНрдЯ (); рдорд╛рд╕реНрдХреЛ рдореЗрдВ рдореАрдЯрдЕрдк</a></li>
<li><a href="../hi431520/index.html">RFM рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдордВрдерди рдХрд╛ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдПрдВ</a></li>
<li><a href="../hi431524/index.html">рдЬрд╛рд╡рд╛ рдореЗрдВ рдХреНрд░рдорд╛рдВрдХрдиред рдЗрддрдирд╛ рд╕рд░рд▓ рдирд╣реАрдВ рд╣реИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>