<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☝🏿 🏡 😌 Dungeon Generation in Diablo 1 💒 🐘 ♊️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Diablo 1 ist der klassische Roguelike von 1996. Dies war einer der ersten erfolgreichen Versuche, die Massen mit Roguelike bekannt zu machen, das bis ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dungeon Generation in Diablo 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460038/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ac/daa/380/7acdaa38058e3058ff1a6ba9a7ca0ce2.png" alt="Bild"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Diablo 1</a> ist der klassische Roguelike von 1996.  Dies war einer der ersten erfolgreichen Versuche, die Massen mit Roguelike bekannt zu machen, das bis dahin Nischengrafiken in Form von ASCII-Kunst hatte.  Das Spiel brachte mehrere Fortsetzungen und viele Simulationen hervor.  Sie ist bekannt für ihre dunkle, düstere Atmosphäre, die sich verdichtet, wenn der Spieler in die Kerker unter der Stadt Tristram hinabsteigt.  Es war eines der ersten Spiele mit prozeduraler Kartengenerierung für mich, und die Möglichkeit, solch glaubwürdige Levels zu generieren, schockierte mich. <br><br>  Ich habe kürzlich herausgefunden, dass aufgrund der Entdeckung verschiedener Dateien mit Debugging-Symbolen mehrere Fans des Spiels die Aufgabe übernommen haben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, den Quellcode zurückzuentwickeln, um ihn</a> zu bereinigen und herauszufinden, wie der von den Entwicklern geschriebene Code aussieht.  So begann meine einwöchige Exkursion in die Studie, wie der Hauptentwickler David Brevik diese Level erstellt hat.  Vielleicht ist deshalb die Magie des Spiels für mich teilweise zusammengebrochen, aber ich habe viele Techniken gelernt, die für Entwickler ähnlicher Spiele nützlich sein werden, also werde ich sie in diesem Artikel teilen. <br><br>  Vielen Dank an David Brevik und das Blizard North-Team für die Erstellung eines so großartigen Spiels sowie an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">galaxyhaxz</a> und das Devilution-Team für ihre großartige Arbeit bei der Wiederherstellung des lesbaren Quellcodes des Projekts. <br><a name="habracut"></a><br><h1>  Einführung </h1><br>  Diablo ist ein Spiel, das aus isometrischen Kacheln besteht.  Das Spiel besteht aus 4 Stufen, von denen jede 4 Stufen hat.  Spielphasen: Kathedrale, Katakomben, Höhlen und Hölle.  Es gibt auch mehrere feste Ebenen, zum Beispiel die Stadt Tristram, die ich in dem Artikel nicht berücksichtigen werde.  Diablo hat separate Level-Generierungsverfahren für jede der 4 Stufen, daher werde ich zuerst auf ihre Funktionen eingehen und dann den Betrieb jeder der Stufen separat betrachten. <br><br>  Ich war nur daran interessiert, wie die Levels generiert wurden.  Erfahren Sie mehr über Quests, Monster usw.  Ich empfehle, den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jarulf-Leitfaden zu Diablo und Hellfire zu</a> lesen, in dem diese Aspekte ausführlich beschrieben werden. <br><br><h1>  Allgemeine Funktionen </h1><br>  Obwohl jede Stufe einen eigenen Pegelgenerator hat, haben sie alle gemeinsame Merkmale. <br><br><h2>  Dungeons und Kacheln </h2><br>  Jedes Level des Spiels wird generiert, um ein Raster von 40 x 40 Plättchen zu füllen.  Die X-Achse entspricht dem Südosten und die Y-Achse entspricht dem Südwesten. <br><br>  Diese Kacheln werden nur für Aufgaben zur Ebenengenerierung verwendet.  Nach dem Erstellen eines Levels wird jedes Plättchen in 4 "Dungeonfragmente" unterteilt, die auf dem Bildschirm gerendert werden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aac/af2/49b/aacaf249b2356c104c27fb93a053b87a.png"></div><br>  Dieses detailliertere Raster wird verwendet, um durchquerte Kacheln zu bestimmen, und bietet auch eine effizientere Wiederverwendung des Grafikspeichers.  Früher habe ich über <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kachelaufteilungsschemata geschrieben</a> . <br><br>  Dies bedeutet, dass die Standard-Diablo-Karte aus mehr als hundert Kacheln besteht, von denen viele geringfügige Abweichungen von anderen sind, um alle möglichen Verbindungsmethoden zu berücksichtigen.  Wir werden später darüber sprechen. <br><br>  Zu meiner Überraschung bestehen Dungeon-Karten im Gegensatz zu anderen Spielen dieser Serie nicht aus vorgefertigten Blöcken.  Fast alles wird mithilfe von Algorithmen erstellt. <br><br><h2>  Mehrstufiger Prozess </h2><br>  Jede Dungeon-Generierungsprozedur ist in zwei Stufen unterteilt.  Die Vorgeneration befasst sich überhaupt nicht mit der Auswahl von Fliesen.  Es wird einfach ein Array generiert, in dem begehbare Kacheln, Kacheln mit Türen und einige andere Details auf hoher Ebene markiert sind.  In der zweiten Phase wird dieser Dungeon-Rohling in eine Reihe von Kacheln umgewandelt. Anschließend wird eine Generierung durchgeführt und unter Berücksichtigung dieser Kacheln werden Änderungen vorgenommen. <br><br>  Dies sollte für den Designer unglaublich praktisch sein.  Sie können mit einem Grundriss experimentieren, der völlig unabhängig von der Wahl der Fliesen und des Stils ist.  In vielen Fällen sind sie jedoch miteinander verbunden und bieten ein ganzheitlicheres Gefühl für die Ebene. <br><br>  Alle Phasen der Erstellung von Dungeon-Rohlingen beginnen mit einem Level, das mit fester „Härte“ gefüllt ist. Danach verwandeln sich die einzelnen Teile des Levels rekursiv in Bodenfliesen.  Ich werde dies weiter unten genauer diskutieren. <br><br><h2>  Fertige Fragmente </h2><br>  Fertige Fragmente sind vorab erstellte Ebenenblöcke, die einfach in eine zufällig generierte Ebene eingefügt werden.  Sie werden für die meisten Spielquests verwendet.  Auf jeder Ebene kann es nur ein fertiges Fragment geben, dessen Position in jeder Phase separat ausgewählt wird. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fef/c34/5c5/fefc345c546569296a0e1059c6a2bbbb.gif"></div><br>  <i>Butcher's Den ist eines der ersten vorgefertigten Schnipsel im Spiel.</i> <br><br><h2>  Mini-Sets </h2><br>  Mini-Kits sind eine weitere Möglichkeit, Inhalte in eine Ebene vorab erstellter Inhalte einzufügen.  Dies sind kleine Stücke, normalerweise ungefähr 3 × 3 groß, die zufällig in den Kerker eingeführt werden.  Es gibt ein einfaches Mustervergleichsschema, dank dessen sie nur an den „richtigen“ Stellen erscheinen.  Oft sind sie mit zusätzlichen Anforderungen codiert, z. B. können Mini-Sets nicht nahe beieinander platziert werden, sie können sich nicht mit vorgefertigten Fragmenten überlappen und so weiter.  Einige Mini-Kits suchen und ersetzen immer, während andere dies mit einer festen Wahrscheinlichkeit tun. <br><br>  Diablo Mini Kits werden für viele verschiedene Zwecke verwendet.  Sie werden verwendet, um große Objekte von Kacheln wie Treppen zu platzieren, Kombinationen von Kacheln zu fixieren, die nicht gut miteinander verbunden sind, und um Kacheln zufällige Variationen hinzuzufügen. <br><br><h2>  Thematische Räume </h2><br>  Themenzimmer sind kleine Räume, die von einer Wand und einer Tür begrenzt werden.  Normalerweise befinden sich in ihnen auf zufällige Weise bestimmte vorbestimmte Objekte.  Zum Beispiel haben Bibliotheken immer ein Bücherregal mit zwei Kerzen auf jeder Seite, mehreren zufälligen Buchstützen und Monstern.  Monster Lairs enthalten viele Monster und einen zufälligen Gegenstand und so weiter. <br><br>  Auf den Ebenen der Kathedrale schafft der Generator geeignete Räume, die durch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Füllen</a> erkannt und wiederverwendet werden.  In anderen Phasen findet der Algorithmus offene Räume, in denen Wände und eine Tür gezeichnet werden, um Räume zu schaffen. <br><br>  Jeder thematische Raumtyp hat bestimmte Anforderungen an die Größe und das Stadium, in dem er erzeugt wird. <br><br><h2>  Fliesenersatz </h2><br>  Einige Karten haben eine spezielle Anpassung der Kacheln, aber alle haben ein gemeinsames Merkmal: Einige Kacheln können durch ähnliche Variationen ersetzt werden.  Die gängigsten Fliesen (z. B. Böden und flache Wände) weisen verschiedene Variationen auf, die die Monotonie des Levels verringern.  Fliesenwechsel werden niemals nebeneinander wiederverwendet. <br><br><h2>  Vergleich von Mustern und „Korrekturen“ </h2><br>  Wie oben erwähnt, werden Mini-Sets als Such- und Ersetzungsmechanismus verwendet, der Generatorfehler korrigiert.  In den meisten Phasen gibt es jedoch Verfahren, mit denen spezifischere Probleme erkannt und behoben werden können.  Ich werde nicht auf Details eingehen, weil es nur ein paar davon gibt.  Es genügt zu sagen, dass Diablo ziemlich fehlerhaft ist, und näher an der Veröffentlichung wurde klar, dass es einfacher wäre, bestimmte Probleme zu erkennen, als ihre grundlegenden Ursachen zu beseitigen. <br><br>  Eine der häufigsten "Korrekturen" war die "Aussperrung": Sie überprüfte, ob es möglich war, den gesamten Dungeon zu durchlaufen, und startete die Generierung erneut, wenn dies nicht der Fall war. <br><br><h2>  Quests </h2><br>  Die meisten Quests wurden mit vorgefertigten Fragmenten erstellt, aber einige verwendeten ihre eigene Logik.  Zum Beispiel generiert Zhar the Mad thematische Bibliotheksräume, der Eingang zu Poisoned Water wird durch Mini-Dialing generiert und Anvil of Fury verfügt über einen bestimmten Code zur Generierung von Ebenen.  Ich werde nicht auf Details eingehen, aber der Code ist voll von ähnlichen Prüfungen für Quests. <br><br><h1>  Kathedrale </h1><br>  Die Kathedrale ist wahrscheinlich die kultigste der Bühnen von Diablo.  Es zeichnet sich durch lange Reihen gotischer Bögen, beengte Räume und viele Engpässe in Form von Türen aus.  Mal sehen, wie es erstellt wurde. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/68a/04e/c56/68a04ec568d05dac4c8f8c2040d68680.png" alt="Bild"></div><br><h2>  Dungeon leer </h2><br>  Der Algorithmus zeichnet als erstes den Kern der Karte.  Er wählt zufällig bis zu drei Räume 10 × 10 in vorbestimmten Positionen entlang der Mittelachse X oder Y aus. Ein breiter Korridor, der die Räume verbindet, wird ebenfalls entlang der Achse gezeichnet.  Befindet sich auf der Ebene ein fertiges Fragment, befindet es sich immer in der Mitte eines dieser Räume.  Diese zentralen Kerkerräume sind für neue Wände als ungeeignet gekennzeichnet, so dass sie immer große Freiflächen bleiben. <br><br>  Alle anderen Räume werden durch die rekursive Knospungstechnik in einer Funktion namens <code>L5roomGen</code> , die in jedem dieser Räume ausgelöst wird, und durch Auswahl einer Achse. <br><br><h3>  L5roomGen-Funktion </h3><br><ul><li>  Sie passiert das Rechteck des ursprünglichen Raums, von dem aus Sie mit dem Knospen beginnen müssen, sowie die bevorzugte Achse. </li><li>  Mit einer Wahrscheinlichkeit von 1/4 ändert sich die bevorzugte Achse. </li><li>  Die zufällige Größe des neuen Raums wird mit 2, 4 oder 6 Kacheln auf jeder Seite ausgewählt. </li><li>  Für jede Seite des ursprünglichen Raums entlang der ausgewählten Achse (d. H. SE / NS für X, SW / NE für Y): <br><ul><li>  Das Rechteck des neuen Raums richtet sich nach der Mitte des Randes des ursprünglichen Raums </li><li>  Es wird überprüft, dass zuvor nichts gezeichnet wurde und wir das Ende der Karte nicht erreicht haben.  Wände erfordern einen Rand von einer Fliese. </li><li>  Wenn die Prüfung erfolgreich ist, wird ein Raum gezogen. </li></ul></li><li>  Für jeden zu <code>L5roomGen</code> Raum wird <code>L5roomGen</code> rekursiv aufgerufen, wobei der neue Raum und die Achse gegenüber der zuvor verwendeten Achse <code>L5roomGen</code> . </li></ul><br>  Letztendlich beginnt dieser Vorgang mit mehreren Räumen, die innerhalb der "harten" Kacheln ausgeschnitten sind, und klebt dann wiederholt neue Rechtecke, um neue passierbare Bereiche auszuschneiden.  Zu diesem Zeitpunkt sind alle "Räume" auf einer Seite geöffnet, da sich jeder neue Raum direkt neben dem vorherigen befindet, ohne Pässe zum Platzieren von Wänden. <br><br>  Dann berechnet der Generator die Anzahl der erzeugten durchquerten Kacheln.  Wenn es unter dem Mindestschwellenwert liegt, der mit jedem Level zunimmt, wird der Dungeon zerstört und der Generierungsversuch erneut ausgeführt. <br><br><h2>  Dungeon </h2><br>  Bisher hat der Algorithmus nur die "festen" und geschlechtsspezifischen Kacheln.  Wir müssen sie durch echte Wandfliesen ersetzen.  Zu diesem Zweck verwendet Diablo den Marschquadrat-Algorithmus, den ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in einem früheren Artikel beschrieben habe</a> . <br><br>  Das Spiel nutzt jedoch seine ungewöhnliche Variation.  Das Kachelset der Kathedrale enthält Wände, die sich jedoch immer am äußersten Rand der Kachel befinden.  Daher gibt es eine Fliese mit einer Wand am Nordostrand, aber keine Fliesen mit einer Wand am Südostrand.  Um Wände auf anderen Seiten zu erstellen, müssen Sie eine „feste“ Kachel mit einer zusätzlichen Wand finden, die sich vom Rand der Kachel nach außen erstreckt.  Es klingt seltsam, ist aber sehr praktisch, um Wände nach Tiefe zu sortieren. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b65/14b/193/b6514b19377666d0c7b06bf76002dd08.svg"></div><br>  Um dies zu bewältigen, überspringt Diablo während der Marschwürfelphase einige Wände: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/553/284/1c2/5532841c2542510b979e4dae6dee2183.svg"></div><br>  Zusätzliche Wände werden später in der Phase „Fixes“ hinzugefügt.  Ich denke, dieses einfache Verfahren beeinflusst am meisten den "Stil" der Kathedrale.  Da die gegenüberliegenden Wände an massiven Fliesen befestigt sind, wird bei zwei durch eine Wandfliese getrennten Räumen die gegenüberliegende Wand einfach nicht erzeugt.  Dies bedeutet, dass die Trennwände zwischen den Räumen "dünner" sind, als Sie normalerweise in der Auflösung erhalten können, mit der Marschquadrate ausgeführt werden. <br><br>  Nach dem Platzieren der Hauptwände fügt der Generator jedem der zentralen Räume vier freistehende Säulen und eine Kolonnade von Bögen für den zentralen Korridor hinzu.  Auf diese Weise können Sie der Kathedrale ein besseres Gefühl für Design vermitteln als auf anderen Ebenen und den Spielern die Navigation erleichtern. <br><br>  Der Generator fügt dann zufällig Trennwände hinzu.  Trennwände verlaufen immer entlang der Achse von einer Wand zur anderen.  Sie beginnen an den Ecken, sodass die Bereiche wunderschön in Räume unterteilt sind.  In 25% der Fälle besteht eine Wand aus einer Reihe von Bögen, in 25% der Fälle aus einer Reihe von Bögen mit einem Gitter, das den Eingang blockiert, und in allen anderen Fällen handelt es sich um eine feste Wand.  Bei Gittern und festen Wänden wird irgendwo entlang der Trennwand zufällig eine Tür oder ein Bogen hinzugefügt, um den Raum passierbar zu machen. <br><br>  Das Füllverfahren erkennt potenzielle Themenräume. <br><br>  Treppen werden platziert, um eine Verbindung zu anderen Ebenen herzustellen.  Wenn es unmöglich ist, sie zu platzieren, beginnt der Versuch, den Dungeon zu generieren, von neuem. <br><br>  Die Anordnung von Mini-Sets, "Korrekturen" und Ersetzungen werde ich nicht im Detail betrachten.  Am allermeisten liebe ich das PANCREAS1 Mini-Kit, das eine 1% ige Chance hat, einen Haufen blutigen Fleisches auf die Bodenfliese zu legen.  Am Ende werden 5-10 Lampenobjekte darauf platziert, um den Dungeon zu dekorieren. <br><br><h1>  Katakomben </h1><br>  Im Gegensatz zur Kathedrale, die ein entworfenes Gebäude zu sein scheint, fühlen sich Katakomben viel spontaner an.  Sie zeichnen sich durch quadratische Räume aus, die durch viele gewundene Korridore miteinander verbunden sind.  An vielen Stellen befinden sich anstelle von Türen breite Öffnungen.  Erhöhen der Wahrscheinlichkeit, dass der Spieler von vielen Feinden umgeben ist. <br><br>  Der komplexeste Generierungsalgorithmus im Spiel wurde verwendet, um Katakomben zu generieren.  Ich vermute, dass der Zeitmangel die Entwickler gezwungen hat, in späteren Phasen einfachere Lösungen anzuwenden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/086/22d/49e/08622d49e3f39ea4fca7d81a67393183.jpg" alt="Bild"></div><br><h2>  Dungeon leer </h2><br>  Das Verfahren zum Erstellen eines Dungeon-Rohlings für Katakomben ist ziemlich einzigartig.  In allen anderen Phasen gibt es einen einzelnen Booleschen Wert, der das Vorhandensein oder Fehlen von Geschlecht anzeigt (plus eine Reihe von Bits für zusätzliche Details).  Katakomben speichern den Dungeon Blank in Form einer ASCII-Karte, fast wie ein klassisches Roguelike.  Und dies ist nicht besonders überraschend angesichts <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">des</a> Eingeständnisses von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">David Brevik, dass er sich von Angband für Diablo inspirieren ließ</a> . <br><br>  Der Hauptraumgenerator ist wieder ein rekursiver Algorithmus, diesmal jedoch eine rekursive Partition.  Die <code>CreateRoom</code> Funktion <code>CreateRoom</code> für den gesamten Dungeonbereich von 40 × 40 minus 1 <code>CreateRoom</code> aufgerufen. <br><br><h3>  CreateRoom-Funktion </h3><br><ul><li>  Der <code>CreateRoom</code> Funktion <code>CreateRoom</code> ein Rechteck übergeben, das den Bereich angibt, in dem Sie Räume generieren möchten.  Details über den ursprünglichen Raum werden ebenfalls an die Funktion übergeben (anfänglich null). </li><li>  Wenn der Bereich zu eng ist, wird die Funktion beendet. </li><li>  Für den Raum wird eine zufällige Größe von 4 bis 9 Kacheln auf jeder Seite ausgewählt, wobei die maximale Größe des Bereichs berücksichtigt wird, in dem Sie den Raum platzieren möchten. </li><li>  In dem Bereich wird eine zufällige Position ausgewählt, um den Raum zu platzieren. </li><li>  Der Raum wird auf einer ASCII-Karte gerendert.  In der Abbildung das Symbol <code>'.'</code>  Bodenfliesen sind angegeben, das Symbol <code>'#'</code> ist die umgebende Wand und die Buchstaben <code>'A'</code> , <code>'B'</code> , <code>'C'</code> und <code>'E'</code> sind die vier Ecken. </li><li>  Wenn ein Raum einen Quellraum hat: <br><ul><li>  An den nächsten Rändern des ursprünglichen und des neuen Raums wird eine zufällige Kachel ausgewählt. </li><li>  Diese Informationen werden in der Korridorliste aufgezeichnet, die später verwendet wird. </li></ul></li><li>  Die verbleibenden Teile des Bereichs, mit Ausnahme des aktuellen Raums, werden ausgeschnitten, wodurch vier Rechtecke entstehen. </li><li>  Die Größe jedes Rechtecks ​​wird um zwei Kacheln reduziert, um einen Raum zwischen den Räumen zu schaffen. Anschließend wird die Funktion <code>CreateRoom</code> rekursiv aufgerufen, der Bereich, für den dieses Rechteck verwendet wird, und der erstellte Raum als Quelle. </li></ul><br>  Wenn sich auf der Karte ein fertiges Fragment befindet, befindet es sich immer im ersten von CreateRoom erstellten Raum, und seine Abmessungen werden so festgelegt, dass dieses Fragment darin platziert wird. <br><br>  Nach dem Aufruf von <code>CreateRoom</code> ein ASCII-Array ähnlich dem unten gezeigten (danke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nomdenom</a> für das Extrahieren aus dem Code): <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>#<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #..# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>###<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #..# #....# #..# #....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>#<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>###<span class="hljs-selector-id"><span class="hljs-selector-id">#EA</span></span>####<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #.....# #.....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>#######<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #.....# #........# #.....# #........# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>####<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #........# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #........# #.# #........# #.# #........# #.# #........# #.# #........# #.# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>#######<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #.# #.# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#BC</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #.# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>###<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #.# #....# #.# #....# #.# #....# #.# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>###<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #.# #.# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>####<span class="hljs-selector-id"><span class="hljs-selector-id">#BC</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #.....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>##<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #.....# #...# #.....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>##<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #.....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>####<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span></code> </pre><br>  In diesem Fall war der ursprünglich erstellte „Root“ -Raum der niedrigste. <br><br>  Dann werden die zuvor gesammelten Korridorinformationen angewendet.  Zwischen jedem aufgezeichneten Punktpaar wird eine Linie gezogen.  Wenn es eine Wand überquert, wird <code>'D'</code> geschrieben, und wenn es eine feste Kachel überquert, wird <code>','</code> .  Die Korridore haben eine zufällige Breite: 1, 2 oder 3. Eckkacheln dienen zur Unterstützung der Navigation. <br><br>  Wenn die Türen an eine andere Tür angrenzen, werden sie übersprungen, und die Korridore können sich überlappen, wodurch Sie die Einfachheit des Generators verbergen können. <br><br>  Nach dem Aufzeichnen aller Korridore wird die ASCII-Karte gelöscht.  Eckfliesen werden zu Wandfliesen, und Fliesen <code>' '</code> neben <code>','</code> ebenfalls zu Wänden.  Schließlich werden die Zeichen <code>','</code> durch die Zeichen <code>'.'</code>  .  Also bekommen wir den unten gezeigten Dungeonplan. <br><br><pre> <code class="hljs css">#### #..# ###### #..# #....# #..# #....# <span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>## #....# #.# <span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#### #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#### #..# #.....# #..# ###.....# #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>######## #<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.....# #........# #.#.....# #........# ### #.#<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#### #........# #.### #.##...# #........###<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.# #.##...# #........##..#.# #.##...# #........##..#.# #.##...# #........##..#.# #.##...# #........##..#.# #.##...# ##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#######..#.# #.##...# #.......#..#.# #.##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>## ###.....#..### #.# #.# ######<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>##.# #.# #.# #....#.# #.# #.# #...<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.# #.# #.# #....###### #.# #.# #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>####....## #.# #.# #...........# #.# #.# ####....##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>####.# ### ######.....##.# #####<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.....##.# #..<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.#....<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>..# #####.#.....#### #########</code> </pre><br>  Wie Sie sehen können, kann dieses Verfahren ziemlich viel leeren Raum auf der Karte lassen.  Daher ist der nächste Schritt des Generators das „Füllen der Hohlräume“.  Er sucht nach angrenzenden Wandabschnitten, auf die zusätzliche Bodenrechtecke geklebt werden können.  Rechtecke können mindestens 5 × 5 und nicht größer als 12 × 14 sein. <br><br>  Das Füllen der Leere wird fortgesetzt, bis mindestens 700 Kacheln erreicht sind oder die Wiederholungsgrenze erreicht ist.  Wenn der Generator 700 Kacheln nicht erreicht hat, beginnt die Dungeonerzeugung bei Null. <br><br>  Dies gibt uns den unten gezeigten Dungeon Blank. <br><br><pre> <code class="hljs css"> ########## #........# ########### #........# #.........# #........# #.........# #........# #.........# #### #........# #.........# #..# #######..###.........# #..# #..............# #..# #..............# <span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>## #..............# #.# <span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>####.........# #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#### #..# ########### #.....# #..# ###.....# #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>######## #<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.....# #........# #.#.....# ########........# ### #.#<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#### #...............# #.### #.##...# #...............###<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.# #.##...# #...............##..#.# #.##...# #...............##..#.# #.##...# #...............##..#.# #.##...# #...............##..#.# #.##...# #......##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#######..#.# #.##...# #......# #.......#..#.# #.##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>## #......# ###.....#..### #.# #.# #......########<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>##.# #.# #.# #.........# #....#.# #.# #.# #.........# #...<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.# #.# #.# #.........# #....###### #.# #.# #.........# #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>####....## #.# #.# #.........# #...........# #.# #.# #.........# ####....##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>####.# ### #.........# ######.....##.# #.........# #####<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.....##.# #.........# #..<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.#....<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>..# ########### #####.#.....#### #########</code> </pre><br><h2>  Dungeon </h2><br>  Auch hier unterscheiden sich die Katakomben von der Standardformel.  Anstelle des Marschquadrat-Algorithmus (der Kacheln basierend auf 2 × 2 Quadraten des Dungeon-Rohlings zuweist) verwendet er ein eigenes Mustervergleichsverfahren, das jedes der 3 × 3-Rechtecke des Dungeon-Rohlings untersucht und das entsprechende Kachel für den Dungeon auswählt.  Muster bestimmen, wie jedes Dungeonplättchen aussehen soll: eine Wand, ein Boden, eine Tür, ein festes Plättchen oder eine Kombination davon.  Ich verstehe nicht ganz warum. <br><br>  Der Rest der Funktion wird Ihnen aus der Kathedrale bekannt vorkommen.  Treppen auf und ab werden auf der Karte platziert, der Dungeon wird auf die Möglichkeit eines vollständigen Durchgangs überprüft und verschiedene Korrekturen werden ebenfalls durchgeführt.  Wie im Abschnitt Allgemeine Funktionen beschrieben, werden Räume eingefügt, gefolgt von vielen Mini-Sets und Fliesenersatz. <br><br>  Ich denke, dass Mini-Sets irgendwie die Türen beeinflussen, aber es ist ziemlich langweilig, sie ohne Werkzeug zu lesen, deshalb habe ich mich nicht mit diesem Thema befasst. <br><br><h1>  Höhlen </h1><br>  Höhlenebenen sind mit weiten Freiflächen und Lavaströmen gefüllt.  Die Wände dieses Bereichs sind rau und wellig.  Die einzigen rechteckigen Komponenten hier sind Holzgerüste, die anscheinend später als die Höhlen selbst erschienen. <br><br>  Diese Phase ist dank der animierten Lava eine der schönsten im Spiel.  Man fühlt, dass es sich sehr von früheren Ebenen unterscheidet, die aus Räumen bestehen.  Daher war ich sehr überrascht, dass der Hauptteil der Generation nach den Prinzipien der Kathedralenbühne modelliert ist und die Karten mit kniffligen Tricks ein „Höhlen“ -Look erhalten. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9b6/b2c/a41/9b6b2ca41b1a48ad9aebcd9be48ee162.jpg" alt="Bild"></div><br><h2>  Dungeon leer </h2><br>  Das Erstellen einer Höhlenebene beginnt mit einem zufälligen 2 × 2-Raum, der sich irgendwo in der Nähe der Kartenmitte befindet.  Der Generator ruft dann die Prozedur <code>DRLG_L3CreateBlock</code> für jede Kante dieses Blocks auf. <br><br>  Beim Zeichnen von Rechtecken auf dieser Ebene wird keine normale Füllung verwendet.  Die Innenräume sind immer solide, aber jede Fliese an der Grenze hat eine 50% ige Chance, ein Boden zu werden, sonst bleibt sie solide. <br><br><h3>  DRLG_L3CreateBlock-Prozedur </h3><br><ul><li>  Diese Funktion erhält den Rand des Rechtecks, d.h.  Ausgangspunkt, Richtung und Länge. </li><li>  Die Größe des neu erstellten Blocks wird für jede Seite im Bereich von 3-4 ausgewählt. </li><li>  Der neue Block wird zufällig relativ zur Eingangsflanke platziert. </li><li>  Wenn nicht genügend Platz zum Zeichnen eines Blocks vorhanden ist, wird das Beenden ausgeführt. </li><li>  Der Block wird gezeichnet. </li><li>  Mit einer Wahrscheinlichkeit von 1/4 wird die Ausgabe ausgeführt. </li><li>  <code>DRLG_L3CreateBlock</code> wird <code>DRLG_L3CreateBlock</code> für drei Kanten aufgerufen, außer für die, von der wir gekommen sind. </li></ul><br>  Obwohl dieses Verfahren <code>L5roomGen</code> ähnelt, <code>L5roomGen</code> durch die Verwendung viel kleinerer Blockgrößen und das Zeichnen rauer Ränder viel organischer.  Darüber hinaus enthält es keinen Rand von 1 Kachel für Wände, sodass im Gegensatz zu früheren Generatoren Schleifen erstellt werden können. <br><br>  Nach dem Erstellen einer groben Skizze der Dungeonform wendet der Generator die Erosionsverfahren an: <br><br><ul><li>  Erstens findet er Bereiche von 2 × 2 Kacheln mit diagonal gegenüberliegenden festen Kacheln.  Es ist oft schwierig, mit solchen Formationen zu arbeiten, wenn Marschquadrate ausgeführt werden, daher wird eine der festen Kacheln zufällig durch das Geschlecht ersetzt. </li><li>  Alle massiven Einzelfliesen, die von 8 Bodenfliesen umgeben sind, werden durch eine Bodenfliese ersetzt. </li><li>  Alle langen und geraden Wandabschnitte werden zufällig aufgeraut, indem 50% der Wände durch Bodenfliesen ersetzt werden. </li><li>  Diagonalen von durchgehenden Kacheln werden wiederholt entfernt. </li></ul><br>  Bei all diesen Verfahren werden mehr Bodenfliesen hinzugefügt, sodass die Karte offener wird. <br><br>  Wenn es weniger als 600 Bodenfliesen hat, wird die Karte neu generiert. <br><br><h2>  Dungeon </h2><br>  Dungeon-Rohlinge werden mithilfe von Marschquadraten in Kacheln umgewandelt.  Im Gegensatz zu Kathedrale und Katakomben ist das Kachelset hier viel praktischer und enthält fast alle Kombinationen, die für Marschplätze benötigt werden.  Es gibt keine Fliesen für diagonal gegenüberliegende Wände, aber sie wurden in der Werkstückphase entfernt, sodass sie nie erscheinen. <br><br>  Dann gibt es wie immer viele Mini-Sets.  Der Code enthält mehrere Mini-Sets, die einen separaten Wandabschnitt definieren und durch Stalagmiten und Böden ersetzen, wodurch die Offenheit der Räume erhöht wird. <br><br>  Lavaseen werden hinzugefügt.  Der Algorithmus sucht mithilfe von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fill</a> nach einem angrenzenden Wandabschnitt.  Wenn es ihm gelingt, einen Abschnitt von Wänden / festen Fliesen mit weniger als 40 Fliesen zu finden, die vollständig von Bodenfliesen umgeben sind, werden sie durch Lava ersetzt.  Wenn der Lavasee nicht gefunden werden kann, beginnt die Erzeugung des Verlieses von neuem. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/282/8a4/716/2828a4716c9319b5399e76ccb04b11a9.png"></div><br>  <i>Eine 3 × 3 Wand verwandelt sich in einen Lavasee</i> <br><br>  Dann werden mehrere Lavaströme hinzugefügt.  Der Generator unternimmt mehrere Versuche, einen Fluss zu zeichnen, der am Lavasee beginnt und an der Wand endet.  Die folgenden Anforderungen werden an den Fluss gestellt: Er sollte sich nicht selbst kreuzen, der Fluss hat eine Länge von 7-100 Kacheln und es sollte ein geeigneter Platz für die Brücke darauf sein.  Das Brückenplättchen sorgt dafür, dass die gesamte Karte passierbar bleibt.  Wenn auf der Karte Platz ist, können bis zu vier Flüsse hinzugefügt werden. <br><br>  Dann werden Themenzimmer platziert.  In diesem Stadium sind die Wände der thematischen Räume Holzzäune, durch die Sie nicht gehen können, aber Sie können beobachten.  Holzzäune werden auch in den beiden folgenden Verfahren verwendet.  Der erste setzt einen Zaun auf alle verbleibenden Abschnitte der Wände mit ziemlich langen geraden Abschnitten.  Der zweite zeichnet eine Reihe von Zäunen auf der Karte von einer Wand zur anderen und setzt dann die Tür ein.  Im Gegensatz zum Verfahren zum Erzeugen einer Kathedrale werden keine Ecken gesucht, um mit dem Erstellen dieser Wände zu beginnen. <br><br><h1>  Hölle </h1><br>  Die Hölle ist die letzte Stufe von Diablo.  Dabei liegt der Schwerpunkt bereits auf Monstern, und die Gestaltung von Levels bleibt auf der Strecke.  Diese Bühne hat das kleinste Kachelset von allen und das meiste davon wird für große Treppen und Pentagramme verwendet.  Die höllischen Ebenen bestehen normalerweise aus mehreren quadratischen Räumen und sind symmetrisch angeordnet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/180/9a3/804/1809a38040316bde51bb114a03f10f99.png" alt="Bild"></div><br><h2>  Dungeon leer </h2><br>  Die Höllengenerierung beginnt mit einem zufälligen Raum von 5-6 Kacheln auf jeder Seite (mehr, wenn es ein fertiges Fragment für die Quest gibt), und dann wird das gleiche rekursive Knospen angewendet wie in der Kathedrale.  Die Erzeugung ist jedoch auf 20 × 20 begrenzt. <br><br>  Ein vertikaler und horizontaler Korridor wird hinzugefügt, der bis zum Rand des 20 × 20-Bereichs gespannt ist. <br><br>  Dann wird der Dungeon-Rohling horizontal und vertikal gespiegelt, um die volle Größe zu erhalten. <br><br><h2>  Dungeon </h2><br>  Dungeon-Rohlinge werden mithilfe von Marschquadraten wieder in Kacheln umgewandelt.  Dann werden ähnlich wie bei der Schaffung der Kathedrale Mauern hinzugefügt, wie in Katakomben und Höhlen. <br><br><h1>  Fazit </h1><br>  Ich habe es wirklich genossen, diesen Code zu lesen.  Obwohl es offensichtlich Fehler gibt, die Namen zufällig zugewiesen werden und einige Teile nicht in qualitativ hochwertigem Quellcode neu erstellt werden können, ist deutlich zu erkennen, dass dieser Code einen ernsthaften Test im Kampf bestanden hat und voller kluger Ideen ist. <br><br>  Hier sind die wichtigsten Lektionen für mich: <br><br><ul><li>  Der Teufel steckt im Detail: Die einzelnen Komponenten sind nicht wahnsinnig komplex, aber wenn sie kombiniert werden, ergeben sie etwas Wunderbares.  Ich kann mir vorstellen, wie die Entwickler über die Verbesserung der Qualität nachgedacht haben, bis sich das Niveau von gut auf erstaunlich geändert hat.  Die Anzahl der Kacheln und die kombinatorische Komplexität der Kachelsätze ist ebenfalls sehr hoch - es ist unmöglich, dies zu implementieren, ohne darauf zu achten, wie die Elemente verbunden sind. </li><li>  Das Suchen und Ersetzen für den Mustervergleich ist ein sehr leistungsfähiges Werkzeug, mit dem Sie viele verschiedene Effekte implementieren können.  Es behebt Generationsfehler, fügt Variabilität hinzu, fügt vorgefertigte Inhalte ein, verwaltet Erosion und vieles mehr. </li><li>  Die Aufteilung der Dungeon-Generierung in die Passabilitätskarte (Dungeon-Vorbereitung) und die Kachel-Generierung ist sowohl in Bezug auf das Design als auch in Bezug auf das Debugging eine sehr bequeme Technik. </li><li>       ,       .      ,         . </li><li>   ,      . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460038/">https://habr.com/ru/post/de460038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460020/index.html">Was ist Deno und wie unterscheidet sich dieses Projekt von Node.js?</a></li>
<li><a href="../de460022/index.html">PHP Digest Nr. 160 (1. - 15. Juli 2019)</a></li>
<li><a href="../de460028/index.html">Problemlösung mit pwnable.kr 04 - flag. Gepackte ausführbare Dateien</a></li>
<li><a href="../de460030/index.html">Native Entwicklung, React Native und Flutter: Auswahlkriterien</a></li>
<li><a href="../de460036/index.html">Alices B2B-Fähigkeit: Vom Prototyp bis zum ersten gespeicherten Rubel</a></li>
<li><a href="../de460040/index.html">Holen Sie sich die USRN-Anweisung von Rosreestr mithilfe von Python unter Umgehung der API</a></li>
<li><a href="../de460044/index.html">Temperaturregelung der Ofenheizung mit Timer auf Arduino</a></li>
<li><a href="../de460046/index.html">Python BDD Framework Vergleich: Vor- und Nachteile</a></li>
<li><a href="../de460048/index.html">Wie wir das Schwachstellenmanagement aufgebaut haben</a></li>
<li><a href="../de460050/index.html">NeoQUEST 2019 von Angesicht zu Angesicht: In der Welt der Cybersicherheit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>