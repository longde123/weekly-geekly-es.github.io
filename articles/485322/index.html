<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüè≠ üë§ ü•ï Hable acerca de PostgreSQL. Entrevista con Alexei Lesovsky en el podcast Zinc Prod. Primera parte ü¶ã üôãüèæ üç¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recientemente, invitamos a Alexei Lesovsky de Data Egret a transmitir Zinc Sale . La conversaci√≥n result√≥ ser interesante e informativa, por lo que le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hable acerca de PostgreSQL. Entrevista con Alexei Lesovsky en el podcast Zinc Prod. Primera parte</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485322/"><blockquote>  Recientemente, invitamos a Alexei Lesovsky de <a href="https://www.dataegret.ru/" rel="nofollow">Data Egret</a> a transmitir <a href="https://soundcloud.com/znprod" rel="nofollow">Zinc Sale</a> .  La conversaci√≥n result√≥ ser interesante e informativa, por lo que le ofrezco la transcripci√≥n de este tema.  Debido al impresionante volumen, fue necesario dividir el texto en pedazos.  Si eres demasiado vago para esperar la continuaci√≥n, puedes escuchar la versi√≥n de audio <a href="https://soundcloud.com/znprod/040-aleksey-lesovskiy-kak-vlyubit-v-sebya-postgres" rel="nofollow">aqu√≠</a> . </blockquote><p>  Hola a todos, este es el cuadrag√©simo n√∫mero del podcast Zinc Prod, y Anton Okolelov, Nikita Vasilchenko y Oleg Gritsak son los anfitriones permanentes con nosotros en el estudio. </p><br><p>  <strong>Anton</strong> : Entonces, hoy tenemos un invitado, Alexey Lesovsky.  Lesha, pres√©ntate, qui√©n eres, qu√© haces, etc. </p><a name="habracut"></a><br><p> <strong>Alexei</strong> : Hola a todos, mi nombre es Alexei Lesovsky, ya que Antokha ya me present√≥.  Estoy administrando Postgres, soy PostgreSQL DBA (administrador de base de datos), trabajo con el inicio de sesi√≥n todos los d√≠as, 7 d√≠as a la semana, y administro bases de datos de clientes.  Tenemos una oficina: es una empresa de consultor√≠a, se dedica a la administraci√≥n, soporte y soporte.  Y personas muy diferentes acuden a nosotros con sus bases de datos, por regla general, son empresas (peque√±as, grandes, peque√±as, todo tipo de diferentes) tienen problemas con la base de datos, analizamos estos problemas y de alguna manera tratamos de solucionarlos.  En realidad, resolvemos los problemas de otras personas, otras compa√±√≠as.  Algo asi. </p><br><p>  Bueno, en mi tiempo libre me gusta hacer cosas diferentes, caminar por el bosque, hacer snowboard, caminar, beber cerveza </p><br><p>  <strong>Anton</strong> : bebe cerveza ahumada </p><br><p>  <strong>Nikita</strong> : antes del lanzamiento, Lyokha habl√≥ sobre la cerveza ahumada </p><br><p>  <strong>Alexei</strong> : s√≠, cerveza ahumada, hay una deliciosa, recomiendo.  Rauchbier Merzen. </p><br><p>  <strong>Anton</strong> : ok, por favor dime, dbshnik, has estado trabajando durante mucho tiempo, varios a√±os.  Que tan dificil es  Te llaman por la noche y te piden que arregles la base.  Te llam√© a las cinco de la ma√±ana hace un a√±o o medio. </p><br><p>  <strong>Alexei</strong> : s√≠, lo era, era un asunto. </p><br><p>  <strong>Anton</strong> : como sobrevives dime </p><br><p>  <strong>Alexey</strong> : escucha, llevo trabajando desde 2014.  Hasta 2014, trabaj√© como administrador de Linux en desarrollo web.  El administrador tiene muchas cosas, ten√≠amos virtualizaci√≥n de kvm, hab√≠a una gran cantidad de Linux, hab√≠a todo tipo de Ruby-on-rails, nginxs, php, rails ... </p><br><p>  <strong>Oleg</strong> : Docker ya ha estado? </p><br><p>  <strong>Alexey</strong> : Docker acaba de comenzar, no lo hemos introducido en ninguna parte de la producci√≥n, pero las tendencias para esto ya han comenzado. </p><br><p>  Y hab√≠a muchos postgres en nuestra oficina.  Luego persegu√≠ un rublo largo y decid√≠ que pod√≠a trabajar en dos trabajos al mismo tiempo.  Y comenz√≥ a trabajar como administrador de forma remota en una oficina de Mosc√∫.  Combin√© dos trabajos, all√≠ solo las bases de datos fueron administradas por Postgresql consulting.  Estaba Max Boguk, Ilya Kosmodemyansky, y como administrador comenc√© a hacer parte de las tareas relacionadas con el saco.  Bueno, es decir  Comenc√© a tomar tranquilamente su pan.  Y en alg√∫n momento, Max me dice esto: escucha y deja que trabajes con nosotros.  Dejar√° todo su trabajo, trabajos a tiempo parcial, vendr√° a nosotros por tiempo completo. </p><br><p>  Bueno, acept√©, no lo dud√©, en principio me ofrecieron un salario comparable, consegu√≠ un trabajo y comenc√© a trabajar desde casa, y ahora desde 2014, resulta que he estado trabajando durante 5 a√±os, trabajo espec√≠ficamente con el padre, bueno, a la antigua usanza de todo tipo de temas administrativos, trabajo con ellos por costumbre.  Es decir  si en nuestra empresa hay un problema con algo que entender desde el lado del administrador, me rechazan, entiendo </p><br><p>  <strong>Anton</strong> : Pero en general, ¬øes necesario saber estas cosas de administraci√≥n?  No solo est√° all√≠, la base est√° en el vac√≠o, est√° girando en alguna parte, necesita configurar el sistema operativo, ¬øverdad? </p><br><p>  <strong>Alexei</strong> : s√≠, s√≠, eso es exactamente porque generalmente depende en gran medida de los subsistemas del sistema operativo, la memoria virtual y la administraci√≥n del disco, es decir.  es como si √©l mismo no operara directamente los recursos, como si descargara todo este trabajo al sistema operativo, y √©l mismo administra la E / S de disco, la administraci√≥n de la p√°gina de memoria, eso es todo, el cambio de proceso y, en consecuencia, si encuentra un cierre de postgres, debe Tambi√©n hay un peque√±o truco en el sistema operativo, c√≥mo funciona todo all√≠ y c√≥mo funciona en la interfaz con postgres. </p><br><p>  Si, por ejemplo, se compara con Oracle, Oracle tiene, por ejemplo, sus propios subsistemas que funcionan con entrada-salida, es decir,  han pasado el sistema operativo, pueden trabajar directamente con el disco, pero en Posgres no es as√≠, necesita saber c√≥mo funciona el sistema operativo con la base de datos. </p><br><p>  <strong>Oleg</strong> : ¬øtuviste que soportar postgres en Windows? </p><br><p>  <strong>Alexei</strong> : s√≠, tuve que hacerlo, tenemos un cliente, est√°n con Windows, servimos a alg√∫n tipo de oficina de San Petersburgo, les hicimos una auditor√≠a de la base de datos.  Su base estaba en Windows, en general daba miedo, nos conectamos a alg√∫n protocolo a trav√©s del protocolo del terminal, Escritorio remoto abierto, lanzamos algunas cosas relacionadas con la grabaci√≥n del rendimiento all√≠.  En resumen, fue dif√≠cil, aterrador, c√≥mo ahora se recuerda un sue√±o terrible.  Y ahora los clientes est√°n b√°sicamente sentados en Linux.  Pr√°cticamente nadie est√° en Windows. </p><br><p>  <strong>Oleg</strong> : ¬øcu√°l es el dolor principal en Postgre que todos pueden notar? </p><br><p>  <strong>Alexey</strong> : mucha gente quiere un autoarchivador y un multimaestro.  Bueno, multimaster, por supuesto, tal cosa, inalcanzable.  Pero todos trabajaron con Galera (con Mysql), y dicen: por qu√©, tambi√©n queremos un multimaster en progreso. </p><br><p>  Bueno, en el progreso hay tales cosas, pero no en el n√∫cleo progresivo en s√≠, hay cosas que implementan el tipo de multimaestro, pero a√∫n no se han producido en absoluto.  Pero la gente quiere un multimaster.  Y la gente tambi√©n quiere un archivador autom√°tico.  Pero ahora, gracias a Dios que Patroni ha aparecido, en Patroni puedes hacer un autoarchivador, la gente lo est√° introduciendo lentamente.  Bueno, en general, desde mi punto de vista, Patroni se ha convertido en el est√°ndar de facto.  Muchas grandes empresas ya lo est√°n implementando.  El mismo Gitlab, recientemente hicieron informes, usan Patroni, est√°n contentos con todo, todos est√°n contentos. </p><br><p>  <strong>Anton</strong> : Escucha, ¬øpuedes decirnos en pocas palabras qu√© clientes son para programadores simples?  Principalmente escuchamos a los l√≠deres de equipo y programadores. </p><br><p>  <strong>Nikita</strong> : espera, ¬øpuedo matarte? Y pedir√© a√∫n m√°s a los no programadores que expliquen qu√© es un multimaster </p><br><p>  <strong>Alexei</strong> : mira, imagina ahora, Antokha es un programador, escribe aplicaciones y la aplicaci√≥n necesita almacenar sus datos en alg√∫n lugar.  Los pone en la base, en la embajada.  En alg√∫n momento, la base de datos se encuentra en un servidor y luego el servidor una vez, y dej√≥ de funcionar.  La fuente de alimentaci√≥n est√° quemada y la aplicaci√≥n necesita continuar trabajando con la base.  Y aqu√≠ surge la opci√≥n de que necesitamos tener alg√∫n tipo de copia de la base de datos y continuar trabajando con ella.  Y cambie a √©l, e idealmente, no haga ning√∫n cambio para que nuestra aplicaci√≥n conozca esta segunda base y contin√∫e escribiendo en ella. </p><br><p>  Esto es en realidad un multimaestro, cuando tenemos varios nodos disponibles para leer y escribir, y nuestra aplicaci√≥n puede trabajar simult√°neamente con ellos y escribir datos en cualquiera de estos nodos y leer datos de estos nodos, pero la naturaleza est√° tan organizada que no se alcanza de manera ideal, y hay pros y contras, hay desventajas, sus propios casos de uso para usar el multimaster.  El ejemplo m√°s com√∫n es que no puede escribir los mismos datos, en t√©rminos relativos, en dos instancias, por ejemplo, trabajar con la misma tabla, escribir en la misma tabla a trav√©s de dos servidores, habr√° conflictos y deben resolverse, esto es un problema por lo tanto, es necesario escribir si escribimos en una tabla, luego escribimos solo a trav√©s de un servidor. </p><br><p>  <strong>Nikita</strong> : y esto est√° directamente relacionado con el ventilador autom√°tico, s√≠, ¬øest√° conectado? </p><br><p>  <strong>Alexei</strong> : s√≠, y esto se debe al auto-fildeador, aqu√≠, por as√≠ decirlo, uno sigue al otro.  Si no podemos permitirnos un multimaster, entonces queremos alg√∫n tipo de mecanismo transparente que cambie el nodo de reserva al modo maestro, es decir.  tenemos una aplicaci√≥n, funciona, y tan pronto como la aplicaci√≥n es eliminada de la base de datos, el desarrollador no quiere cambiar las configuraciones de esta aplicaci√≥n e indicar la nueva direcci√≥n de la base de datos all√≠, reiniciar la aplicaci√≥n, especialmente si hay muchas aplicaciones.  Quiero alg√∫n tipo de mecanismo transparente que funcione en alg√∫n lugar bajo el cap√≥, cambie la base de datos, y nuestra aplicaci√≥n funcionar√° con la misma direcci√≥n y continuar√° leyendo de esta base de datos.  Para hacer esto, ya necesita un archivador autom√°tico que cambie de manera transparente el nodo de repuesto al modo asistente, y para esto Patroni solo se usa </p><br><p>  <strong>Anton</strong> : ¬øPatroni es un interruptor puro o un tenedor de postgres, alg√∫n tipo de complemento? </p><br><p>  <strong>Alexei</strong> : esto, por as√≠ decirlo, es un servicio separado, un proceso separado que se ejecuta en un host con una base de datos.  Y supervisa el estado del cl√∫ster posterior al cl√∫ster.  Aqu√≠ se persiguen dos objetivos: autoajuste y gesti√≥n de cl√∫steres.  Pero en este caso obtenemos un cl√∫ster distribuido, pero tenemos varios nodos en el cl√∫ster, un maestro y varias r√©plicas.  En consecuencia, debe monitorear constantemente el estado del cl√∫ster, ver constantemente si el maestro est√° vivo.  Si muri√≥ repentinamente, debe cambiar al rol de "maestro" de otro servidor.  Y para esto se usa, en general, hay dos enfoques, c√≥mo apoyar este grupo de vistas, la vista en el grupo de c√≥mo deber√≠a vivir en este momento.  Hay una opci√≥n cuando cada uno de los nodos del cl√∫ster se verifican entre s√≠.  Y puede almacenar este estado afuera, es decir  Fuera del c√∫mulo.  Y solo Patroni usa este enfoque, toma y almacena el estado del cl√∫ster en el tercer sistema.  Esto suele ser alg√∫n tipo de DCS (configuraci√≥n del sistema de almacenamiento distribuido).  Puede ser etcd, c√≥nsul, o puede ser kuberenetesovsky etcd.  Es decir  dependiendo de cu√°l sea la infraestructura.  Bueno, en consecuencia, Patroni simplemente guarda un estado de cl√∫ster en este sistema DCS y lo actualiza. </p><br><p>  Si de repente uno de los nodos falla repentinamente, se selecciona un nuevo nodo.  Si este maestro, por ejemplo, se cae, se selecciona un nuevo maestro y este estado se actualiza nuevamente en DCS.  Y aqu√≠ a expensas de DCS Patroni apoya la salud del cl√∫ster. </p><br><p>  <strong>Anton</strong> : ¬øY si la red parpadea entre Patroni y la base? </p><br><p>  <strong>Alexei</strong> : Mira, hay una base de datos, es alg√∫n tipo de servidor o, por ejemplo, en Kubernetes puede ser alg√∫n tipo de servidor.  Considere un caso simple, digamos que este es un servidor.  En el mismo servidor, tenemos una base de datos ejecut√°ndose, y en el mismo servidor ejecutamos el agente Patroni.  Este es un proceso liviano, trabajan en el mismo host y se comunican relativamente hablando en localhost.  Nuestra red puede parpadear entre el repositorio DCS y el host donde trabajan la base y Patroni. </p><br><p>  Puede haber diferentes opciones.  Dependiendo de la gravedad de este parpadeo de la red.  Sucede que si se trataba de un maestro y result√≥ estar aislado, los otros nodos descubrir√°n que el maestro se hab√≠a ido.  Simplemente seleccionar√°n un nuevo maestro, y ver√° el viejo maestro que est√° aislado, y Patroni lo reiniciar√° en modo de solo lectura.  Bueno, para que no haya cerebro dividido.  Es malo si nuestra aplicaci√≥n escribe en dos nodos al mismo tiempo.  Luego, los desarrolladores tendr√°n que rastrillar los datos, y este es un trabajo muy dif√≠cil: recopilar estos datos de forma coherente.  Por lo tanto, el mandril simplemente reinicia el nodo en solo lectura y eso es todo, y funciona.  Tan pronto como se restablezca la red, Patroni podr√° llegar a DCS, coordinar√°n la vista del cl√∫ster m√°s all√° y llegar√°n a alg√∫n tipo de soluci√≥n acordada.  Lo m√°s probable es que este nodo aislado, que era un viejo maestro, se conecte como una r√©plica al nuevo maestro ... </p><br><p>  <strong>Anton</strong>  Bueno, en la pr√°ctica, ¬øc√≥mo funciona?  ¬øHay alg√∫n problema, trampas?  Para que Oleg tome e implemente, por ejemplo, Patroni, debe tomar una decisi√≥n al respecto. </p><br><p>  <strong>Oleg</strong>  Si enseguida </p><br><p>  <strong>Alexey</strong>  Bueno, mira, hemos estado usando Patroni con clientes desde el a√±o pasado.  Tenemos el primer cliente apareci√≥ en mi opini√≥n en noviembre de 2018.  Y en ese momento no ten√≠amos una muy buena idea de c√≥mo trabajar con esto, pero durante el a√±o que trabajamos, en principio, todo nos conviene.  Aprendimos a cocinarlo.  En principio, para recordarlo, en general, realmente no necesita muchos pasos, literalmente dos o tres acciones del lado de postgres, del lado de las configuraciones del usuario, y todo esto funciona bastante bien. </p><br><p>  La pieza es confiable.  Primero es simple, est√° escrito en Python, consume poca memoria y funciona en principio de manera confiable.  Lo √∫nico en la infraestructura deber√≠a ser este DCS.  Pero, por regla general, es necesario C√≥nsul o etc.  Pero para muchas empresas, esto ya se usa para todo tipo de descubrimiento de servicios diferentes, por lo tanto, como regla, no hay problemas con esto. </p><br><p>  Y qu√© tipo de problemas surgen: el problema m√°s b√°sico que la gente no siente de inmediato es que podemos perder algunos de los datos con el archivador autom√°tico </p><br><p>  <strong>Oleg</strong> : debido al retraso de replicaci√≥n? </p><br><p>  <strong>Alexei</strong> : imagina una situaci√≥n en la que se produce un archivador autom√°tico durante la replicaci√≥n, el viejo maestro se desconect√≥, pero a√∫n escribimos parte de los datos en √©l.  Supongamos que hay alg√∫n tipo de retraso de replicaci√≥n, se selecciona un nuevo maestro entre otras r√©plicas.  Se genera un nuevo maestro y si Patroni se configura de tal manera que el nodo ca√≠do se incluye autom√°ticamente en el cl√∫ster, por ejemplo, el inicio autom√°tico de los servicios se activa, luego, cuando el viejo maestro se eleva, ve que ya no es un maestro, est√° detr√°s, intentar√° conectarse al nuevo maestro y convertirse en su se√±al  Y en ese momento ejecuta el comando pg_rewind. </p><br><p>  Este comando rebobina el registro de transacciones en el nodo anterior (el antiguo maestro) hasta que pueda conectarse al nuevo maestro, es decir, se sobrescribe el registro de transacciones.  En este punto, podemos perder algunos de los datos.  En Patroni en s√≠ hay poca protecci√≥n, hay algunos giros que permiten que las r√©plicas no participen en las elecciones con un gran retraso.  Si, por ejemplo, todas las r√©plicas tienen un gran retraso, entonces las elecciones simplemente no se iniciar√°n, y luego la intervenci√≥n manual del administrador es necesaria para que el administrador entre y comience el archivo autom√°tico a mano.  O todos esperar√°n hasta que el viejo maestro se levante.  Hasta que su trabajo sea restaurado.  Y ya estar√°n conectados a √©l y continuar√°n atrap√°ndolo. </p><br><p>  Bueno, es decir, en Patroni hay mecanismos que le permiten no perder datos, pero existe un riesgo, por lo que debe </p><br><p>  <strong>Anton</strong> : ¬øqu√© pasa con la replicaci√≥n sincr√≥nica? </p><br><p>  <strong>Alexei</strong> : replicaci√≥n s√≠ncrona, ya ves, cuando usamos replicaci√≥n s√≠ncrona, perdemos rendimiento.  No todos pueden ir por este trato.  Pero si usamos la replicaci√≥n sincr√≥nica, el riesgo de p√©rdida de datos se reduce.  Pero si usamos varios nodos, digamos m√°s de dos, a√∫n debemos considerar la opci√≥n cuando tenemos un accidente tanto en el maestro como en la r√©plica s√≠ncrona.  Y todav√≠a tenemos una segunda r√©plica, y puede resultar que podamos atraparla y perder parte de los datos nuevamente.  Son posibles diferentes opciones, deben evaluarse, analizarse y comprenderse si tal comportamiento nos conviene o no. </p><br><p>  <strong>Anton</strong> : escucha, solo dos servidores se caen, es como prever una invasi√≥n de extraterrestres </p><br><p>  <strong>Aleksey</strong> : y hay un slammer sobre la anciana </p><br><p>  <strong>Oleg</strong> : ¬ørecuerdas la misma llamada a Lesha a las cinco de la ma√±ana por √∫ltima vez, con lo que estaba interesantemente conectado, Anton, y no es que perdimos dos bases de inmediato? </p><br><p>  <strong>Anton</strong> : fue un factor humano.  Pues s√≠, eso pasa. </p><br><p>  <strong>Alexey</strong> : por cierto, no recuerdo el motivo de la llamada </p><br><p>  <strong>Anton</strong> : transferimos dos servidores all√≠, trabajaron en paralelo, registraron datos, no importa.  Y los sistemas pod√≠an funcionar en uno, pero uno fue transferido a otro centro de datos, encendido.  El segundo fue transportado hasta el momento, y se toc√≥ alg√∫n tipo de cableado en el momento de la instalaci√≥n, y el viejo tambi√©n se cort√≥: mezclaron algo.  En general, los dos servidores cayeron, comenzamos a subir y, dado que estaban r√≠gidamente configurados para grabar, ten√≠an puntos de control muy raros o algo as√≠.  Comenz√≥ durante mucho tiempo, no entendimos lo que estaba sucediendo </p><br><p>  <strong>Oleg</strong> : cien conciertos wal-logs </p><br><p>  <strong>Anton</strong> : no entendimos lo que estaba sucediendo, por qu√© no comenz√≥, y como resultado tuve que hacer una llamada.  Bueno, en realidad no hab√≠a nada especial que hacer ... </p><br><p>  <strong>Alexei</strong> : bueno, es lo √∫nico que probablemente hemos conectado, hemos visto que todo est√° en orden </p><br><p>  <strong>Oleg</strong> : confirm√≥ la muerte del paciente </p><br><p>  <strong>Anton</strong> : de hecho, solo ten√≠as que esperar, en general. </p><br><p>  <strong>Alexey</strong>  S√≠, bueno, este es un problema conocido.  Con algunas configuraciones, los puntos de control son largos.  Hay tal problema. </p><br><p>  Pero, en general, si recuerda esta llamada nocturna, en la pr√°ctica rara vez llamamos por la noche, tenemos una configuraci√≥n de automatizaci√≥n especial: de servicio, todo est√° como deber√≠a, seleccionado de acuerdo con un horario especial.  Entonces, si recuerdas, bueno, tal vez una vez cada seis meses alguien llame </p><br><p>  <strong>Oleg</strong> : todo de nuestra empresa es probable </p><br><p>  <strong>Alexey</strong> : no, diferente </p><br><p>  <strong>Anton</strong> : Oleg, llama m√°s seguido </p><br><p>  <strong>Oleg</strong> : haremos un cambio hoy, probablemente llamar√© </p><br><p>  <strong>Alexey</strong> : tenemos chicos, su hora de la tarde se est√° cerrando, simplemente trabajar√°n </p><br><p>  <strong>Anton</strong> : escucha, Lech, dijiste que Patroni tiene algunos an√°logos.  ¬øC√≥mo difieren, cu√°les son </p><br><p>  <strong>Alexey</strong> : b√°sicamente hay dos opciones, hay una respuesta, esto apareci√≥ hace mucho tiempo, hace unos 10 a√±os.  Implementa un mecanismo cuando los nodos de un cl√∫ster posterior a la gracia se comprueban entre s√≠, qui√©n est√° vivo, qui√©n no est√° vivo.  Pero en mi opini√≥n esto no es muy, realmente no me gusta este esquema de trabajo. </p><br><p>  Y no hay un archivador autom√°tico fuera de la caja, repmgr fue afilado originalmente espec√≠ficamente para administrar el cl√∫ster y para el cambio manual, para el cambio.  Y si desea archivar autom√°ticamente directamente, entonces necesita instalar el demo repmgrd por separado, y resulta que el archivo autom√°tico se inicia aqu√≠.  La cosa es conveniente, buena, pero s√≠, no tenemos un autoarchivador listo para usar.  Necesitas ponerlo por separado.  En general, la cosa es buena, conveniente, en el sentido de que es bien configurable, es conveniente mantener los cl√∫steres basados ‚Äã‚Äãen cl√∫steres.  Ella es muy flexible, personalizable.  Las r√©plicas se pueden verter de varias maneras.  Desde copias de seguridad, desde r√©plicas para verter otras, desde el maestro.  En resumen, una cosa tan flexible, porque 10 a√±os.  Y se introdujeron muchas caracter√≠sticas diferentes, es muy bueno. </p><br><p>  Y otra opci√≥n es Stolon.  Apareci√≥ casi al mismo tiempo que Patroni, un poco m√°s tarde.  Est√° escrito en Go. </p><br><p>  Pero tiene una arquitectura m√°s ramificada.  Si abre el sitio web del proyecto, habr√° im√°genes, y Stolon en s√≠ consta de varios componentes.  Tiene nodos guardianes que trabajan con bases de datos que generan Postges.  Luego est√°n los llamados nodos Centinela.  Supervisan el estado del cl√∫ster, verifican su disponibilidad, verifican que los nodos est√©n vivos o no vivos.  Administran el estado del cl√∫ster y lo reconfiguran si sucede algo. </p><br><p>  Y hay los llamados nodos proxy, todo el tr√°fico los atraviesa.  La aplicaci√≥n cliente funciona con proxies.   -,  -   ,       .  Es decir    .  ,   , Stolon     DCS,    consul, etcd.  -       . </p><br><p>    ,      -  ,    bare metal  ,  ,       - ,   .       .        (   -)    ,       ,       . </p><br><p>      ,     .      . ,           . ,         .     oltp-      .   Stolon    ,       . </p><br><p>     ,  6  8,    .     ,    ,  .   ,     ‚Äî wal_keep_segments ‚Äî   - ,   ,    , .      ,    -  . ,        .       .  Es decir        ,    . , ,    .   ,     ‚Äî     .      . </p><br><p> <strong></strong> : , ,   -  Citus?   ,    . </p><br><p> <strong></strong> : Citus ‚Äî    . Citus   ,      CitusDB, -.       ,      ,     ,     </p><br><p> <strong></strong> :  ? </p><br><p> <strong></strong> :  ,  ,    .      .           ,  pg autofailover.       ,      .    ,      ,   . ,      ,        .    ,   ,  .    ,       ,        .  Es decir         . </p><br><p> <strong></strong> :  Citus.    ,       ,          .   ‚Äî   ,    ... </p><br><p> <strong></strong> : , ,  </p><br><p> <strong></strong> : ,     ,           ,  ,   ,  </p><br><p> <strong></strong> :  ,     ,      .  ,   ,  ,   .     "in the wild"  .        ,    . </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La continuaci√≥n del descifrado del problema se publicar√° en Habr en un futuro pr√≥ximo, pero por ahora suscr√≠base al podcast </font></font><a href="https://soundcloud.com/znprod" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zinc Prod</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ¬°hay muchas cosas interesantes por delante!</font></font></p></div></div><p>Source: <a href="https://habr.com/ru/post/485322/">https://habr.com/ru/post/485322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../485300/index.html">Nuevo brote de gusanos H2Miner que explotan Redis RCE descubierto</a></li>
<li><a href="../485304/index.html">Un par de trucos de elementos de iframe</a></li>
<li><a href="../485312/index.html">DevOps para aplicaciones m√≥viles</a></li>
<li><a href="../485316/index.html">Todos los SERP de Google ahora parecen anuncios</a></li>
<li><a href="../485318/index.html">Agregando belleza e interactividad a los cuadernos Jupyter</a></li>
<li><a href="../485324/index.html">Multithreading en Qt Widgets</a></li>
<li><a href="../485326/index.html">Crear micro frontends usando elementos angulares: una gu√≠a para principiantes</a></li>
<li><a href="../485328/index.html">Especificaciones sobre esteroides</a></li>
<li><a href="../485330/index.html">C√≥mo vencer al azar sin alma en los juegos de roguelike</a></li>
<li><a href="../485334/index.html">Encuesta de sesi√≥n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>