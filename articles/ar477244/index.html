<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ ๐ต RayTracing ูููููุฉ ูู 256 ุฎุทูุท ูู C ++ ุงูุนุงุฑูุฉ ๐๐ผ ๐๏ธ ๐จ๐ฟโ๐ค</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="RayTracing ูููููุฉ ูู 256 ุฎุทูุท ูู C ++ ุงูุนุงุฑูุฉ 


 ูุฐุง ูุตู ุขุฎุฑ ูู ูุญุงุถุฑุชู ุงูููุฌุฒุฉ ุญูู ุฑุณููุงุช ุงูููุจููุชุฑ . ูุฐู ุงููุฑุฉ ูุญู ูุชุญุฏุซ ุนู ุชุชุจุน ุงูุฃุดุนุฉ. ูุงูุนุงุฏุฉ ุ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>RayTracing ูููููุฉ ูู 256 ุฎุทูุท ูู C ++ ุงูุนุงุฑูุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477244/" style=";text-align:right;direction:rtl"><h1 id="understandable-raytracing-in-256-lines-of-bare-c" style=";text-align:right;direction:rtl">  RayTracing ูููููุฉ ูู 256 ุฎุทูุท ูู C ++ ุงูุนุงุฑูุฉ </h1><br><p style=";text-align:right;direction:rtl"> ูุฐุง ูุตู ุขุฎุฑ ูู ูุญุงุถุฑุชู <a href="https://github.com/ssloy/tinyrenderer/wiki">ุงูููุฌุฒุฉ ุญูู ุฑุณููุงุช ุงูููุจููุชุฑ</a> .  ูุฐู ุงููุฑุฉ ูุญู ูุชุญุฏุซ ุนู ุชุชุจุน ุงูุฃุดุนุฉ.  ูุงูุนุงุฏุฉ ุ ุฃุญุงูู ุชุฌูุจ ููุชุจุงุช ุงูุฌูุงุช ุงูุฎุงุฑุฌูุฉ ุ ุญูุซ ุฃุนุชูุฏ ุฃููุง ุชุฌุนู ุงูุทูุงุจ ูุชุญูููู ููุง ูุญุฏุซ ุชุญุช ุงูุบุทุงุก.  ุชุญูู ุฃูุถูุง ูู <a href="https://github.com/ssloy/tinykaboom/wiki">ูุดุฑูุน tinykaboom</a> . </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุงููุซูุฑ ูู ููุงูุงุช raytracing ุนูู ุงูููุจ ุ  ููุน ุฐูู ุ ูุฅู ุงููุดููุฉ ุชููู ูู ุฃู ุฌููุนูุง ุชูุฑูุจูุง ุชุนุฑุถ ุจุฑุงูุฌ ููุชููุฉ ูุตุนุจ ููููุง.  ุฎุฐ ุนูู ุณุจูู ุงููุซุงู ุชุญุฏู <a href="https://www.taylorpetrick.com/blog/post/business-rt">ุจุทุงูุฉ businness ุงูุฎุงุต ุจุชุชุจุน ุฑุงู</a> .  ุฅูู ููุชุฌ ุจุฑุงูุฌ ูุซูุฑุฉ ููุฅุนุฌุงุจ ููุบุงูุฉ ุ ููู ูู ุงูุตุนุจ ููุบุงูุฉ ููู ููู ูุนูู ูุฐุง.  ุจุฏูุงู ูู ุฅุธูุงุฑ ุฃูู ูููููู ุชูุฏูู ุนุฑูุถ ุ ุฃุฑูุฏ ุฃู ุฃุฎุจุฑู ุจุงูุชูุตูู ููู ููููู ุงูููุงู ุจุฐูู ุจููุณู. </p><br><p style=";text-align:right;direction:rtl">  <i>ููุงุญุธุฉ: ููุณ ูู ุงูููุทูู ูุฌุฑุฏ ุฅููุงุก ูุธุฑุฉ ุนูู ุงูููุฏ ุ ููุง ูุฌุฑุฏ ูุฑุงุกุฉ ูุฐู ุงูููุงูุฉ ูุน ููุจ ูู ุงูุดุงู ูู ูุชูุงูู ุงููุฏ.</i>  <i>ุชู ุชุตููู ูุฐู ุงูููุงูุฉ ูุชุชููู ูู ุชูุงูู ููุญุฉ ุงูููุงุชูุญ ูุชูููุฐ ูุญุฑู ุงูุนุฑุถ ุงูุฎุงุต ุจู.</i>  <i>ุณูููู ุจุงูุชุฃููุฏ ุฃูุถู ููู.</i>  <i>ุนูู ุงูุฃูู ุชุบููุฑ ูุบุฉ ุงูุจุฑูุฌุฉ!</i> </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูุฅู ุงููุฏู ุงูููู ูู ูุนุฑูุฉ ููููุฉ ุชูุฏูู ูุซู ูุฐู ุงูุตูุฑ: </p><br><img src="https://habrastorage.org/getpro/habr/post_images/064/50f/65d/06450f65da7c0503838bc008dcaba6a3.jpg"><a name="habracut"></a><br><h1 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 1: ูุชุงุจุฉ ุตูุฑุฉ ุนูู ุงููุฑุต </h1><br><p style=";text-align:right;direction:rtl">  ูุง ุฃุฑูุฏ ุฃู ุฃุฒุนุฌ ูุฏูุฑู ุงูููุงูุฐ ููุนุงูุฌุฉ ุงููุงูุณ / ููุญุฉ ุงูููุงุชูุญ ูุฃุดูุงุก ูู ูุฐุง ุงููุจูู.  ุณุชููู ูุชูุฌุฉ ุจุฑูุงูุฌูุง ุตูุฑุฉ ุจุณูุทุฉ ูุญููุธุฉ ุนูู ุงููุฑุต.  ูุฐุง ุ ูุฅู ุฃูู ูุง ูุญุชุงุฌ ุฅูู ุงูููุงู ุจู ูู ุญูุธ ุงูุตูุฑุฉ ุนูู ุงููุฑุต.  <a href="https://github.com/ssloy/tinyraytracer/tree/bd36c9857305b3cbd06f5b768bb48a92df9ae68b">ููุง</a> ููููู ุงูุนุซูุฑ ุนูู ุงูููุฏ ุงูุฐู ูุณูุญ ููุง ุจุฐูู.  ุงุณูุญูุง ูู ุฃู ุณุฑุฏ ุงูููู ุงูุฑุฆูุณู: </p><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;limits&gt; #include &lt;cmath&gt; #include &lt;iostream&gt; #include &lt;fstream&gt; #include &lt;vector&gt; #include "geometry.h" void render() { const int width = 1024; const int height = 768; std::vector&lt;Vec3f&gt; framebuffer(width*height); for (size_t j = 0; j&lt;height; j++) { for (size_t i = 0; i&lt;width; i++) { framebuffer[i+j*width] = Vec3f(j/float(height),i/float(width), 0); } } std::ofstream ofs; // save the framebuffer to file ofs.open("./out.ppm"); ofs &lt;&lt; "P6\n" &lt;&lt; width &lt;&lt; " " &lt;&lt; height &lt;&lt; "\n255\n"; for (size_t i = 0; i &lt; height*width; ++i) { for (size_t j = 0; j&lt;3; j++) { ofs &lt;&lt; (char)(255 * std::max(0.f, std::min(1.f, framebuffer[i][j]))); } } ofs.close(); } int main() { render(); return 0; }</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชูุฏูู render () ููุท ูู ุงููุธููุฉ ุงูุฑุฆูุณูุฉ ููุง ุดูุก ุขุฎุฑ.  ูุง ูู ุฏุงุฎู ูุธููุฉ ุงูุชูุฏูู ()ุ  ุฃููุงู ููุจู ูู ุดูุก ุ ุฃููู ุจุชุนุฑูู ุฅุทุงุฑ ุงููููุงุฌ ุนูู ุดูู ุตููู ุฃุญุงุฏู ุงูุจุนุฏ ูููู Vec3f ุ ููู ุนุจุงุฑุฉ ุนู ูุชุฌูุงุช ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ุจุณูุทุฉ ุชููุญูุง ููู (ุต ุ ุฒ ุ ุจ) ููู ุจูุณู.  ุชุนูุด ูุฆุฉ ุงููุชุฌูุงุช ูู ููุฏุณุฉ ุงููููุงุช. h ุ ูู ุฃุตููุง ููุง: ุฅููุง ุจุงููุนู ูุนุงูุฌุฉ ุชุงููุฉ ููุชุฌูุงุช ุซูุงุฆูุฉ ูุซูุงุซูุฉ ุงูุฃุจุนุงุฏ (ุฅุถุงูุฉ ูุทุฑุญ ูุชุนููู ูุถุฑุจ ุจููุชุฌ ุนุฏุฏู ุฃู ููุชุฌ ุนุฏุฏู). </p><br><p style=";text-align:right;direction:rtl">  ุฃุญูุธ ุงูุตูุฑุฉ <a href="https://en.wikipedia.org/wiki/Netpbm_format">ุจุชูุณูู ppm</a> .  ุฅููุง ุฃุณูู ุทุฑููุฉ ูุญูุธ ุงูุตูุฑ ุ ูููู ููุณ ุฏุงุฆููุง ุงูุทุฑููุฉ ุงูุฃูุซุฑ ููุงุกูุฉ ูุนุฑุถูุง ุจุดูู ุฃูุจุฑ.  ุฅุฐุง ููุช ุชุฑูุฏ ุงูุญูุธ ูู ุชูุณููุงุช ุฃุฎุฑู ุ ูุฅููู ุฃูุตู ุจุฑุจุท ููุชุจุฉ ุชุงุจุนุฉ ูุฌูุฉ ุฎุงุฑุฌูุฉ ุ ูุซู <a href="https://github.com/nothings/stb">stb</a> .  ูุฐู ููุชุจุฉ ุฑุงุฆุนุฉ: ุชุญุชุงุฌ ููุท ุฅูู ุชุถููู ููู ุฑุฃุณ ูุงุญุฏ stb_image_write.h ูู ุงููุดุฑูุน ุ ูุณูุณูุญ ูู ุจุญูุธ ุงูุตูุฑ ุจุฃูุซุฑ ุงูุชูุณููุงุช ุดููุนูุง. </p><br><p style=";text-align:right;direction:rtl">  <b>ุชุญุฐูุฑ:</b> ุงูููุฏ ุงูุฎุงุต ุจู ููุชูุฆ ุจุงูุฃุฎุทุงุก ุ ูุฃุตูุญูุง ูู ูุฑุญูุฉ ูุง ุจุนุฏ ุงูุฅูุชุงุฌ ุ ููู ุงูุงูุชุฒุงูุงุช ุงููุฏููุฉ ุชุชุฃุซุฑ.  ุชุญูู <a href="https://github.com/ssloy/tinyraycaster/issues/9">ูุฐู ุงููุดููุฉ</a> . </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ุ ูุฅู ุงููุฏู ูู ูุฐู ุงูุฎุทูุฉ ูู ุงูุชุฃูุฏ ูู ุฃููุง ูุงุฏุฑูู ุนูู) ุฅูุดุงุก ุตูุฑุฉ ูู ุงูุฐุงูุฑุฉ + ุชุนููู ุฃููุงู ูุฎุชููุฉ ู (ุจ) ุญูุธ ุงููุชูุฌุฉ ุนูู ุงููุฑุต.  ุซู ููููู ูุดุงูุฏุชู ูู ุจุฑูุงูุฌ ุชุงุจุน ูุฌูุฉ ุฎุงุฑุฌูุฉ.  ูุฐู ูู ุงููุชูุฌุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ec1/8d8/1f8/ec18d81f825957255d786b50c05c8c4b.jpg" alt="ุตูุฑุฉ"></p><br><h1 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 2 ุ ูุงุญุฏุฉ ุญุงุณูุฉ: ุชุชุจุน ุงูุฃุดุนุฉ </h1><br><p style=";text-align:right;direction:rtl">  ูุฐู ูู ุงูุฎุทูุฉ ุงูุฃูุซุฑ ุฃูููุฉ ูุตุนูุจุฉ ูู ุงูุณูุณูุฉ ุจุฃููููุง.  ุฃุฑูุฏ ุชุญุฏูุฏ ูุฌุงู ูุงุญุฏ ูู ุงูููุฏ ุงูุฎุงุต ุจู ูุงุฑุณูู ุฏูู ุฃู ูููู ููููุณูุง ุจุงูููุงุฏ ุฃู ุงูุฅุถุงุกุฉ.  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุฌุจ ุฃู ุชุจุฏู ุจูุง ูุชูุฌุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b02/143/d02/b02143d02d333d683313d209ec14eb25.jpg" alt="ุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูู ุฃุฌู ุงูุฑุงุญุฉ ุ ูุฏู ุงูุชุฒุงู ูุงุญุฏ ููู ุฎุทูุฉ ูู ูุณุชูุฏุน ุงูุชุฎุฒูู ุงูุฎุงุต ุจู ุ  ูุฌุนู Github ูู ุงูุณูู ุฌุฏูุง ุนุฑุถ ุงูุชุบููุฑุงุช ุงูุชู ุชู ุฅุฌุฑุงุคูุง.  <a href="https://github.com/ssloy/tinyraytracer/commit/5806eb45e93dab225ab335824cbc3f537d511b28">ููุง ุ ุนูู ุณุจูู ุงููุซุงู</a> ุ ูุง ุชู ุชุบููุฑู ุจูุงุณุทุฉ ุงูุงูุชุฒุงู ุงูุซุงูู. </p><br><p style=";text-align:right;direction:rtl">  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูุง ุงูุฐู ูุญุชุงุฌู ูุชูุซูู ุงููุฌุงู ูู ุฐุงูุฑุฉ ุงูููุจููุชุฑุ  ุฃุฑุจุนุฉ ุฃุฑูุงู ุชููู: ูุชุฌู ุซูุงุซู ุงูุฃุจุนุงุฏ ููุฑูุฒ ุงููุฑุฉ ูุนุฏุฏ ููุงุณู ูุตู ูุตู ุงููุทุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sphere</span></span></span><span class="hljs-class"> {</span></span> Vec3f center; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> radius; Sphere(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Vec3f &amp;c, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> &amp;r) : center(c), radius(r) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ray_intersect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vec3f &amp;orig, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vec3f &amp;dir, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;t0)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ Vec3f L = center - orig; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> tca = L*dir; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> d2 = L*L - tca*tca; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d2 &gt; radius*radius) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> thc = sqrtf(radius*radius - d2); t0 = tca - thc; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t1 = tca + thc; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t0 &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) t0 = t1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t0 &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุดูุก ุงููุญูุฏ ุบูุฑ ุงูุชุงูู ูู ูุฐุง ุงูููุฏ ูู ุงููุธููุฉ ุงูุชู ุชุณูุญ ูู ุจุงูุชุญูู ููุง ุฅุฐุง ูุงู ุดุนุงุน ูุนูู (ูุตุฏุฑู ุงูุฃุตู ูู ุงุชุฌุงู ุฏูุฑ) ูุชูุงุทุน ูุน ููุทูุชูุง.  <a href="http://www.lighthouse3d.com/tutorials/maths/ray-sphere-intersection/">ูููู ุงูุนุซูุฑ ููุง</a> ุนูู ูุตู ุชูุตููู ููุฎูุงุฑุฒููุฉ ุงูุฎุงุตุฉ ุจุชูุงุทุน ุดุนุงุน ุงููุฑุฉ ุ ูููุตูู ุจุดุฏุฉ ุฃู ุชูุนู ุฐูู ูุชุญูู ูู ุงูููุฏ. </p><br><p style=";text-align:right;direction:rtl">  ููู ูุนูู ุชุชุจุน ุงูุฃุดุนุฉุ  ุงููุง ุจุณูุทุฉ ุฌุฏุง.  ูู ุงูุฎุทูุฉ ุงูุฃููู ุ ููุฃูุง ุงูุตูุฑุฉ ุจุชุฏุฑุฌ ูู ุงูุฃููุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j&lt;height; j++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;width; i++) { framebuffer[i+j*width] = Vec3f(j/<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(height),i/<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(width), <span class="hljs-number"><span class="hljs-number">0</span></span>); } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ููู ุจูุณู ุ ุณูุดูู ุดุนุงุน ูุงุฏู ูู ุงูุฃุตู ูููุฑ ุนุจุฑ ุจูุณููุง ุ ููู ุซู ุชุญูู ููุง ุฅุฐุง ูุงู ูุฐุง ุงูุดุนุงุน ูุชูุงุทุน ูุน ุงููุฑุฉ: </p><br><img src="https://habrastorage.org/getpro/habr/post_images/66d/a0e/be3/66da0ebe356e82253f0492e6335f114e.svg"><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูู ููู ููุงู ุชูุงุทุน ูุน ุงููุฑุฉ ููุญู ูุฑุณู ุงูุจููุณู ุจุงูุฃููุงู 1 ุ ูุฅูุง ุจุงูุฃููุงู 2: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Vec3f </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cast_ray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vec3f &amp;orig, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vec3f &amp;dir, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Sphere &amp;sphere)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sphere_dist = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::numeric_limits&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;::max(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!sphere.ray_intersect(orig, dir, sphere_dist)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vec3f(<span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>, <span class="hljs-number"><span class="hljs-number">0.8</span></span>); <span class="hljs-comment"><span class="hljs-comment">// background color } return Vec3f(0.4, 0.4, 0.3); } void render(const Sphere &amp;sphere) { ๏ฟผ [...] for (size_t j = 0; j&lt;height; j++) { for (size_t i = 0; i&lt;width; i++) { float x = (2*(i + 0.5)/(float)width - 1)*tan(fov/2.)*width/(float)height; float y = -(2*(j + 0.5)/(float)height - 1)*tan(fov/2.); Vec3f dir = Vec3f(x, y, -1).normalize(); framebuffer[i+j*width] = cast_ray(Vec3f(0,0,0), dir, sphere); } } ๏ฟผ [...] }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงููุฑุญูุฉ ุ ุฃูุตูู ุจุฃุฎุฐ ููู ุฑุตุงุต ูุงูุชุญูู ุนูู ุงููุฑู ูู ุฌููุน ุงูุญุณุงุจุงุช (ุชูุงุทุน ูุฑุฉ ุงูุดุนุงุน ูุงุฌุชุงุญ ุงูุตูุฑุฉ ุจุงูุฃุดุนุฉ).  ููุท ูู ุญุงูุฉ ุ ูุชู ุชุญุฏูุฏ ุงููุงููุฑุง ูุฏููุง ูู ุฎูุงู ุงูุฃุดูุงุก ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุนุฑุถ ุงูุตูุฑุฉ </li><li style=";text-align:right;direction:rtl">  ุงุฑุชูุงุน ุงูุตูุฑุฉ </li><li style=";text-align:right;direction:rtl">  ูุฌุงู ุฒุงููุฉ ุงูุฑุคูุฉ </li><li style=";text-align:right;direction:rtl">  ูููุน ุงููุงููุฑุง ุ Vec3f (0.0.0) </li><li style=";text-align:right;direction:rtl">  ุนุฑุถ ุงูุงุชุฌุงู ุ ุนูู ุทูู ุงููุญูุฑ z ุ ูู ุงุชุฌุงู ูุงูุต ุงููุงููุงูุฉ </li></ul><br><p style=";text-align:right;direction:rtl">  ุงุณูุญูุง ูู ุฃู ุฃูุถุญ ููู ูุญุณุจ ุงูุงุชุฌุงู ุงูุฃููู ููุฃุดุนุฉ ูุชุชุจุน.  ูู ุงูุญููุฉ ุงูุฑุฆูุณูุฉ ูุฏููุง ูุฐู ุงูุตูุบุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = (<span class="hljs-number"><span class="hljs-number">2</span></span>*(i + <span class="hljs-number"><span class="hljs-number">0.5</span></span>)/(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)width - <span class="hljs-number"><span class="hljs-number">1</span></span>)*<span class="hljs-built_in"><span class="hljs-built_in">tan</span></span>(fov/<span class="hljs-number"><span class="hljs-number">2.</span></span>)*width/(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)height; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = -(<span class="hljs-number"><span class="hljs-number">2</span></span>*(j + <span class="hljs-number"><span class="hljs-number">0.5</span></span>)/(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)height - <span class="hljs-number"><span class="hljs-number">1</span></span>)*<span class="hljs-built_in"><span class="hljs-built_in">tan</span></span>(fov/<span class="hljs-number"><span class="hljs-number">2.</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุฃูู ูุฃุชูุ  ุจุณูุท ุฌุฏุง.  ูุชู ูุถุน ุงููุงููุฑุง ูุฏููุง ูู ุงูุฃุตู ูุชูุงุฌู ุงูุงุชุฌุงู -z.  ุงุณูุญูุง ูู ุฃู ุฃูุถุญ ุงูุฃุดูุงุก ุ ูุฐู ุงูุตูุฑุฉ ุชุธูุฑ ุงููุงููุฑุง ูู ุงูุฃุนูู ุ ูุญูุฑ y ุฎุงุฑุฌ ุงูุดุงุดุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e00/5c1/b99/e005c1b996cc7eb9978bc434f6773196.png" alt="ุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ููุง ููุช ุ ูุชู ูุถุน ุงููุงููุฑุง ูู ุงูุฃุตู ุ ููุชู ุนุฑุถ ุงููุดูุฏ ุนูู ุงูุดุงุดุฉ ุงูุชู ุชูุน ูู ุงููุณุชูู z = -1.  ูุญุฏุฏ ูุฌุงู ุงูุฑุคูุฉ ูุทุงุน ุงููุณุงุญุฉ ุงูุฐู ุณูููู ูุฑุฆููุง ุนูู ุงูุดุงุดุฉ.  ูู ุงูุตูุฑุฉ ูุฏููุง ุงูุดุงุดุฉ 16 ุจูุณู.  ููููู ุญุณุงุจ ุทููู ูู ุฅุญุฏุงุซูุงุช ุงูุนุงููุ  ุฅููุง ุจุณูุทุฉ: ุฏุนูุง ูุฑูุฒ ุนูู ุงููุซูุซ ุงูุฐู ูุชููู ูู ุงูุฎุท ุงูุฃุญูุฑ ูุงูุฑูุงุฏู ูุงูุฑูุงุฏู ุงููุชูุทุน.  ูู ุงูุณูู ุฃู ุชุฑู ุฃู ุชุงู (ูุฌุงู ุงูุฑุคูุฉ / 2) = (ุนุฑุถ ุงูุดุงุดุฉ) <em>0.5 / (ูุณุงูุฉ ูุงููุฑุง ุงูุดุงุดุฉ).</em>  <em>ูุถุนูุง ุงูุดุงุดุฉ ุนูู ูุณุงูุฉ 1 ูู ุงููุงููุฑุง ุ ูุจุงูุชุงูู (ุนุฑุถ ุงูุดุงุดุฉ) = 2</em> ุชุงู (ูุฌุงู ุงูุฑุคูุฉ / 2). </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุฏุนูุง ูููู ุฃููุง ูุฑูุฏ ุฃู ููุฌู ูุชุฌููุง ูู ุฎูุงู ูุฑูุฒ ุงูุจููุณู ุงูุซุงูู ุนุดุฑ ูู ุงูุดุงุดุฉ ุ ุฃู ูุฑูุฏ ุญุณุงุจ ุงููุชุฌู ุงูุฃุฒุฑู.  ููู ูููููุง ุฃู ููุนู ุฐููุ  ูุง ูู ุงููุณุงูุฉ ูู ูุณุงุฑ ุงูุดุงุดุฉ ุฅูู ุทุฑู ุงููุชุฌู ุงูุฃุฒุฑูุ  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูู 12 + 0.5 ุจูุณู.  ูุญู ูุนูู ุฃู 16 ุจูุณู ููุดุงุดุฉ ุชุชูุงูู ูุน <em>ูุญุฏุชูู ุนุงูููุชูู ุชุงู (fov / 2).</em>  <em>ูููุฐุง ุ ููุน ุทุฑู ุงููุชุฌู ูู (12 + 0.5) / 16</em> 2 <em>ุชุงู (fov / 2) ูุญุฏุงุช ุงูุนุงูู ูู ุงูุญุงูุฉ ุงููุณุฑู ุ ุฃู ุนูู ูุณุงูุฉ (12 + 0.5)</em> 2/16 * ุชุงู (fov / 2) - ุชุงู (fov / 2) ูู ุงูุชูุงุทุน ุจูู ุงูุดุงุดุฉ ูุงููุญูุฑ -z.  ุฃุถู ูุณุจุฉ ุฃุจุนุงุฏ ุงูุดุงุดุฉ ุฅูู ุงูุญุณุงุจุงุช ูุณุชุฌุฏ ุจุงูุถุจุท ุตูุบ ุงุชุฌุงู ุงูุดุนุงุน. </p><br><h1 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 3: ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงููุฌุงูุงุช </h1><br><p style=";text-align:right;direction:rtl">  ุงูุฌุฒุก ุงูุฃุตุนุจ ูุฏ ุงูุชูู ุ ูุงูุขู ุทุฑูููุง ูุงุถุญ.  ุฅุฐุง ููุง ูุนุฑู ููููุฉ ุฑุณู ูุฑุฉ ูุงุญุฏุฉ ุ ููู ูุณุชุบุฑู ุงูุฃูุฑ ููุชูุง ุทูููุงู ูุฅุถุงูุฉ ุงููุฒูุฏ.  <a href="https://github.com/ssloy/tinyraytracer/commit/c19c430151cb659372b4988876173b022164e371">ุชุญูู ูู ุงูุชุบููุฑุงุช</a> ูู ุงูููุฏ ุ ููุฐู ูู ุงูุตูุฑุฉ ุงููุงุชุฌุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/fc0/f37/6c9/fc0f376c9cb8971781f2a24065b47fa5.jpg" alt="ุตูุฑุฉ"></p><br><h1 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 4: ุงูุฅุถุงุกุฉ </h1><br><p style=";text-align:right;direction:rtl">  ุงูุตูุฑุฉ ูุซุงููุฉ ูู ุฌููุน ุงูุฌูุงูุจ ุ ุจุงุณุชุซูุงุก ููุฉ ุงูุถูุก.  ุฎูุงู ุจููุฉ ุงูููุงู ุณูุชุญุฏุซ ุนู ุงูุฅุถุงุกุฉ.  ุฏุนูุง ูุถูู ูุตุงุฏุฑ ุถูุฆูุฉ ููููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Light</span></span></span><span class="hljs-class"> {</span></span> Light(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Vec3f &amp;p, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> &amp;i) : position(p), intensity(i) {} Vec3f position; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> intensity; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุนุฏ ุนูููุฉ ุญุณุงุจ ุงูุฅุถุงุกุฉ ุงูุนุงูููุฉ ุงูุญููููุฉ ูููุฉ ุจุงูุบุฉ ุงูุตุนูุจุฉ ุ ูุฐุง ุ ูุซู ุฃู ุดุฎุต ุขุฎุฑ ุ ุณูู ูุฎุฏุน ุงูุนูู ูู ุฎูุงู ุฑุณู ูุชุงุฆุฌ ุบูุฑ ูุงุฏูุฉ ุชูุงููุง ุ ููููุง ูุนูููุฉ ุจุตุฑููุง.  ุจุงุฏุฆ ุฐู ุจุฏุก: ููุงุฐุง ูููู ุงูุฌู ุจุงุฑุฏูุง ูู ุงูุดุชุงุก ูุญุงุฑูุง ูู ุงูุตููุ  ูุฃู ุชุณุฎูู ุณุทุญ ุงูุฃุฑุถ ูุนุชูุฏ ุนูู ุฒุงููุฉ ุญุฏูุซ ุฃุดุนุฉ ุงูุดูุณ.  ูููุง ุงุฑุชูุนุช ุงูุดูุณ ููู ุงูุฃูู ุ ูุงู ุงูุณุทุญ ุฃูุซุฑ ุฅุดุฑุงููุง.  ูุนูู ุงูุนูุณ ูู ุฐูู ุ ูููุง ูุงู ุฃุนูู ูู ุงูุฃูู ุ ูุงู ูููู ุจุงูุชูุง.  ูุจุนุฏ ุฃู ุชุบุฑุจ ุงูุดูุณ ุนู ุงูุฃูู ุ ูุง ุชุตููุง ุงูููุชููุงุช ูุทูููุง. </p><br><p style=";text-align:right;direction:rtl">  ุฑุฌูุน ุฃุฌูุงุกูุง: ูุตุฏุฑ ุฃุดุนุฉ ูู ุงููุงููุฑุง (ูุง ุนูุงูุฉ ููููุชููุงุช!) ููู ูุชููู ุนูุฏ ูุฑุฉ.  ููู ูุนุฑู ุดุฏุฉ ููุทุฉ ุชูุงุทุน ุงูุฅุถุงุกุฉุ  ูู ุงููุงูุน ุ ูููู ุงูุชุญูู ูู ุงูุฒุงููุฉ ุจูู ุงููุชุฌู ุงูุทุจูุนู ูู ูุฐู ุงูููุทุฉ ูุงููุชุฌู ุงูุฐู ูุตู ุงุชุฌุงู ุงูุถูุก.  ุฃุตุบุฑ ุฒุงููุฉ ุ ูุงู ุงูุณุทุญ ุฃูุถู ูุถุงุกุฉ.  ุชุฐูุฑ ุฃู ุงูููุชุฌ ุงูููุงุณู ุจูู ูุชุฌููู a ู b ูุณุงูู ูุงุชุฌ ููุงุนุฏ ุงููุชุฌูุงุช ุถุฑุจ ุฌูุจ ุชูุงู ุงูุฒุงููุฉ ุจูู ุงููุชุฌูุงุช: a * b = | a |  | ุจ |  ููุณ (ุฃููุง (ุฃ ุ ุจ)).  ุฅุฐุง ุฃุฎุฐูุง ููุงูู ุจุทูู ุงููุญุฏุฉ ุ ูุฅู ููุชุฌ ุงูููุทุฉ ุณูู ูุนุทููุง ูุซุงูุฉ ุฅุถุงุกุฉ ุงูุณุทุญ. </p><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ูู ูุธููุฉ cast_ray ุ ุจุฏูุงู ูู ุงูููู ุงูุซุงุจุช ุ ุณูููู ุจุฅุนุงุฏุฉ ุงูููู ูุน ูุฑุงุนุงุฉ ูุตุงุฏุฑ ุงูุถูุก: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Vec3f </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cast_ray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vec3f &amp;orig, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vec3f &amp;dir, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Sphere &amp;sphere)</span></span></span><span class="hljs-function"> </span></span>{ [...] <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> diffuse_light_intensity = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;lights.size(); i++) { Vec3f light_dir = (lights[i].position - point).normalize(); diffuse_light_intensity += lights[i].intensity * <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::max(<span class="hljs-number"><span class="hljs-number">0.f</span></span>, light_dir*N); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> material.diffuse_color * diffuse_light_intensity; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุชุนุฏููุงุช wrt ุงูุฎุทูุฉ ุงูุณุงุจูุฉ <a href="https://github.com/ssloy/tinyraytracer/commit/9a728fff2bbebb1eedd86e1ac89f657d43191609">ูุชููุฑุฉ ููุง</a> ุ ูููุง ูู ุงููุชูุฌุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/207/766/76d/20776676d3aff568b466807ef548ea5a.jpg" alt="ุตูุฑุฉ"></p><br><h1 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 5: ุงูุฅุถุงุกุฉ ุจุฑุงู </h1><br><p style=";text-align:right;direction:rtl">  ุชูุฏู ุฎุฏุนุฉ ููุทุฉ ุงูููุชุฌ ุชูุฑูุจูุง ุฌูุฏูุง ูุฅุถุงุกุฉ ุงูุฃุณุทุญ ุบูุฑ ุงููุงูุนุฉ ุ ูู ุงูุฃุฏุจ ูุทูู ุนููู ุงูุฅุถุงุกุฉ ุงูููุชุดุฑุฉ.  ูุง ุงูุฐู ูุฌุจ ุฃู ููุนูู ุฅุฐุง ุฃุฑุฏูุง ุฑุณู ุฃุณุทุญ ูุงูุนุฉุ  ุฃุฑูุฏ ุงูุญุตูู ุนูู ุตูุฑุฉ ูุซู ูุฐุง: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/2d6/b39/c52/2d6b39c52aaa6a8c8667fd2df19f2e93.jpg" alt="ุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ุชุญูู ูู <a href="https://github.com/ssloy/tinyraytracer/commit/f5ec45c2541feb86b6a30cc3bb04917d60d13e9b">ุนุฏุฏ ุงูุชุนุฏููุงุช</a> ุงูุถุฑูุฑูุฉ.  ุจุงุฎุชุตุงุฑ ุ ูููุง ูุงู ุงูุถูุก ุนูู ุงูุฃุณุทุญ ุงููุงูุนุฉ ุฃูุซุฑ ุฅุดุฑุงููุง ุ ููุช ุงูุฒุงููุฉ ุจูู ุงุชุฌุงู ุงูุนุฑุถ ูุงุชุฌุงู ุงูุถูุก <i>ุงูููุนูุณ</i> . </p><br><p style=";text-align:right;direction:rtl">  ุชูุนุฑู ูุฐู ุงูุฎุฏุนุฉ ุงููุฒูุฏุฉ ุจุฅุถุงุกุฉ ุงูุฃุณุทุญ ุงููุงูุนุฉ ูุงูููุชุนุฉ ุจุงุณู <a href="https://en.wikipedia.org/wiki/Phong_reflection_model">ูููุฐุฌ ุงูุนูุงุณ ูููุฌ</a> .  ุชุญุชูู ุงููููู ุนูู ูุตู ููุตู ุฅูู ุญุฏ ูุง ููููุฐุฌ ุงูุฅุถุงุกุฉ ูุฐุง.  ูุฏ ูููู ูู ุงูุฌูุฏ ูุฑุงุกุชูุง ุฌูุจูุง ุฅูู ุฌูุจ ูุน ุงูููุฏ ุงููุตุฏุฑู.  ูุฐู ูู ุงูุตูุฑุฉ ุงูุฃุณุงุณูุฉ ูููู ุงูุณุญุฑ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/881/d77/0ca/881d770ca8779cc876808a22c0fd8cce.png" alt="ุตูุฑุฉ"></p><br><h1 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 6: ุงูุธูุงู </h1><br><p style=";text-align:right;direction:rtl">  ููุงุฐุง ูุฏููุง ุงูุถูุก ุ ูููู ูุง ุธูุงูุ  ูุฐุง ููุณ ุจุฎูุฑ!  ุงุฑูุฏ ูุฐู ุงูุตูุฑุฉ </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e8f/fdd/04c/e8ffdd04c72dfc92f0845bb7b079faf7.jpg" alt="ุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  <a href="https://github.com/ssloy/tinyraytracer/commit/ef70d1356169dacb3183ad4fcb4c23f1d7003e1b">ูุฌุฑุฏ ุณุชุฉ ุณุทูุฑ ูู ุงูููุฏ</a> ุชุณูุญ ููุง ุจุชุญููู ูุฐุง: ุนูุฏ ุฑุณู ูู ููุทุฉ ุ ูุญู ููุท ูุชุฃูุฏ ูู ุฃู ุงูููุทุน ุจูู ุงูููุทุฉ ุงูุญุงููุฉ ููุตุฏุฑ ุงูุถูุก ูุง ูุชูุงุทุน ูุน ูุงุฆูุงุช ูุดูุฏูุง.  ุฅุฐุง ูุงู ููุงู ุชูุงุทุน ุ ูุฅููุง ูุชุฎุทู ูุตุฏุฑ ุงูุถูุก ุงูุญุงูู.  ูุง ููุฌุฏ ุณูู ุฏูุฉ ุตุบูุฑุฉ: ุฃุฒุนุฌ ุงูููุทุฉ ุจุชุญุฑูููุง ูู ุงูุงุชุฌุงู ุงูุทุจูุนู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">Vec3f shadow_orig = light_dir*N &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? point - N*<span class="hljs-number"><span class="hljs-number">1e-3</span></span> : point + N*<span class="hljs-number"><span class="hljs-number">1e-3</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงุฐุง ูุฐุงุ  ุฅููุง ูุฌุฑุฏ ููุทุฉ ุชููู ูู ุณุทุญ ุงููุงุฆู ุ ู (ุจุงุณุชุซูุงุก ูุณุฃูุฉ ุงูุฃุฎุทุงุก ุงูุนุฏุฏูุฉ) ูุฅู ุฃู ุดุนุงุน ูู ูุฐู ุงูููุทุฉ ุณูุชูุงุทุน ูุน ุงููุงุฆู ููุณู. </p><br><h1 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 7: ุงูุงูุนูุงุณุงุช </h1><br><p style=";text-align:right;direction:rtl">  ุฅูู ุฃูุฑ ูุง ูุตุฏู ุ ูููู ูุฅุถุงูุฉ ุชุฃููุงุช ุฅูู ุนุฑุถูุง ุ ูุญุชุงุฌ ููุท ุฅูู ุฅุถุงูุฉ ุซูุงุซุฉ ุณุทูุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"> Vec3f reflect_dir = reflect(dir, N).normalize(); Vec3f reflect_orig = reflect_dir*N &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? point - N*<span class="hljs-number"><span class="hljs-number">1e-3</span></span> : point + N*<span class="hljs-number"><span class="hljs-number">1e-3</span></span>; <span class="hljs-comment"><span class="hljs-comment">// offset the original point to avoid occlusion by the object itself Vec3f reflect_color = cast_ray(reflect_orig, reflect_dir, spheres, lights, depth + 1);</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <a href="https://github.com/ssloy/tinyraytracer/commit/c80479d1d22fe98f41b584972affeb43422a23a6">ููููู</a> ุฑุคูุชู <a href="https://github.com/ssloy/tinyraytracer/commit/c80479d1d22fe98f41b584972affeb43422a23a6">ุจููุณู:</a> ุนูุฏ ุชูุงุทุน ุงููุฑุฉ ุ ูุญุณุจ ููุท ุงูุฃุดุนุฉ ุงูููุนูุณุฉ (ุจูุณุงุนุฏุฉ ููุณ ุงููุธููุฉ ุงูุชู ุงุณุชุฎุฏููุงูุง ููุถูุก ุงูุจุงุฑุฒ!) ููุฏุนู ุจุดูู ูุชูุฑุฑ ุจูุธููุฉ cast_ray ูู ุงุชุฌุงู ุงูุดุนุงุน ุงูููุนูุณ.  ุชุฃูุฏ ูู ุงููุนุจ <a href="">ุจุนูู ุงูุนูุฏูุฉ</a> ุ ููุฏ ููุช ุจุถุจุทู ุนูู 4 ุ ุฌุฑุจ ููููุง ูุฎุชููุฉ ุชุจุฏุฃ ูู 0 ุ ูุง ุงูุฐู ุณูุชุบูุฑ ูู ุงูุตูุฑุฉุ  ูุฐู ูู ูุชูุฌุฉ ุจูุฏู ูุน ุงูุนูุงุณุงุช ูุนูู ุงูุนูุฏูุฉ ูู 4: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a9d/1c2/e6d/a9d1c2e6d428aaba07953cae3fa007ea.jpg" alt="ุตูุฑุฉ"></p><br><h1 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 8: ุงูุงููุณุงุฑ </h1><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุง ูุนูู ุฃู ูููุฑ ูููุงู ุ ูุฅู <a href="https://github.com/ssloy/tinyraytracer/commit/b69793bf6e8be54973cad1b18185a67dbf11bad1">ุงูุงููุณุงุฑุงุช ุชููู ุณููุฉ</a> .  ูุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุฏุงูุฉ ูุงุญุฏุฉ ูุญุณุงุจ ุงูุดุนุงุน ุงููููุณุฑ ( <a href="https://en.wikipedia.org/wiki/Snell%2527s_law">ุจุงุณุชุฎุฏุงู ูุงููู Snell</a> ) ุ ูุซูุงุซุฉ ุฃุณุทุฑ ุฃุฎุฑู ูู ุงูููุฏ ูู ุฏุงูุฉ cast_ray ุงูุนูุฏูุฉ.  ูุฐู ูู ุงููุชูุฌุฉ ุญูุซ ุชููู ุฃูุฑุจ ูุฑุฉ "ูุตููุนุฉ ูู ุงูุฒุฌุงุฌ" ุ ููู ุชูุนูุณ ูุชูุนูุณ ุงูุถูุก ูู ููุณ ุงูููุช: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/8c8/14a/56a/8c814a56aafc88609ebeb8c5a6f9a494.jpg" alt="ุตูุฑุฉ"></p><br><h1 style=";text-align:right;direction:rtl">  ุณุชู 9: ูุฑุงุก ุงููุฌุงูุงุช </h1><br><p style=";text-align:right;direction:rtl">  ุญุชู ูุฐู ุงููุญุธุฉ ุ ูููุง ุจุชูุฏูู ูุฑุงุช ููุท ูุฃููุง ูุงุญุฏุฉ ูู ุฃุจุณุท ุงููุงุฆูุงุช ุงูุฑูุงุถูุฉ ุบูุฑ ุงูุชุงููุฉ.  ุฏุนููุง ูุถูู ุทุงุฆุฑุฉ.  ุฑูุนุฉ ุงูุดุทุฑูุฌ ูู ุงูุงุฎุชูุงุฑ ุงูููุงุณููู.  ููุฐุง ุงูุบุฑุถ ุ ูููู ุฅุถุงูุฉ <a href="https://github.com/ssloy/tinyraytracer/commit/5e0da1f09fdbc585caa16df4c7b2f527d61536ef">ุนุดุฑุงุช ุงูุฎุทูุท</a> . </p><br><p style=";text-align:right;direction:rtl">  ูููุง ุงููุชูุฌุฉ: </p><br><img src="https://habrastorage.org/getpro/habr/post_images/d88/871/a50/d88871a5021eb69cc64c7b9a5915e855.jpg"><br><p style=";text-align:right;direction:rtl">  ููุง ูุนุฏุช ุ ุงูููุฏ ูุญุชูู ุนูู 256 ุณุทุฑูุง ูู ุงูุดูุฑุฉ ุ <a href="https://github.com/ssloy/tinyraytracer">ุชุญูู ูู ุฐูู ุจููุณู</a> ! </p><br><h1 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 10: ูููุฉ ุงูููุฒู </h1><br><p style=";text-align:right;direction:rtl">  ููุฏ ูุทุนูุง ุดูุทูุง ุทููููุง: ููุฏ ุชุนูููุง ููููุฉ ุฅุถุงูุฉ ูุงุฆูุงุช ุฅูู ูุดูุฏ ูุง ุ ูููููุฉ ุญุณุงุจ ุงูุฅุถุงุกุฉ ุงููุนูุฏุฉ ุฅูู ุญุฏ ูุง.  ุงุณูุญูุง ูู ุฃู ุฃุชุฑู ูู ูููุชูู ููุงุฌุจ ููุฒูู.  ุชูุงูุง ูู ุงูุฃุนูุงู ุงูุชุญุถูุฑูุฉ ูุฏ ุชู ุจุงููุนู ูู ูุฑุน <a href="https://github.com/ssloy/tinyraytracer/tree/homework_assignment">ุงููุงุฌุจ ุงูููุฒูู</a> .  ุณูุชุทูุจ ูู ูููุฉ ุนุดุฑุฉ ุฃุณุทุฑ ูู ููู ุงูุดูุฑุงุช. </p><br><h3 style=";text-align:right;direction:rtl">  ุงูุงุญุงูุฉ 1: ุฎุฑูุทุฉ ุงูุจูุฆุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูู ุงูููุช ุงูุญุงูู ุ ุฅุฐุง ูู ุชุชูุงุทุน ุงูุฃุดุนุฉ ูุน ุฃู ูุงุฆู ุ ูุณูููู ููุท ุจุชุนููู ุงูุจููุณู ุนูู ููู ุงูุฎูููุฉ ุงูุซุงุจุช.  ูููุงุฐุง ุ ูู ุงููุงูุน ุ ูู ูู ุซุงุจุชุ  ุฏุนูุง <a href="">ููุชูุท</a> ุตูุฑุฉ ูุฑููุฉ (file <a href="">envmap.jpg</a> ) <a href="">ููุณุชุฎุฏููุง</a> ูุฎูููุฉ!  ูุฌุนู ุงูุญูุงุฉ ุฃุณูู ุ ููุช ุจุฑุจุท ูุดุฑูุนูุง ูุน ููุชุจุฉ stb ูุชูููุฑ ุงูุฑุงุญุฉ ูู ุงูุนูู ุจุชูุณูู jpg.  ูุฌุจ ุฃู ุชุนุทููุง ูุฐู ุงูุตูุฑุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/3e0/531/fa9/3e0531fa9ee361de7580029e818bc5f5.jpg" alt="ุตูุฑุฉ"></p><br><h3 style=";text-align:right;direction:rtl">  ุงููุงุฌุจ 2: ุงูุฏุฌุงู ุงูุฏุฌุงู! </h3><br><p style=";text-align:right;direction:rtl">  ูููููุง ุชูุฏูู ูู ูู ุงูุทุงุฆุฑุงุช ูุงูุทุงุฆุฑุงุช (ุงูุธุฑ ุงูุดุทุฑูุฌ).  ูุฐูู ุฏุนููุง ุฑุณู ุชูุณุฌู ุงููุซูุซ!  ููุฏ ูุชุจุช ุฑูุฒูุง ูุณูุญ ูู ุจูุฑุงุกุฉ ููู .obj ุ ูุฃุถูุช ุฅููู ูุธููุฉ ุชูุงุทุน ูุซูุซ ุงูุฃุดุนุฉ.  ุงูุขู ูุฌุจ ุฃู ุชููู ุฅุถุงูุฉ ุงูุจุทุฉ ุฅูู ูุดูุฏูุง ุชุงููุฉ ููุบุงูุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/064/50f/65d/06450f65da7c0503838bc008dcaba6a3.jpg" alt="ุตูุฑุฉ"></p><br><h1 style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h1><br><p style=";text-align:right;direction:rtl">  ูุฏูู ุงูุฑุฆูุณู ูู ุฅุธูุงุฑ ุงููุดุฑูุนุงุช ุงููุซูุฑุฉ ููุงูุชูุงู (ูุงูุณููุฉ!) ููุจุฑูุงูุฌ.  ุฃูุง ููุชูุน ุจุฃูู ููู ุชุตุจุญ ูุจุฑูุฌูุง ุฌูุฏูุง ุ ูุฌุจ ุฃู ุชููู ุจุงููุซูุฑ ูู ุงููุดุงุฑูุน ุงูุฌุงูุจูุฉ.  ูุง ุฃุนูู ุนูู ุ ููููู ุดุฎุตูุงู ูุณุช ููุฌุฐุจุงู ุฅูู ุจุฑูุงูุฌ ุงููุญุงุณุจุฉ ููุนุจุฉ ูุงุณุญุฉ ุฃูุบุงู ุ ุญุชู ูู ูุงู ุชุนููุฏ ุงูููุฏ ูุดุงุจููุง ุชูุงููุง. </p><br><p style=";text-align:right;direction:rtl">  ุจุถุน ุณุงุนุงุช ููุฆุชุงู ูุฎูุณูู ุณุทุฑูุง ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุนุทููุง ุฑุงูุชุฑุงุณูุฑ.  <a href="https://github.com/ssloy/tinyrenderer/wiki">ูููู ุฅุฌุฑุงุก ุฎูุณูุงุฆุฉ ุณุทุฑ</a> ูู ุจุฑูุงูุฌ ุชูููุท ุงูุจุฑูุงูุฌ ูู ุบุถูู ุฃูุงู ููููุฉ.  ุงูุฑุณููุงุช ุฑุงุฆุนุฉ ุญูุง ูุชุนูู ุงูุจุฑูุฌุฉ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar477244/">https://habr.com/ru/post/ar477244/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar477230/index.html">ุชุงุฑูุฎ ุงูุจุฑุงูุฌ ุงูุชุนููููุฉ: ุฃูู ุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุงูุดุฎุตูุฉ ูุงูุฃูุนุงุจ ุงูุชุนููููุฉ ูุงูุจุฑุงูุฌ ููุทูุงุจ</a></li>
<li><a href="../ar477234/index.html">ุงููุฃุฑ ุงูุฐู ูุถุน ุญุฏุง ููุฃุฎูุฉ ุงูุฃุณูุงู</a></li>
<li><a href="../ar477236/index.html">ูุญููุฉ ุฃูุฑูููุฉ ุชุณูุญ ููููุงูุงุช ุจุฅุนุงุฏุฉ ุงูุญูุงุฏ ุงูุตุงูู</a></li>
<li><a href="../ar477238/index.html">ุจุงูุฅุถุงูุฉ ุฅูู Karma: ูุง ููุชูุฏู Stack Overflow ูููุงุฐุง ูุดุชูู ุงููุซูุฑูู ูู ุณููุฉ ุงููุฌุชูุน</a></li>
<li><a href="../ar477242/index.html">ููู ุงุฎุชุฑูุง ServiceDesk. ุงูุฌุฒุก 3</a></li>
<li><a href="../ar477248/index.html">ุชุฌุฑุจุชู ุงูุฃููู ูู ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุจูุงูุงุช Postgres ุจุนุฏ ุชุนุทู (ุตูุญุฉ ุบูุฑ ุตุงูุญุฉ ูู ุงููุชูุฉ 4123007 ูู ูุงุนุฏุฉ relatton / 16490)</a></li>
<li><a href="../ar477250/index.html">ูู ุชุฑูุฏ ุชุดุบูู Windows 10 ุนูู ุขูุฉ ุญุงุณุจุฉุ ุฌูุฏ</a></li>
<li><a href="../ar477252/index.html">ููู ุชุทูุฑุช ุญุงุถูุงุช ุงูุฃุนูุงู ุงูุชุฌุงุฑูุฉ ูุงููุณุฑุนุงุช: ูู ูุฎุชุจุฑ ุชููุงุณ ุฅุฏูุณูู ุฅูู Y Combinator</a></li>
<li><a href="../ar477254/index.html">ูุตุงุฏูุฉ XSS ู CSRF ู Flash. ุญู ุงููุดููุงุช ุจุงุณุชุฎุฏุงู r0ot-mi Web - Client. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar477256/index.html">ุชู ุชุฃุฌูู ุฃูู ุฅุทูุงู ูุงูู ูู OneWeb ุนูู ูุฑูุจุฉ ุงูุฅุทูุงู Soyuz ุงูุนุงู ุงูููุจู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฅุทูุงู ูุฑูุจุฉ ุงูุฅุทูุงู Angara</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>