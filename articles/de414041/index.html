<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👩‍👧‍👦 🎸 👉🏻 Im Winter und Sommer in einer Farbe? Suchen Sie nach Saisonalität in Daten 🗾 🛐 😑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einmal haben wir uns entschlossen zu sehen, welche saisonalen Interessen 2GIS-Benutzer in verschiedenen Städten haben. Das Interesse an Blumen, Neujah...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Im Winter und Sommer in einer Farbe? Suchen Sie nach Saisonalität in Daten</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/2gis/blog/414041/"><img src="https://habrastorage.org/webt/3m/jp/jn/3mjpjnj7rqfzdr01mo8jsoesomy.jpeg"><br><br>  Einmal haben wir uns entschlossen zu sehen, welche saisonalen Interessen 2GIS-Benutzer in verschiedenen Städten haben.  Das Interesse an Blumen, Neujahrsgeschenken und Reifen ist durchaus zu erwarten.  Wir haben uns entschlossen, uns nicht auf sie zu beschränken und alle Tätigkeitsbereiche in allen 113 Städten der Präsenz zu überprüfen. <br><br>  In diesem Artikel werde ich Ihnen erzählen, wie wir nach Saisonalität gesucht haben und welche Merkmale des Benutzerverhaltens darin gefunden wurden. <br><a name="habracut"></a><br><h4>  Warum müssen Sie die Saisonalität messen? </h4><br>  Die Bedürfnisse der 2GIS-Benutzer ändern sich im Laufe des Jahres: Konsumgüter, Dienstleistungen, Bauwesen, öffentliche Dienstleistungen.  Saisonales Wissen ist aus mehreren Gründen nützlich: <br><br><ul><li>  Wir beginnen im Moment und in naher Zukunft mehr über die Werte und Interessen unserer Benutzer zu verstehen. </li><li>  Wir können die Anfrage eines Benutzers "vorhersagen". </li><li>  Vertriebsleiter konzentrieren sich auf für Benutzer relevante Tätigkeitsbereiche. </li></ul><br><h3>  Arten von Verkehr </h3><br>  Bevor wir darüber sprechen, wie wir Datenverkehr verarbeiten, sollten wir klarstellen, dass wir ihn in verschiedene Typen unterteilen. <br><br>  Wiederherstellung ist eine Art von Datenverkehr, bei dem der Benutzer genau das Unternehmen kennt, mit dem er Kontakt aufnehmen möchte.  Er muss die Adresse, den Arbeitsplan oder den Eingang klären.  In diesem Fall erfolgt die Suche nach Firmenname, Telefonnummer und anderen Attributen der Firma. <br><br>  Entdeckungsverkehr ist, wenn ein Benutzer eine Anfrage allgemeiner formuliert: "Polstermöbel", "Essen auf Lenin", "Bäder".  Das heißt, der Benutzer erkundet Marktoptionen und -angebote, ruft häufig Organisationen an oder besucht ihre Websites. <br><br>  Geoverkehr tritt auf, wenn ein Benutzer mit einer Karte arbeitet.  Zum Beispiel wird nach Apotheken oder Tankstellen gesucht, die dem Haus am nächsten liegen. <br><img src="https://habrastorage.org/webt/a7/da/xs/a7daxskkn-arknmjqpz-av2d1pe.jpeg"><br>  Alle Benutzeranforderungen und alle nachfolgenden Aktionen werden im Datenverkehr markiert.  Um nach Saisonalität zu suchen, wurden Discovery + Geo-Traffic analysiert.  Da sie zum einen der Manifestation von Benutzerinteressen entsprechen und zum anderen kontrolliert werden können.  Sie können den Wiederherstellungsverkehr nicht verwalten. <br><br><h3>  Über Trends </h3><br><img src="https://habrastorage.org/webt/av/we/sx/avwesx7puvrhmwfvo9ubshrperg.png" alt="Grafik 1: Sehen Sie Saisonalität?"><br>  <font color="gray"><i>Grafik 1: Sehen Sie Saisonalität?</i></font> <br><br>  Bevor Sie nach Saisonalität suchen, müssen Sie Änderungen im Verkehrsaufkommen auf verschiedenen Gerätetypen berücksichtigen.  Wir haben berücksichtigt, dass das Publikum von WinPhone- und PC-Versionen ständig sinkt.  Während Online, Android, iOS ständig wachsen. <br><br><h4>  Hypothesentest </h4><br>  Kriterien für die Bestimmung der Saisonalität werden für stationäre Serien entwickelt.  Es ist notwendig, die Hypothese zu testen, dass die Serie einen Trend enthält.  Wir werden die Zeitreihen als zufälligen Prozess betrachten.  Dann sind die Elemente der Reihe Realisierungen einer Zufallsvariablen. <br><br>  Wir können die Hypothese testen, dass alle Stichprobenwerte zur gleichen Population mit dem Durchschnitt m gehören.  Dann lautet die Haupthypothese: <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>m</mi><mi>i</mi></msub><mo>=</mo><mi>m</mi><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>N</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.429ex" height="2.419ex" viewBox="0 -780.1 12240 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMATHI-48" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-30" x="1175" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-3A" x="1563" y="0"></use><g transform="translate(2119,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMATHI-69" x="1242" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-3D" x="3620" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMATHI-6D" x="4676" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-2C" x="5554" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMATHI-69" x="5999" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-3D" x="6623" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-31" x="7679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-2C" x="8180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-32" x="8625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-2C" x="9125" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-2E" x="9570" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-2E" x="10016" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-2E" x="10461" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMAIN-2C" x="10906" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/2gis/blog/414041/&amp;usg=ALkJrhidHKFj7cjc4ZBrjEueXAF1OdJhNQ#MJMATHI-4E" x="11351" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>m</mi><mi>i</mi></msub><mo>=</mo><mi>m</mi><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> H_0: m_i = m, i = 1,2, ..., N </script><br>  gegen die konkurrierende Trendhypothese <br><math> </math> $ inline $ H_1: ∣m_ {i + 1} −m_i∣&gt; 0, i = 1,2, ..., N - 1 $ inline $ <br>  Dabei ist N die Anzahl der Elemente in einer Reihe. <br><br>  Um die Hypothese zu testen, müssen Sie eines der Kriterien für die Signifikanz des Trends verwenden.  Basierend auf den Studien wurde das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Inversionskriterium</a> gewählt. <br><br>  Wenn die Hypothese nicht zurückgewiesen wird, muss der Trend aus den Daten entfernt werden.  Wir gehen davon aus, dass es in unseren Daten nur einen linearen Trend geben kann.  Oh, es wäre exponentiell!  Wir gehen auch davon aus, dass wir nicht mehr als einen Wendepunkt haben können. <br><br><img src="https://habrastorage.org/webt/xo/vp/rh/xovprhfclo4duighdd7eibfieig.png" alt="Grafik 2: Zeitreihen (aus Grafik 1) und deren Trend"><br>  <font color="gray"><i>Grafik 2: Zeitreihen (aus Grafik 1) und deren Trend</i></font> <br><br><h4>  Über einen Rechen und Entdeckungen </h4><br>  Wir haben die Grenzen der Studie umrissen und Hypothesen getestet.  Natürlich war es nicht ohne Rechen und Entdeckungen: Da sich die Aufgabe nicht auf beliebte Dienste in Städten mit über einer Million Menschen beschränkte, haben wir eine Liste von Sonderfällen zusammengestellt, die es wert sind, beachtet zu werden. <br><br><ol><li>  Datenlücken.  In engen Tätigkeitsbereichen enthalten einige Daten möglicherweise keine Daten.  Der Fall ist besonders relevant für Kleinstädte.  Diese Funktion muss für die korrekte Konstruktion der Regression berücksichtigt werden. </li><li>  Wenn ein Wendepunkt gefunden wird, berücksichtigen Sie dessen Nähe zum Anfang oder Ende der Reihe.  Eine Fehlinterpretation des Verhaltens einer Reihe unter Randbedingungen ist möglich.  Zum Beispiel scheinen in Diagramm 2 die ersten 120 Punkte ein stückweise lineares Wachstum anzuzeigen.  Tatsächlich zeigte sich jedoch Saisonalität, die wir später sehen werden. </li><li>  Auswahl des richtigen Bezugspunkts.  Um die richtigen Koeffizienten zu erhalten, müssen Sie eine Reihe verwenden, beginnend mit dem ersten signifikanten Punkt, und sich die X-Koordinate dieses Punkts merken (das Datum, an dem die Daten in der Reihe erschienen sind).  Der Trend wird an dieser Stelle im Koordinatensystem mit 0 erstellt.  Dieser Fall ist relevant für den Vergleich von Kugeln miteinander.  Beispielsweise wurden in 2GIS Städte nicht gleichzeitig gestartet und dementsprechend begannen sie, Statistiken zu unterschiedlichen Zeiten zu senden.  Gleiches gilt für die Entstehung neuer Unternehmen wie beispielsweise Friseurläden. </li><li>  Am schwierigsten ist es vielleicht, einen Kompromiss zwischen dem Detaillierungsgrad und der Angemessenheit der Datenmenge zu finden.  Wir haben uns für drei Dimensionen entschieden: Stadt, Tätigkeitsbereich, Benutzergeräteplattform. </li></ol><br><img src="https://habrastorage.org/webt/sg/-m/gc/sg-mgcxzvjd16e8aodxfv4ikixq.png" alt="Grafik 3: Eine Serie ohne Trend"><br>  <font color="gray"><i>Grafik 3: Eine Serie ohne Trend</i></font> <br><br><h3>  Saisonalitätssuche </h3><br>  Nachdem wir die entsprechenden Trends von den Zeitreihen abgezogen haben, können wir mit der Ermittlung der Saisonalität fortfahren.  Es besteht aus zwei Unteraufgaben: <br><br><ol><li>  Feststellung des Vorhandenseins von Saisonalität in einer Reihe. </li><li>  Definitionen von Hoch- und Nebensaison - das hat praktischen Wert. </li></ol><br><h4>  Korrelationserkennung </h4><br>  Sowohl in R als auch in Python gibt es vorgefertigte Korrelationssuchfunktionen.  Wir haben die Pearson-Korrelation verwendet.  Beachten Sie beim Arbeiten mit Vektoren von Benutzerinteressen Folgendes: <br><br><ul><li>  Nach Subtraktion des Trends von der Originalserie können negative Werte erhalten werden.  Dies ist zu diesem Zeitpunkt normal. </li><li>  Für unsere Aufgabe reicht es aus, die Korrelation von Zeitreihen von 365 Tagen zu überprüfen.  Ja, der Einfluss eines Schaltjahres ist unbedeutend und wir berücksichtigen ihn nicht. </li><li>  Um nach Saisonalität zu suchen, müssen Sie Daten für mindestens zwei vollständige Zeiträume haben.  Unsere Berechnungen verwendeten Daten für vier Zeiträume. </li></ul><br>  Wir suchen nach der Korrelation zweier Vektoren: X: [0;  N-365], Y: [366;  N].  Wobei N die Länge der Reihe ist. <br><br><img src="https://habrastorage.org/webt/pm/ht/-6/pmht-6_tiwi8bek3cu6vly95pzg.png" alt="Grafik 4: Korrelationserkennung"><br>  <font color="gray"><i>Grafik 4: Korrelationserkennung</i></font> <br><br><h4>  Holen Sie sich den Vorteil </h4><br>  Die Tatsache des Vorhandenseins von Saisonalität hat keinen praktischen Wert.  Sie müssen verstehen, welche Aufmerksamkeit dem Tätigkeitsbereich im nächsten Monat geschenkt wird: erhöht, gesenkt oder normal. <br><br>  Als Endergebnis wurde eine multiplikative Skala gewählt.  Wobei das Gerät das „normale“ Maß an Benutzerinteresse im Tätigkeitsbereich ist.  Ein anderer Wert als einer kennzeichnet eine mehrfache Zunahme oder Abnahme des Interesses. <br><br>  In unserem Fall reicht [vorerst] eine ausreichend temporäre Skala von einem Monat aus.  Zur Bestimmung von Stufe 1 wurde der Median der monatlichen Benutzeraufmerksamkeit verwendet.  Berechnete dann die mehrfache Abweichung von diesem Median. <br><br><img src="https://habrastorage.org/webt/rv/pj/rr/rvpjrrnufdxhm3hmtnacnfvsu10.png" alt="Grafik 5: Jährliche Saisonalität"><br>  <font color="gray"><i>Grafik 5: Jährliche Saisonalität</i></font> <br><br>  Es ist Zeit, das Geheimnis zu enthüllen, welche Daten die Grafiken des Artikels zeigen.  Auf diese und alle vorherigen Grafiken - Klicks in den Museen von St. Petersburg.  Wie aus dem letzten Zeitplan hervorgeht, sind Museen in den Januarferien, an vielen freien Tagen und im Sommer beliebt. <br><br><h4>  Was ist, wenn ... </h4><br>  ... den Algorithmus nicht den Interessen der Benutzer, sondern zum Beispiel dem Verkauf zu widmen und zu füttern? <br><br>  Der Aktionsalgorithmus ist der gleiche: <br><br><ol><li>  Wir suchen nach Trends.  Das Publikum der Städte wächst und damit auch die Zahl der Werbetreibenden.  Es ist notwendig, den mit der wachsenden Popularität von 2GIS als Werbeplattform verbundenen Trend abzuziehen, um Branchenschübe und -abschwünge zu erzielen. </li><li>  Wir finden Umsatzkorrelationen von Jahr zu Jahr und dann Hoch- und Nebensaison. </li></ol><br><h4>  Es waren einige Anpassungen erforderlich </h4><br>  Werbung in 2GIS wird monatlich verkauft, daher dauerte die Skalierung einen Monat, die Saisonalität der Nutzer wurde jedoch bis zu einem Tag analysiert.  Aus Gründen der Abwärtskompatibilität haben wir die Algorithmen für die Arbeit mit beliebigen Reihen angepasst, wobei die x-Achse die Seriennummer des Punkts ist und die y-Achse einen bestimmten Wert hat (auf dieser Ebene spielt die Wertesemantik keine Rolle). <br><br>  Der Bezugspunkt einer Reihe von Verkäufen (Herkunft) stimmt in der Regel nicht mit dem Bezugspunkt der Saisonalität der Benutzer überein.  Schließlich gewinnt die Stadt zunächst ein Publikum, und erst dann erscheint Werbung.  Zu diesem Zeitpunkt sollten Sie die Ergebnisse zweier Saisonalitäten nicht kombinieren. <br><br>  Da die Verkäufe monatlich sind, haben wir deutlich weniger Punkte in den Reihen.  In diesem Fall sollte die Korrelation an 12 statt an 365 Punkten berücksichtigt werden. <br><br><img src="https://habrastorage.org/webt/zg/sv/lo/zgsvlogmzxvi347x9mlbs9dmdyw.png" alt="Grafik 6: Saisonalität der Verkäufe"><br>  <font color="gray"><i>Grafik 6: Saisonalität der Verkäufe</i></font> <br><br>  Als letzten Schritt haben wir beschlossen, der Saisonalität der Benutzer eine Verkaufssaisonalität aufzuerlegen.  Jetzt können Sie sehen, wo wir Anzeigen später als nötig verkaufen, und hinter der Nachfrage der Nutzer zurückbleiben. <br><br>  Beispielsweise sind Benutzer daran interessiert, von April bis Oktober Beton in Nischni Nowgorod zu kaufen.  Während Unternehmen nur von Mai bis September Werbung betreiben. <br><br><img src="https://habrastorage.org/webt/fy/n7/mc/fyn7mcluv1duddq8a2hueb-idj8.png" alt="Grafik 7: Schnittpunkt von Benutzersaisonalität und Verkaufssaisonalität"><br>  <font color="gray"><i>Grafik 7: Der Schnittpunkt von Benutzersaisonalität und Saisonalität von Verkäufen (grün - Benutzer, blau - Verkäufe, rot - Zufall)</i></font> <br><br><h4>  Was hat getan </h4><br>  Alles, was oben beschrieben wurde, ist in MS SQL Server 2016 implementiert. Um nach linearer Regression und Korrelation zu suchen, wird R verwendet, das seit Version 2016 im Server enthalten ist. Da wir bereits Data Warehouse- und Benutzerstatistikanalysen auf SQL Server haben, hat es sich als sehr praktisch erwiesen, R zu verwenden für mathematische Berechnungen. <br><img src="https://habrastorage.org/webt/zo/uv/fi/zouvfihpufdsdoywofaz85qvra4.jpeg"><br>  Beispiel für die Verwendung von R aus TSQL: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-comment"><span class="hljs-comment">#tmp EXEC sp_execute_external_script @language = N'R', @script = @R, @input_data_1 = N'SELECT DataId, Number, Value FROM #data ORDER BY 1, 2'</span></span></code> </pre> <br>  Wo: <br><br><ul><li>  die Variable R enthält direkt den R-Code; </li><li>  language = N'R '- Gibt an, dass das in der R-Variablen übergebene Skript R-Sprachcode enthält. In SQL Server 2017 können Sie zusätzlich zu R language = N'Python' verwenden.  Dementsprechend muss der Python-Code an den Skriptparameter übergeben werden. </li><li>  input_data_1 - enthält eine SQL-Abfrage, auf deren Ergebnisse im R-Code als InputDataSet zugegriffen werden kann. </li><li>  Das Ergebnis der Prozedur ist das RecordDataSet, das als OutputDataSet &lt;- calcAllTrend (data = InputDataSet) gebildet wird. </li><li>  Stellen Sie sicher, dass Sie das Format des resultierenden Datensatzes angeben: Anzahl und Art der Spalten.  In diesem Fall wird das Format des OutputDataSet durch die Tabelle #tmp bestimmt, in der die Ergebnisse aufgezeichnet werden.  Oder Sie können WITH RESULT SETS verwenden, um den resultierenden Datensatz zu beschreiben. </li></ul><br>  In unserem Fall stellte sich heraus, dass ein wesentlicher Teil der Laufzeit von sp_execute_external_script direkt durch den Zugriff auf R Services belegt ist.  Der R-Code selbst hat schnell geklappt. <br><br>  Ich möchte Sie daran erinnern, dass wir Trends und Saisonalität für alle Städte berechnen wollten, die 2GIS und alle Tätigkeitsbereiche abdecken.  Aus diesem Grund haben wir beschlossen, nicht eine Zeile (Nummer, Wert) an InputDataSet zu senden, sondern mehrere gleichzeitig, gruppiert nach DataId.  Und der DataId-Zyklus wurde in R organisiert. So haben wir beim Aufrufen von R Services erheblich gespart. <br><br><h3>  Fakten aus dem Leben </h3><br>  Sie lesen den Artikel bis zum Ende, es ist lobenswert.  Um Sie vor den Ergebnissen zu unterhalten, teilen wir interessante Fakten mit, die bei der Analyse der Saisonalität ermittelt wurden. <br><br><h4>  Fakt Nr. 1 </h4><br>  Autofahrer wissen aus eigener Erfahrung, dass die Zeit der Suche nach Reifen und Reifenmontage Frühling und Herbst ist.  Um genau zu sein, kann die Jahreszeit in verschiedenen Städten sehr unterschiedlich sein.  Daher ist es beim Erstellen von Sammlungen und Dashboards (Startbildschirme in Produkten) wichtig, die Saisonalität in jeder bestimmten Stadt zu berücksichtigen. <br><br><img src="https://habrastorage.org/webt/r4/6j/q4/r46jq4en-rsrns97h1tsqk-ae18.png" alt="Grafik 8: Saisonalität der Reifen in Krasnodar, Nowosibirsk und Norilsk"><br>  <font color="gray"><i>Grafik 8: Saisonalität der Reifen in Krasnodar, Nowosibirsk und Norilsk</i></font> <br><br><h4>  Fakt Nr. 2 </h4><br>  Die Saisonalität kann sogar innerhalb desselben Tätigkeitsbereichs unterschiedlich sein - auf verschiedenen Gerätetypen.  Zum Beispiel beginnen die Neujahrsgeschenke auf der großen Leinwand im Oktober zu suchen.  Während in mobilen Versionen die Suche einen Monat später beginnt und der Höhepunkt näher an das neue Jahr fällt. <br><br><img src="https://habrastorage.org/webt/hk/ke/rc/hkkercsmeaa9svqjoplu3pvgjyk.png" alt="Grafik 9: Suchen Sie online und in der mobilen 2GIS-Version nach Weihnachtsgeschenken"><br>  <font color="gray"><i>Grafik 9: Suchen Sie online und in der mobilen 2GIS-Version nach Weihnachtsgeschenken</i></font> <br><br><h4>  Fakt Nr. 3 </h4><br>  Während der Arbeit an der Saisonalität haben wir einen Tätigkeitsbereich entdeckt, dessen Interesse alle drei Monate gezeigt wird.  Und das gilt für verschiedene Städte Russlands. <br>  Versuchen Sie zu erraten, was für ein Geschäft das ist. <br><br><div class="spoiler">  <b class="spoiler_title">Spoilerspitze</b> <div class="spoiler_text">  Stark unterschiedliche Städte Russlands.  Also weder das Wetter noch die Region noch lokale Unternehmen, sondern etwas weltweit Gemeinsames. <br>  3 Monate = Quartal.  Achten Sie auf April ... <br></div></div><br><img src="https://habrastorage.org/webt/nj/dj/rv/njdjrv7h0mgsoyo5coff1uvkxle.png" alt="Grafik 10"><br>  <font color="gray"><i>Grafik 10</i></font> <br><br><div class="spoiler">  <b class="spoiler_title">Die Antwort</b> <div class="spoiler_text">  Hierbei handelt es sich um Sozialversicherungsfonds. Alle drei Monate werden vierteljährliche Berichte an das FSS übermittelt. Der Höchststand im April wird durch eine Änderung der Berichtsformulare ab dem 1. Januar eines jeden Jahres erklärt. <br></div></div><br><h3>  Noch einmal über die Hauptsache </h3><br>  Suchen Sie nach Korrelationen in den Daten?  Vergessen Sie nicht, diese Daten vorzubereiten: Prozesslücken, frei von Trends und Emissionen.  Denken Sie daran, dass die Vorbereitung die meiste Zeit in Anspruch nimmt. <br><br>  In der Phase der Arbeit mit Zeilen abstrahieren Sie so viel wie möglich von der Semantik: Arbeiten Sie mit dem Wert und der Seriennummer des Punkts, dann ist der Code einfacher wiederzuverwenden.  Die Visualisierung in jeder Phase der Verarbeitung wird sehr hilfreich sein. <br><br>  PS: Die Aufgabe, Trends und Saisonalität zu finden, wurde als Teil einer anderen Aufgabe erledigt - der Vorhersage von Änderungen der Benutzeraufmerksamkeit nach dem Erwerb von Werbung in 2GIS.  Wenn Sie interessiert sind, kann ich Ihnen gerne mitteilen, wie wir die Prognose erstellt haben. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de414041/">https://habr.com/ru/post/de414041/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de414027/index.html">Können meine Freunde als wahre Freunde betrachtet werden?</a></li>
<li><a href="../de414029/index.html">Geheimnisvolles Licht um einen neu gebildeten Stern und was Astronomen darüber denken</a></li>
<li><a href="../de414031/index.html">Nach dem Treffen "PostgreSQL 11 New Features"</a></li>
<li><a href="../de414037/index.html">Einmal bei einer HFT-Firma ...</a></li>
<li><a href="../de414039/index.html">Geschichten von Wolken</a></li>
<li><a href="../de414049/index.html">Die Hauptspiele der E3 2018: Fallout 76, Metro Exodus, Doom Eternal und andere</a></li>
<li><a href="../de414053/index.html">5 Missverständnisse über die DSGVO</a></li>
<li><a href="../de414055/index.html">Trans-PRK: einer der Standards für die Sehkorrektur</a></li>
<li><a href="../de414057/index.html">Rechenzentrumskühlung: Ein Lied von Eis und Feuer</a></li>
<li><a href="../de414059/index.html">Der Prozentsatz der Ehe unter LED-Lampen. Eine Auswahl von 27.000 verkauften Lampen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>