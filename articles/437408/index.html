<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßùüèº ü§ô üòù 802.1x, EX2200, NPS y todo-todo-todo ... üë®üèΩ‚Äç‚úàÔ∏è ‚úçüèø üïö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La idea de usar 802.1x como un medio para combatir el acceso no autorizado a la red no es nueva. Cada uno de nosotros debe haber encontrado un servici...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>802.1x, EX2200, NPS y todo-todo-todo ...</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437408/">  La idea de usar 802.1x como un medio para combatir el acceso no autorizado a la red no es nueva.  Cada uno de nosotros debe haber encontrado un servicio de mensajer√≠a del servicio de entrega, que puede ver un cable de conexi√≥n de la manga de una chaqueta de la empresa, y ya puede ver c√≥mo √©l, al notar un enchufe RJ-45 libre, se apresura hacia √©l con un movimiento r√°pido ... <br><br>  Sin embargo, si en el concepto general el uso y la configuraci√≥n de 802.1x con autorizaci√≥n a trav√©s de RADIUS es simple y vencido, en este caso hubo un incidente, cuya soluci√≥n ofrecer√© a continuaci√≥n. <br><a name="habracut"></a><br>  <b>Dado:</b> <br><br><ul><li>  Interruptor de acceso - EX2200, JunOS 12.3R2. </li><li>  Servidor RADIUS basado en NPS Windows Server 2012R2. </li></ul><br><ul><li>  Un zool√≥gico diverso de dispositivos de este tipo: televisores, AppleTV, impresoras y otras peque√±as bestias de red, que no pueden iniciar sesi√≥n como participantes normales y adecuados a trav√©s de certificados o PEAP.  Cada uno de los dispositivos en Active Directory tiene su propia cuenta en la unidad organizativa correspondiente con sAMAccountName = MAC (en min√∫sculas, sin caracteres de separaci√≥n), contrase√±a = sAMAccountName. </li></ul><br>  Para los departamentos o grupos de seguridad que contienen estos dispositivos, se ha creado una FineGrainedPasswordPolicy por separado para poder establecer contrase√±as inapropiadas para los est√°ndares de seguridad. <br><br>  Configuraci√≥n original para 802.1x en EX2200: <br><br><pre><code class="plaintext hljs">//set actual interfaces set interfaces interface-range ACCESS_PORTS member "ge-0/0/[0-40]" // Config interface range as L2 ports set interfaces interface-range ACCESS_PORTS unit 0 family ethernet-switching set protocols dot1x authenticator authentication-profile-name dynamicvlan set protocols dot1x authenticator radius-options use-vlan-id set protocols dot1x authenticator interface ACCESS_PORTS supplicant single set protocols dot1x authenticator interface ACCESS_PORTS transmit-period 10 set protocols dot1x authenticator interface ACCESS_PORTS retries 0 set protocols dot1x authenticator interface ACCESS_PORTS mac-radius set protocols dot1x authenticator interface ACCESS_PORTS supplicant-timeout 10 //set actual reject-vlan and fail-vlan set protocols dot1x authenticator interface ACCESS_PORTS server-reject-vlan default set protocols dot1x authenticator interface ACCESS_PORTS server-fail vlan-name default set protocols dot1x authenticator interface ACCESS_PORTS guest-vlan default //set actual password set access radius-server 172.17.xx secret "xxx" set access profile dynamicvlan authentication-order radius set access profile dynamicvlan radius authentication-server 172.17.xx</code> </pre> <br>  Todas las estaciones de trabajo iniciaron sesi√≥n sin problemas, pero cualquiera de los shushera mencionados anteriormente - no.  <b>Wireshark</b> mostr√≥ obstinadamente que NPS env√≠a Access-Reject con el c√≥digo EAP 4, que, como se conoce en c√≠rculos estrechos, significa Fallo. <br><br>  Informativo, sin embargo, como siempre ... <br><br>  El protocolo utilizado por el solicitante para la autenticaci√≥n de mac-radius es EAP-MD5 de forma predeterminada. <br><br>  Tambi√©n hay opciones de PEAP y PAP. <br><br>  PEAP no est√° disponible para EX2200. <br><br>  Estamos intentando configurar PAP.  En texto plano, por supuesto, realmente no quer√≠a, pero, por no tener lo mejor, manejamos el preciado equipo <br><br><pre> <code class="plaintext hljs">set protocols dot1x authenticator interface ACCESS_PORTS mac-radius authentication-protocol pap</code> </pre><br>  y (redoble de tambor) - Error de sintaxis - √∫tilmente nos dice Juniper. <br><br>  Durante el enfrentamiento, las amenazas con un soldador y otras medidas represivas, el sitio web de Juniper sugiri√≥ que esta opci√≥n solo est√° disponible para el firmware de la versi√≥n 15.1. <br><br>  Parecer√≠a, aqu√≠ est√°, una soluci√≥n al problema.  Pero no, el mismo Juniper no solo lo recomienda, sino que tambi√©n protege de todas las formas posibles la costumbre de la obscenidad como el firmware 15.1 en el EX2200.  Grit, utilizaci√≥n del procesador central y RAM por encima de la norma, por lo tanto, 12.3: el techo de la versi√≥n JunOS para los afortunados propietarios de EX2200. <br><br>  Bien, trataremos con el protocolo que env√≠a los datos del interruptor a NPS. <br><br>  Entonces result√≥ que por defecto los env√≠a a eap-md5, ¬øqu√© qu√©?  - Correctamente, est√° deshabilitado en Windows Server, a partir de la versi√≥n 2008; dicen que no es seguro.  Varias consultas en Google dan el resultado deseado: un archivo de registro que incluye el protocolo que necesitamos. <br><br>  Sin embargo, NPS responde obstinadamente a las solicitudes de impresoras y otros <b>Access-Reject</b> . <br>  Sac√≥ cigarrillos, record√≥ que lo hab√≠a tirado, lo escondi√≥ ... <br><br>  Google, qui√©n est√° all√≠ en el mundo ... Pero no, esto es de otra √≥pera ... <br><br>  Ok Google?  <i>Autenticaci√≥n MAC 802.1x con NPS RADIUS</i> <br><br>  Despu√©s de algunas p√°ginas de google, en el foro ubnt encontr√© lo que estaba buscando.  Debe habilitar varios par√°metros para las credenciales de los dispositivos y luego volver a crear las contrase√±as y, voila, Miracle.  Adem√°s, result√≥ incluso mejor de lo esperado.  Eap-md5, por supuesto, no es una buena noticia, pero a√∫n mejor que el texto sin formato. <br><br>  La configuraci√≥n resultante, la configuraci√≥n y las capturas de pantalla de la pol√≠tica bajo el spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Configuraci√≥n EX2200, pol√≠ticas NPS</b> <div class="spoiler_text">  <i>Archivo de registro m√°gico que incluye soporte para EAP-MD5 en Windows Server 2012 R2</i> <br><br><pre> <code class="plaintext hljs">Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\RasMan\PPP\EAP\4] "RolesSupported"=dword:0000000a "FriendlyName"="MD5-Challenge" "Path"=hex(2):25,00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,\ 00,25,00,5c,00,53,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,52,00,\ 61,00,73,00,63,00,68,00,61,00,70,00,2e,00,64,00,6c,00,6c,00,00,00 "InvokeUsernameDialog"=dword:00000001 "InvokePasswordDialog"=dword:00000001</code> </pre> <br>  Despu√©s de realizar cambios en el registro, debe reiniciar el servicio NPS <br><br><pre> <code class="plaintext hljs">Stop-Service IAS Start-Service IAS</code> </pre> <br>  <i>Un script que establece la configuraci√≥n necesaria para las cuentas del dispositivo:</i> <br><br><pre> <code class="plaintext hljs">$devices=Get-ADUser -SearchBase "ou=802.1x-groups,ou=devices_groups,dc=company,dc=local" -Filter * foreach ($device in $devices) { set-aduser -Identity $device.name -UserPrincipalName ($device.name+"@company.local") -PasswordNeverExpires $true -AllowReversiblePasswordEncryption $true -CannotChangePassword $true Set-ADAccountPassword -Identity $device.name -NewPassword (ConvertTo-SecureString -AsPlainText $device.name -force) }</code> </pre> <br>  De hecho, establece los par√°metros equivalentes a una captura de pantalla.  Pero, una cosa es dejar un par de dispositivos, y otra muy distinta cuando tienes m√°s de veinte.  El script tambi√©n restablece la contrase√±a para la cuenta del dispositivo, que es necesaria despu√©s de habilitar el cifrado inverso. <br><br><img src="https://habrastorage.org/webt/an/bg/be/anbgbeol62k1b6z8ggilno0mdry.png" alt="imagen"><br><br>  <i>Configuraci√≥n de la pol√≠tica de NPS:</i> <br><br><ul><li>  Indicamos el grupo con dispositivos y el tipo de puerto. <br><br><img src="https://habrastorage.org/webt/3m/56/nf/3m56nfzul_m4hgqajodg8_1o9he.png"></li><li>  Despu√©s de manipular el registro, nuestro querido MD5-Challenge aparece en la lista de protocolos disponibles.  Nosotros lo elegimos <br><br><img src="https://habrastorage.org/webt/iv/or/bz/ivorbzx3cc3owpxytsmfzcjzpgu.png"></li><li>  Establecemos la configuraci√≥n restante en funci√≥n de los requisitos de la implementaci√≥n l√≥gica.  No es diferente de la configuraci√≥n est√°ndar RADIUS + 802.1x. <br><br><img src="https://habrastorage.org/webt/q6/ta/z9/q6taz9g0pganoesjbos2kwu6_ai.png"></li></ul><br></div></div><br>  <b>El resultado:</b> <br><br><ul><li>  Los dispositivos de red como televisores, Apple TV, impresoras est√°n autenticados por 802.1xy miembros del grupo. </li><li>  Las contrase√±as no se transmiten en texto claro, sino al menos encriptadas. </li></ul><br>  <b>Lista de direcciones, gu√≠as y recursos:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Recomendaciones de Juniper para la versi√≥n de software en EX2200</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Soporte EAP-PAP en dispositivos Juniper para autenticaci√≥n MAC RADIUS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Comunidad UBNT dando el √∫ltimo puntapi√© en la direcci√≥n correcta</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/437408/">https://habr.com/ru/post/437408/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../437390/index.html">"Secretos" DPAPI. Mira el burro</a></li>
<li><a href="../437396/index.html">¬øPor qu√© CarPrice es impulsado por inteligencia artificial?</a></li>
<li><a href="../437400/index.html">El gasto en la nube super√≥ el gasto en infraestructura tradicional por primera vez, ¬øqu√© significa</a></li>
<li><a href="../437402/index.html">C√≥mo le ense√±√© al robot a correr en videos de YouTube</a></li>
<li><a href="../437406/index.html">Microkernel seL4. Verificaci√≥n formal de programas en el mundo real.</a></li>
<li><a href="../437410/index.html">Introducci√≥n a Spring Boot con Spring Data Mongo</a></li>
<li><a href="../437414/index.html">Donde m√°s de 20 millones de tarjetas de transporte son vulnerables en Rusia: desensamblamos y desarrollamos MIFARE Classic</a></li>
<li><a href="../437416/index.html">Gesti√≥n de capacidad: encontrar el equilibrio perfecto</a></li>
<li><a href="../437418/index.html">Acerca de las entidades, DTO, ORM y carga diferida</a></li>
<li><a href="../437420/index.html">¬øQuieres LED eternos? Descubra soldadores y archivos. O iluminaci√≥n casera casera</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>