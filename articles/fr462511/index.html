<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÖ±Ô∏è ‚òØÔ∏è üç´ Google Play Instantan√©. Refactoring √† vie üÄÑÔ∏è üê´ üíñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lorsque vous vous impliquez dans le programme d'acc√®s anticip√©, vous ne savez jamais √† l'avance ce qui se passera √† la fin. Bien s√ªr, vous esp√©rez que...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Google Play Instantan√©. Refactoring √† vie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/462511/">  Lorsque vous vous impliquez dans le programme d'acc√®s anticip√©, vous ne savez jamais √† l'avance ce qui se passera √† la fin.  Bien s√ªr, vous esp√©rez que la technologie d√©collera et que votre application devancera le march√© et obtiendra une partie des relations publiques sur Google I / O.  Et c'est une bonne motivation pour lire les codes sources au lieu de la documentation au stade initial, qui, de plus, doit √™tre t√©l√©charg√©e √† partir des archives secr√®tes. <br><br>  √Ä <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AppsConf,</a> Evgeny Saturov a montr√© √† quoi pourrait conduire la participation √† un acc√®s anticip√© en d√©veloppant une application avec un lancement instantan√©, expliquant toutes les fonctionnalit√©s de Google Play Instant en cours de route.  En d√©chiffrant son rapport, nous d√©couvrirons d'o√π viennent les bundles d'applications Android et ce que la livraison dynamique a √† voir avec cela, nous familiariser avec les nouveaux plug-ins Gradle et apprendre √† faire face aux surprises que les d√©veloppeurs du SDK nous ont pr√©par√©s. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/-KUj_Kp_Xcg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <strong>√Ä propos du conf√©rencier:</strong> Evgeny Saturov ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">saturovv</a> ) travaille pour Surf, une entreprise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">sp√©cialis√©e</a> dans le d√©veloppement personnalis√© Android et iOS, et plus r√©cemment, le d√©veloppement sur Flutter.  Eugene Flutter est un passionn√© et fondateur de FlutterDevPodcast. <br><br><h2>  Une br√®ve excursion dans l'histoire </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lo/nw/zr/lonwzrpjzpi7m-nosk3wy3gndzw.png" width="300"></div><br>  Il y a deux ans, un gars formidable est venu chez nous √† Surf et a d√©clar√©: ¬´Nous avons une technologie que peu de gens connaissent jusqu'√† pr√©sent.  Et vous avez des clients et des cas int√©ressants.  Voyons, nous vous donnerons notre technologie, vous l'int√©grez quelque part et vous obtenez une symbiose sympa.  Nous en ferons la promotion sur Google I / O et tout le monde ira bien. " <br><br>  En fait, <b>travailler avec le programme d'acc√®s anticip√© est un cochon dans un coup de coude</b> .  Vous devez travailler avec du code brut, qui, bien s√ªr, ne fonctionne pas toujours comme pr√©vu et d√©crit.  Dans notre cas: <br><br><ul><li>  Tous les artefacts ont √©t√© livr√©s sous la forme d'une archive ZIP, qui devait √™tre t√©l√©charg√©e tous les quelques jours √† partir d'un stockage super secret et mise √† jour sur une machine locale uniquement manuellement. </li><li>  Vous ne pouvez travailler que dans le "canari". </li><li>  Il n'y a presque pas de documentation, seulement des documents Google non structur√©s dispers√©s, plus souvent similaires au flux de pens√©es des d√©veloppeurs. </li><li>  Le d√©ploiement dans la nourriture, bien s√ªr, est impossible - cela n'est possible qu'apr√®s que la technologie a √©t√© publi√©e.  Autrement dit, l'ensemble du d√©ploiement est uniquement dans la piste alpha. </li><li>  Il est probable qu'apr√®s une version publique, il se r√©v√©lera que le SDK a √©t√© compl√®tement r√©√©crit sans prise en charge de la compatibilit√© descendante.  Vous obtenez des interfaces et des API compl√®tement diff√©rentes - vous devez tout refaire. </li></ul><br>  Voici un bref r√©sum√© de la fa√ßon dont nous avons particip√© au programme d'acc√®s anticip√©. <br><br>  Tout cela est devenu possible gr√¢ce √† notre partenaire r√©gulier - la soci√©t√© Labyrinth - la plus grande boutique en ligne de livres et de papeterie en Russie.  Ils ont rejoint le projet, ne sachant m√™me pas s'il y aurait un avantage √† la fin.  Et le fait qu'en 2017, Surf, en tant que studio, faisait partie du programme d'agence certifi√©e Google.  Malheureusement, le programme a √©t√© ferm√© cette ann√©e. <br><br><h3>  Applications instantan√©es Android </h3><br>  En 2017, pour que l'application s'ex√©cute sans installation, elle devait √™tre sci√©e correctement en modules. <br><br><img src="https://habrastorage.org/webt/fq/qz/d7/fqqzd7dexvnj3d6ojcpi7nunhrw.png"><br><br>  Nous avons de nouveaux plugins Gradle qui g√©n√®rent les artefacts correspondants: <br><br><ul><li>  Module d'application instantan√©e - un plugin d'application qui a g√©n√©r√© une archive ZIP avec un APK, un pour chaque module de fonctionnalit√© de l'application; </li><li>  Module d'application installable - APK g√©n√©r√©. </li></ul><br>  Une hi√©rarchie √† deux niveaux des modules d'entit√©s est apparue.  Il ne pouvait toujours y avoir qu'un seul module de fonctionnalit√©s de base et contenait tout le code de base disponible pour toutes les fonctionnalit√©s, ressources, d√©pendances, etc.  Le module Feature de niveau sup√©rieur contenait l'impl√©mentation d'√©crans sp√©cifiques. <br><br>  Mais <strong>c'√©tait long et cher</strong> pour un certain nombre de raisons: <br><br><ul><li>  La structure modulaire rigide en soi est une grande limitation.  Il est difficile d'imaginer qu'une grande entreprise transformera son application en cours de d√©veloppement et parfaitement fonctionnelle en une pile de modules fumeurs au fil des ans juste pour prendre en charge une nouvelle technologie qui ne sait toujours pas si elle va d√©coller ou non. </li><li>  Restriction stricte sur la taille de l'assemblage, c'est-√†-dire qu'une fonction ne doit pas d√©passer 4 Mo.  Il s'agit d'une limite objectivement petite, et parfois compl√®tement inaccessible, par exemple, en raison de fortes d√©pendances ou quelque chose comme √ßa. </li><li>  Assurez-vous d'utiliser AppLinks, car c'est le seul moyen d'acc√©der √† l'application instantan√©e.  L'utilisateur a cliqu√© sur le lien depuis le courrier, le messager, les r√©sultats de la recherche et est arriv√© √† votre √©cran via l'interception du lien. </li><li>  Enfin, un grand nombre de limitations techniques.  Au d√©but, il √©tait m√™me impossible d'utiliser NDK.  Vous ne pouvez pas envoyer de notifications push, recevoir des donn√©es sensibles, modifier les param√®tres de l'appareil et d√©marrer des processus d'arri√®re-plan.  Les services, les r√©cepteurs de diffusion et les fournisseurs de contenu n'ont pas pu √™tre utilis√©s.  Seule activit√©. </li></ul><br>  La mission principale de l'application instantan√©e est juste une d√©monstration de l'interface utilisateur et rien de plus.  Le refactoring a √©t√© tr√®s douloureux, et donc cette histoire est encore presque jamais trouv√©e en production. <br><br>  Mais en toute honn√™tet√©, la mise en ≈ìuvre de l'application instantan√©e dans le Labyrinthe a donn√© une augmentation de 5% des achats via le client mobile. <br><br><h2>  2019. Google Play Instantan√© </h2><br>  Deux ans se sont √©coul√©s, dans la cour de 2019 - Instant Apps existe toujours, mais pas en tant que technologie ind√©pendante.  Il est encore tr√®s rare en production, je ne l'ai pas cherch√© expr√®s, mais je ne connais que quelques exemples: Sports.ru, Vimeo.  Il est peu probable que Google comptait sur un tel r√©sultat lorsqu'il a annonc√© cette technologie. <br><br>  D√©sormais, l'application instantan√©e est appel√©e diff√©remment - Google Play Instant.  Le changement de nom a permis d'√©liminer la documentation non pertinente.  Si vous voyez l'application instantan√©e Android, il est imm√©diatement clair que cela n'est plus pertinent. <br><br>  En plus du nom, tout le reste a chang√©, y compris la structure modulaire.  <strong>Les demandes sont devenues plus fid√®les</strong> .  La technologie s'int√®gre de mani√®re compl√®tement diff√©rente dans le projet et ne n√©cessite pas un refactoring aussi douloureux, ce qui est certainement bon. <blockquote>  Mais ce qui est moins √©vident et √† mon avis beaucoup plus important, c'est que cette technologie, rest√©e tr√®s niche et rare, est devenue l'anc√™tre de toute une famille de technologies dont elle fait d√©sormais partie. </blockquote>  Au d√©part, Google a positionn√© l'application instantan√©e comme une technologie qui attire les gens vers les entreprises, pas vers les applications.  Il y avait une directive de conception qui interdisait les demandes d'atterrissage avec un seul bouton "T√©l√©charger la demande compl√®te".  Mais un autre probl√®me fondamental a √©t√© r√©solu de c√¥t√©, et je soup√ßonne que cela s'est produit par accident. <br><br>  En f√©vrier de cette ann√©e, le remarquable appareil Samsung Galaxy S10 + avec 1 To de m√©moire √† bord a vu le jour.  Pensez-y juste - un t√©raoctet!  Pourquoi avez-vous tant besoin?! <br><br>  Selon les statistiques officielles de Google, au cours des 7 derni√®res ann√©es, la taille moyenne des APK a √©t√© multipli√©e par 5,5. <br><br><img src="https://habrastorage.org/webt/n1/fj/gi/n1fjgis20pkxen7kpz7h1mqavte.png"><br><br>  La taille de la construction est vraiment importante, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">recherche sur</a> ces statistiques montre: <br><br><ul><li>  chaque 6 Mo de montage suppl√©mentaire r√©duit la conversion de l'installation de 1%; </li><li>  70% des utilisateurs v√©rifient la taille de l'application avant de t√©l√©charger; </li><li>  50% des utilisateurs sont int√©ress√©s par l'espace que l'application prendra sur l'appareil apr√®s l'installation. </li></ul><br>  Cela est encore plus important si votre public cible est des personnes √¢g√©es, ou avec des revenus pas tr√®s √©lev√©s, ou s'il s'agit de march√©s √©mergents. <br><br>  Ces derniers sont de plus en plus difficiles √† ignorer, car en 2018, c'est l'Inde qui a connu une augmentation incroyable des installations. <br><br><img src="https://habrastorage.org/webt/w8/l5/sc/w8l5sclkeutjcit1oweqt3t4n1q.jpeg"><br><br>  Veuillez noter qu'il existe tr√®s peu d'iOS et que le nombre total d'installations d'applications Android d√©passe celui des √âtats-Unis, du Br√©sil et de l'Indon√©sie r√©unis. <br><br>  Maintenant, il est clair quel probl√®me peut √™tre r√©solu avec Google Play Instant.  Vous pouvez utiliser des termes incompr√©hensibles. <br><br><h2>  Ensemble d'applications Android </h2><br>  Android App Bundle - un nouveau format pour publier des applications sur Google Play.  √Ä l'int√©rieur, tout n'est pas tr√®s diff√©rent de l'APK: tous les m√™mes fichiers dex, manifeste, ressources, actifs, etc.  etc.  Mais il existe √©galement des m√©tadonn√©es, qui ne parviennent pas √† l'appareil de l'utilisateur. <br><br><img src="https://habrastorage.org/webt/bb/ut/jt/bbutjtxukmhiiflwbngb_ivjae0.png"><br><br>  Les m√©tadonn√©es sont repr√©sent√©es par trois fichiers: resources.pb, assets.pb, native.pb.  En fait, ce sont des tableaux de correspondance des ressources qui se trouvent dans les param√®tres d'assemblage et de configuration des appareils. <br><br><h2>  Livraison dynamique Android </h2><br>  Tout le monde conna√Æt l'existence de la signature d'application par Google Play.  Mais tout le monde n'est pas pr√™t √† stocker la cl√© de version de son application sur Google Play, car il n'y aura pas de retour en arri√®re.  <b>Il est impossible de quitter la signature d'application par Google Play.</b> <br><br>  Apr√®s avoir donn√© une fois la cl√© de lib√©ration √† Google Play, vous ne pouvez plus jamais signer votre demande comme avant, de votre c√¥t√©.  Mais en √©change de cela, vous pouvez profiter pleinement du pack d'applications Android en tant que format.  Et le processus de signature de l'assemblage sera maintenant un peu diff√©rent. <br><br><img src="https://habrastorage.org/webt/bc/lx/mw/bclxmwzyamlhlisvggnyrori7gk.png"><br><br>  Vous signerez toujours l'assembly avant la sortie sur Google Play, mais vous le signerez avec la cl√© de t√©l√©chargement, qui n'est pas unique.  Il peut √™tre rappel√© depuis la console, r√©√©dit√© s'il est compromis ou perdu.  Vous donnez votre cl√© de d√©verrouillage √† la console et lui dites au revoir - Google va maintenant signer l'assemblage pour vous et jure qu'il gardera votre cl√© en s√©curit√©. <br><br>  Cependant, si vous ne donnez pas la cl√© de sortie √† Google Play, vous ne pourrez pas utiliser quoi que ce soit dans votre projet qui sera discut√© plus loin.  Google resserre les vis, et m√™me l'application instantan√©e, sans donner la cl√©, ne pourra plus se d√©ployer. <br><br>  En fait, ce n'est pas du tout dr√¥le, parce que les personnes qui ont achet√© la promotion Instant App et sont entr√©es dans toute l'histoire ont refactoris√© leurs applications, mais pour une raison quelconque, elles ne peuvent pas donner leur cl√© √† Google Play (ou le service de s√©curit√© est cat√©goriquement contre ou pour d'autres raisons objectives) se sont retrouv√©s dans une situation o√π ils ne peuvent plus soutenir cette d√©cision.  Des centaines d'heures de travail ont en fait √©t√© jet√©es √† la poubelle. <br><br><h3>  2014. Le support Split APK appara√Æt dans Android Lollipop </h3><br>  Puisque nous sommes nostalgiques aujourd'hui, nous reviendrons encore plus t√¥t dans le pass√© - en 2014. <br><br>  Je me souviens encore comment sur mon NEXUS 5, le meilleur t√©l√©phone au monde, l'assemblage Android Lollipop est entr√© avec un design mat√©riel incroyable qui semblait juste un bombardement.  Mais il y a eu des changements qui sont pass√©s inaper√ßus pour beaucoup - c'est le support de l'APK Split. <br><br>  Split APK - un m√©canisme qui vous permet de diviser l'application en petits fichiers APK et, en les installant sur un seul appareil, de les faire se comporter comme une seule application. <br><br>  N'oubliez pas cela et continuez. <br><br>  Android Dynamic Delivery est un nouveau format de distribution d'applications sur Google Play. <br><br><img src="https://habrastorage.org/webt/pg/yk/85/pgyk85hx5b1ymk2ryhbek8ssmhi.png"><br><br>  Nous avions un APK, maintenant le bundle d'applications Android appara√Æt, pour autant qu'une alternative.  AAB agit comme un incubateur-g√©n√©rateur de ces APK tr√®s divis√©s.  AAB d√©ploie le chignon de l'APK, qui peut ensuite √™tre utilis√© comme une application r√©guli√®re en les installant en parall√®le. <br><br>  Voyons de quel type d'APK il s'agit. <br><br><img src="https://habrastorage.org/webt/ku/7k/e5/ku7ke5ykakq3mewuawg5jrcnf-k.png"><br><br>  Au minimum, il s'agit de l'APK de base, qui joue le m√™me r√¥le que dans l'application instantan√©e: c'est le code de base, les ressources de base et la logique m√©tier qui sont fouill√©s entre toutes les fonctionnalit√©s. <br><br>  Apparaissent √©galement: <br><br><ul><li>  Fichiers APK, au nom desquels il existe des pr√©fixes √©trangement similaires aux modificateurs de ressources graphiques (la ligne sup√©rieure du diagramme). </li><li>  Une autre famille d'APK nous rappelle les architectures de processeur. </li><li>  APK de localisation. </li></ul><br>  Il y a environ deux ans, lorsque les graphiques vectoriels n'√©taient pas aussi r√©pandus, de nombreuses applications contenaient principalement des ressources raster, qui √©taient coup√©es √† diff√©rentes densit√©s de pixels sur les √©crans.  L'assemblage pourrait devenir assez lourd.  Les utilisateurs ont t√©l√©charg√© toutes ces ressources, et la plupart d'entre elles ont √©t√© stock√©es sur l'appareil avec un poids mort. <br><br>  D√©sormais, un tel m√©canisme permet √† l'utilisateur de ne recevoir que l'ensemble des ressources n√©cessaires sp√©cifiquement pour son appareil.  Une personne vient sur Google Play, s√©lectionne l'application, Google Play comprend les caract√©ristiques de l'appareil de l'utilisateur et donne l'ensemble des fichiers APK fractionn√©s n√©cessaires - un fichier APK de chaque cat√©gorie. <br><br>  Types de livraison dynamique APK: <br><br><ul><li>  Un et un seul APK de base. </li><li>  L'APK de configuration est au maximum de trois types: <em>res * x, assets * y, lib * z.</em>  Ici: x est le nombre de modificateurs de ressources utilis√©s;  y est le nombre de types d'architectures utilis√©s;  z est le nombre de localisations linguistiques.  Si, par exemple, le projet n'utilise pas de code natif et de biblioth√®ques natives, aucune cat√©gorie ne sera associ√©e au code natif et il restera deux fichiers APK. </li><li>  Fonctionnalit√© dynamique illimit√©e APK. </li></ul><br>  L'APK de fonctionnalit√© dynamique sera discut√© plus en d√©tail ci-dessous.  Mais d'abord, nous dirons au revoir au bloc Split. <br><br><h3>  Au revoir Split </h3><br>  Vous pouvez affirmer qu'avant, vous pourriez faire quelque chose de similaire, g√©n√©rer manuellement un tas d'APK avec uniquement le bon ensemble de ressources, puis tout est d√©ploy√© manuellement sur Google Play. <br><br><pre><code class="java hljs">android { splits { density { enable <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> exclude <span class="hljs-string"><span class="hljs-string">"ldpi"</span></span>, <span class="hljs-string"><span class="hljs-string">"xxhdpi"</span></span>, <span class="hljs-string"><span class="hljs-string">"xxxhdpi"</span></span> compatibleScreens <span class="hljs-string"><span class="hljs-string">'small'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'large'</span></span>, <span class="hljs-string"><span class="hljs-string">'xlarge'</span></span> } } }</code> </pre> <br>  Cette entreprise en soi est plut√¥t douteuse, et maintenant tout cela est tout simplement ignor√©.  Si vous cr√©ez le bundle d'applications Android, un bloc Bundle appara√Æt, ce qui vous permet de d√©sactiver manuellement la r√©partition du projet dans l'une des cat√©gories. <br><br><pre> <code class="java hljs">android { bundle { language { enableSplit = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } density { enableSplit = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } abi { enableSplit = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } } }</code> </pre> <br>  Vous pouvez sp√©cifier que l'application prend en charge, par exemple, uniquement le russe ou uniquement l'anglais, et ignorer cette √©tape lors de l'assemblage. <br><br>  Les plus attentifs, probablement, r√©fl√©chissent maintenant √† ce qu'il faut faire avec les pr√©-sucettes.  Seulement dans Android 5 est apparu le support de l'APK Split.  Nous devons en quelque sorte sortir de cette situation, car le SDK Min n'est en aucun cas le 21e. <br><br>  Pour les pr√©Lollipops, la situation est assez maladroite, mais seulement possible.  Google Play recueille plusieurs APK pour les pr√©-sucettes, qui incluent toutes sortes de combinaisons d'APK de configuration.  Il n'y a qu'un seul APK, mais il y a beaucoup d'options. <br><br><h3>  Le pack d'applications Android change notre vie </h3><br>  Et tr√®s important.  Tout d'abord, il peut √™tre beaucoup plus facile de cr√©er un projet, surtout si vous avez l'habitude de cr√©er manuellement l'APK divis√©.  Mais d'apr√®s mes observations, il n'y en a pas beaucoup. <br><br>  Deuxi√®mement, vous ne risquez plus de perdre ou de compromettre la cl√© de lib√©ration.  Il n'y aura pas de grande trag√©die, si vous perdez votre cl√© de t√©l√©chargement, vous pouvez la rappeler et la r√©√©mettre. <br><br>  Nous ne pointerons pas le doigt - dans le haut du Google Play russe, il y a des applications qui ont longtemps des cl√©s de version sur w3bsit3-dns.com, tous les assemblages personnalis√©s sont sign√©s avec une cl√© de version, et il n'y a rien √† faire avec cela dans les cinq prochaines ann√©es.  Il reste √† attendre la transition vers la signature V3, qui est apparue avec seulement 28 API. <br><blockquote>  L'avantage incontestable du pack d'applications Android: les utilisateurs arr√™tent de d√©penser du trafic et de l'espace disque sur des ressources dont ils n'ont pas besoin.  Cela am√©liore consid√©rablement la r√©tention de l'application. </blockquote>  Mais si vous avez tous les graphiques dans le vecteur, deux localisations et aucune biblioth√®que native, l'avantage sera microscopique. <br><br><h2>  Module de fonctionnalit√© dynamique </h2><br>  Dynamic Feature Module est un module fonctionnel qui n'est pas fourni lors de l'installation de l'application, mais qui est t√©l√©charg√© depuis Google Play et install√© uniquement sur demande. <br><br>  Ces modules sont comparables √† l'APK de base. <br><br><img src="https://habrastorage.org/webt/hp/ho/2v/hpho2vlpy2bawtztyql8r58aruu.png"><br><br>  Il est important que chacun de ces modules de fonctionnalit√©s lui-m√™me contienne √©galement un ensemble de fichiers APK de configuration fractionn√©s.  Par cons√©quent, le nombre total d'APK peut augmenter au-del√† de toute mesure.  Mais ce n'est pas du tout votre pr√©occupation, Google Play le fait. <br><br><h3>  Applications pour les modules d'entit√©s dynamiques: </h3><br>  <strong>Des fonctionnalit√©s utilis√©es par un tr√®s faible pourcentage de l'audience</strong> , mais n√©anmoins importantes pour votre produit.  Par exemple, il s'agit d'une application de divertissement de contenu, et 95% de ses utilisateurs consomment du contenu.  Mais il y a un tr√®s petit pourcentage d'√©diteurs qui g√©n√®rent du contenu.  Pour eux, il y a un √©diteur vid√©o sympa qui p√®se vraiment beaucoup, fonctionne incroyablement cool.  Ensuite, cela n'a aucun sens de pond√©rer l'assemblage pour tout le monde et tout le monde, vous pouvez mettre cette fonctionnalit√© dans le module de fonctionnalit√©s dynamiques et la fournir uniquement √† ceux qui en ont besoin, en la t√©l√©chargeant plus tard. <br><br>  <strong>Fonctionnalit√©s lourdes qui ne sont pas li√©es au sc√©nario d'utilisation principal de l'application.</strong>  Par exemple, la navigation AR dans un service de carte.  Toute fonctionnalit√© AR est la plus √† mettre dans le module de fonctionnalit√© dynamique. <br><br>  <strong>Fonctionnalit√©s qui devraient √™tre disponibles pour les utilisateurs sans installer l'application elle-m√™me</strong> (par exemple, s√©lectionner un produit dans le catalogue et passer une commande).  Certes, c'est quelque chose de tr√®s suspect qui rappelle tout. <br><blockquote>  Les applications instantan√©es Android sont d√©sormais le module de fonctionnalit√© dynamique activ√© instantan√©ment. <br></blockquote>  Ainsi, il s'av√®re qu'il existe deux types de modules d'entit√©s dynamiques: <br><br><ul><li>  Les modules de fonctions dynamiques communs sont des modules de fonctions qui sont t√©l√©charg√©s et install√©s sur un p√©riph√©rique s√©par√©ment de l'application principale.  Ils y vivent aussi longtemps que l'application elle-m√™me existe.  Jusqu'√† ce que vous le supprimiez, le module de fonctions dynamiques le sera. </li><li>  Modules de fonctions dynamiques activ√©s instantan√©ment - modules de fonctions disponibles pour s'ex√©cuter sans installation sur l'appareil.  Ce module vit pour une dur√©e limit√©e. </li></ul><br>  Le deuxi√®me type d'applications sur Google Play se distingue par la pr√©sence du bouton Try.  Lorsque vous cliquez dessus, l'URL par d√©faut est remplac√©e et vous pouvez voir √† quoi ressemble l'application au moins comme exemple d'une fonctionnalit√© principale. <br><br>  Cela peut souvent √™tre trouv√© dans la section des jeux.  C'est pratique et encore plus applicable qu'aux applications, car vous pouvez t√©l√©charger un petit morceau du jeu en d√©mo et voir de quoi il s'agit, cela vaut-il la peine de d√©penser votre trafic et votre temps. <br><br><h2>  Structure modulaire </h2><br>  J'ai d√©j√† dit que la structure modulaire a √©t√© simplifi√©e.  Voyons comment. <br><br>  Au d√©part, nous avions une structure assez monstrueuse.  Entre autres choses, il avait des modules vides, par exemple, le module Instant App √©tait toujours vide, il n'avait pas de code, pas de ressources, mais seulement le fichier build.gradle et c'√©tait tout. <br><br>  Les d√©veloppeurs ont pens√©, pourquoi alors produire des modules suppl√©mentaires uniquement afin de collecter des artefacts d'un certain type.  Et ils l'ont vu, et la fonctionnalit√© a √©t√© transf√©r√©e au module d'application. <br><br>  Mais ensuite, ils sont all√©s encore plus loin et ont pens√© - pourquoi avons-nous besoin du module de fonctionnalit√©s de base?  Il a des probl√®mes avec lui, car nous initialisons tout l√†-bas et son ID d'application est diff√©rent.  Les b√©quilles viennent d'ici, par exemple, en transf√©rant l'ID d'application du module d'application vers le module de fonctionnalit√© de base et en le rempla√ßant comme un v√©ritable ID d'application de l'application afin que tout soit suivi dans Crashlytics, etc. <br><br>  En cons√©quence, cela s'est av√©r√© comme √ßa. <br><br><img src="https://habrastorage.org/webt/s5/ld/ys/s5ldysjxqmlmuqm8axqd70lxyq0.png"><br><br>  Ils ont quitt√© le module d'application, attach√© au-dessus des modules de fonctionnalit√©s - et c'est tout! <br><br>  Ne transmettez pas mes √©motions quand je l'ai d√©couvert.  Les gars de la grande sc√®ne ont dit qu'ils avaient une technologie sympa: "Coupons tous les applications √† cette structure!"  Mais ce n'est pas du travail pendant 5 minutes, mais du travail avec de grandes cons√©quences. <br><br>  En 2017, avoir une application monolithique n'√©tait pas encore une honte.  Le labyrinthe √©tait exactement comme √ßa, alors il n'avait m√™me pas atteint la version publique, mais √©tait en version b√™ta.  Au moment o√π nous nous sommes impliqu√©s dans le Early Access Program, il y avait d√©j√† environ 90 √©crans.  Nous avons pass√© deux mois suppl√©mentaires pour refactoriser, tester et nous assurer que tout fonctionne vraiment. <br><br>  Et apr√®s cela, ils disent: <strong>"Nous sommes trop intelligents, cela peut √™tre fait beaucoup plus facilement</strong> . <strong>"</strong> <br><br>  Mais revenons √† la prose. <br><br><h3>  Configuration Gradle </h3><br>  Afin de prendre en charge la nouvelle configuration, nous devons d'abord r√©pertorier tous les modules de fonctionnalit√©s dynamiques dans le fichier build.gradle du module d'application dans le bloc Android: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  build.gradle app- android { dynamicFeatures = [":dynamic_feature", M:dynamic_feature2M] }</span></span></code> </pre> <br>  Apr√®s cela, dans le fichier build.gradle de chaque module d'entit√©s dynamiques, √©crivez la d√©pendance sur le module d'application: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  build.gradle  dynamic feature- dependencies { implementation project(':app') }</span></span></code> </pre> <br>  En principe, rien de compliqu√©.  Mais il y a aussi une configuration de manifestes. <br><br><h3>  Configuration du manifeste </h3><br>  Dans le manifeste du module d'application, nous pouvons d√©finir le v√©ritable indicateur pour indiquer qu'il existe au moins une fonctionnalit√© activ√©e instantan√©ment dans cette application: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   app- &lt;dist:module dist:instant="true|false" /&gt;</span></span></code> </pre> <br>  Si ce drapeau n'est pas pr√©sent, il ne sera pas possible de s'incorporer dans la piste correspondante sur Google Play. <br><br>  En outre, il existe √©galement une configuration manifeste pour chaque module de fonctionnalit√© dynamique individuellement, dans laquelle il existe davantage de param√®tres: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//    dynamic feature- &lt;dist:module dist:instant="true|false" // Instant-Enabled  dist:onDemand="false|true" // ,         dist:title="@string/feature_modulejnstall_name"&gt; //   &lt;dist:fusing dist:include="true |false" /&gt; //,      APK  preLollipop &lt;/dist:module&gt;</span></span></code> </pre> <br>  Les deux premiers drapeaux s'excluent l√©g√®rement mutuellement, car <code>onDemand</code> est la fonctionnalit√© de base habituelle et <code>instant</code> est la m√™me fonctionnalit√© installable. <br><br>  Titre - le nom technique du module, selon lequel plus tard, apr√®s l'avoir cod√© en dur dans notre application, nous pomperons ce module depuis Google Play. <br><br>  Le param√®tre <code>include</code> est un param√®tre pour preLollipops.  Si vous la d√©finissez sur false, les utilisateurs de preLollipops ne verront jamais cette fonctionnalit√© et ne pourront pas l'utiliser. <br><br><h3>  Configuration des projets Gradle </h3><br>  La dur√©e de vie du plugin Instantapp et du plugin de fonctionnalit√© √©tait assez courte mais dynamique.  Ils ont dur√© moins de deux ans.  Depuis mars de cette ann√©e, ils ne sont plus pris en charge. <br><br>  Maintenant, il n'y a qu'un seul module d'entit√©s dynamiques que nous utilisons: <br><pre> <code class="java hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.dynamic-feature'</span></span></code> </pre> <br><h3>  Configuration du projet dans le module d'application uniquement </h3><br><blockquote>  Un point important: tous les param√®tres concernant la signature (signature-configuration), l'assemblage (ProGuard-configuration), versionCode et versionName doivent √™tre effectu√©s uniquement dans le module d'application build.gradle. </blockquote>  Sinon, ils seront ignor√©s.  √âvitez de sp√©cifier l'un de ces blocs de configuration dans les fichiers build.gradle des modules de fonctions dynamiques. <br><br><h2>  Google play instantan√© </h2><br>  Maintenant, nous avons ce qui suit. <br><br>  <strong>Les exigences pour la structure modulaire ont √©t√© simplifi√©es autant que possible.</strong>  C'est vraiment une bonne nouvelle pour ceux qui ne se sont pas encore impliqu√©s.  Vous pouvez maintenant essayer, m√™me si vous avez une application avec sa propre structure.  Cela ne vous affectera pas du tout, vous pouvez simplement attacher le module sur le dessus, et tout fonctionnera bien. <br><br>  <strong>Les restrictions sur la taille des assemblages sont devenues plus fid√®les.</strong>  Si auparavant c'√©tait 4 Mo, maintenant: <br><br><ul><li>  Les modules de fonctions dynamiques ne sont g√©n√©ralement pas limit√©s en taille; </li><li>  Les modules de fonctions dynamiques activ√©s instantan√©ment peuvent prendre jusqu'√† 10 Mo. </li></ul><br>  Mais maintenant, il y a une √©chelle progressive. <br><br><img src="https://habrastorage.org/webt/hn/xq/rg/hnxqrghmprre_roahys7gkwquhu.png"><br><br>  Si votre fonctionnalit√©: <br><br><ul><li>  plus de 10 Mo, alors je suis d√©sol√©; </li><li>  de 4 √† 10 Mo - accessible par le bouton "Essayer" de Google Play et c'est tout; </li><li>  moins de 4 Mo - tous les moyens d'attirer les utilisateurs vers le module Instant-Enabled sont disponibles (lancement √† partir de la publicit√©, par lien, √† partir de messages, etc.). </li></ul><br>  <strong>Un m√©canisme de chargement des modules est apparu - Play Core API.</strong>  Peu de gens savent que l'application instantan√©e √©tait install√©e via Chrome. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybeLaunchInstantApp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tab tab, String url, String referrerUrl, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isIncomingRedirect)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tab == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || tab.getWebContents() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; InstantAppsHandler handler = InstantAppsHandler.getInstance(); Intent intent = tab.getTabRedirectHandler() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? tab.getTabRedirectHandler().getInitialIntent() : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isIncomingRedirect &amp;&amp; intent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; intent.getAction() == Intent.ACTION_VIEW) { Intent resolvedIntent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(intent); resolvedIntent.setData(Uri.parse(url)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handler.handleIncomingIntent(getAvailableContext(), resolvedIntent, ChromeLauncherActivity.isCustomTabIntent(resolvedIntent)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ... } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre> <br>  Il s'agit d'un v√©ritable morceau de code de Chrome pour Android, qui a intercept√© le lien vers votre application instantan√©e, est all√© sur Google Play et a remplac√© les applications instantan√©es √† partir de l√†.  Si l'application instantan√©e a √©t√© d√©tect√©e, elle a en quelque sorte ouvert l'activit√©, √† partir de laquelle l'application instantan√©e a ensuite √©t√© lanc√©e. <br><br>  Il y avait donc d'√©normes probl√®mes avec le d√©ploiement de cette fonctionnalit√©.  Avec Samsung, c'est une histoire compl√®tement diff√©rente, je soup√ßonne que leur navigateur int√©gr√© a l√©g√®rement plus de privil√®ges que Chrome.  L'application instantan√©e n'a pas fonctionn√© jusqu'√† la derni√®re. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Play Core Library</strong></a> <strong>vous permet d'oublier les probl√®mes de livraison.</strong>  Il vous suffit de le brancher sous forme de package: <br><br><pre> <code class="java hljs">implementation <span class="hljs-string"><span class="hljs-string">'com.google.android.play:core:1.4.0'</span></span></code> </pre> <br>  Et t√©l√©chargez les modules de fonctionnalit√©s dont vous avez besoin sur Google Play. <br><br>  La biblioth√®que a une syntaxe assez fonctionnelle qui vous permet de t√©l√©charger des modules un par un: <br><br><pre> <code class="java hljs">val splitInstallManager = SplitInstallManagerFactory.create(context)</code> </pre> <br>  Ou imm√©diatement un pack de plusieurs: <br><br><pre> <code class="java hljs">val request = SplitInstallRequest .newBuilder() .addModule(<span class="hljs-string"><span class="hljs-string">"feature1"</span></span>) .addModule(<span class="hljs-string"><span class="hljs-string">"feature2"</span></span>) .build()</code> </pre> <br>  Raccrocher l'auditeur: <br><br><pre> <code class="java hljs">splitInstallManager .startInstall(request) .addOnSuccessListener { sessionId -&gt; ... } .addOnFailureListener { exception -&gt; ... }</code> </pre> <br><br>  Affichez-le dans l'interface utilisateur et r√©agissez au fait que le module a √©t√© install√©. <br><br>  Play Core Library est un bon d√©but: <br><br><ul><li>  Enfin, vous pouvez arr√™ter d'esp√©rer peut-√™tre face √† Google Chrome. </li><li>  Vous pouvez d√©montrer le chargement des modules sur l'interface utilisateur comme vous le souhaitez. </li><li>  Il est possible de charger des modules d'entit√©s par lots. </li><li>  Il existe un moyen de g√©rer de mani√®re flexible les erreurs qui se produisent lors du t√©l√©chargement et de l'installation du module de fonctionnalit√©s. </li><li>  Vous n'avez m√™me pas besoin de red√©marrer l'application apr√®s l'installation de la fonctionnalit√©, car il y a <code>SplitCompat.install()</code> - appelez-le et vous pouvez imm√©diatement acc√©der aux classes √† partir de la fonctionnalit√© fra√Æchement install√©e √† la vol√©e. </li></ul><br>  Mais je vous tromperais si je disais que la biblioth√®que Play Core ne vous fera pas souffrir: <br><br><ul><li>  Le code est obscurci et n'est document√© en aucune fa√ßon. </li><li>  Les √©v√©nements de toutes les sessions de chargement actives arrivent √† un <code>SplitInstallStateUpdatedListener</code> - vous devez les trier manuellement.  Il est n√©cessaire de sauvegarder l'ID de session quelque part √† l'avance, ce qui aboutit finalement √† un code pas tr√®s beau. </li><li>  Gestion des √©tats et gestion des erreurs maladroites et redondantes: 9 √©tats possibles, 10 erreurs possibles.  Les combinaisons de ces erreurs et √©tats peuvent √™tre interpr√©t√©es diff√©remment, tous les √©tats et erreurs sont renvoy√©s en entier. </li><li>  Il n'est pas possible de tester normalement le t√©l√©chargement et l'installation de fonctionnalit√©s sur un appareil local - c'est tout simplement impossible. </li></ul><br>  La seule option consiste √† int√©grer votre build sur Google Play dans le canal de test interne et √† essayer ce qui s'est pass√©.  Si vous trouvez une sorte de bogue, recommencez tout le processus, d√©ployez les mises √† jour et essayez plus loin.  Si vous voulez v√©rifier comment cela fonctionne sans build, vous obtenez l'erreur "-2" et vous ne pouvez que deviner ce que cela signifie.  Il s'agit du probl√®me le plus courant dans le r√©f√©rentiel avec les √©chantillons officiels de Google Dynamic Features. <br><br>  <strong>Il n'y a pas de bonne pratique pour naviguer entre les modules fonctionnels.</strong>  Dans les exemples officiels, qui montrent comment l'interaction entre les modules de fonctionnalit√© se produit, ils sugg√®rent que la situation soit r√©solue tout simplement: activez la d√©pendance d'un module √† l'autre.  Chaque direction a sa propre d√©pendance, pourquoi revenir? <br><br><img src="https://habrastorage.org/webt/yr/xh/vx/yrxhvxc_6mdbpre9ppka5-telrq.png"><br><br>  Mais alors tous les avantages de la division en modules sont perdus.  Nous sommes pass√©s √† des modules bien avant qu'il ne soit n√©cessaire de r√©soudre de tels probl√®mes.  Et ils l'ont fait en partie parce que cela simplifie le travail avec la base de code pour les d√©veloppeurs inexp√©riment√©s qui, en raison de l'inexp√©rience, peuvent utiliser l'activit√© de signature avec l'activit√© de base - puis recherchez-le pour une r√©vision du code. <br><br>  Si vous connectez tous les modules avec des d√©pendances de haut en bas, alors seul Google sera bon √† partir de cela, qui n'aura rien √† penser de la navigation. <br><br>  Nous avons longtemps r√©fl√©chi √† ce que nous allions en faire, et finalement nous avons trouv√© une solution qui me fait encore frissonner.  Il est appel√© <code>Class.forName</code> - instanciant une classe en utilisant le <code>ClassPath</code> complet, ce qui rompt en renommant la classe de n'importe quel package √† partir de son chemin, etc. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActivityCrossFeatureRoute</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareIntent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context: Context)</span></span></span><span class="hljs-function">: Intent? </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Intent(context, Class.forName(targetClassPath())) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: ClassNotFoundException) { Logger.e(<span class="hljs-string"><span class="hljs-string">"Activity with the following classpath was not found in the current "</span></span> + <span class="hljs-string"><span class="hljs-string">"application: ${targetClassPath()}. If this activity is the part of Dynamic Feature, "</span></span> + <span class="hljs-string"><span class="hljs-string">"please check if this Dynamic Feature is downloaded and installed on the device"</span></span> + <span class="hljs-string"><span class="hljs-string">"successfully."</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> } }</code> </pre> <br>  J'ai eu honte d'en parler √† quelqu'un jusqu'√† ce que je me rende dans le r√©f√©rentiel d'applications <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plaid</a> et que je vois qu'ils ont r√©solu le probl√®me de navigation de la m√™me mani√®re et conseill√© √† tout le monde de le faire sur Stack Overflow. <br><br>  Plaid est l'un des vitrines les plus cool, avec eux, Google essaie toutes ses derni√®res tendances, animations sympas, astuces de conception, les derniers composants de l'interface utilisateur et, en particulier, la modularit√©. <br><br>  <strong>Beaucoup, vraiment beaucoup de bugs, de sous-ing√©nierie, de rugosit√©.</strong>  Vous n'aurez pas √† rechercher de bogues pendant longtemps. <br><br><ul><li>  L'acc√®s aux ressources √† partir du module d'application n'est possible que le long du chemin complet. </li></ul><br>  Au lieu d'√©crire comme ceci: <code>R.string.primaryColor</code> , vous devez √©crire comme ceci √† chaque fois dans le code: <code>ru.appname.package.R.string.primaryColor</code> .  D'une mani√®re diff√©rente, la build ne fonctionnera pas, et voici le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> vers le tracker de probl√®me officiel. <br><br><ul><li>  Le probl√®me avec l'ex√©cution de JobScheduler sur les appareils O +.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La solution officielle</a> consiste √† lancer manuellement le <code>TestJobSchedulerService</code> : </li></ul><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) { Intent serviceIntent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, TestJobSchedulerService.class); startService(serviceIntent); }</code> </pre> <br><ul><li>  Erreur de gel du manifeste lors de la connexion de biblioth√®ques tierces, par exemple, Firebase, Fabric, AndroidX-packages, etc. </li></ul><br>  Tous utilisent des ID d'application d'espaces r√©serv√©s dans le manifeste.  L'ID d'application n'est pas ins√©r√© correctement, car le manifeste ne se fige pas, Android Studio ne peut pas trouver l'activit√© par d√©faut, et vous recherchez le probl√®me pendant longtemps jusqu'√† ce que vous trouviez des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conseils</a> dans l'outil de suivi des probl√®mes officiel - red√©finissez tous les fournisseurs et sp√©cifiez votre ID d'application l√†-bas. <br><br><pre> <code class="java hljs">&lt;provider android:name=<span class="hljs-string"><span class="hljs-string">"com.crashlytics.android.CrashlyticsInitProvider"</span></span> android:authorities=<span class="hljs-string"><span class="hljs-string">"ru.app.name.crashlyticsinitprovider"</span></span> tools:replace=<span class="hljs-string"><span class="hljs-string">"android:authorities"</span></span> /&gt; &lt;provider android:name=<span class="hljs-string"><span class="hljs-string">"com.google.firebase.provider.FirebaseInitProvider"</span></span> android:authorities=<span class="hljs-string"><span class="hljs-string">"ru.app.name.firebaseinitprovider"</span></span> tools:replace=<span class="hljs-string"><span class="hljs-string">"android:authorities"</span></span> /&gt; &lt;provider android:name=<span class="hljs-string"><span class="hljs-string">"androidx.core.content.FileProvider"</span></span> android:authorities=<span class="hljs-string"><span class="hljs-string">"ru.app.name.fileprovide"</span></span> tools:replace=<span class="hljs-string"><span class="hljs-string">"android:authorities"</span></span> /&gt;</code> </pre> <br><ul><li>  L'impossibilit√© de plusieurs d√©pendances sur des packages tiers est l'un de mes points pr√©f√©r√©s. </li></ul><br>  Supposons que deux modules de fonctionnalit√© d√©pendent d'une biblioth√®que tierce.  Mais vous ne pouvez pas cr√©er de d√©pendance directe car vous obtenez: <code>org.gradle.api.GradleException: [:feature1, :feature2] all package the same library [com.lib.Name:VeryGoodLib]</code> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©ponse officielle</a> : que faire si dans ces modules diff√©rentes versions de la biblioth√®que sont indiqu√©es. <br><br>  Les d√©veloppeurs conseillent: ajoutez un module de fonctionnalit√© √† la hi√©rarchie, dans laquelle il n'y a rien d'autre qu'une d√©pendance √† une biblioth√®que tierce, et rendez-la d√©pendante de deux modules de fonctionnalit√© source. <br><br><ul><li>  Le cache d'appels d'InstantApps.isInstantApp (contexte) dans attachBaseContext (). </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les exemples</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code</a> de la documentation pour les d√©veloppeurs Android se <code>attachBaseContext()</code> , simplement parce qu'ils offrent <code>attachBaseContext()</code> pour acc√©der au contexte par <code>this</code> biais, et si <code>context==null</code> , vous ne pouvez m√™me pas v√©rifier si InstantApps est en cours d'ex√©cution ou non. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attachBaseContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(base: Context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.attachBaseContext(base) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!InstantApps.isInstantApp(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) { SplitCompat.install(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } }</code> </pre> <br><ul><li>  <code>ConstraintLayout</code> affiche les <code>ConstraintLayout</code> lors de l'utilisation des <code>Groups</code> et des <code>Barriers</code> . </li></ul><br>  Imaginez que vous ayez tout travers√©: assembl√© l'assemblage, devin√© qu'il doit √™tre int√©gr√© dans le canal de test sur Google Play, Google Play n'affichait pas de bo√Æte de dialogue rouge.  Avec des mains tremblantes, vous installez cet assemblage sur l'appareil, installez la fonction, allez √† l'√©cran - et vous voyez que toute la disposition s'est regroup√©e en pile dans le coin sup√©rieur gauche.  En effet, si vous utilisez des <code>Groups</code> et des <code>Barriers</code> , il existe une merveilleuse m√©thode <code>getPackageName</code> , qui, pour une raison quelconque, ne fonctionne pas correctement.  Par cons√©quent, toutes vos vues ne sont tout simplement pas positionn√©es.  Toutes les contraintes s'envolent et tout se trouve au hasard sur l'√©cran. <br><br>  Enfin, apr√®s avoir surmont√© cela, vous constaterez que ... <br><br>  <strong>Les fonctionnalit√©s dynamiques sont toujours en version b√™ta!</strong>  Vous ne pouvez pas rester bloqu√© en production - vous avez toujours √©t√© un testeur gratuit pour Google! <br><br><img src="https://habrastorage.org/webt/ry/ct/i6/rycti6op3z_5tkbmn0b5dv77psk.png"><br><br>  Mais pas selon Google.  Si vous voulez en devenir un, vous pouvez remplir le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Formulaire d'Int√©r√™t</a> et peut-√™tre aurez-vous de la chance et vous aurez acc√®s pour √™tre bloqu√© en production. <br><blockquote>  <em>On pense</em> qu'Instant Apps a perdu cette bataille.  Il est peu probable que cela soit annonc√© dans les ann√©es √† venir, mais l'augmentation de l'activit√© d'information autour d'AMP le confirme secr√®tement. </blockquote>  La pens√©e que je voulais vous rappeler √† vous et √† moi-m√™me - <strong>√©crire pour les gens</strong> .  R√©fl√©chissez √† trois fois avant de prendre une d√©cision, surtout si vous d√©veloppez des outils que d'autres d√©veloppeurs utiliseront.  Chaque d√©cision et chaque action affecteront quelqu'un et, √©ventuellement, lui g√¢teront un peu de sang.  <strong>Je ne voudrais pas causer de panne √† quelqu'un.</strong> <br><br><h3>  Liens utiles </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://developer.android.com/topic/google-play-instant/overview</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://developer.android.com/guide/app-bundle</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://developer.android.com/studio/proiects/dvnamic-delivery</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://developer.android.com/guide/app-bundle/playcore</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Regroupement d'une application en un instant (Android Dev Summit '18)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/googlesamples/android-instant-apps</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/googlesamples/android-dynamic-features</a> </li></ul><br><blockquote>  Nous avons fait le programme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Saint AppsConf</a> , qui est d√©j√† du 21 au 22 octobre √† Saint-P√©tersbourg, encore plus mouvement√© et diversifi√© qu'il ne l'√©tait au printemps.  D√©couvrez-le! <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou abonnez-vous √† la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newsletter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√©l√©gramme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l√†, nous parlons des rapports individuels et des pr√©paratifs de la conf√©rence.</font></font><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr462511/">https://habr.com/ru/post/fr462511/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr462501/index.html">Pourquoi ai-je besoin de ma propre autorit√© de certification</a></li>
<li><a href="../fr462503/index.html">√Ä quoi servent les ¬´signaux d'or¬ª de la surveillance et du SRE?</a></li>
<li><a href="../fr462505/index.html">Ne me trompez pas avec votre programmation fonctionnelle</a></li>
<li><a href="../fr462507/index.html">Quand le courrier est livr√©: lutter contre la perte de notifications push dans iOS</a></li>
<li><a href="../fr462509/index.html">Product Fest - Conf√©rence sur la gestion des produits informatiques √† laquelle vous souhaitez vous rendre</a></li>
<li><a href="../fr462513/index.html">D√©localisation: pr√©paration, s√©lection, d√©veloppement du territoire</a></li>
<li><a href="../fr462515/index.html">Bugs lors de l'utilisation du clavier syst√®me</a></li>
<li><a href="../fr462519/index.html">Le livre "Microservices. Mod√®les de d√©veloppement et de refactoring ¬ª</a></li>
<li><a href="../fr462523/index.html">Serveur d'autorisation √† deux facteurs LinOTP</a></li>
<li><a href="../fr462525/index.html">3CX lance de nouveaux softphones SIP pour iOS et Android avec cryptage vocal de bout en bout</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>