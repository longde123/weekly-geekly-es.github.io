<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¿â€ğŸ“ ğŸ’› ğŸ•Ÿ æˆ‘ä»¬ä½¿ç”¨StockSharpå›¾å½¢æ¡†æ¶ç¼–å†™äº¤æ˜“æœºå™¨äººã€‚ ç¬¬äºŒéƒ¨åˆ† ğŸ‘· ğŸ‘¨ğŸ¿â€ğŸ« ğŸ¤µğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬å°†ç»§ç»­è°ˆè®ºä½¿ç”¨StockSharpå¹³å°åˆ›å»ºäº¤æ˜“æœºå™¨äººã€‚ ç¬¬ä¸€ç¯‡æ–‡ç« æ¶‰åŠé¡¹ç›®çš„åˆ›å»ºå’Œäº¤æ˜“ç³»ç»Ÿä¸»è¦å…ƒç´ çš„ç»˜åˆ¶ã€‚ åœ¨å‘¨æœŸçš„æœ€åé˜¶æ®µï¼Œæˆ‘ä»¬å°†ç›´æ¥å®æ–½äº¤æ˜“ç­–ç•¥ã€‚ 

 åˆ›å»ºæŠ•èµ„ç»„åˆé¢æ¿ 
 ç±»ä¼¼äºå·¥å…·æ ï¼Œåˆ›å»ºä¸€ä¸ªæ—¥å¿—é¢æ¿ã€‚ ä¸ºæ­¤ï¼Œå°†å¦ä¸€ä¸ªUserControlæ·»åŠ åˆ°XAMLæ–‡ä»¶å¤¹ã€‚ ä¸ºå…¶å‘½åä¸ºPortfo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æˆ‘ä»¬ä½¿ç”¨StockSharpå›¾å½¢æ¡†æ¶ç¼–å†™äº¤æ˜“æœºå™¨äººã€‚ ç¬¬äºŒéƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iticapital/blog/433078/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/bv/ll/xa/bvllxaiaoeshjg0_71xwfocozqa.png"></a> <br><br> æˆ‘ä»¬å°†ç»§ç»­è°ˆè®ºä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">StockSharp</a>å¹³å°åˆ›å»ºäº¤æ˜“æœºå™¨äººã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€ç¯‡æ–‡ç« </a>æ¶‰åŠé¡¹ç›®çš„åˆ›å»ºå’Œäº¤æ˜“ç³»ç»Ÿä¸»è¦å…ƒç´ çš„ç»˜åˆ¶ã€‚ åœ¨å‘¨æœŸçš„æœ€åé˜¶æ®µï¼Œæˆ‘ä»¬å°†ç›´æ¥å®æ–½äº¤æ˜“ç­–ç•¥ã€‚ <a name="habracut"></a><br><br><h2> åˆ›å»ºæŠ•èµ„ç»„åˆé¢æ¿ </h2><br> ç±»ä¼¼äºå·¥å…·æ ï¼Œåˆ›å»ºä¸€ä¸ªæ—¥å¿—é¢æ¿ã€‚ ä¸ºæ­¤ï¼Œå°†å¦ä¸€ä¸ªUserControlæ·»åŠ åˆ°XAMLæ–‡ä»¶å¤¹ã€‚ ä¸ºå…¶å‘½åä¸ºPortfolioGridControlã€‚ å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªPortfolioGridå…ƒç´ ã€‚ <br><br><pre><code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.PortfolioGridControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:PortfolioGrid x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioGrid"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br> åœ¨PortfolioGridControlæ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®¢é˜…æ–°æŠ•èµ„ç»„åˆçš„å¤–è§‚äº‹ä»¶å’Œè¿æ¥å™¨ä¸Šæ–°å¤´å¯¸çš„å¤–è§‚äº‹ä»¶ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PortfolioGridControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); MainWindow.Instance.Connector.NewPortfolio += PortfolioGrid.Portfolios.Add; MainWindow.Instance.Connector.NewPosition += PortfolioGrid.Positions.Add; }</code> </pre> <br> å› æ­¤ï¼Œåœ¨åˆ›å»ºæ–°æŠ•èµ„ç»„åˆæ—¶ï¼Œå®ƒå°†å‡ºç°åœ¨æŠ•èµ„ç»„åˆé¢æ¿ä¸­ï¼Œè€Œå½“æ–°å¤´å¯¸å‡ºç°åœ¨æŠ•èµ„ç»„åˆé¢æ¿ä¸­æ—¶ï¼Œå®ƒå°†è¢«æ›´æ–°ã€‚ <br><br> åœ¨MainWindowçš„ä¸­å¤®éƒ¨åˆ†ï¼Œæ·»åŠ åˆ›å»ºçš„PortfolioGridControlé¢æ¿ï¼š <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Securities"</span></span>&gt; &lt;myxaml:SecurityGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"SecurityPanel"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Portfolios"</span></span>&gt; &lt;myxaml:PortfolioGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br> è¿è¡Œæ£€æŸ¥ï¼š <br><br><img src="https://habrastorage.org/webt/bz/vs/tl/bzvstlk5xgb54mycansuoqjozhu.png"><br><br> æˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰æŠ•èµ„ç»„åˆçš„æ ‡ç­¾ã€‚ <br><br><h2> åˆ›å»ºè®¢å•é¢æ¿ </h2><br>  Sï¼ƒ.APIä¸­çš„è®¢å•æ å¯ä»¥ä¸‹è®¢å•ï¼Œæ’¤æ¶ˆè®¢å•å’Œé‡æ–°æ³¨å†Œã€‚ ç±»ä¼¼äºå·¥å…·æ ï¼Œåˆ›å»ºä¸€ä¸ªè®¢å•é¢æ¿ï¼Œå°†å¦ä¸€ä¸ªUserControlæ·»åŠ åˆ°XAMLæ–‡ä»¶å¤¹ã€‚ ä¸ºå®ƒå‘½åä¸ºOrderGridControlã€‚ å‘å…¶ä¸­æ·»åŠ OrderGridå…ƒç´ ï¼š <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.OrderGridControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:OrderGrid x:Name=<span class="hljs-string"><span class="hljs-string">"OrderGrid"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br>  OrderGridå…·æœ‰ä¸€ä¸ªOrderRegisteringæ³¨å†Œäº‹ä»¶ï¼ŒOrderReRegistersé‡æ–°æ³¨å†Œäº‹ä»¶å’ŒOrderCancelingå–æ¶ˆäº‹ä»¶ã€‚ <br><br> è®©æˆ‘ä»¬åˆ›å»ºä»–ä»¬çš„å¤„ç†ç¨‹åºï¼š <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.OrderGridControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:OrderGrid x:Name=<span class="hljs-string"><span class="hljs-string">"OrderGrid"</span></span> OrderRegistering=<span class="hljs-string"><span class="hljs-string">"OrderGrid_OnOrderRegistering"</span></span> OrderReRegistering=<span class="hljs-string"><span class="hljs-string">"OrderGrid_OnOrderReRegistering"</span></span> OrderCanceling=<span class="hljs-string"><span class="hljs-string">"OrderGrid_OnOrderCanceling"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br> åœ¨è¯·æ±‚æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªOrderWindowçª—å£ï¼Œæ‚¨éœ€è¦åœ¨å…¶ä¸­æŒ‡å®šå·¥å…·ï¼ŒæŠ•èµ„ç»„åˆå’Œå¸‚åœºæ•°æ®çš„æ•°æ®æºã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå…¨éƒ¨éƒ½æ˜¯è¿æ¥å™¨ã€‚ <br><br> ç„¶åæˆ‘ä»¬ä½¿ç”¨ShowModalæ–¹æ³•è°ƒç”¨OrderWindowã€‚ å¦‚æœåœ¨æ­¤çª—å£ä¸­æŒ‰ä¸‹äº†â€œç¡®å®šâ€æŒ‰é’®ï¼Œåˆ™é€šè¿‡è¿æ¥å™¨ï¼Œæˆ‘ä»¬ä½¿ç”¨RegisterOrderæ–¹æ³•è¿›è¡Œæ³¨å†Œï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OrderGrid_OnOrderRegistering</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newOrder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OrderWindow { Title = <span class="hljs-string"><span class="hljs-string">"Order registering"</span></span>, Order = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Order(), SecurityProvider = MainWindow.Instance.Connector, MarketDataProvider = MainWindow.Instance.Connector, Portfolios = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortfolioDataSource(MainWindow.Instance.Connector), }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newOrder.ShowModal(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) MainWindow.Instance.Connector.RegisterOrder(newOrder.Order); }</code> </pre> <br> åœ¨äº‹ä»¶é‡æ–°æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œæ‰€æœ‰æ“ä½œã€‚ ä»…åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒOrderå¯¹è±¡æ‰ä¼šå‡ºç°åœ¨äº‹ä»¶ä¸­-è¿™æ˜¯éœ€è¦é‡æ–°æ³¨å†Œçš„è®¢å•ã€‚ å› æ­¤ï¼Œåœ¨OrderWindowä¸­ï¼Œæˆ‘ä»¬æŒ‡å®š<code>Order = order.ReRegisterClone(newVolume: order.Balance)</code>æ¥å¡«å……OrderWindowçª—å£çš„å­—æ®µã€‚ <br><br> ç„¶åæˆ‘ä»¬ä½¿ç”¨ShowModalæ–¹æ³•è°ƒç”¨OrderWindowã€‚ å¦‚æœåœ¨æ­¤çª—å£ä¸­å•å‡»â€œç¡®å®šâ€æŒ‰é’®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä½¿ç”¨ReRegisterCloneæ–¹æ³•é€šè¿‡è¿æ¥å™¨é‡æ–°æ³¨å†Œåº”ç”¨ç¨‹åºã€‚ æˆ‘ä»¬å°†å¿…é¡»å–æ¶ˆçš„æ—§åº”ç”¨ç¨‹åºå’Œå¿…é¡»è®¾ç½®çš„æ–°åº”ç”¨ç¨‹åºç§»äº¤ç»™å®ƒã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OrderGrid_OnOrderReRegistering</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Order order)</span></span></span><span class="hljs-function"> </span></span>{ var window = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OrderWindow { Title = <span class="hljs-string"><span class="hljs-string">"Order re-registering"</span></span>, SecurityProvider = MainWindow.Instance.Connector, MarketDataProvider = MainWindow.Instance.Connector, Portfolios = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortfolioDataSource(MainWindow.Instance.Connector), Order = order.ReRegisterClone(newVolume: order.Balance) }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (window.ShowModal(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) MainWindow.Instance.Connector.ReRegisterOrder(order, window.Order); }</code> </pre> <br> åœ¨è¯·æ±‚å–æ¶ˆäº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œåªéœ€è°ƒç”¨CancelOrderæ–¹æ³•å¹¶å°†è®¢å•ä¼ é€’ç»™å®ƒå³å¯ï¼Œè¯¥è®¢å•å¿…é¡»å–æ¶ˆï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OrderGrid_OnOrderCanceling</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Order order</span></span></span><span class="hljs-function">)</span></span> { MainWindow.Instance.Connector.CancelOrder(order); }</code> </pre> <br> ä¸ºäº†ä½¿è®¢å•æ˜¾ç¤ºåœ¨OrderGridä¸­ï¼Œæ‚¨éœ€è¦é¢„è®¢æ–°è®¢å•å‡ºç°çš„äº‹ä»¶å’ŒOrderGridControlæ„é€ å‡½æ•°ä¸­çš„æ³¨å†Œé”™è¯¯äº‹ä»¶ï¼Œç„¶åå°†è¿™äº›äº‹ä»¶ä¼ è¾“åˆ°OrderGridï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OrderGridControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); MainWindow.Instance.Connector.NewOrder += OrderGrid.Orders.Add; MainWindow.Instance.Connector.OrderRegisterFailed += OrderGrid.AddRegistrationFail; }</code> </pre> <br> åœ¨MainWindowçš„ä¸­å¤®éƒ¨åˆ†ï¼Œæ·»åŠ åˆ›å»ºçš„OrderGridControlé¢æ¿ï¼š <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Securities"</span></span>&gt; &lt;myxaml:SecurityGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"SecurityPanel"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Portfolios"</span></span>&gt; &lt;myxaml:PortfolioGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Orders"</span></span>&gt; &lt;myxaml:OrderGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"OrderGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br> è¿è¡Œæ£€æŸ¥ï¼š <br><br><img src="https://habrastorage.org/webt/hp/hu/m7/hphum7vg9x0p-ym0vwdg5_bhdv4.png"><br><br><h2> åˆ›å»ºè‡ªå·±çš„äº¤æ˜“é¢æ¿ </h2><br> ç±»ä¼¼äºå·¥å…·æ ï¼Œåˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„äº¤æ˜“çš„é¢æ¿ã€‚ åœ¨XAMLæ–‡ä»¶å¤¹ä¸­ï¼Œæ·»åŠ å¦ä¸€ä¸ªUserControlã€‚ ä¸ºå®ƒå‘½åä¸ºMyTradeGridControlã€‚ å‘å…¶ä¸­æ·»åŠ MyTradeGridå…ƒç´ ï¼š <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.MyTradeGridControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:MyTradeGrid x:Name=<span class="hljs-string"><span class="hljs-string">"MyTradeGrid"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br> åœ¨MyTradeGridControlæ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®¢é˜…ä¸€ä¸ªæ–°çš„è‡ªå·±äº¤æ˜“çš„å¤–è§‚äº‹ä»¶ï¼Œå¹¶å°†å…¶è½¬ç§»åˆ°MyTradeGridï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyTradeGridControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); MainWindow.Instance.Connector.NewMyTrade += MyTradeGrid.Trades.Add; }</code> </pre> <br> åœ¨MainWindowçš„ä¸­å¤®éƒ¨åˆ†ï¼Œæ·»åŠ åˆ›å»ºçš„OrderGridControlé¢æ¿ï¼š <br><br><pre> <code class="css hljs">&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">HorizontalAlignment</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">Stretch</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">View</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">Tabs</span></span>"&gt; &lt;!<span class="hljs-selector-tag"><span class="hljs-selector-tag">--</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">--</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Header</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">Securities</span></span>"&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">myxaml</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SecurityGridControl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Name</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">SecurityPanel</span></span>" /&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Header</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">Portfolios</span></span>"&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">myxaml</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:PortfolioGridControl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Name</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">PortfolioGridControl</span></span>" /&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Header</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">Orders</span></span>"&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">myxaml</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:OrderGridControl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Name</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">OrderGridControl</span></span>" /&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Header</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">MyTrades</span></span>"&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">myxaml</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:MyTradeGridControl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Name</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">MyTradeGridControl</span></span>" /&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span>&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span>&gt;</code> </pre> <br> è¿è¡Œæ£€æŸ¥ï¼š <br><br><img src="https://habrastorage.org/webt/-4/dr/x1/-4drx1smuyevvg-e5esktgw4ey4.png"><br><br><h2> ç”¨ç­–ç•¥åˆ›å»ºé¢æ¿ </h2><br> æˆ‘ä»¬å°†ä»¥ä¸æ‰€æœ‰ä»¥å‰çš„é¢æ¿ç›¸åŒçš„æ–¹å¼åˆ›å»ºä¸€ä¸ªç­–ç•¥é¢æ¿ã€‚ åœ¨XAMLæ–‡ä»¶å¤¹ä¸­ï¼Œæ·»åŠ å¦ä¸€ä¸ªUserControlã€‚ ä¸ºå®ƒå‘½åä¸ºStrategyControlã€‚ ä½¿ç”¨LayoutControlï¼Œæˆ‘ä»¬å°†å±å¹•åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚ åœ¨å·¦ä¾§ï¼Œå°†æœ‰ä¸€ä¸ªå¸¦æœ‰çƒ›å°å›¾è¡¨çš„é€‰é¡¹å¡å’Œä¸€ä¸ªå¸¦æœ‰ç­–ç•¥ç»Ÿè®¡ä¿¡æ¯çš„é€‰é¡¹å¡ï¼š <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>&gt; &lt;dxlc:LayoutGroup View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"StatistisAndChartLayoutGroup"</span></span>&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Chart"</span></span>&gt; &lt;xaml:Chart x:Name=<span class="hljs-string"><span class="hljs-string">"Chart"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Statistic"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span> &gt; &lt;xaml:StatisticParameterGrid x:Name=<span class="hljs-string"><span class="hljs-string">"StatisticParameterGrid"</span></span> MaxHeight=<span class="hljs-string"><span class="hljs-string">"2000"</span></span>/&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> &gt; &lt;xaml:EquityCurveChart x:Name=<span class="hljs-string"><span class="hljs-string">"EquityCurveChart"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br> è¿™é‡Œï¼ŒStatisticParameterGridç”¨äºæ˜¾ç¤ºç­–ç•¥ç»Ÿè®¡ä¿¡æ¯ï¼ŒEquityCurveChartç”¨äºæ˜¾ç¤ºæŸç›Šè¡¨ã€‚  StatisticParameterGridéœ€è¦è®¾ç½®ä¸€äº›MaxHeightå€¼ï¼Œå¦åˆ™åº”ç”¨ç¨‹åºå°†æ— æ³•å¯åŠ¨ã€‚ <br><br> å³ä¾§å°†åœ¨PropertyGridExä¸­é…ç½®ç­–ç•¥çš„å±æ€§ã€‚ ç”¨äºå¯åŠ¨å’Œåœæ­¢ç­–ç•¥çš„æŒ‰é’®ä¹Ÿå°†ä½äºï¼š <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup View=<span class="hljs-string"><span class="hljs-string">"Group"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span> dxlc:DockLayoutControl.Dock=<span class="hljs-string"><span class="hljs-string">"Right"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;xaml:PropertyGridEx x:Name=<span class="hljs-string"><span class="hljs-string">"PropertyGridEx"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"StartStrategyButton"</span></span> Content=<span class="hljs-string"><span class="hljs-string">"Start strategy"</span></span> ToolTip=<span class="hljs-string"><span class="hljs-string">"Start strategy"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"StartStrategyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"StopStrategyButton"</span></span> Content=<span class="hljs-string"><span class="hljs-string">"Stop strategy"</span></span> ToolTip=<span class="hljs-string"><span class="hljs-string">"Stop strategy"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"StopStrategyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br> å®Œæ•´ä»£ç ï¼š <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.StrategyControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:dxlc=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> xmlns:dx=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/core"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span>&gt; &lt;dxlc:LayoutControl&gt; &lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>&gt; &lt;dxlc:LayoutGroup View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"StatistisAndChartLayoutGroup"</span></span>&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Chart"</span></span>&gt; &lt;xaml:Chart x:Name=<span class="hljs-string"><span class="hljs-string">"Chart"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Statistic"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span> &gt; &lt;xaml:StatisticParameterGrid x:Name=<span class="hljs-string"><span class="hljs-string">"StatisticParameterGrid"</span></span> MaxHeight=<span class="hljs-string"><span class="hljs-string">"2000"</span></span>/&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> &gt; &lt;xaml:EquityCurveChart x:Name=<span class="hljs-string"><span class="hljs-string">"EquityCurveChart"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup View=<span class="hljs-string"><span class="hljs-string">"Group"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span> dxlc:DockLayoutControl.Dock=<span class="hljs-string"><span class="hljs-string">"Right"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;xaml:PropertyGridEx x:Name=<span class="hljs-string"><span class="hljs-string">"PropertyGridEx"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"StartStrategyButton"</span></span> Content=<span class="hljs-string"><span class="hljs-string">"Start strategy"</span></span> ToolTip=<span class="hljs-string"><span class="hljs-string">"Start strategy"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"StartStrategyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"StopStrategyButton"</span></span> Content=<span class="hljs-string"><span class="hljs-string">"Stop strategy"</span></span> ToolTip=<span class="hljs-string"><span class="hljs-string">"Stop strategy"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"StopStrategyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutControl&gt; &lt;/UserControl&gt;</code> </pre> <br> åœ¨StrategyControlæ„é€ å‡½æ•°ä¸­ï¼Œå°†è¿æ¥å™¨è®¾ç½®ä¸ºPropertyGridExçš„æ•°æ®æºï¼Œå‡ ä¹åœ¨æ¯ä¸ªæ§ä»¶ä¸­æˆ‘ä»¬éƒ½æ‰§è¡Œäº†ç±»ä¼¼çš„æ“ä½œï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StrategyControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); PropertyGridEx.SecurityProvider = MainWindow.Instance.Connector; PropertyGridEx.Portfolios = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortfolioDataSource(MainWindow.Instance.Connector); }</code> </pre> <br> æˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼å°†ç­–ç•¥è½¬ç§»åˆ°æˆ‘ä»¬çš„æ§åˆ¶ä¸­ã€‚ ä¸ºæ­¤ï¼Œè¯·åœ¨StrategyControlä¸­åˆ›å»ºBindStraregyæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†é‡‡ç”¨è¯¥ç­–ç•¥ï¼Œå¹¶å°†å…¶é“¾æ¥ä¿å­˜åˆ°å±€éƒ¨å˜é‡ä¸­ï¼Œå¹¶åœ¨PropertyGridExå’ŒStatisticParameterGridä¸­è®¾ç½®è¯¥ç­–ç•¥ã€‚ <br><br> ä½¿ç”¨SetChartæ–¹æ³•ï¼Œæˆ‘ä»¬å°†Chartèœ¡çƒ›çš„å›¾è¡¨è½¬ç§»åˆ°è¯¥ç­–ç•¥ï¼›ä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨GetChartæ–¹æ³•è·å¾—Chartç­–ç•¥ã€‚ æˆ‘ä»¬è¿˜ä¸ºç­–ç•¥è®¾ç½®äº†è¿æ¥å™¨ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Strategy _strategy; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BindStraregy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Strategy strategy</span></span></span><span class="hljs-function">)</span></span> { _strategy = strategy; PropertyGridEx.SelectedObject = strategy; StatisticParameterGrid.Parameters. AddRange(_strategy.StatisticManager.Parameters); _strategy.SetChart(Chart); _strategy.Connector = MainWindow.Instance.Connector; }</code> </pre> <br> åœ¨åˆ¶å®šæŸç›Šè¡¨æ—¶ï¼Œåº”æ³¨æ„è¯¥ç­–ç•¥å°†å¯åŠ¨å’Œåœæ­¢ï¼Œä¹Ÿè®¸æœ‰å‡ æ¬¡ï¼Œæ¯æ¬¡å¯åŠ¨è¯¥ç­–ç•¥æ—¶éƒ½å¿…é¡»æ¸…é™¤è¿™é¦–è¯—ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºResetEquityCurveChartæ–¹æ³•ï¼Œåœ¨æ­¤æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†é¦–å…ˆæ¸…é™¤EquityCurveChartã€‚ ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ä¸ºEquityCurveChartåˆ›å»ºå›¾å½¢å…ƒç´ ï¼Œå®ƒä»¬å¯ä»¥æŒ‡å®šçº¿çš„åç§°ï¼Œé¢œè‰²å’Œç±»å‹ã€‚ <br><br> ä¹‹åï¼Œæˆ‘ä»¬è®¢é˜…è¯¥ç­–ç•¥çš„PnLæ›´æ”¹äº‹ä»¶ï¼Œå¹¶åœ¨æ­¤äº‹ä»¶çš„å¤„ç†ç¨‹åºä¸­åœ¨EquityCurveChartæŸç›Šå›¾ä¸Šç»˜åˆ¶ä¸€ä¸ªæ–°å€¼ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResetEquityCurveChart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { EquityCurveChart.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pnl = EquityCurveChart. CreateCurve(<span class="hljs-string"><span class="hljs-string">"PNL"</span></span>, Colors.Green, ChartIndicatorDrawStyles.Area); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> unrealizedPnL = EquityCurveChart. CreateCurve(<span class="hljs-string"><span class="hljs-string">"unrealizedPnL"</span></span>, Colors.Black, ChartIndicatorDrawStyles.Line); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> commissionCurve = EquityCurveChart .CreateCurve(<span class="hljs-string"><span class="hljs-string">"commissionCurve"</span></span>, Colors.Red, ChartIndicatorDrawStyles.Line); _strategy.PnLChanged += () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartDrawData(); data.Group(_strategy.CurrentTime) .Add(pnl, _strategy.PnL) .Add(unrealizedPnL, _strategy.PnLManager.UnrealizedPnL ?? <span class="hljs-number"><span class="hljs-number">0</span></span>) .Add(commissionCurve, _strategy.Commission ?? <span class="hljs-number"><span class="hljs-number">0</span></span>); EquityCurveChart.Draw(data); }; }</code> </pre> <br> åœ¨ç”¨äºå•å‡»â€œå¼€å§‹â€æŒ‰é’®çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†è°ƒç”¨æ­¤æ–¹æ³•ã€‚ æˆ‘ä»¬è¿˜å°†é‡ç½®ç­–ç•¥çš„çŠ¶æ€å¹¶è¿è¡Œå®ƒï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartStrategyButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { ResetEquityCurveChart(); _strategy.Reset(); _strategy.Start(); }</code> </pre> <br> åœ¨ç”¨äºå•å‡»â€œåœæ­¢â€æŒ‰é’®çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†åœæ­¢è¯¥ç­–ç•¥ã€‚ <br> ç§æœ‰void StopStrategyButton_Clickï¼ˆå¯¹è±¡å‘é€è€…ï¼ŒRoutedEventArgs eï¼‰ï¼š <br><br><pre> <code class="cs hljs">{ _strategy.Stop(); }</code> </pre> <br> åœ¨MainWindowçš„ä¸­å¤®éƒ¨åˆ†ï¼Œæ·»åŠ åˆ›å»ºçš„StrategyControlé¢æ¿ï¼š <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Securities"</span></span>&gt; &lt;myxaml:SecurityGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"SecurityPanel"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Portfolios"</span></span>&gt; &lt;myxaml:PortfolioGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Orders"</span></span>&gt; &lt;myxaml:OrderGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"OrderGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"MyTrades"</span></span>&gt; &lt;myxaml:MyTradeGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"MyTradeGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"MarketDepth"</span></span>&gt; &lt;myxaml:MarketDepthControl x:Name=<span class="hljs-string"><span class="hljs-string">"MarketDepthControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"SimpleStrategyControl"</span></span>&gt; &lt;myxaml:StrategyControl x:Name=<span class="hljs-string"><span class="hljs-string">"SimpleStrategyControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br><h2> ç­–ç•¥åˆ¶å®š </h2><br> ä¾‹å¦‚ï¼Œè€ƒè™‘åˆ›å»ºä¸€ä¸ªç®€å•çš„çƒ›å°ç­–ç•¥ã€‚ å¦‚æœèœ¡çƒ›åœ¨å¢é•¿ï¼ˆç»¿è‰²ï¼‰ï¼Œå¥¹å°†ä¹°å…¥ï¼›å¦‚æœèœ¡çƒ›åœ¨å‡å°‘ï¼ˆçº¢è‰²ï¼‰ï¼Œå¥¹å°†å–å‡ºã€‚ <br><br> è®©æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åˆ›å»ºå¦ä¸€ä¸ªæ–‡ä»¶å¤¹-æˆ‘ä»¬å°†åœ¨å…¶ä¸­å­˜å‚¨æ‰€æœ‰ç­–ç•¥ã€‚ åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°ç±»ï¼Œå°†å…¶å‘½åä¸ºSimpleStrategyã€‚ æ‰€æœ‰Sï¼ƒç­–ç•¥éƒ½å¿…é¡»ç»§æ‰¿è‡ªç­–ç•¥ç­–ç•¥çš„åŸºç±»ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleStrategy</span></span> : <span class="hljs-title"><span class="hljs-title">Strategy</span></span> {}</code> </pre> <br> ç”±äºæˆ‘ä»¬çš„ç­–ç•¥ä½¿ç”¨èœ¡çƒ›ï¼Œå› æ­¤æˆ‘ä»¬å°†åˆ›å»ºå…¬å…±å±æ€§CandleSeriesï¼Œå¹¶åœ¨ç­–ç•¥çš„æ„é€ å‡½æ•°ä¸­å°†å…¶è®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleStrategy</span></span> : <span class="hljs-title"><span class="hljs-title">Strategy</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CandleSeries Series { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SimpleStrategy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Series = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CandleSeries(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(TimeFrameCandle), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Security(), TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">15</span></span>)) { BuildCandlesMode = MarketDataBuildModes.Build }; } }</code> </pre> <br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡ç¤ºCandleSeriesä¸­çš„èœ¡çƒ›å°†ä¸ºTimeFrameCandleï¼Œé—´éš”ä¸º15ç§’ï¼ˆTimeSpan.FromSecondsï¼ˆ15ï¼‰ï¼‰ã€‚ å¯¹äºCandleSeriesï¼Œæ‚¨å¯ä»¥æŒ‡å®šBuildCandlesModeèœ¡çƒ›åˆ›å»ºæ¨¡å¼ã€‚ æˆ‘ä»¬æŒ‡ç¤ºå°†å»ºç«‹èœ¡çƒ›ï¼ˆMarketDataBuildModes.Buildï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬å°†åŸºäºåˆ»åº¦åˆ›å»ºï¼Œä½†æ˜¯æ‚¨å¯ä»¥æŒ‡å®šå…¶ä»–æ•°æ®ç±»å‹ã€‚ <br><br> ç”±äºæˆ‘ä»¬å°†CandleSeriesè®¾ä¸ºå…¬å…±è´¢äº§ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ä¸Šä¸€æ®µä¸­æ‰€è¿°çš„PropertyGridExè¿›ä¸€æ­¥è‡ªå®šä¹‰CandleSeriesã€‚ æ‰€æœ‰ç­–ç•¥éƒ½æœ‰å¯ä»¥é‡å†™çš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦é‡å†™OnStartedæ–¹æ³•ã€‚ åœ¨å¯åŠ¨ç­–ç•¥ä¹‹å‰å°†å…¶è°ƒç”¨ï¼Œå¹¶å…è®¸æ‚¨å°†å…¶é¢„å…ˆè®¾ç½®ä¸ºå¯åŠ¨çŠ¶æ€ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _connector = (Connector)Connector; Series.Security = Security; _connector .WhenCandlesFinished(Series) .Do(ProcessCandle) .Apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); _connector.SubscribeCandles(Series); <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnStarted(); }</code> </pre> <br> åœ¨è¿™é‡Œï¼Œå¯¹äºCandleSeriesï¼Œæˆ‘ä»¬å®šä¹‰äº†PropertyGridExä¸­æŒ‡å®šçš„å·¥å…·ã€‚ ç„¶ååˆ›å»ºå¤„ç†æˆå“èœ¡çƒ›çš„è§„åˆ™ã€‚ åœ¨è§„åˆ™ä¸­ï¼ŒæŒ‡å®šå°†å¤„ç†æ¯ä¸ªå®Œæˆçš„èœ¡çƒ›çš„æ–¹æ³•-åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™æ˜¯ProcessCandleæ–¹æ³•ã€‚ ç¨åå°†æè¿°ã€‚ è®¾ç½®å®Œæ‰€æœ‰å†…å®¹åï¼Œæˆ‘ä»¬é€šè¿‡SubscribeCandlesæ–¹æ³•åœ¨è¿æ¥å™¨ä¸­çš„CandleSeriesä¸Šé¢„è®¢èœ¡çƒ›çš„å¤–è§‚ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒProcessCandleæ–¹æ³•åŒ…å«è¯¥ç­–ç•¥çš„ä¸»è¦é€»è¾‘ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessCandle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Candle candle</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsRealTime(candle)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candle.OpenPrice &lt; candle.ClosePrice &amp;&amp; Position &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { RegisterOrder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.BuyAtMarket(Volume + Math.Abs(Position))); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candle.OpenPrice &gt; candle.ClosePrice &amp;&amp; Position &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { RegisterOrder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SellAtMarket(Volume + Math.Abs(Position))); } }</code> </pre> <br> é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šèœ¡çƒ›æ˜¯å®æ—¶æ„å»ºçš„è¿˜æ˜¯å†å²æ‚ ä¹…çš„ã€‚ å¦‚æœèœ¡çƒ›æ˜¯å†å²çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å…¶å¿½ç•¥ã€‚ å¹¶éæ‰€æœ‰ç­–ç•¥éƒ½éœ€è¦è¿™æ ·åšï¼Œä¾‹å¦‚ï¼ŒåŸºäºçœ¼é•œçš„ç­–ç•¥å¹¶ä¸éœ€è¦æ­¤ï¼Œå› ä¸ºçœ¼é•œå§‹ç»ˆæ˜¯å®æ—¶è¿è¡Œçš„ã€‚ æ²¡æœ‰é€šç”¨çš„æ–¹æ³•å¯ä»¥ç¡®å®šèœ¡çƒ›æ˜¯â€œå®æ—¶â€è¿˜æ˜¯å†å²èœ¡çƒ›ï¼Œå¹¶ä¸”åœ¨æ¯ç§ç­–ç•¥ä¸­ï¼Œå¿…é¡»æ ¹æ®è¦æ±‚ç‹¬ç«‹è§£å†³æ­¤é—®é¢˜ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ç®€å•åœ°å°†èœ¡çƒ›å…³é—­çš„æ—¶é—´ä¸è¿æ¥å™¨ä¸­çš„æ—¶é—´è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸è¶…è¿‡ä¸€å®šçš„å»¶è¿Ÿï¼Œåˆ™èœ¡çƒ›å°†å…·æœ‰å®æ—¶çŠ¶æ€ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsRealTime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Candle candle</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Connector.CurrentTime - candle.CloseTime).TotalSeconds &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; }</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯ä»€ä¹ˆèœ¡çƒ›ï¼Œä»¥åŠè¯¥ç­–ç•¥çš„å½“å‰ä½ç½®æ˜¯ä»€ä¹ˆã€‚ å¦‚æœèœ¡çƒ›åœ¨å¢é•¿ï¼Œé‚£ä¹ˆå¤´å¯¸ç­‰äº0ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨PropertyGridExä¸­æˆ‘ä»¬è®¾ç½®çš„äº¤æ˜“é‡çš„å¸‚åœºè®¢å•å¼€ä»“ã€‚ å¦‚æœèœ¡çƒ›åœ¨å¢é•¿å¹¶ä¸”ä½ç½®å°äº0ï¼Œåˆ™æˆ‘ä»¬å°†ä½ç½®â€œåè½¬â€ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candle.OpenPrice &lt; candle.ClosePrice &amp;&amp; Position &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { RegisterOrder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.BuyAtMarket(Volume + Math.Abs(Position))); }</code> </pre> <br><br> å¯¹äºèœ¡çƒ›çš„å‡å¼±ï¼Œæˆ‘ä»¬é‡‡å–ç›¸åçš„åšæ³•ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candle.OpenPrice &gt; candle.ClosePrice &amp;&amp; Position &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { RegisterOrder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SellAtMarket(Volume + Math.Abs(Position))); }</code> </pre> <br> ç›®å‰ï¼Œæˆ‘ä»¬çš„ç­–ç•¥å·²å‡†å¤‡å°±ç»ªã€‚ å®ƒå¿…é¡»ä¼ é€’ç»™æˆ‘ä»¬åœ¨ä¸Šä¸€æ®µè½ä¸­ä½¿ç”¨BindStraregyæ–¹æ³•åˆ›å»ºçš„SimpleStrategyControlã€‚ æˆ‘ä»¬åœ¨åˆå§‹åŒ–MainWindowç»„ä»¶åç«‹å³åœ¨MainWindowæ„é€ å‡½æ•°ä¸­æ‰§è¡Œæ­¤æ“ä½œã€‚ <br><br><pre> <code class="cs hljs">SimpleStrategyControl.BindStraregy(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleStrategy());</code> </pre> <br><br> è¿è¡Œæ£€æŸ¥ï¼š <br><br><img src="https://habrastorage.org/webt/b1/-p/t6/b1-pt6ohswyhv5ylanblhvjhsf4.png"><br><br><img src="https://habrastorage.org/webt/ig/qx/kd/igqxkdcsehmsbeeayj-wnhgmhuk.png"><br><br> è¯¥ç­–ç•¥æœ‰æ•ˆï¼Œè¾¾æˆäº†äº¤æ˜“ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå›¾è¡¨ä¸Šè¿˜æ²¡æœ‰èœ¡çƒ›å’Œäº¤æ˜“ã€‚ <br><br><h2> ä»ç­–ç•¥ä¸­æ·»åŠ èœ¡çƒ›å’Œäº¤æ˜“è‡³å›¾è¡¨ </h2><br> åœ¨ä½¿ç”¨SetChartæ–¹æ³•çš„æœ‰å…³ç­–ç•¥é¢æ¿çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†Chartèœ¡çƒ›çš„å›¾è¡¨èƒŒå›äº†è¯¥ç­–ç•¥ã€‚ åœ¨ç­–ç•¥çš„OnStartedæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦ä¸ºè¯¥ç­–ç•¥è®¾ç½®äº†å›¾è¡¨ï¼Œå¦‚æœå·²è®¾ç½®ï¼Œåˆ™æˆ‘ä»¬åˆå§‹åŒ–å›¾è¡¨ï¼Œå¹¶è®¢é˜…æ–°çš„è‡ªæœ‰äº‹åŠ¡çš„å¤–è§‚å’Œçƒ›å½¢å˜åŒ–çš„äº‹ä»¶ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _connector = (Connector)Connector; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetChart() <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Chart chart) { InitChart(chart); NewMyTrade += DrawMyTrade; _connector.CandleSeriesProcessing += CandleSeriesProcessing; } Series.Security = Security; _connector .WhenCandlesFinished(Series) .Do(ProcessCandle) .Apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); _connector.SubscribeCandles(Series); <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnStarted(); }</code> </pre> <br>  InitChartå›¾è¡¨åˆå§‹åŒ–æ–¹æ³•ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ChartCandleElement _chartCandleElement; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ChartTradeElement _tradesElem; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Chart _chart; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitChart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Chart chart</span></span></span><span class="hljs-function">)</span></span> { _chart = chart; _chart.GuiSync(() =&gt; { _chart.ClearAreas(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> candlesArea = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartArea(); _chart.AddArea(candlesArea); _chartCandleElement = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartCandleElement(); _chart.AddElement(candlesArea, _chartCandleElement); _tradesElem = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartTradeElement { FullTitle = <span class="hljs-string"><span class="hljs-string">"Trade"</span></span> }; _chart.AddElement(candlesArea, _tradesElem); }); }</code> </pre> <br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æŒ‡å‘Chartçš„é“¾æ¥ä¿å­˜åœ¨æœ¬åœ°å˜é‡ä¸­ã€‚ æˆ‘ä»¬æ¸…é™¤äº†æ—¶é—´è¡¨ã€‚ æˆ‘ä»¬è¿˜åˆ›å»ºèœ¡çƒ›å’Œäº¤æ˜“çš„å›¾è¡¨å…ƒç´ å¹¶å°†å…¶è½¬ç§»åˆ°å›¾è¡¨å›¾è¡¨å…ƒç´ ã€‚ æ„é€ _chart.GuiSyncï¼ˆï¼ˆï¼‰=&gt; {...}ï¼‰; ä¸ºäº†åˆå§‹åŒ–ä¸»çº¿ç¨‹ä¸­çš„è®¡åˆ’ï¼Œéœ€è¦æ­¤å‘½ä»¤ã€‚ <br><br>  CandleSeriesåœ¨å›¾è¡¨ä¸Šç»˜åˆ¶èœ¡çƒ›çš„æµç¨‹å›¾ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CandleSeriesProcessing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CandleSeries candleSeries, Candle candle</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartDrawData(); data.Group(candle.OpenTime) .Add(_chartCandleElement, candle); _chart.Draw(data); }</code> </pre> <br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»è¿æ¥å™¨çš„CandleSeriesProcessingäº‹ä»¶ä¸­è·å¾—ä¸€æ¡èœ¡çƒ›ï¼Œåˆ›å»ºä¸€ä¸ªChartDrawDataä»¥ä¾¿åœ¨å›¾è¡¨ä¸Šæ˜¾ç¤ºå®ƒã€‚ æˆ‘ä»¬æŒ‡ç¤ºæ—¶é—´æ•°æ®ã€‚Groupï¼ˆcandle.OpenTimeï¼‰ï¼ŒæŒ‡ç¤ºåº”å°†èœ¡çƒ›æ·»åŠ åˆ°å›¾è¡¨çš„èœ¡çƒ›å…ƒç´ ã€‚æ·»åŠ ï¼ˆ_chartCandleElementï¼ŒCandleï¼‰;ã€‚ å¹¶ä¸”æˆ‘ä»¬è¡¨æ˜å›¾å½¢éœ€è¦ç»˜åˆ¶æ–°æ•°æ®ã€‚ <br><br> æˆ‘ä»¬å¯¹äº¤æ˜“æ‰§è¡Œç±»ä¼¼çš„æ“ä½œï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawMyTrade</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MyTrade myTrade</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartDrawData(); data.Group(myTrade.Trade.Time) .Add(_tradesElem, myTrade); _chart.Draw(data); }</code> </pre> <br> è¿è¡Œæ£€æŸ¥ï¼š <br><br><img src="https://habrastorage.org/webt/bv/ll/xa/bvllxaiaoeshjg0_71xwfocozqa.png"><br><br><h2> ç®€è¦ç»“è®º </h2><br> è¦åˆ›å»ºä¸€ä¸ªå¤æ‚ä¸”ä¸“ä¸šçš„å¤–è§‚åº”ç”¨ç¨‹åºï¼Œæ‚¨ä¸éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´ã€‚ æ•°å°æ—¶ä»¥æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åº”ç”¨ç¨‹åºï¼Œèƒ½å¤Ÿé…ç½®ï¼Œæ˜¾ç¤ºç›´æ¥äº¤æ˜“å’Œç®—æ³•äº¤æ˜“ã€‚ <br> ä¸è¦å®³æ€•å°è¯•åˆ›å»ºè‡ªå·±çš„äº¤æ˜“ç¨‹åºã€‚ æˆ‘ä»¬å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©æ‚¨ç†Ÿæ‚‰æ­¤äº‹ã€‚ <br><br>  <b>ä½œè€…</b> ï¼šä¼Šä¸‡Â·æ‰é²èŒ¨åŸºï¼ˆIvan Zalutskyï¼‰ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN433078/">https://habr.com/ru/post/zh-CN433078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN433066/index.html">é«˜è´Ÿè·æ¯ï¼ƒ2ã€‚ åç«¯å¼€å‘äººå‘˜é‡æ–°æŠ•å…¥ä½¿ç”¨çš„å† å†›</a></li>
<li><a href="../zh-CN433070/index.html">å¦‚ä½•ä»é¦™è‡ä¸­åŒºåˆ†æ´—å‘æ°´ï¼Œä»é¦™æ§Ÿä¸­åŒºåˆ†çƒ¤ä¸²... Elasticsearch-åœ¨å•†åº—æ•°æ®åº“ä¸­æœç´¢äº§å“</a></li>
<li><a href="../zh-CN433072/index.html">å¦‚ä½•ç ´è§£Sega Dreamcastæ§åˆ¶å°å¤åˆ¶ä¿æŠ¤</a></li>
<li><a href="../zh-CN433074/index.html">åœ¨Androidé¡¹ç›®ä¸­åˆ‡æ¢åˆ°Kotlinï¼šæç¤ºå’ŒæŠ€å·§</a></li>
<li><a href="../zh-CN433076/index.html">æˆ‘ä»¬å¦‚ä½•åˆ¶ä½œAndroid Galleryåº“ä»¥æŸ¥çœ‹åª’ä½“å†…å®¹</a></li>
<li><a href="../zh-CN433082/index.html">æŠ½èµ°ä»–äººçš„å¸æˆ·å·²æˆä¸ºéŸ©å›½çš„åˆ‘äº‹çŠ¯ç½ª</a></li>
<li><a href="../zh-CN433084/index.html">å…¬å¼€è¯¾â€œä»¥ç»å…¸æ³°å¦å°¼å…‹å·æ•°æ®é›†ä¸ºä¾‹çš„ç‰¹å¾å·¥ç¨‹â€</a></li>
<li><a href="../zh-CN433086/index.html">Tinkoffä»¥åŠä¸€åˆ‡ï¼Œä¸€åˆ‡ï¼Œä¸€åˆ‡ï¼šé“¶è¡Œçš„ç‰©è”ç½‘ï¼Œåˆ†æå’Œç›‘æ§</a></li>
<li><a href="../zh-CN433088/index.html">åŸƒéš†Â·é©¬æ–¯å…‹ï¼ˆElon Muskï¼‰ï¼šæ‚¨å¦‚ä½•çœ‹å¾…å®é©¬å’Œä¿æ—¶æ·å¼€å‘çš„å……ç”µæŠ€æœ¯ï¼Œå¯åœ¨3åˆ†é’Ÿå†…å¢åŠ 100å…¬é‡Œçš„è¡Œé©¶è·ç¦»</a></li>
<li><a href="../zh-CN433090/index.html">Oracleä½å›¾ç´¢å¼•æŠ€æœ¯</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>