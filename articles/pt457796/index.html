<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👶🏻 😺 👩‍💼 Funções RTC M41T56 👎 🤷🏼 👩🏼‍🤝‍👩🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="M41T56 é um chip de relógio em tempo real, que é análogo ao popular DS1307. E mesmo que a pinagem do microcircuito seja a mesma, eles têm diferenças s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Funções RTC M41T56</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457796/">  M41T56 é um chip de relógio em tempo real, que é análogo ao popular DS1307.  E mesmo que a pinagem do microcircuito seja a mesma, eles têm diferenças significativas, sobre as quais tentarei falar. <br><a name="habracut"></a><br><h2>  Breve descrição </h2><br>  Não vou me debruçar sobre a operação do barramento IIC, observo apenas que os dois chips têm o endereço 0xd0.  Para trabalhar com o tempo, o microcircuito contém sete registros de contas e um registro de controle.  Registradores de contas contêm números no formato decimal binário, no entanto, alguns bits têm um significado especial. <br><br>  <b>Registros</b> <br>  O valor de xxx bits não está definido. <br><div class="scrollable-table"><table><tbody><tr><th rowspan="2">  função </th><th rowspan="2">  índice </th><th colspan="8">  bits </th><th rowspan="2">  valores possíveis </th></tr><tr><th>  7 </th><th>  6 </th><th>  5 </th><th>  4 </th><th>  3 </th><th>  2 </th><th>  1 </th><th>  0 0 </th></tr><tr><td>  segundos </td><td>  0x00 </td><td>  ST </td><td colspan="3">  dezenas de segundos </td><td colspan="4">  unidades de segundos </td><td>  0 - 59 </td></tr><tr><td>  minutos </td><td>  0x01 </td><td>  xxx </td><td colspan="3">  dezenas de minutos </td><td colspan="4">  unidades de minutos </td><td>  0 - 59 </td></tr><tr><td>  o relógio </td><td>  0x02 </td><td>  Seb </td><td>  SB </td><td colspan="2">  dezenas de horas </td><td colspan="4">  unidades de horas </td><td>  0 - 23 </td></tr><tr><td>  dia </td><td>  0x03 </td><td>  xxx </td><td>  xxx </td><td>  xxx </td><td>  xxx </td><td>  xxx </td><td colspan="3">  dia da semana </td><td>  1 - 7 </td></tr><tr><td>  dia do mês </td><td>  0x04 </td><td>  xxx </td><td>  xxx </td><td colspan="2">  dezenas de dias </td><td colspan="4">  unidades do dia </td><td>  1 - (28 | 29 | 30 | 31) </td></tr><tr><td>  mês </td><td>  0x05 </td><td>  xxx </td><td>  xxx </td><td>  xxx </td><td colspan="1">  des </td><td colspan="4">  unidades do mês </td><td>  1 - 12 </td></tr><tr><td>  ano </td><td>  0x06 </td><td colspan="4">  dezenas de anos </td><td colspan="4">  unidades do ano </td><td>  0 - 99 </td></tr><tr><td>  registro de controle </td><td>  0x07 </td><td>  OUT </td><td>  FT </td><td>  S </td><td colspan="5">  valor de correção </td><td>  - </td></tr></tbody></table></div><br>  <b>Bits</b> <br>  x - após ligar, o estado do bit pode ser qualquer. <br><div class="scrollable-table"><table><tbody><tr><th>  um pouco </th><th>  após a reposição </th><th>  a descrição </th></tr><tr><td>  ST </td><td>  x </td><td>  Ao escrever 1 neste bit, o gerador para </td></tr><tr><td>  CEB </td><td>  x </td>
<td rowspan="2">  Quando o bit CEB (Century Enable Bit) é definido, quando um novo século é alcançado, o bit CB (Century Bit) altera o valor para o oposto. </td></tr><tr><td>  CB </td><td>  x </td></tr><tr><td>  OUT </td><td>  1 </td><td rowspan="2">  Quando os bits OUT (nível de saída OUT) e FT (Frequency Test) são zero, o pino FT / OUT é pressionado ao terra.  Com FT = 1, a saída FT / OUT é de 512 Hz e o bit OUT não importa. </td></tr><tr><td>  FT </td><td>  0 0 </td></tr><tr><td>  S </td><td>  x </td><td>  Marca de calibração do curso RTC. </td></tr></tbody></table></div><br>  As diferenças começam na atribuição dos bits 7, 6 e 5 do registro do relógio.  No M41T56, os bits 7 e 6 são usados ​​para indicar a transição para o novo século, e os bits 5 e 4 são usados ​​para contar dezenas de horas.  Além disso, a contagem de horas é possível apenas no modo 24, o modo AM / PM não está disponível.  No DS1307, o bit 7 não é usado, um zero no bit 6 indica que o modo de contagem 24 é usado e, neste caso, os bits 5 e 4 contêm dezenas de horas.  Se o bit 6 é um, o bit 5 se torna o sinalizador AM / PM e o bit 4 contém dezenas de horas. <br><br>  Diferenças significativas estão no registro de controle, que contém o curso de correção da palavra. <br><br><h2>  Correção de curso </h2><br>  O M41T56 permite compensar o erro do ressonador de quartzo na faixa de -62 a +124 ppm, o que resulta em um desvio não superior a ± 5 segundos por mês.  Para compensação, os seis bits menos significativos do registro de controle são responsáveis.  Os bits 4-0 contêm um número inteiro não assinado do valor de correção, e o bit 5 define a direção da correção.  Se o bit 5 contiver zero, o curso diminui em passos de 2,034 ppm, caso contrário, o RTC acelera em passos de 4,068 ppm.  Isso é inconveniente, por isso esbocei algumas funções simples para converter de ppm em palavra de correção e vice-versa. <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*        . */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MASK_CALIBR ((1 &lt;&lt; 4) | (1 &lt;&lt; 3) | (1 &lt;&lt; 2) | (1 &lt;&lt; 1) | (1 &lt;&lt; 0)) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*        . */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MASK_CALIBR_SIGN (1 &lt;&lt; 5) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/** *    . * @param caliber    RTC. * @return    ppm. */</span></span></span><span class="hljs-meta"> int8_t caliber_to_ppm(uint8_t caliber) { int8_t result = caliber &amp; MASK_CALIBR; result = (uint8_t) result * 2; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> ((caliber &amp; MASK_CALIBR_SIGN) != 0) { result = -result; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { result = (uint8_t) result * 2; } return result; } </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/** *   . * @param ppm    ppm. * @return    RTC. */</span></span></span><span class="hljs-meta"> uint8_t ppm_to_caliber(int8_t ppm) { uint8_t result; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ppm &lt; 0) { result = (uint8_t) (-ppm + 1) / 2; result |= MASK_CALIBR_SIGN; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { result = (uint8_t) (ppm + 2) / 4; } return result; }</span></span></code> </pre> <br><h2>  Detecção de falhas </h2><br>  Nem o DS1307, mas o M41T56 podem detectar erros de geração, mas garantem que quando a energia for ligada, alguns bits estarão em um determinado estado.  M41T56, quando ativado no registro de controle, será 10xxxxxx.  Para rastrear falhas no programa, você pode usar o seguinte algoritmo.  Se, quando o microcontrolador estiver ligado, o registro de controle RTC contiver 10xxxxxx, houve uma falha de energia e um valor deverá ser gravado no registro cujos bits altos não sejam iguais a 10. O mais simples é escrever a palavra de correção com os bits 7 e 6 iguais a zero. <br><br><h2>  Literatura </h2><br><ul><li>  Ficha <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M41T56</a> </li><li>  Folha de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dados do DS1307</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt457796/">https://habr.com/ru/post/pt457796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt457776/index.html">Minas em desempenho estão esperando nos bastidores: parte 2</a></li>
<li><a href="../pt457784/index.html">Calibração personalizada do Eye-Tracker</a></li>
<li><a href="../pt457786/index.html">Anet A8 Plus atualizado. Grande e metal</a></li>
<li><a href="../pt457790/index.html">Celular BuratinoPhone</a></li>
<li><a href="../pt457794/index.html">A propriedade de simetria da relação de cointegração</a></li>
<li><a href="../pt457798/index.html">O que os fundos de código aberto estão fazendo - falando sobre os recentes projetos OpenStack e Linux Foundation</a></li>
<li><a href="../pt457800/index.html">Vulnerabilidade crítica do MacOS Mojave explorada ativamente por cibercriminosos</a></li>
<li><a href="../pt457804/index.html">ListenIt - extensão do Google Chrome para criar automaticamente versões de áudio de artigos</a></li>
<li><a href="../pt457808/index.html">Termovisor Seek Thermal Compact</a></li>
<li><a href="../pt457810/index.html">Abordagem de engenharia para desenvolvimento de software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>