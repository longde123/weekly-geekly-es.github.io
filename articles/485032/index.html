<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤜🏻 💹 🎞️ Cómo hacer que una aplicación React sea más rápida con el cohospedaje estatal 👉 👨🏼‍🚀 👩🏻‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El artículo trata sobre la colocación estatal , es decir, sobre la coubicación de estados , este término también podría traducirse como colocación est...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cómo hacer que una aplicación React sea más rápida con el cohospedaje estatal</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485032/"><p>  <em>El artículo trata sobre <strong>la colocación estatal</strong> , es decir, sobre la <strong>coubicación de estados</strong> , este término también podría traducirse como <strong>colocación estatal</strong> o <strong>colocación estatal</strong> .</em> </p><br><p>  Una de las principales razones para ralentizar una aplicación React es su estado global.  Mostraré esto con un ejemplo de una aplicación muy simple, después de lo cual daré un ejemplo más cercano a la vida real. </p><br><p>  Aquí hay una aplicación simple en la que puede ingresar un nombre para el perro (si la ventana no funciona, <a href="https://uy9h3.csb.app/">aquí está el enlace</a> ): </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p> Si juegas con esta aplicación, pronto descubrirás que funciona muy lentamente.  Al interactuar con cualquier campo de entrada, hay problemas notables de rendimiento.  En tal situación, podría usar un <code>React.memo</code> salvavidas en forma de <code>React.memo</code> y envolverlo con todos los componentes con un renderizado lento.  Pero tratemos de resolver este problema de manera diferente. </p><br><p>  Aquí está el código para esta aplicación: </p><a name="habracut"></a><br><pre> <code class="xml hljs">function sleep(time) { const done = Date.now() + time while (done &gt; Date.now()) { // ... } } //      // -       function SlowComponent({time, onChange}) { sleep(time) return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> Wow, that was{' '} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> onChange(Number(e.target.value))} /&gt; ms slow <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function DogName({time, dog, onChange}) { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> onChange(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function App() { //   " " (global state) const [dog, setDog] = React.useState('') const [time, setTime] = React.useState(200) return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setDog}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SlowComponent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setTime}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p>  Si no ha leído el artículo sobre <a href="https://kentcdodds.com/blog/colocation">Colocación</a> (coubicación), le sugiero que lo lea.  Sabiendo que el cohospedaje puede facilitar el trabajo con nuestra aplicación, usemos este principio cuando trabajemos con estados. </p><br><p>  Preste atención al código de nuestra aplicación, es decir, el estado de <code>time</code> : es utilizado por cada componente de nuestra aplicación, por lo tanto, se levantó ( <a href="https://ru.reactjs.org/docs/lifting-state-up.html">levantando, elevando el estado</a> ) al componente de la <code>App</code> (el componente que envuelve toda nuestra aplicación).  Sin embargo, el estado "dog" ( <code>dog</code> y <code>setDog</code> ) solo lo utiliza un componente, no es necesario en el componente de la <code>App</code> , así que vamos al componente <code>DogName</code> : </p><br><pre> <code class="xml hljs">function DogName({time}) { // <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span><span class="hljs-tag">    </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">setDog</span></span></span><span class="hljs-tag">] = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">React.useState(</span></span></span><span class="hljs-tag">'') // &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span><span class="hljs-tag">   </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">return</span></span></span><span class="hljs-tag"> ( &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> setDog(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function App() { //   " " (global state) const [time, setTime] = React.useState(200) return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> /&gt;</span></span> // <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span><span class="hljs-tag">    &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SlowComponent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setTime}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p>  Y aquí está nuestro resultado (si la ventana no funciona, <a href="https://9nqld.csb.app/">enlace</a> ): </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Wow!  Introducir un nombre ahora funciona MUCHO más rápido.  Además, el componente se ha vuelto más fácil de mantener gracias a la ubicación conjunta.  Pero, ¿por qué funcionó más rápido? </p><br><p>  Dicen que la mejor manera de hacer algo rápidamente es hacer la menor cantidad de cosas posible.  Esto es exactamente lo que está sucediendo aquí.  Cuando gestionamos el estado ubicado en la parte superior del árbol de componentes, cada actualización de este estado invalidará todo el árbol.  La reacción no sabe qué ha cambiado, por eso, tiene que verificar todos los componentes para ver si necesitan actualizaciones DOM.  Este proceso no es gratuito y consume recursos (especialmente si tiene componentes intencionalmente lentos).  Pero si mueve el estado lo más bajo posible en el árbol de componentes, como hicimos con el estado del <code>dog</code> y el componente <code>DogName</code> , entonces React hará menos comprobaciones.  React no verificará el componente <code>SlowComponent</code> (que hicimos deliberadamente lento), ya que React sabe que este componente todavía no puede afectar la salida. </p><br><p>  En resumen, antes, al cambiar el nombre del perro, cada componente se verificaba para cambios (re-renderizado).  Y después de los cambios que hicimos en el código, React comenzó a verificar solo el componente <code>DogName</code> .  ¡Esto ha llevado a un marcado aumento en la productividad! </p><br><h2 id="v-realnoy-zhizni">  En la vida real </h2><br><p>  Veo que los desarrolladores están poniendo en el repositorio global de Redux o en el contexto global lo que realmente no debería ser global.  <code>DogName</code> como el <code>DogName</code> del ejemplo anterior a menudo son lugares donde se produce un problema de rendimiento.  A menudo veo que este problema se manifiesta al interactuar con el mouse (por ejemplo, al mostrar información sobre herramientas sobre un gráfico o sobre una tabla de datos). </p><br><p>  Una solución a este problema es "cancelar" la interacción del usuario (es decir, esperamos hasta que el usuario deje de escribir y luego aplicamos la actualización de estado).  A veces, esto es lo mejor que podemos hacer, pero puede conducir a una mala experiencia del usuario (el modo concurrente futuro debería minimizar la necesidad de hacerlo. <a href="https://youtu.be/nLF0n9SACd4%3Ft%3D181">Vea esta demostración de Dan Abramov</a> ). </p><br><p>  Otra solución que los desarrolladores usan a menudo es usar una de las representaciones de rescate de React, por ejemplo <code>React.memo</code> .  Esto funcionará muy bien en nuestro ejemplo descabellado, ya que le permite a React omitir la representación del <code>SlowComponent</code> , pero en la práctica la aplicación puede sufrir debido a la "muerte por mil cortes", ya que en una aplicación real la desaceleración generalmente no se debe a una lenta componente, y debido al trabajo insuficientemente rápido de muchos componentes, por lo que debe usar <code>React.memo</code> todas partes.  Una vez hecho esto, deberá comenzar a usar <code>useMemo</code> y <code>useCallback</code> , de lo contrario, todo el trabajo que <code>React.memo</code> en <code>React.memo</code> será en vano.  Estas acciones pueden resolver el problema, pero aumentan significativamente la complejidad de su código y, de hecho, aún son menos efectivas que compartir estados, ya que React necesita pasar por cada componente (comenzando desde la parte superior) para determinar si necesita procesarse nuevamente. </p><br><p>  Si quieres jugar con un ejemplo un poco menos descabellado, <a href="https://codesandbox.io/s/colocate-state-ts1x9">ve a codesandbox aquí</a> . </p><br><h2 id="chto-takoe-sovmestnoe-razmeschenie-sostoyaniy">  ¿Qué es el uso compartido? </h2><br><p>  El principio de <a href="https://kentcdodds.com/blog/colocation">colocación conjunta</a> establece: </p><br><blockquote>  El código debe ubicarse lo más cerca posible del lugar al que se refiere. </blockquote><p>  Entonces, para cumplir con este principio, nuestro estado de <code>dog</code> debe estar <em>dentro</em> del componente <code>DogName</code> : </p><br><pre> <code class="xml hljs">function DogName({time}) { const [dog, setDog] = React.useState('') return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> setDog(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p>  Pero, ¿qué pasa si dividimos este componente en varios componentes?  ¿A dónde debe ir el estado?  La respuesta es la misma: "lo más cerca posible del lugar con el que se relaciona", y ese será el <strong>componente principal común más cercano</strong> .  Como ejemplo, analicemos el componente <code>DogName</code> que la <code>input</code> <code>p</code> muestren en diferentes componentes: </p><br><pre> <code class="xml hljs">function DogName({time}) { const [dog, setDog] = React.useState('') return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogInput</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setDog}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogFavoriteNumberDisplay</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function DogInput({dog, onChange}) { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> onChange(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;/&gt;</span></span> ) } function DogFavoriteNumberDisplay({time, dog}) { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p>  No podemos mover el estado al componente <code>DogInput</code> , porque el componente <code>DogFavoriteNumberDisplay</code> también necesita acceso al estado, por lo que nos movemos desde la parte inferior hasta la parte superior del árbol de componentes hasta que encontremos el padre común de estos dos componentes y organicemos la administración del estado en él. </p><br><p>  Todo esto se aplica a situaciones en las que necesita controlar el estado de docenas de componentes en una pantalla particular de su aplicación.  Incluso puede mover esto al contexto para evitar la <a href="https://kentcdodds.com/blog/prop-drilling">perforación del puntal</a> si lo desea.  Pero mantenga este contexto lo más cerca posible del lugar al que pertenece, y luego continuará manteniendo el buen rendimiento (y usabilidad del código) que proporciona el uso compartido.  Recuerde que no necesita colocar <em>todos los</em> contextos en el nivel superior de su aplicación React.  Manténgalos donde tenga más sentido. </p><br><p>  Esta es la idea principal de mi otra publicación, <a href="https://kentcdodds.com/blog/application-state-management-with-react">Application State Management with React</a> .  Mantenga sus estados lo más cerca posible del lugar donde se usan, esto mejorará tanto el rendimiento como la usabilidad del código.  Con este enfoque, lo único que posiblemente empeorará el rendimiento de su aplicación son las interacciones especialmente complejas con los elementos de la interfaz. </p><br><h2 id="tak-chto-ispolzovat-konteksty-ili-redux">  Entonces, ¿qué usar, contextos o Redux? </h2><br><p>  Si lees <a href="https://kentcdodds.com/blog/optimize-react-re-renders">"Un simple truco para optimizar las representaciones de React"</a> , entonces sabes que puedes asegurarte de que solo se actualizan aquellos componentes que usan el estado modificado.  De esta manera, puede solucionar este problema.  Pero las personas aún enfrentan problemas de rendimiento cuando usan el Editor.  El problema es <a href="https://react-redux.js.org/using-react-redux/connect-mapstate">que React-Redux espera que sigas sus recomendaciones para evitar la representación innecesaria de los componentes conectados</a> .  Siempre hay una posibilidad de error; puede configurar accidentalmente componentes para que comiencen a reproducirse con demasiada frecuencia cuando cambian otros estados globales.  Y cuanto mayor sea su aplicación, más negativo será el efecto de esto, especialmente si agrega demasiados estados al Editor. </p><br><p>  Existen métodos que pueden ayudarlo a evitar estos problemas, por ejemplo, use <a href="https://blog.isquaredsoftware.com/2018/11/react-redux-history-implementation/"><code>memoized Reselect     mapState</code></a> o lea la <a href="https://redux.js.org/faq">documentación</a> del <a href="https://redux.js.org/faq">Editor para obtener más información sobre</a> <a href="https://blog.isquaredsoftware.com/2018/11/react-redux-history-implementation/"><code>memoized Reselect     mapState</code></a> <a href="https://redux.js.org/faq">mejorar el rendimiento de la aplicación</a> . </p><br><p>  Vale la pena señalar que la colocación conjunta se puede aplicar junto con el Editor.  Solo use Editores solo para estados globales, y para todo lo demás, use la ubicación conjunta.  Hay <a href="https://redux.js.org/faq/organizing-state">algunas reglas útiles en las</a> preguntas frecuentes del editor <a href="https://redux.js.org/faq/organizing-state">para ayudarlo a decidir si el estado debería funcionar en el editor o si debería permanecer en el componente</a> . </p><br><p>  Por cierto, si divide su estado en dominios (usando varios contextos dependiendo del dominio), entonces el problema será menos pronunciado. </p><br><p>  Pero el hecho sigue siendo: la ubicación conjunta de los estados reduce los problemas de rendimiento y simplifica el mantenimiento del código. </p><br><h2 id="prinimaem-reshenie-o-tom-kuda-pomestit-sostoyanie">  Decide dónde poner el estado </h2><br><p>  Árbol de decisión: </p><br><p><img src="https://habrastorage.org/webt/oj/z8/pt/ojz8ptwezz3qmxqicorsrsh1bku.jpeg" alt="dónde poner"></p><br><p>  Versión de texto, si no hay forma de mirar la imagen: </p><br><ul><li>  1 Comenzamos el desarrollo de la aplicación.  Ir a 2 </li><li>  2 Estado en el componente.  Ir a 3 </li><li>  3 ¿La condición es utilizada <strong>solo por</strong> este componente? <br><ul><li>  ¿Eh?  Vamos a 4 </li><li>  No?  ¿Este estado <strong>necesita</strong> solo <em>un</em> componente hijo? </li><li>  ¿Eh?  Muévalo a este componente secundario (use la ubicación conjunta).  Vamos a 3. </li><li>  No?  ¿Este estado necesita componentes primarios o vecinos (componentes "hermanos", es decir, componentes secundarios del mismo componente primario)? <br><ul><li>  ¿Eh?  Mueva el estado anterior al componente principal.  Ir a 3 </li><li>  No?  Vamos a 4 </li></ul></li></ul></li><li>  4 Dejar como está.  Ir a 5 </li><li>  5 ¿Hay algún problema con la perforación de puntales? <br><ul><li>  ¿Eh?  Movemos este estado al proveedor de contexto y representamos este proveedor en el componente en el que se administra el estado.  Ir a 6 </li><li>  No?  Ir a 6 </li></ul></li><li>  6 Enviamos la solicitud.  Cuando aparezcan nuevos requisitos, vaya a 1 </li></ul><br><p>  Es importante que este proceso sea parte de su proceso regular de refactorización / mantenimiento de aplicaciones.  Si su condición no se eleva donde debería elevarse, entonces este estado dejará de funcionar correctamente y lo notará.  Sin embargo, si no sigue el método de ubicación conjunta de estados y no baja los estados en la jerarquía de componentes, entonces su aplicación continuará funcionando.  Debido a esto, no notará de inmediato problemas de rendimiento y capacidad de administración que se acumularán gradualmente. </p><br><h2 id="zaklyuchenie">  Conclusión </h2><br><p>  En general, los desarrolladores entienden muy bien cuándo es necesario elevar el estado ("estado de elevación") cuando es necesario, pero no entendemos tan bien cuándo es necesario reducir el estado.  Le sugiero que eche un vistazo al código de su aplicación y piense en dónde podría omitirse el estado aplicando el principio de "ubicación conjunta".  Pregúntese: "¿Necesito el estado <code>isOpen</code> de una ventana modal en el Editor?"  (Lo más probable es que la respuesta sea no). </p><br><p>  Use el principio de uso compartido y su código será más fácil y rápido. </p><br><p>  Buena suerte </p></div></div><p>Source: <a href="https://habr.com/ru/post/485032/">https://habr.com/ru/post/485032/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../485022/index.html">Playme Sigma: DVR funcional y asequible</a></li>
<li><a href="../485024/index.html">¿Qué hay debajo de las optimizaciones del compilador GraalVM?</a></li>
<li><a href="../485026/index.html">Oportunidades de Georgia para profesionales de TI</a></li>
<li><a href="../485028/index.html">CRM 2020</a></li>
<li><a href="../485030/index.html">Top 8 tarifas de IEO y su capitalización ahora</a></li>
<li><a href="../485034/index.html">Automatizar la compilación de un proyecto Qt en Windows en Travis CI</a></li>
<li><a href="../485036/index.html">¿Por qué necesito soporte instrumental para la paginación clave?</a></li>
<li><a href="../485042/index.html">Debido al soporte obligatorio 5G, los teléfonos inteligentes con Snapdragon 865 serán peores en 2020</a></li>
<li><a href="../485044/index.html">Desmontamos el reloj digital de la nave espacial Soyuz</a></li>
<li><a href="../485046/index.html">Cómo planificar una estrategia de producto ganadora</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>