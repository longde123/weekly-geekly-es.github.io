<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ä ‚¨úÔ∏è üëÆ Crie um aplicativo para Android. Tarefa com um asterisco üõÄüèº üßû üé∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! No ver√£o, falei no Summer Droid Meetup com um relat√≥rio sobre a cria√ß√£o de um aplicativo Android. A vers√£o em v√≠deo pode ser encontrada aqui...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Crie um aplicativo para Android. Tarefa com um asterisco</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/469771/"><img src="https://habrastorage.org/webt/-b/02/yh/-b02yhihv1wljls_lzryoh__sbe.png"><br><br>  Ol√° Habr!  No ver√£o, falei no Summer Droid Meetup com um relat√≥rio sobre a cria√ß√£o de um aplicativo Android.  A vers√£o em v√≠deo pode ser encontrada aqui: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">habr.com/ru/company/funcorp/blog/462825</a> .  E para quem gosta de ler mais, acabei de escrever este artigo. <br><br>  √â sobre o que √© - um aplicativo Android.  Coletaremos de diferentes maneiras Ol√°, mundo!: Comece pelo console e veja o que acontece sob os bastidores dos sistemas de compila√ß√£o, depois volte ao passado, lembre-se do Maven e aprenda sobre as modernas solu√ß√µes Bazel e Buck.  E, finalmente, tudo isso √© compar√°vel. <br><a name="habracut"></a><br>  Pensamos em uma poss√≠vel mudan√ßa no sistema de montagem quando iniciamos um novo projeto.  Pareceu-nos que esta √© uma boa oportunidade para procurar algumas alternativas para Gradle.  Al√©m disso, √© mais f√°cil fazer isso no in√≠cio do que traduzir um projeto existente.  As seguintes falhas da Gradle nos levaram a essa etapa: <br><br><ul><li>  ele definitivamente tem problemas com a montagem incremental, embora possa ver progresso nessa dire√ß√£o; </li><li>  ele se sai mal com projetos monol√≠ticos muito grandes; </li><li>  acontece que um dem√¥nio come√ßa por muito tempo; </li><li>  exigente na m√°quina em que est√° sendo executada. </li></ul><br><h2>  APK </h2><br>  Antes de tudo, lembre-se do que o aplicativo Android consiste: c√≥digo compilado, recursos e AndroidManifest.xml. <br><br><img src="https://habrastorage.org/webt/pe/do/sm/pedosmtvfcqralxv1td9d4xcjg0.jpeg"><br><br>  As fontes est√£o no arquivo classes.dex (pode haver v√°rios arquivos, dependendo do tamanho do aplicativo) em um formato dex especial com o qual a m√°quina virtual Android pode trabalhar.  Hoje √© ART, em dispositivos mais antigos - Dalvik.  Al√©m disso, voc√™ pode encontrar a pasta lib, onde as fontes nativas s√£o organizadas em subpastas.  Eles ser√£o nomeados dependendo da arquitetura do processador de destino, por exemplo, x86, arm, etc.  Se voc√™ usa exoplayer, provavelmente possui lib.  E a pasta aidl, que cont√©m interfaces de comunica√ß√£o entre processos.  Eles ser√£o √∫teis se voc√™ precisar acessar um servi√ßo em execu√ß√£o em outro processo.  Essas interfaces s√£o usadas no Android e no GooglePlayServices. <br><br>  V√°rios recursos n√£o compilados, como imagens, est√£o na pasta res.  Todos os recursos compilados, como estilos, linhas, etc., s√£o mesclados em um arquivo resource.arsc.  Na pasta de ativos, como regra, eles colocam tudo o que n√£o se encaixa nos recursos, por exemplo, fontes personalizadas. <br><br>  Al√©m de tudo isso, o APK cont√©m AndroidManifest.xml.  Nele, descrevemos v√°rios componentes do aplicativo, como Atividade, Servi√ßo, permiss√µes diferentes etc.  Ele est√° na forma bin√°ria e, para olhar para dentro, primeiro ter√° que ser convertido em um arquivo leg√≠vel por humanos. <br><br><h2>  CONSOLE </h2><br>  Agora que sabemos o que o aplicativo consiste, podemos tentar criar Ol√°, mundo!  do console usando as ferramentas fornecidas pelo SDK do Android.  Este √© um passo muito importante para entender como os sistemas de constru√ß√£o funcionam, porque todos eles contam com esses utilit√°rios em um grau ou outro.  Como o projeto est√° escrito no Kotlin, precisamos do seu compilador para a linha de comando.  √â f√°cil fazer o download separadamente. <br><br>  A montagem do aplicativo pode ser dividida nas seguintes etapas: <br><br><ul><li> Baixe e descompacte todas as bibliotecas das quais o projeto depende.  No meu caso, essa √© a biblioteca de compatibilidade com vers√µes anteriores do appcompat, que, por sua vez, depende do appcompat-core, por isso tamb√©m desenvolvemos; </li><li>  gerar R.java.  Essa classe maravilhosa cont√©m os identificadores de todos os recursos no aplicativo e √© usada para acess√°-los no c√≥digo; </li><li>  compilamos as fontes em bytecode e as traduzimos em Dex, porque a m√°quina virtual Android n√£o sabe como trabalhar com o bytecode usual; </li><li>  empacotamos tudo no APK, mas primeiro alinhamos todos os recursos incompress√≠veis, como imagens, em rela√ß√£o ao in√≠cio do arquivo.  Isso permite que o pre√ßo de um aumento completamente insignificante no tamanho do APK acelere significativamente seu trabalho.  Assim, o sistema pode mapear diretamente os recursos para a RAM usando a fun√ß√£o mmap (). </li><li>  assine o aplicativo.  Este procedimento protege a integridade do APK e confirma a autoria.  E gra√ßas a isso, por exemplo, o Play Market pode verificar se o aplicativo foi criado por voc√™. </li></ul><br><div class="spoiler">  <b class="spoiler_title">script de constru√ß√£o</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preparedir</span></span></span></span>() { rm -r -f <span class="hljs-variable"><span class="hljs-variable">$1</span></span> mkdir <span class="hljs-variable"><span class="hljs-variable">$1</span></span> } PROJ=<span class="hljs-string"><span class="hljs-string">"src/main"</span></span> LIBS=<span class="hljs-string"><span class="hljs-string">"libs"</span></span> LIBS_OUT_DIR=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LIBS</span></span></span><span class="hljs-string">/out"</span></span> BUILD_TOOLS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ANDROID_HOME</span></span></span><span class="hljs-string">/build-tools/28.0.3"</span></span> ANDROID_JAR=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ANDROID_HOME</span></span></span><span class="hljs-string">/platforms/android-28/android.jar"</span></span> DEBUG_KEYSTORE=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(echo ~)</span></span></span><span class="hljs-string">/.android/debug.keystore"</span></span> GEN_DIR=<span class="hljs-string"><span class="hljs-string">"build/generated"</span></span> KOTLIN_OUT_DIR=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$GEN_DIR</span></span></span><span class="hljs-string">/kotlin"</span></span> DEX_OUT_DIR=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$GEN_DIR</span></span></span><span class="hljs-string">/dex"</span></span> OUT_DIR=<span class="hljs-string"><span class="hljs-string">"out"</span></span> libs_res=<span class="hljs-string"><span class="hljs-string">""</span></span> libs_classes=<span class="hljs-string"><span class="hljs-string">""</span></span> preparedir <span class="hljs-variable"><span class="hljs-variable">$LIBS_OUT_DIR</span></span> aars=$(ls -p <span class="hljs-variable"><span class="hljs-variable">$LIBS</span></span> | grep -v /) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> filename <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$aars</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> DESTINATION=<span class="hljs-variable"><span class="hljs-variable">$LIBS_OUT_DIR</span></span>/<span class="hljs-variable"><span class="hljs-variable">${filename%.*}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"unpacking </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$filename</span></span></span><span class="hljs-string"> into </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DESTINATION</span></span></span><span class="hljs-string">"</span></span> unzip -o -q <span class="hljs-variable"><span class="hljs-variable">$LIBS</span></span>/<span class="hljs-variable"><span class="hljs-variable">$filename</span></span> -d <span class="hljs-variable"><span class="hljs-variable">$DESTINATION</span></span> libs_res=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$libs_res</span></span></span><span class="hljs-string"> -S </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DESTINATION</span></span></span><span class="hljs-string">/res"</span></span> libs_classes=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$libs_classes</span></span></span><span class="hljs-string">:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DESTINATION</span></span></span><span class="hljs-string">/classes.jar"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> preparedir <span class="hljs-variable"><span class="hljs-variable">$GEN_DIR</span></span> <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/aapt package -f -m \ -J <span class="hljs-variable"><span class="hljs-variable">$GEN_DIR</span></span> \ -M <span class="hljs-variable"><span class="hljs-variable">$PROJ</span></span>/AndroidManifest.xml \ -S <span class="hljs-variable"><span class="hljs-variable">$PROJ</span></span>/res \ <span class="hljs-variable"><span class="hljs-variable">$libs_res</span></span> \ -I <span class="hljs-variable"><span class="hljs-variable">$ANDROID_JAR</span></span> --auto-add-overlay preparedir <span class="hljs-variable"><span class="hljs-variable">$KOTLIN_OUT_DIR</span></span> compiledKotlin=<span class="hljs-variable"><span class="hljs-variable">$KOTLIN_OUT_DIR</span></span>/compiled.jar kotlinc <span class="hljs-variable"><span class="hljs-variable">$PROJ</span></span>/java <span class="hljs-variable"><span class="hljs-variable">$GEN_DIR</span></span> -include-runtime \ -cp <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ANDROID_JAR</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$libs_classes</span></span></span><span class="hljs-string">"</span></span>\ -d <span class="hljs-variable"><span class="hljs-variable">$compiledKotlin</span></span> preparedir <span class="hljs-variable"><span class="hljs-variable">$DEX_OUT_DIR</span></span> dex=<span class="hljs-variable"><span class="hljs-variable">$DEX_OUT_DIR</span></span>/classes.dex <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/dx --dex --output=<span class="hljs-variable"><span class="hljs-variable">$dex</span></span> <span class="hljs-variable"><span class="hljs-variable">$compiledKotlin</span></span> preparedir <span class="hljs-variable"><span class="hljs-variable">$OUT_DIR</span></span> unaligned_apk=<span class="hljs-variable"><span class="hljs-variable">$OUT_DIR</span></span>/unaligned.apk <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/aapt package -f -m \ -F <span class="hljs-variable"><span class="hljs-variable">$unaligned_apk</span></span> \ -M <span class="hljs-variable"><span class="hljs-variable">$PROJ</span></span>/AndroidManifest.xml \ -S <span class="hljs-variable"><span class="hljs-variable">$PROJ</span></span>/res \ <span class="hljs-variable"><span class="hljs-variable">$libs_res</span></span> \ -I <span class="hljs-variable"><span class="hljs-variable">$ANDROID_JAR</span></span> --auto-add-overlay cp <span class="hljs-variable"><span class="hljs-variable">$dex</span></span> . <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/aapt add <span class="hljs-variable"><span class="hljs-variable">$unaligned_apk</span></span> classes.dex rm classes.dex aligned_apk=<span class="hljs-variable"><span class="hljs-variable">$OUT_DIR</span></span>/aligned.apk <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/zipalign -f 4 <span class="hljs-variable"><span class="hljs-variable">$unaligned_apk</span></span> <span class="hljs-variable"><span class="hljs-variable">$aligned_apk</span></span> <span class="hljs-variable"><span class="hljs-variable">$BUILD_TOOLS</span></span>/apksigner sign --ks <span class="hljs-variable"><span class="hljs-variable">$DEBUG_KEYSTORE</span></span> <span class="hljs-variable"><span class="hljs-variable">$aligned_apk</span></span></code> </pre> <br></div></div><br>  De acordo com as figuras, verifica-se que uma montagem limpa leva 7 segundos, e a montagem incremental n√£o fica para tr√°s, porque n√£o armazenamos nada em cache e reconstru√≠mos tudo sempre. <br><br><h2>  Maven </h2><br>  Foi desenvolvido pelo pessoal da Apache Software Foundation para criar projetos Java.  As configura√ß√µes de compila√ß√£o s√£o descritas em XML.  As primeiras revis√µes do Maven foram coletadas pelo Ant e agora elas mudaram para a vers√£o est√°vel mais recente. <br><br>  Pr√≥s do Maven: <br><br><ul><li>  Ele suporta artefatos de montagem de cache, ou seja,  a constru√ß√£o incremental deve ser mais r√°pida que limpa; </li><li>  capaz de resolver depend√™ncias de terceiros.  I.e.  Quando voc√™ especifica uma depend√™ncia em uma biblioteca de terceiros na configura√ß√£o do Maven ou Gradle, n√£o precisa se preocupar com o que depende; </li><li>  Existe um monte de documenta√ß√£o detalhada, porque ela est√° no mercado h√° algum tempo. </li><li>  e pode ser um mecanismo de cria√ß√£o familiar se voc√™ veio recentemente ao mundo do desenvolvimento do Android a partir do back-end. </li></ul><br>  Contras de Maven: <br><br><ul><li>  Depende da vers√£o do Java instalada na m√°quina na qual a montagem ocorre; </li><li>  O plug-in Android agora √© suportado por desenvolvedores de terceiros: eu pessoalmente considero isso uma desvantagem muito significativa, porque um dia eles podem parar de fazer isso; <br></li><li>  XML n√£o √© muito adequado para descrever configura√ß√µes de compila√ß√£o devido √† sua redund√¢ncia e complexidade; </li><li>  bem, e como veremos mais adiante, corre mais devagar que Gradle, pelo menos em um projeto de teste. </li></ul><br>  Para construir, precisamos criar o pom.xml, que cont√©m uma descri√ß√£o do nosso projeto.  No cabe√ßalho, indique as informa√ß√µes b√°sicas sobre o artefato coletado, bem como a vers√£o do Kotlin. <br><br><div class="spoiler">  <b class="spoiler_title">build config pom.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.example<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>myapplication<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>apk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>My Application<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3.41<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-stdlib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.google.android<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>android<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>4.1.1.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>provided<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>process-sources<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.simpligility.maven.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>android-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sdk</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platform</span></span></span><span class="hljs-tag">&gt;</span></span>28<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platform</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buildTools</span></span></span><span class="hljs-tag">&gt;</span></span>28.0.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buildTools</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sdk</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">failOnNonStandardStructure</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">failOnNonStandardStructure</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Em termos de n√∫meros, nem tudo √© r√≥seo.  Um assembly limpo leva cerca de 12 segundos, enquanto um incremental - 10. Isso significa que o Maven, de alguma forma, reutiliza artefatos de assemblies anteriores ou, na minha opini√£o, √© mais prov√°vel que o plug-in para a constru√ß√£o de um projeto Android o impe√ßa de fazer isso <br><br>  Agora eles est√£o usando tudo isso, acho que, antes de tudo, os criadores do plugin s√£o os caras da simplicidade.  N√£o foi poss√≠vel encontrar informa√ß√µes mais confi√°veis ‚Äã‚Äãsobre esse problema. <br><br><h2>  Bazel </h2><br>  Engenheiros nas entranhas do Google inventaram o Bazel para construir seus projetos e, relativamente recentemente, o transferiram para o c√≥digo aberto.  Para a descri√ß√£o de build-configs como Skylark ou Starlark como python, ambos os nomes t√™m um lugar para estar.  √â montado usando sua pr√≥pria vers√£o est√°vel mais recente. <br><br>  Pr√≥s de Bazel: <br><br><ul><li>  suporte para diferentes linguagens de programa√ß√£o.  Se voc√™ acredita na documenta√ß√£o, ele sabe como coletar projetos para iOs, Android ou mesmo um back-end; </li><li>  Pode armazenar em cache artefatos coletados anteriormente </li><li>  capaz de trabalhar com depend√™ncias do Maven; </li><li>  Bazel tem um suporte muito legal, na minha opini√£o, para projetos distribu√≠dos.  Ele pode especificar revis√µes espec√≠ficas dos reposit√≥rios git como depend√™ncias, e ele as descarregar√° e armazenar√° em cache durante o processo de compila√ß√£o.  Para oferecer suporte √† escalabilidade, o Bazel pode, por exemplo, distribuir v√°rios destinos em servidores de constru√ß√£o baseados na nuvem, o que permite criar rapidamente projetos volumosos. </li></ul><br>  Contras de Bazel: <br><br><ul><li>  todo esse encanto √© muito dif√≠cil de manter, porque as configura√ß√µes de compila√ß√£o s√£o muito detalhadas e descrevem a montagem em um n√≠vel baixo; </li><li>  entre outras coisas, parece que Bazel est√° agora se desenvolvendo ativamente.  Por esse motivo, alguns exemplos n√£o s√£o coletados e os que s√£o coletados podem usar a funcionalidade desatualizada, marcada como obsoleta; </li><li>  a documenta√ß√£o agora tamb√©m deixa muito a desejar, especialmente quando comparada com Gradle; </li><li>  em pequenos projetos, o aquecimento e a an√°lise das configura√ß√µes de constru√ß√£o podem levar mais tempo que o pr√≥prio assembly, o que n√£o √© bom, na minha opini√£o. </li></ul><br>  Conceitualmente, a configura√ß√£o b√°sica do Bazel consiste em WORKSPACE, onde descrevemos todos os tipos de coisas globais para um projeto, e BUILD, que cont√©m alvos diretamente para montagem. <br>  Vamos descrever o espa√ßo de trabalho.  Como temos um projeto Android, a primeira coisa que configuramos √© o SDK do Android.  Al√©m disso, uma regra para descarregar configura√ß√µes √© importada aqui.  Ent√£o, como o projeto est√° escrito em Kotlin, devemos especificar as regras para ele.  Aqui fazemos isso, referindo-se a uma revis√£o espec√≠fica diretamente do reposit√≥rio git. <br><br><div class="spoiler">  <b class="spoiler_title">ESPA√áO DE TRABALHO</b> <div class="spoiler_text"><pre> <code class="python hljs">android_sdk_repository( name = <span class="hljs-string"><span class="hljs-string">"androidsdk"</span></span>, api_level = <span class="hljs-number"><span class="hljs-number">28</span></span>, build_tools_version = <span class="hljs-string"><span class="hljs-string">"28.0.3"</span></span> ) load(<span class="hljs-string"><span class="hljs-string">"@bazel_tools//tools/build_defs/repo:http.bzl"</span></span>, <span class="hljs-string"><span class="hljs-string">"http_archive"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># # KOTLIN RULES # RULES_KOTLIN_VERSION = "990fcc53689c8b58b3229c7f628f843a60cb9f5c" http_archive( name = "io_bazel_rules_kotlin", url = "https://github.com/bazelbuild/rules_kotlin/archive/%s.zip" % RULES_KOTLIN_VERSION, strip_prefix = "rules_kotlin-%s" % RULES_KOTLIN_VERSION ) load("@io_bazel_rules_kotlin//kotlin:kotlin.bzl", "kotlin_repositories", "kt_register_toolchains") kotlin_repositories() kt_register_toolchains()</span></span></code> </pre><br></div></div><br>  Agora vamos come√ßar no BUILD. <br><br>  Primeiro, importamos a regra para montar o Kotlin e descrevemos o que queremos coletar.  No nosso caso, este √© um aplicativo Android; portanto, usamos android_binary, onde definimos o manifesto, o SDK m√≠nimo etc.  Nosso aplicativo depender√° da fonte, portanto, n√≥s os mencionamos em deps e passamos para o que s√£o e onde encontr√°-los.  O c√≥digo tamb√©m depender√° dos recursos e da biblioteca appcompat.  Para recursos, usamos o destino usual para montar fontes do Android, mas apenas atribu√≠mos recursos a ele sem classes java.  E descrevemos algumas regras que importam bibliotecas de terceiros.  Ele tamb√©m menciona appcompat_core, do qual depende o appcompat. <br><br><div class="spoiler">  <b class="spoiler_title">CONSTRUIR</b> <div class="spoiler_text"><pre> <code class="python hljs">load(<span class="hljs-string"><span class="hljs-string">"@io_bazel_rules_kotlin//kotlin:kotlin.bzl"</span></span>, <span class="hljs-string"><span class="hljs-string">"kt_android_library"</span></span>) android_binary( name = <span class="hljs-string"><span class="hljs-string">"app"</span></span>, custom_package = <span class="hljs-string"><span class="hljs-string">"com.example.myapplication"</span></span>, manifest = <span class="hljs-string"><span class="hljs-string">"src/main/AndroidManifest.xml"</span></span>, manifest_values = { <span class="hljs-string"><span class="hljs-string">"minSdkVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"15"</span></span>, }, deps = [ <span class="hljs-string"><span class="hljs-string">":lib"</span></span>, ], ) kt_android_library( name = <span class="hljs-string"><span class="hljs-string">"lib"</span></span>, srcs = glob([<span class="hljs-string"><span class="hljs-string">"src/main/java/**/*"</span></span>]), deps = [ <span class="hljs-string"><span class="hljs-string">":res"</span></span>, <span class="hljs-string"><span class="hljs-string">":appcompat"</span></span>, ], ) android_library( name = <span class="hljs-string"><span class="hljs-string">"res"</span></span>, resource_files = glob([<span class="hljs-string"><span class="hljs-string">"src/main/res/**/*"</span></span>]), manifest = <span class="hljs-string"><span class="hljs-string">"src/main/AndroidManifest.xml"</span></span>, custom_package = <span class="hljs-string"><span class="hljs-string">"com.example.myapplication"</span></span>, ) aar_import( name = <span class="hljs-string"><span class="hljs-string">"appcompat"</span></span>, aar = <span class="hljs-string"><span class="hljs-string">"libs/appcompat.aar"</span></span>, deps = [ <span class="hljs-string"><span class="hljs-string">":appcompat_core"</span></span>, ] ) aar_import( name = <span class="hljs-string"><span class="hljs-string">"appcompat_core"</span></span>, aar = <span class="hljs-string"><span class="hljs-string">"libs/core.aar"</span></span>, )</code> </pre><br></div></div><br>  Em n√∫meros para um projeto t√£o pequeno, tudo parece triste.  Mais de meio minuto para uma constru√ß√£o limpa Ol√°, mundo!  muito.  O tempo de constru√ß√£o incremental tamb√©m est√° longe de ser perfeito. <br><br>  O Bazel √© usado por seus criadores (Google) em alguns de seus projetos, incluindo servidores, assim como Dropbox e Huawei, que coletam aplicativos m√≥veis para eles.  E o not√≥rio Dagger 2 tamb√©m est√° indo para Bazel. <br><br><h2>  Buck </h2><br>  Foi inventado por desertores do Google para o Facebook.  Ele usou o Python para descrever as configura√ß√µes e depois migrou para o Skylark mencionado hoje.  De repente, ele est√° usando o sistema Ant. <br><br>  Buck Pros: <br><br><ul><li>  suporta linguagens de programa√ß√£o diferentes e pode criar Andriod e iOS; </li><li>  Pode armazenar em cache artefatos coletados anteriormente </li><li>  Buck fez sua pr√≥pria implementa√ß√£o de dex, que funciona mais r√°pido que o padr√£o e trava com o daemon do sistema.  Portanto, eles economizam tempo na inicializa√ß√£o do dex.  Os engenheiros realmente otimizaram muito.  Por exemplo, Buck n√£o coleta c√≥digo que depende da biblioteca se a interface n√£o mudou ao alterar os elementos internos da biblioteca.  Da mesma forma para recursos: se os identificadores n√£o foram alterados, ao alterar recursos, o c√≥digo n√£o √© remontado. </li><li>  existe um plugin que pode ocultar Buck por tr√°s da configura√ß√£o de Gredlovsky.  I.e.  voc√™ obt√©m algo como um projeto Gradle normal, que √© realmente constru√≠do atrav√©s do Buck. </li></ul><br>  Contras Buck: <br><br><ul><li>  √© t√£o dif√≠cil de manter quanto Bazel.  I.e.  aqui tamb√©m √© necess√°rio descrever regras de baixo n√≠vel que descrevam claramente o processo de montagem; </li><li>  entre outras coisas, Buck n√£o pode resolver as depend√™ncias do Maven por conta pr√≥pria. </li></ul><br>  Ent√£o, o que o assembly configura para Ol√°, mundo!  atrav√©s do fanfarr√£o?  Aqui, descrevemos um arquivo de configura√ß√£o, onde indicamos que queremos criar um projeto Android que ser√° assinado com uma chave de depura√ß√£o.  O aplicativo tamb√©m depender√° da fonte - lib na matriz deps.  Em seguida, vem o alvo com configura√ß√µes de assinatura.  Estou usando uma chave de d√©bito que acompanha o SDK do Android.  Imediatamente depois de seguir o objetivo, que coletar√° as fontes de Kotlin para n√≥s.  Como o Bazel, depende de recursos e bibliotecas de compatibilidade. <br><br>  N√≥s os descrevemos.  H√° um alvo separado para recursos em Buck, portanto, as bicicletas n√£o s√£o √∫teis.  A seguir, est√£o as regras para bibliotecas de terceiros baixadas. <br><br><div class="spoiler">  <b class="spoiler_title">CONSTRUIR</b> <div class="spoiler_text"><pre> <code class="python hljs">android_binary( name = <span class="hljs-string"><span class="hljs-string">'app'</span></span>, manifest = <span class="hljs-string"><span class="hljs-string">'src/main/AndroidManifest.xml'</span></span>, manifest_entries = { <span class="hljs-string"><span class="hljs-string">'min_sdk_version'</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span>, }, keystore = <span class="hljs-string"><span class="hljs-string">':debug_keystore'</span></span>, deps = [ <span class="hljs-string"><span class="hljs-string">':lib'</span></span>, ], ) keystore( name = <span class="hljs-string"><span class="hljs-string">'debug_keystore'</span></span>, store = <span class="hljs-string"><span class="hljs-string">'debug.keystore'</span></span>, properties = <span class="hljs-string"><span class="hljs-string">'debug.keystore.properties'</span></span>, ) android_library( name = <span class="hljs-string"><span class="hljs-string">'lib'</span></span>, srcs = glob([<span class="hljs-string"><span class="hljs-string">'src/main/java/*.kt'</span></span>]), deps = [ <span class="hljs-string"><span class="hljs-string">':res'</span></span>, <span class="hljs-string"><span class="hljs-string">':compat'</span></span>, <span class="hljs-string"><span class="hljs-string">':compat_core'</span></span>, ], language = <span class="hljs-string"><span class="hljs-string">'kotlin'</span></span>, ) android_resource( name = <span class="hljs-string"><span class="hljs-string">'res'</span></span>, res = <span class="hljs-string"><span class="hljs-string">"src/main/res"</span></span>, package = <span class="hljs-string"><span class="hljs-string">'com.example.myapplication'</span></span>, ) android_prebuilt_aar( name = <span class="hljs-string"><span class="hljs-string">'compat'</span></span>, aar = <span class="hljs-string"><span class="hljs-string">"libs/appcompat.aar"</span></span>, ) android_prebuilt_aar( name = <span class="hljs-string"><span class="hljs-string">'compat_core'</span></span>, aar = <span class="hljs-string"><span class="hljs-string">"libs/core.aar"</span></span>, )</code> </pre><br></div></div><br>  Essa coisa toda est√° indo muito rapidamente.  Uma montagem limpa leva um pouco mais de 7 segundos, enquanto uma montagem incremental √© completamente invis√≠vel em 200 milissegundos.  Eu acho que esse √© um resultado muito bom. <br><br>  √â isso que o Facebook faz.  Al√©m do aplicativo principal, eles coletam o Facebook Messenger para eles.  E o Uber, que criou o plugin para o Gradle e o Airbnb com a Lyft. <br><br><h2>  Conclus√µes </h2><br>  Agora que falamos sobre cada sistema de compila√ß√£o, podemos compar√°-los entre si usando o exemplo Ol√°, mundo!  O conjunto do console agrada com sua estabilidade.  O tempo de execu√ß√£o do script no terminal pode ser considerado a refer√™ncia para a montagem de compila√ß√µes limpas, porque os custos de terceiros para a an√°lise de scripts s√£o m√≠nimos aqui.  Nesse caso, eu chamaria Maven de um estranho √≥bvio por um aumento extremamente insignificante na montagem incremental.  O Bazel analisa as configura√ß√µes por um longo tempo e inicializa: existe uma id√©ia de que de alguma forma armazena em cache os resultados da inicializa√ß√£o, porque a constru√ß√£o incremental √© executada muito mais r√°pido que a limpeza.  Buck √© o l√≠der indiscut√≠vel desta cole√ß√£o.  Montagem r√°pida e incremental muito r√°pida. <br><br><img src="https://habrastorage.org/webt/br/f3/_p/brf3_pzmfeixbecyexdghd5ivfs.jpeg"><br><br>  Agora compare os pr√≥s e contras.  N√£o incluirei o Maven na compara√ß√£o, porque claramente perde para a Gradle e quase nunca √© usado no mercado.  Uno Buck e Bazel, porque eles t√™m aproximadamente as mesmas vantagens e desvantagens. <br><br>  Ent√£o, sobre Gradle: <br><br><ul><li>  o primeiro e, na minha opini√£o, o mais importante √© que √© simples.  Muito simples; </li><li>  pronto para uso, descarrega e descarrega depend√™ncias; </li><li>  para ele, existem muitos treinamentos e documenta√ß√£o diferentes; </li><li>  com suporte ativo do Google e da comunidade.  √ìtima integra√ß√£o com o Android Studio, a atual ferramenta de desenvolvimento principal.  E todos os novos recursos para a cria√ß√£o de um aplicativo Android aparecem pela primeira vez em Gradle. </li></ul><br>  Sobre Buck / Bazel: <br><br><ul><li>  definitivamente pode ser muito r√°pido em compara√ß√£o com o Gradle.  Eu acredito que isso √© especialmente vis√≠vel em projetos muito grandes </li><li>  Voc√™ pode manter um projeto no qual haver√° c√≥digos-fonte para iOS e Android e mont√°-los com um sistema de compila√ß√£o.  Isso permite que algumas partes do aplicativo se atrapalhem entre plataformas.  Por exemplo, √© assim que o Chromium est√° indo; </li><li>  for√ßado a descrever depend√™ncias em detalhes e, assim, literalmente for√ßar o desenvolvedor a ser multi-modular. </li></ul><br>  N√£o se esque√ßa dos contras. <br><br>  Gradle paga por sua simplicidade, sendo lento e ineficiente. <br>  Buck / Bazel, pelo contr√°rio, devido √† sua velocidade, sofre com a necessidade de descrever o processo de compila√ß√£o nas configura√ß√µes com mais detalhes.  Bem, desde que apareceram no mercado h√° relativamente pouco tempo, n√£o h√° muita documenta√ß√£o e v√°rias dicas. <br><br><h2>  iFUNNY </h2><br>  Talvez voc√™ tenha alguma d√∫vida de como coletamos o iFunny.  Assim como muitos - usando Gradle.  E h√° raz√µes para isso: <br><br><ol><li>  Ainda n√£o est√° claro que tipo de ganho em velocidade de montagem isso nos dar√°.  Uma compila√ß√£o limpa do iFunny leva quase 3 minutos e √© incremental - cerca de um minuto, o que na verdade n√£o √© muito longo. </li><li>  As configura√ß√µes de compila√ß√£o Buck ou Bazel s√£o mais dif√≠ceis de manter.  No caso de Buck, voc√™ tamb√©m precisa monitorar a relev√¢ncia das bibliotecas conectadas e das bibliotecas das quais elas dependem. </li><li>  √â banal caro transferir um projeto existente de Gradle para Buck / Bazel, especialmente em condi√ß√µes de lucro incompreens√≠vel. </li></ol><br>  Se o seu projeto demorar mais de 45 minutos e houver cerca de 20 pessoas na equipe de desenvolvimento do Android, faz sentido pensar em mudar o sistema de compila√ß√£o.  Se voc√™ e seu amigo est√£o vendo uma startup, use Gradle e abandone esses pensamentos. <br><br><img src="https://habrastorage.org/webt/ah/po/1o/ahpo1oen8smqi1ks_fdqfqeydea.jpeg"><br><br>  Ficarei feliz em discutir as perspectivas de alternativas ao Gradle nos coment√°rios! <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link para o projeto</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt469771/">https://habr.com/ru/post/pt469771/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt469749/index.html">Melhorando o UX com a tecla Tab</a></li>
<li><a href="../pt469755/index.html">Como ser um bom programador</a></li>
<li><a href="../pt469757/index.html">Tecnologia AR ao servi√ßo da pintura</a></li>
<li><a href="../pt469765/index.html">Elogios relaxam e cr√≠ticas ofendem - como avaliar o trabalho de outra pessoa, para que todos fiquem bem</a></li>
<li><a href="../pt469767/index.html">Como escolhemos o ServiceDesk. Parte 1</a></li>
<li><a href="../pt469775/index.html">Desenhe um som</a></li>
<li><a href="../pt469779/index.html">Outdoor Future London Academy Meetup</a></li>
<li><a href="../pt469783/index.html">Por que o futuro da entrega ainda pode estar por tr√°s dos dirig√≠veis</a></li>
<li><a href="../pt469785/index.html">Uso da Intel NUC - Ganhe o concurso NUC. Resultados e vencedores</a></li>
<li><a href="../pt469797/index.html">Solu√ß√£o Veeam PN e seus novos recursos na vers√£o 2.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>