<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜¤ ğŸ˜¶ ğŸš¥ Debian + Postfix + Dovecot +å¤šåŸŸ+ SSL + IPv6 + OpenVPN +å¤šæ¥å£+ SpamAssassin-learn +ç»‘å®š ğŸ›€ğŸ¿ ğŸ’‹ ğŸ¦Œ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ¬æ–‡ä»‹ç»å¦‚ä½•è®¾ç½®ç°ä»£é‚®ä»¶æœåŠ¡å™¨ã€‚ 
 Postfix + Dovecotã€‚ SPF + DKIM + rDNSã€‚ ä½¿ç”¨IPv6ã€‚ 
 ä½¿ç”¨TLSåŠ å¯†ã€‚ æ”¯æŒå¤šä¸ªåŸŸ-éƒ¨åˆ†å¸¦æœ‰çœŸå®çš„SSLè¯ä¹¦ã€‚ 
 åœ¨å…¶ä»–é‚®ä»¶æœåŠ¡å™¨ä¸Šå…·æœ‰ååƒåœ¾é‚®ä»¶ä¿æŠ¤å’Œè¾ƒé«˜çš„ååƒåœ¾é‚®ä»¶è¯„çº§ã€‚ 
 æ”¯æŒå¤šç§ç‰©ç†æ¥å£ã€‚ 
 ä½¿ç”¨OpenV...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Debian + Postfix + Dovecot +å¤šåŸŸ+ SSL + IPv6 + OpenVPN +å¤šæ¥å£+ SpamAssassin-learn +ç»‘å®š</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413689/"> æœ¬æ–‡ä»‹ç»å¦‚ä½•è®¾ç½®ç°ä»£é‚®ä»¶æœåŠ¡å™¨ã€‚ <br>  Postfix + Dovecotã€‚  SPF + DKIM + rDNSã€‚ ä½¿ç”¨IPv6ã€‚ <br> ä½¿ç”¨TLSåŠ å¯†ã€‚ æ”¯æŒå¤šä¸ªåŸŸ-éƒ¨åˆ†å¸¦æœ‰çœŸå®çš„SSLè¯ä¹¦ã€‚ <br> åœ¨å…¶ä»–é‚®ä»¶æœåŠ¡å™¨ä¸Šå…·æœ‰ååƒåœ¾é‚®ä»¶ä¿æŠ¤å’Œè¾ƒé«˜çš„ååƒåœ¾é‚®ä»¶è¯„çº§ã€‚ <br> æ”¯æŒå¤šç§ç‰©ç†æ¥å£ã€‚ <br> ä½¿ç”¨OpenVPNï¼Œå®ƒé€šè¿‡IPv4è¿æ¥å¹¶æä¾›IPv6ã€‚ <br><br> å¦‚æœæ‚¨ä¸æƒ³å­¦ä¹ æ‰€æœ‰è¿™äº›æŠ€æœ¯ï¼Œä½†æ˜¯æƒ³è¦é…ç½®è¿™æ ·çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæœ¬æ–‡é€‚åˆæ‚¨ã€‚ <br><br> æ²¡æœ‰å°è¯•è§£é‡Šæœ¬æ–‡ä¸­çš„æ¯ä¸ªç»†èŠ‚ã€‚ ä»æ¶ˆè´¹è€…çš„è§’åº¦å‡ºå‘ï¼Œå¯¹æ²¡æœ‰æ ‡å‡†é…ç½®æˆ–é‡è¦çš„é…ç½®è¿›è¡Œè§£é‡Šã€‚ <br><a name="habracut"></a><br> è®¾ç½®é‚®ä»¶æœåŠ¡å™¨çš„åŠ¨æœºæ˜¯æˆ‘çš„æ¢¦æƒ³ã€‚ å¬èµ·æ¥å¯èƒ½å¾ˆæ„šè ¢ï¼Œä½†æ˜¯æ•æˆ‘ç›´è¨€ï¼Œè¿™æ¯”æ¢¦è§è‡ªå·±å–œæ¬¢çš„å“ç‰Œçš„æ–°è½¦è¦å¥½å¾—å¤šã€‚ <br><br> é…ç½®IPv6çš„åŠ¨æœºæœ‰ä¸¤ä¸ªã€‚  ITä¸“ä¸šäººå‘˜éœ€è¦ä¸æ–­å­¦ä¹ æ–°æŠ€æœ¯æ‰èƒ½ç”Ÿå­˜ã€‚ æˆ‘æƒ³ä¸ºåå¯¹æ£€æŸ¥åˆ¶åº¦çš„æ–—äº‰åšå‡ºä¸å¤šçš„è´¡çŒ®ã€‚ <br><br> è®¾ç½®OpenVPNçš„åŠ¨æœºä»…æ˜¯ä¸ºäº†ä½¿IPv6åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šå·¥ä½œã€‚ <br> è®¾ç½®å¤šä¸ªç‰©ç†æ¥å£çš„åŠ¨æœºæ˜¯ï¼Œåœ¨æˆ‘çš„æœåŠ¡å™¨ä¸Šï¼Œä¸€ä¸ªæ¥å£â€œæ…¢è€Œæ— é™åˆ¶â€ï¼Œè€Œå¦ä¸€ä¸ªæ¥å£â€œå¿«é€Ÿä½†æœ‰å…³ç¨â€ã€‚ <br><br> è®¾ç½®ç»‘å®šè®¾ç½®çš„åŠ¨æœºæ˜¯æˆ‘çš„æä¾›å•†æä¾›äº†ä¸ç¨³å®šçš„DNSæœåŠ¡å™¨ï¼Œå¹¶ä¸”googleä¹Ÿå´©æºƒäº†ã€‚ æˆ‘æƒ³è¦ä¸€ä¸ªç¨³å®šçš„DNSæœåŠ¡å™¨ä¾›ä¸ªäººä½¿ç”¨ã€‚ <br><br> æ’°å†™æ–‡ç« çš„åŠ¨æœº-è‰æ¡ˆæ˜¯10ä¸ªæœˆå‰å†™çš„ï¼Œæˆ‘å·²ç»å¯¹å…¶è¿›è¡Œäº†ä¸¤æ¬¡ç ”ç©¶ã€‚ å¦‚æœç”šè‡³ä½œè€…ç»å¸¸éœ€è¦å®ƒï¼Œé‚£ä¹ˆå…¶ä»–äººä¹Ÿå¾ˆæœ‰å¯èƒ½éœ€è¦å®ƒã€‚ <br><br> é‚®ä»¶æœåŠ¡å™¨æ²¡æœ‰é€šç”¨çš„è§£å†³æ–¹æ¡ˆã€‚ ä½†æ˜¯ï¼Œæˆ‘å°†å°è¯•å†™ä¸€äº›ç±»ä¼¼çš„å†…å®¹ï¼Œä¾‹å¦‚â€œè¿™æ ·åšï¼Œç„¶ååœ¨ä¸€åˆ‡æ­£å¸¸è¿›è¡Œæ—¶-ä¸¢å¼ƒå¤šä½™çš„å†…å®¹â€ã€‚ <br><br> ä»tech.ruæœ‰ä¸€ä¸ªæ‰˜ç®¡æœåŠ¡å™¨ã€‚ å¯ä»¥ä¸OVHï¼ŒHetznerï¼ŒAWSè¿›è¡Œæ¯”è¾ƒã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸tech.ruçš„åˆä½œå°†æ›´åŠ æœ‰æ•ˆã€‚ <br><br> æœåŠ¡å™¨ä¸Šå·²å®‰è£…Debian 9ã€‚ <br><br> åœ¨æœåŠ¡å™¨ä¸Šæœ‰2ä¸ªæ¥å£eno1å’Œeno2ã€‚ ç¬¬ä¸€ä¸ªæ˜¯æ— é™çš„ï¼Œç¬¬äºŒä¸ªæ˜¯å¿«é€Ÿçš„ã€‚ <br><br> æ¥å£eno1ä¸Šæœ‰3ä¸ªé™æ€IPåœ°å€XX.XX.XX.X0å’ŒXX.XX.XX.X1å’ŒXX.XX.XX.X2ï¼Œä»¥åŠeno2æ¥å£ä¸Šçš„XX.XX.XX.X5ã€‚ <br><br> æœ‰XXXXï¼šXXXXï¼šXXXXï¼šXXXXï¼š// 64åˆ†é…ç»™æ¥å£eno1çš„IPv6åœ°å€æ± ï¼Œå¹¶åº”æˆ‘çš„è¯·æ±‚ä»XXXXï¼šXXXXï¼šXXXXï¼šXXXXï¼š1ï¼š2 :: / 96åˆ†é…ç»™eno2ã€‚ <br><br> æœ‰3ä¸ªåŸŸâ€œ domain1.comâ€ï¼Œâ€œ domain2.comâ€ï¼Œâ€œ domain3.comâ€ã€‚ å¯¹äºâ€œ domain1.comâ€å’Œâ€œ domain3.comâ€ï¼Œæœ‰ä¸€ä¸ªSSLè¯ä¹¦ã€‚ <br><br> æœ‰ä¸€ä¸ªæ‚¨è¦ç»‘å®šé‚®ç®±â€œ vasya.pupkin @ domain1.comâ€çš„Googleå¸æˆ·ï¼ˆæ¥æ”¶é‚®ä»¶å¹¶ç›´æ¥ä»gmailç•Œé¢å‘é€é‚®ä»¶ï¼‰ã€‚ <br> åº”è¯¥æœ‰ä¸€ä¸ªé‚®ç®±support@domain2.comï¼Œè¿™æ˜¯æˆ‘æƒ³ä»æˆ‘çš„gmailä¸­çœ‹åˆ°çš„é‚®ä»¶çš„å‰¯æœ¬ã€‚ è€Œä¸”å‡ ä¹ä¸å¯èƒ½é€šè¿‡Webç•Œé¢ä»£è¡¨â€œ support @ domain2.comâ€å‘é€é‚®ä»¶ã€‚ <br><br> åº”è¯¥æœ‰ä¸€ä¸ªé‚®ç®±â€œ ivanov @ domain3.comâ€ï¼ŒIvanovå°†åœ¨ä»–çš„iPhoneä¸­ä½¿ç”¨è¯¥é‚®ç®±ã€‚ <br><br> å‘é€çš„ä¿¡ä»¶å¿…é¡»ç¬¦åˆæ‰€æœ‰å½“å‰çš„ååƒåœ¾é‚®ä»¶è¦æ±‚ã€‚ <br> å…¬å…±ç½‘ç»œä¸Šåº”è¯¥æä¾›æœ€é«˜çº§åˆ«çš„åŠ å¯†ã€‚ <br> å‘é€å’Œæ¥æ”¶ç”µå­é‚®ä»¶éƒ½å¿…é¡»æœ‰IPv6æ”¯æŒã€‚ <br> å¿…é¡»æœ‰ä¸€ä¸ªSpamAssassinï¼Œå®ƒå°†æ°¸è¿œä¸ä¼šåˆ é™¤ç”µå­é‚®ä»¶ã€‚ å®ƒå°†é€€å›æˆ–è·³è¿‡ï¼Œæˆ–å°†åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹å‘é€åˆ°IMAPã€‚ <br> åº”è¯¥é…ç½®SpamAssassinè‡ªåŠ¨å­¦ä¹ ï¼šå¦‚æœæˆ‘å°†å­—æ¯ç§»åˆ°Spamæ–‡ä»¶å¤¹ï¼Œæˆ‘å°†ä»ä¸­å­¦ä¹ ï¼› å¦‚æœæˆ‘å°†ä¿¡ä»¶ä»â€œåƒåœ¾é‚®ä»¶â€æ–‡ä»¶å¤¹ä¸­ç§»å‡ºï¼Œåˆ™ä¼šä»ä¸­å­¦ä¹ ã€‚  SpamAssassinå­¦ä¹ æˆæœ-åº”è¯¥å½±å“åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹ä¸­é‚®ä»¶çš„è¦†ç›–èŒƒå›´ã€‚ <br>  PHPè„šæœ¬åº”è¯¥èƒ½å¤Ÿä»£è¡¨è¯¥æœåŠ¡å™¨ä¸Šçš„ä»»ä½•åŸŸå‘é€é‚®ä»¶ã€‚ <br> åº”è¯¥æœ‰ä¸€ä¸ªopenvpnæœåŠ¡ï¼Œè¯¥æœåŠ¡èƒ½å¤Ÿåœ¨æ²¡æœ‰IPv6çš„å®¢æˆ·ç«¯ä¸Šä½¿ç”¨IPv6ã€‚ <br><br> é¦–å…ˆï¼Œæ‚¨éœ€è¦é…ç½®æ¥å£å’Œè·¯ç”±ï¼ŒåŒ…æ‹¬IPv6ã€‚ <br> ç„¶åï¼Œæ‚¨å°†éœ€è¦é…ç½®OpenVPNï¼Œå®ƒå°†é€šè¿‡IPv4è¿æ¥å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›é™æ€çš„çœŸå®IPv6åœ°å€ã€‚ è¯¥å®¢æˆ·ç«¯å°†æœ‰æƒè®¿é—®æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰IPv6æœåŠ¡ï¼Œå¹¶æœ‰æƒè®¿é—®Internetä¸Šçš„ä»»ä½•IPv6èµ„æºã€‚ <br> ç„¶åï¼Œæœ‰å¿…è¦å°†Postfixé…ç½®ä¸ºå‘é€å­—æ¯+ SPF + DKIM + rDNSå’Œå…¶ä»–ç±»ä¼¼çš„çäº‹ã€‚ <br> ç„¶åï¼Œæ‚¨å°†éœ€è¦é…ç½®Dovecotå¹¶é…ç½®å¤šåŸŸã€‚ <br> ç„¶åï¼Œæ‚¨å°†éœ€è¦é…ç½®SpamAssassinå¹¶é…ç½®åŸ¹è®­ã€‚ <br> æœ€åï¼Œå®‰è£…ç»‘å®šã€‚ <br><br><h2>  =============å¤šæ¥å£============== </h2><br> è¦é…ç½®æ¥å£ï¼Œæ‚¨éœ€è¦åœ¨â€œ / etc / network / interfacesâ€ä¸­æ³¨å†Œå®ƒã€‚ <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># The loopback network interface auto lo iface lo inet loopback # The primary network interface allow-hotplug eno1 iface eno1 inet static address XX.XX.XX.X0/24 gateway XX.XX.XX.1 dns-nameservers 127.0.0.1 213.248.1.6 post-up ip route add XX.XX.XX.0/24 dev eno1 src XX.XX.XX.X0 table eno1t post-up ip route add default via XX.XX.XX.1 table eno1t post-up ip rule add table eno1t from XX.XX.XX.X0 post-up ip rule add table eno1t to XX.XX.XX.X0 auto eno1:1 iface eno1:1 inet static address XX.XX.XX.X1 netmask 255.255.255.0 post-up ip rule add table eno1t from XX.XX.XX.X1 post-up ip rule add table eno1t to XX.XX.XX.X1 post-up ip route add 10.8.0.0/24 dev tun0 src XX.XX.XX.X1 table eno1t post-down ip route del 10.8.0.0/24 dev tun0 src XX.XX.XX.X1 table eno1t auto eno1:2 iface eno1:2 inet static address XX.XX.XX.X2 netmask 255.255.255.0 post-up ip rule add table eno1t from XX.XX.XX.X2 post-up ip rule add table eno1t to XX.XX.XX.X2 iface eno1 inet6 static address X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1::/64 gateway X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">:1 up ip -6 addr add X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1:1:1/64 dev $IFACE up ip -6 addr add X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1:1:2/64 dev $IFACE down ip -6 addr del X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1:1:1/64 dev $IFACE down ip -6 addr del X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1:1:2/64 dev $IFACE # The secondary network interface allow-hotplug eno2 iface eno2 inet static address XX.XX.XX.X5 netmask 255.255.255.0 post-up ip route add XX.XX.XX.0/24 dev eno2 src XX.XX.XX.X5 table eno2t post-up ip route add default via XX.XX.XX.1 table eno2t post-up ip rule add table eno2t from XX.XX.XX.X5 post-up ip rule add table eno2t to XX.XX.XX.X5 post-up ip route add 10.8.0.0/24 dev tun0 src XX.XX.XX.X5 table eno2t post-down ip route del 10.8.0.0/24 dev tun0 src XX.XX.XX.X5 table eno2t iface eno2 inet6 static address X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:2::/96 up ip -6 addr add X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:2:1:1/64 dev $IFACE up ip -6 addr add X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:2:1:2/64 dev $IFACE down ip -6 addr del X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:2:1:1/64 dev $IFACE down ip -6 addr del X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:2:1:2/64 dev $IFACE # OpenVPN network iface tun0 inet6 static address X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:3::/80</span></span></code> </pre> <br> è¿™äº›è®¾ç½®å¯ä»¥åº”ç”¨åœ¨tech.ruä¸­çš„ä»»ä½•æœåŠ¡å™¨ä¸Šï¼ˆä¸æ”¯æŒç¨åŠ åè°ƒï¼‰ï¼Œå®ƒå°†ç«‹å³æŒ‰é¢„æœŸå·¥ä½œã€‚ <br><br> å¦‚æœä¸ºOVHçš„Hetznerå»ºç«‹ç±»ä¼¼çš„äº‹æƒ…çš„ç»éªŒ-æœ‰å¥³æœ‹å‹ã€‚ è¾›è‹¦äº† <br><br>  eno1æ˜¯ç½‘å¡1çš„åç§°ï¼ˆç¼“æ…¢ä½†ä¸å—é™åˆ¶ï¼‰ã€‚ <br>  eno2æ˜¯2å·ç½‘å¡çš„åç§°ï¼ˆå¿«é€Ÿï¼Œä½†è¦æ”¶è´¹ï¼‰ã€‚ <br>  tun0æ˜¯æ¥è‡ªOpenVPNçš„è™šæ‹Ÿç½‘å¡çš„åç§°ã€‚ <br>  XX.XX.XX.X0-eno1ä¸Šçš„IPv4ï¼ƒ1 <br>  XX.XX.XX.X1-eno1ä¸Šçš„IPv4ï¼ƒ2ã€‚ <br>  XX.XX.XX.X2-eno1ä¸Šçš„IPv4ï¼ƒ3ã€‚ <br>  XX.XX.XX.X5-eno2ä¸Šçš„IPv4ï¼ƒ1ã€‚ <br>  XX.XX.XX.1-IPv4ç½‘å…³ <br>  XXXXï¼šXXXXï¼šXXXXï¼šXXXX :: / 64-æ•´ä¸ªæœåŠ¡å™¨çš„IPv6ã€‚ <br>  XXXXï¼šXXXXï¼šXXXXï¼šXXXXï¼š1ï¼š2 :: / 96-IPv6 for eno2ï¼Œå…¶ä»–æ‰€æœ‰å†…å®¹éƒ½ä»å¤–éƒ¨ä¼ é€’ç»™eno1ã€‚ <br>  XXXXï¼šXXXXï¼šXXXXï¼šXXXX :: 1-IPv6ç½‘å…³ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ‚¨å¯ä»¥/éœ€è¦åœ¨è¿™é‡Œäº¤ä¸ªæœ‹å‹ã€‚è¯·æŒ‡æ˜IPv6äº¤æ¢æœºï¼‰ã€‚ <br>  dns-nameservers-æŒ‡å®š127.0.0.1ï¼ˆå› ä¸ºbindæ˜¯åœ¨æœ¬åœ°å®‰è£…çš„ï¼‰å’Œ213.248.1.6ï¼ˆæ¥è‡ªtech.ruï¼‰ã€‚ <br><br>  â€œè¡¨eno1tâ€å’Œâ€œè¡¨eno2tâ€-è¿™äº›è·¯ç”±è§„åˆ™çš„å«ä¹‰æ˜¯ï¼Œé€šè¿‡eno1-&gt;çš„æµé‡é€šè¿‡å®ƒï¼Œè€Œé€šè¿‡eno2-&gt;çš„æµé‡é€šè¿‡å®ƒã€‚ æœåŠ¡å™¨å¯åŠ¨çš„è¿æ¥ä¹Ÿå°†é€šè¿‡eno1è¿›è¡Œã€‚ <br><br><pre> <code class="bash hljs">ip route add default via XX.XX.XX.1 table eno1t</code> </pre> <br> ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä»»ä½•åœ¨è§„åˆ™â€œè¡¨eno1tâ€æ ‡è®°ä¸º-&gt;çš„è§„åˆ™ä¸‹æ— æ³•ç†è§£çš„æµé‡ï¼Œå°†å…¶å‘é€åˆ°eno1æ¥å£ã€‚ <br><br><pre> <code class="bash hljs">ip route add XX.XX.XX.0/24 dev eno1 src XX.XX.XX.X0 table eno1t</code> </pre> <br> ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰æœåŠ¡å™¨å¯åŠ¨çš„æµé‡å®šå‘åˆ°eno1æ¥å£ã€‚ <br><br><pre> <code class="bash hljs">ip rule add table eno1t from XX.XX.XX.X0 ip rule add table eno1t to XX.XX.XX.X0</code> </pre> <br> ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®æ ‡è®°æµé‡çš„è§„åˆ™ã€‚ <br><br><pre> <code class="bash hljs">auto eno1:2 iface eno1:2 inet static address XX.XX.XX.X2 netmask 255.255.255.0 post-up ip rule add table eno1t from XX.XX.XX.X2 post-up ip rule add table eno1t to XX.XX.XX.X2</code> </pre> <br> æ­¤å—å®šä¹‰eno1æ¥å£çš„ç¬¬äºŒä¸ªIPv4ã€‚ <br><br><pre> <code class="bash hljs">ip route add 10.8.0.0/24 dev tun0 src XX.XX.XX.X1 table eno1t</code> </pre> <br> ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä»OpenVPNå®¢æˆ·ç«¯åˆ°æœ¬åœ°IPv4çš„è·¯ç”±ï¼Œé™¤äº†XX.XX.XX.X0ã€‚ <br> ä¸ºä»€ä¹ˆæ­¤å‘½ä»¤å¯¹æ‰€æœ‰IPv4éƒ½è¶³å¤Ÿ-æˆ‘ä»ç„¶ä¸æ˜ç™½ã€‚ <br><br><pre> <code class="bash hljs">iface eno1 inet6 static address XXXX:XXXX:XXXX:XXXX:1:1::/64 gateway XXXX:XXXX:XXXX:XXXX::1</code> </pre> <br> è¿™æˆ‘ä»¬è®¾ç½®äº†æ¥å£æœ¬èº«çš„åœ°å€ã€‚ æœåŠ¡å™¨å°†å…¶ç”¨ä½œâ€œå‘é€â€åœ°å€ã€‚ å°†ä¸å†ä½¿ç”¨ã€‚ <br><br> ä¸ºä»€ä¹ˆæ˜¾ç¤ºâ€œï¼š1ï¼š1 ::â€å¦‚æ­¤å¤æ‚ï¼Ÿ è¯¥OpenVPNæ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”ä»…ç”¨äºæ­¤ç›®çš„ã€‚ ç¨åå†è¯¦ç»†ä»‹ç»ã€‚ <br><br> å…³äºç½‘å…³çš„ä¸»é¢˜-è¿™å°±æ˜¯å®ƒçš„å·¥ä½œåŸç†ã€‚ ä½†æ˜¯ä»¥æ­£ç¡®çš„æ–¹å¼-åœ¨è¿™é‡Œæ‚¨å¿…é¡»æŒ‡å®šæœåŠ¡å™¨è¿æ¥åˆ°çš„IPv6äº¤æ¢æœºã€‚ <br><br> ä½†æ˜¯ï¼Œç”±äºæŸäº›åŸå› ï¼Œå¦‚æœæ‰§è¡Œæ­¤æ“ä½œï¼ŒIPv6å°†åœæ­¢å·¥ä½œã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€äº›tech.ruçš„éº»çƒ¦ã€‚ <br><br><pre> <code class="bash hljs">ip -6 addr add XXXX:XXXX:XXXX:XXXX:1:1:1:1/64 dev <span class="hljs-variable"><span class="hljs-variable">$IFACE</span></span></code> </pre> <br> è¿™ä¼šå°†IPv6åœ°å€æ·»åŠ åˆ°æ¥å£ã€‚ å¦‚æœæ‚¨éœ€è¦ä¸€ç™¾ä¸ªåœ°å€ï¼Œåˆ™æ„å‘³ç€æ­¤æ–‡ä»¶ä¸­æœ‰ä¸€ç™¾è¡Œã€‚ <br><br><pre> <code class="bash hljs">iface eno1 inet6 static address XXXX:XXXX:XXXX:XXXX:1:1::/64 ... iface eno2 inet6 static address XXXX:XXXX:XXXX:XXXX:1:2::/96 ... iface tun0 inet6 static address XXXX:XXXX:XXXX:XXXX:1:3::/80</code> </pre> <br><blockquote> æ ‡è®°æ‰€æœ‰æ¥å£çš„åœ°å€å’Œå­ç½‘ï¼Œä»¥ä½¿å…¶æ¸…æ™°å¯è§ã€‚ <br>  eno1-å®ƒå¿…é¡»æ˜¯â€œ / 64â€-å› ä¸ºè¿™æ˜¯æˆ‘ä»¬çš„æ•´ä¸ªåœ°å€æ± ã€‚ <br>  tun0-å­ç½‘å¿…é¡»å¤§äºeno1ã€‚ å¦åˆ™ï¼Œæ‚¨å°†æ— æ³•ä¸ºOpenVPNå®¢æˆ·ç«¯é…ç½®IPv6ç½‘å…³ã€‚ <br>  eno2-å­ç½‘å¿…é¡»å¤§äºtun0ã€‚ å¦åˆ™ï¼ŒOpenVPNå®¢æˆ·ç«¯å°†æ— æ³•è·å–æœ¬åœ°IPv6åœ°å€ã€‚ <br> ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œæˆ‘é€‰æ‹©äº†å­ç½‘æ­¥éª¤16ï¼Œä½†å¦‚æœæ„¿æ„ï¼Œæ‚¨ç”šè‡³å¯ä»¥æ‰§è¡Œâ€œ 1â€æ­¥éª¤â€‹â€‹ã€‚ <br> å› æ­¤ï¼Œ64 + 16 = 80ï¼Œè€Œ80 + 16 = 96ã€‚ <br><br> ä¸ºäº†æ›´åŠ æ¸…æ™°ï¼š <br>  XXXXï¼šXXXXï¼šXXXXï¼šXXXXï¼š1ï¼š1ï¼šYYYYï¼šYYYY-è¿™äº›åœ°å€åº”åˆ†é…ç»™eno1ç•Œé¢ä¸Šçš„ç‰¹å®šç«™ç‚¹æˆ–æœåŠ¡ã€‚ <br>  XXXXï¼šXXXXï¼šXXXXï¼šXXXXï¼š1ï¼š2ï¼šYYYYï¼šYYYY-è¿™äº›åœ°å€åº”åˆ†é…ç»™eno2ç•Œé¢ä¸Šçš„ç‰¹å®šç«™ç‚¹æˆ–æœåŠ¡ã€‚ <br>  XXXXï¼šXXXXï¼šXXXXï¼šXXXXï¼š1ï¼š3ï¼šYYYYï¼šYYYYæ˜¯åº”åˆ†é…ç»™OpenVPNå®¢æˆ·ç«¯æˆ–ç”¨ä½œOpenVPNæœåŠ¡åœ°å€çš„åœ°å€ã€‚ </blockquote><br><br> è¦é…ç½®ç½‘ç»œ-åº”è¯¥å¯ä»¥é‡æ–°å¯åŠ¨æœåŠ¡å™¨ã€‚ <br> åœ¨æ‰§è¡ŒæœŸé—´æ‹¾å–IPv4æ›´æ”¹ï¼ˆè¯·ç¡®ä¿å°†å…¶åŒ…è£…åœ¨å±å¹•ä¸­-å¦åˆ™æ­¤å‘½ä»¤å°†ç®€å•åœ°å°†æœåŠ¡å™¨ä¸Šçš„ç½‘ç»œæ–­å¼€ï¼‰ï¼š <br><br><pre> <code class="bash hljs">/etc/init.d/networking restart</code> </pre> <br> åœ¨æ–‡ä»¶â€œ / etc / iproute2 / rt_tablesâ€çš„æœ«å°¾æ·»åŠ ï¼š <br><br><pre> <code class="bash hljs">100 eno1t 101 eno2t</code> </pre> <br> å¦åˆ™ï¼Œæ‚¨å°†æ— æ³•åœ¨æ–‡ä»¶â€œ / etc / network / interfacesâ€ä¸­ä½¿ç”¨è‡ªå®šä¹‰è¡¨ã€‚ <br> è¿™äº›æ•°å­—å¿…é¡»å”¯ä¸€ä¸”å°äº65535ã€‚ <br><br>  IPv6æ›´æ”¹å¾ˆå®¹æ˜“æ›´æ”¹è€Œæ— éœ€é‡æ–°å¯åŠ¨ï¼Œä½†æ˜¯ä¸ºæ­¤ï¼Œæ‚¨è‡³å°‘éœ€è¦å­¦ä¹ ä¸‰ä¸ªå‘½ä»¤ï¼š <br><br><pre> <code class="bash hljs">ip -6 addr ... ip -6 route ... ip -6 neigh ...</code> </pre> <br> è®¾ç½®â€œ /etc/sysctl.confâ€ <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Uncomment the next line to enable packet forwarding for IPv4 net.ipv4.ip_forward = 1 # Do not accept ICMP redirects (prevent MITM attacks) net.ipv4.conf.all.accept_redirects = 0 net.ipv6.conf.all.accept_redirects = 0 # Do not send ICMP redirects (we are not a router) net.ipv4.conf.all.send_redirects = 0 # For receiving ARP replies net.ipv4.conf.all.arp_filter = 0 net.ipv4.conf.default.arp_filter = 0 # For sending ARP net.ipv4.conf.all.arp_announce = 0 net.ipv4.conf.default.arp_announce = 0 # Enable IPv6 net.ipv6.conf.all.disable_ipv6 = 0 net.ipv6.conf.default.disable_ipv6 = 0 net.ipv6.conf.lo.disable_ipv6 = 0 # IPv6 configuration net.ipv6.conf.all.autoconf = 1 net.ipv6.conf.all.accept_ra = 0 # For OpenVPN net.ipv6.conf.all.forwarding = 1 net.ipv6.conf.all.proxy_ndp = 1 # For nginx on boot net.ipv6.ip_nonlocal_bind = 1</span></span></code> </pre> <br> è¿™äº›æ˜¯æˆ‘æœåŠ¡å™¨çš„sysctlè®¾ç½®ã€‚ æˆ‘æ³¨æ„åˆ°é‡è¦ã€‚ <br><br><pre> <code class="bash hljs">net.ipv4.ip_forward = 1</code> </pre> <br> å¦åˆ™ï¼ŒOpenVPNå°†æ— æ³•ä»¥ä»»ä½•æ–¹å¼å·¥ä½œã€‚ <br><br><pre> <code class="bash hljs">net.ipv6.ip_nonlocal_bind = 1</code> </pre> <br> ä»»ä½•åœ¨æ¥å£å¯åŠ¨åç«‹å³å°è¯•ç»‘å®šIPv6ï¼ˆä¾‹å¦‚nginxï¼‰çš„äººéƒ½ä¼šæ”¶åˆ°é”™è¯¯æ¶ˆæ¯ã€‚ è¿™æ ·çš„åœ°å€ä¸å¯ç”¨ã€‚ <br><br> ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œè¿›è¡Œäº†è¿™æ ·çš„è®¾ç½®ã€‚ <br><br><pre> <code class="bash hljs">net.ipv6.conf.all.forwarding = 1 net.ipv6.conf.all.proxy_ndp = 1</code> </pre> <br> æ²¡æœ‰è¿™äº›IPv6è®¾ç½®ï¼Œæ¥è‡ªOpenVPNå®¢æˆ·ç«¯çš„æµé‡å°±ä¸ä¼šè¿›å…¥ä¸–ç•Œã€‚ <br><br> å…¶ä»–è®¾ç½®æ— å…³ç´§è¦ï¼Œæˆ–è€…æˆ‘ä¸è®°å¾—ä¸ºä»€ä¹ˆã€‚ <br> ä½†ä»¥é˜²ä¸‡ä¸€ï¼Œæˆ‘â€œç…§åŸæ ·â€ç¦»å¼€ã€‚ <br><br> ä¸ºäº†èƒ½å¤Ÿåœ¨ä¸é‡æ–°å¼•å¯¼æœåŠ¡å™¨çš„æƒ…å†µä¸‹è·å–æ­¤æ–‡ä»¶ä¸­çš„æ›´æ”¹ï¼Œæ‚¨éœ€è¦è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š <br><br><pre> <code class="bash hljs">sysctl -p</code> </pre> <br> æœ‰å…³â€œè¡¨æ ¼â€è§„åˆ™çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">habr.com/post/108690</a> <br><br><h2>  ============= OpenVPN ============== </h2><br> æ²¡æœ‰iptablesï¼ŒOpenVPN IPv4æ— æ³•æ­£å¸¸å·¥ä½œã€‚ <br><br> æˆ‘æœ‰ç”¨äºVPNçš„ä»¥ä¸‹iptablesï¼š <br><br><pre> <code class="bash hljs">iptables -A INPUT -p udp -s YY.YY.YY.YY --dport 1194 -j ACCEPT iptables -A FORWARD -i tun0 -o eno1 -j ACCEPT iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eno1 -j SNAT --to-source XX.XX.XX.X0 <span class="hljs-comment"><span class="hljs-comment">##iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eno1 -j MASQUERADE iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT iptables -A INPUT -p udp --dport 1194 -j DROP iptables -A FORWARD -p udp --dport 1194 -j DROP</span></span></code> </pre> <br>  YY.YY.YY.YYæ˜¯æˆ‘åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šçš„é™æ€IPv4åœ°å€ã€‚ <br>  10.8.0.0/24-IPv4 openvpnç½‘ç»œã€‚  openvpnå®¢æˆ·ç«¯çš„IPv4åœ°å€ã€‚ <br> è§„åˆ™çš„é¡ºåºå¾ˆé‡è¦ã€‚ <br><br><pre> <code class="bash hljs">iptables -A INPUT -p udp -s YY.YY.YY.YY --dport 1194 -j ACCEPT iptables -A FORWARD -i tun0 -o eno1 -j ACCEPT ... iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT iptables -A INPUT -p udp --dport 1194 -j DROP iptables -A FORWARD -p udp --dport 1194 -j DROP</code> </pre> <br> è¿™æ˜¯ä¸€ä¸ªé™åˆ¶ï¼Œå› æ­¤åªæœ‰æˆ‘å¯ä»¥ä»æˆ‘çš„é™æ€IPä½¿ç”¨OpenVPNã€‚ <br><br><pre> <code class="bash hljs">iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eno1 -j SNAT --to-source XX.XX.XX.X0 --  -- iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eno1 -j MASQUERADE</code> </pre> <br> è¦åœ¨OpenVPNå®¢æˆ·ç«¯å’ŒInternetä¹‹é—´è½¬å‘IPv4æ•°æ®åŒ…ï¼Œæ‚¨éœ€è¦æ³¨å†Œä»¥ä¸‹å‘½ä»¤ä¹‹ä¸€ã€‚ <br><br> å¯¹äºä¸åŒçš„æƒ…å†µï¼Œå…¶ä¸­ä¸€ç§é€‰é¡¹ä¸åˆé€‚ã€‚ <br> ä¸¤æ”¯çƒé˜Ÿéƒ½é€‚åˆæˆ‘çš„æƒ…å†µã€‚ <br> é˜…è¯»æ–‡æ¡£åï¼Œæˆ‘é€‰æ‹©äº†ç¬¬ä¸€ä¸ªé€‰é¡¹ï¼Œå› ä¸ºå®ƒæ¶ˆè€—çš„CPUæ›´å°‘ã€‚ <br><br> è¿™æ ·ï¼Œæ‰€æœ‰iptablesè®¾ç½®åœ¨é‡æ–°å¯åŠ¨åéƒ½ä¼šè¢«æå–-æ‚¨éœ€è¦å°†å®ƒä»¬ä¿å­˜åœ¨æŸä¸ªåœ°æ–¹ã€‚ <br><br><pre> <code class="bash hljs">iptables-save &gt; /etc/iptables/rules.v4 ip6tables-save &gt; /etc/iptables/rules.v6</code> </pre> <br> è¿™æ ·çš„åå­—å¹¶éå¶ç„¶ã€‚  iptables-persistentåŒ…ä½¿ç”¨å®ƒä»¬ã€‚ <br><br><pre> <code class="bash hljs">apt-get install iptables-persistent</code> </pre> <br> å®‰è£…ä¸»è¦çš„OpenVPNè½¯ä»¶åŒ…ï¼š <br><br><pre> <code class="bash hljs">apt-get install openvpn easy-rsa</code> </pre> <br> è®¾ç½®è¯ä¹¦æ¨¡æ¿ï¼ˆæ›¿æ¢æ‚¨çš„å€¼ï¼‰ï¼š <br><br><pre> <code class="bash hljs">make-cadir ~/openvpn-ca <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/openvpn-ca ln -s openssl-1.0.0.cnf openssl.cnf</code> </pre> <br> è®©æˆ‘ä»¬ç¼–è¾‘è¯ä¹¦æ¨¡æ¿è®¾ç½®ï¼š <br><br><pre> <code class="bash hljs">mcedit vars</code> </pre> <br><pre> <code class="bash hljs">... <span class="hljs-comment"><span class="hljs-comment"># These are the default values for fields # which will be placed in the certificate. # Don't leave any of these fields blank. export KEY_COUNTRY="RU" export KEY_PROVINCE="Krasnodar" export KEY_CITY="Dinskaya" export KEY_ORG="Own" export KEY_EMAIL="admin@domain1.com" export KEY_OU="VPN" # X509 Subject Field export KEY_NAME="server" ...</span></span></code> </pre> <br> åˆ›å»ºæœåŠ¡å™¨è¯ä¹¦ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/openvpn-ca <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> vars ./clean-all ./build-ca ./build-key-server server ./build-dh openvpn --genkey --secret keys/ta.key</code> </pre> <br> æˆ‘ä»¬å°†å‡†å¤‡æœºä¼šåˆ›å»ºç”Ÿæˆçš„â€œ client-name.opvnâ€æ–‡ä»¶ï¼š <br><br><pre> <code class="bash hljs">mkdir -p ~/client-configs/files chmod 700 ~/client-configs/files cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/client-configs/base.conf mcedit ~/client-configs/base.conf</code> </pre> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Client mode client # Interface tunnel type dev tun # TCP protocol proto tcp-client # Address/Port of VPN server remote XX.XX.XX.X0 1194 # Don't bind to local port/address nobind # Don't need to re-read keys and re-create tun at restart persist-key persist-tun # Remote peer must have a signed certificate remote-cert-tls server ns-cert-type server # Enable compression comp-lzo # Custom ns-cert-type server tls-auth ta.key 1 cipher DES-EDE3-CBC</span></span></code> </pre> <br> æˆ‘ä»¬å°†å‡†å¤‡ä¸€ä¸ªè„šæœ¬ï¼Œå°†æ‰€æœ‰æ–‡ä»¶æ‹¼æ¥åˆ°å•ä¸ªopvnæ–‡ä»¶ä¸­ã€‚ <br><br><pre> <code class="bash hljs">mcedit ~/client-configs/make_config.sh chmod 700 ~/client-configs/make_config.sh</code> </pre> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # First argument: Client identifier KEY_DIR=~/openvpn-ca/keys OUTPUT_DIR=~/client-configs/files BASE_CONFIG=~/client-configs/base.conf cat ${BASE_CONFIG} \ &lt;(echo -e '&lt;ca&gt;') \ ${KEY_DIR}/ca.crt \ &lt;(echo -e '&lt;/ca&gt;\n&lt;cert&gt;') \ ${KEY_DIR}/${1}.crt \ &lt;(echo -e '&lt;/cert&gt;\n&lt;key&gt;') \ ${KEY_DIR}/${1}.key \ &lt;(echo -e '&lt;/key&gt;\n&lt;tls-auth&gt;') \ ${KEY_DIR}/ta.key \ &lt;(echo -e '&lt;/tls-auth&gt;') \ &gt; ${OUTPUT_DIR}/${1}.ovpn</span></span></code> </pre> <br> æˆ‘ä»¬åˆ›å»ºç¬¬ä¸€ä¸ªOpenVPNå®¢æˆ·ç«¯ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/openvpn-ca <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> vars ./build-key client-name <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/client-configs ./make_config.sh client-name</code> </pre> <br> æ–‡ä»¶â€œã€œ/ client-configs / files / client-name.ovpnâ€è¢«å‘é€åˆ°å®¢æˆ·ç«¯ã€‚ <br><br> å¯¹äºiOSå®¢æˆ·ç«¯ï¼Œæ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br>  tls-authæ ‡è®°çš„å†…å®¹åº”æ— æ³¨é‡Šã€‚ <br> å¹¶ä¸”è¿˜åº”åœ¨æ ‡ç­¾â€œ tls-authâ€ä¹‹å‰ç´§æ¥ç€æ”¾ç½®â€œ key-direction 1â€ã€‚ <br><br> é…ç½®OpenVPNæœåŠ¡å™¨é…ç½®ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/openvpn-ca/keys cp ca.crt ca.key server.crt server.key ta.key dh2048.pem /etc/openvpn gunzip -c /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz | tee /etc/openvpn/server.conf mcedit /etc/openvpn/server.conf</code> </pre> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Listen port port 1194 # Protocol proto tcp-server # IP tunnel dev tun0 tun-ipv6 push tun-ipv6 # Master certificate ca ca.crt # Server certificate cert server.crt # Server private key key server.key # Diffie-Hellman parameters dh dh2048.pem # Allow clients to communicate with each other client-to-client # Client config dir client-config-dir /etc/openvpn/ccd # Run client-specific script on connection and disconnection script-security 2 client-connect "/usr/bin/sudo -u root /etc/openvpn/server-clientconnect.sh" client-disconnect "/usr/bin/sudo -u root /etc/openvpn/server-clientdisconnect.sh" # Server mode and client subnets server 10.8.0.0 255.255.255.0 server-ipv6 X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:3::/80 topology subnet # IPv6 routes push "route-ipv6 X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">:/64" push "route-ipv6 2000::/3" # DNS (for Windows) # These are OpenDNS push "dhcp-option DNS 208.67.222.222" push "dhcp-option DNS 208.67.220.220" # Configure all clients to redirect their default network gateway through the VPN push "redirect-gateway def1 bypass-dhcp" push "redirect-gateway ipv6" #For iOS # Don't need to re-read keys and re-create tun at restart persist-key persist-tun # Ping every 10s. Timeout of 120s. keepalive 10 120 # Enable compression comp-lzo # User and group user vpn group vpn # Log a short status status openvpn-status.log # Logging verbosity ##verb 4 # Custom config tls-auth ta.key 0 cipher DES-EDE3-CBC</span></span></code> </pre> <br> ä¸ºäº†ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯è®¾ç½®ä¸€ä¸ªé™æ€åœ°å€ï¼Œè¿™æ˜¯å¿…éœ€çš„ï¼ˆä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯æˆ‘ä½¿ç”¨ï¼‰ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Client config dir client-config-dir /etc/openvpn/ccd</span></span></code> </pre> <br> æœ€å›°éš¾å’Œæœ€å…³é”®çš„ç»†èŠ‚ã€‚ <br><br> ä¸å¹¸çš„æ˜¯ï¼ŒOpenVPNå°šä¸èƒ½ä¸ºå®¢æˆ·ç«¯ç‹¬ç«‹é…ç½®IPv6ç½‘å…³ã€‚ <br> æˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªå®¢æˆ·æ‰‹åŠ¨è½¬å‘ã€‚ <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Run client-specific script on connection and disconnection script-security 2 client-connect "/usr/bin/sudo -u root /etc/openvpn/server-clientconnect.sh" client-disconnect "/usr/bin/sudo -u root /etc/openvpn/server-clientdisconnect.sh"</span></span></code> </pre> <br> æ–‡ä»¶â€œ /etc/openvpn/server-clientconnect.shâ€ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # Check client variables if [ -z "$ifconfig_pool_remote_ip" ] || [ -z "$common_name" ]; then echo "Missing environment variable." exit 1 fi # Load server variables . /etc/openvpn/variables ipv6="" # Find out if there is a specific config with fixed IPv6 for this client if [ -f "/etc/openvpn/ccd/$common_name" ]; then # Get fixed IPv6 from client config file ipv6=$(sed -nr 's/^.*ifconfig-ipv6-push[ \t]+([0-9a-fA-F\\:]+).*$/\1/p' "/etc/openvpn/ccd/$common_name") echo $ipv6 fi # Get IPv6 from IPv4 if [ -z "$ipv6" ]; then ipp=$(echo "$ifconfig_pool_remote_ip" | cut -d. -f4) if ! [ "$ipp" -ge 2 -a "$ipp" -le 254 ] 2&gt;/dev/null; then echo "Invalid IPv4 part." exit 1 fi hexipp=$(printf '%x' $ipp) ipv6="$prefix$hexipp" fi # Create proxy rule /sbin/ip -6 neigh add proxy $ipv6 dev eno1</span></span></code> </pre> <br><br> æ–‡ä»¶â€œ /etc/openvpn/server-clientdisconnect.shâ€ï¼š <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # Check client variables if [ -z "$ifconfig_pool_remote_ip" ] || [ -z "$common_name" ]; then echo "Missing environment variable." exit 1 fi # Load server variables . /etc/openvpn/variables ipv6="" # Find out if there is a specific config with fixed IPv6 for this client if [ -f "/etc/openvpn/ccd/$common_name" ]; then # Get fixed IPv6 from client config file ipv6=$(sed -nr 's/^.*ifconfig-ipv6-push[ \t]+([0-9a-fA-F\\:]+).*$/\1/p' "/etc/openvpn/ccd/$common_name") fi # Get IPv6 from IPv4 if [ -z "$ipv6" ]; then ipp=$(echo "$ifconfig_pool_remote_ip" | cut -d. -f4) if ! [ "$ipp" -ge 2 -a "$ipp" -le 254 ] 2&gt;/dev/null; then echo "Invalid IPv4 part." exit 1 fi hexipp=$(printf '%x' $ipp) ipv6="$prefix$hexipp" fi # Delete proxy rule /sbin/ip -6 neigh del proxy $ipv6 dev eno1</span></span></code> </pre> <br> è¿™ä¸¤ä¸ªè„šæœ¬éƒ½ä½¿ç”¨æ–‡ä»¶â€œ / etc / openvpn / variablesâ€ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Subnet prefix=X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">2: # netmask prefixlen=112</span></span></code> </pre> <br> ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œå†™-æˆ‘è§‰å¾—å¾ˆéš¾è®°ä½ã€‚ <br><br> ç°åœ¨çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œnetmask = 112ï¼ˆå³è¾¹åº”è¯¥æ˜¯96ï¼‰ã€‚ <br> å‰ç¼€å¾ˆå¥‡æ€ªï¼Œä¸tun0ç½‘ç»œä¸åŒ¹é…ã€‚ <br> ä½†æ˜¯å¥½å§ï¼Œæˆ‘â€œç…§åŸæ ·â€ä¿ç•™å®ƒã€‚ <br><br><pre> <code class="bash hljs">cipher DES-EDE3-CBC</code> </pre> <br> è¿™æ˜¯ä¸€ä¸ªä¸šä½™çˆ±å¥½è€…-æˆ‘é€‰æ‹©äº†è¿™ç§åŠ å¯†è¿æ¥çš„æ–¹æ³•ã€‚ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ‰å…³è®¾ç½®OpenVPN IPv4çš„æ›´å¤šä¿¡æ¯ã€‚</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ‰å…³è®¾ç½®OpenVPN IPv6çš„æ›´å¤šä¿¡æ¯ã€‚</a> <br><br><h2>  =============åç¼€============== </h2><br> å®‰è£…ä¸»è½¯ä»¶åŒ…ï¼š <br><br><pre> <code class="bash hljs">apt-get install postfix</code> </pre> <br> å®‰è£…æ—¶ï¼Œé€‰æ‹©â€œäº’è”ç½‘ç«™ç‚¹â€ã€‚ <br><br> æˆ‘çš„â€œ /etc/postfix/main.cfâ€çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="bash hljs">smtpd_banner = <span class="hljs-variable"><span class="hljs-variable">$myhostname</span></span> ESMTP <span class="hljs-variable"><span class="hljs-variable">$mail_name</span></span> (Debian/GNU) biff = no <span class="hljs-comment"><span class="hljs-comment"># appending .domain is the MUA's job. append_dot_mydomain = no readme_directory = no # See http://www.postfix.org/COMPATIBILITY_README.html -- default to 2 on # fresh installs. compatibility_level = 2 # TLS parameters smtpd_tls_cert_file=/etc/ssl/domain1.com.2018.chained.crt smtpd_tls_key_file=/etc/ssl/domain1.com.2018.key smtpd_use_tls=yes smtpd_tls_auth_only = yes smtp_bind_address = XX.XX.XX.X0 smtp_bind_address6 = X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">X</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">1:1:1:1 smtp_tls_security_level = may smtp_tls_ciphers = export smtp_tls_protocols = !SSLv2, !SSLv3 smtp_tls_loglevel = 1 smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination myhostname = domain1.com alias_maps = hash:/etc/aliases alias_database = hash:/etc/aliases myorigin = domain1.com mydestination = localhost relayhost = mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 mailbox_size_limit = 0 recipient_delimiter = + inet_interfaces = all inet_protocols = ipv4 internal_mail_filter_classes = bounce # Storage type virtual_transport = lmtp:unix:private/dovecot-lmtp virtual_mailbox_domains = mysql:/etc/postfix/mysql-virtual-mailbox-domains.cf virtual_mailbox_maps = mysql:/etc/postfix/mysql-virtual-mailbox-maps.cf virtual_alias_maps = mysql:/etc/postfix/mysql-virtual-alias-maps.cf # SMTP-Auth settings smtpd_sasl_type = dovecot smtpd_sasl_path = private/auth smtpd_sasl_auth_enable = yes smtpd_recipient_restrictions = permit_sasl_authenticated, permit_mynetworks, #reject_invalid_hostname, #reject_unknown_recipient_domain, reject_unauth_destination, reject_rbl_client sbl.spamhaus.org, check_policy_service unix:private/policyd-spf smtpd_helo_restrictions = #reject_invalid_helo_hostname, #reject_non_fqdn_helo_hostname, reject_unknown_helo_hostname smtpd_client_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_non_fqdn_helo_hostname, permit # SPF policyd-spf_time_limit = 3600 # OpenDKIM milter_default_action = accept milter_protocol = 6 smtpd_milters = unix:var/run/opendkim/opendkim.sock non_smtpd_milters = unix:var/run/opendkim/opendkim.sock # IP address per domain sender_dependent_default_transport_maps = pcre:/etc/postfix/sdd_transport.pcre</span></span></code> </pre> <br> è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹æ­¤é…ç½®çš„è¯¦ç»†ä¿¡æ¯ã€‚ <br><br><pre> <code class="bash hljs">smtpd_tls_cert_file=/etc/ssl/domain1.com.2018.chained.crt smtpd_tls_key_file=/etc/ssl/domain1.com.2018.key</code> </pre> <br><br><hr><blockquote><div class="spoiler">  <b class="spoiler_title">æ ¹æ®å“ˆå¸ƒç½—å¤«æ–¯å…‹å¸‚æ°‘çš„è¯´æ³•ï¼Œæ­¤åŒºå—åŒ…å«â€œé”™è¯¯ä¿¡æ¯å’Œè™šå‡å†…å®¹â€ã€‚</b> <div class="spoiler_text"> åœ¨èŒä¸šç”Ÿæ¶¯å¼€å§‹ä»…8å¹´ä¹‹åï¼Œæˆ‘å°±å¼€å§‹äº†è§£SSLçš„å·¥ä½œåŸç†ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘å°†éšæ„æè¿°å¦‚ä½•ä½¿ç”¨SSLï¼ˆæ— éœ€å›ç­”â€œå®ƒå¦‚ä½•å·¥ä½œï¼Ÿâ€ä»¥åŠâ€œå®ƒä¸ºä»€ä¹ˆå·¥ä½œï¼Ÿâ€çš„é—®é¢˜ï¼‰ã€‚ <br><br> ç°ä»£åŠ å¯†çš„åŸºç¡€æ˜¯åˆ›å»ºå¯†é’¥å¯¹ï¼ˆä¸¤è¡Œå¾ˆé•¿çš„å­—ç¬¦ï¼‰ã€‚ <br><br> ä¸€ä¸ªâ€œå¯†é’¥â€æ˜¯ç§æœ‰çš„ï¼Œå¦ä¸€ä¸ªæ˜¯â€œå…¬å…±â€çš„ã€‚ æˆ‘ä»¬éå¸¸è°¨æ…åœ°å°†ç§é’¥ä¿å¯†ã€‚ æˆ‘ä»¬å°†å…¬é’¥åˆ†å‘ç»™æ¯ä¸ªäººã€‚ <br><br> ä½¿ç”¨å…¬å…±å¯†é’¥ï¼Œæ‚¨å¯ä»¥åŠ å¯†æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œä»¥ä¾¿åªæœ‰ç§æœ‰å¯†é’¥çš„æ‰€æœ‰è€…æ‰èƒ½è§£å¯†ã€‚ <br> å—¯ï¼Œè¿™å°±æ˜¯æŠ€æœ¯çš„å…¨éƒ¨åŸºç¡€ã€‚ <br><br> æ­¥éª¤1-httpsç½‘ç«™ã€‚ <br> è®¿é—®è¯¥ç«™ç‚¹æ—¶ï¼Œæµè§ˆå™¨ä»WebæœåŠ¡å™¨è·æ‚‰è¯¥ç«™ç‚¹ä¸ºhttpsï¼Œå› æ­¤è¯·æ±‚å…¬å…±å¯†é’¥ã€‚ <br>  WebæœåŠ¡å™¨æä¾›å…¬å…±å¯†é’¥ã€‚ æµè§ˆå™¨ä½¿ç”¨å…¬å…±å¯†é’¥åŠ å¯†httpè¯·æ±‚å¹¶å‘é€å®ƒã€‚ <br> åªæœ‰æ‹¥æœ‰ç§é’¥çš„äººï¼ˆå³ï¼Œåªèƒ½å‘å…¶å‘å‡ºå‘¼å«çš„æœåŠ¡å™¨ï¼‰æ‰èƒ½è¯»å–http-requestçš„å†…å®¹ã€‚ <br>  Http-requestè‡³å°‘åŒ…å«ä¸€ä¸ªURIã€‚ å› æ­¤ï¼Œå¦‚æœè¯¥å›½å®¶/åœ°åŒºè¯•å›¾å°†è®¿é—®æƒé™é™åˆ¶ä¸ºä¸é™äºæ•´ä¸ªç½‘ç«™ï¼Œè€Œä¸ä»…é™äºç‰¹å®šé¡µé¢ï¼Œé‚£ä¹ˆå¯¹äºhttpsç½‘ç«™ï¼Œåˆ™æ— æ³•åšåˆ°ã€‚ <br><br> æ­¥éª¤2æ˜¯åŠ å¯†çš„ç­”æ¡ˆã€‚ <br>  WebæœåŠ¡å™¨æä¾›äº†ä¸€ä¸ªæ˜“äºé˜…è¯»çš„ç­”æ¡ˆã€‚ <br> è§£å†³æ–¹æ¡ˆéå¸¸ç®€å•-æµè§ˆå™¨åœ¨æœ¬åœ°ä¸ºæ¯ä¸ªhttpsç«™ç‚¹ç”Ÿæˆç›¸åŒçš„ç§é’¥-å…¬é’¥å¯¹ã€‚ <br> è¿åŒå¯¹ç«™ç‚¹å…¬å…±å¯†é’¥çš„è¯·æ±‚ï¼Œå®ƒå‘é€å…¶æœ¬åœ°å…¬å…±å¯†é’¥ã€‚ <br>  WebæœåŠ¡å™¨ä¼šè®°ä½å®ƒï¼Œå¹¶åœ¨å‘é€httpå“åº”æ—¶ä½¿ç”¨ç‰¹å®šå®¢æˆ·ç«¯çš„æ­¤å…¬å…±å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚ <br> ç°åœ¨ï¼Œhttpå“åº”åªèƒ½ç”±å®¢æˆ·ç«¯æµè§ˆå™¨ç§é’¥çš„æ‰€æœ‰è€…ï¼ˆå³å®¢æˆ·ç«¯æœ¬èº«ï¼‰è§£å¯†ã€‚ <br><br> æ­¥éª¤3-é€šè¿‡å…¬å…±æ¸ é“å»ºç«‹å®‰å…¨è¿æ¥ã€‚ <br> åœ¨ç¤ºä¾‹2ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªæ¼æ´-æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢å¥½å¿ƒäººæ‹¦æˆªHTTPè¯·æ±‚å¹¶ç¼–è¾‘å…¬å…±å¯†é’¥ä¿¡æ¯ã€‚ <br> å› æ­¤ï¼Œä¸­ä»‹å°†çœ‹åˆ°å‡ ä¹æ‰€æœ‰å·²å‘é€å’Œå·²æ¥æ”¶æ¶ˆæ¯çš„å†…å®¹ï¼Œç›´åˆ°é€šä¿¡é€šé“æ›´æ”¹ä¸ºæ­¢ã€‚ <br> è§£å†³è¿™ä¸ªé—®é¢˜éå¸¸ç®€å•-åªéœ€å°†æµè§ˆå™¨çš„å…¬é’¥å‘é€ä¸ºä½¿ç”¨WebæœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†çš„æ¶ˆæ¯å³å¯ã€‚ <br> ç„¶åï¼ŒWebæœåŠ¡å™¨é¦–å…ˆå‘é€è¯¸å¦‚â€œæ‚¨çš„å…¬å…±å¯†é’¥å°±æ˜¯è¿™æ ·â€çš„å“åº”ï¼Œå¹¶ä½¿ç”¨ç›¸åŒçš„å…¬å…±å¯†é’¥å¯¹è¯¥æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ã€‚ <br> æµè§ˆå™¨ä¼šæŸ¥çœ‹ç­”æ¡ˆ-å¦‚æœæ”¶åˆ°æ¶ˆæ¯â€œæ‚¨çš„å…¬é’¥å°±åƒè¿™æ ·â€-é‚£ä¹ˆè¿™100ï¼…ä¿è¯äº†æ­¤é€šä¿¡é€šé“çš„å®‰å…¨ã€‚ <br> æœ‰å¤šå®‰å…¨ï¼Ÿ <br> è¿™æ ·çš„å®‰å…¨é€šä¿¡é€šé“æœ¬èº«çš„åˆ›å»ºä»¥ping * 2é€Ÿåº¦è¿›è¡Œã€‚ ä¾‹å¦‚20msã€‚ <br> æ”»å‡»è€…å¿…é¡»äº‹å…ˆæ‹¥æœ‰åŒæ–¹çš„ç§é’¥ä¹‹ä¸€ã€‚ æˆ–æ‹¿èµ·ç§é’¥å‡ æ¯«ç§’ã€‚ <br> ç ´è§£ä¸€ä¸ªç°ä»£ç§é’¥å°†åœ¨ä¸€å°è¶…çº§è®¡ç®—æœºä¸ŠèŠ±è´¹æ•°åå¹´ã€‚ <br><br> æ­¥éª¤ï¼ƒ4-å…¬å…±å¯†é’¥çš„å…¬å…±æ•°æ®åº“ã€‚ <br> æ˜¾ç„¶ï¼Œåœ¨æ•´ä¸ªæ•…äº‹ä¸­ï¼Œæ”»å‡»è€…æœ‰å¯èƒ½ååœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡é€šé“ä¸Šã€‚ <br> æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æä¾›æœºä¼šï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨æä¾›æœºä¼šã€‚ å¹¶åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šæ¨¡æ‹Ÿä¸€ä¸ªå¯†é’¥å¯¹ã€‚ <br> ç„¶åï¼Œæ”»å‡»è€…å°†çœ‹åˆ°æ‰€æœ‰æµé‡ï¼Œå¹¶å°†èƒ½å¤Ÿâ€œç¼–è¾‘â€æµé‡ã€‚ <br> ä¾‹å¦‚ï¼Œæ›´æ”¹æ±‡æ¬¾åœ°å€æˆ–ä»ç½‘ä¸Šé“¶è¡Œå¤åˆ¶å¯†ç æˆ–é˜»æ­¢â€œä»¤äººåæ„Ÿâ€çš„å†…å®¹ã€‚ <br> ä¸ºäº†å¯¹æŠ—æ­¤ç±»æ”»å‡»è€…ï¼Œä»–ä»¬æå‡ºäº†ä¸€ä¸ªå…¬å…±æ•°æ®åº“ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªhttpsç«™ç‚¹çš„å…¬å…±å¯†é’¥ã€‚ <br> æ¯ä¸ªæµè§ˆå™¨â€œçŸ¥é“â€è¿™äº›æ•°æ®åº“ä¸­å¤§çº¦æœ‰200ä¸ªå­˜åœ¨ã€‚ å®ƒå·²é¢„å®‰è£…åœ¨æ¯ä¸ªæµè§ˆå™¨ä¸­ã€‚ <br> æ¯ä¸ªè¯ä¹¦å‡ç”±å…¬å…±å¯†é’¥å¤‡ä»½â€œçŸ¥è¯†â€ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯èƒ½ä¼ªé€ ä¸æ¯ä¸ªç‰¹å®šè¯ä¹¦é¢å‘æœºæ„çš„è¿æ¥ã€‚ <br><br> ç°åœ¨å¯¹å¦‚ä½•å°†SSLç”¨äºhttpsæœ‰äº†ä¸€ä¸ªç®€å•çš„äº†è§£ã€‚ <br> å¦‚æœæ‚¨åŠ¨åŠ¨è„‘ç­‹ï¼Œå°±ä¼šå‘ç°ç‰¹æ®ŠæœåŠ¡å¦‚ä½•åœ¨æ­¤è®¾è®¡ä¸­é€ æˆè£‚ç—•ã€‚ ä½†è¿™å°†ä½¿ä»–ä»¬ä»˜å‡ºå·¨å¤§çš„åŠªåŠ›ã€‚ <br> ä¸NSAæˆ–CIAç›¸æ¯”è§„æ¨¡è¾ƒå°çš„ç»„ç»‡-å‡ ä¹ä¸å¯èƒ½ç ´è§£ç°æœ‰çš„ä¿æŠ¤çº§åˆ«ï¼Œå³ä½¿å¯¹äºVIPä¹Ÿæ˜¯å¦‚æ­¤ã€‚ <br><br> æˆ‘è¿˜å°†æ·»åŠ æœ‰å…³sshè¿æ¥çš„ä¿¡æ¯ã€‚ æ²¡æœ‰å…¬å…±å¯†é’¥ï¼Œè¯¥æ€ä¹ˆåŠã€‚ è¯¥é—®é¢˜æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ã€‚ <br>  SSHå¯†ç é€‰é¡¹ï¼š <br> åœ¨ç¬¬ä¸€ä¸ªè¿æ¥ä¸­ï¼Œsshå®¢æˆ·ç«¯åº”è­¦å‘Šï¼Œæ­¤å¤„æˆ‘ä»¬æœ‰æ¥è‡ªsshæœåŠ¡å™¨çš„æ–°å…¬é’¥ã€‚ <br> å¹¶é€šè¿‡è¿›ä¸€æ­¥çš„è¿æ¥ï¼Œå¦‚æœå‡ºç°è­¦å‘Šâ€œæ¥è‡ªsshæœåŠ¡å™¨çš„æ–°å…¬å…±å¯†é’¥â€ï¼Œåˆ™è¡¨æ˜å®ƒä»¬æ­£åœ¨å°è¯•å¬æ‚¨çš„å£°éŸ³ã€‚ <br> æˆ–è€…ï¼Œåœ¨æ‚¨ç¬¬ä¸€æ¬¡æ”¶å¬è¿æ¥æ—¶ï¼Œç°åœ¨æ‚¨æ­£åœ¨ä¸æœåŠ¡å™¨è¿›è¡Œå¯¹è¯ï¼Œè€Œæ— éœ€ä¸­ä»‹ã€‚ <br> å®é™…ä¸Šï¼Œç”±äºå®¹æ˜“ï¼Œå¿«é€Ÿä¸”è½»æ¾åœ°å‘ç°çªƒå¬äº‹å®ï¼Œå› æ­¤è¯¥æ”»å‡»ä»…åœ¨ç‰¹å®šæƒ…å†µä¸‹ç”¨äºç‰¹å®šå®¢æˆ·ç«¯ã€‚ <br><br> å…³é”®sshé€‰é¡¹ï¼š <br> æˆ‘ä»¬æ‹¿ä¸€ä¸ªé—ªå­˜é©±åŠ¨å™¨ï¼Œåœ¨ä¸Šé¢ä¸ºsshæœåŠ¡å™¨å†™ä¸€ä¸ªç§é’¥ï¼ˆä¸ºæ­¤æœ‰ä¸€äº›æœ¯è¯­å’Œè®¸å¤šç»†å¾®å·®åˆ«ï¼Œä½†æ˜¯æˆ‘æ­£åœ¨å†™ä¸€ä¸ªæ•™è‚²ç¨‹åºï¼Œè€Œä¸æ˜¯ä½¿ç”¨è¯´æ˜ï¼‰ã€‚ <br> æˆ‘ä»¬å°†å…¬ç”¨å¯†é’¥ä¿ç•™åœ¨sshå®¢æˆ·ç«¯æ‰€åœ¨çš„è®¡ç®—æœºä¸Šï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿå°†å…¶ä¿å¯†ã€‚ <br> æˆ‘ä»¬å°†é—ªå­˜é©±åŠ¨å™¨å¸¦åˆ°æœåŠ¡å™¨ï¼Œæ’å…¥ï¼Œå¤åˆ¶ç§é’¥ï¼Œç„¶ååˆ»å½•é—ªå­˜é©±åŠ¨å™¨å¹¶å°†ç°å°˜æ’’åœ¨é£ä¸­ï¼ˆæˆ–è‡³å°‘å°†å…¶æ ¼å¼åŒ–ä¸ºé›¶ï¼‰ã€‚ <br> å°±æ˜¯è¿™æ ·-å®Œæˆè¿™æ ·çš„æ“ä½œåï¼Œå°†ä¸å¯èƒ½ç ´è§£è¿™æ ·çš„sshè¿æ¥ã€‚ å½“ç„¶ï¼Œåå¤šå¹´æ¥ï¼Œæ‚¨å¯ä»¥åœ¨è¶…çº§è®¡ç®—æœºä¸Šçœ‹åˆ°æµé‡-ä½†è¿™æ˜¯å¦ä¸€å›äº‹ã€‚ <br><br> æˆ‘ä¸ºé¢˜å¤–è¯é“æ­‰ã€‚ <br></div></div></blockquote> å› æ­¤ï¼Œç°åœ¨è¯¥ç†è®ºå·²å¹¿ä¸ºäººçŸ¥ã€‚ æˆ‘å°†å‘Šè¯‰æ‚¨æœ‰å…³åˆ›å»ºsslè¯ä¹¦çš„æµç¨‹ã€‚ <br><br> ä½¿ç”¨â€œ openssl genrsaâ€ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç§é’¥ï¼Œå¹¶ä¸ºå…¬é’¥åˆ›å»ºâ€œç©ºç™½â€ã€‚ <br> æˆ‘ä»¬å°†â€œç©ºç™½â€å‘é€ç»™ç¬¬ä¸‰æ–¹å…¬å¸ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å‘å…¶æ”¯ä»˜äº†å¤§çº¦9ç¾å…ƒçš„æœ€ç®€å•è¯ä¹¦ã€‚ <br><br> åœ¨å‡ ä¸ªå°æ—¶å†…ï¼Œæˆ‘ä»¬ä»è¯¥ç¬¬ä¸‰æ–¹å…¬å¸æ”¶åˆ°äº†æˆ‘ä»¬çš„â€œå…¬é’¥â€å’Œå¦ä¸€ç»„å‡ ä¸ªå…¬é’¥ã€‚ <br><br> ç¬¬ä¸‰æ–¹å…¬å¸ä¸ºä»€ä¹ˆè¦ä¸ºæˆ‘çš„å…¬å¼€å¯†é’¥çš„å‘è¡Œä»˜è´¹ï¼ˆè¿™æ˜¯ä¸€ä¸ªå•ç‹¬çš„å‘è¡Œï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¸äºˆè€ƒè™‘ï¼‰ã€‚ <br><br> ç°åœ¨å¾ˆæ¸…æ¥šé¢˜è¯çš„å«ä¹‰æ˜¯ï¼š <br><br><pre> <code class="plaintext hljs">smtpd_tls_key_file=/etc/ssl/domain1.com.2018.key</code> </pre> <br> åœ¨â€œ / etc / sslâ€æ–‡ä»¶å¤¹ä¸­ï¼Œå­˜å‚¨äº†æœ‰å…³sslé—®é¢˜çš„æ‰€æœ‰æ–‡ä»¶ã€‚ <br>  domain1.com-åŸŸåã€‚ <br>  2018å¹´æ˜¯å¯†é’¥åˆ›å»ºçš„ä¸€å¹´ã€‚ <br>  â€œå¯†é’¥â€-æŒ‡å®šæ–‡ä»¶æ˜¯ç§é’¥ã€‚ <br><br> ä»¥åŠè¿™ä¸ªæ–‡ä»¶çš„å«ä¹‰ï¼š <br><br>  smtpd_tls_cert_file = /etc/ssl/domain1.com.2018.chained.crt <br>  domain1.com-åŸŸåã€‚ <br>  2018å¹´æ˜¯å¯†é’¥åˆ›å»ºçš„ä¸€å¹´ã€‚ <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“¾æ¥çš„-è¡¨ç¤ºæœ‰ä¸€è¿ä¸²çš„å…¬é’¥ï¼ˆç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬çš„å…¬é’¥ï¼Œå…¶ä½™çš„æ˜¯æ¥è‡ªå‘å¸ƒå…¬é’¥çš„å…¬å¸çš„ä¸œè¥¿ï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crt-è¡¨ç¤ºå·²å‡†å¤‡å¥½è¯ä¹¦ï¼ˆå¸¦æœ‰æŠ€æœ¯è¯´æ˜çš„å…¬é’¥ï¼‰ã€‚</font></font><br><br><pre> <code class="bash hljs">smtp_bind_address = XX.XX.XX.X0 smtp_bind_address6 = XXXX:XXXX:XXXX:XXXX:1:1:1:1</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ä¸ä½¿ç”¨æ­¤è®¾ç½®ï¼Œä»…ä½œä¸ºç¤ºä¾‹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› ä¸ºæ­¤å‚æ•°ä¸­çš„é”™è¯¯å°†å¯¼è‡´ä»æœåŠ¡å™¨å‘é€åƒåœ¾é‚®ä»¶ï¼ˆæ²¡æœ‰æ‚¨çš„æ„æ„¿ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åå‘æ‰€æœ‰äººè¯æ˜æ‚¨ä¸åº”è¯¥å—åˆ°è´£å¤‡ã€‚</font></font><br><br><pre> <code class="bash hljs">recipient_delimiter = +</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹Ÿè®¸è®¸å¤šäººä¸çŸ¥é“ï¼Œæ‰€ä»¥è¿™æ˜¯æ”¾ç‰§çš„æ ‡å‡†ç¬¦å·ï¼Œå¤§å¤šæ•°ç°ä»£é‚®ä»¶æœåŠ¡å™¨éƒ½æ”¯æŒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªé‚®ç®±â€œ username@gmail.comâ€ï¼Œè¯·å°è¯•å°†å…¶å‘é€åˆ°â€œ username+spam@gmail.comâ€-çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</font></font><br><br><pre> <code class="bash hljs">inet_protocols = ipv4</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹Ÿè®¸è¿™ä¼šä»¤äººå›°æƒ‘ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†è¿™ä¸ä»…ä»…æ˜¯ã€‚</font><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ–°åŸŸä»…æ˜¯IPv4ï¼Œç„¶åæˆ‘åˆ†åˆ«ä¸ºæ¯ä¸ªåŸŸå¯ç”¨IPv6ã€‚</font></font><br><br><pre> <code class="bash hljs">virtual_transport = lmtp:unix:private/dovecot-lmtp virtual_mailbox_domains = mysql:/etc/postfix/mysql-virtual-mailbox-domains.cf virtual_mailbox_maps = mysql:/etc/postfix/mysql-virtual-mailbox-maps.cf virtual_alias_maps = mysql:/etc/postfix/mysql-virtual-alias-maps.cf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æ‰€æœ‰ä¼ å…¥çš„é‚®ä»¶éƒ½å‘é€åˆ°é¸½èˆã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥åŠåŸŸï¼Œé‚®ç®±ï¼Œåˆ«åçš„è§„åˆ™-æŸ¥æ‰¾æ•°æ®åº“ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/postfix/mysql-virtual-mailbox-domains.cf</font></font><br><br><pre> <code class="bash hljs">user = usermail password = mailpassword hosts = 127.0.0.1 dbname = servermail query = SELECT 1 FROM virtual_domains WHERE name=<span class="hljs-string"><span class="hljs-string">'%s'</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> /etc/postfix/mysql-virtual-mailbox-maps.cf </font></font><br><br><pre> <code class="bash hljs">user = usermail password = mailpassword hosts = 127.0.0.1 dbname = servermail query = SELECT 1 FROM virtual_users WHERE email=<span class="hljs-string"><span class="hljs-string">'%s'</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> /etc/postfix/mysql-virtual-alias-maps.cf </font></font><br><br><pre> <code class="bash hljs">user = usermail password = mailpassword hosts = 127.0.0.1 dbname = servermail query = SELECT destination FROM virtual_aliases WHERE <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>=<span class="hljs-string"><span class="hljs-string">'%s'</span></span></code> </pre> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># SMTP-Auth settings smtpd_sasl_type = dovecot smtpd_sasl_path = private/auth smtpd_sasl_auth_enable = yes</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼ŒpostfixçŸ¥é“æ‚¨åªèƒ½æ¥å—é€šè¿‡dovecotæˆæƒè¿›è¡Œè¿›ä¸€æ­¥å‘é€çš„é‚®ä»¶ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘çœŸçš„ä¸æ˜ç™½ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œé‡å¤äº†è¿™ä¸€ç‚¹ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»åœ¨virtual_transportä¸­æŒ‡å‡ºäº†æ‰€æœ‰éœ€è¦çš„å†…å®¹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯åç¼€ç³»ç»Ÿéå¸¸å¤è€-å¯èƒ½æ˜¯è¿‡å»çš„åŸå ¡ã€‚</font></font><br><br><pre> <code class="bash hljs">smtpd_recipient_restrictions = ... smtpd_helo_restrictions = ... smtpd_client_restrictions = ...</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ¯ä¸ªé‚®ä»¶æœåŠ¡å™¨é…ç½®äº†è‡ªå·±çš„æ–¹å¼ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å¯ä»¥ä½¿ç”¨3å°é‚®ä»¶æœåŠ¡å™¨ï¼Œç”±äºä½¿ç”¨è¦æ±‚ä¸åŒï¼Œè¿™äº›è®¾ç½®ä¹Ÿæœ‰å¾ˆå¤§å·®å¼‚ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨å¿…é¡»ä»”ç»†é…ç½®-å¦åˆ™åƒåœ¾é‚®ä»¶ä¼šæ·¹æ²¡æ‚¨ï¼Œæˆ–æ›´ç³Ÿçš„æ˜¯ï¼Œåƒåœ¾é‚®ä»¶ä¼šæ·¹æ²¡æ‚¨ã€‚</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># SPF policyd-spf_time_limit = 3600</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é…ç½®æŸç§ä¸SPFæ£€æŸ¥ä¼ å…¥æ¶ˆæ¯ç›¸å…³çš„æ’ä»¶ã€‚ </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># OpenDKIM milter_default_action = accept milter_protocol = 6 smtpd_milters = unix:var/run/opendkim/opendkim.sock non_smtpd_milters = unix:var/run/opendkim/opendkim.sock</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é…ç½®æ‰€æœ‰å¤–å‘å­—æ¯ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›DKIMç­¾åã€‚ </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># IP address per domain sender_dependent_default_transport_maps = pcre:/etc/postfix/sdd_transport.pcre</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»phpè„šæœ¬å‘é€ç”µå­é‚®ä»¶æ—¶ï¼Œè¿™æ˜¯ç”µå­é‚®ä»¶è·¯ç”±ä¸­çš„å…³é”®ç»†èŠ‚ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/postfix/sdd_transport.pcreâ€ï¼š</font></font><br><br><pre> <code class="bash hljs">/^www-domain1@domain1\.com$/ domain1: /^www-domain2@domain1\.com$/ domain2: /^www-domain3@domain1\.com$/ domain3: /@domain1\.com$/ domain1: /@domain2\.com$/ domain2: /@domain3\.com$/ domain3:</code> </pre> <br><blockquote>  â€”  .  â€” ,   . <br> Postfix     â€”        . <br><br>     postfix    â€”    Â«master.cfÂ». <br><br>  4, 5, 6 â€”  .       â€”    . <br>     php       Â«fromÂ».      . <br><br>     â€”       nginx+fpm. <br><br>  â€”       linux-user .    fpm-pool. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fpm-poolä½¿ç”¨ä»»ä½•ç‰ˆæœ¬çš„phpï¼ˆåœ¨ç›¸é‚»ç«™ç‚¹çš„åŒä¸€æœåŠ¡å™¨ä¸Šå¯ä»¥ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„phpç”šè‡³ä¸åŒçš„php.iniæ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œç‰¹å®šçš„Linuxç”¨æˆ·â€œ www-domain2â€å…·æœ‰domain2.comç½‘ç«™ã€‚</font><font style="vertical-align: inherit;">è¯¥ç«™ç‚¹æœ‰ä¸€ä¸ªç”¨äºå‘é€ä¿¡ä»¶çš„ä»£ç ï¼Œæ— éœ€æŒ‡å®šâ€œå‘ä»¶äººâ€å­—æ®µã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œå³ä½¿åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™äº›ä¿¡ä»¶ä¹Ÿå°†æ­£ç¡®æ¶ˆå¤±å¹¶ä¸”æ°¸è¿œä¸ä¼šè¿›å…¥åƒåœ¾é‚®ä»¶ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘çš„â€œ /etc/postfix/master.cfâ€çœ‹èµ·æ¥åƒè¿™æ ·ï¼š </font></font><br><br><pre> <code class="bash hljs">... smtp inet n - y - - smtpd -o content_filter=spamassassin ... submission inet n - y - - smtpd -o syslog_name=postfix/submission -o smtpd_tls_security_level=encrypt -o smtpd_sasl_auth_enable=yes -o smtpd_client_restrictions=permit_sasl_authenticated,reject ... policyd-spf unix - nn - 0 spawn user=policyd-spf argv=/usr/bin/policyd-spf spamassassin unix - nn - - pipe user=spamd argv=/usr/bin/spamc -f -e /usr/sbin/sendmail -oi -f <span class="hljs-variable"><span class="hljs-variable">${sender}</span></span> <span class="hljs-variable"><span class="hljs-variable">${recipient}</span></span> ... domain1 unix - - n - - smtp -o smtp_bind_address=XX.XX.XX.X1 -o smtp_helo_name=domain1.com -o inet_protocols=all -o smtp_bind_address6=XXXX:XXXX:XXXX:XXXX:1:1:1:1 -o syslog_name=postfix-domain1 domain2 unix - - n - - smtp -o smtp_bind_address=XX.XX.XX.X5 -o smtp_helo_name=domain2.com -o inet_protocols=all -o smtp_bind_address6=XXXX:XXXX:XXXX:XXXX:1:2:1:1 -o syslog_name=postfix-domain2 domain3 unix - - n - - smtp -o smtp_bind_address=XX.XX.XX.X2 -o smtp_helo_name=domain3 -o inet_protocols=all -o smtp_bind_address6=XXXX:XXXX:XXXX:XXXX:1:1:5:1 -o syslog_name=postfix-domain3</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶æœªå®Œå…¨ç»™å‡º-å®ƒå·²ç»å¾ˆå¤§ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»…è®°å½•å·²æ›´æ”¹çš„å†…å®¹ã€‚</font></font><br><br><pre> <code class="bash hljs">smtp inet n - y - - smtpd -o content_filter=spamassassin ... spamassassin unix - nn - - pipe user=spamd argv=/usr/bin/spamc -f -e /usr/sbin/sendmail -oi -f <span class="hljs-variable"><span class="hljs-variable">${sender}</span></span> <span class="hljs-variable"><span class="hljs-variable">${recipient}</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿™äº›æ˜¯ä¸spamassasinç›¸å…³çš„è®¾ç½®ï¼Œç¨åè¿›è¡Œä»‹ç»ã€‚ </font></font><br><br><pre> <code class="bash hljs">submission inet n - y - - smtpd -o syslog_name=postfix/submission -o smtpd_tls_security_level=encrypt -o smtpd_sasl_auth_enable=yes -o smtpd_client_restrictions=permit_sasl_authenticated,reject</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å…è®¸æ‚¨é€šè¿‡ç«¯å£587è¿æ¥åˆ°é‚®ä»¶æœåŠ¡å™¨ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œè¯·åŠ¡å¿…ç™»å½•ã€‚</font></font><br><br><pre> <code class="bash hljs">policyd-spf unix - nn - 0 spawn user=policyd-spf argv=/usr/bin/policyd-spf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‰“å¼€SPFéªŒè¯ã€‚ </font></font><br><br><pre> <code class="bash hljs">apt-get install postfix-policyd-spf-python</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å®‰è£…ä¸Šè¿°SPFæ£€æŸ¥è½¯ä»¶åŒ…ã€‚ </font></font><br><br><pre> <code class="bash hljs">domain1 unix - - n - - smtp -o smtp_bind_address=XX.XX.XX.X1 -o smtp_helo_name=domain1.com -o inet_protocols=all -o smtp_bind_address6=XXXX:XXXX:XXXX:XXXX:1:1:1:1 -o syslog_name=postfix-domain1</code> </pre> <br><blockquote>    .          IPv4/IPv6 . <br><br>    rDNS. rDNS â€”   -   IP . <br>         ,  helo   rDNS  ,    email. <br><br>  helo    ,      â€”   . <br><br> Helo   rDNS â€”    . <br>        IP . <br>  OVH â€”      rDNS. <br>  tech.ru â€”    . <br>  AWS â€”    . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œ Inet_protocolsâ€å’Œâ€œ smtp_bind_address6â€-è¿™å°±æ˜¯æˆ‘ä»¬å¯ç”¨IPv6æ”¯æŒçš„æ–¹å¼ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹äºIPv6ï¼Œè¿˜éœ€è¦æ³¨å†ŒrDNSã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œ Syslog_nameâ€-è¿™æ˜¯ä¸ºäº†æ–¹ä¾¿é˜…è¯»æ—¥å¿—ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å»ºè®®åœ¨è¿™é‡Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è´­ä¹°è¯ä¹¦</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™é‡Œè®¾ç½®ä¸€å †postfix + dovecot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPFè®¾ç½®ã€‚</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ==============é¸½èˆ=============== </font></font></h2><br><pre> <code class="bash hljs">apt-get install dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-antispam</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é…ç½®mysqlï¼Œè‡ªè¡Œå®‰è£…è½¯ä»¶åŒ…ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/conf.d/10-auth.confâ€</font></font><br><br><pre> <code class="bash hljs">disable_plaintext_auth = yes auth_mechanisms = plain login</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆæƒä»…åŠ å¯†ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/conf.d/10-mail.confâ€</font></font><br><br><pre> <code class="bash hljs">mail_location = maildir:/var/mail/vhosts/%d/%n</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡å‡ºå­—æ¯çš„ä½ç½®ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å¸Œæœ›å°†å®ƒä»¬å­˜å‚¨åœ¨æ–‡ä»¶ä¸­å¹¶æŒ‰åŸŸåˆ†ç»„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/conf.d/10-master.confâ€</font></font><br><br><pre> <code class="bash hljs">service imap-login { inet_listener imap { port = 0 } inet_listener imaps { address = XX.XX.XX.X1, XX.XX.XX.X2, XX.XX.XX.X5, [XXXX:XXXX:XXXX:XXXX:1:1:1:1], [XXXX:XXXX:XXXX:XXXX:1:2:1:1], [XXXX:XXXX:XXXX:XXXX:1:1:5:1] port = 993 ssl = yes } } service pop3-login { inet_listener pop3 { port = 0 } inet_listener pop3s { address = XX.XX.XX.X1, XX.XX.XX.X2, XX.XX.XX.X5, [XXXX:XXXX:XXXX:XXXX:1:1:1:1], [XXXX:XXXX:XXXX:XXXX:1:2:1:1], [XXXX:XXXX:XXXX:XXXX:1:1:5:1] port = 995 ssl = yes } } service lmtp { unix_listener /var/spool/postfix/private/dovecot-lmtp { mode = 0600 user = postfix group = postfix } } service imap { } service pop3 { } service auth { unix_listener auth-userdb { mode = 0600 user = vmail } unix_listener /var/spool/postfix/private/auth { mode = 0666 user = postfix group = postfix } user = dovecot } service auth-worker { user = vmail } service dict { unix_listener dict { } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯ä¸»è¦çš„é¸½èˆè®¾ç½®æ–‡ä»¶ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ–­å¼€ä¸å®‰å…¨çš„è¿æ¥ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å¯ç”¨å®‰å…¨è¿æ¥ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/conf.d/10-ssl.confâ€</font></font><br><br><pre> <code class="bash hljs">ssl = required ssl_cert = &lt;/etc/nginx/ssl/domain1.com.2018.chained.crt ssl_key = &lt;/etc/nginx/ssl/domain1.com.2018.key <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> XX.XX.XX.X5 { ssl_cert = &lt;/etc/nginx/ssl/domain2.com.2018.chained.crt ssl_key = &lt;/etc/nginx/ssl/domain2.com.2018.key }</code> </pre> <br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é…ç½®sslã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æŒ‡å‡ºéœ€è¦sslã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿˜æœ‰è¯ä¹¦æœ¬èº«ã€‚</font><font style="vertical-align: inherit;">ä¸€ä¸ªé‡è¦çš„ç»†èŠ‚æ˜¯â€œæœ¬åœ°â€æŒ‡ä»¤ã€‚</font><font style="vertical-align: inherit;">æŒ‡ç¤ºä½•æ—¶è¿æ¥åˆ°å“ªä¸ªæœ¬åœ°IPv4-è¦ä½¿ç”¨å“ªä¸ªSSLè¯ä¹¦ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæ­¤å¤„æœªé…ç½®IPv6ï¼Œç¨åå°†æ›´æ­£æ­¤é—æ¼ä½œä¸ºçº¿ç¨‹ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XX.XX.XX.X5ï¼ˆåŸŸ2ï¼‰-æ— è¯ä¹¦ã€‚</font><font style="vertical-align: inherit;">è¦è¿æ¥å®¢æˆ·ç«¯ï¼Œå¿…é¡»æŒ‡å®šdomain1.comã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XX.XX.XX.X2ï¼ˆdomain3ï¼‰-æœ‰ä¸€ä¸ªè¯ä¹¦ï¼Œæ‚¨å¯ä»¥æŒ‡å®šdomain1.comæˆ–domain3.comæ¥è¿æ¥å®¢æˆ·ç«¯ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ–‡ä»¶â€œ /etc/dovecot/conf.d/15-lda.confâ€ </font></font><br><br><pre> <code class="bash hljs">protocol lda { mail_plugins = <span class="hljs-variable"><span class="hljs-variable">$mail_plugins</span></span> sieve }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†æ¥å¯¹äºspamassassinæ¥è¯´æ˜¯éœ€è¦çš„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/conf.d/20-imap.confâ€</font></font><br><br><pre> <code class="bash hljs">protocol imap { mail_plugins = <span class="hljs-variable"><span class="hljs-variable">$mail_plugins</span></span> antispam }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€ä¸ªååƒåœ¾é‚®ä»¶æ’ä»¶ã€‚</font><font style="vertical-align: inherit;">ä»Spamæ–‡ä»¶å¤¹è½¬ç§»åˆ°Spamassasinæˆ–ä»Spamæ–‡ä»¶å¤¹è½¬ç§»æ—¶ï¼Œæœ‰å¿…è¦å¯¹spamassasinè¿›è¡ŒåŸ¹è®­ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/conf.d/20-pop3.confâ€</font></font><br><br><pre> <code class="bash hljs">protocol pop3 { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°±æ˜¯è¿™æ ·çš„æ–‡ä»¶ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/conf.d/20-lmtp.confâ€</font></font><br><br><pre> <code class="bash hljs">protocol lmtp { mail_plugins = <span class="hljs-variable"><span class="hljs-variable">$mail_plugins</span></span> sieve postmaster_address = admin@domain1.com }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é…ç½®lmtpã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/conf.d/90-antispam.confâ€</font></font><br><br><pre> <code class="bash hljs">plugin { antispam_backend = pipe antispam_trash = Trash;trash antispam_spam = Junk;Spam;SPAM antispam_pipe_program_spam_arg = --spam antispam_pipe_program_notspam_arg = --ham antispam_pipe_program = /usr/bin/sa-learn antispam_pipe_program_args = --username=%Lu }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»Spamæ–‡ä»¶å¤¹è½¬ç§»åˆ°SpamassasinåŸ¹è®­è®¾ç½®ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/conf.d/90-sieve.confâ€</font></font><br><br><pre> <code class="bash hljs">plugin { sieve = ~/.dovecot.sieve sieve_dir = ~/sieve sieve_after = /var/lib/dovecot/sieve/default.sieve }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡ç¤ºå¦‚ä½•å¤„ç†ä¼ å…¥ç”µå­é‚®ä»¶çš„æ–‡ä»¶ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /var/lib/dovecot/sieve/default.sieveâ€</font></font><br><br><pre> <code class="bash hljs">require [<span class="hljs-string"><span class="hljs-string">"fileinto"</span></span>, <span class="hljs-string"><span class="hljs-string">"mailbox"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> header :contains <span class="hljs-string"><span class="hljs-string">"X-Spam-Flag"</span></span> <span class="hljs-string"><span class="hljs-string">"YES"</span></span> { fileinto :create <span class="hljs-string"><span class="hljs-string">"Spam"</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰å¿…è¦ç¼–è¯‘æ–‡ä»¶ï¼šâ€œ sievec default.sieveâ€ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/conf.d/auth-sql.conf.extâ€</font></font><br><br><pre> <code class="bash hljs">passdb { driver = sql args = /etc/dovecot/dovecot-sql.conf.ext } userdb { driver = static args = uid=vmail gid=vmail home=/var/mail/vhosts/%d/%n }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡å®šç”¨äºæˆæƒçš„sqlæ–‡ä»¶ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶æœ¬èº«æ˜¯ä¸€ç§æˆæƒæ–¹å¼ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/dovecot-sql.conf.extâ€</font></font><br><br><pre> <code class="bash hljs">driver = mysql connect = host=127.0.0.1 dbname=servermail user=usermail password=password default_pass_scheme = SHA512-CRYPT password_query = SELECT email as user, password FROM virtual_users WHERE email=<span class="hljs-string"><span class="hljs-string">'%u'</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™å¯¹åº”äºåç¼€çš„ç›¸åŒè®¾ç½®ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/dovecot/dovecot.confâ€</font></font><br><pre> <code class="bash hljs">protocols = imap lmtp pop3 listen = *, :: dict { } !include conf.d/*.conf !include_try local.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸»è¦é…ç½®æ–‡ä»¶ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡è¦çš„æ˜¯æˆ‘ä»¬åœ¨æ­¤å¤„æŒ‡å®šæ·»åŠ åè®®ã€‚</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ============= SpamAssassin ============== </font></font></h2><br><pre> <code class="bash hljs">apt-get install spamassassin spamc</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å®‰è£…è½¯ä»¶åŒ…ã€‚ </font></font><br><br><pre> <code class="bash hljs">adduser spamd --disabled-login</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä»£è¡¨æ·»åŠ ç”¨æˆ·ã€‚ </font></font><br><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> spamassassin.service</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å¯åŠ¨æ—¶æ‰“å¼€è‡ªåŠ¨ä¸‹è½½spamassassinæœåŠ¡ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ / etc / default / spamassassinâ€ï¼š</font></font><br><br><pre> <code class="bash hljs">CRON=1</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹å¯ç”¨è§„åˆ™è‡ªåŠ¨æ›´æ–°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ä»¶â€œ /etc/spamassassin/local.cfâ€ï¼š</font></font><br><br><pre> <code class="bash hljs">report_safe 0 use_bayes 1 bayes_auto_learn 1 bayes_auto_expire 1 bayes_store_module Mail::SpamAssassin::BayesStore::MySQL bayes_sql_dsn DBI:mysql:sa:localhost:3306 bayes_sql_username sa bayes_sql_password password</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…é¡»åœ¨mysqlä¸­ä½¿ç”¨ç”¨æˆ·â€œ saâ€å’Œå¯†ç â€œ passwordâ€æ¥åˆ›å»ºæ•°æ®åº“â€œ saâ€ï¼ˆç”¨é€‚å½“çš„æ›¿æ¢ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">report_safe-å°†å‘é€ä¸€å°æœ‰å…³åƒåœ¾é‚®ä»¶çš„æŠ¥å‘Šï¼Œè€Œä¸æ˜¯ä¿¡ä»¶ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use_bayesæ˜¯spamassassinæœºå™¨å­¦ä¹ è®¾ç½®ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶ä½™çš„spamassassinè®¾ç½®å·²åœ¨æœ¬æ–‡å‰é¢åº”ç”¨ã€‚</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€èˆ¬è®¾ç½®ä¸ºspamassassin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…³äºå°†æ–°çš„åƒåœ¾é‚®ä»¶å‘é€åˆ°IMAPåƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…³äºä¸€å †ç®€å•çš„Dovecot + SpamAssassin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å»ºè®®åœ¨imapæ–‡ä»¶å¤¹ä¸­ç§»åŠ¨å­—æ¯æ—¶é˜…è¯»æœ‰å…³å­¦ä¹ spamassasinçš„ç†è®ºï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ==============è”ç³»ç¤¾åŒº============== </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä¹Ÿæƒ³å‘ç¤¾åŒºæå‡ºæœ‰å…³å¦‚ä½•æé«˜è½¬å‘ä¿¡ä»¶å®‰å…¨æ€§çš„æƒ³æ³•ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘æ˜¯å¦‚æ­¤æ²‰æµ¸åœ¨é‚®ä»¶ä¸»é¢˜ä¸­ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ ·ç”¨æˆ·å¯ä»¥åœ¨å…¶å®¢æˆ·ç«¯ä¸Šåˆ›å»ºå¯†é’¥å¯¹ï¼ˆå¤–è§‚ï¼Œé›·é¸Ÿï¼Œæµè§ˆå™¨æ’ä»¶ç­‰ï¼‰ã€‚</font><font style="vertical-align: inherit;">å…¬å…±å’Œç§äººã€‚</font><font style="vertical-align: inherit;">å…¬å¼€-å‘é€åˆ°DNSã€‚</font><font style="vertical-align: inherit;">ç§äºº-ä¿å­˜åˆ°å®¢æˆ·ç«¯ã€‚</font><font style="vertical-align: inherit;">é‚®ä»¶æœåŠ¡å™¨å°†èƒ½å¤Ÿä½¿ç”¨å…¬å…±å¯†é’¥å‘é€ç»™ç‰¹å®šçš„æ”¶ä»¶äººã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶ä¸”ä¸ºäº†é˜²æ­¢æ­¤ç±»ç”µå­é‚®ä»¶å‘é€åƒåœ¾é‚®ä»¶ï¼ˆæ˜¯çš„ï¼Œé‚®ä»¶æœåŠ¡å™¨å°†æ— æ³•çœ‹åˆ°å†…å®¹ï¼‰-æœ‰å¿…è¦å¼•å…¥3æ¡è§„åˆ™ï¼š</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¼ºåˆ¶æ€§çœŸå®DKIMç­¾åï¼Œå¼ºåˆ¶æ€§SPFï¼Œå¼ºåˆ¶æ€§rDNSã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å®¢æˆ·ç«¯ä¸Šæœ‰å…³ååƒåœ¾é‚®ä»¶åŸ¹è®­+ DBçš„ç¥ç»ç½‘ç»œã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åŠ å¯†ç®—æ³•åº”ç¡®ä¿å‘é€æ–¹åœ¨åŠ å¯†ä¸ŠèŠ±è´¹çš„CPUèƒ½åŠ›æ¯”æ¥æ”¶æ–¹å¤š100å€ã€‚ </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™¤äº†å…¬å¼€ä¿¡-åˆ¶å®šæ ‡å‡†çš„é‚€è¯·å‡½â€œå¼€å§‹è¿›è¡Œå®‰å…¨é€šä¿¡â€ã€‚</font><font style="vertical-align: inherit;">ä¸€ä¸ªç”¨æˆ·ï¼ˆé‚®ç®±ï¼‰å°†ä¸€å°å¸¦æœ‰é™„ä»¶çš„ä¿¡å‘é€åˆ°å¦ä¸€ä¸ªé‚®ç®±ã€‚</font><font style="vertical-align: inherit;">åœ¨ä¿¡å‡½ä¸­ï¼Œå»ºè®®ä»¥æ–‡æœ¬å½¢å¼å¯åŠ¨å®‰å…¨çš„é€šä¿¡é€šé“ï¼Œä»¥è¿›è¡Œé€šä¿¡å’Œé‚®ç®±æ‰€æœ‰è€…çš„å…¬é’¥ï¼ˆåœ¨å®¢æˆ·ç«¯å…·æœ‰ç§é’¥ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨ç”šè‡³å¯ä»¥ä¸ºæ¯ä¸ªå¯¹åº”å…³ç³»ä¸“é—¨åˆ¶ä½œä¸€å¯¹é”®ã€‚æ¥æ”¶è€…ç”¨æˆ·å¯ä»¥æ¥å—æ­¤è¦çº¦å¹¶å‘é€å…¶å…¬å…±å¯†é’¥ï¼ˆä¹Ÿä¸“é—¨ä¸ºæ­¤é€šä¿¡è€Œåˆ¶æˆï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œç¬¬ä¸€ç”¨æˆ·å‘é€æœåŠ¡æ§åˆ¶ä¿¡ä»¶ï¼ˆç”¨ç¬¬äºŒç”¨æˆ·çš„å…¬å…±å¯†é’¥åŠ å¯†ï¼‰-æ”¶åˆ°ç¬¬äºŒç”¨æˆ·å¯ä»¥è®¤ä¸ºæ‰€å½¢æˆçš„é€šä¿¡ä¿¡é“å¯é çš„æœåŠ¡æ§åˆ¶ä¿¡ä»¶ã€‚ç„¶åï¼Œç¬¬äºŒä¸ªç”¨æˆ·å‘é€ä¸€ä¸ªæ§åˆ¶å­—æ¯-ç„¶åï¼Œç¬¬ä¸€ä¸ªç”¨æˆ·ä¹Ÿå¯ä»¥å°†æ‰€å½¢æˆçš„é¢‘é“è§†ä¸ºå—ä¿æŠ¤çš„é¢‘é“ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†é˜²æ­¢é“è·¯ä¸Šçš„é’¥åŒ™è¢«çªƒå¬ï¼Œåœ¨åè®®ä¸­å¿…é¡»æä¾›ä½¿ç”¨é—ªå­˜é©±åŠ¨å™¨ä¼ è¾“è‡³å°‘ä¸€ä¸ªå…¬å…±é’¥åŒ™çš„å¯èƒ½æ€§ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€é‡è¦çš„æ˜¯ï¼Œè¿™ä¸€åˆ‡éƒ½èµ·ä½œç”¨ï¼ˆé—®é¢˜æ˜¯â€œè°æ¥ä¸ºæ­¤ä»˜è´¹ï¼Ÿâ€ï¼‰ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨å‡ºä»·å€¼10ç¾å…ƒçš„é‚®ä»¶è¯ä¹¦ï¼ŒæœŸé™ä¸º3å¹´ã€‚</font><font style="vertical-align: inherit;">è¿™å°†ä½¿å‘ä»¶äººåœ¨dnsä¸­æŒ‡ç¤ºâ€œæˆ‘çš„å…¬é’¥åœ¨é‚£é‡Œâ€ã€‚</font><font style="vertical-align: inherit;">ä»–ä»¬å°†æä¾›æœºä¼šå¼€å§‹å®‰å…¨è¿æ¥ã€‚</font><font style="vertical-align: inherit;">åŒæ—¶ï¼Œå…è´¹æœç”¨æ­¤ç±»åŒ–åˆç‰©ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gmailæœ€ç»ˆé€šè¿‡å…¶ç”¨æˆ·è·åˆ©ã€‚</font><font style="vertical-align: inherit;">3å¹´å†…ï¼Œåªéœ€10ç¾å…ƒï¼Œå³å¯åˆ›å»ºå®‰å…¨çš„é€šè®¯æ¸ é“ã€‚</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =============ç»“è®º============= </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æµ‹è¯•æ•´ç¯‡æ–‡ç« ï¼Œæˆ‘æ‰“ç®—ç§Ÿç”¨ä¸€ä¸ªä¸“ç”¨æœåŠ¡å™¨ä¸€ä¸ªæœˆï¼Œç„¶åè´­ä¹°å¸¦æœ‰sslè¯ä¹¦çš„åŸŸã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ç”Ÿæ´»æ¡ä»¶å‘å±•äº†ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜æ‹–äº†ä¸¤ä¸ªæœˆã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“ç©ºé—²æ—¶é—´å†æ¬¡å‡ºç°æ—¶-æˆ‘å†³å®šæŒ‰åŸæ ·å‘å¸ƒè¯¥æ–‡ç« ï¼Œè€Œä¸å¿…å†’é™©å°†å‘å¸ƒæ¨è¿Ÿä¸€å¹´ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæœ‰å¾ˆå¤šç±»ä¼¼â€œä½†æ˜¯æ²¡æœ‰è¶³å¤Ÿè¯¦ç»†åœ°æè¿°â€çš„é—®é¢˜-é‚£ä¹ˆå¯èƒ½ä¼šè¿«ä½¿é‡‡ç”¨å¸¦æœ‰æ–°åŸŸå’Œæ–°SSLè¯ä¹¦çš„ä¸“ç”¨æœåŠ¡å™¨å¹¶è¿›è¡Œæ›´è¯¦ç»†åœ°æè¿°ï¼Œæœ€é‡è¦çš„æ˜¯-ç¡®å®šæ‰€æœ‰ç¼ºå°‘çš„é‡è¦ç»†èŠ‚ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä¹Ÿå¸Œæœ›æ”¶åˆ°æœ‰å…³é‚®ä»¶è¯ä¹¦çš„æƒ³æ³•çš„åé¦ˆã€‚å¦‚æœæ‚¨å–œæ¬¢è¿™ä¸ªä¸»æ„ï¼Œæˆ‘å°†å°½åŠ›ä¸ºRFCæ’°å†™è‰æ¡ˆã€‚</font></font><br><br> <b>     â€”     . <br>       â€”     . <br>           .</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN413689/">https://habr.com/ru/post/zh-CN413689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN413675/index.html">å°ä¸‘2018ï¼šåŒ¿åJavaå¼€å‘äººå‘˜ä¿±ä¹éƒ¨</a></li>
<li><a href="../zh-CN413677/index.html">ROSåœ¨EduMIPè‡ªå¹³è¡¡æœºå™¨äººä¸Šå¯åŠ¨</a></li>
<li><a href="../zh-CN413679/index.html">è§’åº¦6ã€‚ PWAã€‚ å»¶è¿ŸåŠ è½½æ¨¡å—ã€‚ åœ¨Firebaseä¸­è‡ªåŠ¨éƒ¨ç½²</a></li>
<li><a href="../zh-CN413681/index.html">åœ¨Goä¸Šå¼€å‘é«˜åº¦å¯é çš„æœåŠ¡å™¨çš„æŠ€æœ¯</a></li>
<li><a href="../zh-CN413683/index.html">ILVå·²è§£é”700ä¸‡ä¸ªIPåœ°å€ã€‚ ä¿æŒé”å®š400ä¸‡</a></li>
<li><a href="../zh-CN413691/index.html">å¼€å§‹</a></li>
<li><a href="../zh-CN413693/index.html">æ‰‹å·¥åˆ¶ä½œï¼šå¯è‡ªè¡Œå®Œæˆç½‘ä¸Šäº¤æ˜“çš„å¯ç¼–ç¨‹é”®ç›˜</a></li>
<li><a href="../zh-CN413695/index.html">Messengerå®‰å…¨æ€§ï¼šä¸ºä»€ä¹ˆå°†æ¶ˆæ¯å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šå¯èƒ½æ˜¯ä¸€ä¸ªå¥½ä¸»æ„</a></li>
<li><a href="../zh-CN413697/index.html">å¦‚ä½•ä¸å†™ä»£ç </a></li>
<li><a href="../zh-CN413699/index.html">â€œè°æ…åŠ¨æ°´-2â€ï¼šæˆ–è€…æ‚¨æƒ³çŸ¥é“çš„æœ‰å…³åæ¸—é€çš„æ‰€æœ‰ä¿¡æ¯</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>