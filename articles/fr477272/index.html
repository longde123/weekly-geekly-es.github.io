<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïï ‚ö∞Ô∏è ‚öóÔ∏è Premi√®re introduction √† AssemblyScript üïü üî∂ ‚òÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La prise en charge de la technologie WebAssembly (Wasm) est apparue relativement r√©cemment dans les navigateurs. Mais cette technologie peut bien √©ten...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Premi√®re introduction √† AssemblyScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/477272/">  La prise en charge de la technologie <a href="https://webassembly.org/">WebAssembly</a> (Wasm) est apparue relativement r√©cemment dans les navigateurs.  Mais cette technologie peut bien √©tendre les capacit√©s du Web, ce qui en fait une plate-forme capable de prendre en charge de telles applications qui sont g√©n√©ralement per√ßues comme des ordinateurs de bureau. <br><br>  La ma√Ætrise de WebAssembly peut √™tre une t√¢che intimidante pour les d√©veloppeurs Web.  Cependant, le compilateur <a href="https://assemblyscript.org/">AssemblyScript</a> peut am√©liorer la situation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pw/p4/91/pwp491ryabgnwblabon5slwooey.jpeg"></div><br>  L'auteur de l'article, dont nous publions la traduction aujourd'hui, propose d'abord de expliquer pourquoi WebAssembly est une technologie tr√®s prometteuse, puis de voir comment AssemblyScript peut aider √† lib√©rer le potentiel de Wasm. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Webassembly</font> </h2><br>  WebAssembly peut √™tre appel√© une langue de bas niveau pour les navigateurs.  Il donne aux d√©veloppeurs la possibilit√© de cr√©er du code qui se compile en autre chose que JavaScript.  Cela permet aux programmes inclus dans les pages Web de fonctionner presque aussi rapidement que les applications natives pour diverses plates-formes.  Ces programmes s'ex√©cutent dans un environnement limit√© et s√©curis√©. <br><br>  Des repr√©sentants des √©quipes responsables du d√©veloppement de tous les principaux navigateurs (Chrome, Firefox, Safari et Edge) ont √©t√© impliqu√©s dans la cr√©ation de la norme WebAssembly.  Ils se sont mis d'accord sur une <a href="https://lists.w3.org/Archives/Public/public-webassembly/2017Feb/0002.html">architecture</a> syst√®me d√©but 2017.  D√©sormais, tous les navigateurs ci-dessus prennent en charge WebAssembly.  En fait, cette technologie peut √™tre utilis√©e dans <a href="https://caniuse.com/">environ 87% des</a> navigateurs. <br><br>  Le code WebAssembly existe au format binaire.  Cela signifie qu'un tel code est plus petit qu'un code JavaScript similaire et se charge plus rapidement.  De plus, le code Wasm peut √™tre pr√©sent√© au <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format">format texte</a> , afin que les gens puissent le lire et le modifier. <br><br>  Lorsque la norme WebAssembly est apparue pour la premi√®re fois, certains d√©veloppeurs pensaient qu'elle pourrait bien remplacer JavaScript et devenir la langue principale du Web.  Mais WebAssembly est mieux vu comme un nouvel outil qui s'int√®gre bien avec la plate-forme Web existante.  C'est l'un de ses <a href="https://webassembly.org/docs/high-level-goals/">objectifs prioritaires</a> . <br><br>  Au lieu de remplacer JavaScript l√† o√π ce langage a √©t√© utilis√© pendant longtemps et avec succ√®s, WebAssembly offre de nouvelles opportunit√©s int√©ressantes pour les d√©veloppeurs Web.  Certes, le code Wasm n'a pas d'acc√®s direct au DOM, donc la plupart des projets Web existants continueront √† utiliser JavaScript.  Ce langage, au fil des ann√©es de d√©veloppement et d'optimisation, est d√©j√† assez rapide.  Et WebAssembly a ses propres <a href="https://webassembly.org/docs/use-cases/">applications</a> : <br><br><ul><li>  Jeux </li><li>  Calculs scientifiques, visualisations, simulations. </li><li>  Applications CAO. </li><li>  √âdition d'images et de vid√©os. </li></ul><br>  Toutes ces utilisations de Wasm sont li√©es par ce que leurs applications respectives sont g√©n√©ralement consid√©r√©es comme des ordinateurs de bureau.  Mais du fait que WebAssembly vous permet d'atteindre un niveau de performance proche du natif, de nombreuses applications similaires peuvent d√©sormais √™tre impl√©ment√©es √† l'aide de la plateforme Web. <br><br>  WebAssembly peut tirer parti des projets Web existants.  Un exemple est le projet <a href="https://www.figma.com/">Figma</a> .  Gr√¢ce √† l'utilisation de Wasm, le temps de chargement de ce projet a √©t√© consid√©rablement am√©lior√©.  Si un site Web utilise un code qui effectue des calculs lourds, alors, afin d'am√©liorer les performances de ce site Web, il est logique de remplacer uniquement ce code par un analogue de WebAssembly. <br><br>  Vous voudrez peut-√™tre essayer d'utiliser WebAssembly dans vos propres projets.  Cette langue peut √™tre apprise et √©crite <a href="https://blog.scottlogic.com/2018/04/26/webassembly-by-hand.html">imm√©diatement dessus</a> .  Mais, n√©anmoins, WebAssembly a √©t√© initialement d√©velopp√© comme <a href="https://github.com/appcypher/awesome-wasm-langs">cible de compilation</a> pour d'autres langues.  Il a √©t√© <a href="https://webassembly.org/docs/c-and-c%2B%2B/">con√ßu</a> avec un bon support pour C et C ++.  Le <a href="">support exp√©rimental de</a> Wasm est apparu dans Go 1.11.  Beaucoup d'efforts sont d√©ploy√©s pour √©crire des applications Wasm dans <a href="https://www.rust-lang.org/what/wasm">Rust</a> . <br><br>  Mais il est tout √† fait possible que les d√©veloppeurs Web ne veuillent pas apprendre le C, C ++, Go ou Rust uniquement pour utiliser WebAssembly.  Que font-ils?  La r√©ponse √† cette question peut donner AssemblyScript. <br><br><h2>  <font color="#3AC1EF">AssemblyScript</font> </h2><br>  AssemblyScript est un compilateur qui convertit le code TypeScript en code WebAssembly.  TypeScript est un langage d√©velopp√© par Microsoft.  Il s'agit d'un sur-ensemble de JavaScript, avec une prise en charge am√©lior√©e des types et d'autres fonctionnalit√©s.  TypeScript est devenu un langage assez <a href="https://insights.stackoverflow.com/survey/2019">populaire</a> .  Il convient de noter que AssemblyScript ne peut convertir en Wasm qu'un ensemble limit√© de constructions TypeScript.  Cela signifie que m√™me quelqu'un qui n'est pas familier avec TypeScript peut rapidement apprendre ce langage √† un niveau suffisant pour √©crire du code que AssemblyScript comprend. <br><br>  De plus, √©tant donn√© que TypeScript est tr√®s similaire √† JavaScript, nous pouvons dire que la technologie AssemblyScript permet aux d√©veloppeurs Web d'int√©grer facilement des modules Wasm dans leurs projets sans avoir besoin d'apprendre un tout nouveau langage. <br><br><h2>  <font color="#3AC1EF">Exemple</font> </h2><br>  √âcrivons notre premier module AssemblyScript.  Tout le code dont nous allons discuter maintenant se trouve sur <a href="https://github.com/dguo/assemblyscript-demo">GitHub</a> .  Pour <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly">prendre en charge</a> WebAssembly, nous avons besoin d'au moins <a href="https://nodejs.org/">Node.js</a> 8. <br><br>  Cr√©ez un nouveau r√©pertoire, initialisez le projet npm et installez AssemblyScript: <br><br><pre><code class="javascript hljs">mkdir assemblyscript-demo cd assemblyscript-demo npm init npm install --save-dev github:AssemblyScript/assemblyscript</code> </pre> <br>  Notez que AssemblyScript doit √™tre install√© directement √† partir <a href="https://github.com/AssemblyScript/assemblyscript">du r√©f√©rentiel GitHub</a> du projet.  AssemblyScript n'a pas encore √©t√© publi√© dans npm, car les d√©veloppeurs <a href="https://github.com/AssemblyScript/assemblyscript/issues/442">ne le consid√®rent pas encore</a> pr√™t pour une utilisation g√©n√©ralis√©e. <br><br>  Nous allons cr√©er des fichiers auxiliaires en utilisant la commande <code>asinit</code> incluse dans AssemblyScript: <br><br><pre> <code class="javascript hljs">npx asinit .</code> </pre> <br>  La section <code>scripts</code> de notre <code>package.json</code> devrait maintenant prendre la forme suivante: <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>  } }</code> </pre> <br>  Le fichier <code>index.js</code> situ√© dans le dossier racine du projet ressemblera √† ceci: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"fs"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> compiled = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Module(fs.readFileSync(__dirname + <span class="hljs-string"><span class="hljs-string">"/build/optimized.wasm"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imports = {  <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {    abort(_msg, _file, line, column) {       <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);    }  } }; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>, <span class="hljs-string"><span class="hljs-string">"exports"</span></span>, {  <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebAssembly.Instance(compiled, imports).exports });</code> </pre> <br>  Cela vous permet d'inclure des modules WebAssembly dans votre code √† l'aide de la commande <a href="https://nodejs.org/api/modules.html">require</a> .  C'est-√†-dire de la m√™me mani√®re que les modules JavaScript normaux sont connect√©s. <br><br>  Le dossier d' <code>assembly</code> contient le fichier <code>index.ts</code> .  Il a du code source √©crit conform√©ment aux r√®gles AssemblyScript.  Le code passe-partout g√©n√©r√© automatiquement est une fonction simple pour ajouter deux nombres: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a: i32, b: i32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i32</span></span></span><span class="hljs-function"> </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; }</code> </pre> <br>  Peut-√™tre vous attendiez-vous √† ce que la signature d'une fonction similaire ressemble √† <code>add(a: number, b: number): number</code> .  Il semblerait donc qu'il soit √©crit en TypeScript ordinaire.  Mais ici, au lieu du type <code>number</code> , le type <code>i32</code> est <code>i32</code> .  Cela se produit car le code AssemblyScript utilise des <a href="https://docs.assemblyscript.org/basics/types">types WebAssembly</a> sp√©cifiques pour les entiers et les nombres √† virgule flottante, plut√¥t que le type de <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html">nombre</a> g√©n√©rique de TypeScript. <br><br>  Assemblons le projet: <br><br><pre> <code class="javascript hljs">npm run asbuild</code> </pre> <br>  Les fichiers suivants doivent appara√Ætre dans le dossier de <code>build</code> : <br><br><pre> <code class="javascript hljs">optimized.wasm optimized.wasm.map optimized.wat untouched.wasm untouched.wasm.map untouched.wat</code> </pre> <br>  Il existe des versions optimis√©es et r√©guli√®res de l'assemblage.  Chaque version de l'assembly nous donne un fichier .wasm binaire, une <a href="https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map">carte map</a> .wasm.map et une repr√©sentation textuelle du code binaire dans un fichier .wat.  La pr√©sentation de test du code Wasm est destin√©e au programmeur, mais nous ne regarderons m√™me pas ce fichier.  En fait, l'une des raisons de l'utilisation de AssemblyScript est qu'il √©limine le besoin de travailler avec du code Wasm. <br><br>  Maintenant, ex√©cutons Node.js en mode REPL et assurez-vous que le module Wasm compil√© peut √™tre utilis√© de la m√™me mani√®re que n'importe quel module JS normal: <br><br><pre> <code class="javascript hljs">$ node Welcome to Node.js v12<span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>. Type <span class="hljs-string"><span class="hljs-string">".help"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information. &gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).add; <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt; add(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span></code> </pre> <br>  En g√©n√©ral, c'est tout ce qui est n√©cessaire pour utiliser la technologie WebAssembly dans Node.js. <br><br><h2>  <font color="#3AC1EF">√âquiper un projet avec un script d'observateur</font> </h2><br>  Afin de reconstruire automatiquement le module pendant le d√©veloppement lorsque vous y apportez des modifications, je recommande d'utiliser le package <a href="https://github.com/Qard/onchange">onchange</a> .  Le fait est que AssemblyScript <a href="https://github.com/AssemblyScript/assemblyscript/issues/624">n'a pas encore</a> son propre syst√®me de surveillance des modifications de fichiers.  Installez le package onchange: <br><br><pre> <code class="javascript hljs">npm install --save-dev onchange</code> </pre> <br>  Ajoutez le <code>asbuild:watch</code> √† <code>package.json</code> .  <a href="https://github.com/Qard/onchange">L'indicateur</a> <code>-i</code> <a href="https://github.com/Qard/onchange">est</a> inclus dans la commande afin que le processus de g√©n√©ration d√©marre une fois lorsque le script est appel√©, avant qu'aucun √©v√©nement ne se produise. <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"asbuild:untouched"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/untouched.wasm -t build/untouched.wat --sourceMap --validate --debug"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:optimized"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc assembly/index.ts -b build/optimized.wasm -t build/optimized.wat --sourceMap --validate --optimize"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run asbuild:untouched &amp;&amp; npm run asbuild:optimized"</span></span>,    <span class="hljs-string"><span class="hljs-string">"asbuild:watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange -i 'assembly/**/*' -- npm run asbuild"</span></span>  } }</code> </pre> <br>  Maintenant, au lieu d'ex√©cuter constamment la commande <code>asbuild</code> , ex√©cutez simplement <code>asbuild:watch</code> une fois. <br><br><h2>  <font color="#3AC1EF">Performances</font> </h2><br>  Nous allons √©crire un test simple qui √©valuera le niveau de performance du code Wasm.  Le principal objectif de WebAssembly est de r√©soudre des t√¢ches qui utilisent intensivement le processeur.  Par exemple, ce sont des calculs ¬´lourds¬ª.  Cr√©ons une fonction qui d√©couvre si un certain nombre est premier. <br><br>  L'impl√©mentation JS de base d'une fonction similaire est illustr√©e ci-dessous.  Il est arrang√© tr√®s simplement, il v√©rifie le nombre par force brute, mais pour nos fins il convient, car il effectue de grandes quantit√©s de calculs. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Une fonction similaire, √©crite pour le compilateur AssemblyScript, a presque la m√™me apparence.  La principale diff√©rence est la pr√©sence d'annotations de type dans le code: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x: u32</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;    }    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i: u32 = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Pour analyser les performances du code, nous utiliserons le package <a href="https://benchmarkjs.com/">Benchmark.js</a> .  Installez-le: <br><br><pre> <code class="javascript hljs">npm install --save-dev benchmark</code> </pre> <br>  Cr√©ez le fichier <code>benchmark.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Benchmark = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'benchmark'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> assemblyScriptIsPrime = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index'</span></span>).isPrime; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPrime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; x; i++) {        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x % i === <span class="hljs-number"><span class="hljs-number">0</span></span>) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;        }    }    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> suite = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Benchmark.Suite; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> startNumber = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stopNumber = <span class="hljs-number"><span class="hljs-number">10000</span></span>; suite.add(<span class="hljs-string"><span class="hljs-string">'AssemblyScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        assemblyScriptIsPrime(i);    } }).add(<span class="hljs-string"><span class="hljs-string">'JavaScript isPrime'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = startNumber; i &lt; stopNumber; i++) {        isPrime(i);    } }).on(<span class="hljs-string"><span class="hljs-string">'cycle'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(event.target)); }).on(<span class="hljs-string"><span class="hljs-string">'complete'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fastest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'fastest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> slowest = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filter(<span class="hljs-string"><span class="hljs-string">'slowest'</span></span>);    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> difference = (fastest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) - slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>)) / slowest.map(<span class="hljs-string"><span class="hljs-string">'hz'</span></span>) * <span class="hljs-number"><span class="hljs-number">100</span></span>;    <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fastest.map(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'name'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string"> is ~</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${difference.toFixed(</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">% faster.`</span></span>); }).run();</code> </pre> <br>  Voici ce que j'ai r√©ussi √† obtenir apr√®s avoir ex√©cut√© la commande de <code>node benchmark</code> sur mon ordinateur: <br><br><pre> <code class="javascript hljs">AssemblyScript isPrime x <span class="hljs-number"><span class="hljs-number">74.00</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">0.43</span></span>% (<span class="hljs-number"><span class="hljs-number">76</span></span> runs sampled) JavaScript isPrime x <span class="hljs-number"><span class="hljs-number">61.56</span></span> ops/sec ¬±<span class="hljs-number"><span class="hljs-number">0.30</span></span>% (<span class="hljs-number"><span class="hljs-number">64</span></span> runs sampled) AssemblyScript isPrime is ~<span class="hljs-number"><span class="hljs-number">20.2</span></span>% faster.</code> </pre> <br>  Comme vous pouvez le voir, l'impl√©mentation AssemblyScript de l'algorithme √©tait 20% plus rapide que l'impl√©mentation JS.  Cependant, notez que ce test est une <a href="https://stackoverflow.com/a/2842707/1481479">microbenchmark</a> .  Ne vous fiez pas trop √† ses r√©sultats. <br><br>  Afin de trouver des r√©sultats plus fiables de la recherche de performances des projets AssemblyScript - je recommande de jeter un ≈ìil √† <a href="https://wasmboy.app/benchmark/">ceci</a> et √† <a href="https://jtiscione.github.io/webassembly-wave/index.html">ces</a> benchmarks. <br><br><h2>  <font color="#3AC1EF">Utilisation d'un module Wasm sur une page Web</font> </h2><br>  Utilisons notre module Wasm sur une page Web.  Nous commen√ßons par cr√©er un fichier <code>index.html</code> avec le contenu suivant: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt;    &lt;head&gt;        &lt;meta charset="utf-8" /&gt;        &lt;title&gt;AssemblyScript isPrime demo&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;form id="prime-checker"&gt;            &lt;label for="number"&gt;Enter a number to check if it is prime:&lt;/label&gt;            &lt;input name="number" type="number" /&gt;            &lt;button type="submit"&gt;Submit&lt;/button&gt;        &lt;/form&gt;        &lt;p id="result"&gt;&lt;/p&gt;        &lt;script src="demo.js"&gt;&lt;/script&gt;    &lt;/body&gt; &lt;/html&gt;</code> </pre> <br>  Cr√©ez maintenant le fichier <code>demo.js</code> dont le code est illustr√© ci-dessous.  Il existe de <a href="https://developers.google.com/web/updates/2018/04/loading-wasm">nombreuses fa√ßons de</a> charger des modules WebAssembly.  Le plus efficace est de les compiler et de les initialiser en mode streaming √† l'aide de la fonction <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiateStreaming">WebAssembly.instantiateStreaming</a> .  Veuillez noter que nous devrons red√©finir la fonction d' <a href="https://docs.assemblyscript.org/details/debugging">abandon</a> , qui est appel√©e si une <a href="https://docs.assemblyscript.org/basics/environment">instruction n'est</a> pas ex√©cut√©e. <br><br><pre> <code class="javascript hljs">(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; {    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> importObject = {        <span class="hljs-attr"><span class="hljs-attr">env</span></span>: {            abort(_msg, _file, line, column) {                <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-string"><span class="hljs-string">"abort called at index.ts:"</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + column);            }        }    };    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> WebAssembly.instantiateStreaming(        fetch(<span class="hljs-string"><span class="hljs-string">"build/optimized.wasm"</span></span>),        importObject    );    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isPrime = <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.instance.exports.isPrime;    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#result"</span></span>);    <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#prime-checker"</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">"submit"</span></span>, event =&gt; {        event.preventDefault();        result.innerText = <span class="hljs-string"><span class="hljs-string">""</span></span>;        <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> number = event.target.elements.number.value;        result.innerText = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${number}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${isPrime(number) ? </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">''</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> : </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'not '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">prime.`</span></span>;    }); })();</code> </pre> <br>  Ensuite, installez le package de <a href="https://github.com/nbluis/static-server">serveur statique</a> .  Nous avons besoin d'un serveur car pour pouvoir utiliser la fonction <code>WebAssembly.instantiateStreaming</code> , le module doit √™tre entretenu √† l'aide du type MIME <code>application/wasm</code> . <br><br><pre> <code class="javascript hljs">npm install --save-dev <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>-server</code> </pre> <br>  Ajoutez le script appropri√© √† <code>package.json</code> : <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: {    <span class="hljs-string"><span class="hljs-string">"serve-demo"</span></span>: <span class="hljs-string"><span class="hljs-string">"static-server"</span></span>  } }</code> </pre> <br>  <code>npm run serve-demo</code> maintenant <code>npm run serve-demo</code> et ouvrez l'URL de l'h√¥te local dans le navigateur.  Si vous entrez un certain nombre dans le formulaire, vous pouvez savoir s'il est simple ou non.  Maintenant, en d√©veloppant AssemblyScript, nous avons parcouru un long chemin entre l'√©criture de code et son utilisation dans Node.js et sur une page Web. <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  WebAssembly, et donc AssemblyScript, n'est pas en mesure d'acc√©l√©rer un site comme par magie.  Mais Wasm n'a jamais √©t√© charg√© d'acc√©l√©rer absolument tout.  Cette technologie est remarquable en ce qu'elle ouvre la voie au Web pour de nouveaux types d'applications. <br><br>  On peut dire quelque chose de similaire √† propos d'AssemblyScript.  Cette technologie simplifie l'acc√®s √† WebAssembly pour un grand nombre de d√©veloppeurs.  Il permet, lors de la cr√©ation de code dans un langage proche de JavaScript, d'utiliser les capacit√©s de WebAssembly pour r√©soudre des probl√®mes de calcul complexes. <br><br>  <b>Chers lecteurs!</b>  Comment √©valuez-vous les perspectives d'utilisation d'AssemblyScript dans vos projets? <br><br><div style="text-align:center;"> <a href="https://ruvds.com/vps_start/"><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr477272/">https://habr.com/ru/post/fr477272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr477256/index.html">Le premier lancement √† part enti√®re de OneWeb sur le lanceur Soyouz est report√© l'ann√©e prochaine, ainsi que le lancement du lanceur Angara</a></li>
<li><a href="../fr477262/index.html">Andro√Ødes de la soci√©t√© Promobot. Vue lat√©rale</a></li>
<li><a href="../fr477264/index.html">La pelle s'est transform√©e en un robot autonome capable de creuser des tranch√©es ind√©pendamment</a></li>
<li><a href="../fr477266/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 390 (18-24 novembre 2019)</a></li>
<li><a href="../fr477268/index.html">Optimisation de la solution de recherche sur github</a></li>
<li><a href="../fr477274/index.html">Comment se d√©barrasser du code CSS inutilis√©? Partie 1</a></li>
<li><a href="../fr477276/index.html">Comment se d√©barrasser du code CSS inutilis√©? 2e partie</a></li>
<li><a href="../fr477278/index.html">Tests frontaux</a></li>
<li><a href="../fr477282/index.html">Profiling Go code de projet et r√©solution des probl√®mes d'allocation de m√©moire</a></li>
<li><a href="../fr477284/index.html">Pourquoi JavaScript est-il requis en mode strict?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>