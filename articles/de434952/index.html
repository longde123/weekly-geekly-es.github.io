<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéµ üå¨Ô∏è üïç OMower mit ROS, die ersten Schritte üçå üßõüèø ü•ë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OMower wurde urspr√ºnglich f√ºr die einfachen Steuerschnittstellen pfodApp und Modbus entwickelt. Das erste ist ein √ºbergeordnetes Textprotokoll, in dem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OMower mit ROS, die ersten Schritte</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434952/">  OMower wurde urspr√ºnglich f√ºr die einfachen Steuerschnittstellen pfodApp und Modbus entwickelt.  Das erste ist ein √ºbergeordnetes Textprotokoll, in dem Men√ºs und Steuerbefehle √ºbertragen werden, und das zweite ist eine bekannte, aber nicht sehr praktische Sache in dieser Anwendung, da das Steuerprogramm den Status aller verwendeten Sensoren st√§ndig ‚Äûmanuell‚Äú abfragen muss.  Daher wurde beschlossen, schrittweise auf ROS (Robot OS) umzusteigen, ein weit verbreitetes Framework zur Steuerung verschiedener Roboter. <br><br> <a href=""><img src="https://habrastorage.org/webt/rr/7_/np/rr7_npqnn9lphvkluh3gc2ulsx8.jpeg" width="720"></a> <br><br><a name="habracut"></a><br><br>  Derzeit befindet sich die ROS-Unterst√ºtzung in einem Anfangsstadium, einschlie√ülich der √úbertragung von Informationen von Sensoren in Form einfacher Arrays (ohne Verwendung spezieller Nachrichtenformate, die von vielen ROS-Bibliotheken angeboten werden), Debug-Protokollen und der Steuerung des Befehlsflusses im pfodApp / Modbus-Format, ohne die M√∂glichkeit Steuern Sie den Roboter wirklich mit Standard-ROS-Werkzeugen.  Das hei√üt, um den Roboter von seinem Platz zu bewegen oder eine interne Einstellung des Roboters zu √§ndern, m√ºssen Sie einen Textbefehl im pfodApp-Format an ihn senden.  Aber auch in solch einer abgeschnittenen Form k√∂nnen Sie einfach senden und aufzeichnen, was mit dem Roboter passiert, seine Bewegungen in Standard-ROS-Tools (rviz) visualisieren und Dienste f√ºr zus√§tzliche Funktionen hinzuf√ºgen.  Dies ist beispielsweise die M√∂glichkeit, in Richtung der von omower_seeker.py bereitgestellten visuellen Vorlage (Schachbrett) zu fahren, um eine genaue Ankunft an der Parkstation zu erreichen. <br><br>  Das Bild zeigt Datenstr√∂me im Roboter.  Die wichtigsten ROS-Dienste werden auf Orange PI Zero ausgef√ºhrt, das in einem speziellen Steckplatz auf der Roboterplatine steckt (auf einem Testger√§t wird hierf√ºr Raspberry PI3 verwendet, das auf √§hnliche Weise verbunden ist - √ºber die serielle Schnittstelle).  √úber die Rosserial-Schnittstelle sendet der Roboter Nachrichten von Sensoren (wie / imu / Orientierung oder / motors / PWM), sein Debug-Protokoll im Textformat und die Ausgabe von Men√ºs / Nachrichten im pfodApp- oder Modbus-Format an den ROS-Kernel und empf√§ngt einen Strom von Textbefehlen oder Modbus -Anfragen.  Zwei zus√§tzliche Raspberry PI Zero werden mit Bildstr√∂men von Kameras geliefert. Wie die Praxis gezeigt hat, ist es jedoch unm√∂glich, mit diesem Schema eine normale Synchronisation f√ºr die Verarbeitung von Stereobildern zu erzielen (die Qualit√§t ist im Bild unten zu sehen), sodass eine normale Stereokamera bald ersetzt wird. <br><br>  Der Grad der ROS-Integration in OMower wird schrittweise erweitert, bis der vollst√§ndige Zugriff auf alle internen Variablen des Roboters und die Verwaltung √ºber Standard-ROS-Tools (z. B. cmd_vel-Nachrichten, die die erforderliche Geschwindigkeit angeben) m√∂glich sind. <br><br> <a href=""><img src="https://habrastorage.org/webt/id/u6/pw/idu6pwvomgxmosirsfjwpl0silm.png" width="720"></a> <br><br>  Ich werde Ihnen etwas mehr √ºber das Modul omower_seeker.py erz√§hlen, als Beispiel f√ºr die Verwendung von ROS zum Hinzuf√ºgen von Funktionen zu OMower.  Der Zweck ist ganz einfach: Gehen Sie in Richtung Schachbrett und passen Sie Ihre Route in Echtzeit an.  Diese Funktion wird verwendet, um den M√§her zur Parkstation zu fahren, wo er seine Batterien schnell aufladen kann.  Das Modul analysiert das Bild von einer der Kameras und berechnet zwei Winkel (den Abweichungswinkel der Karte von der Mitte der Kamera und den Drehwinkel der Karte selbst relativ zur Senkrechten) und √ºbertr√§gt sie als Textbefehl an das interne Suchermodul (omower-seeker.h / cpp im OMower SDK). <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/gCKC3lw30Vo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  √Ñu√üerlich sieht dies nach einer ziemlich einfachen Aufgabe aus, aber im wirklichen Leben gibt es ein ernstes Problem - die Geschwindigkeit der Bildverarbeitung auf einem im Roboter eingebauten Mikrocomputer.  Wie die Praxis zeigt, ist die Geschwindigkeit der Suche nach Mustern in OpenCV im Bild bei Verwendung von Orange PI und Raspberry Pi mit relativ geringem Stromverbrauch sehr gering und instabil. Sie dauert zehn bis Hunderte von Millisekunden bei einer Aufl√∂sung von 640 x 480, was sich w√§hrend der Fahrt in Abweichungen von der erforderlichen Route seit dem Roboter niederschl√§gt schafft es trotz seiner geringen Geschwindigkeit, w√§hrend dieser Zeit einen betr√§chtlichen Winkel zu drehen oder eine relativ gro√üe Strecke zur√ºckzulegen.  Aus diesem Grund wurde ein Schachbrett mit einem Minimum an Zellen ausgew√§hlt, da andere Vorlagen noch mehr Zeit in Anspruch nehmen. <br><br>  Um die lange Suchzeit f√ºr die visuelle Vorlage zu kompensieren, wird ein Kompassschema verwendet - der Roboter-Mikrocontroller speichert seine Werte alle 100 Millisekunden und speichert f√ºnf Proben in der letzten halben Sekunde (l√§ngere Analysen werden einfach verworfen, da sie f√ºr eine genaue Navigation wenig n√ºtzlich sind).  Die berechneten Winkel aus omower_seeker.py (das auch die Vorlagensuchzeit an den Mikrocontroller √ºbertr√§gt) werden unter Verwendung des gespeicherten Kompasswerts, der nicht mehr als 100 Millisekunden von der Suchzeit entfernt ist, auf den tats√§chlichen Drehwinkel neu berechnet, und der Roboter f√§hrt entlang dieses Winkels.  Auf diese Weise k√∂nnen Sie in einer geraden Linie mehr oder weniger genau in Richtung Schachbrett gehen.  Oder wenn es relativ zur Senkrechten leicht gedreht ist - entlang eines Bogens, der den Anflugwinkel so korrigiert, dass er so nah wie m√∂glich an der Achse der Schablone liegt, da wir nicht nur bis zur Platine fahren m√ºssen, sondern auch in die F√ºhrungsschienen gelangen und uns mit den Ladekontakten verbinden m√ºssen. <br><br>  Der vollst√§ndige Algorithmus der Ankunft an der Station wird in drei Stufen implementiert.  Auf dem GPS-Feld werden zwei Punkte festgelegt - der Startpunkt (irgendwo in der Mitte des Arbeitsbereichs) und der Punkt vor der Station sowie der Drehwinkel zur Station.  Nachdem der Roboter vom Startpunkt zum zweiten angekommen ist und sich an der Station in den gew√ºnschten Winkel zum Schachbrett dreht, tritt das Suchermodul in Aktion und stellt die Drehzahl der Motoren √ºber den PID-Regler ein.  Wenn einer der Schritte fehlschl√§gt oder die Abweichungswinkel die eingestellten Werte √ºberschreiten, bricht der Roboter das Rennen ab und kehrt wieder zum Startpunkt zur√ºck. <br><br>  Links und Video: <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OMower SDK, Bibliothek f√ºr Arduino IDE und Leiterplattenlayout</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fertige Firmware mit dem SDK, das sowohl pfodApp / Modbus als auch die Verbindung zu ROS implementiert</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">omower_gateway-Paket f√ºr ROS</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/dyz7xH9U1kY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/mmV4WPHlc7Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de434952/">https://habr.com/ru/post/de434952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de434940/index.html">Gesch√§ft Ich liebe dich</a></li>
<li><a href="../de434942/index.html">Die Kunst des Schamanismus oder der benutzerdefinierten Firmware f√ºr Olinuxino. UBOOT Teil 2</a></li>
<li><a href="../de434944/index.html">Notizen eines Phytochemikers. Bananenschale schl√§gt zur√ºck</a></li>
<li><a href="../de434946/index.html">Mein Umzug nach Norwegen</a></li>
<li><a href="../de434950/index.html">Die Gegenwart, die unsere Zukunft bestimmen wird</a></li>
<li><a href="../de434956/index.html">Das IT-Unternehmen w√§chst, der Gewinn ist nicht besonders. Was zu tun ist?</a></li>
<li><a href="../de434960/index.html">Tic-Tac-Toe: Demonstration eines kontrollierten Prozesses zur Rekonfiguration von DNA-Strukturen</a></li>
<li><a href="../de434962/index.html">Nein, Sie ben√∂tigen Express nicht in Ihrer REST-API auf Node.js.</a></li>
<li><a href="../de434964/index.html">Genug von Paranoia oder warum Sie nicht 100 Punkte in Page Speed ‚Äã‚Äãgl√§nzen</a></li>
<li><a href="../de434966/index.html">Neue Mash-Programmiersprache</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>