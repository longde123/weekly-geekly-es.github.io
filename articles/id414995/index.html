<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¨ üö≠ üëÜ Catatan amatir, atau The Tale of Bagaimana Scala Pengembang FPGA Dikonfigurasi üßëüèæ üôãüèæ üëºüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Untuk waktu yang lama saya bermimpi belajar bagaimana bekerja dengan FPGA, saya melihat lebih dekat. Kemudian dia membeli papan debug, menulis beberap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Catatan amatir, atau The Tale of Bagaimana Scala Pengembang FPGA Dikonfigurasi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414995/"><p><img src="https://habrastorage.org/webt/iv/-q/hz/iv-qhzuto0ce_yrg6l226fghqf8.png" width="60%" align="left">  Untuk waktu yang lama saya bermimpi belajar bagaimana bekerja dengan FPGA, saya melihat lebih dekat.  Kemudian dia membeli papan debug, menulis beberapa halo dunia dan meletakkan papan di dalam kotak, karena tidak jelas apa yang harus dilakukan dengan itu.  Lalu idenya muncul: mari kita tulis generator video komposit untuk TV CRT kuno.  Idenya, tentu saja, lucu, tetapi saya tidak benar-benar mengenal Verilog, dan saya masih harus mengingatnya, dan saya tidak benar-benar membutuhkan generator ini ... Dan baru-baru ini saya ingin melihat ke arah prosesor perangkat lunak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RISC-V</a> .  Anda harus mulai di suatu tempat, dan kode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Rocket Chip</a> (ini adalah salah satu implementasi) ditulis dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pahat</a> - ini adalah DSL untuk Scala.  Lalu tiba-tiba saya ingat bahwa selama dua tahun saya telah mengembangkan secara profesional di Scala dan menyadari: saatnya telah tiba ... </p><br><p>  Jadi, jika Anda ingin membaca cerita dari kehidupan pemotong kawat, multimeter digital, dan osiloskop yang telah terwujud dengan sendirinya, selamat datang di kucing. </p><a name="habracut"></a><br><p>  Jadi apa yang akan ada di artikel ini?  Di dalamnya, saya akan menjelaskan upaya saya untuk menghasilkan sinyal video PAL komposit (mengapa PAL? - Saya baru saja menemukan tutorial yang baik khususnya pada generasi PAL) di papan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mars rover 2</a> oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">nckma</a> .  Tentang RISC-V dalam artikel ini saya tidak akan mengatakan apa-apa.  :) </p><br><p>  Pertama, sedikit tentang Scala dan Pahat: Scala adalah bahasa yang berjalan di atas Java Virtual Machine dan secara transparan menggunakan perpustakaan Java yang ada (walaupun ada juga Scala.js dan Scala Native).  Ketika saya pertama kali mulai mempelajarinya, saya merasa bahwa itu adalah hibrida yang sangat baik dari "plus" dan Haskell <em>(namun, kolega tidak berbagi pendapat ini)</em> - itu adalah sistem tipe canggih canggih dan bahasa ringkas, tetapi karena kebutuhan untuk menyeberang fungsionalisme dengan OOP, banyak sekali konstruksi bahasa di beberapa tempat membangkitkan ingatan akan C ++.  Namun, jangan takut pada Scala - ini adalah bahasa yang sangat ringkas dan aman dengan sistem tipe yang kuat, di mana pada awalnya Anda hanya dapat menulis sebagai Java yang ditingkatkan.  Dan juga, sejauh yang saya tahu, Scala awalnya dikembangkan sebagai bahasa untuk pembuatan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bahasa Spesifik Domain yang nyaman</a> - ini adalah saat Anda menggambarkan, katakanlah, peralatan digital atau catatan dalam bahasa formal, dan bahasa ini terlihat cukup logis dari sudut pandang area subjeknya.  Dan kemudian Anda tiba-tiba mengetahui bahwa itu adalah kode yang benar di Scala (well, atau Haskell) - orang-orang baik hati menulis perpustakaan dengan antarmuka yang nyaman.  Pahat hanyalah perpustakaan untuk Scala, yang memungkinkan kita untuk menggambarkan logika digital pada DSL yang nyaman, dan kemudian menjalankan kode Scala yang dihasilkan dan menghasilkan kode pada Verilog (atau yang lain) yang dapat disalin ke proyek Quartus.  Baik, atau segera jalankan unit-test standar scala-style, yang mereka sendiri akan mensimulasikan testbenches dan mengeluarkan laporan hasil. </p><br><p>  Untuk berkenalan dengan sirkuit digital, saya sangat merekomendasikan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">buku ini</a> (sudah dalam versi cetak Rusia).  Kenyataannya, perkenalan saya yang sistematis dengan dunia FPGA hampir berakhir pada buku ini, jadi kritik konstruktif dalam komentar ini disambut baik (namun, saya ulangi, buku ini luar biasa: buku ini menceritakan dari dasar-dasar pembuatan kreasi prosesor yang sederhana. Dan ada gambar di sana;)).  Nah, menurut Pahat ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tutorial resmi yang bagus</a> . </p><br><p>  <strong>Penafian:</strong> penulis tidak bertanggung jawab atas peralatan yang terbakar, dan jika Anda memutuskan untuk mengulangi percobaan, lebih baik untuk memeriksa level sinyal dengan osiloskop, membuat ulang bagian analog, dll.  Dan secara umum - perhatikan tindakan pencegahan keselamatan.  <em>(Misalnya, dalam proses menulis artikel, saya menyadari bahwa kaki-kaki juga anggota badan, dan tidak ada yang menempel di baterai pemanas sentral, berpegang pada output papan ...)</em> Omong-omong, infeksi ini juga menyebabkan gangguan pada TV di kamar sebelah. dalam proses debug ... </p><br><h2 id="nastroyka-proekta">  Penyiapan proyek </h2><br><p> Kami akan menulis kode dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">IntelliJ Idea Community Edition</a> , karena sistem build akan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sbt</a> , jadi buat direktori, masukkan <code>.gitignore</code> , <code>project/build.properties</code> , <code>project/plugins.sbt</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari sini</a> dan </p><br><div class="spoiler">  <b class="spoiler_title">build.sbt agak disederhanakan</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scalacOptionsVersion</span></span></span></span>(scalaVersion: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = { <span class="hljs-type"><span class="hljs-type">Seq</span></span>() ++ { <span class="hljs-comment"><span class="hljs-comment">// If we're building with Scala &gt; 2.11, enable the compile option // switch to support our anonymous Bundle definitions: // https://github.com/scala/bug/issues/10047 CrossVersion.partialVersion(scalaVersion) match { case Some((2, scalaMajor: Long)) if scalaMajor &lt; 12 =&gt; Seq() case _ =&gt; Seq("-Xsource:2.11") } } } name := "chisel-example" version := "1.0.0" scalaVersion := "2.11.12" resolvers ++= Seq( Resolver.sonatypeRepo("snapshots"), Resolver.sonatypeRepo("releases") ) // Provide a managed dependency on X if -DXVersion="" is supplied on the command line. val defaultVersions = Map( "chisel3" -&gt; "3.1.+", "chisel-iotesters" -&gt; "1.2.+" ) libraryDependencies ++= (Seq("chisel3","chisel-iotesters").map { dep: String =&gt; "edu.berkeley.cs" %% dep % sys.props.getOrElse(dep + "Version", defaultVersions(dep)) }) scalacOptions ++= scalacOptionsVersion(scalaVersion.value)</span></span></code> </pre> </div></div><br><p>  Sekarang buka di Ide dan minta untuk mengimpor proyek sbt - sementara sbt akan mengunduh dependensi yang diperlukan. </p><br><h2 id="pervye-moduli">  Modul pertama </h2><br><h3 id="shim">  PWM </h3><br><p>  Pertama, mari kita coba menulis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PWM</a> sederhana.  Logika saya kira-kira sebagai berikut: untuk menghasilkan sinyal siklus tugas n / m, kami awalnya memasukkan 0 dalam register dan kami akan menambahkan n padanya setiap langkah.  Ketika nilai register melebihi m, kurangi m dan berikan level tinggi untuk satu siklus clock.  Sebenarnya, itu akan menjadi buggy jika n&gt; m, tetapi kami akan menganggap ini sebagai perilaku tidak terbatas, yang diperlukan untuk mengoptimalkan kasus aktual yang digunakan. </p><br><p>  Saya tidak akan menceritakan kembali seluruh panduan pemula - bunyinya dalam setengah jam, saya hanya akan mengatakan bahwa untuk menjelaskan modul, kita perlu mengimpor <code>chisel3._</code> dan mewarisi dari <code>Module</code> kelas abstrak.  Ini abstrak karena kita perlu menggambarkan <code>Bundle</code> dengan nama <code>io</code> - ia akan memiliki seluruh antarmuka modul.  Pada saat yang sama, input <code>clock</code> dan <code>reset</code> akan muncul secara implisit - Anda tidak perlu menggambarkannya secara terpisah.  Inilah yang terjadi: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWM</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numerator = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> denominator = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pulse = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> counter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> nextValue = counter + io.numerator io.pulse := nextValue &gt; io.denominator counter := <span class="hljs-type"><span class="hljs-type">Mux</span></span>(io.pulse, nextValue - io.denominator, nextValue) }</code> </pre><br><p>  Perhatikan, kita memanggil metode <code>.W</code> int reguler untuk mendapatkan lebar port, dan metode <code>.asUInt(width.W)</code> yang biasanya kita panggil dengan integer literal!  Bagaimana ini mungkin?  - yah, di Smalltalk kita hanya akan mendefinisikan metode baru untuk kelas Integer (atau apa pun namanya), tetapi dalam JVM kita masih tidak memiliki seluruh objek - ada juga tipe primitif, dan Scala memahami ini (dan, di samping itu, ada kelas pihak ketiga yang tidak dapat kami modifikasi).  Oleh karena itu, ada berbagai s implisit: dalam hal ini, Scala mungkin menemukan sesuatu seperti </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BetterInt</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">n: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">W</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Width</span></span> = ... }</code> </pre> <br><p>  dalam lingkup saat ini, jadi int biasa memiliki kekuatan super.  Berikut adalah salah satu fitur yang membuat Scala lebih ringkas dan mudah untuk membuat DSL. </p><br><div class="spoiler">  <b class="spoiler_title">Tambahkan sejumput tes untuk ini.</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.iotesters._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatest.{<span class="hljs-type"><span class="hljs-type">FlatSpec</span></span>, <span class="hljs-type"><span class="hljs-type">Matchers</span></span>} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMSpec</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterConstant</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, denum: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, const: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">) </span></span>{ poke(pwm.io.numerator, <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (const) denum <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) poke(pwm.io.denominator, denum) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">2</span></span> * denum) { step(<span class="hljs-number"><span class="hljs-number">1</span></span>) expect(pwm.io.pulse, const) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterExact</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, num: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, ratio: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">) </span></span>{ poke(pwm.io.numerator, num) poke(pwm.io.denominator, num * ratio) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> delay = (<span class="hljs-number"><span class="hljs-number">1</span></span> to ratio + <span class="hljs-number"><span class="hljs-number">2</span></span>).takeWhile { _ =&gt; step(<span class="hljs-number"><span class="hljs-number">1</span></span>) peek(pwm.io.pulse) == <span class="hljs-type"><span class="hljs-type">BigInt</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) } println(<span class="hljs-string"><span class="hljs-string">s"delay = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$delay</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">10</span></span>) { expect(pwm.io.pulse, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to ratio - <span class="hljs-number"><span class="hljs-number">1</span></span>) { step(<span class="hljs-number"><span class="hljs-number">1</span></span>) expect(pwm.io.pulse, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } step(<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterApproximate</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, num: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, denom: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">)</span></span>{ poke(pwm.io.numerator, num) poke(pwm.io.denominator, denom) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> count = (<span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">100</span></span> * denom).map { _ =&gt; step(<span class="hljs-number"><span class="hljs-number">1</span></span>) peek(pwm.io.pulse).toInt }.sum <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> diff = count - <span class="hljs-number"><span class="hljs-number">100</span></span> * num println(<span class="hljs-string"><span class="hljs-string">s"Difference = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$diff</span></span></span><span class="hljs-string">"</span></span>) expect(<span class="hljs-type"><span class="hljs-type">Math</span></span>.abs(diff) &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"Difference should be almost 0"</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlatSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Matchers</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">PWMSpec</span></span>._ behavior of <span class="hljs-string"><span class="hljs-string">"PWMSpec"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWith</span></span></span></span>(testerConstructor: <span class="hljs-type"><span class="hljs-type">PWM</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">PeekPokeTester</span></span>[<span class="hljs-type"><span class="hljs-type">PWM</span></span>]): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { chisel3.iotesters.<span class="hljs-type"><span class="hljs-type">Driver</span></span>(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWM</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>))(testerConstructor) shouldBe <span class="hljs-literal"><span class="hljs-literal">true</span></span> } it should <span class="hljs-string"><span class="hljs-string">"return True constant for 1/1"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return True constant for 10/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return False constant for 1/1"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return False constant for 10/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return True exactly once in 3 steps for 1/3"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterExact</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return good approximation for 3/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterApproximate</span></span>(_, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)) } }</code> </pre> </div></div><br><p>  <code>PeekPokeTester</code> adalah salah satu dari tiga penguji standar di Chisel.  Ini memungkinkan Anda untuk mengatur nilai pada input DUT (perangkat yang diuji) dan memeriksa nilai pada output.  Seperti yang dapat kita lihat, ScalaTest biasa digunakan untuk pengujian dan pengujian memakan ruang 5 kali implementasi itu sendiri, yang pada prinsipnya adalah normal untuk perangkat lunak.  Namun, saya menduga bahwa pengembang peralatan "cast in silicon" yang berpengalaman hanya akan tersenyum dengan sejumlah tes mikroskopis.  Luncurkan dan oops ... </p><br><pre> <code class="hljs powershell">Circuit state created [<span class="hljs-type"><span class="hljs-type">info</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">000</span></span>] SEED <span class="hljs-number"><span class="hljs-number">1529827417539</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">000</span></span>] EXPECT AT <span class="hljs-number"><span class="hljs-number">1</span></span> io_pulse got <span class="hljs-number"><span class="hljs-number">0</span></span> expected <span class="hljs-number"><span class="hljs-number">1</span></span> FAIL ... [<span class="hljs-type"><span class="hljs-type">info</span></span>] PWMSpec: [<span class="hljs-type"><span class="hljs-type">info</span></span>] PWMSpec [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span> *** FAILED *** [<span class="hljs-type"><span class="hljs-type">info</span></span>] false was not equal to true (PWMSpec.scala:<span class="hljs-number"><span class="hljs-number">56</span></span>) [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> False constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> False constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True exactly once <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> steps <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> good approximation <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><p>  Ya, perbaiki di PWM di baris <code>io.pulse := nextValue &gt; io.denominator</code> masuk <code>&gt;=</code> , mulai ulang tes - semuanya berfungsi!  Saya khawatir bahwa pengembang peralatan digital yang berpengalaman ingin membunuh saya karena sikap remeh untuk mendesain (dan beberapa pengembang perangkat lunak akan dengan senang hati bergabung dengan mereka) ... </p><br><h3 id="generator-impulsov">  Generator pulsa </h3><br><p>  Kita juga akan membutuhkan generator yang akan memberikan pulsa sinkronisasi untuk "setengah frame".  Mengapa semi?  karena pertama garis aneh ditransmisikan, lalu yang genap (baik, atau sebaliknya, tapi sekarang kita tidak peduli tentang lemak). </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.util._ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OneShotPulseGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">val lengths: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">], val initial: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Add sentinel value here, so no output flip required after the last state private val delayVecValues = lengths.map(_ - 1) :+ 0 val io = IO(new Bundle { val signal = Output(Bool()) }) private val nextIndex = RegInit(1.asUInt( log2Ceil(delayVecValues.length + 1).W )) private val countdown = RegInit(delayVecValues.head.asUInt( log2Ceil(lengths.max + 1).W )) private val output = RegInit(initial.asBool) private val delaysVec = VecInit(delayVecValues.map(_.asUInt)) private val moveNext = countdown === 0.asUInt private val finished = nextIndex === delayVecValues.length.asUInt when (!finished) { when (moveNext) { countdown := delaysVec(nextIndex) nextIndex := nextIndex + 1.asUInt output := !output }.otherwise { countdown := countdown - 1.asUInt } } io.signal := output }</span></span></code> </pre> <br><p>  Ketika sinyal <code>reset</code> dihapus, sinyal ini memotret dengan pulsa persegi panjang dengan panjang interval antara switching yang ditentukan oleh parameter <code>lengths</code> , setelah itu tetap selamanya di kondisi terakhir.  Contoh ini menunjukkan penggunaan tabel nilai menggunakan <code>VecInit</code> , serta cara untuk mendapatkan lebar register yang diperlukan: <code>chisel3.util.log2Ceil(maxVal + 1).W</code> .  Sejujurnya saya tidak ingat bagaimana hal itu dilakukan di Verilog, tetapi di Pahat, untuk membuat modul seperti parameter dengan vektor nilai, cukup memanggil konstruktor kelas dengan parameter yang diperlukan. </p><br><p>  Anda mungkin bertanya: "Jika input <code>clock</code> dan <code>reset</code> dihasilkan secara implisit, lalu bagaimana kita akan" mengisi ulang "generator pulsa untuk setiap frame?"  Pengembang pahat telah menyediakan untuk semuanya: </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> module = <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> moduleWithCustomReset = withReset(customReset) { <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> otherClockDomain = withClock(otherClock) { <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) }</code> </pre> <br><h2 id="naivnaya-realizaciya-generatora-signala">  Implementasi naif dari generator sinyal </h2><br><p>  Agar TV memahami kami setidaknya, entah bagaimana, Anda perlu mendukung "protokol" level trik rata-rata: ada tiga level sinyal penting: </p><br><ul><li>  1.0V - warna putih </li><li>  0.3V - warna hitam </li><li>  0V - level khusus </li></ul><br><p>  Mengapa saya memanggil 0V khusus?  Karena dengan transisi yang mulus dari 0.3V ke 1.0V, kami dengan lancar beralih dari hitam ke putih, dan antara 0V dan 0.3V, sejauh yang saya mengerti, tidak ada level menengah dan 0V hanya digunakan untuk sinkronisasi.  <em>(Bahkan, itu bahkan tidak berubah dalam kisaran 0V - 1V, tetapi -0,3V - 0,7V, tetapi, semoga, masih ada kapasitor di input)</em> </p><br><p>  Seperti yang diajarkan oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel yang luar biasa ini</a> , sinyal PAL komposit terdiri dari aliran berulang 625 garis berulang: kebanyakan dari mereka adalah garis, pada kenyataannya, gambar (secara genap dan terpisah secara terpisah), beberapa digunakan untuk keperluan sinkronisasi (kami melakukan generator untuk mereka sinyal), beberapa tidak terlihat di layar.  Mereka terlihat seperti ini (saya tidak akan membajak dan memberikan tautan ke aslinya): </p><br><ul><li>  <a href="">Satu garis gambar biasa</a> </li><li>  <a href="">Sinkronkan string</a> </li></ul><br><p>  Mari kita coba gambarkan antarmuka modul: </p><br><p>  <code>BWGenerator</code> akan mengatur pengaturan waktu, dll., Perlu mengetahui pada frekuensi apa ia bekerja: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BWGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">L</span></span> = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> inScanLine = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  <code>PalColorCalculator</code> akan menghitung level sinyal luminance, serta sinyal warna tambahan: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PalColorCalculator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scanLine = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">L</span></span> = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-comment"><span class="hljs-comment">//  --  / io.L := (0.asUInt(10.W) + io.red + io.green + io.blue) / 4.asUInt io.millivolts := 0.asUInt }</span></span></code> </pre> <br><p>  Dalam modul <code>PalGenerator</code> , <code>PalGenerator</code> cukup <code>PalGenerator</code> dua modul yang ditentukan: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PalGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bw = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">BWGenerator</span></span>(clocksPerUs)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> color = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PalColorCalculator</span></span>) io.red &lt;&gt; color.io.red io.green &lt;&gt; color.io.green io.blue &lt;&gt; color.io.blue bw.io.<span class="hljs-type"><span class="hljs-type">L</span></span> &lt;&gt; color.io.<span class="hljs-type"><span class="hljs-type">L</span></span> bw.io.inScanLine &lt;&gt; color.io.scanLine bw.io.x &lt;&gt; io.x bw.io.y &lt;&gt; io.y io.millivolts := bw.io.millivolts + color.io.millivolts }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Dan sekarang kita dengan sedih menggambar burung hantu pertama ...</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.github.atrosinenko.fpga.tv <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.core.withReset <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io.github.atrosinenko.fpga.common.<span class="hljs-type"><span class="hljs-type">OneShotPulseGenerator</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BWGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">ScanLineHSyncStartUs</span></span> = <span class="hljs-number"><span class="hljs-number">4.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">ScanLineHSyncEndUs</span></span> = <span class="hljs-number"><span class="hljs-number">12.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">TotalScanLineLengthUs</span></span> = <span class="hljs-number"><span class="hljs-number">64.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">VSyncStart</span></span> = <span class="hljs-type"><span class="hljs-type">Seq</span></span>( <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-comment"><span class="hljs-comment">// 623 / 311 2, 30, 2, 30 // 624 / 312 ) val VSyncEnd = Seq( 30, 2, 30, 2, // 2 / 314 30, 2, 30, 2, // 3 / 315 2, 30, 2, 30, // 4 / 316 2, 30, 2, 30 // 5 / 317 ) val VSync1: Seq[Int] = VSyncStart ++ Seq( 2, 30, 2, 30, // 625 30, 2, 30, 2 // 1 ) ++ VSyncEnd ++ (6 to 23).flatMap(_ =&gt; Seq(4, 60)) val VSync2: Seq[Int] = VSyncStart ++ Seq( 2, 30, 30, 2 // 313 ) ++ VSyncEnd ++ (318 to 335).flatMap(_ =&gt; Seq(4, 60)) val BlackMv = 300.asUInt(12.W) val WhiteMv = 1000.asUInt(12.W) val FirstHalf = (24, 311) val SecondHalf = (336, 623) val TotalScanLineCount = 625 } class BWGenerator(clocksPerUs: Int) extends Module { import BWGenerator._ val io = IO(new Bundle { val L = Input(UInt(8.W)) val x = Output(UInt(10.W)) val y = Output(UInt(10.W)) val inScanLine = Output(Bool()) val millivolts = Output(UInt(12.W)) }) private val scanLineNr = RegInit(0.asUInt(10.W)) private val inScanLineCounter = RegInit(0.asUInt(16.W)) when (inScanLineCounter === (TotalScanLineLengthUs * clocksPerUs - 1).toInt.asUInt) { inScanLineCounter := 0.asUInt when(scanLineNr === (TotalScanLineCount - 1).asUInt) { scanLineNr := 0.asUInt } otherwise { scanLineNr := scanLineNr + 1.asUInt } } otherwise { inScanLineCounter := inScanLineCounter + 1.asUInt } private val fieldIActive = SecondHalf._2.asUInt &lt;= scanLineNr || scanLineNr &lt; FirstHalf._1.asUInt private val fieldIGenerator = withReset(!fieldIActive) { Module(new OneShotPulseGenerator(VSync1.map(_ * clocksPerUs), initial = false)) } private val fieldIIActive = FirstHalf._2.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; SecondHalf._1.asUInt private val fieldIIGenerator = withReset(!fieldIIActive) { Module(new OneShotPulseGenerator(VSync2.map(_ * clocksPerUs), initial = false)) } private val inFirstHalf = FirstHalf ._1.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; FirstHalf ._2.asUInt private val inSecondHalf = SecondHalf._1.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; SecondHalf._2.asUInt io.inScanLine := (inFirstHalf || inSecondHalf) &amp;&amp; ((ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt &lt;= inScanLineCounter) io.x := Mux( io.inScanLine, inScanLineCounter - (ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt, 0.asUInt ) / 4.asUInt io.y := Mux( io.inScanLine, Mux( inFirstHalf, ((scanLineNr - FirstHalf ._1.asUInt) &lt;&lt; 1).asUInt, ((scanLineNr - SecondHalf._1.asUInt) &lt;&lt; 1).asUInt + 1.asUInt ), 0.asUInt ) when (fieldIActive) { io.millivolts := Mux(fieldIGenerator .io.signal, BlackMv, 0.asUInt) }.elsewhen (fieldIIActive) { io.millivolts := Mux(fieldIIGenerator.io.signal, BlackMv, 0.asUInt) }.otherwise { when (inScanLineCounter &lt; (ScanLineHSyncStartUs * clocksPerUs).toInt.asUInt) { io.millivolts := 0.asUInt }.elsewhen (inScanLineCounter &lt; (ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt) { io.millivolts := BlackMv }.otherwise { io.millivolts := (BlackMv + (io.L &lt;&lt; 1).asUInt).asUInt } } }</span></span></code> </pre> </div></div><br><h3 id="generaciya-sinteziruemogo-koda">  Pembuatan Kode Disintesis </h3><br><p>  Ini semua bagus, tapi kami ingin menjahit desain yang dihasilkan menjadi papan.  Untuk melakukan ini, Anda perlu mensintesis Verilog.  Ini dilakukan dengan cara yang sangat sederhana: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io.github.atrosinenko.fpga.common.<span class="hljs-type"><span class="hljs-type">PWM</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Codegen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestModule</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">mhz: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> imageGenerator = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TestColorImageGenerator</span></span>(<span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">400</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encoder = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PalGenerator</span></span>(clocksPerUs = mhz)) imageGenerator.io.x &lt;&gt; encoder.io.x imageGenerator.io.y &lt;&gt; encoder.io.y imageGenerator.io.red &lt;&gt; encoder.io.red imageGenerator.io.green &lt;&gt; encoder.io.green imageGenerator.io.blue &lt;&gt; encoder.io.blue io.millivolts := encoder.io.millivolts <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">desiredName</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"CompositeSignalGenerator"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>(args: <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { <span class="hljs-type"><span class="hljs-type">Driver</span></span>.execute(args, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWM</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span>)) <span class="hljs-type"><span class="hljs-type">Driver</span></span>.execute(args, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TestModule</span></span>(mhz = <span class="hljs-number"><span class="hljs-number">32</span></span>)) } }</code> </pre><br><p>  Sebenarnya, dalam metode dua-baris <code>main()</code> kita melakukannya dua kali, sisa kode adalah modul lain yang menempel berikutnya </p><br><div class="spoiler">  <b class="spoiler_title">Generator gambar tes benar-benar membosankan</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestColorImageGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, height: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) io.red := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">200.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) io.green := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">200.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) io.blue := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) }</code> </pre> </div></div><br><p>  Sekarang Anda perlu memasukkannya ke dalam proyek Quartus.  Untuk Mars rover 2, kita akan memerlukan versi gratis Quartus 13.1.  Cara menginstalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ada tertulis</a> di situs Mars rovers.  Dari sana, saya mengunduh "Proyek Pertama" untuk papan Mars Rover 2, memasukkannya ke dalam repositori, dan sedikit memperbaikinya.  Karena saya bukan insinyur elektronik (dan FPGA, saya sebenarnya lebih tertarik sebagai akselerator daripada sebagai kartu antarmuka) </p><br><div class="spoiler">  <b class="spoiler_title">seperti dalam lelucon itu ...</b> <div class="spoiler_text"><p>  Programmer duduk jauh di dalam debugging. <br>  Fit son: <br>  "Papa, mengapa matahari terbit di timur setiap hari dan duduk di barat?" <br>  "Apakah kamu memeriksa itu?" <br>  - Sudah diperiksa. <br>  - Sudah diperiksa? <br>  - Bagus <br>  - Apakah itu berhasil? <br>  - Berhasil. <br>  - Apakah itu bekerja setiap hari? <br>  - Ya setiap hari. <br>  - Maka demi Tuhan, Nak, jangan menyentuh apa pun, jangan ubah apa pun. </p></div></div><br><p>  ... Saya baru saja menghapus generator sinyal VGA dan menambahkan modul saya. </p><br><p><img src="https://habrastorage.org/webt/uq/tu/fx/uqtufxsowkzdbhnd652ezepquva.png" alt="Beralih di quatus"></p><br><p>  Setelah itu, saya menghubungkan TV tuner analog ke komputer lain (laptop), sehingga setidaknya ada isolasi galvanis antara catu daya generator sinyal dan konsumen dan baru saja mengirim sinyal dari pin IO7 (+) dan GND (-) papan ke input komposit (minus ke kontak eksternal, plus ke tengah).  Nah, itu, sebagai "sederhana" ... Itu hanya akan terjadi jika tangan tumbuh dari tempat seharusnya, atau jika saya memiliki kabel penghubung perempuan-laki-laki.  Tapi saya hanya punya banyak kabel pria-pria.  Tapi aku punya kegigihan dan gigitan!  Secara umum, ada satu sembelit, saya memang membuat diri saya hampir menjadi pekerja - dengan kesulitan, tetapi berpegang teguh pada papan.  Dan inilah yang saya lihat: </p><br><p><img src="https://habrastorage.org/webt/7a/pi/d-/7apid-1jqyjglndca2aefk2wi2u.png" alt="Gambar b / w pertama"></p><br><p>  Sebenarnya, saya, tentu saja, sedikit menipu Anda.  Kode yang ditunjukkan di atas saya dapatkan setelah sekitar tiga jam debug "pada perangkat keras", tetapi, sialnya, saya menulisnya, dan itu berhasil !!!  Dan, mengingat bahwa saya hampir tidak terbiasa dengan elektronik yang serius, saya pikir tugas itu tidak buruk, tugas yang sulit. </p><br><h2 id="generaciya-cvetnogo-videosignala">  Pembuatan video berwarna </h2><br><p>  Nah, kemudian, masalahnya tetap kecil - untuk menambahkan generator sinyal video warna.  Saya mengambil tutorial dan mulai mencoba untuk membentuk warna meledak (ditambahkan ke tingkat hitam dari gelombang sinus pada frekuensi pembawa sinyal warna, yang diproduksi untuk waktu yang singkat selama HSync) dan, pada kenyataannya, sinyal warna sesuai dengan formula.  Tapi itu tidak keluar, bahkan jika Anda retak ... Pada titik tertentu saya sadar bahwa, meskipun fakta bahwa frekuensi tidak menarik pandangan saya sekilas pada dokumen, TV hampir tidak disetel ke yang sewenang-wenang.  Setelah mencari, saya menemukan bahwa PAL menggunakan frekuensi pembawa 4,43 MHz.  Masalahnya adalah topinya, pikirku.  "Brengsek," jawab sang tuner.  Setelah seharian debugging dan hanya sekali melihat sekilas warna dalam gambar (apalagi, ketika saya mengatakan kepada tuner bahwa itu adalah NTSC pada umumnya) </p><br><div class="spoiler">  <b class="spoiler_title">... Saya menyadari betapa putus asa sebenarnya terlihat</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/7a/pi/d-/7apid-1jqyjglndca2aefk2wi2u.png" alt="hopelessness.zhpg"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Saya ingat ....</a> </p></div></div><br><p>  Kemudian saya menyadari bahwa saya tidak dapat melakukannya tanpa osiloskop.  Dan, seperti yang telah saya katakan, saya tidak terbiasa dengan elektronik, dan, tentu saja, saya tidak memiliki keajaiban teknologi di rumah.  Untuk membeli?  Sedikit mahal untuk satu percobaan ... Dan dari apa itu bisa dibangun di atas lutut?  Hubungkan sinyal ke input baris kartu suara?  Ya, 4 setengah megahertz - tidak mungkin untuk memulai (setidaknya tanpa perubahan).  Hmm, Mars rover memiliki ADC pada 20 MHz, tetapi mentransfer aliran mentah antarmuka serial ke komputer tidak cukup.  Nah, di suatu tempat, Anda masih harus memproses sinyal untuk ditampilkan, dan sebenarnya akan ada jumlah bit informasi yang dapat diterima, tetapi itu juga mengacaukan dengan port serial, menulis program untuk komputer ... Lalu saya berpikir bahwa insinyur harus mengembangkan ada kegigihan dalam dirinya sendiri: ada imager warna idle, ada ADC ... Tapi gambar hitam dan putih adalah output stabil ... Nah, biarkan generator sinyal debug sendiri! </p><br><p>  <em>Penyimpangan liris (seperti yang mereka katakan, "Pendapat siswa tidak harus bertepatan dengan pendapat guru, akal sehat dan aksioma Peano"):</em> Ketika saya menambahkan generasi warna dengan semua jenis penggandaan dan hal-hal rumit lainnya, Fmax merosot kuat untuk pengkondisi sinyal.  Apa itu Fmax?  Sejauh yang saya mengerti dari buku teks Harris &amp; Harris, CAD untuk FPGA lebih suka ketika Verilog ditulis tidak dalam hal apa pun seperti dalam standar, tetapi "dengan konsep": misalnya, hasilnya harus berupa rangkaian sinkron - semacam web asiklik terarah dari <em>logika kombinasional</em> (penambahan, penggandaan , pembagian, operasi logis, ...), masing-masing terjebak dengan input dan output ke output dan input pemicu.  Pemicu di tepi sinyal clock mengingat nilai inputnya untuk seluruh siklus clock berikutnya, level yang harus stabil beberapa waktu sebelum depan dan beberapa waktu sesudahnya (ini adalah dua konstanta waktu).  Sinyal-sinyal dari output pemicu, pada gilirannya, setelah sinyal clock mulai menjalankannya ke output dari logika kombinasional (dan, oleh karena itu, input dari pemicu lainnya. Nah, dan output dari rangkaian mikro), yang juga ditandai oleh dua interval: waktu di mana tidak ada output belum akan memiliki waktu untuk mulai berubah, dan waktu setelah itu perubahan akan menjadi tenang (asalkan input telah berubah sekali).  Berikut adalah frekuensi maksimum di mana logika kombinasional memastikan bahwa persyaratan pemicu terpenuhi - dan ini adalah Fmax.  Ketika sirkuit antara dua jam harus memiliki waktu untuk menghitung lebih banyak, Fmax berkurang.  Tentu saja, saya ingin frekuensinya lebih besar, tetapi jika tiba-tiba melonjak 10 kali (atau bahkan jumlah domain frekuensi dalam laporan CAD menurun) - periksa, mungkin Anda mengacaukan sesuatu di suatu tempat, dan sebagai hasilnya, CAD menemukan ekspresi konstan dan dengan senang hati menggunakannya untuk optimisasi. </p><br><h3 id="raskrutka-oscillografa">  Promosi Osiloskop </h3><br><p>  Tidak, bukan yang setelahnya ada putaran osiloskop dan beberapa bagian tambahan, tetapi bootstrap osiloskop seperti bootstrap kompiler, hanya untuk osiloskop. </p><br><p>  Kami akan membuat osiloskop, atas perintah, merekam beberapa sampel sinyal input, setelah itu hanya menampilkan yang direkam.  Karena dia perlu entah bagaimana memberikan perintah untuk merekam, dan setelah - menavigasi melalui itu, kita akan memerlukan beberapa pengontrol tombol - saya menulis tidak terlalu nyaman, tetapi cukup primitif, ini dia: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleButtonController</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> clickThreshold: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pressThreshold: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, period: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pressedIsHigh: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> buttonInput = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> click = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> longPress = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) })</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">SHOCK!</b>  <b class="spoiler_title">SENSASI!</b>  <b class="spoiler_title">Untuk membuatnya bekerja, Anda hanya perlu ...</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cycleCounter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pressedCounter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) io.click := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> io.longPress := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> when (cycleCounter === <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) { when (pressedCounter &gt;= pressThreshold.asUInt) { io.longPress := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> }.elsewhen (pressedCounter &gt;= clickThreshold.asUInt) { io.click := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } cycleCounter := period.asUInt pressedCounter := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt } otherwise { cycleCounter := cycleCounter - <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt when (io.buttonInput === pressedIsHigh.<span class="hljs-type"><span class="hljs-type">B</span></span>) { pressedCounter := pressedCounter + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt } } }</code> </pre> </div></div><br><p>     : </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Oscilloscope</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, inputWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, windowPixelWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, windowPixelHeight: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> signal = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> visualOffset = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> start = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> output = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem = <span class="hljs-type"><span class="hljs-type">SyncReadMem</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> physicalPixel = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) when (io.start) { physicalPixel := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt } when (physicalPixel &lt; mem.length.asUInt) { mem.write(physicalPixel, io.signal) physicalPixel := physicalPixel + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> shiftedX = io.x + io.visualOffset <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> currentValue = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) currentValue := ((<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; inputWidth) - <span class="hljs-number"><span class="hljs-number">1</span></span>).asUInt - mem.read( <span class="hljs-type"><span class="hljs-type">Mux</span></span>(shiftedX &lt; mem.length.asUInt, shiftedX, (mem.length - <span class="hljs-number"><span class="hljs-number">1</span></span>).asUInt) ) when (io.x &gt; windowPixelWidth.asUInt || io.y &gt; windowPixelHeight.asUInt) { <span class="hljs-comment"><span class="hljs-comment">//  1 -  io.output := !( io.y &gt; (windowPixelHeight + 10).asUInt &amp;&amp; io.y &lt; (windowPixelHeight + 20).asUInt &amp;&amp; (io.x / clocksPerUs.asUInt)(0) ) } otherwise { // , ,  // signal / 2^inputWidth ~ y / windowPixelHeight // signal * windowPixelHeight ~ y * 2^inputWidth io.output := (currentValue * windowPixelHeight.asUInt &gt;= ((io.y - 5.asUInt) &lt;&lt; inputWidth).asUInt) &amp;&amp; (currentValue * windowPixelHeight.asUInt &lt;= ((io.y + 5.asUInt) &lt;&lt; inputWidth).asUInt) } }</span></span></code> </pre> <br><p>   ‚Äî ,   : </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OscilloscopeController</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> visibleWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, createButtonController: (</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleButtonController</span></span></span><span class="hljs-class"> ) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> button1 = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> button2 = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> visibleOffset = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> start = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> leds = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">4.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> controller1 = <span class="hljs-type"><span class="hljs-type">Module</span></span>(createButtonController()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> controller2 = <span class="hljs-type"><span class="hljs-type">Module</span></span>(createButtonController()) controller1.io.buttonInput &lt;&gt; io.button1 controller2.io.buttonInput &lt;&gt; io.button2 <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> offset = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> leds = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">4.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) io.start := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> when (controller1.io.longPress &amp;&amp; controller2.io.longPress) { offset := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt io.start := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> leds := leds + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt }.elsewhen (controller1.io.click) { offset := offset + (visibleWidth / <span class="hljs-number"><span class="hljs-number">10</span></span>).asUInt }.elsewhen (controller2.io.click) { offset := offset - (visibleWidth / <span class="hljs-number"><span class="hljs-number">10</span></span>).asUInt }.elsewhen (controller1.io.longPress) { offset := offset + visibleWidth.asUInt }.elsewhen (controller2.io.longPress) { offset := offset - visibleWidth.asUInt } io.visibleOffset := offset io.leds := leds }</code> </pre> <br><p>            (,   ),      - :           ‚Äî ,    ‚Äî  ,       (   ‚Äî  ).    ‚Äî       ! ,  Verilog  ?.. </p><br><p>     - ,    FPGA: </p><br><p><img src="https://habrastorage.org/webt/fz/bf/ig/fzbfigfaqcfjsuhwmrooccvryze.png" alt="Dari driver sinyal --- langsung ke grafik"></p><br><p>   ‚Äî  (      IO7,   VGA_GREEN  R-2R )        : </p><br><p><img src="https://habrastorage.org/webt/71/uy/x-/71uyx-fz7rf4c9kp2yw2pwxbed4.png" alt="Secara analog, lalu di &amp; quot; angka &amp; quot ;, dan kemudian --- pada grafik"></p><br><p>    ,  ‚Äî   ,  ,     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   PAL</a> ‚Äî "Picture At Last (-, !)" </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  GitHub</a> . </p><br><h2 id="vyvody">  Kesimpulan </h2><br><p> Scala + Chisel       ‚Äî    ,        Higher-kinded types.     Scala- ,   Chisel  ,       .             .   ‚Äî ! </p><br><p>   : "   -?" ‚Äî   ! <em>  ...</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id414995/">https://habr.com/ru/post/id414995/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id414981/index.html">Perpustakaan Tidak Tertulis</a></li>
<li><a href="../id414983/index.html">Alan Kay: Apa yang membuat Xerox PARC istimewa dan yang masih terlihat seperti mereka sekarang</a></li>
<li><a href="../id414989/index.html">Satelit ruang puing diluncurkan dari ISS</a></li>
<li><a href="../id414991/index.html">Deteksi dan pengenalan objek dari kamera di ROS menggunakan paket find_object_2d</a></li>
<li><a href="../id414993/index.html">Identifikasi dan klasifikasi komentar beracun. Kuliah di Yandex</a></li>
<li><a href="../id414997/index.html">ML-Blitz: analisis tugas babak kualifikasi pertama</a></li>
<li><a href="../id414999/index.html">3D Watchman and Thermistor Tester</a></li>
<li><a href="../id415001/index.html">Operator mobil robot Uber, yang menembak jatuh pengendara sepeda, menyaksikan Voice show pada saat tabrakan</a></li>
<li><a href="../id415003/index.html">Upload File Tidak Terbatas di Apple.com</a></li>
<li><a href="../id415005/index.html">Panel surya, perintah suara, dan balap off-road: sepeda listrik saat ini dan masa depan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>