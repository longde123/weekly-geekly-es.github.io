<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗡️ 😆 🚁 Apa yang perlu Anda ketahui sebelum pindah ke Akka toolkit untuk mengimplementasikan Pengadaan Acara dan CQRS 🚣🏻 🙏🏻 🥘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, para pembaca Habr. Nama saya Rustem dan saya adalah pengembang utama di perusahaan IT Kazakhstani DAR. Pada artikel ini saya akan memberi tahu A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apa yang perlu Anda ketahui sebelum pindah ke Akka toolkit untuk mengimplementasikan Pengadaan Acara dan CQRS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453418/"><p>  Halo, para pembaca Habr.  Nama saya Rustem dan saya adalah pengembang utama di perusahaan IT Kazakhstani DAR.  Pada artikel ini saya akan memberi tahu Anda apa yang perlu Anda ketahui sebelum pindah ke Peristiwa Sumber dan template CQRS menggunakan toolkit Akka. </p><br><p>  Sekitar 2015, kami mulai merancang ekosistem kami.  Setelah analisis dan berdasarkan pengalaman dengan Scala dan Akka, kami memutuskan untuk berhenti di toolkit Akka.  Kami memiliki implementasi sukses dari templat Sourcing Acara dengan CQRS dan tidak demikian.  Akumulasi keahlian di bidang ini, yang ingin saya bagikan dengan pembaca.  Kita akan melihat bagaimana Akka menerapkan pola-pola ini, serta alat apa yang tersedia dan berbicara tentang perangkap Akka.  Saya harap setelah membaca artikel ini, Anda akan lebih memahami risiko beralih ke Akka toolkit. </p><a name="habracut"></a><br><p>  Pada subjek CQRS dan Event Sourcing banyak artikel tentang Habré dan sumber daya lainnya ditulis.  Artikel ini ditujukan untuk pembaca yang sudah mengerti apa itu CQRS dan Event Sourcing.  Dalam artikel itu saya ingin berkonsentrasi pada Akka. </p><br><h3 id="domain-driven-design">  Desain berbasis domain </h3><br><p>  Banyak materi telah ditulis tentang Desain Domain-Driven (DDD).  Ada lawan dan pendukung dari pendekatan ini.  Saya ingin menambahkan sendiri bahwa jika Anda memutuskan untuk beralih ke Event Sourcing dan CQRS, maka tidak akan berlebihan untuk mempelajari DDD.  Selain itu, filosofi DDD sangat terasa di semua alat Akka. </p><br><p>  Faktanya, Event Sourcing dan CQRS hanyalah sebagian kecil dari gambaran besar yang disebut Domain-Driven Design.  Saat merancang dan mengembangkan, Anda mungkin memiliki banyak pertanyaan tentang bagaimana menerapkan pola-pola ini dengan baik dan mengintegrasikan ke dalam ekosistem, dan mengetahui DDD akan membuat hidup Anda lebih mudah. </p><br><blockquote>  Dalam artikel ini, istilah entitas (entitas oleh DDD) akan berarti Aktor Kegigihan yang memiliki pengidentifikasi unik. </blockquote><br><h3 id="pochemu-scala">  Mengapa scala? </h3><br><p>  Kita sering ditanya mengapa Scala, dan bukan Java.  Salah satu alasannya adalah Akka.  Kerangka kerja itu sendiri, ditulis dalam bahasa Scala dengan dukungan untuk bahasa Jawa.  Di sini saya harus mengatakan bahwa ada juga implementasi di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">.NET</a> , tetapi ini adalah topik lain.  Agar tidak menimbulkan diskusi, saya tidak akan menulis mengapa Scala lebih baik atau lebih buruk daripada Java.  Saya hanya akan memberi tahu Anda beberapa contoh bahwa, menurut pendapat saya, Scala memiliki keunggulan dibandingkan Jawa ketika bekerja dengan Akka: </p><br><ul><li> Benda yang tidak bisa berubah.  Di Jawa, Anda perlu menulis sendiri objek yang tidak dapat diubah.  Percayalah, tidak mudah dan tidak nyaman untuk selalu menulis parameter akhir.  Dalam <code>case class</code> Scala sudah tidak dapat diubah dengan fungsi <code>copy</code> bawaan </li><li>  Gaya pengkodean.  Ketika diimplementasikan di Jawa, Anda masih akan menulis dalam gaya Scala, yaitu secara fungsional. </li></ul><br><p>  Berikut adalah contoh implementasi aktor di Scala dan Java: </p><br><p>  <strong>Scala:</strong> </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DemoActor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">props</span></span></span></span>(magicNumber: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">Props</span></span> = <span class="hljs-type"><span class="hljs-type">Props</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">DemoActor</span></span>(magicNumber)) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DemoActor</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">magicNumber: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Actor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">receive</span></span></span><span class="hljs-function"> </span></span>= { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> x: <span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; sender() ! (x + magicNumber) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeOtherActor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Actor</span></span></span><span class="hljs-class"> </span></span>{ context.actorOf(<span class="hljs-type"><span class="hljs-type">DemoActor</span></span>.props(<span class="hljs-number"><span class="hljs-number">42</span></span>), <span class="hljs-string"><span class="hljs-string">"demo"</span></span>) <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  <strong>Jawa:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DemoActor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractActor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Props </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">props</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer magicNumber)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Props.create(DemoActor.class, () -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DemoActor(magicNumber)); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Integer magicNumber; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DemoActor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer magicNumber)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.magicNumber = magicNumber; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Receive </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> receiveBuilder() .match( Integer.class, i -&gt; { getSender().tell(i + magicNumber, getSelf()); }) .build(); } } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeOtherActor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractActor</span></span></span><span class="hljs-class"> </span></span>{ ActorRef demoActor = getContext().actorOf(DemoActor.props(<span class="hljs-number"><span class="hljs-number">42</span></span>), <span class="hljs-string"><span class="hljs-string">"demo"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  (Contoh diambil dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> ) </p><br><p>  Perhatikan implementasi metode <code>createReceive()</code> menggunakan contoh bahasa Java.  Secara internal, melalui pabrik <code>ReceiveBuilder</code> , pencocokan pola diterapkan.  <code>receiveBuilder()</code> adalah metode dari Akka untuk mendukung ekspresi lambda, yaitu pencocokan pola di Jawa.  Di Scala, ini diterapkan secara asli.  Setuju, kode dalam Scala lebih pendek dan lebih mudah dibaca. </p><br><ul><li>  Dokumentasi dan contoh-contoh.  Terlepas dari kenyataan bahwa dalam dokumentasi resmi ada contoh di Jawa, di Internet, hampir semua contoh ada di Scala.  Juga, akan lebih mudah bagi Anda untuk menavigasi di sumber-sumber perpustakaan Akka. </li></ul><br><blockquote>  Dalam hal kinerja, tidak akan ada perbedaan antara Scala dan Java, karena semuanya berputar di JVM. </blockquote><br><h3 id="hranilische">  Penyimpanan </h3><br><p>  Sebelum menerapkan Pengadaan Acara dengan Akka Persistence, saya sarankan Anda memilih dulu basis data untuk penyimpanan data permanen.  Pilihan pangkalan tergantung pada persyaratan untuk sistem, pada keinginan dan preferensi Anda.  Data dapat disimpan baik di NoSQL dan RDBMS, dan dalam sistem file, misalnya LevelDB dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Google</a> . </p><br><p>  Penting untuk dicatat bahwa Akka Persistence tidak bertanggung jawab untuk menulis dan membaca data dari database, tetapi melakukannya melalui plug-in yang seharusnya mengimplementasikan Akka Persistence API. </p><br><p>  Setelah memilih alat untuk menyimpan data, Anda perlu memilih <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">plugin</a> dari daftar, atau menulisnya sendiri.  Pilihan kedua, saya tidak merekomendasikan mengapa menemukan kembali roda. </p><br><p>  Untuk penyimpanan data permanen, kami memutuskan untuk tetap di Cassandra.  Faktanya adalah kami membutuhkan pangkalan yang andal, cepat, dan terdistribusi.  Selain itu, Typesafe sendiri menyertai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">plugin</a> , yang sepenuhnya mengimplementasikan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Akka Persistence API</a> .  Itu terus diperbarui dan dibandingkan dengan yang lain, plugin Cassandra telah menulis dokumentasi yang lebih lengkap. </p><br><p>  Perlu disebutkan bahwa plugin ini juga memiliki beberapa masalah.  Misalnya, masih belum ada versi stabil (pada saat penulisan ini, versi terbaru adalah 0,97).  Bagi kami, gangguan terbesar yang kami temui saat menggunakan plugin ini adalah hilangnya acara ketika membaca Persistent Query untuk beberapa entitas.  Untuk gambar lengkap, di bawah ini adalah bagan CQRS: </p><br><p><img src="https://habrastorage.org/webt/xd/3o/hk/xd3ohkb_wfvtfds2qangxxoctws.png"></p><br><p>  Persistent Entity mendistribusikan peristiwa entitas ke dalam tag menggunakan algoritma hash yang konsisten (misalnya, 10 pecahan): </p><br><p><img src="https://habrastorage.org/webt/eb/sq/zj/ebsqzjcj_nom7zs4pyizzkq5o0q.png"></p><br><p>  Lalu, Persistent Query berlangganan tag ini dan meluncurkan aliran yang menambahkan data ke Pencarian Elastis.  Karena Cassandra berada dalam sebuah cluster, acara akan tersebar di seluruh node.  Beberapa node dapat melorot dan akan merespons lebih lambat dari yang lain.  Tidak ada jaminan bahwa Anda akan menerima acara dalam urutan yang ketat.  Untuk mengatasi masalah ini, plugin diimplementasikan sehingga jika ia menerima peristiwa yang tidak berurutan, misalnya, <code>entity-A event NR 2</code> , maka ia menunggu waktu tertentu untuk acara awal dan jika tidak menerimanya, ia hanya akan mengabaikan semua peristiwa entitas ini.  Bahkan tentang ini, ada diskusi tentang Gitter.  Jika ada yang tertarik, Anda dapat membaca korespondensi antara @kotdv dan pengembang plugin: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Gitter</a> </p><br><p>  <strong>Bagaimana kesalahpahaman ini dapat diatasi:</strong> </p><br><ul><li>  Anda perlu memperbarui plugin ke versi terbaru.  Dalam versi terbaru, pengembang Typesafe telah memecahkan banyak masalah yang berkaitan dengan Konsistensi Akhirnya.  Tapi, kami masih menunggu versi stabil </li><li>  Pengaturan yang lebih tepat telah ditambahkan untuk komponen yang bertanggung jawab untuk menerima acara.  Anda dapat mencoba untuk meningkatkan batas waktu untuk acara yang tidak <code>assandra-query-journal.events-by-tag.eventual-consistency.delay=10s</code> untuk operasi plugin yang lebih andal: c <code>assandra-query-journal.events-by-tag.eventual-consistency.delay=10s</code> </li><li>  Konfigurasikan Cassandra seperti yang direkomendasikan oleh DataStax.  Masukkan pengumpul sampah G1 dan alokasikan memori sebanyak mungkin untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Cassandra</a> . </li></ul><br><p>  Pada akhirnya, kami memecahkan masalah dengan peristiwa yang hilang, tetapi sekarang ada penundaan data yang stabil di sisi Permintaan Persistensi (dari lima hingga sepuluh detik).  Diputuskan untuk meninggalkan pendekatan untuk data yang digunakan untuk analitik, dan di mana kecepatan penting, kami secara manual menerbitkan acara di bus.  Hal utama adalah memilih mekanisme yang sesuai untuk memproses atau memublikasikan data: paling tidak sekali atau paling banyak sekali.  Deskripsi yang baik dari Akka dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Penting bagi kami untuk menjaga konsistensi data, dan oleh karena itu, setelah berhasil menulis data ke database, kami memperkenalkan keadaan transisi yang mengontrol keberhasilan publikasi data di bus.  Berikut ini adalah contoh kode: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uuid</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> } <span class="hljs-comment"><span class="hljs-comment">/** * ,    . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DidSomething</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">uuid: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">/**</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class">. </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*/</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LastEventPublished</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">uuid: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">/**</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class">. </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">@param</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unpublishedEvents</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">–</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title"></span></span></span><span class="hljs-class">. </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*/</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">unpublishedEvents: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Event</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updated</span></span></span></span>(event: <span class="hljs-type"><span class="hljs-type">Event</span></span>): <span class="hljs-type"><span class="hljs-type">State</span></span> = event <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> evt: <span class="hljs-type"><span class="hljs-type">DidSomething</span></span> =&gt; copy( unpublishedEvents = unpublishedEvents :+ evt ) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> evt: <span class="hljs-type"><span class="hljs-type">LastEventPublished</span></span> =&gt; copy( unpublishedEvents = unpublishedEvents.filter(_.uuid != evt.uuid) ) } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeEntity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersistentActor</span></span></span><span class="hljs-class"> </span></span>{ … persist(newEvent) { evt =&gt; updateState(evt) publishToEventBus(evt) } … }</code> </pre> <br><p>  Jika karena alasan tertentu tidak mungkin untuk mempublikasikan acara, maka pada awal <code>SomeEntity</code> berikutnya, ia akan tahu bahwa acara <code>DidSomething</code> tidak mencapai bus dan akan mencoba untuk mempublikasikan ulang data lagi. </p><br><h3 id="serializator">  Serializer </h3><br><p>  Serialisasi adalah hal yang sama pentingnya dalam menggunakan Akka.  Dia memiliki modul internal - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Akka Serialisasi</a> .  Modul ini digunakan untuk membuat cerita bersambung saat bertukar antar aktor dan saat menyimpannya melalui Persistence API.  Secara default, Java serializer digunakan, tetapi disarankan untuk menggunakan yang lain.  Masalahnya adalah bahwa Java Serializer lambat dan membutuhkan banyak ruang.  Ada dua solusi populer - ini adalah JSON dan Protobuf.  JSON, meskipun lambat, lebih mudah diimplementasikan dan dipelihara.  Jika Anda perlu meminimalkan biaya serialisasi dan penyimpanan data, Anda bisa berhenti di Protobuf, tetapi kemudian proses pengembangannya akan lebih lambat.  Selain Model Domain, Anda harus menulis Model Data lain.  Jangan lupa tentang versi data.  Bersiaplah untuk terus menulis pemetaan antara Model Domain dan Model Data. </p><br><p><img src="https://habrastorage.org/webt/ag/fk/h0/agfkh04g1ykq5ymlxl0ma5ciwmo.png"></p><br><p>  Menambahkan acara baru - tulis pemetaan.  Mengubah struktur data - menulis versi baru Model Data dan mengubah fungsi pemetaan.  Jangan lupa tentang tes untuk serialis.  Secara umum, akan ada banyak pekerjaan, tetapi pada akhirnya Anda akan mendapatkan komponen yang digabungkan secara longgar. </p><br><h3 id="vyvody">  Kesimpulan </h3><br><ul><li>  Pelajarilah dengan hati-hati dan pilihlah basis dan plugin yang cocok untuk Anda sendiri.  Saya sarankan memilih plugin yang terpelihara dengan baik dan tidak akan berhenti berkembang.  Daerah ini relatif baru, masih ada banyak kekurangan yang belum diselesaikan </li><li>  Jika Anda memilih penyimpanan terdistribusi, Anda harus menyelesaikan masalah dengan penundaan hingga 10 detik sendiri, atau tahan dengan itu </li><li>  Kompleksitas serialisasi.  Anda dapat mengorbankan kecepatan dan berhenti menggunakan JSON, atau memilih Protobuf dan menulis banyak adaptor dan mendukungnya. </li><li>  Ada plus untuk templat ini, ini adalah komponen yang digabungkan secara longgar dan tim pengembangan independen yang membangun satu sistem besar. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id453418/">https://habr.com/ru/post/id453418/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id453408/index.html">Kotak Alat untuk Peneliti - Edisi Kedua: Kumpulan 15 Databank Tematik</a></li>
<li><a href="../id453410/index.html">Jangan membuang umbi pintar di tempat sampah, atau bahaya IoT</a></li>
<li><a href="../id453412/index.html">Top 3D Shop menjadi distributor eksklusif UFactory</a></li>
<li><a href="../id453414/index.html">Naik turunnya IEO, semua yang perlu Anda ketahui tentang gelombang baru penggalangan dana</a></li>
<li><a href="../id453416/index.html">Cara konfigurasi bekerja di .NET Core</a></li>
<li><a href="../id453422/index.html">Berkenalan dengan ITSM: 10 habratopik dan materi ahli untuk “pencelupan cepat” dalam topik ini</a></li>
<li><a href="../id453428/index.html">Meningkatkan keterbacaan kode dalam pengembangan iOS</a></li>
<li><a href="../id453430/index.html">Saat saya menulis pemantauan saya</a></li>
<li><a href="../id453432/index.html">Dari kritik hingga algoritma: suara para elit yang memudar di dunia musik</a></li>
<li><a href="../id453434/index.html">Fleksibilitas Cartridge: Sensor dalam Game untuk Game Boy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>