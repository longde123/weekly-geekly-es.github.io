<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ด๐ฝ ๐ท ๐๐ผ ูุฐูุฑุฉ. AVR ุจูุฒูุชุด ๐ฆ ๐ต ๐๐ผ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงูุฌููุฑ 
 ููุฏ ููุช ุจุงููุนู ุจุฅูุดุงุก ุนุฏุฏ ูู ุงูุฃุฌูุฒุฉ ุงูุฅููุชุฑูููุฉ ุงููุฎุชููุฉ ููููุงูุงุช ุ ููุฏู ููุฒุฉ ุบุฑูุจุฉ: ุฅุฐุง ูุงู ููุงู ุจุงุนุซ ุตูุช ููุฑุถุบุทูุฉ (ุฌุฑุณ) ุนูู ุงูููุญุฉ ุ ูุฃูุง ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุฐูุฑุฉ. AVR ุจูุฒูุชุด</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/402329/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/files/a62/a7b/0f9/a62a7b0f93e34b378c415b8d4b1873bb.jpg"><br><h3 style=";text-align:right;direction:rtl">  ุงูุฌููุฑ </h3><br>  ููุฏ ููุช ุจุงููุนู ุจุฅูุดุงุก ุนุฏุฏ ูู ุงูุฃุฌูุฒุฉ ุงูุฅููุชุฑูููุฉ ุงููุฎุชููุฉ ููููุงูุงุช ุ ููุฏู ููุฒุฉ ุบุฑูุจุฉ: ุฅุฐุง ูุงู ููุงู ุจุงุนุซ ุตูุช ููุฑุถุบุทูุฉ (ุฌุฑุณ) ุนูู ุงูููุญุฉ ุ ูุฃูุง ุ ุจุนุฏ ุงูุงูุชูุงุก ูู ุงูุนูู ุงูุฑุฆูุณู ูู ุงููุดุฑูุน ุ ุฃุจุฏุฃ ูู ุงููุนุงูุงุฉ ูู ุงููุฑุงุก ูุฌุนูู ููุนุจ ุฃูุญุงููุง ูุฎุชููุฉ (ูุฏุฑ ุงูุฅููุงู) )  ูู ุงููููุฏ ุจุดูู ุฎุงุต ุชุถููู ูุญู ูู ููุงูุฉ ุนูููุฉ ุทูููุฉ ูุฌุฐุจ ุงูุงูุชุจุงู.  ุนูู ุณุจูู ุงููุซุงู ุ ุงุณุชุฎุฏูุชู ุนูุฏูุง ุจููุช ูุงููุฑุง ุชุนุฑูุถ ุถูุฆู ูุคูุชุฉ ูุฅุถุงุกุฉ ููุงูู ุงูุถูุก ุ ุฅูุฎ. <br><br>  ูููู ุนูุฏูุง ุจุฏุฃุช ูู ุงูุจุญุซ ุนู ุฃูุซูุฉ ูุชูููุฏ ุงูุชุฑุฏุฏุงุช ูู AVR ุนูู ุงูุดุจูุฉ ุ ูุณุจุจ ูุง ุ ุตุงุฏูุช ูุดุงุฑูุน ูุญุดูุฉ ุฃู ุบูุฑ ููุฌุฒุฉ ุจูุง ูููู ูุชูููุฏ ุชูููุฏ ุงูุชุฑุฏุฏุงุช ุงูุตูุชูุฉ ุจุทุฑููุฉ ูุจุฑูุฌุฉ ุจุญุชุฉ.  ุซู ูุฑุฑุช ูุนุฑูุฉ ุฐูู ุจููุณู ... <br><a name="habracut"></a><br><h3 style=";text-align:right;direction:rtl">  ุงูุงุณุชุทุฑุงุฏ ุงูุบูุงุฆู </h3><br>  ุชุดูู ููุงูุชู ุฅูุดุงุก ุฃุฌูุฒุฉ ูุฎุชููุฉ ุนูู ูุญุฏุงุช ุงูุชุญูู ุงูุฏูููุฉ ุ ูุฃู ูุฐุง ูุง ูุชูุงุทุน ูุน ุฃุณุชุงุฐู.  ูุดุงุท (ุชุทููุฑ ุงูุจุฑูุฌูุงุช) ุ ุฃุนุชุจุฑ ููุณู ูู ุงูุนุตุงูููู ุงููุทูููู ุ ููู ุงูุฅููุชุฑูููุงุช ููุณุช ูููุฉ ุฌุฏูุง.  ูู ุงููุงูุน ุ ุฃูุง ุฃูุถู ุงููููุฑููููุชุฑููุฑ PIC ุ ูููู ุญุฏุซ ุฃู ุชุฑุงููุช ุนุฏุฏูุง ูุนูููุง ูู ุงููููุฑููููุชุฑููุฑ Atmel AVR (ุงูุขู Microchip).  ูู ุจุฅุฌุฑุงุก ุญุฌุฒ ุนูู ุงูููุฑ ูู ููู ูุฏู AVR ูู ูุฏู ุ ุฃู  ูุฐุง ูู ุฃูู ูุดุฑูุน ูู ุนูู Atmel MCU ุ ููู Atmega48pa.  ูููุฐ ุงููุดุฑูุน ููุณู ุจุนุถ ุงูุญูููุฉ ุ ูููู ููุง ุณุฃุตู ุฌุฒุกูุง ููู ูุชุนูู ุจุชูููุฏ ุชุฑุฏุฏุงุช ุตูุชูุฉ.  ุงุฎุชุจุงุฑ ุชูููุฏ ุงูุชุฑุฏุฏุงุช ุงูุฐู ุฃุณููุชู "buzic" ุ ูุงุฎุชุตุงุฑ ูููุณููู ุงูุฌุฑุณ.  ูุนู ุ ููุฏ ูุณูุช ุชูุฑูุจุงู: ูู ูุจุฑ ุ ููุงู ูุณุชุฎุฏู ูุญูู ููุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">buzic</a> ุ ุฃุฑุฏุช ุฃู ุฃุญุฐุฑ ุนูู ุงูููุฑ ูู ุฃู ูุฐู ุงููุฐูุฑุฉ ูุง ุชูุทุจู ุนููู ุนูู ุงูุฅุทูุงู ุ ููู ุญุงูุฉ ุงุนุชุฐุงุฑู ููุฑูุง ุนู ุงุณุชุฎุฏุงู ุชุฑููุจุฉ ุงูุญุฑูู "Buzic". <br><br><h3 style=";text-align:right;direction:rtl">  ูุฐุง ุฏุนูุง ูุฐูุจ </h3><br>  ุชุนุฑูุช ุนูู ุนุฏุฏ ูุจูุฑ ูู ุงูุฃูุซูุฉ ูู ุงูุดุจูุฉ - ูููุง ูุจููุฉ ุฅูุง ุนูู ุฃุจุณุท ุฏูุฑุฉ ูู ุงูุฌุณู ุงูุฑุฆูุณู ููุจุฑุงูุฌ ุงูุซุงุจุชุฉ ุ ุฃู ูู ุงููุทุงุน ุงููุคูุช.  ููููู ุฌููุนูุง ูุณุชุฎุฏููู ููุณ ุงูููุฌ ูุชูููุฏ ุงูุชุฑุฏุฏ: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุทุนุงู ูุณุชูู ุนุงู ููุฏู ูุชุญูู </li><li style=";text-align:right;direction:rtl">  ุฌุนู ุงูุชุฃุฎูุฑ </li><li style=";text-align:right;direction:rtl">  ุชุบุฐูุฉ ููุฎูุถุฉ ุฅูู ูุฏู ูุชุญูู </li></ol><br>  ุชุบููุฑ ุงูุชุฃุฎูุฑ ูุฅุนุฏุงุฏุงุช ุงููุคูุช - ุถุจุท ุงูุชุฑุฏุฏ. <br><br>  ูุฐุง ุงูููุฌ ูู ููุงุณุจูู ูุซูุฑูุง ุ ูุฃูู  ูู ููู ูุฏู ุฑุบุจุฉ ูู ูุชุงุจุฉ ููุฏ ููุชุญูู ุงููุฏูู ูู ูุฏู ูุชุญูู.  ุฃูุฏ ุฃู ูููู "ุงูุญุฌุฑ" ุจุชูููุฏ ุชุฑุฏุฏ ุงูุตูุช ุจุงููุณุจุฉ ูู ุ ููุฏ ููุช ููุชู ุจุชุนููู ููู ุจุนุถ ุงูุชุณุฌููุงุช ุ ูุจุงูุชุงูู ุชุบููุฑูุง (ุงูุชุฑุฏุฏ). <br><br>  ุนูุฏ ุฏุฑุงุณุฉ ูุฑูุฉ ุงูุจูุงูุงุช (ุงููุดุงุฑ ุฅูููุง ูููุง ููู ุจุงุณู DS) ุ ูุง ุฒูุช ุฃุฌุฏ ูุถุน ุงููููุช ุงูุฐู ุงุญุชุงุฌู - ููุฐุง ุงููุถุน ุ ููุง ูุฏ ุชููุนุช ุ ูู ูุถุน CTC (Clear Timer on Compare Match).  ูุธุฑูุง ูุฃู ูุธููุฉ ุชุดุบูู ุงูููุณููู ูู ุ ุจุนุจุงุฑุฉ ููุทูุฉ ุ ูููุณ ุงููุธููุฉ ุงูุฑุฆูุณูุฉ ุ ููุฏ ูุถูุช ุงุฎุชูุงุฑ ุงููุคูุช 2 ููุง (ุงูููุฑุฉ 22 ูู SD). <br><br>  ูุนูู ุงูุฌููุน ุฃู ุฃู ูุชุญูู ุชูุฑูุจูุง ูุฏูู ูุถุน ุชูููุฏ ุฅุดุงุฑุฉ PWM ูุชู ุชูููุฐู ุนูู ุงููุคูุชุงุช ููู ุฌูุงุฒ ุจุงููุงูู.  ูููู ูู ูุฐู ุงููููุฉ ุ PWM ููุณุช ููุงุณุจุฉ ูุฃู  ุณูุชู ุฅูุดุงุก ุชุฑุฏุฏ ูุงุญุฏ ููุท ูู ุงูุฃุฌูุฒุฉ.  ูุฐูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู PFM (ุชุนุฏูู ุชุฑุฏุฏ ุงููุจุถ).  ุจุนุถ ุงูุชุดุงุจู ุจูู PFM ูู ูุถุน ูุคูุช CTC (ุงูุจูุฏ 22.7.2 LH). <br><br><h3 style=";text-align:right;direction:rtl">  ูุถุน CTC </h3><br>  ุงููุคูุช 2 ูู ูุชุญูู Atmega48pa ูู 8 ุจุช ุ ุฃู ุฃูู "ูุฏู" ูู 0 ุฅูู 255 ุซู ูุฐูุจ ูู ุฏุงุฆุฑุฉ.  ุจุงูููุงุณุจุฉ ุ ูููู ุฃู ูุฐูุจ ุงููููุช ูู ุงุชุฌุงู ูุฎุชูู ุ ูููู ููุณ ูู ุญุงูุชูุง.  ุงููููู ุงููุทููุจ ุงูุชุงูู ูู ูุญุฏุฉ ุงูููุงุฑูุฉ.  ุชุญุฏุซ ุจุดูู ูุธ ุฌุฏูุง ุ ูุฐู ุงููุญุฏุฉ ูู ุงูุจุงุฏุฆ ุจุฃู ุฃุญุฏุงุซ ุชุชุนูู ุจุงููุคูุช.  ูููู ุฃู ุชููู ุงูุฃุญุฏุงุซ ูุฎุชููุฉ - ูุซู ุงูุงููุทุงุนุงุช ุ ูุงูุชุบูุฑุงุช ูู ูุณุชูู ุฃุฑุฌู ูุนููุฉ ูู ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ ุ ููุง ุฅูู ุฐูู (ูู ุงููุงุถุญ ุฃููุง ููุชููู ุจุงูุซุงูู).  ููุง ูุฏ ุชุฎูู ุ ูู ุชุชู ุชุณููุฉ ูุญุฏุฉ ุงูููุงุฑูุฉ ููุท - ุจู ุชูุงุฑู ูููุฉ ูุญุฏุฏุฉ ุชู ุชุญุฏูุฏูุง ุจูุงุณุทุฉ ูุทูุฑ ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ุจูููุฉ ุงููุคูุช ุงูุญุงููุฉ.  ุฅุฐุง ูุตูุช ูููุฉ ุงููุคูุช ุฅูู ุงููููุฉ ุงูุชู ุญุฏุฏูุงูุง ุ ูุณูุญุฏุซ ุญุฏุซ.  ูููู ุฃู ุชุญุฏุซ ุงูุฃุญุฏุงุซ ุฃูุถูุง ุนูุฏ ุชุฌุงูุฒ ุงููุคูุช ุฃู ุฃุซูุงุก ุฅุนุงุฏุฉ ุงูุชุนููู.  <b>ุญุณููุง ุ ููุฏ ุชูุตููุง ุฅูู ุงุณุชูุชุงุฌ ููุงุฏู ุฃูู ูู ุงูููุงุฆู ุจุงููุณุจุฉ ููุง ูู ุฃููุงุช ูุนููุฉ ุฃู ุงููุคูุช ุ ูุน ูุญุฏุฉ ุงูููุงุฑูุฉ ุ ูุบูุฑุงู ุจุดูู ูุณุชูู ูุณุชูู ุณูุญ ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ ุฅูู ุงูุงุชุฌุงู ุงููุนุงูุณ - ูุจุงูุชุงูู ูููุฏ ูุจุถุงุช.</b> <br><br>  ุงููููุฉ ุงูุซุงููุฉ ูู ุชุญุฏูุฏ ุงููุชุฑุงุช ุงููุงุตูุฉ ุจูู ูุฐู ุงููุจุถุงุช - ุฃู  ุงูุณูุทุฑุฉ ุนูู ูุชูุฑุฉ ุงูุฌูู.  ูููู ุงูุชูุฑุฏ ุงููุงูู ููุถุน CTC ูู ุญูููุฉ ุฃูู ูู ูุฐุง ุงููุถุน ูุง ููุชูู ุงููุคูุช ุฅูู ุงูููุงูุฉ (255) ุ ูููู ูุชู ุฅุนุงุฏุฉ ุชุนูููู ุนูุฏ ุงููุตูู ุฅูู ุงููููุฉ ุงููุญุฏุฏุฉ.  ููููุง ูุฐูู ุ ูู ุฎูุงู ุชุบููุฑ ูุฐู ุงููููุฉ ุ ูููููุง ุจุงููุนู ุงูุชุญูู ูู ุงูุชุฑุฏุฏ.  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูููุง ุจุชุนููู ูููุฉ ูุญุฏุฉ ุงูููุงุฑูุฉ ุฅูู 10 ุ ูุณูุญุฏุซ ุชุบูุฑ ุงููุณุชูู ุนูู ูุฏู ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ 20 ูุฑุฉ ุฃูุซุฑ ููุง ูู ูููุง ุจุชุนููููุง (ูููุฉ ูุญุฏุฉ ุงูููุงุฑูุฉ) ุนูู 200. <b>ุงูุขู ูููููุง ุงูุชุญูู ูู ุงูุชุฑุฏุฏ!</b> <br><br><img src="https://habrastorage.org/files/d45/90e/b7a/d4590eb7acd543a59fc71057cc6ae5b5.png"><br><br><h3 style=";text-align:right;direction:rtl">  ุญุฏูุฏ </h3><br><img src="https://habrastorage.org/files/8f9/dbb/8f5/8f9dbb8f514f4819863dff1a4dff4690.png"><br>  ูุธูุฑ ุฏุจูุณ ุงูุชุญูู ุงูุฏููู ุฃููุง ุจุญุงุฌุฉ ุฅูู ุฑุจุท ุงูุฌุฑุณ ุงูุฎุงุต ุจูุง ุฅูุง ุจุณุงู PB3 (OC2A) ุฃู ุณุงู PD3 (OC2B) ุ ูุฃู  OC2A ู OC2B ูุนููุงู ุฃูู ุนูู ูุฐู ุงูุฃุฑุฌู ุ ูููู ูููุคูุช 2 ุฃู ูููุฏ ุฅุดุงุฑุงุช. <br><br>  ุงููุฎุทุท ุงูุฐู ุฃุณุชุฎุฏูู ุนุงุฏุฉ ูุชูุตูู ุงูุฌุฑุณ ูู: <br><img src="https://habrastorage.org/files/8c8/a1e/7c6/8c8a1e7c67cf433989b5b94b89fa3e55.png"><br><br>  <b>ูููุฐุง ูููุง ุจุชุฌููุน ุงูุฌูุงุฒ.</b> <br><br><h3 style=";text-align:right;direction:rtl">  ูุณุฌู </h3><br>  ูู ุงูููุฑุฉ ุงูุณุงุจูุฉ ุ ูุฑุฑูุง ุงุฎุชูุงุฑ ุงูุณุงู - ูุฐุง ูู PB3 (OC2A) ุ ูุณูุนูู ูุนู.  ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู PD3 ุ ูุณูููู ูู ุดูุก ุจุงููุณุจุฉ ููุง ูู ููุณู ุ ูุงูุฐู ุณูููู ูุฑุฆููุง ุจูุถูุญ ูู ุงููุตุฉ. <br><br>  ุณูููู ุจุชูููู ุงููุคูุช 2 ุงูุฎุงุต ุจูุง ุนู ุทุฑูู ุชุบููุฑ 3 ุณุฌูุงุช: <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  TCCR2A - ุฅุนุฏุงุฏุงุช ุงููุถุน ูุงุฎุชูุงุฑ ุงูุณููู </li><li style=";text-align:right;direction:rtl">  TCCR2B - ุฅุนุฏุงุฏุงุช ุงููุถุน ูููุณู ุชุฑุฏุฏ ุงููุคูุช (ุฃูุถูุง ุจุชุงุช FOC - ูุง ูุณุชุฎุฏููุง) </li><li style=";text-align:right;direction:rtl">  OCR2A (OCR2B ูุญุงูุฉ ุณุงู PD3) - ูููุฉ ูุญุฏุฉ ุงูููุงุฑูุฉ </li></ol><br><br>  ุงููุธุฑ ุฃููุงู ูู ุชุณุฌููุงุช TCCR2A ู TCCR2B <br><img src="https://habrastorage.org/files/37b/def/522/37bdef52208b48b381b06405d9eddcb5.png"><br>  ููุง ุชุฑูู ุ ูุฏููุง 3 ูุฌููุนุงุช ูู ุงูุจุชุงุช ุงููููุฉ ุจุงููุณุจุฉ ููุง - ูุฐู ูู ุงูุจุชุงุช ูู ุณูุณูุฉ COM2xx ู WGM2x ู CS2x <br>  ุฃูู ุดูุก ูุญุชุงุฌ ุฅูู ุชุบููุฑู ูู WGM2x - ูุฐุง ูู ุงูุดูุก ุงูุฑุฆูุณู ูุงุฎุชูุงุฑ ูุถุน ุงูุฅูุดุงุก - ูุชู ุงุณุชุฎุฏุงู ูุฐู ุงูุจุชุงุช ูุชุญุฏูุฏ ูุถุน CTC. <br><br><img src="https://habrastorage.org/files/f34/28d/3e3/f3428d3e3ecc4e1aafcef3c82b061d23.png"><br>  <i>ููุญูุธุฉ: ูู ุงููุงุถุญ ูู LH ุฃู ุงูุฎุทุฃ ุงููุทุจุนู ูู "ุชุญุฏูุซ OCR0x at" ูุฌุจ ุฃู ูููู OCR2x</i> <br><br>  ุนูู ุณุจูู ุงููุซุงู  ุณูููู ุงูุฑูุฒ ุนูู ุงููุญู ุงูุชุงูู: <br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs">TCCR2A = _BV(WGM21) ;</code> </pre> <br>  ููุง ุชุฑูู ุ ูู ูุชู ุงุณุชุฎุฏุงู TCCR2B ุญุชู ุงูุขู.  ูุฌุจ ุฃู ูููู WGM22 ุตูุฑูุง ุ ููููู ุจุงููุนู ุตูุฑ. <br><br>  ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุชูููู ุจุช COM2xx ุ ุจุดูู ุฃูุซุฑ ุฏูุฉ COM2Ax - ูุฃูู  ูุญู ูุนูู ูุน ุงูุณุงู PB3 (ุชุณุชุฎุฏู PD3 COM2Bx ุจููุณ ุงูุทุฑููุฉ).  ูุง ุณูุญุฏุซ ูุณุงู PB3 ุงูุฎุงุตุฉ ุจูุง ูุนุชูุฏ ุนูููู. <br><br>  ุชุนุชูุฏ ุจุชุงุช COM2xx ุนูู ุงููุถุน ุงูุฐู ุงุฎุชุฑูุงู ูุน ุจุชุงุช WGM2x ุ ูุฐุง ุณูุชุนูู ุนูููุง ุงูุนุซูุฑ ุนูู ุงููุณู ุงูููุงุจู ูู LH.  ูุฃู  ูุฏููุง ูุถุน CTC ุ ุฃู  ููุณ PWM ุ ุซู ุงุจุญุซ ุนู ููุญุฉ "ููุงุฑูุฉ ูุถุน ุงูุฅุฎุฑุงุฌ ุ ุบูุฑ PWM" ุ ููู ููุง: <br><img src="https://habrastorage.org/files/771/054/3e2/7710543e25404353b1c1056cd3a58483.png"><br>  ููุง ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ "ุชุจุฏูู" - ุจุญูุซ ูุชุบูุฑ ุงููุณุชูู ุนูู ุงูุณุงู ุฅูู ุงูุนูุณ ุนูุฏูุง ูุตู ุงููุคูุช ุฅูู ุงููููุฉ ุงููุญุฏุฏุฉ.  ุชุบููุฑ ุงููุณุชูู ุงููุณุชูุฑ ูุชูููุฐ ุชูููุฏ ุงูุชุฑุฏุฏ ุงูุฐู ูุญุชุงุฌู. <br><br>  ูุฃู  ุจุชุงุช COM2xx ููุฌูุฏุฉ ุฃูุถูุง ูู ุณุฌู TCCR2A - ููุท ุชุชุบูุฑ: <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">TCCR2A = _BV(COM2A0) | _BV(WGM21) ;</code> </pre><br>  ุจุทุจูุนุฉ ุงูุญุงู ุ ุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุชุญุฏูุฏ ููุณู ุงูุชุฑุฏุฏ ุจุงุณุชุฎุฏุงู ุจุชุงุช CS2x ุ ูุจุงูุทุจุน ุ ูู ุจุชุนููู ูุฏู PB3 ุนูู ุงูุฅุฎุฑุงุฌ ... ูููููุง ูู ููุนู ุฐูู ุญุชู ุงูุขู ุนูุฏูุง ูุฏูุฑ MK ุ ูู ูุญุตู ุนูู ุตุฑุฎุฉ ุฎุงุฑูุฉ ุจุชุฑุฏุฏ ุบูุฑ ููููู ุ ูููู ุนูุฏูุง ูููู ุจูู ุงูุฅุนุฏุงุฏุงุช ุงูุฃุฎุฑู ู ุจุฏูุฑู ุนูู ุงููุฏู ููุฎุฑูุฌ - ุณูุชู ูุตูู ุฃุฏูุงู. <br><br>  ูุฐูู ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ุงูุชููุฆุฉ ุงููุงููุฉ: <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;avr/io.h&gt; //set bit - using bitwise OR operator #define sbi(x,y) x |= _BV(y) //clear bit - using bitwise AND operator #define cbi(x,y) x &amp;= ~(_BV(y)) #define BUZ_PIN PB3 void timer2_buzzer_init() { // PB3 cbi(PORTB, BUZ_PIN); // PB3  ,    cbi(DDRB, BUZ_PIN); //  TCCR2A = _BV(COM2A0) | _BV(WGM21) ; //   (      ) OCR2A = 0; }</span></span></span></span></code> </pre><br>  ุงุณุชุฎุฏูุช ูุญุฏุงุช ูุงูุฑู cbi ู sbi (ุชุฌุณุณุช ูู ููุงู ูุง ุนูู ุงูุดุจูุฉ) ูุชุนููู ุงูุจุชุงุช ุงููุฑุฏูุฉ ุ ูุชุฑูุชูุง ุจูุฐู ุงูุทุฑููุฉ.  ุชู ูุถุน ูุญุฏุงุช ุงููุงูุฑู ูุฐู ุจุงูุทุจุน ูู ููู ุงูุฑุฃุณ ุ ูููู ูู ุฃุฌู ุงููุถูุญ ุ ุฃุถุนูุง ููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ุญุณุงุจ ุชูุฑุงุฑ ููุฏุฉ ุงูููุงุญุธุงุช </h3><br>  ุงูุขู ูุฃุชู ุฅูู ุฌููุฑ ุงููุณุฃูุฉ.  ููุฐ ุจุนุถ ุงูููุช ุ ุญุงูู ูุนุงุฑู ุงูููุณููููู ุฃู ูุฏูุนูุง ุฅูู ุฏูุงุบู ูุจุฑูุฌูุง ุจุนุถ ุงููุนูููุงุช ุญูู ุงูุทุงูู ุงูููุณููู ุ ูุงู ุฏูุงุบู ูุบูู ุชูุฑูุจูุง ุ ููููู ูุง ุฒูุช ุฃุญุถุฑ ุญุจุฉ ูููุฏุฉ ูู ูุฐู ุงููุญุงุฏุซุงุช. <br>  ุฃุญุฐุฑู ุนูู ุงูููุฑ - ูู ุงููููู ูุฌูุฏ ุฃุฎุทุงุก ูุจูุฑุฉ. <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชููู ูู ูููุงุณ ูู 4 ุฃุฑุจุงุน </li><li style=";text-align:right;direction:rtl">  ูู ูุญู ูู ุฅููุงุน - ุฃู  ุนุฏุฏ ูุฐู ุงูุฃุฑุจุงุน ูู ุงูุฏูููุฉ </li><li style=";text-align:right;direction:rtl">  ูููู ุนุฒู ูู ูุบูุฉ ููููุงุณ ูุงูู ุ ููุฐูู ุฌุฒุกู 1/2 ุ 1/3 ุ 1/4 ุ ุฅูุฎ. </li><li style=";text-align:right;direction:rtl">  ูู ููุงุญุธุฉ ุ ุจุงูุทุจุน ุ ููุง ุชุฑุฏุฏ ูุนูู </li></ol><br>  ููุฏ ุฏุฑุณูุง ุงูุญุงูุฉ ุงูุฃูุซุฑ ุดููุนูุง ุ ูู ุงููุงูุน ุ ูู ุดูุก ุฃูุซุฑ ุชุนููุฏูุง ููุงู ุ ุนูู ุงูุฃูู ุจุงููุณุจุฉ ูู ุ ูุฐูู ูู ุฃูุงูุด ูุฐุง ุงูููุถูุน ูู ุฅุทุงุฑ ูุฐู ุงููุตุฉ. <br><br>  ุญุณููุง ุ ุญุณููุง ุ ุณูุนูู ูุน ูุง ูุฏููุง.  ุงูุดูุก ุงูุฃูุซุฑ ุฃูููุฉ ุจุงููุณุจุฉ ููุง ูู ุงูุญุตูู ูู ููุงูุฉ ุงููุทุงู ุนูู ุชูุฑุงุฑ ุงููุฐูุฑุฉ (ูู ุงููุงูุน ุ ูููุฉ ุณุฌู OCR2A) ููุฏุชูุง ุ ุนูู ุณุจูู ุงููุซุงู ุ ุจุงููููู ุซุงููุฉ.  ููููุง ูุฐูู ุ ูู ุงูุถุฑูุฑู ุฅุฌุฑุงุก ุจุนุถ ุงูุญุณุงุจุงุช. <br><br>  ูุฃู  ูุญู ูู ุฅุทุงุฑ ูุบุฉ ุจุฑูุฌุฉ ุ ุงูุฃูุญุงู ุฃุณูู ูู ุงูุชุฎุฒูู ูู ูุตูููุฉ.  ุงูุทุฑููุฉ ุงูุฃูุซุฑ ููุทููุฉ ูุชุนููู ูู ุนูุตุฑ ูู ุนูุงุตุฑ ุงูุตููู ูู ุงูุชูุณูู ูู ููุงุญุธุฉ + ุงููุฏุฉ.  ูู ุงูุถุฑูุฑู ุญุณุงุจ ุญุฌู ุงูุนูุตุฑ ุจุงูุจุงูุช ุ ูุฃููุง ููุชุจ ุชุญุช ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ ููุน ูุฌูุฏ ุงูููุงุฑุฏ ููุง ููู ุถูู - ููุฐุง ูุนูู ุฃู ุญุฌู ุงูุนูุตุฑ ุจุงูุจุงูุช ูุฌุจ ุฃู ูููู ูุงูููุง. <br><br><h4 style=";text-align:right;direction:rtl">  ุงูุชุฑุฏุฏ </h4><br>  ููุจุฏุฃ ุจุงูุชุฑุฏุฏ.  ูุฃู  ูุฏููุง ูุคูุช 8 ุจุช 2 ุ ุณุฌู ุงูููุงุฑูุฉ OCR2A ูู ุฃูุถุง 8 ุจุช.  ุฃู ุฃู ุนูุตุฑ ูุตูููุฉ ุงููุญู ุงูุฎุงุต ุจูุง ุณูููู ุจุงููุนู 2 ุจุงูุช ุนูู ุงูุฃูู ุ ูุฃูู ูุง ุฒูุช ุจุญุงุฌุฉ ุฅูู ุญูุธ ุงููุฏุฉ.  ูู ุงููุงูุน ุ 2 ุจุงูุช ูู ุงูุญุฏ ุงูุฃูุตู ููุฐุง ุงูููุน ูู ุงูุญุฑู.  ูุง ุฒููุง ูุง ูุญุตู ุนูู ุตูุช ุฌูุฏ ุ ุจุตุฑุงุญุฉ ุ ูุฅููุงู ุงููุฒูุฏ ูู ูุญุฏุงุช ุงูุจุงูุช ุฃูุฑ ุบูุฑ ูุนููู.  <b>ูุฐุง ุ ุชููููุง ุนูุฏ 2 ุจุงูุช.</b> <br><br>  <b>ุนูุฏ ุญุณุงุจ ุงูุชุฑุฏุฏ ุ ูู ุงููุงูุน ุ ุชุธูุฑ ูุดููุฉ ูุจูุฑุฉ ุฃุฎุฑู.</b> <br>  ุฅุฐุง ูุธุฑุช ุฅูู ุชุฑุฏุฏุงุช ุงูููุงุญุธุงุช ุ ูุณูู ูุฑู ุฃููุง ููุณูุฉ ุฅูู ุฃููุชุงู. <br><img src="https://habrastorage.org/files/240/294/17a/24029417a547408aa6806c9ddf66d593.jpg"><br>  ุจุงููุณุจุฉ ุฅูู ูุนุธู ุงูุฃูุญุงู ุงูุจุณูุทุฉ ุ ูููู 3 ุฃููุชุงู ุ ููููู ูุฑุฑุช ุงููุฑุงูุบุฉ ูุชูููุฐ 6: ูุจูุฑุฉ ูุตุบูุฑุฉ ูุงูุฃุฑุจุน ุงูุชุงููุฉ. <br><br>  ุงูุขู ุฏุนูุง ูุชุทุฑู ุฅูู ุงูููุณููู ููุบุฑู ูู ุนุงูู ุจุฑูุฌุฉ ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ. <br>  ุฃู ุฌูุงุฒ ุชูููุช ูู AVR (ูุงูุบุงูุจูุฉ ุงูุนุธูู ูู MK ุงูุขุฎุฑ) ูุฑุชุจุท ุจุชุฑุฏุฏ MK ููุณู.  ุชุฑุฏุฏ ุงูููุงุฑุชุฒ ูู ุฏุงุฆุฑุชู ูู 16 ููุฌุง ูุฑุชุฒ.  ูุชู ุชุญุฏูุฏ ููุณ ุงูุชุฑุฏุฏ ุจูุงุณุทุฉ F_CPU "ุชุนุฑูู" ููููู ูุณุงูููุง ูู 16000000 ูู ุญุงูุชู. ูู ุณุฌู TCCR2B ุ ูููููุง ุชุญุฏูุฏ ููุณูุงุช ุงูุชุฑุฏุฏ ุจุญูุซ ูุง ูููู "ุงููุคูุช" 2 ุงูุฎุงุต ุจูุง "ุจุชุญุฏูุฏ" ุจุณุฑุนุฉ ูุญูููุฉ ุชุจูุบ 16000000 ูุฑุฉ ูู ุงูุซุงููุฉ ุ ูููู ุฃุจุทุฃ ููููุงู.  ูุชู ุงุฎุชูุงุฑ ููุณู ุงูุชุฑุฏุฏ ุจูุงุณุทุฉ ุจุชุงุช CS2x ุ ููุง ูู ูุฐููุฑ ุฃุนูุงู. <br><br><img src="https://habrastorage.org/files/9bd/ca6/247/9bdca624740e4dd787574c6604291dc3.png"><br>  <i>ููุญูุธุฉ: ูู ุงููุงุถุญ ุฃูู ูู LH ูุฌุจ ุฃู ูููู ุงูุฎุทุฃ ุงููุทุจุนู ุจุฏูุงู ูู "CA2x" ูู CS2x</i> <br><br>  ุงูุณุคุงู ุงูุฐู ูุทุฑุญ ููุณู - ููููุฉ ุชูููู ุงููุงุตูุ <br><br>  ููููุงู ุจุฐูู ุ ุชุญุชุงุฌ ุฅูู ููู ููููุฉ ุญุณุงุจ ููู ุณุฌู OCR2A.  ูุญุณุงุจู ุจุณูุท ููุบุงูุฉ: <br>  <b>OCR2A = F_CPU / (ููุณู ุชุฑุฏุฏ ุงูููุงุฑุชุฒ * 2) / ุชุฑุฏุฏ ุงูููุงุญุธุฉ</b> <br>  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุจุชุฏููู ุงูููุงุญุธุฉ ูุจู ุงูุฃููุชุงู ุงูุฃูู ูุงูููุณูู 256 (CS22 = 1 ุ CS21 = 1 ุ CS20 = 0): <br>  OCR2A = 16000000 / (256 * 2) / 261 = 119 <br><br>  ุณุฃุดุฑุญ ุนูู ุงูููุฑ ูู ุฃูู ุฌุงุก ุงูุถุฑุจ ูู 2. ูุงูุญูููุฉ ูู ุฃููุง ุญุฏุฏูุง ูุถุน "ุชุจุฏูู" ูุน ุชุณุฌููุงุช COM2Ax ุ ููุง ูุนูู ุฃู ุชุบููุฑ ุงููุณุชููุงุช ูู ุงููุฏู ูู ุงูุฃุฏูู ุฅูู ุงูุฃุนูู (ุฃู ุงูุนูุณ) ูุงูุนูุณ ุณูุญุฏุซ ูู ูุฑูุฑูู ูู ุงููุคูุช: ุฃููุงู ูุตู ุงููููุช ุฅูู ูููุฉ OCR2A ููุบูุฑ ูุฏู ูุญุฏุฉ ุงูุชุญูู ุงูุฏูููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู 1 ุฅูู 0 ุ ููุชู ุฅุนุงุฏุฉ ุชุนูููู ููุท ูู ุงูููุฉ ุงูุซุงููุฉ ูุชุบูุฑ ูู 0 ุฅูู 1. ูุฐูู ุ ูุฅู ููุชูู ูู ุงููููุช ุชุฐูุจ ููู ููุฌุฉ ูุงููุฉ ุ ุนูู ุงูุชูุงูู ุ ูุฌุจ ุถุฑุจ ุงูููุณูู ุนูู 2 ุ ูุฅูุง ูุฅููุง ูุญุตู ููุท ูุตู ุชูุงุชุฑ ููุงุญุธุชูุง. <br><br>  ููู ููุง ุงููุตูุจุฉ ุงููุฐููุฑุฉ ุฃุนูุงู ... <br><br>  ุฅุฐุง ุฃุฎุฐูุง ุงูููุงุญุธุฉ ูุจู ุงูุฃููุชุงู ุงููุจูุฑ ูุชุฑููุง ุงูููุณูู ุนููู 256: <br>  OCR2A = 16000000 / (256 * 2) / 65 = 480 !!! <br>  <b>480 - ูู ุงููุงุถุญ ุฃู ูุฐุง ุงูุฑูู ุฃูุซุฑ ูู 255 ููุง ูุชูุงุณุจ ูุนูููุง ูุน ุณุฌู OCR2A 8 ุจุช.</b> <br><br>  ูุงุฐุง ุชูุนูุ  ูู ุงููุงุถุญ ุฃู ุชุบููุฑ ุงูููุณู ุ ูููู ุฅุฐุง ูุถุนูุง ุงูููุณู 1024 ุ ูุณูููู ูู ุดูุก ุนูู ูุง ูุฑุงู ูุน ุงููุชุงู ูุจูุฑ.  ุณุชุจุฏุฃ ุงููุดุงูู ุจุงูุฃููุชุงูุงุช ุงูุนููุง: <br>  ููุณ ุงูุฑุงุจุน ุฃููุชุงู - OCR2A = 16000000 / (1024 * 2) / 3520 = 4 <br>  ุงููุชุงู ุฑุงุจุน ุญุงุฏ - OCR2A = 16000000 / (1024 * 2) / 3729 = 4 <br>  <b>ูู ุชุนุฏ ููู OCR2A ูุฎุชููุฉ ุ ููุง ูุนูู ุฃู ุงูุตูุช ุณูุชููู ุฃูุถูุง ุนู ุงูุงุฎุชูุงู.</b> <br><br>  <b>ููุงู ุทุฑููุฉ ูุงุญุฏุฉ ููุฎุฑูุฌ: ูุชูุฑุงุฑ ุงูููุงุญุธุงุช ุ ุชุญุชุงุฌ ุฅูู ุชุฎุฒูู ููุณ ููุท ููู ุณุฌู OCR2A ุ ูููู ุฃูุถูุง ุจุชุงุช ูู ููุณู ุชุฑุฏุฏ ุงูููุงุฑุชุฒ.</b>  <b>ูุฃู</b>  <b>ุจุงููุณุจุฉ ูุฃููุชุงูุงุช ูุฎุชููุฉ ุ ุณุชููู ููุงู ูููุฉ ูุฎุชููุฉ ูููุณู ุชุฑุฏุฏ ุงูููุงุฑุชุฒ ุ ูุงูุฐู ุณูุญุชุงุฌ ุฅูู ุชุนูููู ูู ุณุฌู TCCR2B!</b> <br><br>  ุงูุขู ูู ุดูุก ูุณูุฑ ูู ููุงูู - ูุดุฑุญุช ุฃุฎูุฑูุง ููุงุฐุง ูู ูุชููู ูู ููุก ูููุฉ ุงูููุณูู ุนูู ุงูููุฑ ูู ุงูุฏุงูุฉ timer2_buzzer_init (). <br><br>  ูุณูุก ุงูุญุธ ุ ูุฅู ููุณู ุงูุชุฑุฏุฏ ูู 3 ุจุชุงุช ุฃุฎุฑู.  ููุฌุจ ุฃู ุชุคุฎุฐ ูู ุงูุจุงูุช ุงูุซุงูู ูู ุนูุตุฑ ูุฌููุนุฉ ุงููุญู. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุญูุง ูุญุฏุงุช ุงููุงูุฑู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DIV_MASK (_BV(CS20) | _BV(CS21) | _BV(CS22)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DIV_1024 (_BV(CS20) | _BV(CS21) | _BV(CS22)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DIV_256 (_BV(CS21) | _BV(CS22)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DIV_128 (_BV(CS20) | _BV(CS22)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DIV_64 _BV(CS22) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DIV_32 (_BV(CS20) | _BV(CS21)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NOTE_1024( x ) ((F_CPU / (1024 * 2) / x) | (DIV_1024 &lt;&lt; 8)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NOTE_256( x ) ((F_CPU / (256 * 2) / x) | (DIV_256 &lt;&lt; 8)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NOTE_128( x ) ((F_CPU / (128 * 2) / x) | (DIV_128 &lt;&lt; 8)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NOTE_64( x ) ((F_CPU / (64 * 2) / x) | (DIV_64 &lt;&lt; 8)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NOTE_32( x ) ((F_CPU / (32 * 2) / x) | (DIV_32 &lt;&lt; 8)) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  #define DOB NOTE_1024( 65 ) #define DO_B NOTE_1024( 69 ) #define REB NOTE_1024 ( 73 ) #define RE_B NOTE_1024 ( 78 ) #define MIB NOTE_1024 ( 82 ) #define FAB NOTE_1024 ( 87 ) #define FA_B NOTE_1024 ( 93 ) #define SOLB NOTE_1024 ( 98 ) #define SOL_B NOTE_1024 ( 104 ) #define LAB NOTE_1024 ( 110 ) #define LA_B NOTE_1024 ( 116 ) #define SIB NOTE_1024 ( 123 ) //  #define DOS NOTE_256( 131 ) #define DO_S NOTE_256( 138 ) #define RES NOTE_256 ( 146 ) #define RE_S NOTE_256 ( 155 ) #define MIS NOTE_256 ( 164 ) #define FAS NOTE_256 ( 174 ) #define FA_S NOTE_256 ( 185 ) #define SOLS NOTE_256 ( 196 ) #define SOL_S NOTE_256 ( 207 ) #define LAS NOTE_256 ( 219 ) #define LA_S NOTE_256 ( 233 ) #define SIS NOTE_256 ( 246 ) //  #define DO1 NOTE_256( 261 ) #define DO_1 NOTE_256( 277 ) #define RE1 NOTE_256 ( 293 ) #define RE_1 NOTE_256 ( 310 ) #define MI1 NOTE_256 ( 329 ) #define FA1 NOTE_256 ( 348 ) #define FA_1 NOTE_256 ( 369 ) #define SOL1 NOTE_256 ( 391 ) #define SOL_1 NOTE_256 ( 414 ) #define LA1 NOTE_256 ( 439 ) #define LA_1 NOTE_256 ( 465 ) #define SI1 NOTE_256 ( 493 ) //  #define DO2 NOTE_128( 522 ) #define DO_2 NOTE_128( 553 ) #define RE2 NOTE_128 ( 586 ) #define RE_2 NOTE_128 ( 621 ) #define MI2 NOTE_128 ( 658 ) #define FA2 NOTE_128 ( 697 ) #define FA_2 NOTE_128 ( 738 ) #define SOL2 NOTE_128 ( 782 ) #define SOL_2 NOTE_128 ( 829 ) #define LA2 NOTE_128 ( 878 ) #define LA_2 NOTE_128 ( 930 ) #define SI2 NOTE_128 ( 985 ) //  #define DO3 NOTE_64( 1047 ) #define DO_3 NOTE_64( 1109 ) #define RE3 NOTE_64 ( 1175 ) #define RE_3 NOTE_64 ( 1245 ) #define MI3 NOTE_64 ( 1319 ) #define FA3 NOTE_64 ( 1397 ) #define FA_3 NOTE_64 ( 1480 ) #define SOL3 NOTE_64 ( 1568 ) #define SOL_3 NOTE_64 ( 1661 ) #define LA3 NOTE_64 ( 1760 ) #define LA_3 NOTE_64 ( 1865 ) #define SI3 NOTE_64 ( 1976 ) //  #define DO4 NOTE_32( 2093 ) #define DO_4 NOTE_32( 2217 ) #define RE4 NOTE_32 ( 2349 ) #define RE_4 NOTE_32 ( 2489 ) #define MI4 NOTE_32 ( 2637 ) #define FA4 NOTE_32 ( 2794 ) #define FA_4 NOTE_32 ( 2960 ) #define SOL4 NOTE_32 ( 3136 ) #define SOL_4 NOTE_32 ( 3322 ) #define LA4 NOTE_32 ( 3520 ) #define LA_4 NOTE_32 ( 3729 ) #define SI4 NOTE_32 ( 3951 )</span></span></span></span></code> </pre><br></div></div><br><br>  ูููุฏุฉ ุงูููุงุญุธุฉ ุ ูู ูุชุจู ูุฏููุง ุณูู 5 ุจุชุงุช ุ ูุฐุง ุฏุนูุง ูุญุณุจ ุงููุฏุฉ. <br><br><h4 style=";text-align:right;direction:rtl">  ุงููุฏุฉ </h4><br>  ุชุญุชุงุฌ ุฃููุงู ุฅูู ุชุฑุฌูุฉ ูููุฉ ุงูุฅููุงุน ุฅูู ูุญุฏุงุช ูุคูุชุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ุจุงููููู ุซุงููุฉ) - ููุฏ ูุนูุช ุฐูู ุนูู ุงููุญู ุงูุชุงูู: <br>  <b>ูุฏุฉ ุงูุชุฏุจูุฑ ุงูููุณููู ุจุงููููุฉ ms = (60ุ000 ms * 4 ุฃุฑุจุงุน) / ูููุฉ ุงูุฅููุงุน.</b> <br><br>  ููููุง ูุฐูู ุ ุฅุฐุง ููุง ูุชุญุฏุซ ุนู ุฃุฌุฒุงุก ุงูุถุฑุจ ุ ููุฌุจ ุชูุณูู ูุฐู ุงููููุฉ ุ ููู ุงูุจุฏุงูุฉ ุงุนุชูุฏุช ุฃู ุงูุชุญูู ุงูุฃูุณุฑ ุงููุนุชุงุฏ ููููุงุตู ุณูููู ูุงูููุง.  ุนูู ุณุจูู ุงููุซุงู  ุงูุฑูุฒ ูุงู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> calc_note_delay(<span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> precalced_tempo, <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> note) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (precalced_tempo / _BV((note &gt;&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0b00111</span></span>)); }</code> </pre> <br><br>  ุนูู ุณุจูู ุงููุซุงู  ุงุณุชุฎุฏูุช 3 ุจุชุงุช (ูู ุงูุฎูุณ ุงููุชุจููุฉ) ูุญุตูุช ุนูู ุฃุฌุฒุงุก ูู ุงูุฅููุงุน ุงูููุณููู ูู ุฏุฑุฌุงุช 2 ุฅูู 1/128.  ูููู ุนูุฏูุง ุฃุนุทูุช ุตุฏูููุง ูุทูุจ ููู ุฃู ุฃูุชุจ ููุนูุง ูู ูุบูุฉ ุงูุฑููู ุฅูู ูุทุนุฉ ุงูุญุฏูุฏ ุงูุฎุงุตุฉ ุจู ุ ูุงูุช ููุงู ุฃุณุฆูุฉ ููุงุฐุง ูุง ููุฌุฏ 1/3 ุฃู 1/6 ูุจุฏุฃุช ุฃููุฑ ... <br><br>  ูู ุงูููุงูุฉ ุ ููุช ุจุนูู ูุธุงู ุตุนุจ ููุญุตูู ุนูู ูุซู ูุฐู ุงููุชุฑุงุช.  ุจุช ูุงุญุฏ ูู 2x ุงููุชุจููุฉ - ูุถูุช ุนูู ุนูุงูุฉ ุงูุถุฑุจ ุจููุฏุงุฑ 3 ูููุณู ุงูุณุงุนุฉ ุงูุฐู ุชู ุงูุญุตูู ุนููู ุจุนุฏ ุงูุชุญูู.  ูุงูุจุช ุงูุฃุฎูุฑ ูู ุชูุถูุญ ูุง ุฅุฐุง ูุงู ูู ุงูุถุฑูุฑู ุทุฑุญ 1. ูุฐุง ูู ุงูุตุนุจ ูุตูู ุ ููู ุงูุฃุณูู ุฑุคูุฉ ุงูุฑูุฒ: <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> calc_note_delay(<span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> precalced_tempo, <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> note) { note &gt;&gt;= <span class="hljs-number"><span class="hljs-number">11</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> divider = _BV(note &amp; <span class="hljs-number"><span class="hljs-number">0b00111</span></span>); note &gt;&gt;= <span class="hljs-number"><span class="hljs-number">3</span></span>; divider *= ((note &amp; <span class="hljs-number"><span class="hljs-number">0b01</span></span>) ? <span class="hljs-number"><span class="hljs-number">3</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>); divider -= (note &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (precalced_tempo / divider); }</code> </pre> <br>  ุซู ููุช "ุจุชุนุฑูู" ุฌููุน ุงูููุงุญุธุงุช ุงูููููุฉ (ุจุงุณุชุซูุงุก ุชูู ุงูุชู ูู ุฃูู ูู 1/128). <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุง ูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_MINUS_1 0b10000 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_MUL_3 0b01000 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1 0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N2 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N3 (2 | DEL_MINUS_1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N4 2 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N5 (1 | DEL_MINUS_1 | DEL_MUL_3) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N6 (1 | DEL_MUL_3) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N7 (3 | DEL_MINUS_1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N8 3 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N11 (2 | DEL_MUL_3 | DEL_MINUS_1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N12 (2 | DEL_MUL_3) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N15 (4 | DEL_MINUS_1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N16 4 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N23 (3 | DEL_MUL_3 | DEL_MINUS_1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N24 (3 | DEL_MUL_3) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N31 (5 | DEL_MINUS_1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N32 5 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N47 (4 | DEL_MUL_3 | DEL_MINUS_1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N48 (4 | DEL_MUL_3) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N63 (6 | DEL_MINUS_1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N64 6 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N95 (5 | DEL_MUL_3 | DEL_MINUS_1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N96 (5 | DEL_MUL_3) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N127 (7 | DEL_MINUS_1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEL_1N128 7</span></span></code> </pre><br></div></div><br><br><h4 style=";text-align:right;direction:rtl">  ุถุน ูู ุฐูู ูุนูุง </h4><br>  ุงูุฅุฌูุงูู ุ ูุฏููุง ุงูุชูุณูู ุงูุชุงูู ูุนูุตุฑ ูุฌููุนุฉ ูุบูุงุช ุงูุฑููู. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  1 ุจุช: ููุณู ุงูุชุฃุฎูุฑ - 1 </li><li style=";text-align:right;direction:rtl">  1 ุจุช: ููุณู ุงูุชุฃุฎูุฑ * 3 </li><li style=";text-align:right;direction:rtl">  3bit: ุชุบููุฑ ููุณู ุงูุชุฃุฎูุฑ </li><li style=";text-align:right;direction:rtl">  3bit: ููุณู ุณุงุนุฉ ุงููุนุงูุฌ </li><li style=";text-align:right;direction:rtl">  8 ุจุช: ูููุฉ OCR2A </li></ul><br>  ููุท 16 ุจุช. <br><br>  ุนุฒูุฒู ุงููุงุฑุฆ ุ ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฐูู ุ ููููู ุฃู ุชุญูู ุจุงูุชูุณูู ุจููุณู ุ ุฑุจูุง ุณูููุฏ ุดูุก ุฃูุซุฑ ููุฉ ูู ูููู. <br><br>  ูุณููุง ุฃู ูุถูู ููุงุญุธุฉ ูุงุฑุบุฉ ุ ุฃู  ุงูุตูุช.  ูุฃุฎูุฑูุง ุ ุดุฑุญุช ููุงุฐุง ูู ุงูุจุฏุงูุฉ ุ ูู ูุธููุฉ timer2_buzzer_init () ุ ูููุง ุจุชุนููู ุงููุญุทุฉ PB3 ููุฅุฏุฎุงู ูููุณ ุงูุฅุฎุฑุงุฌ.  ุนูุฏ ุชุบููุฑ ุงูุชุณุฌูู DDRB ุ ุณูููู ุจุชุดุบูู ูุฅููุงู ุชุดุบูู "ุงูุตูุช" ุฃู ุงูุชูููู ููู.  ูุฃู  ูุง ูููู ุฃู ูููู ูุฏููุง ููุงุญุธุงุช ุจูููุฉ 0 - ุณุชููู ููุงุญุธุฉ "ูุงุฑุบุฉ". <br><br>  ุญุฏุฏ ูุญุฏุงุช ุงููุงูุฑู ุงูููููุฏุฉ ูุงููุธููุฉ ูุชูููู ุชูููุฏ ุงูุตูุช: <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EMPTY_NOTE 0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NOTE(delay, note) (uint16_t)((delay </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&lt; 11) | note) ........ ........ ........ void play_music_note(uint16_t note) { if (note) { TCCR2B = (note &gt;&gt; 8) &amp; DIV_MASK; OCR2A = note &amp; 0xff; sbi(DDRB, BUZ_PIN); } else cbi(DDRB, BUZ_PIN); }</span></span></span></span></code> </pre><br>  ุงูุขู ุณุฃุฑููู ููู ุชุจุฏู ูุบูุฉ ุฑููู ููุชูุจุฉ ููููุง ููุฐุง ุงููุจุฏุฃ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> king[] PROGMEM = { NOTE(DEL_1N4, MI3), NOTE(DEL_1N4, FA_3), NOTE(DEL_1N4, SOL3), NOTE(DEL_1N4, LA3), NOTE(DEL_1N4, SI3), NOTE(DEL_1N4, SOL3), NOTE(DEL_1N2, SI3), NOTE(DEL_1N4, LA_3), NOTE(DEL_1N4, FA_3), NOTE(DEL_1N4, LA_3), NOTE(DEL_1N4, EMPTY_NOTE), NOTE(DEL_1N4, LA3), NOTE(DEL_1N4, FA3), NOTE(DEL_1N2, LA3), NOTE(DEL_1N4, MI3), NOTE(DEL_1N4, FA_3), NOTE(DEL_1N4, SOL3), NOTE(DEL_1N4, LA3), NOTE(DEL_1N4, SI3), NOTE(DEL_1N4, SOL3), NOTE(DEL_1N4, SI3), NOTE(DEL_1N4, MI4), NOTE(DEL_1N4, RE4), NOTE(DEL_1N4, SI3), NOTE(DEL_1N4, SOL3), NOTE(DEL_1N4, SI3), NOTE(DEL_1N2, RE4), NOTE(DEL_1N2, EMPTY_NOTE), };</code> </pre><br><br><h3 style=";text-align:right;direction:rtl">  ุชุดุบูู ูุบูุฉ ุงูุฑููู </h3><br>  ูุง ูุฒุงู ุฃูุงููุง ูููุฉ ูุงุญุฏุฉ ููู ุนุฒู ุงููุญู.  ููููุงู ุจุฐูู ุ ูุญุชุงุฌ ุฅูู "ุชุดุบูู" ูู ุฎูุงู ูุฌููุนุฉ ูุบูุงุช ุงูุฑููู ุ ูุน ุชุญูู ุงูุฅููุงู ุงููุคูุช ุงูููุงุณุจ ูุชุจุฏูู ุชุฑุฏุฏุงุช ุงูููุงุญุธุงุช.  ูู ุงููุงุถุญ ุฃููุง ุจุญุงุฌุฉ ุฅูู ูุคูุช ุขุฎุฑ ุ ูุงูุฐู ุ ุจุงูููุงุณุจุฉ ุ ูููู ุงุณุชุฎุฏุงูู ูููุงู ุนุงูุฉ ุฃุฎุฑู ุ ููุง ุฃูุนู ุนุงุฏุฉู.  ุนูุงูุฉ ุนูู ุฐูู ุ ููููู ุงูุชุจุฏูู ุจูู ุนูุงุตุฑ ุงููุตูููุฉ ุฅูุง ูู ููุงุทุนุฉ ูุฐุง ุงููุคูุช ุฃู ูู ุงูุญููุฉ ุงูุฑุฆูุณูุฉ ุ ูุงุณุชุฎุฏุงู ุงููุคูุช ูุญุณุงุจ ุงูููุช.  ูู ูุฐุง ุงููุซุงู ุ ุงุณุชุฎุฏูุช ุงูุฎูุงุฑ ุงูุซุงูู. <br><br>  ููุง ุชุนูู ุ ูุฅู ูุต ุฃู ุจุฑูุงูุฌ ูู MK ูุชุถูู ุญููุฉ ูุง ููุงุฆูุฉ: <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(;;) { <span class="hljs-comment"><span class="hljs-comment">//   } return 0; }</span></span></code> </pre><br>  ูู ุฐูู ุณูู "ูุฑูุถ" ุนูู ุทูู ูุฌููุนุชูุง.  ูููููุง ุจุญุงุฌุฉ ุฅูู ูุธููุฉ ูุดุงุจูุฉ ูู GetTickCount ูู WinApi ุ ูุงูุชู ุชูุฑุฌุน ุนุฏุฏ ุงููููู ุซุงููุฉ ุนูู ุฃูุธูุฉ ุชุดุบูู Windows.  ูููู ุจุทุจูุนุฉ ุงูุญุงู ุ ูู ุนุงูู MK ูุง ุชูุฌุฏ ูุซู ูุฐู ุงููุธุงุฆู "ุฎุงุฑุฌ ุงูุตูุฏูู" ุ ูุฐุง ูุฌุจ ุนูููุง ูุชุงุจุชูุง ุจุฃููุณูุง. <br><br><h4 style=";text-align:right;direction:rtl">  ุงููุคูุช 1 </h4><br>  ูุญุณุงุจ ุงููุชุฑุงุช ุงูุฒูููุฉ (ูุง ุฃูุชุจ ุนูุฏุงู ูููู ุซุงููุฉ ุ ุณุชููู ูููุง ุจุนุฏ ุงูุณุจุจ) ููุฏ ุงุณุชุฎุฏูุช ุงููุคูุช 1 ุจุงูุงูุชุฑุงู ูุน ูุถุน CTC ุงููุนุฑูู ุจุงููุนู.  ุงููุคูุช 1 ูู ุฌูุงุฒ ุถุจุท ุงูููุช 16 ุจุช ุ ููุง ูุนูู ุฃู ูููุฉ ูุญุฏุฉ ุงูููุงุฑูุฉ ุงูุฎุงุตุฉ ุจูุง ููุดุงุฑ ุฅูููุง ุจุงููุนู ุจูุงุณุทุฉ 2 8 ุจุช ูุณุฌู OCR1AH โโู OCR1AL - ููุจุงูุชุงุช ุงูุนุงููุฉ ูุงูููุฎูุถุฉ ุ ุนูู ุงูุชูุงูู.  ูุง ุฃุฑูุฏ ุฃู ุฃุตู ุจุงูุชูุตูู ุงูุนูู ูุน ุงููุคูุช 1 ุ ูุฃู ูุฐุง ูุง ููุทุจู ุนูู ุงูููุถูุน ุงูุฑุฆูุณู ููุฐู ุงููุฐูุฑุฉ.  ูุฐูู ุ ุณุฃููู ูู ููุท ูู ูููุชูู. <br><br>  ูุญู ูู ุงููุงูุน ุจุญุงุฌุฉ ุฅูู 3 ูุธุงุฆู: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชููุฆุฉ ุงููููุช </li><li style=";text-align:right;direction:rtl">  ูุนุงูุฌ ููุงุทุนุฉ ุงููููุช </li><li style=";text-align:right;direction:rtl">  ุฏุงูุฉ ุชููู ุจุฅุฑุฌุงุน ุนุฏุฏ ุงูููุงุตู ุงูุฒูููุฉ. </li></ul><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููู ุงูุฑูุฒ C</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;avr/io.h&gt; #include &lt;avr/interrupt.h&gt; #include &lt;util/atomic.h&gt; #include "timer1_ticks.h" volatile unsigned long timer1_ticks; //  ISR (TIMER1_COMPA_vect) { timer1_ticks++; } void timer1_ticks_init() { //   // CTC ,     8 TCCR1B |= (1 &lt;&lt; WGM12) | (1 &lt;&lt; CS11); //     OCR1AH = (uint8_t)(CTC_MATCH_OVERFLOW &gt;&gt; 8); OCR1AL = (uint8_t) CTC_MATCH_OVERFLOW; //    TIMSK1 |= (1 &lt;&lt; OCIE1A); } unsigned long ticks() { unsigned long ticks_return; //  ,   ticks_return   //     ATOMIC_BLOCK(ATOMIC_FORCEON) { ticks_return = timer1_ticks; } return ticks_return; }</span></span></span></span></code> </pre><br></div></div><br><br>  ูุจู ุฃู ุฃุนุฑุถ ููู ุงูุฑุฃุณ ูุน CTC_MATCH_OVERFLOW ุซุงุจุช ูุนูู ุ ูุญุชุงุฌ ุฅูู ุงูุนูุฏุฉ ูู ุงูููุช ุงูููุงุณุจ ุฅูู ูุณู <b>"ุงููุฏุฉ"</b> ูุชุญุฏูุฏ ุงููุงูุฑู ุงูุฃูุซุฑ ุฃูููุฉ ููุญู ุ ูุงูุฐู ูุญุณุจ ุฅููุงุน ุงููุญู.  ููุฏ ุงูุชุธุฑุช ููุชูุง ุทูููุงู ูุชุญุฏูุฏู ุ ูุฃูู ูุฑุชุจุท ูุจุงุดุฑุฉ ุจุงููุงุนุจ ุ ูุจุงูุชุงูู ุจุงููุคูุช 1. <br>  ูู ุงูุชูุฑูุจ ุงูุฃูู ุ ุจุฏุง ุงูุฃูุฑ ุนูู ูุฐุง ุงููุญู (ุงูุธุฑ ุงูุญุณุงุจุงุช ูู ูุณู "ุงููุฏุฉ"): <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TEMPO( x ) (60000 * 4 / x)</span></span></code> </pre><br>  ุงููููุฉ ุงูุชู ูุญุตู ุนูููุง ูู ุงูุฅุฎุฑุงุฌ ูุฌุจ ุฃู <b>ูุณุชุจุฏู</b> ุงููุณูุทุฉ ุงูุฃููู ูู ุงูุฏุงูุฉ <b>calc_note_delay</b> .  ุงูุขู ูููู ูุธุฑุฉ ูุงุญุตุฉ ุนูู ุฏุงูุฉ calc_note_delay ุ ููู ุงูุณุทุฑ: <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (precalced_tempo / divider);</code> </pre><br>  ูุฑู ุฃู ุงููููุฉ ุงูุชู ุชู ุงูุญุตูู ุนูููุง ุนู ุทุฑูู ุญุณุงุจ ูุงูุฑู TEMPO ููุณููุฉ ุนูู ููุณูู ูุนูู.  ุชุฐูุฑ ุฃู ุงูุญุฏ ุงูุฃูุตู <b>ููููุณูู ุงูุฐู ุญุฏุฏูุงู</b> ูู <b>DEL_1N128</b> ุ ุฃู  ุงูููุณูู ุนููู 128. <br><br>  ุงูุขู ููุฃุฎุฐ ูููุฉ ุงูุฅููุงุน ุงููุดุชุฑูุฉ ุงูุชู ุชุณุงูู 240 ููููู ุจุจุนุถ ุงูุญุณุงุจุงุช ุงูุจุณูุทุฉ: <br>  <b>60000 * 4/240 = 1000</b> <br>  ูุง ุฑุนุจ!  ุญุตููุง ุนูู 1000 ููุท ุ ูุธุฑูุง ูุฃู ูุฐู ุงููููุฉ ุณุชุธู ููุณูุฉ ุนูู 128 ุ ูุฅููุง ูุฎุงุทุฑ ุจุฎุทุฑ ุงูุงูุฒูุงู ุฅูู 0 ุจูุนุฏูุงุช ุนุงููุฉ.  <b>ูุฐุง ูู ุงูุนุฏุฏ ุงูุซุงูู ูู ุงููุฏุฉ.</b> <br><br>  ููููุฉ ุญููุงุ  ูู ุงููุงุถุญ ุ ูู ุฃุฌู ุชูุณูุน ูุทุงู ููู ุงูุฅููุงุน ุ ูุญุชุงุฌ ุจุทุฑููุฉ ูุง ุฅูู ุฒูุงุฏุฉ ุงูุนุฏุฏ ุงูุฐู ุชู ุงูุญุตูู ุนููู ุนู ุทุฑูู ุญุณุงุจ ูุงูุฑู TEMPO.  ูููู ุงูููุงู ุจุฐูู ุจุทุฑููุฉ ูุงุญุฏุฉ ููุท - ููุงุจุชุนุงุฏ ุนู ุงููููู ุซุงููุฉ ูุญุณุงุจ ุงูููุช ูู ูุชุฑุงุช ุฒูููุฉ ูุนููุฉ.  ุงูุขู ุฃูุช ุชููู ููุงุฐุง ุทูุงู ูุฐุง ุงูููุช ุชุฌูุจุช ุฐูุฑ "ูููู ุซุงููุฉ" ูู ุงููุตุฉ.  ุฏุนููุง ูุญุฏุฏ ูุงูุฑู ุขุฎุฑ: <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MS_DIVIDER 4</span></span></code> </pre> <br>  ููููู ููุณูููุง ุนูู ุงููููู ุซุงููุฉ - ูุณูู ุงููููู ุซุงููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนูู 4 (250 ฮผs). <br>  ุซู ุชุญุชุงุฌ ุฅูู ุชุบููุฑ ูุงูุฑู TEMPO: <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TEMPO( x ) (60000 * MS_DIVIDER * 4 / x)</span></span></code> </pre> <br><br>  ุงูุขู ุ ุจุถููุฑ ูุฑุชุงุญ ุ ุณุฃุนุทู ููู ุงูุฑุฃุณ ููุนูู ูุน ุงููุคูุช 1: <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> TIMER1_TICKS_H_INCLUDED #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TIMER1_TICKS_H_INCLUDED #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MS_DIVIDER 4 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CTC_MATCH_OVERFLOW ((F_CPU / 1000) / (8 * MS_DIVIDER)) void timer1_ticks_init(); unsigned long ticks(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// TIMER1_TICKS_H_INCLUDED</span></span></span></span></code> </pre> <br>  ูููููุง ุงูุขู ุชุบููุฑ MS_DIVIDER ุ ุถุจุท ุงููุทุงู ูููุงููุง - ูุฏู 4 ูู ุงูููุฏ ุงูุฎุงุต ุจู - ูุงู ูุฐุง ูุงูููุง ูููุงูู.  <b>ุชูุจูู: ุฅุฐุง ูุงู ูุง ูุฒุงู ูุฏูู ุฃู ููุงู "ูุฑุชุจุทุฉ" ุจุงููุคูุช 1 ุ ููุง ุชูุณ ุฃู ุชุถุฑุจ / ุชูุณู ููู ุงูุชุญูู ูู ุงูููุช ููุง ูู MS_DIVIDER.</b> <br><br><h4 style=";text-align:right;direction:rtl">  ุงููุฑุต ุงูุฏูุงุฑ </h4><br>  ุงูุขู ุฏุนูุง ููุชุจ ูุงุนุจูุง.  ุฃุนุชูุฏ ุฃู ูู ุดูุก ุณูููู ูุงุถุญูุง ูู ุงูุฑูุฒ ูุงูุชุนูููุงุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ timer1_ticks_init(); <span class="hljs-comment"><span class="hljs-comment">//   sei(); timer2_buzzer_init(); //    MS_DIVIDER long time_since = ticks(); //       MS_DIVIDER uint16_t note_delay = 0; //     uint16_t note_pos = 0; //  uint16_t length = sizeof(king) / sizeof(king[0]); //     uint16_t tempo = TEMPO(240); for(;;) { unsigned long time_current = ticks(); if (time_current - time_since &gt; note_delay) { //   uint16_t note = pgm_read_word(&amp;king[note_pos]); //   play_music_note(note); //    note_delay = calc_note_delay(tempo, note); //  if (++note_pos &gt;= length) note_pos = 0; time_since = time_current; } } return 0; }</span></span></code> </pre><br><br><h3 style=";text-align:right;direction:rtl">  ุงูุฎูุงุตุฉ </h3><br>  ุขูู ุฃู ุชููู ูุฐู ุงููุฐูุฑุฉ ูููุฏุฉ ูููุงุฑุฆ ุงููุญุชุฑู ููููุณู ุ ุญุชู ูุง ุฃูุณู ูู ุงููุฑูู ุงูุฏูููุฉ ูู ุชุดุบูู ุงูุฃูุญุงู ุ ูู ุญุงูุฉ ุงูุชูุงุท ุงููููุฑููููุชุฑููุฑ AVR ูุฑุฉ ุฃุฎุฑู. <br><br>  ุญุณููุง ุ ุชูููุฏููุง ุงูููุฏูู ูุดูุฑุฉ ุงููุตุฏุฑ (ุทูุฑุชู ูู ุจูุฆุฉ Code Blocks ุ ูุฐูู ูุง ุชุฎู ูู ุงููููุงุช ุงูุบุงูุถุฉ): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/j60UCr2q0Ak" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุฏ ุงููุตุฏุฑ</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar402329/">https://habr.com/ru/post/ar402329/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar402319/index.html">ุชููู ุฌุงูุนุฉ Jagiellonian ุจุชุทููุฑ ุชุทุจูู ูุฏุฑุจ ุจุงุณุชุฎุฏุงู ุฅููุงููุงุช IBM Watson</a></li>
<li><a href="../ar402321/index.html">ูุฑุงุฌุนุฉ Livall: ุฎูุฐุฉ ุฐููุฉ ูุน ูุญุฏุฉ ุชุญูู ููููุฑูููู ูุชุทุจูู ุฃุตูู</a></li>
<li><a href="../ar402323/index.html">"ุงูุนูู ุฃูุถุง": ูู ุงูุงุณุชูุงุน ุฅูู ุงูููุณููู</a></li>
<li><a href="../ar402325/index.html">"ุนุงูู ุฑููู". ุงููุตู ุงูุณุงุจุน</a></li>
<li><a href="../ar402327/index.html">ุฃุนููุช ุดุฑูุฉ WayRay ุนู ุดุฑุงูุฉ ุงุณุชุฑุงุชูุฌูุฉ ูุน Banma Technologies ุจุฏุนู ุงุณุชุซูุงุฑู ูู ูุฌููุนุฉ Alibaba Group</a></li>
<li><a href="../ar402345/index.html">ุจูุงูุงุช ุชููุน ุงูุฃููุงุน</a></li>
<li><a href="../ar402347/index.html">ูุฌููุนุฉ ูุฎุชุงุฑุฉ ูู ุงูุณูุงุนุงุช ุงูุฑูุงุถูุฉ ุญุชู 2500 ุฑูุจู</a></li>
<li><a href="../ar402351/index.html">ุงูุฅูุชุฑูุช ูู ุฌููุน ุฃูุญุงุก ุงูุนุงูู: ุงููุงุจุงู ูุณูุบุงููุฑุฉ</a></li>
<li><a href="../ar402355/index.html">ุงูุดุทุฑูุฌ ุงูููููู</a></li>
<li><a href="../ar402357/index.html">ูู ูููููู ุงุณุชุจุฏุงู Adobe Premiere ู Sony Vegas ุจูุญุฑุฑ ููุฏูู ูุฌุงููุ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>