<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💪 👩🏽 🧑🏿‍🤝‍🧑🏾 Gnomo ganancioso: Como escrevi análises de mercado no Lineage 2 🈁 👨🏼‍🎓 🐉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Então chegou a hora do outono-inverno. Do lado de fora da janela, as chuvas e o desejo de passar o tempo ao ar livre são cada vez menores. E então uma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gnomo ganancioso: Como escrevi análises de mercado no Lineage 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429244/"><p>  Então chegou a hora do outono-inverno.  Do lado de fora da janela, as chuvas e o desejo de passar o tempo ao ar livre são cada vez menores.  E então uma mensagem vem de um amigo meu: " <em>Vamos jogar o <strong>Lineage 2</strong></em> ?"  E, novamente, cedendo à nostalgia, concordei.  Escolhemos um servidor novo e criamos personagens. </p><br><img src="https://habrastorage.org/webt/gd/jh/t1/gdjht1oa4v3ooibwdzyoxptvenc.jpeg"><br><p><br>  Ao contrário do World of Warcraft, o Lineage 2 possui um sistema de mineração de moeda de jogo completamente diferente.  Você precisa caçar monstros o tempo todo com o objetivo de obter lucro.  Foi até uma descoberta para mim que, para algumas pessoas, o RMT (negociação com dinheiro real) é um pouco trabalhoso.  Além disso, o jogo tem uma economia que os jogadores formam.  Em outras palavras, você pode ganhar dinheiro com compra-venda ou compra de recursos baratos, tirar proveito deles e vender com um prêmio.  Como para nós o jogo continua sendo uma espécie de relaxamento, foi essa a maneira de obter a moeda do jogo que escolhemos. </p><br><p>  Para comprar e vender itens, o jogador deve estar online (Captura de tela acima).  Por conseguinte, alguém quer vender mais rápido (mais barato) e alguém compra rapidamente (mais caro).  Mas e se a diferença for vender - comprar positivo?  Apenas este exemplo será considerado no artigo como resultado. </p><br><p>  No entanto, os preços de mercado são bastante instáveis ​​e frequentemente mudam.  Portanto, é provável que compre algo "barato" e depois ainda mais barato para vender com lucro negativo.  É isso que estamos tentando evitar.  Em geral, foi decidido escrever um <em>sistema de análise de mercado</em> e lidar com algumas tecnologias que são interessantes para mim. </p><br><p>  <strong>Spoiler</strong> : <br>  As seguintes tecnologias serão usadas no artigo <br>  Docker, DigitalOcean, NodeJs, Ktor, Prometheus, Grafana, notificação de bot do Telegram </p><a name="habracut"></a><br><h1>  Primeiro foi Data </h1><br><p>  Para analisar algo, primeiro precisamos obter esse algo.  Foram consideradas 2 opções para obter informações. </p><br><p>  <u>Farejando</u> - escreva um aplicativo que ouvirá o tráfego e o analisará.  As desvantagens dessa abordagem são muito simples.  Você precisa estar constantemente online e assistir ao mercado, e de acordo com a política do servidor, eles podem banir.  No entanto, eu gostaria de uma ação mínima do usuário e é desejável automatizar tudo o mais possível. </p><br><p>  <u>Análise</u> - existe um site especializado em cheirar esse jogo - l2on.net.  Apenas o que precisamos!  Atribuímos o papel de um coletor de dados brutos a esse serviço.  Resta apenas obter de alguma forma os dados e começar a experimentar com eles. <br></p><br><img src="https://habrastorage.org/webt/xt/wc/1k/xtwc1kiirfrvwnv_epcueloqk0m.png"><br><p></p><br><p>  Com base na cadeia de consulta, entendemos que precisamos passar o ID do recurso para obter informações sobre ele.  No entanto, se automatizarmos isso, também será necessário transferir o ID do servidor do jogo.  Após digitar um minuto no código fonte da página, foi encontrado o seguinte: <br></p><br><img src="https://habrastorage.org/webt/_j/zd/em/_jzdemfcobutgb4cgyh9s5w7gcy.png"><br><p><br>  Tentando ... Ótimo!  Temos uma lista de preços de compra e venda. <br>  Agora você precisa pensar em como analisar o site. </p><br><p>  A escolha recaiu sobre o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Puppeteer</a> para os NodeJs. <br>  Em sua base <strong>,</strong> foi criado o primeiro módulo do subsistema, <strong>Scrapper</strong> .  Sua principal tarefa é acessar o site, abrir, analisar e retornar dados na forma de JSON.  Tomamos uma amostra dos últimos N elementos, consideramos os preços médio, mínimo e máximo.  (Olhando para o futuro, direi que você precisa refinar o percentil para editar o ruído, se algum jogador colocar um preço muito alto na venda ou baixo na compra) Temos a resposta de acordo com os dados: <br></p><br><img src="https://habrastorage.org/webt/um/v0/qh/umv0qhmk3b1zlorvoauwx9-warq.png"><br><p><br>  Agora podemos passar para a próxima parte - <em>armazenamento de dados</em> . </p><br><p>  Suponha que tenhamos de 2 a 3 consumidores de nossos dados e queremos fornecer a eles uma matriz.  Também queremos evitar solicitações frequentes para l2on, para não ficar na lista negra.  Portanto, precisamos criar um segundo módulo que atue como intermediário entre o l2on e nossos agentes. </p><br><p>  A metodologia da pesquisa foi escolhida simples.  Uma vez a cada 5 minutos, o módulo deve solicitar todos os itens da lista estabelecida e fornecer saída como dados para um recurso e saída para análise. </p><br><p>  Para este sistema, eu queria experimentar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ktor</a> - uma solução de servidor no Kotlin. <br>  Não usei o banco de dados, mas decidi armazenar os dados mais recentes em Singleton.  Sim, a solução não é a mais elegante, mas é rápida, e sempre poderemos otimizá-la. </p><br><p>  Então o segundo módulo do sistema apareceu - <strong>Harvester</strong> . <br>  O Harvester fornece ao usuário dois pontos de extremidade / item / {id} e / métricas <br>  Se tudo estiver claro com o primeiro, o segundo retornará dados no formato para o próximo sistema - <strong>Prometheus</strong> </p><br><img src="https://habrastorage.org/webt/sw/kw/cd/swkwcdgzed4wpz8id7sdnp7ceqy.png"><br><img src="https://habrastorage.org/webt/hi/jf/h8/hijfh82bupsk2kdksroqxf_ppsy.png"><br><h1>  Armazenamento de dados para análise </h1><br><p>  O link intermediário foi selecionado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Prometheus</a> - um banco de dados de código aberto para análises que funciona através da abordagem Pull.  Em outras palavras, ao configurar, você precisa especificar no arquivo yaml o conjunto de provedores de dados e a frequência da pesquisa.  No nosso caso, esse é exatamente o mesmo ponto de extremidade / métricas. </p><br><p>  Tentamos executar o Prometheus (por padrão, é a porta 9090) e, se virmos algo semelhante ao Target: <br></p><br><img src="https://habrastorage.org/webt/vq/1f/_9/vq1f_9rh_3fy5h6na8gogngdtww.png"><br><p><br>  Então, estamos no caminho certo.  Isso significa que a cada 30 segundos Prometheus vai para Harvester e escolhe o último estado para todos os produtos em que estamos interessados. </p><br><h1>  Exibição de dados </h1><br><p>  A próxima etapa é uma bela exibição gráfica. </p><br><p>  Para renderização, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grafana</a> foi selecionado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">,</a> que também é de código aberto. <br>  Vantagens Grafana e Prometheus - estão disponíveis na forma de contêineres do Docker que requerem um mínimo de ação do usuário. </p><br><p>  Quando você inicia o Grafana (porta padrão 3000), ele solicita que você especifique um banco de dados disponível.  Selecionamos Prometeu como base e prescrevemos o endereço.  Se tudo correr bem, veremos: <br></p><br><img src="https://habrastorage.org/webt/cf/h_/cn/cfh_cnonbcdyolueoyqustssjac.png"><br><p><br>  O próximo passo é desenhar gráficos. </p><br><p>  Um exemplo de uma solicitação para desenhar um gráfico de vendas: <br></p><br><img src="https://habrastorage.org/webt/vc/m5/3r/vcm53ri4w_zrynpcp7fezm7dw3a.png"><br><p><br>  Assim, a qualquer momento vemos o preço médio da compra e venda, bem como a dinâmica dos preços. <br></p><br><img src="https://habrastorage.org/webt/be/hf/_w/behf_wpfl8f_mfvqjv6upqe1yxi.png"><br><p><br>  No entanto, há momentos em que o preço mínimo de venda é superior ao preço máximo de compra.  Isso significa que podemos obter lucro fácil na forma de "comprar e vender".  Para o canal de envio, a notificação foi selecionada pelo Telegram.  Crie um bot e adicione seu token ao Grafana (sim, sim, ele suporta notificações) <br></p><br><img src="https://habrastorage.org/webt/3c/zc/cb/3czccb4qcvsney3oszcuk5kctaq.png"><br><p><br>  Basta estabelecer simplesmente a condição sob a qual essa notificação chegará até nós. <br></p><br><img src="https://habrastorage.org/webt/rg/xw/d5/rgxwd5zjonbwwdf3vnbryywbxdu.png"><br><p><br>  Como podemos ver no gráfico, essas situações acontecem no mercado. <br></p><br><img src="https://habrastorage.org/webt/di/mp/ql/dimpqln0oq39ou9jn2qnbxwu4vq.jpeg"><br><p></p><br><h1>  Cloud </h1><br><p>  Empacotamos cada subsistema no contêiner do Docker e o carregamos no DigitalOcean ou em outros serviços ao seu gosto.  Mas isso não nos impede de iniciar todo o sistema sem um IP dedicado.  Agora, o contêiner mínimo para DO custa US $ 5 por mês. </p><br><p>  Inicie o Scrapper primeiro <br>  docker run -d -p 6661: 6661 --name scrapper l2 / scrapper: mais recente </p><br><p>  Atrás dele Harvester <br>  docker run -d -p 6662: 6662 -v / root / harvester: / res --link scrapper: scrapper l2harvester: mais recente <br>  O arquivo ids.txt com o formato deve estar na pasta / harvester </p><br><p>  id1 name1 <br>  id2 name2 </p><br><h1>  Conclusão </h1><br><p>  Por fim, o sistema é o seguinte: </p><br><img src="https://habrastorage.org/webt/yc/mc/ab/ycmcabimfltt1nakqxjfwfgmu3i.png"><br><p>  Está planejado no futuro adicionar um agente para atualizar o Google Docs e calcular o custo de criação em tempo real. </p><br><p>  Não sei se esse tempo de operação trará algum benefício, mas para mim, pessoalmente, foi uma boa experiência atualizar meus conhecimentos no campo aplicado.  Minha principal especificidade são as aplicações móveis.  O desenvolvimento no servidor é uma habilidade e curiosidade adicionais. </p><br><p>  Como complemento, anexo links para me familiarizar com o código: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Scrapper</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Colheitadeira</a> <br>  (Você pode coletar contêineres por equipes <br>  docker build -t scrapper. <br>  docker build -t harvester.) </p><br><p>  Eu realmente espero que este artigo tenha inspirado alguém com sentimentos nostálgicos ou tenha inspirado alguma nova idéia.  Obrigado por ler o artigo até o fim! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429244/">https://habr.com/ru/post/pt429244/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429234/index.html">Criação do jogo "Like coins" no Godot Engine. Parte 1</a></li>
<li><a href="../pt429236/index.html">Quantos cientistas de dados você precisa para acender uma lâmpada (ou qual equipe fará os dados funcionarem para os negócios)</a></li>
<li><a href="../pt429238/index.html">Mais uma vez sobre os níveis de camada</a></li>
<li><a href="../pt429240/index.html">Como eu tentei consertar uma pesquisa no mapa por drivers</a></li>
<li><a href="../pt429242/index.html">“Não seja tímido. Experimente! Entrevistas sobre vida, compiladores e vida em compiladores com Unity Alexandre Mutel</a></li>
<li><a href="../pt429246/index.html">Estágio de verão na Mars IS: uma visão interna</a></li>
<li><a href="../pt429248/index.html">Dicas poliglotas: como aprender qualquer idioma sem lágrimas e maldições</a></li>
<li><a href="../pt429250/index.html">Cem receitas digitais da contabilidade</a></li>
<li><a href="../pt429252/index.html">Análise estática de aplicativos móveis</a></li>
<li><a href="../pt429254/index.html">Nas curvas de Bezier e na velocidade do Arduino, parte dois</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>