<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🚀 📬 🎛️ Nous regardons sous le capot du nouveau Gmail 👂 👨🏼‍⚖️ 🎳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a six mois, Google a présenté une version mise à jour de son service de messagerie. Malgré le fait que de nombreux utilisateurs n'étaient pas sat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous regardons sous le capot du nouveau Gmail</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429506/"><p>  Il y a six mois, Google a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">présenté une</a> version mise à jour de son service de messagerie.  Malgré le fait que de nombreux utilisateurs n'étaient pas satisfaits de la refonte, y compris <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur Habré</a> , c'est maintenant l'interface principale pour les utilisateurs. </p><br><p>  Entre autres lacunes, les gens se plaignent de la dégradation des performances de la nouvelle version, en particulier sur les ordinateurs faibles.  Voyons pourquoi cela se produit et ce qui peut être si difficile dans l'interface de messagerie.  Dans cet article, nous utiliserons les outils de développement de Google Chrome, donc cet article sera également un rappel des opportunités qui y sont disponibles. </p><a name="habracut"></a><br><h2 id="ishodnye-dannye">  Données source </h2><br><p>  Tout d'abord, vous devez comprendre à quoi nous avons affaire.  Google Chrome Devtools dispose d'un outil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lighthouse</a> intégré qui crée un rapport de performances simple et compréhensible pour votre site.  Dans ce document, Gmail obtient un deuce pour les performances (sur un maximum de 100 points!) </p><br><p><img src="https://habrastorage.org/webt/yu/zg/lp/yuzglprkqo7bjwn7ddfbcdxz8k0.png"></p><br><p>  Pour être honnête, ce n'est pas le résultat que vous attendez d'un produit Google.  Néanmoins, examinons cette situation plus en détail.  Désactivez le cache et chargez l'interface Gmail avec devtools activé.  L'onglet Réseau affichera toutes les demandes de téléchargement de cette page.  Il s'est avéré 6,9 Mo.  C'est une taille impressionnante, étant donné que même Youtube, un autre service récemment mis à jour, ne charge que 2 Mo de ressources. </p><br><blockquote>  Il convient de noter ici que les services modernes, notamment Gmail, utilisent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Service Workers</a> pour améliorer la mise en cache des ressources.  Par conséquent, pour des mesures précises d'un démarrage à froid, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">désactivation du cache</a> ne suffit pas; vous devez également <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">réinitialiser les techniciens de</a> maintenance, qui détiennent également des ressources.  Ce n'est qu'après cela que le numéro de téléchargement à partir de zéro sera réel. </blockquote><p>  Essayons maintenant de regarder le chargement de la page au ralenti.  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation de Google Chrome</a> explique comment procéder.  Nous obtenons un ensemble de captures d'écran des différentes étapes du chargement de la page: </p><br><p><img src="https://habrastorage.org/webt/2j/tw/ao/2jtwaofovrdv_ytxy6vjd6dnzrm.png"></p><br><p>  Ici, vous pouvez voir que la page est plus ou moins chargée à la 9ème seconde. </p><br><p>  Avec le rechargement lors de l'utilisation du cache, la situation est meilleure.  La page ne fait que 250 Ko de requêtes, mais cela ne la rend pas plus rapide, nous voyons toujours l'écran de démarrage pendant près de 10 secondes.  Le point n'est clairement pas le nombre de demandes, quelque chose d'autre rend la page plus lente. </p><br><h2 id="blokiruem-resursy">  Nous bloquons les ressources </h2><br><p>  Regardez maintenant la liste des scripts téléchargeables: </p><br><p><img src="https://habrastorage.org/webt/md/2l/qw/md2lqwcqm3bl9l5frwa4-c3qpqi.png"></p><br><p>  Peut-être que certains d'entre eux ne sont pas si nécessaires au fonctionnement normal de l'interface?  Essayons de les désactiver un par un et testons la page sans eux.  Cela se fait facilement en utilisant la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctionnalité intégrée de devtools</a> . </p><br><p> Empiriquement, il s'est avéré que les demandes de <code>https://mail.google.com/_/scs/*</code> sont essentielles au fonctionnement de l'interface, mais les demandes suivantes peuvent être bloquées: </p><br><ul><li>  <code>www.gstatic.com/og/*</code> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bibliothèque cliente Google API</a> , bibliothèque pour les demandes aux services Google </li><li>  <code>ssl.gstatic.com/inputtools/*</code> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Outils de saisie Google</a> - widget clavier à l'écran </li><li>  <code>hangouts.google.com</code> - responsable du widget handgouts </li></ul><br><blockquote>  En plus de ces demandes, mon AdBlock a installé des demandes déjà bloquées sur <code>https://play.google.com/log</code> , nous ne les prenons pas en compte, car elles n'ont pas été faites avant même le début des expériences avec les verrous. </blockquote><p>  Nous ajoutons ces scripts à la liste noire et constatons que le chargement de la page a commencé en 4 secondes, mais vous pouvez toujours lire et écrire des lettres. </p><br><h2 id="smotrim-v-profayler">  Nous regardons dans le profileur </h2><br><p>  Nous avons donc minimisé le chargement des ressources autant que possible, mais la page prend encore beaucoup de temps à charger.  Nous devons voir ce qui se passe pendant ces 4 secondes.  Ici, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">profileur intégré à Chrome</a> viendra à notre aide.  Il nous montre cette photo: </p><br><p><img src="https://habrastorage.org/webt/nf/df/5f/nfdf5fyvr7vgproydoxpqjo4zgo.png"></p><br><p>  Ici, vous pouvez voir que pendant tout ce temps, le navigateur a été occupé par l'exécution de Javascript.  Il est intéressant qu'une chose aussi importante et difficile se produise dans ce code.  Heureusement, Javascript se charge dans le navigateur presque inchangé et peut être lu. </p><br><h2 id="rassmatrivaem-ostavshiysya-kod">  Considérez le code restant </h2><br><p>  Lisons le code Javascript à notre disposition.  Voici l'occasion de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">formater le code minifié</a> pour le rendre plus lisible. </p><br><p>  Selon les résultats de la visualisation, les éléments suivants ont été trouvés: </p><br><ul><li>  Le code est très obscurci.  Très probablement, le compilateur de fermeture Google a été utilisé en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mode avancé</a> .  Autrement dit, les développeurs de Gmail ont tiré le meilleur parti des technologies de minification modernes. </li><li>  Les mesures de performances sont collectées dans le code, les développeurs doivent donc être conscients de la lenteur du chargement de l'interface utilisateur. </li><li>  Les sources contiennent des polyfills pour Promise, Map, Set et d'autres API modernes qui pourraient ne pas se charger dans les navigateurs modernes. </li><li>  Code Gmail écrit dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Google Closure Libary</a> </li></ul><br><p>  Au dernier point, il vaut la peine de s'arrêter plus en détail.  La bibliothèque de fermeture est un cadre de développement d'interface qui est apparu en 2009 et n'a pas beaucoup changé depuis lors.  Par exemple, <a href="https://github.com/google/closure-library/blob/master/closure/goog/net/xml">Ajax via ActiveXObject y</a> est toujours pris en charge: ce qui n'est nécessaire que pour IE6 et inférieur, bien que Gmail actuel ne prenne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">officiellement en charge</a> que IE 10+. </p><br><p>  De plus, l'interface de fermeture est basée sur une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hiérarchie de classes</a> dans la «meilleure» tradition GWT - une approche avec beaucoup d'abstractions verbeuses qui affectent évidemment les performances de rendu.  Les frameworks d'interface utilisateur modernes (React ou Vue, par exemple) offrent des abstractions beaucoup plus légères - des composants - qui sont beaucoup moins chers à rendre. </p><br><p>  D'où la longue initialisation: des milliers de classes sont créées dans le code et de nombreuses abstractions sont initialisées avant de réellement commencer à nous rendre l'interface Gmail. </p><br><p>  Ainsi, malgré l'apparence mise à jour, Gmail tire un héritage d'anciennes technologies, dont la gravité ne peut pas être cachée derrière la coque extérieure. </p><br><h2 id="vyvody">  Conclusions </h2><br><p>  J'espère qu'après cet examen, il sera un peu plus clair pourquoi Gmail ralentit.  Malheureusement, il n'est pas en notre pouvoir de faire en sorte que Google accélère son service, mais vous pouvez au moins en tirer quelques leçons pour vos applications: </p><br><ul><li>  Les projets hérités rencontrent généralement du code inutile, comme des hacks pour les navigateurs hérités.  Passez en revue vos sources et débarrassez-vous des choses qui ne sont plus pertinentes. </li><li>  Les abstractions ne sont pas gratuites.  Si vous souhaitez résoudre un problème en utilisant un modèle architectural élégant, pensez d'abord à un outil trop lourd, il existe peut-être une option plus simple. </li><li>  Ne téléchargez pas d'éléments secondaires sur la page de manière native.  Dans ce cas, le widget Hangouts peut ne pas bloquer la chaîne, interférer avec le chargement des principales ressources Gmail, mais se charger en arrière-plan, après avoir rendu la fonctionnalité principale. </li><li>  Ne négligez pas la technologie moderne.  Ils peuvent contenir des solutions fondamentalement nouvelles pour vos tâches, plus productives et plus pratiques.  Il est étrange de voir en 2018 une refonte du service de Google, qui n'utilise pas de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">composants web</a> , pour lequel Google se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">noie</a> si activement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lors de conférences</a> . </li><li>  N'oubliez pas de faire attention <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">aux mesures de performance</a> de vos projets.  Pour cela, il existe maintenant de nombreux outils pratiques, à la fois basés sur un navigateur et pour le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lancement dans CI</a> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429506/">https://habr.com/ru/post/fr429506/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429496/index.html">Laser au sabre laser fait maison: comment c'était. 2e partie</a></li>
<li><a href="../fr429498/index.html">4 raisons de tergiverser (texte)</a></li>
<li><a href="../fr429500/index.html">"Le temps de faire des affaires" a finalement volé</a></li>
<li><a href="../fr429502/index.html">Vaut-il la peine de développer des compétences croisées</a></li>
<li><a href="../fr429504/index.html">Comment appeler les méthodes audio vk</a></li>
<li><a href="../fr429508/index.html">Résumé du rapport «Comment devenir un spécialiste sympa des bases de données» (HL2018, Data Egret, Ilya Kosmodemyansky)</a></li>
<li><a href="../fr429510/index.html">ArduPilot pour les débutants. Installer et configurer sur BeagleBone Blue</a></li>
<li><a href="../fr429512/index.html">Événements numériques à Moscou du 12 au 18 novembre</a></li>
<li><a href="../fr429514/index.html">Microsoft a expliqué comment résoudre le problème de la sécurité des données sur les SSD avec un cryptage matériel qui fuit</a></li>
<li><a href="../fr429522/index.html">Concevoir un robot de service. Énoncé du problème, architecture de la solution</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>