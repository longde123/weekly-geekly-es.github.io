<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôãüèª üçæ üèîÔ∏è Perro pastor ü§∞üèª ü§±üèΩ ü•õ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sheepdog es un sistema escalable que proporciona dispositivos de bloques distribuidos a m√°quinas virtuales. Su desarrollo comenz√≥ en 2009 por desarrol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Perro pastor</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412739/"><p><img src="https://habrastorage.org/webt/ru/g3/9i/rug39i1kkn-c4ack--isbvvzjma.jpeg"></p><br><p>  <strong>Sheepdog</strong> es un sistema escalable que proporciona dispositivos de bloques distribuidos a m√°quinas virtuales.  Su desarrollo comenz√≥ en 2009 por desarrolladores de la compa√±√≠a japonesa <em>Nippon Telegraph and Telephone Corporation</em> .  <strong>Sheepdog</strong> es una aplicaci√≥n de c√≥digo abierto bajo la licencia GPL2.  La √∫ltima versi√≥n 0.9.3, lanzada en noviembre de 2015, ser√° el legado de la versi√≥n 1.0, adecuada para uso comercial <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1</a></sup> <sup><a name="cite_ref-1"></a></sup>  .  <em>(ya se ha convertido en - aprox. por.)</em> </p><br><blockquote>  En aras del inter√©s, la primera versi√≥n (0.1.0) fue lanzada por los desarrolladores en agosto de 2010, y al mismo tiempo, el soporte del perro pastor se incluy√≥ de inmediato en la rama principal de desarrollo de QEMU. <a name="habracut"></a><br>  Las primeras pruebas en un perro pastor que realic√© en noviembre de 2011 <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2</a></sup> <sup><a name="cite_ref-2"></a></sup>  y los resultados fueron buenos para las operaciones de E / S.  Sin embargo, el sistema <strong>Sheepdog todav√≠a</strong> ten√≠a problemas con la restauraci√≥n del nodo ca√≠do.  Este problema probablemente se resolvi√≥ pronto, ya que el desarrollo de la aplicaci√≥n es bastante din√°mico, pero en ese momento utilic√© una soluci√≥n diferente. </blockquote><br><h1 id="vozmozhnosti">  Las posibilidades </h1><br><p>  El principio de funcionamiento de <strong>Sheepdog est√°</strong> muy bien descrito en la presentaci√≥n publicada, por lo que me limitar√© a una breve descripci√≥n general. </p><br><p>  <strong>Es escalable</strong> <br>  El volumen del cl√∫ster se puede aumentar arbitrariamente tanto a nivel de nodo, aumentando la capacidad y el espacio para datos durante la operaci√≥n, como aumentando el n√∫mero de nodos.  Cuantos m√°s nodos, mayor ser√° el rendimiento de E / S VDI. </p><br><p>  <strong>El es simple</strong> <br>  A diferencia de otros sistemas, como CEPH, <strong>Sheepdog</strong> no funciona directamente con el sistema de archivos sino que funciona con bloques de tama√±o fijo, por lo tanto, no requiere demonios separados para servir metadatos.  Todo el control se realiza utilizando una herramienta de <strong>perro</strong> √∫nico que se comunica directamente con las <strong>ovejas.</strong> <br>  <em>(ceph tambi√©n usa objetos - aprox. por.)</em> </p><br><p>  <strong>Calcula un nodo ca√≠do</strong> <br>  Cada VDI consta de estos bloques (objetos) que se replican simult√°neamente en varios nodos, por lo tanto, si uno de ellos cae, los datos permanecen disponibles y los objetos de los nodos ca√≠dos comienzan a replicarse en el otro nodo. </p><br><p>  <strong>Admite instant√°neas de dispositivos de bloque</strong> <br>  Las <strong>instant√°neas del</strong> perro pastor funcionan igual que Btrfs.  Los bloques VDI adjuntos se guardan y los nuevos datos se escriben en nuevos bloques. </p><br><p>  Las siguientes funciones pueden ser problem√°ticas en ciertas circunstancias: </p><br><p>  <strong>Perro pastor no es compatible con SPOF</strong> <br>  Si se usa VDI como un dispositivo de bloque a trav√©s de QEMU, puede surgir un problema si est√° conectado al mismo tiempo en varios lugares.  SPOF <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3</a></sup> podr√≠a haber evitado esto. <sup><a name="cite_ref-3"></a></sup>  Perro pastor no tiene.  Sin embargo, en la nueva versi√≥n de Sheepdog, VDI puede bloquearse para no permitir m√°s de una conexi√≥n. </p><br><p>  <strong>El ciclo de vida de los objetos de datos.</strong> <br>  Los objetos VDI solo se pueden eliminar cuando se eliminan todos los clones y las instant√°neas asociadas con ellos.  Esto es exactamente lo mismo que para Btrfs.  Por lo tanto, eliminar instant√°neas no utilizadas puede no ser suficiente para dejar espacio para el almacenamiento. </p><br><h1 id="demon-kommunikacii">  Demonio de comunicaci√≥n </h1><br><p>  El perro pastor es rid√≠culamente peque√±o en comparaci√≥n con Ceph o GlusterFS.  Esto se debe a que no intenta resolver todos los problemas por s√≠ mismo, sino que utiliza al m√°ximo lo que ya est√° funcionando. </p><br><p>  A su vez, proporciona un dispositivo de bloque que puede usarse como un disco f√≠sico, as√≠ como una incursi√≥n de software, etc. </p><br><p>  Solo le importa la distribuci√≥n de objetos de datos entre los nodos en los que se ejecuta. </p><br><p>  Sin embargo, necesita la informaci√≥n que proporciona el <strong>daemon de comunicaci√≥n</strong> , un componente clave sin el cual <strong>Sheepdog</strong> no funcionar√°. </p><br><p>  <strong>Demonio de comunicaci√≥n</strong> : no proporciona la capacidad de intercambiar datos entre nodos.  Esto es lo que <strong>los</strong> demonios de <strong>ovejas</strong> est√°n haciendo.  A trav√©s de √©l, la <strong>oveja</strong> solo descubre qu√© nodos est√°n actualmente vivos. </p><br><h2 id="corosync">  corosync </h2><br><p>  En primer lugar, <strong>Sheepdog</strong> supone que los nodos se comunicar√°n entre s√≠ a trav√©s de <strong>corosync</strong> .  Admite hasta 64 nodos, aunque en teor√≠a deber√≠a poder servir m√°s, su uso es √≥ptimo para peque√±os grupos de hasta 16 nodos. </p><br><p>  Por lo general, <strong>corosync</strong> tambi√©n usa Pacemaker, por lo que no es necesario instalar nada m√°s. </p><br><h3 id="ustanovka-corosync-na-debian">  Instale corosync en Debian </h3><br><p>  Corosync est√° en los repositorios de distribuci√≥n, y su instalaci√≥n es simple: </p><br><pre><code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> install corosync libcoro<span class="hljs-built_in"><span class="hljs-built_in">sync-common4</span></span></code> </pre> <br><h3 id="nastroyka-corosync">  Configuraci√≥n Corosync </h3><br><h2 id="zookeeper">  cuidador del zool√≥gico </h2><br><p>  <strong>Los</strong> desarrolladores de <strong>Sheepdog</strong> recomiendan usar <strong>zookeeper</strong> para grupos m√°s grandes.  Seg√∫n los desarrolladores, se construy√≥ y prob√≥ un almacenamiento de prueba de <strong>Sheepdog</strong> con 1000 nodos <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4</a></sup> <sup><a name="cite_ref-4"></a></sup>  . </p><br><h3 id="ustanovka-zookeeper-na-debian">  Instalar zookeeper en Debian </h3><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> install zookeeper zookeeperd</code> </pre> <br><p>  Lanzando el demonio .. </p><br><pre> <code class="hljs pgsql">$ /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/zookeeper/bin/zkServer.sh <span class="hljs-keyword"><span class="hljs-keyword">start</span></span></code> </pre> <br><p>  El puerto predeterminado en el que se ejecuta zookeeper es 2181 </p><br><p>  Ejecuci√≥n de perro pastor con el apoyo del cuidador del zool√≥gico: </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> sheep <span class="hljs-literal"><span class="hljs-literal">-c</span></span> zookeeper:IP1:PORT1,IP2:PORT2,IP3:PORT3 ...other...option...</code> </pre> <br><p>  La ventaja de <strong>Zookeeper</strong> es que, en su caso, <strong>Sheepdog</strong> tiene una configuraci√≥n de nodos m√°s clara y f√°cil, pero existe el problema de que el paquete de instalaci√≥n de Debian no incluye su soporte. </p><br><p>  Por lo tanto, para obtener un perro pastor con soporte de zookeeper, debe compilarlo a partir del c√≥digo fuente.  Aunque no puedo descartar que la situaci√≥n pueda ser diferente en este momento. <br>  <em>(el soporte de Zookeeper todav√≠a requiere compilaci√≥n de la fuente - aprox. por.)</em> </p><br><h1 id="nastroyka-demona-sheep">  Preparando el demonio de las ovejas </h1><br><p>  El nodo se convierte en parte del perro pastor cuando se inicia el administrador de objetos, el demonio <strong>ovino</strong> .  Siempre funciona en dos copias: </p><br><ol><li><p>  La primera instancia del proceso comienza como una puerta de enlace, que recibe las solicitudes de E / S de los clientes (por ejemplo, de los controladores de los dispositivos de bloque QEMU), calcula los nodos de destino y env√≠a solicitudes para su posterior procesamiento entre ellos.  Es decir, establece muchas conexiones de red. </p><br></li><li>  Otro funciona como administrador de objetos local ( <strong>Object Manager</strong> ) </li></ol><br><p>  Los par√°metros de configuraci√≥n del daemon de ovejas se pueden pasar como argumentos de l√≠nea de comandos en tiempo de ejecuci√≥n.  Si no hay ninguno, se utilizar√°n los valores predeterminados, con los que debe tener cuidado: </p><br><p>  <strong>N√∫mero de puerto</strong> <br>  A menos que se especifique lo contrario, el daemon de ovejas se ejecuta en el puerto 7000 </p><br><p>  <strong>Camino de la b√≥veda</strong> <br>  A menos que se especifique lo contrario, el directorio shep usa el directorio / var / lib / sheepdog, y los objetos VDI se almacenan en su subdirectorio <code>obj</code> . </p><br><blockquote>  Te√≥ricamente, nada impide que varias instancias de <strong>ovejas</strong> trabajen en un nodo; la condici√≥n principal es que todos usen su n√∫mero de puerto y su propio almacenamiento.  El problema de la direcci√≥n IP del nodo est√° casi resuelto.  ¬°Cada instancia de ejecuci√≥n del demonio de <strong>ovejas que se</strong> ejecuta en un puerto diferente se conectar√° autom√°ticamente a un cl√∫ster existente! <br><br>  La informaci√≥n importante es que el n√∫mero de puerto es parte de la configuraci√≥n del contenedor VDI.  Debe saber si desea volver a configurar el daemon de <strong>oveja</strong> para que se ejecute en el otro puerto del cl√∫ster existente. <br><br>  Por lo tanto, si ejecuta una instancia del demonio <strong>oveja</strong> con un n√∫mero de puerto diferente, pero con la misma ruta al almac√©n de objetos, puede perder informaci√≥n en los contenedores VDI existentes. </blockquote><br><h1 id="demon-sheep-kak-shlyuz">  La oveja demon√≠aca como puerta de entrada </h1><br><p>  En m√°quinas que no tienen espacio de almacenamiento para objetos VDI, el daemon de <strong>ovejas</strong> se puede ejecutar exclusivamente en modo de puerta de enlace, con el indicador <code>-G</code> . </p><br><p>  En este caso, al distribuir objetos VDI, el almacenamiento local no se utilizar√° en absoluto, y los datos se distribuir√°n directamente a otros nodos. </p><br><h1 id="demon-sheep-kak-menedzher-obektov">  Ovejas demonio como administrador de objetos </h1><br><p>  La segunda instancia en ejecuci√≥n, act√∫a como un administrador de objetos local, recibe solicitudes de E / S de una instancia que comienza como una puerta de enlace y realiza operaciones de r / w en el almacenamiento de objetos locales ( <strong>almacenamiento de objetos</strong> ) </p><br><h2 id="hranilische-obektov">  Almacenamiento de objetos </h2><br><p>  De forma predeterminada, el almacenamiento de objetos VDI en <strong>Sheepdog</strong> es el directorio <code>/var/lib/sheepdog/obj</code> , que tambi√©n utiliza el daemon de <strong>ovejas</strong> como parte de su estructura de directorio interno; esta es la ruta de almacenamiento predeterminada. </p><br><p>  Si desea que los objetos VDI se almacenen en otro lugar, puede pasar la ruta donde se monta otro dispositivo de bloque como par√°metro al inicio. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sheep</span></span> ... /cesta_do_p≈ô√≠pojn√©ho_bodu</code> </pre> <br><p>  Hay incluso m√°s formas de transmitir.  La nueva versi√≥n de <strong>Sheepdog es</strong> compatible con la llamada tecnolog√≠a de dispositivos m√∫ltiples, que le permite aumentar din√°micamente la capacidad de memoria, si es necesario, sin tener que reiniciar el <strong>Sheepdog</strong> .  El aumento de la capacidad de almacenamiento funciona de manera similar a Btrfs. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sheep</span></span> ... /cesta_do_A,/cesta_do_B,/cesta_do_C</code> </pre> <br><p>  <em>(el primer directorio especificado se usar√° solo para metadatos - aprox. por)</em> </p><br><p>  Tambi√©n se puede agregar (o eliminar) almacenamiento adicional a trav√©s <strong>del nodo de perro md</strong> </p><br><p>  ... </p><br><p>  La funcionalidad que ofrece el dispositivo m√∫ltiple es especialmente √∫til cuando el sistema de archivos de almacenamiento no es compatible con este "por dise√±o" (a diferencia de Btrfs o ZFS).  En general, la elecci√≥n de un sistema de archivos para almacenar objetos, sus propiedades, par√°metros y configuraciones puede afectar significativamente el rendimiento del sistema de archivos IO de una m√°quina virtual. </p><br><blockquote>  La tecnolog√≠a de dispositivos m√∫ltiples requiere atributos avanzados en el lado del archivo, lo que no es un problema para los sistemas de archivos modernos como btrfs <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">5</a></sup> <sup><a name="cite_ref-5"></a></sup>  o ext4.  Pero algunos sistemas de archivos m√°s antiguos como reiserfs o ext2 <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">6</a></sup> <sup><a name="cite_ref-6"></a></sup>  No los apoyen. <br><br>  Si desea utilizar un sistema de archivos que no admite atributos extendidos para almacenar objetos, necesitamos compilar <strong>Sheepdog</strong> sin compatibilidad con m√∫ltiples dispositivos. </blockquote><br><h2 id="tip-hranilischa---plain-versus-tree">  Tipo de almacenamiento: simple versus √°rbol </h2><br><p>  Al formatear un cl√∫ster, entre otras opciones, puede especificar el tipo de almacenamiento (almacenamiento de fondo).  Puede establecer el tipo en <strong>simple</strong> o en <strong>√°rbol</strong> .  Para un tipo <strong>simple</strong> , la estructura del directorio se ver√° as√≠: </p><br><pre> <code class="hljs ruby"><span class="hljs-params"><span class="hljs-params">| |</span></span>- obj <span class="hljs-params"><span class="hljs-params">| |</span></span>- &lt;id &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|-&lt; &gt; |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>-&lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|-&lt; &gt; |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>- ... <span class="hljs-params"><span class="hljs-params">| |</span></span>- &lt;id  &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> ... <span class="hljs-params"><span class="hljs-params">|- config [] |</span></span>- epoch <span class="hljs-params"><span class="hljs-params">| |</span></span>- &lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span>- &lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span>- ... <span class="hljs-params"><span class="hljs-params">|- journal \- sheep.log []</span></span></code> </pre> <br><p>  Todos los objetos VDI en el directorio <code>obj</code> se enviar√°n a un subdirectorio cuyo nombre se basa en el identificador de la era actual.  Es decir, para cada era, los objetos VDI correspondientes se almacenar√°n por separado.  Sin embargo, durante una era, una gran cantidad de objetos VDI pueden aparecer en el directorio, lo que posteriormente ralentiza el acceso a los archivos.  Por lo tanto, puede elegir la segunda opci√≥n, que es <strong>√°rbol</strong> : </p><br><pre> <code class="hljs ruby"><span class="hljs-params"><span class="hljs-params">|- obj |</span></span> <span class="hljs-params"><span class="hljs-params">|- aa |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>-&lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|-&lt; &gt; |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>-&lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|- ... |</span></span> <span class="hljs-params"><span class="hljs-params">|- ab |</span></span> <span class="hljs-params"><span class="hljs-params">| ... |</span></span> <span class="hljs-params"><span class="hljs-params">|- meta |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>- &lt; &gt; <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|- ... |</span></span> <span class="hljs-params"><span class="hljs-params">|- 0a |</span></span> <span class="hljs-params"><span class="hljs-params">| ... |</span></span>- config [] <span class="hljs-params"><span class="hljs-params">|- epoch |</span></span> <span class="hljs-params"><span class="hljs-params">|- &lt; &gt; |</span></span> <span class="hljs-params"><span class="hljs-params">|- &lt; &gt; |</span></span> <span class="hljs-params"><span class="hljs-params">|- ... \- sheep.log []</span></span></code> </pre> <br><p>  En este tipo de almacenamiento, el daemon de <strong>ovejas</strong> crea un conjunto de 256 subdirectorios con los nombres <code>0a, ..., 99</code> en el directorio <code>obj</code> , y luego dispersa los objetos en funci√≥n de los dos √∫ltimos caracteres de la <strong>identificaci√≥n de VDI</strong> , que es exclusivo no solo para cada contenedor de VDI sino tambi√©n para sus instant√°neas o clones </p><br><h2 id="imena-vdi-obektov">  Nombres de objetos VDI </h2><br><p>  Cuando <strong>Sheepdog</strong> guarda los datos en el contenedor VDI, los archivos comenzar√°n a aparecer en el almac√©n de datos <code>obj</code> , cada uno tendr√° su propio nombre que consta de varios elementos: </p><br><pre> <code class="hljs go">../obj/<span class="hljs-number"><span class="hljs-number">8f</span></span>/<span class="hljs-number"><span class="hljs-number">00e8</span></span>b18f00000005 ^^</code> </pre> <br><p>  Los primeros dos caracteres indican el tipo de objeto.  Los objetos de datos comienzan con <code>00...</code> y los metadatos (que pueden almacenarse en otro directorio) <code>80...</code> </p><br><pre> <code class="hljs go">../obj/<span class="hljs-number"><span class="hljs-number">8f</span></span>/<span class="hljs-number"><span class="hljs-number">00e8</span></span>b18f00000005 ^^^^^^</code> </pre> <br><p>  Luego viene el VDI.  Es √∫nico no solo para cada contenedor, sino tambi√©n para su instant√°nea o clon. </p><br><pre> <code class="hljs go">../obj/<span class="hljs-number"><span class="hljs-number">8f</span></span>/<span class="hljs-number"><span class="hljs-number">00e8</span></span>b18f00000005 ^^ ^^</code> </pre> <br><p>  Los dos √∫ltimos d√≠gitos del identificador VDI indican, en el caso del tipo de almacenamiento en <strong>√°rbol</strong> , en qu√© se encuentra el subdirectorio al que pertenece el objeto. </p><br><pre> <code class="hljs go">../obj/<span class="hljs-number"><span class="hljs-number">8f</span></span>/<span class="hljs-number"><span class="hljs-number">00e8</span></span>b18f00000005 ^^^^^^^^</code> </pre> <br><p>  Y el identificador del contenedor VDI en hexadecimal es seguido por el n√∫mero de serie del objeto en el contenedor VDI </p><br><h2 id="epoha">  Era </h2><br><p>  El subdirectorio de <code>epoch</code> contiene listas binarias de objetos que pertenecen a la era.  El n√∫mero de √©poca aumenta, cada vez que cambia cada cl√∫ster, cuando se agrega o elimina un nodo.  Cada uno de estos cambios inicia el proceso de <strong>recuperaci√≥n</strong> , durante el cual se comprobar√° el estado actual de los objetos locales en los nodos, seguido de un aumento en la era. </p><br><h1 id="kak-optimalno-vybrat-hranilische-vdi-obektov">  C√≥mo elegir el almacenamiento √≥ptimo de objetos VDI </h1><br><p>  La capacidad de almacenamiento disponible se calcula en funci√≥n del espacio libre en los nodos.  El espacio elegido por <strong>ovejas</strong> siempre depende de la cantidad de espacio disponible en el dispositivo de bloque donde se almacenan los objetos VDI. </p><br><p>  El tama√±o de un contenedor VDI es solo una forma virtual que no est√° relacionada con la cantidad de espacio que ocupan los objetos VDI.  Es importante saber c√≥mo Sheepdog procesa los datos en un cl√∫ster: </p><br><blockquote>  Sheepdog siempre intenta almacenar datos de manera uniforme entre todas las m√°quinas de la √©poca. </blockquote><p>  Esto significa que si uno de los nodos cae, la era cambia y <strong>Sheepdog</strong> inicia inmediatamente el proceso de recuperaci√≥n, crear√° los objetos VDI que faltan en los nodos restantes para compensar la p√©rdida. </p><br><p>  Una situaci√≥n similar surgir√° al agregar un nuevo nodo.  <strong>Sheepdog</strong> comenzar√° a mover de manera uniforme los objetos VDI de los nuevos nodos a su repositorio, de modo que el porcentaje de llenado del espacio de datos en los nodos sea lo m√°s equilibrado posible.  Use el siguiente comando para obtener una descripci√≥n global de cu√°nto espacio se usa actualmente en sus nodos: </p><br><pre> <code class="hljs pgsql">nod1 ~ # collie node md <span class="hljs-keyword"><span class="hljs-keyword">info</span></span> -A Id Size Used Avail Use% <span class="hljs-type"><span class="hljs-type">Path</span></span> Node <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1.1</span></span> TB <span class="hljs-number"><span class="hljs-number">391</span></span> GB <span class="hljs-number"><span class="hljs-number">720</span></span> GB <span class="hljs-number"><span class="hljs-number">35</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">702</span></span> GB <span class="hljs-number"><span class="hljs-number">394</span></span> GB <span class="hljs-number"><span class="hljs-number">307</span></span> GB <span class="hljs-number"><span class="hljs-number">56</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">794</span></span> GB <span class="hljs-number"><span class="hljs-number">430</span></span> GB <span class="hljs-number"><span class="hljs-number">364</span></span> GB <span class="hljs-number"><span class="hljs-number">54</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1.6</span></span> TB <span class="hljs-number"><span class="hljs-number">376</span></span> GB <span class="hljs-number"><span class="hljs-number">1.2</span></span> TB <span class="hljs-number"><span class="hljs-number">22</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1.2</span></span> TB <span class="hljs-number"><span class="hljs-number">401</span></span> GB <span class="hljs-number"><span class="hljs-number">838</span></span> GB <span class="hljs-number"><span class="hljs-number">32</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1.5</span></span> TB <span class="hljs-number"><span class="hljs-number">370</span></span> GB <span class="hljs-number"><span class="hljs-number">1.1</span></span> TB <span class="hljs-number"><span class="hljs-number">24</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj Node <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1.6</span></span> TB <span class="hljs-number"><span class="hljs-number">388</span></span> GB <span class="hljs-number"><span class="hljs-number">1.2</span></span> TB <span class="hljs-number"><span class="hljs-number">23</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/sheepdog-data/obj</code> </pre> <br><h2 id="proizvoditelnost-io">  Rendimiento de E / S </h2><br><p>  Es importante decir aqu√≠ que <strong>Sheepdog</strong> funciona de manera diferente a Ceph y tiene diferentes prioridades. </p><br><p>  Para Ceph, el "peso" del dispositivo OSD es cr√≠tico al colocar objetos de datos, as√≠ como el rendimiento del dispositivo de bloque, la conectividad del host y la velocidad de respuesta.  <em>(en realidad no - aprox. por)</em> </p><br><p>  Sheepdog hace algo como esto, no lo s√©.  Posiblemente  Los datos para √©l son lo primero.  El rendimiento en t√©rminos de operaciones de E / S es secundario.  Por supuesto, con nodos m√°s potentes, su rendimiento de E / S puede mejorar, pero siempre depende de la estructura espec√≠fica.  <em>(sin embargo, las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pruebas</a> muestran un mejor rendimiento del perro pastor en comparaci√≥n con ceph - aproximadamente por)</em> </p><br><blockquote>  Agregu√© un nuevo nodo a Sheepdog con datos almacenados en un disco giratorio SATA II de 2TB.  La velocidad m√°xima de escritura para este disco es de aproximadamente 80M / s.  De hecho, var√≠a mucho porque las unidades SATA no pueden leer y escribir al mismo tiempo. <br><br>  Inicialmente, la velocidad de escritura promedio en VDI en este disco era de aproximadamente 20 ~ 30M / s, ya que adem√°s de los datos de VDI, los datos del contenedor 392G se replicaron como parte del proceso de recuperaci√≥n.  Esto continu√≥ durante 6.5 horas.  La velocidad de escritura oscil√≥ entre 40 ~ 55M / s. <br><br>  Obviamente, en este caso, la velocidad de escritura estaba limitada por el rendimiento de E / S del dispositivo de bloque local. </blockquote><p>  Para Sheepdog, se aplica la siguiente regla: "Cuantos m√°s objetos VDI haya en los nodos con conexi√≥n r√°pida, mejor ser√° el rendimiento de las operaciones de E / S". </p><br><p>  Debido al hecho de que mover objetos VDI en segundo plano significa que la "muerte r√°pida de un nodo" ralentizar√° la replicaci√≥n de los objetos de datos que ocupan m√°s espacio, esto se manifestar√° como una disminuci√≥n en el rendimiento de las operaciones de E / S del contenedor VDI </p><br><h2 id="zanimaemoe-prostranstvo">  Espacio ocupado </h2><br><p>  Al colocar objetos de datos, la cantidad de espacio libre es cr√≠tica para el demonio <strong>ovino</strong> .  El mecanismo parece simple.  El demonio <strong>ovino</strong> , a trav√©s del cual los datos se comunican con el contenedor VDI, de vez en cuando determina la utilizaci√≥n del espacio libre y ocupado en los nodos, lo que lo ordena.  Luego, los datos se distribuyen entre los nodos con la tasa de utilizaci√≥n m√°s baja. </p><br><p>  Si hay una ruta de escritura predominantemente r√°pida, la operaci√≥n de escritura en el contenedor VDI tambi√©n ser√° r√°pida.  Como cuanto m√°s r√°pido se realicen las operaciones de E / S del contenedor VDI, antes el demonio <strong>ovino</strong> puede proceder a la siguiente operaci√≥n. </p><br><p>  Lo importante es que con Sheepdog no habr√° situaci√≥n cuando uno de los nodos est√© completamente lleno.  Si la tasa de utilizaci√≥n en el nodo empeora mucho, entonces el demonio oveja comienza a mover sus objetos de datos a otra ubicaci√≥n. </p><br><p>  Sheepdog funciona igual que Btrfs, utilizando solo el espacio realmente ocupado.  Por lo tanto, puede crear un contenedor VDI virtual con una capacidad de 1 TB, que en realidad ocupar√° tanto espacio como los datos almacenados en √©l.  Desde este punto de vista, es deseable utilizar tales formatos de discos virtuales y sistemas de archivos en contenedores VDI que puedan limpiarse uno tras otro. </p><br><h1 id="zapusk-klastera">  Lanzamiento de cl√∫ster </h1><br><blockquote>  Si bien todos los nodos se pueden detener al mismo tiempo, los nodos no se pueden iniciar a la vez.  Los nodos deben conectarse gradualmente.  Comenzando con el nodo que se especific√≥ por primera vez en la lista de nodos. <br>  <em>(Esta es una declaraci√≥n extremadamente extra√±a - aproximadamente por)</em> </blockquote><br><h1 id="vdi">  Vdi </h1><br><p>  Esta es una abreviatura gen√©rica en <strong>Sheepdog</strong> para disco virtual, no su formato espec√≠fico. <sup><a name="cite_ref-7"></a></sup>  .  En general, esta es una caja virtual con compartimentos de tama√±o fijo, en la que <strong>Sheepdog</strong> luego coloca los datos que el cliente transmite. </p><br><h1 id="sozdanie-vdi">  Creando VDI </h1><br><p>  Antes de crear o importar el primer VDI, debemos formatear el cl√∫ster.  Al formatear un cl√∫ster, se establecen par√°metros que luego se usar√°n de manera predeterminada al crear cada VDI posterior. </p><br><p>  Un ejemplo que demuestra la creaci√≥n de un nuevo VDI llamado Disk1 y 1 GB de tama√±o </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi create disk1 1G root</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@nod</span></span></span><span class="hljs-comment">1 :~# collie vdi list Name Id Size Used Shared Creation time VDI id Copies Tag Block Size Shift disk1 0 1.0 GB 0.0 MB 0.0 MB 2015-12-04 14:07 e8b18f 2 22</span></span></code> </pre> <br><p>  <strong>Id</strong> <br>  Identificador VDI </p><br><p>  <strong>Tama√±o</strong> <br>  El tama√±o del VDI que no necesariamente se asignar√° previamente de forma inmediata. <br>  Si este VDI est√° en formato incremental (qcow2 y similares) creado usando <code>qemu-img convert</code> , no coincidir√° con el tama√±o del disco virtual, pero crecer√° constantemente. </p><br><p>  <strong>Usado</strong> <br>  Informaci√≥n sobre cu√°nto espacio ocupan los objetos de datos VDI. <br>  VDI, que no requiere la asignaci√≥n de objetos de datos durante la creaci√≥n, no ocupar√° nada en absoluto, ya que los objetos de datos a√∫n no se han creado para ello. </p><br><p>  <strong>Compartido</strong> <br>  El volumen de objetos de datos que comparten otros VDI </p><br><p>  <strong>Tiempo de creaci√≥n</strong> <br>  Tiempo de creaci√≥n de VDI </p><br><p>  <strong>Tama√±o del bloque</strong> <br>  El tama√±o del objeto VDI.  Atencion  No se especifica en MB, sino como una potencia de dos bytes.  En versiones anteriores, solo se usaban objetos de tama√±o fijo de 4 MB.  Actualmente, VDI puede tener objetos m√°s grandes.  El tama√±o √≥ptimo para el objeto VDI de una m√°quina virtual normal se parece a 64 MB (26).  El tama√±o predeterminado de 22 (4 MB) tambi√©n es m√≠nimo.  Menos no se puede instalar.  Cuanto m√°s peque√±o sea el tama√±o del objeto, mayor ser√° el n√∫mero de archivos que <strong>Sheepdog</strong> tendr√° que procesar <strong>mientras</strong> trabaja con VDI, y trabajar con archivos no es un problema barato desde el punto de vista de IO.  Una gran cantidad de archivos, especialmente con controladores SATA lentos, puede conducir a un fuerte deterioro en las velocidades de lectura y escritura.  El tama√±o m√°ximo de los objetos que se pueden usar es 31 (2 GB).  Esto puede ser beneficioso si VDI almacena constantemente una gran cantidad de datos est√°ticos, como copias de seguridad. </p><br><p>  <strong>Identificaci√≥n de Vdi</strong> <br>  Identificador de VDI. </p><br><h2 id="chto-soderzhit-vdi">  ¬øQu√© contiene VDI? </h2><br><p>  El contenido de VDI son datos.  Este es un dispositivo de bloque distribuido, por lo que <strong>Sheepdog</strong> no resuelve estos datos o basura.  Desde este punto de vista, VDI parece un volumen l√≥gico LVM.  Un VDI rellenado previamente corresponde a una partici√≥n LV cl√°sica con un rango dedicado, mientras que VDI se asemeja a una partici√≥n LV delgada creada en un grupo (consulte LVM (thin_provisioning)), pero con la diferencia de que las extensiones de datos (objetos) no se almacenan localmente bloquean dispositivos y est√°n dispersos entre nodos. </p><br><blockquote>  El formato VDI funciona en esta analog√≠a como un sistema de archivos.  Algunos ocupan extensiones reservadas (objetos) secuencialmente, otros los asignan como sus inodos y luego les env√≠an datos directamente.  Una combinaci√≥n incorrecta del sistema de archivos de almacenamiento de nodos, el formato VDI y el sistema de archivos interno puede provocar una degradaci√≥n significativa del rendimiento de E / S. </blockquote><br><h2 id="kak-poluchit-informaciyu-o-vdi">  C√≥mo obtener informaci√≥n sobre VDI </h2><br><p>  Para obtener m√°s informaci√≥n sobre el formato VDI, puede usar <strong>qemu-img info</strong> : </p><br><pre> <code class="hljs mel">root@nod1 :~# qemu-img info sheepdog:localhost:<span class="hljs-number"><span class="hljs-number">8000</span></span>:disk1 <span class="hljs-keyword"><span class="hljs-keyword">image</span></span>: sheepdog:localhost:<span class="hljs-number"><span class="hljs-number">8000</span></span>:test2 <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">format</span></span>: qcow2 virtual <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>G (<span class="hljs-number"><span class="hljs-number">12884901888</span></span> bytes) disk <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">4.0</span></span>G cluster_size: <span class="hljs-number"><span class="hljs-number">65536</span></span> Format specific information: compat: <span class="hljs-number"><span class="hljs-number">1.1</span></span> lazy refcounts: false refcount bits: <span class="hljs-number"><span class="hljs-number">16</span></span> corrupt: false</code> </pre> <br><p>  A partir de la salida del comando, puede descubrir que disk1 tiene un tama√±o nominal de 12G.  Actualmente solo toma 4G.  Como est√° en formato qcow2, es obvio que se cre√≥ como incremental. </p><br><pre> <code class="hljs mel">root@nod1 :~# collie vdi list Name Id Size Used Shared Creation time VDI id Copies Tag Block Size Shift disk2 <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4.0</span></span> GB <span class="hljs-number"><span class="hljs-number">4.0</span></span> GB <span class="hljs-number"><span class="hljs-number">0.0</span></span> MB <span class="hljs-number"><span class="hljs-number">2015</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span><span class="hljs-number"><span class="hljs-number">-04</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">825</span></span>dc1 <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> root@nod1 :~# qemu-img info sheepdog:localhost:<span class="hljs-number"><span class="hljs-number">8000</span></span>:disk2 <span class="hljs-keyword"><span class="hljs-keyword">image</span></span>: sheepdog:localhost:<span class="hljs-number"><span class="hljs-number">8000</span></span>:disk2 <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">format</span></span>: raw virtual <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">4.0</span></span>G (<span class="hljs-number"><span class="hljs-number">4294967296</span></span> bytes) disk <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>: <span class="hljs-number"><span class="hljs-number">4.0</span></span>G root@nod1 :~# find /datastore/obj/ | grep <span class="hljs-number"><span class="hljs-number">825</span></span>dc1 /datastore/obj/meta/<span class="hljs-number"><span class="hljs-number">80825</span></span>dc100000000 /datastore/obj/c1/<span class="hljs-number"><span class="hljs-number">00825</span></span>dc100000000 /datastore/obj/c1/<span class="hljs-number"><span class="hljs-number">00825</span></span>dc100000001</code> </pre> <br><p>  En este caso, Disk2 se cre√≥ como un VDI de 4 GB preasignado en formato sin formato con un tama√±o de bloque de 2 GB, que en realidad solo toma dos 2 GB </p><br><h2 id="eksport-vdi-v-fayl">  Exportar VDI a archivo </h2><br><p>  El contenido VDI se puede exportar desde <strong>Sheepdog de</strong> varias maneras.  Quiz√°s lo m√°s r√°pido es usar <strong>la lectura del perro</strong> .  El comando es un poco confuso, pero solo significa: "Cargue el contenido del VDI y env√≠elo a STDOUT ..", que puede redirigirse a un archivo: </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi read disk1 &gt; /backups/soubor.raw</span></span></code> </pre> <br><p>  Si VDI tiene 10G pero solo se usa 2G, crear√° un archivo con una capacidad total de 10 GB. </p><br><p>  <strong>En este comando, el contenido del VDI no cambia</strong> , por lo que si el contenido del VDI, por ejemplo, un disco virtual en el formato comprimido qcow2, se puede usar directamente </p><br><pre> <code class="hljs mel">.. -drive <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>:/disk1_exportovany_z_vdi,..,<span class="hljs-keyword"><span class="hljs-keyword">format</span></span>=qcow2 ..</code> </pre> <br><p>  Otra forma de obtener el contenido de VDI en un archivo es usar <strong>qemu-img convert</strong> .  No es tan r√°pido, pero le permite convertir VDI a otro formato utilizando diferentes opciones del formato de disco virtual correspondiente. </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># qemu-img convert -f qcow2 -O file -o preallocation=full,nocow=on sheepdog:localhost:8000:disk1 /disk1_exportovany_z_vdi</span></span></code> </pre> <br><h2 id="inkrementnoe-rezervnoe-kopirovanie">  Copia de seguridad incremental </h2><br><p>  Crear copia de seguridad incremental </p><br><p>  Delta entre la primera y la segunda instant√°nea. </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi backup test -F snap1 -s snap2 /backups/soubor_diff</span></span></code> </pre> <br><p>  Restaurar VDI de copia de seguridad incremental </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi restore test -s snap1 /tmp/backup restoring /tmp/backup... done</span></span></code> </pre> <br><p>  Al importar una copia de seguridad incremental, el VDI deber√≠a tener, por supuesto, la instant√°nea desde la que se realiz√≥ la copia de seguridad. </p><br><p>  Verificaci√≥n leyendo el contenido original de la imagen de prueba </p><br><pre> <code class="hljs ruby"> root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi read test 0 512 -s 3</span></span></code> </pre> <br><h1 id="import-vdi-iz-fayla">  Importar VDI desde archivo </h1><br><p>  La importaci√≥n de un disco virtual existente como un archivo FS local puede realizarse de manera similar a la exportaci√≥n.  Pero con la diferencia de que <strong>se usa la escritura de perro</strong> ("Leer datos de STDIN y escribir en un archivo VDI ...") </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi write disk1 &lt; /backups/soubor.raw</span></span></code> </pre> <br><p></p><br><blockquote><ul><li>  El contenido solo se puede importar a un VDI existente. </li><li>  El VDI importado siempre ocupa m√°s espacio que el archivo original, porque los bloques de datos desde los que se restaura el VDI contienen datos en el √°rea marcada. </li></ul><br></blockquote><p>  Si todav√≠a no existe VDI y no sabemos cu√°nto espacio se necesitar√° para el disco virtual, podemos usar <strong>qemu-img convert</strong> </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># qemu-img convert -f file -O qcow2 -o redundancy=2:1 ./disk_ukladany_do_vdi sheepdog:localhost:8000:disk</span></span></code> </pre> <br><blockquote>  Aunque los formatos VDI como qcow2, qed y otros se pueden usar en VDI.  Para la eficiencia de E / S, es mejor preasignar bloques de datos. <br>     ,        <strong>Sheepdog</strong>     VDI. </blockquote><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://www.sheepdog-project.org/doc/vdi_read_and_write.html</a> </p><br><h1 id="proverka-vdi">  VDI </h1><br><p>    VDI ,      . </p><br><pre> <code class="hljs ruby">root@nod1 <span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment"># collie vdi check disk1</span></span></code> </pre> <br><blockquote>    VDI,     .    Sheepdog    ,      .     ,            . </blockquote><p> :   'dog node kill'     ,         ethernet ,   sheep    .          (,    Ethernet),         sheep .               . </p><br><h2 id="io-proizvoditelnost-vdi"> IO  VDI </h2><br><p>  VDI    .          .       ,   IO   VDI. </p><br><p>   <strong>Sheepdog</strong>    SYNC,    .   -,     VFS,   ,       ,       . </p><br><p>       VDI  <strong>Sheepdog</strong>    ,            .              .  <strong>Sheepdog</strong>        VDI-. </p><br><h2 id="ispolzovanie-vfs-kesha-nody">  VFS-  </h2><br><p>      IO  VDI      <strong>sheep</strong>   <strong>-n</strong> .    SYNC         ,   ,        VFS .     ,   VFS  ,   ,      ! </p><br><p>         .            ,          ‚Äî , ,    . </p><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">sheep</span></span> -n ...</code> </pre> <br><blockquote>   <strong>Sheepdog</strong>      .      <strong>-D</strong> </blockquote><br><h1 id="obektnyy-kesh">   </h1><br><p>     -   .   <strong>sheep</strong>           -   IO ‚Äî  SSD .  ,   VDI,       SYNC   .             . </p><br><p>       ,   VDI     ,         VDI   . ,     ,     ,      VDI. </p><br><pre> <code class="hljs dos">sheep -w size=<span class="hljs-number"><span class="hljs-number">20000</span></span>,directio,<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>=/<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> ...</code> </pre> <br><p> <strong>size</strong> <br>   </p><br><p> <strong>directio</strong> <br>     <strong>sheep</strong>      ,      .      SSD. </p><br><p> <strong>dir</strong> </p><br><pre> <code class="hljs erlang">     ,     .</code> </pre> <br><p>       ( )   <strong>dog</strong> . </p><br><blockquote>        VDI          <strong>dog vd cashe flush</strong> ,     VDI! </blockquote><br><h2 id="zhurnal">  Revista </h2><br><p>   ‚Äî  .           VDI,     VFS   ,           (/store_dir/journal/[epoch]/[vdi_object_id]),     ,    . </p><br><p>   IO   ,        (cik, cak),   (sequence). </p><br><p>  , <strong>Sheepdog</strong>        VDI ,           ,  SSD-.     ,       VDI    ,           ,                VDI. </p><br><p>        <strong>sheep</strong>      ‚Äî         </p><br><pre> <code class="hljs matlab">$ sheep -<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> <span class="hljs-built_in"><span class="hljs-built_in">size</span></span>=<span class="hljs-number"><span class="hljs-number">256</span></span>M ...</code> </pre> <br><p>       ,  VDI      ,    .        -,   ‚Äî   ‚Äî         -: </p><br><pre> <code class="hljs matlab">$ sheep -<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> dir=/dir,<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>=<span class="hljs-number"><span class="hljs-number">256</span></span>M ...</code> </pre> <br><p>  dir =      ,          .       ,     SW RAID     SSD. </p><br><p> <strong>:</strong>    <strong>sheep</strong>     ,    .     ,      skip,   . </p><br><pre> <code class="hljs matlab">$ sheep -<span class="hljs-built_in"><span class="hljs-built_in">j</span></span> dir=/dir,<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>=<span class="hljs-number"><span class="hljs-number">256</span></span>M,skip ...</code> </pre> <br><hr><br><ol><li> <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">‚Üë</a> <a name="cite_note-1"></a> .       2015 . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://events.linuxfoundation.jp/sites/events/files/slides/COJ2015_Sheepdog_20150604.pdf</a></sup> </li><li> <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">‚Üë</a> <a name="cite_note-2"></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://www.abclinuxu.cz/blog/kenyho_stesky/2011/11/sheepdog-hrajeme-si-v-hampejzu</a></sup> </li><li> <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">‚Üë</a> <a name="cite_note-3"></a> SPOF ( <strong>S</strong> ingle <strong>p</strong> oint <strong>o</strong> f <strong>f</strong> ailure) ,             .  SPOF   VDI   iSCSI  <strong>tgtd</strong></sup> </li><li> <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">‚Üë</a> <a name="cite_note-4"></a></sup>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1</a></sup> </li><li><p> <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">‚Üë</a> <a name="cite_note-5"></a> Btrfs ‚Äî    COW,       ,        .   ,      -,      .      ,     ,              .      ,         ,   .  ,     :</sup> </p><br><p> <sup>autodefrag ‚Äî     ,          .</sup> </p><br><p> <sup>      </sup> </p><br><p> <sup>nocow ‚Äî           (),      ‚Äî           GlusterFS</sup> </p><br><p> <sup> Btrfs   ,     ,     FS,       <strong>Sheepdog</strong> .</sup> </p><br><ul><li> <sup>    ,   ,    ,      </sup> </li><li> <sup>  multipath,                         .</sup> </li></ul><br><p> <sup>,  ,        ,        Sheepdog.</sup> </p><br></li><li><p> <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">‚Üë</a> <a name="cite_note-6"></a> <strong>Ext2</strong> .     -  FS  Btrfs,    ext2,     inode.    ext3  ext4     .   inode , Sheepdog          . ,      -,   .           ,   <strong>Sheepdog</strong>      ,         <strong>dog vdi check</strong> . ,  ext2  ,            ‚Äî    -     <strong>dog vdi md</strong> ,       VDI     .</sup> </p><br></li><li> <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">‚Üë</a> <a name="cite_note-7"></a>    ,   , <strong>vdi</strong>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">QEMU_Block_Disk</a></sup> </li></ol><br><h1 id="ssylki">  Referencias </h1><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/collie/sheepdog/wiki</a> ‚Äî ,        <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://www.osrg.net/sheepdog/</a> ‚Äî    Nippon Telegraph and Telephone Corporation <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://www.sheepdog-project.org/doc/index.html</a> ‚Äî   Sheepdog   0.8.0;  ‚Äî Valerio Pachera <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://www.admin-magazine.com/Archive/2014/23/Distributed-storage-with-Sheepdog</a> ‚Äî  Udo Seidela   <strong>Sheepdog</strong> ,   23-   Admin   2014  </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es412739/">https://habr.com/ru/post/es412739/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es412725/index.html">C√≥mo hacer que su infraestructura de TI sea aburrida</a></li>
<li><a href="../es412727/index.html">¬øC√≥mo elegir una herramienta para la creaci√≥n de prototipos en 2018?</a></li>
<li><a href="../es412729/index.html">RGPD. ¬øEs necesario realizarlo en Rusia?</a></li>
<li><a href="../es412735/index.html">Deja el concurso ATM Alone en PHDays 8</a></li>
<li><a href="../es412737/index.html">Protecci√≥n de datos personales de 3.000 millones de personas: similitudes y diferencias en la legislaci√≥n de los pa√≠ses BRICS</a></li>
<li><a href="../es412741/index.html">C√≥mo dejar de temer que la inteligencia artificial te dejar√° sin trabajo</a></li>
<li><a href="../es412743/index.html">Profesi√≥n: detective cibern√©tico</a></li>
<li><a href="../es412747/index.html">MIS Almacenamiento de datos m√©dicos</a></li>
<li><a href="../es412749/index.html">La electr√≥nica como arte: corriente el√©ctrica</a></li>
<li><a href="../es412751/index.html">Calvicie: Teor√≠a y pr√°ctica del tratamiento, parte 1 "Mi dihidrotestosterona, mi enemigo"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>