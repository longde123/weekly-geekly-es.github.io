<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèª üë®üèº‚Äç‚öñÔ∏è üòã Wie Yandex.Zen, das WordPress-Caching-Plugin und das Hosting, meinen Druck steigerten ü•™ üñïüèº ‚úãüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel stammt vielmehr aus einer Reihe von "Hostess Notes". Nun, ein bisschen mehr √ºber pers√∂nliche Erfahrungen und Aush√∂hlungen. 

 Wenn Sie ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie Yandex.Zen, das WordPress-Caching-Plugin und das Hosting, meinen Druck steigerten</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423005/"><img src="https://habrastorage.org/webt/12/3o/cf/123ocfvpows898t7vrwuhhveguo.jpeg" alt="Bild" width="100%"><br><br>  Dieser Artikel stammt vielmehr aus einer Reihe von "Hostess Notes".  Nun, ein bisschen mehr √ºber pers√∂nliche Erfahrungen und Aush√∂hlungen. <br><br>  Wenn Sie sich mit WordPress-Sites befassen m√ºssen, auf denen das WP Super Cache-Caching-Plugin installiert ist, kann der Artikel f√ºr Sie hilfreich sein.  Ansonsten ist dies nur eine kurze Geschichte. <br><a name="habracut"></a><br>  Kurz gesagt, der Anfang der Geschichte lautet: Es gab eine Website.  Thematische Nachrichten und Informationen.  Erstellt von einem unbekannten Assistenten auf CMS WordPress.  Und genau so, wie es in diesem Moment von seinem Besitzer erlaubt wurde.  Im Laufe der Zeit gewann die Website an Popularit√§t, die Anzahl der Besucher wuchs.  Die Seite selbst "verdient" auf Werbung.  Das hei√üt,  Je mehr Besucher, desto besser.  Irgendwann, w√§hrend der Spitzenlast, begann sich die Site zu drehen: Seiten wurden langsam geladen und so weiter.  Aber bis sich der Schwanz pickte, bewegte sich nat√ºrlich niemand wirklich.  Der Hahn erschien in dem Moment, als der Ort ein Ereignis abdecken sollte, das die Aufmerksamkeit der √ñffentlichkeit auf sich zog.  Besucher kamen herein, die Website ging unter und alle gesch√§tzten Einnahmen schmolzen vor unseren Augen.  Aufgrund der Umst√§nde musste ich als Beatmungsbeutel fungieren.  Ich habe damals <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen Artikel</a> dar√ºber geschrieben.  Meine Entscheidung war gruselig (nicht wiederholen), aber das Hauptziel wurde erf√ºllt - Tr√§ume wurden gerettet.  Meistens. <br><br>  Nat√ºrlich war niemand daran interessiert, eine √§hnliche Situation zu wiederholen, und arbeitete an der Website.  Zun√§chst fanden sie die Gr√ºnde f√ºr den Ausfall und die hohe Auslastung des Servers heraus.  Sie waren an der Tagesordnung: das Fehlen einer Caching-Site als solche und eines schlecht implementierten Mechanismus zum Aufzeichnen und Anzeigen der Anzahl der Artikelansichten.  Letzterer selbst hat eine anst√§ndige Last erzeugt: Bei jeder Anforderung f√ºr die Artikelseite nahm er die Anzahl der Ansichten dieses Artikels aus der Datenbank, zeigte sie an, f√ºgte eine hinzu und schrieb sie zur√ºck in die Datenbank.  Gleichzeitig wurde die Tabelle <b>wp_postmeta</b> mit Metadaten zur Speicherung verwendet (wie es in WP zu hei√üen scheint).  In dem die Masse v√∂llig irrelevant f√ºr die Buchhaltung von Informationen gespeichert war und die sehr gro√ü war. <br><br>  Das Caching-Problem wurde einfach gel√∂st: In einer ruhigen Umgebung wurde das WP Super Cache-Plugin normal installiert.  Was mir viele, wenn ich mich richtig erinnere, geraten haben, anstelle der unheimlichen Kr√ºcke, die ich in den Kommentaren zu meinem Artikel gebaut habe, zu tun.  Ehrlich gesagt habe ich damals und heute schlecht im WordPress-√ñkosystem navigiert und daher erschien diese Kr√ºcke.  Das Caching-Plugin wurde von bereits bekannten Personen installiert und konfiguriert und war sofort einsatzbereit.  Damit war das Caching-Problem gel√∂st.  Warum dieses Plugin ausgew√§hlt wurde, wei√ü ich nicht genau.  Soweit ich wei√ü, ist dies eines der beliebtesten Plugins dieses Typs f√ºr WP. <br><br>  Angesichts der Ansichten verhielten sie sich etwas anders.  Es ist klar, dass der urspr√ºngliche Mechanismus aufgegeben werden musste.  Ich wollte mich nicht weigern, die Ansichten selbst zu ber√ºcksichtigen: Zumindest ein Block, der wie "die beliebtesten Artikel der Woche" zeigt, war damit verbunden.  Alle Plugins zum Aufzeichnen von Ansichten, auch wenn sie mit dem Caching-Plugin "befreundet" waren, erwiesen sich als sehr uners√§ttlich und implementierten meistens denselben Mechanismus beim Schreiben und Extrahieren von Daten aus wp_postmeta.  F√ºr einen kleinen Standort ist dies durchaus geeignet.  F√ºr einen Standort mit relativ soliden Spitzenbesuchsquoten - nicht mehr: zu gefr√§√üig f√ºr eine so kleine Funktion.  Dann tauchte ich √ºbrigens jahrelang f√ºr bezahltes und unbenutztes Hosting auf.  Am einfachsten und billigsten.  Die Verantwortung f√ºr das Speichern, Aufzeichnen und Zur√ºckgeben von Daten √ºber Ansichten lag bei ihm.  Alles ist asynchron, d.h.  Selbst wenn es herunterf√§llt, werden auf der Hauptseite weiterhin leise Artikel, Anzeigen und alles angezeigt, was angezeigt werden soll.  Die Online-Speicherung der Anzeigedaten wurde Redis und die Langzeitspeicherung MySQL zugewiesen.  Es dreht sich also, es fragt nicht wirklich und verschlingt 1-2% der maximal zul√§ssigen Last auf diesem Hosting. <br><br>  Und so vergeht eine ziemlich lange Zeit.  Wieder Nacht und wieder eine alte Geschichte.  Ziemlich starker Verkehr geht auf die Site und die Site beginnt zu fallen.  Und wieder bin ich der einzige Spezialist f√ºr wache Bedingungen in der Region.  Nat√ºrlich bin ich √ºberrascht √ºber die Wiederholung von Ereignissen.  Mein erster Gedanke ist, dass jemand versehentlich das Caching deaktiviert hat.  Aber nein, im Quellcode der Site-Seite, die mir der fallende Server gibt, sehe ich Anzeichen daf√ºr, dass ein Caching-Plugin funktioniert.  Alles sollte in Ordnung sein.  Aber in der Server-Systemsteuerung sehe ich, dass kein RAM mehr vorhanden ist, die Anzahl der Datenbankabfragen unglaublich ist und alles schlecht ist.  Zuerst √∂ffne ich die Seite mit der Beschreibung des Plugins, laufe schnell durch ihre Augen, finde nichts und verlasse diese Aktivit√§t.  Der n√§chste Schritt ist das Anzeigen der Statistiken.  Ich sehe, dass der Hauptverkehrsfluss von Yandex.Zen in die Site flie√üt.  Und die Anfrage, die den Benutzer zur Site f√ºhrt, sieht folgenderma√üen aus: <br><br><blockquote>  https://example.com <b>? utm_referrer = https:% 2F% 2Fzen.yandex.com</b> </blockquote><br>  Das hei√üt,  Yandex.Zen f√ºgt der Adresse sein utm-Tag hinzu.  Da der Server bereits vollst√§ndig im Liegen liegt und mir nur 500 gibt, kann ich aus irgendeinem Grund die Theorie, dass Seiten mit einer solchen "Gewichtung" nicht zwischengespeichert werden, nicht eindeutig √ºberpr√ºfen.  Daher wird eine weitere ‚ÄûKr√ºcke‚Äú geboren (sie wurde sp√§ter ersetzt): Zu .htaccess wird eine Umleitung hinzugef√ºgt, die die Anfrage mit utm-Tags in eine Anfrage ohne diese umwandelt, bevor WordPress und alle seine leistungsstarken Plugins ins Spiel kommen.  Die Maschine startet neu und voila, alles funktioniert: Die Site wird schnell geladen, der Server raschelt leise bei niedrigen Geschwindigkeiten.  Da ist nichts passiert. <br><br>  Dann entspannte ich mich und kletterte ruhig und beobachtete die Einstellungen des Caching-Plugins.  Zun√§chst das Kontrollk√§stchen "Seiten nicht mit GET-Parametern zwischenspeichern".  Alles ist gut, sie ist es nicht wert.  Wie das Experiment gezeigt hat, bew√§ltigt das Plugin das Abfrage-Caching mit einem beliebigen Satz beliebiger Parameter.  Wenn dies keine utm-Tags sind (tats√§chlich habe ich nur Anforderungen eines bestimmten Typs umgeleitet und nicht alle utm-Tags abgeschnitten). <br><br>  Hier habe ich mir (mit STRG + F) die Plugin-Seite genau angesehen.  Und ich fand dort in den FAQ den herrlichen Absatz "Wie sollte ich die Tracking-Tools utm_source in Google Analytics mit diesem Plugin am besten verwenden?".  Es ist klar, dass ich ihn bei der ersten fl√ºchtigen Pr√ºfung ignoriert habe: Es scheint nichts mit dem Problem zu tun zu haben.  Gleichzeitig ist es √ºbrigens nicht sehr informativ und bietet keine spezifische L√∂sung. <br><br>  <b>Die einzig m√∂gliche n√ºtzliche Schlussfolgerung im Artikel:</b> Wenn Sie eine WP-Site mit dem WP Super Cache-Plugin haben, √ºberpr√ºfen Sie, was sie tut (oder nicht), wenn Sie eine Anfrage mit den Parametern ‚Äû? Utm_referrer = https:% 2F% 2Fzen. yandex.com "usw.  Ich bin mir nicht sicher, ob bei der Installation dieses Plugins jeder seine FAQ so sorgf√§ltig liest.  Die spezifische Implementierung bleibt anscheinend bei den Site-Eigent√ºmern: Als ich mir das Update dieses Plugins das letzte Mal angesehen habe, habe ich keine √Ñnderungen bez√ºglich seiner seltsamen Reaktion auf utm-Tags gesehen. <br><br>  Aber die Geschichte w√§re unvollst√§ndig gewesen (und ich h√§tte es nicht erz√§hlt), wenn es keine weitere Best√§tigung von Murphys Gesetz gegeben h√§tte.  W√§hrend wir friedlich mit dem Eigent√ºmer der Site korrespondierten und beobachteten, wie die Site ungef√§hr eine Stunde lang leise funktionierte ... fiel die Site.  Unerwartet und endlich.  Es gibt keinen Zugriff auf das Server Control Panel, FTP, SSH und alles andere funktioniert nicht.  Nichts funktioniert.  Wenn zuvor mein Druck durch die L√∂sung des Problems, das J. Zen und das Caching-Plugin ausgel√∂st haben, nur geringf√ºgig erh√∂ht wurde (schlie√ülich ist es ein besonderes Vergn√ºgen, schnell etwas zu verstehen und zu beheben), ist mir eine ganze Mini-Panikattacke passiert.  Und nur das vage Gef√ºhl, dass ein paar Zeilen in .htaccess eine Stunde nach dem Erstellen dieser Zeilen nicht alles t√∂ten k√∂nnen, lie√ü den ‚ÄûMini‚Äú nicht zu etwas Vollst√§ndigerem werden.  Im Allgemeinen sind wir nach ein paar Minuten des Austauschs √ºberraschter Nachrichten auf das pers√∂nliche Konto des Hosting-Anbieters gestiegen, auf dem sich der Server befindet.  Und dort fanden wir in Tickets eine Warnung √ºber "technische Arbeit von X nach Y auf MSC".  Das Interessanteste ist, dass wir bei der Post, egal wie wir gesucht haben, keine Nachrichten vom Hoster √ºber diese Werke gefunden haben.  Das Ticket war mindestens einen Tag alt.  Zuvor gingen solche Nachrichten per Post ein, und normalerweise sieht sich niemand Tickets des Support-Service (und des B√ºros des Hosters selbst) an, normalerweise ohne besonderen Bedarf.  Daher war das, was passiert ist, eine gro√üe √úberraschung.  Danach schimpften wir mit den Augen des Gastgebers, lachten, warteten, bis alles funktionierte und gingen schlafen. <br><br>  Hier ist eine Geschichte. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de423005/">https://habr.com/ru/post/de423005/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de422989/index.html">Eine Datenbank ist nicht nur ein Data Warehouse</a></li>
<li><a href="../de422993/index.html">Brennen von OLED-Fernsehern in echten Tests</a></li>
<li><a href="../de422995/index.html">QA-Mitap in Redmadrobot</a></li>
<li><a href="../de422997/index.html">Das Buch "Modern PHP"</a></li>
<li><a href="../de422999/index.html">Erstellen Sie Ihren eigenen Alien-Datensatz</a></li>
<li><a href="../de423007/index.html">‚ÄûMalyavki, aber gut‚Äú: Wie wir die Sch√ºler zum √úben gebracht haben</a></li>
<li><a href="../de423009/index.html">SENS-Diagnose. Proteinglykations-Biomarker</a></li>
<li><a href="../de423011/index.html">Microservice Management mit Kubernetes und Istio</a></li>
<li><a href="../de423013/index.html">So organisieren Sie Ihre Abh√§ngigkeiten in einer Vue-Anwendung</a></li>
<li><a href="../de423015/index.html">Git: H√§ufige Fehler und wie man sie behebt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>