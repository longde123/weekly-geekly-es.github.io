<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÇ üë©üèª‚Äçüåæ üîç Kryptografische Workstation basierend auf PKCS # 11-Token. Zertifikate f√ºr EGAIS erhalten. Teil 4 ‚òùüèø üî† ü§Æ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Und jetzt, als ich der kryptografischen Workstation, die auf PKCS # 11 cryptoarmpkcs-Token basiert, beinahe die Generierung selbstsignierter Zertifika...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kryptografische Workstation basierend auf PKCS # 11-Token. Zertifikate f√ºr EGAIS erhalten. Teil 4</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464017/"><img src="https://habrastorage.org/webt/wp/sl/w1/wpslw1m_c55qfxj1sifpmgmge20.png" align="left">  Und jetzt, als ich der kryptografischen Workstation, die auf PKCS # 11 cryptoarmpkcs-Token basiert, beinahe die Generierung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">selbstsignierter Zertifikate</a> hinzugef√ºgt h√§tte und bereit w√§re, mit dem Schreiben des Artikels zu beginnen, erhielt ich einen Brief wie den folgenden: <blockquote> Wir sind die UZNIREK-Zertifizierungsstelle. Wir hatten Schwierigkeiten, ES im pkcs # 11-Format f√ºr EGAIS auszugeben. Das Portal versteht die ES im Znamerek-CSP-Format nicht. Wir bitten Sie, bei diesem Problem zu helfen. </blockquote>  Ich kannte nicht alle Feinheiten der Arbeit mit EGAIS, aber da es sich um PKCS # 11 handelte, schlug ich vor, das Dienstprogramm cryptoarmpkcs zu verwenden, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">um eine Anforderung</a> zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">generieren</a> und ein Zertifikat f√ºr ein Token zu installieren, nachdem es von der Zertifizierungsstelle empfangen wurde.  Die Antwort, die ich erhielt, war etwas ablenkend: <a name="habracut"></a><br><blockquote>  Tatsache ist, dass wir ES auf RuToken 2.0 √ºber CryptoPro CSP aufgezeichnet haben, aber mit allen richtigen Einstellungen hat das EGAIS-Portal die ES auf dem Schl√ºsselmedium nicht gesehen, der Client hat uns zur Unterst√ºtzung kontaktiert und wir haben festgestellt, dass das Problem nicht besteht Das Schl√ºsselzertifikat ist in diesem Format geschrieben. Hier finden Sie das Handbuch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dev.rutoken.ru/display/KB/RU1051</a> </blockquote>  . <br>  Ich (und nicht nur ich) habe bereits viele Male geschrieben, dass viele kryptografische Token mit Unterst√ºtzung der russischen Kryptografie als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">normale Flash-Laufwerke verwenden</a> .  Dies war nur dann der Fall, wenn der Schl√ºssel und das Zertifikat nicht als PKCS # 11-Objekte zum Token gelangten.  Es war eine Schande, dass sie den Rat nicht befolgten und nicht einmal versuchten, eine Anfrage zu erstellen.  Aber dann habe ich beschlossen, alles beiseite zu legen und herauszufinden, wie und auf welchen Zertifikaten f√ºr EGAIS Rosalkogolregulirovanie ausgestellt wird.  Und wir werden nur kryptografische PKCS # 11-Token ber√ºcksichtigen.  Die gr√∂√üte Entt√§uschung ist der Zugriff auf EGAIS nur √ºber Windows und den IE-Browser.  Andererseits kann die Generierung einer Zertifikatanforderung und die Zertifikatinstallation auch unter jedem Betriebssystem durchgef√ºhrt werden, wenn Treiber / Bibliotheken f√ºr das entsprechende Token vorhanden sind. <br><br>  Mindestens PKCS # 11-Token JaCarta, RutokenECP-2.0, das LS11SW2016-Software-Token und sogar das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cloud-Token</a> unterst√ºtzen MS Windows, Linux und OS X. Und nicht nur diese Betriebssysteme. <br><br>  Tats√§chlich m√ºssen wir den Entwicklern von EGAIS Tribut zollen.  Sie schlugen eine interessante Technologie vor, die den Zugriff auf die Verwendung pers√∂nlicher Zertifikate (Zertifikat plus Schl√ºsselpaar) erm√∂glicht, die auf kryptografischen Token mit Unterst√ºtzung der russischen Kryptografie gespeichert sind, und den Kanal auf RSA-Zertifikaten sch√ºtzt.  Obwohl, wenn sie A sagten, k√∂nnte man B sagen, d.h.  Sch√ºtzen Sie den Kanal mit GOST-ov-Algorithmen.  Das einzig traurige ist, dass all dies nur f√ºr MS Windows (oder irre ich mich?) Oder besser gesagt f√ºr Internet Explorer zugeschnitten ist.  Dienstprogramme zum Generieren von Zertifikatanforderungen f√ºr EGAIS sind an ein bestimmtes Token gebunden. <br><br>  Das Dienstprogramm cryptoarmpkcs ist jedoch plattform√ºbergreifend.  Dar√ºber hinaus kann es mit jedem kryptografischen PKCS # 11-Token arbeiten, das die russische Kryptografie unterst√ºtzt. <br><br>  Was ist die Besonderheit der Zertifikatsanforderung f√ºr EGAIS?  Das Hauptmerkmal ist das obligatorische Vorhandensein eines zus√§tzlichen Feldes unstucturedName (UN) (oid - 1.2.840.113549.1.9.2) im definierten Namen des Zertifikatsinhabers (DN-Betreff).  Wenn der Inhaber des Zertifikats ein einzelner Unternehmer ist, wird in dieses Feld die Zeile ‚ÄûKPP =‚Äú geschrieben. Wenn der Eigent√ºmer eine juristische Person ist, wird in dieses Feld eine Zeile des folgenden Typs geschrieben: <br>  PPC = reason_code_of_tax_account_account: <br><br><img src="https://habrastorage.org/webt/p5/ta/ik/p5taik-xzifzowoorpxbgrko-tu.png"><br><br>  In diesem Zusammenhang wurde der Anforderung auf der ersten Seite der Registerkarte "Zertifikatanforderung" die Schaltfl√§che "EGAIS" hinzugef√ºgt: <br><br><img src="https://habrastorage.org/webt/lu/3y/pe/lu3ypehfo1drl5bffwfzu7bkngc.png"><br><br>  Ein weiteres Merkmal ist, dass Inhaber von Zertifikaten f√ºr EGAIS Lizenznehmer des FSRAP-Deklarationssystems sein k√∂nnen (oid - 1.2.643.3.6.78.4.4).  Dies muss auch beim Erstellen einer Anfrage ber√ºcksichtigt werden: <br><br><img src="https://habrastorage.org/webt/vs/zr/so/vszrso3twrpryl_cudxmggdw2ke.png"><br><br>  Nachdem alle Felder der Zertifikatanforderung ausgef√ºllt wurden und Sie die Richtigkeit der Daten best√§tigt haben, wird ein Schl√ºsselpaar generiert und die Anforderung erstellt: <br><br><img src="https://habrastorage.org/webt/rk/o3/to/rko3to_iuk4iaeq6aqjoxp-uf1o.png"><br><br>  Wenn Sie sich die Anfrage ansehen, sehen Sie darin die oid-s (Extetnded Key Usage), die f√ºr EGAIS Rosalkogolregulirovanie erforderlich sind: <br><br><img src="https://habrastorage.org/webt/g4/m-/mh/g4m-mh0xck7omdvymsuyalu_wfi.png"><br><br>  Hier sollten Sie (im vorherigen Screenshot) auf die Bezeichnung des Schl√ºsselpaars achten.  In der PKCS # 11-Terminologie ist dies das CKA_LABEL-Attribut f√ºr den √∂ffentlichen und den privaten Schl√ºssel.  Nach einem solchen Schema wird vom EGAIS-Abfragegenerator f√ºr JaCarta aus CenterInform FSUE eine Bezeichnung (Schl√ºsselname) erstellt: <br><br><img src="https://habrastorage.org/webt/zv/bl/dg/zvbldgbgw9kmcphcz-nzq68pzqa.png"><br><br>  Traditionell dreifaches <b>Zertifikat x public_key x privater Schl√ºssel</b> <b><br></b>  auf dem Token ist √ºber das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Attribut CKA_ID verbunden</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><br></a>  :: <br><blockquote>  Die h√§ufigste Methode zur Angabe von CKA_ID ist die Verwendung des Hash-Funktionswerts aus dem Wert des √∂ffentlichen Schl√ºssels.  Diese Methode zum Verkn√ºpfen von drei Objekten wird im NSS-Projekt (Network Security Services) verwendet.  Gleichzeitig wird der SHA1-Algorithmus als Hash-Funktion verwendet. </blockquote>  Leider k√∂nnen sowohl CKA_LABEL als auch CKA_ID jederzeit mit einem beliebigen Wert gesetzt / ge√§ndert werden.  Somit besteht immer die M√∂glichkeit, dass das Zertifikat dem privaten Schl√ºssel einer anderen Person zugeordnet wird.  Sie m√ºssen nicht erkl√§ren, welche Konsequenzen dies haben wird. <br><br>  Gibt es im Allgemeinen einen strengen mathematischen Algorithmus, mit dem Sie das Tripel CKO_CERTIFICATE x CKO_PRIVATE_KEY x CKO_PUBLIC_KEY zu einem Ganzen verbinden k√∂nnen? <br>  Ja, ein solcher Algorithmus, der auf kryptografischen Mechanismen (CKM_) des Tokens basiert, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">existiert</a> . <br><br>  Leider (obwohl es objektiv verstanden werden kann) wird ein B√ºndel in einem Tripel durch CKA_LABEL betrachtet, das durch die oben erw√§hnte Methode gebildet wird.  Dar√ºber hinaus wird f√ºr die privaten und √∂ffentlichen Schl√ºssel SKA_ID auf √§hnliche Weise gebildet.  F√ºr Schl√ºssel ist dies nur eine Katastrophe, weil  Weder CKA_ID noch CKA_LABEL sind jedoch in irgendeiner Weise an den Schl√ºssel selbst gebunden.  Dies gilt auch f√ºr das Zertifikat, nachdem es auf dem Token installiert wurde.  Wenn bei der herk√∂mmlichen Bildung von CKA_ID als Hash aus dem √∂ffentlichen Schl√ºssel immer √ºberpr√ºft werden kann, ob einer mit dem anderen √ºbereinstimmt, kann dies nicht durchgef√ºhrt werden, wenn CKA_ID und CKA_LABEL auf die oben beschriebene Weise festgelegt werden. <br><br>  Es kann sich eine Frage stellen, aber wie kann die Konformit√§t f√ºr einen privaten Schl√ºssel √ºberpr√ºft werden?  Die Antwort ist einfach: Berechnen Sie den Wert des √∂ffentlichen Schl√ºssels gegen den privaten.  Das Zertifikat enth√§lt nat√ºrlich den Wert seines √∂ffentlichen Schl√ºssels.  Dar√ºber hinaus enth√§lt das Zertifikat selbst den CKA_ID-Wert sowohl f√ºr den Zertifikatsinhaber (Certificate Subject Key Identifier) ‚Äã‚Äãals auch f√ºr den Zertifikatsverleger (Certificate Authority Key Identifier): <br><br><img src="https://habrastorage.org/webt/og/vx/9e/ogvx9esfdvq1vlfcy436vkwvqkm.png"><br><br>  Das Unangenehmste war, dass bei der Installation des Zertifikats nicht das Vorhandensein des privaten Schl√ºssels √ºberpr√ºft wird, sondern nur der √∂ffentliche Schl√ºssel ausreicht.  In diesem Fall wird das Zertifikat installiert, es befindet sich jedoch kein privater Schl√ºssel.  Ein weiteres Problem.  Dies ist eine Suche nach √∂ffentlichen Schl√ºsseln nach TIN.  Stellen Sie sich vor, eine Person hat eine TIN und mehrere Schl√ºssel f√ºr verschiedene Zertifikate.  Zu welchem ‚Äã‚Äãgeh√∂rt?  Danach wird klar, dass JaCarta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nur ein Zertifikat</a> und ein Schl√ºsselpaar haben muss: <br><blockquote>  Dieser Fehler kann mit der Duplizierung von Zertifikaten zusammenh√§ngen.  Im JaCarta Single Client im Administratormodus auf der Registerkarte GOST Nach Eingabe des PIN-Codes sollten ein √∂ffentlicher, ein privater Schl√ºssel und ein Zertifikat sichtbar sein.  In diesem Fall ist die Schl√ºsselduplizierung sichtbar.  Sie m√ºssen die zus√§tzlichen entfernen.  Setzen Sie das Medium erneut in den USB-Anschluss ein und versuchen Sie erneut, die UTM zu installieren.  Wenn der Fehler weiterhin besteht, initialisieren Sie Jacarta gem√§√ü Link 1 und f√ºhren Sie den Generierungsprozess erneut durch. </blockquote>  Hoffen wir, dass dieses Manko beseitigt wird.  M√∂glicherweise fragen Sie, wie das Dienstprogramm cryptoarmpkcs f√ºr EGAIS das Zertifikat installiert.  Aus Gr√ºnden der vollst√§ndigen Kompatibilit√§t mit JaCarta haben wir die Ideologie beibehalten, dass CKA_ID und CKA_LABEL f√ºr Schl√ºssel identisch sind.  Aber erst, nachdem das Zertifikat auf dem Token installiert und im Schl√ºsselpaar gebunden wurde.  Bis dahin wird das Schl√ºsselpaar CKA_ID gleich dem Hashwert des √∂ffentlichen Schl√ºssels gehalten. <br>  Nach der Installation des Zertifikats k√∂nnen Sie damit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumente signieren</a> . <br><br>  Informationen zu selbstsignierten Zertifikaten finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> : <br><br><img src="https://habrastorage.org/webt/df/ir/yw/dfirywymvzgoqq5u46qa4th6tcw.png" alt="Bild"><br><br><div class="spoiler">  <b class="spoiler_title">Verteilungen befinden sich am selben Ort.</b> <div class="spoiler_text"><ul><li>  <a href="">Linux32</a> </li><li>  <a href="">Linux64</a> </li><li>  <a href="">OS X.</a> </li><li>  <a href="">WIN32</a> </li><li>  <a href="">WIN64</a> </li></ul><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464017/">https://habr.com/ru/post/de464017/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464003/index.html">4G Router als universeller Server f√ºr IoT</a></li>
<li><a href="../de464007/index.html">Wie ich ein Vorhersagemodell f√ºr ein Callcenter erstellt habe, damit ihre Anrufe die Benutzer nicht w√ºtend machen</a></li>
<li><a href="../de464011/index.html">Wie ich die IT in der Psychologie verlassen habe</a></li>
<li><a href="../de464013/index.html">FAQ zur HeadHunter-API (Stellenausschreibung)</a></li>
<li><a href="../de464015/index.html">Installieren Sie OpenCV + CUDA unter Windows</a></li>
<li><a href="../de464019/index.html">Open Source: Der Grafikkartenentwickler hat die Treiberdokumentation f√ºr Linux ver√∂ffentlicht</a></li>
<li><a href="../de464021/index.html">Was ist Feature Toggle oder wie kann man qu√§lende Walrosse und langlebige Zweige loswerden?</a></li>
<li><a href="../de464023/index.html">"Grundlagen der Programmierung" f√ºr einen kostenlosen Kurs mit Beispielen in JavaScript</a></li>
<li><a href="../de464027/index.html">Wie man Inhalte im Zeitalter der Informationsexplosion √ºberlebt</a></li>
<li><a href="../de464031/index.html">‚ÄûFunde eines Audiomanen‚Äú: Soundkarten, um in die Atmosph√§re einer unbekannten Stadt einzutauchen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>