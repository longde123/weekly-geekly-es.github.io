<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌼 🏮 ✍🏽 So verwandeln Sie Ihren Telegramm-Avatar in eine Uhr 👩🏿‍🏭 🦌 😿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich habe kürzlich in einer Community von Programmierern in Telegram gesessen und ein sehr interessantes Profil festgestellt. Das Folgende war merkwürd...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So verwandeln Sie Ihren Telegramm-Avatar in eine Uhr</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457078/">  Ich habe kürzlich in einer Community von Programmierern in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Telegram</a> gesessen und ein sehr interessantes Profil festgestellt.  Das Folgende war merkwürdig - auf dem Hauptfoto zeigte er die aktuelle Zeit.  Ich war schrecklich interessiert daran, wie er dies erreicht hat, und ich habe mich um jeden Preis entschieden, dasselbe Programm zu schreiben. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xi/yg/ny/xiygnyxpdy_olhjvu7rx-zufbzk.jpeg" alt="Bild"></div><a name="habracut"></a><br>  Vorher habe ich oft mit Telegramm-Bots unter Verwendung der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PyTelegramBotAPI-</a> Bibliothek gearbeitet, daher habe ich vorgeschlagen, dass eine solche Funktion in der Bot-API enthalten ist.  Sicherlich war dies eine dumme Annahme in meinem Leben, weil  Das Foto befand sich auf dem Profilbild des <b>Benutzers</b> , nicht des Bots - und bald war ich davon überzeugt und fand keine Voraussetzungen für die Möglichkeit, das Profilfoto zu ändern. <br><br>  Ich begann im Internet zu surfen und stieß auf ein ziemlich praktisches Tool - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Telethon</a> .  Er erlaubte mir nur, Telegram als <b>Benutzer</b> und nicht als Bot einzugeben.  Nun, ich denke, es war der allererste und größte Schritt in Richtung Ziel.  Schauen wir uns als nächstes an, wie Sie die „Uhr“ in unserem Profilbild neu erstellen. <br><br><h3>  Erster Schritt.  Erhalten Sie Zugriff auf die Telegramm-Anmeldung über den Code </h3><br>  Wir folgen dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> , geben die Telefonnummer ein und erhalten einen Bestätigungscode.  Lesen Sie hier mehr darüber.  Von dort erhalten wir also zwei Dinge, die uns wichtig sind - api_id und api_hash.  Wir erstellen die <i>Datei config.py</i> und geben dort den folgenden Code ein: <br><br><pre><code class="python hljs">api_id = &lt; API_ID&gt; api_hash = &lt; API_HASH&gt;</code> </pre> <br>  Erstellen Sie nun die Datei <i>main.py</i> , in die wir schreiben: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telethon <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TelegramClient, sync <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> .config <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> *</code> </pre><br>  Es ist wichtig, dass sich <i>main.py</i> und <i>config.py</i> auf derselben Dateiebene befinden, d. H.  in einem Ordner, andernfalls gibt die Zeile <b>von .config import *</b> einen Fehler aus.  Die <b>TelegramClient-</b> Klasse ermöglicht es uns, uns als regulärer Benutzer bei Telegram anzumelden.  Weiter schreiben wir in die gleiche Datei folgendes: <br><br><pre> <code class="python hljs">client = TelegramClient(&lt; &gt;, api_id, api_hash) client.start()</code> </pre><br>  Daher können wir davon ausgehen, dass wir bei Telegram angemeldet sind.  <b>SITZUNGSNAME</b> Sie können nach eigenem Ermessen eine beliebige auswählen (z. B. <i>"Ananas"</i> ).  Wir sind also mit dem Telegramm verbunden.  Jetzt ist es Zeit, über die Fotos nachzudenken ... <br><br><h3>  Schritt zwei  Erstellen Sie eine Zeitquelle für Fotos </h3><br>  Vielleicht war dieser Schritt für mich der einfachste, weil  Ich habe lange Zeit verschiedene Software entwickelt, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Computer Vision</a> verwendet, und daher ist die Arbeit mit Bildern etwas Alltägliches geworden.  Hier ist alles einfach - wir installieren die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">opencv-</a> Bibliothek, mit der Sie mit Fotos Wunder wirken können.  Erstellen Sie die Datei <i>utils.py</i> und schreiben Sie sie ein: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convert_time_to_string</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">f"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{dt.hour}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{dt.minute:</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">02</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">"</span></span></code> </pre><br>  Wir benötigen diese Funktion, damit die Zeit im Format <b>H: MM</b> auf dem Foto angezeigt wird (es gab andere Möglichkeiten, dies zu tun, aber ich habe diese bevorzugt). <br><br>  Also fangen wir an, die Fotos selbst zu erstellen.  Wir erstellen die Datei <i>generate_time_images.py</i> und schreiben hinein: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> .utils <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime, timedelta</code> </pre><br>  Diese Bibliotheken sollten ausreichen, um Fotos mit Zeitstempel zu erstellen.  Als nächstes schreiben wir eine Funktion, um einen schwarzen Hintergrund zu erhalten, auf den wir die Zeit schreiben werden: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_black_background</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> np.zeros((<span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>))</code> </pre><br>  Jetzt müssen Sie den Zyklus jede Minute in Tagen durchlaufen und ein Foto mit der Uhrzeit erstellen.  Erstellen <b>Sie</b> im <b>Voraus</b> einen Ordner <b>time_images,</b> in dem Sie die Fotos speichern.  Also schreiben wir: <br><br><pre> <code class="python hljs">start_time = datetime.strptime(<span class="hljs-string"><span class="hljs-string">"2019-01-01"</span></span>, <span class="hljs-string"><span class="hljs-string">"%Y-%m-%d"</span></span>) <span class="hljs-comment"><span class="hljs-comment">#     end_time = start_time + timedelta(days=1) def generate_image_with_text(text): image = get_black_background() font = cv2.FONT_HERSHEY_SIMPLEX cv2.putText(image, text, (int(image.shape[0]*0.35), int(image.shape[1]*0.5)), font, 1.5, (255, 255, 0), 2, cv2.LINE_AA) return image while start_time &lt; end_time: text = convert_time_to_string(start_time) image = generate_image_with_text(text) cv2.imwrite(f"time_images/{text}.jpg", image) start_time += timedelta(minutes=1)</span></span></code> </pre><br>  Um eine Sammlung von Fotos zu erstellen, müssen Sie nur noch etwas ausführen: <i>generate_time_images.py</i> ausführen.  Nach dem Start sehen wir, dass viele Fotos im Ordner <b>time_images / erschienen sind</b> .  Sie sollten so etwas wie diese Fotos bekommen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cx/yl/ci/cxylcit5sc-he9er0v2fvkidr3y.jpeg" alt="Bild"></div><br><h3>  Schritt drei  Fotos jede Minute aktualisieren </h3><br>  <b>Telethon</b> hat eine sehr praktische Sache - <b>UploadProfilePhotoRequest</b> .  Wir importieren es in unsere zuvor geschriebene <i>main.py</i> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telethon.tl.functions.photos <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UploadProfilePhotoRequest, DeletePhotosRequest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> .utils <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> *</code> </pre><br>  Natürlich sollten wir den Avatar zu keinem Zeitpunkt aktualisieren - machen Sie es einfach einmal pro Minute.  Dazu müssen wir den Moment kennen, in dem die alte Minute endet und eine neue beginnt - in diesem Moment werden wir das Foto ändern.  Wir schreiben noch eine kleine Funktion in <i>utils.py</i> : <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time_has_changed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(prev_time)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> convert_time_to_string(datetime.now()) != prev_time</code> </pre><br>  Ja, ja, wir übergeben eine Zeichenfolge mit dem Zeitpunkt der vorherigen Aktualisierung des Avatars.  Natürlich gab es auch andere Möglichkeiten, es zu implementieren, aber ich habe alles in Eile geschrieben, sodass ich nicht viel über Optimierung nachdachte.  Wir füllen weiterhin unsere <i>main.py</i> : <br><br><pre> <code class="python hljs">prev_update_time = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> time_has_changed(prev_update_time): prev_update_time = convert_time_to_string(datetime.now()) client(DeletePhotosRequest(client.get_profile_photos(<span class="hljs-string"><span class="hljs-string">'me'</span></span>))) file = client.upload_file(<span class="hljs-string"><span class="hljs-string">f"time_images/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{prev_update_time}</span></span></span><span class="hljs-string">.jpg"</span></span>) client(UploadProfilePhotoRequest(file))</code> </pre><br>  Wir benötigen <b>DeletePhotosRequest</b> , um frühere Avatare zu löschen, damit der Effekt entsteht, dass wir kein neues Foto hinzufügen - es ändert sich von selbst.  Um den Prozessor nicht zu überlasten, können Sie <b>time.sleep (1)</b> am Ende der Schleife hinzufügen <b>(</b> <b>natürlich</b> zuerst <b>time.py</b> importieren). <br><br>  Fertig!  <i>Wenn</i> Sie <i>main.py ausführen, wird</i> Ihr Avatar zu einer Uhr.  Als originellere Option können Sie versuchen, den Text auf den Fotos folgendermaßen zu ändern: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ze/mf/d4/zemfd4q5j-ib1zutxfozugec51g.jpeg" alt="Bild"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de457078/">https://habr.com/ru/post/de457078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de457066/index.html">So modifizieren Sie den FEDOR-Roboter und den ISS-Flugstuhl</a></li>
<li><a href="../de457068/index.html">Warteschlangen - was ist das, warum und wie man es benutzt? Schauen Sie sich die AWS SQS-Funktionen an</a></li>
<li><a href="../de457070/index.html">Textolite statt Pappe. Ein paar Worte zum interaktiven Abzeichen OFFZONE 2019</a></li>
<li><a href="../de457072/index.html">So lösen Sie ein altes Problem mit ML in Python und .Net</a></li>
<li><a href="../de457074/index.html">Die Entwicklung der Entwickler: Welche Spiele sollten wir in Zukunft erwarten?</a></li>
<li><a href="../de457082/index.html">Nicht wahrnehmbare Gewährung von Administratorrechten</a></li>
<li><a href="../de457086/index.html">Architekturmuster "Builder" im Universum von "Swift" und "iOS" / "macOS"</a></li>
<li><a href="../de457090/index.html">Sicherheitskrippen: JWT</a></li>
<li><a href="../de457092/index.html">Wir studieren MITRE ATT & CK. Mobile Matrizen: Gerätezugriff. Teil 5</a></li>
<li><a href="../de457094/index.html">Excel-Add-In, mit dem Filter bei der Arbeit mit Cubes (VBA) einfach festgelegt werden können</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>