<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüè≠ ü§í üëãüèª Mini ta√ßa ai 2 ou quase AgarIO - o que poderia ser feito para vencer üöµ üàπ üêû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! Desta vez, quero escrever sobre como consegui vencer a competi√ß√£o Mini AI Cup 2 . Como no meu √∫ltimo artigo , praticamente n√£o haver√° det...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mini ta√ßa ai 2 ou quase AgarIO - o que poderia ser feito para vencer</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420737/">  Ol√° pessoal!  Desta vez, quero escrever sobre como consegui vencer a competi√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mini AI Cup 2</a> .  Como no meu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√∫ltimo artigo</a> , praticamente n√£o haver√° detalhes de implementa√ß√£o.  Desta vez, a tarefa era menos volumosa, mas, no entanto, havia muitas nuances e pequenas coisas que afetavam o comportamento do bot.  Como resultado, mesmo ap√≥s quase tr√™s semanas de trabalho ativo no bot, ainda havia id√©ias sobre como melhorar a estrat√©gia. <br><br><img src="https://habrastorage.org/webt/iw/ef/hv/iwefhvnhx6m3ubjpwo_d0cgn3qi.png"><br><br>  Sob o corte de muitos gifs e tr√°fego. <br><a name="habracut"></a><br>  <i>Os persistentes descobrir√£o, o resto fugir√° horrorizado (dos coment√°rios na <s>breve</s> parte comprimida).</i> <br><br>  <i>Quem tem muita pregui√ßa de ler muito pode ir ao pen√∫ltimo spoiler do artigo para ver uma <s>breve</s> descri√ß√£o concisa do algoritmo <s>, e ent√£o voc√™ pode come√ßar a ler desde o in√≠cio</s> .</i> <br><br>  Link para a fonte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no github</a> . <br><br><h3>  Sele√ß√£o de ferramenta </h3><br>  Como na √∫ltima vez, levei muito tempo para pensar por onde come√ßar.  A escolha foi, entre outras coisas, entre duas linguagens: Java, familiar para mim, e j√° bastante esquecido dos dias de estudante em C ++.  Mas, desde o in√≠cio, pareceu-me que o principal obst√°culo para escrever um bom bot n√£o seria tanto a velocidade de desenvolvimento quanto a produtividade da solu√ß√£o final, mas a escolha caiu em C ++. <br><br>  Ap√≥s a experi√™ncia bem-sucedida de usar meu pr√≥prio visualizador para depurar o bot em competi√ß√µes anteriores, tamb√©m n√£o queria passar sem um.  Mas o visualizador que escrevi para mim no Qt for <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CodeWars</a> n√£o parecia uma solu√ß√£o ideal para mim e decidi usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esse</a> visualizador.  Tamb√©m foi feito sob o CodeWars, mas n√£o exigiu processamento s√©rio para uso nesta competi√ß√£o.  A relativa simplicidade da conex√£o e a conveni√™ncia de invocar a renderiza√ß√£o em qualquer lugar do c√≥digo foram a seu favor. <br><br>  Como antes, eu realmente queria depurar qualquer marca no jogo - a capacidade de executar uma estrat√©gia em um momento arbitr√°rio do jogo testado.  Como o visualizador de plug-in n√£o conseguiu resolver esse problema, com a ajuda do par #ifdef (no qual tamb√©m agrupei as partes do c√≥digo respons√°vel pela renderiza√ß√£o), adicionei a cada tick a grava√ß√£o da classe Context, que continha todos os valores necess√°rios das vari√°veis ‚Äã‚Äãdo tick anterior.  No fundo, a solu√ß√£o era semelhante √† que eu usei no Code Wizards, mas desta vez a abordagem n√£o foi t√£o espont√¢nea.  Depois de simular o jogo inteiro, voc√™ foi solicitado a inserir o n√∫mero do tick do jogo, que deve ser reiniciado.  Informa√ß√µes sobre o estado das vari√°veis ‚Äã‚Äãantes que esse tick fosse retirado da matriz, bem como a linha recebida pela estrat√©gia de entrada, o que me permitiu executar os movimentos da minha estrat√©gia em qualquer ordem necess√°ria. <br><br><h3>  Iniciar </h3><br>  No dia em que as regras foram abertas, eu n√£o passei e, na primeira noite, olhei o que nos esperava.  Ele n√£o hesitou em se indignar com o formato de entrada json (sim, √© conveniente, mas alguns participantes come√ßam a aprender YPs antigos, novos ou esquecidos em tais competi√ß√µes, e come√ßar com a an√°lise de json n√£o √© o mais agrad√°vel), olhou para a estranha f√≥rmula do movimento e de alguma forma come√ßou a formar o quadro do futuro estrat√©gias (para entender o artigo no futuro, √© √∫til ler as <a href="">regras</a> ).  Por 2 dias, escrevi v√°rias classes como Ejection, Virus, Player e outras, lendo json, conectando uma biblioteca de arquivo √∫nico para registro ... E na noite da abertura de uma sandbox sem classifica√ß√£o, eu j√° tinha uma estrat√©gia quase id√™ntica em princ√≠pio ao C ++, mas c√≥digo significativamente maior. <br><br>  E ent√£o ... comecei a descobrir op√ß√µes, como desenvolv√™-las.  Pensamentos naquela √©poca: <br><br><ul><li>  A busca por estados mundiais n√£o pode ser reduzida √†queles valores que podem dominar o minimax e as modifica√ß√µes; </li><li>  Campos potenciais s√£o bons, mas respondem mal √† pergunta de como o mundo mudar√° os pr√≥ximos n tiques; </li><li>  A gen√©tica e algoritmos semelhantes funcionar√£o, mas apenas 20 ms s√£o dados por golpe, e a profundidade do c√°lculo seria desej√°vel, √† primeira vista, mais do que as sensa√ß√µes podem ser processadas usando o GA.  Sim, e voc√™ pode brincar com a sele√ß√£o de par√¢metros de muta√ß√£o "felizes para sempre". </li></ul><br>  Definitivamente, decidi uma coisa: precisamos fazer uma simula√ß√£o do mundo.  Afinal, os c√°lculos aproximados podem "superar" um c√°lculo frio e preciso?  Tais considera√ß√µes, √© claro, me levaram a examinar o c√≥digo que deveria ser respons√°vel por simular o mundo no servidor, porque desta vez foi colocado em dom√≠nio p√∫blico junto com as regras.  Afinal, n√£o h√° nada melhor do que o c√≥digo que descreva com precis√£o as regras do mundo? <br><br>  Ent√£o pensei exatamente at√© come√ßar a estudar o c√≥digo que deveria testar nossos bots no servidor e localmente.  Inicialmente, em termos de compreensibilidade e corre√ß√£o do c√≥digo, nem tudo estava muito bem, e os organizadores, juntamente com os participantes, come√ßaram a process√°-lo ativamente.  Durante o teste beta (captura alguns dias depois), as altera√ß√µes no mecanismo de jogo foram muito graves e muitas n√£o come√ßaram a participar at√© o momento em que o mecanismo de teste n√£o se estabilizou.  Mas no final, na minha opini√£o, eles esperaram por um mecanismo que funcionasse bem para um jogo muito adequado ao formato da competi√ß√£o.  Tamb√©m n√£o comecei a implementar abordagens s√©rias at√© que o corredor local se estabilizasse e, durante a primeira semana, nada mais sensato foi feito no meu rob√¥, exceto pelo visualizador aparafusado. <br><br>  Na v√©spera do primeiro fim de semana no telegrama, os organizadores criaram um grupo separado, no qual se supunha que as pessoas seriam capazes de ajudar a corrigir e melhorar o corredor local.  Tamb√©m participei do trabalho no motor do mundo.  Ap√≥s discuss√µes neste bate-papo, como teste, fiz 2 solicita√ß√µes pull para o local do corredor: ajustando a f√≥rmula de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">comer</a> (e pequenas mudan√ßas na ordem de comer) √†s regras e mesclando v√°rias partes em um ag√°rico, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mantendo a in√©rcia e o centro de massa</a> ).  Ent√£o comecei a pensar em como inserir a f√≠sica de colis√£o s√£ nesse c√≥digo, porque a f√≠sica presente no mundo dos jogos naquela √©poca funcionava de maneira muito il√≥gica.  Como as colis√µes entre os dois ag√°ricos n√£o foram descritas nas regras, solicitei aos organizadores crit√©rios segundo os quais minha implementa√ß√£o dessa l√≥gica seria aceit√°vel.  A resposta foi a seguinte: os ag√°ricos em uma colis√£o devem ser "suaves" (ou seja, eles podem se chocar um pouco), enquanto a l√≥gica de uma colis√£o com as paredes n√£o deve ser tocada (ou seja, as paredes devem simplesmente parar os ag√°ricos, mas n√£o os afastar).  E meu pr√≥ximo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pedido de retirada</a> foi uma altera√ß√£o s√©ria da f√≠sica. <br><br><div class="spoiler">  <b class="spoiler_title">Antes e depois da altera√ß√£o da f√≠sica</b> <div class="spoiler_text">  <i>Essa f√≠sica de colis√£o foi:</i> <br><img src="https://habrastorage.org/webt/hx/xc/ey/hxxceykf2thwuvqz9eknvhuy9rw.gif" alt="imagem"><br>  <i>E ela ficou assim ap√≥s as atualiza√ß√µes:</i> <br><img src="https://habrastorage.org/webt/hu/4s/-k/hu4s-kyhokl2-0sotgkuhib2fem.gif" alt="imagem"><br></div></div><br>  Tamb√©m gostaria de destacar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">essa</a> solicita√ß√£o de recebimento, que reduziu significativamente o c√≥digo confuso com a an√°lise de estado e um grande n√∫mero de erros encontrados (e potenciais) em algo muito mais intelig√≠vel. <br><br><h3>  Escrevendo uma simula√ß√£o </h3><br>  Depois de colocar o c√≥digo de localidade do corredor em uma forma s√£, gradualmente comecei a transferir o c√≥digo de simula√ß√£o mundial do local do corredor para o meu bot.  Antes de tudo, era, √© claro, um c√≥digo para simular o movimento dos ag√°ricos e, ao mesmo tempo, um c√≥digo para calcular a f√≠sica das colis√µes.  Foram necess√°rias algumas noites para salvar o c√≥digo reprojetado de reescrever bugs (a transfer√™ncia l√≥gica n√£o foi realizada copiando o c√≥digo) e estimativas aproximadas de qu√£o profundo os c√°lculos devem ser feitos. <br><br>  A fun√ß√£o de classifica√ß√£o para cada carrapato naquele momento era +1 para o alimento que eu como e -1 para o inimigo que comeu, assim como valores ligeiramente maiores para comer os ag√°ricos um do outro.  Nas constantes para comer outros ag√°ricos, havia inicialmente uma diferen√ßa entre comer meu oponente, meu oponente (e, √© claro, uma multa muito grande por comer minha √∫ltima agarika pelo oponente), bem como dois oponentes diferentes um do outro (depois de alguns dias, o √∫ltimo coeficiente se tornou 0).  Al√©m disso, a velocidade total de todos os ticks anteriores da simula√ß√£o, cada tick foi multiplicado por 1 + 1e-5 para incentivar meu bot a executar a√ß√µes mais √∫teis pelo menos um pouco antes e, no final da simula√ß√£o, a velocidade do √∫ltimo tick foi adicionada como b√¥nus, tamb√©m muito pequena .  Para simular o movimento dos ag√°ricos, os pontos foram selecionados na borda do mapa com um passo de 15 graus a partir das coordenadas m√©dias aritm√©ticas de todos os meus ag√°ricos, e um ponto foi selecionado ao simular o movimento no qual a fun√ß√£o de estimativa assumiu o maior valor.  E j√° com uma simula√ß√£o aparentemente primitiva e uma avalia√ß√£o simples na √©poca, o bot firmemente entrincheirou-se no top 10. <br><br><div class="spoiler">  <b class="spoiler_title">Demonstra√ß√£o de pontos, o comando de movimento ao qual o algoritmo originalmente simulou</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/fy/xr/l_/fyxrl_dc2onzsfeij-vmex1qnoc.gif" alt="imagem"><br>  <i>Pontos, cujo comando de movimento foi dado durante v√°rias simula√ß√µes.</i>  <i>Se voc√™ olhar bem de perto - o comando final dado √†s vezes √© alterado em rela√ß√£o aos pontos que est√£o sendo pesquisados, mas s√£o conseq√º√™ncias de altera√ß√µes futuras.</i> <br></div></div><br>  Na noite de sexta e s√°bado, foi adicionada uma simula√ß√£o de fus√£o de ag√°ricos, uma simula√ß√£o de "minar" os v√≠rus e adivinhar o TTF do oponente.  O TTF do oponente era um valor calculado bastante interessante, e era poss√≠vel entender em que ponto o oponente fez uma divis√£o ou chegou ao v√≠rus apenas capturando o momento do voo n√£o controlado, que poderia durar de um n√∫mero muito pequeno de carrapatos com uma grande viscosidade e at√© o v√¥o por todo o mapa.  Como as colis√µes de ag√°ricos podem levar a um ligeiro excesso de sua velocidade m√°xima, para calcular o TTF do oponente, verifiquei que a velocidade dele em dois tiques seguidos corresponde realmente √† velocidade em que voc√™ pode obter dois tiques seguidos em voo livre (em voo livre, os ag√°ricos voavam estritamente em linha reta e com desacelerar cada escala estritamente igual √† viscosidade).  Isso quase eliminou completamente a possibilidade de falsos positivos.  Al√©m disso, durante o teste dessa l√≥gica, notei que um TTF maior sempre corresponde a um ID maior do agaric (do qual mais tarde fiquei convencido ao transferir o c√≥digo de <a href="">explos√£o para o v√≠rus</a> e <a href="">processar a divis√£o</a> ), o que tamb√©m valeu a pena. <br><br>  Tendo analisado as constantes divis√µes no top 3 (o que lhes permitiu coletar significativamente comida no mapa), como teste, adicionei um comando de divis√£o permanente ao bot se n√£o houvesse inimigo no raio de visibilidade, e no domingo de manh√£ encontrei meu bot na segunda linha da classifica√ß√£o.  Gerenciar um punhado de pequenos ag√°ricos aumentou muito o ranking, mas perd√™-los era muito mais f√°cil se voc√™ se deparar com um oponente.  E como o medo de ser comido pelos meus ag√°ricos era muito condicional (a penalidade era apenas por comer em uma simula√ß√£o, mas n√£o por abordar um oponente que pudesse comer), a primeira coisa foi adicionada uma penalidade por cruzar com um oponente que pudesse comer.  E essa mesma avalia√ß√£o funcionou como um b√¥nus por perseguir um oponente.  Depois de verificar o consumo de CPU com minha estrat√©gia, decidi adicionar mais uma rodada de simula√ß√£o quando a divis√£o foi feita no primeiro tick (essa l√≥gica, √© claro, tamb√©m teve que ser transferida para o meu c√≥digo a partir do c√≥digo do idioma do corredor) e, em seguida, a simula√ß√£o foi exatamente a mesma de antes .  Esse tipo de l√≥gica n√£o era muito adequado para "atirar" no inimigo (embora, √†s vezes, por acidente se partisse em um momento muito adequado), mas era muito bom para coletar comida mais rapidamente, o que todo o topo estava fazendo naquele momento.  Tais modifica√ß√µes nos permitiram entrar na pr√≥xima semana na primeira linha do rating, embora a margem n√£o tenha sido significativa. <br><br>  Naquele momento, isso foi o suficiente, a "espinha dorsal" da estrat√©gia foi elaborada, a estrat√©gia parecia bastante primitiva e expans√≠vel.  Mas o que eu realmente notei foi o consumo da CPU e a estabilidade geral do c√≥digo.  Portanto, principalmente as noites da pr√≥xima parte da semana de trabalho foram dedicadas a melhorar a precis√£o das simula√ß√µes (que o visualizador ajudou muito), estabilizando o c√≥digo (valgrind) e algumas otimiza√ß√µes da velocidade de trabalho. <br><br><h3>  Vamos em frente </h3><br>  Minha pr√≥xima estrat√©gia enviada, que mostrou um resultado significativamente melhor e foi √† frente dos advers√°rios (na √©poca), continha duas mudan√ßas significativas: adicionar um campo potencial para coletar comida e dobrar o n√∫mero de simula√ß√µes se houver um oponente com um TTF desconhecido nas proximidades. <br><br>  O campo potencial para a coleta de alimentos na primeira vers√£o era bastante simples e toda a sua ess√™ncia era lembrar os alimentos que desapareciam da zona de visibilidade, reduzindo o potencial nos locais pr√≥ximos aos quais o bot inimigo estava e zerando na minha zona de visibilidade (com restaura√ß√£o subseq√ºente a cada n carrapatos de acordo com as regras).  Isso parecia uma melhoria √∫til, mas, na pr√°tica, na minha opini√£o subjetiva, a diferen√ßa era pequena ou completamente ausente.  Por exemplo, em cart√µes com alta in√©rcia e velocidade, o bot geralmente pulava a comida e tentava voltar a ela, perdendo muita velocidade.  No entanto, se ele decidisse manter a velocidade e simplesmente ignorasse os alimentos ignorados, ele comeria muito mais. <br><br><div class="spoiler">  <b class="spoiler_title">Campo potencial de coleta de alimentos</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/aw/ae/lg/awaelgpt4zl98lgdjfr1rvk53so.gif" alt="imagem"><br>  <i>Voc√™ pode prestar aten√ß√£o em como a cada 40 ticks o campo fica um pouco mais brilhante.</i>  <i>A cada 40 carrapatos, o campo √© atualizado de acordo com a forma como os alimentos s√£o adicionados no mapa, e a probabilidade de os alimentos aparecerem √© "manchada" uniformemente no campo.</i>  <i>Se neste carrapato, vemos que h√° comida que ver√≠amos no carrapato anterior - a probabilidade de aparecimento desse alimento n√£o √© "manchada" com o restante, mas √© definida por pontos espec√≠ficos (o alimento aparece a cada 40 carrapatos estritamente simetricamente).</i> <br></div></div><br>  Uma utilidade subjetiva completamente diferente acabou sendo uma simula√ß√£o dupla do inimigo com diferentes TTFs - o m√≠nimo e o m√°ximo poss√≠vel (caso eu n√£o conhe√ßa o TTF para todos os ag√°ricos vis√≠veis no mapa).  E se antes meu bot pensava que o grupo inimigo de ag√°ricos se tornaria um todo e se moveria lentamente, ent√£o agora ele escolheria o pior dos dois cen√°rios e n√£o arriscaria estar perto do inimigo, sobre quem ele sabe menos do que gostaria. <br><br>  Depois de ganhar uma vantagem significativa, tentei aument√°-la adicionando uma defini√ß√£o do ponto em que o oponente instrui seus agarics a se moverem, e embora esse ponto tenha sido calculado na maioria dos casos com bastante precis√£o, isso por si s√≥ n√£o melhorou os resultados do bot.  De acordo com minhas observa√ß√µes, ficou ainda pior do que o caso quando os ag√°ricos do oponente simplesmente se moveram na mesma dire√ß√£o e na mesma velocidade como se o oponente n√£o tivesse feito nada, ent√£o essas edi√ß√µes foram salvas em um ramo de viol√£o separado at√© melhores tempos. <br><br><div class="spoiler">  <b class="spoiler_title">A defini√ß√£o da equipe advers√°ria que foi usada posteriormente</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8l/vx/ac/8lvxacnkg_w4byrrkka9znflham.gif" alt="imagem"><br>  <i>Os raios dos agarics do oponente mostram o suposto time que o oponente deu aos agarics no tick anterior.</i>  <i>Os raios azuis s√£o a dire√ß√£o exata em que o agarik mudou de dire√ß√£o no √∫ltimo tique.</i>  <i>Preto √© o pretendido.</i>  <i>Era poss√≠vel determinar com mais precis√£o a dire√ß√£o da equipe apenas se o √°gar estivesse completamente na zona de nossa visibilidade (era poss√≠vel calcular o efeito de colis√µes na mudan√ßa de velocidade).</i>  <i>A interse√ß√£o dos raios √© a equipe pretendida do oponente.</i>  <i>Gif feito com base no jogo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aicups.ru/session/200710</a> , cerca de 3.000 carrapatos.</i> <br></div></div><br>  Houve tamb√©m tentativas de transferir a fun√ß√£o de avalia√ß√£o para a avalia√ß√£o da massa ganha, tentativas de mudar a fun√ß√£o de avaliar o perigo do oponente ... Mas, novamente, todas essas mudan√ßas de sentimentos tornaram-se ainda piores.  A √∫nica coisa que foi √∫til com a fun√ß√£o de avaliar o perigo de estar perto do inimigo foi outra otimiza√ß√£o de desempenho, al√©m de estender essa estimativa para um raio muito maior que o raio de interse√ß√£o com o inimigo (essencialmente todo o mapa, mas com uma redu√ß√£o quadr√°tica, se um pouco simplificado - presen√ßa em cinco ou mais raios do oponente na regi√£o de 1/25 do risco m√°ximo de ser comido).  A √∫ltima mudan√ßa tamb√©m n√£o planejada levou ao fato de que meus agariks ficaram com muito medo de se aproximar de um inimigo significativamente maior, e, no caso de seus tamanhos muito superiores, estavam mais inclinados a se mover em dire√ß√£o ao oponente.  Portanto, acabou sendo um substituto bem-sucedido e n√£o intensivo em recursos para o c√≥digo planejado para o futuro, que deveria ser respons√°vel pelo medo de um ataque de um oponente por meio da divis√£o (e uma pequena ajuda nesse ataque para mim mais tarde). <br><br>  Depois de longas e relativamente infrut√≠feras tentativas de melhorar algo, voltei novamente a prever a dire√ß√£o do movimento do oponente.  Decidi tentar se n√£o √© apenas substituir os rivais fict√≠cios, e fazer como fiz com a op√ß√£o TTF m√≠nima e m√°xima - simule duas vezes e escolha a melhor.  Mas, para isso, a CPU pode n√£o ser suficiente e, em muitos jogos do meu bot, eles podem simplesmente se desconectar do sistema devido a um apetite insaci√°vel.  Portanto, antes de implementar esta op√ß√£o, adicionei uma defini√ß√£o aproximada do tempo gasto e, se os limites forem excedidos, comecei a reduzir o n√∫mero de movimentos de simula√ß√£o.  Ao adicionar uma simula√ß√£o dupla do inimigo para o caso em que conhe√ßo o local para onde ele est√° indo, recebi novamente um aumento bastante s√©rio na maioria das configura√ß√µes de jogo, exceto pela mais intensiva em recursos (com alta in√©rcia / baixa velocidade / baixa viscosidade), que devido a uma forte diminui√ß√£o de profundidade As simula√ß√µes podem ficar ainda um pouco piores. <br><br>  Antes do in√≠cio dos jogos de 25k tick, foram feitas mais duas melhorias √∫teis: a penalidade por terminar a simula√ß√£o longe do centro do mapa, al√©m de lembrar a posi√ß√£o anterior do oponente se ele deixasse a linha de vis√£o (al√©m de simular seu movimento naquele momento).<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A implementa√ß√£o da penalidade para a posi√ß√£o final do bot na simula√ß√£o foi um campo de perigo est√°tico pr√©-calculado com zero perigo em um raio um pouco maior que a metade do comprimento do campo de jogo e aumentando gradualmente √† medida que se afasta do campo de jogo. A aplica√ß√£o de uma multa desse campo nos pontos finais da simula√ß√£o quase n√£o exigia uma CPU e evitava corridas extras nos cantos, √†s vezes evitando os ataques inimigos. E a memoriza√ß√£o com a simula√ß√£o subsequente de rivais, na maioria das vezes, nos permitiu evitar dois problemas √†s vezes manifestados. O primeiro problema √© apresentado no GIF abaixo. O segundo problema era que, se um inimigo maior se perdia do campo de vis√£o (por exemplo, ap√≥s a fus√£o de suas partes), era poss√≠vel "com √™xito" se unir a ele, alimentando adicionalmente um oponente j√° perigoso.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de um campo de perigo no final de uma curva em um canto e carrapatos desperdi√ßados</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/rc/qc/7s/rcqc7st4c0xmmzn038tl7eiuxrm.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicialmente, as multas foram planejadas perto das paredes, mas no final foram adicionadas apenas nos cantos. </font></font></i> <br><img src="https://habrastorage.org/webt/r_/qm/zx/r_qmzxmxzysmrityd6sld0yjhlw.gif" alt="imagem"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que pode acontecer se voc√™ n√£o se lembrar da localiza√ß√£o anterior do inimigo? </font><font style="vertical-align: inherit;">Nesse caso, a gel√©ia durou pouco, mas havia muito mais graves.</font></font></i> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, pontos de simula√ß√£o de movimento foram adicionados aos pontos na borda do mapa: a cada agarik de rivais e dentro de um raio da coordenada m√©dia aritm√©tica do meu agariki a cada 45 graus. </font><font style="vertical-align: inherit;">O raio foi definido para uma dist√¢ncia m√©dia das coordenadas aritm√©ticas m√©dias dos meus ag√°ricos.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Novos pontos de simula√ß√£o</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/1g/tp/s0/1gtps0pna1gmgquavh75h2ta-jc.gif" alt="imagem"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao redor do ponto central dos meus agariks, adicionamos pontos de simula√ß√£o adicionais. </font><font style="vertical-align: inherit;">Ocasionalmente, eles ajudavam os agariks a "se reunir" no lugar certo para comer seus rivais. </font><font style="vertical-align: inherit;">O resto do tempo, eles eram praticamente in√∫teis.</font></font></i> <br></div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prepara√ß√£o final </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> No momento da abertura dos jogos para 25k ticks e da passagem para a final, eu tinha uma margem s√≥lida, mas n√£o planejava relaxar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juntamente com os novos jogos de 25k, chegou a not√≠cia: os jogos durante a final tamb√©m ter√£o 25k de dura√ß√£o e o prazo da estrat√©gia para os ticks se tornou um pouco mais. </font><font style="vertical-align: inherit;">Depois de avaliar o tempo que minha estrat√©gia gasta no jogo nas novas condi√ß√µes, decidi adicionar outra vers√£o da simula√ß√£o: fazemos tudo como de costume, mas durante a simula√ß√£o em movimento n dividimos. </font><font style="vertical-align: inherit;">Isso, entre outras coisas, exigiu o uso da simula√ß√£o encontrada na etapa anterior, mas com um deslocamento de 1 movimento (por exemplo, se descobrimos que a separa√ß√£o de 7 tiques do atual, no pr√≥ximo passo, repetimos o mesmo, mas faremos a divis√£o j√° no sexto passo). </font><font style="vertical-align: inherit;">Isso acrescentou ataques agressivos aos rivais, mas consumiu mais tempo de estrat√©gia.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deveria ter havido uma descri√ß√£o concisa do algoritmo</font></font></b> <div class="spoiler_text"> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ficou assim</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Avalia√ß√£o da simula√ß√£o:</font></font><br><img src="https://habrastorage.org/webt/nr/we/mj/nrwemjif4m5vgis-dy_r6shmc3u.gif"><br><ul><li> f ‚Äî ,            ; </li><li> sim ‚Äî        (  ,  , TTF ,     ); </li><li> finalPositionFoodPotentialField ‚Äî   ,   ,    ; </li><li> finalPositionCornerDanger ‚Äî        .        ,         ; </li><li> n ‚Äî ,         .  10   50 ; </li><li> ateFood ‚Äî         i; </li><li> virusBurst ‚Äî            i; </li><li> opponentAteFood ‚Äî        i; </li><li> meAteOpponent ‚Äî      ; </li><li> opponentAteMe ‚Äî      ; </li><li> mine/opponents ‚Äî     .  I.e.          ‚Äî      ; </li><li> danger ‚Äî  ,   ,     . </li></ul><br><br><img src="https://habrastorage.org/webt/xu/0b/vq/xu0bvqxveolkicxieftkfrmuv5u.gif"><br><ul><li> moveType ‚Äî    ,        ; </li><li> max/min TTF ‚Äî   ,        TTF   (    TTF ); </li><li> dummy/aim ‚Äî      Dummy         (    ,          ). </li></ul><br><br><img src="https://habrastorage.org/webt/kr/cn/vl/krcnvlbbrj1eyfcai1abuv4o4pi.gif"><br><ul><li> destination ‚Äî ,         ; </li><li> moveTo ‚Äî  ,   n    ‚Äú   ‚Äù   ; </li><li> splitThenMove ‚Äî       split   ; </li><li> delayedSplitThenMove ‚Äî  ,  split    . </li></ul><br><br>             1 .  I.e.  splitThenMove    moveTo, delayedSplitThenMove      7  6 ,      6  5  ..     ,     ‚Äî               7 .                . <br><br>  destination : <br><ul><li>      15       ( ‚Äî  ).  24      ; </li><li>  ,       (    ); </li><li>         : </li><li> ‚Äú‚Äù     ,       ; </li><li>  8   .             . </li></ul><br>    destination     ,              . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos os refinamentos adicionais estavam relacionados exclusivamente √† efici√™ncia das simula√ß√µes no caso de falta de TL: otimiza√ß√£o da sequ√™ncia de desconectar certas partes da l√≥gica, dependendo da CPU consumida. </font><font style="vertical-align: inherit;">Na maioria dos jogos, isso n√£o deveria mudar nada, mas criar algo mais correto do que n√£o funcionou.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pontos finais na final</font></font></b> <div class="spoiler_text"> <i>          .  808       2424 ,     . <s>   .</s></i> <br> <a href=""><img src="https://habrastorage.org/webt/ij/bi/qf/ijbiqfz4pmd8je8ps7qfvird4pi.png"></a> <br></div></div><br><h4>  Em vez de uma conclus√£o </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em geral, o in√≠cio dessa competi√ß√£o acabou sendo bastante polido, mas nas primeiras uma semana e meia a tarefa foi levada a uma forma bastante jog√°vel com a ajuda dos participantes. </font><font style="vertical-align: inherit;">Inicialmente, a tarefa era muito vari√°vel e escolher a abordagem correta para resolv√™-la n√£o parecia uma tarefa trivial. </font><font style="vertical-align: inherit;">Ainda mais interessante foi encontrar maneiras de melhorar o algoritmo sem ultrapassar os limites do consumo de CPU. </font><font style="vertical-align: inherit;">Muito obrigado aos organizadores da competi√ß√£o e por apresentarem os c√≥digos-fonte do mundo para acesso aberto. </font><font style="vertical-align: inherit;">Este √∫ltimo, √© claro, acrescentou muito problemas a eles no in√≠cio, mas facilitou muito (se n√£o para dizer, o que tornou poss√≠vel em princ√≠pio) a compreens√£o dos participantes sobre o dispositivo do simulador de mundo. </font><font style="vertical-align: inherit;">Agradecimentos especiais pela oportunidade de escolher um pr√™mio! </font><font style="vertical-align: inherit;">Portanto, o pr√™mio saiu muito mais √∫til :-) </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que preciso de outro MacBook?</font></font></s> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt420737/">https://habr.com/ru/post/pt420737/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt420715/index.html">A dura verdade sobre a gravidade da aprendizagem</a></li>
<li><a href="../pt420725/index.html">Como eu ensinei AI a jogar Tetris para NES. Parte 1: an√°lise do c√≥digo do jogo</a></li>
<li><a href="../pt420729/index.html">Semin√°rio on-line aberto "Naive Bayes Classifier"</a></li>
<li><a href="../pt420731/index.html">Zabbix em ester√≥ides: como funciona a plataforma de monitoramento unificado da Sbertech</a></li>
<li><a href="../pt420735/index.html">Convidamos voc√™ para o final da maratona Encontre-se na Digital no escrit√≥rio do Mail.Ru Group</a></li>
<li><a href="../pt420739/index.html">A caixa ainda est√° dispon√≠vel: por que em 2018 voc√™ ainda precisa aprender idiomas</a></li>
<li><a href="../pt420741/index.html">Folha de dicas para programadores ou "procuraremos no Google por voc√™"</a></li>
<li><a href="../pt420749/index.html">GitLab para projeto de entrega cont√≠nua em tecnologias InterSystems: Containers</a></li>
<li><a href="../pt420753/index.html">Front-end de microsservi√ßo - uma abordagem moderna para a separa√ß√£o da frente</a></li>
<li><a href="../pt420757/index.html">Concurso de Programa√ß√£o: Com√©rcio (Resultados)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>