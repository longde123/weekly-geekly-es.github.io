<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçñ üíë üïí Uma maneira f√°cil de criar um alerta de voz no sistema de automa√ß√£o residencial (‚ÄúSmart Home‚Äù) üëÇ üåÑ ü§∞üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tendo testado o cliente SIP do console Linphonec, vi nele a possibilidade de uma maneira simples e r√°pida de implementar alertas de voz em um telefone...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Uma maneira f√°cil de criar um alerta de voz no sistema de automa√ß√£o residencial (‚ÄúSmart Home‚Äù)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466735/">  Tendo testado o cliente SIP do console Linphonec, vi nele a possibilidade de uma maneira simples e r√°pida de implementar alertas de voz em um telefone celular, para um sistema de automa√ß√£o residencial. <br><br>  Eu acho que esse m√©todo √© adequado para muitos sistemas de automa√ß√£o residencial DIY, darei minha vers√£o. <br><br>  Eu tenho um sistema de automa√ß√£o residencial MajorDoMo Smart instalado em um computador de placa √∫nica Raspberry Pi (executando o Raspbian (Debian 9). <br><br>  Criaremos a possibilidade de notifica√ß√£o do MajorDoMo para um smartphone sem o uso de equipamento adicional e do nosso servidor VoIP. <br><br>  Um breve princ√≠pio do alerta: no caso de um acidente cr√≠tico (todos podem definir uma lista de alarmes para si mesmos), o sistema de automa√ß√£o gerencia o cliente VoIP do console e chama o host via protocolo SIP, ap√≥s a resposta que ele reproduz o arquivo de som gravado anteriormente com a mensagem do acidente. <br><a name="habracut"></a><br>  Primeiro de tudo, precisamos de duas contas do provedor SIP com entrada / sa√≠da gratuitas dentro da rede.  Por exemplo, considere o servi√ßo de telefonia em nuvem Zadarma.com. <br><br>  O primeiro passo: registramos com o provedor, enquanto acessamos sua conta pessoal e sua conta SIP.  Podemos registrar-se em v√°rias caixas de correio, mas podemos reabastecer a conta e obter n√∫meros adicionais.  De qualquer forma, devemos ter 2 n√∫meros (contas) e uma senha. <br><br>  Em um smartphone (funciona para mim no Androd OS), instalamos um aplicativo m√≥vel do mercado, qualquer cliente SIP o far√°.  Por conveni√™ncia e minimiza√ß√£o das configura√ß√µes iniciais, podemos usar o aplicativo propriet√°rio para chamadas do Zadarma, mas podemos ser mais funcionais. <br>  Ap√≥s a instala√ß√£o, fazemos o registro indicando seu n√∫mero e senha, concluindo a configura√ß√£o do smartphone.  Ent√£o usamos um n√∫mero. <br><br>  No Raspberry Home Automation Server, precisamos de um cliente de terminal SIP da Linphonec.  Ao instalar a partir do reposit√≥rio Raspbian, √© instalada uma vers√£o 3.6.1 bastante antiga, que n√£o funciona corretamente com o sistema de som ALSA, mas como n√£o h√° necessidade de usar a voz diretamente, vamos seguir o caminho mais f√°cil. <br><br>  <i>Instalando a vers√£o atual do pacote Linphone (3.12.0) sem uma interface gr√°fica para Debian 9, descrevi em um artigo anterior: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bot√£o de chamada DIY.</a></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Raspberry Pi, MajorDoMo, Freeswitch e Linphonec</a> .</i>  <i>L√° voc√™ encontra informa√ß√µes sobre a instala√ß√£o de uma placa de som USB e as configura√ß√µes de som para o Raspberry Pi.</i> <br><br>  No terminal, execute o seguinte comando: <br><br><pre><code class="plaintext hljs">sudo apt-get install linphone-nogtk</code> </pre> <br>  A instala√ß√£o do utilit√°rio cliente do console linphonec e linphonecsh √© realizada - um programa do console para gerenciar o linphonec em execu√ß√£o em segundo plano no diret√≥rio / usr / bin. <br>  Vamos fazer a primeira execu√ß√£o digitando: <br><br><pre> <code class="plaintext hljs">linphonec</code> </pre> <br>  N√≥s o lan√ßamos, o cliente SIP jura na ALSA, n√£o prestamos aten√ß√£o a ele. <br><br>  Executamos o comando de registro do cliente (Linphonec) no servidor zadarma, especifique seu segundo n√∫mero e senha: <br><br><pre> <code class="plaintext hljs">register sip:xxxxxx@sip.zadarma.com sip.zadarma.com PASSWORD</code> </pre> <br>  Se a entrada estiver correta, veremos a resposta sobre o registro bem-sucedido: <br><br><img src="https://habrastorage.org/webt/sd/jj/wc/sdjjwcmmgdfsfklr4flza5tcnp8.png" alt="imagem"><br><br>  Sa√≠mos do cliente (Ctrl + c, enquanto o cliente salva as configura√ß√µes no arquivo .linphonerc do usu√°rio atual, no meu caso, o diret√≥rio / home / pi /. Na pr√≥xima vez que o SIP for iniciado, o cliente ser√° automaticamente registrado no servidor do provedor. <br><br>  Gravamos uma mensagem de voz (por exemplo: "A aten√ß√£o do sistema foi reiniciada, o status est√° agora em opera√ß√£o": <br><br><pre> <code class="plaintext hljs">arecord -D plughw:1,0 -f cd /home/pi/alarm_restart.wav</code> </pre><br>  Para executar e controlar o Linphonec no modo daemon, o utilit√°rio Linphonecsh √© usado.  Inicialmente, na inicializa√ß√£o, a inicializa√ß√£o do cliente linphonecsh -init √© necess√°ria.  Quando esse comando √© executado, o cliente do console inicia sem carregar o arquivo de configura√ß√£o. <br><br>  Para que na inicializa√ß√£o a configura√ß√£o seja lida, execute o sinalizador com: <br><br><pre> <code class="plaintext hljs"> linphonecsh init -c /home/pi/.linphonerc</code> </pre><br>  Agora podemos gerenciar o cliente do console a partir do terminal. <br><br><div class="spoiler">  <b class="spoiler_title">Lista de comandos Linphonecsh</b> <div class="spoiler_text"><pre> <code class="xml hljs">Usage: linphonecsh <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> [arguments] where action is one of init : spawn a linphonec daemon (first step to make other actions) followed by the arguments sent to linphonec generic : sends a generic command to the running linphonec daemon followed by the generic command surrounded by quotes, for example "call sip:joe@example.net" register : register; arguments are --host <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> --username <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> unregister : unregister dial : dial <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sip</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">or</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">number</span></span></span><span class="hljs-tag">&gt;</span></span> status : can be 'status register', 'status autoanswer' or 'status hook' soundcard : can be 'soundcard capture', 'soundcard playback', 'soundcard ring', followed by an optional number representing the index of the soundcard, in which case the soundcard is set instead of just read. exit : make the linphonec daemon to exit.</code> </pre> <br><br></div></div><br>  Vamos tentar os seguintes comandos: <br><br><pre> <code class="plaintext hljs">linphonecsh generic 'soundcard use files'</code> </pre> <br><pre> <code class="plaintext hljs">linphonecsh generic 'play alarm.wav'</code> </pre> <br><pre> <code class="plaintext hljs">linphonecsh dial sip:@sip.zadarma.com</code> </pre> <br>  Onde gen√©ricos s√£o as equipes do pr√≥prio programa Linphonec.  XXXXXX √© o nosso n√∫mero SIP instalado no smartphone. <br><br>  Nesse caso, ocorre uma chamada ao atender - voc√™ pode ouvir a reprodu√ß√£o de um arquivo gravado anteriormente com um acidente. <br><br>  Manualmente funcionou.  Para integrar-se ao sistema de automa√ß√£o residencial baseado em MajorDoMo, por exemplo, tome a emerg√™ncia de reiniciar o servidor. <br>  Escrevemos a seguinte linha no crontab (ao carregar o PC, o cliente do console carrega: <br><br><pre> <code class="plaintext hljs">crontab -e</code> </pre> <br><pre> <code class="xml hljs">@reboot sudo -u pi linphonecsh init -c /home/pi/.linphonerc</code> </pre> <br>  Em seguida, v√° para a p√°gina da web do sistema DD, v√° para <b>Painel de controle - Scripts - Eventos - Inicializa√ß√£o.</b>  . <br><br><img src="https://habrastorage.org/webt/3i/ui/ec/3iuiec-as4d75jtddxvsmdgbgme.png"><br><br>  Os scripts s√£o implementados na linguagem de programa√ß√£o PHP.  J√° existe uma linha no c√≥digo que, ao iniciar o sistema, pronuncia uma frase com o endere√ßo IP do servidor. <br><br>  Adicione mais alguns: <br><br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh generic 'soundcard use files'"</span></span>);</code> </pre> <br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh generic 'play alarm.wav'"</span></span>);</code> </pre> <br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh dial sip:576935@sip.zadarma.com "</span></span>);</code> </pre> <br>  Instalamos <i>para executar ap√≥s salvar</i> , salvamos, ao mesmo tempo em que h√° uma chamada no telefone celular. <br><br>  N√≥s reinicializamos o sistema MajorDoMo, atrav√©s do <b>Servi√ßo - Reinicializa√ß√£o / desligamento</b> . <br>  Ap√≥s uma reinicializa√ß√£o, uma notifica√ß√£o de voz chega ao telefone.  O mesmo algoritmo de a√ß√µes pode ser feito para outro acidente cr√≠tico para voc√™. <br><br>  Ap√≥s alterar ligeiramente a sequ√™ncia de a√ß√µes, voc√™ pode instalar seu pr√≥prio servidor de telefonia IP (Asterisk, Freeswitch, etc.) em seu sistema de automa√ß√£o residencial, conectar um gateway de VoIP a ele e acessar diretamente uma operadora de celular ou PSTN.  Essa op√ß√£o √© mais funcional, possui mais recursos, mas tamb√©m exige alguns custos grandes, tanto de material quanto para a configura√ß√£o do sistema. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt466735/">https://habr.com/ru/post/pt466735/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt466725/index.html">O punhal 2 √© elementar (parte 1)</a></li>
<li><a href="../pt466727/index.html">Atualiza√ß√£o pregui√ßosa: como o PostgreSQL 12 melhora o desempenho</a></li>
<li><a href="../pt466729/index.html">O livro "Minera√ß√£o de dados. Recuperando informa√ß√µes do Facebook, Twitter, LinkedIn, Instagram, GitHub ¬ª</a></li>
<li><a href="../pt466731/index.html">Extravag√¢ncia. Setembro sobe</a></li>
<li><a href="../pt466733/index.html">Bem-vindo ao DINS Java EVENTO 18 de setembro</a></li>
<li><a href="../pt466737/index.html">Por que a rede social do Google+ falhou</a></li>
<li><a href="../pt466739/index.html">O melhor √© o inimigo do bem</a></li>
<li><a href="../pt466741/index.html">O melhor √© o inimigo do bem</a></li>
<li><a href="../pt466745/index.html">O primeiro local de trabalho ou como come√ßar a desenvolver API no Node.js</a></li>
<li><a href="../pt466747/index.html">Desenvolvedores Mitap iOS na Redmadrobot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>