<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺🏿 🚁 🧘🏻 Blazor: comment empêcher un composant de tomber malade ou deux approches pour séparer le code du balisage 👨‍👩‍👧 🤛🏻 🙍🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je pense que chaque développeur, quand il est arrivé à un nouveau projet, a pensé qu'il serait bien de remonter le temps et de dire aux pères de votre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Blazor: comment empêcher un composant de tomber malade ou deux approches pour séparer le code du balisage</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484822/"><p>  Je pense que chaque développeur, quand il est arrivé à un nouveau projet, a pensé qu'il serait bien de remonter le temps et de dire aux pères de votre projet que les modèles devraient non seulement être demandés lors de l'entretien, mais également appliqués au vrai projet, mais sérieusement. </p><br><p>  En particulier, c'est probablement un modèle, mais une très bonne règle est que le balisage doit être séparé du code.  Cela s'applique aux bons vieux formulaires Web, Asp.Net MVC - quelqu'un d'autre écrit-il du balisage sur Razor?), Et Angular est populaire dans une entreprise difficile. </p><br><p>  Si vous êtes depuis longtemps passé de désespoir sur le devant des enders et êtes passé à la nouvelle angulaire et React, alors ... </p><a name="habracut"></a><br><p>  Oui, messieurs, les développeurs du backend, nous avions à nouveau l'espoir que les connaissances acquises au fil des ans ne seraient pas perdues dans la tête.  Et cet espoir est la technologie Blazor de Microsoft. <br>  Après avoir ouvert le projet par défaut que le studio crée lors de la création du projet Blazor, puis après avoir examiné plusieurs articles, je me suis glissé dans l'idée que tout est vraiment si mauvais et que le code et le balisage sont toujours dans le même fichier, comme par exemple ici (ci-après, tous les exemples seront montrés sur la base de Projet de modèle d'application Blazor Server de Visual Studio 2019 avec .Net Core 3.1 installé): </p><br><p><img src="https://habrastorage.org/webt/fz/uk/bn/fzukbn53judeqzxrqg7vim1t8xu.png" alt="image"></p><br><p>  Rien ne confond ici? </p><br><p>  À mon avis, tout ce qui est rempli de rouge a peu à voir avec le contenu que ce composant représente et vous devez vous en débarrasser.  Pourquoi? </p><br><ol><li>  Eh bien, premièrement, le développeur front-end qui travaillera avec vous en même temps sur ce contrôle sera un peu dérouté par des symboles qui lui sont incompréhensibles et chaque fois qu'il sera prudent et vous posera des questions quand il aura besoin de changer quelque chose dans le morceau de code encadré par le balisage Razor . </li><li>  Bien sûr, les frontenders seront prudents, mais à coup sûr, vous rencontrerez périodiquement le fait qu'après certaines manipulations, votre page ne fonctionnera pas comme prévu ou ne fonctionnera tout simplement pas. </li><li>  Si vous pensez que les développeurs frontaux ne seront pas nécessaires, car tout peut maintenant être écrit en C #, alors vous vous trompez.  Dans tous les cas, vous devez styliser le contrôle et cela sera fait soit par le développeur frontal, soit par le typographe qui, souvent, ne sait pas ce qu'est C #. </li><li>  Au début, il semblera que le code est petit et qu'il n'encombre pas beaucoup la mise en page, c'est trompeur, dans un projet en pleine croissance, vous passerez très rapidement de la scène, de la démo technologique à «merde ce qui se passe ici».  Plus d'une fois, je suis tombé sur le fait que depuis SQL Web Controls ou directement sur la page .cshtml, une requête SQL dans la base de données a été publiée, oui, je ne plaisante pas.  Très souvent, des développeurs expérimentés qui vous ont torturé hier dans une interview sur la sécurité sociale, connaissant déjà les principes SOLIDES, écrivent demain la logique métier, directement dans le balisage. </li></ol><br><p>  Je pense que je vous ai déjà fait assez peur, maintenant je vais vous dire comment éviter les problèmes ci-dessus, d'autant plus que cela se fait très simplement.  Et ce sera génial si vous adoptez les approches suivantes en règle générale lors de la création d'un nouveau composant Razor.  Donc, la première approche. </p><br><h3 id="bazovyy-klass">  Classe de base </h3><br><p>  La première et, jusqu'à récemment, la seule approche. </p><br><p>  Vous créez une classe de base dans laquelle se trouvera toute la logique d'affichage, pour le contrôle de l'exemple ci-dessus.  Créez un nouveau fichier en utilisant le modèle <br>  [Nom du contrôle] .razor.cs </p><br><p>  Ici, le studio viendra à notre aide et construira à partir de deux fichiers quelque chose comme dans l'image ci-dessous: </p><br><p><img src="https://habrastorage.org/webt/oc/96/u9/oc96u90oqb2zzpuomier1gks3dq.png" alt="image"></p><br><p>  Comme vous pouvez le voir, le studio est assez intelligent et a compris lui-même ce que vous en attendiez.  Le contrôle a été regroupé avec le fichier dans lequel nous voulons placer notre code. </p><br><p>  Si vous ouvrez un nouveau fichier maintenant, le <strong>nom de la</strong> classe <strong>FetchData</strong> sera souligné par une ligne ondulée rouge, tout est vrai, car malgré le fait que dans <strong>FetchData.razor</strong> vous ne verrez <strong>nulle part les</strong> déclarations de classe avec le nom <strong>FetchData</strong> , plus tard après la compilation du projet, il apparaîtra, je montrerai il est inférieur et le nom de classe <strong>FetchData est donc</strong> déjà réservé.  Nous n'avons d'autre choix que d'utiliser la convention selon laquelle nous placerons la logique d'affichage (et seulement elle !!!) dans la classe FetchDataBase, c'est-à-dire que le nom de la classe sera formé par le modèle: <br>  <strong>[ControlName] Base</strong> </p><br><p>  Bien sûr, vous pouvez être confus et écrire votre propre analyseur statique, qui vérifiera ces fichiers pour chaque composant, pourquoi pas? <br>  Ensuite, nous devons hériter de cette classe de <strong>ComponentBase</strong> .  N'oubliez pas d'ajouter <br>  <strong>en utilisant Microsoft.AspNetCore.Components</strong> ; </p><br><p>  Et voici ce que nous avons obtenu: </p><br><p><img src="https://habrastorage.org/webt/4z/8y/7d/4z8y7dupxs8f1z32uscjrblitky.png" alt="image"></p><br><p>  Wow, la classe est prête à transférer la logique d'affichage ici, que nous avons maintenant la possibilité d'écrire complètement en C #, n'est-ce pas du bonheur?  :) </p><br><p>  Mais alors que le composant Razor lui-même ne sait rien de notre fichier, seul Visual Studio sait qu'ils ont quelque chose en commun. </p><br><p>  Alors, faites l'astuce suivante: </p><br><p><img src="https://habrastorage.org/webt/q8/i3/p2/q8i3p2nhk-ecwlhusbd46fz7p58.png" alt="image"></p><br><p>  Nous avons hérité du composant Razor de la classe <strong>FetchDataBase</strong> . </p><br><p>  Laissez le code C # qui existe toujours dans <strong>FetchData.razor</strong> ne vous dérange pas. </p><br><p>  À l'heure actuelle, nous allons transférer toute la logique d'affichage dans notre soi-disant code derrière le fichier: </p><br><p><img src="https://habrastorage.org/webt/an/au/kn/anauknb0nxw3tzqxinb15_4j1fy.png" alt="image"></p><br><p>  Ce qui s'est passé, eh bien, tout d'abord, nous avons ajouté en utilisant-et.  Sur les contrôles Razor, vous ne les verrez pratiquement pas, car il est habituel de les ajouter à <strong>_Imports.razor</strong> .  Il y a déjà ajouté certains des plus utilisés. </p><br><p>  Ensuite, nous injectons à travers la propriété, comme vous pouvez le voir, notre DI préféré fonctionne très bien. <br>  Il vous suffit de marquer la propriété implémentée avec l'attribut <strong>[Inject]</strong> .  Dans le composant Razor, il était étiqueté <strong><a href="https://habr.com/ru/users/inject/" class="user_link">Inject</a></strong> .  Autrement dit, les changements sont minimes. </p><br><p>  Eh bien, suit ensuite la propriété, dans laquelle nous chargeons les informations affichées, elle doit être au moins <strong>protégée</strong> (car le contrôle Razor hérite de la classe actuelle).  Ou <strong>public</strong> si vous décidez de permettre l'initialisation de l'extérieur, dans ce cas vous devrez toujours le marquer avec l'attribut <strong>[Parameter]</strong> .  Dans les versions antérieures de Blazor, il était assez <strong>protégé</strong> , mais maintenant l'analyseur de studio vous le grondera. </p><br><p>  En principe, vous pouvez ajouter un constructeur à cette classe et y travailler, mais ce n'est pas recommandé, il est préférable de placer toute la logique d'initialisation dans la méthode <strong>OnInitializedAsync ()</strong> </p><br><p>  C'est tout ce qui reste dans <strong>FetchData.razor</strong> </p><br><p><img src="https://habrastorage.org/webt/_m/5f/3z/_m5f3zs5nzf8qvrguce_zc9pxbo.png" alt="image"></p><br><p>  Il y avait des balises Razor entrecoupées, mais comment pourrait-il en être autrement, nous devons toujours afficher nos données d'une manière ou d'une autre.  Mais le code C # pur a complètement disparu.  Et c'est super à mon avis.  Je vous conseille de suivre initialement une approche similaire et ensuite ni vous ni vos collègues ne vous prendront la tête lorsque votre contrôle atteindra de grandes tailles. </p><br><p>  La chose la plus importante est de savoir si cela fonctionne, vérifions maintenant: </p><br><p><img src="https://habrastorage.org/webt/gr/sn/rh/grsnrh24yfincyy0eq8rv9gvxme.png" alt="image"></p><br><p>  Super, c'est comme s'ils n'avaient rien cassé =) </p><br><h3 id="partial-class">  Classe partielle </h3><br><p>  Et donc la deuxième approche, qui est apparue récemment ( <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components%3Fview%3Daspnetcore-3.1" rel="nofollow">https://docs.microsoft.com/en-us/aspnet/core/blazor/components?view=aspnetcore-3.1#partial-class-support</a> ), mais très probablement remplacera complètement précédent.  À la demande des travailleurs, .Net Core 3.1 a ajouté la possibilité de créer une <strong>classe partielle</strong> pour les contrôles Razor.  Donc, nous laissons presque tout comme dans l'approche précédente, mais maintenant nous n'avons pas besoin d'hériter de ComponentBase, et la classe peut être appelée de la même manière que le composant, c'est-à-dire que sa signature sera la suivante: <br>  classe partielle publique [ComponentName] </p><br><p>  Comme vous pouvez le voir ci-dessous, les changements sont minimes, dans le code derrière nous nous sommes débarrassés de l'héritage de <strong>ComponentBase</strong> et avons marqué la classe comme <strong>partielle</strong> </p><br><p><img src="https://habrastorage.org/webt/q1/5o/i5/q15oi5kifsulqhij-jhookhhryu.png" alt="image"></p><br><p>  Le fichier de balisage est également un peu simplifié, nous nous sommes également débarrassés de l'héritage de FetchDataBase, cette classe a cessé d'exister en raison de son inutilité. </p><br><p><img src="https://habrastorage.org/webt/mq/53/tl/mq53tldh_tppbmfrcicmqe0wwbw.png" alt="image"></p><br><p>  Comme vous pouvez le voir, il existe deux approches pour garder votre balisage propre.  Celui que vous choisissez dépend de vous.  Malheureusement, ce serait bien pour le studio de générer immédiatement du code-back lors de la création d'un nouveau composant.  Maintenant, cela est activement discuté et, comme le disent les développeurs, à l'avenir, une telle probabilité sera ajoutée s'il y a une demande, et elle le sera certainement. <br>  Alors, maintenant, en quoi notre composant Razor se transforme-t-il: </p><br><p><img src="https://habrastorage.org/webt/jf/2v/ef/jf2vefp9jwrsq5pb_psmcbvonua.png" alt="image"></p><br><p>  C'est familier, n'est-ce pas?) Tous ceux qui ont créé leurs composants Razor Asp.Net MVC trouveront très familier le contenu du fichier généré automatiquement. </p><br><p>  J'espère que vous en avez appris un peu plus sur Blazor aujourd'hui grâce à mon premier article sur Habr.  Laissez ci-dessous les critiques, questions et demandes de nouveaux articles =) </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484822/">https://habr.com/ru/post/fr484822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484812/index.html">Mon expérience avec Plesk</a></li>
<li><a href="../fr484814/index.html">6. Mise en route de Fortinet v6.0. Filtrage Web et contrôle des applications</a></li>
<li><a href="../fr484816/index.html">Utilisation de hooks d'opérations pour sauvegarder des fichiers sur macOS à la volée</a></li>
<li><a href="../fr484818/index.html">Le livre "C ++. La pratique de la programmation multithread "</a></li>
<li><a href="../fr484820/index.html">FAQ.Net - un programme de prise de notes gratuit pour Windows avec une conception mise à jour</a></li>
<li><a href="../fr484824/index.html">La guerre pour éteindre les lumières</a></li>
<li><a href="../fr484826/index.html">L'intelligence artificielle aggrave encore plus la mauvaise médecine</a></li>
<li><a href="../fr484834/index.html">Comment construire une stratégie d'entreprise pour la formation et le développement</a></li>
<li><a href="../fr484836/index.html">Calcul de la rentabilité du tarif vert en 2020, Ukraine</a></li>
<li><a href="../fr484838/index.html">13 exemples de configuration de règles dans Google Ads [instruction]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>