<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíï üóùÔ∏è ‚ùÑÔ∏è Creaci√≥n de infraestructura de TI tolerante a fallas. Parte 2. Instalaci√≥n y configuraci√≥n del cl√∫ster oVirt 4.3 ü§∑üèø üë©üèª‚Äçüé® üëµüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo es una continuaci√≥n del anterior: ‚Äú Creaci√≥n de una infraestructura de TI tolerante a fallas. Parte 1: preparaci√≥n para la implementaci√≥...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Creaci√≥n de infraestructura de TI tolerante a fallas. Parte 2. Instalaci√≥n y configuraci√≥n del cl√∫ster oVirt 4.3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lenvendo/blog/485208/"><p>  Este art√≠culo es una continuaci√≥n del anterior: ‚Äú <a href="https://habr.com/ru/company/lenvendo/blog/483980/">Creaci√≥n de una infraestructura de TI tolerante a fallas.</a>  <a href="https://habr.com/ru/company/lenvendo/blog/483980/">Parte 1: preparaci√≥n para la implementaci√≥n del cl√∫ster oVirt 4.3</a> ". </p><br><p>  Considerar√° el proceso de instalaci√≥n y configuraci√≥n b√°sica del cl√∫ster oVirt 4.3 para alojar m√°quinas virtuales altamente accesibles, teniendo en cuenta el hecho de que todos los pasos preliminares para preparar la infraestructura ya se han completado. </p><a name="habracut"></a><br><h2 id="vvodnaya-chast">  Introduccion </h2><br><p>  El objetivo principal del art√≠culo no es dar instrucciones paso a paso del formulario " <strong>Siguiente</strong> -&gt; <strong>S√≠</strong> -&gt; <strong>Finalizar</strong> ", sino mostrar algunas caracter√≠sticas al instalarlo y configurarlo.  El proceso de implementaci√≥n de su cl√∫ster puede no coincidir siempre con el descrito en √©l, debido a las peculiaridades de la infraestructura y el entorno, pero los principios generales ser√°n los mismos. </p><br><p>  Desde un punto de vista subjetivo, <a href="https://www.ovirt.org/">oVirt 4.3</a> es similar en funcionalidad a VMware vSphere versi√≥n 5.x, pero por supuesto con sus propias caracter√≠sticas de configuraci√≥n y operaci√≥n. </p><br><p>  Para aquellos que est√©n interesados, todas las diferencias entre RHEV (tambi√©n conocido como oVirt) y VMware vSphere se pueden encontrar en Internet, por ejemplo <a href="https://www.redhat.com/cms/managed-files/vi-virtualization-vmware-competitive-review-f10106jm-201803_0_0.pdf">aqu√≠</a> , pero a√∫n as√≠ ocasionalmente notar√© algunas de sus diferencias o similitudes, seg√∫n el art√≠culo. </p><br><p>  Por separado, me gustar√≠a comparar un poco de trabajo con redes para m√°quinas virtuales.  OVirt implementa un principio similar de gesti√≥n de red para m√°quinas virtuales (en adelante, VM), como en VMware vSphere: </p><br><ul><li>  utilizando el puente est√°ndar de Linux (en VMware - <em>Standard vSwitch</em> ) que se ejecuta en hosts de virtualizaci√≥n; </li><li>  El uso de Open vSwitch (OVS) (en VMware, <em>Distributed vSwitch</em> ) es un conmutador virtual distribuido que consta de dos componentes principales: un servidor OVN central y controladores OVN en hosts administrados. </li></ul><br><p> Cabe se√±alar que, debido a la simplicidad de la implementaci√≥n, el art√≠culo describir√° la configuraci√≥n de red en oVirt para m√°quinas virtuales que usan el puente est√°ndar de Linux, que es la opci√≥n est√°ndar cuando se usa el hipervisor KVM. </p><br><p>  En este sentido, hay varias reglas b√°sicas para trabajar con una red en un cl√∫ster que es mejor no violar: </p><br><ul><li>  Todas las configuraciones de red en los hosts deben ser id√©nticas antes de agregarlas a oVirt, excepto las direcciones IP. </li><li>  Despu√©s de que el host est√© bajo el control de oVirt, se desaconseja cambiar algo en la configuraci√≥n de la red con sus manos, sin una total confianza en sus acciones, ya que el agente de oVirt simplemente las revertir√° a las anteriores, despu√©s de reiniciar el host o agente. </li><li>  Agregar una nueva red para la VM, as√≠ como trabajar con ella, debe hacerse solo desde la consola de administraci√≥n de oVirt. </li></ul><br><p>  Otro <u>punto importante</u> : para un entorno muy cr√≠tico (muy sensible a la p√©rdida de dinero), a√∫n se recomendar√≠a usar soporte pagado y usar <a href="https://access.redhat.com/products/red-hat-virtualization">Red Hat Virtualization 4.3</a> .  Durante el funcionamiento del cl√∫ster oVirt, puede haber algunos puntos en los que es conveniente obtener ayuda calificada lo antes posible, en lugar de tratar con ellos usted mismo. </p><br><p>  Y, por √∫ltimo, <u>se recomienda que</u> antes de implementar el cl√∫ster oVirt, se familiarice con la <a href="https://www.ovirt.org/documentation/">documentaci√≥n oficial</a> para conocer al menos conceptos y definiciones b√°sicos; de lo contrario, ser√° un poco dif√≠cil leer el art√≠culo m√°s a fondo. </p><br><p>  Los siguientes documentos son b√°sicos para comprender el art√≠culo y los principios de funcionamiento del cl√∫ster oVirt: </p><br><ul><li>  <a href="https://www.ovirt.org/documentation/install-guide/Installation_Guide/">Gu√≠a de instalaci√≥n virtual</a> </li><li>  <a href="https://www.ovirt.org/documentation/self-hosted/Self-Hosted_Engine_Guide/">oVirt Gu√≠a de motor alojada</a> </li><li>  <a href="https://www.ovirt.org/documentation/admin-guide/administration-guide/">oVirt Administration Guide</a> <a href="https://www.ovirt.org/documentation/admin-guide/administration-guide/"><br></a> </li></ul><br><p>  El volumen all√≠ no es muy grande, en una o dos horas es bastante posible dominar los principios b√°sicos, y para los fan√°ticos de los detalles, se recomienda leer la <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/">Documentaci√≥n</a> del <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/">producto para Red Hat Virtualization 4.3</a> : RHEV y oVirt son esencialmente lo mismo. </p><br><p>  Entonces, si se completan todas las configuraciones b√°sicas en los hosts, conmutadores y almacenamiento, procedemos directamente a la implementaci√≥n de oVirt. </p><br><h2 id="chast-2-ustanovka-i-nastroyka-klastera-ovirt-43">  Parte 2. Instalaci√≥n y configuraci√≥n del cl√∫ster oVirt 4.3 </h2><br><p>  Para facilitar la orientaci√≥n, enumerar√© las secciones principales de este art√≠culo, que deben realizarse a su vez: </p><br><ol><li>  Instalaci√≥n del servidor de administraci√≥n oVirt </li><li>  Creaci√≥n de un nuevo centro de datos. </li><li>  Crea un nuevo cl√∫ster </li><li>  Instalar hosts adicionales en un entorno autohospedado </li><li>  Crear √°rea de almacenamiento o dominios de almacenamiento </li><li>  Crear y configurar redes para m√°quinas virtuales. </li><li>  Crear una imagen de instalaci√≥n para implementar una m√°quina virtual </li><li>  Crear una m√°quina virtual </li></ol><br><h3 id="ustanovka-upravlyayuschego-servera-ovirt">  Instalaci√≥n del servidor de administraci√≥n oVirt </h3><br><p>  <strong>El servidor de administraci√≥n de oVirt</strong> es el elemento m√°s importante en la infraestructura de oVirt, en forma de m√°quina virtual, host o dispositivo virtual que administra toda la infraestructura de oVirt. </p><br><p>  Sus an√°logos cercanos del mundo de la virtualizaci√≥n: </p><br><ul><li>  VMware vSphere: servidor vCenter </li><li>  Microsoft Hyper-V: System Center Virtual Machine Manager (VMM). </li></ul><br><p>  Para instalar el servidor de administraci√≥n oVirt, tenemos dos opciones: </p><br><p>  <u>Opcion 1</u> <br>  Implementar un servidor como una m√°quina virtual o host especializado. </p><br><p>  Esta opci√≥n funciona bien, pero siempre que dicha VM funcione independientemente del cl√∫ster, es decir,  no se ejecuta en ning√∫n host del cl√∫ster como una m√°quina virtual normal que ejecuta KVM. </p><br><p>  ¬øPor qu√© no puede implementar tal VM en los hosts del cl√∫ster? </p><br><p>  Al comienzo del proceso de implementaci√≥n del servidor de administraci√≥n oVirt, tenemos un dilema: necesita instalar la VM administradora, pero el cl√∫ster en s√≠ a√∫n no est√°, y por lo tanto, ¬øqu√© puede encontrar de inmediato?  Es correcto instalar KVM en el futuro nodo del cl√∫ster, luego crear una m√°quina virtual en √©l, por ejemplo, con el sistema operativo CentOS e implementar el motor oVirt en √©l.  Esto generalmente se puede hacer por razones de control total sobre una VM de este tipo, pero esta es una intenci√≥n err√≥nea, porque en este caso, en el futuro, habr√° un 100% de problemas con una VM de control de este tipo: </p><br><ul><li>  no se puede migrar en la consola oVirt entre los hosts (nodos) del cl√∫ster; </li><li>  al migrar usando herramientas KVM a trav√©s de <em>virsh migrate</em> , esta VM ser√° inaccesible para la administraci√≥n desde la consola oVirt. </li><li>  Los hosts de cl√∫ster no pueden ponerse en <strong>modo de mantenimiento</strong> si migra esta VM de host a host utilizando <em>virsh migrate</em> . </li></ul><br><p>  Entonces, haga todo de acuerdo con las reglas: use oVirt o un host separado o una VM independiente que se ejecute en √©l para el servidor de administraci√≥n, o mejor, haga lo que est√° escrito en la segunda versi√≥n. </p><br><p>  <u>Opci√≥n 2</u> <br>  Instalaci√≥n de oVirt Engine Appliance en el host del cl√∫ster que administra. </p><br><p>  Es esta opci√≥n la que se considerar√° a continuaci√≥n, como m√°s correcta y adecuada en nuestro caso. <br>  Los requisitos para dicha VM se describen a continuaci√≥n, solo agregar√© que se recomienda tener al menos dos hosts en la infraestructura en la que se pueda ejecutar la VM administradora para que sea tolerante a fallas.  Aqu√≠ me gustar√≠a agregar que, como ya escrib√≠ en los comentarios del art√≠culo anterior, no pude obtener <em>splitbrain</em> en el cl√∫ster oVirt de dos hosts, con la capacidad de ejecutar la m√°quina virtual del motor alojado en ellos. </p><br><h4 id="ustanovka-ovirt-engine-appliance-na-pervyy-host-klastera">  Instale oVirt Engine Appliance en el primer host del cl√∫ster </h4><br><p>  Enlace a la documentaci√≥n oficial: <a href="https://www.ovirt.org/documentation/self-hosted/Self-Hosted_Engine_Guide/">oVirt Self-Hosted Engine Guide</a> , cap√≠tulo " <a href="https://www.ovirt.org/documentation/self-hosted/chap-Deploying_Self-Hosted_Engine.html">Implementaci√≥n del motor Self-Hosted usando la l√≠nea de comandos</a> " </p><br><p>  El documento indica los requisitos previos que deben cumplirse antes de implementar la m√°quina virtual del motor alojado, as√≠ como el proceso de instalaci√≥n se describe en detalle, por lo que repetirlo literalmente no tiene mucho sentido, por lo que nos centramos en algunos detalles importantes. </p><br><ul><li>  Antes de comenzar todos los pasos, aseg√∫rese de habilitar el soporte de virtualizaci√≥n en la configuraci√≥n del BIOS en el host. </li><li>  Instale el paquete de instalaci√≥n del motor alojado en el host: </li></ul><br><pre><code class="plaintext hljs">yum -y install http://resources.ovirt.org/pub/yum-repo/ovirt-release43.rpm yum -y install epel-release yum install screen ovirt-hosted-engine-setup</code> </pre> <br><ul><li>  Comenzamos el procedimiento para implementar oVirt Hosted Engine en la pantalla del host (puede salir de √©l mediante Ctrl-A + D, cerrarlo mediante Ctrl-D): </li></ul><br><pre> <code class="plaintext hljs">screen hosted-engine --deploy</code> </pre> <br><p>  Si lo desea, puede comenzar la instalaci√≥n con un archivo de respuesta preparado: </p><br><pre> <code class="plaintext hljs">hosted-engine --deploy --config-append=/var/lib/ovirt-hosted-engine-setup/answers/answers-ohe.conf</code> </pre> <br><ul><li>  Durante la implementaci√≥n del motor alojado, especifique todos los par√°metros necesarios: </li></ul><br><pre> <code class="plaintext hljs">-   -  vCPU  vRAM ( 4 vCPU  16 ) -  -    hosted engine  ‚Äì    FC -  LUN   hosted engine -       hosted engine ‚Äì     Local (  PostgreSQL    )  . .</code> </pre> <br><ul><li>  Para instalar una m√°quina virtual altamente accesible con un motor alojado, creamos un LUN especial n√∫mero 4 y 150 GB de tama√±o en el sistema de almacenamiento, que luego se present√≥ a los hosts del cl√∫ster; consulte el <a href="https://habr.com/ru/company/lenvendo/blog/483980/">art√≠culo anterior</a> . </li></ul><br><p>  Anteriormente tambi√©n verificamos su visibilidad en los hosts: </p><br><pre> <code class="plaintext hljs">multipath -ll ‚Ä¶ 3600a098000e4b4b3000003c95d171065 dm-3 DELL , MD38xxf size=150G features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw |-+- policy='service-time 0' prio=14 status=active | `- 15:0:0:4 sdc 8:32 active ready running `-+- policy='service-time 0' prio=9 status=enabled `- 18:0:0:4 sdj 8:144 active ready running</code> </pre> <br><ul><li>  El proceso de implementaci√≥n del motor alojado en s√≠ no conlleva nada complicado, al final deber√≠amos obtener algo como esto: </li></ul><br><pre> <code class="plaintext hljs">[ INFO ] Generating answer file '/var/lib/ovirt-hosted-engine-setup/answers/answers-20191129131846.conf' [ INFO ] Generating answer file '/etc/ovirt-hosted-engine/answers.conf' [ INFO ] Stage: Pre-termination [ INFO ] Stage: Termination [ INFO ] Hosted Engine successfully deployed</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Verificando la disponibilidad de los servicios oVirt en el host:</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/qv/kd/c8/qvkdc8tkfhqkxar1v13jxt4ozxs.png"></p></div></div><br><p>  Si todo se hizo correctamente, luego de completar la instalaci√≥n, vaya a <em><a href="https://ovirt_hostname/ovirt-engine">https: // ovirt_hostname / ovirt-engine</a></em> desde la computadora del administrador utilizando un navegador web y haga clic en [ <strong>Portal de administraci√≥n</strong> ]. </p><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla "Portal de administraci√≥n"</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/m7/sq/xp/m7sqxpd7qkl3dugl4oj7_5bga5g.png"></p></div></div><br><p>  Despu√©s de ingresar el nombre de usuario y la contrase√±a (establecidos durante la instalaci√≥n) en la ventana como en la captura de pantalla, accedemos al panel de control de Open Virtualization Manager, en el que puede realizar todas las acciones con la infraestructura virtual: </p><br><ol><li>  agregar centro de datos </li><li>  agregar y configurar un cl√∫ster </li><li>  agregar hosts y administrarlos </li><li>  agregar √°reas de almacenamiento o dominios de almacenamiento para discos de m√°quinas virtuales </li><li>  agregar y configurar redes para m√°quinas virtuales </li><li>  agregue m√°quinas virtuales, im√°genes de instalaci√≥n, plantillas de VM y admin√≠strelas </li></ol><br><p><img src="https://habrastorage.org/webt/4r/t_/qg/4rt_qg6irvl-mf6bsorclnmr36e.png"></p><br><p>  Todas estas acciones ser√°n consideradas m√°s adelante, algo en una celda grande, algo m√°s detallado y con matices. <br>  Pero primero, recomendar√≠a leer este complemento, que probablemente muchos sean √∫tiles. </p><br><p>  <strong>Adem√°s</strong> </p><br><p>  <strong>1)</strong> En principio, si existe tal necesidad, entonces nada le impide preinstalar el hipervisor KVM en los nodos del cl√∫ster utilizando los <strong><em>paquetes</em></strong> <strong><em>libvirt</em></strong> y <strong><em>qemu-kvm</em></strong> (o <strong><em>qemu-kvm-ev</em></strong> ) de la versi√≥n deseada, aunque al implementar el nodo del cl√∫ster oVirt, puede hazlo tu mismo. </p><br><p>  Pero si <strong><em>libvirt</em></strong> y <strong><em>qemu-kvm</em></strong> no se instalaron con la √∫ltima versi√≥n, puede obtener dicho error durante la implementaci√≥n del motor alojado: </p><br><pre> <code class="plaintext hljs">error: unsupported configuration: unknown CPU feature: md-clear</code> </pre> <br><p>  Es decir  debe tener <a href="https://centos.pkgs.org/7/centos-updates-x86_64/libvirt-4.5.0-10.el7_6.12.x86_64.rpm.html">una versi√≥n actualizada de</a> <strong><em>libvirt</em></strong> con protecci√≥n <a href="https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/MDS">MDS</a> que admita esta pol√≠tica: </p><br><pre> <code class="plaintext hljs">&lt;feature policy='require' name='md-clear'/&gt;</code> </pre> <br><p>  Instale libvirt v.4.5.0-10.el7_6.12, con soporte md-clear: </p><br><pre> <code class="plaintext hljs">yum-config-manager --disable mirror.centos.org_centos-7_7_virt_x86_64_libvirt-latest_ yum install centos-release-qemu-ev yum update yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer libguestfs libguestfs-tools dejavu-lgc-sans-fonts virt-top libvirt libvirt-python libvirt-client systemctl enable libvirtd systemctl restart libvirtd &amp;&amp; systemctl status libvirtd</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Verifique el soporte de md-clear:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">virsh domcapabilities kvm | grep require &lt;feature policy='require' name='ss'/&gt; &lt;feature policy='require' name='hypervisor'/&gt; &lt;feature policy='require' name='tsc_adjust'/&gt; &lt;feature policy='require' name='clflushopt'/&gt; &lt;feature policy='require' name='pku'/&gt; &lt;feature policy='require' name='md-clear'/&gt; &lt;feature policy='require' name='stibp'/&gt; &lt;feature policy='require' name='ssbd'/&gt; &lt;feature policy='require' name='invtsc'/&gt;</code> </pre> </div></div><br><p>  Despu√©s de eso, puede continuar instalando el motor alojado. </p><br><p>  <strong>2)</strong> En oVirt 4.3, la presencia y el uso del cortafuegos <strong>firewall</strong> es un requisito previo. </p><br><div class="spoiler">  <b class="spoiler_title">Si durante la implementaci√≥n de la VM para el motor alojado obtenemos el siguiente error:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">[ ERROR ] fatal: [localhost]: FAILED! =&gt; {"changed": false, "msg": "firewalld is required to be enabled and active in order to correctly deploy hosted-engine. Please check, fix accordingly and re-deploy.\n"} [ ERROR ] Failed to execute stage 'Closing up': Failed executing ansible-playbook [https://bugzilla.redhat.com/show_bug.cgi?id=1608467</code> </pre> </div></div><br><p>  Luego debe apagar otro firewall (si se usa) e instalar y ejecutar <strong>firewalld</strong> : </p><br><pre> <code class="plaintext hljs">yum install firewalld systemctl enable firewalld systemctl start firewalld firewall-cmd --state firewall-cmd --get-default-zone firewall-cmd --get-active-zones firewall-cmd --get-zones</code> </pre> <br><p>  M√°s tarde, cuando instale el agente ovirt en un nuevo host para el cl√∫ster, configurar√° los puertos necesarios en <strong>firewalld</strong> autom√°ticamente. </p><br><p>  <strong>3)</strong> Reiniciar un host con una VM que se ejecuta en √©l con un motor alojado. </p><br><p>  Como de costumbre, <a href="https://www.ovirt.org/documentation/self-hosted/chap-Maintenance_and_Upgrading_Resources.html">referencia 1</a> y <a href="https://www.ovirt.org/documentation/self-hosted/chap-Troubleshooting.html">referencia 2</a> a documentos de orientaci√≥n. </p><br><p>  Toda la administraci√≥n de la m√°quina virtual del motor alojado se realiza SOLAMENTE usando el comando del <strong>motor alojado</strong> en el host donde funciona, debe olvidarse de <strong>virsh</strong> , as√≠ como el hecho de que puede conectarse a esta m√°quina virtual a trav√©s de SSH y ejecutar el <strong>comando de</strong> " <strong>apagado</strong> " en ella. </p><br><div class="spoiler">  <b class="spoiler_title">El procedimiento para poner la VM en modo de servicio:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">hosted-engine --set-maintenance --mode=global hosted-engine --vm-status !! Cluster is in GLOBAL MAINTENANCE mode !! --== Host host1.test.local (id: 1) status ==-- conf_on_shared_storage : True Status up-to-date : True Hostname : host1.test.local Host ID : 1 Engine status : {"health": "good", "vm": "up", "detail": "Up"} Score : 3400 stopped : False Local maintenance : False crc32 : dee1a774 local_conf_timestamp : 1821 Host timestamp : 1821 Extra metadata (valid at timestamp): metadata_parse_version=1 metadata_feature_version=1 timestamp=1821 (Sat Nov 29 14:25:19 2019) host-id=1 score=3400 vm_conf_refresh_time=1821 (Sat Nov 29 14:25:19 2019) conf_on_shared_storage=True maintenance=False state=GlobalMaintenance stopped=False hosted-engine --vm-shutdown</code> </pre> </div></div><br><p>  Reiniciamos el host con el agente del motor alojado y hacemos lo que necesitamos con √©l. </p><br><p>  Despu√©s de reiniciar, verifique el estado de la VM con el motor alojado: </p><br><pre> <code class="plaintext hljs">hosted-engine --vm-status</code> </pre> <br><p>  Si nuestra VM con motor alojado no se inicia y si vemos errores similares en el registro del servicio: </p><br><div class="spoiler">  <b class="spoiler_title">Error en el registro del servicio:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">journalctl -u ovirt-ha-agent ... Jun 29 14:34:44 host1 journal: ovirt-ha-agent ovirt_hosted_engine_ha.agent.hosted_engine.HostedEngine ERROR Failed to start necessary monitors Jun 29 14:34:44 host1 journal: ovirt-ha-agent ovirt_hosted_engine_ha.agent.agent.Agent ERROR Traceback (most recent call last):#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/agent.py", line 131, in _run_agent#012 return action(he)#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/agent.py", line 55, in action_proper#012 return he.start_monitoring()#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/hosted_engine.py", line 413, in start_monitoring#012 self._initialize_broker()#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/hosted_engine.py", line 537, in _initialize_broker#012 m.get('options', {}))#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/lib/brokerlink.py", line 86, in start_monitor#012 ).format(t=type, o=options, e=e)#012RequestError: brokerlink - failed to start monitor via ovirt-ha-broker: [Errno 2] No such file or directory, [monitor: 'ping', options: {'addr': '172.20.32.32'}] Jun 29 14:34:44 host1 journal: ovirt-ha-agent ovirt_hosted_engine_ha.agent.agent.Agent ERROR Trying to restart agent</code> </pre> </div></div><br><p>  Luego conectamos el almacenamiento y reiniciamos el agente: </p><br><pre> <code class="plaintext hljs">hosted-engine --connect-storage systemctl restart ovirt-ha-agent systemctl status ovirt-ha-agent hosted-engine --vm-start hosted-engine --vm-status</code> </pre> <br><p>  Despu√©s de iniciar la VM con motor alojado, la eliminamos del modo de mantenimiento: </p><br><div class="spoiler">  <b class="spoiler_title">Procedimiento para eliminar una VM del modo de mantenimiento:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">hosted-engine --check-liveliness hosted-engine --set-maintenance --mode=none hosted-engine --vm-status --== Host host1.test.local (id: 1) status ==-- conf_on_shared_storage : True Status up-to-date : True Hostname : host1.test.local Host ID : 1 Engine status : {"health": "good", "vm": "up", "detail": "Up"} Score : 3400 stopped : False Local maintenance : False crc32 : 6d1eb25f local_conf_timestamp : 6222296 Host timestamp : 6222296 Extra metadata (valid at timestamp): metadata_parse_version=1 metadata_feature_version=1 timestamp=6222296 (Fri Jan 17 11:40:43 2020) host-id=1 score=3400 vm_conf_refresh_time=6222296 (Fri Jan 17 11:40:43 2020) conf_on_shared_storage=True maintenance=False state=EngineUp stopped=False</code> </pre> </div></div><br><p>  <strong>4)</strong> Eliminar el motor alojado y todo lo relacionado con √©l. </p><br><p>  A veces puede ser necesario eliminar correctamente un motor alojado previamente instalado: un <a href="https://www.ovirt.org/documentation/self-hosted/chap-Troubleshooting.html">enlace</a> a un documento de orientaci√≥n. </p><br><p>  Simplemente ejecute el comando en el host: </p><br><pre> <code class="plaintext hljs">/usr/sbin/ovirt-hosted-engine-cleanup</code> </pre> <br><p>  A continuaci√≥n, elimine los paquetes innecesarios, haciendo una copia de seguridad de algunas configuraciones antes de eso, si es necesario: </p><br><pre> <code class="plaintext hljs">yum autoremove ovirt* qemu* virt* libvirt* libguestfs</code> </pre> <br><h4 id="sozdanie-novogo-datacentra">  Creaci√≥n de un nuevo centro de datos. </h4><br><p>  Documentaci√≥n de referencia: Gu√≠a de administraci√≥n de oVirt.  <a href="https://www.ovirt.org/documentation/admin-guide/chap-Data_Centers.html">Cap√≠tulo 4: Centros de datos</a> </p><br><p>  Primero, definimos qu√© es un <strong>centro de datos</strong> (cito de la ayuda): esta es una entidad l√≥gica que define un conjunto de recursos utilizados en un entorno espec√≠fico. </p><br><p>  Un centro de datos es un tipo de contenedor que consiste en: </p><br><ul><li>  recursos l√≥gicos en forma de cl√∫steres y hosts </li><li>  agrupe recursos de red en forma de redes l√≥gicas y adaptadores f√≠sicos en hosts, </li><li>  recursos de almacenamiento (para discos VM, plantillas, im√°genes) en forma de √°reas de almacenamiento (dominios de almacenamiento). </li></ul><br><p>  Un centro de datos puede incluir varios cl√∫steres que consisten en varios hosts con m√°quinas virtuales que se ejecutan en ellos, tambi√©n puede tener varias √°reas de almacenamiento asociadas. <br>  Puede haber varios centros de datos, funcionan independientemente uno del otro.  Ovirt tiene una separaci√≥n de poderes por rol, y puede configurar los permisos personalmente, tanto a nivel del centro de datos como en sus elementos l√≥gicos individuales. </p><br><p>  El centro de datos, o centros de datos, si hay varios, se administran desde una √∫nica consola administrativa o portal. </p><br><p>  Para crear un centro de datos, vaya al portal administrativo y cree un nuevo centro de datos: <br>  <strong>Calcular</strong> &gt;&gt; <strong>Centros de datos</strong> &gt;&gt; <strong>Nuevo</strong> </p><br><p>  Como utilizamos el almacenamiento compartido en el sistema de almacenamiento, el tipo de almacenamiento debe ser Compartido: </p><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla con el asistente del centro de datos</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/bf/eg/id/bfegid-tcvqsfjjxa1oqzop_9iw.png"></p></div></div><br><p>  Al instalar una m√°quina virtual con motor alojado, de manera predeterminada se crea un centro de datos: <strong>Datacenter1</strong> , y luego, si es necesario, puede cambiar el Tipo de almacenamiento a otro. </p><br><p>  Crear un centro de datos es una tarea simple, sin matices complicados, y todas las acciones adicionales con √©l se describen en la documentaci√≥n.  Solo notar√© que los hosts individuales que solo tienen almacenamiento local (disco) para la VM no pueden ingresar al centro de datos con Tipo de almacenamiento - Compartido (no puede agregarlos all√≠), y para ellos necesita crear un centro de datos separado, es decir  cada host individual con almacenamiento local necesita su propio centro de datos separado. </p><br><h4 id="sozdanie-novogo-klastera">  Crea un nuevo cl√∫ster </h4><br><p>  Enlace de documentaci√≥n - oVirt Administration Guide.  <a href="https://www.ovirt.org/documentation/admin-guide/chap-Clusters.html">Cap√≠tulo 5: Clusters</a> </p><br><p>  Sin detalles innecesarios, un <strong>cl√∫ster</strong> es una agrupaci√≥n l√≥gica de hosts que tienen un √°rea de almacenamiento com√∫n (en forma de unidades compartidas en un sistema de almacenamiento, como en nuestro caso).  Tambi√©n es deseable que los hosts en el cl√∫ster sean id√©nticos en hardware y tengan el mismo tipo de procesador (Intel o AMD).  Por supuesto, es mejor que los servidores en el cl√∫ster sean completamente iguales. </p><br><p>  El cl√∫ster es parte del centro de datos (con un tipo espec√≠fico de almacenamiento: <em>local</em> o <em>compartido</em> ), y todos los hosts deben pertenecer necesariamente a un cl√∫ster, dependiendo de si tienen un almacenamiento com√∫n o no. </p><br><p>  Al instalar una m√°quina virtual con motor alojado en el host, de forma predeterminada se crea un centro de datos - <strong>Datacenter1</strong> , junto con un cl√∫ster - <strong>Cluster1</strong> , y en el futuro puede configurar sus par√°metros, habilitar opciones adicionales, agregar hosts, etc. </p><br><p>  Como de costumbre, para obtener detalles sobre todas las configuraciones del cl√∫ster, es recomendable consultar la documentaci√≥n oficial.  De algunas caracter√≠sticas de la configuraci√≥n del cl√∫ster, agregar√© solo eso al crearlo, es suficiente para configurar solo los par√°metros b√°sicos en la pesta√±a <strong><em>General</em></strong> . </p><br><p>  Anotar√© los par√°metros m√°s importantes: </p><br><ul><li>  <em>Tipo de procesador</em> : se selecciona en funci√≥n de qu√© procesadores est√°n instalados en los hosts del cl√∫ster, de qu√© fabricante son y qu√© procesador es el m√°s antiguo en los hosts, de modo que, seg√∫n esto, se utilicen todas las instrucciones de procesador disponibles en el cl√∫ster. </li><li>  <em>Tipo de interruptor</em> : en nuestro cl√∫ster usamos solo el puente de Linux, por lo que lo seleccionamos. </li><li>  <em>Tipo de cortafuegos</em> : aqu√≠ todo est√° claro, esto es cortafuegos, que debe habilitarse y configurarse en los hosts. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla con par√°metros del cl√∫ster</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/os/vn/qy/osvnqyj3srg8vjpflkdy9l4e84e.png"></p></div></div><br><h4 id="ustanovka-dopolnitelnyh-hostov-v-self-hosted-okruzhenii">  Instalar hosts adicionales en un entorno autohospedado </h4><br><p>  <a href="https://www.ovirt.org/documentation/self-hosted/chap-Installing_Additional_Hosts_to_a_Self-Hosted_Environment.html">Enlace</a> a la documentaci√≥n. </p><br><p>  Los hosts adicionales para el entorno Self-Hosted se agregan de la misma manera que un host normal, con el punto adicional para implementar una VM con un motor alojado: <strong><em>elija la acci√≥n de implementaci√≥n del motor alojado</em></strong> &gt;&gt; <strong><em>Implementar</em></strong> .  Dado que el LUN para la VM con el motor alojado tambi√©n debe presentarse al host adicional, esto significa que este host se puede usar si es necesario para alojar la VM con el motor alojado en √©l. <br>  Para la tolerancia a fallos, se recomienda encarecidamente que haya al menos dos hosts en los que se pueda alojar una m√°quina virtual alojada del motor. </p><br><p>  En el host adicional, deshabilite iptables (si est√° habilitado), habilite firewalld </p><br><pre> <code class="plaintext hljs">systemctl stop iptables systemctl disable iptables systemctl enable firewalld systemctl start firewalld</code> </pre> <br><p>  Instale la versi√≥n requerida de KVM (si es necesario): </p><br><pre> <code class="plaintext hljs">yum-config-manager --disable mirror.centos.org_centos-7_7_virt_x86_64_libvirt-latest_ yum install centos-release-qemu-ev yum update yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer libguestfs libguestfs-tools dejavu-lgc-sans-fonts virt-top libvirt libvirt-python libvirt-client systemctl enable libvirtd systemctl restart libvirtd &amp;&amp; systemctl status libvirtd virsh domcapabilities kvm | grep md-clear</code> </pre> <br><p>  Instale los repositorios necesarios y el instalador del motor alojado: </p><br><pre> <code class="plaintext hljs">yum -y install http://resources.ovirt.org/pub/yum-repo/ovirt-release43.rpm yum -y install epel-release yum update yum install screen ovirt-hosted-engine-setup</code> </pre> <br><p>  A continuaci√≥n, vaya a la <strong><em>consola de Open Virtualization Manager</em></strong> , agregue un nuevo host y haga todo paso a paso, tal como est√° escrito en la <a href="https://www.ovirt.org/documentation/self-hosted/chap-Installing_Additional_Hosts_to_a_Self-Hosted_Environment.html">documentaci√≥n</a> . </p><br><p>  Como resultado, despu√©s de agregar un host adicional, deber√≠amos obtener aproximadamente una imagen en la consola administrativa, como en la captura de pantalla. </p><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla del portal administrativo - hosts</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wh/hr/nc/whhrnchajorr5ogqxinvecjdxi0.png"></p></div></div><br><p>  El host en el que est√° activa actualmente la m√°quina virtual del motor alojado tiene una corona dorada y la inscripci√≥n " <em>Ejecuci√≥n de la m√°quina virtual del motor alojado</em> ", el host en el que se puede ejecutar esta m√°quina virtual si es necesario es la inscripci√≥n " <em>puede ejecutar la m√°quina virtual del motor alojado</em> ". </p><br><p>  En el caso de una falla del host en la que " <em>Ejecutando la VM del motor alojado</em> ", se reiniciar√° autom√°ticamente en el segundo host.  Adem√°s, esta VM se puede migrar del host activo al de respaldo para su mantenimiento. </p><br><p>  <u>Configure Power Management / fencing en oVirt hosts</u> </p><br><p>  Enlaces de documentaci√≥n: </p><br><ul><li>  Red Hat Virtualization 4.3 -&gt; Referencia t√©cnica -&gt; <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html/technical_reference/chap-power_management">Cap√≠tulo 4. Administraci√≥n de energ√≠a</a> </li><li>  oVirt Administration Guide -&gt; <a href="https://www.ovirt.org/documentation/admin-guide/chap-Hosts.html">Cap√≠tulo 7: Hosts</a> </li></ul><br><p>  Aunque parezca que se ha completado la adici√≥n y configuraci√≥n del host, esto no es del todo cierto. <br>  Para el funcionamiento normal de los hosts e identificar / eliminar fallas con cualquiera de ellos, se requiere la configuraci√≥n de Power Management / fencing. </p><br><p>  <strong>El cercado</strong> , o recinto, es el proceso de excluir temporalmente un host fallido o fallido de un cl√∫ster, durante el cual se reinician los servicios oVirt en √©l o el host. </p><br><p>  Se proporcionan todos los detalles sobre las definiciones y par√°metros de Power Management / fencing, como es habitual en la documentaci√≥n, solo dar√© un ejemplo de c√≥mo configurar este par√°metro importante cuando se aplica a los servidores Dell R640 con iDRAC 9. </p><br><ol><li>  Entramos en el portal administrativo, hacemos clic en <strong>Calcular</strong> &gt;&gt; <strong>Hosts,</strong> seleccionamos el host. </li><li>  Haz clic en <strong>Editar</strong> . </li><li>  Haga clic en la pesta√±a <strong>Administraci√≥n de energ√≠a</strong> . </li><li>  Marque la casilla junto a la opci√≥n <strong>Habilitar administraci√≥n de energ√≠a</strong> . </li><li>  <em>Marcamos</em> la casilla junto a la opci√≥n de <em>integraci√≥n de Kdump</em> para que el host no entre en modo de cercado mientras escribe un volcado por ca√≠da del n√∫cleo. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Nota</b> <div class="spoiler_text"><p>  Despu√©s de habilitar la integraci√≥n de Kdump en un host que ya se est√° ejecutando, debe reinstalarse de acuerdo con el procedimiento de la Gu√≠a de administraci√≥n de oVirt -&gt; <a href="https://www.ovirt.org/documentation/admin-guide/chap-Hosts.html">Cap√≠tulo 7: Hosts</a> -&gt; Reinstalar hosts. </p></div></div><br><ol><li>  Opcionalmente, puede marcar la casilla de verificaci√≥n <em>Desactivar control de pol√≠tica de administraci√≥n de energ√≠a</em> si no queremos que la administraci√≥n de energ√≠a del host est√© controlada por la Pol√≠tica de programaci√≥n del cl√∫ster. </li><li>  Haga clic en el bot√≥n ( <em>+</em> ) para agregar un nuevo dispositivo de administraci√≥n de energ√≠a, se abrir√° la ventana para editar las propiedades del agente. <br>  Para iDRAC9, complete los campos: <br><ul><li>  <em>Direcci√≥n</em> : direcci√≥n de iDRAC9 </li><li>  <em>Nombre de usuario / Contrase√±a</em> : inicio de sesi√≥n y contrase√±a respectivamente para ingresar al iDRAC9 </li><li>  <em>Tipo</em> - drac5 </li><li>  marcar <em>seguro</em> </li><li>  agregue las siguientes opciones: <em>cmd_prompt =&gt;, login_timeout = 30</em> </li></ul></li></ol><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla con los par√°metros de "Administraci√≥n de energ√≠a" en las propiedades del host</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/kz/be/ky/kzbekyoxr6cromqq0epltd2cjbo.png"></p></div></div><br><h4 id="sozdanie-oblasti-hraneniya-ili-storage-domains">  Crear √°rea de almacenamiento o dominios de almacenamiento </h4><br><p>  Enlace de documentaci√≥n - Gu√≠a de administraci√≥n de oVirt, <a href="https://www.ovirt.org/documentation/admin-guide/chap-Storage.html">Cap√≠tulo 8: Almacenamiento</a> . </p><br><p>  <strong>Un dominio de almacenamiento</strong> , o √°rea de almacenamiento, es una ubicaci√≥n centralizada para almacenar discos de m√°quinas virtuales, im√°genes de instalaci√≥n, plantillas e instant√°neas. </p><br><p>  Las √°reas de almacenamiento se pueden conectar a un centro de datos utilizando varios protocolos, cl√∫steres y sistemas de archivos de red. </p><br><p>  OVirt tiene tres tipos de √°rea de almacenamiento: </p><br><ul><li>  <strong>Data Domain</strong> : para almacenar todos los datos asociados con m√°quinas virtuales (discos, plantillas).  Data Domain no se puede compartir entre diferentes centros de datos. </li><li>  <strong>Dominio ISO</strong> (tipo de √°rea de almacenamiento en desuso): para almacenar im√°genes de instalaci√≥n del sistema operativo.  El dominio ISO se puede compartir entre diferentes centros de datos. </li><li>  <strong>Exportar dominio</strong> (tipo de √°rea de almacenamiento obsoleto): para el almacenamiento temporal de im√°genes movidas entre centros de datos. </li></ul><br><p>  En nuestro caso particular, un dominio de almacenamiento de tipo Data Domain utiliza el Protocolo de canal de fibra (FCP) para conectarse a los LUN en el sistema de almacenamiento. </p><br><p>  Desde el punto de vista de oVirt, cuando se utilizan sistemas de almacenamiento (FC o iSCSI), cada disco virtual, instant√°nea o plantilla es un disco l√≥gico. <br>  Los dispositivos de bloque se ensamblan en una sola unidad (en los hosts del cl√∫ster) usando el Grupo de vol√∫menes y luego se dividen usando LVM en vol√∫menes l√≥gicos utilizados como discos virtuales para m√°quinas virtuales. </p><br><p>  Todos estos grupos y muchos vol√∫menes LVM se pueden ver en el host del cl√∫ster utilizando los comandos <strong>vgs</strong> y <strong>lvs</strong> .  Naturalmente, todas las acciones con tales discos deben realizarse solo desde la consola oVirt, excepto en casos especiales. </p><br><p>  Los discos virtuales para m√°quinas virtuales pueden ser de dos tipos: QCOW2 o RAW.  Los discos pueden ser <em>delgados</em> o <em>gruesos</em> .  Las instant√°neas siempre se crean como <em>delgadas</em> . </p><br><p>  La forma de administrar dominios de almacenamiento, o √°reas de almacenamiento a las que se accede a trav√©s de FC, es bastante l√≥gica: para cada disco virtual de una VM hay un volumen l√≥gico separado que solo se puede escribir en un host.  En el caso de las conexiones a trav√©s de FC, oVirt utiliza algo como LVM en cl√∫ster. </p><br><p>  Las m√°quinas virtuales ubicadas en la misma √°rea de almacenamiento se pueden migrar entre hosts que pertenecen al mismo cl√∫ster. </p><br><p>  Como puede ver en la descripci√≥n, el cl√∫ster en oVirt, como el cl√∫ster en VMware vSphere o en Hyper-V, significa esencialmente lo mismo: esta es una agrupaci√≥n l√≥gica de hosts, preferiblemente id√©nticos en hardware, y que tienen un almacenamiento com√∫n para discos de m√°quinas virtuales. </p><br><p>  Procedemos directamente a crear un √°rea de almacenamiento de datos (discos VM), ya que sin ella el centro de datos no se inicializar√°. <br>  Perm√≠tame recordarle que todos los LUN presentados a los hosts del cl√∫ster en el almacenamiento deben estar visibles para ellos mediante el comando " <strong>multipath -ll</strong> ". </p><br><p>  De acuerdo con la <a href="https://www.ovirt.org/documentation/admin-guide/chap-Storage.html">documentaci√≥n</a> , vaya al portal, vaya a <strong><em>Almacenamiento</em></strong> &gt;&gt; <strong><em>Dominios</em></strong> -&gt; <strong><em>Nuevo dominio</em></strong> y siga las instrucciones de la secci√≥n "Agregar almacenamiento FCP". </p><br><p>  Despu√©s de iniciar el asistente, complete los campos obligatorios: </p><br><ul><li>  <em>Nombre</em> : establezca el nombre del cl√∫ster </li><li>  <em>Funci√≥n de dominio</em> - Datos </li><li>  <em>Tipo de almacenamiento</em> : canal de fibra </li><li>  <em>Host para usar</em> : seleccione el host donde est√° disponible el LUN requerido. </li></ul><br><p>  En la lista de LUN, seleccionamos el que necesitamos, hacemos clic en <em>Agregar</em> y luego en <em>Aceptar</em> .  Si es necesario, puede ajustar par√°metros adicionales del √°rea de almacenamiento haciendo clic en <em>Par√°metros avanzados</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla del asistente de complemento "Dominio de almacenamiento"</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/tk/tz/gq/tktzgqwyqioqf45ere-qi2ll6bc.png"></p></div></div><br><p>  De acuerdo con los resultados del asistente, deber√≠amos obtener una nueva √°rea de almacenamiento, y nuestro centro de datos deber√≠a pasar al estado <strong>UP</strong> o inicializado: </p><br><div class="spoiler">  <b class="spoiler_title">Capturas de pantalla del centro de datos y √°reas de almacenamiento en √©l:</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/dj/4j/zm/dj4jzmtuzoyu4ustvkcaqxgywoo.png"></p><br><p><img src="https://habrastorage.org/webt/5l/tn/gd/5ltngdb3ipqfrfkkvktqriegwzq.png"></p></div></div><br><h4 id="sozdanie-i-nastroyka-setey-dlya-virtualnyh-mashin">  Crear y configurar redes para m√°quinas virtuales. </h4><br><p>  Enlace de documentaci√≥n - Gu√≠a de administraci√≥n de oVirt, <a href="https://www.ovirt.org/documentation/admin-guide/chap-Logical_Networks.html">Cap√≠tulo 6: Redes l√≥gicas</a> </p><br><p>  Las redes, o redes, se utilizan para agrupar redes l√≥gicas utilizadas en la infraestructura virtual oVirt. </p><br><p>  Las interfaces l√≥gicas como el puente de Linux se utilizan para interactuar con un adaptador de red en una m√°quina virtual, con un adaptador f√≠sico en el host. </p><br><p>  Para agrupar y dividir el tr√°fico entre redes, las VLAN se configuran en los conmutadores. </p><br><p>         oVirt,     ,   VLAN  ,        ,        . </p><br><p>                <a href="https://habr.com/ru/company/lenvendo/blog/483980/"> </a> ‚Äì    <strong>bond1</strong> ,           oVirt. </p><br><p>     hosted-engine,      ,           ‚Äì <strong>ovritmgmt</strong> ,      . </p><br><p>        <strong>ovritmgmt</strong>   ,    ,      oVirt. </p><br><div class="spoiler"> <b class="spoiler_title">   ovritmgmt</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/li/ym/4o/liym4ottpmognydqgsc7mi3lvfi.png"></p></div></div><br><p>        ,      <strong><em>Network</em></strong> &gt;&gt; <strong><em>Networks</em></strong> &gt;&gt; <strong><em>New</em></strong> ,    <strong><em>General</em></strong>      VLAN,      ¬´ <em>VM Network</em> ¬ª,          . </p><br><div class="spoiler"> <b class="spoiler_title">    VLAN32</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/gx/3x/nd/gx3xndfoeo-cniaf-cjlnjcefq4.png"></p></div></div><br><p>   <strong><em>Cluster</em></strong> ,       <strong>Cluster1</strong> . </p><br><p>     <strong><em>Compute</em></strong> &gt;&gt; <strong><em>Hosts</em></strong> ,      ,   <strong><em>Network interfaces</em></strong> ,    <em>Setup host networks</em> ,       . </p><br><div class="spoiler"> <b class="spoiler_title">  ¬´Setup host networks¬ª</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/l8/87/me/l887meiynekpssdplkxid4_11yo.png"></p></div></div><br><p>  oVirt         ‚Äì  VLAN  BRIDGE. </p><br><div class="spoiler"> <b class="spoiler_title">       :</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">cat ifcfg-bond1 # Generated by VDSM version 4.30.17.1 DEVICE=bond1 BONDING_OPTS='mode=1 miimon=100' MACADDR=00:50:56:82:57:52 ONBOOT=yes MTU=1500 DEFROUTE=no NM_CONTROLLED=no IPV6INIT=no cat ifcfg-bond1.432 # Generated by VDSM version 4.30.17.1 DEVICE=bond1.432 VLAN=yes BRIDGE=ovirtvm-vlan432 ONBOOT=yes MTU=1500 DEFROUTE=no NM_CONTROLLED=no IPV6INIT=no cat ifcfg-ovirtvm-vlan432 # Generated by VDSM version 4.30.17.1 DEVICE=ovirtvm-vlan432 TYPE=Bridge DELAY=0 STP=off ONBOOT=yes MTU=1500 DEFROUTE=no NM_CONTROLLED=no IPV6INIT=no</code> </pre> </div></div><br><p>   ,     <u> </u>      <strong>ifcfg-bond1.432</strong>  <strong>ifcfg-ovirtvm-vlan432</strong> . </p><br><p>            c hosted engine,      . </p><br><h4 id="sozdanie-ustanovochnogo-obraza-dlya-razvyortyvaniya-virtualnoy-mashiny">        </h4><br><p>    ‚Äî oVirt Administration Guide, <a href="https://www.ovirt.org/documentation/admin-guide/chap-Storage.html">Chapter 8: Storage</a> ,  Uploading Images to a Data Storage Domain. </p><br><p>    ,     ,       ,    , , <a href="https://cobbler.github.io/">Cobbler</a>    . </p><br><p>      ,        oVirt. ,     ISO Domain,     oVirt    ,         Storage domain   . </p><br><p>      <strong>Storage</strong> &gt;&gt; <strong>Disks</strong> &gt;&gt; <strong>Upload</strong> &gt;&gt; <strong>Start</strong> <br>       ISO ,     ,    " <em>Test connection</em> ". </p><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/mf/f6/mq/mff6mqownqd8xt9zhyesnobmt2y.png"></p></div></div><br><div class="spoiler"> <b class="spoiler_title">    :</b> <div class="spoiler_text"><p> <code>Unable to upload image to disk d6d8fd10-c1e0-4f2d-af15-90f8e636dadc due to a network error. Ensure that ovirt-imageio-proxy service is installed and configured and that ovirt-engine's CA certificate is registered as a trusted CA in the browser. The certificate can be fetched from https://ovirt.test.local/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA`</code> </p> </div></div><br><p>     oVirt  ¬´ <strong>  </strong> ¬ª (Trusted Root CA)    ,    . </p><br><p>     Trusted Root CA,   " <em>Test connection</em> ",  : </p><br><pre> <code class="plaintext hljs">Connection to ovirt-imageio-proxy was successful.</code> </pre> <br><p>     ,      ISO  Storage Domain. </p><br><p>  ,    Storage Domain   Data,         ,      Storage Domain  hosted engine,      . </p><br><div class="spoiler"> <b class="spoiler_title">   ISO  Storage Domain  hosted engine</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/1c/eg/vl/1cegvlrj_jio2lyrw8bzwwxqik0.png"></p></div></div><br><h4 id="sozdanie-virtualnoy-mashiny">    </h4><br><p>   : <br> oVirt Virtual Machine Management Guide ‚Äì&gt; <a href="https://www.ovirt.org/documentation/vmm-guide/chap-Installing_Linux_Virtual_Machines.html">Chapter 2: Installing Linux Virtual Machines <br> Console Clients Resources</a> </p><br><p>    oVirt    ,       .    ,       ,       ‚Äì        .       ‚Äì      -   ,   . </p><br><p>      CentOS 7,       . </p><br><p>    ,   <strong>Compute</strong> &gt;&gt; <strong>Virtual Machines</strong> ,     .     ,   <em></em> .   ,   . </p><br><p>   ,       ,   ,   ,      : </p><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/b-/ax/5r/b-ax5rq6w4tfzjp26f0x_oassb8.png"></p><br><p><img src="https://habrastorage.org/webt/zf/og/yc/zfogycv0ghsys-pjj6xl4f6uj64.png"></p><br><p><img src="https://habrastorage.org/webt/da/k9/9s/dak99sg1l7ktd-_kujmswznaveq.png"></p><br><p><img src="https://habrastorage.org/webt/ej/ra/rr/ejrarrisp1wubzm2-cdsawkq0kq.png"></p><br><p><img src="https://habrastorage.org/webt/ka/gi/mv/kagimvvhxi2bei9i-n6gp-ozbse.png"></p></div></div><br><p>     ,  ,        . <br>          : </p><br><div class="spoiler"> <b class="spoiler_title">        </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ph/lz/vv/phlzvvb-isibuzvomxhg-ligxtm.png"></p></div></div><br><p>     ,        . </p><br><div class="spoiler"> <b class="spoiler_title">  ,  ¬´Console¬ª</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ay/w8/7h/ayw87h-2eubjlamhixkkap2j2ag.png"></p></div></div><br><p>       , , <a href="https://virt-manager.org/">Virtual Machine Viewer</a> . </p><br><p>         ,       : </p><br><p><img src="https://habrastorage.org/webt/wu/yj/nm/wuyjnmj_wk_qm_hmzffxkrji0dw.png"></p><br><p>     ,   oVirt guest agent: </p><br><pre> <code class="plaintext hljs">yum -y install epel-release yum install -y ovirt-guest-agent-common systemctl enable ovirt-guest-agent.service &amp;&amp; systemctl restart ovirt-guest-agent.service systemctl status ovirt-guest-agent.service</code> </pre> <br><p>  ,    ,    , ..     ,    , oVirt      .           ,   . </p><br><h4 id="zaklyuchenie">  Conclusi√≥n </h4><br><p> ,     ,  oVirt ‚Äì       ,       ‚Äî      ,    ,    . </p><br><p> -          ,           ,   - ,  ..          ,     , -         .   ‚Äì   ,     ,             . </p><br><p>     ,           : ,  ,  ,     . </p><br><p>           ,       ‚Äî     VyOS      (  ,           oVirt). </p></div></div><p>Source: <a href="https://habr.com/ru/post/485208/">https://habr.com/ru/post/485208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../485198/index.html">Otra forma de medir el rendimiento de los m√©todos de aplicaci√≥n .NET</a></li>
<li><a href="../485200/index.html">Desordenar al principio: autopsia sobre la velocidad de lanzamiento de una aplicaci√≥n iOS</a></li>
<li><a href="../485202/index.html">Sistema de supresi√≥n</a></li>
<li><a href="../485204/index.html">Volver al principio: por qu√© la capitalizaci√≥n de Amazon pronto volver√° a superar los $ 1 bill√≥n</a></li>
<li><a href="../485206/index.html">¬øC√≥mo me decepcion√≥ Typecript y vale la pena?</a></li>
<li><a href="../485210/index.html">Simple zombie shooter en Unity</a></li>
<li><a href="../485214/index.html">CLRium # 7: Pr√°ctico. Seminario, tarea con verificaci√≥n, tutor√≠a</a></li>
<li><a href="../485218/index.html">Reserva de constantes y ganchos Git en C #</a></li>
<li><a href="../485220/index.html">La evoluci√≥n del cortafuegos de aplicaciones web: de cortafuegos a sistemas de seguridad basados ‚Äã‚Äãen la nube de aprendizaje autom√°tico</a></li>
<li><a href="../485222/index.html">¬øC√≥mo trabajar con l√≠deres de opini√≥n en China? Cinco consejos pr√°cticos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>