<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍⚕️ 🧑🏾‍🤝‍🧑🏽 📲 Cinco anos de escravidão 👩🏼‍✈️ 👝 🔒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Você já pensou em seu próprio jogo? E o seu próprio jogo multiplayer? Eu acho que sim! Muitos de vocês gostariam de se apegar ao desenvolvimento de su...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cinco anos de escravidão</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451636/"><p>  Você já pensou em seu próprio jogo?  E o seu próprio jogo multiplayer?  Eu acho que sim!  Muitos de vocês gostariam de se apegar ao desenvolvimento de sua própria obra-prima, onde sua imaginação multifacetada e seu perfeccionismo excepcional se fundem.  Entendo você e quero contar a minha história dessa maneira fascinante. </p><br><img src="https://habrastorage.org/webt/0c/5s/ok/0c5sokhrkkhvb-sxot8jlq2-h1a.png"><a name="habracut"></a><br><br><h3>  Antecedentes </h3><br><p>  Tudo começou em 2007, quando apareceu um jogo j2me online baseado no trabalho de Sergey Lukyanenko.  Eu ainda não tinha um computador e fiquei muito impressionado com este jogo em um telefone celular, acima de tudo, atingiu o mundo aberto.  Eu me envolvi e, apesar da ausência de tutoriais, rapidamente descobri o que estava acontecendo. </p><br><p>  O tempo passou, mas o interesse não desapareceu, já não havia apenas um jogo.  O desejo de aprender como isso funciona e a aleatoriedade levaram ao uso de bugs nas proibições subsequentes.  A graduação e a escolha da profissão "programador" deram impulso ao desenvolvimento do meu primeiro software para obter lucro no mundo online. </p><br><p>  Assim que meu conhecimento no campo de OOP foi fortalecido, já decidimos com meu companheiro de brincadeira e artista desenvolver nosso próprio MMO, o que seria cem vezes mais legal! </p><br><h3>  Sobre o que é o nosso jogo? </h3><br><p>  Nosso jogo glorifica duas facções em guerra, Oseon e Weiland.  Cada um deles tem seu próprio planeta; por sua vez, abriga os edifícios necessários para o desenvolvimento do jogador. </p><br><img src="https://habrastorage.org/webt/hh/qq/ku/hhqqkurjlfnato607npxc724bps.png"><br><p>  <i>Home planeta facção Oseon</i> </p><br><p>  Os planetas das facções são protegidos por um sistema de 12 portas.  Tendo capturado todos os portões, os jogadores ganham acesso ao planeta inimigo.  Não basta apenas se teletransportar pelo caminho aberto, depois disso é necessário capturar a cidadela - o edifício principal do planeta.  Encontrando-se em uma situação difícil, os jogadores do lado ocupado recebem tropas de reserva com parâmetros 1,4 vezes maiores que os seus. </p><br><p>  As batalhas acontecem passo a passo, algumas as comparam com outras semelhantes em “Heroes”, outras as chamam de uma espécie de xadrez.  Em parte, eles estão bem, existem unidades com magia aqui, e você terá que pensar alguns passos à frente com a cabeça. </p><br><img src="https://habrastorage.org/webt/-c/9d/1f/-c9d1ff4ggm6xefni-f_nrntahi.png"><br><p>  <i>Batalha com o inimigo</i> </p><br><p>  No entanto, o mundo cruel dos jogos PvP tem outras mecânicas interessantes, começando com o desenvolvimento usual de depósitos ricos e terminando com caçadas a caçadores de tesouros. </p><br><h3>  Protótipo </h3><br><p>  Como não tínhamos experiência na criação de jogos MMO, decidimos levar tudo o que é ruim.  Nosso conjunto inclui: Anthill, Netty, MySQL.  Essas não eram exatamente essas tecnologias.  Depois de muito trabalho, enfrentamos vários problemas: a falta de um editor de interface, os micro-logs do mapa ao mover, entrada de texto e muito mais.  Em tela cheia, o jogo parecia nojento. </p><br><img src="https://habrastorage.org/webt/ak/z_/xu/akz_xuh5kt1y03ctr_svj48hxro.jpeg"><br><p>  <i>O protótipo do jogo.</i>  <i>Desenvolvimento de minas</i> </p><br><p>  Em alguns casos, ao mudar o estado do jogo, a câmera virtual no mecanismo começou a se comportar de maneira estranha. </p><br><img src="https://habrastorage.org/files/ce5/2db/b5e/ce52dbb5e8214c90aaaa66f3587bee4b.jpg"><br><p>  <i>O protótipo do jogo.</i>  <i>Lags</i> </p><br><p>  Após um ano de desenvolvimento, quando não era mais possível recuar, concluímos a mecânica básica do jogo, montamos um editor de mapas e decidimos que havia chegado a hora de testá-lo em público. <br>  Adicionamos o jogo ao VK (sem catálogo) e anunciamos o lançamento em nosso grupo, onde havia cerca de 100 pessoas. <br>  Neste momento, o jogo tinha um controle incompreensível envolvendo o teclado, havia muitos bugs, além de mapas muito simples, com apenas duas camadas (grama e árvores).  E depois de três dias jogando no VK, apenas 15 pessoas se inscreveram - as pessoas não entenderam como jogar.  E decidimos refazer tudo do zero. </p><br><div class="spoiler">  <b class="spoiler_title">Capturas de tela da versão antiga</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/86/ip/lq/86iplq2x6vm3xlv0zofiusij4su.jpeg"><br><p>  <i>Ótimo online</i> </p><br><img src="https://habrastorage.org/webt/wv/cj/6e/wvcj6edp7-rgvxtwdvfuyzzzi4e.jpeg"><br><p>  <i>Menu de interação do jogador</i> </p><br><img src="https://habrastorage.org/webt/4s/jf/xq/4sjfxqhnbcft0c8hg3x105nfva0.png"><br><p>  <i>Luta</i> </p></div></div><br><h3>  Lech, não é isso, vamos primeiro! </h3><br><p>  Provavelmente, muitos, diante do fracasso, acham que não é deles, porque gastou muito tempo, mas não há resultado visível.  Mas desistir é estúpido quando você percorreu um longo caminho.  Depois de alguns meses, com a experiência existente, decidimos retomar o jogo. </p><br><p>  Decidimos criar definitivamente a nova versão do cliente com renderização gráfica via placa de vídeo.  Das muitas estruturas, Starling parecia a mais atraente, tinha uma API semelhante com um flash padrão, era suportada pela Adobe e era possível usar os gráficos existentes sem muito esforço.  Finalmente, a nova versão funcionou sem problemas. <br>  Para rasterizar o vetor em tempo real, peguei o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dynamic TextureAtlas Generator</a> .  Mas na biblioteca subseqüente quase teve que ser reescrita e abandonada atlas, a animação ocupava muito espaço e não cabia no atlas dos tamanhos permitidos. </p><br><h3>  Postais </h3><br><p>  Depois que descobrimos as tecnologias no cliente, decidimos lidar com as placas de <s>servidor</s> .  Cada planeta pode consistir em um ou mais locais, entre os quais você pode ir para a direita ou esquerda.  Para cada local, uma parte do mapa foi criada, consistindo inicialmente em duas camadas.  Mais tarde, decidimos adicionar outra camada e, em seguida, outra camada e, como resultado, estabelecemos quatro: </p><br><ul><li>  grama / solo; </li><li>  pedras \ água; </li><li>  decorações do tamanho de gaiolas; </li><li>  cenário amplo. </li></ul><br><p>  A idéia era que as três primeiras camadas fossem desenhadas em um bitmap e enviadas para a memória de vídeo.  Essa é uma boa abordagem quando, em vez de três camadas, uma é desenhada em segundo plano.  Mas não foi sem problemas: ao alternar o MovieClipa para o próximo quadro para rasterização, todos os quadros anteriores devem ser desenhados.  Na entrada do local, o jogo foi congelado, por isso foi decidido transferir todos os blocos para o BitmapData com antecedência e fazer cópias rápidas de pixels.  Mas, ao mesmo tempo, um friso desagradável foi obtido no início do jogo, no momento da rasterização de um grande número de quadros.  Você pode ter visto alguns navegadores congelarem na inicialização ao carregar recursos.  Como não queríamos que o jogo fosse o mesmo inválido, limitei o tempo para desenhar peças para cada quadro.  Aqui você pode ler mais sobre como fazê-lo. <br>  Todos os cartões tinham um tamanho de 20x16 quadrados de 64px.  Os dados do mapa foram gravados em um arquivo em formato binário, onde os limites da camada foram determinados com antecedência e restavam apenas o registro do número do quadro do MovieClip.  Assim, o peso do arquivo de mapa era de 1280 bytes.  Porém, mais tarde, o formato foi convertido em JSON para facilitar o trabalho com dados. </p><br><p>  Como resultado, o trabalho em mapas ocupou uma parte significativa do desenvolvimento do cliente.  Para poder criar belos mapas, um editor foi escrito no Flex. </p><br><img src="https://habrastorage.org/webt/qp/iy/kr/qpiykrgcgjbuiz31c1isrezc6ey.png"><br><p>  <i>Editor de mapa</i> </p><br><p>  Cada um dos 14 planetas tem sua própria flora e fauna, para que você possa entender visualmente em que planeta está. </p><br><img src="https://habrastorage.org/webt/nz/q4/yc/nzq4ycpgqdkymsswgou_etbdsfo.png"><br><p>  <i>Variedade</i> </p><br><p>  Além disso, programaticamente, adicionamos metades de blocos para o cartão, de cima e de baixo, que simplesmente duplicam os blocos vizinhos.  Isso foi feito para elementos interativos importantes, como botões de menu.  Campos de locais vizinhos com a névoa da guerra foram adicionados à esquerda e à direita - essa foi uma ótima idéia que resolveu vários problemas ao mesmo tempo.  O jogo começou a ficar muito melhor em tela cheia. </p><br><img src="https://habrastorage.org/webt/_e/et/_u/_eet_uwchuytsdydwnhf5i348yc.png"><br><p>  <i>Cartão com névoa de guerra nas laterais</i> </p><br><h3>  Servidor </h3><br><p>  Enquanto lidávamos com o cliente, procurávamos simultaneamente um programador de servidor, mas não havia muitos que quisessem escrever um jogo duvidoso sem documentação normal.  Alguns começaram a escrever e desistiram imediatamente, porque ficou claro o que escrever, e mergulhar nos espinhos da lógica do jogo era chato.  Depois de algum tempo, determinamos que precisávamos de um especialista que pudesse projetar o servidor em Java e, se ele abandonasse o projeto no futuro, eu poderia adicioná-lo.  O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">solucionador de</a> artesão local nos ajudou com a arquitetura do servidor.  Pode-se dizer que ele nos colocou no caminho certo: ele mostrou como criar um servidor e pegou emprestada a arquitetura do curso de treinamento do Mail.ru.  Solver não foi exceção e depois de um tempo nos deixou.  Depois de mais um ano de esforço, consegui escrever toda a lógica básica do jogo.  Agora, olhando para trás, estou perplexo porque não escrevemos o servidor no Akka? </p><br><p>  Você pode ler sobre arquitetura aqui - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Arquitetura de um servidor de jogos online usando o Skyforge</a> como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">exemplo</a> ; também é possível encontrar palestras sobre o Intuit.  No nosso servidor, é claro, não 2 milhões de linhas, mas também bastante.  Nenhuma fibra (como no skyforge) é usada, e nosso servidor provavelmente se mostrou menos legível.  A propósito, o código usado para a mesma fibra para multitarefa sem aglomeração no Skyforge foi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">publicado</a> muito mais tarde, quando tudo já funcionava para nós. <br>  Enquanto eu estava ocupado com o servidor e colei a lógica no cliente, o artista completou os detalhes ausentes, que caíram imediatamente no cliente.  Assim que o servidor ficou pronto, lançamos um teste alfa.  Desta vez, tudo estava quase como deveria, mas os bugs e erros do servidor precisavam ser corrigidos por um longo tempo. </p><br><h3>  Para frente e para trás.  Mecânica de jogo nascida </h3><br><p>  Eu gostaria de falar sobre outra coisa incomum no jogo.  Como você nomearia um jogador que especificamente faz um exército incompleto e perde para outros jogadores / bots?  Nós os chamamos de "ameixas".  Eles mesclam experiência e diminuem seu nível intencionalmente, tornando-se mais fortes em seu nível.  Isso é importante quando o nível de jogadores que podem ser atacados é limitado e oferece mais oportunidades de desenvolvimento.  Está se tornando mais fácil derrotar inimigos de alto nível e obter mais recompensas.  É como bombear o persa, mas na direção oposta.  Embora possa parecer mais simples que o jogo clássico, o desperdício de experiência exige mais tempo e habilidade para aumentar inicialmente.  Se você diminuir o nível de um personagem fraco, isso não dará uma grande vantagem e puxará o jogador apenas para a média.  Aumentar e diminuir o nível pode ser infinitamente longo.  Mesmo tendo atingido o desenvolvimento máximo para seu nível máximo atual, o jogador pode subir para um nível ainda mais alto para acessar novas tecnologias e mesclar seu progresso com a experiência novamente, permanecendo tão forte em tecnologia. </p><br><p>  Iniciantes têm um problema quando não podem fazer nada com esses anões bombeados.  Resolvemos esse problema introduzindo restrições, dividindo os jogadores em dois grupos: você só pode atacar bots em bots, com restrições no nível máximo de outros jogadores e nos mesmos jogadores mesclados que são.  Assim, eles quase deixaram de exercer pressão sobre o equilíbrio do jogo e, o mais importante, poderiam continuar fazendo o que quisessem. </p><br><h3>  Não deu certo, não fartanulo </h3><br><p>  Entramos no catálogo de jogos da VK em 4 de fevereiro de 2018 e não na primeira vez.  Nossa primeira solicitação foi rejeitada sem explicação, enquanto a reinscrição foi adicionada ao catálogo. </p><br><p>  Apesar do longo tempo de desenvolvimento do jogo, não foi possível capturar todos os detalhes; cometemos muitos erros.  Antes de tudo, eles cometeram um erro com a plataforma: nem todos os jogadores estão prontos para gastar muito tempo em um jogo 2D baseado em navegador, o que requer um mecânico.  Muitas pessoas estão acostumadas a jogos mais simples e compreensíveis, onde há mais diversão desde o início.  Nosso treinamento no jogo, para dizer o mínimo, falhou.  Depois de concluir o tutorial, os jogadores esquecem com segurança o que estava lá e talvez nem leiam. <br>  De acordo com as estatísticas da VK, temos uma enorme quantidade de jogadores; na maioria das vezes, apenas aqueles que jogaram aquele jogo antigo e já familiarizados com a mecânica permanecem por um longo tempo. </p><br><h3>  48 semanas depois ... </h3><br><p>  Cerca de um ano após o lançamento da versão alfa, ficou claro que o Flash logo deixaria de funcionar nos navegadores.  A partir desse momento, decidi que deveria portar o cliente para algo mais tenaz.  Claro, é melhor escrever em um idioma familiar, então eu escolhi o LibGDX.  Essa estrutura Java nos permitiu não reescrever alguma parte da lógica, mas simplesmente copiá-la do servidor.  Ele possui boas abstrações para mapas de blocos e uma implementação para o Tiled, o que nos permitiu escrever rapidamente o código para nossos mapas.  Mas também existem pontos fracos: renderização de fontes, falta de editores de interface visual ao vivo etc. </p><br><p>  No momento, um cliente alfa para Android é gravado, o que implementa 50% de todos os recursos do jogo. </p><br><img src="https://habrastorage.org/webt/tx/vc/4c/txvc4cjf5ve_36nu88ybojus43k.png"><br><p>  <i>Mobile Game Client</i> </p><br><p>  O desenvolvimento ainda está em andamento.  Se você deseja desenhar ou escrever algo para um cliente móvel - escreva. </p><br><p>  <i>Gostaria também de expressar minha gratidão ao engenheiro de som Peresvet Mukhanov e ao compositor Artem Davydov, que escreveram tudo o que pode ser ouvido no jogo em um tempo muito curto e de alta qualidade.</i> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt451636/">https://habr.com/ru/post/pt451636/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt451624/index.html">Sobre como Harry Potter molda a educação russa, é claro, não onde você precisa</a></li>
<li><a href="../pt451626/index.html">Aprendendo sem professor: um aluno curioso</a></li>
<li><a href="../pt451628/index.html">Avaliação da 3D Expo em abril de 2019</a></li>
<li><a href="../pt451630/index.html">Monitoramento contínuo - automação de verificações de qualidade de software no pipeline de CI / CD</a></li>
<li><a href="../pt451634/index.html">Como somos analisados ​​em lojas e restaurantes</a></li>
<li><a href="../pt451638/index.html">Animação em aplicativos móveis: testando Lottie</a></li>
<li><a href="../pt451640/index.html">Game of Thrones: construindo infográficos sobre assassinatos, sexo, viagens a Westeros e muito mais</a></li>
<li><a href="../pt451642/index.html">Encontrar um caminho entre obstáculos redondos</a></li>
<li><a href="../pt451644/index.html">Implantação de aplicativos em VM, Nomad e Kubernetes</a></li>
<li><a href="../pt451646/index.html">A produção do casco da nave espacial da Federação começou</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>