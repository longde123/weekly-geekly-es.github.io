<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëéüèΩ ‚è´ ‚≠ïÔ∏è DEFCON-Konferenz 17. Lachen Sie √ºber Ihre Viren! Teil 1 üê± üè∞ üÖ±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Michael: Ich begr√º√üe alle, ich bin Michael Lai, das ist Matthew Richard, du kannst ihn Matt oder Richard nennen, weil er zwei Namen hat, aber das spie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DEFCON-Konferenz 17. Lachen Sie √ºber Ihre Viren! Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/428858/"> <b>Michael: Ich</b> begr√º√üe alle, ich bin Michael Lai, das ist Matthew Richard, du kannst ihn Matt oder Richard nennen, weil er zwei Namen hat, aber das spielt keine Rolle. <br><br>  <b>Matt:</b> Das Thema unseres heutigen Gespr√§chs ist die L√§cherlichkeit von Malware, und genau das versuchen wir zu tun. <br><br><img src="https://habrastorage.org/webt/dg/yd/dw/dgyddwjbkvhvkngc1lug68ifhb8.jpeg"><br><br>  Also, nicht jeder, der den Code schreibt, macht es gut, die Leute machen viele Fehler.  Und nicht jeder, der den Virus verwendet, macht es richtig.  Es gibt auch Menschen, die in beiden F√§llen versagen.  Setzen Sie sich also bequemer hin, entspannen Sie sich und h√∂ren Sie zu. Vielleicht sind diese Informationen f√ºr Sie hilfreich. <br><br>  Nur f√ºr den Fall, wir haben sachliches technisches Material in die Pr√§sentation aufgenommen, damit Sie zumindest etwas lernen, wenn Ihnen das Gespr√§ch nicht lustig erscheint.  Ich stelle fest, dass dies nur unsere Meinung ist, die m√∂glicherweise nicht mit der Meinung unserer Arbeitgeber √ºbereinstimmt. <a name="habracut"></a><br><br>  <b>Michael: Die</b> erste Geschichte hei√üt "Schatz, ich habe die Entropie reduziert!"  Sie spricht dar√ºber, wie der Autor von Silent Banker, einem sehr komplexen Verschl√ºsselungsalgorithmus, vergessen hat, mit PRNG - einem Pseudozufallszahlengenerator - Entropie zu erzeugen.  Auf der Folie sehen Sie ein Zeus-Code-Snippet vom September 2007, in dem PRNG verwendet wird, um eine Hash-basierte Erkennung zu verhindern.  Die Generierung besteht darin, diese globale Variable mit dem Namen ddTickCount zu initiieren: Zun√§chst wird sie im EAX-Register abgelegt, von wo aus die Funktion zum ersten Mal aufgerufen wird.  Dann wird gepr√ºft, ob der Wert der Funktion gleich Null ist, und wenn nicht gleich, wird TickCount aufgerufen, um SEED zu erzeugen, dh eine Pseudozufallszahl mit dem Befehl GetTickCount zu initiieren. <br><br><img src="https://habrastorage.org/webt/eq/lo/pv/eqlopvhuevvaq3r9k1oqbkdygy0.jpeg"><br><br>  Wir waren nicht √ºberrascht, als wir die √Ñhnlichkeiten mit diesem Code in der Silent Banker-Bin√§rdatei vom Februar 2008 sahen.  Es verwendet PRNG, um tempor√§re Dateinamen zu generieren.  Auch hier gibt es dieselbe globale Variable ddTickCount, die pr√ºft, ob es eine Null gibt, und wenn dies der Fall ist, wird mit GetTickCount eine Pseudozufallszahl initiiert.  Bevor ich msvsrt rand sah, den Pseudozufallszahlengenerator, der von der rand () - Funktion der Microsoft C Runtime Windows-Bibliothek verwendet wird, dachte ich zun√§chst, dass es eine Verbindung zwischen dem Zeus-Autor und dem Silent Banker-Autor gibt, die nur auf HEX-Zahlen basiert, die in einer Bin√§rdatei fest codiert sind .  Tats√§chlich waren beide nur statisch mit msvsrt verbunden. <br><br>  Jetzt kommen wir zum Rezept f√ºr eine Katastrophe.  Dies ist ein Codeausschnitt aus der Silent Banker-Version vom Juli 2008, die einige Monate nach der Februar-Version ver√∂ffentlicht wurde. <br><br><img src="https://habrastorage.org/webt/z9/wh/fr/z9whfrngqr3rhppqfx1xdficwio.jpeg"><br><br>  Sie haben ihren Code aktualisiert und eine neue Version von Silent Banker ver√∂ffentlicht, die sich erheblich von der vorherigen Version unterschied.  In diesem Programm wird PRNG verwendet, um einen Verschl√ºsselungsschl√ºssel zu generieren.  Hier sehen Sie nicht mehr, dass eine globale Variable namens CurrentSeed auf Gleichheit mit Null gepr√ºft wird und abh√§ngig davon eine Pseudozufallszahl generiert wird. Sie wird einfach in diesem Code verwendet. <br><br><img src="https://habrastorage.org/webt/tz/ig/ny/tzignymsyqo08w5wjth2zugzo38.jpeg"><br><br>  Es ist m√∂glich, dass irgendwo in der Bin√§rdatei, noch vor diesem Ort, der Wert dieser globalen Variablen in Form einer Art von Zahl generiert wird.  Also zerlege ich diesen Code und √ºberpr√ºfe, ob der CurrentSeed-Wert an anderer Stelle im Programm verwendet wird, bevor er in dieser rand () -Funktion verwendet wird.  Sie sehen, dass dd anfangs von vorne beginnt, und wir werden die Querverweise auf diese Variable √ºberpr√ºfen. <br><br><img src="https://habrastorage.org/webt/xb/gw/uh/xbgwuhestru6xn4re261ayainnk.jpeg"><br><br>  In Spalte T bedeutet der Wert w, dass es f√ºr diese globale Variable in der gesamten Bin√§rdatei nur eine g√ºltige Operation gibt - dies ist die Rand-Funktion selbst.  Ich werde diese Dinge flie√üend durchgehen, da sie bereits auf der DefCon im letzten Jahr erw√§hnt wurden.  Auf der Folie "Rezept f√ºr eine Katastrophe" wird die Zeile "PRNG-Seed" oder "Initiierung eines Pseudozufallszahlengenerators" grau angezeigt, um anzuzeigen, dass der Autor von Silent Banker diese Initiierung nicht durchgef√ºhrt hat. <br><br><img src="https://habrastorage.org/webt/bp/aj/n9/bpajn9ym0w4nhtdxaboum9cm2oe.jpeg"><br><br>  Der n√§chste Schritt besteht darin, dass sie einen 16-Byte-Schl√ºssel generieren und 1000 Systemaufrufe an die MyRand () - Funktion senden.  Dann generieren sie aus einem 16-Byte-Schl√ºssel eine 8-Byte-Zahl - den Schl√ºssel unter Verwendung einer bestimmten Formel. <br><br>  Danach generieren sie eine weitere 8-Byte-Nummer, um aus der ersten 8-Byte-Nummer einen Sekund√§rschl√ºssel zu erstellen, f√ºgen einen beliebigen Wert aus der INI-Konfigurationsdatei hinzu und erhalten einen Terti√§rschl√ºssel, der ebenfalls eine 8-Byte-Nummer ist.  Schlie√ülich verwenden sie eine mathematische Funktion mit beliebiger Genauigkeit, um einen 8-Byte-Schl√ºssel in einen 32-Byte-Schl√ºssel umzuwandeln. <br><br>  Danach verschl√ºsseln sie die gestohlenen Daten wie das Kennwort des Benutzers mit dem urspr√ºnglichen 16-Byte-Schl√ºssel.  Sie geben diese 16-Byte-Nummer jedoch nicht mit den gestohlenen Daten an "ihren" Angreifer weiter, da das Senden des Schl√ºssels zusammen mit der verschl√ºsselten Nachricht keine gute Idee ist.  Stattdessen f√ºgt der Autor von Silent Banker eine 32-Byte-Nummer in die gestohlenen Daten ein und sendet sie an den Empf√§nger, der √ºber ein Programm verf√ºgen sollte, das diese Nummer zur√ºck in den 16-Byte-Originalschl√ºssel konvertiert.  Dieses Programm haben wir jedoch nicht! <br><br>  Die n√§chste Folie zeigt ein Rezept, wie Sie diese Katastrophe mit Nummer 1 - dem Fehlen eines PRNG-Generators - zu Ihrem Vorteil nutzen k√∂nnen. <br><br><img src="https://habrastorage.org/webt/al/wp/lm/alwplmsbxy8ej3auux-aa0v6qbk.jpeg"><br><br>  Zun√§chst setzen wir den Wert von PRNG mit Null gleich.  Wir k√∂nnen die n√§chsten vier Schritte mithilfe eines Python-Skripts f√ºr den Debugger automatisieren, da wir eine Formel haben, die einen 16-Byte-Schl√ºssel, einen 8-Byte-Schl√ºssel, den n√§chsten 8-Byte-Schl√ºssel und einen 32-Byte-Schl√ºssel berechnet.  Diese Formel ist nicht im C-Code enthalten, aber wir haben sie, weil wir eine Kopie der Silent Banker-Bin√§rdatei haben, in der sie vorhanden ist. <br><br>  Ich werde Ihnen eine Demo zeigen, wie dieses Python-Skript funktioniert.  Wir haben ein gutes Szenario: Hier habe ich Silent Banker und einen unabh√§ngigen Debugger, an den ich angeschlossen bin, sowie den Internet Explorer, in dem Silent Banker ausgef√ºhrt wird.  Ich habe vier Funktionen festgestellt, die Verschl√ºsselungsschl√ºssel generieren.  Ich f√ºge dieses Python-Skript hinzu, das in der vorherigen Folie gezeigt wurde und das ich mit dem Befehl bang keygen aufrufe.  Sie k√∂nnen sehen, dass der Debugger diese wenigen Funktionen, die ich f√ºr diese Demo ausf√ºhren m√∂chte, einfach f√ºnfmal ‚Äûverliert‚Äú.  Im wirklichen Leben haben wir diese Aktion 5.000 Mal ausgef√ºhrt, um einen gr√∂√üeren Schl√ºsselsatz zu erhalten. <br><br>  Im Protokollfenster k√∂nnen Sie sehen, dass f√ºr jede Iteration der Schleife ein prim√§rer 16-Byte-Schl√ºssel ausgegeben wird, der dann einem 32-Byte-Schl√ºssel zugeordnet wird.  W√§hrend das Skript Informationen im Protokoll druckt, wird auch eine Textdatei auf der Festplatte erstellt, die Paare von Schl√ºsseln mit 16 und 32 Byte enth√§lt.  Es ist nur eine hexadezimale HEX-Datei, daher k√∂nnen wir unser Python-Skript verwenden, um diese Datei zu verarbeiten. Wir haben auch ein Protokollverzeichnis, das wir vom gestohlenen Befehls- und Steuerknoten wiederhergestellt haben. <br><br><img src="https://habrastorage.org/webt/3l/s8/q5/3ls8q5neoqhw_1vzzbx9iadyvuy.jpeg"><br><br>  Oben sehen Sie mehrere Zertifikate verschl√ºsselter privater Schl√ºssel. Darunter befinden sich mehrere Textdateien, die verschl√ºsselte Daten enthalten.  Wir k√∂nnen das Programm einfach ausf√ºhren und in diesen Textdateien suchen, indem wir diesen 32-Byte-Schl√ºssel und den damit verbundenen 16-Byte-Originalschl√ºssel extrahieren. <br><br>  Sobald das Programm einen 16-Byte-Schl√ºssel findet, entschl√ºsselt es die darin enthaltenen Informationen und pr√§sentiert sie in Form einer Textdatei.  Sie sehen diese Datei auf dem Bildschirm und k√∂nnen sie nicht lesen. <br><br><img src="https://habrastorage.org/webt/_l/65/sk/_l65skt8szevodoual8wimixbhi.jpeg"><br><br>  Aber dann haben wir eine Reihe lesbarer tempor√§rer .tmp-Dateien, von denen wir diese Informationen erhalten und an die "rechtm√§√üigen" Eigent√ºmer zur√ºckgeben k√∂nnen.  Die ganze harte Arbeit zum Schutz von Informationen wurde von Silent Banker vergebens geleistet, weil sie vergessen hatten, einen Pseudozufallszahlengenerator zu initiieren. <br><br><img src="https://habrastorage.org/webt/bm/kj/qn/bmkjqnl8fuofa6yhjzjfhg2golq.jpeg"><br><br>  Jetzt werde ich den besten Teil des oben genannten zeigen - dies ist die Silent Banker-Funktion, die ich Why_Not_Use_This genannt habe (Warum nicht verwenden?). <br><br><img src="https://habrastorage.org/webt/nz/yi/-l/nzyi-lwhkvyqil67khx6wt6zeiy.jpeg"><br><br>  Tats√§chlich haben sie in ihrem eigenen Programm die Funktion GetCursorPos (Bestimmen der Cursorposition) zum Erzeugen von Entropie, mit der PRNG initiiert werden kann, und wir k√∂nnen im Programm nach Querverweisen auf diese Funktion suchen. <br><br><img src="https://habrastorage.org/webt/eb/7z/pu/eb7zpunaanojkiys5gc6wx8cgvi.jpeg"><br><br>  Wir sehen, dass es an 10-15 anderen Stellen im Code verwendet wird.  Es stellt sich also heraus, dass die Autoren von Silent Banker nicht vergessen haben, einen Pseudozufallszahlengenerator in das Programm einzuf√ºgen, sondern einfach vergessen haben, diese Funktion im Verschl√ºsselungsprozess mit dem Aufrufoperator auszuf√ºhren. <br><br><img src="https://habrastorage.org/webt/lp/_n/e-/lp_ne-pmgawe-72jw9_x0fvj6ym.jpeg"><br><br>  Die n√§chste Folie hei√üt "Das ist weggerutscht ..." und zeigt, wie dieses Programm funktionieren w√ºrde, wenn der Autor nichts vergessen h√§tte. <br><br><img src="https://habrastorage.org/webt/x0/wn/kb/x0wnkb_6crrojmz0r7twgomdav0.jpeg"><br><br>  Die n√§chste Geschichte mit dem Titel "DES oder nicht DES" handelt von einem Malware-Autor, der nicht einmal wei√ü, wie man die Windows-Programmierschnittstelle richtig verwendet, oder nicht wei√ü, wie gro√ü der maximale DES-Schl√ºssel ist.  Aufgrund der ung√ºltigen Gr√∂√üe dieses Schl√ºssels wird sein Trojaner daher standardm√§√üig mit dem logischen Operator xor verwendet. <br><br>  F√ºr die CryptDeriveKey-Programmschnittstellenfunktion bestimmen die beiden niedrigen Bytes des Parameters dwFlags, Flags, die festlegen, wie die resultierende URL aussehen soll, die Gr√∂√üe Ihres Verschl√ºsselungsschl√ºssels. <br><br><img src="https://habrastorage.org/webt/2a/jt/-q/2ajt-qrub9dk2qkyhbea_panhly.jpeg"><br><br>  Wenn die niedrigen Bytes also 0080 sind, ist der von uns angeforderte Verschl√ºsselungsschl√ºssel ein 128-Bit-RC4-Schl√ºssel.  Es ist dasselbe, als w√ºrde man sich in den Fu√ü schie√üen, und ich werde Ihnen zeigen, warum. <br><br><img src="https://habrastorage.org/webt/02/fm/ev/02fmevcyb9eos_-2a5qcpofweqq.jpeg"><br><br>  Auf der Folie sehen Sie eine Zeile mit der falschen Gr√∂√üe des 128-Bit-Schl√ºssels dwFlags - 800000 und eine Zeile mit dem falschen MSCryptoAPI-Wert.  Ich werde Ihnen die Demontage dieses Dings zeigen.  Sie sehen eine Funktion namens "Initialisieren des Verschl√ºsselungssubsystems": Der Trojaner ruft den verschl√ºsselten Kontext auf und erstellt dann einen Container f√ºr den MD5-Hash, erstellt dann einen MD5-Hash des fest codierten Kennworts in der Bin√§rdatei und versucht, die Ausgabe dieser Hash-Funktion zum Erstellen eines 128-Bit-DES-Schl√ºssels zu verwenden.  In diesem Fall wird jedoch kein Schl√ºssel erstellt, da es keinen 128-Bit-DES-Schl√ºssel gibt. <br><br><img src="https://habrastorage.org/webt/cp/kv/os/cpkvosn5t2fsqsxbgd3kjdrb5-c.jpeg"><br><br>  Wenn eine dieser API-Funktionen fehlschl√§gt, springt sie zu dieser Stelle, die ich gelb markiert habe, und zeigt eine Meldung an, dass der Schl√ºssel nicht empfangen werden kann.  Und dieser Ort ist genau hier, wo er den Wert, der in ebp ist und zu diesem Zeitpunkt 0 ist, also direkt in diesen booleschen Wert bUseMSCryptoAPI verschiebt. <br><br>  Mal sehen, welchen Effekt dies w√§hrend der Programmausf√ºhrung hat.  Wir werden diesem Element der Codestruktur folgen, um zu sehen, wo es sonst im Programm verwendet wird und wie unterschiedlich sich dieses Trojaner-Exponat verh√§lt, wenn die Funktion wahr ist und wenn die Wunde falsch ist. <br><br><img src="https://habrastorage.org/webt/-4/0d/m1/-40dm1wrxg7y9pjzfdyv5wp_ov8.jpeg"><br><br>  Wir sehen, dass der logische Wert in der Funktion √ºberpr√ºft wird, die ich Daten verschl√ºsseln nannte, "Datenverschl√ºsselung", und wenn es wahr ist, kommt es zu diesem Block, in dem DES-Verschl√ºsselung und CryptEncrypt MSAPI verwendet werden. <br><br><img src="https://habrastorage.org/webt/bf/14/oz/bf14oz0sgb2bwpj9fkorcziwhhw.jpeg"><br><br>  Wenn dieser Wert jedoch 0 ist und es bekanntlich immer fr√ºh Null ist, geht die Funktion zu diesem Block, der standardm√§√üig xor ist. <br><br><img src="https://habrastorage.org/webt/3i/y2/go/3iy2gollhuccdcjwuclgygehxsq.jpeg"><br><br>  Ich war gespannt, zu welchem ‚Äã‚ÄãZeitpunkt der Autor des Schadprogramms beschlossen hat, all dies zu sichern.  Vielleicht dr√§ngten ihn die Leute von oben, so dass er gezwungen war, Malware loszuwerden, aber in letzter Minute stellte er fest, dass sein DES nicht funktionierte, und benutzte xor f√ºr die Backup-Aufzeichnung.  Alles in allem war es ziemlich lustig, also ist die Moral dieser Geschichte, immer Backups zu machen! <br><br>  Die folgende Geschichte hei√üt "Was hast du mit was gemacht?".  Ich habe versucht, einen Begriff zu finden, der beschreibt, wie die Verschl√ºsselung des Coreflood-Trojaners funktioniert, und habe beschlossen, ihn als "standortabh√§ngige Verschl√ºsselung" zu bezeichnen.  Kurz gesagt, die Autoren dieses Trojaners haben eine neue Verschl√ºsselungsmethode erfunden.  Ich dachte, vielleicht hat schon jemand einen Artikel dar√ºber geschrieben und es sollte "google" sein?  Google gab mir einen Link zu einer US-Patentseite, auf der jemand ein Patent f√ºr "ortsabh√§ngige Verschl√ºsselung" angemeldet hat.  Dieses Schema ist ziemlich verwirrend, daher wird es viel Zeit in Anspruch nehmen, es zu studieren.  So funktioniert es: Ich sende Ihnen eine verschl√ºsselte Nachricht. Um sie zu entschl√ºsseln und zu lesen, m√ºssen Sie ein GPS-Ger√§t nehmen und zu einem Punkt mit dem von mir angegebenen Breiten- und L√§ngengrad gehen.  In der Regel ist die Verschl√ºsselung ein Kompromiss zwischen Sicherheit und Benutzerfreundlichkeit, bei dieser Methode gibt es jedoch weder die eine noch die andere. <br><br><img src="https://habrastorage.org/webt/ff/s5/bk/ffs5bkfdwagmbngmoms8efnmcje.jpeg"><br><br>  Dies ist definitiv nicht sicher und erfordert, dass Sie dorthin gehen, wo der Absender zeigt, um die Nachricht zu lesen.  Matt scherzte, wenn Sie online per E-Mail k√§mpfen und wirklich jemanden loswerden m√∂chten, senden Sie ihm eine verschl√ºsselte Nachricht, die er irgendwo im Irak lesen kann, und Sie werden keine Probleme mehr mit ihm haben. <br><br>  Wie wird diese Methode im Coreflood-Trojaner verwendet?  Die Folie zeigt ein Codefragment, aus dem folgt, dass der Trojaner, nachdem er Benutzerinformationen gestohlen hat, diese verschl√ºsselt und auf die Festplatte schreibt, damit der Trojaner diese Informationen sp√§ter empfangen und Befehl und Kontrolle auf seine Website hochladen kann. <br><br>  Diese Funktion hei√üt SetFilePointer (setzt den Dateizeiger) und ihr R√ºckgabewert ist dWord. Dies gibt den Versatz in der Datei an, auf den der Zeiger gesetzt wurde, wenn er √ºberschritten wurde.  Als n√§chstes nimmt die Funktion die Anzahl der Bytes, um nNumberOfBitesToWrite zu verschl√ºsseln, und verschiebt sie in das ecx-Register.  Sie nimmt dann den Datenzeiger zur Verschl√ºsselung und verschiebt ihn in das edx-Register. <br><br><img src="https://habrastorage.org/webt/rg/lp/tu/rglptunvnn4tddlxgtivifxdg6w.jpeg"><br><br>  Danach wird der xor-Operator verwendet, der jedes Byte in den al- und ah-Puffer legt. Dies bedeutet, dass von SetFilePointer zur√ºckgegebene Bytes auf niedriger und hoher Ebene zur√ºckgegeben werden.  Somit ist der Verschl√ºsselungsschl√ºssel in diesem Schema der Offset in der Datei, in der die Daten vorhanden sind.  Das ist einfach unglaublich! <br><br>  Die n√§chste Folie hei√üt "So setzen Sie einen Core-Dump zur√ºck".  Es zeigt das dumpCore-Programm, das ich gerade geschrieben habe und das gerade herausgekommen ist.  Sie k√∂nnen es herunterladen, es gibt den gesamten Quellcode.  Dieses Programm hilft Ihnen, wenn der Computer mit dem Coreflood-Virus infiziert ist, der aus irgendeinem Grund nicht zum Befehls- und Kontrollserver gelangen konnte, um die gestohlenen Daten herunterzuladen.  So k√∂nnen Sie diese Dateien, die er auf der Festplatte gespeichert hat, abrufen und mit meinem Programm entschl√ºsseln, um herauszufinden, was Ihnen gestohlen wurde, beispielsweise wenn Sie den Client dar√ºber informieren m√ºssen. <br><br>  Die Protokolle der gestohlenen Daten sind auf der Folie rot eingekreist. <br><br><img src="https://habrastorage.org/webt/xb/ib/c6/xbibc6gjkihoami36sqhcopedky.jpeg"><br><br>  Was in Coreflood immer noch interessant ist: Obwohl es einen ziemlich schwachen Verschl√ºsselungsalgorithmus hat, versucht es immer noch, alle gestohlenen Informationen √ºber die Computerkonfiguration des Opfers, alle Zielinformationen von Banken und Kreditgenossenschaften usw. zu √ºbertragen.  Eine andere M√∂glichkeit, einen Core-Dump zu entfernen, hei√üt "So entfernen Sie einen Core-Dump mit Wireshark".  Wireshark ist ein Programm, das den Ethernet-Netzwerkverkehr oder den TCP-Datenfluss analysiert. <br><br><img src="https://habrastorage.org/webt/ii/9h/4d/ii9h4d6emu0hiquq3xs1hxab78i.jpeg"><br><br>  Die folgende Folie zeigt, wie Coreflood funktioniert.  Dies sind DLLs, die in Explorer und Internet Explorer eingegeben werden.  Sie √§ndern die Registrierung, erfordern einen Neustart der Anwendung, erfordern jedoch keinen Neustart des Systems.  Es gibt verschiedene M√∂glichkeiten, diese DLLs in einen Prozess einzuf√ºgen. <br><br><img src="https://habrastorage.org/webt/ak/gk/hb/akgkhblgwmnu5tq_l2fcg7wrags.jpeg"><br><br>  Wichtig f√ºr Hacker, die unbemerkt in den Virus eindringen m√∂chten, ist, wie der Virus auf den Computer des Benutzers gelangt: Erfordert ein Neustart des Systems, damit die Malware Auswirkungen hat, oder reicht es aus, dass der Benutzer die Anwendung einfach neu startet, in diesem Fall den Explorer. <br><br>  Und jetzt ist es ruhig, so dass niemand h√∂ren kann! <br><br><img src="https://habrastorage.org/webt/yk/-q/97/yk-q97lw3wqjqp741oiik2yxudu.jpeg"><br><br>  Dies ist der Code, den wir mithilfe des Reverse Engineering rekonstruiert haben.  Dies zeigt, wie Coreflood den Explorer manuell herunterf√§hrt, damit die √Ñnderungen sofort wirksam werden.  Sie wissen wahrscheinlich, was passiert, wenn der Explorer auf dem Computer ausf√§llt - die Taskleiste verschwindet, die Fenster aller ge√∂ffneten Anwendungen, alle Symbole auf dem Desktop verschwinden und nacheinander kehren sie an ihren Platz zur√ºck. <br><br>  Die Autoren von Coreflood wussten offensichtlich davon und platzierten an dieser Stelle einen Systemaufruf, um den "richtigen" Fehlermodus des Dirigenten unmittelbar vor dem OpenProcess-Aufruf einzustellen. <br><br>  Was macht die SetErrorMode-Funktion?  Es verhindert einen bestimmten Fehler von an das System gesendeten Benachrichtigungen, die ein kleines Popup-Fenster erstellen und eine Fehlermeldung senden, die zum Beenden der Anwendung f√ºhrte.  Mit dieser Fehlermeldung wurde lediglich verhindert, dass dem Benutzer ein Popup-Fenster angezeigt wird, bevor der Explorer fehlschlug.  Sagen Sie mir, was f√ºr den Benutzer verd√§chtiger aussieht: ein kleines Popup-Fenster, das vom Verschwinden von allem begleitet wird, was auf dem Bildschirm angezeigt wird und dann wieder angezeigt wird, oder das Verschwinden und Erscheinen von allem ohne Fehlermeldung?  Ich habe geh√∂rt, Sie sagten: "Beide Ereignisse." <br><br>  Die n√§chste Folie rief ich "Mit Armen und Beinen, aber ohne Kopf."  Wenn Coreflood als DLL geladen wird, wird es nicht in der Liste der geladenen Module angezeigt.  Er ordnet dem Haufen ein wenig Speicher zu und kopiert sich an diesen Haufenplatz - ich habe ihn in einen roten Rahmen gesetzt. <br><br><img src="https://habrastorage.org/webt/ns/zf/em/nszfemfch9kulz_ualmhjd-5cf4.jpeg"><br><br>  Dann l√∂scht er seinen PE-Header. Wenn Sie also auf einen mit diesem Trojaner infizierten Computer sto√üen, sagen Sie: "Mein n√§chster Schritt sollte darin bestehen, diese ausf√ºhrbare Datei zu sichern und zur Analyse auf die IDA hochzuladen." Es ist jedoch sehr schwierig, die ausf√ºhrbare Datei zu sichern. Wenn es keinen PE-Header gibt.  Wenn Coreflood die virtuelle Zuweisung aufruft, definiert es das Mem-Flag von oben nach unten, wodurch das System die h√∂chste und nicht die niedrigste verf√ºgbare Adresse zur√ºckgibt.  Dadurch kann der Trojaner das √ñffnen / Schlie√üen von Anf√ºhrungszeichen in einem h√∂heren Speicherbereich des Benutzermodus unter anderen System-DLLs verbergen.  Daher rief ich in der n√§chsten Demo "Wie man alles, was verborgen ist, unbrauchbar macht". <br><br><img src="https://habrastorage.org/webt/wz/h8/1u/wzh81uifnp2xp6vl-xak505logk.jpeg"><br><br>  Wenn Sie auf etwas wie Coreflood sto√üen, das Stealth verwendet, und es keine vorgefertigten Tools f√ºr die Arbeit mit solchen Viren gibt, m√ºssen Sie Ihre eigenen erstellen. <br>  Wenn Sie mit dem Entpacken vertraut sind, ist die Verwendung eines Debuggers f√ºr Sie √ºblich.  Besonders wenn es keinen automatischen Entpacker gibt, da dies kein g√§ngiger Algorithmus ist.  In diesem Fall k√∂nnen Sie den Debugger verwenden, um zum urspr√ºnglichen Einstiegspunkt zu gelangen und dann den Dump des Trojaners mit ProcDump oder einem anderen Dienstprogramm zu entfernen.       PE     Import Reconstructor,  ,          ,     . <br><br>      ,    .           .       Volatility,       Internet Explorer  .    ,   Coreflood,       ,    .  ,      7FF81000. <br><br><img src="https://habrastorage.org/webt/-d/zw/9b/-dzw9b_qihk8hpoouzgomi3hv2c.jpeg"><br><br>       ,    HEX    ,     Coreflood.    ,      ,          .               . <br><br> ,     ,  Coreflood,       Volatility  .     ,     ID  Internet Explorer.     ,   ,   PID  1732.     Malfind,      ,      ,         ,   .          VAD  ,  ,     .    ,    . <br><br><img src="https://habrastorage.org/webt/aq/mg/_m/aqmg_mfa2sy70g_y-pk77lw-hek.jpeg"><br><br>   ,      ,      7FF81000. ,          Fix IAT,     PID 1732 Internet Explorer      ,   Coreflood. <br><br>     dll,    Internet Explorer,             ,   RBA ,    ,   . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anschlie√üend zerlegt er alle Informationen, beginnend im Speicherbereich bei 7FF81000, und sucht nach Systemaufrufen, die zu einer dieser exportierten Funktionen f√ºhren. </font><font style="vertical-align: inherit;">Somit wird die Tabelle der importierten Adressen auch ohne PE-Header neu erstellt. </font><font style="vertical-align: inherit;">Sie sehen, dass das von ihm ausgegebene Ergebnis dem Ergebnis von Import Reconstructor √§hnelt: Es gibt ein Modul, die erste Funktion und jede aus den Modulen importierte Funktion. </font><font style="vertical-align: inherit;">Die Ausgabe dieses Fix IAT-Skripts ist nicht ausf√ºhrbar. Sie k√∂nnen es also im PE-√Ñnderungs-Viewer √∂ffnen und dann feststellen, dass die Importtabelle erfolgreich wiederhergestellt wurde.</font></font><br><br><img src="https://habrastorage.org/webt/yz/9w/no/yz9wno8uv0z5jpt5922gwrhvofw.jpeg"><br><br>  21:15 <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEFCON-Konferenz 17. Lachen Sie √ºber Ihre Viren!</font></font></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 2</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/OeG4KBWB-EY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Vielen Dank f√ºr Ihren Aufenthalt bei uns.  Gef√§llt dir unser Artikel?  M√∂chten Sie weitere interessante Materialien sehen?  Unterst√ºtzen Sie uns, indem Sie eine Bestellung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aufgeben</a> oder Ihren Freunden empfehlen, einen <b>Rabatt von 30% f√ºr Habr-Benutzer auf ein einzigartiges Analogon von Einstiegsservern, das wir f√ºr Sie erfunden haben:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die ganze Wahrheit √ºber VPS (KVM) E5-2650 v4 (6 Kerne) 10 GB DDR4 240 GB SSD 1 Gbit / s von $ 20 oder wie teilt man den Server?</a>  (Optionen sind mit RAID1 und RAID10, bis zu 24 Kernen und bis zu 40 GB DDR4 verf√ºgbar). <br><br>  <b>VPS (KVM) E5-2650 v4 (6 Kerne) 10 GB DDR4 240 GB SSD 1 Gbit / s bis Dezember kostenlos,</b> wenn Sie f√ºr einen Zeitraum von sechs Monaten bezahlen, k√∂nnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> bestellen. <br><br>  <b>Dell R730xd 2 mal g√ºnstiger?</b>  Nur wir haben <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 GB DDR4 6 x 480 GB SSD 1 Gbit / s 100 TV von 249 US-Dollar</a> in den Niederlanden und den USA!</b>  Lesen Sie mehr √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Aufbau eines Infrastrukturgeb√§udes.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Klasse mit Dell R730xd E5-2650 v4 Servern f√ºr 9.000 Euro f√ºr einen Cent?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de428858/">https://habr.com/ru/post/de428858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de428848/index.html">Hinweise des IoT-Anbieters: Wie erstelle ich an einem Tag ein LoRa-Netzwerk in einer Stadt ohne Netzwerk?</a></li>
<li><a href="../de428850/index.html">Entwicklungsmanagement in einem gro√üen Projekt</a></li>
<li><a href="../de428852/index.html">Offene Sendung der Haupthalle HighLoad ++ 2018</a></li>
<li><a href="../de428854/index.html">So schalten Sie das Licht in einem kleinen Rechenzentrum aus: eine kosteng√ºnstige M√∂glichkeit, Notf√§lle einzusetzen</a></li>
<li><a href="../de428856/index.html">Ein wunderbarer Trick, um Open Source-Projektbetreuer zu einem Tag zu machen</a></li>
<li><a href="../de428860/index.html">DEFCON-Konferenz 17. Lachen Sie √ºber Ihre Viren! Teil 2</a></li>
<li><a href="../de428864/index.html">Lassen Sie uns das Web wieder gro√üartig machen</a></li>
<li><a href="../de428866/index.html">7 Designprinzipien, Einstellung zu Designtrends, UX-Designer-Portfolio, ...</a></li>
<li><a href="../de428868/index.html">Multi-Release-JARs - schlecht oder gut?</a></li>
<li><a href="../de428870/index.html">Mrr: Gesamt-FRP f√ºr React</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>