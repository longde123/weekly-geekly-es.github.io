<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÜüèª üë©‚Äçüë©‚Äçüë¶‚Äçüë¶ üå¶Ô∏è Entrenamos la red neuronal para jugar "Snake" y escribir un servidor para la competencia üéôÔ∏è üî§ üîä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Esta vez se selecciona el juego "Serpiente". 
- Se ha creado una biblioteca para la red Go. 
- Se encuentra el principio de aprendizaje, dependiendo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entrenamos la red neuronal para jugar "Snake" y escribir un servidor para la competencia</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451070/"><img src="https://habrastorage.org/webt/hw/lo/8l/hwlo8lzjxf08eebmebxewu9jgji.png"><br><br><ul><li>  Esta vez se selecciona el juego "Serpiente". </li><li>  Se ha creado una biblioteca para la red Go. </li><li>  Se encuentra el principio de aprendizaje, dependiendo de la "profundidad" de la memoria. </li><li>  Se ha escrito un servidor para el juego entre desarrolladores. </li></ul><a name="habracut"></a><br><h2>  La esencia del juego </h2><br>  Quiz√°s muchas personas recuerdan el juego "Snake", que era una aplicaci√≥n est√°ndar en los tel√©fonos Nokia.  Su esencia es esta: una serpiente se mueve por el campo, que disminuye si no encuentra comida, o aumenta si la encuentra.  Si una serpiente se estrella contra un obst√°culo, entonces muere. <br><br>  Cambi√© un poco las reglas: la serpiente no muere si se bloquea, sino que simplemente se detiene y contin√∫a disminuyendo.  Adem√°s, la serpiente se puede dividir por la mitad.  Si a la serpiente le queda una c√©lula en el cuerpo y no puede encontrar comida en 10 movimientos, entonces muere, convirti√©ndose en comida. <br><br>  Entrenaremos al bot que controla la serpiente.  Si la serpiente se divide, entonces el bot recibir√° otra serpiente en control, que a su vez tambi√©n puede dividirse. <br><br>  Se toma como base el experimento con las serpientes del ciberbi√≥logo Mikhail Tsarkov. <br><br><h2>  Red neuronal </h2><br>  Como parte de la tarea, se escribi√≥ una biblioteca para la red neuronal en el idioma Go.  Al estudiar el trabajo de la red neuronal, utilizo el diario de video <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">foo52ru</a> y el libro de Tariq Rashid - Crear una red neuronal. <br><br>  La funci√≥n <code>CreateLayer(L []int)</code> crea una red neuronal con el n√∫mero requerido de capas y su tama√±o.  En cada capa, excepto la √∫ltima, se agrega una neurona de desplazamiento.  Alimentamos datos a la primera capa, y obtenemos el resultado de la √∫ltima capa. <br><br>  Un ejemplo: <br><br><pre> <code class="go hljs">CreateLayer([]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>{<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">57</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>})</code> </pre> <br>  Aqu√≠ creamos una red neuronal con nueve entradas.  Dos capas ocultas de 57 y 3 neuronas y una neurona para obtener el resultado.  Las neuronas de desplazamiento se agregan autom√°ticamente por el plus a las que configuramos. <br><br>  La biblioteca te permite: <br><br><ul><li>  Enviar datos a la entrada de red. </li><li>  Obtenga el resultado accediendo a la √∫ltima capa. </li><li>  Pregunte las respuestas correctas y realice la capacitaci√≥n ajustando los pesos de los lazos. </li></ul><br>  Los pesos iniciales de los enlaces est√°n dados por valores aleatorios cercanos a cero.  Para la activaci√≥n, utilizamos la funci√≥n log√≠stica. <br><br><h2>  Entrenamiento bot </h2><br>  El bot recibe un campo cuadrado de 9x9 en la entrada, en el centro del cual est√° la cabeza de una serpiente.  En consecuencia, nuestra red neuronal tendr√° 81 entradas.  El orden de las celdas alimentadas a la entrada no importa.  Durante el entrenamiento, la red "lo resolver√°" por s√≠ misma, d√≥nde est√° ubicado. <br><br>  Para indicar obst√°culos y otras serpientes, utilic√© valores de -1 a 0 (no incluidos).  Las celdas vac√≠as se designaron con un valor de 0.01 y la comida 0.99. <br><br>  En la salida de la red neuronal, se utilizaron 5 neuronas para acciones: <br><br><ol><li>  moverse a la izquierda a lo largo del eje X; </li><li>  a la derecha </li><li>  arriba del eje y; </li><li>  abajo </li><li>  dividido por la mitad. </li></ol><br>  El movimiento del bot fue determinado por la neurona, que tiene el mayor valor en la salida. <br><br><h3>  Paso 0. Aleatorizador </h3><br>  Primero, se cre√≥ un aleatorizador bot.  Entonces llamo a un bot que camina al azar.  Es necesario verificar la efectividad de la red neuronal.  Con el entrenamiento adecuado, una red neuronal deber√≠a vencerlo f√°cilmente. <br><br><h3>  Paso 1. Aprender sin memoria </h3><br>  Despu√©s de cada movimiento, ajustamos los pesos de los enlaces para la neurona de salida que indica el valor m√°s alto.  No tocamos otras neuronas de salida. <br><br>  Se dieron los siguientes valores para el entrenamiento: <br><br><ul><li>  comida encontrada: 0.99 </li><li>  hizo un movimiento en cualquier direcci√≥n: 0.5 </li><li>  perdi√≥ una c√©lula del cuerpo sin encontrar comida (se dan 10 movimientos para esto): 0.2 </li><li>  se detiene (golpea un obst√°culo o se atasca): 0.1 </li><li>  de pie, con una c√©lula del cuerpo: 0.01 </li></ul><br>  Despu√©s de tal entrenamiento, los bots r√°pidamente comenzaron a vencer al aleatorizador, y configur√© la tarea: crear bots que los superen. <br><br><h4>  Pruebas A / B </h4><br>  Para realizar esta tarea, se cre√≥ un programa que divide las serpientes en dos partes, dependiendo de la configuraci√≥n de la red neuronal.  En el campo, se produjeron 20 serpientes de cada configuraci√≥n. <br><br>  Todas las serpientes controladas por un bot ten√≠an la misma red neuronal.  Cuantas m√°s serpientes en su gesti√≥n y m√°s a menudo se enfrentaron a diferentes tareas, el entrenamiento m√°s r√°pido tuvo lugar.  Si, por ejemplo, una serpiente aprendi√≥ a evitar puntos muertos o se parti√≥ por la mitad cuando lleg√≥ a un callej√≥n sin salida, entonces autom√°ticamente todas las serpientes de este robot adquirieron estas habilidades. <br><br>  Al cambiar la configuraci√≥n de la red neuronal, puede obtener buenos resultados, pero esto no es suficiente.  Para mejorar a√∫n m√°s el algoritmo, decid√≠ usar la memoria para varios movimientos. <br><br><h3>  Paso 2. Aprendiendo con memoria </h3><br>  Para cada bot, cre√© una memoria para 8 movimientos.  El estado del campo y el movimiento que sugiri√≥ el bot se registraron en la memoria.  Despu√©s de eso, hice ajustes a los pesos de los ocho estados que precedieron al movimiento.  Para esto, utilic√© un √∫nico factor de correcci√≥n, independiente de la profundidad de viaje.  Por lo tanto, cada movimiento llev√≥ al ajuste de los pesos no una vez, sino ocho. <br><br>  Como se esperaba, los bots de memoria comenzaron a vencer r√°pidamente a los bots que entrenaron sin memoria. <br><br><h3>  Paso 3. Disminuci√≥n del coeficiente de correcci√≥n dependiendo de la profundidad de la memoria </h3><br>  Luego, trat√© de reducir el factor de correcci√≥n, dependiendo de la profundidad de la memoria.  Para el √∫ltimo movimiento realizado, se estableci√≥ el coeficiente m√°s grande para ajustar los pesos.  En el curso que lo precedi√≥, el factor de correcci√≥n disminuy√≥ y as√≠ sucesivamente en toda la memoria. <br><br><img src="https://habrastorage.org/webt/e6/0f/cb/e60fcbmlddlafl3eocr4dxmxx6a.png"><br><br>  Una disminuci√≥n lineal en el coeficiente de correcci√≥n dependiendo de la profundidad de la memoria condujo al hecho de que los nuevos robots comenzaron a vencer a aquellos que usaban un solo coeficiente. <br><br>  Luego, trat√© de usar la reducci√≥n logar√≠tmica del factor de correcci√≥n.  El coeficiente disminuy√≥ a la mitad, dependiendo de la profundidad de la memoria para cada movimiento.  Por lo tanto, los movimientos que se hicieron "hace mucho tiempo" tuvieron un impacto significativamente menor en el aprendizaje que los movimientos "nuevos". <br><br>  Los bots con una reducci√≥n logar√≠tmica en el coeficiente de correcci√≥n comenzaron a derrotar a los bots con una relaci√≥n lineal. <br><br><h2>  Servidor para bots </h2><br>  Al final result√≥ que, mejorar el nivel de bots de "bombeo" puede ser infinito.  Y decid√≠ crear un servidor donde los desarrolladores pudieran competir entre s√≠ (independientemente del lenguaje de programaci√≥n) al escribir un algoritmo efectivo para Snakes. <br><br><h3>  Protocolo </h3><br>  Para la autorizaci√≥n, debe enviar una solicitud GET al directorio "juego" y especificar un nombre de usuario, por ejemplo: <br><br><pre> <code class="xml hljs">.../game/?user=masterdak</code> </pre> <br>  En lugar de "..." debe especificar la direcci√≥n del sitio y el puerto donde se implementa el servidor. <br><br>  A continuaci√≥n, el servidor emitir√° una respuesta en formato JSON que indica la sesi√≥n: <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"answer"</span></span>:<span class="hljs-string"><span class="hljs-string">"Hellow, masterdak!"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"session"</span></span>:<span class="hljs-string"><span class="hljs-string">"f4f559d1d2ed97e0616023fb4a84f984"</span></span>}</code> </pre> <br>  Despu√©s de eso, puede solicitar un mapa y las coordenadas de la serpiente en el campo, agregando una sesi√≥n a la solicitud: <br><br><pre> <code class="xml hljs">.../game/?user=masterdak&amp;session=f4f559d1d2ed97e0616023fb4a84f984</code> </pre> <br>  El servidor mostrar√° algo como esto: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"answer"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sent game data."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"area"</span></span>: [ [<span class="hljs-string"><span class="hljs-string">"...  ..."</span></span>] ], <span class="hljs-attr"><span class="hljs-attr">"snakes"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"num"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"body"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-attr"><span class="hljs-attr">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-attr"><span class="hljs-attr">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-attr"><span class="hljs-attr">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"energe"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dead"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } ] } }</code> </pre><br>  El campo de <b>√°rea</b> indicar√° el estado del campo de juego con los siguientes valores: <br><br><pre> <code class="go hljs"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">//  -1 // -2 // 2 //  1 // </span></span></code> </pre><br>  Esto ser√° seguido por una matriz con serpientes que est√°n bajo su control. <br><br>  El cuerpo de la serpiente est√° en la matriz del <b>cuerpo</b> .  Como puede ver, todo el cuerpo de la serpiente (incluida la cabeza, la primera celda) al principio est√° en la misma posici√≥n "x": 19, "y": 24. Esto se debe al hecho de que al comienzo del juego las serpientes salen del hoyo, que est√° definido por una celda en el campo .  Adem√°s, las coordenadas del cuerpo y la cabeza ser√°n diferentes. <br><br>  Las siguientes estructuras (un ejemplo en Go) definen todas las opciones de respuesta del servidor: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> respData <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Answer <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Session <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Data <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Area [][]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Snakes []<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Num <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Body []Cell Energe <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Dead <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> } } } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Cell <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { X <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Y <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> }</code> </pre><br>  A continuaci√≥n, debe enviar el movimiento que realiza la serpiente agregando <b>movimiento</b> a la solicitud GET, por ejemplo: <br><br><pre> <code class="xml hljs">...&amp;move=u</code> </pre> <br>  <b>u</b> - significa comando arriba; <br>  <b>d</b> - abajo; <br>  <b>l</b> - a la izquierda; <br>  <b>r</b> - a la derecha; <br>  <b>/</b> - reducir a la mitad. <br><br>  El comando para varias serpientes (por ejemplo, para siete) se ver√° as√≠: <br><br><pre> <code class="xml hljs">...&amp;move=ud/urld</code> </pre> <br>  Un personaje, un equipo.  La respuesta debe contener un comando para todas las serpientes que est√°n bajo su control.  De lo contrario, algunas serpientes pueden no recibir un comando y continuar√°n la acci√≥n anterior. <br><br>  El campo se actualiza a intervalos de 150 ms.  Si no se recibe ning√∫n comando dentro de los 60 segundos, el servidor cerrar√° la conexi√≥n. <br><br><h2>  Referencias </h2><br>  Para evitar el efecto habrae, para aquellos que est√©n interesados ‚Äã‚Äãen ver, env√≠eme un mensaje.  En respuesta, enviar√© la direcci√≥n IP de mi servidor.  O puede implementar su servidor utilizando el c√≥digo fuente del programa. <br><br>  No soy especialista en programaci√≥n ni en redes neuronales.  Por lo tanto, puedo cometer errores.  Difund√≠ el c√≥digo "tal cual".  Me gustar√≠a que desarrolladores m√°s experimentados mostraran los errores cometidos. <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Biblioteca para la red neuronal junto con el juego "Tic Tac Toe"</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Snake Master - Servidor</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Snake Master - Bot</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Snakeworld2</a> </li></ol><br><br>  <b>UPD</b> <br>  Cargue temporalmente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la direcci√≥n IP del servidor</a> .  Ahora solo se lanza un aleatorizador bot (SnakeBot0) all√≠.  Espero que el servidor no se cuelgue tan r√°pido. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/451070/">https://habr.com/ru/post/451070/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451058/index.html">Taller corporativo</a></li>
<li><a href="../451060/index.html">El dispositivo InSight envi√≥ una segunda selfie desde Marte</a></li>
<li><a href="../451062/index.html">Cr√°teres de meteoros en la Tierra y en el espacio.</a></li>
<li><a href="../451066/index.html">Desmontamos el final de "Alien"</a></li>
<li><a href="../451068/index.html">Acelerando el lanzamiento de Julia con PackageCompiler.jl</a></li>
<li><a href="../451074/index.html">PIL en Python de f√°cil a dif√≠cil</a></li>
<li><a href="../451078/index.html">laboratorios indibiome</a></li>
<li><a href="../451082/index.html">Personalizaci√≥n del sonido: "lentes" de metamaterial para controlar el campo de sonido</a></li>
<li><a href="../451084/index.html">.NET zoo bajo el prisma de NET Core</a></li>
<li><a href="../451086/index.html">Revisi√≥n completa de Oculus Rift S</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>