<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐼 🐯 🦌 CRDT：无冲突的复制数据类型 🏚️ 🧑🏾‍🤝‍🧑🏻 🔽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="如何计算google.com页面点击量？ 以及如何存储非常受用户喜欢的计数器？ 本文建议考虑使用CRDT（无冲突的复制数据类型，在俄语中大致翻译为无冲突的复制数据类型）来解决这些问题，在更一般的情况下，是使用具有多个主节点的分布式系统中的副本同步任务。 

 1.简介 
 长期以来，我们习惯于使用诸...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CRDT：无冲突的复制数据类型</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418897/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/r1/we/lm/r1welma_rgaxinwrbp7ekni1tdo.png"></div><br> 如何计算google.com页面点击量？ 以及如何存储非常受用户喜欢的计数器？ 本文建议考虑使用CRDT（无冲突的复制数据类型，在俄语中大致翻译为无冲突的复制数据类型）来解决这些问题，在更一般的情况下，是使用具有多个主节点的分布式系统中的副本同步任务。 <br><a name="habracut"></a><br><h1>  1.简介 </h1><br> 长期以来，我们习惯于使用诸如日历之类的应用程序或诸如Evernote之类的便笺服务。 它们的结合是，它们使您可以脱机工作，从多个设备同时到多个人（在同一数据上）。 每个这样的应用程序的开发人员面临的挑战是如何确保在多个设备上同时更改的数据的“最流畅”同步。 理想情况下，根本不需要用户参与即可解决合并冲突。 <br><br> 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上一篇文章中，我们</a>已经考虑了一种解决此类问题的方法-操作转换，还将描述一种既有优点又有缺点的非常相似的方法（例如，尚未发明<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">CRDT</a> for <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">JSON。Upd</a> ：感谢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">msvn</a>的链接，这里<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这是</a>研究文章作者关于CRDT中JSON的实现的项目） <br><br><h1>  2.强大的最终一致性 </h1><br> 最近，在最终一致性领域已经进行了很多工作，并进行了大量研究。 以我的观点，现在有一个趋势，即从强一致性转向各种一致性选项，研究在哪种情况/系统中应用哪种一致性更有利可图，以重新考虑现有定义。 例如，当某些作品的作者谈论一致性，最终具有某些其他属性的一致性，而其他作者为此使用某些术语时，这会引起混乱。 <br><br> 其中一篇文章的作者提出的问题批评了最终一致性的当前定义：据此，如果您的系统始终对所有请求都回答“ 42”，那么一切正常，最终是一致的。 <br><br> 在不违背本文正确性的前提下，我跟随原始文章的作者，使用以下术语（请注意，这些不是严格的定义，是不同的）： <br><br><ul><li> 强一致性（SC）：所有写入操作均严格排序，任何副本上的读取请求均返回相同的最后记录结果。  <b>需要实时</b>共识来解决冲突（以及随之而来的后果），并且可以承受下降到n / 2-1个节点的风险。 </li><li> 最终一致性（EC）：在本地更新数据，然后进一步发送更新。 在不同的副本上进行读取可以返回陈旧的数据。 如果发生冲突，我们要么回滚，要么以某种方式决定要做什么。  T.O. 仍然需要达成共识，但<b>不再是实时的</b> 。 </li><li> 强大的最终一致性（SEC）：EC +用于解决冲突，副本具有预定义的算法。  T.O.  <b>不需要共识</b> ；它可以承受n-1个节点的下降。 </li></ul><br> 请注意，SEC（照原样）解决了CAP定理的问题：满足了所有三个属性。 <br><br> 因此，我们准备捐赠SC，并希望为我们潜在不稳定的分布式系统提供一组特定的基本数据类型，这些数据类型将自动为我们解决写入冲突（不需要用户交互或请求仲裁者） <br><br><h1>  3.关于喜欢和点击的任务 </h1><br> 毫无疑问，有几种算法可以解决此类问题。  CRDT提供了一种相当优雅和简便的方法。 <br><br><h3>  Google.com命中数： </h3><br>  google.com每秒大约处理来自世界各地的150,000个请求。 显然，计数器需要异步更新。 队列部分地解决了这个问题-例如，如果我们提供一个外部API来获取此值，那么我们将必须进行复制，以免将存储库置于读取请求中。 如果已经存在复制，也许没有全局队列？ <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/wv/4y/tn/wv4ytnmej1xm2tbhen3ddztgv6w.png" alt="图片"></div><br><br><h3> 计算用户点赞次数： </h3><br> 该任务与上一个任务非常相似，只是现在您需要计算唯一点击数。 <br><br><h1>  4.术语 </h1><br> 为了更全面地了解本文，您需要了解以下术语： <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">幂等</a> <br> 说多次应用操作不会改变结果。 <br> 示例-GET操作或零加法： <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>f</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mo>=</mo><mi>x</mi><mo>+</mo><mn>0</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.895ex" height="2.419ex" viewBox="0 -780.1 6413 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-66" x="0" y="0"></use><g transform="translate(550,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-78" x="1380" y="0"></use><g transform="translate(1952,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-3D" x="3060" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-78" x="4117" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-2B" x="4911" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-30" x="5912" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mo>=</mo><mi>x</mi><mo>+</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-1"> f（x）= x + 0 </script><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">可交换性</a> <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>f</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mo>=</mo><mi>f</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.192ex" height="2.419ex" viewBox="0 -780.1 9555 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-66" x="0" y="0"></use><g transform="translate(550,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-78" x="1380" y="0"></use><g transform="translate(1952,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-79" x="2782" y="0"></use><g transform="translate(3280,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-3D" x="4388" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-66" x="5444" y="0"></use><g transform="translate(5995,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-79" x="6824" y="0"></use><g transform="translate(7322,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-78" x="8152" y="0"></use><g transform="translate(8724,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mo>=</mo><mi>f</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-2"> f（x，y）= f（y，x）</script><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">偏序</a> <br> 自反性+传递性+反对称 <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">半格</a> <br> 部分排序的集合具有准确的上（下）面 <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">版本向量</a> <br> 维向量等于节点数，并且每个节点在发生特定事件时会在向量中增加其值。 在同步期间，将使用此向量传输数据，这将引入顺序关系，从而使您可以确定哪个副本具有旧/新数据。 </li></ol><br><h1>  5.同步模型 </h1><br><h3> 基于州： </h3><br> 也称为被动同步，它形成了聚合复制数据类型-CvRDT。 <br> 它用于NFS，AFS，Coda等文件系统以及KV存储Riak，Dynamo中 <br> 在这种情况下，副本直接交换状态，接收副本将接收到的状态与其当前状态合并。 <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/ac/r_/7b/acr_7blhm_vkl7rwgfenmjpvdus.png" alt="图片"></div><br> 要使用此同步执行副本的收敛，必须： <br><br><ul><li> 数据形成半格 </li><li> 合并功能产生了确切的上限 </li><li> 复制品形成了一个连通图。 </li></ul><br> 一个例子： <br><br><ul><li> 数据集：自然数 <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.088ex" height="2.057ex" viewBox="0 -780.1 4343.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-62" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-62" x="3025" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-4E" x="3455" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3"> \ mathbb {N} </script></li><li> 最低要求： <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mi>f</mi><mi>t</mi><mi>y</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.86ex" height="2.419ex" viewBox="0 -780.1 3384 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-2212" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="1028" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6E" x="1374" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-66" x="1974" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-74" x="2525" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-79" x="2886" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>f</mi><mi>t</mi><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-4">-\ infty </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5408;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5E76;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mo>=</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x6700;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5927;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x503C;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="29.274ex" height="2.419ex" viewBox="0 -780.1 12603.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">合</text><g transform="translate(829,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">并</text></g><g transform="translate(1659,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-78" x="2489" y="0"></use><g transform="translate(3062,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-79" x="3892" y="0"></use><g transform="translate(4389,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-3D" x="5497" y="0"></use><g transform="translate(6553,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">最</text></g><g transform="translate(7383,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">大</text></g><g transform="translate(8213,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">值</text></g><g transform="translate(9043,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-78" x="9873" y="0"></use><g transform="translate(10446,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-79" x="11276" y="0"></use><g transform="translate(11773,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo>合</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>并</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mo>最</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>大</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>值</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-5">合并（x，y）=最大值（x，y）</script></li></ul><br> 这些要求为我们提供了一个<b>交换</b>和<b>幂等</b>合并函数，该函数在给定数据集上<b>单调增长</b> ： <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/jn/nw/vl/jnnwvlfp_tjkank2zknwdcbj-oc.png" alt="图片"></div><br> 这样可以确保副本早晚收敛，并且使您不必担心数据传输协议- <b>我们可能会丢失具有新状态的消息，将它们发送几次，甚至可以以任何顺序发送</b> 。 <br><br><h3> 基于操作： </h3><br> 也称为主动同步，它形成交换复制数据类型-CmRDT。 <br> 用于协作系统，如Bayou，Rover，IceCube，Telex。 <br><br> 在这种情况下，副本交换状态更新操作。 更新数据时，原始副本： <br><br><ul><li> 调用generate（）方法，该方法返回effector（）方法以在其余副本上执行。 换句话说，效果器（）是用于更改其余副本状态的闭包。 </li><li> 将效应器应用于本地状态 </li><li> 将效应器发送到所有其他副本 </li></ul><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/bd/i3/ps/bdi3pshr57wi0udnldnurhcdpfs.png" alt="图片"></div><br> 要执行副本的收敛，必须满足以下条件： <br><br><ul><li> 可靠的传送协议 </li><li> 如果效应器按照输入的顺序（对于给定类型）交付给所有副本，则同时效应器是可交换的， <b>或者</b> </li><li> 如果效应器在不考虑顺序的情况下交付给所有副本，则所有效应器都是可交换的。 </li><li> 如果效应子可以多次传递，则它必须是幂等的 </li><li> 一些实现使用队列（Kafka）作为传递协议的一部分。 </li></ul><br><h3> 基于增量的： </h3><br> 考虑到基于状态/操作，很容易注意到，如果更新仅更改部分状态，则发送整个状态是没有意义的；如果大量更改影响一个状态（例如，计数器），则可以发送一个汇总更改，而不是所有操作变化。 <br><br> 增量同步结合了这两种方法，并发出增量变量，这些变量会根据最新的同步日期更新状态。 在初始同步时，有必要完全发送状态，并且在此类情况下，某些实现在构造增量变量时已经考虑了其余副本的状态。 <br><br> 如果允许延迟，则下一个优化方法是压缩基于op的日志。 <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/rd/vi/a5/rdvia5kv708z55ndt_t5j_leaum.png" alt="图片"></div><br><h3> 基于纯操作： </h3><br> 在基于op的同步中创建opector会有延迟。 在某些系统中，这可能是不可接受的，然后您必须发送原始更改，但要付出复杂的协议和额外的元数据量的代价。 <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/3l/p2/r2/3lp2r2ruizjddxllrwgbgwh5ykw.png" alt="图片"></div><br><h3> 标准使用方法： </h3><br><ul><li> 如果<b>要立即</b>在系统中<b>发送</b>更新，则基于状态将是一个糟糕的选择，因为发送整个状态比仅进行更新操作要昂贵。 基于增量的效果更好，但是在这种特殊情况下，与基于状态的差异很小。 </li><li> 如果您需要<b>在失败后同步副本</b> ，那么基于状态和基于增量的是最佳选择。 如果必须使用基于op的选项，则选项为： <br><br>  1）从失败时刻开始滚动所有错过的操作 <br>  2）副本之一的完整副本，并回滚丢失的操作 </li><li> 如上所述，基于op的更新要求准确地交付给每个副本一次。 如果效应子是幂等的，则仅可以省略一次交货要求。 在实践中，实施第一种方法要比第二种方法容易得多。 </li></ul><br><h3> 基于Op和基于State之间的关系： </h3><br> 可以互相模拟两种方法，因此将来我们将在不参考任何特定同步模型的情况下考虑CRDT。 <br><br><h1>  6. CRDT </h1><br><h2>  6.1柜台 </h2><br> 支持两个操作的整数：inc和dec。 例如，考虑基于op的同步和基于状态的同步的可能实现： <br><br><h3> 基于操作数的计数器： </h3><br> 显然，仅发送更新即可。  inc的示例： <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> function (counter) { counter += <span class="hljs-number"><span class="hljs-number">1</span></span> } }</code> </pre> <br><h3> 基于状态的计数器： </h3><br> 由于不清楚合并功能的外观，因此实现不再那么明显。 <br><br> 考虑以下选项： <br><br>  <u>单调递增计数器（仅递增计数器，G计数器）：</u> <br><br> 数据将被存储为尺寸等于节点数的矢量（版本矢量），并且每个副本将使用其id增大位置值。 <br><br> 合并函数将在相应位置取最大值，最终值为向量中所有元素的总和 <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>g</mi><mi>i</mi><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>a</mi><mi>l</mi><mi>i</mi><mi>g</mi><mi>n</mi></mrow><mi>i</mi><mi>n</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF06;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF1A;</mo></mrow><mi>V</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mo stretchy=&quot;false&quot;>]</mo><mo>=</mo><mi>V</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mo stretchy=&quot;false&quot;>]</mo><mo>+</mo><mn>1</mn><mspace linebreak=&quot;newline&quot; /><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF06;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF1A;</mo></mrow><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi></mrow></msubsup><mi>V</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mspace linebreak=&quot;newline&quot; /><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5408;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5E76;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><msub><mi>C</mi><mn>1</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>C</mi><mn>2</mn></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF06;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF1A;</mo></mrow><mo stretchy=&quot;false&quot;>[</mo><mn>1..</mn><mi>n</mi><mo stretchy=&quot;false&quot;>]</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x4E2D;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x7684;</mo></mrow><mi>i</mi><mtext mathcolor=&quot;red&quot;>\&amp;#x7ED3;</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x679C;</mo></mrow><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>=</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x6700;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5927;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x503C;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><msub><mi>C</mi><mn>1</mn></msub><mo>.</mo><mi>V</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>C</mi><mn>2</mn></msub><mo>.</mo><mi>V</mi><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mtext mathcolor=&quot;red&quot;>\&amp;#x7ED3;</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x675F;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>a</mi><mi>l</mi><mi>i</mi><mi>g</mi><mi>n</mi></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="76.867ex" height="9.527ex" viewBox="0 -832 33095.6 4102" role="img" focusable="false" style="vertical-align: -7.595ex; max-width: 638px;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(6400,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-67" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="1626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6E" x="1972" y="0"></use><g transform="translate(2572,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-61" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6C" x="529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-67" x="1173" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6E" x="1654" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="4827" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6E" x="5172" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-63" x="5773" y="0"></use><g transform="translate(6206,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(7036,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><g transform="translate(7866,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">＆</text></g><g transform="translate(8696,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">：</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-56" x="9526" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5B" x="10295" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="10574" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-64" x="10919" y="0"></use><g transform="translate(11443,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(12273,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5D" x="13103" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-3D" x="13659" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-56" x="14715" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5B" x="15485" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="15763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-64" x="16109" y="0"></use><g transform="translate(16632,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(17462,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5D" x="18292" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-2B" x="18793" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-31" x="19794" y="0"></use></g><g transform="translate(11165,-1433)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-76" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-61" x="485" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6C" x="1015" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-75" x="1313" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-65" x="1886" y="0"></use><g transform="translate(2352,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(3182,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><g transform="translate(4012,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">＆</text></g><g transform="translate(4842,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">：</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-73" x="5922" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-75" x="6391" y="0"></use><g transform="translate(6964,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6E" x="1242" y="499"></use><g transform="translate(878,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-30" x="1124" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-56" x="9091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5B" x="9861" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="10139" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5D" x="10485" y="0"></use></g><g transform="translate(180,-2938)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">合</text><g transform="translate(829,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">并</text></g><g transform="translate(1659,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(2489,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-31" x="1011" y="-213"></use></g><g transform="translate(3659,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(4489,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-32" x="1011" y="-213"></use></g><g transform="translate(5658,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><g transform="translate(6488,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">＆</text></g><g transform="translate(7318,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">：</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5B" x="8148" y="0"></use><g transform="translate(8427,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-2E" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6E" x="9484" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5D" x="10085" y="0"></use><g transform="translate(10363,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">中</text></g><g transform="translate(11193,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">的</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="12023" y="0"></use><g fill="red" stroke="red" transform="translate(12369,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">结</text></g></g><g transform="translate(13699,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">果</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5B" x="14529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="14808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5D" x="15153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-3D" x="15709" y="0"></use><g transform="translate(16766,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">最</text></g><g transform="translate(17596,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">大</text></g><g transform="translate(18426,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">值</text></g><g transform="translate(19256,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(20086,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-31" x="1011" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-2E" x="21255" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-56" x="21700" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5B" x="22470" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="22748" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5D" x="23094" y="0"></use><g transform="translate(23372,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(24202,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-32" x="1011" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-2E" x="25372" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-56" x="25817" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5B" x="26586" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="26865" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5D" x="27210" y="0"></use><g transform="translate(27489,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><g fill="red" stroke="red" transform="translate(28319,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">结</text></g></g><g transform="translate(29649,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">束</text></g><g transform="translate(30479,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-61" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6C" x="529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-69" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-67" x="1173" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhg8WIGaAxUqWMxbCldLIC-4gM53Xw#MJMATHI-6E" x="1654" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>g</mi><mi>i</mi><mi>n</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi><mi>l</mi><mi>i</mi><mi>g</mi><mi>n</mi></mrow><mi>i</mi><mi>n</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>＆</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>：</mo></mrow><mi>V</mi><mo stretchy="false">[</mo><mi>i</mi><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mo stretchy="false">]</mo><mo>=</mo><mi>V</mi><mo stretchy="false">[</mo><mi>i</mi><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mo stretchy="false">]</mo><mo>+</mo><mn>1</mn><mspace linebreak="newline"></mspace><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>＆</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>：</mo></mrow><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>n</mi></mrow></msubsup><mi>V</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mspace linebreak="newline"></mspace><mrow class="MJX-TeXAtom-ORD"><mo>合</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>并</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><msub><mi>C</mi><mn>1</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>C</mi><mn>2</mn></msub><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>＆</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>：</mo></mrow><mo stretchy="false">[</mo><mn>1..</mn><mi>n</mi><mo stretchy="false">]</mo><mrow class="MJX-TeXAtom-ORD"><mo>中</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>的</mo></mrow><mi>i</mi><mtext mathcolor="red">\结</mtext><mrow class="MJX-TeXAtom-ORD"><mo>果</mo></mrow><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mo>最</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>大</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>值</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><msub><mi>C</mi><mn>1</mn></msub><mo>.</mo><mi>V</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>C</mi><mn>2</mn></msub><mo>.</mo><mi>V</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mtext mathcolor="red">\结</mtext><mrow class="MJX-TeXAtom-ORD"><mo>束</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>a</mi><mi>l</mi><mi>i</mi><mi>g</mi><mi>n</mi></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> \ begin {align} inc（）＆：V [id（）] = V [id（）] + 1 \\ value（）＆：\ sum_ {i = 0} ^ {n} V [i] \\合并（C_1，C_2）＆：[1..n]中的i \结果[i] =最大值（C_1.V [i]，C_2.V [i]）\结束{align} </script></p><br> 您也可以使用G套件（见下文） <br><br> 应用范围： <br><br><ul><li> 计算点击次数/点击数（原文如此！） </li></ul><br>  <u>带减量支持的计数器（PN计数器）</u> <br><br> 我们启动两个G计数器-一个用于递增操作，第二个-用于递减 <br><br> 应用范围： <br><br><ul><li>  p2p网络（例如Skype）中已登录的用户数 </li></ul><br>  <u>非负计数器</u> <br><br> 尚不存在简单的实现。 在评论中提出您的想法，进行讨论。 <br><br><h2>  6.2注册 </h2><br> 具有两种操作的存储单元-分配（写）和值（读）。 <br> 问题是分配不是可交换的。 有两种方法可以解决此问题： <br><br><h3> 最后写胜寄存器（LWW寄存器）： </h3><br> 我们通过为每个操作生成唯一ID（例如时间戳）来输入完整订单。 <br><br> 同步的一个示例是对（值，id）的交换： <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/rw/8m/1k/rw8m1k8wgby7v0gczcthhdmdvns.png"></div><br> 应用范围： <br><br><ul><li> 卡桑德拉中的列 </li><li>  NFS-全部或部分文件 </li></ul><br><h3> 用多个值注册（多值寄存器，MV寄存器）： </h3><br> 该方法类似于G计数器-我们存储集合（值，版本向量）。 寄存器值-合并时的所有值-向量中每个值的LWW分别。 <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/o3/kr/vc/o3krvcuowzsa-vi_avn27jcscxk.png"></div><br> 应用范围： <br><br><ul><li> 在亚马逊的篮子。 与此相关联的是一个众所周知的错误，当从购物篮中删除一个项目后，它再次出现在那里。 原因是尽管寄存器存储了一组值，但它不是一组值（请参见下图）。 顺便说一句，亚马逊甚至都不认为这是一个错误-实际上，它可以增加销量。 </li><li> 子 在更一般的情况下，我们将选择实际（注意-没有冲突！）值的问题转移给应用程序。 </li></ul><br> 亚马逊错误的解释： <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/k0/au/le/k0auleq-jjcrfdtkdswe8tfdxnq.png"></div><br><br><h2>  6.3手 </h2><br> 该集合是构造容器，地图和图形的基本类型，并支持操作-添加和rmv，这是不可交换的。 <br><br> 考虑一下基于op的集合的朴素实现，其中add和rmv在到达时执行（add同时到达1和2个副本，然后rmv到达1） <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/yk/uu/3b/ykuu3b4-brgkjj2p4y32gmytafs.png"></div><br> 如您所见，副本最终分散了。 考虑构造无冲突集的各种选项： <br><br><h3> 生长套装（G-套装）： </h3><br> 最简单的解决方案是防止项目被删除。 剩下的就是加法运算，它是可交换的。 合并功能是集合的并集。 <br><br><h3> 两相装置（2P装置）： </h3><br> 我们允许您删除，但删除后无法再次添加。 为了实现，我们设置了单独的一组远程G-set元素（这样的集合称为逻辑删除集） <br> 基于状态的示例： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\&amp;#x5F00;&amp;#x59CB;{align}&amp;#x67E5;&amp;#x627E;&amp;#xFF08;e&amp;#xFF09;&amp;#xFF06;&amp;#xFF1A;e&amp;#xA0;\&amp;#x5728;A&amp;#xA0;\&amp;#xA0;land&amp;#xA0;e&amp;#xA0;\&amp;#xA0;notin&amp;#xA0;R&amp;#xA0;\\&amp;#x52A0;&amp;#xFF08;e&amp;#xFF09;&amp;#xFF06;&amp;#xFF1A;A&amp;#xA0;=&amp;#xA0;A&amp;#xA0;\&amp;#xA0;cup&amp;#xA0;\&amp;#xA0;{e&amp;#xA0;\}&amp;#xA0;\\&amp;#xA0;rmv&amp;#xFF08;e&amp;#xFF09;&amp;#xFF06;&amp;#xFF1A;R&amp;#xA0;=&amp;#xA0;R&amp;#xA0;\&amp;#xA0;cup&amp;#xA0;\&amp;#xA0;{e&amp;#xA0;\}&amp;#xA0;\\&amp;#x5408;&amp;#x5E76;&amp;#xFF08;S_1&amp;#xFF0C;S_2&amp;#xFF09;&amp;#xFF06;&amp;#xFF1A;\\&amp;#xA0;Res&amp;#xFF06;ult.A&amp;#xA0;=&amp;#xA0;S_1.A&amp;#xA0;\&amp;#xA0;cup&amp;#xA0;S_2.A&amp;#xA0;\\&amp;#xA0;Res&amp;#xFF06;ult.R&amp;#xA0;=&amp;#xA0;S_1.R&amp;#xA0;\&amp;#xA0;cup&amp;#xA0;S_2.R&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{align}</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">\开始{align}查找（e）＆：e&nbsp;\在A&nbsp;\&nbsp;land&nbsp;e&nbsp;\&nbsp;notin&nbsp;R&nbsp;\\加（e）＆：A&nbsp;=&nbsp;A&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\&nbsp;rmv（e）＆：R&nbsp;=&nbsp;R&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\合并（S_1，S_2）＆：\\&nbsp;Res＆ult.A&nbsp;=&nbsp;S_1.A&nbsp;\&nbsp;cup&nbsp;S_2.A&nbsp;\\&nbsp;Res＆ult.R&nbsp;=&nbsp;S_1.R&nbsp;\&nbsp;cup&nbsp;S_2.R&nbsp;\&nbsp;end&nbsp;{align}</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>\开始{align}查找（e）＆：e&nbsp;\在A&nbsp;\&nbsp;land&nbsp;e&nbsp;\&nbsp;notin&nbsp;R&nbsp;\\加（e）＆：A&nbsp;=&nbsp;A&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\&nbsp;rmv（e）＆：R&nbsp;=&nbsp;R&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\合并（S_1，S_2）＆：\\&nbsp;Res＆ult.A&nbsp;=&nbsp;S_1.A&nbsp;\&nbsp;cup&nbsp;S_2.A&nbsp;\\&nbsp;Res＆ult.R&nbsp;=&nbsp;S_1.R&nbsp;\&nbsp;cup&nbsp;S_2.R&nbsp;\&nbsp;end&nbsp;{align}</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-7"> \开始{align}查找（e）＆：e \在A \ land e \ notin R \\加（e）＆：A = A \ cup \ {e \} \\ rmv（e）＆：R = R \ cup \ {e \} \\合并（S_1，S_2）＆：\\ Res＆ult.A = S_1.A \ cup S_2.A \\ Res＆ult.R = S_1.R \ cup S_2.R \ end {align} </script></p><br><h3>  LWW元素集： </h3><br> 实现无冲突集的另一种方法是引入一个完整的顺序，一种选择是为每个元素生成唯一的时间戳。 <br><br> 我们得到两个集合-add-set和remove-set，当调用add（）时，添加（element，unique_id（）），检查集合中是否有元素-查看时间戳更大的位置-在remove-set或add-set中 <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/iw/gt/95/iwgt95jsuu9xps80j0w-sjgweq4.png"></div><br><h3>  PN集： </h3><br> 集合顺序的变化-我们为每个元素启动一个计数器，添加它时我们增加它，删除它时我们就减少它。 如果元素的计数器为正，则该元素在集合中。 <br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/nf/qz/dw/nfqzdwf7risphmn8qyuq0tsjc3s.png"></div><br> 注意有趣的效果-在第三个副本中，添加元素不会导致其外观。 <br><br><h3> 观察删除集，或集，加赢集： </h3><br> 在这种类型中，添加优先于删除。 实现示例：为每个新添加的元素分配一个唯一的标签（相对于该元素，而不是整个集合）。  Rmv从集合中删除一个元素，并将所有可见对（元素，标签）发送到副本以进行删除。 <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/5n/ac/1l/5nac1lanif5y_kh_w9rvaz-jqoe.png"></div><br><br><h3> 赢双赢组合： </h3><br> 与上一个相似，但同时添加/ rmv rmv wins。 <br><br><h2>  6.4图 </h2><br> 这种类型是建立在许多基础上的。 问题是这样的：如果同时执行addEdge（u，v）和removeVertex（u）-我该怎么办？ 以下选项是可能的： <br><br><ul><li>  RemoveVertex优先级，所有与此顶点相关的边都将被删除 </li><li>  AddEdge优先级，恢复已删除的顶点 </li><li> 我们延迟执行removeVertex，直到同时执行所有addEdge。 </li></ul><br> 最简单的选择是第一个，对于其实现（2P2P-Graph），它足以获得两个2P-Set，一个用于顶点，第二个用于边缘 <br><br><h2>  6.5地图 </h2><br><h3> 文字映射： </h3><br> 要解决的两个问题： <br><br><ul><li> 如何同时执行推入操作？ 与计数器类似，您可以选择LWW或MV语义 </li><li> 与同步投放/ rmv怎么办？ 与集合类似，您可以将put-wins或rmv-wins或last-put-wins语义使用。 </li></ul><br><h3>  CRDT映射（CRDT的映射）： </h3><br> 一个更有趣的情况，因为 允许您构建嵌套映射。 我们不考虑更改嵌套类型的情况-这应由嵌套的CRDT本身决定。 <br><br>  <u>递归重置地图删除</u> <br><br> 删除操作将类型值“重置”到某个起始状态。 例如，对于计数器，这是零值。 <br><br> 考虑一个例子-一般的购物清单。 其中一个用户添加面粉，第二个​​用户进行检出（这导致对所有元素的删除操作的调用）。 结果，一份面粉仍保留在列表中，这似乎是合乎逻辑的。 <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/9g/sn/4j/9gsn4jdmbdg_ba1hdrmftl5mcgy.png"></div><br>  <u>移除胜出地图</u> <br><br>  rmv操作优先。 <br><br> 示例：在一个在线游戏中，一个爱丽丝玩家拥有10个硬币和一把锤子。 然后，同时发生两个事件：在副本A上，她产生了一个指甲；在副本B上，她的角色被删除，同时删除了所有对象： <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/tb/xd/6s/tbxd6s7eun3rpn57mnwt9d4hbxa.png"></div><br><br> 请注意，当使用递归删除时，最终会保留指甲，这在删除字符时不是正确的状态。 <br><br>  <u>更新胜图</u> <br><br> 更新优先，或者取消先前的操作以删除同时的rmv。 <br><br> 示例：在在线游戏中，副本B上的Alice角色由于不活动而被删除，但是活动同时在副本A上发生。 显然，删除操作必须取消。 <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/63/oz/5y/63oz5yzch4ioguyram3erawkzl0.png"></div><br> 使用这种实现时，有一个有趣的效果-假设我们有两个副本A和B，并且它们通过某个键k存储该集合。 然后，如果A删除键k的值，而B删除该集的所有元素，那么最终副本将保留带有键k的空集。 <br><br> 请注意，单纯的实现将无法正常工作-您不能简单地撤消所有先前的删除操作。 在下面的示例中，使用这种方法，最终状态将是初始状态，这是不正确的： <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/mp/un/hm/mpunhmkzj125hqob4net7iq7kc4.png"></div><br><h2> 清单 </h2><br> 这种类型的问题是，在本地插入/删除操作之后，不同副本上的项目索引将不同。 为了解决此问题，应用了操作转换方法-应用获得的更改时，应考虑原始副本中元素的索引。 <br><br><h1>  7. Riak </h1><br> 例如，考虑一下Riak中的CRDT： <br><br><ul><li> 计数器：PN计数器 </li><li> 设置：或设置 </li><li> 地图：CRDT更新胜出地图 </li><li>  （布尔值）标志：或设置最多1个元素 </li><li> 寄存器：对（值，时间戳） </li></ul><br><h1>  8.谁使用CRDT </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wiki</a>部分包含了很好的示例。 <br><br><h1>  9.参考 </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">关键CRDT商店</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">无冲突的复制JSON数据类型</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">对收敛和交换复制数据类型的全面研究</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">收敛和交换复制数据类型</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">无冲突的复制数据类型</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Riak CRDT的模糊指南</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CRDT：一个更新（或只是一个PUT）</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">无冲突的复制数据类型：概述</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">强大的最终一致性和无冲突的复制数据类型</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">最终一致的数据结构</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN418897/">https://habr.com/ru/post/zh-CN418897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN418885/index.html">Crispr可以加快自然过程并改变食物的种植方式</a></li>
<li><a href="../zh-CN418887/index.html">宇宙膨胀有多快？</a></li>
<li><a href="../zh-CN418889/index.html">手动应用程序测试指南：好处，步骤和方法</a></li>
<li><a href="../zh-CN418891/index.html">我们使用PVS-Studio检查了Android源代码，否则没人能完美</a></li>
<li><a href="../zh-CN418895/index.html">学习人工智能玩游戏</a></li>
<li><a href="../zh-CN418899/index.html">将MySQL从5.7升级到8.0.11后的第一印象和操作</a></li>
<li><a href="../zh-CN418901/index.html">在2018年欧洲计算机科学奥林匹克eJOI上，俄罗斯人获得了大多数金牌</a></li>
<li><a href="../zh-CN418903/index.html">科学家：火星上没有足够的二氧化碳来温暖大气层。 杆爆炸无济于事</a></li>
<li><a href="../zh-CN418905/index.html">电报机器人中的InlineKeyboard</a></li>
<li><a href="../zh-CN418907/index.html">如何教Zabbix将问题通知直接发送到桌面</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>