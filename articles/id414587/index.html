<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻 👨🏽‍⚕️ 🎄 DIY drone mandiri dengan kontrol atas Internet. Bagian 2 tentang perangkat lunak 👅 👩🏽‍🤝‍👨🏿 👢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ini adalah kelanjutan dari kisah drone otonom. Bagian pertama berbicara tentang perangkat keras, yang ini akan berbicara tentang perangkat lunak. Untu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DIY drone mandiri dengan kontrol atas Internet. Bagian 2 tentang perangkat lunak</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414587/">  Ini adalah kelanjutan dari kisah drone otonom.  Bagian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pertama</a> berbicara tentang perangkat keras, yang ini akan berbicara tentang perangkat lunak.  Untuk mulai dengan, program pendidikan kecil tentang interaksi operator dengan helikopter.  Berikut adalah tata letak khas untuk kebanyakan drone rakitan: <br><br><img src="https://habrastorage.org/webt/f6/jn/na/f6jnnadl96jkvjtcngwxhxogkcu.png" alt="gambar"><br><br>  Dan inilah skema untuk drone canggih: <br><br><img src="https://habrastorage.org/webt/gz/5t/bg/gz5tbg7qqv82_5t86usnrsyhgsg.png" alt="gambar"><br><a name="habracut"></a><br>  Beginilah cara kerja drone mainan, yang dikendalikan dari smartphone: <br><br><img src="https://habrastorage.org/webt/zr/tu/7r/zrtu7r2febul6zxzy2uzrkpf8rq.png" alt="gambar"><br><br>  Anda dapat mengontrol drone melalui Internet (jika Anda memiliki kartu SIM dengan alamat IP statis): <br><br><img src="https://habrastorage.org/webt/ae/d1/yk/aed1yk46dzosxybjpglxk6bwu5i.png" alt="gambar"><br><br>  Atau lebih jika alamat IP dinamis: <br><br><img src="https://habrastorage.org/webt/v2/x_/jo/v2x_jo1dtumefo_wekedrufda0o.png" alt="gambar"><br><br>  Untuk keandalan dan redundansi saluran komunikasi, opsi terakhir dapat dikembangkan ke kondisi seperti itu: <br><br><img src="https://habrastorage.org/webt/x6/yz/ho/x6yzhoievpeggh8ya7jo8cmxvo4.png" alt="gambar"><br><br>  Selanjutnya, saya akan menjelaskan proses pengaturan untuk pengendali penerbangan Emlid Navio 2 dan komputer mikro Raspberry Pi 3. <br><br><img src="https://habrastorage.org/webt/7g/lr/cv/7glrcvssoyxvii2swoekbsrkuf8.jpeg" alt="gambar"><br>  Tetapi, dengan sedikit modifikasi, pengaturan ini cocok untuk pengontrol penerbangan apa pun, yang dengannya Anda dapat berkomunikasi melalui protokol <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MAVLink</a> bersama dengan komputer mana pun di keluarga Linux OS. <br><br><img src="https://habrastorage.org/webt/bq/6c/my/bq6cmyprlzet6b8w4kemu_nn_ao.png" alt="gambar"><br><br>  <b><u>Penting!</u></b>  <b><u>Pengaturan harus dilakukan dengan mematikan power pada pengontrol kecepatan agar mesin tidak sengaja hidup.</u></b> <br><br><h3>  Perangkat lunak kontrol drone untuk PC dan tablet </h3><br>  Untuk mengontrol UAV, program khusus GCS (Ground Control Station) digunakan.  Lebih jauh dalam teks saya akan menggunakan singkatan ini.  Saya menyukai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">QGroundControl</a> , sebuah multi-platform open source (Windows, Linux, MacOS, iOS, Android) GCS yang menjadi bagian dari proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">DroneCode</a> .  Tetapi ada alternatif, gratis dan komersial: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Perencana APM</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MissionPlanner</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">UgCS</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">LibrePilot</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OpenPilot</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tower</a> (DroidPlanner) untuk Android, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MAVPilot</a> (iOS), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SidePilot</a> (iOS).  Serta konsol <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MAVProxy</a> . <br><br><h3>  Instal gambar OS pada kartu SD </h3><br>  Untuk operasi autopilot normal, sangat disarankan untuk menggunakan kartu SD "cepat" (kelas 10).  Kartu memori lambat tidak punya waktu untuk menyimpan log autopilot bahkan pada frekuensi rendah, akibatnya kartu itu bengkok atau tidak ditulis sama sekali.  Bukti ini mungkin merupakan kesalahan " <i>Detak jantung IO</i> ", yang dapat diamati di konsol MAVLink (cara menonton konsol MAVLink dijelaskan di bawah).  Saat membeli, lihat kemampuan untuk menulis video 4K: kemungkinan besar itu akan menjadi SD cepat.  Sayangnya, saya mengetahui hal ini setelah jatuhnya drone, ketika itu perlu untuk menganalisis log dan mencari tahu alasannya.  Log tidak dapat dibaca untuk beberapa GCS.  Alasan mematikan motor selama penerbangan ternyata dangkal: Saya lupa menyesuaikan tegangan minimum pada baterai dalam pengaturan untuk operasi yang gagal. <br><br>  Jadi, unduh gambar Raspbian Stretch yang sudah selesai dengan Ardupilot dan ROS yang sudah diinstal dari Emlid dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">halaman instruksi asli</a> .  Dan kami menulisnya ke kartu memori menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Etcher</a> atau program serupa. <br><br>  Untuk menghubungkan Raspberry ke jaringan WiFi Anda segera setelah dinyalakan, Anda perlu mengedit file <i>wpa_supplicant.conf</i> di root kartu SD.  Itu harus berisi baris berikut: <br><br><pre><code class="bash hljs">network={ ssid=<span class="hljs-string"><span class="hljs-string">"_wifi_"</span></span> psk=<span class="hljs-string"><span class="hljs-string">"_wifi_"</span></span> }</code> </pre> <br>  Anda juga dapat mengonfigurasinya tanpa WiFi dengan menghubungkan komputer satu-pelat ke router dengan kabel Ethernet.  Sekarang lepaskan kartu SD dari PC, masukkan ke dalam Raspberry dan nyalakan daya.  Setelah setengah menit, itu akan muncul di panel admin router pada halaman perangkat yang terhubung (navio <i>hostname</i> ). <br><br><h3>  Memperbarui kit distribusi dan menginstal paket yang diperlukan </h3><br>  Buka klien SSH dan sambungkan ke Raspberry (alamat IP navio lokal alih-alih <i>RASPBERRY_IP_ADDRESS</i> ): <br><br><pre> <code class="bash hljs">ssh pi@RASPBERRY_IP_ADDRESS</code> </pre> <br>  Kata sandi standar: <i>raspberry</i> .  Pertama-tama, perlu untuk memperluas sistem file OS ke seluruh volume kartu SD: <br><br><pre> <code class="bash hljs">sudo raspi-config --expand-rootfs</code> </pre> <br>  dan reboot: <br><br><pre> <code class="bash hljs">sudo reboot</code> </pre> <br>  Setelah reboot, hubungkan lagi dan perbarui distribusi: <br><br><pre> <code class="bash hljs">sudo apt-get update &amp;&amp; sudo apt-get dist-upgrade -y</code> </pre> <br>  Instal paket tambahan: <br><br><pre> <code class="bash hljs">sudo apt-get install autoconf automake libtool pkg-config libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libraspberrypi-dev gstreamer1.0-tools gstreamer1.0-plugins-good gstreamer1.0-plugins-bad</code> </pre> <br>  dan kompilasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pembungkus gst-rpicamsrc</a> untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">gstreamer</a> dan kamera asli Raspicam: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/thaytan/gst-rpicamsrc.git rpicamsrc <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> rpicamsrc chmod +x autogen.sh ./autogen.sh --prefix=/usr --libdir=/usr/lib/arm-linux-gnueabihf/ make sudo make install</code> </pre> <br>  Periksa apakah kamera berfungsi (file video test.h264 dibuat): <br><br><pre> <code class="bash hljs">gst-launch-1.0 rpicamsrc bitrate=1000000 ! filesink location=test.h264</code> </pre> <br>  Jika gstreamer mulai, tunggu beberapa detik hingga video direkam.  Anda dapat menghentikan proses dengan menekan <i>Ctrl + C.</i>  Jika ada video, maka kamera berfungsi. <br><br><h3>  Konfigurasikan dan jalankan Ardupilot </h3><br>  Rilis versi baru Ardupilot agak terlambat dalam perakitan dari Emlid.  Jika fungsionalitas yang diperlukan tersedia dalam versi terbaru, maka Anda dapat menginstalnya dari sumber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menggunakan instruksi ini</a> . <br><br>  Pengembang Navio menambahkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">utilitas alat Emlid yang</a> sederhana dan nyaman ke sensor mereka untuk memeriksa sensor dan mengatur Ardupilot.  Pertama, periksa apakah Raspberry melihat pengontrol Navio: <br><br><pre> <code class="bash hljs">emlidtool info</code> </pre> <br>  Jika dalam menanggapi perintah ini menghasilkan sesuatu seperti: <br><br><pre> <code class="bash hljs">Vendor: Emlid Limited Product: Navio 2 Issue: Emlid 2018-06-05 831f3b08594f2da17dccae980a2e3659115ef71f Kernel: 4.14.34-emlid-v7+ RCIO firmware: 0xcaec2284</code> </pre> <br>  itu berarti dia melihat.  Periksa status sensor (tampilkan daftar dan status): <br><br><pre> <code class="bash hljs">emlidtool <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br>  dan pengontrol PWM di kernel Linux: <br><br><pre> <code class="bash hljs">cat /sys/kernel/rcio/status/alive</code> </pre> <br>  0 = tidak bekerja, 1 = bekerja. <br><br>  Firmware dari pengontrol PWM diperbarui sebagai berikut: <br><br><pre> <code class="bash hljs">sudo emlidtool rcio update</code> </pre> <br>  Sekarang konfigurasikan Ardupilot: <br><br><pre> <code class="bash hljs">sudo emlidtool ardupilot</code> </pre> <br>  GUI teks dengan menu langkah demi langkah akan terbuka di terminal.  Kami memilih copter versi terbaru, ketik <i>arducopter</i> , autostart saat startup ( <i>Saat boot: aktifkan</i> ), mulai setelah konfigurasi ( <i>Ardupilot: start</i> ). <br><br><img src="https://habrastorage.org/webt/w8/p7/yn/w8p7ynlxvrqybsaqrdkqxbk68yy.png" alt="gambar"><br><br>  Kami keluar melalui item menu <i>Keluar</i> . <br><br>  Periksa apakah Ardupilot sudah mulai: <br><br><pre> <code class="bash hljs">sudo systemctl status arducopter</code> </pre> <br>  Harap dicatat bahwa file startup di systemd disebut <u>arducopter</u> , karena opsi <i>copter</i> dikonfigurasi. <br><br>  Sekarang kita perlu mengkonfigurasi Ardupilot sehingga mengirimkan kita telemetri.  Untuk melakukan ini, edit file konfigurasi: <br><br><pre> <code class="bash hljs">sudo nano /etc/default/arducopter</code> </pre> <br>  Itu harus berisi baris berikut: <br><br><pre> <code class="bash hljs">TELEM1=<span class="hljs-string"><span class="hljs-string">"-A udp:127.0.0.1:14550"</span></span> ARDUPILOT_OPTS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TELEM1</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  Simpan file ( <i>Ctrl + X</i> , lalu <i>Y</i> ) dan mulai ulang Ardupilot: <br><br><pre> <code class="bash hljs">sudo systemctl daemon-reload sudo systemctl restart arducopter</code> </pre> <br>  Anda dapat memeriksa status proses Ardupilot dengan perintah berikut: <br><br><pre> <code class="bash hljs">sudo systemctl status arducopter</code> </pre> <br>  Dengan pengaturan ini, Ardupilot akan mengirimkan telemetri (paket <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MAVLink</a> ) ke port UDP lokal 14550. Selanjutnya, skrip <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MAVProxy</a> (uraian di bawah) akan mengambil telemetri dari sana dan mengirimkannya ke GCS atau skrip, serta mengirim paket dengan perintah di arah yang berlawanan. <br><br>  Alih-alih alamat dan port lokal, Anda dapat merekam alamat IP PC atau tablet di jaringan lokal dan paket akan segera disiarkan di sana. <br><br><img src="https://habrastorage.org/webt/8p/no/vv/8pnovvpynimp8tvucgtqnbvqhls.png" alt="gambar"><br><br>  Namun, pendekatan ini dibenarkan jika data telemetri tidak digunakan di tempat lain dan perangkat dengan GCS memiliki alamat IP statis.  Jika tidak, setiap kali Anda harus mendaftarkan Ardupilot baru dalam pengaturan.  Untuk berkomunikasi dengan autopilot melalui TCP, beberapa GCS dengan alamat dinamis dan beberapa skrip lain di komputer on-board dapat secara bersamaan, lebih mudah menggunakan MAVProxy. <br><br><img src="https://habrastorage.org/webt/lt/gu/o6/ltguo6ghxcrnv8syshno6arbwi8.png" alt="gambar"><br><br>  Skrip ini (ditulis dengan Python) dapat menerima paket MAVLink ke alamat UDP lokal dan menyampaikannya ke beberapa alamat IP lokal atau jarak jauh, baik melalui UDP dan TCP.  Paket dikirim di kedua arah ke Ardupilot ⇔ GCS.  Selain itu, MAVProxy adalah GCS lengkap, tetapi dengan antarmuka teks. <br><br><h3>  MAVProxy </h3><br>  MAVProxy sudah diinstal pada gambar Navio.  Itu juga dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">diinstal</a> pada PC (Windows, Linux, MacOS) untuk komunikasi lebih lanjut dengan autopilot dalam mode konsol. <br><br>  Setelah memastikan Ardupilot berfungsi, jalankan skrip MAVProxy di Raspberry dengan perintah ini: <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:127.0.0.1:14550</code> </pre> <br>  <i>Parameter --master = udp: 127.0.0.1: 14550</i> menetapkan sumber data untuk skrip.  Ini adalah port UDP lokal yang terdaftar dalam file konfigurasi Ardupilot.  Setelah menjalankan perintah, MAVProxy akan terhubung ke port ini dan menampilkan pesan autopilot, mirip dengan milik saya: <br><br><pre> <code class="bash hljs">pi@navio:~ $ mavproxy.py --master=udp:127.0.0.1:14550 Connect udp:127.0.0.1:14550 source_system=255 Failed to load module: No module named adsb. Use <span class="hljs-string"><span class="hljs-string">'set moddebug 3'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the MAVProxy console to <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> traceback Log Directory: Telemetry <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>: mav.tlog Waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> heartbeat from 127.0.0.1:14550 MAV&gt; online system 1 STABILIZE&gt; Mode STABILIZE fence breach GPS lock at 0 meters APM: APM:Copter V3.5.5 (88a1ecdd) APM: Frame: UNKNOWN APM: PreArm: RC Roll not configured APM: PreArm: Compass not calibrated APM: PreArm: 3D Accel calibration needed APM: PreArm: check firmware or FRAME_CLASS APM: PreArm: Throttle below Failsafe</code> </pre> <br>  Karena autopilot belum dikalibrasi dan tidak sepenuhnya disetel, pesan juga fasih berbicara tentang ini.  Dalam mode ini, Anda dapat berkomunikasi dengan autopilot melalui perintah.  Jika drone disetel sepenuhnya, maka urutan dua perintah seperti itu akan menyebabkan awal mesin dan drone lepas landas hingga ketinggian 20 m: <br><br><pre> <code class="bash hljs">arm throttle takeoff 20</code> </pre> <br>  Autopilot yang tidak dikalibrasi tidak akan terbang, tetapi akan menampilkan pesan dengan alasan mengapa ia tidak dapat melakukan ini. <br><br><h3>  Membangun komunikasi dengan drone di jaringan lokal </h3><br>  Hentikan skrip ( <i>Ctrl + C</i> ) dan jalankan kembali dalam formulir ini: <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:127.0.0.1:14550 --out=tcpin:0.0.0.0:5762</code> </pre> <br>  Dengan parameter tambahan <i>--out = tcpin: 0.0.0.0: 5762,</i> MAVProxy akan mendengarkan pada port 5762 untuk koneksi TCP yang masuk dari GCS.  Segera setelah GCS terhubung, paket data akan mulai bergerak antara drone dan GCS.  Mari kita coba sambungkan dari PC: <br><br><img src="https://habrastorage.org/webt/8e/zz/eb/8ezzebgztbjr6nkllbyefkdots0.png" alt="gambar"><br><br>  Jika koneksi berhasil, maka GCS akan menampilkan banyak pesan dengan permintaan untuk mengkalibrasi sensor dan memuat parameter on-board dengan nilai saat ini: <br><br><img src="https://habrastorage.org/webt/mz/gy/co/mzgycobpds-e3bk7i5szgplvvey.png" alt="gambar"><br><br><img src="https://habrastorage.org/webt/i1/bx/ms/i1bxms-du1v9tbqpemtfv-sgodw.png" alt="gambar"><br><br><h3>  Kalibrasi sensor dan penyetelan parameter autopilot </h3><br>  Kalibrasi autopilot dapat dilakukan di hampir semua GCS.  Dokumentasi Ardupilot menggambarkannya dengan sangat rinci.  Pertama-tama, kita mengatur jenis bingkai.  Saya memiliki tata letak 4-motor standar, jadi ini <i>Quad X.</i> <br><br><img src="https://habrastorage.org/webt/mv/gc/bi/mvgcbi8augohhzhrcfrnosuia-s.png" alt="gambar"><br><br>  Penerbangan pertama masih lebih baik dilakukan dalam mode manual.  Kami menghubungkan dan mengkalibrasi kontrol radio (penerima dan pemancar). <br><br><img src="https://habrastorage.org/webt/dj/ay/xw/djayxw3ulzuaabk4ubn3qavp0d4.png" alt="gambar"><br><br>  Tetap mengkalibrasi accelerometer dan kompas. <br><br><img src="https://habrastorage.org/webt/bm/rs/1r/bmrs1rhiwgxu2udg11td3t8slak.png" alt="gambar"><br><br>  Agar Ardupilot dapat melihat dan memperhitungkan data akun dari sensor eksternal, tetapkan parameter yang diperlukan: <br><br>  Untuk <u>PX4Flow</u> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kalibrasi sensor itu sendiri dan pembaruan firmware</a> ) <br><br> <code>FLOW_ENABLE = 1 (Enabled) <br> FLOW_ADDR = 0 (0 =     042)</code> <br> <br>  Untuk laser altimeter <u>VL53L0X</u> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi</a> ) <br><br> <code>RNGFND_TYPE = 16 (VL53L0X) <br> RNGFND_ORIENT = 25 (  ) <br> RNGFND_ADDR = 41 (I2C-   ).   - 0x29,     = 41. <br> RNGFND_SCALING = 1 <br> RNGFND_MIN_CM = 5 <br> RNGFND_MAX_CM = 120 <br> RNGFND_GNDCLEAR = 15 (    ,     )</code> <br> <br>  Untuk <u>IRLock</u> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">petunjuk terperinci</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">wiki IR-Lock</a> ) <br><br> <code>PLND_ENABLED = 1 <br> PLND_TYPE = 2 <br> PLND_BUS = 1</code> <br> <br>  Untuk tampilan depan sonar ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi</a> ) <br><br> <code>RNGFND2_TYPE = 2 (MaxbotixI2C sonar) <br> RNGFND2_ORIENT = 0 (  ) <br> RNGFND2_MAX_CM = 700 (   )</code> <br> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Daftar</a> lengkap <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">opsi</a> Ardupilot. <br><br>  Sekarang restart Ardupilot dari menu GCS, sambungkan kembali ke board dan buka jendela MAVLink Inspector untuk melihat data dari sensor. <br><br><img src="https://habrastorage.org/webt/6z/x_/8z/6zx_8zmfbc4nflyaxyz-h2yv8zs.png" alt="gambar"><br><br>  Sayangnya, pembacaan IR-Lock tidak terlihat di sini, untuk analisis pekerjaannya Anda harus melihat log on-board.  Cara melakukan ini dijelaskan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Tetap mengkonfigurasi pengaturan keamanan dan Anda dapat memulai drone: <br><br><img src="https://habrastorage.org/webt/ex/jp/x-/exjpx-pjkbvzmugdr-r1ujqpziw.png" alt="gambar"><br><br>  Cara mengkonfigurasi gyro-suspensi dan mengontrol kamera utama secara rinci Saya akan menulis di salah satu artikel berikut, poin utama diuraikan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><h3>  Siaran video </h3><br>  Mari kita periksa bagaimana penyiaran video bekerja di jaringan WiFi.  Dengan perintah ini, Anda dapat menjalankan video dalam port TCP pada Raspberry menggunakan utilitas raspivid asli untuk kamera Raspicam: <br><br><pre> <code class="bash hljs">raspivid -t 0 -hf -fps 25 -w 640 -h 480 -o - | gst-launch-1.0 fdsrc ! h264parse ! rtph264pay config-interval=1 pt=96 ! gdppay ! tcpserversink host=0.0.0.0 port=5001</code> </pre> <br>  Tetapi perintah ini melakukan hal yang sama, hanya menggunakan pembungkus rpi-camsrc yang telah dikompilasi sebelumnya untuk gstreamer: <br><br><pre> <code class="bash hljs">gst-launch-1.0 rpicamsrc sensor-mode=4 ! h264parse ! rtph264pay config-interval=1 pt=96 ! gdppay ! tcpserversink host=0.0.0.0 port=5001</code> </pre> <br>  Dalam kedua kasus, siaran H264 tersedia di alamat IP Raspberry pada port 5001. <br><br>  Anda dapat melihatnya dengan menjalankan perintah seperti itu di PC Anda ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">gstreamer</a> harus diinstal), alih-alih <i>RPI_ADDRESS,</i> tentukan alamat Raspberry di jaringan: <br><br><pre> <code class="bash hljs">gst-launch-1.0 -v tcpclientsrc host=RPI_ADDRESS port=5001 ! gdpdepay ! rtph264depay ! avdec_h264 ! videoconvert ! autovideosink sync=<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  Akibatnya, jendela dengan video harus terbuka. <br><br>  Hampir semua GCS memiliki pemutar video bawaan yang dapat menampilkan aliran video RTSP.  Untuk membuat server RTSP dari Raspberry, Anda dapat menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">VLC</a> console <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">player</a> .  Instalasi: <br><br><pre> <code class="bash hljs">sudo apt-get install vlc</code> </pre> <br>  Siaran video dimulai sebagai berikut: <br><br><pre> <code class="bash hljs">raspivid -o - -t 0 -n -w 320 -h 240 -fps 25 | cvlc -vvv stream:///dev/stdin --sout <span class="hljs-string"><span class="hljs-string">'#rtp{sdp=rtsp://:8554/live}'</span></span> :demux=h264</code> </pre> <br>  Video tersedia di (bukan <i>RPI_ADDRESS</i> , alamat Raspberry): <br><br> <code>rtsp://RPI_ADDRESS:8554/live</code> <br> <br>  Penyiapan GCS: <br><br><img src="https://habrastorage.org/webt/uk/x8/hu/ukx8huklwh9kxu5glz289xkzenq.png" alt="gambar"><br><br><img src="https://habrastorage.org/webt/7r/og/gw/7roggwghpf_arhxggulllplkr6i.png" alt="gambar"><br><br>  Alamat aliran dapat digunakan untuk menghubungkan beberapa pemain pada perangkat yang berbeda, tetapi karena menangkap dan menyiarkan video untuk Raspberry adalah proses yang sangat memakan waktu, lebih baik bagi beberapa konsumen video untuk menggunakan server eksternal (uraian di bawah). <br><br><h3>  Telemetri melalui Internet </h3><br>  Agar GCS dapat terhubung melalui Internet ke drone dengan alamat IP dinamis, diperlukan server perantara dengan IP statis di mana skrip MAVProxy akan diluncurkan.  Untuk tujuan ini, saya mengambil keuntungan dari penyewaan server cloud dari salah satu penyedia terkenal.  Untuk MAVProxy, konfigurasi paling minimal cocok, tetapi karena saya akan menggunakan server yang sama untuk menyampaikan video, saya memilih opsi dengan memori sedikit lebih banyak (satu inti dan 1GB memori, Ubuntu 18.04).  Untuk keterlambatan minimum dalam lewatnya data antara board dan GCS, server harus berada dalam kedekatan geografis maksimum dengan drone dan GCS. <br><br><img src="https://habrastorage.org/webt/eu/yl/3i/euyl3i1m1s5zjyjl5suhj0gw4sg.png" alt="gambar"><br><br>  Instal MAVProxy di server.  Ketergantungan pertama: <br><br><pre> <code class="bash hljs">sudo apt-get install python-dev python-opencv python-wxgtk3.0 python-pip python-matplotlib python-pygame python-lxml python-yaml</code> </pre> <br>  dan kemudian skrip itu sendiri melalui PIP: <br><br><pre> <code class="bash hljs">sudo pip install MAVProxy</code> </pre> <br>  tulis jalannya: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"export PATH=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/.local/bin"</span></span> &gt;&gt; ~/.bashrc</code> </pre> <br>  dan jalankan skrip dengan parameter berikut: <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:0.0.0.0:15001 --out=tcpin:0.0.0.0:15002</code> </pre> <br>  MAVProxy mendengarkan pada port 15001 untuk paket telemetri yang masuk dari drone melalui UDP, dan port 15002 untuk koneksi TCP yang masuk dari GCS. <br><br>  Jalankan MAVProxy di Raspberry dengan satu parameter lagi, sehingga telemetri juga disiarkan ke server (bukan <i>SERVER_IP</i> alamat server Anda): <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:127.0.0.1:14550 --out=tcpin:0.0.0.0:5762 --out=udpout:SERVER_IP:15001</code> </pre> <br>  Setelah memulai skrip pada komputer terpasang, pesan dari autopilot akan muncul di konsol server.  Seperti yang disebutkan di atas, MAVProxy adalah GCS lengkap dengan antarmuka teks dan dalam keadaan ini sudah mungkin untuk mengedit parameter dan mengontrol drone melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">perintah</a> di konsol server. <br><br>  Hubungkan GCS pada PC atau tablet ke server.  Pengaturan koneksi sama seperti untuk jaringan lokal, hanya alih-alih alamat IP Raspberry kami menentukan alamat server dan port 15002. <br><br><img src="https://habrastorage.org/webt/8m/ed/rc/8medrcfonj1lsyr1wvufdi2elom.png" alt="gambar"><br><br>  Sekarang Anda dapat menghubungkan modem USB 4G ke Raspberry dan mengevaluasi penundaan reaksi cakrawala di layar. <br><br><h3>  Video internet </h3><br><img src="https://habrastorage.org/webt/7i/w2/ow/7iw2owafcz4bjjmwu116q9tr65i.png" alt="gambar"><br><br>  Untuk menyampaikan video, instal pemutar VLC di server: <br><br><pre> <code class="bash hljs">sudo apt-get install vlc</code> </pre> <br>  Setelah instalasi, jalankan sebagai relay dari port UDP 5001 di kanal RTSP <i><b>SERVER_IP: 8554 / live</b></i> : <br><br><pre> <code class="bash hljs">cvlc -vvv udp://@:5001 --sout <span class="hljs-string"><span class="hljs-string">'#rtp{sdp=rtsp://:8554/live}'</span></span> :demux=h264</code> </pre> <br>  Di papan, kami akan memulai siaran video dari kamera ke server melalui UDP (bukan alamat server <i>SERVER_IP</i> ): <br><br><pre> <code class="bash hljs">gst-launch-1.0 rpicamsrc bitrate=1000000 ! video/x-h264,width=640,height=480,framerate=25/1 ! h264parse ! udpsink host=SERVER_IP port=5001</code> </pre> <br>  Alamat aliran sekarang dapat digunakan sebagai sumber video dalam pengaturan GCS atau dibuka di sembarang pemain yang mendukung protokol ini. <br><br>  Sekarang Anda dapat merencanakan rute penerbangan dan meluncurkan drone melalui Internet, setelah sebelumnya menyalakannya, misalnya, menggunakan asisten telepon. <br><br>  Jelas, karena waktu tempuh video dan telemetri yang relatif lama melalui jaringan, metode ini hampir tidak cocok untuk penerbangan FPV dalam mode manual antar rintangan. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/43rqRE9f1hA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Subjek untuk publikasi selanjutnya: <br><br><ul><li>  Opsi untuk mengisi ulang drone di rumah burung saya dan yang mana saya berhenti. </li><li>  Menerapkan GCS berbasis web menggunakan MAVProxy, NodeJS, socket.io, dan server media untuk mengelola beberapa drone secara bersamaan. </li><li>  Saluran komunikasi berlebihan dan sistem penyelamatan drone </li><li>  Visi dan kap mesin untuk menghindari tabrakan dengan rintangan </li></ul><br>  Dilanjutkan ... </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id414587/">https://habr.com/ru/post/id414587/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id414577/index.html">Devilution: Diablo proyek rekayasa terbalik</a></li>
<li><a href="../id414579/index.html">Google AI telah belajar memprediksi kapan seorang pasien akan mati (tetapi tidak semuanya begitu suram)</a></li>
<li><a href="../id414581/index.html">Di mana kancingnya ?! Bagaimana orang sederhana bisa membongkar data dari Kibana dan Elasticsearch dan tidak membebani pengembang</a></li>
<li><a href="../id414583/index.html">RIT ++, Tech RaDarts, dan semuanya</a></li>
<li><a href="../id414585/index.html">Bagaimana String.getBytes (UTF_8) saya rusak dan apa yang saya lakukan dengannya</a></li>
<li><a href="../id414589/index.html">Robotika kolaboratif Sberbank: robot apa yang bisa kami lakukan dengan Anda?</a></li>
<li><a href="../id414593/index.html">Perbandingan C # dan JavaScript. Dasar-dasarnya</a></li>
<li><a href="../id414597/index.html">Tanyakan pada Ethan: Seberapa dekat peradaban asing dapat bersatu?</a></li>
<li><a href="../id414601/index.html">Ketika gunung-gunung tinggi dan laptop-laptop besar: sedikit sejarah TI lagi</a></li>
<li><a href="../id414605/index.html">Kerajaan mini</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>