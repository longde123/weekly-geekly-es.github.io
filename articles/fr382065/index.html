<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ğŸ¿ ğŸ‘ŠğŸ» ğŸ•Œ SystÃ¨me de protection contre les fuites ğŸ’³ ğŸ´ ğŸ‘©ğŸ»â€ğŸ¤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je veux partager mon expÃ©rience dans la crÃ©ation d'un appareil qui Ã©tait non seulement intÃ©ressant Ã  mettre en Å“uvre, mais qui pouvait Ã©galement Ãªtre ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SystÃ¨me de protection contre les fuites</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/382065/"><img src="https://habrastorage.org/files/055/477/b38/055477b3811b49e2b9123bdccca872f1.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je veux partager mon expÃ©rience dans la crÃ©ation d'un appareil qui Ã©tait non seulement intÃ©ressant Ã  mettre en Å“uvre, mais qui pouvait Ã©galement Ãªtre bÃ©nÃ©fique. </font><font style="vertical-align: inherit;">Peut-Ãªtre que quelqu'un dira qu'il Ã©tait possible de faire quelque chose de plus simple, mais ce n'est pas notre faÃ§on ...</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout a commencÃ© avec le fait qu'aprÃ¨s la rÃ©paration de l'appartement un problÃ¨me potentiel a Ã©tÃ© dÃ©couvert. </font><font style="vertical-align: inherit;">En cas de fuite quelque part, il ne sera pas possible de se rendre aux grues pour entrer dans l'appartement sans certains efforts physiques et dextÃ©ritÃ©, car la trappe de fermeture des grues n'est pas trÃ¨s bien installÃ©e. </font><font style="vertical-align: inherit;">Par consÃ©quent, en cas de besoin urgent (accident) de fermer rapidement les robinets ne fonctionnera pas. </font><font style="vertical-align: inherit;">Il Ã©tait nÃ©cessaire de faire quelque chose avec cela, et une solution est apparue - pour saisir l'opportunitÃ© Ã  distance, c'est-Ã -dire </font><font style="vertical-align: inherit;">sans ouvrir la trappe, arrÃªtez l'alimentation en eau. </font><font style="vertical-align: inherit;">Et en prime, pour mettre en Å“uvre tout ce qui peut Ãªtre fait confiance avec l'Ã©lectronique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici Ã  quoi ressemble l'appareil. </font></font><br>
<br>
<img src="https://habrastorage.org/files/9fa/6a7/137/9fa6a713753a403ab27be8f6c4ffe0da.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Principales caractÃ©ristiques:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coupez l'alimentation en eau indÃ©pendamment en cas de fuite</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coupez l'alimentation en eau "en mode manuel" - sur le panneau avant il y a un "bouton rouge" et un interrupteur Ã  bascule Ã  deux positions</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affichage des relevÃ©s de compteur sur son propre Ã©cran</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher d'autres informations utiles sur l'Ã©cran</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est pas possible, mais prÃ©voit:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travaillez Ã  partir d'une source d'alimentation de secours. </font><font style="vertical-align: inherit;">Maintenant, en cas de panne de courant - l'appareil est inutile</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec des capteurs de fuite sans fil</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nettoyez vous-mÃªme les robinets. </font><font style="vertical-align: inherit;">Afin de ne pas Â«devenir acideÂ», il est conseillÃ© de les ouvrir / fermer une fois par mois</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissez-vous des Ã©vÃ©nements sur un smartphone et soyez contrÃ´lÃ© par "air"</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il ne peut pas (et mÃªme si cela est trÃ¨s nÃ©cessaire):</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avoir plusieurs canaux pour lire diffÃ©rents capteurs de fuite cÃ¢blÃ©s, maintenant tous les capteurs (5 piÃ¨ces) sont connectÃ©s en parallÃ¨le</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GÃ©rez les grues individuellement. </font><font style="vertical-align: inherit;">Il y en a deux (un sur l'eau chaude, le second sur l'eau froide), et ils sont connectÃ©s en parallÃ¨le</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ContrÃ´le de rupture des capteurs</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici une description des composants et de leur fonction (prix en date de juillet 2015).</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    1/2 " DN15 DC5V</a> ( CR02,  ,     ) â€” 3080   </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Maple Mini (  stm32f103c8t6)</a>    â€” 233 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SPI TFT LCD  ILI9341</a> â€” 302 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Ds3231 + AT24C32</a>   ,  ,   â€” 4  EEPROM â€” 38 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ULN2003 DIP-16</a> â€”    â€” 123 /10  ( )</li>
<li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> â€” 239 /10  (  )</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>     â€” 164 /5  ( )</li>
<li>  ,  : ,  (    ), ,  , </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sÃ»r, j'avais Ã©galement besoin d'un programmeur / Ã©mulateur, j'ai utilisÃ© celui-ci: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARM Emulator, prend en charge ARM7, ARM9, ARM11, Cortex-M3 core, ADS, IAR, STM32, interface JTAG, version V8 Ã  double tampon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Parmi les fonctionnalitÃ©s, il est possible de mentionner qu'en plus des </font><font style="vertical-align: inherit;">fils </font><font style="vertical-align: inherit;">standard pour la </font><font style="vertical-align: inherit;">programmation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , j'ai dÃ» lui appliquer la tension d'alimentation actuelle de la puce programmable, 3,3 volts dans mon cas. </font><font style="vertical-align: inherit;">Il est nÃ©cessaire que le programmeur comprenne les niveaux de tension des valeurs logiques. </font><font style="vertical-align: inherit;">Sans cela, la puce programmable ne voulait pas Ãªtre dÃ©tectÃ©e. </font><font style="vertical-align: inherit;">En outre, ce programmeur a la capacitÃ© d'alimenter un appareil programmable, une broche est fournie pour cela, la tension est activÃ©e / dÃ©sactivÃ©e par l'utilitaire JLink.exe.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus sur le fer</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MicrocontrÃ´leur</font></font></h3><img src="https://habrastorage.org/files/73d/47b/3b3/73d47b3b3ca9476dafadf503b3162931.jpg" width="300" align="right"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le cerveau de tout le systÃ¨me est un microcontrÃ´leur 32 bits de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> soigneusement soudÃ© par des travailleurs chinois dans des usines chinoises Ã  une carte qui est Â«compatibleÂ» avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leaf Maple Mini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã€ propos de Leaf Maple Mini</font></font></b><div class="spoiler_text">   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">eta4ever</a> <blockquote>  ,  </blockquote>        Â«Â»     ,    â€¦<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dispose de 48 conclusions. </font><font style="vertical-align: inherit;">Le cÅ“ur fonctionne Ã  72 MHz, a intÃ©grÃ© SRAM - 20 Ko et Flash - 128 Ko. </font><font style="vertical-align: inherit;">Plus de dÃ©tails </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ces paramÃ¨tres encouragent certainement l'utilisation d'outils et d'outils de haut niveau, c'est-Ã -dire </font><font style="vertical-align: inherit;">ce sont </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FreeRTOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Ã©cran couleur graphique, C ++, etc. </font><font style="vertical-align: inherit;">(et pas deux LED et assembleur). </font><font style="vertical-align: inherit;">En gÃ©nÃ©ral, ne vous refusez rien ... sauf C ++, mais ce n'est pas un problÃ¨me de puce.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi?</font></font></b><div class="spoiler_text">       C++ ,  ,     ,     . ,     C++      ,   ,  ,   , ..      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32CubeMX</a>      ,   FreeRTOS.     ,      .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation des conclusions du microcontrÃ´leur. </font><font style="vertical-align: inherit;">De lÃ , vous pouvez deviner Ã  quoi est connectÃ©.</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/173/70e/067/17370e0676c64b75b9ddf7ec11a1ae29.png"><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher</font></font></h3><br>
<img src="https://habrastorage.org/files/c09/361/5b6/c093615b66774fb7969845db6584ee70.jpg" width="300" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le module avec un Ã©cran TFT de 320x240 pixels construit sur un contrÃ´leur compatible avec ILI9341 est responsable de l'affichage des informations; il fonctionne par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ã  la frÃ©quence maximale possible pour ce bundle (18MHz). </font><font style="vertical-align: inherit;">SPI n'est connectÃ© au microcontrÃ´leur que dans une seule direction, la sortie de lecture des donnÃ©es du module d'affichage reste suspendue en l'air, car </font><font style="vertical-align: inherit;">Je n'ai pas proposÃ© cette fonctionnalitÃ©, mais je l'ai enregistrÃ©e sur les jambes libres du microcontrÃ´leur. </font><font style="vertical-align: inherit;">Le transfert de donnÃ©es fonctionne sur </font></font><abbr title="DMA ou Direct Memory Access - technologie d'accÃ¨s direct Ã  la mÃ©moire contournant le processeur central"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DMA</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un connecteur pour connecter une carte SD est soudÃ© au module Ã  l'arriÃ¨re, je n'ai pas testÃ© de travailler avec une carte SD et le connecteur n'est pas impliquÃ© dans ce projet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module RTC et EEPROM</font></font></h3><br>
<img src="https://habrastorage.org/files/527/406/51e/52740651ee344478a84c0a15f43c3c51.jpg" width="300" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'horloge du module est implÃ©mentÃ©e avec une puce DS3231. Je n'ai pas causÃ© de problÃ¨mes particuliers, le seul inconvÃ©nient Ã©tait que toutes les valeurs (date, heure) sont stockÃ©es dans des registres au </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format BCD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lorsque deux chiffres dÃ©cimaux sont reflÃ©tÃ©s dans un octet (dans les quatre bits supÃ©rieurs - le chiffre le plus significatif, dans le bas - le chiffre le moins significatif) . Par exemple, la valeur Â«38 minutesÂ» est stockÃ©e en tant que valeur dÃ©cimale 56 (il s'agit de Â«38Â» dans la notation hexadÃ©cimale). Il n'a pas Ã©tÃ© possible de savoir s'il Ã©tait possible de passer au format binaire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le module a sa propre batterie, donc Ã  chaque fois que vous perdez de lâ€™alimentation, vous nâ€™avez pas Ã  rÃ©gler lâ€™heure et la date. De plus, le microcircuit AT24C32 est soudÃ© sur la carte du module, ayant jusqu'Ã  32768 bits EEPROM! Autrement dit, il s'agit de 4 Ko de mÃ©moire non volatile. L'horloge et la mÃ©moire se trouvent sur le mÃªme bus I2C. Ã€ l'heure actuelle, la mÃ©moire est utilisÃ©e uniquement pour stocker les paramÃ¨tres de l'appareil, la valeur actuelle des lectures des compteurs et autre chose. finalement occupÃ© ... 25 octets. Plus tard, il sera utilisÃ© pour garder des journaux de divers Ã©vÃ©nements, et Ã©ventuellement pour garder des statistiques de consommation (je ne sais pas pourquoi, mais il y aura une occasion de programmer l'affichage des graphiques).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus des contacts du bus I2C et de l'alimentation, il y en a deux de plus sur la carte. </font><font style="vertical-align: inherit;">"SQW" est le signal du rÃ©veil qui peut Ãªtre programmÃ© via les registres et "32K" est la frÃ©quence gÃ©nÃ©rÃ©e par le DS3231 pour les autres appareils. </font><font style="vertical-align: inherit;">Ce projet ne s'applique pas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module avec capteur d'humiditÃ©</font></font></h3><br>
<img src="https://habrastorage.org/files/6a9/b19/bc1/6a9b19bc17f64a42bc008a3c5a3fe058.jpg" align="right" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il sert de tampon entre le monde extÃ©rieur et le microcontrÃ´leur. </font><font style="vertical-align: inherit;">Les fils allant aux sondes au total ont une longueur d'environ 10 mÃ¨tres, sans Ã©cran. </font><font style="vertical-align: inherit;">Fils tÃ©lÃ©phoniques conventionnels Ã  deux fils. </font><font style="vertical-align: inherit;">En cas de coup statique, j'espÃ¨re que seul ce module mourra, mais pas le microcontrÃ´leur. </font><font style="vertical-align: inherit;">Il est capable de mesurer la rÃ©sistance entre deux Ã©lectrodes et de donner ces informations sous forme analogique (tension de 0 Ã  tension d'alimentation) et numÃ©rique (0/1, le module dispose d'une rÃ©sistance variable qui peut Ãªtre ajustÃ©e Ã  la limite de fonctionnement).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a eu des problÃ¨mes mineurs avec ce module. Lors de l'application et de la suppression de la tension d'alimentation, le module Ã  la sortie numÃ©rique a signalÃ© un dÃ©clenchement, cela peut Ã©galement Ãªtre vu par le clignotement de la LED pendant une fraction de seconde (sur la carte du module, une LED est installÃ©e en parallÃ¨le avec la sortie numÃ©rique). Le microcontrÃ´leur a rÃ©ussi Ã  lire un signal anormal lorsque l'alimentation du systÃ¨me a Ã©tÃ© appliquÃ©e / rÃ©initialisÃ©e (problÃ¨me n Â° 1). La solution a Ã©tÃ© mise en Å“uvre en sautant de courtes impulsions de fonctionnement, en prÃ©vision d'une condition fixÃ©e pendant un certain temps.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La rÃ©sistance variable a un trÃ¨s petit angle de rÃ©glage, auquel je n'ai pas pu trouver la frontiÃ¨re entre l'absence de faux positifs et une bonne sensibilitÃ© (problÃ¨me n Â° 2). Il a ensuite Ã©tÃ© implÃ©mentÃ© en lisant le signal analogique via le microcontrÃ´leur ADC. Dans le mÃªme temps, il est devenu possible de dÃ©finir la limite de rÃ©ponse dans les paramÃ¨tres de l'appareil en tant que paramÃ¨tre. La possibilitÃ© d'ajuster le niveau de rÃ©ponse est dÃ©sormais considÃ©rÃ©e comme superflue, et il est probablement prÃ©fÃ©rable de coder en dur la valeur limite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a Ã©tÃ© remarquÃ© qu'aprÃ¨s plusieurs minutes de fonctionnement (Ã©chauffement?), Le module a soudainement commencÃ© Ã  signaler un fonctionnement spontanÃ© (problÃ¨me numÃ©ro 3, combien d'entre eux?!).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ la frontiÃ¨re des rÃ©ponses anormales, l'intensitÃ© de la lueur LED (sur le module) augmente ou diminue progressivement, comme si elle Ã©tait contrÃ´lÃ©e par un gÃ©nÃ©rateur PWM, il est clair que c'est du bruit et c'est de la haute frÃ©quence, on pourrait en attendre la mÃªme chose Ã  la sortie Â«numÃ©riqueÂ» du module (problÃ¨me n Â° 4 ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je prÃ©cise que tous ces problÃ¨mes ont Ã©tÃ© rÃ©solus lors de la mise en Å“uvre du signal analogique du module. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les sondes (parties de capteurs situÃ©es directement dans des lieux d'accumulation d'eau en cas d'accident) sont rÃ©alisÃ©es Ã  partir de moyens improvisÃ©s. Il s'agit d'Ã©tain (acier) et d'une petite boÃ®te de jonction ronde, modifiÃ©e mÃ©caniquement au type souhaitÃ© et avec des fils soudÃ©s Ã  l'intÃ©rieur. Lorsque de l'eau pÃ©nÃ¨tre entre les paires d'Ã©lectrodes, la rÃ©sistance diminue et est considÃ©rÃ©e par le contrÃ´leur comme une Â«fuiteÂ».</font></font><br>
<br>
<img src="https://habrastorage.org/files/bc7/366/3ad/bc73663ad6f048079b0ca835a353a0b6.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les tests en laboratoire ont montrÃ© que le produit remplit bien sa fonction et n'est pas un maillon faible du systÃ¨me.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nutrition</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ensemble du systÃ¨me fonctionne Ã  partir de la charge du tÃ©lÃ©phone - 5 volts, 2A (ici avec une marge). </font><font style="vertical-align: inherit;">Sur la carte Maple Mini, un rÃ©gulateur de tension de 3,3 volts est installÃ©, la tension d'entrÃ©e peut aller jusqu'Ã  12 volts, les caractÃ©ristiques du stabilisateur le permettent, mais une tension aussi Ã©levÃ©e n'est pas pratique Ã  utiliser, plus Ã  ce sujet ci-dessous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec un stabilisateur, 3,3 volts vont Ã©galement Ã  la puissance des modules RTC, TFT et au module de mesure d'humiditÃ©. </font><font style="vertical-align: inherit;">Les grues sont connectÃ©es via l'ensemble interrupteur d'alimentation ULN2003AN, directement Ã  partir de l'alimentation, c'est-Ã -dire </font><font style="vertical-align: inherit;">travailler Ã  partir de 5 volts, moins la chute sur les touches. </font><font style="vertical-align: inherit;">ULN2003AN n'utilise que deux des sept canaux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sÃ»r, il est conseillÃ© de remplacer l'alimentation par une autre, avec une tension lÃ©gÃ¨rement supÃ©rieure, car parfois, lors de la fermeture des grues, l'une d'elles dans une position presque extrÃªme en raison du fonctionnement de sa propre remorque (deux piÃ¨ces sont installÃ©es dans le corps de la vanne, pour dÃ©terminer les positions extrÃªmes), s'arrÃªte pendant une fraction de seconde, puis un Â«rebondÂ» se produit (en raison du jeu dans les engrenages de la boÃ®te de vitesses ), puis une tentative rÃ©pÃ©tÃ©e de serrer la vanne Ã  boisseau sphÃ©rique et ainsi de suite jusqu'Ã  ce que le contrÃ´leur supprime la tension d'alimentation du servo variateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le vendeur sur le site dispose d'informations que les grues doivent fonctionner Ã  partir de 5 volts, dans ce cas la tension est moins fournie. </font><font style="vertical-align: inherit;">Le logiciel est conÃ§u pour que pour ouvrir et fermer les robinets, la tension ne soit fournie que pendant un certain temps (6 secondes), pÃ©riode pendant laquelle les robinets doivent avoir le temps de s'ouvrir ou de se fermer. </font><font style="vertical-align: inherit;">Il convient de noter que cet effet n'affecte pas la fermeture incomplÃ¨te du robinet, comme </font><font style="vertical-align: inherit;">ce moment survient aprÃ¨s que le robinet a complÃ¨tement coupÃ© le dÃ©bit d'eau. </font><font style="vertical-align: inherit;">Il est Ã©galement possible de mentionner que trop de tension aux servos (appliquÃ©e Ã  9 volts pour l'expÃ©rience) les fait se dÃ©placer par inertie plus loin (aprÃ¨s le dÃ©clenchement du fin de course) et buter contre la position extrÃªme avec le bruit caractÃ©ristique d'un impact.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vannes Ã  boisseau sphÃ©rique servo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les vannes d'arrÃªt semblent fiables, mais la partie Ã©lectronique a dÃ» Ãªtre finalisÃ©e. </font></font><br>
<br>
<img src="https://habrastorage.org/files/b73/ca0/7bb/b73ca07bb94e48278a4de7c54d6056bb.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous regardez le circuit de commande de la grue, vous remarquerez qu'il est contrÃ´lÃ© par une tension positive. </font><font style="vertical-align: inherit;">Le "moins" gÃ©nÃ©ral et deux fils "plus" de puissance du signal, l'un pour la fermeture, l'autre pour l'ouverture. </font><font style="vertical-align: inherit;">Mais ULN2003AN ne peut pas fonctionner dans ce mode; dans ce cas, lorsque la clÃ© est ouverte, la sortie gÃ©rÃ©e est connectÃ©e au moins. </font><font style="vertical-align: inherit;">La solution est de changer la polaritÃ© de contrÃ´le de la grue elle-mÃªme. </font><font style="vertical-align: inherit;">Pour ce faire, j'ai dÃ» Ã©changer les signaux de la "bande-annonce", car </font><font style="vertical-align: inherit;">en raison d'un changement de polaritÃ©, le moteur Ã©lectrique a tournÃ© dans la direction opposÃ©e (par rapport au circuit d'origine), tandis que les positions extrÃªmes sont maintenant dans des directions opposÃ©es. </font><font style="vertical-align: inherit;">En consÃ©quence, nous avons une grue avec un Â«plusÂ» commun et deux Â«inconvÃ©nientsÂ» de contrÃ´le. </font><font style="vertical-align: inherit;">Exactement ce qui est nÃ©cessaire!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grues avec servos en conditions de "combat".</font></font><br>
<br>
<img src="https://habrastorage.org/files/7b0/9c1/7ae/7b09c17aebf74188a522f485fc6361fe.jpg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lectures des compteurs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sÃ»r, aucune donnÃ©e n'est stockÃ©e dans le compteur lui-mÃªme, ce qui pourrait Ãªtre lu par deux fils qui en sont retirÃ©s. </font><font style="vertical-align: inherit;">Ce n'est qu'une chaÃ®ne avec un interrupteur Ã  lames et un aimant situÃ© sur une roue en rotation. </font><font style="vertical-align: inherit;">Les mesures avec un multimÃ¨tre n'ont montrÃ© la prÃ©sence d'aucune rÃ©sistance ou capacitÃ© Ã©lectrique dans le circuit. </font><font style="vertical-align: inherit;">Dans mes compteurs, le circuit (avec ouverture ultÃ©rieure) du commutateur Ã  lames se produit Ã  un dÃ©bit d'un litre d'eau. </font><font style="vertical-align: inherit;">Quelque part, il y avait des informations sur les compteurs, dont le signal est formÃ© tous les 10 litres. </font><font style="vertical-align: inherit;">Ceux. </font><font style="vertical-align: inherit;">ils sont diffÃ©rents. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le microcontrÃ´leur est nÃ©cessaire pour lire ces impulsions. </font><font style="vertical-align: inherit;">L'interface utilisateur de l'appareil, bien sÃ»r, fournit la valeur initiale.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De problÃ¨mes existants: en l'absence d'Ã©lectricitÃ©, la consommation d'eau ne sera pas prise en compte. Il y a un dÃ©faut matÃ©riel, il est nÃ©cessaire de le rÃ©parer - faites une alimentation de secours sur les batteries, cela est Ã©galement nÃ©cessaire pour les fonctions principales de l'appareil, sinon l'appareil ne pourra pas fermer les robinets si nÃ©cessaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De lÃ , les deux tÃ¢ches suivantes se prÃ©sentent:</font></font><br>
<ol>
<li>      . , ,    Â« Â»,     ,     () /     .      ,           (  ),       Â«Â»,   ,    (,        ),   ,      FreeRTOS.</li>
<li>        ,           ,          Â« Â».<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fermez les robinets?</font></font></b><div class="spoiler_text">,   , , ,       , 11  ,    ,  Â«Â» ,          ,      Â«Â»  , !<br>
</div></div></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les contrÃ´les</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encodeur</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SituÃ© Ã  cÃ´tÃ© de l'Ã©cran et conÃ§u pour naviguer dans le menu. </font><font style="vertical-align: inherit;">Rotation - passez Ã  l'Ã©lÃ©ment de menu suivant / prÃ©cÃ©dent, appuyez sur - sÃ©lectionnez / activez un Ã©lÃ©ment de menu.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Bouton rouge"</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moyen le plus simple pour fermer les robinets est d'appuyer sur le bouton rouge. </font><font style="vertical-align: inherit;">Bien que cela ne devrait pas Ãªtre utile, car </font><font style="vertical-align: inherit;">quelque temps auparavant, l'appareil lui-mÃªme devait tout faire. </font><font style="vertical-align: inherit;">Mais juste au cas oÃ¹, le bouton existe. </font><font style="vertical-align: inherit;">Presse rÃ©pÃ©tÃ©e, appui long, double clic, etc. </font><font style="vertical-align: inherit;">pas comptÃ©, seulement la premiÃ¨re presse et c'est tout. </font><font style="vertical-align: inherit;">Le mode Â«urgenceÂ» est activÃ©, il ne peut Ãªtre dÃ©sactivÃ© que par un Ã©lÃ©ment de menu spÃ©cial.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interrupteur Ã  bascule marche / arrÃªt</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils peuvent Ã©galement Ãªtre dÃ©sactivÃ©s par des taps, mais peuvent Ã©galement Ãªtre ouverts, bien sÃ»r, si le systÃ¨me n'est pas en mode Â«crashÂ». </font><font style="vertical-align: inherit;">Il peut Ãªtre utile pour l'arrÃªt temporaire de l'approvisionnement en eau.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED tricolore</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici aussi, tout est simple. </font><font style="vertical-align: inherit;">Pour indiquer le mode actuel: vert - tout est en ordre, rouge - tout n'est pas en ordre, bleu - les robinets sont bloquÃ©s Ã  l'aide de l'interrupteur Ã  bascule (voir paragraphe ci-dessus). </font><font style="vertical-align: inherit;">Le mÃ©lange des couleurs n'est pas utilisÃ©, trois suffisaient. </font><font style="vertical-align: inherit;">Mais ici, un problÃ¨me s'est posÃ©. </font><font style="vertical-align: inherit;">La lueur est si forte qu'elle Ã©blouit lorsque vous regardez l'Ã©cran. </font><font style="vertical-align: inherit;">470 ohms pour chaque couleur n'Ã©tait pas suffisant. </font><font style="vertical-align: inherit;">CorrigÃ© par programme. </font><font style="vertical-align: inherit;">Lorsque l'Ã©cran est dans un Ã©tat actif (et il est actif lorsque vous utilisez les commandes et pendant un certain temps), cette LED est Ã©teinte.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'appareil fonctionne, des tests pÃ©riodiques montrent qu'il fonctionne correctement. </font><font style="vertical-align: inherit;">Il ne gÃ¨le pas, il n'est pas buggÃ©. </font><font style="vertical-align: inherit;">Bien que je sache oÃ¹ il y a des erreurs potentielles mais non critiques dans le code, cela n'est pas abordÃ© dans cet article. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources, projet Keil uVision 5, fichier de projet pour STM32CubeMX</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr382065/">https://habr.com/ru/post/fr382065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr382051/index.html">Pourquoi dÃ©clarer le colis pochta.fi aux douanes finlandaises?</a></li>
<li><a href="../fr382053/index.html">ADN de lapin tordu Ã©tudiÃ©</a></li>
<li><a href="../fr382057/index.html">Mauvais conseils Ã  un guide copter dÃ©butant. Partie 2</a></li>
<li><a href="../fr382059/index.html">[Poste d'information] SystÃ¨mes de fichiers pour lecteurs USB et cartes mÃ©moire</a></li>
<li><a href="../fr382063/index.html">Organes sensoriels de la voiture</a></li>
<li><a href="../fr382067/index.html">L'Ã©criture manuscrite d'un rÃ©seau neuronal prÃ©tend Ãªtre l'Ã©criture manuscrite d'une personne</a></li>
<li><a href="../fr382071/index.html">Pour la premiÃ¨re fois, un programme est meilleur qu'une personne en reconnaissance de formes</a></li>
<li><a href="../fr382073/index.html">Sauvetage de noyade - le travail des robots</a></li>
<li><a href="../fr382075/index.html">Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¾ Ñ‚Ğ¾Ğ¼ ĞºĞ°Ğº Ñ Ğ¿Ñ€Ğ¸Ğ²ĞµĞ· NAO Ğ² Ğ Ğ¾ÑÑĞ¸Ñ</a></li>
<li><a href="../fr382077/index.html">Jimmy Wales lance un rÃ©seau social et un opÃ©rateur tÃ©lÃ©phonique pour aider les gens Ã  faire un don Ã  un organisme de bienfaisance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>