<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤞🏿 👊🏻 🕌 Système de protection contre les fuites 💳 🐴 👩🏻‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je veux partager mon expérience dans la création d'un appareil qui était non seulement intéressant à mettre en œuvre, mais qui pouvait également être ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Système de protection contre les fuites</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/382065/"><img src="https://habrastorage.org/files/055/477/b38/055477b3811b49e2b9123bdccca872f1.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je veux partager mon expérience dans la création d'un appareil qui était non seulement intéressant à mettre en œuvre, mais qui pouvait également être bénéfique. </font><font style="vertical-align: inherit;">Peut-être que quelqu'un dira qu'il était possible de faire quelque chose de plus simple, mais ce n'est pas notre façon ...</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout a commencé avec le fait qu'après la réparation de l'appartement un problème potentiel a été découvert. </font><font style="vertical-align: inherit;">En cas de fuite quelque part, il ne sera pas possible de se rendre aux grues pour entrer dans l'appartement sans certains efforts physiques et dextérité, car la trappe de fermeture des grues n'est pas très bien installée. </font><font style="vertical-align: inherit;">Par conséquent, en cas de besoin urgent (accident) de fermer rapidement les robinets ne fonctionnera pas. </font><font style="vertical-align: inherit;">Il était nécessaire de faire quelque chose avec cela, et une solution est apparue - pour saisir l'opportunité à distance, c'est-à-dire </font><font style="vertical-align: inherit;">sans ouvrir la trappe, arrêtez l'alimentation en eau. </font><font style="vertical-align: inherit;">Et en prime, pour mettre en œuvre tout ce qui peut être fait confiance avec l'électronique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi ressemble l'appareil. </font></font><br>
<br>
<img src="https://habrastorage.org/files/9fa/6a7/137/9fa6a713753a403ab27be8f6c4ffe0da.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Principales caractéristiques:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coupez l'alimentation en eau indépendamment en cas de fuite</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coupez l'alimentation en eau "en mode manuel" - sur le panneau avant il y a un "bouton rouge" et un interrupteur à bascule à deux positions</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affichage des relevés de compteur sur son propre écran</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher d'autres informations utiles sur l'écran</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est pas possible, mais prévoit:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travaillez à partir d'une source d'alimentation de secours. </font><font style="vertical-align: inherit;">Maintenant, en cas de panne de courant - l'appareil est inutile</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec des capteurs de fuite sans fil</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nettoyez vous-même les robinets. </font><font style="vertical-align: inherit;">Afin de ne pas «devenir acide», il est conseillé de les ouvrir / fermer une fois par mois</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissez-vous des événements sur un smartphone et soyez contrôlé par "air"</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il ne peut pas (et même si cela est très nécessaire):</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avoir plusieurs canaux pour lire différents capteurs de fuite câblés, maintenant tous les capteurs (5 pièces) sont connectés en parallèle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gérez les grues individuellement. </font><font style="vertical-align: inherit;">Il y en a deux (un sur l'eau chaude, le second sur l'eau froide), et ils sont connectés en parallèle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contrôle de rupture des capteurs</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici une description des composants et de leur fonction (prix en date de juillet 2015).</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    1/2 " DN15 DC5V</a> ( CR02,  ,     ) — 3080   </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Maple Mini (  stm32f103c8t6)</a>    — 233 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SPI TFT LCD  ILI9341</a> — 302 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Ds3231 + AT24C32</a>   ,  ,   — 4  EEPROM — 38 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ULN2003 DIP-16</a> —    — 123 /10  ( )</li>
<li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> — 239 /10  (  )</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>     — 164 /5  ( )</li>
<li>  ,  : ,  (    ), ,  , </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, j'avais également besoin d'un programmeur / émulateur, j'ai utilisé celui-ci: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARM Emulator, prend en charge ARM7, ARM9, ARM11, Cortex-M3 core, ADS, IAR, STM32, interface JTAG, version V8 à double tampon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Parmi les fonctionnalités, il est possible de mentionner qu'en plus des </font><font style="vertical-align: inherit;">fils </font><font style="vertical-align: inherit;">standard pour la </font><font style="vertical-align: inherit;">programmation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , j'ai dû lui appliquer la tension d'alimentation actuelle de la puce programmable, 3,3 volts dans mon cas. </font><font style="vertical-align: inherit;">Il est nécessaire que le programmeur comprenne les niveaux de tension des valeurs logiques. </font><font style="vertical-align: inherit;">Sans cela, la puce programmable ne voulait pas être détectée. </font><font style="vertical-align: inherit;">En outre, ce programmeur a la capacité d'alimenter un appareil programmable, une broche est fournie pour cela, la tension est activée / désactivée par l'utilitaire JLink.exe.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus sur le fer</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microcontrôleur</font></font></h3><img src="https://habrastorage.org/files/73d/47b/3b3/73d47b3b3ca9476dafadf503b3162931.jpg" width="300" align="right"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le cerveau de tout le système est un microcontrôleur 32 bits de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> soigneusement soudé par des travailleurs chinois dans des usines chinoises à une carte qui est «compatible» avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leaf Maple Mini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À propos de Leaf Maple Mini</font></font></b><div class="spoiler_text">   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">eta4ever</a> <blockquote>  ,  </blockquote>        «»     ,    …<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dispose de 48 conclusions. </font><font style="vertical-align: inherit;">Le cœur fonctionne à 72 MHz, a intégré SRAM - 20 Ko et Flash - 128 Ko. </font><font style="vertical-align: inherit;">Plus de détails </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ces paramètres encouragent certainement l'utilisation d'outils et d'outils de haut niveau, c'est-à-dire </font><font style="vertical-align: inherit;">ce sont </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FreeRTOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , écran couleur graphique, C ++, etc. </font><font style="vertical-align: inherit;">(et pas deux LED et assembleur). </font><font style="vertical-align: inherit;">En général, ne vous refusez rien ... sauf C ++, mais ce n'est pas un problème de puce.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi?</font></font></b><div class="spoiler_text">       C++ ,  ,     ,     . ,     C++      ,   ,  ,   , ..      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32CubeMX</a>      ,   FreeRTOS.     ,      .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation des conclusions du microcontrôleur. </font><font style="vertical-align: inherit;">De là, vous pouvez deviner à quoi est connecté.</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/173/70e/067/17370e0676c64b75b9ddf7ec11a1ae29.png"><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher</font></font></h3><br>
<img src="https://habrastorage.org/files/c09/361/5b6/c093615b66774fb7969845db6584ee70.jpg" width="300" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le module avec un écran TFT de 320x240 pixels construit sur un contrôleur compatible avec ILI9341 est responsable de l'affichage des informations; il fonctionne par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à la fréquence maximale possible pour ce bundle (18MHz). </font><font style="vertical-align: inherit;">SPI n'est connecté au microcontrôleur que dans une seule direction, la sortie de lecture des données du module d'affichage reste suspendue en l'air, car </font><font style="vertical-align: inherit;">Je n'ai pas proposé cette fonctionnalité, mais je l'ai enregistrée sur les jambes libres du microcontrôleur. </font><font style="vertical-align: inherit;">Le transfert de données fonctionne sur </font></font><abbr title="DMA ou Direct Memory Access - technologie d'accès direct à la mémoire contournant le processeur central"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DMA</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un connecteur pour connecter une carte SD est soudé au module à l'arrière, je n'ai pas testé de travailler avec une carte SD et le connecteur n'est pas impliqué dans ce projet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module RTC et EEPROM</font></font></h3><br>
<img src="https://habrastorage.org/files/527/406/51e/52740651ee344478a84c0a15f43c3c51.jpg" width="300" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'horloge du module est implémentée avec une puce DS3231. Je n'ai pas causé de problèmes particuliers, le seul inconvénient était que toutes les valeurs (date, heure) sont stockées dans des registres au </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format BCD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lorsque deux chiffres décimaux sont reflétés dans un octet (dans les quatre bits supérieurs - le chiffre le plus significatif, dans le bas - le chiffre le moins significatif) . Par exemple, la valeur «38 minutes» est stockée en tant que valeur décimale 56 (il s'agit de «38» dans la notation hexadécimale). Il n'a pas été possible de savoir s'il était possible de passer au format binaire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le module a sa propre batterie, donc à chaque fois que vous perdez de l’alimentation, vous n’avez pas à régler l’heure et la date. De plus, le microcircuit AT24C32 est soudé sur la carte du module, ayant jusqu'à 32768 bits EEPROM! Autrement dit, il s'agit de 4 Ko de mémoire non volatile. L'horloge et la mémoire se trouvent sur le même bus I2C. À l'heure actuelle, la mémoire est utilisée uniquement pour stocker les paramètres de l'appareil, la valeur actuelle des lectures des compteurs et autre chose. finalement occupé ... 25 octets. Plus tard, il sera utilisé pour garder des journaux de divers événements, et éventuellement pour garder des statistiques de consommation (je ne sais pas pourquoi, mais il y aura une occasion de programmer l'affichage des graphiques).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus des contacts du bus I2C et de l'alimentation, il y en a deux de plus sur la carte. </font><font style="vertical-align: inherit;">"SQW" est le signal du réveil qui peut être programmé via les registres et "32K" est la fréquence générée par le DS3231 pour les autres appareils. </font><font style="vertical-align: inherit;">Ce projet ne s'applique pas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module avec capteur d'humidité</font></font></h3><br>
<img src="https://habrastorage.org/files/6a9/b19/bc1/6a9b19bc17f64a42bc008a3c5a3fe058.jpg" align="right" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il sert de tampon entre le monde extérieur et le microcontrôleur. </font><font style="vertical-align: inherit;">Les fils allant aux sondes au total ont une longueur d'environ 10 mètres, sans écran. </font><font style="vertical-align: inherit;">Fils téléphoniques conventionnels à deux fils. </font><font style="vertical-align: inherit;">En cas de coup statique, j'espère que seul ce module mourra, mais pas le microcontrôleur. </font><font style="vertical-align: inherit;">Il est capable de mesurer la résistance entre deux électrodes et de donner ces informations sous forme analogique (tension de 0 à tension d'alimentation) et numérique (0/1, le module dispose d'une résistance variable qui peut être ajustée à la limite de fonctionnement).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a eu des problèmes mineurs avec ce module. Lors de l'application et de la suppression de la tension d'alimentation, le module à la sortie numérique a signalé un déclenchement, cela peut également être vu par le clignotement de la LED pendant une fraction de seconde (sur la carte du module, une LED est installée en parallèle avec la sortie numérique). Le microcontrôleur a réussi à lire un signal anormal lorsque l'alimentation du système a été appliquée / réinitialisée (problème n ° 1). La solution a été mise en œuvre en sautant de courtes impulsions de fonctionnement, en prévision d'une condition fixée pendant un certain temps.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La résistance variable a un très petit angle de réglage, auquel je n'ai pas pu trouver la frontière entre l'absence de faux positifs et une bonne sensibilité (problème n ° 2). Il a ensuite été implémenté en lisant le signal analogique via le microcontrôleur ADC. Dans le même temps, il est devenu possible de définir la limite de réponse dans les paramètres de l'appareil en tant que paramètre. La possibilité d'ajuster le niveau de réponse est désormais considérée comme superflue, et il est probablement préférable de coder en dur la valeur limite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a été remarqué qu'après plusieurs minutes de fonctionnement (échauffement?), Le module a soudainement commencé à signaler un fonctionnement spontané (problème numéro 3, combien d'entre eux?!).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À la frontière des réponses anormales, l'intensité de la lueur LED (sur le module) augmente ou diminue progressivement, comme si elle était contrôlée par un générateur PWM, il est clair que c'est du bruit et c'est de la haute fréquence, on pourrait en attendre la même chose à la sortie «numérique» du module (problème n ° 4 ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je précise que tous ces problèmes ont été résolus lors de la mise en œuvre du signal analogique du module. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les sondes (parties de capteurs situées directement dans des lieux d'accumulation d'eau en cas d'accident) sont réalisées à partir de moyens improvisés. Il s'agit d'étain (acier) et d'une petite boîte de jonction ronde, modifiée mécaniquement au type souhaité et avec des fils soudés à l'intérieur. Lorsque de l'eau pénètre entre les paires d'électrodes, la résistance diminue et est considérée par le contrôleur comme une «fuite».</font></font><br>
<br>
<img src="https://habrastorage.org/files/bc7/366/3ad/bc73663ad6f048079b0ca835a353a0b6.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les tests en laboratoire ont montré que le produit remplit bien sa fonction et n'est pas un maillon faible du système.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nutrition</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ensemble du système fonctionne à partir de la charge du téléphone - 5 volts, 2A (ici avec une marge). </font><font style="vertical-align: inherit;">Sur la carte Maple Mini, un régulateur de tension de 3,3 volts est installé, la tension d'entrée peut aller jusqu'à 12 volts, les caractéristiques du stabilisateur le permettent, mais une tension aussi élevée n'est pas pratique à utiliser, plus à ce sujet ci-dessous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec un stabilisateur, 3,3 volts vont également à la puissance des modules RTC, TFT et au module de mesure d'humidité. </font><font style="vertical-align: inherit;">Les grues sont connectées via l'ensemble interrupteur d'alimentation ULN2003AN, directement à partir de l'alimentation, c'est-à-dire </font><font style="vertical-align: inherit;">travailler à partir de 5 volts, moins la chute sur les touches. </font><font style="vertical-align: inherit;">ULN2003AN n'utilise que deux des sept canaux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, il est conseillé de remplacer l'alimentation par une autre, avec une tension légèrement supérieure, car parfois, lors de la fermeture des grues, l'une d'elles dans une position presque extrême en raison du fonctionnement de sa propre remorque (deux pièces sont installées dans le corps de la vanne, pour déterminer les positions extrêmes), s'arrête pendant une fraction de seconde, puis un «rebond» se produit (en raison du jeu dans les engrenages de la boîte de vitesses ), puis une tentative répétée de serrer la vanne à boisseau sphérique et ainsi de suite jusqu'à ce que le contrôleur supprime la tension d'alimentation du servo variateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le vendeur sur le site dispose d'informations que les grues doivent fonctionner à partir de 5 volts, dans ce cas la tension est moins fournie. </font><font style="vertical-align: inherit;">Le logiciel est conçu pour que pour ouvrir et fermer les robinets, la tension ne soit fournie que pendant un certain temps (6 secondes), période pendant laquelle les robinets doivent avoir le temps de s'ouvrir ou de se fermer. </font><font style="vertical-align: inherit;">Il convient de noter que cet effet n'affecte pas la fermeture incomplète du robinet, comme </font><font style="vertical-align: inherit;">ce moment survient après que le robinet a complètement coupé le débit d'eau. </font><font style="vertical-align: inherit;">Il est également possible de mentionner que trop de tension aux servos (appliquée à 9 volts pour l'expérience) les fait se déplacer par inertie plus loin (après le déclenchement du fin de course) et buter contre la position extrême avec le bruit caractéristique d'un impact.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vannes à boisseau sphérique servo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les vannes d'arrêt semblent fiables, mais la partie électronique a dû être finalisée. </font></font><br>
<br>
<img src="https://habrastorage.org/files/b73/ca0/7bb/b73ca07bb94e48278a4de7c54d6056bb.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous regardez le circuit de commande de la grue, vous remarquerez qu'il est contrôlé par une tension positive. </font><font style="vertical-align: inherit;">Le "moins" général et deux fils "plus" de puissance du signal, l'un pour la fermeture, l'autre pour l'ouverture. </font><font style="vertical-align: inherit;">Mais ULN2003AN ne peut pas fonctionner dans ce mode; dans ce cas, lorsque la clé est ouverte, la sortie gérée est connectée au moins. </font><font style="vertical-align: inherit;">La solution est de changer la polarité de contrôle de la grue elle-même. </font><font style="vertical-align: inherit;">Pour ce faire, j'ai dû échanger les signaux de la "bande-annonce", car </font><font style="vertical-align: inherit;">en raison d'un changement de polarité, le moteur électrique a tourné dans la direction opposée (par rapport au circuit d'origine), tandis que les positions extrêmes sont maintenant dans des directions opposées. </font><font style="vertical-align: inherit;">En conséquence, nous avons une grue avec un «plus» commun et deux «inconvénients» de contrôle. </font><font style="vertical-align: inherit;">Exactement ce qui est nécessaire!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grues avec servos en conditions de "combat".</font></font><br>
<br>
<img src="https://habrastorage.org/files/7b0/9c1/7ae/7b09c17aebf74188a522f485fc6361fe.jpg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lectures des compteurs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, aucune donnée n'est stockée dans le compteur lui-même, ce qui pourrait être lu par deux fils qui en sont retirés. </font><font style="vertical-align: inherit;">Ce n'est qu'une chaîne avec un interrupteur à lames et un aimant situé sur une roue en rotation. </font><font style="vertical-align: inherit;">Les mesures avec un multimètre n'ont montré la présence d'aucune résistance ou capacité électrique dans le circuit. </font><font style="vertical-align: inherit;">Dans mes compteurs, le circuit (avec ouverture ultérieure) du commutateur à lames se produit à un débit d'un litre d'eau. </font><font style="vertical-align: inherit;">Quelque part, il y avait des informations sur les compteurs, dont le signal est formé tous les 10 litres. </font><font style="vertical-align: inherit;">Ceux. </font><font style="vertical-align: inherit;">ils sont différents. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le microcontrôleur est nécessaire pour lire ces impulsions. </font><font style="vertical-align: inherit;">L'interface utilisateur de l'appareil, bien sûr, fournit la valeur initiale.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De problèmes existants: en l'absence d'électricité, la consommation d'eau ne sera pas prise en compte. Il y a un défaut matériel, il est nécessaire de le réparer - faites une alimentation de secours sur les batteries, cela est également nécessaire pour les fonctions principales de l'appareil, sinon l'appareil ne pourra pas fermer les robinets si nécessaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De là, les deux tâches suivantes se présentent:</font></font><br>
<ol>
<li>      . , ,    « »,     ,     () /     .      ,           (  ),       «»,   ,    (,        ),   ,      FreeRTOS.</li>
<li>        ,           ,          « ».<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fermez les robinets?</font></font></b><div class="spoiler_text">,   , , ,       , 11  ,    ,  «» ,          ,      «»  , !<br>
</div></div></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les contrôles</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encodeur</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Situé à côté de l'écran et conçu pour naviguer dans le menu. </font><font style="vertical-align: inherit;">Rotation - passez à l'élément de menu suivant / précédent, appuyez sur - sélectionnez / activez un élément de menu.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Bouton rouge"</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moyen le plus simple pour fermer les robinets est d'appuyer sur le bouton rouge. </font><font style="vertical-align: inherit;">Bien que cela ne devrait pas être utile, car </font><font style="vertical-align: inherit;">quelque temps auparavant, l'appareil lui-même devait tout faire. </font><font style="vertical-align: inherit;">Mais juste au cas où, le bouton existe. </font><font style="vertical-align: inherit;">Presse répétée, appui long, double clic, etc. </font><font style="vertical-align: inherit;">pas compté, seulement la première presse et c'est tout. </font><font style="vertical-align: inherit;">Le mode «urgence» est activé, il ne peut être désactivé que par un élément de menu spécial.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interrupteur à bascule marche / arrêt</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils peuvent également être désactivés par des taps, mais peuvent également être ouverts, bien sûr, si le système n'est pas en mode «crash». </font><font style="vertical-align: inherit;">Il peut être utile pour l'arrêt temporaire de l'approvisionnement en eau.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED tricolore</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici aussi, tout est simple. </font><font style="vertical-align: inherit;">Pour indiquer le mode actuel: vert - tout est en ordre, rouge - tout n'est pas en ordre, bleu - les robinets sont bloqués à l'aide de l'interrupteur à bascule (voir paragraphe ci-dessus). </font><font style="vertical-align: inherit;">Le mélange des couleurs n'est pas utilisé, trois suffisaient. </font><font style="vertical-align: inherit;">Mais ici, un problème s'est posé. </font><font style="vertical-align: inherit;">La lueur est si forte qu'elle éblouit lorsque vous regardez l'écran. </font><font style="vertical-align: inherit;">470 ohms pour chaque couleur n'était pas suffisant. </font><font style="vertical-align: inherit;">Corrigé par programme. </font><font style="vertical-align: inherit;">Lorsque l'écran est dans un état actif (et il est actif lorsque vous utilisez les commandes et pendant un certain temps), cette LED est éteinte.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'appareil fonctionne, des tests périodiques montrent qu'il fonctionne correctement. </font><font style="vertical-align: inherit;">Il ne gèle pas, il n'est pas buggé. </font><font style="vertical-align: inherit;">Bien que je sache où il y a des erreurs potentielles mais non critiques dans le code, cela n'est pas abordé dans cet article. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources, projet Keil uVision 5, fichier de projet pour STM32CubeMX</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr382065/">https://habr.com/ru/post/fr382065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr382051/index.html">Pourquoi déclarer le colis pochta.fi aux douanes finlandaises?</a></li>
<li><a href="../fr382053/index.html">ADN de lapin tordu étudié</a></li>
<li><a href="../fr382057/index.html">Mauvais conseils à un guide copter débutant. Partie 2</a></li>
<li><a href="../fr382059/index.html">[Poste d'information] Systèmes de fichiers pour lecteurs USB et cartes mémoire</a></li>
<li><a href="../fr382063/index.html">Organes sensoriels de la voiture</a></li>
<li><a href="../fr382067/index.html">L'écriture manuscrite d'un réseau neuronal prétend être l'écriture manuscrite d'une personne</a></li>
<li><a href="../fr382071/index.html">Pour la première fois, un programme est meilleur qu'une personne en reconnaissance de formes</a></li>
<li><a href="../fr382073/index.html">Sauvetage de noyade - le travail des robots</a></li>
<li><a href="../fr382075/index.html">История о том как я привез NAO в Россию</a></li>
<li><a href="../fr382077/index.html">Jimmy Wales lance un réseau social et un opérateur téléphonique pour aider les gens à faire un don à un organisme de bienfaisance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>