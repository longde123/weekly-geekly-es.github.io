<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÄ üßò üàÇÔ∏è CRDT: types de donn√©es r√©pliqu√©es sans conflit üë©üèæ‚Äçüî¨ üêé üòª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comment compter les visites sur la page google.com? Et comment stocker le compteur de likes d'utilisateurs tr√®s populaires? Cet article propose d'envi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CRDT: types de donn√©es r√©pliqu√©es sans conflit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418897/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/r1/we/lm/r1welma_rgaxinwrbp7ekni1tdo.png"></div><br>  Comment compter les visites sur la page google.com?  Et comment stocker le compteur de likes d'utilisateurs tr√®s populaires?  Cet article propose d'envisager de r√©soudre ces probl√®mes √† l'aide de CRDT (Conflict-free Replicated Data Types, qui en russe se traduit approximativement par Conflict-Free Replicated Data Types), et dans le cas plus g√©n√©ral, des t√¢ches de synchronisation de r√©pliques dans un syst√®me distribu√© avec plusieurs n≈ìuds principaux. <br><a name="habracut"></a><br><h1>  1. Introduction </h1><br>  Nous sommes habitu√©s depuis longtemps √† utiliser des applications telles qu'un calendrier ou un service de notes tel qu'Evernote.  Ils sont unis par le fait qu'ils vous permettent de travailler hors ligne, depuis plusieurs appareils et vers plusieurs personnes en m√™me temps (sur les m√™mes donn√©es).  Le d√©fi auquel sont confront√©s les d√©veloppeurs de chacune de ces applications est de savoir comment assurer la synchronisation la plus ¬´fluide¬ª des donn√©es modifi√©es simultan√©ment sur plusieurs appareils.  Id√©alement, la participation des utilisateurs ne devrait pas du tout √™tre requise pour r√©soudre les conflits de fusion. <br><br>  Dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent, nous avons</a> d√©j√† envisag√© une approche pour r√©soudre ces probl√®mes - Transformation op√©rationnelle, il d√©crira √©galement une m√©thode tr√®s similaire qui pr√©sente √† la fois des avantages et des inconv√©nients (par exemple, CRDT pour JSON n'a pas encore √©t√© invent√©. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Mise</a> √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">jour</a> : Merci √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">msvn</a> pour le lien, ici <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">voici un</a> projet des auteurs d'un article de recherche sur l'impl√©mentation de JSON en CRDT) <br><br><h1>  2. Forte coh√©rence √©ventuelle </h1><br>  R√©cemment, beaucoup de travaux ont √©t√© √©crits et beaucoup de recherches ont √©t√© faites dans le domaine de la coh√©rence √©ventuelle.  √Ä mon avis, il y a maintenant une forte tendance √† passer d'une forte coh√©rence √† diverses options de coh√©rence, √† rechercher quelle coh√©rence dans quelles situations / syst√®mes il est plus rentable d'appliquer, √† repenser les d√©finitions existantes.  Cela conduit √† une certaine confusion, par exemple, lorsque les auteurs de certains travaux, parlant de coh√©rence, signifient une coh√©rence √©ventuelle avec une propri√©t√© suppl√©mentaire, et que d'autres auteurs utilisent une certaine terminologie pour cela. <br><br>  La question pos√©e par les auteurs de l'un des articles critique la d√©finition actuelle de la coh√©rence √©ventuelle: selon elle, si votre syst√®me r√©pond toujours ¬´42¬ª √† toutes les demandes, alors tout est OK, il est finalement coh√©rent. <br><br>  Sans violer l'exactitude de cet article, j'utiliserai, suivant les auteurs des articles originaux, la terminologie suivante (veuillez noter que ce ne sont pas des d√©finitions strictes, ce sont des diff√©rences): <br><br><ul><li>  Forte coh√©rence (SC): toutes les op√©rations d'√©criture sont strictement ordonn√©es, une demande de lecture sur n'importe quelle r√©plique renvoie le m√™me r√©sultat enregistr√© en dernier.  <b>Un</b> consensus en <b>temps r√©el</b> est n√©cessaire pour r√©soudre les conflits (avec les cons√©quences qui en d√©coulent), peut r√©sister √† une chute √† n / 2 - 1 n≈ìuds. </li><li>  Coh√©rence √©ventuelle (EC): mettez √† jour les donn√©es localement, envoyez la mise √† jour plus loin.  La lecture sur diff√©rentes r√©pliques peut renvoyer des donn√©es p√©rim√©es.  En cas de conflit, soit nous reculons, soit nous d√©cidons quoi faire.  T.O.  un consensus est encore n√©cessaire, mais <b>plus en temps r√©el</b> . </li><li>  Forte coh√©rence √©ventuelle (SEC): EC + pour la r√©solution des conflits, les r√©pliques ont un algorithme pr√©d√©fini.  T.O.  <b>le consensus n'est pas n√©cessaire</b> , il peut r√©sister √† une chute √† n - 1 n≈ìuds. </li></ul><br>  Notez que SEC (pour ainsi dire) r√©sout le probl√®me du th√©or√®me CAP: les trois propri√©t√©s sont satisfaites. <br><br>  Donc, nous sommes pr√™ts √† faire don de SC et voulons avoir un certain ensemble de types de donn√©es de base pour notre syst√®me distribu√© potentiellement instable qui r√©soudra automatiquement les conflits d'√©criture pour nous (aucune interaction utilisateur ou demande √† un arbitre n'est requise) <br><br><h1>  3. T√¢ches concernant les likes et les hits </h1><br>  Sans aucun doute, il existe plusieurs algorithmes pour r√©soudre ces probl√®mes.  CRDT offre un moyen assez √©l√©gant et facile. <br><br><h3>  Nombre de visites sur Google.com: </h3><br>  google.com traite environ 150 000 demandes par seconde du monde entier.  De toute √©vidence, le compteur doit √™tre mis √† jour de mani√®re asynchrone.  Les files d'attente r√©solvent partiellement le probl√®me - par exemple, si nous fournissons une API externe pour obtenir cette valeur, nous devrons effectuer une r√©plication afin de ne pas mettre le r√©f√©rentiel avec des demandes de lecture.  Et s'il existe d√©j√† une r√©plication, peut-√™tre sans files d'attente globales? <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/wv/4y/tn/wv4ytnmej1xm2tbhen3ddztgv6w.png" alt="image"></div><br><br><h3>  Compter les go√ªts des utilisateurs: </h3><br>  La t√¢che est tr√®s similaire √† la pr√©c√©dente, seulement maintenant vous devez compter les hits uniques. <br><br><h1>  4. Terminologie </h1><br>  Pour une compr√©hension plus compl√®te de l'article, vous devez conna√Ætre les termes suivants: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Idempotence</a> <br>  Dit que l'application de l'op√©ration plusieurs fois ne change pas le r√©sultat. <br>  Exemples - op√©ration GET ou addition avec z√©ro: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.849ex" height="2.66ex" viewBox="0 -832 5532 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-78" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-29" x="1512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-3D" x="2179" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-78" x="3236" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-2B" x="4030" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-30" x="5031" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> f (x) = x + 0 </script><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Commutativit√©</a> <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.312ex" height="2.66ex" viewBox="0 -832 7023.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-78" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-2C" x="1512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-79" x="1957" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-29" x="2455" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-3D" x="3122" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-66" x="4178" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-28" x="4729" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-79" x="5118" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-2C" x="5616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-78" x="6061" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-29" x="6633" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> f (x, y) = f (y, x) </script><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ordre partiel</a> <br>  R√©flexivit√© + Transitivit√© + Antisym√©trie <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Demi-r√©seau</a> <br>  Ensemble partiellement ordonn√© avec face sup√©rieure (inf√©rieure) exacte <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Version vecteur</a> <br>  Un vecteur de dimension est √©gal au nombre de n≈ìuds et chaque n≈ìud, lorsqu'un certain √©v√©nement se produit, incr√©mente sa valeur dans le vecteur.  Pendant la synchronisation, les donn√©es sont transmises avec ce vecteur et cela introduit une relation d'ordre, qui vous permet de d√©terminer quelle r√©plique contient des donn√©es anciennes / nouvelles. </li></ol><br><h1>  5. Mod√®les de synchronisation </h1><br><h3>  Bas√© sur l'√©tat: </h3><br>  √âgalement appel√© synchronisation passive, il forme le type de donn√©es r√©pliqu√© convergent - CvRDT. <br>  Il est utilis√© dans des syst√®mes de fichiers tels que NFS, AFS, Coda et dans les stockages KV Riak, Dynamo <br>  Dans ce cas, les r√©pliques √©changent des √©tats directement, la r√©plique r√©ceptrice fusionne l'√©tat re√ßu avec son √©tat actuel. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/ac/r_/7b/acr_7blhm_vkl7rwgfenmjpvdus.png" alt="image"></div><br>  Pour effectuer la convergence des r√©pliques √† l'aide de cette synchronisation, il est n√©cessaire que: <br><br><ul><li>  Les donn√©es ont form√© un demi-r√©seau </li><li>  La fonction de fusion a produit une limite sup√©rieure exacte </li><li>  Les r√©pliques ont form√© un graphique connect√©. </li></ul><br>  Un exemple: <br><br><ul><li>  Jeu de donn√©es: nombres naturels <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.088ex" height="2.057ex" viewBox="0 -780.1 4343.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-62" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-62" x="3025" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-4E" x="3455" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> \ mathbb {N} </script></li><li>  Article minimum: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.86ex" height="2.419ex" viewBox="0 -780.1 3384 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-2212" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-69" x="1028" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-6E" x="1374" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-66" x="1974" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-74" x="2525" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-79" x="2886" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> - \ infty </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="25.379ex" height="2.66ex" viewBox="0 -832 10926.9 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-75" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-73" x="1123" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-69" x="1592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-6F" x="1938" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-6E" x="2423" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-28" x="3024" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-78" x="3413" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-2C" x="3986" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-79" x="4431" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-29" x="4928" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-3D" x="5595" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-6D" x="6652" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-61" x="7530" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-78" x="8060" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-28" x="8632" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-78" x="9022" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-2C" x="9594" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMATHI-79" x="10039" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhjFEkq42tRR113FwchBPTpIxHTOWA#MJMAIN-29" x="10537" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> fusion (x, y) = max (x, y) </script></li></ul><br>  De telles exigences nous donnent une fonction de fusion <b>commutative</b> et <b>idempotente</b> qui <b>cro√Æt de fa√ßon monotone</b> sur un ensemble de donn√©es donn√©: <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/jn/nw/vl/jnnwvlfp_tjkank2zknwdcbj-oc.png" alt="image"></div><br>  Cela garantit que les r√©pliques convergent t√¥t ou tard et vous permet de ne pas vous soucier du protocole de transfert de donn√©es - <b>nous pouvons perdre des messages avec un nouvel √©tat, les envoyer plusieurs fois et m√™me les envoyer dans n'importe quel ordre</b> . <br><br><h3>  Bas√© sur l'op√©ration: </h3><br>  √âgalement appel√© synchronisation active, il forme le type de donn√©es r√©pliqu√© commutatif - CmRDT. <br>  Utilis√© dans les syst√®mes coop√©ratifs tels que Bayou, Rover, IceCube, Telex. <br><br>  Dans ce cas, les r√©pliques √©changent des op√©rations de mise √† jour d'√©tat.  Lors de la mise √† jour des donn√©es, la r√©plique d'origine: <br><br><ul><li>  Appelle la m√©thode generate (), qui renvoie la m√©thode effector () √† ex√©cuter sur les r√©pliques restantes.  En d'autres termes, effecteur () est la fermeture pour changer l'√©tat des r√©pliques restantes. </li><li>  Application d'un effecteur √† un √©tat local </li><li>  Envoie effecteur √† toutes les autres r√©pliques </li></ul><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/bd/i3/ps/bdi3pshr57wi0udnldnurhcdpfs.png" alt="image"></div><br>  Pour effectuer la convergence des r√©pliques, les conditions suivantes doivent √™tre remplies: <br><br><ul><li>  Protocole de livraison fiable </li><li>  Si l'effecteur est livr√© √† toutes les r√©pliques conform√©ment √† l'ordre entr√© (pour un type donn√©), alors les effecteurs simultan√©s sont commutatifs, <b>ou</b> </li><li>  Si l'effecteur est livr√© √† toutes les r√©pliques sans tenir compte de la commande, alors tous les effecteurs sont commutatifs. </li><li>  Dans le cas o√π l'effecteur peut √™tre livr√© plusieurs fois, il doit √™tre idempotent </li><li>  Certaines impl√©mentations utilisent des files d'attente (Kafka) dans le cadre du protocole de livraison. </li></ul><br><h3>  Bas√© sur Delta: </h3><br>  En consid√©rant l'√©tat / op, il est facile de remarquer que si une mise √† jour ne modifie qu'une partie de l'√©tat, alors cela n'a aucun sens d'envoyer tout l'√©tat, et si un grand nombre de modifications affectent un √©tat (par exemple, un compteur), alors vous pouvez envoyer un, changement agr√©g√© et pas toutes les op√©rations changements. <br><br>  La synchronisation delta combine les deux approches et envoie des mutateurs delta qui mettent √† jour l'√©tat en fonction de la derni√®re date de synchronisation.  Lors de la synchronisation initiale, il est n√©cessaire d'envoyer compl√®tement l'√©tat, et certaines impl√©mentations dans de tels cas prennent d√©j√† en compte l'√©tat des r√©pliques restantes lors de la construction de delta-mutateurs. <br><br>  La m√©thode d'optimisation suivante consiste √† compresser le journal bas√© sur les op√©rations, si des retards sont autoris√©s. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/rd/vi/a5/rdvia5kv708z55ndt_t5j_leaum.png" alt="image"></div><br><h3>  Bas√© purement sur les op√©rations: </h3><br>  Il y a un retard dans la cr√©ation de l'opector dans la synchronisation bas√©e sur les op√©rations.  Dans certains syst√®mes, cela peut ne pas √™tre acceptable, alors vous devez envoyer la modification d'origine au prix de compliquer le protocole et la quantit√© suppl√©mentaire de m√©tadonn√©es. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/3l/p2/r2/3lp2r2ruizjddxllrwgbgwh5ykw.png" alt="image"></div><br><h3>  Approches d'utilisation standard: </h3><br><ul><li>  Si les mises √† jour doivent <b>√™tre envoy√©es imm√©diatement</b> dans le syst√®me, alors bas√© sur l'√©tat serait un mauvais choix, car l'envoi de l'√©tat entier est plus cher qu'une simple op√©ration de mise √† jour.  Delta-based fonctionne mieux, mais dans ce cas particulier, la diff√©rence avec state-based sera faible. </li><li>  Si vous avez besoin de <b>synchroniser la r√©plique apr√®s une panne</b> , alors bas√© sur l'√©tat et bas√© sur le delta sont le choix parfait.  Si vous devez utiliser une op√©ration, les options sont les suivantes: <br><br>  1) Lancer toutes les op√©rations manqu√©es √† partir du moment de l'√©chec <br>  2) Une copie compl√®te de l'une des r√©pliques et la restauration des op√©rations manqu√©es </li><li>  Comme indiqu√© ci-dessus, bas√© sur les op√©rations n√©cessite que les mises √† jour soient livr√©es exactement une fois √† chaque r√©plique.  L'obligation de livraison ne peut √™tre supprim√©e qu'une seule fois si l'effecteur est idempotent.  En pratique, il est beaucoup plus facile de mettre en ≈ìuvre le premier que le second. </li></ul><br><h3>  La relation entre Op-based et State-based: </h3><br>  Deux approches peuvent √™tre √©mul√©es l'une par rapport √† l'autre, donc √† l'avenir, nous consid√©rerons le CRDT sans r√©f√©rence √† un mod√®le de synchronisation sp√©cifique. <br><br><h1>  6. CRDT </h1><br><h2>  6.1 Compteur </h2><br>  Un entier qui prend en charge deux op√©rations: inc et dec.  Par exemple, consid√©rez les impl√©mentations possibles pour les synchronisations bas√©es sur les op√©rations et les √©tats: <br><br><h3>  Compteur bas√© sur les op√©rations: </h3><br>  De toute √©vidence, il suffit d'envoyer des mises √† jour.  Exemple pour inc: <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> function (counter) { counter += <span class="hljs-number"><span class="hljs-number">1</span></span> } }</code> </pre> <br><h3>  Compteur bas√© sur l'√©tat: </h3><br>  L'impl√©mentation n'est plus aussi √©vidente, car on ne sait pas √† quoi devrait ressembler la fonction de fusion. <br><br>  Consid√©rez les options suivantes: <br><br>  <u>Compteur √† augmentation monotone (compteur √† incr√©mentation uniquement, compteur G):</u> <br><br>  Les donn√©es seront stock√©es comme un vecteur de dimension √©gale au nombre de n≈ìuds (vecteur de version) et chaque r√©plique augmentera la valeur en position avec son id. <br><br>  La fonction de fusion prendra un maximum dans les positions correspondantes, et la valeur finale est la somme de tous les √©l√©ments du vecteur <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><span class="noError" style="display: inline-block;">\&nbsp;begin&nbsp;{align}&nbsp;inc&nbsp;()&nbsp;&amp;:&nbsp;V&nbsp;[id&nbsp;()]&nbsp;=&nbsp;V&nbsp;[id&nbsp;()]&nbsp;+&nbsp;1&nbsp;\\&nbsp;value&nbsp;()&nbsp;&amp;:&nbsp;\&nbsp;sum_&nbsp;{i&nbsp;=&nbsp;0}&nbsp;^&nbsp;{n}&nbsp;V&nbsp;[i]&nbsp;\\&nbsp;fusionner&nbsp;(C_1,&nbsp;C_2)&nbsp;&amp;:&nbsp;i&nbsp;\&nbsp;in&nbsp;[1..n]&nbsp;\&nbsp;Result&nbsp;[i]&nbsp;=&nbsp;max&nbsp;(C_1.V&nbsp;[i],&nbsp;C_2.V&nbsp;[i])&nbsp;\&nbsp;end&nbsp;{align}</span></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> \ begin {align} inc () &: V [id ()] = V [id ()] + 1 \\ value () &: \ sum_ {i = 0} ^ {n} V [i] \\ fusionner (C_1, C_2) &: i \ in [1..n] \ Result [i] = max (C_1.V [i], C_2.V [i]) \ end {align} </script></p><br>  Vous pouvez √©galement utiliser le G-Set (voir ci-dessous) <br><br>  Application: <br><br><ul><li>  Compter les clics / hits (sic!) </li></ul><br>  <u>Compteur avec support de d√©cr√©mentation (compteur PN)</u> <br><br>  Nous commen√ßons deux G-compteur - un pour les op√©rations d'incr√©mentation, le second - pour d√©cr√©menter <br><br>  Application: <br><br><ul><li>  Le nombre d'utilisateurs connect√©s dans un r√©seau p2p, tel que Skype </li></ul><br>  <u>Compteur non n√©gatif</u> <br><br>  Une impl√©mentation simple n'existe pas encore.  Sugg√©rez vos id√©es dans les commentaires, discutez. <br><br><h2>  6.2 S'inscrire </h2><br>  Une cellule m√©moire avec deux op√©rations - assigner (√©crire) et valeur (lire). <br>  Le probl√®me est que l'attribution n'est pas commutative.  Il existe deux approches pour r√©soudre ce probl√®me: <br><br><h3>  Registre des derniers gains en √©criture (registre LWW): </h3><br>  Nous entrons la commande compl√®te gr√¢ce √† la g√©n√©ration d'un identifiant unique pour chaque op√©ration (horodatage, par exemple). <br><br>  Un exemple de synchronisation est l'√©change de paires (valeur, id): <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/rw/8m/1k/rw8m1k8wgby7v0gczcthhdmdvns.png"></div><br>  Application: <br><br><ul><li>  Colonnes √† cassandra </li><li>  NFS - fichier en tout ou en partie </li></ul><br><h3>  Enregistrez-vous avec plusieurs valeurs (Multi-Value Register, MV-Register): </h3><br>  L'approche est similaire √† un compteur G - nous stockons l'ensemble (valeur, vecteur de version).  Enregistrer la valeur - toutes les valeurs, lors de la fusion - LWW s√©par√©ment pour chaque valeur dans le vecteur. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/o3/kr/vc/o3krvcuowzsa-vi_avn27jcscxk.png"></div><br>  Application: <br><br><ul><li>  Panier en Amazonie.  Un bug bien connu est associ√© √† cela, lorsque, apr√®s avoir retir√© un article du panier, il y appara√Æt √† nouveau.  La raison en est que malgr√© le fait que le registre stocke un ensemble de valeurs, ce n'est pas un ensemble (voir l'image ci-dessous).  Amazon, d'ailleurs, ne consid√®re m√™me pas cela comme un bug - en fait, il augmente les ventes. </li><li>  Riak.  Dans un cas plus g√©n√©ral, nous d√©pla√ßons le probl√®me du choix de la valeur r√©elle (note - il n'y a pas de conflit!) √Ä l'application. </li></ul><br>  Explication du bug dans Amazon: <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/k0/au/le/k0auleq-jjcrfdtkdswe8tfdxnq.png"></div><br><br><h2>  6.3 Beaucoup </h2><br>  L'ensemble est le type de base pour la construction de conteneurs, de cartes et de graphiques et prend en charge les op√©rations - add et rmv, qui ne sont pas commutatives. <br><br>  Consid√©rez l'impl√©mentation na√Øve de l'ensemble bas√© sur les op√©rations, dans lequel add et rmv sont ex√©cut√©s √† leur arriv√©e (add vient √† 1 et 2 r√©pliques en m√™me temps, puis rmv passe √† 1) <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/yk/uu/3b/ykuu3b4-brgkjj2p4y32gmytafs.png"></div><br>  Comme vous pouvez le voir, les r√©pliques se sont finalement dispers√©es.  Consid√©rez les diff√©rentes options pour construire des ensembles sans conflit: <br><br><h3>  Ensemble de croissance (G-Set): </h3><br>  La solution la plus simple consiste √† emp√™cher la suppression d'√©l√©ments.  Il ne reste que l'op√©ration add, qui est commutative.  La fonction de fusion est l'union des ensembles. <br><br><h3>  Ensemble biphas√© (ensemble 2P): </h3><br>  Nous vous autorisons √† supprimer, mais vous ne pouvez pas l'ajouter √† nouveau apr√®s la suppression.  Pour l'impl√©menter, nous avons mis en place un ensemble distinct d'√©l√©ments G-set distants (un tel ensemble est appel√© un ensemble tombstone) <br>  Exemple pour un √©tat: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><span class="noError" style="display: inline-block;">\&nbsp;begin&nbsp;{align}&nbsp;lookup&nbsp;(e)&nbsp;&amp;:&nbsp;e&nbsp;\&nbsp;in&nbsp;A&nbsp;\&nbsp;land&nbsp;e&nbsp;\&nbsp;notin&nbsp;R&nbsp;\\&nbsp;add&nbsp;(e)&nbsp;&amp;:&nbsp;A&nbsp;=&nbsp;A&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\&nbsp;rmv&nbsp;(e)&nbsp;&amp;:&nbsp;R&nbsp;=&nbsp;R&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\&nbsp;merge&nbsp;(S_1,&nbsp;S_2)&nbsp;&amp;:&nbsp;\\&nbsp;Res&nbsp;&amp;&nbsp;ult.A&nbsp;=&nbsp;S_1.A&nbsp;\&nbsp;cup&nbsp;S_2.A&nbsp;\\&nbsp;Res&nbsp;&amp;&nbsp;ult.R&nbsp;=&nbsp;S_1.R&nbsp;\&nbsp;cup&nbsp;S_2.R&nbsp;\&nbsp;end&nbsp;{align}</span></span></div><script type="math/tex;mode=display" id="MathJax-Element-7"> \ begin {align} lookup (e) &: e \ in A \ land e \ notin R \\ add (e) &: A = A \ cup \ {e \} \\ rmv (e) &: R = R \ cup \ {e \} \\ merge (S_1, S_2) &: \\ Res & ult.A = S_1.A \ cup S_2.A \\ Res & ult.R = S_1.R \ cup S_2.R \ end {align} </script></p><br><h3>  Ensemble d'√©l√©ments LWW: </h3><br>  La prochaine fa√ßon d'impl√©menter un ensemble sans conflit est d'introduire un ordre complet, l'une des options est de g√©n√©rer des horodatages uniques pour chaque √©l√©ment. <br><br>  Nous obtenons deux ensembles - add-set et remove-set, lorsque add () est appel√©, add (element, unique_id ()), en v√©rifiant s'il y a un √©l√©ment dans l'ensemble - regardez o√π l'horodatage est plus grand - dans remove-set ou dans add-set <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/iw/gt/95/iwgt95jsuu9xps80j0w-sjgweq4.png"></div><br><h3>  PN-Set: </h3><br>  Variation avec ordre de l'ensemble - on d√©marre un compteur pour chaque √©l√©ment, quand on l'ajoute, on l'augmente, quand on le supprime on le diminue.  Un √©l√©ment est dans l'ensemble si son compteur est positif. <br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/nf/qz/dw/nfqzdwf7risphmn8qyuq0tsjc3s.png"></div><br>  Notez l'effet int√©ressant - dans la troisi√®me r√©plique, l'ajout d'un √©l√©ment ne conduit pas √† son apparition. <br><br><h3>  Ensemble d'observation-suppression, ensemble OU, ensemble ajout-gain: </h3><br>  Dans ce type, ajouter a priorit√© sur supprimer.  Exemple d'impl√©mentation: chaque √©l√©ment nouvellement ajout√© se voit attribuer une balise unique (relative √† l'√©l√©ment, et non √† l'ensemble complet).  Rmv supprime un √©l√©ment de l'ensemble et envoie toutes les paires vues (√©l√©ment, balise) aux r√©pliques pour suppression. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/5n/ac/1l/5nac1lanif5y_kh_w9rvaz-jqoe.png"></div><br><br><h3>  Ensemble gagnant-gagnant: </h3><br>  Similaire au pr√©c√©dent, mais en m√™me temps, ajoutez / rmv rmv gagne. <br><br><h2>  6.4 Graphique </h2><br>  Ce type est construit sur la base de nombreux.  Le probl√®me est le suivant: s'il y a des op√©rations simultan√©es addEdge (u, v) et removeVertex (u) - que dois-je faire?  Les options suivantes sont possibles: <br><br><ul><li>  Priorit√© RemoveVertex, toutes les ar√™tes incidentes √† ce sommet sont supprim√©es </li><li>  Priorit√© AddEdge, sommets supprim√©s restaur√©s </li><li>  Nous retardons l'ex√©cution de removeVertex jusqu'√† ce que tous les addEdge simultan√©s soient ex√©cut√©s. </li></ul><br>  L'option la plus simple est la premi√®re, pour sa mise en ≈ìuvre (2P2P-Graph) il suffit d'obtenir deux 2P-Set, un pour les sommets, le second pour les bords <br><br><h2>  6.5 Carte </h2><br><h3>  Carte des litt√©raux: </h3><br>  Deux probl√®mes √† r√©soudre: <br><br><ul><li>  Que faire des op√©rations de vente simultan√©es?  Par analogie avec les compteurs, vous pouvez choisir la s√©mantique LWW ou MV </li><li>  Que faire avec put / rmv simultan√©?  Par analogie avec les ensembles, vous pouvez soit mettre-victoires, ou rmv-victoires, ou la derni√®re s√©mantique gagne-s√©mantique. </li></ul><br><h3>  Cartographie CRDT (Carte des CRDT): </h3><br>  Un cas plus int√©ressant, car  vous permet de cr√©er des mappages imbriqu√©s.  Nous ne consid√©rons pas les cas de changement de types imbriqu√©s - cela devrait √™tre d√©cid√© par le CRDT imbriqu√© lui-m√™me. <br><br>  <u>Supprimer la carte en tant que r√©initialisation r√©cursive</u> <br><br>  L'op√©ration de suppression "r√©initialise" la valeur du type √† un certain √©tat de d√©part.  Par exemple, pour un compteur, il s'agit d'une valeur nulle. <br><br>  Prenons un exemple - une liste de courses g√©n√©rale.  Un des utilisateurs ajoute de la farine et le second effectue un paiement (cela conduit √† un appel √† l'op√©ration de suppression sur tous les √©l√©ments).  En cons√©quence, une unit√© de farine reste sur la liste, ce qui semble logique. <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/9g/sn/4j/9gsn4jdmbdg_ba1hdrmftl5mcgy.png"></div><br>  <u>Supprimer-gagne la carte</u> <br><br>  L'op√©ration rmv a priorit√©. <br><br>  Exemple: dans un jeu en ligne, un joueur Alice a 10 pi√®ces et un marteau.  Ensuite, deux √©v√©nements se produisent simultan√©ment: sur la r√©plique A, elle a produit un clou, et sur la r√©plique B, son personnage est supprim√© avec la suppression de tous les objets: <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/tb/xd/6s/tbxd6s7eun3rpn57mnwt9d4hbxa.png"></div><br><br>  Notez que lors de l'utilisation de remove-as-r√©cursif, un clou resterait finalement, ce qui n'est pas l'√©tat correct lorsque le personnage est supprim√©. <br><br>  <u>Mettre √† jour-gagne la carte</u> <br><br>  Les mises √† jour ont priorit√©, ou plut√¥t annulent les op√©rations pr√©c√©dentes pour supprimer simultan√©ment rmv. <br><br>  Exemple: dans un jeu en ligne, le personnage d'Alice sur la r√©plique B est supprim√© en raison de l'inactivit√©, mais l'activit√© se produit sur la r√©plique A en m√™me temps.  De toute √©vidence, l'op√©ration de suppression doit √™tre annul√©e. <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/63/oz/5y/63oz5yzch4ioguyram3erawkzl0.png"></div><br>  Il y a un effet int√©ressant lorsque vous travaillez avec une telle impl√©mentation - supposons que nous avons deux r√©pliques, A et B, et qu'elles stockent l'ensemble par une cl√© k.  Ensuite, si A supprime la valeur de la cl√© k et B supprime tous les √©l√©ments de l'ensemble, alors √† la fin les r√©pliques laisseront un ensemble vide avec la cl√© k. <br><br>  Notez qu'une impl√©mentation na√Øve ne fonctionnera pas correctement - vous ne pouvez pas simplement annuler toutes les op√©rations de suppression pr√©c√©dentes.  Dans l'exemple suivant, avec cette approche, l'√©tat final serait comme l'√©tat initial, ce qui est incorrect: <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/mp/un/hm/mpunhmkzj125hqob4net7iq7kc4.png"></div><br><h2>  Liste </h2><br>  Le probl√®me avec ce type est que les indices d'√©l√©ment sur diff√©rentes r√©pliques seront diff√©rents apr√®s les op√©rations locales d'insertion / suppression.  Pour r√©soudre ce probl√®me, l'approche de transformation op√©rationnelle est appliqu√©e - lors de l'application du changement obtenu, l'indice de l'√©l√©ment dans la r√©plique d'origine doit √™tre pris en compte. <br><br><h1>  7. Riak </h1><br>  √Ä titre d'exemple, consid√©rons CRDT dans Riak: <br><br><ul><li>  Compteur: PN-Counter </li><li>  Set: OU-Set </li><li>  Carte: mise √† jour remporte la carte des CRDT </li><li>  (Boolean) Flag: OR-Set o√π maximum 1 √©l√©ment </li><li>  Registre: paires (valeur, horodatage) </li></ul><br><h1>  8. Qui utilise CRDT </h1><br>  La section <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki</a> contient de bons exemples. <br><br><h1>  9. R√©f√©rences </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Magasins Key-CRDT</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un type de donn√©es JSON r√©pliqu√© sans conflit</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Une √©tude approfondie des types de donn√©es r√©pliqu√©es convergentes et commutatives</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Type de donn√©es r√©pliqu√© convergent et commutatif</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Type de donn√©es r√©pliqu√© sans conflit</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un guide Bluffers sur les CRDT √† Riak</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CRDT: une MISE √Ä JOUR (ou juste un PUT)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Types de donn√©es r√©pliqu√©es sans conflit: vue d'ensemble</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Forte coh√©rence √©ventuelle et types de donn√©es r√©pliqu√©es sans conflit</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structures de donn√©es finalement coh√©rentes</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418897/">https://habr.com/ru/post/fr418897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418885/index.html">Crispr peut acc√©l√©rer les processus naturels et changer la fa√ßon dont les aliments sont cultiv√©s</a></li>
<li><a href="../fr418887/index.html">√Ä quelle vitesse l'univers se d√©veloppe-t-il?</a></li>
<li><a href="../fr418889/index.html">Guide de test manuel des applications: avantages, √©tapes et m√©thodologies</a></li>
<li><a href="../fr418891/index.html">Nous avons v√©rifi√© les codes source Android √† l'aide de PVS-Studio, ou personne n'est parfait</a></li>
<li><a href="../fr418895/index.html">Apprenez l'intelligence artificielle pour jouer √† un jeu</a></li>
<li><a href="../fr418899/index.html">Premi√®res impressions et actions apr√®s la mise √† niveau de MySQL de la version 5.7 vers la version 8.0.11</a></li>
<li><a href="../fr418901/index.html">Les Russes ont remport√© la majorit√© des m√©dailles d'or √† l'Olympiade europ√©enne d'informatique eJOI 2018</a></li>
<li><a href="../fr418903/index.html">Scientifiques: il n'y a pas assez de CO‚ÇÇ sur Mars pour r√©chauffer l'atmosph√®re. L'explosion d'un p√¥le n'aidera pas</a></li>
<li><a href="../fr418905/index.html">Clavier en ligne dans les robots t√©l√©grammes</a></li>
<li><a href="../fr418907/index.html">Comment apprendre √† Zabbix √† envoyer des notifications de probl√®mes directement sur le bureau</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>