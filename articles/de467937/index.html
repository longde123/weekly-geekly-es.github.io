<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüé® ‚úäüèæ ‚ôæ Frisches WordPress Online Shop Plugin üõçÔ∏è üìï üëèüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor einiger Zeit musste ich einen Online-Shop auf WordPress erstellen. Es gibt viele gute L√∂sungen im offiziellen Repository. Unter ihnen ist der Anf√º...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Frisches WordPress Online Shop Plugin</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467937/">  Vor einiger Zeit musste ich einen Online-Shop auf WordPress erstellen.  Es gibt viele gute L√∂sungen im offiziellen Repository.  Unter ihnen ist der Anf√ºhrer - Woocommerce - schon lange aufgefallen.  Ich denke, er braucht keine Einf√ºhrung.  Eine millionenschwere Armee von Benutzern, Hunderte von kostenpflichtigen und kostenlosen Erweiterungen und unglaubliche Flexibilit√§t.  Aus diesem Grund verf√ºgt Woocommerce √ºber mehr als 5 Millionen aktive Installationen und deckt einen gro√üen Teil der Online-Shops weltweit ab. <br><br>  Trotzdem habe ich beschlossen, mein Fahrrad zu erfinden.  Teilweise, um F√§higkeiten zu verbessern, teils, um zu versuchen, ein nicht ressourcenintensives und schnell genuges E-Commerce-Plugin zu erstellen.  Ich habe es k√ºrzlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im offiziellen Repository ver√∂ffentlicht</a> , daher lade ich alle ein, es zu testen.  In diesem Artikel werde ich keinen √úberblick √ºber die M√∂glichkeiten geben, sondern nur √ºber einige interessante technische L√∂sungen sprechen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/275/768/f10/275768f10305ee3e6490d68f761cc1c7.png" width="772" height="250"><br><a name="habracut"></a><br><h2>  Permalinks Problem </h2><br>  Im Allgemeinen sind Permalinks in WordPress eine der schwierigsten Websites, da sie die L√∂sung einer Reihe von Problemen mit Verbindungen und Abh√§ngigkeiten erfordern.  WpStore kann Permalinks verwalten.  Sie k√∂nnen beispielsweise den <code>product</code> Slug aus der <code>product</code> URL entfernen, in Ihren eigenen √§ndern oder den Kategorie-Slug oder sogar die Kategorie-Verschachtelung hinzuf√ºgen.  <code>./-/---/---/-/</code> k√∂nnen folgenderma√üen aussehen: <code>./-/---/---/-/</code> .  Nicht schlecht. <br><br>  Ich musste viel schwitzen, um Kategorien zu verschachteln.  Mit der Funktion <code>wp_get_object_terms,</code> wir die Kategorien des angegebenen Produkts. Anschlie√üend erfassen wir im Zyklus die Schwachstellen und bilden die URL gem√§√ü der Hierarchie von √ºbergeordnet zu untergeordnet.  Um die notwendigen Links anzuzeigen, verwenden wir den Filter post_link.  Hier ist nur ein Teil des Codes (Sie k√∂nnen den vollst√§ndigen Code in der Quelle sehen): <br><br><pre> <code class="php hljs">add_filter( <span class="hljs-string"><span class="hljs-string">'post_link'</span></span>, <span class="hljs-string"><span class="hljs-string">'wpsl_post_type_permalink'</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span> ); add_filter( <span class="hljs-string"><span class="hljs-string">'post_type_link'</span></span>, <span class="hljs-string"><span class="hljs-string">'wpsl_post_type_permalink'</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span> ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wpsl_post_type_permalink</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $permalink, $post_id, $leavename )</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-comment"><span class="hljs-comment">/** * Works only in the admin panel when changing the structure of permanent links or creating/updating the product * In the frontend to display links to products using $post-&gt;guid * Relevant if the structure of permalinks are used %category% or %categories% */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( is_admin() ) { <span class="hljs-comment"><span class="hljs-comment">// get all terms (product categories) of this post (product) by hierarchicaly // change %category% if ( strpos( get_option( 'product_permalink' ), '%category%' ) !== false &amp;&amp; $terms = wpsl_get_terms_hierarchicaly( $post-&gt;ID, 'product_cat' ) ) { $custom_slug = str_replace( '%category%', isset( $terms[0] ) &amp;&amp; is_object( $terms[0] ) ? $terms[0]-&gt;slug : '', $custom_slug ); } // change %categories% if ( strpos( get_option( 'product_permalink' ), '%categories%' ) !== false &amp;&amp; $terms = wpsl_get_terms_hierarchicaly( $post-&gt;ID, 'product_cat' ) ) { foreach( $terms as $term ) { $hierarchical_slugs[] = $term-&gt;slug; } $custom_slug = str_replace( '%categories%', implode( '/', $hierarchical_slugs ), $custom_slug ); } else { $custom_slug = str_replace( '%categories%', 'product', $custom_slug ); } } .... return $permalink; }</span></span></code> </pre> <br>  Zu diesem Zeitpunkt trat jedoch ein Leistungsproblem auf.  Die Website begann langsamer zu arbeiten, insbesondere auf der Ausgabeseite mehrerer Produkte.  Auf der Kategorieseite mit der Ausgabe von nur 16 Produkten wurden beispielsweise fast 90 Abfragen an die Datenbank gestellt, und die Serverantwortzeit stieg dramatisch um etwa 25 bis 30%. <br><br>  Es stellte sich heraus, dass WordPress beim Aufrufen der Funktion_permalink viele Operationen ausf√ºhrt: Es erh√§lt den CNC-Typ und sammelt die <strong>Post-</strong> Daten abh√§ngig von diesem Typ.  Um 1 Link anzuzeigen, erzeugt WordPress mehrere nicht zwischengespeicherte Anforderungen an die Datenbank.  Dar√ºber hinaus ist der Prozess der Erlangung von Taxonomien und Hierarchien von Waren nicht der schnellste. <br><br>  Da die st√§ndige Generierung des Links nicht zu uns passt, ist es logisch, ihn irgendwo zu speichern und dann einfach von dort zu ziehen.  Es wurde beschlossen, das spezielle <code>guid</code> Feld der Tabelle <code>guid</code> .  Obwohl WP-Entwickler eine √Ñnderung nicht empfehlen, k√∂nnen wir diese Warnung aus mehreren Gr√ºnden ignorieren: <br><br><ul><li>  guid wird verwendet, um RSS zu generieren, und nur wenige Leute verwenden es. </li><li>  In RSS werden nur Eintr√§ge angezeigt, und unser Beitragstyp ist Produkt. </li></ul><br>  Um die Links in der Datenbank korrekt zu halten, h√§ngen wir an das Ereignis <code>save_post</code> eine Funktion, die das Guid-Feld aktualisiert: <br><br><pre> <code class="php hljs">add_action( <span class="hljs-string"><span class="hljs-string">'save_post'</span></span>, <span class="hljs-string"><span class="hljs-string">'wpsl_guid_rewrite'</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span> ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wpsl_guid_rewrite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $id )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !is_admin() ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( defined( <span class="hljs-string"><span class="hljs-string">'DOING_AUTOSAVE'</span></span> ) &amp;&amp; DOING_AUTOSAVE ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( strpos( get_option( <span class="hljs-string"><span class="hljs-string">'product_permalink'</span></span> ), <span class="hljs-string"><span class="hljs-string">'%category%'</span></span> ) !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> || strpos( get_option( <span class="hljs-string"><span class="hljs-string">'product_permalink'</span></span> ), <span class="hljs-string"><span class="hljs-string">'%categories%'</span></span> ) !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( $id &amp;&amp; get_post_type( (int)$id ) == <span class="hljs-string"><span class="hljs-string">'product'</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $wpdb; $wpdb-&gt;update( $wpdb-&gt;posts, [ <span class="hljs-string"><span class="hljs-string">'guid'</span></span> =&gt; ( get_permalink( $id ) ) ], [ <span class="hljs-string"><span class="hljs-string">'ID'</span></span> =&gt; intval( $id ) ] ); } clean_post_cache( $id ); } }</code> </pre> <br>  Es bleibt uns <code>post_type_link</code> die <code>post_type_link</code> am <code>post_type_link</code> Hook <code>post_type_link</code> und den generierten Link auszugeben: <br><br><pre> <code class="php hljs">add_filter( <span class="hljs-string"><span class="hljs-string">'post_type_link'</span></span>, <span class="hljs-string"><span class="hljs-string">'wpsl_get_permalink_change'</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span> ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wpsl_get_permalink_change</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $post_link, $post, $leavename, $sample )</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>( $post-&gt;guid ) &amp;&amp; $post-&gt;guid &amp;&amp; $post-&gt;post_type == <span class="hljs-string"><span class="hljs-string">'product'</span></span> &amp;&amp; ( strpos( get_option( <span class="hljs-string"><span class="hljs-string">'product_permalink'</span></span> ), <span class="hljs-string"><span class="hljs-string">'%category%'</span></span> ) !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> || strpos( get_option( <span class="hljs-string"><span class="hljs-string">'product_permalink'</span></span> ), <span class="hljs-string"><span class="hljs-string">'%categories%'</span></span> ) !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $post-&gt;guid; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $post_link; }</code> </pre> <br>  Hier √ºberpr√ºfen wir die Vollst√§ndigkeit des Guid-Feldes, des Post-Typs und des CNC-Typs.  Wenn die Werte der drei Parameter zu uns passen, zeigen Sie den zuvor gespeicherten Link an. <br><br>  Das Beste ist nun: Sehen Sie sich die Ergebnisse an.  Die Anzahl der Anfragen an die Datenbank hat sich fast verdoppelt - von fast 90 auf 44!  Die Serverantwortzeit auf dem Testhosting sank auf akzeptable 0,24 Sekunden. <br><br>  Die Aktualisierung des Guid-Feldes erfolgt nicht nur w√§hrend der Erstellung und Bearbeitung von Waren.  Das Plug-In verf√ºgt √ºber ein integriertes System zum Importieren von Waren √ºber CSV, sodass die Aktualisierung auch nach Abschluss des Imports erfolgt. <br><br>  Update: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Plugin-Dokumentation</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de467937/">https://habr.com/ru/post/de467937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de467921/index.html">Nehmen Sie staubige Stifte heraus: Handschrift ist gut f√ºr das Gehirn</a></li>
<li><a href="../de467923/index.html">Sie m√∂chten also Analyst im Bereich Netzwerksicherheit werden ...</a></li>
<li><a href="../de467925/index.html">Warum lieben Entwickler das dunkle Thema so sehr?</a></li>
<li><a href="../de467929/index.html">Wir organisieren Chaos oder wie man einen Prozessansatz in einer Organisation implementiert</a></li>
<li><a href="../de467933/index.html">Und doch, warum Posit eine w√ºrdige Alternative zu IEEE 754 sind</a></li>
<li><a href="../de467943/index.html">Grundlagen der Risiko- und gesch√§ftsorientierten Informationssicherheit: Grundkonzepte und Paradigma</a></li>
<li><a href="../de467949/index.html">Warum ist die Standardimplementierung von Schnittstellen n√ºtzlich?</a></li>
<li><a href="../de467951/index.html">Habrastatistik: Leserkommentare analysieren. Teil 2, Antworten auf Fragen</a></li>
<li><a href="../de467953/index.html">Testen billiger virtueller Server</a></li>
<li><a href="../de467957/index.html">Was steckt hinter der Feigenbaum-Konstante?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>