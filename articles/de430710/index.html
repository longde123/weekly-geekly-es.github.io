<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíº üÜö üåÇ Was tun, wenn der Schwarze Freitag morgen ist und Ihre Server nicht bereit sind? üéÆ üñêüèΩ üßÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="F√ºr diejenigen, die mit Marketing herumgespielt haben oder gerade erst in den Stream gekommen sind, ist ‚ÄûBlack Friday‚Äú ein Hype, verr√ºckte Bestellunge...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Was tun, wenn der Schwarze Freitag morgen ist und Ihre Server nicht bereit sind?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/430710/">  F√ºr diejenigen, die mit Marketing herumgespielt haben oder gerade erst in den Stream gekommen sind, ist ‚ÄûBlack Friday‚Äú ein Hype, verr√ºckte Bestellungen und eine Menge Kunden. <br><br>  Es ist gut, die Infrastruktur im Voraus auf den Zustrom vorzubereiten, aber an wen denken wir im Voraus?  Aber manchmal wird die Entscheidung zur Teilnahme am Vortag getroffen. <br><br>  Der Feiertag des Konsums hat also begonnen, die Server des Online-Shops beginnen fr√∂hlich zu blinken, das Callcenter ist √ºberhitzt und die Lieferservices bieten die Lieferung irgendwo im Januar an. <br>  Was tun, entspannen und philosophisch betrachten oder tapfer k√§mpfen? <br><br><img src="https://habrastorage.org/webt/ue/-w/8b/ue-w8bfnunh48ekqvwsgloqmfvs.jpeg"><br><a name="habracut"></a><br>  Ich habe die Serverinfrastruktur von Online-Shops w√§hrend des Black Friday begleitet und wurde nie im Voraus kontaktiert oder hatte Zeit, mich vorzubereiten.  Ich teile meine Erfahrungen mit denen, die heute den gleichen Auftrag erhalten. <br><br>  (Sie haben Gl√ºck, wenn Sie es richtig machen k√∂nnen, d. H. Die √úberwachung in wenigen Monaten einrichten, Datenverkehr, Engp√§sse analysieren, Projektarchitekturen durchf√ºhren, bei Bedarf Stresstests durchf√ºhren, die Architektur zusammen mit den Entwicklern neu erstellen und zus√§tzliche Serverkapazit√§ten im Voraus anschlie√üen.  Wir werden ein anderes Mal √ºber den richtigen Ansatz sprechen, hier √ºber Brandschutzma√ünahmen. <br><br><h2>  Wir richten die √úberwachung ein </h2><br>  Ich denke, √úberwachung ist auf jeden Fall prim√§r.  Es wird immer noch Probleme geben, aber dank der √úberwachungspl√§ne k√∂nnen Sie verstehen, wo die Engp√§sse jetzt liegen. <br><br>  Wenn m√∂glich, verwende ich L√∂sungen wie Zabbix / Prometheus / ELK (abh√§ngig von der Architektur). Wenn nicht, verbinde ich SaaS schnell wie okmeter.io.  Selbst wenn der Verkauf nur einen Tag dauert, k√∂nnen Sie eine Reihe von Indikatoren auf einem Monitor nicht wie einen Zulu-Tag hintereinander anzeigen. <br><br>  Immer noch gro√üartige Tools sind blackfire.io/newrelic.com f√ºr die Profilerstellung und pinba.org f√ºr die Analyse von "Verlangsamungs" -Seiten im Allgemeinen. <br><br>  blackfire / newrelic hilft dabei, das Problem auf einer bestimmten Seite zu l√∂sen. Pinba hilft Ihnen dabei, festzustellen, welche Seiten am h√§ufigsten geladen werden und am l√§ngsten laufen (dies ist beispielsweise in Bitrix sofort einsatzbereit, aber versuchen Sie, in das Admin-Panel zu wechseln und dort zu arbeiten, wenn der Server und die Seite ist schon sehr schlecht). <br><br><h2>  √úbersch√ºssiges abschneiden </h2><br>  Ich schalte alles aus, was ausgeschaltet werden kann: bedingt unn√∂tige Module im Moment, alle m√∂glichen Sch√∂nheiten usw. <br><br>  Der Verkauf ist ein einfacher Vorgang, ein gro√üer Rabatt auf eine Reihe von Produkten.  Ein Besucher mit brennenden Augen m√∂chte ein Produkt ausw√§hlen, bis es ausverkauft ist, eine Bestellung aufgeben, einen Rabatt erhalten und eine Zahlung leisten. <br>  Abonnieren Sie den Newsletter, registrieren Sie sich auf der Website, fragen Sie nach der Servicequalit√§t - all dies interessiert den Kunden jetzt nicht, diese Module k√∂nnen deaktiviert oder vereinfacht werden.  Ich schalte alles aus, ohne das die Site ein paar Tage lang ruhig arbeiten kann. <br><br>  Ein Fall aus der Praxis: W√§hrend des Black Friday habe ich auf einem laufenden Server unter viel Verkehr debuggt, und nach 2 Stunden stellte sich heraus, dass das Lieferservicemodul extrem langsam ist, auf externe Services zugreift und die Lieferkosten f√ºr jede Bestellung automatisch berechnet.  Als der Verkehr hunderte Male wuchs, h√∂rten diese externen Dienste einfach auf, damit fertig zu werden. <br><br>  Sie k√∂nnen sich einfach hinsetzen und nachdenken, und was k√∂nnte auf Ihre Website / in eine mobile Anwendung / usw. fallen? <br><br><h2>  Fallen lassen </h2><br>  Ich bereite mich darauf vor, dass jeder Dienst sowieso fallen wird.  In diesem Fall m√ºssen Sie den Besuchern mindestens etwas zeigen. <br><br>  Beispielsweise sollte ein nicht funktionierendes Lieferservicemodul oder Zahlungsformular nicht die gesamte Bestellung blockieren. Der Benutzer kann morgen zur√ºckkehren und seine Bestellung abschlie√üen. <br><br>  Auf den Seiten der 50er Jahre Fehler zeige ich die Mail- oder Telefonnummer der Verkaufsabteilung. <br><br><pre><code class="plaintext hljs">error_page 500 502 503 504 /50x.html; location = /50x.html { root /srv/www/yourwebsite.com/htdocs/sale-contacts/; }</code> </pre> <br><h2>  Erstellen Sie eine Kopie der Site </h2><br>  Wenn es m√∂glich ist, eine Kopie der Site zum Testen von √Ñnderungen zu haben, ist dies sehr gut.  Ich spreche nicht von einem etablierten Bereitstellungssystem :) <br><br>  Mit modischen Cloud-Diensten k√∂nnen Sie √ºbrigens schnell und einfach eine Kopie des Battle Servers erstellen. <br><br>  Fallstudie: Eine Site, deren Infrastruktur ich am Black Friday nach der Optimierung durch Entwickler (teilweise unterwegs), dem Hinzuf√ºgen von Ressourcen und der Optimierung von Software gewartet habe, begann mehr oder weniger ertr√§glich mit starkem Datenverkehr zu arbeiten, aber immer noch sehr viel bei der Bestellung verlangsamt.  Die Benutzer dachten, dass keine Bestellungen gesendet wurden, und dr√ºckten f√ºr alle F√§lle mehrmals die Checkout-Taste.  Mehrere Figuren dr√ºckten 300 mal den Knopf!  Toller Stresstest :) Hundertmal mehr Besucher und rund 300 Bestellungen mehr!  :) :) <br><br><h2>  CDN-Dienste </h2><br>  Sie k√∂nnen auf CDN verzichten, aber wenn die Server die R√ºckgabe der richtigen Menge an Statik objektiv nicht bew√§ltigen k√∂nnen, ist dies erforderlich. <br><br>  Sie k√∂nnen schnell ein CDN f√ºr g√§ngige CMS wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1C-Bitrix</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wordpress anschlie√üen</a> .  Sie k√∂nnen das CDN jedoch nicht unterwegs konfigurieren, sondern m√ºssen im Voraus darauf achten. <br><br><h2>  AntidDoS </h2><br>  Ich empfehle au√üerdem, AntiDDoS-Dienste zu verbinden und auf jeden Fall voranzukommen (andernfalls k√∂nnen sie unter pl√∂tzlicher Belastung, ohne sich an den normalen Datenverkehr anzupassen, legitime Besucher blockieren). <br><br>  F√ºr einen bestimmten Zeitraum kann dies kostenlos durchgef√ºhrt werden: <br><br><ul><li>  qrator.net, 10 Tage kostenlos, wenn Sie Bitrix haben - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://www.1c-bitrix.ru/ddos/</a> </li><li>  DDoS-Guard, es gibt einen kostenlosen Tarif - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://ddos-guard.net/en/store/web</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">cloudflare.com</a> gibt es einen kostenlosen Tarif (aber hier empfehle ich mindestens den ersten bezahlten Tarif und denke daran, dass ihre IP-Adressen in der Russischen F√∂deration h√§ufig gesperrt sind) </li></ul><br><h2>  Serverfunktionen hinzuf√ºgen </h2><br>  Wir sehen die M√∂glichkeit, Ressourcen hinzuzuf√ºgen.  Es wird m√∂glich sein, dem Hauptserver Ressourcen hinzuzuf√ºgen, einen neuen Knoten zum Parallelisieren von Abfragen, einen Knoten f√ºr MySQL usw. zu erstellen.  Wenn nicht Sie selbst, dann wird Ihnen ein nebenbei angeheuerter Outsourcer vielmals daf√ºr danken. <br>  Es ist praktisch, wenn Ihr Provider physische und Cloud-Server hosten kann (Selectel.ru, Servers.com). <br><br><h2>  Fuh, lass uns gehen </h2><br>  Das Gef√§hrlichste sind die ersten Minuten nach den Newslettern.  Der Cache ist noch nicht aufgew√§rmt, es gibt nur wenige Statistiken, Sie kennen die Funktionen des Systems immer noch nicht (wenn Sie keine ernsthaften Tests im Voraus durchgef√ºhrt haben). <br><br><h2>  Einige Konfigurationen </h2><br><h4>  Caching in Nginx </h4><br>  Wir erstellen 3 Stunden lang einen 500-MB-Cache f√ºr alle Seiten mit Ausnahme der Bestellseiten. <br><br><pre> <code class="plaintext hljs">proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=blackfriday_cache:180m max_size=500m inactive=7d; #  blackfriday_cache,  180  proxy_cache_key "$request_method$scheme$host$request_uri"; proxy_cache_use_stale error timeout invalid_header http_500; map $uri $cookie_nocache { #     ,   ; 1 - , 0 -  "/order" "1"; "/bitrix" "1"; default "0"; } location / { .... proxy_hide_header "Set-Cookie"; #       proxy_ignore_headers "X-Accel-Expires"; proxy_ignore_headers "Expires"; proxy_ignore_headers "Cache-Control"; proxy_ignore_headers "Set-Cookie"; add_header X-Cache $upstream_cache_status; ... proxy_no_cache $cookie_nocache; #  ,   map;  1 -   proxy_cache blackfriday_cache; #    proxy_cache_valid 180m; #  180  proxy_cache_valid 404 1m; # 404  -   1  .... proxy_pass http://backend; #     } location @backend { .... #   }</code> </pre> <br>  Zus√§tzliche Materialien viel, Links: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/post/124684</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://nginx.org/ru/docs/http/ngx_">nginx.org/ru/docs/http/ngx_http_proxy_module.html</a> </li></ul><br>  Mit dem 100-Mbit-Kanal k√∂nnen Sie 12 Seiten mit einem Gewicht von 1 MB pro Sekunde erstellen. Dies entspricht 43.000 pro Stunde.  nginx ist in der Lage, ein solches Volumen auch auf einem kosteng√ºnstigen Server bereitzustellen. <br><br><h4>  Wir verteilen Anforderungen auf mehrere Knoten (die Site sollte bereit sein, mit mehreren Webknoten zu arbeiten). </h4><br><br><h5>  √úber Round-Robin DNS </h5><br><br>  (Seien Sie vorsichtig, diese Methode wird von vielen DNS-Anbietern nicht mehr korrekt unterst√ºtzt.) <br><br><pre> <code class="plaintext hljs">$ dig lifehacker.ru +short 136.243.37.180 136.243.37.178</code> </pre> <br><br><h5>  √úber Nginx stromaufw√§rts </h5><br><br><pre> <code class="plaintext hljs">$ cat nginx.conf upstream backend { server backend1.yoursite.com; server backend2.yoursite.com; } server { server_name yoursite.com; location / { proxy_pass http://backend; } } location @backend { .... #   }</code> </pre> <br><br><h5>  √úber Cloudflare, Qrator usw. </h5><br>  Sie haben die M√∂glichkeit, mehrere Backends direkt √ºber das Panel festzulegen. Die Konfigurationsaktualisierung erfolgt normalerweise sofort. <br><br><h2>  Ruhig </h2><br>  Es kommt vor, dass es unm√∂glich ist, eine perfekte Arbeit zu gew√§hrleisten, aber die Hauptsache f√ºr das Gesch√§ft ist, dass das System im Grunde funktioniert.  Lassen Sie es langsamer werden, aber es sollte Benutzern erm√∂glichen, Bestellungen aufzugeben und nicht endlos F5 zu dr√ºcken.  "Elend, hemmend, die Nerven aller spaltend", Tausende von Kunden nutzen es gleichzeitig und sie machen, machen, machen Bestellungen, und jeder von ihnen ist wertvoll.  Ich habe Beispiele gesehen, bei denen der Laden an einem Tag eine sechsmonatige Trendwende vollzogen hat und das Ergebnis alle Nerven wert war. <br><br>  Erfolgreicher Verkauf an Sie :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de430710/">https://habr.com/ru/post/de430710/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de430700/index.html">Ein einheitliches System zur Aufzeichnung von Online-Filmansichten wird in Russland funktionieren</a></li>
<li><a href="../de430702/index.html">Sehr seltsames Training</a></li>
<li><a href="../de430704/index.html">Wie Technologien f√ºr k√ºnstliche Intelligenz das Wachstum von Aviasales f√∂rdern: Sieben Beispiele</a></li>
<li><a href="../de430706/index.html">Neue Evolutionstheorie</a></li>
<li><a href="../de430708/index.html">Tic Tac Toe "Ohne Grenzen"</a></li>
<li><a href="../de430712/index.html">NeurIPS: Wie man die beste ML-Konferenz erobert</a></li>
<li><a href="../de430714/index.html">VMware kauft Heptio - was bedeutet das f√ºr Kubernetes?</a></li>
<li><a href="../de430718/index.html">F√ºr welche Objekte lohnt sich die Cloud-Video√ºberwachung?</a></li>
<li><a href="../de430720/index.html">Intel RealSense D435i: kleines Update und kurzer historischer Exkurs</a></li>
<li><a href="../de430722/index.html">PHP-Leistung: Planen, Profilieren, Optimieren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>