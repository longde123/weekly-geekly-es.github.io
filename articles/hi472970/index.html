<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯН╝ ЁЯПо ЁЯПм рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдФрд░ рд╕рдВрдЧрдардирд╛рддреНрдордХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рдЖрд▓реЛрдЪрдирд╛ред рднрд╛рдЧ 1, рддрдХрдиреАрдХреА: рдЦрд░реЛрдВрдЪ рд╕реЗ рдПрдХ рдХреНрд▓рд╛рдЗрдВрдЯ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдЕрдиреБрднрд╡ - рдЯреАрдПрд▓, рдПрдордЯреА ЁЯС╕ЁЯП╝ ЁЯей ЁЯНз</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рд╣реЛрд░реЗрдмреЗ рдкрд░ рдкреЛрд╕реНрдЯ рдЕрдзрд┐рдХ рдмрд╛рд░ рджрд┐рдЦрд╛рдИ рджрд┐рдП рд╣реИрдВ рдХрд┐ рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдХрд┐рддрдирд╛ рдЕрдЪреНрдЫрд╛ рд╣реИ, рдмрд┐рд▓реНрдбрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдЖрджрд┐ рдореЗрдВ рдбреНрдпреВрд░реЛрд╡ рднрд╛рдЗрдпреЛрдВ рдХреЛ рдХрд┐рддрдирд╛ рд╢рд╛рдирджрд╛рд░ рдФрд░ рдЕрдиреБрднрд╡реА рд╣реИред рдЗ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдФрд░ рд╕рдВрдЧрдардирд╛рддреНрдордХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рдЖрд▓реЛрдЪрдирд╛ред рднрд╛рдЧ 1, рддрдХрдиреАрдХреА: рдЦрд░реЛрдВрдЪ рд╕реЗ рдПрдХ рдХреНрд▓рд╛рдЗрдВрдЯ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдЕрдиреБрднрд╡ - рдЯреАрдПрд▓, рдПрдордЯреА</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472970/"><p> рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рд╣реЛрд░реЗрдмреЗ рдкрд░ рдкреЛрд╕реНрдЯ рдЕрдзрд┐рдХ рдмрд╛рд░ рджрд┐рдЦрд╛рдИ рджрд┐рдП рд╣реИрдВ рдХрд┐ рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдХрд┐рддрдирд╛ рдЕрдЪреНрдЫрд╛ рд╣реИ, рдмрд┐рд▓реНрдбрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдЖрджрд┐ рдореЗрдВ рдбреНрдпреВрд░реЛрд╡ рднрд╛рдЗрдпреЛрдВ рдХреЛ рдХрд┐рддрдирд╛ рд╢рд╛рдирджрд╛рд░ рдФрд░ рдЕрдиреБрднрд╡реА рд╣реИред  рдЗрд╕реА рд╕рдордп, рдмрд╣реБрдд рдХрдо рд▓реЛрдЧреЛрдВ рдиреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЦреБрдж рдХреЛ рддрдХрдиреАрдХреА рдЙрдкрдХрд░рдг рдореЗрдВ рдбреБрдмреЛ рджрд┐рдпрд╛ - рдЕрдзрд┐рдХрддрдо рд░реВрдк рд╕реЗ, рд╡реЗ JSON рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ (рдФрд░ MTProto рд╕реЗ рдмрд╣реБрдд рдЕрд▓рдЧ) рдмреЙрдЯ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдорддреМрд░ рдкрд░ рд╡реЗ рджреВрдд рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдШреВрдордиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рдкреНрд░рд╢рдВрд╕рд╛ рдФрд░ рдЬрдирд╕рдВрдкрд░реНрдХ рд▓реЗрддреЗ рд╣реИрдВред  рд▓рдЧрднрдЧ рдбреЗрдврд╝ рд╕рд╛рд▓ рдкрд╣рд▓реЗ, рдЗрдХреЛрд▓реЛрди рдПрдирдЬреАрдУ рд╡рд╛рд╕рд┐рд▓реА рдореЗрдВ рдореЗрд░рд╛ рд╕рд╣рдпреЛрдЧреА (рджреБрд░реНрднрд╛рдЧреНрдпрд╡рд╢, рд╣реИрдмрд░ рдкрд░ рдЙрд╕рдХрд╛ рдЦрд╛рддрд╛ рдбреНрд░рд╛рдлреНрдЯ рдХреЗ рд╕рд╛рде рдорд┐рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛) рдкрд░реНрд▓ рдкрд░ рдЦрд░реЛрдВрдЪ рд╕реЗ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдХреНрд▓рд╛рдЗрдВрдЯ рд▓рд┐рдЦрдирд╛ рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛, рдФрд░ рдЗрди рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЗ рд▓реЗрдЦрдХ рдмрд╛рдж рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛ рдЧрдПред  рдкрд░реНрд▓ рдореЗрдВ рдХреНрдпреЛрдВ, рдХреБрдЫ рддреБрд░рдВрдд рдкреВрдЫреЗрдВрдЧреЗ? <del>  <s>рдХреНрдпреЛрдВрдХрд┐ рдЕрдиреНрдп рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рдРрд╕реА рдкрд░рд┐рдпреЛрдЬрдирд╛рдПрдБ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИрдВ</s> </del>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рд╡рд╣ рдмрд┐рдВрджреБ рдирд╣реАрдВ рд╣реИ, рдХреЛрдИ рдЕрдиреНрдп рднрд╛рд╖рд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬрд╣рд╛рдВ рдЕрднреА рддрдХ рдХреЛрдИ <strong>рддреИрдпрд╛рд░ рдкреБрд╕реНрддрдХрд╛рд▓рдп</strong> рдирд╣реАрдВ рд╣реИ, рдФрд░ рддрджрдиреБрд╕рд╛рд░ рд▓реЗрдЦрдХ рдХреЛ <em>рдЦрд░реЛрдВрдЪ рд╕реЗ</em> рд╕рднреА рддрд░рд╣ <em>рд╕реЗ</em> рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдПрдХ рдРрд╕реА рдЪреАрдЬ рд╣реИ - рд╡рд┐рд╢реНрд╡рд╛рд╕, рд▓реЗрдХрд┐рди рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВред  рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рд╕реЗ рдПрдХ рдЙрддреНрдкрд╛рдж рдХреЗ рд╕рд╛рде, рдЖрдк рдХреЗрд╡рд▓ рдирд┐рд░реНрдорд╛рддрд╛ рд╕реЗ рддреИрдпрд╛рд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдкрд░ рднрд░реЛрд╕рд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рджреВрд╕рд░реЗ рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╡рд┐рд╖рдп рд╣реИ)ред  рдлрд┐рд▓рд╣рд╛рд▓, рдкреБрд╕реНрддрдХрд╛рд▓рдп "рдордзреНрдп" рд╕реНрддрд░ рдкрд░ рдХрд╛рдлреА рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ (рдпрд╣ рдЖрдкрдХреЛ рдХрд┐рд╕реА рднреА рдПрдкреАрдЖрдИ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ)ред </p><br><p>  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдкреЛрд╕реНрдЯ рдХреА рдЗрд╕ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдФрд░ рдЧрдгрд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рд▓реЗрдХрд┐рди рдХрдИ рдЕрдиреНрдп рддрдХрдиреАрдХреА рд╡рд┐рд╡рд░рдг рдФрд░ рд╡рд╛рд╕реНрддреБрд╢рд┐рд▓реНрдк рдмреИрд╕рд╛рдЦреА (рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрдВрдЧреЗ рдЬреЛ рдЦрд░реЛрдВрдЪ рд╕реЗ рдирд╣реАрдВ рд▓рд┐рдЦреЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдХрд┐рд╕реА рднреА рднрд╛рд╖рд╛ рдореЗрдВ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ)ред  рддреЛ, рдореБрдЦреНрдп рд▓рдХреНрд╖реНрдп <strong>рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдкреНрд░рд▓реЗрдЦрди рдХреЗ рдЕрдиреБрд╕рд╛рд░</strong> рдЦрд░реЛрдВрдЪ рд╕реЗ рдЧреНрд░рд╛рд╣рдХ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдерд╛ред  рдпрд╣ рдорд╛рди рд▓реЗрдВ рдХрд┐ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХрд╛ рд╕реНрд░реЛрдд рдХреЛрдб рдмрдВрдж рд╣реИ (рдлрд┐рд░ рд╕реЗ, рджреВрд╕рд░реЗ рднрд╛рдЧ рдореЗрдВ, рд╣рдо рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреИрд╕реЗ <em>рд╣реЛрддрд╛ рд╣реИ</em> ), рд▓реЗрдХрд┐рди, рдЬреИрд╕рд╛ рдХрд┐ рдкреБрд░рд╛рдиреЗ рджрд┐рдиреЛрдВ рдореЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрд░рдПрдлрд╕реА рдЬреИрд╕рд╛ рдПрдХ рдорд╛рдирдХ рд╣реИ - рдХреНрдпрд╛ рдХреНрд▓рд╛рдЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд▓рд┐рдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИ рд╕рд┐рд░реНрдл рдПрдХ рд╡рд┐рдирд┐рд░реНрджреЗрд╢, рд╕реНрд░реЛрдд рдкрд░ "рдирд╣реАрдВ рдЭрд╛рдБрдХ рд░рд╣рд╛ рд╣реИ", рдХрдо рд╕реЗ рдХрдо рдЖрдзрд┐рдХрд╛рд░рд┐рдХ (рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдбреЗрд╕реНрдХрдЯреЙрдк, рдореЛрдмрд╛рдЗрд▓), рдХрдо рд╕реЗ рдХрдо рдЕрдиреМрдкрдЪрд╛рд░рд┐рдХ рдЯреЗрд▓реАрдлрд╝реЛрдирди? </p><a name="habracut"></a><br><p>  <strong>рд╕рд╛рдордЧреНрд░реА рдХреА рддрд╛рд▓рд┐рдХрд╛:</strong> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рд▓реЗрдЦрди ... рдХреНрдпрд╛ рдпрд╣ рдореМрдЬреВрдж рд╣реИ?</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдЪ рдореЗрдВ? редред</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпреБрд╡рд╛ рд▓реЗрдЦрдХ рдХрд╣рд╛рдБ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджреНрд╡рд┐рдЖрдзрд╛рд░реА рдХреНрд░рдорд╛рдВрдХрди: рдЯреАрдПрд▓ (рдЯрд╛рдЗрдк рднрд╛рд╖рд╛) рдФрд░ рдЗрд╕рдХреА рдпреЛрдЬрдирд╛, рдФрд░ рдкрд░рддреЗрдВ, рдФрд░ рдХрдИ рдЕрдиреНрдп рдбрд░рд╛рд╡рдиреЗ рд╢рдмреНрдж</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЯреАрдПрд▓ рд╕рд┐рдВрдЯреИрдХреНрд╕ рдХреЗ рдПрдХ рд╕рдмрд╕реЗрдЯ рдХрд╛ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдг рдЬреЛ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬ рдирд╣реАрдВ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡реЗрдХреНрдЯрд░, рдЬрд┐рд╕реЗ рдШрдЯрд╛рдпрд╛ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдореМрдЬреВрджрд╛ рдЯреАрдПрд▓ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛрдб рдореЗрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рдХрд╛рд░ рдХреА рднрд╛рд╖рд╛ рдореЗрдВ рдХрдореА</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдВрд╕реНрдХрд░рдгред</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд░рддреЛрдВ (рдкрд░рддреЛрдВ)</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">MTProto</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд░рд┐рд╡рд╣рди рд╕реНрддрд░</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдВрдЬреА, рд╕рдВрджреЗрд╢, рд╕рддреНрд░, рдбрд┐рдлреА-рд╣реЗрд▓рдореИрди</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдВрджреЗрд╢, рд╕рдВрджреЗрд╢_ рд╕рдВрджреЗрд╢, msg_seqno, рдкреБрд╖реНрдЯрд┐рдХрд░рдг, рдЧрд▓рдд рджрд┐рд╢рд╛ рдореЗрдВ рдкрд┐рдВрдЧ рдФрд░ рдЕрдиреНрдп рдЕрдЬреНрдЮрд╛рддрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рдВрджреЗрд╢</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">RPC: рдЕрдиреБрд░реЛрдз, рдЙрддреНрддрд░, рддреНрд░реБрдЯрд┐рдпрд╛рдВред</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреБрд╖реНрдЯрд┐ред</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирд╢рд╛: рд╕рдВрджреЗрд╢ рд╕рдВрджреЗрд╢ рдХреА рд╕реНрдерд┐рддрд┐</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд┐рдВрдЧ рдФрд░ рдЯрд╛рдЗрдорд┐рдВрдЧред</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрддрд╛рд░ред</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдФрд░ рдХреИрд╕реЗ рдбрд┐рдЬрд╛рдЗрди рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдерд╛?</a> </li></ul></li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдкреАрдЖрдИ?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬрд╛рд░реА рд░рдЦрд╛ рдЬрд╛рдП!</a> </li></ul><br><h2 id="anchordocsanchordokumentaciya-ona-ved-est-pravda"><a name="docs"></a>  рдкреНрд░рд▓реЗрдЦрди ... рдХреНрдпрд╛ рдпрд╣ рдореМрдЬреВрдж рд╣реИ?  рд╕рдЪ рдореЗрдВ? редред </h2><br><p>  рдЗрд╕ рд▓реЗрдЦ рдХреЗ рд▓рд┐рдП рдиреЛрдЯреНрд╕ рдХреЗ рдЯреБрдХрдбрд╝реЗ рдкрд┐рдЫрд▓реА рдЧрд░реНрдорд┐рдпреЛрдВ рдореЗрдВ рдПрдХрддреНрд░ рдХрд┐рдП рдЬрд╛рдиреЗ рд▓рдЧреЗред  рдпрд╣ рд╕рдм рдХреБрдЫ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╕рд╛рдЗрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://core.telegram.org рдкрд░</a> рдкреНрд░рд▓реЗрдЦрди 23 рдкрд░рдд рдХреЗ рд░реВрдк рдореЗрдВ рдерд╛, рдЕрд░реНрдерд╛рддреНред  2014 рдореЗрдВ рдХрд╣реАрдВ рдЕрдЯрдХ рдЧрдпрд╛ (рдпрд╛рдж рд░рдЦреЗрдВ, рддреЛ рдЕрднреА рддрдХ рдЪреИрдирд▓ рднреА рдирд╣реАрдВ рд╣реИрдВ?)ред  рдмреЗрд╢рдХ, рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЗрд╕рдиреЗ 2014 рдореЗрдВ рдЙрд╕ рд╕рдордп рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╡рд╛рд▓реЗ рдЧреНрд░рд╛рд╣рдХ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рд╣реЛрдЧреАред  рд▓реЗрдХрд┐рди рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рднреА, рдкреНрд░рд▓реЗрдЦрди, рдкрд╣рд▓реЗ, рдЕрдкреВрд░реНрдг рдерд╛, рдФрд░ рджреВрд╕рд░реА рдмрд╛рдд, рдХрднреА-рдХрднреА рдЦреБрдж рдХрд╛ рд╡рд┐рд░реЛрдзрд╛рднрд╛рд╕ рдерд╛ред  рдПрдХ рдорд╣реАрдиреЗ рдкрд╣рд▓реЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ, рд╕рд┐рддрдВрдмрд░ 2019 рдореЗрдВ, рдпрд╣ <em>рдЧрд▓рддреА рд╕реЗ</em> рдкрддрд╛ рдЪрд▓рд╛ рдерд╛ рдХрд┐ рд╕рд╛рдЗрдЯ рдкрд░ рдкреНрд░рд▓реЗрдЦрди рдХрд╛ рдПрдХ рдмрдбрд╝рд╛ рдЕрдкрдбреЗрдЯ рдерд╛, рдкреВрд░реА рддрд░рд╣ рд╕реЗ рддрд╛рдЬрд╛ рд▓реЗрдпрд░ 105 рдкрд░, рдЗрд╕ рдиреЛрдЯ рдХреЗ рд╕рд╛рде рдХрд┐ рдЕрдм рд╕рдм рдХреБрдЫ рдлрд┐рд░ рд╕реЗ рдкрдврд╝рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдХрдИ рд▓реЗрдЦреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдХрдИ рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рд░рд╣реЗред  рдЗрд╕рд▓рд┐рдП, рдкреНрд░рд▓реЗрдЦрди рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рдиреАрдЪреЗ рджреА рдЧрдИ рдЖрд▓реЛрдЪрдирд╛рдУрдВ рдХреЛ рдкрдврд╝рддреЗ рд╣реБрдП, рдпрд╣ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЗрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдЪреАрдЬреЗрдВ рдЕрдм рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рдирд╣реАрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреБрдЫ рдЕрднреА рднреА рдХрд╛рдлреА рд╣реИрдВред  рдЖрдЦрд┐рд░рдХрд╛рд░, рдЖрдзреБрдирд┐рдХ рджреБрдирд┐рдпрд╛ рдореЗрдВ 5 рд╕рд╛рд▓ рд╕рд┐рд░реНрдл рдПрдХ рдмрд╣реБрдд рдХреБрдЫ рдирд╣реАрдВ рд╣реИ, рдмрд▓реНрдХрд┐ рдмрд╣реБрдд рдХреБрдЫ рд╣реИред  рдЙрд╕ рд╕рдордп рд╕реЗ (рд╡рд┐рд╢реЗрд╖рдХрд░ рдпрджрд┐ рдЖрдк рдЬрд┐рдпреЛрдЪреИрдЯ рдХреЗ рдмрд╛рдж рд╕реЗ рдЕрд╕реНрд╡реАрдХреГрдд рдФрд░ рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рдирд╣реАрдВ рд░рдЦрддреЗ рд╣реИрдВ), рддреЛ рдЗрд╕ рдпреЛрдЬрдирд╛ рдореЗрдВ рдПрдкреАрдЖрдИ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реМ рд╕реЗ рдмрдврд╝рдХрд░ рджреЛ рд╕реМ рд╕реЗ рдкрдЪрд╛рд╕ рд╣реЛ рдЧрдИ рд╣реИ! </p><br><h2 id="anchorbeginanchors-chego-nachat-molodomu-avtoru"><a name="begin"></a>  рдпреБрд╡рд╛ рд▓реЗрдЦрдХ рдХрд╣рд╛рдБ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ? </h2><br><p>,            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Telethon  Python</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Madeline  PHP</a>,       <em>  </em> тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> <code>api_id</code>  <code>api_hash</code> (  API   ),      .  <strong></strong>     ,    ,       ,    . ,    ,     тАФ   ,        <strong> </strong> ,       .</p><br>
<p>  ,    ,    ,        Telegram    , ,  ..      ,       ""      ,    , ..  .  ,    ,    .</p><br>
<p>    ,          .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://core.telegram.org/</a>    Getting Started    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> MTProto</a> тАФ     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">   OSI</a>      ,   .</p><br>
<p>  ,   MTProto,  ,     (       , layer violation)    ,    ...</p><br>
<h1 id="anchortlanchorbinarnaya-serializaciya-tl-type-language-i-ego-shema-i-sloi-i-mnogo-drugih-strashnyh-slov"><a name="TL"></a> : TL (Type Language)   ,  ,     </h1><br>
<p> , ,   Telegram тАФ .   ,      ,  .</p><br>
<p>, .      , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">JSON Schema</a>,   .   :        .  , ,   .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> MTProto</a>,       ,    - ,    :</p><br>
<pre><code class="plaintext">int ? = Int;
long ? = Long;
double ? = Double;
string ? = String;

vector#1cb5c415 {t:Type} # [ t ] = Vector t;

rpc_error#2144ca19 error_code:int error_message:string = RpcError;

rpc_answer_unknown#5e2ad36e = RpcDropAnswer;
rpc_answer_dropped_running#cd78e586 = RpcDropAnswer;
rpc_answer_dropped#a43ad8b7 msg_id:long seq_no:int bytes:int = RpcDropAnswer;

msg_container#73f1f8dc messages:vector&lt;%Message&gt; = MessageContainer;

---functions---

set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:bytes = Set_client_DH_params_answer;

ping#7abe77ec ping_id:long = Pong;
ping_delay_disconnect#f3427b8c ping_id:long disconnect_delay:int = Pong;

invokeAfterMsg#cb9f372d msg_id:long query:!X = X;
invokeAfterMsgs#3dc4b4f0 msg_ids:Vector&lt;long&gt; query:!X = X;

account.updateProfile#78515775 flags:# first_name:flags.0?string last_name:flags.1?string about:flags.2?string = User;
account.sendChangePhoneCode#8e57deb flags:# allow_flashcall:flags.0?true phone_number:string current_number:flags.0?Bool = auth.SentCode;</code></pre><br>
<p>,   ,       тАФ ,    (  ,   ?),     ,      тАж .         ++ (  , <em> </em>).      ,  , , ,  (       ), - ,  - ,   тАФ   ,     <em></em> (    )  ?    <em>(,        JSON- тАФ      )</em>.</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Binary Data Serialization</a>    <s>     </s>      4 . , , , ,  ,  ,  ,  тАж      !    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">TL Language</a>,          ,        ,  ,                !</p><br>
<p>,        , ,     ,   ,   ,   ,   -   .    :</p><br>
<ul>
<li>, <em></em>  ,  ,  <strong> </strong></li>
<li>       IT-  тАФ     </li>
<li>,   ,    <strong> </strong>,        TL,   </li>
</ul><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">LeoNerd</a>   <code>#perl</code>  IRC- FreeNode,     Telegram  Matrix (    ):</p><br>
<blockquote> ,  -     ,         ,   ,     .</blockquote><p> ,   bare- (int, long  ..)  -     тАФ        тАФ        <strong></strong>.  ,   , <em></em>,      .</p><br>
<p>  </p><br>
<h2 id="anchorsynanchor-kratkoe-opisanie-podmnozhestva-sintaksisa-tl-dlya-teh-kto-ne-et-chitat-oficialnuyu-dokumentaciyu"><a name="syn"></a>     TL  ,  тАж    </h2><br>
<pre><code class="plaintext">constructor = Type;
myVec ids:Vector&lt;long&gt; = Type;

fixed#abcdef34 id:int = Type2;

fixedVec set:Vector&lt;Type2&gt; = FixedVec;

constructorOne#crc32 field1:int = PolymorType;
constructorTwo#2crc32 field_a:long field_b:Type3 field_c:int = PolymorType;
constructorThree#deadcrc bit_flags_of_what_really_present:# optional_field4:bit_flags_of_what_really_present.1?Type = PolymorType;

an_id#12abcd34 id:int = Type3;
a_null#6789cdef = Type3;</code></pre><br>
<p>   <strong></strong>,    (  тАФ )   <code>#</code>  <strong>CRC32</strong>      .    ,    тАФ     .        ,    тАФ  , ,  тАФ .  ,     ,  <strong></strong> тАФ        .</p><br>
<p>      <code>---functions---</code>,     ,     :    RPC-,  тАФ  (         ,   ,     ),  " " тАФ   . , ,     тАФ     <code>---types---</code>,      " ".       , ..        ,   ,   C++,  TL -  .</p><br>
<p> ""  "",    ? ,   , -           тАФ     ,   тАФ    -,  <code>final</code>    .   , ,   <em></em>       - .   тАФ    ,    (           ,   ,     ) тАФ        ,   <em></em>     .</p><br>
<p>  ? ,     4 ,   <code>0xcrc32</code> тАФ  ,    <code>field1</code>   <code>int</code>, ..   4 ,       <code>PolymorType</code> .  <code>0x2crc32</code>  ,    ,  <code>long</code>,   8 .     ,   . , <code>Type3</code>         , ,     <code>0x12abcd34</code>,      4  <code>int</code>,  <code>0x6789cdef</code>,     .   тАФ   .          4  <code>int</code>  <code>field_c</code>  <code>constructorTwo</code>       <code>PolymorType</code>.</p><br>
<p>,   <code>0xdeadcrc</code>  <code>constructorThree</code>,    .     <code>bit_flags_of_what_really_present</code>   <code>#</code> тАФ   ,       <code>nat</code>,  " ".  ,  , unsigned int тАФ , , ,       . ,     , ,     тАФ    on the wire,       ,    (   ). , ,    , ,      <code>Type</code>,      2 .   (   ),     <code>ids</code>   <code>ids:Vector&lt;long&gt;</code>.</p><br>
<p>  ,     generic'    Java.  . , .  <strong></strong>       ,      Vector.      4  CRC32    Vector,  ,  4  тАФ   ,     .</p><br>
<p>   ,       4 ,     тАФ      <code>bytes</code>  <code>string</code>         4 тАФ ,        ?  TL     ,     ,    ,        4 ,   JSON   ? ,        ,   ,     ,          ?..</p><br>
<p>  ,      ,   ,    . -, CRC32         (  whitespace  ..) тАФ      ,    ,     CRC32 , , .       ,         ,    ,     ?..</p><br>
<p>-,   <strong>CRC32</strong>,        <strong>-</strong>   ,    ().       тАФ  ,     2<sup>32</sup>,   .    ,  CRC32    ( )    ,        ? ,     :    CRC32   ,    4      4  тАФ   .           (  ),      ,     .</p><br>
<blockquote>,   ,   <em></em> CRC32?      (  )  -,          239, -!</blockquote><p>, ,  ,      <code>Vector&lt;int&gt;</code>  <code>Vector&lt;PolymorType&gt;</code>    CRC32.      ?     , <em>    </em>? ,       ,   <code>Vector&lt;int&gt;</code>  ,    40000 .    <code>Vector&lt;Type2&gt;</code>,       <code>int</code>      тАФ    10000   0xabcdef34   4  <code>int</code>,            <code>fixedVec</code>   80000     40000 ?</p><br>
<p>      тАФ ,     ,     id, ,  тАФ           .    Telegram   .</p><br>
<p>...</p><br>
<h2 id="anchorvectoranchorvector-kotoryy-tak-i-ne-smogli-vyvesti"><a name="vector"></a>Vector,      </h2><br>
<p>         ,  ,   (  )     tuples  .     ,   ,     ,       .    ?   <em></em>,  ,      тАФ    lazy evaluation     .   <em> </em>   :    <strong></strong>, ..     тАФ   ,  тАФ          ( <code>(cons)</code>  Lisp).  , ,   <strong></strong>    4  (CRC32    TL)    .      <em> </em>,         тАФ .</p><br>
<p>,  TL    ,    .     :</p><br>
<blockquote>Serialization always uses the same constructor тАЬvectorтАЭ (const 0x1cb5c415 = crc32("vector t:Type # [ t ] = Vector tтАЭ) that is not dependent on the specific value of the variable of type t. <br>
<br>
The value of the optional parameter t is not involved in the serialization since it is derived from the result type (always known prior to deserialization).</blockquote><p>: <code>vector {t:Type} # [ t ] = Vector t</code> тАФ  <em></em>      ,        !     .  ,        .       ,   :</p><br>
<blockquote>The Vector t polymorphic pseudotype is a тАЬtypeтАЭ whose value is a sequence of values of any type t, either boxed or bare.</blockquote><p>тАж      .  ,      (       ),            ,    :     ,     ( - ACM),    .  тАФ     тАФ .</p><br>
<blockquote>,  . , <code>#</code>   <code>nat</code>,  :<br>
<br>
There are type expressions (<em>type-expr</em>) and numeric expressions (<em>nat-expr</em>). However, they are defined the same way.<br>
<pre><code class="plaintext">type-expr ::= expr
nat-expr ::= expr</code></pre><br>
<br>
     , ..          .</blockquote><p>  ,   (<code>vector&lt;int&gt;</code>, <code>vector&lt;User&gt;</code>)    (<code>#1cb5c415</code>), ..  ,    </p><br>
<pre><code class="plaintext">users.getUsers#d91a548 id:Vector&lt;InputUser&gt; = Vector&lt;User&gt;;</code></pre><br>
<p>     ,   . , <em></em>  тАФ     ,   bare-,   ,  -      тАФ          <em> </em>?     - PHP,           ?</p><br>
<p>     тАФ     TL? ,         ,   protobuf,   ?   ,    .</p><br>
<h2 id="anchortlimplanchorsuschestvuyuschie-realizacii-tl-v-kode"><a name="TLimpl"></a>  TL  </h2><br>
<p>TL              (<em></em>),     Telegram.      <a href="">  </a>     .         ,    Telegram. ,       (     ( )   ). </p><br>
<pre><code class="plaintext">Templates are not used now. Instead, the same universal constructors (for example, vector {t:Type} [t] = Vector t) are used w</code></pre><br>
<p>    ,  ,  ,   .</p><br>
<pre><code class="plaintext">#define ZHUKOV_BYTES_HACK

#ifdef ZHUKOV_BYTES_HACK

/* dirty hack for Zhukov request */</code></pre><br>
<p> , :</p><br>
<pre><code class="plaintext">    static const char *reserved_words_polymorhic[] = {

      "alpha", "beta", "gamma", "delta", "epsilon", "zeta", "eta", "theta", NULL

      };</code></pre><br>
<p>  тАФ  , :</p><br>
<pre><code class="plaintext">intHash {alpha:Type} vector&lt;coupleInt&lt;alpha&gt;&gt; = IntHash&lt;alpha&gt;;</code></pre><br>
<p>    ,    int тАФ Type.  C++     :</p><br>
<pre><code class="plaintext">    template &lt;T&gt; class IntHash {
      vector&lt;pair&lt;int,T&gt;&gt; _map;
    }</code></pre><br>
<p> , <code>alpha</code> тАФ  !    C++    T,    alpha, betaтАж    8 ,    .   ,  -      :</p><br>
<pre><code class="plaintext">--    TL 
-- ...     , ,...     ... , !
-- ?   

-- ,        !
--  ,     ?
--   ,     ,  --  </code></pre><br>
<p>       TL "".       Telegram-.</p><br>
<p> :</p><br>
<blockquote>Vasily, [09.10.18 17:07]<br>
     ,     ,      ,    <br>
 ,    .jpg<br>
   .webp</blockquote><p>,          ,    , ,        -        <abbr title="Domain Specific Language">DSL</abbr>, ?..</p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">telegram-cli</a>   ,       TLO   (cli) ,   тАФ     TL  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>,      <a href=""> TL</a>?..</p><br>
<blockquote>16.12 04:18 Vasily: -, -   lex+yacc<br>
16.12 04:18 Vasily:      <br>
16.12 04:18 Vasily:         <br>
16.12 04:19 Vasily: 3+  <code>&lt;censored&gt;</code>  </blockquote><p>, ?  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>    тАФ Telegram Desktop:</p><br>
<pre><code class="python">    nametype = re.match(r'([a-zA-Z\.0-9_]+)(#[0-9a-f]+)?([^=]*)=\s*([a-zA-Z\.&lt;&gt;0-9_]+);', line);
    if (not nametype):
      if (not re.match(r'vector#1cb5c415 \{t:Type\} # \[ t \] = Vector t;', line)):
         print('Bad line found: ' + line);</code></pre><br>
<p>1100+   ,   +    , , ,        TL,      ,   тАж ,      <i></i> ,          ?!</p><br>
<p>тАж ,     CRC32?  ,   Telegram Desktop      ,    CRC32 <em> </em>    !</p><br>
<blockquote>Vasily, [18.12 22:49]<br>
   ,     TL<br>
      ,      ,      <br>
tdesktop, , </blockquote><p>   ,      .</p><br>
<p>, telegram-cli тАФ , Telegram Desktop тАФ ,    ?   ?..   Android-      (    ,     ),       ,      .</p><br>
<p>      ? ,  , ,      :</p><br>
<blockquote>Vasily: <code>flags.0? true</code><br>
,      true,   <br>
<br>
Vasily: <code>flags.1? int</code><br>
,   ,    <br>
<br>
Vasily: ,  ,   !<br>
Vasily:  -    ,  true тАФ     ,     -  <br>
Vasily:       ,      </blockquote><p>, , Telethon?     MTProto,  тАФ      ,   <code>%</code>      "  bare-", ..     ,   :</p><br>
<blockquote>Vasily, [22.06.18 18:38]<br>
  :<br>
<pre><code class="plaintext">msg_container#73f1f8dc messages:vector message = MessageContainer;</code></pre><br>
<br>
 :<br>
<pre><code class="plaintext">msg_container#73f1f8dc messages:vector&lt;%Message&gt; = MessageContainer;</code></pre><br>
<br>
    ,    -  <br>
<br>
   bare      <br>
<br>
 telethon   <br>
<br>
     <code>msg_container</code><br>
<br>
 ,    %.   .<br>
<br>
Vadim Goncharov, [22.06.18 19:22]<br>
  tdesktop?<br>
<br>
Vasily, [22.06.18 19:23]<br>
   TL        <br>
<br>
<code>// parsed manually</code><br>
<br>
TL  ,     <br>
<br>
 %     <br>
<br>
     ,   <br>
<br>
   ,      <br>
<br>
     TL,     </blockquote><p>" ",   , "-   ,  ,  ".</p><br>
<p> : "   ,   </p><br>
<pre><code class="plaintext">    args: /* empty */ { $$ = NULL; }
        | args arg { $$ = g_list_append( $1, $2 ); }
        ;

    arg: LC_ID ':' type-term { $$ = tl_arg_new( $1, $3 ); }
            | LC_ID ':' condition '?' type-term { $$ = tl_arg_new_cond( $1, $5, $3 ); free($3); }
            | UC_ID ':' type-term { $$ = tl_arg_new( $1, $3 ); }
            | type-term { $$ = tl_arg_new( "", $1 ); }
            | '[' LC_ID ']' { $$ = tl_arg_new_mult( "", tl_type_new( $2, TYPE_MOD_NONE ) ); }
            ;</code></pre><br>
<p>-  ,  </p><br>
<pre><code class="plaintext">struct tree *parse_args4 (void) {
  PARSE_INIT (type_args4);
  struct parse so = save_parse ();
  PARSE_TRY (parse_optional_arg_def);
  if (S) {
    tree_add_child (T, S);
  } else {
    load_parse (so);
  }
  if (LEX_CHAR ('!')) {
    PARSE_ADD (type_exclam);
    EXPECT ("!");
  }
  PARSE_TRY_PES (parse_type_term);
  PARSE_OK;
}</code></pre><br>
<p> </p><br>
<pre><code class="python">        # Regex to match the whole line
        match = re.match(r'''
            ^                  # We want to match from the beginning to the end
            ([\w.]+)           # The .tl object can contain alpha_name or namespace.alpha_name
            (?:
                \#             # After the name, comes the ID of the object
                ([0-9a-f]+)    # The constructor ID is in hexadecimal form
            )?                 # If no constructor ID was given, CRC32 the 'tl' to determine it

            (?:\s              # After that, we want to match its arguments (name:type)
                {?             # For handling the start of the '{X:Type}' case
                \w+            # The argument name will always be an alpha-only name
                :              # Then comes the separator between name:type
                [\w\d&lt;&gt;#.?!]+  # The type is slightly more complex, since it's alphanumeric and it can
                               # also have Vector&lt;type&gt;, flags:# and flags.0?default, plus :!X as type
                }?             # For handling the end of the '{X:Type}' case
            )*                 # Match 0 or more arguments
            \s                 # Leave a space between the arguments and the equal
            =
            \s                 # Leave another space between the equal and the result
            ([\w\d&lt;&gt;#.?]+)     # The result can again be as complex as any argument type
            ;$                 # Finally, the line should always end with ;
            ''', tl, re.IGNORECASE | re.VERBOSE)</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext">    ---functions---         return FUNCTIONS;
    ---types---             return TYPES;
    [a-z][a-zA-Z0-9_]*      yylval.string = strdup(yytext); return LC_ID;
    [A-Z][a-zA-Z0-9_]*      yylval.string = strdup(yytext); return UC_ID;
    [0-9]+                  yylval.number = atoi(yytext); return NUM;
    #[0-9a-fA-F]{1,8}       yylval.number = strtol(yytext+1, NULL, 16); return ID_HASH;

    \n                      /* skip new line */
    [ \t]+                  /* skip spaces */
    \/\/.*$                 /* skip comments */
    \/\*.*\*\/              /* skip comments */
    .                       return (int)yytext[0];</code></pre><br>
<p>..  тАФ   ".</p><br>
<p> ,          TL    100    ~300   (   <code>print</code>'  ),           .         ,   тАФ          .</p><br>
<h2 id="anchornotypelanganchornehvatka-tipov-v-yazyke-tipov"><a name="notypelang"></a>    </h2><br>
<p>  тАФ   , ? ,    (    ),     TL.   ,       .  ,    ,  ,       .      ?</p><br>
<p> , constraints.        :</p><br>
<blockquote>The fileтАЩs binary content is then split into parts. All parts must have the same size ( <strong>part_size</strong> ) and the following conditions must be met:<br>
<ul>
<li><code>part_size % 1024 = 0</code> (divisible by 1KB)</li>
<li><code>524288 % part_size = 0</code> (512KB must be evenly divisible by part_size)</li>
</ul><br>
<br>
The last part does not have to satisfy these conditions, provided its size is less than part_size.<br>
<br>
Each part should have a sequence number, <strong>file_part</strong>, with a value ranging from 0 to 2,999.<br>
<br>
After the file has been partitioned you need to choose a method for saving it on the server. Use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">upload.saveBigFilePart</a> in case the full size of the file is more than 10 MB and <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">upload.saveFilePart</a> for smaller files.<br>
[...] one of the following data input errors may be returned:<br>
<ul>
<li>FILE_PARTS_INVALID тАФ Invalid number of parts. The value is not between <code>1..3000</code></li>
</ul><br>
</blockquote><p>-     ?  -   TL? .  ,    Turbo Pascal   ,  <em></em>.     ,     <code>enum</code> тАФ ,     ()  .     тАФ , ,       <em></em>.     , тАж ,    ,         , ?</p><br>
<p>    TL .  , ,  JSON Schema.     512  -   ,        ,   ,    <em> </em>     <code>1..3000</code> (     )    , ?..</p><br>
<p>,     .     ,    TL тАФ     ,  <strong></strong>   TL          ,   .     TL   . ,           (   , RPC   -,     ) тАФ           ?..    тАФ   .</p><br>
<p>   ,   ? , ,    <strong>description</strong>     ( JSON-   ),      ,      тАФ       ?    <a href=""> </a>:</p><br>
<p>-<code>channelFull#76af5481 flags:# can_view_participants:flags.3?true can_set_username:flags.6?true can_set_stickers:flags.7?true hidden_prehistory:flags.10?true id:int about:string participants_count:flags.0?int admins_count:flags.1?int kicked_count:flags.2?int banned_count:flags.2?int read_inbox_max_id:int read_outbox_max_id:int unread_count:int chat_photo:Photo notify_settings:PeerNotifySettings exported_invite:ExportedChatInvite bot_info:Vector&lt;BotInfo&gt; migrated_from_chat_id:flags.4?int migrated_from_max_id:flags.4?int pinned_msg_id:flags.5?int stickerset:flags.8?StickerSet available_min_id:flags.9?int = ChatFull;</code><br>
+<code>channelFull#1c87a71a flags:# can_view_participants:flags.3?true can_set_username:flags.6?true can_set_stickers:flags.7?true hidden_prehistory:flags.10?true can_view_stats:flags.12?true id:int about:string participants_count:flags.0?int admins_count:flags.1?int kicked_count:flags.2?int banned_count:flags.2?int online_count:flags.13?int read_inbox_max_id:int read_outbox_max_id:int unread_count:int chat_photo:Photo notify_settings:PeerNotifySettings exported_invite:ExportedChatInvite bot_info:Vector&lt;BotInfo&gt; migrated_from_chat_id:flags.4?int migrated_from_max_id:flags.4?int pinned_msg_id:flags.5?int stickerset:flags.8?StickerSet available_min_id:flags.9?int = ChatFull;</code></p><br>
<p></p><br>
<p>-<code>message#44f9b43d flags:# out:flags.1?true mentioned:flags.4?true media_unread:flags.5?true silent:flags.13?true post:flags.14?true id:int from_id:flags.8?int to_id:Peer fwd_from:flags.2?MessageFwdHeader via_bot_id:flags.11?int reply_to_msg_id:flags.3?int date:int message:string media:flags.9?MessageMedia reply_markup:flags.6?ReplyMarkup entities:flags.7?Vector&lt;MessageEntity&gt; views:flags.10?int edit_date:flags.15?int post_author:flags.16?string grouped_id:flags.17?long = Message;</code><br>
+<code>message#44f9b43d flags:# out:flags.1?true mentioned:flags.4?true media_unread:flags.5?true silent:flags.13?true post:flags.14?true from_scheduled:flags.18?true id:int from_id:flags.8?int to_id:Peer fwd_from:flags.2?MessageFwdHeader via_bot_id:flags.11?int reply_to_msg_id:flags.3?int date:int message:string media:flags.9?MessageMedia reply_markup:flags.6?ReplyMarkup entities:flags.7?Vector&lt;MessageEntity&gt; views:flags.10?int edit_date:flags.15?int post_author:flags.16?string grouped_id:flags.17?long = Message;</code></p><br>
<p>  ,  GitHub, ,       .  " 10 ",     ,         ,    -  тАж   ,        ,     <em>  </em>.</p><br>
<p>,   .     ?   ,   <em></em>      ?       .  ,   ,      .          :</p><br>
<pre><code class="plaintext">storage.fileUnknown#aa963b05 = storage.FileType;
storage.filePartial#40bc6f52 = storage.FileType;
storage.fileJpeg#7efe0e = storage.FileType;
storage.fileGif#cae1aadf = storage.FileType;
storage.filePng#a4f63c0 = storage.FileType;
storage.filePdf#ae1e508d = storage.FileType;
storage.fileMp3#528a0677 = storage.FileType;
storage.fileMov#4b09ebbc = storage.FileType;
storage.fileMp4#b3cea0e4 = storage.FileType;
storage.fileWebp#1081464c = storage.FileType;</code></pre><br>
<p>  ,      5  ,    32     .  .     TL          .</p><br>
<p> ,        . ,  MTProto ( )     Gzip,   тАФ  ,     . ,     RpcResult,   .     ?..   ,     .</p><br>
<p>  ,     тАФ  <code>InputPeerUser</code>  <code>InputUser</code>.  .   !       .    ? , ,      telegram-cli:</p><br>
<pre><code class="plaintext">  if (tgl_get_peer_type (E-&gt;id) != TGL_PEER_CHANNEL || (C &amp;&amp; (C-&gt;flags &amp; TGLCHF_MEGAGROUP))) {
    out_int (CODE_messages_get_history);
    out_peer_id (TLS, E-&gt;id);
  } else {    
    out_int (CODE_channels_get_important_history);

    out_int (CODE_input_channel);
    out_int (tgl_get_peer_id (E-&gt;id));
    out_long (E-&gt;id.access_hash);
  }
  out_int (E-&gt;max_id);
  out_int (E-&gt;offset);
  out_int (E-&gt;limit);
  out_int (0);
  out_int (0);</code></pre><br>
<p> ,    <strong></strong>,    !  ,   ?..  ,  ,    ,       ?        ?       .</p><br>
<h2 id="anchoronionanchorversionnost-sloi-layers"><a name="onion"></a>.  (layers)</h2><br>
<p>    ,    ,     .   ,   ,        ,   ,  ,    ,      .  ,    тАФ      "",   .  ,    . ,       тАФ ,       .    2.       TL:</p><br>
<blockquote>If a client supports Layer 2, then the following constructor must be used:<br>
<pre><code class="plaintext">invokeWithLayer2#289dd1f6 {X:Type} query:!X = X;</code></pre><br>
<br>
In practice, this means that before every API call, an int with the value <code>0x289dd1f6</code> must be added before the method number.</blockquote><p> .    ?  </p><br>
<pre><code class="plaintext">invokeWithLayer3#b7475268 query:!X = X;</code></pre><br>
<p> ?   ,</p><br>
<pre><code class="plaintext">invokeWithLayer4#dea0d430 query:!X = X;</code></pre><br>
<p>? ,   ,   ,  <strong></strong>           тАФ      ,    -?     4   тАФ   . So,</p><br>
<pre><code class="plaintext">invokeWithLayer5#417a57ae query:!X = X;</code></pre><br>
<p> ,        .   :</p><br>
<blockquote>Update: Starting with Layer 9, helper methods <code>invokeWithLayerN</code> can be used only together with <code>initConnection</code></blockquote><p>!  9   , ,  ,   Internet-    80- тАФ       !</p><br>
<p> ?..</p><br>
<pre><code class="plaintext">invokeWithLayer10#39620c41 query:!X = X;
...
invokeWithLayer18#1c900537 query:!X = X;</code></pre><br>
<p>     .    9  , ,      ,         ,       ,     ,   .  .</p><br>
<p>?..</p><br>
<blockquote>Vasily, [16.07.18 14:01]<br>
   :<br>
    .     InvokeWithLayer.    ,       .<br>
<br>
..     ,     <br>
<br>
Vadim Goncharov, [16.07.18 14:02]<br>
 InvokeWithLayer     ?<br>
<br>
Vasily, [16.07.18 14:02]<br>
  <br>
<br>
Vadim Goncharov, [16.07.18 14:02]<br>
         <br>
<br>
,   ,     </blockquote><p>, ..  <code>Updates</code>   тАФ  ,         API-,     .   ,      ,    ,    Updates     .</p><br>
<p> ,     <em></em>     ,      :</p><br>
<ul>
<li>      ,   ,    </li>
<li>     ?</li>
<li> <em></em>,          ?</li>
</ul><br>
<p>,    ,       ,     (  ,  )? !    !</p><br>
<p>       . 14   ,    Telegram - тАж    :</p><br>
<pre><code class="plaintext">2019-08-15 09:28:35.880640 MSK warn  main: ANON:87: unknown object type: 0x80d182d1 at TL/Object.pm line 213.
2019-08-15 09:28:35.751899 MSK warn  main: ANON:87: unknown object type: 0xb5223b0f at TL/Object.pm line 213.</code></pre><br>
<p>     (,    ).      TL -   тАФ     ,    <strong></strong> ,   .      ?</p><br>
<p>,       тАФ    .  .   CRC32 тАФ     73 ,     82.     тАФ      !</p><br>
<p>,      ? ,  Telegram Desktop 1.2.17 (,     Linux),     Exception: MTP Unexpected type id #b5223b0f read in MTPMessageMedia...</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/a59/759/6b7/a597596b72291e5d5c6ac57525003074.jpg"></p><br>
<p> ,     -     ,         ...</p><br>
<p>   -?    :      91,         73.   ,    ,   ,         ,     .</p><br>
<p>     :  , ,     , ,   ,    тАФ ,             .          .</p><br>
<p>?       ,          .  ,   ,    "",    ,    ,      ,     .      "",      .</p><br>
<p> тАж     ?!.. ,      ,      .    Android     TL-,     (   )  ().   :</p><br>
<pre><code class="java">public static class TL_message_layer68 extends TL_message {
    public static int constructor = 0xc09be45f;
//...
//  
//...
    public static class TL_message_layer47 extends TL_message {
        public static int constructor = 0xc992e15c;
        public static Message TLdeserialize(AbstractSerializedData stream, int constructor, boolean exception) {
            Message result = null;
            switch (constructor) {
                case 0x1d86f70e:
                    result = new TL_messageService_old2();
                    break;
                case 0xa7ab1991:
                    result = new TL_message_old3();
                    break;
                case 0xc3060325:
                    result = new TL_message_old4();
                    break;
                case 0x555555fa:
                    result = new TL_message_secret();
                    break;
                case 0x555555f9:
                    result = new TL_message_secret_layer72();
                    break;
                case 0x90dddc11:
                    result = new TL_message_layer72();
                    break;
                case 0xc09be45f:
                    result = new TL_message_layer68();
                    break;
                case 0xc992e15c:
                    result = new TL_message_layer47();
                    break;
                case 0x5ba66c13:
                    result = new TL_message_old7();
                    break;
                case 0xc06b9607:
                    result = new TL_messageService_layer48();
                    break;
                case 0x83e5de54:
                    result = new TL_messageEmpty();
                    break;
                case 0x2bebfa86:
                    result = new TL_message_old6();
                    break;
                case 0x44f9b43d:
                    result = new TL_message_layer104();
                    break;
                case 0x1c9b1027:
                    result = new TL_message_layer104_2();
                    break;
                case 0xa367e716:
                    result = new TL_messageForwarded_old2(); //custom
                    break;
                case 0x5f46804:
                    result = new TL_messageForwarded_old(); //custom
                    break;
                case 0x567699b3:
                    result = new TL_message_old2(); //custom
                    break;
                case 0x9f8d60bb:
                    result = new TL_messageService_old(); //custom
                    break;
                case 0x22eb6aba:
                    result = new TL_message_old(); //custom
                    break;
                case 0x555555F8:
                    result = new TL_message_secret_old(); //custom
                    break;
                case 0x9789dac4:
                    result = new TL_message_layer104_3();
                    break;</code></pre><br>
<p></p><br>
<pre><code class="java">    boolean fixCaption = !TextUtils.isEmpty(message) &amp;&amp;
    (media instanceof TLRPC.TL_messageMediaPhoto_old ||
     media instanceof TLRPC.TL_messageMediaPhoto_layer68 ||
     media instanceof TLRPC.TL_messageMediaPhoto_layer74 ||
     media instanceof TLRPC.TL_messageMediaDocument_old ||
     media instanceof TLRPC.TL_messageMediaDocument_layer68 ||
     media instanceof TLRPC.TL_messageMediaDocument_layer74)
    &amp;&amp; message.startsWith("-1");</code></pre><br>
<p>тАж  . , ,   ,  ?..      ! , ,      ,   ,   <code>_old7</code> -     тАж ,     </p><br>
<pre><code class="plaintext">TL_message_layer104
TL_message_layer104_2
TL_message_layer104_3</code></pre><br>
<p>,   ,       ?! , , "", ,   ,  ,  ?..        ?    , ?..</p><br>
<p>  Telegram Desktop, ,   тАФ  ,           ,  - .  ,       ,   ,    ?   ,    ,    ,     .</p><br>
<p>     ? ,  -,       .</p><br>
<p>,    :</p><br>
<pre><code class="java">public static class TL_folders_deleteFolder extends TLObject {
    public static int constructor = 0x1c295881;

    public int folder_id;

    public TLObject deserializeResponse(AbstractSerializedData stream, int constructor, boolean exception) {
        return Updates.TLdeserialize(stream, constructor, exception);
    }

    public void serializeToStream(AbstractSerializedData stream) {
        stream.writeInt32(constructor);
        stream.writeInt32(folder_id);
    }
}

//manually created

//RichText start
public static abstract class RichText extends TLObject {
    public String url;
    public long webpage_id;
    public String email;
    public ArrayList&lt;RichText&gt; texts = new ArrayList&lt;&gt;();
    public RichText parentRichText;

    public static RichText TLdeserialize(AbstractSerializedData stream, int constructor, boolean exception) {
        RichText result = null;
        switch (constructor) {
            case 0x1ccb966a:
                result = new TL_textPhone();
                break;
            case 0xc7fb5e01:
                result = new TL_textSuperscript();
                break;</code></pre><br>
<p>   "manually created"   ,        (     maintenance?),     . ,     тАФ  ,    <em> </em> (-   GPL   Linux),       .</p><br>
<p> .   ,      .</p><br>
<h1 id="anchormtanchor-mtproto"><a name="MT"></a> MTProto</h1><br>
<p>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  </a>      .    . ,     Telegram тАФ      -,     ,   (,   API   sticker pack тАФ   ,   ).</p><br>
<p>, "" (message)  "" (session) тАФ   ,     Telegram-. ,    ,        ,      "" тАФ  ,  ,    ,   ,  .   тАж     .</p><br>
<h2 id="anchorpolimeryanchortransportnyy-uroven"><a name="polimery"></a> </h2><br>
<p>  тАФ .     5 :</p><br>
<ul>
<li>TCP</li>
<li>Websocket</li>
<li>Websocket over HTTPS</li>
<li>HTTP</li>
<li>HTTPS</li>
</ul><br>
<blockquote>Vasily, [15.06.18 15:04]<br>
   UDP ,    <br>
<br>
 TCP   <br>
<br>
   UDP  TCP,      sequence number  crc<br>
      ?</blockquote><p>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">TCP   4 </a>:</p><br>
<ul>
<li>Abridged</li>
<li>Intermediate</li>
<li>Padded intermediate</li>
<li>Full</li>
</ul><br>
<p> , Padded intermediate  MTProxy,    -  .       ( ),      ?       ,      payload    MTProto,     :</p><br>
<ul>
<li> Abridged  1  4 ,   0xef,  </li>
<li> Intermediate  4    ,       <code>0xeeeeeeee</code>  ,   Intermediate</li>
<li> Full  ,    : , sequence number,   ,    MTProto, , CRC32. ,    TCP.          ,    ,    . ,   ,   TCP 16-  ,     . ,    -      16 ,    тАФ    тАФ     SHA  .    CRC32   тАФ .</li>
</ul><br>
<p> Abridged,      ,  Intermediate,   "In case 4-byte data alignment is needed",  - . , ,   Telegram  ,          ?     ,           (    -...).    ,   Abridged,         padding'  16  тАФ  3  <em></em> ?</p><br>
<p> ,       ,     ,    .</p><br>
<p>  ,  .. Web  MTProxy,     ,  ,   ,   .    MTProxy   ,       2018,      ,   <strong> </strong>,  <em> </em>!    ,   (  )  MTProxy        ,      (  ),        Go,    Node.js      .</p><br>
<p>            ,    .    5-  OSI,  тАФ     MTProto session.</p><br>
<h2 id="anchorkeystermsdhanchorklyuchi-soobscheniya-sessii-diffie-hellman"><a name="keystermsDH"></a>, , , Diffie-Hellman</h2><br>
<p>      тАж  тАФ    ,      Active sessions.   .</p><br>
<img src="https://habrastorage.org/getpro/habr/post_images/afa/7dc/a1d/afa7dca1d0a7b13070911cf36e24dba1.jpg"><br>
<p>         .    ,  plaintext тАФ            .        ""  ?       Telegram (             4 ,       ):</p><br>
<blockquote>     <em>session</em> тАФ   UI    "current sessions",       / OS.<br>
 тАФ <em>MTProto session</em>,    sequence number  (  )  ,   <strong>    TCP-.</strong>      MTProto-,     .<br>
<br>
   <em>sessions</em>   <em>authorization</em>.   ,  ,  <em>UI-</em>   ,  <em>authorization</em>,  ,  . :<br>
<ul>
<li>      <em>auth_key</em>  bounds it to account,   SMS тАФ   <em>authorization</em></li>
<li>    <em>MTProto session</em>,   <code>session_id</code>  .</li>
<li>  ,  <em>authorization</em>  <code>session_id</code>    <em>instance</em> тАФ         </li>
<li>,    <strong></strong> <em>MTProto sessions</em>      <em>auth_key</em> тАФ      DC.</li>
<li>,       <em> DC</em> тАФ    DC    <em>auth_key</em> !</li>
<li>  ,      ,     <em>authorization</em> (<em>UI-</em>),    API <code>auth.exportAuthorization</code>   DC <code>auth.importAuthorization</code>   DC.</li>
<li>  ,     <em>MTProto sessions</em> (   <code>session_id</code>)    DC,  <strong></strong> <em>auth_key</em>.</li>
<li>,    Perfect Forward Secrecy.  <em>auth_key</em>  <strong>permanent</strong> key тАФ per DC тАФ     <code>auth.bindTempAuthKey</code>   <strong>temporary</strong> <em>auth_key</em> тАФ  ,   <em>temp_auth_key</em> per DC,    <em>MTProto sessions</em>   DC.</li>
</ul><br>
<br>
,  <em>salt</em> ( future salts)    <em>auth_key</em> .. shared   <em>MTProto sessions</em>      DC.</blockquote><p>  "  TCP-"? ,   <em> </em>    - тАФ   ()  TCP-   ,   .     HTTP,  MTProto       ,   ,   тАФ            ,      TCP-.</p><br>
<p>,        .    тАФ       ? тАФ   .</p><br>
<p> ,  <code>auth_key</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> -  Telegram</a>.   ...</p><br>
<blockquote>Vasily, [19.06.18 20:05]<br>
data_with_hash := SHA1(data) + data + (any random bytes); such that the length equal 255 bytes;<br>
encrypted_data := RSA (data_with_hash, server_public_key); a 255-byte long number (big endian) is raised to the requisite power over the requisite modulus, and the result is stored as a 256-byte number.<br>
<br>
  -  DH<br>
<br>
   DH  <br>
     </blockquote><p>      <del>  </del> тАФ  proof of work ,     .    DoS-.  RSA-       ,  ,   <code>new_nonce</code>.        ,    ?</p><br>
<blockquote>Vasily, [20.06.18 00:26]<br>
      appid<br>
<br>
    DH <br>
<br>
,     ,    4   .  <br>
<br>
     -404,  ?<br>
<br>
  : "  <s></s>      -,  DH",      404</blockquote><p>       ?  ? -    (     ).</p><br>
<blockquote>     <br>
<br>
    ,     - <br>
<br>
 32  .       <br>
<br>
 ,         BE<br>
<br>
Vadim Goncharov, [20.06.18 15:49]<br>
 -  404?<br>
<br>
Vasily, [20.06.18 15:49]<br>
!<br>
<br>
Vadim Goncharov, [20.06.18 15:50]<br>
    ,    " "<br>
<br>
Vasily, [20.06.18 15:50]<br>
<em></em><br>
<br>
       %)<br>
<br>
 error reporting  <br>
<br>
Vasily, [20.06.18 20:18]<br>
,    MD5.    <br>
<br>
The key fingerprint is computed as follows:<br>
<pre><code class="plaintext">digest = md5(key + iv)
fingerprint = substr(digest, 0, 4) XOR substr(digest, 4, 4)</code></pre><br>
<br>
SHA1  sha2</blockquote><p>, , <code>auth_key</code>  2048    - .  ?   ,   1024      тАж      .          .   TLS-,   .        ,   !  , , <em></em>. ..      "-",  -  ICQ,    "-",   SSH (  - gitlab/github).   .      "     DC"?   "   "? ,     тАФ     ,         .</p><br>
<p>, ""    .  ,   ?   ?    :</p><br>
<blockquote>Vasily, [21.06.18 17:53]<br>
     2    %)<br>
<br>
  , <br>
<br>
Vasily, [21.06.18 18:02]<br>
   ,  ,     </blockquote><p> .  ,         ?  <a href=""> </a> ( ,    ) тАФ  ,     :</p><br>
<pre><code class="plaintext">278     static const char *goodPrime = "c71caeb9c6b1c9048e6c522f70f13f73980d40238e3e21c14934d037563d930f48198a0aa7c14058229493d22530f4dbfa336f6e0ac925139543aed44cce7c3720fd51f69458705ac68cd4fe6b6b13abdc9746512969328454f18faf8c595f642477fe96bb2a941d5bcd1d4ac8cc49880708fa9b378e3c4f3a9060bee67cf9a4a4a695811051907e162753b56b0f6b410dba74d8a84b2a14b3144e0ef1284754fd17ed950d5965b4b9dd46582db1178d169c6bc465b0d6ff9ca3928fef5b9ae4e418fc15e83ebea0f87fa9ff5eed70050ded2849f47bf959d956850ce929851f0d8115f635b105ee2e4e15d04b2454bf6f4fadf034b10403119cd8e3b92fcc5b";
279   if (!strcasecmp(prime, goodPrime)) {</code></pre><br>
<p>,    <em>-</em>    ,          .</p><br>
<p>,    .  , ..  ,    ,    AES.</p><br>
<blockquote>The message key is defined as the 128 middle bits of the SHA256 of the message body (including session, message ID, etc.), including the padding bytes, prepended by 32 bytes taken from the authorization key.<br>
<br>
Vasily, [22.06.18 14:08]<br>
, , <br>
<br>
 <code>auth_key</code>. .  тАж    . Feel free to study the open source code.<br>
<br>
Note that MTProto 2.0 requires from 12 to 1024 bytes of padding, still subject to the condition that the resulting message length be divisible by 16 bytes.<br>
<br>
   ?<br>
<br>
 ,   404   </blockquote><p>       ,  ,   <abbr title="Message Authentication Code">MAC</abbr>  .   AES   ,      IGE. , ,      FAQтАж , ,       SHA-  ,     тАФ      -  silently ignore  (   ,   ?).</p><br>
<p>  ,  ,              .        ,   Telegram Desktop.    (   D877F783D5D3EF8C)    ,    MTProto (     1.0), ..   ,    ( -     <code>auth_key</code>  256 ,   <code>msg_key</code> ).  ,      .  ,       тАФ   .    ,   , ?..    MAC       ,  .   MTProto  <em></em>     ,        .     Telegram Desktop    <code>user_data</code>      тАФ  AES   CTR.</p><br>
<blockquote>Vasily, [21.06.18 01:27]<br>
,  ,   IGE: IGE was the first attempt at an "authenticating encryption mode," originally for Kerberos. It was a failed attempt (it does not provide integrity protection), and had to be removed. That was the beginning of a 20 year quest for an authenticating encryption mode that works, which recently culminated in modes like OCB and GCM.<br>
<br>
     :<br>
<br>
The team behind Telegram, led by Nikolai Durov, consists of six ACM champions, half of them Ph.Ds in math. It took them about two years to roll out the current version of MTProto.<br>
<br>
 .     <br>
<br>
     tls</blockquote><p>, ,      . , ,    TL    ?       ? , ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">initConnection</a>,   ?</p><br>
<blockquote>Vasily, [25.06.18 18:46]<br>
Initializes connection and save information on the user's device and application.<br>
<br>
  app_id, device_model, system_version, app_version  lang_code.<br>
<br>
  query<br>
<br>
  . Feel free to study the open source</blockquote><p>  invokeWithLayer    ,  - ? ,    тАФ    ,     тАФ  ,    :</p><br>
<blockquote>Vasily, [25.06.18 19:13]<br>
  ,      ,     invokewithlayer</blockquote><p> initConnection     ,     ? ,  ,          ,   ,    . !      !     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>   тАФ    , ...</p><br>
<blockquote>Only a small portion of the API methods are available to unauthorized users:</blockquote><br>
<ul>
<li>auth.sendCode</li>
<li>auth.resendCode</li>
<li>account.getPassword</li>
<li>auth.checkPassword</li>
<li>auth.checkPhone</li>
<li>auth.signUp</li>
<li>auth.signIn</li>
<li>auth.importAuthorization</li>
<li>help.getConfig</li>
<li>help.getNearestDc</li>
<li>help.getAppUpdate</li>
<li>help.getCdnConfig</li>
<li>langpack.getLangPack</li>
<li>langpack.getStrings</li>
<li>langpack.getDifference</li>
<li>langpack.getLanguages</li>
<li>langpack.getLanguage</li>
</ul><br>
<p>   , <code>auth.sendCode</code>,      ,     api_id  api_hash,      SMS  .        DC (     , ),        DC.  ,   IP-   DC  ,   <code>help.getConfig</code>. -    5 ,     2018    .</p><br>
<p>  ,         .      ,    IP-?      ,   ,    MTProto?  : "  ,       ?".    ,  -    <strong> RSA-</strong>, ..   <em></em>  . ,         ,       (,       MTProto,    ,  ).</p><br>
<p>, .              .     ,     ,   .  ...</p><br>
<blockquote>Vasily, [10.07.18 14:45]<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://core.telegram.org/method/help.getConfig</a><br>
<pre><code class="plaintext">config#7dae33e0 [...] = Config;
help.getConfig#c4f9186b = Config;</code></pre><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://core.telegram.org/api/datacenter</a><br>
<pre><code class="plaintext">config#232d5905 [...] = Config;
help.getConfig#c4f9186b = Config;</code></pre><br>
<br>
  ,  <br>
<br>
  tdesktop  </blockquote><p>,   , ,  .       .      ?  ,    ,  ?   ,   тАФ     (,      ).</p><br>
<p>тАж  ,    -   API, ..   ,  -    MTProto?  :</p><br>
<blockquote>Vasily, [28.06.18 02:04]<br>
,      e2e<br>
<br>
Mtproto        ,     <br>
<br>
      ,     ,   mtproto    </blockquote><p> ?        PFS,  (, Telegram Desktop   ).    API <code>auth.bindTempAuthKey</code>, ..   .          тАФ  , ,    <code>initConnection</code>  ..,   <em></em>  .     ,         DC,   <code>auth_key_id</code>         ,         ""   тАФ     ,   тАж        ,    future salts, ?..</p><br>
<p>    MTProto   .</p><br>
<h2 id="anchorrecurseanchorsoobscheniya-o-soobscheniyah-msg_id-msg_seqno-podtverzhdeniya-pingi-ne-v-tu-storonu-i-drugie-idiosinkrazii"><a name="recurse"></a>  , msg_id, msg_seqno, ,        </h2><br>
<p>    ?    ""   ,     ,   API. , msg_key   ,      .         (  ,  ,  padding,    ):</p><br>
<ul>
<li>salt тАФ int64</li>
<li>session_id тАФ int64</li>
<li>message_id тАФ int64</li>
<li>seq_no тАФ int32</li>
</ul><br>
<p>,  тАФ    DC.    ?   ,    <code>get_future_salts</code>,  ,      ,   ,     "",   () тАФ  . , ,   ,  <code>new_session_created</code> тАФ     -  , .       .</p><br>
<p>           . ,    MTProto   ?   , <code>session_id</code>  <code>seq_no</code>    . ,   TCP-, . ,       , , .     тАФ   TCP-   ,  <code>seq_no</code> .   тАФ    ,         ,   .</p><br>
<p>   <code>seq_no</code>? ,   .   ,    :</p><br>
<blockquote>Content-related Message<br>
<br>
A message requiring an explicit acknowledgment. These include all the user and many service messages, virtually all with the exception of containers and acknowledgments.<br>
<br>
Message Sequence Number (msg_seqno)<br>
<br>
A 32-bit number equal to twice the number of тАЬcontent-relatedтАЭ messages (those requiring acknowledgment, and in particular those that are not containers) created by the sender prior to this message and subsequently incremented by one if the current message is a content-related message. A container is always generated after its entire contents; therefore, its sequence number is greater than or equal to the sequence numbers of the messages contained in it.</blockquote><p>       1,     2?.. ,     "   ACK,  ",        тАФ  , ,    <strong></strong> ,      <code>seq_no</code>! ?     - , ,    ,         .              .     TCP  ,    - ,       ,   TCP <code>seq_no</code>  ,     <code>seq_no</code>   тАФ   .  MTProto   <strong></strong>  <code>seq_no</code>,   TCP,   <code>msg_id</code> !</p><br>
<p>    <code>msg_id</code>,     ?   ,    .    64- ,        "- ",   тАФ Unix timestamp,   ,   32  . ..     (        ).   ,   -  ,   .  ,  тАФ  <code>session_id</code> тАФ  : <strong>Under no circumstances can a message meant for one session be sent into a different session</strong>.  , ,    <em></em>  тАФ ,   , id .   ,     .</p><br>
<p>, <code>msg_id</code>  ...</p><br>
<h3 id="anchorrpcackanchorrpc-zaprosy-otvety-oshibki-podtverzhdeniya"><a name="RPCack"></a>RPC: , , . .</h3><br>
<p> ,  , ,         " RPC-",   .      content-related !  , <em></em>    !   .   <strong></strong>  <code>msg_id</code>.    тАФ :</p><br>
<pre><code class="plaintext">rpc_result#f35c6d01 req_msg_id:long result:Object = RpcResult;</code></pre><br>
<p>   ,     .  ,    API,  ,       тАФ ,   ,   ,        ,        ?  ,  ,      no workers,     :    TCP-  тАФ -,           <code>message_id</code>.    ,   .</p><br>
<p>?..   ?    RPC-    <code>msg_id</code>!      "     !"?  ,     ?   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  </a>  ,  </p><br>
<pre><code class="plaintext">msgs_ack#62d6b459 msg_ids:Vector long = MsgsAck;</code></pre><br>
<p>     .   !    RpcResult,    .  ,       MsgsAck тАФ , " ".    RpcResult.      .</p><br>
<p> ,      ! .           .   .  , ,   .    .</p><br>
<p>      .</p><br>
<pre><code class="plaintext">rpc_error#2144ca19 error_code:int error_message:string = RpcError;</code></pre><br>
<p>,  -,     тАФ  !  .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>, , ,  .    ,   тАФ <em> </em> HTTP- ( ,    ,       ),      <strong>___</strong>. , PHONE_NUMBER_OCCUPIED  FILE_PART__MISSING.   ,      <strong></strong>. , <code>FLOOD_WAIT_3600</code>  ,    ,  <code>PHONE_MIGRATE_5</code>,          5- DC.     , ?      ,  , .</p><br>
<p> ,      , ,      ,    <strong>   </strong>.  <em>  </em>. -, ,  / тАФ <code>RpcError</code>     <code>RpcResult</code>.   ?    ?.. ,  ,  <code>RpcError</code>       <code>RpcResult</code>,        ?..    ,     , ..    <code>req_msg_id</code> ?..</p><br>
<p>    .   ,    ,      :</p><br>
<pre><code class="plaintext">rpc_drop_answer#58e4a740 req_msg_id:long = RpcDropAnswer;</code></pre><br>
<p>     ,     ,  ,     (    ,   ),       (:   Telegram Desktop   ).</p><br>
<h3 id="anchorhighanchornarkomaniya-statusy-soobscheniy-o-soobscheniyah"><a name="high"></a>:    </h3><br>
<p>,       TL, MTProto  Telegram  ,   ,    <em>soft skills</em>     ,     .   , <i></i>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  </a>     ,           .</p><br>
<p>  ,  .    </p><br>
<pre><code class="plaintext">bad_msg_notification#a7eff811 bad_msg_id:long bad_msg_seqno:int error_code:int = BadMsgNotification;
bad_server_salt#edab447b bad_msg_id:long bad_msg_seqno:int error_code:int new_server_salt:long = BadMsgNotification;</code></pre><br>
<p>,         MTProto,   " тАФ  тАФ "           тАФ  .    :</p><br>
<ol>
<li>  ,    .   - ,   .</li>
<li>    ? 16, 17, 18, 19, 20, 32, 33, 34, 35, 48, 64тАж   , ?</li>
</ol><br>
<p> :</p><br>
<blockquote>The intention is that error_code values are grouped (error_code &gt;&gt; 4): for example, the codes 0x40 тАФ 0x4f correspond to errors in container decomposition.</blockquote><p>, -,    , -,  ,   ?   ?.. ,  .</p><br>
<p>         :</p><br>
<ul>
<li>Request for Message Status Information<br>
If either party has not received information on the status of its outgoing messages for a while, it may explicitly request it from the other party:<br>
<code>msgs_state_req#da69fb52 msg_ids:Vector long = MsgsStateReq;</code></li>
<li>Informational Message regarding Status of Messages<br>
<code>msgs_state_info#04deb57d req_msg_id:long info:string = MsgsStateInfo;</code><br>
Here, <code>info</code> is a string that contains exactly one byte of message status for each message from the incoming msg_ids list:<br>
<ul>
<li>1 = nothing is known about the message (msg_id too low, the other party may have forgotten it)</li>
<li>2 = message not received (msg_id falls within the range of stored identifiers; however, the other party has certainly not received a message like that)</li>
<li>3 = message not received (msg_id too high; however, the other party has certainly not received it yet)</li>
<li>4 = message received (note that this response is also at the same time a receipt acknowledgment)</li>
<li>+8 = message already acknowledged</li>
<li>+16 = message not requiring acknowledgment</li>
<li>+32 = RPC query contained in message being processed or processing already complete</li>
<li>+64 = content-related response to message already generated</li>
<li>+128 = other party knows for a fact that message is already received<br>
This response does not require an acknowledgment. It is an acknowledgment of the relevant msgs_state_req, in and of itself.<br>
Note that if it turns out suddenly that the other party does not have a message that looks like it has been sent to it, the message can simply be re-sent. Even if the other party should receive two copies of the message at the same time, the duplicate will be ignored. (If too much time has passed, and the original msg_id is not longer valid, the message is to be wrapped in msg_copy).</li>
</ul></li>
<li>Voluntary Communication of Status of Messages<br>
Either party may voluntarily inform the other party of the status of the messages transmitted by the other party.<br>
<code>msgs_all_info#8cc0d131 msg_ids:Vector long info:string = MsgsAllInfo</code></li>
<li>Extended Voluntary Communication of Status of One Message<br>
тАж<br>
<code>msg_detailed_info#276d3ec6 msg_id:long answer_msg_id:long bytes:int status:int = MsgDetailedInfo;</code><br>
<code>msg_new_detailed_info#809db6df answer_msg_id:long bytes:int status:int = MsgDetailedInfo;</code></li>
<li>Explicit Request to Re-Send Messages<br>
<code>msg_resend_req#7d861a08 msg_ids:Vector long = MsgResendReq;</code><br>
The remote party immediately responds by re-sending the requested messages [...]</li>
<li>Explicit Request to Re-Send Answers<br>
<code>msg_resend_ans_req#8610baeb msg_ids:Vector long = MsgResendReq;</code><br>
The remote party immediately responds by re-sending <i>answers</i> to the requested messages [...]</li>
<li>Message Copies<br>
In some situations, an old message with a msg_id that is no longer valid needs to be re-sent. Then, it is wrapped in a copy container:<br>
<code>msg_copy#e06046b2 orig_message:Message = MessageCopy;</code><br>
Once received, the message is processed as if the wrapper were not there. However, if it is known for certain that the message orig_message.msg_id was received, then the new message is not processed (while at the same time, it and orig_message.msg_id are acknowledged). The value of orig_message.msg_id must be lower than the containerтАЩs msg_id.</li>
</ul><br>
<p>   ,   <code>msgs_state_info</code>     TL (   ,      enum,    ).   . - ,      <em>  </em> ?..  ,     - ,    ,     тАФ   ,   .     <strong>  </strong>.</p><br>
<p> ,          ,       ,    ,    .   ,        <strong></strong>.   ,       ! ,   -,      .    , <em></em>,    ,    TL тАФ   ()   ,  ,    , ..         .</p><br>
<h3 id="anchorpinganchor-pingi-i-taymingi-ocheredi"><a name="ping"></a>   . .</h3><br>
<p> ,       (   ),     тАФ        TCP (  ,     ,       ),     MTProto тАФ <strong> </strong>.    <s></s>     ,      ,     .</p><br>
<p>   тАФ  . ,  -       тАФ      .    ?    . ,      -    , ,  Telegram Desktop   4 ,   ( ,   ,           ;    ,      ,      MTProto    ).</p><br>
<p>  ? ,        ,       -,      .       ,    ,    TCP тАФ  RTT      "" ( )      .  ,        тАФ          .</p><br>
<p>  ,  , ?     TCP     TCP тАФ       .</p><br>
<p> ,     ,  ,     ,    API? ,   ,  ,      . ?      <code>msg_id</code>,   <i></i> ,          тАФ    -        (,    ,         ,     тАФ     ,       - ). ,         ,    :</p><br>
<ol>
<li>      .</li>
<li> <code>msg_id</code>       тАФ  ;   .</li>
<li>)   MsgsAck тАФ  ,   " ".<br>
)  , -   ,   badmsg тАФ   " "<br>
)  ,       тАФ   , .</li>
<li>   <code>RpcResult</code> тАФ   ( ) тАФ   ,   .</li>
</ol><br>
<p><em></em>,       .       ,       ,  <code>msg_id</code>.      ,  -   ,   .</p><br>
<p>          .  ,    ,   ,         тАФ   ,       ?   (, ).</p><br>
<p>  ?    "   "      "  ,     !" (   ,     ,  rationale    ,   ),  / тАФ     ,    .        ?</p><br>
<blockquote>A server usually acknowledges the receipt of a message from a client (normally, an RPC query) using an RPC response. If a response is a long time coming, a server may first send a receipt acknowledgment, and somewhat later, the RPC response itself.<br>
<br>
A client normally acknowledges the receipt of a message from a server (usually, an RPC response) by adding an acknowledgment to the next RPC query if it is not transmitted too late (if it is generated, say, 60-120 seconds following the receipt of a message from the server). However, if for a long period of time there is no reason to send messages to the server or if there is a large number of unacknowledged messages from the server (say, over 16), the client transmits a stand-alone acknowledgment. </blockquote><p>тАж :    ,    ,   ,     .</p><br>
<p>  :</p><br>
<blockquote><strong>Ping Messages (PING/PONG)</strong><br>
<pre><code class="plaintext">ping#7abe77ec ping_id:long = Pong;</code></pre><br>
<br>
A response is usually returned to the same connection:<br>
<pre><code class="plaintext">pong#347773c5 msg_id:long ping_id:long = Pong;</code></pre><br>
<br>
These messages do not require acknowledgments. A pong is transmitted only in response to a ping while a ping can be initiated by either side.<br>
<br>
<strong>Deferred Connection Closure + PING</strong><br>
<pre><code class="plaintext">ping_delay_disconnect#f3427b8c ping_id:long disconnect_delay:int = Pong;</code></pre><br>
<br>
Works like ping. In addition, after this is received, the server starts a timer which will close the current connection disconnect_delay seconds later unless it receives a new message of the same type which automatically resets all previous timers. If the client sends these pings once every 60 seconds, for example, it may set disconnect_delay equal to 75 seconds. </blockquote><p>    ?!  60     , - ,      .  120 ,  ,    ,     . ,     тАФ " ,     ",      TCP_NODELAY,    . , ,     тАФ 200 <i></i>.               тАФ  , ,  5 ,        "User is typing...".   .</p><br>
<p> , .  ,   TCP-. ,   10            тАФ       ,   .     3 ,   тАФ  , ?..</p><br>
<p>  . TCP-,    ,   .   ,  ,    . ,      SSH-  ,   - ,    ,    тАФ       (  ,   ), . ,     ,    (, !),   , ,    тАФ      .</p><br>
<p>  / IM       ,   тАФ -.   "",      .   ,    Jabber ( 20  ) тАФ  ,     , ,   online (           ). ,  TCP_KEEPALIVE,    ,    TCP,    (     ),    тАФ   ,        ,    ,   ,    (,    ? Telegram Desktop  Ubuntu 18.04    ).</p><br>
<p>    <em></em> ,    тАФ    ,       ,   .</p><br>
<p>      Telegram?   !  .. , ,      .    тАФ    <code>ping_delay_disconnect</code>,     .  ,     ,       . ,    , . , ,    ,     ,   ...</p><br>
<h3 id="anchorteachlifeanchora-kak-nado-bylo-proektirovat"><a name="teachlife"></a>    ?</h3><br>
<p>,            Telegram/    ( )          .</p><br>
<p>     ,    Telegram   ? ,     ,    TCP-, , .     тАФ  . ,    UDP-,       (     тАФ   ).  -  ,      TCP  ,     ,      ( ),       "   " тАФ    .</p><br>
<p>   ?   ,  <code>msg_id</code>   ,        replay-,        . ,      (   Updates,    API      ),   :</p><br>
<ol>
<li>,  TCP-  ,     тАФ    ,  ,    ,  .      id',   "  seq_no" тАФ  ,   TCP (  тАФ  seq  ).      ,   ?</li>
<li>    replay-   , - nonce. ,        .   <code>uint32</code> тАФ         ,   16        ,  тАФ     (  ).</li>
<li> <code>msg_id</code>  тАФ        , -, id , -, id ,   . ,        <code>seq_no</code>.</li>
</ol><br>
<p>    ,        тАФ      API   , .          ,       ,   .</p><br>
<h1 id="anchordatadumperanchorapi-"><a name="DataDumper"></a>API ?</h1><br>
<p>-! ,   ,    ,              ,       (    ,     ,  PUSH,  -  ).</p><br>
<p>,        Perl! ( ,     ,   bless тАФ   ,  тАФ  ):</p><br>
<pre><code class="perl">2019.10.24 12:00:51 $1 = {
  'cb' =&gt; 'TeleUpd::__ANON__',
  'out' =&gt; bless( {
    'filter' =&gt; bless( {}, 'Telegram::ChannelMessagesFilterEmpty' ),
    'channel' =&gt; bless( {
      'access_hash' =&gt; '-6698103710539760874',
      'channel_id' =&gt; '1380524958'
    }, 'Telegram::InputPeerChannel' ),
    'pts' =&gt; '158503',
    'flags' =&gt; 0,
    'limit' =&gt; 0
  }, 'Telegram::Updates::GetChannelDifference' ),
  'req_id' =&gt; '6751291954012037292'
};

2019.10.24 12:00:51 $1 = {
  'in' =&gt; bless( {
    'req_msg_id' =&gt; '6751291954012037292',
    'result' =&gt; bless( {
      'pts' =&gt; 158508,
      'flags' =&gt; 3,
      'final' =&gt; 1,
      'new_messages' =&gt; [],
      'users' =&gt; [],
      'chats' =&gt; [
        bless( {
          'title' =&gt; '',
          'username' =&gt; 'hoolinomics',
          'flags' =&gt; 8288,
          'id' =&gt; 1380524958,
          'access_hash' =&gt; '-6698103710539760874',
          'broadcast' =&gt; 1,
          'version' =&gt; 0,
          'photo' =&gt; bless( {
            'photo_small' =&gt; bless( {
              'volume_id' =&gt; 246933270,
              'file_reference' =&gt; '
              'secret' =&gt; '1854156056801727328',
              'local_id' =&gt; 228648,
              'dc_id' =&gt; 2
            }, 'Telegram::FileLocation' ),
            'photo_big' =&gt; bless( {
              'dc_id' =&gt; 2,
              'local_id' =&gt; 228650,
              'file_reference' =&gt; '
              'secret' =&gt; '1275570353387113110',
              'volume_id' =&gt; 246933270
            }, 'Telegram::FileLocation' )
          }, 'Telegram::ChatPhoto' ),
          'date' =&gt; 1531221081
        }, 'Telegram::Channel' )
      ],
      'timeout' =&gt; 300,
      'other_updates' =&gt; [
        bless( {
          'pts_count' =&gt; 0,
          'message' =&gt; bless( {
            'post' =&gt; 1,
            'id' =&gt; 852,
            'flags' =&gt; 50368,
            'views' =&gt; 8013,
            'entities' =&gt; [
              bless( {
                'length' =&gt; 20,
                'offset' =&gt; 0
              }, 'Telegram::MessageEntityBold' ),
              bless( {
                'length' =&gt; 18,
                'offset' =&gt; 480,
                'url' =&gt; 'https://alexeymarkov.livejournal.com/[url_].html'
              }, 'Telegram::MessageEntityTextUrl' )
            ],
            'reply_markup' =&gt; bless( {
              'rows' =&gt; [
                bless( {
                  'buttons' =&gt; [
                    bless( {
                      'text' =&gt; '???? 165',
                      'data' =&gt; 'send_reaction_0'
                    }, 'Telegram::KeyboardButtonCallback' ),
                    bless( {
                      'data' =&gt; 'send_reaction_1',
                      'text' =&gt; '???? 9'
                    }, 'Telegram::KeyboardButtonCallback' )
                  ]
                }, 'Telegram::KeyboardButtonRow' )
              ]
            }, 'Telegram::ReplyInlineMarkup' ),
            'message' =&gt; '    ! 
// [         ]
 .',
            'to_id' =&gt; bless( {
              'channel_id' =&gt; 1380524958
            }, 'Telegram::PeerChannel' ),
            'date' =&gt; 1571724559,
            'edit_date' =&gt; 1571907562
          }, 'Telegram::Message' ),
          'pts' =&gt; 158508
        }, 'Telegram::UpdateEditChannelMessage' ),
        bless( {
          'pts' =&gt; 158508,
          'message' =&gt; bless( {
            'edit_date' =&gt; 1571907589,
            'to_id' =&gt; bless( {
              'channel_id' =&gt; 1380524958
            }, 'Telegram::PeerChannel' ),
            'date' =&gt; 1571807301,
            'message' =&gt; '   Facebook  ?  ? -,   .  ,   ,     ,      .

    :   Facebook     . ,      ,     .      . -       .  ,             ,     -      .    .

,     :     Whatsapp,  Instagram.     ,    !

    .     . - -   ,    .

# #facebook # #',
            'reply_markup' =&gt; bless( {
              'rows' =&gt; [
                bless( {
                  'buttons' =&gt; [
                    bless( {
                      'data' =&gt; 'send_reaction_0',
                      'text' =&gt; '???? 452'
                    }, 'Telegram::KeyboardButtonCallback' ),
                    bless( {
                      'text' =&gt; '???? 21',
                      'data' =&gt; 'send_reaction_1'
                    }, 'Telegram::KeyboardButtonCallback' )
                  ]
                }, 'Telegram::KeyboardButtonRow' )
              ]
            }, 'Telegram::ReplyInlineMarkup' ),
            'entities' =&gt; [
              bless( {
                'length' =&gt; 199,
                'offset' =&gt; 0
              }, 'Telegram::MessageEntityBold' ),
              bless( {
                'length' =&gt; 8,
                'offset' =&gt; 919
              }, 'Telegram::MessageEntityHashtag' ),
              bless( {
                'offset' =&gt; 928,
                'length' =&gt; 9
              }, 'Telegram::MessageEntityHashtag' ),
              bless( {
                'length' =&gt; 6,
                'offset' =&gt; 938
              }, 'Telegram::MessageEntityHashtag' ),
              bless( {
                'length' =&gt; 11,
                'offset' =&gt; 945
              }, 'Telegram::MessageEntityHashtag' )
            ],
            'views' =&gt; 6964,
            'flags' =&gt; 50368,
            'id' =&gt; 854,
            'post' =&gt; 1
          }, 'Telegram::Message' ),
          'pts_count' =&gt; 0
        }, 'Telegram::UpdateEditChannelMessage' ),
        bless( {
          'message' =&gt; bless( {
            'reply_markup' =&gt; bless( {
              'rows' =&gt; [
                bless( {
                  'buttons' =&gt; [
                    bless( {
                      'data' =&gt; 'send_reaction_0',
                      'text' =&gt; '???? 213'
                    }, 'Telegram::KeyboardButtonCallback' ),
                    bless( {
                      'data' =&gt; 'send_reaction_1',
                      'text' =&gt; '???? 8'
                    }, 'Telegram::KeyboardButtonCallback' )
                  ]
                }, 'Telegram::KeyboardButtonRow' )
              ]
            }, 'Telegram::ReplyInlineMarkup' ),
            'views' =&gt; 2940,
            'entities' =&gt; [
              bless( {
                'length' =&gt; 609,
                'offset' =&gt; 348
              }, 'Telegram::MessageEntityItalic' )
            ],
            'flags' =&gt; 50368,
            'post' =&gt; 1,
            'id' =&gt; 857,
            'edit_date' =&gt; 1571907636,
            'date' =&gt; 1571902479,
            'to_id' =&gt; bless( {
              'channel_id' =&gt; 1380524958
            }, 'Telegram::PeerChannel' ),
            'message' =&gt; '  1   .  10 (, 1-)  :
// [         ]

  ,    1 ,  ... , .'
          }, 'Telegram::Message' ),
          'pts_count' =&gt; 0,
          'pts' =&gt; 158508
        }, 'Telegram::UpdateEditChannelMessage' ),
        bless( {
          'pts' =&gt; 158508,
          'pts_count' =&gt; 0,
          'message' =&gt; bless( {
            'message' =&gt; ', , ,    1?

// [         ]
# #it #',
            'edit_date' =&gt; 1571907650,
            'date' =&gt; 1571893707,
            'to_id' =&gt; bless( {
              'channel_id' =&gt; 1380524958
            }, 'Telegram::PeerChannel' ),
            'flags' =&gt; 50368,
            'post' =&gt; 1,
            'id' =&gt; 856,
            'reply_markup' =&gt; bless( {
              'rows' =&gt; [
                bless( {
                  'buttons' =&gt; [
                    bless( {
                      'data' =&gt; 'send_reaction_0',
                      'text' =&gt; '???? 360'
                    }, 'Telegram::KeyboardButtonCallback' ),
                    bless( {
                      'data' =&gt; 'send_reaction_1',
                      'text' =&gt; '???? 32'
                    }, 'Telegram::KeyboardButtonCallback' )
                  ]
                }, 'Telegram::KeyboardButtonRow' )
              ]
            }, 'Telegram::ReplyInlineMarkup' ),
            'views' =&gt; 4416,
            'entities' =&gt; [
              bless( {
                'offset' =&gt; 0,
                'length' =&gt; 64
              }, 'Telegram::MessageEntityBold' ),
              bless( {
                'offset' =&gt; 1551,
                'length' =&gt; 5
              }, 'Telegram::MessageEntityHashtag' ),
              bless( {
                'length' =&gt; 3,
                'offset' =&gt; 1557
              }, 'Telegram::MessageEntityHashtag' ),
              bless( {
                'offset' =&gt; 1561,
                'length' =&gt; 10
              }, 'Telegram::MessageEntityHashtag' )
            ]
          }, 'Telegram::Message' )
        }, 'Telegram::UpdateEditChannelMessage' )
      ]
    }, 'Telegram::Updates::ChannelDifference' )
  }, 'MTProto::RpcResult' )
};

2019.10.24 12:00:51 $1 = {
  'in' =&gt; bless( {
    'update' =&gt; bless( {
      'user_id' =&gt; 2507460,
      'status' =&gt; bless( {
        'was_online' =&gt; 1571907651
      }, 'Telegram::UserStatusOffline' )
    }, 'Telegram::UpdateUserStatus' ),
    'date' =&gt; 1571907650
  }, 'Telegram::UpdateShort' )
};

2019.10.24 12:05:46 $1 = {
  'in' =&gt; bless( {
    'chats' =&gt; [],
    'date' =&gt; 1571907946,
    'seq' =&gt; 0,
    'updates' =&gt; [
      bless( {
        'max_id' =&gt; 141719,
        'channel_id' =&gt; 1295963795
      }, 'Telegram::UpdateReadChannelInbox' )
    ],
    'users' =&gt; []
  }, 'Telegram::Updates' )
};

2019.10.24 13:01:23 $1 = {
  'in' =&gt; bless( {
    'server_salt' =&gt; '4914425622822907323',
    'unique_id' =&gt; '5297282355827493819',
    'first_msg_id' =&gt; '6751307555044380692'
  }, 'MTProto::NewSessionCreated' )
};

2019.10.24 13:24:21 $1 = {
  'in' =&gt; bless( {
    'chats' =&gt; [
      bless( {
        'username' =&gt; 'freebsd_ru',
        'version' =&gt; 0,
        'flags' =&gt; 5440,
        'title' =&gt; 'freebsd_ru',
        'min' =&gt; 1,
        'photo' =&gt; bless( {
          'photo_small' =&gt; bless( {
            'local_id' =&gt; 328733,
            'volume_id' =&gt; 235140688,
            'dc_id' =&gt; 2,
            'file_reference' =&gt; '
            'secret' =&gt; '4426006807282303416'
          }, 'Telegram::FileLocation' ),
          'photo_big' =&gt; bless( {
            'dc_id' =&gt; 2,
            'file_reference' =&gt; '
            'volume_id' =&gt; 235140688,
            'local_id' =&gt; 328735,
            'secret' =&gt; '71251192991540083'
          }, 'Telegram::FileLocation' )
        }, 'Telegram::ChatPhoto' ),
        'date' =&gt; 1461248502,
        'id' =&gt; 1038300508,
        'democracy' =&gt; 1,
        'megagroup' =&gt; 1
      }, 'Telegram::Channel' )
    ],
    'users' =&gt; [
      bless( {
        'last_name' =&gt; 'Panov',
        'flags' =&gt; 1048646,
        'min' =&gt; 1,
        'id' =&gt; 82234609,
        'status' =&gt; bless( {}, 'Telegram::UserStatusRecently' ),
        'first_name' =&gt; 'Dima'
      }, 'Telegram::User' )
    ],
    'seq' =&gt; 0,
    'date' =&gt; 1571912647,
    'updates' =&gt; [
      bless( {
        'pts' =&gt; 137596,
        'message' =&gt; bless( {
          'flags' =&gt; 256,
          'message' =&gt; '     ??',
          'to_id' =&gt; bless( {
            'channel_id' =&gt; 1038300508
          }, 'Telegram::PeerChannel' ),
          'id' =&gt; 119634,
          'date' =&gt; 1571912647,
          'from_id' =&gt; 82234609
        }, 'Telegram::Message' ),
        'pts_count' =&gt; 1
      }, 'Telegram::UpdateNewChannelMessage' )
    ]
  }, 'Telegram::Updates' )
};</code></pre><br>
<p>,     тАФ    ,    !</p><br>
<p>Oh, wai~~тАж     ? -  тАж ,     Web API  JSON,        ?..</p><br>
<p>   тАж    , ?..   тАФ     ,  Web- <strong> </strong>?..   JSON  HTTPS    ?!       ?     ?</p><br>
<p> ,    TL+MTProto,    . , HTTP,    "-",  ,    -  TLS ?</p><br>
<p><strong> .</strong>     ,   JSON, ,     .  MsgPack   ,   , , CBOR тАФ  , ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">RFC 7049</a>.   ,     <em></em>,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> :</p><br>
<ul>
<li>25 + 256 тАФ        ,    </li>
<li>26 тАФ   Perl c     </li>
<li>27 тАФ         </li>
</ul><br>
<p>  ,          TL   CBOR      .      CBOR -  :</p><br>
<pre><code class="plaintext">cborlen=1039673 tl_len=1095092</code></pre><br>
<p>, <strong></strong>:     ,        ,   .</p><br>
<p><strong>  </strong>.     RTT   (     ) тАФ      MTProto,     тАФ     ,   , etc.     TLS?   :</p><br>
<blockquote>  PFS  TLS   TLS session tickets (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">RFC 5077</a>)               .       ,         (  session ticket). ,      session ticket,      ,  .  ticket    (session ticket key),          frontend-,  SSL   .[10].  ,  session ticket   PFS      , ,     (OpenSSL, nginx, Apache          ;        ,   ). </blockquote><p> RTT  ,     ClientHello  ServerHello,     Finished     .    ,     Web,      ,  ,       - ,     Web- тАФ   .  ,  ,         .</p><br>
<p><strong>-  ?</strong>   .</p><br>
<h1 id="anchorbroiler747anchor-to-be-continued"><a name="broiler747"></a> To be continued!</h1><br>
<p>          ,    тАФ , , ,     .. , ,    ,    .</p><br>
<p>        /  .  ,  :</p><br>
<ul>
<li>    TL-</li>
<li>     </li>
<li> dialogs  roster</li>
<li>  vs   </li>
<li>  photo  image</li>
<li>     </li>
</ul><br>
<p>  ! Stay tuned!</p></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi472970/">https://habr.com/ru/post/hi472970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi472958/index.html">Arduino рдореЗрдВ рд╡рд┐рдВрдбреЛрдЬ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреИрд╕реЗ рдмрдирд╛рдПрдВ</a></li>
<li><a href="../hi472960/index.html">рд╕реЛрдиреА рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдореВрд▓реНрдп / рдЧреБрдгрд╡рддреНрддрд╛ рд▓реЗрдВрд╕</a></li>
<li><a href="../hi472962/index.html">рд╡реАрдбрд┐рдпреЛ рдкреЛрд╕реНрдЯ: рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рджреГрд╢реНрдп рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдпреЛрдЧ</a></li>
<li><a href="../hi472964/index.html">рд╕реНрдерд┐рддрд┐: рдЕрдзрд┐рдХ рд╕реЗ рдЕрдзрд┐рдХ рдУрдкрди рд╕реЛрд░реНрд╕ рдХрдВрдкрдирд┐рдпрд╛рдВ рд▓рд╛рдЗрд╕реЗрдВрд╕ рдмрджрд▓ рд░рд╣реА рд╣реИрдВ - рд╣рдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд░рд╛рдп рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi472966/index.html">рдЬрд╝рд┐рдк рдЖрд░реНрдХрд╛рдЗрд╡ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ рдФрд░ рд╣рдо рдЗрд╕рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рднрд╛рдЧ 2 - рдбреЗрдЯрд╛ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ рдФрд░ рд╕рдВрдкреАрдбрд╝рди</a></li>
<li><a href="../hi472972/index.html">рд╣рдо рдПрдХ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреНрд▓рд╛рд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдХреБрдХреАрдЬрд╝ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi472978/index.html">Arduino рдЕрдкрдиреЗ рдмреЗрдЯреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд▓реЗрдЦрди рдкрд╛рдареНрдпрдХреНрд░рдо</a></li>
<li><a href="../hi472980/index.html">рд╢реЙрд░реНрдЯреНрд╕ рдмреЗрд▓реЛрдХреБрдореЗрдВрдЯрд╕реЗрд╡рд╛</a></li>
<li><a href="../hi472982/index.html">"рдмреНрд░реЗрдХрдбрд╛рдЙрди рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрдиреЛ": рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрджреНрдпреЛрдЧрд┐рдХ рдорд╢реАрдиреЛрдВ рдХреА рдСрдбрд┐рдпреЛ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдкреНрд░рдХрд╛рд╢рд┐рдд рд╣реБрдИ</a></li>
<li><a href="../hi472984/index.html">рдЖрд░рдУрдПрд╕ рдЯреНрд░рдХ рдЯреНрд░реЙрд▓реАред рднрд╛рдЧ 7. рд░реЛрдмреЛрдЯ рдХрд╛ рд╕реНрдерд╛рдиреАрдпрдХрд░рдг: рдХрдорд░реЗ рдХреЗ рдирдХреНрд╢реЗ рдкрд░ рдЧрдордкрд┐рдВрдЧ, рдПрдПрдорд╕реАрдПрд▓, рд╕рдВрджрд░реНрдн рдмрд┐рдВрджреБ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>