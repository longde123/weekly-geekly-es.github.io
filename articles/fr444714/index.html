<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐥 🔸 🍫 Comment nous avons overclocké CAD COMPASS-3D → Partie 1 👰🏾 🍂 🙇🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="20 ans se sont écoulés depuis la sortie de la première version 3D de KOMPAS - V5.11. Pendant ce temps, nous avons réalisé que les besoins de nos utili...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons overclocké CAD COMPASS-3D → Partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ascon/blog/444714/">  20 ans se sont écoulés depuis la sortie de la première version 3D de KOMPAS - V5.11.  Pendant ce temps, nous avons réalisé que les besoins de nos utilisateurs croissaient proportionnellement aux capacités de KOMPAS-3D, tout comme la fonctionnalité de KOMPAS augmentait proportionnellement aux besoins des utilisateurs.  Un seul hic: construire la partie technologique pendant de nombreuses années, nous avons rencontré le problème de performance lors de la réalisation de grands projets complexes.  Maintenant, cette ligne a été dépassée et nous sommes prêts à dire comment nous avons réussi à accélérer KOMPAS-3D dans plus de 30 opérations de base. <br><img src="https://habrastorage.org/webt/vo/kj/vq/vokjvqv4wbizt33m1gmmw4h1g0y.png"><br><a name="habracut"></a><br><br><h1>  <font color="#00B2FF">La patience ne peut pas être accélérée</font> </h1><br><h3>  <font color="#00B2FF">Comment avons-nous compris qu'il était temps «d'accélérer»?</font> </h3><br>  S'il y a 12 ans, il y avait suffisamment de travail avec des assemblages pouvant aller jusqu'à plusieurs milliers de composants, les utilisateurs de KOMPAS veulent maintenant réaliser des projets complexes impliquant 300 000 composants dans un assemblage, et quelques millions seront peu. <br><br> <a href=""><img src="https://habrastorage.org/webt/kd/01/8g/kd018gvvqgxbn175g33_au4cz0c.png"></a> <br><br>  <i>L'évolution des projets utilisateurs KOMPAS-3D: à gauche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les équipements de fraisage et de rotor de déneigement des tracteurs K-700A, K-703MBA</a> , à droite l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">installation Steam-Gas PGU-410 MW</a> .</i>  <i>Si c'est difficile à voir, cliquez sur l'image.</i> <br><br>  Dans ServiceDesk - support technique - nous avons reçu des demandes dans le style "Je ne peux pas ouvrir mon usine le matin" et "le modèle a ouvert, mais il ne tourne pas". <br><br>  Il n'y a qu'une seule conclusion - COMPAS a nécessité une révision sérieuse. <br><br><h3>  <font color="#00B2FF">Premiers changements</font> </h3><br>  La tâche principale consiste à augmenter les performances du système lorsque vous travaillez avec de grands assemblages.  Et d'augmenter non pas de 10-30% conditionnel, mais plusieurs fois. <br><br>  Pour résoudre ces problèmes, nous avons formé en 2015 un groupe de travail pour accélérer KOMPAS-3D.  Une sorte d'escouade de réponse rapide de programmeurs, testeurs et analystes. <br><img src="https://habrastorage.org/webt/cf/uo/a0/cfuoa0ywcyqlfvqtcbazgzsxovs.png"><br>  <i>Notre équipe de vitesse</i> <br><br><blockquote>  AIDE: nous avons travaillé sur l'accélération auparavant - ce sont à la fois des optimisations et de nouvelles fonctions qui nous permettent de résoudre certains des problèmes lors du travail avec de grands assemblages.  Cependant, les tâches n'étaient pas aussi ambitieuses qu'elles le sont actuellement et le travail n'était pas si volumineux. </blockquote><br><br><h3>  <font color="#00B2FF">Comment avez-vous choisi les critères d'accélération?</font> </h3><br>  Nous avons choisi 5 directions d'accélération: <br><br><ul><li> rendu (rotation, mouvement et zoom de l'image du modèle), </li><li>  ajout de composants à un grand assemblage </li><li>  ouverture de l'assemblage </li><li>  édition dans les assemblages, </li><li>  projection. </li></ul><br>  Lors du choix de ces domaines, nous nous sommes appuyés sur plusieurs sources: <br><br><ul><li>  propre expérience et recherche, </li><li>  analyse des demandes d'assistance technique et analyse de la base d'erreurs (dans nos outils il y a un label spécial «performance», où sont notés les problèmes critiques de performance), </li><li>  les résultats du sondage auprès des utilisateurs (les utilisateurs remplissent généralement ces questionnaires lors des événements ASCON), </li><li>  <s>des pouvoirs supérieurs</s> . </li></ul><br><img src="https://habrastorage.org/webt/qp/lv/lu/qplvlufe8cxowb-ojxonbtegsey.png"><br>  <i>Ici, nous discutons de quelque chose.</i> <br><br>  Parallèlement à la formation du groupe de travail, nous avons créé notre propre espace d'information - une base de connaissances - nous y avons noté toutes les tâches, collecté et systématisé des idées dans les domaines d'accélération possibles.  En conséquence, des exigences ont commencé à se former avec des scénarios de travaux futurs, grâce auxquels il était possible de contrôler les performances. <br><br>  Un autre axiome que nous avons adopté en travaillant sur la version: la productivité ne peut pas être simplement prise et améliorée, puis oublié.  Il était nécessaire de mesurer et d'enregistrer l'état actuel, à partir duquel nous pouvions ensuite repousser.  À cette époque, le point de départ était la version V16 (notre histoire est toujours en 2015), qui devait être contrôlée par des scripts de nos savoirs traditionnels.  La performance de plusieurs points clés a été contrôlée manuellement, mais maintenant ce processus est automatisé grâce au POI. <br><blockquote> <a href=""><img align="right" src="https://habrastorage.org/webt/br/cu/ku/brcukuey6fmjicbcsx2tibjhjhw.png"></a>  <b>Anton Sidyakin, programmeur, chef d'équipe:</b> <br><br>  «Nous avons automatisé les processus grâce au système introduit - POI (Points of Interest).  Ce sont des balises spéciales situées dans le code source.  Selon eux, en exécutant des scripts dans KOMPAS-3D décrits par le langage utilisateur, vous pouvez obtenir un rapport compréhensible non seulement pour le programmeur, mais aussi pour les analystes avec des testeurs et aide à découvrir ce que KOMPAS-3D fait à un certain moment et combien de temps y est consacré.  Ces informations peuvent ensuite être traitées automatiquement et comparées aux données source. " <br><br><img src="https://habrastorage.org/webt/6e/_4/l2/6e_4l2uqd4wv-3wq9dmwxbfathc.png"><br>  <i>Résultats des tests de performances automatiques.</i>  <i>Au fait, qui a lu à cet endroit sait maintenant que la dalle KDPV est un symbole de notre équipe d'accélérateurs.</i>  <i>Ils considèrent le code lent comme du code lent)</i> <br></blockquote><br><br><h3>  <font color="#00B2FF">Quels modèles ont été utilisés pour la comparaison?</font> </h3><br>  Nous avons décidé de nous concentrer sur de véritables modèles utilisateurs répondant aux critères des «grands ensembles». <br><br>  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">base de données des modèles du</a> concours Aces de modélisation 3D par ordinateur a été très utile. <br><br>  Voici des captures d'écran de nos modèles préférés.  Bien sûr, ce n'est pas tout, et, en outre, nous sommes convaincus que les meilleurs modèles de ces dernières années deviendront bientôt familiers et que KOMPAS travaillera avec eux non pas à la limite, mais dans son mode régulier à haute vitesse. <br><br><table><tbody><tr><td><img src="https://habrastorage.org/webt/lt/rb/p_/ltrbp_x2dl3qdcxvolkbxsxzktk.png"></td><td><img src="https://habrastorage.org/webt/hi/uj/t0/hiujt0vtlahhdjk--bcjxahpmdq.png"></td></tr><tr><td>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Trolleybus</a></i> </td><td>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Unité vapeur-gaz CCP-410 MW</a></i> </td></tr><tr><td><img src="https://habrastorage.org/webt/wq/9v/y0/wq9vy0m2mbdmgzvq-kxxe63nmgg.png"></td><td><img src="https://habrastorage.org/webt/6b/bk/ss/6bbkssvpds7qutrfr9efhk3xwim.png"></td></tr><tr><td>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Boîte de vitesse de centrale marine</a></i> </td><td>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Installation technologique sous vide</a></i> </td></tr></tbody></table><br><br>  Lorsqu'il était nécessaire de charger le système encore plus, en plus de ces modèles, un «méli-mélo préfabriqué» particulier était également utilisé, par exemple: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/-hLuI_wTxBw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Nous avons également utilisé des modèles synthétiques: dans certains cas, certains problèmes sont plus prononcés sur eux et ils sont plus pratiques à utiliser pour le débogage et les tests. <br><br><h2>  <font color="#00B2FF">À propos du développement et des résultats obtenus</font> </h2><br><h3>  <font color="#00B2FF">Dessin</font> </h3><br>  Tout d'abord, ils ont essayé d'accélérer le rendu (ce qui a également été demandé par la majorité des utilisateurs qui ont participé à l'enquête). <br><br>  La vitesse de rendu est critique dans tous les processus où le modèle est positionné ou son affichage change.  Et ce n'est pas seulement la rotation, le mouvement ou le zoom du modèle.  La vitesse de rendu est également importante dans les processus où l'image du modèle est mise à jour: <br><ul><li>  Ajout d'un composant à un assemblage </li><li>  sélection d'objets de base pour les partenaires (faces, arêtes, etc.), </li><li>  mise en évidence des parties sélectionnées du modèle (composants, faces), </li><li>  modifier la visibilité des objets (masquer / afficher le composant). </li></ul><br>  Et ce sont loin de tous les cas où le sous-système de visualisation est utilisé.  Par conséquent, il est clair pourquoi l'accélération du rendu est devenue une priorité pour nous. <br><br>  Dans le même temps, il était important non seulement d'utiliser les capacités des cartes vidéo modernes et productives, mais aussi de ne pas oublier ceux qui utilisent un matériel pas si solide et moderne. <br><br>  Le résultat du travail a été la mise en œuvre de deux options de rendu: <br><ul><li>  De base - Active les extensions Open GL 2.0.  Moins exigeant sur les performances de la carte vidéo.  Donne une bonne accélération de rendu, </li><li>  «Amélioré» - utilise les extensions modernes d'OpenGL 4.5.  Exigeant sur les caractéristiques de la carte vidéo.  Donne une accélération de rendu maximale sur les cartes modernes </li></ul><br><br><div class="spoiler">  <b class="spoiler_title">Indice:</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wg/it/il/wgitil7a81cclzrfczfx6wj-q6i.png"><br>  <i>Paramètres de rendu pour v18.</i> <br><br>  Par défaut, "Détection automatique" fonctionne - l'option souhaitée est sélectionnée en fonction des extensions OpenGL prises en charge. <br></div></div><br><br><blockquote> <a href=""><img align="right" src="https://habrastorage.org/webt/i_/dr/__/i_dr__2m4lqftoi4deevr-k89gs.png"></a>  <b>Yuri Korchagin, programmeur:</b> <br><br>  «Dans le problème des performances d'affichage de grandes scènes, il est clair que beaucoup de ressources sont dépensées pour faire le tour de la scène et calculer les paramètres avec lesquels la primitive doit être affichée. <br><br>  Un autre problème est associé à un grand nombre d'appels de tirage (appels à l'API OpenGL, qui conduisent à la sortie de la géométrie dans le tampon de trame). <br><br>  L'état initial supposait également le transfert de toutes les données vers la carte vidéo à partir de la RAM.  Et ce sont des millions de triangles dans le cas d'un grand assemblage. <br><br>  Les corrections cosmétiques ne pouvaient pas être supprimées ici, car une augmentation multiple de la productivité était nécessaire.  Par conséquent, il a été décidé de réécrire en grande partie le module de visualisation. <br><br>  La première étape a été d'utiliser la mémoire vidéo pour mettre en cache les données de dessin (triangulation, filaire, faces).  En déplaçant ces données vers le GPU, nous avons réussi à obtenir une augmentation de 2 à 3 fois du FPS. <br><br>  Cela a été suivi par la création d'un modèle de données adapté à la visualisation.  Autrement dit, nous nous sommes débarrassés des demandes de modèle 3D, qui peuvent être assez gourmandes en ressources, ce qui a également donné son effet positif. <br><br>  L'étape suivante consistait à étudier la qualité et le volume de la triangulation.  Souvent, de petits détails étaient affichés avec une précision excessive, et vice versa - dans certaines situations, au lieu de surfaces lisses, l'utilisateur voyait un modèle «haché» à l'écran. <br><br>  Nous avons décidé d'utiliser plusieurs niveaux de détail et d'appliquer l'approximation des primitives en tenant compte de l'écart angulaire.  De cette façon, deux oiseaux avec une pierre ont été tués: ils ont amélioré la qualité et éliminé la charge excessive sur le GPU. " </blockquote><br><div class="spoiler">  <b class="spoiler_title">Spoiler: A propos de la triangulation</b> <div class="spoiler_text"><blockquote> <a href=""><img align="right" src="https://habrastorage.org/webt/yw/ls/ca/ywlscagmaodmtdctqxlzfau4ega.png"></a> <br>  <b>Spécifié par Nikita Batyanov, un ingénieur analytique:</b> <br><br>  «Pour un affichage des modèles plus correct et généralement agréable, nous avons décidé de compléter les paramètres de triangulation par une déviation angulaire maximale.  Auparavant, nous utilisions uniquement le paramètre d'écart linéaire maximal. <br><br>  Permettez-moi de vous rappeler: pour que la carte vidéo dessine nos représentations théoriques des objets, il faut les décomposer en triangles.  Plus il y a de tels triangles, plus l'image aura l'air «idéale», mais plus la charge sur la carte vidéo sera forte. <br><br>  L'algorithme de triangulation utilisant la déviation angulaire maximale vous permet d'afficher plus précisément certains modèles, sans augmenter le nombre de triangles autant que si seule la déviation linéaire maximale était utilisée. <br><br>  "Nous pouvons dessiner des objets plus petits par rapport aux dimensions de l'ensemble du modèle, tout en surestimant légèrement le nombre de triangles." </blockquote><br></div></div><br><blockquote> <a href=""><img align="right" src="https://habrastorage.org/webt/i_/dr/__/i_dr__2m4lqftoi4deevr-k89gs.png"></a>  <b>Yuri Korchagin, programmeur:</b> <br><br>  «Eh bien, l'affichage du modèle est devenu plus rapide, mais pas autant que nous le souhaiterions.  À ce stade, nous avons réalisé que nous ne pouvions pas tirer le meilleur parti de cette approche. <br><br>  D'autre part, l'utilisation des dernières approches nécessitera les cartes vidéo les plus récentes, ce qui contredit les exigences de compatibilité et certains utilisateurs ne l'apprécieront manifestement pas.  Par conséquent, les améliorations décrites ci-dessus sont devenues disponibles en tant qu'option de rendu «de base». <br><br>  Et puis le plaisir a commencé ... " </blockquote><br><br>  Dans la partie suivante, nous continuons notre histoire sur le rendu, et montrons également les résultats de la mesure de la vitesse de rendu pendant la rotation de l'assemblage, les calculs MTC, l'ajout de composants à l'assemblage et parlons de l'apparence d'un type de charge partielle. <br><br>  Et pour le dessert, ils vous ont laissé une vidéo pour comparer la vitesse de rendu pendant la rotation, la mise à l'échelle et le décalage du réducteur d'une centrale marine. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/gx17am7Q1bg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  <b>La fin de la première partie.</b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">À suivre</a> .</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444714/">https://habr.com/ru/post/fr444714/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444704/index.html">Opportunités nanoCAD SPDS Chantier de construction dans des projets de construction et de reconstruction dans des conditions exiguës</a></li>
<li><a href="../fr444706/index.html">Photos Facebook 3D à l'intérieur: Shaders Parallax</a></li>
<li><a href="../fr444708/index.html">Application PentQL avec GraphQL</a></li>
<li><a href="../fr444710/index.html">Comprendre le protocole de consensus stellaire</a></li>
<li><a href="../fr444712/index.html">«Attitude atypique à l'égard de la finance» - et si les employés géraient eux-mêmes leurs revenus. Conversation avec Flant</a></li>
<li><a href="../fr444716/index.html">Un téléphone Samsung avec un écran pliable pour 2000 $ affiche un pli</a></li>
<li><a href="../fr444718/index.html">Holographie amateur - le début du voyage</a></li>
<li><a href="../fr444720/index.html">Ce que l'auteur a fumé: ajoutez la vieille école à ce monde fou de jeux</a></li>
<li><a href="../fr444724/index.html">Architecture de runet</a></li>
<li><a href="../fr444726/index.html">Lecteur OBD2 - Diagnostic automobile</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>