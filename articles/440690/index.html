<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçü§ù‚Äçüë®üèª üëàüèΩ üïû Caracter√≠sticas de trabajar con Mesh en Unity ‚Ñ¢Ô∏è üë© üßùüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Los gr√°ficos por computadora, como saben, son la base de la industria del juego. En el proceso de creaci√≥n de contenido gr√°fico, inevitablemente encon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Caracter√≠sticas de trabajar con Mesh en Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/plarium/blog/440690/">  Los gr√°ficos por computadora, como saben, son la base de la industria del juego.  En el proceso de creaci√≥n de contenido gr√°fico, inevitablemente encontramos dificultades asociadas con la diferencia en su presentaci√≥n en el entorno de creaci√≥n y en la aplicaci√≥n.  A estas dificultades se agregan los riesgos del simple descuido humano.  Dada la escala del desarrollo del juego, tales problemas surgen con frecuencia o en grandes cantidades. <br><br>  Combatir tales dificultades nos llev√≥ a pensar en la automatizaci√≥n y escribir art√≠culos sobre este tema.  La mayor parte del material se ocupar√° de trabajar con <b>Unity 3D</b> , ya que esta es la principal herramienta de desarrollo en Plarium Krasnodar.  En adelante, los modelos y texturas 3D se considerar√°n como contenido gr√°fico. <br><br>  En este art√≠culo, hablaremos sobre las caracter√≠sticas de acceder a datos que representan objetos 3D en <b>Unity</b> .  El material ser√° √∫til principalmente para principiantes, as√≠ como para aquellos desarrolladores que rara vez interact√∫an con la representaci√≥n interna de dichos modelos. <br><br><img src="https://habrastorage.org/webt/sh/4a/ou/sh4aousvny7jcs3jpcplosm9tbw.jpeg"><a name="habracut"></a><br><br><h3>  Acerca de los modelos 3D en Unity: para los m√°s peque√±os </h3><br><img src="https://habrastorage.org/webt/_f/ir/tm/_firtmofn97mha8zhd0mxrhoigw.png"><br><br>  En el enfoque est√°ndar, <b>Unity</b> utiliza los componentes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MeshFilter</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MeshRenderer</a> para representar el modelo.  MeshFilter se refiere al activo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mesh</a> que representa el modelo.  Para la mayor√≠a de los sombreadores, la informaci√≥n de geometr√≠a es un componente m√≠nimo obligatorio para representar un modelo en la pantalla.  Los datos de escaneo de textura y los huesos de animaci√≥n pueden no estar disponibles si no est√°n involucrados.  La forma en que se implementa esta clase en el interior y c√≥mo se almacena todo es un misterio para la <s>en√©sima cantidad de dinero en</s> siete sellos. <br><br>  En el exterior, la malla como objeto proporciona acceso a los siguientes conjuntos de datos: <br><br><ul><li>  <b>v√©rtices</b> : un conjunto de posiciones de v√©rtices geom√©tricos en un espacio tridimensional con su propio origen; </li><li>  <b>normales, tangentes</b> : conjuntos de vectores normales y tangentes a v√©rtices que se usan com√∫nmente para calcular la iluminaci√≥n; </li><li>  <b>uv, uv2, uv3, uv4, uv5, uv6, uv7, uv8</b> : conjuntos de coordenadas para el escaneo de texturas; </li><li>  <b>colores, colores32</b> : conjuntos de valores de color de v√©rtices, cuyo ejemplo de libro de texto es mezclar textura por m√°scara; </li><li>  <b>bindposes</b> : conjuntos de matrices para colocar v√©rtices en relaci√≥n con los huesos; </li><li>  <b>boneWeights</b> - coeficientes de influencia de los huesos en la parte superior; </li><li>  <b>tri√°ngulos</b> : un conjunto de √≠ndices de v√©rtices procesados ‚Äã‚Äã3 a la vez;  cada uno de estos triples representa un pol√≠gono (en este caso, un tri√°ngulo) del modelo. </li></ul><br>  El acceso a la informaci√≥n sobre v√©rtices y pol√≠gonos se implementa a trav√©s de las propiedades correspondientes, cada una de las cuales devuelve una matriz de estructuras.  Para una persona que <s>no lee la documentaci√≥n</s> rara vez trabaja con mallas en <b>Unity</b> , puede que no sea obvio que cada vez que se accede a los datos de v√©rtice, se crea una copia del conjunto correspondiente en la memoria en forma de una matriz con una longitud igual al n√∫mero de v√©rtices.  Este matiz se considera en un peque√±o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bloque de documentaci√≥n</a> .  Los comentarios sobre las propiedades de la clase <b>Mesh</b> mencionadas anteriormente tambi√©n advierten sobre esto.  La raz√≥n de este comportamiento es la caracter√≠stica arquitect√≥nica de <b>Unity</b> en el contexto del tiempo de ejecuci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mono</a> .  Esquem√°ticamente, esto se puede representar de la siguiente manera: <br><br><img src="https://habrastorage.org/webt/wn/xp/0y/wnxp0y08-wuonzrdzmf6defkzac.jpeg"><br><br>  El n√∫cleo del motor (UnityEngine (nativo)) est√° aislado de los scripts del desarrollador, y el acceso a su funcionalidad se implementa a trav√©s de la biblioteca UnityEngine (C #).  De hecho, es un adaptador, ya que la mayor√≠a de los m√©todos sirven como una capa para recibir datos del n√∫cleo.  En este caso, el n√∫cleo y el resto, incluidos sus scripts, giran bajo diferentes procesos y la parte del script solo conoce la lista de comandos.  Por lo tanto, no hay acceso directo a la memoria utilizada por el n√∫cleo desde el script. <br><br><h3>  Sobre el acceso a datos internos, o qu√© tan malas pueden ser las cosas </h3><br>  Para demostrar cu√°n malas pueden ser las cosas, analicemos la cantidad de memoria borrada por Garbage Collector utilizando un ejemplo de la documentaci√≥n.  Para simplificar la creaci√≥n de perfiles, envuelva el mismo c√≥digo en el m√©todo Actualizar. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MemoryTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Mesh Mesh; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; Mesh.vertexCount; i++) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = Mesh.vertices[i].x; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = Mesh.vertices[i].y; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> z = Mesh.vertices[i].z; DoSomething(x, y, z); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//nothing to do } }</span></span></code> </pre> <br>  Ejecutamos este script con una primitiva est√°ndar: una esfera (515 v√©rtices).  Usando la herramienta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Profiler</a> , en la pesta√±a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Memoria</a> , puede ver cu√°nta memoria se ha marcado para la recolecci√≥n de basura en cada marco.  En nuestra m√°quina de trabajo, este valor era ~ 9.2 Mb. <br><br><img src="https://habrastorage.org/webt/fy/v0/zl/fyv0zl3ooi-u6vn5nmvyskzbrrg.png"><br><br>  Esto es bastante incluso para una aplicaci√≥n cargada, y aqu√≠ lanzamos una escena con un objeto en el que se monta el script m√°s simple. <br><br>  Es importante mencionar las caracter√≠sticas del compilador <b>.Net</b> y la optimizaci√≥n del c√≥digo.  Al recorrer la cadena de llamadas, encontrar√° que llamar a <b>Mesh.vertices</b> implica llamar al m√©todo <b>externo</b> del motor.  Esto evita que el compilador optimice el c√≥digo dentro de nuestro m√©todo <b>Update ()</b> , a pesar de que <b>DoSomething () est√°</b> vac√≠o y las variables <b>x, y, z</b> no se utilizan por este motivo. <br><br>  Ahora almacenamos en cach√© la matriz de posiciones al comienzo. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MemoryTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Mesh Mesh; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3[] _vertices; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _vertices = Mesh.vertices; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; _vertices.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = _vertices[i].x; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = _vertices[i].y; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> z = _vertices[i].z; DoSomething(x, y, z); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//nothing to do } }</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/sf/fr/fd/sffrfdqcfcx_3ybl9eg94rd1vhm.png"><br><br>  En promedio 6 Kb.  Otra cosa! <br><br>  Esta caracter√≠stica se convirti√≥ en una de las razones por las que tuvimos que implementar nuestra propia estructura para almacenar y procesar datos de malla. <br><br><h3>  Como lo hacemos </h3><br>  Durante el trabajo en grandes proyectos, surgi√≥ la idea de crear una herramienta para el an√°lisis y la edici√≥n de contenido gr√°fico importado.  Discutiremos los m√©todos de an√°lisis y transformaci√≥n en los siguientes art√≠culos.  Ahora veamos la estructura de datos que decidimos escribir para la conveniencia de implementar algoritmos, teniendo en cuenta las caracter√≠sticas de acceso a la informaci√≥n sobre la malla. <br><br>  Inicialmente, esta estructura se ve√≠a as√≠: <br><br><img src="https://habrastorage.org/webt/ep/2f/jx/ep2fjx87onpgda5ogkqgkg-u_ri.jpeg"><br><br>  Aqu√≠, la clase <b>CustomMesh</b> representa la malla en s√≠.  Por separado, en forma de <b>utilidad,</b> implementamos la conversi√≥n de <b>UntiyEngine.Mesh</b> y viceversa.  Una malla se define por su conjunto de tri√°ngulos.  Cada tri√°ngulo contiene exactamente tres aristas, que a su vez est√°n definidas por dos v√©rtices.  Decidimos agregar a los v√©rtices solo la informaci√≥n que necesitamos para el an√°lisis, a saber: posici√≥n, normal, dos canales de exploraci√≥n de textura ( <b>uv0</b> para la textura principal, <b>uv2</b> para iluminaci√≥n) y color. <br><br>  Despu√©s de un tiempo, surgi√≥ la necesidad de ascender en la jerarqu√≠a.  Por ejemplo, para descubrir desde un tri√°ngulo a qu√© malla pertenece.  Adem√°s, la <b>degradaci√≥n</b> de <b>CustomMesh</b> a <b>Vertex</b> parec√≠a pretenciosa, y la cantidad irrazonable y significativa de valores duplicados me puso nerviosa.  Por estas razones, la estructura tuvo que ser redise√±ada. <br><br><img src="https://habrastorage.org/webt/m5/8_/0p/m58_0pneh5z97etazjao0yofeli.jpeg"><br><br>  <b>CustomMeshPool</b> implementa m√©todos para una administraci√≥n conveniente y acceso a todos los <b>CustomMesh</b> procesados.  Debido al campo <b>MeshId</b> , cada entidad tiene acceso a la informaci√≥n de toda la malla.  Esta estructura de datos cumple los requisitos para las tareas iniciales.  Es f√°cil de expandir agregando el conjunto de datos apropiado a <b>CustomMesh</b> y los m√©todos necesarios a <b>Vertex</b> . <br><br>  Vale la pena se√±alar que este enfoque no es √≥ptimo en rendimiento.  Al mismo tiempo, la mayor√≠a de los algoritmos que hemos implementado se centran en analizar el contenido en el editor de <b>Unity</b> , por lo que no es necesario pensar a menudo en la cantidad de memoria utilizada.  Por esta raz√≥n, literalmente almacenamos en cach√© todo lo que es posible.  Primero probamos el algoritmo implementado, y luego refactorizamos sus m√©todos y, en algunos casos, simplificamos las estructuras de datos para optimizar el tiempo de ejecuci√≥n. <br><br>  Eso es todo por ahora.  En el pr√≥ximo art√≠culo, hablaremos sobre c√≥mo editar modelos 3D ya agregados al proyecto, y utilizaremos la estructura de datos considerada. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440690/">https://habr.com/ru/post/440690/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440676/index.html">El d√≠a que Dodo se detuvo. Script sincr√≥nico</a></li>
<li><a href="../440678/index.html">DIY hobby enrutador CNC. Humanidades para las humanidades. Parte 2</a></li>
<li><a href="../440680/index.html">C√≥mo mirar ma√±ana igrofikuyuchi</a></li>
<li><a href="../440682/index.html">- Y haces gas all√≠ en la industria petroqu√≠mica, ¬øverdad?</a></li>
<li><a href="../440688/index.html">Relaciones p√∫blicas en TI: ¬øc√≥mo vivir, a d√≥nde ir?</a></li>
<li><a href="../440692/index.html">¬øQu√© hay de malo con las pruebas A / B?</a></li>
<li><a href="../440694/index.html">Crea una escena b√°sica en A-Frame</a></li>
<li><a href="../440696/index.html">Kit de herramientas de refactorizaci√≥n de bases de datos: Flyway vs. Liquibase</a></li>
<li><a href="../440700/index.html">Ciencia de datos "fuerzas especiales" internamente</a></li>
<li><a href="../440702/index.html">Precauci√≥n: ¬°GAS! o c√≥mo hicimos contratos inteligentes sin gas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>