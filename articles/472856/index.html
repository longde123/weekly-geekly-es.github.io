<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游뚶 游뚸 游뱛游낗 C칩mo cre칠 un servicio de control de calidad a partir de tablas y palos 游 游뱍 游깱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! A menudo, cuando piensan en lanzar un piloto, los gerentes comienzan a complicar la situaci칩n, a construir hojas de ruta y a esperar el MVP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C칩mo cre칠 un servicio de control de calidad a partir de tablas y palos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/472856/">  Hola Habr!  A menudo, cuando piensan en lanzar un piloto, los gerentes comienzan a complicar la situaci칩n, a construir hojas de ruta y a esperar el MVP de los desarrolladores, en lugar de tomar y probar la idea por su cuenta.  Debajo del corte, quiero compartir la historia de la creaci칩n de un servicio de control de calidad basado en formularios de Google, VK y docenas de l칤neas de c칩digo, en el que ning칰n desarrollador result칩 afectado, solo 1 vendedor. <br><br><img src="https://habrastorage.org/webt/z0/h1/0h/z0h10hxua4cagzjcovtbf5t8oja.png"><br><a name="habracut"></a><br><blockquote>  <b>Descargo de responsabilidad</b> : en este art칤culo estoy esperando ejemplos de c칩digo que le har치n preguntas, dudas, tal vez incluso l치grimas sangrientas y ceguera.  Para justificarlo, solo hay una cosa que decir: este c칩digo funcion칩 como Papa Carlo, y cumpli칩 su misi칩n al 100%, y algunos scripts a칰n funcionan. </blockquote><h2>  Primera calificaci칩n de Dodo Pizzeria </h2><br>  Uno de los principios fundamentales de nuestra empresa: lo <b>que no se puede medir, no existe</b> .  La pizza existe, lo que significa que necesita evaluar de alguna manera su calidad. <br><br>  Todo comenz칩 en 2013.  En ese momento, hab칤a 7 pizzer칤as en la red.  Luego, en Dodo, decidieron lanzar un proyecto para controlar la calidad y los est치ndares del producto, una calificaci칩n de pizzer칤as abierta a todos los socios. <br><br>  Se ve칤a as칤. <br><br><img src="https://habrastorage.org/webt/c9/rq/qj/c9rqqjnm6lxlqahi13lral5y7ni.png"><br><br>  Los datos fueron tomados de llamadas de clientes, revisiones en las redes sociales.  redes y un poco de Dodo IS (nuestro sistema de informaci칩n). <br><br>  Una ventaja obvia en ese momento: la calificaci칩n comenz칩 a impulsar a las pizzer칤as administradoras a trabajar en la calidad para estar en la cima. <br><br><h2>  Pizzer칤as Second Shop Mystery Shop </h2><br>  Aproximadamente un a침o despu칠s, nos dimos cuenta de que necesit치bamos evaluar el producto en s칤 y tomamos el famoso modelo: "compradores misteriosos".  En ese momento, hicimos un gran avance: el primero en Rusia decidi칩 que nuestros clientes ser칤an los compradores misteriosos. <br><br><h4>  La aparici칩n de un grupo cerrado VK </h4><br>  Inicialmente, descubrimos c칩mo trabajan con compradores misteriosos en agencias que brindan dichos servicios.  Result칩 que se comunican por correo electr칩nico o llaman directamente para ofrecer la verificaci칩n. <br><br>  Esta opci칩n no nos sedujo de inmediato.  Definitivamente no 칤bamos a llamar, porque para nosotros fue mucho tiempo, pero para un cliente fue doloroso y estaba a la par con el spam.  El correo se utiliz칩 para env칤os masivos, pero pronto fueron abandonados. <br><br>  Se nos ocurri칩: <br><br><ol><li>  Para la comunicaci칩n con los agentes secretos y la coordinaci칩n de los controles, utilizaron la p치gina habitual en VK. </li><li>  Para recopilar informes fotogr치ficos, formaron un grupo en VK con una pared abierta. </li><li>  Y para las encuestas de servicio, elegimos los formularios de Google.  Que?  Convenientemente, no necesita cortar un servicio separado, y se muestra bien en el tel칠fono m칩vil. </li><li>  Todas las instrucciones estaban en Google Docs. </li></ol><br>  Todo est치 en la rodilla.  Todo es como deber칤a ser para una startup. <br><br><img src="https://habrastorage.org/webt/0x/bu/2u/0xbu2ung5j6no9ltwyi_re80aqe.jpeg"><br>  <i>Foto de un comprador misterioso.</i>  <i>S칤, midieron el ancho con una regla, cortaron el borde de la pizza para mostrar el horneado y la calidad de la masa.</i> <br><br><div class="spoiler">  <b class="spoiler_title">M치s ejemplos de reportajes fotogr치ficos de 2015 est치n aqu칤.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-v/fx/nh/-vfxnheu2wvm1gxfcc2epiwqyxw.jpeg"><br><img src="https://habrastorage.org/webt/zd/kk/d0/zdkkd0crvk0xqgdidv9roxanw_c.jpeg"><br><img src="https://habrastorage.org/webt/qk/co/fz/qkcofzsjt7iz2qm0czous0dw84o.jpeg"><br><img src="https://habrastorage.org/webt/ca/zq/5a/cazq5atxyea8vjvdtmprmwnstly.jpeg"><br></div></div><br>  La calificaci칩n cambiaba constantemente, se agregaron nuevos criterios de evaluaci칩n.  Por ejemplo, esto es 131 puntos para evaluar la pizzer칤a Abakan-1. <br><br><img src="https://habrastorage.org/webt/x9/6c/lj/x96cljo2g-fkxgmsrbbqy8_bcxe.gif"><br><br>  Todo el proceso fue que todas las violaciones en los puntos se observaron manualmente, sin automatizaci칩n.  Y todo esto fue hecho por un empleado. <br><br><h4>  La magia de las hojas de c치lculo de Google </h4><br>  En 2016, aprendimos (madurado) que la humanidad ha inventado durante mucho tiempo funciones distintas a = SUMA.  Y qu칠 se puede hacer usando scripts y funciones de importaci칩n de datos entre tablas ... Direct CRM build. <br><br>  Por ejemplo, para evaluar cada pizzer칤a en la tabla hab칤a una hoja, y en ella criterios de evaluaci칩n y puntajes.  1 pizzer칤a = 1 hoja.  Cuantas m치s pizzer칤as, m치s s치banas.  Cada semana una nueva se침al.  Al presionar el bot칩n m치gico, la hoja de plantilla en la tabla se expandi칩 en 120 hojas.  Wah, que bueno! <br><br><img src="https://habrastorage.org/webt/k-/s9/fv/k-s9fvqwy1wnaomulahpgn7a7no.gif"><br><br>  Esta etapa de automatizaci칩n "Dodo Controlling" tom칩 alrededor de seis meses.  Avanzamos paso a paso: aprendimos algo nuevo - implementado, aprendimos algo m치s nuevo - introducido nuevamente. <br><br><h2>  La limitaci칩n como motor del progreso. </h2><br>  Desde el principio, hablamos con compradores misteriosos en nombre de una cuenta personal en VK.  Y luego lleg칩 el d칤a en que nos enfrentamos con problemas irresolubles de p치ginas personales: <br><br><ul><li>  hay un l칤mite de 10,000 amigos; </li><li>  Hay un l칤mite en el env칤o de mensajes: a veces no podemos enviar mensajes, porque VK nos bloque칩 con la frase "usted envi칩 demasiados mensajes, venga ma침ana". </li></ul><br>  Por lo general, VK bloque칩 el env칤o de mensajes alrededor de las 16:00.  Era una hora feliz cuando el equipo pod칤a descansar. <br><br>  Poco a poco, nos encontramos con casi todas las limitaciones del VK y casi logramos dejar de amar este sitio.  Pero ocurri칩 un milagro, y VK le dio a los grupos la oportunidad de conectar widgets de mensajes, bots de chat y otras cosas. <br><br>  De hecho, esta posibilidad era anterior a diciembre de 2016, pero con una limitaci칩n cr칤tica para nosotros: el grupo pod칤a responder el mensaje solo dentro de los 10 d칤as desde el momento en que envi칩 el 칰ltimo mensaje del cliente.  Cuando eliminaron esta restricci칩n, la vida de nuestro equipo comenz칩 a brillar con nuevos colores.  Desde entonces, hemos comenzado el camino de la automatizaci칩n utilizando la API VK y las hojas de c치lculo de Google. <br><br><h2>  Miedo y asco en una secuencia de comandos de usuario </h2><br>  Inicialmente, para convertirse en un comprador misterioso, ten칤a que completar un formulario, luego presentar una solicitud al grupo, escribirnos una palabra clave y esperar a que respondamos.  Esta espera podr칤a durar hasta 48 horas.  Fue indecentemente largo y el deseo de realizar controles despu칠s de tal registro se desvaneci칩. <br><br>  Con una nueva tienda de conocimiento, nos propusimos automatizar el registro. <br><br>  Ten칤amos varios m칠todos de API, una forma, varias docenas de tablas, una p치gina de inicio, un bot en PHP, scripts en la tabla que fueron escritos por el mejor comercializador Dodo y el primer CFO de Dodo en una persona, docenas de plantillas de mensajes para diferentes situaciones.  Entonces ni siquiera sab칤a que esto se llamaba un script de usuario: <br><br><ol><li>  Mystery Shopper llen칩 un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cuestionario</a> (esta es una versi칩n desactualizada y ahora no funciona). </li><li>  Los datos del formulario cayeron primero en la base de datos, luego en la tabla.  El bot primero llam칩 a la base de datos para verificar los datos sobre el perfil, porque el tiempo de espera de respuesta de la placa en decenas de miles de l칤neas era grande, y la base de datos lo digiri칩 f치cilmente). </li><li>  Despu칠s de completar el cuestionario en el formulario, apareci칩 un mensaje en la pantalla: "Gracias, queda por unirse al grupo (enlace) y escribir la palabra clave" Sherlock "". </li><li>  Luego, el comprador misterioso envi칩 una solicitud para unirse al grupo y escribi칩 la palabra clave "Sherlock".  La palabra fue el desencadenante para ejecutar el script de validaci칩n: <br>  - se envi칩 una solicitud a la base de datos si el agente es adecuado para nosotros por edad; <br>  - en caso afirmativo, la persona fue agregada a los grupos, y en la tabla opuesta al cuestionario del candidato se anot칩 el estado "ok / not ok"; <br>  - Se pintaron m치s datos en color turquesa y fue importante.  As칤 que con mis ojos fue m치s f치cil entender qui칠n nos conviene y con qui칠n podemos hablar.  El gui칩n pintaba perfiles rojos inadecuados; <br>  - Adem치s, el comprador secreto fue aceptado autom치ticamente en el grupo, y se envi칩 un mensaje al chat con m치s pasos e instrucciones. </li></ol><br><img src="https://habrastorage.org/webt/so/ty/se/sotysezhht_urug1ax9cnrvc9-g.png"><br><br>  Tal es la automatizaci칩n del registro.  Ahora todo el procedimiento se ha vuelto casi simple y comprensible. <br><br>  Adem치s, todo fue como un reloj.  Qued칩 claro que podemos enviar mensajes a trav칠s de tablas directamente a PM a agentes secretos a trav칠s de mensajes grupales. <br><br><img src="https://habrastorage.org/webt/zn/px/nd/znpxndqiyuxkqp0y6mnhov7fooc.gif"><br><br>  춰Y acabas de tener 46 l칤neas de c칩digo! <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = SpreadsheetApp.getActiveSpreadsheet().getActiveRange(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = range.getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> carray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> marray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> iarray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>).getValues(); ss.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tt = range.getRowIndex(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = tt + i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> check = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange(<span class="hljs-string"><span class="hljs-string">'L'</span></span> + add).getValue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (check != <span class="hljs-string"><span class="hljs-string">''</span></span>) { SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange(<span class="hljs-string"><span class="hljs-string">'K'</span></span> + add).setValue(<span class="hljs-string"><span class="hljs-string">""</span></span>).setBackground(<span class="hljs-string"><span class="hljs-string">"#ffff00"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = { <span class="hljs-string"><span class="hljs-string">"message"</span></span> : marray[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"user_id"</span></span> : r[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"access_token"</span></span> : <span class="hljs-string"><span class="hljs-string">"    "</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.74"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = { <span class="hljs-comment"><span class="hljs-comment">//   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload, "muteHttpExceptions" : true, }; var jsonData = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.send", options).getContentText()); if (jsonData['error'] != undefined) { SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange('K' + add).setValue("").setBackground("#ff0000"); } Logger.log(jsonData); var log = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Log'); var int = log.getRange('A1').getValue(); var d = new Date(); log.getRange('B' + int).setValue(d); log.getRange('C' + int).setValue(r[0] + ""); log.getRange('A1').setValue(int + 1); Utilities.sleep(400); }); }</span></span></code> </pre> <br>  En las tablas, generamos el texto de los mensajes y realizamos env칤os personalizados mediante la p치gina de identificaci칩n.  Tambi칠n dejamos de copiar y enviar mensajes manualmente.  En las horas pico, podr칤amos enviar hasta 3000 mensajes en 45 minutos usando tablas.  Si lo hici칠ramos a mano, entonces no escribir칤a este art칤culo, pero seguir칤a enviando mensajes. <br><br>  A continuaci칩n, doy un ejemplo de una tableta tan milagrosa.  Intent칠 mucho hacer una UX / UI clara y funcional.  Al hacer clic en el bot칩n rojo, se lanz칩 una lista de correo con una propuesta para realizar una verificaci칩n secreta. <br><br><img src="https://habrastorage.org/webt/ht/be/ix/htbeixa27tdtlix28xnzhsmh6xg.png"><br><br><h2>  M치s funciones para automatizar procesos infernales </h2><br>  La compa침칤a tiene muchos formularios de Google que nos ayudan a recopilar algunas m칠tricas de pizzer칤as de forma continua.  Cada formulario tiene una lista de pizzer칤as que deben mantenerse actualizadas.  Hay 53 formularios en total, cada uno de ellos se actualiz칩 previamente de forma manual. <br><br>  Un poco cansado de este trabajo, nos dimos cuenta de que este negocio podr칤a automatizarse.  Volv칤 a recurrir a nuestro vendedor, despu칠s de una o dos horas, todo estaba listo y solo 47 l칤neas de c칩digo. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myFunction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getActiveRange(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> forms = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sources = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ranges = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>).getValues(); forms.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> form = FormApp.openById(forms[i]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> values = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sources[i]).getRange(ranges[i]).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr = []; values.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">el,ei</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (el[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">''</span></span>) { arr.push(el[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item = form.getItems()[<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(items[i])].asListItem(); item.setChoiceValues(arr); Logger.log(item.getTitle()); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getSheetByName(<span class="hljs-string"><span class="hljs-string">"    "</span></span>).getRange(<span class="hljs-string"><span class="hljs-string">"A2:C"</span></span>).getValues(); Logger.log(range); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ui = SpreadsheetApp.getUi(); <span class="hljs-comment"><span class="hljs-comment">// Or DocumentApp or FormApp. ui.createMenu('Custom Menu') .addItem('Change', 'myFunction') .addToUi(); } function update() { var ss = SpreadsheetApp.getActiveSpreadsheet(); var range = ss.getSheetByName(" ").getRange("A2:A"); range.activate(); myFunction(); } function createTimeDrivenTriggers() { ScriptApp.newTrigger('update').timeBased().everyDays(1).create(); }</span></span></code> </pre><br>  Los formularios son diferentes, con diferentes listas de pizzer칤as y la ubicaci칩n de la lista de pizzer칤as en el formulario.  En alg칰n lugar necesitamos extranjeros, en alg칰n lugar de Rusia. <br><br><img src="https://habrastorage.org/webt/wq/h8/g2/wqh8g2jyt3gmwqopaicz4h2u_h8.png"><br><br>  Las columnas B y C le dicen al script en qu칠 formulario actualizar y en qu칠 lugar el formulario muestra la lista.  Y las columnas D y E, de qu칠 hoja y rango necesita tomar la lista para actualizar. <br><br>  A continuaci칩n, establecieron un disparador para ejecutar el script una vez al d칤a y, por lo tanto, pudieron vencer el infierno del proceso de actualizaci칩n de formularios primero para su departamento, luego para toda la empresa.  Este script a칰n funciona. <br><br><h2>  El caso m치s dif칤cil sobre un caracol. </h2><br>  Una vez que quer칤amos recibir grabaciones de audio de los controles de entrega. <br><br>  De d칩nde vino la grabaci칩n de audio: los compradores misteriosos grabaron la reuni칩n del servicio de mensajer칤a con el cliente como un mensaje de audio en VK.  Por lo general, esto es 10-15 segundos de grabaci칩n de audio. <br><br>  C칩mo los obtuvimos: tomaron los 칰ltimos 20 mensajes en la direcci칩n VK del comprador misterioso, buscaron la palabra "Ulica" entre ellos, luego retrocedieron un mensaje y quitaron el enlace a la grabaci칩n de audio.  (Spoiler: no es la mejor palabra, a menudo nos escribieron la palabra "Caracol"). <br><br>  Ya hay m치s l칤neas de c칩digo, prep치rate. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLastAudio</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getActiveRange().getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tt = ss.getActiveRange().getRowIndex(); range.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ri = tt + i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cuid = r[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ci = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload1 = { <span class="hljs-string"><span class="hljs-string">"q"</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'peer_id'</span></span> : r[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"access_token"</span></span> : token, <span class="hljs-string"><span class="hljs-string">"v"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.73"</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options1 = { <span class="hljs-comment"><span class="hljs-comment">//   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload1, "muteHttpExceptions" : true }; var jsonData = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.search", options1).getContentText()); Logger.log(jsonData); if (jsonData['response']['items'] == undefined) { ss.getRange("B" + ri).setValue(' ').setBackground('#f00'); return; } var cmid = jsonData['response']['items'][0]['id']; var date = new Date((jsonData['response']['items'][0]['date']*1000)); var fdate = Utilities.formatDate(date, "GMT+3", "dd-MM-yyyy HH:mm:ss"); ss.getRange("B" + ri).setValue(fdate); var payload2 = { "user_id" : cuid, "count" : '20', "access_token" : token, "v" : "5.73", }; var options2 = { //   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload2, "muteHttpExceptions" : true }; var jsonData2 = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.getHistory", options2).getContentText()); Logger.log(jsonData2); jsonData2['response']['items'].forEach(function (r,i) { if (r['id'] == cmid) { ci = i + 1; Logger.log(jsonData2['response']['items'][ci]); if (jsonData2['response']['items'][ci] == undefined) { ss.getRange("C" + ri).setValue(" "); } else { if (jsonData2['response']['items'][ci] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'][0]['doc'] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'][0]['doc']['url'] != undefined) { ss.getRange("C" + ri).setValue(jsonData2['response']['items'][ci]['attachments'][0]['doc']['url']); } else { ss.getRange("C" + ri).setValue(jsonData2['response']['items'][ci]['body']); } } } }); }); }</span></span></code> </pre><br><h2>  Las hojas de c치lculo de Google no son gomosas, pero soy un codificador regular </h2><br>  Entonces todo giraba y giraba, hasta que crecimos hasta 60 mil compradores misteriosos a principios de 2018. <br><br>  Entonces, ya nos hemos topado con restricciones de tabla.  Entonces, una tabla no pod칤a contener m치s de 2 millones de celdas, y utilizamos 1,6 millones de celdas en una de las etiquetas de departamento m치s concurridas, de las cuales 135 mil celdas ten칤an todo tipo de funciones de tabla. <br><br>  Tal backend.  Todo se ralentiz칩 terriblemente y cuando varias personas trabajaron juntas, el plato dio "El documento es demasiado popular, vuelve m치s tarde". <br><br>  Luego qued칩 claro que soy un mal codificador, el sistema no soporta la carga y necesito ser reemplazado. <br><br><h2>  Y luego vino el verdadero desarrollador ... </h2><br>  Pero esta es una historia completamente diferente y la escribiremos m치s adelante.  Espero que estos ejemplos ayuden a los gerentes en sus proyectos, donde hay muchos procesos infernales.  Los procesos pueden y deben ser automatizados, tanto las tablas como el zapier (tambi칠n lo usamos) pueden ayudar, y encontrar soluciones si hay recursos, al principio no los ten칤amos. <br><br>  Si tiene una persona en la empresa que sabe algo sobre scripts, entonces es adecuado para organizar procesos infernales en tabletas.  Si usted mismo quiere aprender algo como esto, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Telegram</a> tiene un excelente canal para esto, del cual tom칠 informaci칩n sobre funciones y scripts. <br><br>  Bueno, cabecera para todos los gerentes: conocer las tablas todos los d칤as ahorra tiempo al trabajar con datos y le permite pensar y comprender al menos un poco lo que hace el desarrollador con los datos y lo que puede hacer con los datos en general. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/472856/">https://habr.com/ru/post/472856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../472840/index.html">쮸lmacenamiento definido por software o qu칠 mat칩 a los dinosaurios?</a></li>
<li><a href="../472848/index.html">Reflexiones sobre una carrera en TI</a></li>
<li><a href="../472850/index.html">Profesi칩n o vida: Gana un curso de Netolog칤a si no tienes miedo</a></li>
<li><a href="../472852/index.html">GitLab realiza cambios para usuarios de productos en la nube y comerciales</a></li>
<li><a href="../472854/index.html">Unity UI Profiling: 쯈ui칠n estropea mi procesamiento por lotes?</a></li>
<li><a href="../472858/index.html">Python y clientes HTTP r치pidos</a></li>
<li><a href="../472860/index.html">Invalidaci칩n de cach칠 en cascada. Parte 1</a></li>
<li><a href="../472864/index.html">Punto de control: optimizaci칩n de CPU y RAM</a></li>
<li><a href="../472866/index.html">Talism치n para comunicaci칩n estable</a></li>
<li><a href="../472870/index.html">Por qu칠 Agile se detiene sin transformar la arquitectura y las herramientas de desarrollo - presentaci칩n de la conferencia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>