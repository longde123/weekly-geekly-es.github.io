<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ûñ üëî üëèüèæ Comment effectuer une transaction BTC sans d√©poser de petites pi√®ces üòÇ üë©‚Äçüåæ ü•É</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nombreux portefeuilles Bitcoin lors du choix des pi√®ces √† envoyer pr√©f√®rent utiliser une grande pi√®ce, dont le solde est sup√©rieur au montant envoy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment effectuer une transaction BTC sans d√©poser de petites pi√®ces</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465041/"><p><img src="https://habrastorage.org/webt/fn/ez/kn/fnezknn373mov5izqcr1u0nppfk.png" alt="Objectif: emballer autant d'objets de valeur que possible dans un sac √† dos, √† condition que la capacit√© du sac √† dos soit limit√©e"></p><br><p> De nombreux portefeuilles Bitcoin lors du choix des pi√®ces √† envoyer pr√©f√®rent utiliser une grande pi√®ce, dont le solde est sup√©rieur au montant envoy√©.  Apr√®s chacune de ces transactions, une pi√®ce de monnaie de change est form√©e.  Apr√®s un certain temps, le portefeuille entier est envahi par de telles pi√®ces de l'ordre de 0,001 (~ 10 $ pour le moment), sur lesquelles il n'y a d√©j√† rien √† d√©penser.  Lorsque, une fois de plus, j'ai eu besoin de faire une transaction, il m'est venu √† l'esprit s'il √©tait possible de monter la transaction afin qu'il n'y ait pas de changement.  Le portefeuille a obstin√©ment propos√© de "couper" une autre pi√®ce plus grande, j'ai donc d√©cid√© de choisir des pi√®ces avec mes mains pour collecter le montant n√©cessaire.  Cependant, cela ne s'est pas av√©r√© si simple: la somme s'est av√©r√©e inf√©rieure √† la valeur souhait√©e ou l'a d√©pass√©e trop.  En cons√©quence, j'ai d√©cid√© qu'il devrait y avoir un algorithme avec lequel vous pouvez collecter le montant souhait√© des pi√®ces ou un peu plus.  Il s'est av√©r√© que ce n'est pas seulement possible, mais fonctionne si bien que m'a fait √©crire cet article.  Mais tout d'abord. </p><a name="habracut"></a><br><h2 id="zadacha-o-ryukzake">  Probl√®me de sac √† dos </h2><br><p>  Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">probl√®me du sac √† dos est</a> largement connu: emballer autant d'objets de valeur que possible dans un sac √† dos, √† condition que la capacit√© du sac √† dos soit limit√©e.  Dans ce cas, nous avons le cas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">du probl√®me de sac √† dos 0-1</a> , car chaque article (pi√®ce) n'est disponible pour √™tre emball√© dans le sac √† dos qu'une seule fois.  De plus, le poids de chaque ¬´√©l√©ment¬ª co√Øncide avec sa valeur, nous avons donc affaire √† un cas encore plus sp√©cial, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">probl√®me de la somme des sous-ensembles</a> .  Wikip√©dia sugg√®re d'utiliser un algorithme g√©n√©tique, mais j'ai d√©cid√© de chercher une solution exacte en utilisant la programmation dynamique, car cela est tout √† fait r√©alisable en termes de ressources et semble simple. </p><br><p>  Pour r√©duire le probl√®me du choix des pi√®ces √† la t√¢che d'un sac √† dos, vous devez effectuer une petite conversion des donn√©es d'entr√©e.  Le fait est que la r√©solution du probl√®me du sac √† dos (plus pr√©cis√©ment, la somme des sous-ensembles) nous donnera un sous-ensemble de l'ensemble d'origine qui a une quantit√© maximale ne d√©passant pas le param√®tre (capacit√© de charge du sac √† dos).  Mais nous ne sommes pas satisfaits de la combinaison de pi√®ces, ce qui donne un montant inf√©rieur au montant que nous voulons envoyer.  Cependant, nous sommes √† l'aise avec des combinaisons l√©g√®rement sup√©rieures.  Par exemple, si nous devons envoyer 0,005 bitcoins et que nous avons trouv√© une combinaison qui donne 0,00499, cela nous est inutile, car il est inf√©rieur au montant souhait√© par le vendeur.  Mais si nous trouvons 0,005001, c'est vrai.  Extra satoshiki peut √™tre utilis√© comme une commission (nous en parlerons en d√©tail ci-dessous) ou le donner au vendeur s'il permet d'envoyer un montant plus important.  Par cons√©quent, avec l'aide du probl√®me du sac √† dos, nous devons choisir non pas les pi√®ces qui doivent √™tre <strong>envoy√©es</strong> , mais celles qui doivent √™tre <strong>laiss√©es</strong> .  Ensuite, la "p√©nurie" au maximum se transformera en "buste" en termes de probl√®me d'origine. </p><br><p><img src="https://habrastorage.org/webt/ew/3q/su/ew3qsuzkpbzdy68chuyleel8vrm.png" alt="S√©lection automatique et manuelle des pi√®ces √† envoyer"></p><br><p>  Un exemple.  Supposons que nous ayons de telles pi√®ces: 0,1 BTC, 0,002 BTC, 0,00832423 BTC.  Et nous devons envoyer 0,01 BTC.  Nous trouverons de telles pi√®ces, dont la somme sera maximale, mais inf√©rieure ou √©gale au montant total de nos pi√®ces moins le montant envoy√©, c'est-√†-dire un tel nombre: 0,1 + 0,002 + 0,00832423 - 0,01 = 0,10032423.  Dans ce cas, une simple recherche r√©v√®le qu'il s'agit d'une pi√®ce de 0,1.  Nous le laissons, ce qui signifie que nous envoyons le reste: 0,002 BTC et 0,00832423 BTC, ce qui donne au total 0,01032423 BTC, ce qui est sup√©rieur √† 0,01 BTC et nous convient.  (Certes, la commission est sortie √† environ 3 $, mais disons que le r√©seau est occup√© et que nous voulons rendre l'envoi aussi rapide que possible.) </p><br><h2 id="komissii">  Les commissions </h2><br><p>  Pour tenir compte des frais de transaction, j'ai modifi√© chaque pi√®ce d'entr√©e, r√©duisant son solde du montant qui devrait √™tre pay√© pour son inclusion dans la transaction en tant qu'entr√©e.  Cela peut √™tre fait en connaissant la taille de l'entr√©e et la commission (par exemple, 2 satoshi par octet).  De plus, j'ai modifi√© le montant √† envoyer, en y ajoutant le prix de la partie de la transaction qui ne d√©pend pas des pi√®ces s√©lectionn√©es: rubrique et sortie (s).  L'utilisateur peut sp√©cifier tous ces param√®tres √† l'aide de drapeaux.  Vous pouvez √©galement d√©sactiver l'ajustement pour les commissions en g√©n√©ral en sp√©cifiant une commission de 0 Satoshi par octet. </p><br><p>  J'ai pris des informations sur les tailles des entr√©es et des sorties dans diff√©rentes versions d'adresses (segwit classique, envelopp√© et segwit natif d'ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://bitcoin.stackexchange.com/a/84006</a> </p><br><h2 id="algoritmy-i-realizaciya">  Algorithmes et impl√©mentation </h2><br><p>  J'ai imm√©diatement abandonn√© l'algorithme g√©n√©tique, peut-√™tre en vain.  Concentr√© sur des algorithmes pr√©cis.  Ma premi√®re tentative a √©t√© de r√©aliser √† travers une recherche exhaustive de toutes les combinaisons, mais m√™me sur 40 pi√®ces, cela a fonctionn√© pendant des heures et a d√ª l'abandonner.  J'ai ensuite essay√© la programmation dynamique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">propos√©e sur Wikip√©dia</a> .  Dans ce document, vous ne pouvez pas garder en m√©moire la matrice enti√®re, mais uniquement les lignes actuelles et pr√©c√©dentes.  De plus, nous n'avons pas besoin de stocker la valeur, car elle co√Øncide avec le poids et est le num√©ro de colonne.  Mais nous devons nous souvenir de la combinaison - j'ai d√©cid√© de la stocker sous la forme d'un jeu de bits.  De plus, vous ne pouvez stocker qu'une seule ligne, en cr√©ant la ligne suivante en place.  Chaque enregistrement de ligne non nul reste √† sa place et est copi√© (avec l'ajout du bit correspondant) dans une autre cellule un certain nombre de cellules √† droite (s'il y √©tait vide auparavant).  Si vous allez dans l'ordre inverse, en triant la cellule dans laquelle va le ¬´saut¬ª, vous pouvez tout remplir correctement: </p><br><p><img src="https://habrastorage.org/webt/fa/qb/ts/faqbtspntkfkjgzwy6koiubabvi.png" alt="Illustration de la transition vers la ligne suivante, c'est-√†-dire l'ajout d'une autre pi√®ce √† la programmation dynamique"><br>  <em>Chaque cellule non nulle de la ligne actuelle g√©n√®re dans la ligne suivante elle-m√™me et une autre cellule pour un certain nombre de cellules (√©gal √† la valeur de la pi√®ce ajout√©e) √† droite.</em>  <em>S'il y a d√©j√† une valeur dans cette cellule, alors l'option avec le plus grand nombre de pi√®ces s√©lectionn√©es (c'est-√†-dire non incluses dans la transaction) ¬´gagne¬ª, car nous voulons envoyer le moins de pi√®ces possible, toutes choses √©tant √©gales par ailleurs.</em> </p><br><p>  Sur une cellule, je d√©pense 8 octets pour un jeu de bits, et le nombre de cellules est √©gal au nombre possible de soldes de 0 au montant des pi√®ces moins le montant envoy√©.  Par exemple, s'il n'y a qu'un bitcoin dans le portefeuille et que 0,1 est envoy√©, alors il y aura 100'000'000-10'000'000 = 90'000'000 cellules, chacune de 8 octets, soit 720 m√©gaoctets - un peu pour un ordinateur moderne.  Si le nombre de pi√®ces est inf√©rieur √† 32, il serait alors possible d'utiliser 4 octets par pi√®ce, mais je ne l'ai pas optimis√©.  De plus, s'il y a plus de 64 pi√®ces, le programme ne fonctionne pas - cela devrait √©galement √™tre corrig√© en cr√©ant un jeu de bits de longueur arbitraire.  Enfin, vous pouvez d√©fausser le dernier signe des soldes, perdant un peu de pr√©cision, mais gagnant 10 fois en m√©moire.  Mais jusqu'√† pr√©sent, cela suffira. </p><br><p> J'ai appel√© le <strong>programme immuable</strong> et l'ai plac√© sur le gitlab: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gitlab.com/starius/changeless</a> .  Il est √©crit en Go, assembl√© en utilisant <code>go get</code> , comme d'habitude.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les binaires pour Linux, Windows, Mac</a> , collect√©s dans CI sont disponibles. </p><br><p>  Lorsque j'ai lanc√© le programme avec de vraies pi√®ces, j'ai √©t√© √©tonn√© de la pr√©cision avec laquelle elle a choisi la combinaison n√©cessaire.  Lorsque le nombre de pi√®ces est √©lev√©, presque n'importe quel montant proportionnel aux soldes des pi√®ces peut √™tre s√©lectionn√© avec pr√©cision jusqu'√† satoshi!  Vous modifiez le montant requis pour 1 satoshi et le programme donne une combinaison compl√®tement diff√©rente de pi√®ces exactement pour ce montant.  Vous trouverez ci-dessous un exemple de travail sur 50 pi√®ces al√©atoires avec des soldes de 0 √† 1 bitcoin. </p><br><pre> <code class="plaintext hljs">$ cat coins50.txt 0.01331611 0.03906237 0.04847086 0.08453118 0.09748168 0.10395389 0.10619825 0.12156721 0.12923149 0.13587973 0.14798976 0.16053788 0.19011834 0.21570038 0.21946913 0.31861430 0.33435508 0.33718842 0.33789473 0.35976748 0.37360122 0.44944553 0.47572926 0.49927495 0.50992142 0.53062326 0.53079433 0.53542072 0.54715225 0.55019714 0.55313907 0.56656642 0.56673333 0.65879650 0.66228482 0.68424322 0.70436496 0.75638055 0.79095597 0.82438005 0.83684407 0.85151564 0.86862948 0.90054250 0.90239402 0.91636213 0.93087757 0.93579251 0.97207439 0.98248384 $ changeless -amount 10.00000000 -coins coins50.txt Processing item 50/50. 0.09748168 + 0.33435508 + 0.47572926 + 0.53542072 + 0.66228482 + 0.70436496 + 0.75638055 + 0.82438005 + 0.9005425 + 0.90239402 + 0.91636213 + 0.93579251 + 0.97207439 + 0.98248384 = 10.00004651 Tx size: 2118 vBytes. Total fees: 0.00004651 BTC (2.2 sats/vByte). $ changeless -amount 10.00000001 -coins coins50.txt Processing item 50/50. 0.01331611 + 0.09748168 + 0.53079433 + 0.56656642 + 0.70436496 + 0.75638055 + 0.82438005 + 0.86862948 + 0.9005425 + 0.91636213 + 0.93087757 + 0.93579251 + 0.97207439 + 0.98248384 = 10.00004652 Tx size: 2118 vBytes. Total fees: 0.00004651 BTC (2.2 sats/vByte).</code> </pre> <br><p>  Le programme a r√©ussi √† ramasser des combinaisons de pi√®ces pour envoyer exactement 10 bitcoins et exactement 10.00000001 bitcoins (10 bitcoins et 1 satoshi).  Pour voir cela, vous devez soustraire la commission du montant des pi√®ces: 10.00004651 - 0.00004651 = 10, 10.00004652 - 0.00004651 = 10.00000001. </p><br><h2 id="kak-poluchit-spisok-balansov-monet">  Comment obtenir une liste des soldes de pi√®ces </h2><br><p>  Pour le programme Electrum, j'ai trouv√© cette fa√ßon (commande console): </p><br><pre> <code class="plaintext hljs">' '.join((x["value"]) for x in listunspent())</code> </pre> <br><p>  Si vous souhaitez exclure certaines pi√®ces, par exemple √† une certaine adresse, cela peut √™tre fait comme ceci: </p><br><pre> <code class="plaintext hljs">' '.join((x["value"]) for x in listunspent() if x["address"] != "bad address")</code> </pre> <br><p>  Pour les autres portefeuilles, je n'ai pas trouv√© un moyen aussi simple et j'ai d√ª le retaper avec mes mains. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465041/">https://habr.com/ru/post/fr465041/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465027/index.html">10 questions na√Øves mais importantes sur le CRM</a></li>
<li><a href="../fr465029/index.html">[POSSIBLE] SORM d√©chiffre le trafic HTTPS vers Mail.ru et ICQ</a></li>
<li><a href="../fr465031/index.html">Vue int√©rieure: RFID dans le monde moderne. Partie 2: RFID chinoise</a></li>
<li><a href="../fr465033/index.html">Venez avec la technologie Powercheck</a></li>
<li><a href="../fr465039/index.html">Semaine de la s√©curit√© 35: statistiques sur les fuites de mots de passe et les attaques via Google Drive</a></li>
<li><a href="../fr465045/index.html">Kali Linux NetHunter sur Android: pourquoi et comment installer</a></li>
<li><a href="../fr465047/index.html">Tests unitaires dans SGBD - comment nous le faisons dans Sportmaster, deuxi√®me partie</a></li>
<li><a href="../fr465049/index.html">10 livres sur la gestion de projet Agile √† emporter avec vous en 2020</a></li>
<li><a href="../fr465055/index.html">Six comp√©tences pour faire passer votre carri√®re en Data Science au niveau sup√©rieur.</a></li>
<li><a href="../fr465057/index.html">Conteneurs et fen√™tres. De Hello World √† Kubernetes. Premi√®re partie, introduction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>