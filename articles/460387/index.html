<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê¥ üåï ü§æ Gu√≠a para principiantes de SELinux üç¢ üëäüèª üíû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se prepar√≥ una traducci√≥n del art√≠culo para los estudiantes del curso de seguridad de Linux. 



 SELinux o Security Enhanced Linux es un mecanismo de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gu√≠a para principiantes de SELinux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/460387/"><p><img src="https://habrastorage.org/webt/pp/_j/xp/pp_jxp4pddr_8apkdp5bsztp3r4.png"></p><br><p>  <em>Se prepar√≥ una traducci√≥n del art√≠culo para los estudiantes del curso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">seguridad de Linux.</a></em> </p><br><hr><br><p>  SELinux o Security Enhanced Linux es un mecanismo de control de acceso avanzado desarrollado por la Agencia de Seguridad Nacional de los Estados Unidos (NSA) para evitar intrusiones maliciosas.  Implementa un modelo de control de acceso forzado (u obligatorio) (Ing. Control de acceso obligatorio, MAC) sobre el modelo discrecional (o selectivo) existente (Ing. Control de acceso discrecional, DAC), es decir, permisos para leer, escribir, ejecutar. <a name="habracut"></a></p><br><p>  SELinux tiene tres modos: </p><br><ol><li>  <strong>Cumplimiento</strong> : <strong>denegaci√≥n de</strong> acceso seg√∫n las reglas de la pol√≠tica. </li><li>  <strong>Permisivo</strong> : acciones de registro que violan las pol√≠ticas que estar√≠an prohibidas en el modo obligatorio. </li><li>  <strong>Deshabilitado</strong> : deshabilita SELinux por completo. </li></ol><br><p> Por defecto, la configuraci√≥n est√° en <code>/etc/selinux/config</code> </p><br><h1 id="izmenenie-rezhimov-selinux">  Cambio de modos SELinux </h1><br><p>  Para averiguar el modo actual, ejecute </p><br><pre> <code class="plaintext hljs">$ getenforce</code> </pre> <br><p>  Para cambiar el modo a permisivo, ejecute el siguiente comando </p><br><pre> <code class="plaintext hljs">$ setenforce 0</code> </pre> <br><p>  o, para cambiar el modo de <strong>permisivo</strong> a <strong>obligatorio</strong> , hacer </p><br><pre> <code class="plaintext hljs">$ setenforce 1</code> </pre> <br><p>  Si necesita deshabilitar completamente SELinux, esto solo se puede hacer a trav√©s del archivo de configuraci√≥n </p><br><pre> <code class="plaintext hljs">$ vi /etc/selinux/config</code> </pre> <br><p>  Para deshabilitar, cambie el par√°metro SELINUX de la siguiente manera: </p><br><pre> <code class="plaintext hljs">SELINUX=disabled</code> </pre> <br><h1 id="nastroyka-selinux">  Configuraci√≥n de SELinux </h1><br><p>  Cada archivo y proceso est√° marcado con un contexto SELinux, que contiene informaci√≥n adicional como usuario, rol, tipo, etc.  Si es la primera vez que habilita SELinux, primero debe configurar el contexto y las etiquetas.  El proceso de etiquetado y contexto se conoce como etiquetado.  Para comenzar a marcar, en el archivo de configuraci√≥n, cambie el modo a <strong>permisivo</strong> . </p><br><pre> <code class="plaintext hljs">$ vi /etc/selinux/config SELINUX=permissive</code> </pre> <br><p>  Despu√©s de configurar el modo <strong>permisivo</strong> , cree un archivo oculto vac√≠o llamado <code>autorelabel</code> en la ra√≠z </p><br><pre> <code class="plaintext hljs">$ touch /.autorelabel</code> </pre> <br><p>  y reinicie la computadora </p><br><pre> <code class="plaintext hljs">$ init 6</code> </pre> <br><p>  Nota: utilizamos el modo <strong>permisivo</strong> para marcar, porque el uso del modo <strong>forzado</strong> puede provocar el bloqueo del sistema durante el reinicio. </p><br><p>  No se preocupe si la descarga se atasca en alg√∫n archivo, el marcado lleva alg√∫n tiempo.  Despu√©s de marcar e iniciar su sistema, puede ir al archivo de configuraci√≥n y configurar el modo de <strong>ejecuci√≥n</strong> , as√≠ como ejecutar: </p><br><pre> <code class="plaintext hljs">$ setenforce 1</code> </pre> <br><p>  Ahora ha habilitado con √©xito SELinux en su computadora. </p><br><h1 id="monitorim-logi">  Monitorear registros </h1><br><p>  Es posible que tenga alg√∫n tipo de error al marcar o mientras el sistema se estaba ejecutando.  Para verificar si su SELinux funciona correctamente y si no bloquea el acceso a ning√∫n puerto, aplicaci√≥n, etc., debe mirar los registros.  El registro de SELinux se encuentra en <code>/var/log/audit/audit.log</code> , pero no necesita leerlo por completo para encontrar errores.  Puede usar audit2why para encontrar errores.  Ejecute el siguiente comando: </p><br><pre> <code class="plaintext hljs">$ audit2why &lt; /var/log/audit/audit.log</code> </pre> <br><p>  Como resultado, obtienes una lista de errores.  Si no hubo errores en el registro, no se mostrar√°n mensajes. </p><br><h1 id="nastroyka-politiki-selinux">  Configurar la pol√≠tica de SELinux </h1><br><p>  Una pol√≠tica de SELinux es un conjunto de reglas que gu√≠an la seguridad de SELinux.  Una pol√≠tica define un conjunto de reglas para un entorno particular.  Ahora aprenderemos c√≥mo configurar pol√≠ticas para permitir el acceso a servicios restringidos. </p><br><h4 id="1-logicheskie-znacheniya-pereklyuchateli">  1. Valores l√≥gicos (interruptores) </h4><br><p>  Los conmutadores (booleanos) le permiten cambiar partes de una pol√≠tica mientras trabaja, sin la necesidad de crear nuevas pol√≠ticas.  Le permiten realizar cambios sin reiniciar o volver a compilar las pol√≠ticas de SELinux. </p><br><p>  <strong>Ejemplo</strong> <br>  Supongamos que queremos compartir el directorio de inicio del usuario a trav√©s de FTP para leer y escribir, y ya lo hemos compartido, pero cuando intentamos acceder, no vemos nada.  Esto se debe a que la pol√≠tica de SELinux proh√≠be que el servidor FTP lea y escriba en el directorio de inicio del usuario.  Necesitamos cambiar la pol√≠tica para que el servidor FTP pueda acceder a los directorios principales.  Veamos si hay alg√∫n cambio para esto haciendo </p><br><pre> <code class="plaintext hljs">$ semanage boolean -l</code> </pre> <br><p>  Este comando mostrar√° una lista de interruptores disponibles con su estado actual (encendido / encendido o apagado / apagado) y descripci√≥n.  Puede refinar su b√∫squeda agregando grep para encontrar solo resultados relacionados con ftp: </p><br><pre> <code class="plaintext hljs">$ semanage boolean -l | grep ftp</code> </pre> <br><p>  y encuentra lo siguiente </p><br><pre> <code class="plaintext hljs">ftp_home_dir -&gt; off Allow ftp to read &amp; write file in user home directory</code> </pre> <br><p>  Este interruptor est√° desactivado, as√≠ que lo habilitaremos con <code>setsebool $ setsebool ftp_home_dir on</code> </p><br><p>  Ahora nuestro demonio ftp podr√° acceder al directorio de inicio del usuario. <br>  Nota: tambi√©n puede obtener una lista de modificadores disponibles sin descripci√≥n haciendo <code>getsebool -a</code> </p><br><h4 id="2-metki-i-kontekst">  2. Etiquetas y contexto </h4><br><p>  Esta es la forma m√°s com√∫n de implementar pol√≠ticas SELinux.  Cada archivo, carpeta, proceso y puerto est√° marcado con un contexto SELinux: </p><br><ul><li>  Para los archivos y carpetas, las etiquetas se almacenan como atributos extendidos en el sistema de archivos y se pueden ver con el siguiente comando: <br><pre> <code class="plaintext hljs">$ ls -Z /etc/httpd</code> </pre> </li><li>  Para procesos y puertos, el n√∫cleo controla el marcado y puede ver estas etiquetas de la siguiente manera: </li></ul><br><p>  el proceso </p><br><pre> <code class="plaintext hljs">$ ps ‚ÄìauxZ | grep httpd</code> </pre> <br><p>  puerto </p><br><pre> <code class="plaintext hljs">$ netstat -anpZ | grep httpd</code> </pre> <br><p>  <strong>Ejemplo</strong> <br>  Ahora veamos un ejemplo para comprender mejor las etiquetas y el contexto.  Supongamos que tenemos un servidor web que <code>/var/www/html/  /home/dan/html/</code> lugar del directorio <code>/var/www/html/  /home/dan/html/</code> .  SELinux considerar√° esto como una violaci√≥n de la pol√≠tica y es posible que no pueda navegar por sus p√°ginas web.  Esto se debe a que no hemos configurado el contexto de seguridad asociado con los archivos HTML.  Para ver el contexto de seguridad predeterminado, use el siguiente comando: </p><br><pre> <code class="plaintext hljs">$ ls ‚Äìlz /var/www/html -rw-r‚Äîr‚Äî. root root unconfined_u:object_r:httpd_sys_content_t:s0 /var/www/html/</code> </pre> <br><p>  Aqu√≠ tenemos <code>httpd_sys_content_t</code> como contexto para los archivos html.  Necesitamos establecer este contexto de seguridad para nuestro directorio actual, que ahora tiene el siguiente contexto: </p><br><pre> <code class="plaintext hljs">-rw-r‚Äîr‚Äî. dan dan system_u:object_r:user_home_t:s0 /home/dan/html/</code> </pre> <br><p>  Comando alternativo para verificar el contexto de seguridad de un archivo o directorio: </p><br><pre> <code class="plaintext hljs">$ semanage fcontext -l | grep '/var/www'</code> </pre> <br><p>  Tambi√©n usaremos semanage para cambiar el contexto despu√©s de encontrar el contexto de seguridad correcto.  Para cambiar el contexto de / home / dan / html, ejecute los siguientes comandos: </p><br><pre> <code class="plaintext hljs">$ semanage fcontext -a -t httpd_sys_content_t '/home/dan/html(/.*)?' $ semanage fcontext -l | grep '/home/dan/html' /home/dan/html(/.*)? all files system_u:object_r:httpd_sys_content_t:s0 $ restorecon -Rv /home/dan/html</code> </pre> <br><p>  Despu√©s de cambiar el contexto usando semanage, el comando restorecon cargar√° el contexto predeterminado para archivos y directorios.  Nuestro servidor web ahora podr√° leer archivos de la carpeta <code>/home/dan/html</code> , ya que el contexto de seguridad de esta carpeta se ha cambiado a <code>httpd_sys_content_t</code> . </p><br><h4 id="3-sozdanie-lokalnyh-politik">  3. Crear pol√≠ticas locales </h4><br><p>  Puede haber situaciones en las que los m√©todos anteriores son in√∫tiles para usted y obtiene errores (avc / negaci√≥n) en audit.log.  Cuando esto sucede, debe crear una pol√≠tica local.  Puede encontrar todos los errores con audit2why, como se describi√≥ anteriormente. </p><br><p>  Para resolver errores, puede crear una pol√≠tica local.  Por ejemplo, obtenemos un error relacionado con httpd (apache) o smbd (samba), grep errores y creamos una pol√≠tica para ellos: </p><br><pre> <code class="plaintext hljs">apache $ grep httpd_t /var/log/audit/audit.log | audit2allow -M http_policy samba $ grep smbd_t /var/log/audit/audit.log | audit2allow -M smb_policy</code> </pre> <br><p>  Aqu√≠ <code>http_policy</code> y <code>smb_policy</code> son los nombres de las pol√≠ticas locales que creamos.  Ahora necesitamos cargar estas pol√≠ticas locales creadas en la pol√≠tica actual de SELinux.  Esto se puede hacer de la siguiente manera: </p><br><pre> <code class="plaintext hljs">$ semodule ‚ÄìI http_policy.pp $ semodule ‚ÄìI smb_policy.pp</code> </pre> <br><p>  Se cargaron nuestras pol√≠ticas locales, y ya no deber√≠amos recibir ning√∫n avc o denail en audit.log. </p><br><hr><br><p>  <em>Fue mi intento de ayudarlo a comprender SELinux.</em>  <em>Espero que despu√©s de leer este art√≠culo se sienta m√°s c√≥modo con SELinux.</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460387/">https://habr.com/ru/post/460387/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460373/index.html">Under the Hood Turbo Pages: Arquitectura de la p√°gina web Tecnolog√≠a de descarga r√°pida</a></li>
<li><a href="../460375/index.html">Libro "Aprendizaje autom√°tico para empresas y marketing"</a></li>
<li><a href="../460377/index.html">Uso de Liquibase para administrar la estructura de la base de datos en una aplicaci√≥n Spring Boot. Parte 1</a></li>
<li><a href="../460381/index.html">¬øQu√© es la asertividad y por qu√© es necesaria?</a></li>
<li><a href="../460383/index.html">Las transiciones de pantalla en Legend of Zelda usan las funciones no documentadas de NES</a></li>
<li><a href="../460393/index.html">Antecedentes: qu√© esperar de Fedora Silverblue</a></li>
<li><a href="../460395/index.html">La anal√≠tica como caracter√≠stica: el proceso de trabajar con datos en Plesk</a></li>
<li><a href="../460397/index.html">Inicio r√°pido con WebComponents</a></li>
<li><a href="../460399/index.html">Indicador de carga de SVG en Vue.js</a></li>
<li><a href="../460403/index.html">Ventajas y desventajas de HugePages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>