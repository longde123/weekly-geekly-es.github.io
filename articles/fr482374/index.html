<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚¨õÔ∏è üòÉ üéõÔ∏è D√©veloppement de jeux sur LibGDX √† l'aide du mod√®le Entity Component System üë©üèæ‚Äçüåæ üê™ üõÄüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut Habr! Je m'appelle Andrey Shilo, je suis d√©veloppeur Android chez FINCH . Aujourd'hui, je vais vous dire quelles erreurs ne devraient pas √™tre c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppement de jeux sur LibGDX √† l'aide du mod√®le Entity Component System</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482374/">  Salut Habr!  Je m'appelle Andrey Shilo, je suis d√©veloppeur Android chez <a href="https://www.facebook.com/FinchMoscow">FINCH</a> .  Aujourd'hui, je vais vous dire quelles erreurs ne devraient pas √™tre commises lors de l'√©criture m√™me du jeu le plus simple et pourquoi l'approche architecturale ECS ( <a href="https://en.wikipedia.org/wiki/Entity_component_system">Entity Component System</a> ) est cool. <br><a name="habracut"></a><br><h2>  La premi√®re fois est toujours douloureuse </h2><br>  Nous avons un projet amusant pour une grande entreprise m√©diatique, qui est un r√©seau social non standard.  r√©seau avec des messages, des commentaires, des likes et des vid√©os.  Une fois, ils nous ont donn√© une t√¢che - introduire la m√©canique du jeu comme promotion.  Le jeu ressemblait √† de simples mini-courses, o√π avec un coup sur la gauche / droite, la voiture se d√©pla√ßait sur la voie gauche / droite.  Donc, en esquivant les obstacles et en r√©cup√©rant des boosters, vous deviez arriver √† la ligne d'arriv√©e, dans l'ensemble, le joueur avait trois vies. <br><br>  Le jeu √©tait cens√© √™tre impl√©ment√© directement dans l'application, bien s√ªr, sur un √©cran s√©par√©.  Nous avons choisi inconditionnellement <a href="https://libgdx.badlogicgames.com/">LibGDX</a> comme moteur, car vous pouvez coder le jeu sur kotiln et d√©boguer sur le bureau, en lan√ßant le jeu en tant <a href="https://libgdx.badlogicgames.com/documentation/gettingstarted/Running%2520and%2520Debugging.html">qu'application java</a> .  Dans le m√™me temps, nous n'avions pas de gens qui connaissaient d'autres moteurs pouvant √™tre impl√©ment√©s dans l'application (si vous le savez, alors partagez-le). <br><br>  Le jeu ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/le/xy/z0/lexyz0syrcyj6czcecctxnw0kh8.jpeg"><br><br>  √âtant donn√© que le jeu selon les savoirs traditionnels d'origine semblait simple, nous ne nous sommes pas plong√©s dans les approches architecturales.  De plus, les promotions elles-m√™mes passent rapidement - en moyenne, une action prend un mois et demi.  En cons√©quence, plus tard, le code du jeu sera simplement supprim√© et ne sera pas n√©cessaire avant la prochaine promo, √† condition que quelqu'un veuille r√©p√©ter quelque chose comme √ßa. <br><br>  Tous les facteurs d√©crits ci-dessus et les gestionnaires bien-aim√©s et pressants nous ont pouss√©s √† √©crire un m√©canisme de jeu sans aucune architecture. <br><br><h2>  Description du jeu r√©sultant </h2><br>  La plupart du code a √©t√© compil√© dans les classes: MyGdxGame: <a href="https://libgdx.badlogicgames.com/ci/nightlies/docs/api/com/badlogic/gdx/Game.html">Game</a> , GameScreen: <a href="https://libgdx.badlogicgames.com/ci/nightlies/docs/api/com/badlogic/gdx/Screen.html">Screen</a> et TrafficGame: <a href="https://libgdx.badlogicgames.com/ci/nightlies/docs/api/com/badlogic/gdx/scenes/scene2d/Actor.html">Actor</a> . <br><br>  MyGdxGame - est le point d'entr√©e au d√©but du jeu, ici les param√®tres sont transf√©r√©s au constructeur sous forme de cha√Ænes.  GameScreen et les param√®tres de jeu sont √©galement cr√©√©s ici, qui sont transmis √† cette classe, mais sous une forme diff√©rente. <br><br>  GameScreen - cr√©e un acteur du jeu TrafficGame, l'ajoute √† la sc√®ne, lui passe les param√®tres d√©j√† mentionn√©s, et ¬´√©coute¬ª les clics de l'utilisateur sur l'√©cran et appelle les m√©thodes correspondantes de l'acteur TrafficGame. <br><br>  TrafficGame - l'acteur principal de la sc√®ne dans laquelle se d√©roule tout le mouvement du jeu: rendu et logique de travail. <br><br>  Bien que l'utilisation de <a href="https://github.com/libgdx/libgdx/wiki/Scene2d">scene2d</a> permette de construire des arbres d'imbrication d'acteurs, ce n'est pas la meilleure solution architecturale.  Cependant, pour impl√©menter un jeu UI / UX (sur LibGDX), scene2d est une excellente option. <br><br>  Dans notre cas, TrafficGame a une √©norme collection d'instances mixtes et toutes sortes d'indicateurs de comportement qui √©taient autoris√©s dans les m√©thodes avec de grandes constructions <i>lorsque</i> .  Un exemple: <br><br><pre><code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isGameActive: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(value) { backgroundActor?.isGameActive = value boostersMap.values.filterNotNull().forEach { it.isGameActive = value } obstaclesMap.values.filterNotNull().forEach { it.isGameActive = value } finishActor.isGameActive = value field = value } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> backgroundActoolbarActor <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pauseButtonActor: PauseButtonActor <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> finishActor: FinishActor <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isQuizWon = falser: BackgroundActor? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> playerCarActor: PlayerCarActor <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> toolbarActor: To <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pointsTime = <span class="hljs-number"><span class="hljs-number">0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> totalTimeElapsed = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> timeToFinishTheGame = <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastQuizBoosterTime = <span class="hljs-number"><span class="hljs-number">0.0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastBoosterTime = <span class="hljs-number"><span class="hljs-number">0.0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> boostersMap = hashMapOf&lt;<span class="hljs-built_in"><span class="hljs-built_in">Long</span></span>?, BoosterActor?&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boosterSpawnedCount = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> totalBoostersEatenCount = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> boosterLimit = <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastBoosterYPos = <span class="hljs-number"><span class="hljs-number">0.0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> toGenerateBooster = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastObstacleTime = <span class="hljs-number"><span class="hljs-number">0.0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obstaclesMap = hashMapOf&lt;<span class="hljs-built_in"><span class="hljs-built_in">Long</span></span>?, ObstacleActor?&gt;()</code> </pre> <br>  Naturellement, vous ne devriez pas √©crire comme √ßa.  Mais en d√©fense, je dirai que c'est arriv√© parce que: <br><br><ul><li>  Vous devez commencer maintenant, eh bien, et nous montrerons le TK final avec le design plus tard.  Classique </li><li>  Les architectures d√©j√† famili√®res (MVP / MVC / MVVM, etc.) ne conviennent pas √† la mise en ≈ìuvre du processus de jeu, car elles sont con√ßues uniquement pour l'interface utilisateur, dans le jeu tout se passe en temps r√©el. </li><li>  Initialement, le jeu semblait simple, mais en fait il n√©cessitait beaucoup de code, prenant en compte un grand nombre de nuances, dont la majeure partie a fait surface lors de l'√©criture du jeu. </li></ul><br><img src="https://habrastorage.org/webt/8e/cg/sn/8ecgsncl5hmmhmzw8unltjyqgh0.jpeg"><br><br>  En plus de toutes ces difficult√©s, il existe un autre probl√®me commun avec l'h√©ritage.  Si vous rendez un jeu plus difficile, par exemple un jeu de plateforme, alors la question se pose - "Comment r√©partir le code r√©utilisable entre les objets du jeu?".  L'option la plus couramment choisie est l'h√©ritage, o√π le code r√©utilisable est plac√© dans les classes parentes.  Mais cette solution cr√©e de nombreux probl√®mes si des conditions n'apparaissent pas dans l'arbre d'h√©ritage: <br><br><img src="https://habrastorage.org/webt/xg/tw/_6/xgtw_64w3v31if0kfnwoy9yemlg.png"><br><br>  Et ils r√©solvent g√©n√©ralement ces probl√®mes en r√©√©crivant la structure de l'arbre d'h√©ritage √† partir de z√©ro (enfin, cette fois, ce sera certainement mieux), ou les classes parentes sont cass√©es avec des b√©quilles. <br><br><img src="https://habrastorage.org/webt/af/8-/4o/af8-4ovkeruwatlo--agakilupm.gif"><br><br><h2>  ECS est notre tout </h2><br>  Une toute autre histoire est notre deuxi√®me jeu promo.  Elle √©tait comme <a href="https://ru.wikipedia.org/wiki/Flappy_Bird">Flappy Bird</a> , mais avec des diff√©rences: le personnage √©tait contr√¥l√© par la voix, et le plafond et le sol n'√©taient pas des obstacles - on pouvait glisser dessus. <br>  Un exemple de gameplay et √† titre de comparaison, le processus de jeu de Flappy Bird: <br><br><img src="https://habrastorage.org/webt/9k/sv/ao/9ksvaojzedwbnyd0nm602f2n90e.gif"><br><img src="https://habrastorage.org/webt/gr/sq/3t/grsq3twwn7aorv6utrvdvgnwldw.gif"><br><br>  Pour plus de clart√©, dans l'exemple, la cam√©ra est retir√©e pour voir les coulisses du jeu.  Le sol et le plafond sont des blocs carr√©s qui, atteignant le bord, sont r√©arrang√©s au d√©but, et les obstacles sont g√©n√©r√©s selon un motif donn√© qui vient de l'arri√®re.  Le design du jeu a √©t√© choisi par les clients, alors ne soyez pas surpris. <br><br>  J'aime le d√©veloppement de jeux pour appareils mobiles et pendant les heures creuses, pour des raisons d'exp√©rimentation, j'explorerai les sch√©mas de jeu et tout ce qui concerne le d√©veloppement de jeux.  J'ai lu un livre sur <a href="https://gameprogrammingpatterns.com/">les mod√®les de conception de jeux</a> , mais je n'ai pas compris quelle devrait √™tre la v√©ritable architecture de la logique de jeu, jusqu'√† ce que je tombe sur ECS. <br><br>  Entity Component System - le mod√®le de conception le plus souvent utilis√© dans le d√©veloppement de jeux.  L'id√©e principale du mod√®le est la <a href="https://en.wikipedia.org/wiki/Composition_over_inheritance">composition plut√¥t que l'h√©ritage</a> .  La composition vous permet de m√©langer diff√©rentes m√©caniques sur des objets de jeu, ce qui vous permettra √† l'avenir de d√©l√©guer la d√©finition des propri√©t√©s des objets √† un concepteur de jeu, par exemple, par le biais d'un constructeur √©crit.  Comme je connaissais d√©j√† ce mod√®le, nous avons d√©cid√© de l'appliquer dans le deuxi√®me match. <br><br>  Consid√©rez les composants du mod√®le: <br><br><ul><li>  <i>Composant</i> - objets avec une <b>structure de donn√©es simple qui</b> ne contient aucune logique ou qui agissent comme un raccourci.  Les composants sont divis√©s par objectif et d√©terminent toutes les propri√©t√©s des objets du jeu.  Vitesse, position, texture, corps, etc.  etc.  tout cela est d√©crit dans les composants puis ajout√© aux objets du jeu. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VelocityComponent</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Component { val velocity = Vector2</span></span></span></span>() }</code> </pre> </li><li>  <i>Entit√©</i> - objets de jeu: obstacles / boosters / h√©ros contr√¥l√©s et m√™me arri√®re-plan.  Ils n'ont pas de classes sp√©cialis√©es par type: UltraMegaSuperman: GameUnit, mais <b>sont</b> simplement des <b>conteneurs</b> pour l'ensemble de composants.  Le fait qu'une certaine entit√© soit ainsi UltraMegaSuperman d√©finit son ensemble de composants et leurs param√®tres. <br>  Par exemple, dans notre cas, le personnage principal avait les composants suivants: <br><br><ul><li>  TextureComponent - d√©finit ce qui doit √™tre dessin√© √† l'√©cran </li><li>  TransformComponent - la position de l'objet dans l'espace de jeu </li><li>  VelocityComponent - vitesse de l'objet dans l'espace de jeu </li><li>  HeroControllerComponent - contient des valeurs qui affectent le mouvement du h√©ros </li><li>  ImmortalityTimeComponent - contient le temps restant d'immortalit√© </li><li>  DynamicComponent - indique que l'objet n'est pas statique et est soumis √† la gravit√© </li><li>  BodyComponent - d√©finit le corps physique du h√©ros 2D n√©cessaire pour calculer les collisions </li></ul></li><li>  <i>Syst√®me</i> - contient le code de traitement des donn√©es des composants de chaque entit√©.  Ils <b>ne</b> doivent <b>pas stocker d'objets Entit√© et / ou Composant</b> , car cela contredirait le mod√®le.  Id√©alement, ils devraient √™tre propres du tout. <br><br>  Les syst√®mes font tout le sale boulot: dessinez tous les objets du jeu, d√©placez l'objet par sa vitesse, v√©rifiez les collisions, changez la vitesse √† partir du contr√¥le entrant, etc.  Par exemple, l'effet de la gravit√© ressemble √† ceci: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(entity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Entity</span></span></span></span><span class="hljs-function"><span class="hljs-params">, deltaTime: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { entity.getComponent(VelocityComponent::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">velocity</span></span></span><span class="hljs-class"> .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">add</span></span></span></span>(<span class="hljs-number"><span class="hljs-number">0f</span></span>, -GRAVITY * deltaTime) }</code> </pre> <br>  La sp√©cialisation de chaque syst√®me d√©termine les exigences pour les entit√©s qu'il doit traiter.  Autrement dit, dans l'exemple ci-dessus, l'entit√© doit avoir les composants de vitesse VelocityComponent et DynamicComponent pour que cette entit√© puisse √™tre trait√©e, sinon cette entit√© n'est pas int√©ressante pour le syst√®me, et donc pour les autres.  Pour dessiner une texture, par exemple, vous devez savoir ce qu'est la texture TextureComponent et o√π dessiner le TransformComponent.  Pour d√©terminer les exigences de chaque syst√®me, la famille est √©crite dans le constructeur dans lequel les classes de composants sont indiqu√©es. <br><br><pre> <code class="kotlin hljs">Family.all(TransformComponent::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TextureComponent::class.java).get</span></span></span></span>()</code> </pre> <br>  De plus, l'ordre des entit√©s de traitement dans le syst√®me peut √™tre ajust√© par un comparateur.  De plus, l'ordre d'ex√©cution des syst√®mes dans le moteur est √©galement r√©gul√© par la valeur de priorit√©. <br></li></ul><br>  Le moteur combine trois composants.  Il contient tous les syst√®mes et toutes les entit√©s du jeu.  Au d√©but du jeu, tous les syst√®mes n√©cessaires dans le jeu <br><br><pre> <code class="kotlin hljs">engine.apply { addSystem(ControlSystem()) addSystem(GravitySystem()) addSystem(renderingSystem) addSystem(MovementSystem()) addSystem(EnemyGeneratorSystem()) }</code> </pre>  ainsi que des entit√©s de d√©part sont ajout√©es au moteur, <br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hero: Entity = engine.createEntity() engine.addEntity(hero)</code> </pre> <br>  <a href="https://libgdx.badlogicgames.com/ci/ashley/docs/com/badlogic/ashley/core/PooledEngine.html">PooledEngine :: createEntity</a> - r√©cup√®re un objet entit√© du <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D1%2583%25D0%25BB">pool</a> , puisque les entit√©s peuvent √™tre cr√©√©es pendant le jeu, afin de ne pas salir la m√©moire.  Si n√©cessaire, ils sont extraits du pool d'objets et lorsqu'ils sont supprim√©s, ils sont replac√©s.  De m√™me pour les composants.  Lors de la r√©ception de composants du pool, il est n√©cessaire d'initialiser tous les champs, car ils peuvent contenir des informations sur l'utilisation pr√©c√©dente de ce composant. <br><br>  La relation entre les principales parties du mod√®le est pr√©sent√©e ci-dessous: <br><br><img src="https://habrastorage.org/webt/gk/tj/ak/gktjakst_gxpnuikd_bbgpnfv2a.png"><br><br>  Le moteur contient une collection de syst√®mes et une collection d'entit√©s.  Chaque syst√®me re√ßoit du moteur un lien vers une collection d'entit√©s, qui est une s√©lection de la collection g√©n√©rale en fonction des exigences du syst√®me; il sera mis √† jour pendant le jeu lorsque les entit√©s et les composants changent.  Chaque entit√© contient une collection de ses composants qui la d√©finissent dans le jeu. <br><br>  Le cycle de jeu est structur√© comme suit: <br><br><ol><li>  En utilisant l'impl√©mentation du mod√®le <a href="https://habr.com/ru/post/271315/">¬´Game Cycle¬ª</a> de LibGDX, dans la m√©thode de mise √† jour, nous obtenons son incr√©ment √† chaque pas de temps - deltaTime. </li><li>  Ensuite, nous passons le temps au moteur.  Et lui, √† son tour, it√®re √† travers le syst√®me dans un cycle, les distribue deltaTime. <pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until systems.size()) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> system = systems[i] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (system.checkProcessing()) { system.update(deltaTime) } }</code> </pre> </li><li>  Les syst√®mes recevant deltaTime trient leurs entit√©s et leur appliquent des modifications en tenant compte de deltaTime. <pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until entities.size()) { processEntity(entities[i], deltaTime) }</code> </pre> </li></ol><br>  Cela se produit √† chaque mesure du jeu. <br><br><h2>  Avantages sociaux chez ECS </h2><br><ol><li>  <b>Les donn√©es viennent en premier</b> .  √âtant donn√© que les syst√®mes ne traitent que les entit√©s qui leur conviennent, en l'absence de telles entit√©s, le syst√®me ne fera tout simplement rien, cela permet de tester et de d√©boguer de nouvelles fonctionnalit√©s, en cr√©ant uniquement les entit√©s n√©cessaires pour cela. <br><br>  Par exemple, vous avez cr√©√© le jeu "Tanks".  Apr√®s un certain temps, vous avez d√©cid√© d'ajouter un nouveau type de terrain - ¬´lave¬ª.  Si le char essaie de le traverser, il √©chouera.  Mais la technologie futuriste vient √† la rescousse, en installant que vous pouvez traverser la lave. <br><br>  Pour d√©boguer un tel cas, vous n'avez pas besoin de cr√©er des mod√®les complets de r√©servoirs et de construire des cartes compl√®tes avec des emplacements de lave suppl√©mentaires - il suffit de penser aux composants minimum n√©cessaires sur le r√©servoir et d'ajouter une entit√© au moteur de jeu pour tester.  Tout cela semble √©vident, mais en fait, vous rencontrez la classe TheTank qui, dans le constructeur, demande une liste de param√®tres: calibre, vitesse, sprite, vitesse de tir, noms d'√©quipage, etc.  bien que cela ne soit pas n√©cessaire pour tester les intersections de lave. <br></li><li>  En outre, en suivant l'exemple du paragraphe pr√©c√©dent, nous notons une <b>grande flexibilit√©</b> , car avec cette approche, il est beaucoup plus facile d'ajouter et de supprimer des fonctionnalit√©s. <br><br>  Un vrai exemple.  Le sc√©nario de jeu de notre deuxi√®me promo √©tait que l'utilisateur, apr√®s avoir ex√©cut√© la chanson pendant environ 2 minutes, s'est √©cras√© dans la ligne d'arriv√©e, et le jeu a recommenc√© le compte √† rebours en red√©marrant le niveau, mais avec des points de sauvegarde, donnant ainsi au joueur une pause. <br><br>  Quelques jours avant la sortie pr√©vue vient la t√¢che "de supprimer la ligne d'arriv√©e et de faire un rapport pendant une demi-heure de jeu continu avec des obstacles et des chansons en boucle".  Un changement global, mais c'√©tait tr√®s facile √† faire - il suffisait de supprimer l'essence de la ligne d'arriv√©e et d'ajouter un syst√®me de r√©f√©rence pour la fin de la partie. </li><li>  Tous les d√©veloppements sont <b>faciles √† tester</b> .  Sachant que les donn√©es en premier lieu, vous pouvez simuler tous les cas de test, les ex√©cuter et voir le r√©sultat. </li><li>  √Ä l'avenir, pour <b>valider l'√©tat du jeu</b> , vous pouvez connecter un serveur au processus de jeu.  Il ex√©cutera √† travers le m√™me code la m√™me entr√©e client et comparera son r√©sultat avec le r√©sultat sur le client.  Si les donn√©es ne convergent pas, alors le client est un tricheur ou nous avons des erreurs dans le jeu. </li></ol><br><br><h2>  ECS dans le grand monde de gamedev </h2><br>  Les grandes entreprises comme Unity, Epic ou Crytek utilisent ce mod√®le dans leurs cadres pour fournir aux d√©veloppeurs un outil avec une tonne de fonctionnalit√©s.  Je vous conseille de voir le rapport sur la fa√ßon dont la <a href="https://www.youtube.com/watch%3Fv%3D2Hi3GeCBpd0">logique de gameplay a √©t√©</a> impl√©ment√©e <a href="https://www.youtube.com/watch%3Fv%3D2Hi3GeCBpd0">dans Overwatch</a> <br><br>  Pour une meilleure compr√©hension, j'ai fait un petit <a href="https://github.com/AndrewMisterio/examples">exemple sur github</a> . <br>  Merci de votre attention! <br><br><h2>  √âgalement sur le sujet: </h2><br><ul><li>  <a href="https://habr.com/ru/post/343778/">Impl√©mentation et exemple du jeu</a> </li><li>  <a href="https://habr.com/ru/post/358108/">ECS et tout-tout</a> </li><li>  <a href="https://leopotam.com/2/">Bases ECS</a> </li><li>  <a href="https://fateev.pro/ru/gamedev/entity-component-system">Syst√®me de composants et d'entit√©s</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482374/">https://habr.com/ru/post/fr482374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482360/index.html">D√©tective Habra: ils sont amis avec les OVNIS</a></li>
<li><a href="../fr482364/index.html">Choses que vous [peut-√™tre] ne saviez pas sur Java</a></li>
<li><a href="../fr482366/index.html">Ce que les experts en robotique pensent du pilote automatique Tesla</a></li>
<li><a href="../fr482370/index.html">nodejs: gestionnaires de processus et modules ES6</a></li>
<li><a href="../fr482372/index.html">Activer le mode de session am√©lior√© pour les invit√©s Arch Linux dans Hyper-V</a></li>
<li><a href="../fr482378/index.html">Une br√®ve histoire de Wacom: comment la technologie des tablettes graphiques est arriv√©e aux lecteurs √©lectroniques</a></li>
<li><a href="../fr482384/index.html">Mon projet non r√©alis√©. R√©seau de 200 routeurs MikroTik</a></li>
<li><a href="../fr482386/index.html">Visual Studio pour Mac: prenez le contr√¥le de votre IDE avec les raccourcis clavier</a></li>
<li><a href="../fr482390/index.html">Tutoriel du tutoriel Ember.js. Application Super Rentals. Partie 1.2</a></li>
<li><a href="../fr482392/index.html">Astuces ELF dans Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>