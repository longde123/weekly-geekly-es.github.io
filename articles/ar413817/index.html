<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐ผ ๐คฏ ๐ค ูู ุงูููุช ุงูุญูููู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงูุชูุงูุณูุฉ ุบูุฑ ุงููุชุฌุงูุณุฉ ุจุฏูุฉ ๐จ๐ผโ๐ ใฐ๏ธ โ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุดุฑุญ 


 ุชุนุชุจุฑ ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูู ุงูููุช ุงููุนูู ุจุงูุถุจุท ูุฑุฉ ูุงุญุฏุฉ (ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท ) ูููุฉ ุบูุฑ ุชุงููุฉ ููุบุงูุฉ ูุชุชุทูุจ ููุฌูุง ุฌุงุฏูุง ููุฏุฑูุณูุง ุทูุงู ุณูุณูุฉ ุงูุญุณุงุจ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูู ุงูููุช ุงูุญูููู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงูุชูุงูุณูุฉ ุบูุฑ ุงููุชุฌุงูุณุฉ ุจุฏูุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413817/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/uf/mh/m-/ufmhm-q0wjfbdgbv4jn4ece8duw.jpeg" alt="ุณุฌู ุชูุงูุณู"></p><br><h2 id="annotaciya" style=";text-align:right;direction:rtl">  ุดุฑุญ </h2><br><p style=";text-align:right;direction:rtl">  ุชุนุชุจุฑ ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูู ุงูููุช ุงููุนูู ุจุงูุถุจุท ูุฑุฉ ูุงุญุฏุฉ (ูุฑุฉ ูุงุญุฏุฉ <em>ุจุงูุถุจุท</em> ) ูููุฉ ุบูุฑ ุชุงููุฉ ููุบุงูุฉ ูุชุชุทูุจ ููุฌูุง ุฌุงุฏูุง ููุฏุฑูุณูุง ุทูุงู ุณูุณูุฉ ุงูุญุณุงุจุงุช ุจุฃููููุง.  ูุนุชูุฏ ุงูุจุนุถ ุฃู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซู ูุฐู ุงููููุฉ ูุณุชุญููุฉ</a> .  ูู ุงููุงูุน ุ ุฃุฑูุฏ ุฃู ูููู ูุฏู ููุฌ ูููุฑ ูุนุงูุฌุฉ ูุชุณุงูุญุฉ ูุน ุงูุฃุฎุทุงุก ุฏูู ุฃู ุชุฃุฎูุฑ ุนูู ุงูุฅุทูุงู ูุงุณุชุฎุฏุงู ุชุฎุฒูู ูุฎุชูู ููุจูุงูุงุช ุ ูุงูุฐู ูุทุฑุญ ูุชุทูุจุงุช ุฌุฏูุฏุฉ ุฃูุซุฑ ุตุฑุงูุฉ ูููุธุงู: <em>ูุชุฒุงูู ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท</em> ูุนุฏู ุชุฌุงูุณ ุงูุทุจูุฉ ุงูุซุงุจุชุฉ.  ุญุชู ุงูุขู ุ ูุง ูุฏุนู ูุฐุง ุงููุทูุจ ุฃููุง ูู ุงูุฃูุธูุฉ ุงูููุฌูุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุณููุดู ุงูููุฌ ุงูููุชุฑุญ ุจุงุณุชูุฑุงุฑ ุนู ุงูููููุงุช ุงูุณุฑูุฉ ูุงูููุงููู ุงูุถุฑูุฑูุฉ ุงูุชู ุชุฌุนู ูู ุงูุณูู ูุณุจููุง ุชูููุฐ <em>ุงููุชุฒุงููุฉ</em> ุบูุฑ ุงููุชุฌุงูุณุฉ <em>ุจุงูุถุจุท ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท</em> ูู ูููููู ุญุฑููุง. </p><br><h2 id="vvedenie" style=";text-align:right;direction:rtl">  ููุฏูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ููุฑ ูุทูุฑ ุงูุฃูุธูุฉ ุงูููุฒุนุฉ ุจุนุฏุฉ ูุฑุงุญู: </p><br><p style=";text-align:right;direction:rtl">  <em>ุงููุฑุญูุฉ 1: ุงูุฎูุงุฑุฒููุงุช</em> .  ููุง ุฏุฑุงุณุฉ ุงูุฎูุงุฑุฒููุงุช ุงูุฃุณุงุณูุฉ ูููุงูู ุงูุจูุงูุงุช ูููุฌ ุงูุจุฑูุฌุฉ ูุซู OOP ููุง ุฅูู ุฐูู.  ุงูููุฏ ูุชุฑุงุจุท ุจุดูู ุญุตุฑู.  ุงููุฑุญูุฉ ุงูุฃููู ูู ุฏุฎูู ุงููููุฉ.  ููุน ุฐูู ุ ููู ูุนูุฏุฉ ููุบุงูุฉ ููููู ุฃู ุชุณุชูุฑ ูุณููุงุช. </p><br><p style=";text-align:right;direction:rtl">  <em>ุงููุฑุญูุฉ 2: multithreading</em> .  ุจุนุฏ ุฐูู ุ ุชุทุฑุญ ุฃุณุฆูุฉ ุญูู ุงุณุชุฎุฑุงุฌ ุฃูุตู ูุฏุฑ ูู ุงูููุงุกุฉ ูู ุงูุญุฏูุฏ ุ ูููุงู ุชุนุฏุฏ ูุคุดุฑุงุช ุ ูุนุฏู ุงูุชุฒุงูู ุ ูุงูุณุจุงู ุ ูุชุตุญูุญ ุงูุฃุฎุทุงุก ุ ูุงูุฑููุฏ ุ ูููุงูู ุจูุง ููู ... ูุชุนุซุฑ ุงููุซูุฑ ูู ูุฐู ุงููุฑุญูุฉ ูุญุชู ูุจุฏุฃ ูู ุงูุชูุงุท ุฅุซุงุฑุฉ ูุง ูููู ุชูุณูุฑูุง ูู ูุฑุญูุฉ ูุง.  ููู ููุฉ ููููุฉ ููุท ูููุช ุจููุฉ ุงูุฐุงูุฑุฉ ุงูุงูุชุฑุงุถูุฉ ูููุงุฐุฌ ุงูุฐุงูุฑุฉ ุ ูุงูุฎูุงุฑุฒููุงุช ุงูุฎุงููุฉ ูู ุงูููู / ุงูุงูุชุธุงุฑ ุ ูุงูููุงุฐุฌ ุงููุฎุชููุฉ ุบูุฑ ุงููุชุฒุงููุฉ.  ูุชูุฑูุจุง ูุง ุฃุญุฏ ุนูู ุงูุฅุทูุงู - ุงูุชุญูู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุชุนุฏุฏุฉ ุงูุฎููุท. </p><br><p style=";text-align:right;direction:rtl">  <em>ุงููุฑุญูุฉ 3: ุงูุชูุฒูุน</em> .  ููุง ูุญุฏุซ ูุซู ูุฐู ุงูููุงูุฉ ูุง ูู ุญูุงูุฉ ุฎุฑุงููุฉ ููุง ููู ููุตู. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุฃู ุดูุฆูุง ูุนูุฏูุง.  ูููู ุจุงูุชุญููู: ุงูุนุฏูุฏ ูู ุงูุฎููุท -&gt; ุงูุนุฏูุฏ ูู ุงูุนูููุงุช -&gt; ุงูุนุฏูุฏ ูู ุงูุฎูุงุฏู.  ููู ูู ุฎุทูุฉ ูู ุฎุทูุงุช ุงูุชุญูู ุชุญุฏุซ ุชุบููุฑุงุช ููุนูุฉ ุ ููููุง ุชูุน ุนูู ุงููุธุงู ุ ูุชุณุญูู ูุชุญููู ุฅูู ุบุจุงุฑ. </p><br><p style=";text-align:right;direction:rtl">  ูุงูููุทุฉ ููุง ูู ุชุบููุฑ ูุฌุงู ูุนุงูุฌุฉ ุงูุฎุทุฃ ูุชูุงูุฑ ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ.  ุฅุฐุง ูุงู ููุงู ุฏุงุฆููุง ุฌุฒุก ูู ุงูุฐุงูุฑุฉ ูุงู ูุชุงุญูุง ูู ูู ุฎูุท ุ ูุฅุฐุง ุฑุบุจุช ูู ุฐูู ุ ูู ูู ุนูููุฉ ุ ุงูุขู ูุง ุชูุฌุฏ ูุซู ูุฐู ุงููุทุนุฉ ููุง ูููู ุฃู ุชููู.  ูู ูููุณู ููุณุชูู ููุฎูุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ุงููุดู ูู ุงูุฏูู ูู ููุช ุณุงุจู ูุฏ ุฏูู ุงูุฏูู ูุงูุนูููุฉ ูู ููุณ ุงูููุช ุ ููุงู ูุฐุง ุฌูุฏูุง ุ ูุฃูู  ูู ูุคุฏ ุฅูู ูุดู ุฌุฒุฆู ุ ูุงูุขู ุฃุตุจุญ ุงููุดู ุงูุฌุฒุฆู ูู ุงููุงุนุฏุฉ ููู ูู ูุฑุฉ ูุจู ูู ุนูู ุชููุฑ ููู: "ูุงุฐุง ููุ".  ูุฐุง ูุฒุนุฌ ููุบุงูุฉ ููุดุชุช ุงูุงูุชุจุงู ุนู ุงููุชุงุจุฉ ุ ูู ุงููุงูุน ุ ุงูุฅุฌุฑุงุกุงุช ููุณูุง ุงูุชู ูููู ุจูุง ุงูุฑูุฒ ุจุณุจุจ ูุฐุง ููุณ ูู ุจุนุถ ุงูุฃุญูุงู ุ ูููู ุจุฃูุงูุฑ ูู ุงูุญุฌู.  ูู ุดูุก ูุชุญูู ุฅูู ุดุนูุฑูุฉ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุ ูุชุจุฏูู ุงูุญุงูุฉ ูุงูุญูุงุธ ุนูู ุงูุณูุงู ุ ูุงูุชุฑููู ุจุณุจุจ ูุดู ุฃุญุฏ ุงูููููุงุช ุ ููููู ุขุฎุฑ ุ ูุนุฏู ุฅููุงููุฉ ุงููุตูู ุฅูู ุจุนุถ ุงูุฎุฏูุงุช ุ ุฅูุฎ.  ุงูุฎ.  ุจุนุฏ ุฃู ุฃุฎุทุฃุช ูุฑุงูุจุฉ ูู ูุฐู ุงูุฃุดูุงุก ุ ููููู ุงูุญุตูู ุนูู ููู ูููุฆ ุนูู ุฌูุงุฒ ุงูููุจููุชุฑ ุงููุญููู ุงูููุถู ูุฏูู. </p><br><p style=";text-align:right;direction:rtl">  ุณูุงุก ูุงูุช ูุณุฃูุฉ ุชุนุฏุฏ ุงูููุงุถูุน: ููุฏ ุฃุฎุฐุช ูุงุฆู ุงููุฒุงููุฉ ูุฐูุจุช ูุชูุฒูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ูู ุฃุฌู ุงููุชุนุฉ.  ุฌูุงู! </p><br><p style=";text-align:right;direction:rtl">  ููุชูุฌุฉ ูุฐูู ุ ูุฏููุง ุฃู ุงูุฃููุงุท ุงูุฑุฆูุณูุฉ ูุงุฎุชุจุงุฑ ุงููุนุงุฑู ูุฏ ุชู ุณุญุจูุง ุ ูุฃู ุงูุฃููุงุท ุงูุฌุฏูุฏุฉ ุ ูุชุญู ูุญููุง ุ ูุณุจุจ ูุง ูู ูุชู ุชุณููููุง ุ ูุงุชุถุญ ุงูุฃูุฑ ููุง ูู ูุงู ููุชุฉ ุญูู ููู ุชููุญ ุงูุฌููุฉ ุจุนุตุงูุง ูุณูุท ุงูุจุฑุฌ ูู ุงูุฏุจุงุจุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ูุฅู ุงูุฃูุธูุฉ ุงูููุฒุนุฉ ูุฏููุง ูุฌููุนุฉ ูู ุงูููุงุฑุณุงุช ุงููุซุจุชุฉ ูุงูุฎูุงุฑุฒููุงุช ุงููุซุจุชุฉ.  ููุน ุฐูู ุ ูุนุชุจุฑ ูู ูุจุฑูุฌ ูุญุชุฑู ููุณู ุฃูู ูู ูุงุฌุจู ุฑูุถ ุงูุฅูุฌุงุฒุงุช ุงููุนุฑููุฉ ูุฏุฑุงุฌุฉ ูุตูุญุชู ุ ุนูู ุงูุฑุบู ูู ุงูุฎุจุฑุฉ ุงูููุชุณุจุฉ ุ ุนุฏุฏ ูุจูุฑ ูู ุงูููุงูุงุช ุงูุนูููุฉ ูุงูุจุญุซ ุงูุฃูุงุฏููู.  ุจุนุฏ ูู ุดูุก ุ ุฅุฐุง ุงุณุชุทุนุช ุงูุฏุฎูู ุฅูู ุงูุฎูุงุฑุฒููุงุช ูุงูุชุนุฏุฏูุฉ ุ ููู ููููู ุงูุฏุฎูู ูู ููุถู ูุน ุงูุชูุฒูุนุ  ูุง ูููู ุฃู ูููู ููุงู ุฑุฃููู ููุง! </p><br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉ ูุฐูู ุ ุงูุฃูุธูุฉ ูู ุนุฑุจุงุช ุงูุชู ุชุฌุฑูุง ุงูุฏูุงุจ ุ ุชุชุจุงุนุฏ ุงูุจูุงูุงุช ูุชุชุฏููุฑ ุ ุชุตุจุญ ุงูุฎุฏูุงุช ุบูุฑ ูุชููุฑุฉ ุจุดูู ุฏูุฑู ูููุชุงุจุฉ ุ ุฃู ุญุชู ุบูุฑ ูุชุงุญุฉ ุชูุงููุง ุ ูุฃูู ูุฌุฃุฉ ุชุนุทูุช ุงูุนูุฏุฉ ุ ุชุนุทูุช ุงูุดุจูุฉ ุ ุงุณุชูููุช Java ุงููุซูุฑ ูู ุงูุฐุงูุฑุฉ ู GC ูููุฉ ุ ูููุงู ุงูุนุฏูุฏ ูู ุงูุฃุณุจุงุจ ุงูุฃุฎุฑู ุงูุชู ูููู ุฃู ุชุคุฎุฑ ููุงูุชูุง ููุณูุทุงุช. </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ุญุชู ูุน ุงูููุฌ ุงููุนุฑููุฉ ูุงููุซุจุชุฉ ุ ูุง ุชุตุจุญ ุงูุญูุงุฉ ุฃุณูู ุ ูุฃู  ุงูุจุฏุงุฆูุฉ ุงูููุซููุฉ ุงูููุฒุนุฉ ูู ุงููุฒู ุงูุซููู ูุน ูุชุทูุจุงุช ุฎุทูุฑุฉ ูููุทู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุงุจูุฉ ููุชูููุฐ.  ูุฐูู ุ ูุชู ูุทุน ุงูุฒูุงูุง ูููุง ุฃููู ุฐูู.  ูููุง ูุญุฏุซ ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุ ูุน ูุทุน ุงูุฒูุงูุง ุนูู ุนุฌู ุ ุชุธูุฑ ุงูุจุณุงุทุฉ ููุงุจููุฉ ุงูุชูุณุน ุงููุณุจูุฉ ุ ูููู ููุซูููุฉ ูุชูุงูุฑ ูุงุชุณุงู ุงููุธุงู ุงูููุฒุน ูุฎุชูู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงุญูุฉ ุงููุซุงููุฉ ุ ูุง ุฃูุฏ ุฃู ุฃููุฑ ุนูู ุงูุฅุทูุงู ูู ุฃู ูุธุงููุง ููุฒุน ููุชุนุฏุฏ ุงูููุงุถูุน ุ ุฃู  ุงูุนูู ูู ุงููุฑุญูุฉ ุงูุฃููู (ุงูุฎูุงุฑุฒููุงุช) ุ ุฏูู ุงูุชูููุฑ ูู ุงููุฑุญูุฉ ุงูุซุงููุฉ (ุชุฒุงูู ูุชุนุฏุฏ + ุงูุชุฒุงูู) ูุงูุซุงูุซุฉ (ุงูุชูุฒูุน).  ูุฐู ุงูุทุฑููุฉ ูุนุฒู ุงูุชุฌุฑูุฏ ูู ุดุฃููุง ุฃู ุชุฒูุฏ ุจุดูู ูุจูุฑ ูู ุงูุจุณุงุทุฉ ูุงูููุซูููุฉ ูุณุฑุนุฉ ูุชุงุจุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ.  ูุณูุก ุงูุญุธ ุ ูู ุงูููุช ุงูุญุงูู ูุฐุง ูููู ููุท ูู ุงูุฃุญูุงู. </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ูุฅู ุงูุชุฌุฑูุฏ ุงููุฑุฏู ูุณูุญ ุจุงูุนุฒูุฉ ุงููุณุจูุฉ.  ุฃุญุฏ ุงูุฃูุซูุฉ ุงููููุฐุฌูุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงุณุชุฎุฏุงู coroutines</a> ุ ุญูุซ ุจุฏูุงู ูู ุงูุฑูุฒ ุบูุฑ ุงููุชุฒุงูู ูุญุตู ุนูู ูุชุฒุงูู ุ ุฃู  ููุชูู ูู ุงููุฑุญูุฉ ุงูุซุงููุฉ ุฅูู ุงููุฑุญูุฉ ุงูุฃููู ุ ููุง ูุณูุญ ููุง ุจุชุจุณูุท ูุชุงุจุฉ ุงูุฑูุฒ ูุงูุญูุงุธ ุนููู ุจุดูู ูุจูุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุชูุดู ุงูููุงูุฉ ุนูู ุงูุชูุงูู ุนู ุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุงุช ุฎุงููุฉ ูู ุงูููู ูุฅูุดุงุก ูุธุงู ูู ุงูููุช ุงูุญูููู ูุงุจู ููุชูุฒูุน ูููุฒุน ููุซูู ุจู ููุชูุงุณู ุ ุฃู  ููู ุชุณุงุนุฏ ุงูุฅูุฌุงุฒุงุช ุจุฏูู ููู ูููุฑุญูุฉ ุงูุซุงููุฉ ูู ุชูููุฐ ุงููุฑุญูุฉ ุงูุซุงูุซุฉ ุ ููุง ูููู ูู ุงููููุฉ ุฅูู ุฎูุงุฑุฒููุงุช ููุฑุฏุฉ ุงูุฎููุท ูููุฑุญูุฉ ุงูุฃููู. </p><br><h2 id="postanovka-zadachi" style=";text-align:right;direction:rtl">  ุจูุงู ุงููุดููุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุชูุถุญ ูุฐู ุงููููุฉ ููุท ุจุนุถ ุงูุฃุณุงููุจ ุงููุงูุฉ ููุชู ุชูุฏูููุง ููุซุงู ูุฅุฏุฎุงู ุงููุดููุงุช ูู ุงูุณูุงู.  ูููู ุชุนูููู ุจุณูููุฉ ุนูู ุงูุญุงูุงุช ุงูุฃูุซุฑ ุชุนููุฏูุง ุ ูุงูุชู ุณูุชู ุฅุฌุฑุงุคูุง ูู ุงููุณุชูุจู. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงููููุฉ: ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุชุฏููุฉ ูู ุงูููุช ุงููุนูู</strong> . </p><br><p style=";text-align:right;direction:rtl">  ููุงู ููุนุงู ูู ุชูุงุฑุงุช ุงูุฃุฑูุงู.  ููุฑุฃ ุงููุนุงูุฌ ุจูุงูุงุช ุชุฏููุงุช ุงูุฅุฏุฎุงู ูุฐู ููุญุฏุฏ ุงูุฃุฑูุงู ุงูุฃุฎูุฑุฉ ููุชุฑุฉ ูุนููุฉ.  ูุชู ุญุณุงุจ ูุชูุณุท โโูุฐู ุงูุฃุฑูุงู ุฎูุงู ูุฐู ุงููุชุฑุฉ ุงูุฒูููุฉ ุ ุฃู  ูู ูุงูุฐุฉ ุจูุงูุงุช ููุฒููุฉ ูููุช ูุนูู.  ูุฌุจ ูุชุงุจุฉ ูุชูุณุท โโุงููููุฉ ุงูุชู ุชู ุงูุญุตูู ุนูููุง ุฅูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุฅุฎุฑุงุฌ ูููุนุงูุฌุฉ ุงููุงุญูุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุฅุฐุง ุชุฌุงูุฒ ุนุฏุฏ ุงูุฃุฑูุงู ูู ุงููุงูุฐุฉ ุนุชุจุฉ ูุนููุฉ ุ ููู ุจุฒูุงุฏุฉ ุงูุนุฏุงุฏ ูู ูุงุนุฏุฉ ุจูุงูุงุช ุงููุนุงููุงุช ุงูุฎุงุฑุฌูุฉ ุจููุฏุงุฑ ูุงุญุฏ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nf/9d/jh/nf9djhbhsjmrumrg5eckb1h6u_c.png" alt="ุงูุฃููู"></p><br><p style=";text-align:right;direction:rtl">  ููุงุญุธ ุจุนุถ ููุฒุงุช ูุฐู ุงููุดููุฉ. </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <em>ุงููุง ุญุชููุฉ</em> .  ููุงู ูุตุฏุฑุงู ููุณููู ุบูุฑ ุงููุทุนู: ูุฐู ูุฑุงุกุฉ ูู ุชูุงุฑูู ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุงูุฐุฉ ุฒูููุฉ.  ูู ุงููุงุถุญ ุฃูู ูููู ุฅุฌุฑุงุก ุงููุฑุงุกุฉ ุจุทุฑู ูุฎุชููุฉ ุ ูุณุชุนุชูุฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ ุนูู ุชุณูุณู ุงูุจูุงูุงุช ุงูุชู ุณูุชู ุงุณุชุฎุฑุงุฌูุง.  ุชุบูุฑ ุงููุงูุฐุฉ ุงูุฒูููุฉ ุงููุชูุฌุฉ ุฃูุถูุง ูู ุงูุจุฏุงูุฉ ุฅูู ุงูุจุฏุงูุฉ ุ ูุซู  ูููุฉ ุงูุจูุงูุงุช ูู ุงููุงูุฐุฉ ุชุนุชูุฏ ุนูู ุณุฑุนุฉ ุงูุนูู. </li><li style=";text-align:right;direction:rtl">  <em>ุญุงูุฉ ุงููุนุงูุฌ</em> .  ุชูุฌุฏ ุญุงูุฉ ุงููุนุงูุฌ ูู ุดูู ูุฌููุนุฉ ูู ุงูุฃุฑูุงู ูู ุงููุงูุฐุฉ ุ ูุงูุชู ุชุนุชูุฏ ุนูููุง ูุชุงุฆุฌ ุงูุนูู ุงูุญุงููุฉ ูุงููุงุญูุฉ.  ุนูู ุณุจูู ุงููุซุงู  ูุฏููุง ูุนุงูุฌ ุฑุณูู. </li><li style=";text-align:right;direction:rtl">  <em>ุงูุชูุงุนู ูุน ุงูุชุฎุฒูู ุงูุฎุงุฑุฌู</em> .  ูู ุงูุถุฑูุฑู ุชุญุฏูุซ ูููุฉ ุงูุนุฏุงุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฎุงุฑุฌูุฉ.  ุงูููุทุฉ ุงูุญุงุณูุฉ ูู ุฃู ููุน ุงูุชุฎุฒูู ุงูุฎุงุฑุฌู ูุฎุชูู ุนู ุชุฎุฒูู ุญุงูุฉ ุงููุนุงูุฌ ูุงูุฎููุท. </li></ol><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุ ููุง ูู ููุถุญ ุฃุฏูุงู ุ ูุคุซุฑ ุจุดูู ุฎุทูุฑ ุนูู ุงูุฃุฏูุงุช ุงููุณุชุฎุฏูุฉ ูุทุฑู ุงูุชูููุฐ ุงูููููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุจูู ุฅุถุงูุฉ ููุณุฉ ุตุบูุฑุฉ ุฅูู ุงููููุฉ ุ ุงูุชู ุชููู ุงููููุฉ ุนูู ุงูููุฑ ูู ููุทูุฉ ุชุชุฌุงูุฒ ุงูุชุนููุฏ ุฅูู ูุณุชุญูู: ููุงู ุญุงุฌุฉ ุฅูู ุถูุงู <em>ูุชุฒุงูู ููุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท</em> . </p><br><h2 id="exactly-once" style=";text-align:right;direction:rtl">  ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท </h2><br><p style=";text-align:right;direction:rtl">  ุบุงูุจูุง ูุง <em>ูุชู</em> ุชูุณูุฑู <em>ูุฑุฉ ูุงุญุฏุฉ ุนูู</em> ูุทุงู ูุงุณุน ุฌุฏูุง ุ ููุง ูุนูู ุงููุตุทูุญ ููุณู ุ ููุชููู ุนู ุชูุจูุฉ ุงููุชุทูุจุงุช ุงูุฃุตููุฉ ูููููุฉ.  ุฅุฐุง ููุง ูุชุญุฏุซ ุนู ูุธุงู ูุนูู ูุญูููุง ุนูู ุฌูุงุฒ ููุจููุชุฑ ูุงุญุฏ - ูุฅู ูู ุดูุก ุจุณูุท: ุฎุฐ ุงููุฒูุฏ ุ ูุฑูู ุฃุจุนุฏ.  ููู ูู ูุฐู ุงูุญุงูุฉ ูุชุญุฏุซ ุนู ูุธุงู ููุฒุน: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููู ุฃู ูููู ุนุฏุฏ ุงููุนุงูุฌุงุช ูุจูุฑูุง: ูุนูู ูู ูุนุงูุฌ ูุน ูุทุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู.  ุนูุงูุฉ ุนูู ุฐูู ุ ูููู ุฅุถุงูุฉ ุงููุชุงุฆุฌ ุฅูู ุฃูุงูู ูุฎุชููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุงุนุฏุฉ ุจูุงูุงุช ุฎุงุฑุฌูุฉ ุ ุฑุจูุง ุญุชู ูุชู ุชุจุฏูููุง. </li><li style=";text-align:right;direction:rtl">  ูููู ููู ูุนุงูุฌ ุฅููุงู ุงููุนุงูุฌุฉ ูุฌุฃุฉ.  ูุดูุฑ ุงููุธุงู ุงููุชุณุงูุญ ูุน ุงูุฎุทุฃ ุฅูู ุงุณุชูุฑุงุฑ ุงูุชุดุบูู ุญุชู ูู ุญุงูุฉ ูุดู ุงูุฃุฌุฒุงุก ุงููุฑุฏูุฉ ูู ุงููุธุงู. </li></ol><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ูุฌุจ ุฃู ูููู ูุณุชุนุฏูู ูุญูููุฉ ุฃู ุงููุนุงูุฌ ูุฏ ููุน ุ ููุฌุจ ุฃู ููุชูุท ูุนุงูุฌ ุขุฎุฑ ุงูุนูู ุงูููุฌุฒ ุจุงููุนู ูููุงุตูุฉ ุงููุนุงูุฌุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุทุฑุญ ุงูุณุคุงู ุนูู ุงูููุฑ: ูุง <em>ุงูุฐู</em> ุณูุนูู <em>ุจุงูุถุจุท ูุฑุฉ ูุงุญุฏุฉ</em> ุฅุฐุง ูุงู ุงููุนุงูุฌ ุบูุฑ ุงููุทุนู ูุนููุ  ุจุนุฏ ูู ุดูุก ุ ูู ูู ูุฑุฉ ูุนูุฏ ูููุง ุงูุนูู ุ ุณูู ูุชููู ุ ุจุดูู ุนุงู ุ ุญุงูุงุช ูุฎุชููุฉ ูุฎุชููุฉ.  ุงูุฌูุงุจ ููุง ุจุณูุท: ูุน <em>ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท ุ</em> ููุงู ุชูููุฐ ูููุธุงู ูุชู ููู ูุนุงูุฌุฉ ูู ูููุฉ ุฅุฏุฎุงู ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท ุ ููุง ูุนุทู ูุชูุฌุฉ ุงูุฅุฎุฑุงุฌ ุงูููุงุจูุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุง ูุฌุจ ุฃู ูููู ูุฐุง ุงูุชูููุฐ ุฌุณุฏููุง ุนูู ููุณ ุงูุนูุฏุฉ.  ูููู ูุฌุจ ุฃู ุชููู ุงููุชูุฌุฉ ููุง ูู ุชู ูุนุงูุฌุฉ ูู ุดูุก ุนูู ุนูุฏุฉ ููุทููุฉ ูุงุญุฏุฉ <em>ุจุฏูู ุฃุนุทุงู</em> . </p><br><h2 id="concurrent-exactly-once" style=";text-align:right;direction:rtl">  ูุชุฒุงูู ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท </h2><br><p style=";text-align:right;direction:rtl">  ูุชูุงูู ุงููุชุทูุจุงุช ุ ููุฏู ููููููุง ุฌุฏูุฏูุง: <em>ูุชุฒุงูู ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท</em> .  ุงูุงุฎุชูุงู ุงูุฃุณุงุณู ุนู ุงูุจุณูุท <em>ููุฑุฉ ูุงุญุฏุฉ</em> ูู ุนุฏู ูุฌูุฏ ูุชุฑุงุช ุชููู ูุคูุช ุฃุซูุงุก ุงููุนุงูุฌุฉ ุ ููุง ูู ุชู ูุนุงูุฌุฉ ูู ุดูุก ุนูู ููุณ ุงูุนูุฏุฉ <strong>ุจุฏูู ูุทุฑุงุช</strong> <strong>ูุจุฏูู ุชูููุงุช</strong> .  ูู ูููุชูุง ุ ุณูุทูุจ <em>ูุชุฒุงููุฉ ุชูุงููุง ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท</em> ุ ูู ุฃุฌู ุจุณุงุทุฉ ุงูุนุฑุถ ุ ุญุชู ูุง ูููุฑ ูู ููุงุฑูุฉ ูุน ุงูุฃูุธูุฉ ุงูุญุงููุฉ ุบูุฑ ุงููุชููุฑุฉ ุงูููู. </p><br><p style=";text-align:right;direction:rtl">  ุณุชุชู ููุงูุดุฉ ูุชุงุฆุฌ ูุซู ูุฐุง ุงูุดุฑุท ุฃุฏูุงู. </p><br><h2 id="tranzakcionnost" style=";text-align:right;direction:rtl">  ุงููุนุงููุงุช </h2><br><p style=";text-align:right;direction:rtl">  ุญุชู ูููู ุงููุงุฑุฆ ูุดุจุนูุง ุจุนูู ุฃูุจุฑ ุจุงูุชุนููุฏ ุงูุฐู ูุดุฃ ุ ูููููู ูุธุฑุฉ ุนูู ุณููุงุฑูููุงุช ุณูุฆุฉ ูุฎุชููุฉ ูุฌุจ ุฃุฎุฐูุง ูู ุงูุงุนุชุจุงุฑ ุนูุฏ ุชุทููุฑ ูุซู ูุฐุง ุงููุธุงู.  ุณูุญุงูู ุฃูุถูุง ุงุณุชุฎุฏุงู ููุฌ ุนุงู ูุณูุญ ููุง ุจุญู ุงููุดููุฉ ุงููุฐููุฑุฉ ุฃุนูุงู ูุน ูุฑุงุนุงุฉ ูุชุทูุจุงุชูุง. </p><br><p style=";text-align:right;direction:rtl">  ุฃูู ูุง ูุชุจุงุฏุฑ ุฅูู ุงูุฐูู ูู ุงูุญุงุฌุฉ ุฅูู ุชุณุฌูู ุญุงูุฉ ุงููุนุงูุฌ ูุชุฏูู ุงูุฅุฏุฎุงู ูุงูุฅุฎุฑุงุฌ.  ูุชู ูุตู ุญุงูุฉ ุชุฏููุงุช ุงูุฅุฎุฑุงุฌ ุจูุงุฆูุฉ ุงูุชุธุงุฑ ุจุณูุทุฉ ูู ุงูุฃุฑูุงู ุ ูุญุงูุฉ ุชุฏููุงุช ุงูุฅุฏุฎุงู ุญุณุจ ุงูููุถุน ุงูููุฌูุฏ ูููุง.  ูู ุฌููุฑู ุ ูุนุฏ ุงูุฏูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุบูุฑ ูุญุฏูุฏุฉ ุ ููุนูู ุงูููุถุน ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูููุนูุง ูุฑูุฏูุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/iu/h0/pf/iuh0pfzcezje80kdbsv3idyeu9a.jpeg" alt="ููุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ููุดุฃ ุงูุชูููุฐ ุงูุณุงุฐุฌ ุงูุชุงูู ูููุนุงูุฌ ุจุงุณุชุฎุฏุงู ููุน ูู ูุณุชูุฏุน ุงูุจูุงูุงุช.  ูู ูุฐู ุงููุฑุญูุฉ ุ ูู ุชููู ุงูุฎุตุงุฆุต ุงููุญุฏุฏุฉ ูููุณุชูุฏุน ูููุฉ ุจุงููุณุจุฉ ููุง.  ุณูุณุชุฎุฏู ูุบุฉ Pseco ูุชูุถูุญ ุงูููุฑุฉ (Pseco: = pseudo code): </p><br><pre style=";text-align:right;direction:rtl"><code class="hljs pgsql">handle(input_queues, output_queues, state): #    input_indexes = <span class="hljs-keyword"><span class="hljs-keyword">storage</span></span>.get_input_indexes() #      <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>: #         items, new_input_indexes = input_queues.get_from(input_indexes) #    state.queue.push(items) #     duration state.queue.trim_time_window(duration) avg = state.queue.avg() need_update_counter = state.queue.size() &gt; size_boundary # (A)      output_queues[<span class="hljs-number"><span class="hljs-number">0</span></span>].push(avg) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> need_update_counter: # (B)      db.increment_counter() # (C)     <span class="hljs-keyword"><span class="hljs-keyword">storage</span></span>.save_state(state) # (D)    <span class="hljs-keyword"><span class="hljs-keyword">storage</span></span>.save_queue_indexes(new_input_indexes) # (E)    input_indexes = new_input_indexes</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููุง ููู ุฎูุงุฑุฒููุฉ ุจุณูุทุฉ ููุฑุฏุฉ ุงูุฎููุท ุชูุฑุฃ ุงูุจูุงูุงุช ูู ุชุฏููุงุช ุงูุฅุฏุฎุงู ูุชูุชุจ ุงูููู ุงููุทููุจุฉ ููููุง ูููููุฉ ุงูููุถุญุฉ ุฃุนูุงู. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูุฑู ูุง ูุญุฏุซ ูู ุญุงูุฉ ุณููุท ุงูุนูุฏุฉ ูู ููุงุท ุนุดูุงุฆูุฉ ูู ุงูููุช ุงูููุงุณุจ ุ ููุฐูู ุจุนุฏ ุงุณุชุฆูุงู ุงูุนูู.  ูู ุงููุงุถุญ ุฃูู ูู ุญุงูุฉ ุงูุณููุท ูู ุงูููุทุชูู <code>(A)</code> ู <code>(E)</code> ุณูููู ูู ุดูุก ุนูู ูุง ูุฑุงู: ุฅูุง ุฃู ุงูุจูุงูุงุช ูู ูุชู ุชุณุฌูููุง ูู ุฃู ููุงู ุญุชู ุงูุขู ููุณุชุนูุฏ ุงูุญุงูุฉ ุจุจุณุงุทุฉ ููุณุชูุฑ ูู ุงูุนูุฏุฉ ุงูุฃุฎุฑู ุ ุฃู ุชู ุชุณุฌูู ุฌููุน ุงูุจูุงูุงุช ุงูุถุฑูุฑูุฉ ุจุงููุนู ููุณุชูุฑ ูู ุงูุฎุทูุฉ ุงูุชุงููุฉ ููุท. </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ูู ุญุงูุฉ ุงูุณููุท ูู ุฌููุน ุงูููุงุท ุงูุฃุฎุฑู ุ ุชูุชุธุฑูุง ูุดุงูู ุบูุฑ ูุชููุนุฉ.  ุฅุฐุง ุญุฏุซ ุงูุฎูุงุถ ุนูุฏ ุงูููุทุฉ <code>(B)</code> ุ ูุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงููุนุงูุฌ ุ ุณูุณุชุนูุฏ ุงูุญุงูุฉ ููุนูุฏ ุชุณุฌูู ูุชูุณุท โโุงููููุฉ ูู ููุณ ูุทุงู ุงูุฃุฑูุงู ุชูุฑูุจูุง.  ูู ุญุงูุฉ ุงูุณููุท ุนูุฏ ุงูููุทุฉ <code>(C)</code> ุจุงูุฅุถุงูุฉ ุฅูู ูุชูุณุท โโุงูุชูุฑุงุฑ ุ ุณูุญุฏุซ ุชูุฑุงุฑ ูู ุฒูุงุฏุฉ ุงููููุฉ.  ููู ุญุงูุฉ ุญุฏูุซ ุงูุฎูุงุถ ูู <code>(D)</code> ุณูุญุตู ุนูู ุญุงูุฉ ุบูุฑ ูุชูุงุณูุฉ ูููุนุงูุฌ: ุชุชูุงูู ุงูุญุงูุฉ ูุน ูุญุธุฉ ุฌุฏูุฏุฉ ูู ุงูููุช ุงูููุงุณุจ ุ ูุณููุฑุฃ ุงูููู ูู ุชุฏููุงุช ุงูุฅุฏุฎุงู ุงููุฏููุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/fn/8z/6f/fn8z6f9t3y-fe2hzlepgnie7qps.jpeg" alt="ููุงุฌุขุช"></p><br><p style=";text-align:right;direction:rtl">  ูู ุงูููุช ููุณู ุ ูู ูุชุบูุฑ ุดูุก ุฌููุฑููุง ุนูุฏ ุฅุนุงุฏุฉ ุชุฑุชูุจ ุนูููุงุช ุงูุชุณุฌูู: ุณูุจูู ุนุฏู ุงูุงุชุณุงู ูุงูุชูุฑุงุฑ ูุฐูู.  ูุจุงูุชุงูู ุ ูุตู ุฅูู ุงุณุชูุชุงุฌ ููุงุฏู ุฃู ุฌููุน ุงูุฅุฌุฑุงุกุงุช ูุชุบููุฑ ุญุงูุฉ ุงููุนุงูุฌ ูู ุงููุณุชูุฏุน ููุงุฆูุฉ ุงูุชุธุงุฑ ุงูุฅุฎุฑุงุฌ ููุงุนุฏุฉ ุงูุจูุงูุงุช ูุฌุจ ุฃู ูุชู ุชูููุฐูุง ุจุงููุนุงููุฉ ุ ุฃู  ูู ุดูุก ุฐุฑู ูู ููุณ ุงูููุช. </p><br><p style=";text-align:right;direction:rtl">  ูุจูุงุกู ุนูู ุฐูู ุ ูู ุงูุถุฑูุฑู ุชุทููุฑ ุขููุฉ ุญุชู ุชุชููู ุงููุฎุงุฒู ุงููุฎุชููุฉ ูู ุชุบููุฑ ุญุงูุชูุง ุ ูููุณ ุฏุงุฎู ูู ูููุง ุจุดูู ูุณุชูู ุ ูููู ูุนุงููุงุช ุจูู ุฌููุน ุงููุฎุงุฒู ูู ููุช ูุงุญุฏ.  ุจุงูุทุจุน ุ ููููู ูุถุน ุงูุชุฎุฒูู ุฏุงุฎู ูุงุนุฏุฉ ุจูุงูุงุช ุฎุงุฑุฌูุฉ ุ ููุน ุฐูู ุ ุงูุชุฑุถุช ุงููููุฉ ุฃู ูุญุฑู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุญุฑู ุฅุทุงุฑ ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุชุฏููุฉ ูููุตูุงู ููุนููุงู ุจุดูู ูุณุชูู ุนู ุจุนุถููุง ุงูุจุนุถ.  ููุง ุฃุฑูุฏ ุฃู ุฃุนุชุจุฑ ุงูุญุงูุฉ ุงูุฃูุซุฑ ุตุนูุจุฉ ุ ูุฃู  ุงูุญุงูุงุช ุงูุจุณูุทุฉ ููุณุช ูุซูุฑุฉ ููุงูุชูุงู ูููุธุฑ ูููุง. </p><br><h2 id="konkurentnaya-otzyvchivost" style=";text-align:right;direction:rtl">  ุงูุงุณุชุฌุงุจุฉ ุงูุชูุงูุณูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ููุฑ ูู ุงูุชูููุฐ ุงูุชูุงูุณู ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท ุจูุฒูุฏ ูู ุงูุชูุงุตูู.  ูู ุญุงูุฉ ูุฌูุฏ ูุธุงู ูุชุญูู ุงูุฃุฎุทุงุก ุ ูุญุชุงุฌ ุฅูู ุงุณุชูุฑุงุฑ ุงูุนูู ูู ููุทุฉ ูุง.  ูู ุงููุงุถุญ ุฃู ูุฐู ุงูููุทุฉ ุณุชููู ููุทุฉ ูู ุงููุงุถู ุ ูุฃูู  ููุญูุงุธ ุนูู ุงูุฃุฏุงุก ุ ูู ุงููุณุชุญูู ุชุฎุฒูู ุฌููุน ูุญุธุงุช ุชุบููุฑุงุช ุงูุญุงูุฉ ูู ุงูุญุงุถุฑ ูุงููุณุชูุจู: ุฅูุง ุฃู ูุชู ุญูุธ ุงููุชูุฌุฉ ุงูุฃุฎูุฑุฉ ููุนูููุงุช ุฃู ูุฌููุนุฉ ูู ุงูููู ูุฒูุงุฏุฉ ุงูุฅูุชุงุฌูุฉ.  ูููุฏูุง ูุฐุง ุงูุณููู ุนูู ุงูููุฑ ุฅูู ุญูููุฉ ุฃูู ุจุนุฏ ุงุณุชุนุงุฏุฉ ุญุงูุฉ ุงููุนุงูุฌ ุ ุณูููู ููุงู ุจุนุถ ุงูุชุฃุฎูุฑ ูู ุงููุชุงุฆุฌ ุ ูุณูู ุชุฒุฏุงุฏ ูุน ุฒูุงุฏุฉ ุญุฌู ูุฌููุนุฉ ุงูููู ูุญุฌู ุงูุญุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ูุฐุง ุงูุชุฃุฎูุฑ ุ ููุงู ุฃูุถูุง ุชุฃุฎูุฑุงุช ูู ุงููุธุงู ูุฑุชุจุทุฉ ุจุชุญููู ุงูุญุงูุฉ ุฅูู ุนูุฏุฉ ุฃุฎุฑู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฅู ุงูุชุดุงู ุนูุฏุฉ ูุดููุฉ ูุณุชุบุฑู ุฃูุถูุง ุจุนุถ ุงูููุช ุ ูุบุงูุจูุง ูุง ูููู ูุซูุฑูุง.  ูุฐุง ูุฑุฌุน ุ ุฃููุงู ููุจู ูู ุดูุก ุ ุฅูู ุญูููุฉ ุฃูู ุฅุฐุง ุญุฏุฏูุง ููุชูุง ูุตูุฑูุง ูููุดู ุ ูุฅู ุงูุฅูุฐุงุฑุงุช ุงููุงุฐุจุฉ ุงููุชูุฑุฑุฉ ููููุฉ ุ ููุง ุณูุคุฏู ุฅูู ุฌููุน ุฃููุงุน ุงูุชุฃุซูุฑุงุช ุงูุฎุงุตุฉ ุบูุฑ ุงูุณุงุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุน ุงูุฒูุงุฏุฉ ูู ุนุฏุฏ ุงููุนุงูุฌุงุช ุงููุชูุงุฒูุฉ ุ ุงุชุถุญ ูุฌุฃุฉ ุฃูู ููุณ ูููู โโูุนูููู ุจุดูู ุฌูุฏ ุนูู ูุฏู ุงููุณุงูุงุฉ ุญุชู ูู ุบูุงุจ ุงููุดู.  ูู ุจุนุถ ุงูุฃุญูุงู ุชุญุฏุซ ุงูุชูุงุกุงุช ุ ููุง ูุคุฏู ุฃูุถูุง ุฅูู ุชุฃุฎูุฑุงุช ูู ุงููุนุงูุฌุฉ.  ูููู ุฃู ูุชููุน ุณุจุจ ูุฐู ุงูุชุจุงุนุฏ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <em>ุงูุจุฑูุงูุฌ</em> : ุชููู GC ูุคูุชูุง ุ ูุชุฌุฒุฆุฉ ุงูุฐุงูุฑุฉ ุ ูุฅููุงู ูุคูุช ูููุฎุตุต ุ ูุงููุทุงุน kernel ุ ูุฌุฏููุฉ ุงูููุงู ุ ููุดููุงุช ูู ุจุฑุงูุฌ ุชุดุบูู ุงูุฌูุงุฒ ุชุชุณุจุจ ูู ุญุฏูุซ ุจุทุก. </li><li style=";text-align:right;direction:rtl">  <em>ุงูุฃุฌูุฒุฉ</em> : ุชุญููู ุนุงูู ูููุฑุต ุฃู ุงูุดุจูุฉ ุ ุงุฎุชูุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุจุณุจุจ ูุดุงูู ุงูุชุจุฑูุฏ ุ ุงูุชุญููู ุงูุฒุงุฆุฏ ุ ุฅูุฎ ุ ุชุจุงุทุค ุงููุฑุต ุจุณุจุจ ุงููุดุงูู ุงูุชูููุฉ. </li></ol><br><p style=";text-align:right;direction:rtl">  ููุฐู ููุณุช ุจุฃู ุญุงู ูุงุฆูุฉ ุญุตุฑูุฉ ุจุงููุดููุงุช ุงูุชู ูููู ุฃู ุชุจุทุฆ ุงููุนุงูุฌุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุจูุงุก ุนูู ุฐูู ุ ูุฅู ุงูุชุจุงุทุค ูู ุฃูุฑ ูุฌุจ ุนูู ุงููุฑุก ุฃู ูุนูุด ูุนู.  ูู ุจุนุถ ุงูุฃุญูุงู ูุง ุชููู ูุฐู ูุดููุฉ ุฎุทูุฑุฉ ุ ูุฃุญูุงููุง ูููู ูู ุงูููู ููุบุงูุฉ ุงูุญูุงุธ ุนูู ุณุฑุนุฉ ูุนุงูุฌุฉ ุนุงููุฉ ุนูู ุงูุฑุบู ูู ุงููุดู ุฃู ุงูุชุจุงุทุค. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูููุฑ ุชูุดุฃ ููุฑุฉ ุงุฒุฏูุงุฌูุฉ ุงูุฃูุธูุฉ: ูููุฑูุถ ูุฏูู ูุงุญุฏ ูููุณ ุงูุจูุงูุงุช ููุณ ูุนุงูุฌูุง ูุงุญุฏูุง ุจู ูุนุงูุฌูู ูู ููุช ูุงุญุฏ ุ ุฃู ุญุชู ุซูุงุซุฉ.  ุงููุดููุฉ ููุง ูู ุฃูู ูู ูุฐู ุงูุญุงูุฉ ุ ูููู ุฃู ูุญุฏุซ ุณููู ุงููุธุงู ุงูููุฑุฑ ูุบูุฑ ุงููุชูุงุณู ุจุณูููุฉ.  ุนุงุฏุฉู ุ ูู ูุชู ุชุตููู ุฃุทุฑ ุงูุนูู ููุฐุง ุงูุณููู ูุชุดูุฑ ุฅูู ุฃู ุนุฏุฏ ุงููุนุงูุฌุงุช ูู ุฃู ููุช ูุนูู ูุง ูุชุฌุงูุฒ ูุงุญุฏ.  ุงูุฃูุธูุฉ ุงูุชู ุชุณูุญ ุจุงูุงุฒุฏูุงุฌูุฉ ุงูููุตููุฉ ููุชูููุฐ ุชุณูู <em>ูุชุฒุงููุฉ ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท</em> . </p><br><p style=";text-align:right;direction:rtl">  ุชุชูุญ ูู ูุฐู ุงูุจููุฉ ุญู ุงูุนุฏูุฏ ูู ุงููุดุงูู ูู ููุช ูุงุญุฏ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุณููู ุบูุฑ ุงูุขูู: ุฅุฐุง ุณูุทุช ุฅุญุฏู ุงูุนูุฏ ุ ุชุณุชูุฑ ุงูุฃุฎุฑู ุจุจุณุงุทุฉ ูู ุงูุนูู ููุง ูู ูู ูุญุฏุซ ุดูุก.  ููุณุช ููุงู ุญุงุฌุฉ ูุชูุณูู ุฅุถุงูู ุ ูุซู  ูุชู ุชูููุฐ ุงููุนุงูุฌ ุงูุซุงูู ุจุบุถ ุงููุธุฑ ุนู ุญุงูุฉ ุงูุฃูู. </li><li style=";text-align:right;direction:rtl">  ุฅุฒุงูุฉ ุงูุตุฏูุงุช: ูู ูู ูุฏู ุงููุชูุฌุฉ ุฌูุฏูุง ุจุงููุณุจุฉ ูู.  ูุงูุขุฎุฑ ุณูููู ุนููู ููุท ุงุฎุชูุงุฑ ุฏููุฉ ุฌุฏูุฏุฉ ูุงูุงุณุชูุฑุงุฑ ูู ูุฐู ุงููุญุธุฉ. </li></ol><br><p style=";text-align:right;direction:rtl">  ูุฐุง ุงูููุฌ ุ ุนูู ูุฌู ุงูุฎุตูุต ุ ูุณูุญ ูู ุจุฅููุงู ุนูููุฉ ุญุณุงุจูุฉ ุตุนุจุฉ ูุตุนุจุฉ ููุชุฑุฉ ุฃุทูู ูููู ุงูุชูุจุค ุจูุง ุ ูุฃูู  ุงุญุชูุงููุฉ ุฃู ูุตุจุญ ููุงููุง ุบุจููุง ูุณููุทูุง ุฃูู ุจุดูู ููุญูุธ. </p><br><h3 id="veroyatnostnaya-ocenka" style=";text-align:right;direction:rtl">  ุชูููู ุงูุงุญุชูุงูุงุช </h3><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูุญุงูู ุชูููู ููุงุฆุฏ ุงุฒุฏูุงุฌูุฉ ุงูุฃุฏุงุก.  ุงูุชุฑุถ ุฃู ุดูุฆูุง ูุง ูุญุฏุซ ูู ุงููุชูุณุท โโูู ููู ูุน ุงููุนุงูุฌ: ุฅูุง ุฃู ูููู GC ูุฏ ุชุถุงุกู ุ ุฃู ุฃู ุงูุนูุฏุฉ ุชูุฐุจ ุ ุฃู ุฃู ุงูุญุงููุงุช ุฃุตุจุญุช ุณุฑุทุงููุฉ.  ุงูุชุฑุถ ุฃูุถูุง ุฃููุง ูููู ุจุฅุนุฏุงุฏ ุญุฒู ุงูุจูุงูุงุช ูู 10 ุซูุงูู. </p><br><p style=";text-align:right;direction:rtl">  ุซู ูููู ุงุญุชูุงู ุญุฏูุซ ุดูุก ูุง ุฃุซูุงุก ุฅูุดุงุก ุงูุนุจูุฉ ูู <code>10 / (24 ยท 3600) โ 1e-4</code> . </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุจุชุดุบูู ูุนุงูุฌูู ุจุงูุชูุงุฒู ุ ูุฅู ุงุญุชูุงู ุฃู ููุง <code>โ 1e-8</code> ูู <code>โ 1e-8</code> .  ูุฐุง ุณูุฃุชู ูุฐุง ุงูุญุฏุซ ูู ุบุถูู 23 ุนุงููุง!  ูุนู ุ ุงูุฃูุธูุฉ ูุง ุชุนูุด ูุซูุฑูุง ุ ููุง ูุนูู ุฃู ูุฐุง ูู ูุญุฏุซ ุฃุจุฏูุง! </p><br><p style=";text-align:right;direction:rtl">  ุนูุงูุฉ ุนูู ุฐูู ุ ุฅุฐุง ูุงู ููุช ุชุญุถูุฑ ุงูุนุจูุฉ ุฃูุตุฑ ู / ุฃู ุณูุญุฏุซ ุงูุฎูุงุถ ุฃูู ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุ ูุฅู ูุฐุง ุงูุฑูู ุณูุฒุฏุงุฏ ููุท. </p><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ูุณุชูุชุฌ ุฃู ุงูููุฌ ููุฏ ุงููุธุฑ ูุฒูุฏ ุจุดูู ูุจูุฑ ูู ููุซูููุฉ ูุธุงููุง ุจุฃูููู.  ูุจูู ููุท ูุญู ุณุคุงู ุตุบูุฑ ูุซู ูุฐุง: ุฃูู ุชูุฑุฃ ุญูู ููููุฉ ุฅูุดุงุก ูุธุงู <em>ูุชุฒุงูู ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท</em> .  ูุงูุฌูุงุจ ุจุณูุท: ุนููู ุฃู ุชูุฑุฃ ููุง. </p><br><h2 id="polutranzakcii" style=";text-align:right;direction:rtl">  ูุตู ูุนุงููุฉ </h2><br><p style=";text-align:right;direction:rtl">  ููุฒูุฏ ูู ุงูููุงูุดุฉ ุ ูุญู ุจุญุงุฌุฉ ุฅูู ููููู <em>ูุตู ุงูุตููุฉ</em> .  ุฃุณูู ุทุฑููุฉ ูุชูุณูุฑ ุฐูู ูู ูู ุฎูุงู ูุซุงู. </p><br><p style=";text-align:right;direction:rtl">  ููุฑ ูู ุชุญููู ุงูุฃููุงู ูู ุญุณุงุจ ูุตุฑูู ุฅูู ุขุฎุฑ.  ูููู ูุตู ุงูููุฌ ุงูุชูููุฏู ุจุงุณุชุฎุฏุงู ุงููุนุงููุงุช ุจูุบุฉ Pseco ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">transfer(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, amount): tx = db.begin_transaction() amount_from = tx.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> amount_from &lt; amount: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> error.insufficient_funds tx.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, amount_from - amount) tx.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, tx.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>) + amount) tx.<span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ok</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ูุงุฐุง ูู ูู ุชูู ูุฐู ุงููุนุงููุงุช ูุชุงุญุฉ ููุงุ  ุจุงุณุชุฎุฏุงู ุงูุฃููุงู ุ ูููู ุงูููุงู ุจุฐูู ุนูู ุงููุญู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">transfer(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, amount): #         lock_from = db.<span class="hljs-keyword"><span class="hljs-keyword">lock</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>) lock_to = db.<span class="hljs-keyword"><span class="hljs-keyword">lock</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>) amount_from = db.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> amount_from &lt; amount: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> error.insufficient_funds db.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, amount_from - amount) db.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, db.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>) + amount) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ok</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ุงูููุฌ ูููู ุฃู ูุคุฏู ุฅูู ุทุฑูู ูุณุฏูุฏ ุ ููุง  ูููู ุฃุฎุฐ ุงูุฃููุงู ุจุชุณูุณู ูุฎุชูู ุจุงูุชูุงุฒู.  ูุชุตุญูุญ ูุฐุง ุงูุณููู ุ ูููู ุชูุฏูู ูุธููุฉ ุชุฃุฎุฐ ูู ุงูููุช ููุณู ุนุฏุฉ ุฃููุงู ูู ุชุณูุณู ุญุงุณู (ุนูู ุณุจูู ุงููุซุงู ุ ูุฑุฒ ุญุณุจ ุงูููุงุชูุญ) ุ ููุง ููุบู ุชูุงููุง ุงูุฌููุฏ ุงููุญุชูู. </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ูููู ุชุจุณูุท ุงูุชูููุฐ ุฅูู ุญุฏ ูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs vbscript">transfer(from, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, amount): lock_from = db.lock(from) amount_from = db.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(from) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> amount_from &lt; amount: return <span class="hljs-keyword"><span class="hljs-keyword">error</span></span>.insufficient_funds db.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(from, amount_from - amount) lock_from.release() #   , # .. db.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(db.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>...)     lock_to = db.lock(<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>) db.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, db.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>) + amount) return ok</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ุงูููุฌ ูุฌุนู ุฃูุถูุง ุงูุญุงูุฉ ุงูููุงุฆูุฉ ูุชุณูุฉ ุ ูุน ุงูุญูุงุธ ุนูู ุงูุซูุงุจุช ุจููุน ููุน ุงูุฅููุงู ุงูููุฑุท ููุฃููุงู.  ุงููุฑู ุงูุฑุฆูุณู ุนู ุงูููุฌ ุงูุณุงุจู ูู ุฃูู ูู ูุซู ูุฐุง ุงูุชูููุฐ ูุฏููุง ูุชุฑุฉ ุฒูููุฉ ูุนููุฉ ุชููู ูููุง ุงูุญุณุงุจุงุช ูู ุญุงูุฉ ุบูุฑ ูุชูุงุณูุฉ.  ููู ูุซู ูุฐู ุงูุนูููุฉ ุชุนูู ุฃู ุงูุญุงูุฉ ุงูุฅุฌูุงููุฉ ููุฃููุงู ูู ุงูุญุณุงุจุงุช ูุง ุชุชุบูุฑ.  ูู ูุฐู ุงูุญุงูุฉ ุ ููุงู ูุฌูุฉ ุฒูููุฉ ุจูู <code>lock_from.release()</code> ู <code>db.lock(to)</code> ุ ูุฏ ุชุนุทู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฎูุงููุง ูููุฉ ุบูุฑ ูุชูุงุณูุฉ: ูุฏ ูุฎุชูู ุงููุจูุบ ุงูุฅุฌูุงูู ุนู ุงููุจูุบ ุงูุตุญูุญ ุฅูู ุงูุฃุณูู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ูููุง ุจุชูุณูู ูุนุงููุฉ ูุงุญุฏุฉ ูุชุญููู ุงูุฃููุงู ุฅูู ูุตููู ูู ุงููุนุงููุงุช: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชููู ุงููุตู ุงูุฃูู ูู ุงููุนุงููุฉ ุจุนูู ุดูู ูุฎุตู ุงููุจูุบ ุงูุถุฑูุฑู ูู ุงูุญุณุงุจ. </li><li style=";text-align:right;direction:rtl">  ุงููุตู ุงูุซุงูู ูู ุงููุนุงููุฉ ููุชุจ ุงููุจูุบ ุงููุณุญูุจ ุฅูู ุญุณุงุจ ุขุฎุฑ. </li></ol><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงุถุญ ุฃู ุชูุณูู ุงููุนุงููุฉ ุฅูู ูุนุงููุงุช ุฃุตุบุฑ ุ ุจุดูู ุนุงู ุ ููุชูู ุณููู ุงููุนุงููุงุช.  ูุงููุซุงู ุฃุนูุงู ููุณ ุงุณุชุซูุงุก.  ููุน ุฐูู ุ ุฅุฐุง ุชู ุชุญููู ุฌููุน ุงููุนุงููุงุช ุงููุตู ูู ุงูุณูุณูุฉ ุจุงููุงูู ุ ูุณุชููู ุงููุชูุฌุฉ ูุชุณูุฉ ูุน ุฌููุน ุงูุซูุงุจุช ุงููุญููุธุฉ.  ูุฐุง ูู ุจุงูุถุจุท ูุง ูู ุฎุงุตูุฉ ูููุฉ ูุณูุณูุฉ ูุตู ุงููุนุงููุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูููุฏ ุจุนุถ ุงูุงุชุณุงู ูุคูุชูุง ุ ููุน ุฐูู ููุชุณุจ ููุฒุฉ ุฃุฎุฑู ูููุฏุฉ: ุงุณุชููุงููุฉ ุงูุนูููุงุช ุ ููุชูุฌุฉ ูุฐูู ุ ูุงุจููุฉ ุงูุชูุณุน ุงูุฃูุถู.  ูุชุฌูู ุงูุงุณุชููุงู ูู ุญูููุฉ ุฃู ูุตู ุงููุนุงููุฉ ูู ูู ูุฑุฉ ุชุนูู ูุน ุณุทุฑ ูุงุญุฏ ููุท ุ ููู ูุฑุงุกุฉ ุจูุงูุงุชูุง ูุงูุชุญูู ูููุง ูุชุบููุฑูุง ุ ุฏูู ุงูุงุชุตุงู ุจุจูุงูุงุช ุฃุฎุฑู.  ูุจุงูุชุงูู ุ ููููู ุฎูุท ูุงุนุฏุฉ ุจูุงูุงุช ุชุนูู ูุน ุฌุฒุก ูุงุญุฏ ููุท.  ุนูุงูุฉ ุนูู ุฐูู ุ ูููู ุงุณุชุฎุฏุงู ูุฐุง ุงูููุฌ ูู ุญุงูุฉ ุงููุณุชูุฏุนุงุช ุบูุฑ ุงููุชุฌุงูุณุฉ ุ ุฃู  ูููู ุฃู ุชุจุฏุฃ ูุตู ุงููุนุงููุงุช ุนูู ููุน ูุงุญุฏ ูู ุงูุชุฎุฒูู ุ ูุชูุชูู ุนูู ููุน ุขุฎุฑ.  ุฅููุง ุฎุตุงุฆุต ูููุฏุฉ ุณูุชู ุงุณุชุฎุฏุงููุง ูู ุงููุณุชูุจู. </p><br><p style=";text-align:right;direction:rtl">  ูุทุฑุญ ุณุคุงู ุดุฑุนู: ููููุฉ ุชุทุจูู ูุตู ุงูุบูุจูุจุฉ ูู ุงูุฃูุธูุฉ ุงูููุฒุนุฉ ูููุณ ุฃุดุนู ุงููุงุฑุ  ูุญู ูุฐู ุงููุดููุฉ ุ ุชุญุชุงุฌ ุฅูู ุงููุธุฑ ูู ููุฌ ุนุฏู ุงูููู. </p><br><h2 id="lock-free" style=";text-align:right;direction:rtl">  ุจุฏูู ููู </h2><br><p style=";text-align:right;direction:rtl">  ููุง ุชุนูู ุ ุชุนูู ุงูููุงูุฌ ุงูุฎุงููุฉ ูู ุงูููู ุฃุญูุงููุง ุนูู ุชุญุณูู ุฃุฏุงุก ุงูุฃูุธูุฉ ูุชุนุฏุฏุฉ ุงูุฎููุท ุ ุฎุงุตุฉ ูู ุญุงูุฉ ุงููุตูู ุงูุชูุงูุณู ุฅูู ุงูููุฑุฏ.  ููุน ุฐูู ุ ููุณ ูู ุงููุงุถุญ ุชูุงููุง ุฃู ูุซู ูุฐุง ุงูููุฌ ูููู ุงุณุชุฎุฏุงูู ูู ุงูุฃูุธูุฉ ุงูููุฒุนุฉ.  ุฏุนููุง ูุชุนูู ุจุนูู ูููุธุฑ ูู ูุง ูู ุจุฏูู ููู ูููุงุฐุง ุณุชููู ูุฐู ุงูุฎุงุตูุฉ ูููุฏุฉ ูู ุญู ูุดููุชูุง. </p><br><p style=";text-align:right;direction:rtl">  ูู ุจุนุถ ุงูุฃุญูุงู ูุง ูููู ุจุนุถ ุงููุทูุฑูู ุชูุงููุง ูุง ูู ููู ูุฌุงูู.  ุชุดูุฑ ุงููุธุฑุฉ ุงูุถููุฉ ุฅูู ุฃู ูุฐุง ุฃูุฑ ูุชุนูู ุจุชุนูููุงุช ุงููุนุงูุฌ ุงูุฐุฑู.  ูู ุงูููู ุฃู ูููู ููุง ุฃู ุงูููู ุงูุญุฑ ูุนูู ุงุณุชุฎุฏุงู "ุงูุฐุฑุงุช" ุ ูุงูุนูุณ ุบูุฑ ุตุญูุญ ุ ุฃู  ููุณ ูู "ุงูุฐุฑุงุช" ุชุนุทู ุณููููุง ุจุฏูู ููู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุฎุตุงุฆุต ุงููููุฉ ููุฎูุงุฑุฒููุฉ ุงูุฎุงููุฉ ูู ุงูููู ูู ุฃู ูุคุดุฑ ุชุฑุงุจุท ูุงุญุฏ ุนูู ุงูุฃูู ูุญูู ุชูุฏููุง ูู ุงููุธุงู.  ูููู ูุณุจุจ ูุง ุ ูุนุฒู ุงููุซูุฑูู ูุฐู ุงูุฎุงุตูุฉ ุฅูู ุชุนุฑูู (ูุฐุง ุชุนุฑูู ุตุฑูุญ ูููู ุงูุนุซูุฑ ุนููู ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนูู ููููุจูุฏูุง</a> ).  ููุง ูู ุงูุถุฑูุฑู ุฅุถุงูุฉ ูุงุฑู ุจุณูุท ูุงุญุฏ ููู: ูุชู ุฅุญุฑุงุฒ ุชูุฏู ุญุชู ูู ุญุงูุฉ ูุดุงุดุฉ ููุถูุน ูุงุญุฏ ุฃู ุฃูุซุฑ.  ูุฐู ููุทุฉ ุญุฑุฌุฉ ููุบุงูุฉ ูุชู ุชุฌุงูููุง ุบุงูุจูุง ูููุง ุขุซุงุฑ ุฎุทูุฑุฉ ุนูู ุงููุธุงู ุงูููุฒุน. </p><br><p style=";text-align:right;direction:rtl">  ููุงุฐุง ูููู ุบูุงุจ ุดุฑุท ุงูุชูุฏู ูุฎููุท ูุงุญุฏ ุนูู ุงูุฃูู ููููู ุงูุฎูุงุฑุฒููุฉ ุงูุฎุงููุฉ ูู ุงููููุ  ูุงูุญูููุฉ ูู ุฃูู ูู ูุฐู ุงูุญุงูุฉ ุณูููู spinlock ุงููุนุชุงุฏ ุฃูุถูุง ุจุฏูู ููู.  ูู ุงููุงูุน ุ ุงูุดุฎุต ุงูุฐู ุฃุฎุฐ ุงูููู ุณูุญุฑุฒ ุชูุฏููุง.  ูู ููุงู ุฎูุท ูุน ุงูุชูุฏู =&gt; ุจุฏูู ูููุ </p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงุถุญ ุฃู ุงูุฅููุงู ูุนูู ุจุฏูู ุฃููุงู ุ ุจูููุง ูุดูุฑ spinlock ุจุงุณูู ุฅูู ุฃู ูุฐุง ููู ุญูููู.  ูุฐุง ูู ุงูุณุจุจ ูู ุฃูู ูู ุงูููู ุฅุถุงูุฉ ุดุฑุท ุนูู ุงูุชูุฏู ุญุชู ูู ุญุงูุฉ ุงูุชุตุฏุนุงุช.  ุจุนุฏ ูู ุดูุก ุ ูููู ุฃู ุชุณุชูุฑ ูุฐู ุงูุชุฃุฎูุฑุงุช ุฅูู ุฃุฌู ุบูุฑ ูุณูู ุ ูุฃูู  ูุง ูููู ุงูุชุนุฑูู ุดูุฆูุง ุนู ุงูุญุฏ ุงูุฒููู ุงูุนููู.  ูุฅุฐุง ูุงู ุงูุฃูุฑ ูุฐูู ุ ูุฅู ูุซู ูุฐู ุงูุชุฃุฎูุฑุงุช ุณุชููู ูุนุงุฏูุฉ ุฅูู ุญุฏ ูุง ูุฅููุงู ุงูุชุฏููุงุช.  ูู ูุฐู ุงูุญุงูุฉ ุ ุณุชูุชุฌ ุงูุฎูุงุฑุฒููุงุช ุงูุฎุงููุฉ ูู ุงูููู ุชูุฏููุง ูู ูุฐู ุงูุญุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูู ูุงู ุฅู ุงูููุงุฑุจุงุช ุงูุฎุงููุฉ ูู ุงูููู ุชูุทุจู ุญุตุฑููุง ุนูู ุงูุฃูุธูุฉ ูุชุนุฏุฏุฉ ุงูุฎููุทุ  ุงุณุชุจุฏุงู ุฎููุท ูู ููุณ ุงูุนูููุฉ ุนูู ููุณ ุงูุนูุฏุฉ ูุน ุงูุนูููุงุช ุนูู ุงูุนูุฏ ุงููุฎุชููุฉ ุ ูุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ููุฎููุท ูุน ุงูุชุฎุฒูู ุงูููุฒุน ุงููุดุชุฑู ุ ูุญุตู ุนูู ุฎูุงุฑุฒููุฉ ููุฒุนุฉ ุจุฏูู ููู. </p><br><p style=";text-align:right;direction:rtl">  ุงูุฎูุงุถ ุงูุนูุฏุฉ ูู ูุซู ูุฐุง ุงููุธุงู ูุนุงุฏู ุงูุชุฃุฎูุฑ ูู ุชูููุฐ ูุคุดุฑ ุชุฑุงุจุท ูุจุนุถ ุงูููุช ุ ูุฃูู  ุญุงู ุงูููุช ูุงุณุชุนุงุฏุฉ ุงูุนูู.  ูู ุงูููุช ููุณู ุ ูุณูุญ ููุฌ ุนุฏู ุงูููู ูููุดุงุฑููู ุงูุขุฎุฑูู ูู ุงููุธุงู ุงูููุฒุน ุจููุงุตูุฉ ุงูุนูู.  ุนูุงูุฉ ุนูู ุฐูู ุ ูููู ุชุดุบูู ุฎูุงุฑุฒููุงุช ุฎุงุตุฉ ุฎุงููุฉ ูู ุงูููู ุจุงูุชูุงุฒู ูุน ุจุนุถูุง ุงูุจุนุถ ุ ูููุดู ุนู ุชุบููุฑ ุชูุงูุณู ูุงุณุชุจุนุงุฏ ุงูุชูุฑุงุฑุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุดูุฑ ุงูููุฌ ุงูุฐู <em>ูุชู ุงุณุชุฎุฏุงูู ูุฑุฉ ูุงุญุฏุฉ ุจุงูุถุจุท</em> ุฅูู ูุฌูุฏ ุชุฎุฒูู ููุฒุน ูุชูุงุณู.  ูุซู ูุฐู ุงููุฎุงุฒู ููุงุนุฏุฉ ุชูุซู ุฌุฏูู ูููุฉ ุฑุฆูุณูุฉ ุซุงุจุชูุง ุถุฎููุง.  ุงูุนูููุงุช ุงููุญุชููุฉ: <code>set</code> ุ <code>get</code> ุ <code>del</code> .  ููุน ุฐูู ุ ููุฒู ุฅุฌุฑุงุก ุนูููุฉ ุฃูุซุฑ ุชุนููุฏูุง ููููุฌ ุจุฏูู ููู: CAS ุฃู ููุงุฑูุฉ ููุจุงุฏูุฉ.  ุฏุนููุง ูููุฑ ุจูุฒูุฏ ูู ุงูุชูุตูู ูู ูุฐู ุงูุนูููุฉ ุ ูุฅููุงููุงุช ุงุณุชุฎุฏุงููุง ุ ููุฐูู ุงููุชุงุฆุฌ ุงูุชู ุชุนุทููุง. </p><br><h3 id="cas" style=";text-align:right;direction:rtl">  ูุงุณ </h3><br><p style=";text-align:right;direction:rtl">  CAS ุฃู ููุงุฑูุฉ ููุจุงุฏูุฉ ูู ุจุฏุงุฆูุฉ ุงููุฒุงููุฉ ุงูุฑุฆูุณูุฉ ูุงููููุฉ ูุฎูุงุฑุฒููุงุช ุจุฏูู ููู ูุฎุงููุฉ ูู ุงูุงูุชุธุงุฑ.  ูููู ุชูุถูุญ ุฌููุฑู ูู ุฎูุงู Pseco ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs kotlin">CAS(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>, expected, new): # ,   atomic,   atomic: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() != expected: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(new) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุจุนุถ ุงูุฃุญูุงู ุ ูู ุฃุฌู ุงูุชุญุณูู ุ ูุง ูุนูุฏูู <code>true</code> ุฃู <code>false</code> ุ ูููู ุงููููุฉ ุงูุณุงุจูุฉ ุ ูุฃู  ูู ูุซูุฑ ูู ุงูุฃุญูุงู ูุชู ุชูููุฐ ูุฐู ุงูุนูููุงุช ูู ุญููุฉ ุ ูููุญุตูู ุนูู ุงููููุฉ <code>expected</code> ุ ูุฌุจ ุนููู ุฃููุงู ูุฑุงุกุชูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs vala">CAS_optimized(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>, expected, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>): # ,   atomic,   atomic: current = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current == expected: <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> current #  CAS   CAS_optimized CAS(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>, expected, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>.CAS_optimized(expected, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>) == expected</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุฃู ูููุฑ ูุฐุง ุงูููุฌ ูุฑุงุกุฉ ูุงุญุฏุฉ.  ูุฌุฒุก ูู ูุฑุงุฌุนุชูุง ุ ุณูุณุชุฎุฏู ุดูููุง ุจุณูุทูุง ูู <code>CAS</code> ุ ูุฃูู  ุฅุฐุง ุฑุบุจุช ูู ุฐูู ุ ูููู ุฅุฌุฑุงุก ูุฐุง ุงูุชุญุณูู ุจุดูู ูุณุชูู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุฉ ุงูุฃูุธูุฉ ุงูููุฒุนุฉ ุ ูุชู ุฅุตุฏุงุฑ ูู ุชุบููุฑ.  ุนูู ุณุจูู ุงููุซุงู  ุฃููุงู ููุฑุฃ ุงููููุฉ ูู ุงููุชุฌุฑ ุ ูุญุตู ุนูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู ูู ุงูุจูุงูุงุช.  ุซู ูุญุงูู ุงููุชุงุจุฉ ุ ูุชููุนูู ุฃู ุฅุตุฏุงุฑ ุงูุจูุงูุงุช ูู ูุชุบูุฑ.  ูู ูุฐู ุงูุญุงูุฉ ุ ุชุฒุฏุงุฏ ุงููุณุฎุฉ ูู ูู ูุฑุฉ ูุชู ูููุง ุชุญุฏูุซ ุงูุจูุงูุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs cs">CAS_versioned(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>, expected_version, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>): atomic: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>.get_version() != expected_version: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>, expected_version + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุณูุญ ูู ูุฐุง ุงูููุฌ ุจุงูุชุญูู ุจุดูู ุฃูุซุฑ ุฏูุฉ ูู ุชุญุฏูุซ ุงูููู ุ ูุชุฌูุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุดููุฉ ABA</a> .  ุนูู ูุฌู ุงูุฎุตูุต ุ ูุฏุนู ุงูุฅุตุฏุงุฑ Etcd ู Zookeeper. </p><br><p style=";text-align:right;direction:rtl">  ูุงุญุธ ุงูุฎุงุตูุฉ ุงููุงูุฉ ุงูุชู <code>CAS_versioned</code> ุงุณุชุฎุฏุงู ุนูููุงุช <code>CAS_versioned</code> .  ูุงูุญูููุฉ ูู ุฃูู ูููู ุชูุฑุงุฑ ูุซู ูุฐู ุงูุนูููุฉ ุฏูู ุงููุณุงุณ ุจุงูููุทู ุงููุชููู.  ูู ุงูุจุฑูุฌุฉ ูุชุนุฏุฏุฉ ุงูุฎููุท ุ ูุฐู ุงูุฎุงุตูุฉ ููุณ ููุง ูููุฉ ุฎุงุตุฉ ุ ูุฃู  ููุงู ุ ุฅุฐุง ูุดูุช ุงูุนูููุฉ ุ ููุญู ุนูู ูููู ูู ุฃููุง ูู ุชูุทุจู.  ูู ุญุงูุฉ ุงููุธู ุงูููุฒุนุฉ ุ ุชู ุงูุชูุงู ูุฐุง ุงูุซุงุจุช ุ ูุฃูู  ูุฏ ูุตู ุงูุทูุจ ุฅูู ุงููุณุชูู ุ ูููู ุงูุงุณุชุฌุงุจุฉ ุงููุงุฌุญุฉ ูู ุชุนุฏ ููุฌูุฏุฉ.  ูุฐูู ุ ูู ุงูููู ุฃู ุชููู ูุงุฏุฑูุง ุนูู ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุทูุจุงุช ุฏูู ุฎูู ูู ูุณุฑ ุซูุงุจุช ุงูููุทู ุฑููุน ุงููุณุชูู. </p><br><p style=";text-align:right;direction:rtl">  ูุฐู ูู ุงูุฎุงุตูุฉ ุงูุชู <code>CAS_versioned</code> ุนูููุฉ <code>CAS_versioned</code> .  ูู ุงููุงูุน ุ ูููู ุชูุฑุงุฑ ูุฐู ุงูุนูููุฉ ุฅูู ูุง ูุง ููุงูุฉ ุญุชู ูุชู ุฅุฑุฌุงุน ุงูุงุณุชุฌุงุจุฉ ุงูุญููููุฉ ูู ุงููุณุชูู.  ููู ุจุฏูุฑู ูููู ูุฆุฉ ูุงููุฉ ูู ุงูุฃุฎุทุงุก ุงููุชุนููุฉ ุจุชูุงุนู ุงูุดุจูุฉ. </p><br><h3 id="primer" style=";text-align:right;direction:rtl">  ูุซุงู </h3><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ููููุฉ <code>CAS_versioned</code> ููุตู ุงููุนุงููุงุช ุ ูู ุญุณุงุจ ุฅูู ุขุฎุฑ ุ ูุงูุชู ุชูุชูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅูู ูุณุฎ ูุฎุชููุฉ ูู Etcd.  ููุง ุ ุฃูุชุฑุถ ุฃู ุงูุฏุงูุฉ <code>CAS_versioned</code> ูุฏ ุชู ุชูููุฐูุง ููููุง ูุฐูู ุจูุงุกู ุนูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูููุฏูุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">withdraw(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, amount): # CAS- <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>: #     version_from, amount_from = <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.get_versioned() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> amount_from &lt; amount: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> error.insufficient_funds <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.CAS_versioned(version_from, amount_from - amount): break <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ok deposit(<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, amount): # CAS- <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>: version_to, amount_to = <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>.get_versioned() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>.CAS_versioned(version_to, amount_to + amount): break <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ok transfer(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, amount): #   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> withdraw(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, amount) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> ok: #     , #    deposit(<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, amount)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููุง ููุง ุจุชูุณูู ุนูููุชูุง ุฅูู ูุตู ุงููุนุงููุงุช ุ ููููุฐ ูู ูุนุงููุฉ ูุตู ูู ุฎูุงู ุนูููุฉ <code>CAS_versioned</code> .  ูุณูุญ ูู ูุฐุง ุงูููุฌ ุจุงูุนูู ุจุดูู ูุณุชูู ูุน ูู ุญุณุงุจ ุ ููุง ูุณูุญ ุจุงุณุชุฎุฏุงู ุงูุชุฎุฒูู ุบูุฑ ุงููุชุฌุงูุณุฉ ุบูุฑ ุงููุฑุชุจุท ุจุจุนุถู ุงูุจุนุถ.  ุงููุดููุฉ ุงููุญูุฏุฉ ุงูุชู ุชูุชุธุฑูุง ููุง ูู ุฎุณุงุฑุฉ ุงููุงู ูู ุญุงูุฉ ุญุฏูุซ ุงูุฎูุงุถ ูู ุงูุนูููุฉ ุงูุญุงููุฉ ูู ุงููุชุฑุฉ ุงููุงุตูุฉ ุจูู ูุตู ุงููุนุงููุงุช. </p><br><h2 id="ochered" style=";text-align:right;direction:rtl">  ูุงุฆูุฉ ุงูุงูุชุธุงุฑ </h2><br><p style=";text-align:right;direction:rtl">  ูููุถู ูุฏููุง ุ ุชุญุชุงุฌ ุฅูู ุชูููุฐ ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุฃุญุฏุงุซ.  ุชููู ุงูููุฑุฉ ูู ุฃูู ุจุงููุณุจุฉ ูููุนุงูุฌูู ููุชูุงุตู ูุน ุจุนุถูู ุงูุจุนุถ ุ ูุฌุจ ุฃู ูููู ูุฏูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุฑุณุงุฆู ูุฑุชุจุฉ ูุง ูุชู ูููุง ููุฏ ุงูุจูุงูุงุช ุฃู ุชูุฑุงุฑูุง.  ูุจูุงุกู ุนูู ุฐูู ุ ุณูุชู ุจูุงุก ุฌููุน ุงูุชูุงุนูุงุช ูู ุณูุณูุฉ ุงููุนุงูุฌุงุช ุนูู ูุฐุง ุงูุจุฏุงุฆู.  ููุง ุฃููุง ุฃุฏุงุฉ ูููุฏุฉ ูุชุญููู ูุชุฏููู ุชุฏููุงุช ุงูุจูุงูุงุช ุงููุงุฑุฏุฉ ูุงูุตุงุฏุฑุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููู ุฃูุถูุง ุฅุฌุฑุงุก ุทูุฑุงุช ูู ุญุงูุฉ ุงููุนุงูุฌุงุช ูู ุฎูุงู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุณุชุชุฃูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูู ุฒูุฌ ูู ุงูุนูููุงุช: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฃุถู ุฑุณุงูุฉ ุฅูู ููุงูุฉ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ. </li><li style=";text-align:right;direction:rtl">  ุงุณุชูุจุงู ุฑุณุงูุฉ ูู ุงูุตู ูู ุงูููุฑุณ ุงููุญุฏุฏ. </li></ol><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุงูุณูุงู ุ ูุง ุฃููุฑ ูู ุฅุฒุงูุฉ ุงูุฑุณุงุฆู ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุนุฏุฉ ุฃุณุจุงุจ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููู ูุนุฏุฉ ูุนุงูุฌุงุช ุงููุฑุงุกุฉ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ููุณูุง.  ุณุชููู ุฅุฒุงูุฉ ุงูุชุฒุงูู ูููุฉ ุบูุฑ ุชุงููุฉ ุ ุนูู ุงูุฑุบู ูู ุฃููุง ููุณุช ูุณุชุญููุฉ. </li><li style=";text-align:right;direction:rtl">  ูู ุงููููุฏ ุงูุงุญุชูุงุธ ุจูุงุฆูุฉ ุงูุชุธุงุฑ ููุชุฑุฉ ุทูููุฉ ูุณุจููุง (ููู ุฃู ุฃุณุจูุน) ูุชุตุญูุญ ุงูุฃุฎุทุงุก ูุงูุชุฏููู.  ูู ุงูุตุนุจ ุงููุจุงูุบุฉ ูู ูุงุฆุฏุฉ ูุฐู ุงูุฎุงุตูุฉ. </li><li style=";text-align:right;direction:rtl">  ููููู ุญุฐู ุงูุนูุงุตุฑ ุงููุฏููุฉ ุฅูุง ูู ุงูููุนุฏ ุงููุญุฏุฏ ุฃู ุนู ุทุฑูู ุชุนููู TTL ุนูู ุนูุงุตุฑ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ.  ูู ุงูููู ุงูุชุฃูุฏ ูู ุฃู ุงููุนุงูุฌุงุช ุชูููุช ูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูุจู ูุตูู ุงููููุณุฉ ูุชูุธูู ูู ุดูุก.  ุฅุฐุง ูุงู ููุช ุงููุนุงูุฌุฉ ุจุชุฑุชูุจ ุงูุซูุงูู ุ ู TTL ูุชุฑุชูุจ ุงูุฃูุงู ุ ููุฌุจ ุฃูุง ูุญุฏุซ ุฃู ุดูุก ูู ูุฐุง. </li></ol><br><p style=";text-align:right;direction:rtl">  ูุชุฎุฒูู ุงูุนูุงุตุฑ ูุชูููุฐ ุงูุฅุถุงูุฉ ุจุดูู ูุนุงู ุ ูุญุชุงุฌ ุฅูู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงููููุฉ ูุน ุงูููุฑุณ ุงูุญุงูู.  ูุดูุฑ ูุฐุง ุงูููุฑุณ ุฅูู ููุงูุฉ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุฅุถุงูุฉ ุนูุงุตุฑ. </li><li style=";text-align:right;direction:rtl">  ,    . </li></ol><br><h3 id="kak-by-lock-free-ochered" style=";text-align:right;direction:rtl">   lock-free  </h3><br><p style=";text-align:right;direction:rtl">          :        .        : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">    CAS     . </li><li style=";text-align:right;direction:rtl">       . </li></ol><br><p style=";text-align:right;direction:rtl">    ,    ,     . </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <strong>    lock-free</strong> .  ,      ,          . Lock-free? !   ,    2 :   .         lock-free,     โ !    ,  ,        ,   .              .         , ..            ,     . </li><li style=";text-align:right;direction:rtl"> <strong>    </strong> .         ,               .    . </li></ol><br><p style=";text-align:right;direction:rtl">  ,    lock-free         . </p><br><h3 id="lock-free-realizaciya-dobavleniya" style=";text-align:right;direction:rtl"> Lock-free   </h3><br><p style=";text-align:right;direction:rtl"> ,  ,     :   , ..      ,    : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">push(queue, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>): #      <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = queue.get_current_index() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>: #  ,    #    var = queue.at(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) #  = <span class="hljs-number"><span class="hljs-number">0</span></span>   , ..   # ,         <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> var.CAS_versioned(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>): #   ,    queue.update_index(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) break #   , .   <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = max(queue.get_current_index(), <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) update_index(queue, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>: #     cur_index, version = queue.get_current_index_versioned() #      , #  , .   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cur_index &gt;= <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: # -     , #        break <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> queue.current_index_var().CAS_versioned(<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>): #      ,   break # -  . # ,      ,  </code> </pre> <br><p style=";text-align:right;direction:rtl">      .   ,            (     โ ,  ,     ).       lock-free   .    ? </p><br><p style=";text-align:right;direction:rtl">   ,   <code>push</code>     ,      ! ,             ,      . </p><br><p style=";text-align:right;direction:rtl">        .       :         .   ,      -   ,  -               .  ,      , ..      .          .        ?       , ..     ,    ,        . </p><br><p style=";text-align:right;direction:rtl">  ,       ,          . ..    .        ,    ,     .          ,       . </p><br><p style=";text-align:right;direction:rtl">  ,       .               ,   .    ,   ,     .       ,    . </p><br><h2 id="vzaimodeystvie-ocheredey" style=";text-align:right;direction:rtl">   </h2><br><p style=";text-align:right;direction:rtl">  ,  ,   ,      . </p><br><p style=";text-align:right;direction:rtl"> <em></em> .       . </p><br><p style=";text-align:right;direction:rtl">    ,      : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  , ..  stateless. </li><li style=";text-align:right;direction:rtl">  ,     โ . </li></ol><br><p style=";text-align:right;direction:rtl"> ,    ,        <em>concurrent exactly-once</em> . </p><br><p style=";text-align:right;direction:rtl">        : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">handle(<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>, output): <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) output.push(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> += <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   .        : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">handle(<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>, output, state): #   <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = state.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) output.push(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> += <span class="hljs-number"><span class="hljs-number">1</span></span> #   state.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">     <em>exactly-once</em> .   ,           ,    ,    . </p><br><p style=";text-align:right;direction:rtl">    <em>exactly-once</em> ,     ,    . ..,  ,       ,       ,   ,    โ      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">#       get_next_index(queue): <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = queue.get_index() #     <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> queue.has(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>): #    queue.push <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = max(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>, queue.get_index()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> #      . #  <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>    push_at(queue, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>): var = queue.at(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> var.CAS_versioned(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>): #   queue.update_index(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> handle(<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>, output, state): #   #    {PREPARING, <span class="hljs-number"><span class="hljs-number">0</span></span>} fsm_state = state.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>: switch fsm_state: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> {PREPARING, input_index}: #   :   , #        output_index = output.get_next_index() fsm_state = {WRITING, input_index, output_index} <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> {WRITING, input_index, output_index}: <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(input_index) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> output.push_at(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, output_index): #  ,     input_index += <span class="hljs-number"><span class="hljs-number">1</span></span> #    ,  push_at  <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, #        fsm_state = {PREPARING, input_index} state.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(fsm_state)</code> </pre> <br><p style=";text-align:right;direction:rtl">        <code>push_at</code> ?      ,   .   ,    ,  ,    .   ,               .             .          -  ,     lock-free . </p><br><p style=";text-align:right;direction:rtl">  ,      : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">   :       . </li><li style=";text-align:right;direction:rtl"> ,  :      . </li></ol><br><p style=";text-align:right;direction:rtl">   :   <em>concurrent</em>  <em>exactly-once</em> . </p><br><p style=";text-align:right;direction:rtl">      ?   : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">       ,         ,   <code>push_at</code>     false.            . </li><li style=";text-align:right;direction:rtl">       ,      . ,   ,       . </li></ol><br><p style=";text-align:right;direction:rtl">     <em>concurrent exactly-once</em>   ?   ,     ,            .    ,           .            . </p><br><p style=";text-align:right;direction:rtl">          : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">#     ,  ,     # ..       <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, #      <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>. #       <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> push_at_idempotent(queue, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> queue.push_at(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> queue.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> handle(<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>, output, state): <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>, fsm_state = state.get_versioned() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>: switch fsm_state: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> {PREPARING, input_index}: #   ,   , #        output_index = output.get_next_index() fsm_state = {WRITING, input_index, output_index} <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> {WRITING, input_index, output_index}: <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(input_index) #   , #       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> output.push_at_idempotent(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, output_index): input_index += <span class="hljs-number"><span class="hljs-number">1</span></span> fsm_state = {PREPARING, input_index} #     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> state.CAS_versioned(<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>, fsm_state): <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: #   ,    <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>, fsm_state = state.get_versioned()</code> </pre> <br><p style=";text-align:right;direction:rtl">  : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/rx/qi/ub/rxqiubplbrrdlokp_sniqhktmvu.png" alt="ุจุณูุท"></p><br><p style=";text-align:right;direction:rtl">     ,     .     ,           . </p><br><p style=";text-align:right;direction:rtl">             kernel panic,   ,    ..              .              .       :      ,    .  ,        . </p><br><p style=";text-align:right;direction:rtl">  ,    <strong> </strong>    ,    . </p><br><h2 id="reshenie-nachalnoy-zadachi" style=";text-align:right;direction:rtl">    </h2><br><p style=";text-align:right;direction:rtl">        :    . </p><br><p style=";text-align:right;direction:rtl">       :  ,     ,    ,      ,      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">#  : # - input_queues -   # - output_queues -   # - state -    # - <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> -    : state, inputs -&gt; state, outputs handle(input_queues, output_queues, state, <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>): #        <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>, fsm_state = state.get_versioned() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>: switch fsm_state: # input_indexes       <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> {HANDLING, user_state, input_indexes}: #       inputs = [queue.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> queue, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> zip(input_queues, input_indexes)] #   ,    next_indexes = next(inputs, input_indexes) #    #     user_state, outputs = <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>(user_state, inputs) #      , #     fsm_state = {PREPARING, user_state, next_indexes, outputs, <span class="hljs-number"><span class="hljs-number">0</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> {PREPARING, user_state, input_indexes, outputs, output_pos}: #  ,      #    output_index = output_queues[output_pos].get_next_index() #     fsm_state = { WRITING, user_state, input_indexes, outputs, output_pos, output_index } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> { WRITING, user_state, input_indexes, outputs, output_pos, output_index }: <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = outputs[output_pos] #       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> output_queues[output_pos].push_at_idempotent( <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, output_index ): #  ,      output_pos += <span class="hljs-number"><span class="hljs-number">1</span></span> #    ,      PREPARING. #     #     fsm_state = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> output_pos == len(outputs): #   , #       {HANDLING, user_state, input_indexes} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: #       #   , #         {PREPARING, user_state, input_indexes, outputs, output_pos} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> state.CAS_versioned(<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>, fsm_state): <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: #   ,    <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>, fsm_state = state.get_versioned()</code> </pre> <br><p style=";text-align:right;direction:rtl">     : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/fe/mk/bg/femkbgvjaxyy2gi9ye5wkaufqf4.png" alt="ููุงุฆู"></p><br><p style=";text-align:right;direction:rtl">      : <code>HANDLING</code> .        , ..,  ,     .  ,      .    ,   <code>PREPARING</code>  <code>WRITING</code>   ,         .     ,      <code>HANDLING</code> . </p><br><p style=";text-align:right;direction:rtl">  ,      ,       ,          .   ,           .  ,            . </p><br><p style=";text-align:right;direction:rtl">      .         .               . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/or/qk/tg/orqktgqgrdw-9tv0_wkl2wt_rye.png" alt="ููุงุฆู"></p><br><p style=";text-align:right;direction:rtl">   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs cpp">my_handler(state, inputs): #      state.<span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>.push(inputs) #    duration state.<span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>.trim_time_window(duration) #   avg = state.<span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>.avg() need_update_counter = state.<span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>.size() &gt; size_boundary <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state, [ avg, <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> need_update_counter: <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: # none      none ]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,      ,           <em>concurrent exactly-once</em>     <code>handle</code> . </p><br><p style=";text-align:right;direction:rtl">        : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">handle_db(input_queue, db): <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>: #      tx = db.begin_transaction() #     . #      , #      <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = tx.get_current_index() #    tx.write_current_index(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) #      <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = intput_queue.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: #    tx.increment_counter() tx.<span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>() #   ,      , #          </code> </pre> <br><p style=";text-align:right;direction:rtl">    .  ูุฃู       ,         , , ,    <em>concurrent exactly-once</em> .       . </p><br><h2 id="za-bortom" style=";text-align:right;direction:rtl">   </h2><br><p style=";text-align:right;direction:rtl">   โ            .        ,      ,     . </p><br><h3 id="optimizacii-dlya-konkretnogo-hranilischa" style=";text-align:right;direction:rtl">     </h3><br><p style=";text-align:right;direction:rtl">      ,      ,       .           ,  ,          . </p><br><h3 id="asinhronnaya-publikaciya" style=";text-align:right;direction:rtl">   </h3><br><p style=";text-align:right;direction:rtl">           .    ,     .  ูุฃู        ,      .              .        . </p><br><h3 id="gruppirovka-znacheniy" style=";text-align:right;direction:rtl">   </h3><br><p style=";text-align:right;direction:rtl">        โ   . ,       ,     .    ,     -  ,   ,    .        , .. ,    ,        . </p><br><h3 id="dvoynoe-shardirovanie" style=";text-align:right;direction:rtl">   </h3><br><p style=";text-align:right;direction:rtl">       .   ,     ,           .            ,    ,    . </p><br><h2 id="fundamentalnost-podhoda" style=";text-align:right;direction:rtl">   </h2><br><p style=";text-align:right;direction:rtl">     . ,         .  :          ,      .     ,       . </p><br><p style=";text-align:right;direction:rtl">      ,   ,      : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">    ,   .          . </li><li style=";text-align:right;direction:rtl">     .      ,        . </li><li style=";text-align:right;direction:rtl">          .    ,       .      ,   ,        . ..          .     :    . </li></ol><br><p style=";text-align:right;direction:rtl">     , , -,     ,  -,     . </p><br><p style=";text-align:right;direction:rtl">     ,     .     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">transfer(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, amount): #   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> withdraw(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, amount) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> ok: #     , #    deposit(<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>, amount)</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>withdraw</code>     ,   ,  <code>deposit</code>    :      ?    <code>deposit</code>  -     (,   ,       ),    .  ,    ,    ,   ,        ?    ,   ,      - ,     . </p><br><p style=";text-align:right;direction:rtl">     ,   ,   ,     . ,     ,   ,   .   ,     .   ,       ,       .  ูุฃู     ,       ,        .      ,        :     ,     โ  . </p><br><h3 id="dvuhfaznost-bez-blokirovok" style=";text-align:right;direction:rtl">    </h3><br><p style=";text-align:right;direction:rtl">      ,       . </p><br><p style=";text-align:right;direction:rtl">      :        ,  ,     ,   ,   .   ,        -  : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <em></em> .            ,   , ,     ,     . </li><li style=";text-align:right;direction:rtl"> <em></em> .        . </li></ul><br><p style=";text-align:right;direction:rtl">     , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> . </p><br><p style=";text-align:right;direction:rtl"> ,        , ..       ,      ,  .        ,       . </p><br><p style=";text-align:right;direction:rtl">          :     lock-free   ,           .            , ..      ,  . </p><br><p style=";text-align:right;direction:rtl">      CAS       . ,      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs swift">#     ,    handle(input, output, state): # ... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> fsm_state: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> {<span class="hljs-type"><span class="hljs-type">HANDLING</span></span>, ...}: #      fsm_state = {<span class="hljs-type"><span class="hljs-type">PREPARING</span></span>, ...} <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> {<span class="hljs-type"><span class="hljs-type">PREPARING</span></span>, input_index}: #   ... output_index = ...get_next_index() fsm_state = {<span class="hljs-type"><span class="hljs-type">WRITING</span></span>, output_index, ...} <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> {<span class="hljs-type"><span class="hljs-type">WRITING</span></span>, output_index, ...}: #  ,  output_index</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,     .          .      : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <strong>PREPARING</strong> .     ,        . </li><li style=";text-align:right;direction:rtl"> <strong>WRITING</strong> .     .       ,       <strong>PREPARING</strong> . </li></ol><br><p style=";text-align:right;direction:rtl">     ,      . ,          ,     โ    .     : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">         .  ,    , ..     ,      . </li><li style=";text-align:right;direction:rtl">            , ..       .         ,     . </li></ol><br><p style=";text-align:right;direction:rtl">  ,  lock-free        ,        ,     . </p><br><h2 id="trebovaniya-k-konsistentnosti" style=";text-align:right;direction:rtl">    </h2><br><p style=";text-align:right;direction:rtl">  ,     .     ,      <em>Stale Read</em> ,       .   โ       CAS:              .       : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <em>Distributed single register</em> โ       (, etcd  Zookeeper): <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> Linearizability </li><li style=";text-align:right;direction:rtl"> Sequential consistency </li></ol></li><li style=";text-align:right;direction:rtl"> <em>Transactional</em> โ     (, MySQL, PostgreSQL  ..): <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> Serializability </li><li style=";text-align:right;direction:rtl"> Snapshot Isolation </li><li style=";text-align:right;direction:rtl"> Repeatable Read </li><li style=";text-align:right;direction:rtl"> Read Committed </li></ol></li><li style=";text-align:right;direction:rtl"> <em>Distributed Transactional</em> โ NewSQL : <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> Strict Consistency </li><li style=";text-align:right;direction:rtl">    </li></ol></li></ul><br><p style=";text-align:right;direction:rtl">   :             ?   ,  ,   .         ,    ,     CAS                .        , ,   <em>Read My Writes</em> . </p><br><h2 id="zaklyuchenie" style=";text-align:right;direction:rtl">  ุงูุฎูุงุตุฉ </h2><br><p style=";text-align:right;direction:rtl">        <em>exactly-once</em> .     , ..  ,  ,    ,    .       ,      ,  , , ..        ,     . </p><br><p style=";text-align:right;direction:rtl">       lock-free       . </p><br><p style=";text-align:right;direction:rtl">    : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <strong></strong> :      . </li><li style=";text-align:right;direction:rtl"> <strong></strong> :       . </li><li style=";text-align:right;direction:rtl"> <strong></strong> :        : <em>exactly-once</em> . </li><li style=";text-align:right;direction:rtl"> <strong>Concurrent</strong> :       . </li><li style=";text-align:right;direction:rtl"> <strong>Real-time</strong> :     . </li><li style=";text-align:right;direction:rtl"> <strong>Lock-free</strong> :      ,     . </li><li style=";text-align:right;direction:rtl"> <strong>Deadlock free</strong> :      ,      . </li><li style=";text-align:right;direction:rtl"> <strong>Race condition free</strong> :     . </li><li style=";text-align:right;direction:rtl"> <strong>Hot-hot</strong> :        . </li><li style=";text-align:right;direction:rtl"> <strong>Hard stop</strong> :       . </li><li style=";text-align:right;direction:rtl"> <strong>No failover</strong> :                  . </li><li style=";text-align:right;direction:rtl"> <strong>No downtime</strong> :    . </li><li style=";text-align:right;direction:rtl"> <strong> </strong> :   ,    . </li><li style=";text-align:right;direction:rtl"> <strong></strong> :         . </li><li style=";text-align:right;direction:rtl"> <strong></strong> :         . </li><li style=";text-align:right;direction:rtl"> <strong></strong> :        . </li></ol><br><p style=";text-align:right;direction:rtl">  ,        .  ููู ูุฐู ูุตุฉ ุฃุฎุฑู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ku/4j/nf/ku4jnf9-1pkdjfh_peshj0xd73w.jpeg" alt="ุฎููู"></p><br><h2 id="novye-terminy" style=";text-align:right;direction:rtl">   </h2><br><p style=";text-align:right;direction:rtl">       : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> Concurrent exactly-once. </li><li style=";text-align:right;direction:rtl"> Semi-transactions  . </li><li style=";text-align:right;direction:rtl"> Lock-free two-phase commit,       . </li></ol><br><h2 id="zadachi-dlya-samoistyazaniya" style=";text-align:right;direction:rtl">    </h2><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">     . </li><li style=";text-align:right;direction:rtl">  lock-free       . </li><li style=";text-align:right;direction:rtl">    . </li></ol><br><h2 id="literatura" style=";text-align:right;direction:rtl">  ุงูุฃุฏุจ </h2><br><p style=";text-align:right;direction:rtl"> [1] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">:  ABA.</a> <br> [2] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Blog: You Cannot Have Exactly-Once Delivery</a> <br> [3] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">:         .</a> <br> [4] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">:  3:  .</a> <br> [5] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">:  .</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar413817/">https://habr.com/ru/post/ar413817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar413807/index.html">ุชุญุฏูุฏ ุงูุฎุตุงุฆุต ุงูุจุงููุณุชูุฉ ุงูุฒูููุฉ ูุญุฑูุฉ ูุฑูุฒ ูุชูุฉ ุงููุจูุท ุงููุธูู ูู ุทุงุฆุฑุฉ</a></li>
<li><a href="../ar413809/index.html">ุฌูุงุฒ ูู ุงูุชุดููุฑ ูุงูุชุฌุงุฑุจ ูุน Android ูู ุญุงููุฉ LXC</a></li>
<li><a href="../ar413811/index.html">ููุฎุต ุงูููุงุฏ ุงูุทุงุฒุฌุฉ ูู ุนุงูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ููุฃุณุจูุน ุงููุงุถู ุฑูู 318 (4-10 ููููู 2018)</a></li>
<li><a href="../ar413813/index.html">ููุฎุต PHP ุฑูู 132 (27 ูุงูู - 10 ููููู 2018)</a></li>
<li><a href="../ar413815/index.html">ุงุฐูุจ ูุฑุดุฉ ุนูู ุงููุณุงููุฉ ูู ุฑูุณูุง</a></li>
<li><a href="../ar413819/index.html">ุจุตุฑุงุญุฉ ุนู ุณูู ุชูููููุฌูุง ุงููุนูููุงุช ูู ุฑูุณูุง</a></li>
<li><a href="../ar413823/index.html">ุงุฒุฏูุงุฑ ุงูุนูุงูุฉ ุงูุชู ูุง ูุนูู ููุง</a></li>
<li><a href="../ar413827/index.html">ูุจูุบ ุนูุฑ ูุดุฑูุน Kubernetes 4 ุณููุงุช</a></li>
<li><a href="../ar413831/index.html">ุณูุชู ุฅุทูุงู ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ ูู Tesla Autopilot ูู ุฃุบุณุทุณ ุ ูุฃูู ูุฑุฉ ูุน "ููุฒุงุช ุงูููุงุฏุฉ ุงูุฐุงุชูุฉ ุจุงููุงูู"</a></li>
<li><a href="../ar413837/index.html">ุฌุนู ุจุฑุฌ ุงูุฏูุงุน ูุนุจุฉ ูุญุฏุฉ - ุงูุฌุฒุก 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>