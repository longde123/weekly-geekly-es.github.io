<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø üêÇ üé≤ Sepuluh Hal yang Dapat Anda Lakukan Dengan GraalVM ü§µüèº üìå üé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dari penerjemah: GraalVM adalah teknologi baru yang menarik, tetapi di Habr√© tidak ada banyak artikel yang dapat menunjukkan contoh-contoh kemampuan G...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sepuluh Hal yang Dapat Anda Lakukan Dengan GraalVM</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/433432/"><p><img src="https://habrastorage.org/webt/7z/5d/ap/7z5dap05rvptsue50u6ajtsxsmw.png"><br>  <em>Dari penerjemah: GraalVM adalah teknologi baru yang menarik, tetapi di Habr√© tidak ada banyak artikel yang dapat menunjukkan contoh-contoh kemampuan Graal.</em>  <em>Artikel di bawah ini bukan hanya daftar apa yang dapat dilakukan GraalVM, tetapi juga kelas master kecil yang mirip dengan yang dilakukan Chris Seaton dan Oleg Shelaev di Oracle CodeOne 2018. Setelah penulis, saya mendorong Anda untuk mencoba membuat contoh dari artikel, itu benar-benar menarik</em> </p><br><p>  Ada banyak hal berbeda di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GraalVM</a> , dan jika Anda mendengar nama ini sebelumnya, atau bahkan melihat laporan, masih ada banyak hal yang mungkin belum Anda ketahui, tetapi yang dapat dilakukan GraalVM.  Pada artikel ini, kita akan melihat berbagai fitur yang disediakan GraalVM dan menunjukkan apa yang dapat Anda lakukan dengannya. </p><br><ol><li>  Eksekusi cepat Java </li><li>  Kurangi waktu mulai dan penggunaan memori untuk Java </li><li>  Menggabungkan JavaScript, Java, Ruby, dan R </li><li>  Eksekusi program yang ditulis dalam bahasa platform-spesifik </li><li>  Alat umum untuk semua bahasa pemrograman </li><li>  Suplemen Aplikasi JVM </li><li>  Aplikasi Ketergantungan Platform </li><li>  Kode Java sebagai pustaka khusus platform </li><li>  Dukungan untuk beberapa bahasa pemrograman dalam database </li><li>  Membuat bahasa pemrograman untuk GraalVM </li></ol><a name="habracut"></a><br><p>  Anda dapat melakukan semua yang ditampilkan dalam artikel ini menggunakan GraalVM 1.0.0 RC1, yang tersedia melalui tautan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari situs web GraalVM</a> .  Saya menggunakan MacOS Enterprise Edition, tetapi kode yang ditulis di sini akan berfungsi di Linux dan GraalVM Community Edition. </p><br><p>  Saat Anda membaca artikel, jalankan program yang dijelaskan di dalamnya!  Kode dapat diunduh dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> . </p><br><h2 id="ustanovka">  Instalasi </h2><br><p> Setelah mengunduh dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://graalvm.org/downloads,</a> saya menambahkan path ke executable GraalVM dalam <code>$PATH</code> .  Secara default, ini menambahkan dukungan untuk eksekusi Java dan JavaScript. </p><br><pre> <code class="plaintext hljs">$ git clone https://github.com/chrisseaton/graalvm-ten-things.git $ cd foo $ tar -zxf graalvm-ee-1.0.0-rc1-macos-amd64.tar.gz # or graalvm-ee-1.0.0-rc1-linux-amd64.tar.gz on Linux $ export PATH=graalvm-1.0.0-rc1/Contents/Home/bin:$PATH # or PATH=graalvm-1.0.0-rc1/bin:$PATH on Linux</code> </pre> <br><p>  GraalVM hadir dengan dukungan JavaScript bawaan dan berisi manajer paket bernama <code>gu</code> yang menambahkan kemampuan untuk menginstal dukungan untuk bahasa selain Java dan JavaScript.  Saya juga menginstal Ruby, Python dan R, mereka diunduh dari GitHub. </p><br><pre> <code class="plaintext hljs">$ gu install -c org.graalvm.ruby $ gu install -c org.graalvm.python $ gu install -c org.graalvm.R</code> </pre> <br><p>  Sekarang, jika Anda menjalankan perintah <code>java</code> atau <code>js</code> , Anda akan melihat versi GraalVM dari mesin ini. </p><br><pre> <code class="plaintext hljs">$ java -version java version "1.8.0_161" Java(TM) SE Runtime Environment (build 1.8.0_161-b12) GraalVM 1.0.0-rc1 (build 25.71-b01-internal-jvmci-0.42, mixed mode) $ js --version Graal JavaScript 1.0 (GraalVM 1.0.0-rc1)</code> </pre> <br><h2 id="1-bystroe-vypolnenie-java">  1. Eksekusi Java cepat </h2><br><p>  "Graal" di GraalVM adalah nama dari kompiler.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dia sendiri diciptakan untuk memerintah semua</a> !  Ini berarti bahwa ini adalah salah satu implementasi kompiler yang ditulis dalam bentuk perpustakaan yang dapat digunakan untuk banyak hal yang berbeda.  Sebagai contoh, kami menggunakan Graal untuk mengkompilasi <em>sebelumnya</em> dan <em>tepat waktu</em> untuk mengkompilasi kode yang ditulis dalam bahasa pemrograman yang berbeda, termasuk untuk arsitektur prosesor yang berbeda. </p><br><p>  Cara pertama dan termudah untuk menggunakan Graal adalah menggunakannya sebagai kompiler Java JIT. </p><br><p>  Sebagai contoh, kita akan menggunakan program yang menghasilkan 10 kata paling umum dalam sebuah dokumen.  Program ini menggunakan kemampuan bahasa Jawa modern, seperti Streaming dan koleksi. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.file.Files; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.file.Paths; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Function; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Collectors; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Stream; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Arrays.stream(args) .flatMap(TopTen::fileLines) .flatMap(line -&gt; Arrays.stream(line.split(<span class="hljs-string"><span class="hljs-string">"\\b"</span></span>))) .map(word -&gt; word.replaceAll(<span class="hljs-string"><span class="hljs-string">"[^a-zA-Z]"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) .filter(word -&gt; word.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) .map(word -&gt; word.toLowerCase()) .collect(Collectors.groupingBy(Function.identity(), Collectors.counting())) .entrySet().stream() .sorted((a, b) -&gt; -a.getValue().compareTo(b.getValue())) .limit(<span class="hljs-number"><span class="hljs-number">10</span></span>) .forEach(e -&gt; System.out.format(<span class="hljs-string"><span class="hljs-string">"%s = %d%n"</span></span>, e.getKey(), e.getValue())); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Stream&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String path)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Files.lines(Paths.get(path)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(e); } } }</code> </pre> <br><p>  GraalVM termasuk kompiler <code>javac</code> , tetapi tidak ada perbedaan untuk demo ini apakah akan menggunakannya atau kompiler standar.  Oleh karena itu, Anda dapat menggunakan kompiler <code>javac</code> standar jika Anda mau. </p><br><pre> <code class="plaintext hljs">$ javac TopTen.java</code> </pre> <br><p>  Jika kita menjalankan perintah <code>java</code> , yang termasuk dalam GraalVM, maka kompiler Grait JIT akan digunakan secara otomatis - tidak diperlukan langkah-langkah tambahan.  Saya akan menggunakan perintah <code>time</code> untuk mendapatkan data nyata tentang waktu yang dihabiskan untuk menjalankan program dari awal sampai akhir, alih-alih menggunakan microbenchmark yang kompleks.  Sejumlah besar input juga akan digunakan sehingga tidak ada sindiran tentang beberapa detik yang disimpan di sini atau di sana.  Ukuran file <code>large.txt</code> adalah 150 MB. </p><br><pre> <code class="plaintext hljs">$ make large.txt $ time java TopTen large.txt sed = 502701 ut = 392657 in = 377651 et = 352641 id = 317627 eu = 317627 eget = 302621 vel = 300120 a = 287615 sit = 282613 real 0m17.367s user 0m32.355s sys 0m1.456s</code> </pre> <br><p>  Graal ditulis dalam Java, bukan C ++, seperti kebanyakan kompiler JIT lainnya untuk Java.  Kami berpikir bahwa ini memungkinkan kami untuk memperbaikinya lebih cepat daripada kompiler yang ada, menambahkan optimisasi kuat baru (seperti, misalnya, analisis pelarian parsial) yang tidak tersedia dalam kompiler JIT standar untuk HotSpot. <br>  Dan ini dapat membuat program Java Anda lebih cepat. </p><br><p>  Untuk tujuan perbandingan, untuk menjalankan program tanpa kompiler Grait JIT, saya akan menggunakan <code>-XX:-UseJVMCICompiler</code> .  JVMCI adalah antarmuka antara Graal dan JVM.  Anda juga dapat menjalankan contoh pada JVM standar dan membandingkan hasilnya. </p><br><pre> <code class="plaintext hljs">$ time java -XX:-UseJVMCICompiler TopTen large.txt sed = 502701 ut = 392657 in = 377651 et = 352641 id = 317627 eu = 317627 eget = 302621 vel = 300120 a = 287615 sit = 282613 real 0m23.511s user 0m24.293s sys 0m0.579s</code> </pre> <br><p>  Tes ini menunjukkan bahwa Graal menjalankan program Java kami dalam waktu sekitar tiga perempat waktu yang dibutuhkan untuk menjalankannya dengan kompiler HotSpot standar.  Di mana kami percaya bahwa meningkatkan produktivitas dengan satuan persen adalah pencapaian yang signifikan, 25% adalah masalah besar. </p><br><p>  Twitter adalah satu-satunya perusahaan saat ini yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menggunakan Graal di server "pertempuran"</a> , dan mereka mengatakan itu dibenarkan untuk mereka, dalam hal menghemat uang nyata.  Twitter menggunakan Graal untuk menjalankan aplikasi yang ditulis dalam Scala - Graal bekerja pada level bytecode JVM, yaitu  berlaku untuk bahasa JVM apa pun. </p><br><p>  Ini adalah kasus penggunaan pertama untuk GraalVM - cukup mengganti kompiler JIT dengan versi yang lebih baik untuk aplikasi Java yang ada. </p><br><h2 id="2-umenshenie-vremeni-starta-i-potrebleniya-pamyati-dlya-java">  2. Kurangi waktu mulai dan penggunaan memori untuk Java </h2><br><p>  Kekuatan platform Java terutama terlihat ketika bekerja dengan proses yang berjalan lama dan beban puncak.  Proses jangka pendek, sebaliknya, menderita waktu startup yang lama dan penggunaan memori yang relatif tinggi. </p><br><p>  Sebagai contoh, jika kita menjalankan aplikasi dari bagian sebelumnya, mengumpankannya dengan jumlah input data yang jauh lebih kecil - sekitar 1Kb dan bukannya 150MB, maka tampaknya itu akan memakan waktu terlalu lama dan cukup banyak memori - sekitar 60MB, untuk memproses file sekecil itu. .  Kami menggunakan opsi <code>-l</code> untuk mencetak jumlah memori yang digunakan selain waktu eksekusi. </p><br><pre> <code class="plaintext hljs">$ make small.txt $ /usr/bin/time -l java TopTen small.txt # -v on Linux instead of -l sed = 6 sit = 6 amet = 6 mauris = 3 volutpat = 3 vitae = 3 dolor = 3 libero = 3 tempor = 2 suscipit = 2 0.32 real 0.49 user 0.05 sys 59846656 maximum resident set size</code> </pre> <br><p>  GraalVM memberi kita alat yang memecahkan masalah ini.  Kami mengatakan bahwa Graal adalah perpustakaan kompiler dan dapat digunakan dengan berbagai cara.  Salah satunya adalah mengkompilasi <em>di muka menjadi</em> image yang dapat dieksekusi yang <em>bergantung pada</em> platform, alih-alih mengkompilasi <em>just-in-time</em> pada saat run time.  Ini mirip dengan cara kerja kompiler biasa, seperti <code>gcc</code> . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server TopTen classlist: 1,513.82 ms (cap): 2,333.95 ms setup: 3,584.09 ms (typeflow): 4,642.13 ms (objects): 3,073.58 ms (features): 156.34 ms analysis: 8,059.94 ms universe: 353.02 ms (parse): 1,277.02 ms (inline): 1,412.08 ms (compile): 10,337.76 ms compile: 13,776.23 ms image: 2,526.63 ms write: 1,525.03 ms [total]: 31,439.47 ms</code> </pre> <br><p>  Perintah ini menciptakan <code>topten</code> platform- <code>topten</code> disebut <code>topten</code> .  File ini tidak memulai JVM, tidak tertaut ke JVM, dan tidak termasuk JVM dengan cara apa pun.  Perintah <code>native-image</code> benar-benar mengkompilasi kode Java Anda dan perpustakaan Java yang Anda gunakan menjadi kode mesin lengkap.  Untuk komponen runtime seperti pengumpul sampah, kami meluncurkan VM baru kami sendiri yang disebut SubstrateVM, yang, seperti Graal, juga ditulis dalam Java. </p><br><p>  Jika Anda melihat dependensi yang menggunakan <code>topten</code> , Anda akan melihat bahwa ini hanya pustaka sistem standar.  Kami hanya dapat mentransfer file yang satu ini ke sistem di mana JVM belum pernah diinstal dan menjalankannya di sana untuk memverifikasi bahwa itu tidak menggunakan JVM atau file lain.  <code>Topten</code> juga cukup kecil - kode yang dapat dieksekusi memakan waktu kurang dari 6 MB. </p><br><pre> <code class="plaintext hljs">$ otool -L topten # ldd topten on Linux topten: .../CoreFoundation.framework ... .../libz.1.dylib ... .../libSystem.B.dylib ... $ du -h topten 5.7M topten</code> </pre> <br><p>  Jika kita menjalankan executable ini, kita akan melihat bahwa itu memulai tentang urutan besarnya lebih cepat dan menggunakan sekitar urutan besarnya lebih sedikit memori daripada program yang sama berjalan di bawah JVM.  Peluncuran ini sangat cepat sehingga Anda tidak akan memperhatikan berapa lama.  Jika Anda menggunakan baris perintah, Anda tidak akan merasakan jeda yang biasanya hadir ketika Anda menjalankan program kecil, berumur pendek di bawah JVM </p><br><pre> <code class="plaintext hljs">$ /usr/bin/time -l ./topten small.txt sed = 6 sit = 6 amet = 6 mauris = 3 volutpat = 3 vitae = 3 dolor = 3 libero = 3 tempor = 2 suscipit = 2 0.02 real 0.00 user 0.00 sys 4702208 maximum resident set size</code> </pre> <br><p>  Utilitas <code>native-image</code> memiliki beberapa <a href="">keterbatasan</a> .  Jadi, pada waktu kompilasi Anda harus memiliki semua kelas hadir, ada juga pembatasan penggunaan API Refleksi.  Tetapi ada beberapa keuntungan tambahan atas kompilasi dasar, seperti pelaksanaan initialisator statis pada waktu kompilasi.  Dengan demikian, jumlah pekerjaan yang dilakukan setiap kali aplikasi diunduh berkurang. </p><br><p>  Ini adalah aplikasi kedua GraalVM - distribusi dan eksekusi program Java yang ada, dengan awal yang cepat dan konsumsi memori yang lebih sedikit.  Metode ini memperbaiki masalah konfigurasi seperti menemukan tabung yang tepat saat runtime, dan juga memungkinkan Anda membuat gambar buruh pelabuhan yang lebih kecil. </p><br><h2 id="3-kombinirovanie-javascript-java-ruby-i-r">  3. Menggabungkan JavaScript, Java, Ruby, dan R </h2><br><p>  Bersama dengan Java, GraalVM mencakup implementasi baru JavaScript, Ruby, R, dan mesin Python.  Mereka ditulis menggunakan kerangka kerja baru yang disebut <em>Truffle</em> .  Kerangka kerja ini memungkinkan untuk membuat juru bahasa yang sederhana dan berkinerja tinggi.  Ketika Anda menulis juru bahasa menggunakan Truffle, itu akan secara otomatis menggunakan Graal untuk memberikan kompilasi JIT untuk bahasa Anda.  Jadi, Graal tidak hanya kompiler JIT dan kompiler AOT untuk Java, itu juga bisa menjadi kompiler JIT untuk JavaScript, Ruby, R dan Python. </p><br><p>  Dukungan untuk bahasa pihak ketiga di GraalVM bertujuan untuk menjadi pengganti yang transparan untuk mesin yang ada untuk pelaksanaan berbagai bahasa.  Sebagai contoh, kita dapat menginstal modul "warna" untuk Node.js: </p><br><pre> <code class="plaintext hljs">$ npm install --global color ... + color@3.0.0 added 6 packages in 14.156s</code> </pre> <br><p>  Kemudian tulis sebuah program menggunakan modul ini untuk mengubah warna RGB HTML ke HSL: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Color = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'color'</span></span>); process.argv.slice(<span class="hljs-number"><span class="hljs-number">2</span></span>).forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">) </span></span>{ print(Color(val).hsl().string()); });</code> </pre> <br><p>  Dan jalankan dengan cara biasa: </p><br><pre> <code class="plaintext hljs">$ node color.js '#42aaf4' hsl(204.89999999999998, 89%, 60.8%)</code> </pre> <br><p>  Mesin eksekusi berbagai bahasa di GraalVM bekerja bersama - ada API yang memungkinkan Anda menjalankan kode dari satu bahasa dalam program yang ditulis dalam bahasa lain.  Dan ini memungkinkan Anda untuk menulis program multibahasa - program yang ditulis dalam lebih dari satu bahasa pemrograman. </p><br><p>  Ini mungkin diperlukan jika Anda menulis sebagian besar program Anda dalam satu bahasa, tetapi ingin menggunakan perpustakaan yang ditulis dalam bahasa pemrograman lain.  Sebagai contoh, misalkan kita perlu menulis aplikasi untuk mengonversi nama warna dari CSS ke representasi numeriknya di Node.js, tetapi kami ingin menggunakan pustaka warna Ruby alih-alih menulis konversi sendiri. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = express(); color_rgb = Polyglot.eval(<span class="hljs-string"><span class="hljs-string">'ruby'</span></span>, <span class="hljs-string"><span class="hljs-string">` require 'color' Color::RGB `</span></span>); app.get(<span class="hljs-string"><span class="hljs-string">'/css/:name'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ color = color_rgb.by_name(req.params.name).html() res.send(<span class="hljs-string"><span class="hljs-string">'&lt;h1 style="color: '</span></span> + color + <span class="hljs-string"><span class="hljs-string">'" &gt;'</span></span> + color + <span class="hljs-string"><span class="hljs-string">'&lt;/h1&gt;'</span></span>); }); app.listen(<span class="hljs-number"><span class="hljs-number">8080</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'serving at http://localhost:8080'</span></span>) });</code> </pre> <br><p>  Dalam kode ini, kami menulis bahwa kami perlu mengeksekusi kode Ruby sebagai string, tetapi perhatikan bahwa kami tidak melakukan banyak hal di sini - kami hanya menghubungkan pustaka dan kemudian mengembalikan objek Ruby.  Di Ruby, kita akan menggunakannya seperti ini: <code>Color::RGB.by_name (name).html</code> .  Jika Anda melihat bagaimana <code>color_rgb</code> digunakan nanti dalam JavaScript, Anda akan melihat bahwa kami benar-benar memanggil metode yang sama dari JavaScript, meskipun ini adalah objek dan metode Ruby.  Dan kami meneruskannya sebagai string JavaScript dan menggabungkan hasilnya, yang merupakan string Ruby, dengan string JavaScript. </p><br><p>  Instal kedua dependensi - Ruby dan JavaScript. </p><br><pre> <code class="plaintext hljs">$ gem install color Fetching: color-1.8.gem (100%) Successfully installed color-1.8 1 gem installed $ npm install express + express@4.16.2 updated 1 package in 10.393s</code> </pre> <br><p>  Maka Anda perlu memulai <code>node</code> dengan beberapa opsi tambahan: <code>--polyglot</code> , untuk mengatakan bahwa kami memerlukan akses ke bahasa lain dan <code>--jvm</code> , karena gambar <code>node</code> dapat dieksekusi secara default tidak menyertakan apa pun selain JavaScript. </p><br><pre> <code class="plaintext hljs">$ node --polyglot --jvm color-server.js serving at http://localhost:8080</code> </pre> <br><p>  Dan kemudian pergi ke URL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http: // localhost: 8080 / css / orange</a> (atau warna lain), seperti biasa, di browser Anda. <br><img src="https://habrastorage.org/webt/_h/uz/e2/_huze29ugzgpz8ecll22rpv6s1w.png"><br>  Mari kita coba membuat contoh yang lebih serius, yang menggunakan lebih banyak bahasa dan modul. </p><br><p>  JavaScript tidak mendukung bilangan bulat yang sangat besar.  Saya menemukan beberapa modul seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">big-integer</a> , tetapi semuanya tidak efisien karena  menyimpan komponen suatu angka sebagai angka titik apung JavaScript.  Kelas <code>BigInteger</code> di Jawa lebih efisien, mari kita gunakan untuk melakukan beberapa operasi aritmatika dengan bilangan bulat besar. </p><br><p>  JavaScript juga tidak memiliki dukungan bawaan untuk menggambar grafik, sementara R dengan baik menggambar grafik.  Mari kita gunakan modul <code>svg</code> dari R untuk menggambar sebidang sebaran fungsi trigonometri dalam ruang 3D. </p><br><p>  Dalam kedua kasus, kami akan menggunakan API untuk mendukung multibahasa dari GraalVM (selanjutnya disebut sebagai Polyglot API) dan kami hanya dapat memasukkan hasil pelaksanaan program dalam bahasa lain ke dalam JavaScript. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BigInteger = Java.type(<span class="hljs-string"><span class="hljs-string">'java.math.BigInteger'</span></span>) app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = <span class="hljs-string"><span class="hljs-string">'Hello World from Graal.js!&lt;br&gt; '</span></span> <span class="hljs-comment"><span class="hljs-comment">// Using Java standard library classes text += BigInteger.valueOf(10).pow(100) .add(BigInteger.valueOf(43)).toString() + '&lt;br&gt;' // Using R interoperability to create graphs text += Polyglot.eval('R', `svg(); require(lattice); x &lt;- 1:100 y &lt;- sin(x/10) z &lt;- cos(x^1.3/(runif(1)*5+10)) print(cloud(x~y*z, main="cloud plot")) grDevices:::svg.off() `); res.send(text) }) app.listen(3000, function () { console.log('Example app listening on port 3000!') })</span></span></code> </pre> <br><p>  Buka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http: // localhost: 3000 /</a> di browser Anda untuk melihat hasilnya: <br><img src="https://habrastorage.org/webt/1o/so/fj/1osofjuimjcfd7pv1qhcikonupo.png"><br>  Ini adalah hal ketiga yang dapat kita lakukan dengan GraalVM - menjalankan program yang ditulis dalam beberapa bahasa dan menggunakan modul dari bahasa ini bersama dalam satu program.  Kami menyajikan ini sebagai cara untuk menyatukan lingkungan runtime dan pustaka - Anda dapat menggunakan bahasa pemrograman yang menurut Anda paling cocok untuk menyelesaikan tugas saat ini dan pustaka apa pun yang Anda inginkan, terlepas dari bahasa pemrograman yang digunakan. </p><br><h2 id="4-ispolnenie-programm-napisannyh-na-platformo-zavisimyh-yazykah">  4. Eksekusi program yang ditulis dalam bahasa platform-spesifik </h2><br><p>  Bahasa lain yang didukung GraalVM adalah C. GraalVM dapat mengeksekusi kode C dengan cara yang sama seperti mengeksekusi program yang ditulis dalam JavaScript dan Ruby. </p><br><p>  Apa yang sebenarnya didukung GraalVM adalah eksekusi kode yang dihasilkan dari eksekusi utilitas LLVM, mis.  bitcode, bukan dukungan langsung untuk C. Ini berarti Anda dapat menggunakan alat yang ada untuk bahasa C dan lainnya yang mendukung LLVM, seperti C ++, Fortran dan, berpotensi, lebih banyak bahasa di masa depan.  Demi kesederhanaan demonstrasi, saya menjalankan versi khusus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">gzip</a> , yang dirakit dalam satu file ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Stephen McCamant</a> mendukung versi ini).  Ini hanya kode sumber <code>gzip</code> dan konfigurasi <code>autoconf</code> digabungkan menjadi satu file untuk kesederhanaan.  Saya harus menambal beberapa hal untuk membuatnya bekerja pada macOS dan dengan dentang, tapi saya tidak melakukan apa pun secara khusus untuk mendukung GraalVM. </p><br><p>  Kami mengkompilasi gzip menggunakan <code>clang</code> standar (kompiler LLVM untuk C) dan ingin itu membuat kami menjadi bitcode LLVM, dan bukan membangun platform-spesifik, karena GraalVM tidak akan meluncurkannya.  Saya menggunakan <code>clang</code> 4.0.1. </p><br><pre> <code class="plaintext hljs">$ clang -c -emit-llvm gzip.c</code> </pre> <br><p>  Dan kemudian jalankan hasilnya, langsung menggunakan perintah lli (LLVM bitcode interpreter) dari GraalVM.  Mari kita coba kompres file menggunakan pengarsip sistem gzip saya, dan kemudian unzip menggunakan gzip yang berjalan di bawah GraalVM. </p><br><pre> <code class="plaintext hljs">$ cat small.txt Lorem ipsum dolor sit amet... $ gzip small.txt $ lli gzip.bc -d small.txt.gz $ cat small.txt Lorem ipsum dolor sit amet...</code> </pre> <br><p>  Implementasi Ruby dan Python di GraalVM menggunakan teknik yang sama untuk menjalankan ekstensi yang ditulis dalam C untuk bahasa-bahasa ini.  Ini berarti bahwa Anda dapat menjalankan ekstensi ini di dalam VM dan ini memungkinkan kami untuk mempertahankan kecepatan eksekusi yang tinggi bahkan jika kami menggunakan antarmuka ekstensi khusus platform yang sudah kedaluwarsa. </p><br><p>  Ini adalah cara keempat untuk menggunakan GraalVM - menjalankan program yang ditulis dalam bahasa platform khusus, seperti C atau C ++, serta meluncurkan ekstensi ke bahasa seperti Python atau Ruby, yang tidak dapat membuat implementasi JVM dari bahasa ini, seperti JRuby. </p><br><h2 id="5-obschie-instrumenty-dlya-vseh-yazykov-programmirovaniya">  5. Alat umum untuk semua bahasa pemrograman </h2><br><p>  Jika Anda memprogram di Jawa, maka Anda mungkin menggunakan alat yang sangat berkualitas tinggi seperti IDE, debugger, dan profiler.  Tidak semua bahasa memiliki toolkit ini, tetapi Anda bisa mendapatkannya jika menggunakan bahasa yang didukung oleh GraalVM. </p><br><p>  Dukungan untuk semua bahasa di GraalVM (kecuali Java, saat ini) diimplementasikan menggunakan kerangka kerja umum - Truffle.  Ini memungkinkan kami membuat fungsionalitas, misalnya, debugger, sekali dan menggunakannya untuk semua bahasa. </p><br><p>  Untuk mencoba ini, kami akan menulis program yang paling sederhana - <em>FizzBuzz</em> , karena ini visual (ia mencetak sesuatu di layar) dan memiliki cabang yang jelas yang hanya digunakan dalam beberapa iterasi.  Dengan demikian, akan lebih mudah bagi kita untuk mengatur breakpoint.  Mari kita mulai dengan implementasi JavaScript. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fizzbuzz</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((n % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; (n % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'FizzBuzz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Fizz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Buzz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-number"><span class="hljs-number">1</span></span>; n &lt;= <span class="hljs-number"><span class="hljs-number">20</span></span>; n++) { print(fizzbuzz(n)); }</code> </pre> <br><p>  Kami memulai program seperti biasa, menggunakan utilitas <code>js</code> , di bawah GraalVM. </p><br><pre> <code class="plaintext hljs">$ js fizzbuzz.js 1 2 Fizz 4 Buzz Fizz</code> </pre> <br><p>  Kita juga dapat menjalankan program dengan flag <code>--inspect</code> .  Ini akan memberi kami tautan yang dapat Anda buka di Chrome dan menghentikan program di debugger. </p><br><pre> <code class="plaintext hljs">$ js --inspect fizzbuzz.js Debugger listening on port 9229. To start debugging, open the following URL in Chrome: chrome-devtools://devtools/bundled/inspector.html?ws=127.0.0.1:9229/6c478d4e-1350b196b409</code> </pre> <br><p>  Anda dapat mengatur breakpoint dalam kode <em>FizzBuzz</em> dan kemudian melanjutkan eksekusi.  Ketika program menghentikan eksekusi, kita akan melihat nilai variabel <code>n</code> di debugger dan kita dapat melanjutkan eksekusi program atau mempelajari antarmuka debugger. <br><img src="https://habrastorage.org/webt/kn/nq/so/knnqsotzl0j-k8e4y83a1ziz97w.png"><br>  Debugger di Chrome biasanya digunakan untuk JavaScript, tetapi untuk GraalVM di JavaScript tidak ada yang berbeda dari bahasa lain.  Bendera <code>--inspect</code> juga tersedia dan berfungsi dalam implementasi Python, Ruby, dan R. Saya tidak akan menunjukkan kepada Anda sumber dari setiap program, tetapi mereka menjalankan cara yang sama dan Anda mendapatkan debugger yang sama di Chrome untuk masing-masingnya. </p><br><pre> <code class="plaintext hljs">$ graalpython --jvm --inspect fizzbuzz.py</code> </pre> <br><p><img src="https://habrastorage.org/webt/6t/fx/2m/6tfx2m4btthox9mxxkweqehwjgm.png"></p><br><pre> <code class="plaintext hljs">$ ruby --inspect fizzbuzz.rb</code> </pre> <br><p><img src="https://habrastorage.org/webt/2z/_z/ti/2z_ztia4yk9fqomzo_vxj9c7mb0.png"></p><br><pre> <code class="plaintext hljs">$ Rscript --inspect fizzbuzz.r</code> </pre> <br><p><img src="https://habrastorage.org/webt/rg/12/wn/rg12wnspfc176rtrz7uww4qymo0.png"><br>  Alat lain yang mungkin Anda kenal dari Jawa adalah VisualVM.  Ini menyediakan antarmuka pengguna di mana Anda dapat bergabung dengan JVM yang berjalan pada mesin lokal Anda atau melalui jaringan untuk memeriksa berbagai aspek pelaksanaan program, seperti penggunaan memori atau eksekusi thread. </p><br><p>  GraalVM menyertakan VisualVM sebagai utilitas <code>jvisualvm</code> standar. </p><br><pre> <code class="plaintext hljs">$ jvisualvm &amp;&gt; /dev/null &amp;</code> </pre> <br><p>  Jika kita menjalankan VisualVM ketika program Java <code>TopTen</code> , maka kita dapat mengamati penggunaan memori atau, misalnya, mengambil snapshot dari isi memori dan melihat jenis objek yang kita gunakan memori pada heap. </p><br><pre> <code class="plaintext hljs">$ java TopTen large.txt</code> </pre> <br><p><img src="https://habrastorage.org/webt/gd/-5/ld/gd-5ldwlrn3y9szdaoqrmd_7res.png"><br>  Saya menulis program ini di Ruby untuk menghasilkan beberapa sampah di memori saat runtime. </p><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'erb'</span></span> x = <span class="hljs-number"><span class="hljs-number">42</span></span> template = ERB.new &lt;&lt;-EOF The value of x <span class="hljs-symbol"><span class="hljs-symbol">is:</span></span> &lt;%= x %&gt; EOF loop <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> puts template.result(binding) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Jika Anda menjalankan implementasi standar Ruby pada JVM - JRuby, Anda akan kecewa dengan VisualVM karena Anda hanya akan melihat objek Java internal alih-alih objek dalam bahasa Anda. </p><br><p>  Jika Anda menggunakan versi Ruby untuk GraalVM, maka VisualVM mengenali objek Ruby.  Kita perlu menggunakan opsi <code>--jvm</code> untuk menggunakan VisualVM, sebagai  itu tidak mendukung versi asli Ruby. </p><br><pre> <code class="plaintext hljs">$ ruby --jvm render.rb</code> </pre> <br><p> ,  ,       Java ,    , ,   Summary,   Ruby Heap       Ruby . <br><img src="https://habrastorage.org/webt/ge/d4/xc/ged4xcxp5ylkaxjxyxd5b8v3kyo.png"><br>  Truffle ‚Äî  -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nexus</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  </a> .         Truffle      ,  ,   API Truffle'  ,         ,   Truffle,         . </p><br><p> ,   GraalVM ‚Äî         ,       .   Truffle  GraalVM      ,       VisualVM. </p><br><h2 id="6-dopolnenie-jvm-prilozheniy"> 6.  JVM  </h2><br><p>   ,   ,   ,        Java .  API   <code>org.graalvm.polyglot</code>      ,         . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.polyglot.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.polyglot.Value; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtendJava</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ String language = <span class="hljs-string"><span class="hljs-string">"js"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (Context context = Context.newBuilder().allowNativeAccess(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>).build()) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String arg: args) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg.startsWith(<span class="hljs-string"><span class="hljs-string">"-"</span></span>)) { language = arg.substring(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Value v = context.eval(language, arg); System.out.println(v); } } } } }</code> </pre> <br><p>    <code>javac</code>  <code>java</code>   GraalVM,   <code>org.graalvm.*</code>     <code>classpath</code> , ..          . </p><br><pre> <code class="plaintext hljs">$ javac ExtendJava.java $ java ExtendJava '14 + 2' 16 $ java ExtendJava -js 'Math.sqrt(14)' 3.7416573867739413 $ java ExtendJava -python '[2**n for n in range(0, 8)]' [1, 2, 4, 8, 16, 32, 64, 128] $ java ExtendJava -ruby '[4, 2, 3].sort' [2, 3, 4]</code> </pre> <br><p> ,        ‚Äî     ,      <code>node</code>  <code>ruby</code> ,  GraalVM. </p><br><p>     GraalVM ‚Äî             Java . Polyglot API     ‚Äú‚Äù      Java ,       . </p><br><h2 id="7-dopolnenie-platformo-zavisimyh-prilozheniy"> 7.  -  </h2><br><p>  GraalVM    ,  ,    ‚Äî  ,        ,  GraalVM,  - . ,  JavaScript ,  V8,  Python ‚Äî CPython     , ..          . GraalVM           ‚Äî      Polyglot . </p><br><p>    GraalVM,       ,         JavaScript.    Polyglot ,    ,  : </p><br><pre> <code class="plaintext hljs">$ graalvm-1.0.0-rc1/Contents/Home/jre/lib/svm/bin/rebuild-images libpolyglot</code> </pre> <br><p>     C,   ,    ,  GraalVM,     .       <code>ExtendJava</code>   ,    ,   . </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;polyglot_api.h&gt; int main(int argc, char **argv) { graal_isolate_t *isolate = NULL; graal_isolatethread_t *thread = NULL; if (graal_create_isolate(NULL, &amp;isolate) != 0 || (thread = graal_current_thread(isolate)) == NULL) { fprintf(stderr, "initialization error\n"); return 1; } poly_context context = NULL; if (poly_create_context(thread, NULL, 0, &amp;context) != poly_ok) { fprintf(stderr, "initialization error\n"); return 1; } char* language = "js"; for (int n = 1; n &lt; argc; n++) { if (argv[n][0] == '-') { language = &amp;argv[n][1]; } else { poly_value result = NULL; if (poly_context_eval(thread, context, language, "unicalc", argv[n], &amp;result) != poly_ok) { fprintf(stderr, "eval error\n"); return 1; } char buffer[1024]; size_t length; if (poly_value_to_string_utf8(thread, result, buffer, sizeof(buffer), &amp;length) != poly_ok) { fprintf(stderr, "to string error\n"); return 1; } buffer[length] = '\0'; printf("%s\n", buffer); poly_destroy_handle(thread, result); } } return 0; }</span></span></span></span></code> </pre> </div></div><br><p>      ,       polyglot   GraalVM.  , ,    JVM. </p><br><pre> <code class="plaintext hljs">$ clang -Igraalvm-1.0.0-rc1/Contents/Home/jre/lib/polyglot / -rpath graalvm-1.0.0-rc1/Contents/Home / -Lgraalvm-1.0.0-rc1/Contents/Home/jre/lib/polyglot / -lpolyglot extendc.c -o extendc $ otool -L extendc extendc: .../libpolyglot.dylib ... .../libSystem.B.dylib ...</code> </pre> <br><pre> <code class="plaintext hljs">$ ./extendc '14 + 2' 16 $ ./extendc -js 'Math.sqrt(14)' 3.7416573867739413 $ ./extendc -python '[2**n for n in range(0, 8)]' [1, 2, 4, 8, 16, 32, 64, 128]</code> </pre> <br><p>   ,      GraalVM ‚Äî  -    ,    ,  GraalVM. </p><br><h2 id="8-kod-na-java-kak-platformo-zavisimaya-biblioteka"> 8.   Java  -  </h2><br><p>  Java        , , ,    ,  - ,      .     Java   - ,     JVM   ,         . </p><br><p> GraalVM    Java ,   ,      - ,          .      ,    ,    Java    JVM. </p><br><p>   ,     Apache SIS    ,     ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a> )     .   SIS 0.8,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://sis.apache.org/</a>     jar. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.sis.distance.DistanceUtils; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Distance</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> aLat = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> aLong = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> bLat = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> bLong = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">3</span></span>]); System.out.printf(<span class="hljs-string"><span class="hljs-string">"%.2f km%n"</span></span>, DistanceUtils.getHaversineDistance(aLat, aLong, bLat, bLong)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IsolateThread thread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aLat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aLong, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bLat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bLong)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DistanceUtils.getHaversineDistance(aLat, aLong, bLat, bLong); } }</code> </pre> <br><p>      ,       - </p><br><pre> <code class="plaintext hljs">$ javac -cp sis.jar -parameters Distance.java $ java -cp sis.jar:. Distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>       ,      <code>topten</code> . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server -cp sis.jar:. Distance ... $ ./distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>      ,    .   ,        <code>@CEntryPoint</code> </p><br><pre> <code class="java hljs">... <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.nativeimage.IsolateThread; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.nativeimage.c.function.CEntryPoint; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Distance</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@CEntryPoint</span></span>(name = <span class="hljs-string"><span class="hljs-string">"distance"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IsolateThread thread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a_lat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a_long, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b_lat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b_long)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DistanceUtils.getHaversineDistance(a_lat, a_long, b_lat, b_long); } ... }</code> </pre> <br><p>      <code>javac</code> ,   GraalVM    API  <code>classpath</code> . C         . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server -cp sis.jar:. -H:Kind=SHARED_LIBRARY \ -H:Name=libdistance $ otool -L libdistance.dylib # .so on Linux libdistance.dylib: .../libdistance.dylib ... .../CoreFoundation.framework ... .../libz.1.dylib ... .../libSystem.B.dylib ... $ du -h libdistance.dylib 4.8M libdistance.dylib</code> </pre> <br><p>      ,     .     ,    :   VM   ,      ,           . </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;libdistance.h&gt; int main(int argc, char **argv) { graal_isolate_t *isolate = NULL; graal_isolatethread_t *thread = NULL; if (graal_create_isolate(NULL, &amp;isolate) != 0 || (thread = graal_current_thread(isolate)) == NULL) { fprintf(stderr, "initialization error\n"); return 1; } double a_lat = strtod(argv[1], NULL); double a_long = strtod(argv[2], NULL); double b_lat = strtod(argv[3], NULL); double b_long = strtod(argv[4], NULL); printf("%.2f km\n", distance(thread, a_lat, a_long, b_lat, b_long)); return 0; }</span></span></span></span></code> </pre> <br><p>       ,       (  <code>LD_LIBRARY_PARTH=.</code>  Linux) </p><br><pre> <code class="plaintext hljs">$ clang -I. -L. -ldistance distance.c -o distance $ otool -L distance distance: .../libdistance.dylib ... .../libSystem.B.dylib ... $ ./distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>     GraalVM ‚Äî   java  - ,         JVM </p><br><h2 id="9-podderzhka-neskolkih-yazykov-programmirovaniya-v-baze-dannyh"> 9.        </h2><br><p>     Polyglot  ‚Äî     Oracle.      Oracle Database Multilingual Engine (MLE),         GraalVM   SQL. </p><br><p> ,    front-end,    JavaScript     email ,  JavaScript  <code>validator</code> .     -       ,      SQL  PL/SQL.         ,    . </p><br><p>  MLE  Docker  : </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://oracle.github.io/oracle-db-mle/releases/0.2.7/docker/</a> </p><br><p>     Docker Daemon. </p><br><pre> <code class="plaintext hljs">$ docker load --input mle-docker-0.2.7.tar.gz</code> </pre> <br><p>  ,  Docker,  ,    (    ),  Bash   . </p><br><pre> <code class="plaintext hljs">$ docker run mle-docker-0.2.7 $ docker ps $ docker exec -ti &lt;container_id&gt; bash -li</code> </pre> <br><p>    <code>sqlplus</code> ( SQL ),   Bash,     ,   ,     . </p><br><pre> <code class="plaintext hljs">$ sqlplus scott/tiger@localhost:1521/ORCLCDB</code> </pre> <br><p>    ,    <code>sqlplus</code> . ,   Bash  Docker,         <code>dbjs</code> ,       .   <code>sqlplus</code> . </p><br><pre> <code class="plaintext hljs">$ npm install validator $ npm install @types/validator $ dbjs deploy -u scott -p tiger -c localhost:1521/ORCLCDB validator $ sqlplus scott/tiger@localhost:1521/ORCLCDB</code> </pre> <br><p>         <code>validator</code>   SQL . </p><br><pre> <code class="plaintext hljs">SQL&gt; select validator.isEmail('hello.world@oracle.com') from dual; VALIDATOR.ISEMAIL('HELLO.WORLD@ORACLE.COM') ------------------------------------------- 1 SQL&gt; select validator.isEmail('hello.world') from dual; VALIDATOR.ISEMAIL('HELLO.WORLD') -------------------------------- 0</code> </pre> <br><p>    ,     GraalVM ‚Äî  ,  GraalVM,   Oracle.  ,     front-end  back-end,    ,  ,           . </p><br><h2 id="10-sozdanie-yazykov-programmirovaniya-dlya-graalvm"> 10.     GraalVM </h2><br><p> Oracle Labs            JavaScript, R, Ruby, Python  C   ,      Truffle,       GraalVM. </p><br><p> Truffle ‚Äî  java ,     <em>  </em> (AST).  AST ‚Äî ,     ,                ,   , ,  .     ,    ,   Truffle  Graal   JIT  ,       AST . </p><br><p>    Truffle,    GraalVM    ,      ,  DSL.      Truffle  Graal   ,     ,  Truffle ‚Äî         GraalVM.        , , , , . ,         ,        . Oracle labs    Ruby ,    ,         . </p><br><p>       ,     ,   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SimpleLanguage</a> ‚Äî         Truffle,       JavaScript.  ,  ,   , , , <a href="">   if</a> . </p><br><p>  ,    Truffle   Oracle Labs,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SmallTalk</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Newspeak</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lisp</a> .    Lisp  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a> ,         . </p><br><h2 id="zaklyuchenie">  Kesimpulan </h2><br><p> GraalVM        ‚Äî  ,         ,       .       ,  ,    ,      ,    . </p><br><p>   GraalVM,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://www.graalvm.org/</a> .          ,  ,      . </p><br><p>    ,              ,    .     ,     GraalVM         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">@ChrisGSeaton</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">@shelajev</a> . </p><br><p> <em>:</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Oleg ≈†elajev</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Olya Gupalo</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Doug Simon</a> </p><cut></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id433432/">https://habr.com/ru/post/id433432/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id433414/index.html">Menguji Monitor Jaringan PRTG dan membandingkannya dengan Zabbix</a></li>
<li><a href="../id433420/index.html">Hasil ZeroNights 2018</a></li>
<li><a href="../id433424/index.html">Apakah mungkin memuat level yang tidak bisa dilewati di Super Mario Maker?</a></li>
<li><a href="../id433428/index.html">Dari mana kreativitas berasal: analisis aktivitas gelombang alpha otak selama tes RAT</a></li>
<li><a href="../id433430/index.html">Kotak Mecool KM9 Android pada SoC Amlogic S905X2 segar dengan RAM 4 GB dan Android TV 8.1 - pahami dan maafkan</a></li>
<li><a href="../id433434/index.html">‚ÄúPascal dan bahkan yang kurang begitu Dasar jelas tidak diperlukan‚Äù: sebuah wawancara dengan pelatih dalam pemrograman olahraga</a></li>
<li><a href="../id433436/index.html">Pengantar Penelitian Kinerja</a></li>
<li><a href="../id433438/index.html">Duma Negara akan membatasi crowdfunding</a></li>
<li><a href="../id433442/index.html">Entity Framework Core 2.2 dirilis. Apa yang baru? (3 dari 3)</a></li>
<li><a href="../id433446/index.html">Security Week 51: bug di WordPress 5.0 dan perangkat lunak Logitech, kerentanan foto Facebook</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>