<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✋ 🐲 🚈 Peluncuran 619 ribu tetris di GLSL, rendering dan bot sederhana 🥗 🛋️ 🍮</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya punya "ide" untuk membuat jumlah maksimum menjalankan Tetris secara bersamaan untuk satu shader (satu tekstur framebuffer). 


 Berikut ini adala...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Peluncuran 619 ribu tetris di GLSL, rendering dan bot sederhana</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443042/"><p>  Saya punya "ide" untuk membuat jumlah maksimum menjalankan Tetris secara bersamaan untuk satu shader (satu tekstur framebuffer). </p><br><p>  Berikut ini adalah deskripsi singkat tentang cara kerja kode yang dihasilkan. </p><a name="habracut"></a><br><h4 id="chto-eto">  Apa ini </h4><br><p> Setiap tetris berfungsi dalam tiga piksel, untuk resolusi <code>1920x1080</code> Anda dapat menjalankan <code>619200</code> salinan sekaligus.  Juga membuat bot sederhana untuk bermain otomatis. <br>  <strong>Pada akhir posting, tautan untuk menjalankan dan sumber.</strong> <br>  <strong>Video diperbarui, menunjukkan jumlah bidang yang tersisa, hingga nol.</strong> </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/rcgpwVLydLw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3 id="hranenie-dannyh">  Penyimpanan data </h3><br><p>  Tabel ukuran tetris <code>[10, 22]</code> (10 lebar, 22 tinggi). <br>  Setiap sel bisa kosong atau tidak kosong. <br>  Total <code>22 * 10 = 220</code> bit diperlukan untuk menyimpan seluruh tabel. <br>  Satu "pixel" adalah empat float 24-bit, 96 bit per pixel. </p><br><p>  Secara visual (bagian dari bingkai debug), tiga piksel disorot dalam warna merah, ini adalah satu bidang yang disimpan: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f6b/9e7/973/f6b9e7973210477303e269254223e645.png" alt="gambar"></p><br><p> <code>2 * 96 + 24 + 4</code> <br>  Dua piksel, satu float dari pixel ketiga, 4 bit float kedua dari pixel ketiga <br>  Ada dua pelampung yang tidak terpakai di <em>pixel3</em> pixel <em>ketiga.zw</em> , mereka menyimpan <em>keadaan logika</em> , lebih tepatnya </p><br><ul><li>  <strong>z</strong> menyimpan tiga angka delapan-bit <code>[a,b,c]</code> <br>  - posisi blok saat ini, sebagai ID posisi dalam array (array ukuran 220 bit, posisi maksimum 220 yang kurang dari 0xff) <br>  - <em>b</em> waktu sampai jatuh otomatis (timer) setiap frame <code>-1</code> ke nomor ini, karena menjadi 0 maka jatuh pada blok ke bawah <br>  - ID <em>c</em> dari blok saat ini </li><li>  <strong>w</strong> juga <code>[a,b,c]</code> , tetapi juga tanda (positif atau negatif) dari seluruh pelampung adalah bendera <em>akhir pertandingan dalam tabel saat ini</em> (agar tidak membuang-buang sumber daya jika lapangan <em>kewalahan</em> ) <br>  - <em>suatu</em> tindakan, tidak ada tindakan (0), kiri (1), kanan (2), dan seterusnya, kode lengkap dalam <em>Common</em> , tindakan memiliki dua negara, <em>periksa kiri</em> dan <em>periksa</em> apakah mungkin untuk bergerak ke kiri, maka tindakan diatur ke <em>kiri_ bergerak</em> . <br>  - <code>[b,c]</code> <em>0xffff</em> (16 bit) poin dari tabel saat ini, jumlah garis yang dibakar </li></ul><br><p>  Ada <code>20 </code> tersisa tidak digunakan dalam float kedua dari pixel ketiga. </p><br><p>  bingkai <strong>debug</strong> yang menunjukkan bahwa <em>logika penyimpanan berfungsi dengan benar</em> <br>  di sebelah kiri ada bidang putih berukuran tiga piksel, atur khusus untuk menunjukkan bahwa celah diproses dengan benar (jika resolusinya bukan kelipatan tiga, strip akan miring) <br>  <em>kondisi pada saluran 75 Penyangga A</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/00f/770/c98/00f770c9850ac3900303ba7503040268.png" alt="gambar"></p><br><h4 id="zachem-nuzhny-id-deystviy">  Mengapa saya memerlukan ID tindakan: </h4><br><ul><li>  Data disimpan dalam tiga piksel, tidak mungkin untuk secara bersamaan <em>memeriksa logika dan mengubah data</em> dalam satu bingkai (tanpa mengeksekusi semua logika dan memuat seluruh peta di setiap piksel, beban akan meningkat puluhan kali). </li><li>  Oleh karena itu, logika <em>Penyimpanan Data</em> berfungsi di setiap piksel dan menjalankan perintah yang diterima, <em>gerakan kiri</em> , <em>perintah</em> verifikasi pemeriksaan <em>kiri</em> dijalankan hanya dalam satu piksel (ketiga). </li></ul><br><h4 id="medlennoe-mesto">  Tempat yang lambat </h4><br><ul><li>  Setiap piksel ketiga (piksel logika) mendekompresi seluruh peta (membaca ketiga piksel). </li><li>  Dua piksel yang tersisa hanya mendekompresi "dirinya" (satu piksel) untuk melakukan tindakan yang disimpan. </li><li>  Selama aksi, <em>garis dibakar,</em> piksel lain dimuat, karena tabel jatuh dan bagian bawah tabel harus tahu apa yang ada di atas. </li></ul><br><h4 id="proizvoditelnost-algoritma-hraneniya-dannyh">  Kinerja Algoritma Penyimpanan </h4><br><p>  Untuk pengujian, atur <em>#define debug</em> ke Common dan <em>AI 0 di</em> sana juga. <br>  <strong>Saya mendapat hasil seperti itu</strong> - <em>10FPS</em> saat merender dan memproses semua 619200 bidang, <br>  di 120 ribu bidang (25fps) </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c6f/f08/74f/c6ff0874f2aa639402b7247546e718c2.jpg" alt="gambar"></p><br><h3 id="logika-bota">  Logika bot </h3><br><p>  <strong>Logika Sangat buruk</strong> , bot terbakar dalam satu menit, dan mendapat hingga 60 poin. </p><br><p>  Saya tidak dapat memulai <em>logika yang baik</em> dengan banyak siklus memeriksa lubang dan tepian dan bidang yang mudah terbakar, mengingat posisi terbaik berdasarkan semua kemungkinan jatuh ... <br>  Logika yang bagus bekerja untuk saya hingga 100 salinan dan memberikan jeda yang kuat ketika melewati semua siklus. </p><br><p>  <strong>Logika bot saya berfungsi seperti ini</strong> <br>  Semua logika ada di fungsi <em>AI_pos_gen</em> di Buffer A, ada sepuluh baris di dalamnya. </p><br><p>  Kodesemu: <br>  periksa tinggi untuk pemasangan blok sama dengan maksimum untuk bidang pada kolom saat ini (periksa satu baris untuk ketinggian) </p><br><pre> <code class="plaintext hljs">(4   ){ (  (10)){ (     ){  (    ,  )   best ID()  best POS } } }  (     )   (  )      0     1</code> </pre> <br><p>  Ternyata tiga siklus itu biasa - mereka menempatkan blok sehingga tingginya minimal. </p><br><p>  Fungsi <em>AI_pos_gen</em> dipanggil ketika blok baru muncul, dan mengembalikan posisi untuk <em>jatuh dari atas</em> , mengambil ID blok dan membuatnya berputar, fungsinya bekerja di pixel ketiga (logika), yaitu, ia memiliki peta yang dimuat penuh (array peta). <br>  <em>Anda dapat dengan mudah mencoba menulis bot Anda jika diinginkan.</em> </p><br><p>  <strong>Tempat paling lambat</strong> <br>  Menambahkan hanya satu loop untuk <em>menguji lubang</em> , driver kartu video saya mogok ketika jumlah bot lebih dari 10 ribu ... bot yang saya tulis adalah versi bot paling "minimalis" dari bot yang bisa saya lakukan, dan sayangnya sangat buruk. </p><br><h3 id="interfeysrendering-ui">  Antarmuka UI / Rendering </h3><br><p>  Semua render dalam <em>Gambar</em> , logika UI dalam <em>Buffer B.</em> </p><br><p>  <strong>Rendering:</strong> <br>  Membagi layar menjadi <em>ubin</em> dan menggambar meja di setiap ubin, beban minimum. </p><br><p>  Logika memuat peta - setiap piksel tidak dibongkar, setiap piksel dibongkar, hanya "bit yang diperlukan" dibongkar (secara harfiah), kode fungsinya adalah: </p><br><pre> <code class="plaintext hljs">int maptmp(int id, int midg) { int nBits = 8; ivec4 pixeldata = loadat(id, midg); int itt = (id / 24) / 4; //data pixel id 0-2 int jtt = (id - itt * 24 * 4) / 24; //component in data pizel id 0-3 int ott = (id - itt * 24 * 4 - jtt * 24) / 8; //component in unpacked value 0-2 int ttt = (id - itt * 24 * 4 - jtt * 24 - ott * 8); //bit after int2bit 0-7 ivec3 val = decodeval16(pixeldata[jtt]); int n = val[ott]; for (int i = 0; i &lt; nBits; ++i, n /= 2) { if (i == ttt) { if ((n % 2) == 0)return 0; else return 1; //switch + return does not work on windows(Angle) /*switch (n % 2) { case 0:return 0;break; case 1:return 1;break; }*/ } } return 0; }</code> </pre> <br><p>  <strong>Untuk menghindari pikselasi</strong> saat menggulir, mulai dari 43000, bagian pecahan float hilang, dan tidak berhasil menambahkan 619 ribu ke UV untuk menggulir (akan ada piksel alih-alih tabel). <br>  Semua pengguliran dibagi menjadi satu <em>ubin</em> besar dan berputar dalam lingkaran menambahkan maksimum 32 ke UV.  (baris 207 dalam <em>Gambar</em> ). </p><br><p>  Hal yang sama dilakukan untuk menentukan ID bidang.  (baris 215 pada <em>Gambar</em> ) </p><br><h4 id="ui">  UI </h4><br><p>  Angka: <br>  Kuning adalah jumlah bidang tetris. <br>  Kiri besar - jumlah bidang saat ini. <br>  Di kanan bawah - titik-titik dari bidang saat ini. </p><br><h3 id="ishodnik-i-zapusk">  Sumber dan Peluncuran </h3><br><p>  <em>Bufer A</em> logic, <em>Bufer B</em> adalah kontrol UI, rendering <em>gambar</em> <br>  Sumber di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://www.shadertoy.com/view/3dlSzs</a> (waktu kompilasi melalui Angle 16 detik) <br>  Bot dinonaktifkan di sana (Anda dapat mengaktifkannya), dan semua bidang dapat <em>dimainkan</em> dari keyboard. </p><br><p>  Kontrol panah kiri / kanan / atas / bawah. </p><br><p>  Reset persegi panjang merah UI, pindahkan (seret mouse dengan mengklik LMB) dan klik bidang untuk menggulir atau memilih bidang yang akan ditampilkan. </p><br><p>  Luncurkan dari browser web: </p><br><ul><li>  jalankan chrome dengan <i>chrome.exe --use-angle = gl</i> </li><li>  ikuti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan ke shadertoy</a> </li><li>  di editor di situs, pilih Common dan hapus <i>#define no_AI</i> </li><li>  (juga sama) mengatur #define AI 199 ke 0, mis. <i>#define AI 0</i> </li><li>  klik tombol kompilasi (di bawah jendela editor pada shader) dan klik layar penuh </li></ul><br><p>  <b>Opsi kedua</b> adalah menjalankan shader di "peluncur shader" apa pun, di sini adalah <a href="">tautan ke arsip ( <b>unduh</b> )</a> di mana * .exe file dengan shader ini. </p><br><p>  Waktu kompilasi OpenGL sekitar 10 detik. </p><br><p>  <strong>Pembaruan</strong> : menambahkan shader dengan <em>lubang memeriksa</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://www.shadertoy.com/view/wsXXzH</a> <br>  bukannya kondisi untuk posisi yang lebih baik pada ketinggian yang sama.  Fungsi <code>check_block_at_wh</code> (baris 380 BufA) menghitung lubang bersama dengan memeriksa validitas posisi, tidak ada siklus baru yang ditambahkan, dan baris kondisi 442 hingga 459 BufA. <br>  Ini juga cepat terbakar dalam satu menit dalam 30-60 poin. (Jelas, Anda perlu memeriksa area yang luas untuk mencari lubang, tetapi ini memberikan rem yang kuat) </p><br><p>  Dan dua gambar menjelaskan sedikit pekerjaan: <br>  pemilihan posisi <a href="">https://i.imgur.com/e0uENgV.png</a> <br>  posisi blokir untuk kondisinya adalah <a href="">https://i.imgur.com/ORECXUW.png</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id443042/">https://habr.com/ru/post/id443042/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id443030/index.html">Profil memori paling sederhana pada STM32 dan mikrokontroler lainnya</a></li>
<li><a href="../id443032/index.html">Komponen Web di Dunia Nyata</a></li>
<li><a href="../id443034/index.html">Stasiun Pengisian Tesla Baru: Isi Daya Baterai untuk 120 Kilometer dalam 5 Menit</a></li>
<li><a href="../id443038/index.html">Jika superglue masuk ke mata</a></li>
<li><a href="../id443040/index.html">7 alasan utama mengapa aplikasi diblokir di Google Play dan AppStore</a></li>
<li><a href="../id443046/index.html">Bagaimana Peneliti Keamanan Mengakses Situs yang Dilindungi Kode iOS</a></li>
<li><a href="../id443050/index.html">Penjelasan paling sederhana tentang bagaimana algoritma enkripsi simetris bekerja hari ini</a></li>
<li><a href="../id443052/index.html">Jam tangan akurat dan cantik dari smartphone lama</a></li>
<li><a href="../id443054/index.html">Pilihan utilitas untuk programmer di Linux</a></li>
<li><a href="../id443056/index.html">Pasien HIV kedua mencapai remisi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>