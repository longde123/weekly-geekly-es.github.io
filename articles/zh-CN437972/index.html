<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✊🏽 🖕🏽 ⏪ 适用于初学者的PHP。 会议 🈷️ 🚄 🖖🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="祝你有美好的一天。 这是针对初学者的PHP系列文章中的第一篇。 这将是不寻常的系列文章，不会出现echo "Hello World" ，而从PHP程序员的生活中也不会有顽固的人，他们会使用少量的“作业”来巩固材料。 

 我将从会话开始-这是您必须使用的最重要的组件之一。 不了解他的工作原理-做生意...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>适用于初学者的PHP。 会议</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437972/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0a/389/8cf/c0a3898cf539ad6a3dc7ffb833d9715d.png" alt="ElePHPant。适用于初学者的PHP。届会"></div><br> 祝你有美好的一天。 这是针对初学者的PHP系列文章中的第一篇。 这将是不寻常的系列文章，不会出现<code>echo "Hello World"</code> ，而从PHP程序员的生活中也不会有顽固的人，他们会使用少量的“作业”来巩固材料。 <br><br> 我将从会话开始-这是您必须使用的最重要的组件之一。 不了解他的工作原理-做生意。 因此，为了避免出现问题，我将尝试谈论所有可能的细微差别。 <br><a name="habracut"></a><br> 但是对于初学者来说，要了解为什么需要会话，我们转向起源-HTTP协议。 <br><br><h3>  HTTP协议 </h3><br>  HTTP协议是“超文本传输​​协议”，即“超文本传输​​协议”，即 其实-一个文本协议，理解起来并不困难。 <br><blockquote> 最初，可以理解的是，在此协议下，仅HTML将被发送，地址和名称也将被发送，但现在它们将不再发送，并且= ^。^ =并且（•_ㅅ_••） </blockquote><br> 为了避免麻烦，让我举一个HTTP协议通信的例子。 <br> 这是请求的示例，当您请求<code>http://example.com</code>页面时，浏览器将如何发送请求： <br><br><pre> <code class="plaintext hljs">GET / HTTP/1.1 Host: example.com Accept: text/html &lt; &gt;</code> </pre> <br> 这是一个示例响应： <br><br><pre> <code class="plaintext hljs">HTTP/1.1 200 OK Content-Length: 1983 Content-Type: text/html; charset=utf-8 &lt;html&gt; &lt;head&gt;...&lt;/head&gt; &lt;body&gt;...&lt;/body&gt; &lt;/html&gt;</code> </pre><br> 这些是非常简化的示例，但是即使在这里，您也可以看到HTTP请求和响应包含的内容： <br><br><ol><li>  <strong>起始行</strong> -对于请求，包含请求页面的方法和路径，对于响应-协议版本和响应代码 </li><li>  <strong>标头</strong> -具有以冒号分隔的键值格式，每个新标题均从新行写入 </li><li>  <strong>邮件正文</strong> -如上面的请求所述，直接HTML或数据与标头之间由两个换行符分隔，可能不存在 </li></ol><br> 因此，我们有点想出该协议-它很简单，自1992年以来一直引领着它的历史，因此您不会将其命名为理想的，但是它是什么-发送请求-得到答案，仅此而已，服务器和客户端不再连接。 但是这种情况绝不是唯一可能的，我们可以获得授权，服务器必须以某种方式理解该请求来自特定用户，即 客户端和服务器必须在特定会话中进行通信。 是的，为此发明了以下机制： <br><br><ol><li> 用户授权后，服务器会生成并记住一个唯一密钥-会话标识符，并将其报告给浏览器 </li><li> 浏览器保存该密钥，并在随后的每个请求中发送 </li></ol><br> 为了实现此机制，创建了Cookie（Cookie，Cookie）-计算机上的简单文本文件，按每个域的文件分类（尽管某些浏览器更高级，并且使用数据库存储SQLite），而浏览器对记录数施加了限制以及存储的数据的大小（对于大多数浏览器，这是4096字节，请参阅1997年的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RFC 2109</a> ） <br><blockquote> 即 如果您从浏览器中窃取了cookie，您是否可以代表您进入Facebook页面？ 请不要惊慌，这至少在Facebook上是无法做到的，然后，我将向您介绍一种防范这种对用户的攻击的可能方法。 </blockquote><br> 现在，让我们看看我们的请求-响应如何更改，只要有授权即可： <br><br>  <b>索取</b> <br><pre> <code class="plaintext hljs">POST /login/ HTTP/1.1 Host: example.com Accept: text/html login=Username&amp;password=Userpass</code> </pre> <br><br> 我们的方法已更改为POST，并且登录名和密码在请求正文中传输。 如果使用GET方法，则查询字符串将包含用户名和密码，从意识形态的角度来看这不是很正确，并且会以日志记录的形式（例如，以相同的<code>access.log</code>形式）产生许多副作用，并以明文形式缓存密码。 <br><br>  <b>回应</b> <br><pre> <code class="plaintext hljs">HTTP/1.1 200 OK Content-Type: text/html; charset=utf-8 Set-Cookie: KEY=VerySecretUniqueKey &lt;html&gt; &lt;head&gt;...&lt;/head&gt; &lt;body&gt;...&lt;/body&gt; &lt;/html&gt;</code> </pre> <br> 服务器的响应将包含<code>Set-Cookie: KEY=VerySecretUniqueKey</code>标头<code>Set-Cookie: KEY=VerySecretUniqueKey</code> ，这将强制浏览器将此数据保存在cookie中，并在下次访问服务器时将其发送并由服务器识别： <br><br>  <b>索取</b> <br><pre> <code class="plaintext hljs">GET / HTTP/1.1 Host: example.com Accept: text/html Cookie: KEY=VerySecretUniqueKey &lt; &gt;</code> </pre> <br><blockquote> 如您所见，浏览器（请求头）和服务器（响应头）发送的头不同，尽管请求和响应（通用头）都相同 </blockquote><br> 服务器通过发送的Cookie识别了我们的用户，并将进一步向他提供访问个人信息的权限。 好了，整理了会话和HTTP之后，现在您可以返回PHP及其功能了。 <br><br><h3>  PHP和会话 </h3><br><blockquote> 我希望您已经在计算机上安装了PHP，因为 此外，我将给出示例，并且需要运行它们 </blockquote><br> 创建PHP语言以匹配HTTP协议-即 它的主要任务是为HTTP请求提供答案，并“消亡”以释放内存和资源。 因此，会话机制在PHP的自动模式下不起作用，而在手动模式下，您需要知道要调用的内容和顺序。 <br><blockquote> 在这里，您可以找到有关<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PHP即将死亡</a>的主题的文章，或者<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">以俄语提供</a> ，但是最好将其放在书签中，以备后用。 </blockquote><br> 首先，您需要“启动”会话-为此，我们使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session_start（）</a>函数，创建一个具有以下内容的<em>session.start.php</em>文件： <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> session_start();</code> </pre> <br> 使用脚本在文件夹中运行内置的PHP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Web服务器</a> ： <br><br><pre> <code class="bash hljs">php -S 127.0.0.1:8080</code> </pre> <br> 启动浏览器并打开开发人员工具（或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">其他</a>工具），然后转到页面<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://127.0.0.1:8080/session.start.php-</a>您应该只看到一个空白页面，但不要急于关闭-外观服务器发送给我们的标头： <br><br> <a href="" rel="attachment"><img src="https://habrastorage.org/getpro/habr/post_images/3e8/b2d/145/3e8b2d145c8f29ce0fe30664dcc36119.png" alt="曲奇" width="460" height="222"></a> <br><br> 会有很多事情，我们只对服务器响应中的这一行感兴趣（干净的cookie，如果没有这样的行，则刷新页面）： <br><br><pre> <code class="plaintext hljs">Set-Cookie: PHPSESSID=dap83arr6r3b56e0q7t5i0qf91; path=/</code> </pre> <br> 看到此消息后，浏览器将保存一个名为“ PHPSESSID”的cookie： <br><br> <a href="" rel="attachment wp-att-2816"><img src="https://habrastorage.org/getpro/habr/post_images/f06/d02/09e/f06d0209e68ccac4b99570758c23a2ad.png" alt="浏览器会话Cookie" width="460" height="410"></a> <br><br><blockquote>  <code>PHPSESSID</code>默认会话名称，使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session.name</a>指令从php.ini配置中进行调整，如有必要，可以在配置文件本身或使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session_name（）</a>函数更改名称 </blockquote><br> 现在-我们刷新页面，我们看到浏览器将此Cookie发送到服务器，您可以尝试刷新页面两次，结果将是相同的： <br><br> <a href="" rel="attachment wp-att-2817"><img src="https://habrastorage.org/getpro/habr/post_images/272/4e6/001/2724e60013b929e3e9e7f1bfa9212ef1.png" alt="带有Cookie的浏览器请求" width="460" height="87"></a> <br><br> 我们所拥有的总数-理论与实践相吻合，这很好。 <br><br> 下一步是将任意值保存到会话中，为此，PHP中使用了超全局变量<code>$_SESSION</code> ，我们将保存当前时间-为此，请调用<a href="">date（）</a>函数： <br><br><pre> <code class="php hljs">session_start(); $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>] = date(<span class="hljs-string"><span class="hljs-string">"H:i:s"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>];</code> </pre> <br> 我们刷新页面，查看服务器时间，然后再次更新-时间已更新。 现在，确保设置的时间不会随着每次页面刷新而改变： <br><br><pre> <code class="php hljs">session_start(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>])) { $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>] = date(<span class="hljs-string"><span class="hljs-string">"H:i:s"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>];</code> </pre> <br> 我们更新-时间没有改变，需要什么。 但是同时，我们还记得PHP快要死了，这意味着它将这个会话存储在某个地方，我们会找到这个地方... <br><br><h3> 一切秘密都变得清晰 </h3><br> 默认情况下，PHP将会话存储在文件中<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-session.save_handler</a>指令负责此工作，在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session.save_path</a>指令中查找文件保存路径，或使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session_save_path（）</a>函数获取必要的路径。 <br><blockquote> 在您的配置中，可能未指定文件的路径，然后会话文件将存储在系统的临时文件中-调用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sys_get_temp_dir（）</a>函数并找出该隐藏位置。 </blockquote><br> 因此，我们沿着该路径查找您的会话文件（我有这个文件<code>sess_dap83arr6r3b56e0q7t5i0qf91</code> ），在文本编辑器中将其打开： <br><br><pre> <code class="bash hljs">time|s:8:<span class="hljs-string"><span class="hljs-string">"16:19:51"</span></span>;</code> </pre> <br> 如您所见，这是我们的时间，这是会话存储的棘手格式，但是我们可以进行更改，更改时间，或者我们可以简单地输入任何行，为什么不这样做： <br><br><pre> <code class="bash hljs">time|s:13:<span class="hljs-string"><span class="hljs-string">"\m/ (@.@) \m/"</span></span>;</code> </pre> <br> 要将此字符串转换为数组，您需要使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session_decode（）</a>函数进行反向转换<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-session_encode（）</a> -这称为序列化，仅在PHP中用于会话-这是它自己的-特殊的，尽管您可以使用标准的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PHP序列化</a> -在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session</a>配置指令中写<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">.serialize_handler的</a>值为<code>php_serialize</code> ，您会很高兴的，并且<code>$_SESSION</code>可以不受限制地使用-现在您可以使用数字和特殊字符作为索引<code>|</code> 和<code>!</code> 以这个名字（在过去10多年的工作中，我从未如此：） <br><br><div class="spoiler">  <b class="spoiler_title">工作任务</b> <div class="spoiler_text"> 编写您的函数，类似于<code>session_decode()</code>函数，在这里您为会话设置了一个测试数据集（不需要解析正则表达式），并从当前会话的文件中获取用于转换的文本： <br><br><pre> <code class="php hljs">$_SESSION[<span class="hljs-string"><span class="hljs-string">'integer var'</span></span>] = <span class="hljs-number"><span class="hljs-number">123</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'float var'</span></span>] = <span class="hljs-number"><span class="hljs-number">1.23</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'octal var'</span></span>] = <span class="hljs-number"><span class="hljs-number">0x123</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'string var'</span></span>] = <span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'array var'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'one'</span></span>, <span class="hljs-string"><span class="hljs-string">'two'</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>]); $object = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> stdClass(); $object-&gt;foo = <span class="hljs-string"><span class="hljs-string">'bar'</span></span>; $object-&gt;arr = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>, <span class="hljs-string"><span class="hljs-string">'world'</span></span>); $_SESSION[<span class="hljs-string"><span class="hljs-string">'object var'</span></span>] = $object; $_SESSION[<span class="hljs-string"><span class="hljs-string">'integer again'</span></span>] = <span class="hljs-number"><span class="hljs-number">42</span></span>;</code> </pre> <br></div></div><br> 那么，我们还没有尝试过什么呢？ 没错-要窃取Cookie，让我们启动另一个浏览器并向其中添加相同的Cookie。 为此，我为您编写了一个简单的javascript，将其复制到浏览器控制台中并运行它，只记得将会话标识符更改为您自己的： <br><br><pre> <code class="javascript hljs">javascript:(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie=<span class="hljs-string"><span class="hljs-string">'PHPSESSID=dap83arr6r3b56e0q7t5i0qf91;path=/;'</span></span>;<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.reload();})()</code> </pre> <br> 现在，您的两个浏览器正在查看同一会话。 上面我提到，我将讨论保护方法，以最简单的方式进行讨论-我们将会话绑定到浏览器，更确切地说，绑定到浏览器在服务器上的显示方式-我们将记住<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">User-Agent</a>并每次进行检查： <br><br><pre> <code class="php hljs">session_start(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>])) { $_SESSION[<span class="hljs-string"><span class="hljs-string">'ua'</span></span>] = $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_USER_AGENT'</span></span>]; $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>] = date(<span class="hljs-string"><span class="hljs-string">"H:i:s"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_SESSION[<span class="hljs-string"><span class="hljs-string">'ua'</span></span>] != $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_USER_AGENT'</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'Wrong browser'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>];</code> </pre> <br> 伪造起来比较困难，但是仍然可以在这里添加保存并检查<code>$_SERVER['REMOTE_ADDR']</code>和<code>$_SERVER['HTTP_X_FORWARDED_FOR']</code> ，这看起来或多或少就像是防止入侵者入侵我们的cookie的保护措施。 <br><br><blockquote> 上一段中的关键字<b>看起来像</b> cookie在真实项目中已经通过HTTPS协议运行了很长时间了，因此如果没有物理访问您的计算机或智能手机，没有人可以窃取它们 </blockquote><br><br> 值得一提的是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=http://php.net/session.configuration.php&amp;usg=ALkJrhgkMJRkcdQJWi8078KdQAhzFEN-nA#ini.session.cookie-">session.cookie-httponly指令</a> ，由于这个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=http://php.net/session.configuration.php&amp;usg=ALkJrhgkMJRkcdQJWi8078KdQAhzFEN-nA#ini.session.cookie-">指令</a> ，会话JavaScript将无法访问。 另外，如果查看<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">setcookie（）</a>函数手册，您会注意到最后一个参数也负责HttpOnly。 请记住，此设置使您可以在几乎<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">所有浏览器中</a>有效应对XSS攻击。 <br><br><div class="spoiler">  <b class="spoiler_title">工作任务</b> <div class="spoiler_text"> 在代码中将检查添加到用户的IP；如果检查失败，请删除受损的会话。 <br></div></div><br><h3> 一步一步 </h3><br> 现在，我将使用以下代码作为示例（默认设置），逐步说明算法在PHP中会话的工作方式： <br><br><pre> <code class="php hljs">session_start(); $_SESSION[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] = <span class="hljs-number"><span class="hljs-number">42</span></span>;</code> </pre> <br><ol><li> 调用<code>session_start()</code> PHP通过<code>session.name</code>指定的名称在cookie中搜索会话标识符-这是<code>PHPSESSID</code> </li><li> 如果没有标识符，则将创建它（请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session_id（）</a> ），并沿着路径<code>session.save_path</code>创建一个名称为<code>sess_{session_id()}</code>的空会话文件，标题将添加到服务器的响应中以设置cookie <code>{session_name()}={session_id()}</code> </li><li> 如果存在标识符，则在<code>session.save_path</code>文件夹中查找会话文件： <br><ul><li> 我们找不到它-我们创建一个名为<code>sess_{$_COOKIE[session_name()]}</code>的空文件（标识符只能包含<code>az</code> ， <code>AZ</code> ， <code>0-9</code>范围内的字符，逗号和减号） </li><li> 查找，读取文件并将数据解压缩（请参见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session_decode（）</a> ）到超全局变量<code>$_SESSION</code> （文件被锁定以进行读取/写入） </li></ul></li><li> 脚本完成工作后，将使用<code>session_encode()</code>将<code>$_SESSION</code>所有数据打包到路径<code>session.save_path</code>名为<code>sess_{session_id()}</code> （释放该锁） </li></ol><br><div class="spoiler">  <b class="spoiler_title">工作任务</b> <div class="spoiler_text"> 在浏览器中使用名称<code>PHPSESSID</code>设置任意cookie值，使其为<code>1234567890</code> ，刷新页面，检查是否已创建新文件<code>sess_1234567890</code> <br></div></div><br><h3> 有没有饼干的生活吗？ </h3><br> 即使浏览器中禁用了cookie，PHP仍可以使用该会话，但是站点上的所有URL都将包含一个带有会话标识符的参数，是的-您是否仍需要配置它，但是是否需要它？ 我不必使用它，但是如果我真的想，我只想说说在哪里挖掘： <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session.use_cookies</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session.use_only_cookies</a> </li></ul><br><h3> 如果您需要将会话存储在数据库中？ </h3><br> 要将会话存储在数据库中，您将需要更改会话存储并告诉PHP如何使用它，为此，创建了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SessionHandlerInterface</a>接口和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session_set_save_handler</a>函数。 <br><blockquote> 另外，我注意到您不需要为redis和memcache编写自己的会话处理程序-安装这些扩展时，相应的处理程序也将与它们一起使用，因此RTFM就是一切。 好吧，是的，必须在调用<code>session_start()</code> ;）之前指定处理程序。 </blockquote><br><div class="spoiler">  <b class="spoiler_title">工作任务</b> <div class="spoiler_text"> 实现<code>SessionHandlerInterface</code>以将会话存储在MySQL中，检查其是否有效。 <br> 对于那些已经熟悉数据库的人来说，这是一个星号任务。 <br></div></div><br><br><h3> 会话何时终止？ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session.gc_maxlifetime</a>指令负责会话的生存期。 默认情况下，此指令等于1440秒（24分钟），应理解为如果在指定时间内未访问会话，则该会话将被视为“烂”并等待其轮换删除。 <br><br> 另一个问题很有趣，您可以问成熟的开发人员吗？PHP何时删除过期会话的文件？ 答案在官方指南中，但没有明确-请记住： <br><br> 可以在调用<code>session_start()</code>函数时启动垃圾回收，启动的可能性取决于两个指​​令<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session.gc_probability</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">session.gc_divisor</a> ，第一个充当除数，第二个充当除数，默认情况下这些值为1和100， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">依此</a>类推。 e。 收集器将启动并且会话文件将被删除的可能性约为1％。 <br><br><div class="spoiler">  <b class="spoiler_title">工作任务</b> <div class="spoiler_text"> 更改<code>session.gc_divisor</code>指令的值，以便垃圾收集器每次启动，请检查是否发生这种情况。 <br></div></div><br><br><h3> 最琐碎的错误 </h3><br> 超过一百万的错误会导致Google的结果： <br><br><blockquote> 无法发送会话Cookie- <strong>标头已由发送</strong> <br> 无法发送会话缓存限制器- <strong>标头已发送</strong> </blockquote><br> 要获取一个文件，请创建一个具有以下内容的<em>session.error.php</em>文件： <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> str_pad(<span class="hljs-string"><span class="hljs-string">' '</span></span>, ini_get(<span class="hljs-string"><span class="hljs-string">'output_buffering'</span></span>)); session_start();</code> </pre> <br><blockquote> 在第二行中，一个奇怪的“魔术”是一个带有输出缓冲区的焦点，我将在以下文章之一中讨论它，到目前为止，我们认为这只是一个长度为4096个字符的字符串，在这种情况下，它是所有空格 </blockquote><br> 首先先删除cookie，然后会收到上述错误，尽管错误文本有所不同，但本质是相同的：火车已经离开-服务器已将页面内容发送到浏览器，并且发送标头为时已晚，这在cookie中将不起作用，并且珍贵的会话标识符不会出现在cookie中。 如果遇到此错误-查找一个提前显示文本的位置，则在连接的文件之一中，该字符可能是字符<code>&lt;?php</code>之前或之后的空格，如果是空格，则可能存在某些无法打印的线程像<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">BOM</a>一样，所以要小心，这种感染不会影响到您（毕竟……荷尔蒙大笑）。 <br><br><div class="spoiler">  <b class="spoiler_title">工作任务</b> <div class="spoiler_text"> 为了测试这些知识，我希望您实现自己的会话机制并使上面的代码工作： <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'include/sess.php'</span></span>; sess_start(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SESS[<span class="hljs-string"><span class="hljs-string">"id"</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESS[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $_SESS[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] = <span class="hljs-number"><span class="hljs-number">42</span></span>; }</code> </pre> <br><blockquote> 要实施您的计划，您将需要<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">register_shutdown_function（）</a>函数 </blockquote><br></div></div><br><br><h3> 锁扣 </h3><br> 初学者中的另一个常见错误是尝试在会话文件被另一个脚本锁定时读取会话文件。 实际上，这并不是一个错误，这是对阻塞原理的误解:) <br><br> 但是，让我们再次采取步骤： <br><br><ol><li>  <code>session_start()</code>不仅创建/读取文件，而且将其锁定，以便在执行脚本时任何人都无法进行更改，或者从会话文件中读取不一致的数据 </li><li> 该锁在脚本末尾释放 </li></ol><br><br>  “插入”此错误非常容易，创建两个文件： <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// start.php session_start(); echo "OK";</span></span></code> </pre><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// lock.php session_start(); sleep(10); echo "OK";</span></span></code> </pre><br><br> 现在，如果您在浏览器中打开<code>lock.php</code>页面，然后在新选项卡中打开<code>start.php</code> ，您将看到仅在执行第一个脚本后第二个页面才会打开，这会阻塞会话文件10秒钟。 <br><br> 有两种避免这种现象的选择-“笨拙”和“体贴”。 <br><br>  <b>“斧头”</b> <br> 使用自定义的会话处理程序在其中“忘记”以实现锁定:) <br> 更好的选择是采用现成的选项并禁用锁（例如，memcached具有这样的选项<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-memcached.sess_locking</a> ）O_o <br> 花几个小时调试代码以查找罕见的弹出错误... <br><br>  <b>“周到”</b> <br> 最好的方法在哪里-监视自己的会话锁定，并在不需要时将其删除： <br><br>  -如果确定不需要更改会话数据，请在启动会话时使用<code>read_and_close</code>选项： <br><br><pre> <code class="php hljs">session_start([ <span class="hljs-string"><span class="hljs-string">'read_and_close'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ]);</code> </pre><br><br> 因此，锁定将在读取会话数据后立即释放。 <br><br>  -如果您仍需要更改会话，请在更改会话后关闭会话以免录音： <br><br><pre> <code class="php hljs">session_start(); <span class="hljs-comment"><span class="hljs-comment">// some changes session_write_close();</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">工作任务</b> <div class="spoiler_text">  <code>start.php</code>和<code>lock.php</code>这两个文件的列表<code>start.php</code> ， <code>lock.php</code>创建更多的<code>read-close.php</code>和<code>write-close.php</code> ，您将在其中以列出的方式控制锁定。 检查锁如何工作（或不工作）。 <br></div></div><br><br><h3> 总结 </h3><br> 在本文中，您获得了七个任务，它们不仅涉及<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">会话的</a>工作，而且还向您介绍<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MySQL</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">字符串函数</a> 。 对于这种材料的吸收-您不需要单独的文章，只需提供的链接上的手册就足够了-没有人会为您阅读。 加油！ <br><br>  <b>PS：</b>如果您从该文章中学到了新知识-感谢作者-在社交网络中分享该文章；） <br>  <b>PPS</b>是的，这是我<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">博客中</a>的一篇跨文章，但仍然有用:) <br><br>  <b>一系列文章“ PHP初学者”：</b> <br><br><ul><li>  <b>会议</b> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">档案连线</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN437972/">https://habr.com/ru/post/zh-CN437972/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN437958/index.html">符合GOST-2012的具有数字签名的终端服务器在ESIA中的授权</a></li>
<li><a href="../zh-CN437960/index.html">IT公司技术总监对训练营毕业生的建议</a></li>
<li><a href="../zh-CN437962/index.html">PVS-Studio投资回报率</a></li>
<li><a href="../zh-CN437964/index.html">本书“机器学习和TensorFlow”</a></li>
<li><a href="../zh-CN437968/index.html">PVS-Studio投资回报率</a></li>
<li><a href="../zh-CN437974/index.html">如何赢得数字世界技能？ 一个实际的例子</a></li>
<li><a href="../zh-CN437976/index.html">“ Vkontakte”被允许向警方隐藏个人记录</a></li>
<li><a href="../zh-CN437978/index.html">欢迎来到SphinxSearch-meetup SuperJob</a></li>
<li><a href="../zh-CN437980/index.html">公开网络研讨会“黑匣子测试中的逐对测试方法”</a></li>
<li><a href="../zh-CN437982/index.html">Shade的新型加密器攻击针对俄罗斯商业用户</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>