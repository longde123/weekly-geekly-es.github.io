<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>#⃣ 👰 🧑🏾‍🤝‍🧑🏾 核心动画中的粒子系统。 圣诞故事 🎴 ☪️ 🤞🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="大家好！ 

 圣诞节已经过去很久了，但是在圣诞节之后，我们有一个有趣的故事，关于如何使用不常使用的Core Animation功能为用户营造节日气氛。 我分享伦敦同事亚历克西斯（Alexis）的文章翻译。 

 圣诞节一直是我一年中最喜欢的日子之一。 它给我们的生活带来了许多爱，欢笑，幸福和魔力。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>核心动画中的粒子系统。 圣诞故事</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/446938/"><img src="https://habrastorage.org/webt/9s/eo/zq/9seozqwk1lhhha-t9kjesviqs14.jpeg"><br><br> 大家好！ <br><br> 圣诞节已经过去很久了，但是在圣诞节之后，我们有一个有趣的故事，关于如何使用不常使用的Core Animation功能为用户营造节日气氛。 我分享伦敦同事亚历克西斯（Alexis）的文章翻译。 <br><br> 圣诞节一直是我一年中最喜欢的日子之一。 它给我们的生活带来了许多爱，欢笑，幸福和魔力。 <br><br> 我在西班牙特内里费岛（Tenerife）出生和长大，特内里费岛（Tenerife）是非洲海岸附近大西洋中间一个阳光明媚的岛屿。 而且，相信我，特内里费岛的圣诞节与伦敦的圣诞节有很大的不同，最近两年我在伦敦见到他（自从我开始在Badoo工作以来）。 <br><br> 对我来说，住在伦敦的好处之一就是考虑雪花。 在这里，我有生以来第一次见到他们，简直令人难以置信！ <br><br> 记住这一点，我决定在圣诞节前不久，在我去特内里费岛与家人庆祝假期之前，在办公室与我分享了一个有趣的故事。 <br><br> 碰巧的是，我被分配了一项不寻常的任务，其内容如下： <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/lt/df/wd/ltdfwdnu7xreylndpr6of3vkbt8.png"><br><br> 嗯，很有趣。 我们想将带有雪花的圣诞节动画添加到我们的iOS应用程序中，我很幸运地创建了它。 但是我不知道从哪里开始。 <br><br> 像往常一样，将草图文件附加到具有必要设计的任务上，如下所示： <br><br><img src="https://habrastorage.org/webt/_d/q9/tl/_dq9tlxzvrca0jhk0lxjx3rnmhu.png"><br><br> 至少我看到了我们所需要的，但是我不确定这些雪花应该如何表现。 为了弄清所有细节，我去与设计师交谈。 <br><br> 我怀疑，他们已经在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">After Effects中</a>绘制了很棒的动画。 <br><br> 设计师向我解释说，他们希望将从上方飘落的雪花添加到启动该应用程序的现有动画中（以及徽标上的圣诞老人帽子，但这只是图片的简单替代，因此不值得在本文中提及）。 <br><br> 我知道在iOS上启动应用程序的动画是使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lottie制作的</a> ，因为它是我加入公司后添加的（详细信息可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Radek Cieciwa</a>的文章中找到）。 但是，我告诉设计师，我将尝试找到用于显示雪花的更简单的解决方案（无需使用Lottie），并开始探索各种方法。 <br><br> 这是我的同事Radek为Badoo制作的动画。 无可挑剔！ <br><br><img src="https://habrastorage.org/webt/8e/cg/jj/8ecgjj7a9ywk34vr-_idw4ckb-a.gif"><br><br> 因此，我添加了飘落的雪花。 想知道我是怎么做到的吗？ 您将在下面找到答案。 <br><br><img src="https://habrastorage.org/webt/rq/yd/gh/rqydgh5ar15k2f42kwxusdr3iq4.gif"><br><br><h1> 粒子系统 </h1><br> 在阅读有关动画的各种文档时，我记得在游戏和电影中，粒子系统通常用于解决此类问题。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">维基百科</a>非常准确地描述了这个概念： <br><br><blockquote>  “粒子系统是一种用于计算机图形学的方法，用于表示没有明确几何边界的对象（各种云，星云，爆炸，蒸汽射流，导弹列车，烟，雪，雨等）。 粒子系统可以在二维和三维图形中实现。” </blockquote><br><div class="spoiler">  <b class="spoiler_title">该技术于1982年在《星际迷航2：可汗之怒》中首次使用，以产生“创世效应”。</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/zXFNypyMJCc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br> 粒子系统由一个或多个称为图元的图形图元（例如点，线或图像）组成。 这些粒子是由作为粒子系统一部分的发射器创建和发射的。 <br><br> 每个粒子都有一组直接或间接影响其行为并确定如何绘制的参数。 粒子可以同时在大量不同方向上同时移动，以产生液体效果。 <br><br> 当系统发射粒子时，动画才会生效。 系统会在粒子系统指定区域内的任意位置发射粒子。 它可以采用多种形式：圆形，矩形，球形，框形，线形，点形等。 <br><br> 该系统还确定影响其几何形状，速度和其他参数的粒子属性。 不同的发射器API对于相似的属性具有不同的名称。 <br><br> 当系统同时发射粒子时，它们会创建令人惊叹的动画，看起来像雨，火或雪。 <br><br><img src="https://habrastorage.org/webt/m1/rj/jo/m1rjjoaqdn9cnn5gqkzjnu1o2iw.gif"><img src="https://habrastorage.org/webt/ti/zj/yi/tizjyikmqt6nvvztyycatujepgs.gif"><img src="https://habrastorage.org/webt/3e/vq/4d/3evq4dymfm0o-qaoy8qqs0jhkti.gif"><br><br><h1> 从理论到实践 </h1><br> 我认为苹果很可能在其框架之一中内置了粒子系统支持。 搜索结果表明我是对的。 <br><br> 粒子系统是Core Animation框架的一部分，并且在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CAEmitterLayer</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CAEmitterCell类</a>中进行了很好的描述。 <br><br> 在研究了有关iOS上的粒子系统和受支持的API的所有必要信息之后，我继续进行我最喜欢的部分-实现我们的想法。 <br><br> 不幸的是，圣诞节不会永远结束，因此我们需要能够在12月25日之后远程关闭雪花的功能。 <br><br> 如前所述，应用程序启动动画是使用Lottie实现的。 也就是说，我需要找到一种不影响现有动画及其代码的添加雪花的方法，因为我的解决方案必须在发行后立即删除。 <br><br> 我找到了一种非常简单的方法-添加了一个新的透明UIView，以在现有动画和背景前显示雪花，然后使用一个标记远程控制其外观。 <br><br><img src="https://habrastorage.org/webt/rm/_l/zk/rm_lzk5j94unwv3h5lqj9mqv65a.png"><br><br> 上图显示了最终解决方案中使用的UIView： <br><br><ol><li>  <b>UIView</b>带有发射雪花的粒子系统。 <br></li><li>  Lottie驱动的应用程序启动动画中使用的UIViews。 <br></li></ol><br><br> 解决此问题后，我必须创建一个包含粒子发射逻辑的组件以生成动画雪花。 <br><br> 首先，我需要可以用作发射器内容的雪花图像。 它们应该很简单，对吧？ <br><br> 每个雪花都是一个普通的或模糊的白色圆圈。 我自己在Sketch中创建了它们。 <br><br><img src="https://habrastorage.org/webt/9p/va/zd/9pvazdqkilhjtvjtidqvl1nwsh4.png" width="500"><br><br><h1> 一些实施细节 </h1><br>  CAEmitterLayer是一种特殊的CALayer，可创建，设置动画和渲染粒子系统。 它允许您控制几何形状，位置，绘图模式等等。 <br><br> 我开始通过创建图层来开发动画： <br><br><pre><code class="swift hljs">snowEmitterLayer.emitterShape = <span class="hljs-type"><span class="hljs-type">CAEmitterLayerEmitterShape</span></span>.line snowEmitterLayer.beginTime = <span class="hljs-type"><span class="hljs-type">CACurrentMediaTime</span></span>() snowEmitterLayer.timeOffset = <span class="hljs-number"><span class="hljs-number">10.0</span></span></code> </pre> <br> 我只需要更改三个属性： <br><br><ul><li>  <b>itterShape</b> ：定义层的形状。 我使用了一条线，使雪花可以出现在整个屏幕上。 <br></li><li>  <b>beginTime</b> ：是CAMediaTiming协议的一部分，表示相对于父层动画的层动画的开始时间； <br></li><li>  <b>timeOffset</b> ：也是CAMediaTiming协议的一部分，从本质上讲，它是相对于开始时间的给定时间的快速动画。 我将值指定为10秒，这导致在动画开始的那一刻，雪花已经覆盖了整个屏幕，而这正是我们想要的（如果将值设置为0秒，则雪花将开始出现在顶部并覆盖屏幕完全是在一段时间之后）。 <br></li></ul><br> 完成图层后，我创建了两个不同的发射器：雪花较重，雪花较容易。 <br><br> 对于沉重的雪花，我将发射器设置如下： <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> flakeEmitterCell = <span class="hljs-type"><span class="hljs-type">CAEmitterCell</span></span>() flakeEmitterCell.contents = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"snowflake_dot"</span></span>)!.cgImage flakeEmitterCell.emissionRange = .pi flakeEmitterCell.lifetime = <span class="hljs-number"><span class="hljs-number">20.0</span></span> flakeEmitterCell.birthRate = <span class="hljs-number"><span class="hljs-number">30</span></span> flakeEmitterCell.scale = <span class="hljs-number"><span class="hljs-number">0.15</span></span> flakeEmitterCell.scaleRange = <span class="hljs-number"><span class="hljs-number">0.6</span></span> flakeEmitterCell.velocity = <span class="hljs-number"><span class="hljs-number">30.0</span></span> flakeEmitterCell.velocityRange = <span class="hljs-number"><span class="hljs-number">20</span></span> flakeEmitterCell.spin = -<span class="hljs-number"><span class="hljs-number">0.5</span></span> flakeEmitterCell.spinRange = <span class="hljs-number"><span class="hljs-number">1.0</span></span> flakeEmitterCell.yAcceleration = <span class="hljs-number"><span class="hljs-number">30.0</span></span> flakeEmitterCell.xAcceleration = <span class="hljs-number"><span class="hljs-number">5.0</span></span></code> </pre> <br> 如您所见，我必须更改大量属性，每个属性对于实现所需的效果都非常重要： <br><br><ul><li>  content：CGImage用来显示雪花（您记得，这是我自己创建的图像之一）； <br></li><li>  <b>missionRange</b> ：以弧度表示的角度，定义了将在其中出现粒子的圆锥（我选择了PI角度，以便粒子在整个屏幕上可见）； <br></li><li>  <b>寿命</b> ：确定一个粒子的寿命； <br></li><li>  <b>birthRate</b> ：确定<b>每秒</b>发射的粒子数； <br></li><li>  <b>scale</b>和<b>scaleRange</b> ：影响粒子大小，最大大小为1.0； 间隔确定了所创建粒子之间的尺寸偏差，从而允许发射随机大小的粒子； <br></li><li>  <b>velocity</b>和<b>velocityRange</b> ：影响粒子出现的速度； 在velocityRange中指定的值内随机偏离； <br></li><li>  <b>spin</b>和<b>spinRange</b> ：影响旋转速度（以弧度/秒为单位），并且在spinRange中指定的值内具有随机偏差； <br></li><li>  <b>yAcceleration</b>和<b>xAcceleration</b> ：这是应用于发射器的加速度矢量的两个分量。 <br></li></ul><br> 我还需要第二个发射器来产生雪花。 除以下两个以外，所有属性均保持不变： <br><br><ul><li>  <b>内容</b> ：这里我使用了带有模糊圆圈的图像； <br></li><li>  <b>速度</b> ：在这里，我不得不降低下落的速度以使雪花变亮。 <br></li></ul><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> blurryFlakeEmitterCell = <span class="hljs-type"><span class="hljs-type">CAEmitterCell</span></span>() blurryFlakeEmitterCell.contents = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"snowflake_blurry_dot"</span></span>)?.cgImage blurryFlakeEmitterCell.velocity = <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-comment"><span class="hljs-comment">//     </span></span></code> </pre> <br> 我只能连接图层和发射器，事实证明这很容易： <br><br><pre> <code class="swift hljs">snowEmitterLayer.emitterCells = [flakeEmitterCell, blurryFlakeEmitterCell] <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.layer.addSublayer(snowEmitterLayer)</code> </pre><br><h1> 结论 </h1><br> 我很快创建了一个工作版本，雪花飘落，看起来非常好。 它非常容易实现，并且不会更改现有代码。 我向设计师展示了它，他们真的很喜欢它。 <br><br> 如果您拥有正确的工具，粒子系统动画可能会给人留下深刻的印象，并且相对容易实现。 <br><br> 有关粒子系统的更多信息可以在以下来源中找到： <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">维基百科</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">雷·温德利奇</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">团结</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">艾伦·马丁论粒子系统</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN446938/">https://habr.com/ru/post/zh-CN446938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN446920/index.html">Google的愚人节反向工程</a></li>
<li><a href="../zh-CN446922/index.html">引擎盖下的猫。 第二部分</a></li>
<li><a href="../zh-CN446924/index.html">表示具有任意步长的有限差分形式的任意多项式</a></li>
<li><a href="../zh-CN446926/index.html">“所以我意识到我现在是一名约会工程师，并且可以通过其他方式将自己定位在市场上”</a></li>
<li><a href="../zh-CN446932/index.html">TDMS航道和BIM</a></li>
<li><a href="../zh-CN446940/index.html">对产品进行质量检查。 为什么很酷</a></li>
<li><a href="../zh-CN446942/index.html">服务器，您能听到我说话吗？ NeoQUEST-2019任务示例的BROP攻击</a></li>
<li><a href="../zh-CN446944/index.html">为什么要投资无利可图的公司？</a></li>
<li><a href="../zh-CN446948/index.html">Android Gustuff木马如何从您的帐户中删除奶油（法定和加密货币）</a></li>
<li><a href="../zh-CN446950/index.html">76％的制造商没有实施添加剂的经验-为什么如此好</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>