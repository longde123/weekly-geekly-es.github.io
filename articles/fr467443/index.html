<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê¶ üéß üóìÔ∏è Centre multim√©dia "Kodi" et projet Yocto üîî üö∂üèΩ üï∫üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction au projet Yocto 
 Yocto Project est un projet Open Source collaboratif visant √† simplifier le d√©veloppement de distributions pour les sys...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Centre multim√©dia "Kodi" et projet Yocto</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467443/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/q_/p2/ue/q_p2uexsi7n5tjnthirivhuwq2o.png"></div><br><h2>  Introduction au projet Yocto </h2><br>  Yocto Project est un projet Open Source collaboratif visant √† simplifier le d√©veloppement de distributions pour les syst√®mes embarqu√©s.  Yocto contient un grand nombre de mod√®les, de m√©tadonn√©es et d'outils de construction.  Dans Yocto Project, vous pouvez connecter un grand nombre de couches BSP (Platform Support Package) pour toutes sortes de plates-formes mat√©rielles. <br><br>  L'objectif principal de l'article est une tentative de montrer l'assemblage d'un package de distribution typique dans le projet Yocto en utilisant le c√©l√®bre centre multim√©dia Kodi, version 17.6 pour un ordinateur Raspberry Pi 3B √† carte unique √† titre d'exemple. <br><br>  Si, quelque part au fond de votre √¢me, vous sentez que vous √™tes un collectionneur, mais que vous n'avez pas encore d√©cid√© ce que vous souhaitez collecter, cet article est pour vous.  Si vous utilisez d√©j√† le projet Yocto dans votre travail quotidien, vous pouvez faire d√©filer cet article.  Allez directement au dernier chapitre et pr√©parez-vous. <br><br>  L'article est purement pratique et d√©montre la possibilit√© d'utiliser les r√©alisations du projet Yocto et d'OpenEmbedded pour construire le centre multim√©dia "Kodi".  Les couches Yocto sont g√©r√©es √† l'aide de l'utilitaire Repo de Google.  Un article dans le document cette s√©rie. <br><br>  Alors: allons-y. <br><a name="habracut"></a><br><h2>  Contenu: </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Installer</a> Yocto Project sur Ubuntu <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Moteur de</a> construction de distribution dans le projet Yocto <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Utilisation d'</a> OpenEmbedded avec le projet Yocto <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Package de</a> support de plateforme (BSP) <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">G√©rer les</a> calques Yocto avec Repo <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Installer</a> Repo <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Manifeste de</a> cr√©ation de distribution <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contenu du</a> manifeste <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Description du</a> manifeste <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structure du</a> manifeste <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Initialisation des</a> variables Poky <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Initialisation du r√©f√©rentiel</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Synchronisation de</a> r√©f√©rentiel <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cr√©ation d'</a> une configuration de projet Yocto <br>  Fichier de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">configuration</a> build / conf / local.conf <br>  Fichier de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">configuration</a> build / conf / bblayers.conf <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Couche</a> pour assembler un centre multim√©dia <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structure de</a> couche <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration de la</a> couche <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Composition de</a> recettes-berserk <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Composition des</a> recettes-core <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Composition des</a> recettes-noyau <br>  Recettes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">composition</a> -Mediacentre <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Composition de</a> recettes-multim√©dia <br>  Kodi Build <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Recipe Supplement</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ajout d'un nouvel</a> √©l√©ment au menu des param√®tres Kodi <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Param√®tres de</a> mise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en</a> m√©moire tampon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">maximum</a> pour la vid√©o <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Regarder la t√©l√©vision</a> sur IPTV <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Regarder Youtube</a> avec le plugin Kodi <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Extension de</a> configuration r√©seau du shell de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">console</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Recette de</a> construction de distribution <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un bref</a> guide pour cr√©er une image de distribution <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Postscript</a> <br><br><a name="install_yocto_koditv"></a><h2>  Installer Yocto Project sur Ubuntu </h2><br>  Pour cr√©er la distribution √† l'aide du projet Yocto sur Ubuntu, vous devez installer les packages suivants: <br><br><pre><code class="bash hljs">sudo apt-get install -y --no-install-suggests --no-install-recommends \ gawk wget git-core diffstat unzip texinfo gcc-multilib \ build-essential chrpath socat cpio python python3 python3-pip python3-pexpect \ xz-utils debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa libsdl1.2-dev \ xterm</code> </pre> <br>  Les packages sont install√©s √† l'aide de la commande <strong>apt-get install</strong> et de la <strong>commande √©l√©vation de</strong> privil√®ges <strong>sudo</strong> .  Dans le syst√®me Ubuntu, c'est une pratique r√©pandue lorsque la commande sudo est utilis√©e pour effectuer des actions administratives (lors de la cr√©ation de l'utilisateur principal du syst√®me, elle est automatiquement enregistr√©e dans le groupe ¬´sudo¬ª). <br><br>  Vous pouvez voir des instructions d'installation plus d√©taill√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici:</a> <br><br><a name="mechanism_build_koditv"></a><h2>  Moteur de construction de distribution dans le projet Yocto </h2><br>  Dans le projet Yocto, chaque unit√© de programme est d√©crite √† l'aide d'une recette d'assemblage.  Le langage de description de recette ressemble √† ¬´bash¬ª avec la possibilit√© d'ins√©rer des morceaux de code dans le langage python.  Vous pouvez obtenir des informations de syntaxe de base dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le manuel du projet Yocto</a> .  Un ensemble de recettes d'assemblage, selon le but, peut √™tre combin√© en couches d'assemblage distinctes. <br><br>  Les couches sont divis√©es en couches d√©pendantes du mat√©riel - couches BSP, couches UI (interface utilisateur), couches Yocto sp√©cifiques, ainsi que des couches qui impl√©mentent certaines fonctionnalit√©s: <br>  par exemple, couches d'OpenEmbedded =&gt; multim√©dia, python, perl, ruby, r√©seau, systemd, serveur Web, etc. <br><br><a name="openembedded_koditv"></a><h2>  Utilisation d'OpenEmbedded avec le projet Yocto </h2><br>  Et pourtant, si vous utilisez le projet Yocto, vous aurez certainement besoin de couches avec des fonctionnalit√©s suppl√©mentaires, c'est-√†-dire  Un large √©ventail de recettes pour toutes les occasions.  Et il existe un tel ensemble - ce sont des recettes d'OpenEmbedded.  OpenEmbedded est une infrastructure de construction de packages pour Linux embarqu√©. <br><br>  OpenEmbedded est enti√®rement compatible avec le projet Yocto, car ce projet a √©t√© pris comme base pour le projet Yocto.  C'est peut-√™tre pour cela que le projet Yocto a une stabilit√© l√©g√®rement meilleure, une meilleure documentation et un support l√©g√®rement meilleur (mais en gros c'est toujours le m√™me OpenEmbedded). <br><br><a name="package_bsp_koditv"></a><h2>  Package de support de plateforme (BSP) </h2><br>  Le Board Support Package est une ou plusieurs couches distinctes et sp√©cialis√©es pour une carte sp√©cifique qui d√©finit les caract√©ristiques mat√©rielles de la plate-forme, c'est-√†-dire  impl√©mente les √©l√©ments sp√©cifiques qui distinguent une carte d'une autre: fonctionnalit√©s du processeur, interruptions, adressage, fonctionnalit√©s du chargeur de d√©marrage, fonctionnalit√©s de l'adaptateur vid√©o (GPU), etc. <br><br>  Cet article utilise la couche BSP - <strong>meta-raspberrypi</strong> <br>  Le r√©f√©rentiel de couches est situ√© √†: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">git.yoctoproject.org/git/meta-raspberrypi</a> <br><br><a name="repo_koditv"></a><h2>  G√©rer les calques Yocto avec Repo </h2><br>  Yocto Project peut utiliser un grand nombre de couches de diff√©rents fournisseurs - d√©veloppeurs d'√©quipements, et tout cela doit √™tre g√©r√© d'une mani√®re ou d'une autre.  Imaginez que vous ayez une douzaine de cartes diff√©rentes, et chaque carte est livr√©e avec un r√©f√©rentiel git BSP distinct, et cela ne compte pas l'infrastructure du projet Yocto lui-m√™me, ainsi que les fonctionnalit√©s suppl√©mentaires possibles d'OpenEmbedded. <br><br>  Dans cette situation, vous ne vous en sortirez pas avec un script d'installation simple s√©par√©.  Willy-nilly, doit chercher des outils qui peuvent bien le faire.  Encore plus que bien.  L'un des meilleurs outils de ce type est l'utilitaire Google - Repo. <br><br>  <strong>Repo</strong> est le principal outil de gestion des r√©f√©rentiels GIT lors de la construction du syst√®me d'exploitation Android avec sa grande base de code.  Repo vous permet de g√©rer une douzaine, sinon une centaine de r√©f√©rentiels git s√©par√©s dans un projet, dont vous pouvez sp√©cifier soigneusement les versions dans un fichier xml du <strong>Manifeste</strong> <br><br>  et pour la synchronisation correcte de toutes les versions de tous les r√©f√©rentiels, il vous suffit d'ex√©cuter une seule commande <br><br>  <strong>synchronisation de repo</strong> <br><br><a name="install_repo_koditv"></a><h3>  Installer Repo </h3><br>  En utilisant l'ensemble de commandes suivant, vous pouvez installer Repo dans votre r√©pertoire personnel <strong>~ / bin</strong> <br>  (la commande curl peut √™tre install√©e s√©par√©ment: sudo apt-get install curl) <br><br><pre> <code class="bash hljs">PATH=<span class="hljs-variable"><span class="hljs-variable">${PATH}</span></span>:~/bin mkdir ~/bin curl http://commondatastorage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo chmod a+x ~/bin/repo</code> </pre><br><br>  et √† l'avenir, vous aurez juste besoin d'utiliser la commande dans la console: <strong>repo</strong> <br><br><blockquote>  ou alors <br>  si le r√©pertoire HOME / bin n'est pas ajout√© automatiquement avec le chemin de d√©marrage standard <br>  voir le fichier HOME / .profile <br><br>  $ <br>  $ PATH = $ {PATH}: ~ / bin <br>  $ repo <br>  $ <br></blockquote><br><a name="manifest_repo_koditv"></a><h3>  Manifeste de cr√©ation de distribution </h3><br>  La distribution recueillie dans le cadre de l'article, je dois l'appeler quelque chose.  Que ce soit le nom <strong>Torvin</strong> .  Nom de code Torvin, il contiendra une distribution Linux minimaliste avec l'assemblage d'un seul programme.  Cela fait r√©f√©rence √† un programme utilisateur d'application - Kodi, et rien de plus (tout le reste est un niveau syst√®me).  Pour un centre multim√©dia, √† mon avis, cela suffit. <br><br><a name="context_repo_koditv"></a><h3>  Contenu du manifeste </h3><br>  Le fichier <strong>torvin-0.2.5.xml</strong> est utilis√© pour g√©rer les couches de distribution <strong>.</strong> <br><br><pre> <code class="xml hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">default</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sync-j</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">revision</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rocko"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">remote</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fetch</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://git.yoctoproject.org/git"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"yocto"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">remote</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fetch</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://github.com/openembedded"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"oe"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">remote</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fetch</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://github.com/berserktv"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bs"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">remote</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">revision</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"master"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bs-manifest"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sources/bs-manifest"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">linkfile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"setup-environment"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"setup-environment"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">linkfile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shell.sh"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"raspberry/shell.sh"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">linkfile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sources/base"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"raspberry/rocko"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">remote</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"yocto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">revision</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rocko"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"poky"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sources/poky"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">remote</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"oe"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">revision</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rocko"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"meta-openembedded"</span></span></span><span class="hljs-tag"> \ </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sources/meta-openembedded"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">remote</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"yocto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">revision</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rocko"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"meta-raspberrypi"</span></span></span><span class="hljs-tag"> \ </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sources/meta-raspberrypi"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">remote</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">revision</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rocko"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"berserk"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sources/berserk"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><a name="desc_repo_koditv"></a><h3>  Description du manifeste </h3><br>  Au d√©but du manifeste, <strong>les</strong> balises <strong>distantes</strong> d√©signent deux r√©f√©rentiels GIT principaux et un auxiliaire: <br><br>  <strong>https: ‚ÅÑ‚ÅÑgit.yoctoproject.org / git</strong> - D√©p√¥t Yocto nomm√© <strong>yocto</strong> <br>  <strong>https: ‚ÅÑ‚ÅÑgithub.com / openembedded</strong> - R√©f√©rentiel OpenEmbedded nomm√© <strong>oe</strong> <br>  https: ‚ÅÑ‚ÅÑgithub.com / berserktv - r√©f√©rentiel GIT auxiliaire nomm√© <strong>bs</strong> <br><br>  Dans la partie suivante du manifeste, en utilisant une d√©nomination abr√©g√©e, nous travaillons avec des projets situ√©s dans ces r√©f√©rentiels, la balise de <strong>projet</strong> contient les attributs suivants: <br><br>  <strong>remote</strong> - le nom du r√©f√©rentiel nomm√© distant <br>  <strong>revision</strong> - le nom de la version de branche ou de hachage <br>  <strong>name</strong> - nom du projet dans le r√©f√©rentiel sp√©cifi√© <br>  <strong>path</strong> - le chemin du projet local dans votre syst√®me de fichiers <br><br><pre> <code class="html hljs xml">   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">remote</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">revision</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"master"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bs-manifest"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sources/bs-manifest"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span>  xml      : git clone https://github.com/berserktv/bs-manifest -b master sources/bs-manifest</code> </pre><br>  Dans le corps de la balise de <strong>projet</strong> , j'ai indiqu√© des commandes pour cr√©er des liens symboliques vers l'infrastructure de scripts auxiliaires d'initialisation initiale et de d√©marrage r√©gulier du syst√®me de construction <strong>Poky</strong> dont j'ai <strong>besoin</strong> <br><br><pre> <code class="html hljs xml">   linkfile <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">remote</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">revision</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"master"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bs-manifest"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sources/bs-manifest"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">linkfile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"setup-environment"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"setup-environment"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">linkfile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shell.sh"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"raspberry/shell.sh"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">linkfile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sources/base"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"raspberry/rocko"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span>        : ln -s src dest .. #      ln -s sources/bs-manifest/setup-environment setup-environment ln -s sources/bs-manifest/raspberry/shell.sh shell.sh #    ,  #      cd sources ln -s bs-manifest/raspberry/rocko base</code> </pre><br><a name="struct_repo_koditv"></a><h3>  Structure du manifeste BS </h3><br><pre> ‚îú‚îÄ‚îÄ COPYING.MIT
 ‚îú‚îÄ‚îÄ framboise
 ‚îÇ ‚îú‚îÄ‚îÄ rocko
 ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ conf
 ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ bblayers.conf
 ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ local.conf
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ torvin-0.2.5.xml
 ‚îÇ ‚îî‚îÄ‚îÄ shell.sh
 ‚îú‚îÄ‚îÄ README.md
 ‚îî‚îÄ‚îÄ environnement de configuration
</pre><br><br>  Le projet <strong>bs-manifest</strong> est utilis√© pour une gestion de configuration flexible, en tenant compte des assemblages de diff√©rentes versions de la distribution.  J'ai cette version - 0.2.5 <br><br><a name="env_repo_koditv"></a><h3>  Initialisation des variables Poky </h3><br>  L' <strong>environnement de configuration du</strong> script d'initialisation est issu du projet Freescale Community (dans l'environnement yocto, c'est une solution courante).  Le script est responsable de l'initialisation des variables du syst√®me de construction Poky, le script cr√©e une structure de r√©pertoire dans laquelle il est tr√®s bien divis√©: <br><br><ul><li>  <strong>build</strong> - r√©pertoire de <strong>construction</strong> </li><li>  <strong>source</strong> - code source des recettes d'assemblage </li><li>  <strong>download</strong> - r√©pertoire pour t√©l√©charger le code du programme (bases de donn√©es git, archives tar.gz) </li></ul><br>  Le contenu du script setup-environment peut √™tre consult√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici:</a> <br><br><div class="spoiler">  <b class="spoiler_title">Contenu du script Shell.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment">#!/bin/bash MACHINE='raspberrypi3' source ./setup-environment build echo "you may try 'bitbake core-image-minimal'" bash</span></span></code> </pre><br></div></div><br>  Ce script racine sert √† initialiser les variables de configuration de l'environnement de g√©n√©ration et est g√©n√©ralement appel√© au d√©but d'une session. <br><br><a name="init_repo_koditv"></a><h3>  Initialisation du r√©f√©rentiel </h3><br>  Pour initialiser le d√©p√¥t, vous devez ex√©cuter la commande: <br><br><pre> <code class="bash hljs">mkdir torvin <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> torvin repo init -u https:‚ÅÑ‚ÅÑgithub.com/berserktv/bs-manifest -m raspberry/rocko/torvin-0.2.5.xml</code> </pre><br>  o√π <strong>-u https: ‚ÅÑ‚ÅÑgithub.com / berserktv / bs-manifest</strong> indique √† GIT le chemin vers le projet de manifeste <br><br>  remarque: vous pouvez √©galement sp√©cifier <strong>-b nom_arbre</strong> <br>  (si vous ne sp√©cifiez pas le commutateur -b, la branche principale est suppos√©e (par d√©faut)) <br><br>  o√π le chemin <strong>-m framboise / rocko / torvin-0.2.5.xml</strong> vers le fichier de configuration indique ce qui suit: <br><br><ol><li>  Le nom de la plate-forme mat√©rielle pour laquelle l'assemblage est effectu√© - <strong>framboise</strong> </li><li>  Le nom de la principale branche de travail Yocto / OpenEmbedded est <strong>rocko</strong> </li><li>  Le nom de code de la version est <strong>torvin</strong> (toutes les versions de la s√©rie 0.2.x) </li><li>  Le num√©ro de version num√©rique en cours d'assemblage est <strong>0,2,5</strong> </li></ol><br><a name="sync_repo_koditv"></a><h3>  Synchronisation de r√©f√©rentiel </h3><br>  pour d√©marrer ou synchroniser ult√©rieurement, il suffit d'ex√©cuter la commande: <br><br><pre> <code class="bash hljs">repo sync</code> </pre><br>  qui r√©cup√©rera toutes les derni√®res versions des projets GIT sp√©cifi√©es dans le fichier manifeste (les branches sont g√©n√©ralement indiqu√©es), si vous avez un commit de hachage ou un nom de balise dans l'attribut de r√©vision, la version de ce r√©f√©rentiel git ne changera pas.  Le nom de la balise peut √™tre sp√©cifi√© comme ceci: revision = "refs / tags / v0.2.5" <br><br><a name="config_koditv"></a><h3>  Cr√©ation d'une configuration de projet Yocto </h3><br>  Une fois la commande repo sync ex√©cut√©e, vous pouvez commencer √† cr√©er la configuration principale du projet Yocto: <br><br><pre> <code class="bash hljs">./shell.sh</code> </pre><br>  une fois le script termin√©, le r√©pertoire <strong>build / conf</strong> sera cr√©√©: <br>  avec deux fichiers principaux: <br><br><ul><li>  <strong>local.conf</strong> - Variables de contr√¥le d'assemblage: <br>  nom de la plateforme, type de packages de distribution et de build, etc. </li><li>  <strong>bblayers.conf</strong> - configuration des couches connect√©es du projet Yocto </li></ul><br>  par d√©faut, le script setup-environment recherche les <strong>sources / base / conf</strong> <br>  configuration initiale et si les <strong>fichiers</strong> <strong>local.conf</strong> et <strong>bblayers.conf</strong> <br>  existent, ils sont copi√©s dans <strong>build / conf</strong> <br>  (voir la variable TEMPLATES dans setup-environment) <br><br>  c'est-√†-dire  les fichiers proviennent de sources / bs-manifest / raspberry / rocko / conf <br>  voir cr√©er un lien symbolique vers la base <br><br><a name="local_conf_config_koditv"></a><h3>  Fichier de configuration build / conf / local.conf </h3><br><div class="spoiler">  <b class="spoiler_title">Afficher / masquer</b> <div class="spoiler_text"><pre> <code class="bash hljs"> MACHINE ??= <span class="hljs-string"><span class="hljs-string">'raspberrypi3'</span></span> DISTRO ?= <span class="hljs-string"><span class="hljs-string">'poky'</span></span> PACKAGE_CLASSES ?= <span class="hljs-string"><span class="hljs-string">"package_deb"</span></span> EXTRA_IMAGE_FEATURES ?= <span class="hljs-string"><span class="hljs-string">"debug-tweaks"</span></span> USER_CLASSES ?= <span class="hljs-string"><span class="hljs-string">"buildstats image-mklibs image-prelink"</span></span> PATCHRESOLVE = <span class="hljs-string"><span class="hljs-string">"noop"</span></span> BB_DISKMON_DIRS = <span class="hljs-string"><span class="hljs-string">"\ STOPTASKS,</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${TMPDIR}</span></span></span><span class="hljs-string">,1G,100K \ STOPTASKS,</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DL_DIR}</span></span></span><span class="hljs-string">,1G,100K \ STOPTASKS,</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${SSTATE_DIR}</span></span></span><span class="hljs-string">,1G,100K \ STOPTASKS,/tmp,100M,100K \ ABORT,</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${TMPDIR}</span></span></span><span class="hljs-string">,100M,1K \ ABORT,</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DL_DIR}</span></span></span><span class="hljs-string">,100M,1K \ ABORT,</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${SSTATE_DIR}</span></span></span><span class="hljs-string">,100M,1K \ ABORT,/tmp,10M,1K"</span></span> PACKAGECONFIG_append_pn-qemu-native = <span class="hljs-string"><span class="hljs-string">" sdl"</span></span> PACKAGECONFIG_append_pn-nativesdk-qemu = <span class="hljs-string"><span class="hljs-string">" sdl"</span></span> CONF_VERSION = <span class="hljs-string"><span class="hljs-string">"1"</span></span> DL_DIR ?= <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${BSPDIR}</span></span></span><span class="hljs-string">/downloads/"</span></span> <span class="hljs-comment"><span class="hljs-comment"># size memory GPU for Raspberry Pi GPU_MEM = "128" GPU_MEM_256 = "112" GPU_MEM_512 = "160" GPU_MEM_1024 = "320" # for libs: "mpeg2dec libmad ffmpeg x264" LICENSE_FLAGS_WHITELIST += "commercial"</span></span></code> </pre><br></div></div><br><a name="bblayers_conf_config_koditv"></a><h3>  Fichier de configuration build / conf / bblayers.conf </h3><br><div class="spoiler">  <b class="spoiler_title">Afficher / masquer</b> <div class="spoiler_text"><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment"># POKY_BBLAYERS_CONF_VERSION is increased each time build/conf/bblayers.conf # changes incompatibly LCONF_VERSION = "6" POKY_BBLAYERS_CONF_VERSION = "2" BBPATH = "${TOPDIR}" BSPDIR := \ "${@os.path.abspath(os.path.dirname(d.getVar('FILE', True)) + '/../..')}" BBFILES ?= "" BBLAYERS ?= " \ ${BSPDIR}/sources/poky/meta \ ${BSPDIR}/sources/poky/meta-poky \ ${BSPDIR}/sources/poky/meta-yocto-bsp \ ${BSPDIR}/sources/meta-openembedded/meta-oe \ ${BSPDIR}/sources/meta-openembedded/meta-python \ ${BSPDIR}/sources/meta-openembedded/meta-networking \ ${BSPDIR}/sources/meta-openembedded/meta-multimedia \ ${BSPDIR}/sources/meta-openembedded/meta-filesystems \ ${BSPDIR}/sources/meta-raspberrypi \ ${BSPDIR}/sources/berserk/meta-berserk \ "</span></span></code> </pre><br></div></div><br><br>  les principales variables du fichier local.conf - auxquelles vous devez faire attention: <br><br><ul><li>  MACHINE - le nom de la plate-forme sous laquelle l'assemblage est effectu√© </li><li>  DISTRO - nom de la cat√©gorie de distribution </li><li>  PACKAGE_CLASSES - format de package pour l'installation du logiciel </li><li>  LICENSE_FLAGS_WHITELIST - utilisation de licences suppl√©mentaires </li></ul><br>  param√®tres sp√©cifiques pour la famille de cartes Raspberry Pi <br><br><ul><li>  GPU_MEM = "128" - la quantit√© de m√©moire vid√©o pour l'adaptateur vid√©o GPU (allou√©e √† partir de la RAM) </li><li>  GPU_MEM_256 = "112" - le m√™me que pour les cartes avec une taille totale de RAM = 256 Mo </li><li>  GPU_MEM_512 = "160" - le m√™me que pour les cartes avec une taille totale de RAM = 512 Mo </li><li>  GPU_MEM_1024 = "320" - il en va de m√™me pour les cartes avec une taille totale de RAM = 1024 Mo </li></ul><br><blockquote>  note: <br>  par exemple, si vous ne laissez que la variable GPU_MEM = "128", <br>  puis pour toutes les cartes RPI, RPI2, RPI3 <br>  quelle que soit la quantit√© de RAM r√©elle <br>  sur la carte sera toujours allou√© pour le GPU - 128 Mo <br>  (et la taille totale de la RAM diminue de cette valeur) <br></blockquote><br>  si toutes les variables sont sp√©cifi√©es, les directives GPU_MEM_256, GPU_MEM_512, GPU_MEM_1024 sont plus prioritaires. <br><br>  Pour l'assemblage du Multimedia Center, en plus des couches Yocto r√©guli√®res, voir le fichier bblayers.conf <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">${BSPDIR}</span></span>/sources/poky/meta \ <span class="hljs-variable"><span class="hljs-variable">${BSPDIR}</span></span>/sources/poky/meta-poky \ <span class="hljs-variable"><span class="hljs-variable">${BSPDIR}</span></span>/sources/poky/meta-yocto-bsp \</code> </pre><br>  J'ai connect√© quatre couches avec des fonctionnalit√©s suppl√©mentaires d'OpenEmbedded. <br><br>  Kodi Multimedia Center - est un programme complexe qui utilise un grand nombre de biblioth√®ques externes et vous devez cr√©er chaque biblioth√®que en utilisant la recette de construction, donc si possible j'utiliserai toutes les recettes d'OpenEmbedded dans la cat√©gorie <strong>Multim√©dia</strong> <br><br>  Donc, j'ai une couche multim√©dia connect√©e et les couches dont elle d√©pend <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">${BSPDIR}</span></span>/sources/meta-openembedded/meta-oe \ <span class="hljs-variable"><span class="hljs-variable">${BSPDIR}</span></span>/sources/meta-openembedded/meta-python \ <span class="hljs-variable"><span class="hljs-variable">${BSPDIR}</span></span>/sources/meta-openembedded/meta-networking \ <span class="hljs-variable"><span class="hljs-variable">${BSPDIR}</span></span>/sources/meta-openembedded/meta-multimedia \</code> </pre><br>  puis une autre couche OpenEmbedded est connect√©e pour fonctionner avec les syst√®mes de fichiers <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">${BSPDIR}</span></span>/sources/meta-openembedded/meta-filesystems \</code> </pre><br>  en outre connect√© la couche BSP principale de la plate-forme Raspberry Pi <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">${BSPDIR}</span></span>/sources/meta-raspberrypi \</code> </pre><br>  Eh bien, √† la toute fin, une couche suppl√©mentaire est connect√©e, qui est charg√©e d'assembler l'image de distribution avec les fonctionnalit√©s du "Multimedia Center" <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">${BSPDIR}</span></span>/sources/berserk/meta-berserk \</code> </pre><br><a name="layer_koditv"></a><h2>  Couche pour assembler un centre multim√©dia </h2><br>  √Ä mon avis, le projet Yocto est une combinaison industrielle pour cr√©er des distributions int√©gr√©es.  Mais si vous avez d√©j√† travaill√© avec le syst√®me de construction Buildroot, alors Yocto peut vous sembler lourd.  Il utilise une √©norme quantit√© d'espace libre sur le disque dur.  Pour un fonctionnement normal, Yocto n√©cessite environ 80 √† 100 Go d'espace libre, et cela ne prend g√©n√©ralement en compte l'assemblage que pour une seule plate-forme. <br><br>  Yocto fait face √† son objectif principal - prendre en charge autant de plates-formes mat√©rielles diff√©rentes que possible, et cela n√©cessite le m√©canisme le plus flexible pour commuter les assemblages.  Et ce m√©canisme a besoin de temps et de lieu.  Construire une distribution dans Yocto n'est pas un processus rapide. <br><br>  Donc, toutes les fonctionnalit√©s d'assemblage du "Multimedia Center" que j'ai avec une couche s√©par√©e: <br><br><pre> <code class="bash hljs">https://github/berserktv/berserk</code> </pre><br>  (Titre tir√© de mon livre pr√©f√©r√©, The Hammer and the Cross, de Harry Harrison.) <br>  (Torvin est √©galement un personnage de ce livre.) <br><br>  Pour cr√©er les fonctionnalit√©s dont j'ai besoin, j'utiliserai les soi-disant modules compl√©mentaires pour les recettes, qui se trouvent dans des fichiers avec l'extension .bbappend <br>  dans le fichier .bbappend, vous pouvez ajouter vos propres appels de commande pour la m√©thode de recette de g√©n√©ration standard, par exemple, √† la m√©thode do_configure, do_compile, do_install, etc. <br><br><a name="struct_top_layer_koditv"></a><h3>  Structure de couche </h3><br><pre> ‚îú‚îÄ‚îÄ COPYING.MIT
 ‚îú‚îÄ‚îÄ meta-berserk
 ‚îÇ ‚îú‚îÄ‚îÄ conf
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ layer.conf
 ‚îÇ ‚îú‚îÄ‚îÄ recettes-berserk
 ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ bs-net
 ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ premi√®re manche
 ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ images
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ tv
 ‚îÇ ‚îú‚îÄ‚îÄ recettes-core
 ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ init-ifupdown
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ psplash
 ‚îÇ ‚îú‚îÄ‚îÄ noyau de recettes
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ linux
 ‚îÇ ‚îú‚îÄ‚îÄ recettes-mediacentre
 ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ kodi
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ plugins kodi
 ‚îÇ ‚îî‚îÄ‚îÄ recettes-multim√©dia
 ‚îÇ ‚îî‚îÄ‚îÄ ffmpeg
 ‚îú‚îÄ‚îÄ README.md
 ‚îî‚îÄ‚îÄ changelog.txt
</pre><br><br>  Composition de couche: <br><br><ul><li>  <strong>conf</strong> - configuration des couches </li><li>  <strong>recipes-berserk</strong> - recette de construction de distribution, tv, r√©seau et premi√®res recettes de lancement </li><li>  <strong>recipes-core</strong> - recettes de base, en particulier une modification de la recette de d√©marrage </li><li>  <strong>recipes-kernel</strong> - Recettes de construction de noyau Linux </li><li>  <strong>recipes-mediacentre</strong> - recettes pour construire Kodi et ses plugins </li><li>  <strong>recipes-multimedia</strong> - recettes multim√©dias, assemblage ffmpeg </li></ul><br><a name="config_layer_koditv"></a><h3>  configuration des couches </h3><br><div class="spoiler">  <b class="spoiler_title">inclut le fichier layer.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment"># We have a conf and classes directory, add to BBPATH BBPATH .= ":${LAYERDIR}" # We have a packages directory, add to BBFILES BBFILES += "${LAYERDIR}/recipes-*/*/*.bb \ ${LAYERDIR}/recipes-*/*/*.bbappend" BBFILE_COLLECTIONS += "bs" BBFILE_PATTERN_bs := "^${LAYERDIR}/" BBFILE_PRIORITY_bs = "5" DISTRO_FEATURES_append += " wifi x11" PREFERRED_VERSION_ffmpeg = "3.1.11" SYSVINIT_ENABLED_GETTYS = "1" PREFERRED_VERSION_linux-raspberrypi ?= "4.9%"</span></span></code> </pre><br></div></div><br>  Le fichier contient une indication de la version de la biblioth√®que ffmpeg, le num√©ro de version du noyau linux, ainsi que le nombre de consoles virtuelles (tty), et inclut les fonctionnalit√©s du kit de distribution - wifi x11 <br><blockquote>  DISTRO_FEATURES_append + = "wifi x11" <br><br>  PREFERRED_VERSION_ffmpeg = "3.1.11" <br>  SYSVINIT_ENABLED_GETTYS = "1" <br><br>  PREFERRED_VERSION_linux-raspberrypi? = "4.9%" <br></blockquote><br><a name="berserk_layer_koditv"></a><h3>  composition de recettes-berserk </h3><br><pre> ‚îú‚îÄ‚îÄ bs-net
 ‚îÇ ‚îî‚îÄ‚îÄ bs-net_0.1.3.bb
 ‚îú‚îÄ‚îÄ premi√®re manche
 ‚îÇ ‚îú‚îÄ‚îÄ fichiers
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ first-run.sh
 ‚îÇ ‚îî‚îÄ‚îÄ first-run.bb
 ‚îú‚îÄ‚îÄ images
 ‚îÇ ‚îî‚îÄ‚îÄ berserk-image.bb
 ‚îî‚îÄ‚îÄ tv
     ‚îú‚îÄ‚îÄ fichiers
     ‚îÇ ‚îî‚îÄ‚îÄ berserk.m3u8
     ‚îú‚îÄ‚îÄ tv-config.bb
     ‚îî‚îÄ‚îÄ tv-dir.inc
</pre><br><br>  o√π: <br><br><ul><li>  bs-net_0.1.3.bb - recette pour la construction d'extensions shell pour les interfaces WLAN / Ethernet </li><li>  first-run.bb - recette pour la premi√®re ex√©cution, partitionnement de disque suppl√©mentaire </li><li>  first-run.sh - script shell de la premi√®re ex√©cution (ex√©cution au niveau d'ex√©cution S) </li><li>  berserk-image.bb - recette pour construire l'image de distribution </li><li>  tv-config.bb - recette pour configurer les cha√Ænes de t√©l√©vision en utilisant IPTV </li><li>  berserk.m3u8 - configuration des cha√Ænes de t√©l√©vision publiques (format m3u8) </li></ul><br><a name="core_layer_koditv"></a><h3>  recettes-composition de base </h3><br><pre> ‚îú‚îÄ‚îÄ init-ifupdown
 ‚îÇ ‚îú‚îÄ‚îÄ fichiers
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ interfaces
 ‚îÇ ‚îî‚îÄ‚îÄ init-ifupdown_1.0.bbappend
 ‚îî‚îÄ‚îÄ psplash
     ‚îú‚îÄ‚îÄ fichiers
     ‚îÇ ‚îî‚îÄ‚îÄ psplash-berserk-img.h
     ‚îî‚îÄ‚îÄ psplash_git.bbappend
</pre><br><br>  o√π: <br><br><ul><li>  interfaces - fichier avec le param√®tre r√©seau actuel </li><li>  init-ifupdown_1.0.bbappend - extension pour la recette de configuration du r√©seau </li><li>  psplash-berserk-img.h - image de l'√©conomiseur d'√©cran de d√©marrage <br>  fichier d'en-t√™te obtenu √† l'aide de l'utilitaire gdk-pixbuf-csource </li><li>  psplash_git.bbappend - extension de la recette pour d√©marrer l'√©conomiseur d'√©cran de d√©marrage </li></ul><br>  La configuration r√©seau sur le p√©riph√©rique cible se trouve dans le fichier: <br><br><pre> <code class="bash hljs">/etc/network/interfaces</code> </pre><br>  Apr√®s avoir ajout√© l'extension de la recette init-ifupdown, je remplace le fichier de configuration normal par le mien et change l'ordre (priorit√©) du script ex√©cut√© pour les niveaux d'ex√©cution <br><br><pre> <code class="bash hljs">INITSCRIPT_PARAMS = <span class="hljs-string"><span class="hljs-string">"start 98 2 3 4 5 . stop 10 0 6 1 ."</span></span></code> </pre><br>  √Ä l'heure actuelle, presque toutes les distributions Linux modernes incluent un √©cran de d√©marrage.  En r√®gle g√©n√©rale, l'√©conomiseur d'√©cran de d√©marrage affiche l'√©tat actuel du t√©l√©chargement, c'est-√†-dire  indicateur du temps √©coul√© depuis le d√©marrage du syst√®me.  √Ä cet √©gard, Yocto ne fait pas exception et vous pouvez changer l'image de l'√©conomiseur d'√©cran de d√©marrage standard en une image arbitraire. <br><br>  Pour ce faire, vous devez: <br><br><ol><li>  FILESEXTRAPATHS_prepend - ajoute un r√©pertoire pour les ressources </li><li>  SRC_URI - ajouter un fichier d'en-t√™te avec une image arbitraire </li><li>  SPLASH_IMAGES - modifier la variable de contr√¥le du package </li></ol><br>  et plus loin dans la recette d'image "berserk-image.bb", il est n√©cessaire d'ajouter l'image de d√©marrage de d√©marrage comme caract√©ristiques de l'image <br><br><pre> <code class="bash hljs">IMAGE_FEATURES += <span class="hljs-string"><span class="hljs-string">"splash"</span></span> <span class="hljs-comment"><span class="hljs-comment">#          SPLASH = "psplash-berserk"</span></span></code> </pre><br><a name="kernel_layer_koditv"></a><h2>  composition de recettes-noyau </h2><br><pre> ‚îî‚îÄ‚îÄ linux
     ‚îú‚îÄ‚îÄ fichiers
     ‚îÇ ‚îú‚îÄ‚îÄ db.txt.patch
     ‚îÇ ‚îî‚îÄ‚îÄ rbpi.cfg
     ‚îî‚îÄ‚îÄ linux-raspberrypi_4.9.bbappend
</pre><br><br>  o√π: <br><br><ul><li>  db.txt.patch - correctif avec la base du domaine r√©glementaire (utilis√© pour le WiFi) </li><li>  rbpi.cfg - Fragment de configuration du noyau Linux </li><li>  linux-raspberrypi_4.9.bbappend - extension de la recette de construction du noyau 4.9 pour Raspberry Pi </li></ul><br>  Les appareils Wi-Fi fonctionnent √† certaines fr√©quences et pour eux, il existe un domaine r√©glementaire - c'est le param√®tre qui indique le pays dans lequel cet appareil est cens√© fonctionner. <br><br>  Le noyau Linux poss√®de une base de donn√©es compl√©mentaire dans laquelle les fr√©quences autoris√©es et la puissance autoris√©e pour celles-ci sont enregistr√©es pour chaque pays. <br><br>  Dans le cas le plus simple, cette base de donn√©es peut √™tre directement incluse statiquement dans le noyau en sp√©cifiant un param√®tre: <br>  <strong>CONFIG_CFG80211_INTERNAL_REGDB = y</strong> <br>  c'est <strong>exactement</strong> ce que j'ai fait en connectant un patch √† cette base de donn√©es <strong>db.txt.patch</strong> <br><br>  Et encore une chose: dans Yocto, il existe des fragments de configurations de noyau.  Habituellement, un fragment de configuration, un fichier avec l'extension cfg, contient uniquement les param√®tres du noyau dont vous avez clairement besoin √† certaines fins.  Et ce morceau de configuration est ajout√© aux param√®tres par d√©faut qui sont d√©j√† pr√©sents dans la recette lors de la construction du noyau. <br><br>  En plus de la recette bbappend, vous pouvez √©galement modifier les param√®tres qui sont pass√©s au noyau lors du d√©marrage: <br><br>  c'est-√†-dire  remplacer la variable <br>  <strong>CMDLINE</strong> voir fichier linux-raspberrypi_4.9.bbappend <br><br><div class="spoiler">  <b class="spoiler_title">Contenu rbpi.cfg</b> <div class="spoiler_text"><pre> <code class="html hljs xml"> # use statically compiled regulatory rules database CONFIG_CFG80211_INTERNAL_REGDB=y #  Wifi  Asus USB-N53 chipset Ralink RT3572 CONFIG_RT2800USB=m #  wifi    Atheros D-Link DWA-126 802.11n (AR9271), # NetGear WNDA3200, NetGear WNA1100, TP-Link TL-WN722N (AR9271), # TL-WN322G v3, TL-WN422G  .. . cateee.net CONFIG_ATH9K_HW=m CONFIG_ATH9K_HTC=m #  Wifi    wpa_supplicant CONFIG_WIRELESS=y CONFIG_WEXT_CORE=y CONFIG_WEXT_PROC=y CONFIG_CRYPTO_AES=y #    IPSec,    Wifi  #   wpa_supplicant   CONFIG_CRYPTO_CCM=m CONFIG_CRYPTO_CTR=m CONFIG_CRYPTO_ARC4=m ######################### #   CONFIG_HAVE_PERF_EVENTS=y CONFIG_PERF_EVENTS=y CONFIG_HAVE_LATENCYTOP_SUPPORT=y CONFIG_LATENCYTOP=y # This option adds support for ASIX AX88xxx # based USB 2.0 10/100 Ethernet adapters. CONFIG_USB_NET_AX8817X=m</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"> linux-raspberrypi_4.9.bbappend</b> <div class="spoiler_text"><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment">#      rpbi.cfg FILESEXTRAPATHS_prepend := "${THISDIR}/files:" SRC_URI += "file://db.txt.patch;patch=1 \ file://rbpi.cfg \ " #  BSP  meta-raspberrypi     # https://github.com/agherzan/meta-raspberrypi/issues/14 #    #   do_kernel_configme   #     arch/    do_kernel_configme_append() { cat ${WORKDIR}/rbpi.cfg &gt;&gt; ${WORKDIR}/defconfig } # CMDLINE for raspberrypi # default CMDLINE = "dwc_otg.lpm_enable=0 console=serial0,115200 # root=/dev/mmcblk0p2 rootfstype=ext4 rootwait" CMDLINE = "quiet dwc_otg.lpm_enable=0 console=serial0,115200 \ root=/dev/mmcblk0p2 rootfstype=ext4 rootwait"</span></span></code> </pre><br></div></div><br><a name="mediacentre_layer_koditv"></a><h3>  recipes-mediacentre </h3><br><pre> <code class="bash hljs">‚îú‚îÄ‚îÄ kodi ‚îÇ  ‚îú‚îÄ‚îÄ kodi ‚îÇ  ‚îú‚îÄ‚îÄ kodi_17.bbappend ‚îÇ  ‚îú‚îÄ‚îÄ kodi-dir.inc ‚îÇ  ‚îú‚îÄ‚îÄ kodi-runner.bb ‚îÇ  ‚îú‚îÄ‚îÄ kodi-settings.bb ‚îÇ  ‚îî‚îÄ‚îÄ kodi-version.inc ‚îî‚îÄ‚îÄ kodi-plugins ‚îú‚îÄ‚îÄ files ‚îú‚îÄ‚îÄ kodi-language-ru_3.0.10.bb ‚îú‚îÄ‚îÄ kodi-pvr-iptvsimple.bb ‚îú‚îÄ‚îÄ plugin-video-youtube_5.5.1.bb ‚îú‚îÄ‚îÄ screensaver-kodi-universe_0.1.2.bb ‚îú‚îÄ‚îÄ script-berserk-network_0.2.5.bb ‚îî‚îÄ‚îÄ script-module-requests_2.12.4.bb</code> </pre><br>  o√π: <br><br><ol><li> kodi/ <br><ul><li> kodi ‚Äî    <strong>icon,run,settings</strong> <br>           </li><li> kodi_17.bbappend ‚Äî       Kodi </li><li> kodi-dir.inc ‚Äî    Kodi    </li><li> kodi-runner.bb ‚Äî   Kodi     </li><li> kodi-settings.bb ‚Äî     Kodi </li><li> kodi-version.inc ‚Äî        Kodi </li></ul><br></li><li> kodi-plugins/ <br><br><ul><li> files ‚Äî   tar.gz      </li><li> kodi-language-ru_3.0.10.bb ‚Äî     (  Kodi) </li><li> kodi-pvr-iptvsimple.bb ‚Äî   Kodi  pvr-iptvsimple </li><li> plugin-video-youtube_5.5.1.bb ‚Äî   Kodi    ¬´Youtube¬ª </li><li> screensaver-kodi-universe_0.1.2.bb ‚Äî    screensaver-kodi-universe </li><li> script-berserk-network_0.2.5.bb ‚Äî      </li><li> script-module-requests_2.12.4.bb ‚Äî      Youtube </li></ul><br></li></ol><br><a name="multimedia_layer_koditv"></a><h3>  recipes-multimedia </h3><br><pre>‚îî‚îÄ‚îÄ ffmpeg<font></font>
    ‚îú‚îÄ‚îÄ ffmpeg<font></font>
    ‚îÇ  ‚îú‚îÄ‚îÄ 0001-ffmpeg-Call-get_format-to-fix-an-issue-with-MMAL-ren.patch<font></font>
    ‚îÇ  ‚îú‚îÄ‚îÄ h264_parser.patch<font></font>
    ‚îÇ  ‚îî‚îÄ‚îÄ pfcd_hevc_optimisations.patch<font></font>
    ‚îî‚îÄ‚îÄ ffmpeg_3.1.11.bb<font></font>
</pre><br><br>  o√π: <br><br><ul><li> 0001-ffmpeg-Call-get_format-to-fix-an-issue-with-MMAL-ren.patch ‚Äî   ffmpeg </li><li> h264_parser.patch ‚Äî     h264 </li><li> pfcd_hevc_optimisations.patch ‚Äî      Raspberry Pi </li><li> ffmpeg_3.1.11.bb ‚Äî    ffmpeg (,  ) </li></ul><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - biblioth√®que OpenSource pour l'encodage / d√©codage d'un grand nombre de formats vid√©o et audio. </font><font style="vertical-align: inherit;">FFmpeg prend en charge pr√®s de 400 codecs (ffmpeg -codecs) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et plus de 300 formats (ffmpeg-formats).</font></font><br><br><a name="build_kodi_koditv"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajout d'une recette de construction Kodi </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La couche OpenEmbedded a une recette r√©guli√®re pour construire Kodi, mais elle est assez g√©n√©rale, et j'aimerais obtenir une version l√©g√®rement plus stable et test√©e pour la plate-forme Raspberry Pi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les d√©veloppeurs de logiciels ont un patch de port invers√©. Le logiciel est constamment mis √† jour et chaque nouvelle version comprend √† la fois de nouvelles fonctionnalit√©s et la correction d'erreurs connues. Le patch de portage inverse vous permet de transf√©rer certaines des modifications de la nouvelle version du programme vers une ancienne, la rendant ainsi plus stable. Mais c'est un travail tr√®s dur et laborieux, qui est toujours effectu√© par un grand nombre de d√©veloppeurs.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le monde de la communaut√© OpenSource, il existe plusieurs projets bien connus utilisant Kodi, dont le meilleur (√† mon avis) est LibreElec (OpenElec). </font><font style="vertical-align: inherit;">LibreElec a une bonne version pour la plate-forme Raspberry Pi. </font><font style="vertical-align: inherit;">Ici, ils l'ont et il est pr√©f√©rable de prendre le patch de port inverse pour Kodi. </font><font style="vertical-align: inherit;">Ainsi, vous pouvez vous d√©barrasser d'un grand nombre de probl√®mes sans m√™me en avoir connaissance. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le centre multim√©dia Kodi se concentre sur la lecture du contexte ¬´Media¬ª, et √† mon avis, la composante la plus critique est la combinaison de Kodi et FFmpeg, c'est-√†-dire </font><font style="vertical-align: inherit;">l'interaction de certaines versions de ces programmes, d'autres biblioth√®ques peuvent √™tre laiss√©es √† partir des couches Yocto et OpenEmbedded. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour l'assemblage, j'ai pris la version stable de Kodi 17.6 et la version FFmpeg 3.1.11</font></font><br><br><div class="spoiler">  <b class="spoiler_title">Remarque:</b> <div class="spoiler_text"><pre> <code class="bash hljs">  ,       ,      systemD.         (   (  )).  ,     LibreElec       : <span class="hljs-comment"><span class="hljs-comment">#!/bin/bash HASH_VER="934507d922fb011ce46c76566206f2f1f603360b" git clone https://github.com/LibreELEC/LibreELEC.tv.git libreelec cd libreelec git checkout ${HASH_VER}   Kodi,   : projects/RPi2/patches/kodi (. : kodi-001-backport.patch)    FFmpeg,   : packages/multimedia/ffmpeg/patches</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fichier de description de version inclus sera tel </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kodi-version.inc</font></font></strong> <br><br><pre> <code class="bash hljs">FILESEXTRAPATHS_prepend := <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${THISDIR}</span></span></span><span class="hljs-string">/kodi:"</span></span> <span class="hljs-comment"><span class="hljs-comment">#  Krypton SRCREV = "a9a7a20071bfd759e72e7053cee92e6f5cfb5e48" PV = "17.6+gitr${SRCPV}"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La branche Yocto et OpenEmbedded que je consid√®re - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rocko</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , contient Kodi version 17.3, et pour passer √† la version 17.6, il suffit d'ajouter un petit ajout √† la recette - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kodi_17.bbappend</font></font></strong> <br><br><pre> <code class="bash hljs">require kodi-version.inc <span class="hljs-comment"><span class="hljs-comment">#     (   17.3) SRC_URI_remove = "file://0013-FTPParse.cpp-use-std-string.patch" #  ,   systemd   SRC_URI_remove = "file://0004-handle-SIGTERM.patch" #      RPI   libreelec SRC_URI_append += "file://kodi-krypton-rpb-backports.patch" #  error adding symbols: DSO missing from command line SRC_URI_append += "file://vchostif.patch" MENU_ICON = "addons/skin.estuary/media/icons/settings" #       ( ) SRC_URI_append += "file://bs-menu.patch file://icon/bs-network.png" do_configure_prepend() { install -m 0644 ${WORKDIR}/icon/bs-network.png ${S}/${MENU_ICON} } #    kodi plugins RRECOMMENDS_${PN}_append = "\ python-xml python-misc python-db \ python-crypt python-threading python-math python-email \ python-io python-netserver python-urllib3 python-datetime" #     Raspberry Pi #  OPENGL    --enable-gles #  kodi     docs/README.linux =&gt; libxmu libxinerama # libxtst xdpyinfo #      DISTRO_FEATURES   "x11" #   kodi  RPI1  RPI2,3    --disable-x11 BS_RPI = " --disable-gl --enable-openmax --enable-player=omxplayer \ --with-platform=raspberry-pi --disable-x11" BS_RPI3 = " --disable-gl --enable-openmax --enable-player=omxplayer \ --with-platform=raspberry-pi2 --disable-x11" EXTRA_OECONF_append = "${@bb.utils.contains('MACHINE', 'raspberrypi', \ '${BS_RPI}', '', d)}" EXTRA_OECONF_append = "${@bb.utils.contains('MACHINE', 'raspberrypi2', \ '${BS_RPI3}', '', d)}" EXTRA_OECONF_append = "${@bb.utils.contains('MACHINE', 'raspberrypi3', \ '${BS_RPI3}', '', d)}" #       Kodi   #  ,  USB  microSDHC  ( ) EXTRA_OECONF_append = " --enable-optical-drive"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'option de construction "--enable-Optical-Drive" vous permet de connecter le m√©canisme de notification pratique que Kodi utilise lors de la connexion d'un disque optique. </font><font style="vertical-align: inherit;">Dans ce cas, le module MediaManager (a) (xbmc / storage / MediaManager.cpp) surveille la connexion / d√©connexion des nouvelles partitions de disque et affiche un message contextuel √† ce sujet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple udev de connexion / d√©connexion de disques:</font></font><br><br><pre> <code class="bash hljs">ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span> SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"block"</span></span> ENV{ID_FS_TYPE}==<span class="hljs-string"><span class="hljs-string">"vfat"</span></span> \ KERNEL==<span class="hljs-string"><span class="hljs-string">"sd[az][0-9]"</span></span> \ RUN+=<span class="hljs-string"><span class="hljs-string">"/bin/mkdir -p /media/%k"</span></span>, \ RUN+=<span class="hljs-string"><span class="hljs-string">"/bin/mount -o iocharset=utf8,noatime /dev/%k /media/%k"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span> SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"block"</span></span> ENV{ID_FS_TYPE}==<span class="hljs-string"><span class="hljs-string">"ntfs"</span></span> \ KERNEL==<span class="hljs-string"><span class="hljs-string">"sd[az][0-9]"</span></span> \ RUN+=<span class="hljs-string"><span class="hljs-string">"/bin/mkdir -p /media/%k"</span></span>, \ RUN+=<span class="hljs-string"><span class="hljs-string">"/usr/bin/ntfs-3g -o \ iocharset=utf8,noatime,windows_names /dev/%k /media/%k"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span> SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"block"</span></span> ENV{ID_FS_TYPE}==<span class="hljs-string"><span class="hljs-string">"ext2|ext3|ext4"</span></span> \ KERNEL==<span class="hljs-string"><span class="hljs-string">"sd[az][0-9]"</span></span> \ RUN+=<span class="hljs-string"><span class="hljs-string">"/bin/mkdir -p /media/%k"</span></span>, \ RUN+=<span class="hljs-string"><span class="hljs-string">"/bin/mount -o noatime /dev/%k /media/%k"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"remove"</span></span> SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"block"</span></span> KERNEL==<span class="hljs-string"><span class="hljs-string">"sd[az][0-9]"</span></span> \ RUN+=<span class="hljs-string"><span class="hljs-string">"/bin/umount /media/%k"</span></span>, RUN+=<span class="hljs-string"><span class="hljs-string">"/bin/rmdir /media/%k"</span></span></code> </pre><br><pre> <code class="html hljs xml">:  rmdir     ,       ( Linux    -  )       .</code> </pre><br><a name="add_menu_koditv"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajout d'un nouvel √©l√©ment au menu des param√®tres Kodi </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans Kodi 17.6, les fichiers de configuration xml sont responsables de l'affichage des √©l√©ments de menu. </font><font style="vertical-align: inherit;">Pour ajouter un √©l√©ment suppl√©mentaire dans le menu "Param√®tres", ajustez simplement le fichier: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kodi / addons / skin.estuary / xml / Settings.xml </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o√π skin.estuary est le th√®me de conception de menu par d√©faut, la </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">description de </font><font style="vertical-align: inherit;">l'√©l√©ment </font><font style="vertical-align: inherit;">ressemble √† ceci:</font></font><br><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;item&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    &lt;label&gt; $ LOCALIZE [13279] &lt;/label&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    &lt;onclick&gt; RunAddon (script.berserk.network, butnetwork) &lt;/onclick&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    &lt;icon&gt; ic√¥nes / param√®tres / bs-network.png &lt;/icon&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;/item&gt;</font></font><font></font>
</pre><br><br>  o√π: <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©tiquette</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - nom de l'√©l√©ment de menu </font></font><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onclick</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - gestion de l'√©v√©nement en appuyant sur le bouton de menu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(lancement du plug-in, avec le premier argument passant la cha√Æne "butnetwork") </font></font><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ic√¥ne</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ic√¥ne de l'√©l√©ment de menu (chemin vers l'image png) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La fonctionnalit√© ci-dessus, ainsi que la connexion de plusieurs plug-ins Kodi suppl√©mentaires, est int√©gr√©e √† en utilisant le fichier bs-menu.patch</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher / masquer</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs"> diff -Naur a/addons/skin.estuary/xml/Settings.xml b/addons/skin.estuary/xml/Settings.xml --- a/addons/skin.estuary/xml/Settings.xml 2018-02-01 18:17:45.000000000 +0300 +++ b/addons/skin.estuary/xml/Settings.xml 2018-03-08 12:06:50.000000000 +0300 @@ -134,6 +134,11 @@ &lt;icon&gt;icons/settings/interface.png&lt;/icon&gt; &lt;/item&gt; &lt;item&gt; + &lt;label&gt;<span class="hljs-variable"><span class="hljs-variable">$LOCALIZE</span></span>[13279]&lt;/label&gt; + &lt;onclick&gt;RunAddon(script.berserk.network,butnetwork)&lt;/onclick&gt; + &lt;icon&gt;icons/settings/bs-network.png&lt;/icon&gt; + &lt;/item&gt; + &lt;item&gt; &lt;label&gt;<span class="hljs-variable"><span class="hljs-variable">$LOCALIZE</span></span>[20077]&lt;/label&gt; &lt;onclick&gt;ActivateWindow(SkinSettings)&lt;/onclick&gt; &lt;icon&gt;icons/settings/skin.png&lt;/icon&gt; diff -Naur a/system/addon-manifest.xml b/system/addon-manifest.xml --- a/system/addon-manifest.xml 2018-03-07 15:58:24.000000000 +0300 +++ b/system/addon-manifest.xml 2018-05-14 14:06:58.000000000 +0300 @@ -27,6 +27,7 @@ &lt;addon&gt;resource.uisounds.kodi&lt;/addon&gt; &lt;addon&gt;screensaver.xbmc.builtin.black&lt;/addon&gt; &lt;addon&gt;screensaver.xbmc.builtin.dim&lt;/addon&gt; + &lt;addon&gt;screensaver.kodi.universe&lt;/addon&gt; &lt;addon&gt;script.module.pil&lt;/addon&gt; &lt;addon&gt;service.xbmc.versioncheck&lt;/addon&gt; &lt;addon&gt;skin.estuary&lt;/addon&gt; @@ -43,4 +44,8 @@ &lt;addon&gt;xbmc.python&lt;/addon&gt; &lt;addon&gt;xbmc.webinterface&lt;/addon&gt; &lt;addon optional=<span class="hljs-string"><span class="hljs-string">"true"</span></span>&gt;peripheral.joystick&lt;/addon&gt; + &lt;addon&gt;script.berserk.network&lt;/addon&gt; + &lt;addon&gt;resource.language.ru_ru&lt;/addon&gt; + &lt;addon&gt;script.module.requests&lt;/addon&gt; + &lt;addon&gt;plugin.video.youtube&lt;/addon&gt; &lt;/addons&gt;</code> </pre><br></div></div><br><a name="max_set_video_koditv"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Param√®tres de mise en m√©moire tampon maximum pour la vid√©o </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dans Kodi Multimedia Center, pour maximiser les performances, vous pouvez sp√©cifier les param√®tres de mise en m√©moire tampon maximum: </font></font><br><br><pre> <code class="bash hljs">&lt;advancedsettings&gt; &lt;cache&gt; &lt;buffermode&gt;1&lt;/buffermode&gt; &lt;memorysize&gt;139460608&lt;/memorysize&gt; &lt;readfactor&gt;20&lt;/readfactor&gt; &lt;/cache&gt; &lt;/advancedsettings&gt;</code> </pre><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffermode = 1</font></font></strong> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - demandes de tampon pour tous les syst√®mes de fichiers (y compris le </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readfactor</font></font></strong> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> local) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ajuste la vitesse de t√©l√©chargement en fonction du d√©bit binaire vid√©o moyen. </font><font style="vertical-align: inherit;">Ainsi, par exemple, si vous lisez une vid√©o avec un taux de transfert de donn√©es moyen de 5 Mbit / s et d√©finissez le taux de lecture du tampon sur 2,0, cela limitera la vitesse de t√©l√©chargement (et donc le taux de remplissage du cache) √† environ 10 Mbit / s, donc: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readfactor = 20 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">supprime la restriction sur la vitesse de t√©l√©chargement </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memorysize</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 139460608 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- la taille du tampon est de 133 Mo, tout en utilisant 133 * 3 RAM, c'est-√†-dire </font><font style="vertical-align: inherit;">environ 400 Mo de RAM</font></font><br><br><a name="iptv_koditv"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Regarder la t√©l√©vision sur IPTV </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kodi Media Center est un outil tr√®s puissant pour visualiser le contenu num√©rique. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La fonction principale pour laquelle j'ai collect√© "Media Center" est la fonction de regarder la t√©l√©vision num√©rique en utilisant IPTV (Internet Protocol Television) ie t√©l√©vision sur le protocole Internet. Avec cette fonction, vous pouvez regarder la t√©l√©vision num√©rique depuis votre fournisseur Internet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est l'option la plus moderne et optimale √† la fois en termes de qualit√© d'image et en termes de fonctionnalit√©s suppl√©mentaires, c'est-√†-dire services fournis. Par exemple, des cha√Ænes de t√©l√©vision peuvent √™tre fournies dans l'archive, dans laquelle l'enregistrement vid√©o souhait√© est disponible pendant un certain temps apr√®s la diffusion. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour prendre en charge IPTV dans Kodi, il existe plusieurs options de plugin, dont je me suis install√© sur le plugin</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pvr.iptvsimple</font></font></strong> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour construire le plugin, utilisez la recette:</font></font><br><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    ‚îî‚îÄ‚îÄ plugins kodi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ‚îî‚îÄ‚îÄ kodi-pvr-iptvsimple.bb</font></font><font></font>
</pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le plug-in est connect√© / configur√© via: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menu principal Kodi =&gt; ¬´Modules compl√©mentaires¬ª =&gt; ¬´Mes modules compl√©mentaires¬ª =&gt; ¬´Clients PVR¬ª =&gt; ¬´PVR IPTV Simple Client¬ª </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour v√©rifier le fonctionnement de la t√©l√©vision IPTV dans le cadre de Kodi, j'ai pris plusieurs cha√Ænes d'actualit√©s publiques et les a ajout√©s √† la liste au format m3u8, et ont √©galement activ√© le lancement automatique du plugin ¬´pvr.iptvsimple¬ª au d√©but du media center.</font></font><br><br><a name="youtube_koditv"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Regarder Youtube avec le plugin Kodi </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les programmeurs qui ont d√©velopp√© Kodi ont fourni la flexibilit√© n√©cessaire pour √©tendre ses fonctions. </font><font style="vertical-align: inherit;">Ceci est fait pour que tout passionn√©, s'il le souhaite, puisse ajouter √† Kodi ce dont il a vraiment besoin. </font><font style="vertical-align: inherit;">Et ces plugins pour Kodi sont l'obscurit√©.</font></font> Eh bien, vous obtenez le point.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y en a tellement qu'ils m√©ritent une description dans un article s√©par√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les plugins sont install√©s tr√®s simplement, connectez simplement Kodi √† Internet et appuyez sur quelques boutons dans le menu. Vous pouvez le lire sur l'un des forums d√©di√©s √† Kodi. Mais l'assemblage, il y a l'assemblage, et je vais inclure un autre plugin dans le kit de distribution comme exemple. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le plugin (ohm) le plus int√©ressant et le plus r√©pandu pour Kodi est √† mon avis le plugin de vue Youtube. Kodi est un centre multim√©dia, et Youtube est le plus grand r√©f√©rentiel de ce contenu tr√®s multim√©dia, donc le plug-in Youtube pour Kodi est presque obligatoire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le plugin est √©crit en python, et c'est un m√©canisme de plug-in normal, vous n'avez pas besoin de compiler quoi que ce soit, copiez simplement le plug-in termin√© dans le r√©pertoire racine avec les plug-ins et sp√©cifiez le nom du plug-in dans le fichier manifeste xml:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"System / addon-manifest.xml" </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le plugin provient du d√©p√¥t officiel, et son code source est inclus dans l'archive: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recipes-mediacentre / kodi-plugins / files / plugin.video.youtube.tar.gz Voir l' </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">emplacement de la recette d'assemblage du plugin dans chapitre "recettes-composition du mediacentre"</font></font><br><br><a name="bsnet_layer_koditv"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extension de configuration r√©seau du shell de la console </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que le kit de distribution collect√© dans le cadre de cet article est une d√©mo, les exigences de configuration des ¬´Interfaces r√©seau¬ª sont minimales. </font><font style="vertical-align: inherit;">Je ne voulais pas faire glisser de gestionnaire de r√©seau lourd pour cela, ce qui √©tait tr√®s incompr√©hensible pour moi et tr√®s lourd, et j'ai donc √©crit deux scripts shell qui compl√®tent la configuration du m√©canisme de configuration normal:</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">############################################################## #     /etc/network/interfaces: ############################################################## auto eth0 iface eth0 inet manual up /etc/network/eth-manual $IFACE up down /etc/network/eth-manual $IFACE down auto wlan0 iface wlan0 inet manual up /etc/network/wlan $IFACE up down /etc/network/wlan $IFACE down</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour configurer facilement les interfaces r√©seau Ethernet / WLAN via l'interface graphique, j'utilise un autre petit plugin Kodi "script.berserk.network". </font><font style="vertical-align: inherit;">C'est presque le seul plugin Kodi que j'ai compris, mais pour cela, j'ai d√ª l'√©crire. </font><font style="vertical-align: inherit;">Il est extr√™mement compact et minimaliste et est √©crit en langage python. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ces deux composants sont collect√©s √† l'aide de recettes:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recipes-berserk / bs-net / bs-net_0.1.3.bb </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recipes-mediacentre / kodi-plugins / script-berserk-network_0.2.5.bb </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä ce stade, je voudrais m'attarder sur les d√©tails. </font><font style="vertical-align: inherit;">Ainsi, toute la flexibilit√© d'utilisation de Yocto r√©side dans diff√©rents ensembles de recettes, c'est-√†-dire </font><font style="vertical-align: inherit;">connect√© un ensemble de recettes - le gestionnaire de r√©seau le plus simple a √©t√© ajout√© au kit de distribution, connect√© un autre ensemble - ajout√© votre gestionnaire de r√©seau pr√©f√©r√© en utilisant par exemple systemD, etc. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour me connecter automatiquement √† un point d'acc√®s WiFi au d√©marrage du syst√®me, j'utilise la r√®gle udev: /etc/udev/rules.d/80-wifi-start.rules</font></font><br><br><pre> <code class="bash hljs">SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"net"</span></span>, ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, DRIVERS==<span class="hljs-string"><span class="hljs-string">"?*"</span></span>, KERNEL==<span class="hljs-string"><span class="hljs-string">"wlan*"</span></span>, \ RUN+=<span class="hljs-string"><span class="hljs-string">"/etc/network/wlan-runner </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$env</span></span></span><span class="hljs-string">{INTERFACE} up"</span></span> SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"net"</span></span>, ACTION==<span class="hljs-string"><span class="hljs-string">"remove"</span></span>, DRIVERS==<span class="hljs-string"><span class="hljs-string">"?*"</span></span>, KERNEL==<span class="hljs-string"><span class="hljs-string">"wlan*"</span></span>, \ RUN+=<span class="hljs-string"><span class="hljs-string">"/etc/network/wlan-runner </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$env</span></span></span><span class="hljs-string">{INTERFACE} down"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le script wlan-runner ex√©cute simplement les commandes: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / network / wlan $ IFACE up</font></font><br>  ou <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / etc / network / wlan $ IFACE down </font></font><br><br><a name="distrib_recipe_koditv"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recette de construction de distribution </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le projet Yocto dispose d'un m√©canisme de r√©utilisation. Il existe des classes dont vous pouvez h√©riter (directive "h√©riter"), et il existe des recettes de base que vous pouvez connecter (directive "inclure"). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je montrerai l'h√©ritage en utilisant l'exemple de classe: </font></font><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poky / meta / clasess / core-image.bbclass</font></font></strong> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La classe est charg√©e de d√©crire les groupes de packages que vous pouvez inclure dans une recette particuli√®re. Pour ce faire, il suffit d'indiquer la construction au d√©but de la recette: </font></font><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√©riter core-image</font></font></strong> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> M√™me dans le texte de cette classe, vous pouvez voir les fonctionnalit√©s de l'image, chaque fonctionnalit√© est responsable d'un groupe de fonctions incluses dans l'image, et chaque groupe d√©crit finalement un ensemble de programmes ou de biblioth√®ques install√©s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les caract√©ristiques de l'image sont indiqu√©es comme suit:</font></font><br><br><pre> <code class="bash hljs">IMAGE_FEATURES += <span class="hljs-string"><span class="hljs-string">"ssh-server-dropbear splash"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe √©galement DISTRO_FEATURES - fonctionnalit√©s de distribution qui peuvent √™tre sp√©cifi√©es dans le fichier de configuration de couche. </font><font style="vertical-align: inherit;">Ce sont des fonctions au niveau de la distribution, et si par exemple vous modifiez une fonctionnalit√© (par exemple x11), l'assembly suivant commencera √† r√©assembler tous les packages qui d√©pendent de cette option (cela peut prendre un certain temps). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La recette de base de base que j'utilise: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poky / meta / recipes-core / images / core-image-minimal.bb</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recette de construction d'image</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment"># Project: "Berserk" - build Kodi for the Raspberry Pi platform # license - The MIT License (MIT) DESCRIPTION = "Berserk - the image for the Raspberry PI" LICENSE = "MIT" MD5_SUM = "md5=0835ade698e0bcf8506ecda2f7b4f302" LIC_FILES_CHKSUM = "file://${COMMON_LICENSE_DIR}/MIT;${MD5_SUM}" IMAGE_FEATURES += "ssh-server-dropbear splash" #    rootfs    (250000kB=~250Mb) IMAGE_ROOTFS_EXTRA_SPACE_append += "+ 250000" # Base this image on core-image-minimal include recipes-core/images/core-image-minimal.bb # Set default password for 'root' user inherit extrausers ROOTUSERNAME = "root" ROOTPASSWORD = "berserk" EXTRA_USERS_PARAMS = "usermod -P ${ROOTPASSWORD} ${ROOTUSERNAME};" #  ,      SPLASH = "psplash-berserk" BS_DEBUG_TOOLS = "ldd strace ltrace" BS_GLIBC = "glibc-thread-db \ glibc-gconv-utf-16 \ glibc-gconv-utf-32 \ glibc-binary-localedata-en-us \ glibc-binary-localedata-ru-ru \ glibc-charmap-utf-8 \ " BS_BASE = "kernel-modules \ lsb \ pciutils \ parted \ tzdata \ dosfstools \ ntp \ ntpdate \ e2fsprogs-resize2fs \ ntfs-3g \ ntfsprogs \ " BS_WLAN = "kernel-module-rt2800usb \ kernel-module-rt2800lib \ kernel-module-rt2x00lib \ kernel-module-rt2x00usb \ kernel-module-cfg80211 \ kernel-module-nls-utf8 \ kernel-module-ath9k-common \ kernel-module-ath9k-hw \ kernel-module-ath9k-htc \ kernel-module-ctr \ kernel-module-ccm \ kernel-module-arc4 \ " BS_WIFI_SUPPORT = " \ iw \ dhcp-client \ wireless-tools \ wpa-supplicant \ linux-firmware \ " BS_SOFT = "mc \ kodi \ kodi-runner \ kodi-settings \ kodi-language-ru \ kodi-pvr-iptvsimple \ bs-net \ tv-config \ first-run \ script-berserk-network \ screensaver-kodi-universe \ plugin-video-youtube \ script-module-requests \ " # Include modules in rootfs IMAGE_INSTALL += " \ ${BS_BASE} \ ${BS_WLAN} \ ${BS_WIFI_SUPPORT} \ ${BS_GLIBC} \ ${BS_SOFT} \ ${BS_DEBUG_TOOLS} \ "</span></span></code> </pre><br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je voudrais pr√©ciser que, par exemple </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> package </font><strong><font style="vertical-align: inherit;">kernel-modules</font></strong><font style="vertical-align: inherit;"> installera </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tous les modules du noyau sp√©cifi√©s dans le fichier defconfig dans l'image de distribution. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais si vous personnalisez fortement quelque chose, alors bien s√ªr, vous n'aurez peut-√™tre m√™me pas besoin de tous les modules du noyau, auquel cas il est pratique d'ajouter chaque module par son nom, comme indiqu√© dans la variable </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BS_WLAN</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est comme une feuille de triche, sp√©cifiez uniquement ce dont vous avez besoin et apr√®s avoir v√©rifi√© le package "Kernel-modules" supprimer, v√©rifier, etc.</font></font><br><br><a name="instruction_koditv"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Un bref guide pour cr√©er une image de distribution </font></font></h2><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Installez les d√©pendances du projet Yocto dans Ubuntu:</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs"> sudo apt-get install -y --no-install-suggests --no-install-recommends \ gawk wget git-core diffstat unzip texinfo gcc-multilib build-essential \ chrpath socat cpio python python3 python3-pip python3-pexpect \ xz-utils debianutils iputils-ping python3-git python3-jinja2 \ libegl1-mesa libsdl1.2-dev xterm</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) T√©l√©chargez et installez Repo:</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs"> mkdir ~/bin curl http://commondatastorage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo chmod a+x ~/bin/repo</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) T√©l√©chargez le projet depuis github:</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs"> PATH=<span class="hljs-variable"><span class="hljs-variable">${PATH}</span></span>:~/bin mkdir torvin <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> torvin repo init -u https://github.com/berserktv/bs-manifest \ -m raspberry/rocko/torvin-0.2.5.xml repo sync</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Construisez le projet:</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs"> ./shell.sh bitbake berserk-image</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5) √âcrivez l'image de distribution sur la carte m√©moire:</font></font></b> <div class="spoiler_text"><blockquote>         <br> torvin/build/tmp/deploy/images/raspberrypi3 <br><br>      <br>     : <br> berserk-image-raspberrypi3.rpi-sdimg <br><br> c       <br> c      UTC <br><br>        dd <br><br> : <br>       ¬´microSDHC¬ª <br>      . <br><br> $ sudo bash <br> $ cd torvin/build/tmp/deploy/images/raspberrypi3 <br> $ dd if=berserk-image-raspberrypi3.rpi-sdimg of=/dev/sdX bs=1M <br> $ sync <br><br>  /dev/sdX: <br> X   a,b,c  .. <br>        <br><br>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">:</a> <br>     Windows,    <br>  Win32 Disk Imager  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">:</a> <br>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">:</a> <br></blockquote><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Remarque:</b> <div class="spoiler_text"><pre> <code class="bash hljs">             N      ,      <span class="hljs-string"><span class="hljs-string">""</span></span>          ,    git  (..         <span class="hljs-string"><span class="hljs-string">""</span></span>)   :  - Intel(R) Core(TM) i5-3570 CPU @ 3.40GHz  - 8    -  USB-3.0 1T   - 4  05    - 1     - 274.8 M   torvin/build    (cache ,   ,   ,  ,   ,    ..) -   42    torvin/downloads -  9.1  (git    tar.gz )  rootfs   - 550     /lib/firmware - 212  /lib/modules - 53  :        firmware (   )       ,   200 </code> </pre><br></div></div><br><a name="postscriptum_koditv"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Postscript </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les capacit√©s d'OpenSource ces derni√®res ann√©es ne font qu'augmenter. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais ces opportunit√©s ne sont pas petites, pour des exemples vous n'avez m√™me pas besoin d'aller loin. Il est peu probable que le m√™me "Microsoft" s'attendait √† ce que la technologie OpenSource la rejette du march√© des syst√®mes d'exploitation mobiles. Je veux dire l'OS de Google - "Android", qui a jet√© du jour au lendemain le "Pionnier" des syst√®mes mobiles. Et il n'est pas clair si Microsoft pourra y revenir √† nouveau. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien s√ªr, "Google", une √©norme soci√©t√© avec des finances presque illimit√©es et d'excellents d√©veloppeurs, mais toujours, comme on dit "sans le Core et pas ici et l√†". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les meilleurs projets OpenSource au fil du temps deviennent une ≈ìuvre d'art (par exemple Kodi, Openelec / libre, etc.)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et aujourd'hui, tout le monde peut rejoindre les meilleures pratiques en OpenSource, pour ainsi dire sans sortir de Github (a). </font><font style="vertical-align: inherit;">Cet article est √† ce sujet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ayez beaucoup d'assemblages bons et diff√©rents pour vous, et souvenez-vous que "le monde de l'Internet des objets arrive".</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr467443/">https://habr.com/ru/post/fr467443/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr467427/index.html">BudgetTracker - un autre outil open-source pour la comptabilit√© des finances personnelles</a></li>
<li><a href="../fr467429/index.html">Habrastatistique: explorer les sections les plus et les moins visit√©es du site</a></li>
<li><a href="../fr467435/index.html">Nous envoyons les rapports de l'agent Veeam Linux par courrier ou par t√©l√©gramme</a></li>
<li><a href="../fr467437/index.html">MVCC dans PostgreSQL-1. L'isolement</a></li>
<li><a href="../fr467439/index.html">Pourquoi le vinyle est-il revenu et comment les services de streaming sont-ils li√©s √† cela?</a></li>
<li><a href="../fr467445/index.html">Liste insaisissable des mises √† jour Windows install√©es</a></li>
<li><a href="../fr467449/index.html">D√©tection des vuln√©rabilit√©s et √©valuation de la r√©sistance aux attaques de pirates des cartes √† puce et des processeurs cryptographiques avec protection int√©gr√©e</a></li>
<li><a href="../fr467453/index.html">R√©solution du probl√®me du num√©ro 42 √† l'aide d'un supercalculateur plan√©taire</a></li>
<li><a href="../fr467455/index.html">Mod√®le QBS pour la programmation de microcontr√¥leurs dans QtCreator en utilisant l'exemple des contr√¥leurs Milander</a></li>
<li><a href="../fr467457/index.html">Le chemin de la chirurgie au d√©veloppement de jeux ou la premi√®re exp√©rience de d√©veloppement mobile sur Unity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>