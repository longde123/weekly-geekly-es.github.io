<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔽 🖐🏿 🍩 JMeter - Swiss Tester Knife (Partie 1) 🧝🏽 ⛹️ 👩‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tu parles de JMeter? Très probablement, si vous êtes dans le sujet, vous avez déjà tout lu sur cet outil pour les tests de stress. Mais j'ai quelque c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JMeter - Swiss Tester Knife (Partie 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456928/">  Tu parles de JMeter?  Très probablement, si vous êtes dans le sujet, vous avez déjà tout lu sur cet outil pour les tests de stress.  Mais j'ai quelque chose pour vous surprendre.  Pendant trois ans chez QA, j'ai réalisé que JMeter est très polyvalent et peut être utilisé à diverses fins.  Par exemple, pour: <br><br><ul><li>  rechercher un bug insaisissable avec la chute du site pour certains utilisateurs; </li><li>  réchauffement rapide du cache sur des milliers de pages produits; </li><li>  tester le backend d'une application mobile; </li><li>  création de 2000 enregistrements avec des données utilisateur dans la base de données d'application en peu de temps. </li></ul><br>  Si vous êtes intéressé, bienvenue au chat.  Il s'est avéré volumineux, donc je vais diviser l'article en deux parties. <br><a name="habracut"></a><br><blockquote> <i><b>Avertissement:</b> Pour des raisons évidentes, je n'insère pas de captures d'écran de projets réels dans l'article (ni n'en extrait toutes les informations importantes).</i>  <i>Les illustrations sont fournies à des fins de recherche et d'enseignement uniquement.</i> </blockquote><br><h2>  Application JMeter classique </h2><br>  JMeter - applet Java avec interface graphique.  Pour les tests, il démarre sans interface graphique.  Et pour écrire des scripts de test, il a un panneau dans lequel vous pouvez faire n'importe quoi. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d8/ac5/d62/8d8ac5d625f266f640fe6d65dce8e994.png" alt="Création d'un script sur JMeter"></div>  <font color="#999999"><i>Voici à quoi ressemble le processus de création du script (ici même le mot "écriture" ne convient pas)</i></font> <br><br>  Un plan de test commun est créé, dans lequel le groupe de threads se jette avec les principaux éléments du test: les contrôleurs de processus et les requêtes (HTTP, FTP, etc.). <br><br>  De plus, il existe des éléments supplémentaires pour définir les paramètres.  Par exemple, HTTP Request Defaults vous permet de spécifier le serveur principal, les en-têtes et d'activer / désactiver le téléchargement d'actifs supplémentaires (images, styles, polices, etc.).  C'est facile à comprendre.  Et vous pouvez immédiatement exécuter un test à partir de cette interface et consulter les résultats. <br><br>  JMeter peut enregistrer de tels cas de test.  Il s'exécute en tant que proxy sur la machine locale et, si vous configurez un navigateur (ou une application), générez du trafic via ce proxy, JMeter enregistrera toutes les demandes et réponses.  Et à partir de cet ensemble, vous pouvez concocter un script de test qui va répéter les actions de l'utilisateur, et l'exécuter où et quand vous le souhaitez: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qy/z7/lq/qyz7lqjkh8y-e9ul3mqi76qceam.png" alt="Écriture d'un script dans JMeter en fonction des actions de l'utilisateur"></div><br><br>  Le problème principal est le tas de mémoire de Java lui-même.  Il repose sur le plafond et peut tomber avec 50 fils de tests simultanés, même sur des machines haut de gamme. <br>  Si la machine n'a pas assez de puissance pour un test à pleine charge, contactez une organisation tierce.  Ils ont déployé une infrastructure qui est un ensemble de serveurs.  Ils ont obtenu le même JMeter.  Moyennant des frais, ces gars exécuteront votre script sur n'importe quelle charge.  Nous avons demandé ces services chez Octoperf et Blazemeter. <br><br><h2>  C'est le football, bébé: comment nous avons attrapé un bug avec un crash partiel du serveur </h2><br>  Nous sommes engagés dans le développement Web depuis 18 ans (cheers - maintenant vous pouvez fumer, vous marier et regarder John Wick).  Il y a eu de nombreux clients au cours de leur vie, mais les plus importants sont apparus récemment.  Par exemple, nous avons créé un site sur <b>Sitecore</b> pour l'un des clubs de football de la Premier League anglaise avec le paradigme SPW (site Web à page unique: toutes les pages s'ouvrent sans recharger la page du navigateur elle-même).  Sous le capot se trouve le panneau d'administration pour gérer une page de match en direct.  Il s'agit d'une diffusion textuelle en ligne du jeu: les principaux événements (buts, suppressions, coups francs) sont chargés automatiquement à partir du système Opta, et les photos, commentaires et reposts des fans de Twitter et Instagram sont publiés par des personnes en direct - gestionnaires de contenu de club de football. <br><br>  Je note avec fierté: après la sortie, les médias britanniques ont publié des articles sous les titres «Enfin, l’hégémonie des anciens sites des clubs de football est terminée.  A cette époque, la plupart des clubs avaient déjà des sites.  Mais ils semblaient avoir été développés au début des années 2000 et n'ont pas changé depuis - avec le design et l'UX correspondants. <br><br>  Avant le lancement, nous avons effectué un test de pleine charge et nous nous sommes assurés que tout fonctionne comme il se doit.  La structure du serveur ressemblait à ceci: <br><br><ol><li>  la demande du client va au serveur d'équilibrage de charge → </li><li>  le serveur d'équilibrage de charge vérifie l'état de huit serveurs <abbr title="Content Delivery, serveur de diffusion de contenu">CD</abbr> → </li><li>  le serveur d'équilibrage de charge envoie une demande au serveur de CD le moins chargé → </li><li>  Le serveur de CD répond au client. </li></ol><br>  Un an après le lancement, lors d'un afflux important d'utilisateurs sur le site, le client a appelé et déclaré que le site était en panne: <br><br>  - Notre site ne fonctionne pas!  Ça ne marche pas du tout!  Juste un écran blanc et une inscription du navigateur que le site est en panne!  - dit le client. <br>  Nous sommes dans une panique ouvrant le site, et avec lui tout va bien: <br>  «Cela fonctionne toujours», répondons-nous. <br>  Le client ouvre le site depuis le téléphone et l'ordinateur et ... tout va bien aussi! <br>  - Vraiment, désolé.  Apparemment, les utilisateurs ont des problèmes. <br><br>  Ces messages n'apparaissent pas à partir de zéro, nous avons donc mené une étude: nous avons lancé un utilitaire de surveillance de l'état des serveurs Server Density et regardé ce qui leur arrivait lors d'un afflux d'utilisateurs sur le site: <br><br><img src="https://habrastorage.org/webt/o8/m9/rd/o8m9rd9amg7mcl_vlf8ky2ce1wu.png" alt="Afficher l'historique de chargement du serveur dans Server Density"><br>  <font color="#999999"><i>Il y a une charge, mais tous les serveurs de CD se ressemblent et même</i></font> <br><br>  Bientôt, l'histoire s'est répétée - certains utilisateurs ont signalé un site complètement cassé.  Ce n'était pas une erreur ou une page introuvable - le serveur n'a tout simplement pas répondu à la demande.  Il a été possible de rattraper la situation avec l'aide de JMeter. <br><br>  L'objectif était simple: charger les huit serveurs et voir ce qui se passe.  Un test de résistance a été effectué à l'aube à Tcheliabinsk, et à Londres, la nuit a été profonde.  Nous avons utilisé plusieurs machines en mode non-interface (cela vous permet d'exécuter beaucoup plus de threads en même temps).  Le script a sans cesse ouvert la page d'accueil, et c'était notre principale erreur. <br><br><img src="https://habrastorage.org/webt/g_/fu/c-/g_fuc-c3uungpae4vrrhn2q-c94.png" alt="Le script de test de charge le plus simple dans JMeter pour demander une page dans une boucle"><br><br>  Nous avons téléchargé les mêmes actifs qui étaient déjà mis en cache cent fois.  Par conséquent, la charge est sortie insignifiante.  Puis l'idée est venue: sur le site - un chariot et un petit panier de pages avec des nouvelles pour certaines dates.  Si vous avancez quelques variables et les substituez dans l'URL, nous aurons toujours une page aléatoire (par exemple - ... url / news / 2016/08/23 /? Page = 4). <br><br>  Du coup, nous avons réalisé que Server Density avait un certain «lissage» intégré dans les graphiques de la charge du serveur au cours des périodes passées.  Si, en cinq minutes, la charge sur le serveur atteint 100%, puis tombe à 0%, et après 20-30 secondes a augmenté à 90%, il affichera la valeur moyenne pour cette période - environ 80-90%.  Par conséquent, nous n'avons pas vu de véritable panne de serveur. <br><br>  Après avoir examiné les journaux en détail lors des tests de résistance, nous avons découvert que l'un des serveurs de CD s'est redémarré à 100% et n'en a parlé à personne (il est tellement introverti). <br><br><img src="https://habrastorage.org/webt/i5/ie/n6/i5ien6w5zjrwwm1lk23crcj9vn8.png"><br><br>  L'équilibreur de charge n'a examiné que l'utilisation du processeur de tous les serveurs.  Il a vu que l'un d'entre eux était chargé à 20% et le reste à 90% et a envoyé l'utilisateur au premier.  Et il était en train de redémarrer et a donné un écran blanc.  De plus, le serveur de distribution a exposé l'utilisateur à un cookie et l'a lié étroitement au serveur inactif.  Par conséquent, même après la mise à jour, le site n'était pas disponible.  Les 7 autres utilisateurs sur 8 en même temps ont apprécié la vie et ont dit que tout fonctionnait. <br><br><h4>  <font color="#cc0000">Conclusion:</font> </h4><br>  nous avons constaté que JMeter peut être utilisé pour les tests de résistance et en même temps analyser l'état des serveurs lors des tests avec d'autres outils.  Nous avons réussi à «attraper» le problème de la chute du site chez certains utilisateurs et à le résoudre en corrigeant la logique de répartition de la charge et en ajoutant un contrôle d'état. <br><br>  Dans la partie suivante, je vais vous expliquer comment, avec l'aide de JMeter, nous avons mis en place le processus de mise en cache des pages produits, testé le fonctionnement d'une application mobile sans l'application elle-même et créé 2000 utilisateurs dans le système sans accès à la base de données. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456928/">https://habr.com/ru/post/fr456928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456910/index.html">Internet project security.txt - apprendre à connaître un autre fichier bien connu</a></li>
<li><a href="../fr456912/index.html">Comment créer des sites en 2019</a></li>
<li><a href="../fr456920/index.html">Sony Xperia 1 en Russie - prix et bonus de précommande</a></li>
<li><a href="../fr456922/index.html">Comment les processeurs sont conçus et fabriqués: les bases de l'architecture informatique</a></li>
<li><a href="../fr456926/index.html">Comment nous faisons Sportmaster</a></li>
<li><a href="../fr456930/index.html">Amener l'IoT à la masse: résultats du premier hackathon IoT de GeekBrains et Rostelecom</a></li>
<li><a href="../fr456932/index.html">OpenGL ultramoderne. Partie 1</a></li>
<li><a href="../fr456936/index.html">Cartes animées sur SwiftUI</a></li>
<li><a href="../fr456938/index.html">Lancement d'une application de taxi-toiling à Tokyo: comment Sony le fait-il avec S. Ride?</a></li>
<li><a href="../fr456942/index.html">Le dieu aux multiples armes de l'échéance ou l'utilisation généralisée de l'analyse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>