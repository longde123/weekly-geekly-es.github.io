<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïå ü§õüèæ ‚õ≥Ô∏è ESET: Eine Analyse neuer Zebrocy-Komponenten üò≤ üíáüèΩ ü§üüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Cybergroup Sednit ist seit mindestens 2004 in Betrieb und erscheint regelm√§√üig in den Nachrichten. Es wird angenommen, dass Sednit (besser bekannt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ESET: Eine Analyse neuer Zebrocy-Komponenten</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/437236/">  Die Cybergroup Sednit ist seit mindestens 2004 in Betrieb und erscheint regelm√§√üig in den Nachrichten.  Es wird angenommen, dass Sednit (besser bekannt als Fancy Bear) hinter dem Riss des Demokratischen Nationalkomitees der USA vor den Wahlen 2016, der Welt-Anti-Doping-Agentur (WADA), dem Fernsehsender TV5Monde und anderen Angriffen steckt.  Das Arsenal der Gruppe enth√§lt eine Reihe b√∂sartiger Tools, von denen wir einige <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in einem fr√ºheren Bericht</a> dokumentiert haben. <br><br>  Wir haben k√ºrzlich einen Bericht √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LoJax ver√∂ffentlicht</a> , ein UEFI-Rootkit, das ebenfalls mit Sednit zusammenh√§ngt und bei Angriffen auf dem Balkan, in Mittel- und Osteuropa eingesetzt wurde. <br><br>  Im August 2018 stellten die Sednit-Betreiber zwei neue Zebrocy-Komponenten bereit, und von nun an hat die Verwendung dieses Tools stark zugenommen.  Zebrocy ist eine Sammlung von Bootloadern, Droppern und Hintert√ºren.  Downloader und Dropper dienen der Intelligenz, w√§hrend Backdoors f√ºr Persistenz und Spyware sorgen.  Diese neuen Komponenten haben eine ungew√∂hnliche M√∂glichkeit, gesammelte Daten √ºber die Mail-Service-Protokolle SMTP und POP3 zu filtern. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fh/nc/qk/fhncqkih604tvkrg44vywz9uzum.jpeg"></div><a name="habracut"></a><br>  Die Opfer der neuen Tools √§hneln den Opfern, die in unserem vorherigen Beitrag √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zebrocy</a> sowie im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kaspersky Lab erw√§hnt wurden</a> .  Die Ziele der Angriffe sind in Zentralasien, Mittel- und Osteuropa, haupts√§chlich Botschaften, Au√üenministerien und Diplomaten. <br><br><h3>  R√ºckblick </h3><br><img src="https://habrastorage.org/webt/-y/xq/ob/-yxqobqgv5jqqvti0t4zsnea5se.png"><br>  <i>Abbildung 1. Schema alter und neuer Zebrocy-Komponenten</i> <br><br>  Zwei Jahre lang verwendete die Cybergruppe Sednit Phishing-E-Mails als Infektionsvektor f√ºr Zebrocy (Optionen 1 und 2 in der obigen Tabelle).  Nach dem Kompromiss verwendeten die Angreifer verschiedene Bootloader der ersten Stufe, um Informationen √ºber das Opfer zu sammeln, und setzten bei Interesse nach einigen Stunden oder Tagen eine der Hintert√ºren der zweiten Stufe ein. <br><br>  Das klassische Kampagnenschema von Zebrocy besteht darin, das Opfer als Archiv in den Anhang zum Brief aufzunehmen.  Das Archiv enth√§lt zwei Dateien, von denen eine ein harmloses Dokument und die zweite eine ausf√ºhrbare Datei ist.  Angreifer versuchen, das Opfer auszutricksen, indem sie der zweiten Datei einen f√ºr das Dokument oder Bild typischen Namen geben und die ‚Äûdoppelte Erweiterung‚Äú verwenden. <br><br>  In der neuen Kampagne (Option 3 in der Tabelle) wird ein komplizierteres Schema verwendet - wir werden es unten analysieren. <br><br><h3>  Delphi Dropper </h3><br>  Die erste Bin√§rdatei ist eine Delphi-Pipette, was f√ºr die Zebrocy-Kampagne recht ungew√∂hnlich ist.  In den meisten F√§llen handelt es sich eher um einen Bootloader, der in der ersten Phase des Angriffs auf dem System des Opfers installiert ist. <br><br>  Mit Hilfe verschiedener Methoden erschwert Dropper das Reverse Engineering.  In den untersuchten Beispielen verwendet er das Schl√ºsselwort <i>Leber</i> , um den Anfang und das Ende von Schl√ºsselelementen anzugeben, wie unten gezeigt. <br><br><pre><code class="plaintext hljs">$ yara -s tag_yara.yar SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe find_tag SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe 0x4c260:$tag: l\x00i\x00v\x00e\x00r\x00 0x6f000:$tag: liver 0x6f020:$tag: liver 0x13ab0c:$tag: liver</code> </pre> <br>  Die obige YARA-Regel sucht nach der <i>Stringleber</i> .  Die erste <i>Leberzeile wird</i> im Code verwendet, trennt jedoch nichts, w√§hrend die anderen den Schl√ºsseldeskriptor, das Bild (der Hexdump ist unten dargestellt) und die verschl√ºsselte Komponente in der Pipette gemeinsam nutzen. <br><br><pre> <code class="plaintext hljs">$ hexdump -Cn 48 -s 0x6f000 SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe 0006f000 6c 69 76 65 72 4f 70 65 6e 41 69 72 33 39 30 34 |liverOpenAir3904| 0006f010 35 5f 42 61 79 72 65 6e 5f 4d 75 6e 63 68 65 6e |5_Bayren_Munchen| 0006f020 6c 69 76 65 72 ff d8 ff e0 00 10 4a 46 49 46 00 |liver‚Ä¶‚Ä¶JFIF.|</code> </pre> <br>  Zun√§chst werden die Daten in einem Bild mit dem Dateinamen <i>C: \ Users \ public \ Pictures \ scanPassport.jpg gespeichert</i> , sofern eine solche Datei noch nicht vorhanden ist. <br><br>  Interessanterweise hei√üt die Dropper-Datei <i>SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe</i> , was auch ein Phishing-Schema f√ºr P√§sse und Reiseinformationen vorschl√§gt.  Dies kann bedeuten, dass der Bediener den Zweck der Phishing-Nachricht kennt.  Der Dropper √∂ffnet das Image und stoppt die Ausf√ºhrung, falls die Datei bereits vorhanden ist.  Andernfalls √∂ffnet er es und erh√§lt das Schl√ºsselhandle <i>OpenAir39045_Bayren_Munchen</i> .  Das Bild fehlt, obwohl das Format korrekt ist - siehe Abbildung unten. <br><br><img src="https://habrastorage.org/webt/c9/_d/km/c9_dkmprdqv95bluopzc9ylq5ly.png"><br>  <i>Abbildung 2. ScanPassport.jpg</i> <br><br>  Die Key Descriptor Line enth√§lt <i>Bayren_Munchen</i> - h√∂chstwahrscheinlich ein Hinweis auf die Fu√üballmannschaft des FC Bayern M√ºnchen.  In jedem Fall ist der Inhalt des Deskriptors nicht wichtig, sondern seine L√§nge, mit der Sie den XOR-Schl√ºssel zum Entschl√ºsseln der Komponente erhalten k√∂nnen. <br><br>  Um den XOR-Schl√ºssel zu erhalten, sucht der Dropper nach dem letzten <i>Leberschl√ºsselwort</i> und r√ºckt es um die L√§nge des Deskriptors ein.  Die L√§nge des XOR-Schl√ºssels betr√§gt 27 (0x1b) Bytes (identisch mit der L√§nge des Schl√ºsseldeskriptors). <br><br>  Mit dem XOR-Schl√ºssel und einer einfachen Schleife entschl√ºsselt der Dropper den letzten Teil - die verschl√ºsselte Komponente, die sich unmittelbar nach dem letzten Tag bis zum Ende der Datei befindet.  Beachten Sie, dass der MZ-Header der ausf√ºhrbaren Komponente unmittelbar nach dem <i>Leberschl√ºsselwort</i> beginnt und der XOR-Schl√ºssel aus dem Teil des PE-Headers abgerufen wird, bei dem es sich normalerweise um eine Folge von 0x00 Byte handelt, die nach der Entschl√ºsselung der Komponente wiederhergestellt wurden (siehe Abbildung unten). <br><br><img src="https://habrastorage.org/webt/lm/lt/ty/lmlttyypf34eysahxyd0kplpuhu.png"><br>  <i>Abbildung 3. Verschl√ºsselte Komponente (links) versus entschl√ºsselte Komponente (rechts)</i> <br><br>  Die Komponente wird auf <i>C: \ Users \ Public \ Documents \ AcrobatReader.txt zur√ºckgesetzt</i> und konvertiert die Datei in <i>C: \ Users \ Public \ Documents \ AcrobatReader.exe</i> . <br><br>  M√∂glicherweise ist dies ein Versuch, den Schutz des PCs zu umgehen, der eine Warnung generiert, wenn die Bin√§rdatei die Datei mit der Erweiterung .exe auf die Festplatte leert. <br><br>  Der Bediener versucht erneut, das Opfer auszutricksen. Wenn er auf das Verzeichnis achtet, sieht er das Bild wie in der folgenden Abbildung dargestellt: <br><br><img src="https://habrastorage.org/webt/ql/vj/q3/qlvjq3gqetpqgo5cgyo8-bc9nug.png"><br>  <i>Abbildung 4. Die Komponente sieht aus wie eine PDF-Datei</i> <br><br>  Standardm√§√üig verbirgt Windows die Erweiterung. Diese wird von einem Angreifer verwendet, der die ausf√ºhrbare Datei im Ordner "Dokumente" ablegt und als PDF tarnt. <br><br>  Schlie√ülich f√ºhrt der Dropper die gehostete Komponente aus und beendet sie. <br><br><h3>  MSIL Mail Loader </h3><br>  Die mitgelieferte Komponente der vorherigen Pipette ist der mit UPX gepackte MSIL-Lader.  Zum besseren Verst√§ndnis wird die Logik des Prozesses unten beschrieben, dann wird der Quellcode angegeben und das Steuerschema wird ber√ºcksichtigt. <br><br>  Die Hauptmethode ruft <i>Run</i> auf, um die Anwendung zu starten, die dann <i>Form1</i> erstellt. <br><br><pre> <code class="plaintext hljs">{   Application.EnableVisualStyles();   Application.SetCompatibleTextRenderingDefault(false);   Application.Run((Form) new Form1()); }</code> </pre> <br>  <i>Form1</i> weist viele Variablen zu, einschlie√ülich eines neuen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Timers</a> f√ºr sieben davon. <br><br><pre> <code class="plaintext hljs">   this.start = new Timer(this.components);  this.inf = new Timer(this.components);   this.txt = new Timer(this.components);   this.subject = new Timer(this.components);   this.run = new Timer(this.components);   this.load = new Timer(this.components);   this.screen = new Timer(this.components);</code> </pre> <br>  Das Timer-Objekt hat drei wichtige Felder: <br><br><ul><li>  Aktiviert: Zeigt den Status des aktivierten Timers an. </li><li>  Intervall: Zeit zwischen Ereignissen in Millisekunden </li><li>  H√§kchen: Der R√ºckruf wird ausgef√ºhrt, nachdem der Timer abgelaufen ist und wenn der Timer eingeschaltet ist </li></ul><br>  Felder werden wie folgt angezeigt: <br><br><pre> <code class="plaintext hljs">  this.start.Enabled = true;   this.start.Interval = 120000;   this.start.Tick += new EventHandler(this.start_Tick);   this.inf.Interval = 10000;   this.inf.Tick += new EventHandler(this.inf_Tick);   this.txt.Interval = 120000;   this.txt.Tick += new EventHandler(this.txt_Tick);   this.subject.Interval = 120000;   this.subject.Tick += new EventHandler(this.subject_Tick);   this.run.Interval = 60000;   this.run.Tick += new EventHandler(this.run_Tick);   this.load.Interval = 120000;   this.load.Tick += new EventHandler(this.load_Tick);   this.screen.Interval = 8000;   this.screen.Tick += new EventHandler(this.screen_Tick);</code> </pre> <br>  F√ºr jedes Objekt wird das <i>Intervallintervall</i> von 8 Sekunden bis 2 Minuten eingestellt.  Dem Ereignishandler wird ein R√ºckruf hinzugef√ºgt.  Beachten Sie, dass nur <i>start</i> den Wert f√ºr <i>Enabled</i> auf true setzt. <i>Dies</i> bedeutet, dass <i>start_Tick</i> nach 2 Minuten (12.000 Millisekunden = 120 Sekunden) vom Ereignishandler aufgerufen wird. <br><br><pre> <code class="plaintext hljs">   private void start_Tick(object sender, EventArgs e)   {       try       {           this.start.Enabled = false;           Lenor lenor = new Lenor();           this.dir = !Directory.Exists(this.label15.Text.ToString()) ? this.label16.Text.ToString() + "\" : this.label15.Text.ToString() + "\";           this.att = this.dir + "audev.txt";           this._id = lenor.id(this.dir);           this.inf.Enabled = true;       }</code> </pre> <br>  Au√üerdem zeigt jede Methode ein identisches Verhalten - √§ndert den Wert " <i>Aktiviert"</i> zu Beginn in " <i>Falsch"</i> .  Die Methode wird ausgef√ºhrt und √§ndert dann den Aktivierungswert des n√§chsten Objekts in <i>true</i> , wodurch der n√§chste Timer aktiviert wird.  Die Variable <i>Enabled</i> wird vom Operator verwendet, um so etwas wie eine Zustandsmaschine zu erstellen. Wenn die Funktion nicht funktioniert, wiederholt der Mechanismus ihre Ausf√ºhrung, bis er ein positives Ergebnis erh√§lt.  Die Zeit zwischen der Ausf√ºhrung von zwei Funktionen kann als Versuch verwendet werden, den Virenschutz durch Hinzuf√ºgen einer Verz√∂gerung zu umgehen. <br><br>  Nachdem wir nun die Struktur jeder Methode beschrieben haben, fahren wir mit dem Steueralgorithmus fort.  Im Folgenden finden Sie eine √úbersicht √ºber die Schritte zum Austausch von E-Mails zwischen Postf√§chern. <br><br><img src="https://habrastorage.org/webt/hd/zj/tl/hdzjtlq57qrzyht5k_lsydclpxm.png"><br>  <i>Abbildung 5. E-Mail-Austausch</i> <br><br>  Malvar pr√ºft, ob ein bestimmter Pfad vorhanden ist, mit dem die einzelnen Dateien w√§hrend der Ausf√ºhrung gesichert werden.  Verwenden Sie nach M√∂glichkeit <i>C: \ Benutzer \ √ñffentlich \ Videos \</i> , andernfalls <i>C: \ Dokumente und Einstellungen \ Alle Benutzer \ Dokumente \</i> als Standardverzeichnis.  Bitte beachten Sie, dass der zweite Pfad spezifisch f√ºr Windows XP ist, w√§hrend der erste Pfad spezifisch f√ºr Vista und h√∂her ist. <br><br>  Eine 16-Byte- <i>ID wird</i> durch Verketten der Seriennummer von Volume C: und des Benutzernamens generiert.  Es wird in der Datei <i>audev.txt</i> gespeichert. <br><br>  Der Bootloader sammelt die folgenden Informationen: <br>  - aktueller Anwendungspfad <br>  - Betriebssystemversion <br>  - Systemverzeichnis <br>  - Benutzerdom√§ne <br>  - Autoname <br>  - Benutzername <br>  - aktuelle Zeitzone <br>  - aktuelles Datum <br>  - eine Liste der logischen Laufwerke und Informationen zu jedem von ihnen (Modell, Seriennummer usw.) <br>  - Auflisten der Verzeichnisse <i>C: \ Programme \</i> und <i>C: \ Programme (x86) \</i> <br>  - Liste der Prozesse <br><br>  Diese Daten werden in der Datei <i>C: \ Users \ Public \ Videos \ si.ini gespeichert</i> und per Brief im Anhang √ºber SMTPS unter Verwendung des Standardports 465 gesendet. Der Nachrichtentext enth√§lt die <i>SI-</i> Zeile (was Systeminformationen bedeuten kann), der Nachrichtenempf√§nger ist <i>sym777. g@post.cz</i> .  F√ºr den gesamten Informationsaustausch wird der Betreff der Briefe als <i>ID angegeben</i> . <br><br>  Der Betreiber hat beschlossen, mehrere Ersatzadressen zu erstellen und denselben Brief an zwei andere Empf√§nger zu senden, h√∂chstwahrscheinlich f√ºr den Fall, dass die prim√§re Adresse nicht funktioniert.  Nach dem Senden des Briefes l√∂scht der Bootloader die Datei <i>si.ini</i> . <br><br>  W√§hrend der ersten Ausf√ºhrung der Malware wird eine <i>set.txt-</i> Datei mit dem Text <i>{System_Parametrs = 10}</i> und einem Eintrag im Windows-Registrierungsschl√ºssel erstellt. <br><br><img src="https://habrastorage.org/webt/hl/eh/ge/hlehgecuzoyjoygnnlt6c1q2l58.png"><br>  <i>Abbildung 6. Persistenz in der Registrierung</i> <br><br>  Ein Screenshot wird unter dem Namen <i>scx.bin</i> vom Computer des Opfers aufgenommen und per E-Mail-Anhang mit dem Text <i>SC</i> (was Screenshot bedeuten kann) im Nachrichtentext gesendet. <br><br>  Nach dem Senden kontaktiert die Malware die Mailbox <i>kae.mezhnosh@post.cz</i> √ºber das POP3-Protokoll √ºber SSL (Port 995) und sucht nach Nachrichten mit einem Betreff, der mit der <i>ID</i> √ºbereinstimmt.  Wenn eine solche Nachricht vorhanden ist und der <i>Text</i> nicht leer ist, entschl√ºsselt die Malware sie und sendet eine Nachricht mit <i>okey</i> im <i>Text</i> an <i>sym777.g@post.cz</i> .  Der Inhalt einer zuvor empfangenen Nachricht wird wie folgt gel√∂scht und analysiert: <br><br><pre> <code class="plaintext hljs">string[] strArray = this._adr.Replace("B&amp;", "").Replace("Db", "").Split('%');       string str1 = strArray[0];       string str2 = strArray[1];</code> </pre> <br>  Es werden zwei Zeilen erhalten: Die erste ist das Passwort und die zweite ist der Benutzername f√ºr die E-Mail-Adresse. <br><br>  Neue Anmeldeinformationen werden verwendet, um eine Verbindung zum empfangenen Postfach herzustellen, darin nach einer Nachricht mit einem Thema zu suchen, das mit der <i>ID der</i> Malvari √ºbereinstimmt, und nach einer Anwendung mit der Zeichenfolge <i>audev</i> im Dateinamen.  Wenn beide Bedingungen erf√ºllt sind, speichert die Malware die Anwendung und l√∂scht die Nachricht vom Server. <br><br>  Ein Nachrichtenprotokoll wird an <i>sym777.g@post.cz</i> gesendet, und √ºber POP3 empfangene Nachrichten stammen vom Empf√§nger mit k√ºrzlich empfangenen Benutzerdaten. <br><br>  Das Angriffsschema erschwert die Untersuchung.  Erstens, wenn Sie einen Bootloader mit Buchstaben haben, k√∂nnen Sie keine Verbindung zum Postfach herstellen, das den n√§chsten Schritt enth√§lt. <br><br>  Zweitens, wenn Sie Anmeldeinformationen f√ºr E-Mails erhalten, k√∂nnen Sie die n√§chste Nutzlast immer noch nicht erhalten, da sie nach dem Empfang gel√∂scht wird. <br><br>  Wenn der Bootloader den Anhang erfolgreich auf die Festplatte schreibt, sendet er eine Nachricht in der Mail mit <i>okey2</i> im <i>Text</i> und dem <i>l.txt-</i> Anhang mit <i>090</i> .  Dieselbe Datei wird mit Nullen √ºberschrieben, und die Malware versucht, eine weitere Nachricht zu erhalten.  Wenn dies funktioniert, wird die Datei <i>l.txt</i> mit <i>okey3</i> im Body <i>gesendet</i> .  Der Inhalt des Anhangs ist das Verzeichnis und der Dateiname.  Malvar verschiebt die Audev-Datei an diese Adresse.  Schlie√ülich sendet die Malware eine E-Mail mit <i>okey4</i> im <i>Text</i> und <i>l.txt</i> im Anhang.  Dadurch wird die ausf√ºhrbare Datei <i>audev.exe gestartet</i> und das Vorhandensein der Zeile <i>audev</i> in der Prozessliste √ºberpr√ºft. <br><br><pre> <code class="plaintext hljs">  Process.Start(this.rn);   foreach (Process process in Process.GetProcesses())   {       if (process.ProcessName.Contains("audev")) }</code> </pre> <br>  Wenn ein solcher Name gefunden wird, wird der letzte Brief gesendet, der im <i>Text okey5</i> und <i>l.txt</i> im Anhang enth√§lt.  Schlie√ülich werden <i>l.txt</i> und <i>set.txt</i> gel√∂scht, der erstellte Windows-Registrierungsschl√ºssel wird gel√∂scht und das Programm wird beendet. <br><br><h3>  Delphi Mail Downloader </h3><br>  Die Hauptaufgabe des Bootloaders besteht darin, die Bedeutung eines kompromittierten Systems zu bewerten und, wenn es interessant erscheint, den neuesten Zebrocy-Bootloader zu laden und auszuf√ºhren. <br><br>  Die Bin√§rdatei wird in Delphi geschrieben und mit UPX gepackt.  Eine vollst√§ndige Definition des <i>TForm1-</i> Objekts finden Sie im Abschnitt mit seinen Ressourcen. Es zeigt einige verwendete Konfigurationsparameter.  In den folgenden Abschnitten werden die Initialisierung, die Funktionen und das Netzwerkprotokoll des Bootloaders beschrieben. <br><br><h3>  Initialisierung </h3><br>  Entschl√ºsselt zun√§chst die Zeichenfolgen, bei denen es sich um E-Mail-Adressen und Kennw√∂rter handelt.  Der Betreiber wendet den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AES-EZB-</a> Verschl√ºsselungsalgorithmus an.  Jede Zeile wird hexadezimal entschl√ºsselt, wobei die ersten vier Bytes der endg√ºltigen Gr√∂√üe der entschl√ºsselten Zeile entsprechen (entschl√ºsselte Zeilen am Ende k√∂nnen Einr√ºckungen enthalten).  Das <i>TForm1-</i> Objekt enth√§lt zwei AES-Schl√ºssel: Der erste dient zum Verschl√ºsseln von Daten und der zweite zum Entschl√ºsseln. <br><br>  E-Mail-Adressen und Passw√∂rter werden vom Bediener verwendet, um Befehle an die Malvari zu senden und um Informationen zu erhalten, die vom Computer des Opfers gesammelt wurden.  Die Kommunikationsprotokolle SMTP und POP3 werden angewendet - beide √ºber SSL.  Um OpenSSL zu verwenden, <i>l√∂scht</i> die Malware zwei dynamische OpenSSL-Bibliotheken und verwendet sie: <i>libeay32.dll (98c348cab0f835d6cf17c3a31cd5811f86c0388b)</i> und <i>ssleay32.dll (6d981d71895581dfb103170486b8614f7f203b)</i> . <br><br><img src="https://habrastorage.org/webt/fo/vl/_6/fovl_6evpu2kfxhr3b-4kcjeets.png"><br>  <i>Abbildung 7. OpenSSL-DLL-Eigenschaften</i> <br><br>  Bitte beachten Sie, dass alle Dateien im Arbeitsverzeichnis der Malware abgelegt werden <i>: C: \ Users \ Public \</i> . <br><br>  Die Persistenz wird w√§hrend der ersten Ausf√ºhrung der Malvari durch die bekannte Skripttechnik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">des</a> Eingabeskripts bereitgestellt.  Eine Datei mit dem Skript <i>register.bat</i> wird erstellt und mehrere Zeilen werden aus dem <i>TForm1-</i> Objekt geschrieben.  Das endg√ºltige Skript lautet wie folgt: <br><br><pre> <code class="plaintext hljs">reg add HKCU\Environment /v "UserInitMprLogonScript" /t REG_EXPAND_SZ /d "C:\Users\Public\Videos\audev.exe" /f del C:\Users\Public\Videos\registr.bat exit</code> </pre> <br>  Last but not least erstellt die Malware eine <i>ID</i> , genau wie in den zuvor beschriebenen Zebrocy-Bin√§rdateien.  Es erh√§lt den Benutzernamen √ºber <i>die</i> Windows-API <i>GetUserNameW</i> und f√ºgt am Anfang die Seriennummer des Laufwerks C: \ hinzu. <br><br><h3>  Die M√∂glichkeiten </h3><br>  Da es verschiedene Bedingungen und Verfahren zum Sammeln von Informationen √ºber das Opfer gibt, werden im Folgenden die verschiedenen Funktionen des Opfers beschrieben.  Die Scan-Konfiguration wird im <i>TForm1-</i> Objekt gespeichert, in dem sieben verschiedene M√∂glichkeiten zum Sammeln von Informationen vom Computer des Opfers zusammengefasst sind. <br><br>  Beginnend mit einem einfachen Scan beziehen sich die ersten Informationen, die die Malware erhalten kann, auf Dateien mit den folgenden Erweiterungen: <i>.docx, .xlsx, .pdf, .pptx, .rar, .zip, .jpg, .bmp, .tiff</i> .  F√ºr jede der auf der Festplatte gefundenen Dateien erh√§lt die Malware den vollst√§ndigen Pfad und das Datum der letzten √Ñnderung.  Diese Informationen werden mit dem zuvor <i>erw√§hnten</i> AES-Schl√ºssel verschl√ºsselt und in der Datei <i>0.txt</i> gespeichert.  Ein weiterer Scan zielt auf die Erweiterungen <i>.dat, .json, .db ab</i> und <i>ruft</i> wie im vorherigen Fall den vollst√§ndigen Pfad und das letzte Datum ab, an dem die Datei ge√§ndert wurde.  Anschlie√üend werden sie verschl√ºsselt und in der Datei <i>57.txt</i> gespeichert. <br><br>  Das Auflisten laufender Prozesse ist eine weitere Funktion von malvari, mit der Sie Informationen in einer <i>08.txt-</i> Datei speichern k√∂nnen.  Es sieht so aus: <br><br><pre> <code class="plaintext hljs">======Listing_of_processes======= [System Process] System smss.exe csrss.exe wininit.exe csrss.exe winlogon.exe services.exe lsass.exe [‚Ä¶]</code> </pre> <br>  Die <i>i.txt-</i> Datei enth√§lt allgemeine Informationen zum Computer des Opfers sowie einige Informationen zur Malvari (Versionsnummer und Pfad, auf dem sie ausgef√ºhrt wird).  Siehe das folgende Beispiel: <br><br><pre> <code class="plaintext hljs">v7.00 C:\Users\Public\Videos\audev.txt ============================================ Log_Drivers: C: fixed; size= 102297 Mb, free=83927 Mb S/N: [redacted] ================================================== OSV: Windows 7 WinType: 32 WinDir: C:\Windows Lang: English (United States) TZ: UTC1:0 Romance Standard Time HostN: [redacted]-PC User: [redacted] ===============S_LIST===================== C:\Program Files\Common Files C:\Program Files\desktop.ini C:\Program Files\DVD Maker C:\Program Files\Internet Explorer C:\Program Files\Microsoft.NET C:\Program Files\MSBuild C:\Program Files\Reference Assemblies C:\Program Files\Uninstall Information C:\Program Files\Windows Defender [‚Ä¶]</code> </pre> <br>  Malware kann Screenshots <i>erstellen</i> , die im Format <i>2 \ [JJJJ-mm-TT HH-MM-SS] -Image_001.jpg gespeichert sind</i> , und eine weitere Datei <i>2 \ sa.bin generieren</i> , die eine Liste der Pfade zu den Dateien aller erfassten Screenshots enth√§lt.  Die letzte Option besteht darin, Netzwerkkomponenten und Systemdaten <i>aufzulisten</i> . Das Ergebnis wird in <i>4.txt geschrieben</i> . <br><br><h3>  Netzwerkprotokoll </h3><br>  Der Delphi Mail Loader ist eine relativ neue Erweiterung des Zebrocy-Toolkits. Er bietet eine neue M√∂glichkeit, Daten zu filtern und Befehle vom Bediener zu empfangen.  Die Exfiltration ist recht einfach, macht jedoch im Netzwerk viel L√§rm, da zuvor gesammelte verschl√ºsselte Dateien √ºber SMTPS gesendet werden. Jede Version der Datei ist dreimal. <br><br><img src="https://habrastorage.org/webt/tw/xe/if/twxeif5sgovtnxjkuxhrcmcqyze.png"><br><br>  Der Betreff der Nachricht ist die Opfer- <i>ID</i> , und die Datei wird als Anhang mit einem Schl√ºsselwort gesendet, das dem Inhalt der Datei entspricht.  Bitte beachten Sie, dass f√ºr jede Datei eine verschl√ºsselte Version gesendet wird. <br><br><img src="https://habrastorage.org/webt/pn/pv/1m/pnpv1mmbkhhjs3qfrxa2uthwsky.png"><br><br>  Screenshots und Dateien f√ºr beide Scans werden ebenfalls gesendet, jedoch mit unterschiedlichen Schl√ºsselw√∂rtern. <br><br><img src="https://habrastorage.org/webt/vu/s8/32/vus8328b9llia3xsyobiyqmnejw.png"><br><br><img src="https://habrastorage.org/webt/x9/ds/0h/x9ds0hckegel5ayp75d4nmkgtuc.png"><br>  <i>Abbildung 8. Beispiel einer Nachricht mit √ºbertragenen Daten</i> <br><br>  W√§hrend SMTP f√ºr die <i>Datenexfiltration</i> verwendet wird, wird die Bin√§rdatei √ºber POP3 und Nachrichtenanalyse mit der <i>E-</i> Mail- <i>Adresse tomasso25@ambcomission.com</i> verbunden.  Der Textk√∂rper des Briefes enth√§lt verschiedene Schl√ºsselw√∂rter, die von der Malware als Befehle interpretiert werden. <br><br><img src="https://habrastorage.org/webt/wg/de/u7/wgdeu7jmqergcyp8lkyt4tk8ogs.png"><br><br>  Nach der Ausf√ºhrung werden das Debugger-Protokoll und das Ergebnis der Befehle (falls vorhanden) an den Bediener zur√ºckgesendet.  Beispielsweise empf√§ngt der Bediener nach einem Scanbefehl eine Datei, die eine Liste von Dateien mit √ºbereinstimmenden Erweiterungen zusammen mit jeder solchen Datei enth√§lt. <br><br>  W√§hrend dieser Bootloader Backdoor-Funktionen hat, speichert er einen Bootloader auf Delphi in das System, der bereits dieser Gruppe zugeordnet ist, die wir in einem fr√ºheren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> √ºber Zebrocy beschrieben haben. <br><br><h3>  Fazit </h3><br>  In der Vergangenheit haben wir bereits die Schnittstelle zwischen Zebrocy und der traditionellen Sednit-Malware gesehen.  Wir haben Zebrocy dabei erwischt, wie er Sednits Flaggschiff-Hintert√ºr in das XAgent-System geworfen hat. Deshalb schreiben wir Zebcyys Urheberschaft dieser Cybergruppe mit hohem Vertrauen zu. <br><br>  Die Analyse von Bin√§rdateien ergab jedoch Fehler sowohl auf Sprachebene als auch bei der Entwicklung, was auf ein anderes Qualifikationsniveau der Autoren hinweist.  Beide Bootloader verwenden Mail-Protokolle, um Daten zu filtern, und verf√ºgen √ºber identische Mechanismen zum Sammeln derselben Informationen.  Sie verursachen jedoch viel Rauschen im Netzwerk und im System, erstellen viele Dateien und senden sie.  Bei der Analyse des Mailloaders auf Delphi schienen uns einige Funktionen weg zu sein, aber die Zeilen blieben immer noch in der Bin√§rdatei.  Dieses Toolkit wird vom Sednit-Team verwendet, aber wir glauben, dass es von einem anderen Team entwickelt wird - weniger erfahren im Vergleich zu den Entwicklern der traditionellen Sednit-Komponenten. <br><br>  Zebrocy-Komponenten sind eine Erg√§nzung des Sednit-Toolkits, und die j√ºngsten Ereignisse erkl√§ren m√∂glicherweise die zunehmende aktive Verwendung von Zebrocy-Bin√§rdateien anstelle der herk√∂mmlichen Malvari. <br><br><h3>  Kompromissindikatoren </h3><br><br>  <b>Dateinamen, SHA-1 und Erkennung durch ESET-Produkte</b> <br><br>  1. SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe - 7768fd2812ceff05db8f969a7bed1de5615bfc5a - <b>Win32 / Sednit.ORQ</b> <br>  2. C: \ Users \ public \ Pictures \ scanPassport.jpg - da70c54a8b9fd236793bb2ab3f8a50e6cd37e2df <br>  3. C: \ Benutzer \ √ñffentlich \ Dokumente \ AcrobatReader. {Exe, txt} - a225d457c3396e647ffc710cd1edd4c74dc57152 - <b>MSIL / Sednit.D</b> <br>  4. C: \ Benutzer \ √ñffentlich \ Videos \ audev.txt - a659a765536d2099ecbde988d6763028ff92752e - <b>Win32 / Sednit.CH</b> <br>  5.% TMP% \ Indy0037C632.tmp - 20954fe36388ae8b1174424c8e4996ea2689f747 - <b>Win32 / TrojanDownloader.Sednit.CMR</b> <br>  6.% TMP% \ Indy01863A21.tmp - e0d8829d2e76e9bb02e3b375981181ae02462c43 - <b>Win32 / TrojanDownloader.Sednit.CMQ</b> <br><br>  <b>E-Mail</b> <br><br>  <i>carl.dolzhek17@post.cz</i> <i><br></i>  <i>shinina.lezh@post.cz</i> <i><br></i>  <i>P0tr4h4s7a@post.cz</i> <i><br></i>  <i>carl.dolzhek17@post.cz</i> <i><br></i>  <i>sym777.g@post.cz</i> <i><br></i>  <i>kae.mezhnosh@post.cz</i> <i><br></i>  <i>tomasso25@ambcomission.com</i> <i><br></i>  <i>kevin30@ambcomission.com</i> <i><br></i>  <i>salah444@ambcomission.com</i> <i><br></i>  <i>karakos3232@seznam.cz</i> <i><br></i>  <i>rishit333@ambcomission.com</i> <i><br></i>  <i>antony.miloshevich128@seznam.cz</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de437236/">https://habr.com/ru/post/de437236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de437226/index.html">Kelvin Point Shadow</a></li>
<li><a href="../de437228/index.html">Bitcoin als W√§hrung wird zu einer Wirtschaftskrise f√ºhren</a></li>
<li><a href="../de437230/index.html">So eine andere Online-Werbung. Drei Achsen vs. AI, Ad Tech und DOOH</a></li>
<li><a href="../de437232/index.html">Psto gut</a></li>
<li><a href="../de437234/index.html">Wir beginnen mit der Untersuchung von Mikrocontrollern am Beispiel von STM32F030f4p6</a></li>
<li><a href="../de437238/index.html">Orange Pi 3 ver√∂ffentlicht - ein 30-Dollar-Mini-PC unter Linux</a></li>
<li><a href="../de437240/index.html">So integrieren Sie die Zimbra Collaboration Suite in Active Directory</a></li>
<li><a href="../de437242/index.html">Beherrschung des Produktmanagers. Funktionsanforderungen</a></li>
<li><a href="../de437244/index.html">Google lehrt Nutzer, Phishing-E-Mails zu erkennen</a></li>
<li><a href="../de437248/index.html">FPGA Mitap in St. Petersburg</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>