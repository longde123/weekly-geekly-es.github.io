<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå©Ô∏è ‚ò¢Ô∏è üàöÔ∏è Evolucione o cree una base para robots en la plataforma ARDUINO, y manejamos sensores y video a una computadora a trav√©s de un tel√©fono inteligente üîç ü•Ö üë©üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Para los queridos lectores de GeekTimes, el pr√≥ximo (cuarto) art√≠culo tan esperado sobre lo que suceder√° si vuelves a mezclar el arduino, ESP8266, WI-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Evolucione o cree una base para robots en la plataforma ARDUINO, y manejamos sensores y video a una computadora a trav√©s de un tel√©fono inteligente</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448516/"> Para los queridos lectores de GeekTimes, el pr√≥ximo (cuarto) art√≠culo <s>tan esperado</s> sobre lo que suceder√° si vuelves a mezclar el arduino, ESP8266, WI-FI, sazonarlo con un tel√©fono inteligente Android y espolvorearlo sobre la aplicaci√≥n JAVA. <br><br>  Hablaremos sobre los robots del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> antes del √∫ltimo, que lleg√≥ el momento de al menos ser un poco m√°s inteligentes. <br><br><img src="https://habrastorage.org/webt/dc/uf/us/dcufusp1engi_cqy_pdjltx-qgq.jpeg" alt="imagen"><br><br>  A qui√©n le importa, bienvenido al gato. <br><a name="habracut"></a><br>  Si no est√° muy interesado en leer art√≠culos antiguos, entonces brevemente, el punto era que para controlar el carro de cuatro ruedas habitual en la plataforma Arduino, se le agreg√≥ un puente inal√°mbrico UART desarrollado por m√≠ basado en el conocido m√≥dulo ESP8266.  Tambi√©n por conveniencia (y en general este era el objetivo principal) usando el mismo ESP, escrib√≠ un programador para arduinki, que le permite flashearlo usted mismo de forma remota. <br><br><img src="https://habrastorage.org/webt/y-/57/pt/y-57pte4rudizc-oitiqraysx7m.png" alt="imagen"><br><br>  Es decir, el carrito en alg√∫n lugar lejano (pero dentro de su red WI-FI) viaja (s√≠, me gusta escribir esta palabra), env√≠a datos y recibe comandos, y si es necesario, por pedido, tambi√©n puede cambiar el programa en su microcontrolador AVR.  En consecuencia, se ejecut√≥ el programa en JAVA para PC, que puede disfrutar de control y obtener telemetr√≠a primitiva en forma de distancia recorrida (interruptor de l√°minas e im√°n en la rueda). <br><br><img src="https://habrastorage.org/webt/yf/r_/nk/yfr_nk3y69gts4z4x4ubodhd7cy.png" alt="imagen"><br><br>  Adem√°s, experiment√© con √©xito en el siguiente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> con el control del carro usando un tel√©fono inteligente: botones, inclinaciones e incluso voz.  Pero cuando el carro se fue a la habitaci√≥n de al lado, incluso la voz no pudo devolverlo (a diferencia del gato).  Fue all√≠, golpe√≥ paredes y muebles, se enred√≥ con cables, pero adem√°s de informaci√≥n sobre la distancia recorrida, no envi√≥ nada. <br><br>  Por lo tanto, surgi√≥ de inmediato la idea de proporcionar al futuro Terminator √≥rganos sensoriales.  Una de las opciones m√°s f√°ciles para esto es el uso del sonar. <br><br><img src="https://habrastorage.org/webt/yj/qh/eg/yjqhegrrkudwtrwdx5nr_ppkywo.png" alt="imagen"><br><br>  El algoritmo de trabajo para la desgracia es simple, arrancamos el sensor desde un frente y al mismo tiempo alg√∫n contador de microcontrolador.  HC-SR04 comienza a disparar ultrasonido en la distancia.  La se√±al de respuesta del sensor a trav√©s de otro cable se√±ala el final de la medici√≥n de distancia, y el intervalo de tiempo entre el inicio y la respuesta es proporcional a la distancia medida.  En consecuencia, en este momento, disminuimos la velocidad del mostrador y vemos cu√°nto entra. <br><br>  La precisi√≥n se obtiene hasta aproximadamente un cent√≠metro, y un rango de metros a dos.  No le gustan las superficies de lana y lana (por ejemplo, un gato), donde cualquier se√±al de eco se ahog√≥ irrevocablemente. <br><br>  <s>El √°rea afectada del</s> √°ngulo de visi√≥n del HC-SR04 es peque√±a, por lo que para saber qu√© est√° sucediendo en el marco de un √°ngulo de al menos 90 grados, es conveniente hacer lo siguiente: <br><br><ol><li>  atornille el sensor a la servom√°quina y m√≠relo en diferentes direcciones </li><li>  pon algunos sensores. </li></ol><br>  Al principio, implement√© la primera opci√≥n, colocando el sonar en un servo SG90 barato y el carro se convirti√≥ en un rover.  Se requiri√≥ tanto tiempo para tomar al menos tres mediciones, por lo que b√°sicamente el carro se puso en rotaci√≥n con un servo, luego se movi√≥ cuidadosamente hacia adelante, pero no muy lejos (y de repente apareci√≥ un obst√°culo en el costado), y nuevamente sinti√≥ el espacio frente a s√≠ mismo.  A√∫n as√≠, el sonido no es la luz para ti. <br><br>  Por lo tanto, sin m√°s pre√°mbulos, puse tres sistemas de sonda a la vez.  El carro adquiri√≥ una apariencia de ara√±a ct√≥nica, se detuvo sin brillo frente a los obst√°culos y comenz√≥ a rodarlos en el camino.  Pero los cerebros al final fueron suficientes para no quedar atrapados en un ambiente amigable.  Tuvimos que avanzar - hacia la autonom√≠a y el progreso.  Y aqu√≠, sin diferentes sentidos, incluso el gusano nematodo te dir√° que no puedes hacerlo. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yjUsvUk880o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Adem√°s, generalmente los entusiastas comienzan a esculpir en sus creaciones varios sensores nuevos, como giroscopios, aceler√≥metros, magnet√≥metros e incluso sensores de FUEGO (todos esos chinos sin nombre producen en millones de cantidades para Arduino).  Y yo tambi√©n, casi comenc√© por este camino resbaladizo, pero cambi√© de opini√≥n a tiempo.  Y lo hice por este motivo.  En la perspectiva m√°s lejana, se supon√≠a que el robot rob√≥tico ten√≠a visi√≥n en forma de c√°mara y tambi√©n entend√≠a lo que ve.  Pero el microcontrolador AVR de la placa Arduino le dir√° "adi√≥s" en la etapa de recepci√≥n del video, sin mencionar el procesamiento.  Y de repente mi mirada cay√≥ sobre el viejo tel√©fono inteligente GALAXY S7, ya maltratado por la vida. <br><br>  Tal potencia inform√°tica, ocho n√∫cleos, 4 gigabytes de memoria, dos c√°maras, acceso a la red, ¬øqu√© m√°s se necesita para convertir a un mono en una persona? <br><br>  Pero solo necesitamos un dise√±o peque√±o para que nuestro tel√©fono inteligente descanse en un carrito y para que pueda colocarse y quitarse f√°cilmente. <br><br><img src="https://habrastorage.org/webt/l6/ej/gf/l6ejgf5jxwlzkqs21pifxg-wtl8.jpeg" alt="imagen"><br><br>  Luego me sub√≠ al sitio de desarrolladores de Android para averiguar qu√© otras caracter√≠sticas puede ofrecernos un tel√©fono inteligente normal.  Result√≥ que no es peque√±o.  Te√≥ricamente puedes <br><br><div class="spoiler">  <b class="spoiler_title">acceder a los siguientes sensores sensores.</b> <div class="spoiler_text">  TYPE_ACCELEROMETER <br><br>  TYPE_AMBIENT_TEMPERATURE <br><br>  TYPE_GAME_ROTATION_VECTOR <br><br>  GEOMAGNETIC_ROTATION_VECTOR <br><br>  TYPE_GRAVITY <br><br>  TYPE_GYROSCOPE <br><br>  TYPE_GYROSCOPE_UNCALIBRATED <br><br>  TYPE_HEART_BEAT <br><br>  TYPE_HEART_RATE <br><br>  TYPE_LIGHT <br><br>  TYPE_LINEAR_ACCELERATION <br><br>  TYPE_LOW_LATENCY_OFFBODY_DETECT <br><br>  TYPE_MAGNETIC_FIELD <br><br>  TYPE_MAGNETIC_FIELD_UNCALIBRATED <br><br>  TYPE_MOTION_DETECT <br><br>  TYPE_ORIENTATION <br><br>  TYPE_POSE_6DOF <br><br>  TYPE_PRESSURE <br><br>  TYPE_PROXIMITY <br><br>  TYPE_RELATIVE_HUMIDITY <br><br>  TYPE_ROTATION_VECTOR <br><br>  TYPE_SIGNIFICANT_MOTION <br><br>  TYPE_STATIONARY_DETECT <br><br>  TYPE_STEP_COUNTER <br><br>  TYPE_STEP_DETECTOR <br><br></div></div><br>  Como dicen, ¬°qu√© hay all√≠ solo!  Y, de hecho, no hab√≠a mucho que fuera espec√≠fico del GALAXY S7.  Por ejemplo, un sensor de humedad.  Y la temperatura ambiente (aunque entend√≠ que al estar dentro de la carcasa, mostrar√° la temperatura del tel√©fono inteligente).  Pero los sensores de presi√≥n y luz estaban presentes.  Sin mencionar los giroscopios, aceler√≥metros, con los cuales puede determinar f√°cilmente su posici√≥n en el espacio. <br><br>  Como resultado, una decisi√≥n ha madurado, dejar que el tel√©fono inteligente reciba y procese toda la informaci√≥n del nivel superior: video y todos estos sensores.  Y la plataforma Arduino ser√° responsable, por as√≠ decirlo, del inconsciente, de todo lo que ya funciona y no requiere retrabajo, todos estos motores, sonar, interruptores de l√°minas, etc. <br><br>  Dado que es dif√≠cil depurar el programa directamente en el tel√©fono inteligente, incluso con UDB, decid√≠ dejar que todo se transfiriera a una computadora personal normal y se procesara all√≠.  Y luego, de alguna manera, cuando haya una versi√≥n funcional, devolveremos el cerebro al carro.  Debemos comenzar con algo peque√±o, y de hecho es interesante observar la transmisi√≥n de video desde un carrito fren√©tico. <br><br>  Los datos de los sensores se pueden enviar en una l√≠nea simple, a trav√©s de un servidor cliente primitivo, no hay ning√∫n problema con esto.  Pero con la transferencia del video, inmediatamente hubo dificultades.  En general, necesitaba una transmisi√≥n en tiempo real desde la c√°mara del tel√©fono inteligente a la ventana de la aplicaci√≥n en la computadora.  Esto es por ahora.  En el futuro, no solo yo, sino alg√∫n tipo de sistema de reconocimiento de patrones podr√≠a mirar esta imagen en la ventana.  Por ejemplo JAVA OpenCV.  O tal vez incluso una red neuronal desde la nube: D.  No s√©, esta etapa a√∫n est√° muy lejos.  Pero me gustar√≠a ver el mundo con el "ojo" de un cami√≥n rob√≥tico. <br><br>  Todo el mundo conoce numerosas aplicaciones, como una "c√°mara m√≥vil" de la tienda de Google, donde puede ver una transmisi√≥n de video de la c√°mara de un tel√©fono inteligente abriendo un navegador con la IP deseada en la computadora.  Por lo tanto, al principio pens√© que no ser√≠a dif√≠cil traducirlo desde mi GALAXY (lo cual no fue un error d√©bil), por lo que primero debe verificar c√≥mo ser√° con su recepci√≥n en la computadora, dado que puedo escribir de alguna manera solo en JAVA. <br><br>  Al final result√≥ que, con la reproducci√≥n de video JAVA, por decirlo suavemente, no muy bien.  √ârase una vez en 1997, se lanz√≥ el llamado Java Media Framework, una biblioteca que facilita el desarrollo de programas que funcionan con audio y video de los creadores de JAVA.  Pero, en alg√∫n lugar despu√©s de 2003, se le puso un gran tornillo y desde entonces ya han pasado 15 a√±os.  Despu√©s de algunos experimentos, logr√© ejecutar un archivo en la ventana, no recuerdo cu√°l ya (parece AVI), pero esta vista parec√≠a bastante miserable.  Los archivos con otras extensiones no quer√≠an ejecutarse en absoluto, en casos extremos hab√≠a una pista de audio. <br><br>  En Internet, encontr√© dos proyectos alternativos m√°s para trabajar con video: Xuggler y aprica VLCj.  El primer proyecto fue atractivo en sus capacidades, pero tambi√©n muri√≥ hace mucho tiempo, pero el segundo result√≥ ser bastante animado e interesante en su propia idea.  Los chicos tomaron y sujetaron a JAVA el conocido reproductor multimedia VLC.  Es decir, aprica no usa c√≥decs autoescritos, sino c√≥decs ya hechos.  Con √©l, perder√°s cualquier archivo.  Una decisi√≥n acertada, pero lo principal es que ya tiene este reproductor VLC instalado en su computadora.  Bueno, ¬øqui√©n no lo tiene?  Sin embargo, la √∫nica advertencia es que tiene las mismas profundidades de bits del jugador y JAVA.  Por ejemplo, m√°s tarde, con sorpresa, descubr√≠ que todav√≠a ten√≠a un VLC de 32 bits en mi computadora, en contraste con JAVA de 64 bits.  Y medio d√≠a de vida se perdi√≥ en vano. <br><br>  Los desarrolladores de Caprica prometen a los usuarios muchas cosas en su sitio web.  Y todos los formatos de archivo y el lanzamiento en varias ventanas en una aplicaci√≥n JAVA, reproducci√≥n de video de You-Tube, captura de una transmisi√≥n de video "en vivo", etc.  Pero la dura realidad puso todo en su lugar.  No, no enga√±aron con archivos: todo se reproduce.  Pero ahora el video de YouTube ya no quiere.  Al principio no pod√≠a entender por qu√©, pero luego vi una inscripci√≥n en el registro que de alguna manera, en alg√∫n lugar, era imposible ejecutar un cierto script lua e inmediatamente record√© que: <br><blockquote>  Este 'raspado de pantalla' de la p√°gina web de YouTube es fr√°gil: si YouTube cambia la estructura de sus p√°ginas web, a veces VLC no podr√° encontrar la URL de transmisi√≥n, cuando esto sucede, debe esperar a que un desarrollador proporcione una nueva LUA script y espere a que se lance una nueva versi√≥n de VLC. </blockquote>  En resumen, aparentemente YouTube ha cambiado la estructura de su p√°gina web y necesito esperar un nuevo lanzamiento.  Por otro lado, necesito una transmisi√≥n de video "en vivo" y no reproducir un archivo del sitio.  Es decir, incluso si el script lua funcionara, no me ayudar√≠a mucho. <br><br>  Pero no encontr√© la transmisi√≥n prometida en absoluto, aunque estaba escrito que: <br><br><blockquote>  Servidor de transmisi√≥n de red (por ejemplo, una estaci√≥n de radio de red o un servidor de video a pedido); <br>  Cliente de transmisi√≥n de red; </blockquote>  Tal vez sea Lista de deseos, o tal vez est√© en la versi√≥n comercial, es dif√≠cil de decir. <br><br>  Pero los archivos se reproducen, repito, sin ninguna queja.  Por ejemplo, puedes crear, aqu√≠ hay tanta indecencia <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6yH53kRyHXk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  La instalaci√≥n del paquete en s√≠ no es dif√≠cil e incluso se describe en detalle, por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Es cierto, de alguna manera prescrib√≠ torpemente las variables de entorno y ahora mi VLC se inicia por primera vez con un retraso de diez segundos, pero luego guarda lo que se necesita en la memoria cach√© y luego en la sesi√≥n actual se inicia sin pausas. <br><br>  Luego, en su proyecto JAVA, prescribe las dependencias necesarias y puede comenzar a <s>remachar reproductores multimedia en las ventanas JAVA</s> para que funcionen. <br><br>  Despu√©s de haber marcado el plan de trabajo aproximado al costado de la computadora personal, regres√© a la fuente de los datos de video, mi tel√©fono inteligente ANDROID. <br><br>  Pero aqu√≠ esperaba otra gran decepci√≥n.  Despu√©s de haber escaneado bastantes sitios e incluso el manual de ANDROID en l√≠nea, descubr√≠ que es imposible organizar la transmisi√≥n en tiempo real utilizando medios regulares.  Como en Caprica, solo puede leer archivos ya grabados.  Es decir, la c√°mara encendida, MEDIA RECORDER comenz√≥ a grabar cuando era necesario detenerla.  Y podemos obtener acceso a los datos (y su transferencia) solo despu√©s de una parada. <br><br>  Encontr√© confirmaci√≥n de mis conclusiones en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> antiguo.  Realmente hubo indicios de que una vez que alguien logr√≥ enga√±ar a Android haci√©ndole creer que estaba escribiendo en un archivo, pero de hecho se desliz√≥ un b√∫fer.  Pero en cualquier caso, como ya se explic√≥ anteriormente, no pude captar esa transmisi√≥n de video en el lado de la PC en la aplicaci√≥n JAVA. <br><br>  Por lo tanto, se tom√≥ una decisi√≥n simple, <u>temporal</u> (quiero destacar): enviar una transmisi√≥n de video de la c√°mara en pedazos durante dos segundos.  No es un rover, por supuesto, pero el rover ya resulta bastante. <br><br>  Una vez que me decid√≠ por esta decisi√≥n, comenc√© a dominar las clases CAMERA y MEDIA RECORDER.  Hay bastantes ejemplos de c√≥digo en la red para iniciar la c√°mara y grabar archivos de video, pero por alguna raz√≥n ninguno de ellos funcion√≥ para m√≠.  Ni en el emulador, ni en un dispositivo real.  Result√≥ que la raz√≥n radica en los permisos, es decir, en los permisos.  Resulta que los ejemplos de c√≥digo se escribieron en aquellos d√≠as en que Android todav√≠a era gratuito y el programador pod√≠a hacer lo que quisiera si escrib√≠a todos los permisos necesarios en el manifiesto.  Pero mi versi√≥n actual de OC no permiti√≥ esto.  Primero, ten√≠a que dar permiso al usuario para escribir el archivo y encender la c√°mara inmediatamente despu√©s de iniciar la aplicaci√≥n.  Esto me cost√≥ actividad extra, es decir, en Actividad. <br><br><div class="spoiler">  <b class="spoiler_title">Clase MainActivity.java</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.Manifest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.PackageManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.Camera; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.MediaRecorder; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.AsyncTask; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v4.app.ActivityCompat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v4.content.ContextCompat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v7.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Toast; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ Camera camera; MediaRecorder mediaRecorder; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MainActivity m; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> Camera_granted; File videoFile; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED) ||(ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) ) <span class="hljs-comment"><span class="hljs-comment">//ask for authorisation { ActivityCompat.requestPermissions(MainActivity.this, new String[]{Manifest.permission.CAMERA,Manifest.permission.WRITE_EXTERNAL_STORAGE}, 50); } if ((ContextCompat.checkSelfPermission(MainActivity.this, Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED)&amp; (ContextCompat.checkSelfPermission(MainActivity.this, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED)) { Toast.makeText(MainActivity.this,"", Toast.LENGTH_SHORT).show();} m=this; MyTask mt = new MyTask(); mt.execute(); } } class MyTask extends AsyncTask&lt;Void, Void, Void&gt; { @Override protected void onPreExecute() { super.onPreExecute(); } @Override protected Void doInBackground(Void... params) { boolean ready = false; while(!ready) { if ((ContextCompat.checkSelfPermission(MainActivity.m, Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED)&amp; (ContextCompat.checkSelfPermission(MainActivity.m, Manifest.permission.WRITE_EXTERNAL_STORAGE) == PackageManager.PERMISSION_GRANTED)) { System.out.println(" "); ready=true; } } return null; } @Override protected void onPostExecute(Void result) { Toast.makeText(MainActivity.m,"", Toast.LENGTH_SHORT).show(); Intent intent=new Intent(MainActivity.m,CameraActivity.class); //   : MainActivity.m.startActivity(intent); } }</span></span></code> </pre> <br></div></div><br>  Despu√©s de eso, las cosas salieron bien y apareci√≥ el siguiente c√≥digo de trabajo.  La segunda actividad de la clase Camera_Activity es responsable de trabajar con la c√°mara y grabar archivos de video.  Http_server clase para reenviar (el nombre, por supuesto, es incorrecto, pero result√≥ hist√≥ricamente).  El c√≥digo es simple, siempre que haya una explicaci√≥n. <br><br><img src="https://habrastorage.org/webt/dv/-z/l1/dv-zl1u_fxzjus5hcacejbzhudc.png"><br><br>  Todo est√° completamente acostado en el Github.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace</a> <br><br><div class="spoiler">  <b class="spoiler_title">C√°mara_Actividad</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.Camera; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.MediaRecorder; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.AsyncTask; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Environment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.annotation.Nullable; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v7.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.SurfaceHolder; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.SurfaceView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.TextView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.BufferedInputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.FileInputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.ServerSocket; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.SensorEvent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.SensorEventListener; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.SensorManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.Sensor; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> android.hardware.Camera.getNumberOfCameras; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.BufferedOutputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.OutputStreamWriter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.PrintWriter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.Socket; <span class="hljs-comment"><span class="hljs-comment">/** * Created by m on 01.02.2019. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CameraActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SensorEventListener</span></span></span><span class="hljs-class"> </span></span>{ SurfaceView surfaceView; TextView mTextView; Button mStart; Button mStop; Camera camera; MediaRecorder mediaRecorder; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ServerSocket ss; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ServerSocket ss2; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MainActivity m; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> stopCamera=<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> File videoFile1; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> File videoFile2; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> File videoFile3; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] data; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SensorManager mSensorManager; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Sensor mAxeleration, mLight,mRotation,mHumidity,mPressure,mTemperature; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ax; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ay; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> az; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> light; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> hum; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> press; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> tempr; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String Sensors; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); mSensorManager = (SensorManager) getSystemService(Context.SENSOR_SERVICE); <span class="hljs-comment"><span class="hljs-comment">//    mAxeleration = mSensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER); //    mSensorManager.registerListener(this, mAxeleration, SensorManager.SENSOR_DELAY_NORMAL); mLight = mSensorManager.getDefaultSensor(Sensor.TYPE_LIGHT); mSensorManager.registerListener(this, mLight, SensorManager.SENSOR_DELAY_NORMAL); mRotation = mSensorManager.getDefaultSensor(Sensor.TYPE_ORIENTATION); mSensorManager.registerListener(this, mRotation, SensorManager.SENSOR_DELAY_NORMAL); mHumidity = mSensorManager.getDefaultSensor(Sensor.TYPE_LINEAR_ACCELERATION); mSensorManager.registerListener(this, mHumidity, SensorManager.SENSOR_DELAY_NORMAL); mPressure = mSensorManager.getDefaultSensor(Sensor.TYPE_PRESSURE); mSensorManager.registerListener(this, mPressure, SensorManager.SENSOR_DELAY_NORMAL); mTemperature = mSensorManager.getDefaultSensor(Sensor.TYPE_AMBIENT_TEMPERATURE); mSensorManager.registerListener(this, mTemperature, SensorManager.SENSOR_DELAY_NORMAL); setContentView(R.layout.camera); // videoFile = new File(Environment.getExternalStorageDirectory() + File.separator+ Environment.DIRECTORY_DCIM + File.separator + "test.3gp"); videoFile1 = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), "test1.3gp"); videoFile2 = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), "test2.3gp"); videoFile3 = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), "test3.3gp"); // videoFile4 = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), "testOUT.3gp"); // File file = new File(Environment.getExternalStorageDirectory(),VIDEO_PATH_NAME);//   // "touch" the file try { videoFile1.createNewFile(); videoFile2.createNewFile(); videoFile3.createNewFile(); } catch (IOException e) { } mStart = (Button) findViewById(R.id.btnStartRecord); mStop = (Button) findViewById(R.id.btnStopRecord); surfaceView = (SurfaceView) findViewById(R.id.surfaceView); mTextView = (TextView) findViewById(R.id.textView); SurfaceHolder holder = surfaceView.getHolder(); holder.addCallback(new SurfaceHolder.Callback() { @Override public void surfaceCreated(SurfaceHolder holder) { try { camera.setPreviewDisplay(holder); camera.startPreview(); } catch (Exception e) { e.printStackTrace(); } } @Override public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) { } @Override public void surfaceDestroyed(SurfaceHolder holder) { } }); mStart.setOnClickListener(new View.OnClickListener() { public void onClick(View v){ System.out.println("  "); //    WriteVideo WV = new WriteVideo(); WV.start(); mStart.setClickable(false); mStop.setClickable(true); Http_server.File_is_sent=true; new ServerCreation().execute();//      } } ); mStop.setOnClickListener(new View.OnClickListener() { public void onClick(View v){ stopCamera = false; // mTextView.setText(" "); releaseMediaRecorder(); releaseCamera(); mStart.setClickable(true); mStop.setClickable(false); System.out.println("  "); Http_server.File_is_sent=true; } } ); } @Override public void onAccuracyChanged(Sensor sensor, int accuracy) { //    } @Override public void onSensorChanged(SensorEvent event) { //   switch (event.sensor.getType()) { case Sensor.TYPE_ACCELEROMETER: ax = (int)(event.values[0] * 9); // + -  az = (int)(event.values[2] * 9);//  +  -  // System.out.println(" = "+ ax + "  = " + az); break; case Sensor.TYPE_LIGHT: light = event.values[0]; // System.out.println(" = "+ light); break; case Sensor.TYPE_ORIENTATION: x = (int)event.values[0]; y = (int)event.values[1]+90; //  +  -  z = (int)event.values[2]; // + -  // System.out.println("x = "+ x + " y = " + y+ " z= "+ z); break; case Sensor.TYPE_LINEAR_ACCELERATION: hum = event.values[2]; int k = (int)(hum*100); hum = - (double)k;//   ,    /2 // System.out.println(hum); break; case Sensor.TYPE_PRESSURE: press = event.values[0]*760/10.1325; int i = (int) press; press = (double)i/100; // System.out.println(press); break; case Sensor.TYPE_AMBIENT_TEMPERATURE: tempr = event.values[0]; System.out.println(tempr); break; } Sensors = " tangaz_1 "+ az+ " kren_1 " + ax + " tangaz_2 "+ y + " kren_2 " + z + " forvard_accel "+ hum + " light " + light+ " "; // System.out.println(Sensors); } @Override protected void onResume() { super.onResume(); releaseCamera(); releaseMediaRecorder(); int t = getNumberOfCameras(); mTextView.setText(""+t); if(camera == null) { camera = Camera.open(); // camera.unlock(); } else{ } } @Override protected void onPause() { super.onPause(); } @Override protected void onStop() { super.onStop(); releaseCamera(); releaseMediaRecorder(); } private boolean prepareVideoRecorder() { if (mediaRecorder==null) {mediaRecorder = new MediaRecorder();} camera.unlock(); mediaRecorder.setCamera(camera); mediaRecorder.setVideoSource(MediaRecorder.VideoSource.CAMERA); switch (count) { case 1: mediaRecorder.setOutputFile(videoFile1.getAbsolutePath()); break; case 2: mediaRecorder.setOutputFile(videoFile2.getAbsolutePath()); break; case 3: mediaRecorder.setOutputFile(videoFile3.getAbsolutePath()); break; } mediaRecorder.setPreviewDisplay(surfaceView.getHolder().getSurface()); mediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.THREE_GPP); //mediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4); mediaRecorder.setVideoSize(640,480); mediaRecorder.setOrientationHint(90);//    ,     mediaRecorder.setVideoFrameRate(30); mediaRecorder.setVideoEncoder(1); try { mediaRecorder.prepare(); } catch (Exception e) { e.printStackTrace(); releaseMediaRecorder(); return false; } return true; } private void releaseMediaRecorder() { if (mediaRecorder != null) { mediaRecorder.release(); mediaRecorder = null; if (camera != null) { // camera.lock();//         } } } public void releaseCamera() { if (camera != null) { // camera.setPreviewCallback(null); // SurfaceView.getHolder().removeCallback(SurfaceView); camera.release(); camera = null; } } private class WriteVideo extends Thread{ public void run () { stopCamera=true; do{ // releaseMediaRecorder(); // releaseCamera(); if(camera == null) { camera = Camera.open(Camera.CameraInfo.CAMERA_FACING_BACK); } System.out.println(""); if (prepareVideoRecorder()) { mediaRecorder.start(); } else { releaseMediaRecorder(); } try { Thread.sleep(2000);//     } catch (Exception e) { } count++; if(count==3){count=1;}// 4 if (mediaRecorder != null) { releaseMediaRecorder(); } System.out.println(""); File f=null; switch (count) { case 1: f = videoFile2;// 3 break; case 2: f = videoFile1;//1 break; case 3: f = videoFile2; break; } try { BufferedInputStream bis = new BufferedInputStream(new FileInputStream(f)); data = new byte[bis.available()]; bis.read(data); bis.close(); }catch (Exception e) { System.out.println(e); } if(Http_server.File_is_sent)//       { System.out.println("  "); new HTTP_Server_Calling().execute(); Http_server.File_is_sent=false; } } while(stopCamera); if (mediaRecorder != null) { System.out.println(""); } } } } class ServerCreation extends AsyncTask&lt;Void, Void, Void&gt; { @Override protected void onPreExecute() { super.onPreExecute(); } @Override protected Void doInBackground(Void... params) { try { CameraActivity.ss = new ServerSocket(40001);//      System.out.println("  "); new Http_server(CameraActivity.ss.accept()); CameraActivity.ss2 = new ServerSocket(40002);//      }catch (Exception e) { System.out.println(e); System.out.println("   "); } new HTTP_Server_Calling2().start(); return null; } @Override protected void onPostExecute(Void result) { } } class HTTP_Server_Calling extends AsyncTask&lt;Void, Void, Void&gt; { @Override protected void onPreExecute() { super.onPreExecute(); } @Override protected Void doInBackground(Void... params) { try { new Http_server(CameraActivity.ss.accept()); } catch (Exception e) { System.out.println(e); } return null; } @Override protected void onPostExecute(Void result) { } } class HTTP_Server_Calling2 extends Thread//           { public void run() { while (CameraActivity.stopCamera) { try { Thread.sleep(500);//      new Http_server_Sensors(CameraActivity.ss2.accept()); } catch (Exception e) { System.out.println(e); } } } } class Http_server extends Thread { public Socket socket; public static volatile boolean File_is_sent=true; Http_server(Socket s) { System.out.println("  "); socket = s; setPriority(MAX_PRIORITY); start(); } public void run() { try { System.out.println("    "); BufferedOutputStream bos = new BufferedOutputStream((socket.getOutputStream())); bos.write(CameraActivity.data); bos.flush(); bos.close(); socket.close(); } catch (Exception e) { System.out.println(e); } File_is_sent = true; } } public class Http_server_Sensors extends Thread { public Socket socket; PrintWriter pw; Http_server_Sensors(Socket s) { socket = s; setPriority(MAX_PRIORITY); start(); } public void run() { try { pw = new PrintWriter(new OutputStreamWriter(socket.getOutputStream()), true);//    System.out.println(CameraActivity.Sensors); pw.println(CameraActivity.Sensors);//  pw.flush(); pw.close(); socket.close(); } catch (Exception e) { System.out.println(e); } } }</span></span></code> </pre><br></div></div><br><br>  La esencia del programa despu√©s de iniciar y encender la c√°mara es la siguiente: <br>  escribe un video por dos segundos en el primer archivo, <br>  escribimos el video durante dos segundos en el segundo archivo y, mientras tanto, enviamos el primer archivo a trav√©s de TCP-IP a trav√©s de la conexi√≥n WI-FI local a la computadora, <br>  vuelva a escribir el primer archivo y, mientras tanto, env√≠e el segundo, <br>  Y as√≠ sucesivamente. <br><br>  Luego, el ciclo se repite hasta que se presiona el bot√≥n "detener" o la bater√≠a del tel√©fono inteligente se agota.  En principio, es posible implementar un an√°logo de presionar botones, usando comandos de una computadora, tambi√©n a trav√©s de TCP, esto no es dif√≠cil. <br><br>  Al principio, el b√∫fer de video, por si acaso, consist√≠a en tres archivos de formato 3GP (escribimos el primero, enviamos el tercero, escribimos el segundo, enviamos el primero, escribimos el tercero, enviamos el segundo), pero luego result√≥ que los dos archivos son bastante suficientes (grabaci√≥n y env√≠o mutuo) no interferir). <br><br>  Con una resoluci√≥n de c√°mara de 640 por 480, los archivos se obtienen en alg√∫n lugar alrededor de 200-300 kB, lo cual es bastante dif√≠cil para mi enrutador.  Todav√≠a no me molest√© con el sonido, pero todo parece ser simple all√≠: instalas los codificadores de audio, las tasas de bits, la cantidad de canales y dem√°s. <br><br>  Un poco m√°s tarde, cuando depur√© la transferencia de video, complet√© el c√≥digo tambi√©n transmitiendo informaci√≥n desde los sensores del tel√©fono inteligente.  Todo se transmite trivialmente en una l√≠nea, pero no pude transferirlo a trav√©s del mismo socket que el video.  Aparentemente, las clases para transmitir una cadena PrintWriter y transmitir datos binarios BufferedOutputStream usan diferentes flujos, pero luego tienen un b√∫fer de salida, donde se acoplan con √©xito.  Como resultado, el video comienza a fallar y desmoronarse.  Adem√°s, el archivo de video se transmite una vez cada dos segundos, y para los sensores este intervalo es demasiado grande.  Por lo tanto, se decidi√≥ distribuirlos en diferentes enchufes para que no interfieran entre s√≠.  Por esta raz√≥n, ha aparecido una nueva clase Http_server_Sensors. <br><br>  Entonces, organizamos el despacho, ahora nuevamente volveremos al lado oscuro de recepci√≥n. <br><br>  Como ya hemos visto desde el primer ejemplo, reproducir archivos de video en una aplicaci√≥n JAVA usando un reproductor VLC ahora no plantea problemas.  Lo principal es obtener estos archivos. <br><br>  El siguiente programa de demostraci√≥n es responsable de esto. <br><br><div class="spoiler">  <b class="spoiler_title">Reproductor de video</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.awt.BorderLayout; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.awt.event.ActionEvent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.awt.event.ActionListener; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.awt.event.WindowAdapter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.awt.event.WindowEvent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.swing.JButton; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.swing.JFrame; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.swing.JOptionPane; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.swing.JPanel; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.swing.SwingUtilities; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uk.co.caprica.vlcj.component.EmbeddedMediaPlayerComponent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uk.co.caprica.vlcj.discovery.NativeDiscovery; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uk.co.caprica.vlcj.player.MediaPlayer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uk.co.caprica.vlcj.player.MediaPlayerEventAdapter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.Socket; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VideoPlayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> JFrame frame; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> EmbeddedMediaPlayerComponent mediaPlayerComponent; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> JButton pauseButton; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> JButton rewindButton; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> JButton skipButton; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String mr1, mr2; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> playing_finished = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> File_1_play_starting = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> File_1_play_finished = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> File_2_play_starting = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> File_2_play_finished = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//192.168.1.128 public static void main(final String[] args) { new NativeDiscovery().discover(); mr1 = "D:\\test1.3gp"; mr2 = "D:\\test2.3gp"; SwingUtilities.invokeLater(new Runnable() { @Override public void run() { VideoPlayer vp = new VideoPlayer(); vp.mediaPlayerComponent.getMediaPlayer().setPlaySubItems(true); VideoPlayer.playing_finished=false; new Control().start();//   // while (!Http_client.File_ready) { // System.out.println(""); try { Thread.sleep(100); } catch (Exception e) { } } // while (true) { playing_finished = false; } // System.out.println("  1"); } }); } public VideoPlayer() { frame = new JFrame("My First Media Player"); frame.setBounds(100, 100, 600, 400); frame.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE); frame.addWindowListener(new WindowAdapter() { @Override public void windowClosing(WindowEvent e) { System.out.println(e); mediaPlayerComponent.release(); System.exit(0); } }); JPanel contentPane = new JPanel(); contentPane.setLayout(new BorderLayout()); mediaPlayerComponent = new EmbeddedMediaPlayerComponent(); contentPane.add(mediaPlayerComponent, BorderLayout.CENTER); frame.setContentPane(contentPane); JPanel controlsPane = new JPanel(); pauseButton = new JButton("Pause"); controlsPane.add(pauseButton); rewindButton = new JButton("Rewind"); controlsPane.add(rewindButton); skipButton = new JButton("Skip"); controlsPane.add(skipButton); contentPane.add(controlsPane, BorderLayout.SOUTH); pauseButton.addActionListener(new ActionListener() { @Override public void actionPerformed(ActionEvent e) { mediaPlayerComponent.getMediaPlayer().pause(); } }); rewindButton.addActionListener(new ActionListener() { @Override public void actionPerformed(ActionEvent e) { mediaPlayerComponent.getMediaPlayer().skip(-10000); } }); skipButton.addActionListener(new ActionListener() { @Override public void actionPerformed(ActionEvent e) { mediaPlayerComponent.getMediaPlayer().skip(10000); } }); mediaPlayerComponent.getMediaPlayer().addMediaPlayerEventListener(new MediaPlayerEventAdapter() { @Override public void playing(MediaPlayer mediaPlayer) { SwingUtilities.invokeLater(new Runnable() { @Override public void run() { frame.setTitle(String.format( "My First Media Player - %s", mediaPlayerComponent.getMediaPlayer() )); } }); } @Override public void finished(MediaPlayer mediaPlayer) { SwingUtilities.invokeLater(new Runnable() { @Override public void run() { playing_finished = true; System.out.println("finished " + playing_finished); //closeWindow(); } }); } @Override public void error(MediaPlayer mediaPlayer) { SwingUtilities.invokeLater(new Runnable() { @Override public void run() { JOptionPane.showMessageDialog( frame, "Failed to play media", "Error", JOptionPane.ERROR_MESSAGE ); closeWindow(); } }); } }); frame.setVisible(true); //mediaPlayerComponent.getMediaPlayer(); } public void start(String mrl) { mediaPlayerComponent.getMediaPlayer().setPlaySubItems(true); mediaPlayerComponent.getMediaPlayer().prepareMedia(mrl); //mediaPlayerComponent.getMediaPlayer().parseMedia(); mediaPlayerComponent.getMediaPlayer().playMedia(mrl); // mediaPlayerComponent. } public void closeWindow() { frame.dispatchEvent(new WindowEvent(frame, WindowEvent.WINDOW_CLOSING)); } } class PlayFile { public static void run(int number) { if (number==1) { VideoPlayer.mediaPlayerComponent.getMediaPlayer().prepareMedia(VideoPlayer.mr1); System.out.println("  1"); VideoPlayer.mediaPlayerComponent.getMediaPlayer().start(); VideoPlayer.mediaPlayerComponent.getMediaPlayer().playMedia(VideoPlayer.mr1); VideoPlayer.File_1_play_starting = true; VideoPlayer.File_1_play_finished = false; while (!VideoPlayer.playing_finished) {//      try { Thread.sleep(1); } catch (Exception e) { } } VideoPlayer.mediaPlayerComponent.getMediaPlayer().stop(); VideoPlayer.playing_finished = false; VideoPlayer.File_1_play_starting = false; VideoPlayer.File_1_play_finished = true; } { try { Thread.sleep(10); } catch (Exception e) { } } if (number==2) { VideoPlayer.mediaPlayerComponent.getMediaPlayer().prepareMedia(VideoPlayer.mr2); System.out.println("  2"); VideoPlayer.mediaPlayerComponent.getMediaPlayer().start(); VideoPlayer.mediaPlayerComponent.getMediaPlayer().playMedia(VideoPlayer.mr2); VideoPlayer.File_2_play_starting = true; VideoPlayer.File_2_play_finished = false; while (!VideoPlayer.playing_finished) { try { Thread.sleep(1); } catch (Exception e) { } } VideoPlayer.mediaPlayerComponent.getMediaPlayer().stop(); VideoPlayer.playing_finished = false; VideoPlayer.File_2_play_starting = false; VideoPlayer.File_2_play_finished = true; } { try { Thread.sleep(10); } catch (Exception e) { } } } } public class Control extends Thread{ public static boolean P_for_play_1=false; public static boolean P_for_play_2=false; public void run() { // new Http_client(1).start(); while (!Http_client.File1_reception_complete) { try { Thread.sleep(1); } catch (Exception e) { } } while (true) { new Http_client(2).start(); PlayFile.run(1); while (!VideoPlayer.File_1_play_finished) { try { Thread.sleep(1); } catch (Exception e) { } } while (!Http_client.File2_reception_complete) { try { Thread.sleep(1); } catch (Exception e) { } } new Http_client(1).start(); PlayFile.run(2); while (!VideoPlayer.File_2_play_finished) { try { Thread.sleep(1); } catch (Exception e) { } } while (!Http_client.File1_reception_complete) { try { Thread.sleep(1); } catch (Exception e) { } } //PlayFile.run(1); } } } public class Http_client extends Thread { public static boolean File1_starts_writing=false; public static boolean File1_reception_complete=false; public static boolean File2_starts_writing=false; public static boolean File2_reception_complete=false; public int Number; public BufferedOutputStream bos; Http_client(int Number) { this.Number = Number; } public void run(){ try { Socket socket= new Socket("192.168.1.128", 40001); // System.out.println(" "); // PrintWriter pw = new PrintWriter(new OutputStreamWriter(socket.getOutputStream()), true); // pw.println("ready");// Greetings with CLIENT // System.out.println(" "); BufferedInputStream bis = new BufferedInputStream(socket.getInputStream()); if (Number ==1) { File1_starts_writing=true; File1_reception_complete=false; System.out.println("  1,    2"); bos = new BufferedOutputStream(new FileOutputStream(VideoPlayer.mr1)); byte[] buffer = new byte[32768]; while (true) { //     int readBytesCount = bis.read(buffer); if (readBytesCount == -1) { //   break; } if (readBytesCount &gt; 0) { //    - ,   bos.write(buffer, 0, readBytesCount); } } System.out.println(" "); System.out.println(" "); bos.flush(); bos.close(); File1_starts_writing=false; File1_reception_complete=true; } if (Number==2) { File2_starts_writing=true; File2_reception_complete=false; System.out.println("  2,    1"); bos = new BufferedOutputStream(new FileOutputStream(VideoPlayer.mr2)); byte[] buffer = new byte[32768]; while (true) { //     int readBytesCount = bis.read(buffer); if (readBytesCount == -1) { //   break; } if (readBytesCount &gt; 0) { //    - ,   bos.write(buffer, 0, readBytesCount); } } System.out.println(" "); System.out.println(" "); bos.flush(); bos.close(); File2_starts_writing=false; File2_reception_complete=true; } socket.close(); // pw.close(); bis.close(); } catch(Exception e){ System.out.println(e); System.out.println("gfgfg"); } try { Thread.sleep(10); } catch (Exception e) { } } }</span></span></code> </pre></div></div><br><br>  Su esencia es simple.  Se inicia un cliente TCP, que comienza a esperar a que el servidor est√© listo en el tel√©fono inteligente.  Una vez recibido el primer archivo, comienza a reproducirse de inmediato y se espera que el archivo n√∫mero dos en paralelo.  Adem√°s, se espera el final de la recepci√≥n del segundo archivo o el final de la reproducci√≥n del primero.  Lo mejor de todo, por supuesto, <s>tres estrellas</s> , cuando el archivo se descarga m√°s r√°pido de lo que se reproduce.  Si perdi√≥ el primer archivo, pero a√∫n no ha recibido el segundo, entonces todo est√° esperando ... Mostraremos una pantalla en negro.  De lo contrario, comience a reproducir r√°pidamente el segundo archivo y descargue simult√°neamente el primero nuevamente. <br>  Ten√≠a una vaga esperanza de que la pausa entre cambiar archivos de reproducci√≥n ser√≠a menor que el tiempo de reacci√≥n del ojo humano, pero no se materializ√≥.  Sin prisa, por supuesto, este VLC. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/BaY3gD6RBdU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Como resultado, obtenemos una especie de vil video discontinuo (el primer trilobite, aparentemente, vio el mundo as√≠), donde la nitidez todav√≠a se ajusta constantemente.  Y debemos tener en cuenta que el video tambi√©n llega tarde por dos segundos.  En resumen, en producci√≥n no recomiendo difundirlo.  Pero me falta pescado y trilobites, como dicen ... <br><br>  Resumiendo lo anterior, podemos decir absolutamente que: <br><br>  El env√≠o de video por partes es esencialmente inoperativo y solo puede ser √∫til en casos donde el video es lo suficientemente largo y no necesita una segunda reacci√≥n a lo que est√° sucediendo. <br><br>  La transmisi√≥n de video a trav√©s de TCP-IP tambi√©n es una idea incorrecta, independientemente de lo que digan algunas personalidades de Habr sobre la velocidad de transferencia de datos utilizando este protocolo (que supuestamente es incluso m√°s r√°pido que UDP).  Por supuesto, las intranets inal√°mbricas modernas tienen buenas caracter√≠sticas para garantizar el apret√≥n de manos continuo de los servidores y clientes TCP, y el propio TCP parece haber sido actualizado para datos largos, pero los enchufes entre la reproducci√≥n de videos aparecen peri√≥dicamente en la demostraci√≥n. <br><br>  Pero, al menos para el futuro, aparecieron los siguientes pensamientos: <br><br><ol><li>  env√≠e cuadro por cuadro (no video, sino fotos) a trav√©s de UDP, pero controle la informaci√≥n a trav√©s de TCP, </li><li>  maneje marcos de fotos a trav√©s de UDP pero con se√±ales de sincronizaci√≥n en el mismo canal. </li></ol><br>  Por supuesto, hasta ahora hay m√°s preguntas que respuestas.  ¬øHay suficiente velocidad de recepci√≥n en JAVA con su nivel de abstracci√≥n al trabajar con la red y las im√°genes?  ¬øEs posible hacer 30 disparos normales por segundo en el nivel accesible para m√≠ en Android?  ¬øTendr√© que cosecharlos antes de enviarlos para reducir la tasa de bits?  ¬øY entonces JAVA es suficiente para empacar y desempacar?  Y si, de repente, algo funciona, ¬øser√° posible pasar por el siguiente paso, atornillar el sistema de visi√≥n por computadora JAVA OpenCV aqu√≠?  √âl mismo, por supuesto, siempre es interesante ver la transmisi√≥n de video desde el nivel del piso, pero no debemos olvidar el objetivo m√°s alto: ¬°un robot rob√≥tico con la inteligencia de una hormiga! <br><br>  Pero, mientras tengamos lo que tenemos, volveremos al carrito actual.  El antiguo programa del art√≠culo anterior para el microcontrolador AVR en la plataforma Arduino no ha cambiado mucho, solo se ha agregado la opci√≥n de ramificaci√≥n: conducci√≥n aut√≥noma o controlada por el operador.  Los datos que el carro (m√©dula espinal) transmite a trav√©s de WIFI son los mismos: la distancia recorrida.  Un poco m√°s tarde, tambi√©n adjunt√© la transferencia de temperatura de un elemento cr√≠tico: el controlador del motor.  Todo esto es transmitido y recibido primero por UART, y ya al ingresar a la red a trav√©s de UDP.  No doy el c√≥digo, todo el an√°lisis completo en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> antes del √∫ltimo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">.</a> <br><br><img src="https://habrastorage.org/webt/zh/gb/vz/zhgbvzhttcqg7o_la1sabrmw2gy.png"><br><br>  Para dos motores, el (controlador) sigue siendo m√°s o menos suficiente, pero con cuatro despu√©s de un tiempo se sobrecalienta a un estado inoperativo.  Al principio intent√© usar los sensores de temperatura anal√≥gicos m√°s simples basados ‚Äã‚Äãen diodos zener, como el LM335, pero no sali√≥ nada.  No ten√≠a una fuente de voltaje de referencia, para abreviar, ION.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y coger milivoltios con poca bater√≠a no tiene sentido. Por cierto, sobre la bater√≠a: cuando estaba cansado de retirar y volver a colocar constantemente las bater√≠as de litio 14500 para recargar, simplemente tom√© una bater√≠a de repuesto de un destornillador y el carro comenz√≥ a conducir continuamente durante una hora y media, adem√°s ten√≠a un aspecto y peso amenazantes (s√≠, est√° en esta bater√≠a "Ojos"). Por lo tanto, para medir la temperatura, instal√© un giroscopio-aceler√≥metro defectuoso basado en el L3G4200D. Afortunadamente, tambi√©n midi√≥ la temperatura y la transmiti√≥ a trav√©s del bus I2C.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un tel√©fono inteligente sentado detr√°s de la bater√≠a y sobre el sonar-sonar transmite una transmisi√≥n de video, lecturas del aceler√≥metro (puede usarlo para inclinar el carrito y inclinarlo cuando est√° parado), rodar y inclinarse en grados en la din√°mica ya calculada por el tel√©fono inteligente (una opci√≥n muy conveniente) , aceleraci√≥n lineal en la direcci√≥n de desplazamiento, iluminaci√≥n. En general, por supuesto, puede transferir todo lo que su tel√©fono inteligente puede medir desde la presi√≥n del aire hacia el norte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como resultado, la aplicaci√≥n en JAVA adquiri√≥ la siguiente forma: </font></font><br><br><img src="https://habrastorage.org/webt/do/6y/oe/do6yoema_7rnzm9z38yfijhzv14.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo curioso es que realmente parece un panel de control de un veh√≠culo lunar sovi√©tico, solo que tengo una pantalla de TV en el costado y la tienen en el centro.</font></font><br><br><img src="https://habrastorage.org/webt/hw/ql/tu/hwqltuwvxsplpvdat2pcokifzye.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando lo encienda, primero con√©ctese al carro y al tel√©fono inteligente, seleccione el modo de control manual o la autonom√≠a total, ¬°y listo! Hasta que la ventana de temperatura del conductor se vuelva amarilla y luego se vuelva roja. Gr√°ficos! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algo as√≠ se ve en vivo.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AaMWKKeBff8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No traigo el programa aqu√≠, porque como de costumbre, la construcci√≥n de ventanas ocupa el 95% del c√≥digo. </font><font style="vertical-align: inherit;">Se puede encontrar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠. </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el futuro, el cerebro (tel√©fono inteligente) deber√≠a aprender a transferir videos normales (y no lo que es ahora) a una computadora, donde deber√≠a ser reconocido de alguna manera (mientras el objetivo es construir un mapa de la habitaci√≥n a nivel del piso y determinar su ubicaci√≥n). </font><font style="vertical-align: inherit;">Bueno, y ya bajo el comunismo, me gustar√≠a portarlo de vuelta a mi tel√©fono inteligente para que no necesite una computadora. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si al menos algo funciona, definitivamente lo publicar√©.</font></font> Gracias por su atencion </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448516/">https://habr.com/ru/post/448516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448498/index.html">"Rusia 404": ¬øCu√°nto Internet libre queda para vivir?</a></li>
<li><a href="../448500/index.html">Resolviendo un Crackme simple para Sega Mega Drive</a></li>
<li><a href="../448504/index.html">Recogieron para todos "Habrom" el libro de referencia "Por qui√©n fue emitido ..." para pasaportes. Descargar a la salud</a></li>
<li><a href="../448506/index.html">The Matrix tiene 20 a√±os: c√≥mo Wachowski hizo cyberpunk, lo que determin√≥ la agenda de toda una generaci√≥n</a></li>
<li><a href="../448510/index.html">Acer en 2019: ¬øy si eliminas todas las moscas de las computadoras port√°tiles para juegos?</a></li>
<li><a href="../448518/index.html">¬øC√≥mo ver un agujero negro?</a></li>
<li><a href="../448522/index.html">Generaci√≥n de configuraci√≥n para nginx, historial de una solicitud de extracci√≥n</a></li>
<li><a href="../448524/index.html">Cient√≠ficos israel√≠es por primera vez en el mundo imprimieron un coraz√≥n vivo</a></li>
<li><a href="../448528/index.html">Servicio gratuito de Wireguard VPN en AWS</a></li>
<li><a href="../448530/index.html">C√≥mo dorm√≠a Megaphone en suscripciones m√≥viles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>