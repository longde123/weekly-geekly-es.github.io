<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👎🏿 🔖 🍦 Rekko Challenge: cómo ocupar el segundo lugar en la competencia para la creación de sistemas de recomendación 🛬 📝 👪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos Mi equipo en Tinkoff está construyendo sistemas de recomendación. Si está satisfecho con su reembolso mensual, entonces este es nuestro n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Rekko Challenge: cómo ocupar el segundo lugar en la competencia para la creación de sistemas de recomendación</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/454818/"><p>  Hola a todos  Mi equipo en Tinkoff está construyendo sistemas de recomendación.  Si está satisfecho con su reembolso mensual, entonces este es nuestro negocio.  También creamos un sistema de recomendación de ofertas especiales de socios y participamos en colecciones individuales de Historias en la aplicación Tinkoff.  Y nos encanta participar en concursos de aprendizaje automático para mantenernos en buena forma. </p><br><p>  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Boosters.pro</a> durante dos meses, del 18 de febrero al 18 de abril, se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">realizó</a> un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">concurso</a> para construir un sistema de recomendación sobre datos reales de uno de los cines en línea más grandes de Rusia, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Okko</a> .  Los organizadores tenían como objetivo mejorar el sistema de recomendación existente.  Por el momento, la competencia está <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">disponible en modo sandbox</a> , en el que puede probar sus enfoques y perfeccionar sus habilidades en la construcción de sistemas de recomendación. </p><br><p><img src="https://habrastorage.org/webt/lv/1c/rj/lv1crjkiorbmthzwkmprnoqdusa.png" alt="alt_text"></p><a name="habracut"></a><br><h1 id="opisanie-dannyh">  Descripción de datos </h1><br><p>  El acceso al contenido en Okko se realiza a través de la aplicación en el televisor o teléfono inteligente, o mediante la interfaz web.  El contenido se puede alquilar®, comprar (P) o ver por suscripción (S).  El organizador de la competencia proporcionó datos sobre las vistas durante N días (N&gt; 60), además, la información sobre las calificaciones y los marcadores agregados estaba disponible.  Vale la pena tener en cuenta un detalle importante, si el usuario vio una película varias veces o varios episodios de la serie, solo se registrará en la tableta la fecha de la última transacción y el tiempo total empleado por unidad de contenido. </p><br><p><img src="https://habrastorage.org/webt/qy/w5/2z/qyw52zw89wafhju80zo73p3uxya.png" alt="alt_text"></p><br><p>  Se proporcionaron alrededor de 10 millones de transacciones, 450 mil calificaciones y 950 mil marcadores para 500 mil usuarios. </p><br><p><img src="https://habrastorage.org/webt/nz/g6/_g/nzg6_gexjoxdvmsng8lkjcm9_m8.png" alt="alt_text"></p><br><p>  La muestra contiene no solo usuarios activos, sino también usuarios que han visto un par de películas durante todo el período. </p><br><p> El catálogo de Okko contiene tres tipos de contenido: películas (películas), series (series) y películas en serie (película multiparte), un total de 10.200 objetos.  Para cada objeto, estaba disponible un conjunto de atributos y atributos anónimos (característica_1, ..., característica_5), disponibilidad de suscripción, alquiler o compra y duración. </p><br><p><img src="https://habrastorage.org/webt/ww/z3/wj/wwz3wjub5-tgvdrpjkinmi8ojgg.png" alt="alt_text"></p><br><h1 id="celevaya-peremennaya-i-metrika">  Variable objetivo y métrica </h1><br><p>  La tarea requería predecir una gran cantidad de contenido que el usuario consumiría en los próximos 60 días.  Se cree que un usuario consumirá contenido si él: </p><br><ul><li>  Cómpralo o alquilalo </li><li>  Mira más de la mitad de la película por suscripción </li><li>  Mire más de un tercio de la serie por suscripción </li></ul><br><p><img src="https://habrastorage.org/webt/hs/62/an/hs62anr4vai9g-7aivjqq8gfjek.png" alt="alt_text"></p><br><ul><li>  <strong>r_u (i)</strong> : si el usuario u consumió el contenido predicho para él en el lugar i (1 o 0) </li><li>  <strong>n_u</strong> : la cantidad de elementos que el usuario consumió durante el período de prueba </li><li>  <strong>U</strong> : muchos usuarios de prueba </li></ul><br><p>  Puede obtener más información sobre las métricas para la tarea de clasificación en esta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicación</a> . </p><br><p>  La mayoría de los usuarios ven películas hasta el final, por lo que la proporción de la clase positiva en las transacciones es del 65%.  La calidad del algoritmo se evaluó utilizando un subconjunto de 50 mil usuarios de la muestra presentada. </p><br><h1 id="agregirovannyy-reyting">  Calificación agregada </h1><br><p>  La decisión de la competencia comenzó con la agregación de todas las interacciones de los usuarios con el contenido en una sola escala de calificación.  Se suponía que si el usuario compraba el contenido, esto significaba el máximo interés.  La película es más corta que la serie, por lo tanto, para ver la serie en su conjunto, debe dar más puntos.  Como resultado, la calificación agregada se formó de acuerdo con las siguientes reglas: </p><br><ul><li>  Compartir película * 5 </li><li>  Programa de TV Compartir * 10 </li><li>  [Marcando la película] * 0.5 </li><li>  [Marcando la serie] * 1.5 </li><li>  [Compra / alquiler de contenido] * 15 </li><li>  Calificación + 2 </li></ul><br><h1 id="model-pervogo-urovnya">  Modelo de primer nivel </h1><br><p>  Los organizadores proporcionaron una solución básica basada en el filtrado colaborativo con escalas Tf-IDF.  Al agregar todo tipo de interacciones a la calificación agregada, aumentar el número de vecinos más cercanos de 20 a 150 y reemplazar Tf-IDF con pesos BM25 eliminó aproximadamente <strong>0.03</strong> en LB (Tabla de líderes). </p><br><p>  Inspirado por la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicación del equipo que ocupó el tercer lugar en el RecSys Challenge 2018</a> , elegí el modelo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LightFM</a> con pérdida <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">WARP</a> como el segundo modelo base.  LightFM con hiperparámetros seleccionados: learning_rate, no_components, item_alpha, user_alpha, max_sampled dio <strong>0.033</strong> en LB. </p><br><p><img src="https://habrastorage.org/webt/le/km/ak/lekmakeznlccijkuu24mnvqlcsm.png" alt="alt_text"></p><br><p>  La validación del modelo se realizó a tiempo: el primer 80% de las interacciones cayeron en el tren, el 20% restante en la validación.  Para una presentación sobre LB, se entrenó un modelo en todo el conjunto de datos con parámetros seleccionados para la validación. </p><br><h1 id="blending-modeley">  Mezcla de modelos </h1><br><p>  En la etapa anterior, resultó construir dos líneas de base sólidas, además, sus recomendaciones se cruzaron en promedio para el 60 por ciento del contenido recomendado.  Si hay dos modelos fuertes y al mismo tiempo débilmente correlacionados, entonces su combinación es un paso razonable. </p><br><p><img src="https://habrastorage.org/webt/2-/5x/ya/2-5xyaedg2u-tqzbjr80v-49j38.png" alt="alt_text"></p><br><p>  En este caso, los puntajes del modelo pertenecen a diferentes distribuciones y tienen diferentes escalas, por lo que se decidió utilizar la suma de los rangos para combinar los dos modelos.  La combinación de modelos produjo <strong>0.0347</strong> en LB. </p><br><p><img src="https://habrastorage.org/webt/b4/8e/m4/b48em4d9um22gvkdttdp8i-heco.png" alt="alt_text"></p><br><h1 id="model-vtorogo-urovnya">  Modelo de segundo nivel </h1><br><p>  Los sistemas de recomendación a menudo usan un enfoque de dos niveles para construir modelos: primero, los candidatos principales se seleccionan mediante un modelo simple de primer nivel, luego el superior seleccionado se vuelve a clasificar por un modelo más complejo con la adición de una gran cantidad de características. </p><br><p><img src="https://habrastorage.org/webt/e5/ll/db/e5lldbt4k4ncxq5uiqbk61l8doc.png" alt="alt_text"></p><br><p>  El conjunto de datos se dividió en el tiempo en las partes de capacitación y validación.  Se recopiló una selección de recomendaciones para la parte de validación para cada usuario, que consiste en combinar las predicciones top200 de modelos de primer nivel con la excepción de las películas ya vistas.  Además, se requería enseñar al modelo a reorganizar la parte superior resultante para cada usuario.  El problema fue formulado en términos de clasificación binaria.  Un par (usuario, contenido) pertenecía a la clase positiva solo si el usuario consumió el contenido durante el período de validación.  Como modelo de segundo nivel, se utilizó el aumento de gradiente, es decir, el paquete LightGBM. </p><br><h2 id="priznaki">  Signos </h2><br><p>  Los modelos de primer nivel para pares (usuario, contenido) evalúan la relevancia en forma de velocidad, clasificando en orden decreciente para obtener un rango.  El modelo entrenado en los signos de rango y velocidad, junto con los signos del catálogo de contenido, noqueó <strong>0.0359</strong> en LB. </p><br><p>  A partir de la forma de distribución de la primera de las características anónimas, se concluyó que es la fecha en que apareció la película en el catálogo, por lo tanto, el modelo fue fuertemente reentrenado para esta característica con el esquema de validación seleccionado.  La eliminación de una característica de la muestra dio un aumento en LB a <strong>0.0367</strong> </p><br><p>  El modelo LightFM, además de predecir la relevancia del contenido para el usuario, devuelve dos vectores: sesgo del elemento y sesgo del usuario, que se correlacionan con el grado de popularidad del contenido y el número de películas vistas por el usuario, respectivamente.  Agregar signos aumentó la velocidad en LB a <strong>0.0388</strong> . </p><br><p>  Puede asignar un rango para un par (usuario, contenido) antes o después de eliminar películas ya vistas.  Los cambios en el método a este último proporcionaron un aumento en LB a <strong>0.0395</strong> . </p><br><p><img src="https://habrastorage.org/webt/dm/ux/h_/dmuxh_6p9obkaumaeimtritdre0.png" alt="alt_text"></p><br><p>  Casi nadie vio una parte significativa del catálogo de películas.  El contenido que vieron menos de 100 usuarios se eliminó de la muestra para capacitar a un modelo de segundo nivel, lo que redujo el catálogo a la mitad.  La eliminación de contenido impopular hizo que la selección de los modelos de primer nivel fuera más relevante y solo después de eso el vector de usuarios de LightFM mejoró la velocidad de validación y aumentó LB a <strong>0.0429</strong> . </p><br><p>  Además, se agregó una señal: el usuario agregó el marcador al libro, pero no miró el período del tren, lo que aumentó la velocidad en LB a <strong>0.0447</strong> .  Además, se agregaron signos sobre la fecha de la primera y última transacción, aumentaron la <strong>velocidad</strong> a <strong>0.0457</strong> en LB. </p><br><p><img src="https://habrastorage.org/webt/jy/4_/0v/jy4_0vcyt5ndutilvgqmbcivlkq.png" alt="alt_text"></p><br><p>  Consideraremos este modelo final.  Los más significativos fueron los signos de los modelos de primer nivel y los signos anónimos del catálogo de contenido. </p><br><p>  Las siguientes características no aumentaron al modelo final: </p><br><ul><li>  cantidad de marcadores + parte del contenido visto de los marcadores - <strong>0.0453</strong> LB </li><li>  la cantidad de películas compradas <strong>0.0451</strong> LB </li></ul><br><p>  Pero cuando se mezclaron con el modelo final, noquearon <strong>0.0465</strong> en LB.  Inspirados por el resultado de la mezcla, los siguientes modelos fueron entrenados por separado: </p><br><ul><li>  con diferentes fracciones de la muestra de entrenamiento para el modelo de primer nivel.  La división del 90% / 10% dio un aumento, en contraste con la división del 95% / 5% y 70% / 30%. </li><li>  con un método de agregación de calificación modificado. </li><li>  con la adición de películas impopulares al conjunto de entrenamiento para un modelo de segundo nivel.  Para cada unidad de contenido, se compiló una compilación de 1000 usuarios. </li></ul><br><p>  La combinación final de 6 modelos permitió alcanzar <strong>0.0469678</strong> en LB, que correspondía al quinto lugar. </p><br><p><img src="https://habrastorage.org/webt/zu/tk/zm/zutkzmaxdgaatxyk5qddhdo5dda.png" alt="alt_text"></p><br><p>  En la parte privada, ocurrió una sacudida, que arrojó la solución al segundo lugar.  Creo que la solución resultó ser sostenible gracias a la combinación de una gran cantidad de modelos. </p><br><p><img src="https://habrastorage.org/webt/rm/qo/8q/rmqo8ql3pgwas205pr5peg49hoy.png" alt="alt_text"></p><br><h1 id="ne-zashlo">  No ingresado </h1><br><p>  En el proceso de resolver la competencia, se generaron muchos signos que parecían entrar definitivamente, pero lamentablemente.  Señales y enfoques de mayor confianza: </p><br><ul><li>  Atributos de contenido anónimo.  No se sabía con certeza qué contenían, pero todos los participantes en el concurso creían que contenían información sobre actores, directores, compositores ... En mi decisión, traté de agregarlos en varios formatos: los más populares como caracteres binarios, trazaron la matriz de contenido atributos usando LightFM y BigARTM, y luego extraiga los vectores y agréguelos al modelo de segundo nivel. </li><li>  Vectores de contenido del modelo LigthFM en el modelo de segundo nivel. </li><li>  Atributos de los dispositivos desde los cuales el usuario vio el contenido. </li><li>  Bajar el peso del contenido popular para un modelo de segundo nivel. </li><li>  La proporción de películas / programas de televisión en relación con el número total de contenido visto. </li><li>  Clasificación de métricas de CatBoost. </li></ul><br><h1 id="interesnye-fakty-o-sorevnovanii">  Datos interesantes sobre la competencia. </h1><br><ul><li>  La solución Top1 resultó ser peor que el modelo de producto okko 0.048 vs 0.062.  Debe tenerse en cuenta que el modelo del producto ya se lanzó al momento del muestreo. </li><li>  Aproximadamente una semana después del comienzo de la competencia, se modificó el conjunto de datos, para aquellos que participaron desde el principio agregaron 30 presentaciones, que se quemaron inesperadamente después de que los equipos se fusionaron. </li><li>  La validación no siempre se correlacionó con LB, lo que indicaba una posible sacudida. </li></ul><br><h1 id="kod-resheniya">  Código de decisión </h1><br><p>  La solución está disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> en forma de dos computadoras portátiles jupyter: agregación de clasificación, modelos de capacitación del primer y segundo nivel. <br>  Una solución de tercer lugar también está disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> . </p><br><h1 id="reshenie-organizatorov">  La decisión de los organizadores. </h1><br><p>  En lugar de mil palabras, adjunto las principales características de los organizadores. </p><br><p><img src="https://habrastorage.org/webt/xa/yg/gx/xayggxsl3bpargxaeinl8wgsbhy.jpeg" alt="alt_text"></p><br><p>  Además, los chicos de Okko <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicaron un artículo</a> en el que hablan sobre las etapas de desarrollo de su motor de recomendación. </p><br><p>  PD: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí puede ver el</a> rendimiento en Data Fest 6 sobre esta solución al problema. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454818/">https://habr.com/ru/post/454818/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454804/index.html">Crea tu componente con micro-plantillas</a></li>
<li><a href="../454806/index.html">Entrenamiento Cisco 200-125 CCNA v3.0. Día 9. El mundo físico de los interruptores. Parte 1</a></li>
<li><a href="../454808/index.html">Sobre naves espaciales y espacio. Cómo hacer una función cambiando todo el producto en el camino</a></li>
<li><a href="../454810/index.html">Aire fresco en Marte: doble una molécula de CO2 y obtenga oxígeno</a></li>
<li><a href="../454816/index.html">Configuración del paquete php-fpm + nginx en WSL</a></li>
<li><a href="../454820/index.html">Búsqueda de Azure</a></li>
<li><a href="../454824/index.html">El amplificador operacional más simple en elementos discretos</a></li>
<li><a href="../454826/index.html">Reduzca las copias de seguridad en un 99.5% con hashget</a></li>
<li><a href="../454828/index.html">Crear una imagen de mosaico</a></li>
<li><a href="../454830/index.html">3 cualidades clave para un gerente de producto exitoso: Alexander Belyaev</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>