<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîà üö∏ ‚åöÔ∏è Procesos de aprendizaje en Linux ‚ô†Ô∏è ü§ï üï¥üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo, me gustar√≠a hablar sobre la ruta de la vida de los procesos en la familia del sistema operativo Linux. En teor√≠a y ejemplos, ver√© c√≥...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Procesos de aprendizaje en Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423049/"><img src="https://habrastorage.org/webt/w9/tj/yz/w9tjyz5nyynb4zwy2kiikc0ckec.png"><br>  En este art√≠culo, me gustar√≠a hablar sobre la ruta de la vida de los procesos en la familia del sistema operativo Linux.  En teor√≠a y ejemplos, ver√© c√≥mo nacen y mueren los procesos, una peque√±a charla sobre la mec√°nica de las llamadas y se√±ales del sistema. <br><br>  Este art√≠culo est√° dirigido a principiantes en programaci√≥n de sistemas y aquellos que solo quieren aprender un poco m√°s sobre c√≥mo funcionan los procesos en Linux. <br><a name="habracut"></a><br>  Todo lo escrito a continuaci√≥n se aplica a Debian Linux con el kernel 4.15.0. <br><br><h2>  Contenido </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Introduccion</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Atributos de proceso</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ciclo de vida del proceso</a> <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Proceso de nacimiento</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Estado listo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El estado es "en ejecuci√≥n"</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Reencarnaci√≥n en otro programa</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Estado pendiente</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Estado de parada</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Proceso de finalizaci√≥n</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El estado de los "zombies"</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Olvido</a> </li></ol></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Agradecimientos</a> </li></ol><br><a name="intro"></a><h2>  Introduccion </h2><br>  El software del sistema interact√∫a con el n√∫cleo del sistema a trav√©s de funciones especiales: llamadas al sistema.  En casos raros, hay una API alternativa, por ejemplo, procfs o sysfs, hecha en forma de sistemas de archivos virtuales. <br><br><a name="definition"></a><h2>  Atributos de proceso </h2><br>  El proceso en el n√∫cleo se presenta simplemente como una estructura con muchos campos (la definici√≥n de la estructura se puede leer <a href="" rel="nofollow">aqu√≠</a> ). <br>  Pero dado que el art√≠culo est√° dedicado a la programaci√≥n del sistema, y ‚Äã‚Äãno al desarrollo del n√∫cleo, estamos algo abstra√≠dos y simplemente nos centramos en los campos de proceso importantes para nosotros: <br><br><ul><li>  Id. De proceso (pid) </li><li>  Descriptores de archivos abiertos (fd) </li><li>  Manejadores de se√±al </li><li>  Directorio de trabajo actual (cwd) </li><li>  Variables de entorno (entorno) </li><li>  C√≥digo de retorno </li></ul><br><a name="lifecycle"></a><h2>  Ciclo de vida del proceso </h2><br><img src="https://habrastorage.org/webt/dw/ru/5n/dwru5nbeoag7imroc_ki1qa9gba.png"><br><br><a name="fork"></a><h3>  Proceso de nacimiento </h3><br>  Solo un proceso en el sistema nace de una manera especial - <code>init</code> - es generado directamente por el n√∫cleo.  Todos los dem√°s procesos aparecen duplicando el proceso actual utilizando la llamada al sistema <code>fork(2)</code> .  Despu√©s de ejecutar <code>fork(2)</code> , obtenemos dos procesos casi id√©nticos, con la excepci√≥n de los siguientes puntos: <br><br><ol><li>  <code>fork(2)</code> devuelve el PID del ni√±o al padre, 0 se devuelve al ni√±o; </li><li>  El hijo cambia el PPID (Id. De proceso principal) al PID del padre. </li></ol><br>  Despu√©s de ejecutar <code>fork(2)</code> , todos los recursos del proceso hijo son una copia de los recursos del padre.  Copiar un proceso con todas las p√°ginas de memoria asignadas es costoso, por lo que el kernel de Linux utiliza la tecnolog√≠a Copy-On-Write. <br>  Todas las p√°ginas en la memoria del padre se marcan como de solo lectura y est√°n disponibles tanto para el padre como para el ni√±o.  Tan pronto como uno de los procesos cambia los datos en una p√°gina en particular, esta p√°gina no cambia, pero la copia ya est√° copiada y modificada.  En este caso, el original est√° "desatado" de este proceso.  Tan pronto como el original de solo lectura permanezca "vinculado" a un solo proceso, la p√°gina se reasigna al estado de lectura-escritura. <br><br><div class="spoiler">  <b class="spoiler_title">Un ejemplo de un programa in√∫til simple con fork (2)</b> <div class="spoiler_text"><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;unistd.h&gt; #include &lt;errno.h&gt; #include &lt;sys/wait.h&gt; #include &lt;sys/types.h&gt; int main() { int pid = fork(); switch(pid) { case -1: perror("fork"); return -1; case 0: // Child printf("my pid = %i, returned pid = %i\n", getpid(), pid); break; default: // Parent printf("my pid = %i, returned pid = %i\n", getpid(), pid); break; } return 0; }</span></span></span></span></code> </pre><br><br><pre> <code class="bash hljs">$ gcc test.c &amp;&amp; ./a.out my pid = 15594, returned pid = 15595 my pid = 15595, returned pid = 0</code> </pre><br></div></div><br><a name="ready"></a><h3>  Estado listo </h3><br>  Inmediatamente despu√©s de la ejecuci√≥n, la <code>fork(2)</code> entra en el estado listo. <br>  De hecho, el proceso hace cola y espera a que el planificador en el n√∫cleo permita que el proceso se ejecute en el procesador. <br><br><a name="running"></a><h3>  El estado es "en ejecuci√≥n" </h3><br>  Tan pronto como el planificador puso el proceso en ejecuci√≥n, comenz√≥ el estado "en ejecuci√≥n".  El proceso puede ejecutar todo el per√≠odo de tiempo propuesto (cu√°ntico) o puede dar paso a otros procesos que utilizan la exportaci√≥n del sistema <code>sched_yield</code> . <br><br><a name="exec"></a><h3>  Reencarnaci√≥n en otro programa </h3><br>  Algunos programas implementan l√≥gica en la cual el proceso padre crea un hijo para resolver un problema.  El ni√±o en este caso resuelve un problema espec√≠fico, y el padre solo delega tareas a sus hijos.  Por ejemplo, un servidor web con una conexi√≥n entrante crea un hijo y le pasa el procesamiento de la conexi√≥n. <br>  Sin embargo, si necesita ejecutar otro programa, debe recurrir a la llamada al sistema <code>execve(2)</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argv[], </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> envp[])</span></span></span></span>;</code> </pre><br>  o la biblioteca llama a <code>execl(3), execlp(3), execle(3), execv(3), execvp(3), execvpe(3)</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg, ... </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/* (char *) NULL */</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execlp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *file, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg, ... </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/* (char *) NULL */</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg, ... </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*, (char *) NULL, char * const envp[] */</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execv</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argv[])</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execvp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *file, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argv[])</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execvpe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *file, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argv[], </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> envp[])</span></span></span></span>;</code> </pre><br>  Todas las llamadas anteriores ejecutan el programa, cuya ruta se indica en el primer argumento.  Si tiene √©xito, el control se transfiere al programa cargado y no se devuelve al original.  En este caso, el programa cargado tiene todos los campos de la estructura del proceso, excepto los descriptores de archivo marcados como <code>O_CLOEXEC</code> , se cerrar√°n. <br><br>  ¬øC√≥mo no confundirse en todos estos desaf√≠os y elegir el correcto?  Es suficiente entender la l√≥gica de denominaci√≥n: <br><br><ul><li>  Todas las llamadas comienzan con <code>exec</code> </li><li>  La quinta letra define el tipo de argumento que pasa: <br><ul><li>  <b>l</b> significa <b>lista</b> , todos los par√°metros se pasan como <code>arg1, arg2, ..., NULL</code> </li><li>  <b>v</b> significa <b>vector</b> , todos los par√°metros se pasan en una matriz terminada en nulo; </li></ul></li><li>  La letra <b>p</b> , que significa <b>camino</b> , puede seguir.  Si el argumento del <code>file</code> comienza con un car√°cter distinto de "/", el <code>file</code> especificado se busca en los directorios enumerados en la variable de entorno PATH </li><li>  La √∫ltima puede ser la letra <b>e</b> , que indica el <b>entorno</b> .  En tales llamadas, el √∫ltimo argumento es una matriz terminada en nulo de cadenas terminadas en nulo de la <code>key=value</code> forma <code>key=value</code> - variables de entorno que se pasar√°n al nuevo programa. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de llamada a / bin / cat --help via execve</b> <div class="spoiler_text"><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _GNU_SOURCE #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;unistd.h&gt; int main() { char* args[] = { "/bin/cat", "--help", NULL }; execve("/bin/cat", args, environ); // Unreachable return 1; }</span></span></span></span></code> </pre><br><br><pre> <code class="bash hljs">$ gcc test.c &amp;&amp; ./a.out Usage: /bin/cat [OPTION]... [FILE]... Concatenate FILE(s) to standard output. * *</code> </pre><br></div></div><br>  La familia de llamadas <code>exec*</code> permite ejecutar scripts con derechos de ejecuci√≥n y comenzar con una secuencia de shebangs (#!). <br><br><div class="spoiler">  <b class="spoiler_title">Un ejemplo de ejecuci√≥n de una secuencia de comandos con una RUTA falsificada utilizando el ejemplo</b> <div class="spoiler_text"><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _GNU_SOURCE #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;unistd.h&gt; int main() { char* e[] = {"PATH=/habr:/rulez", NULL}; execle("/tmp/test.sh", "test.sh", NULL, e); // Unreachable return 1; }</span></span></span></span></code> </pre><br><br><pre> <code class="bash hljs">$ cat test.sh <span class="hljs-comment"><span class="hljs-comment">#!/bin/bash echo $0 echo $PATH $ gcc test.c &amp;&amp; ./a.out /tmp/test.sh /habr:/rulez</span></span></code> </pre><br></div></div><br>  Hay una convenci√≥n que implica que argv [0] coincide con los argumentos nulos para funciones en la familia exec *.  Sin embargo, esto puede ser violado. <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo cuando el gato se convierte en perro usando execlp</b> <div class="spoiler_text"><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _GNU_SOURCE #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;unistd.h&gt; int main() { execlp("cat", "dog", "--help", NULL); // Unreachable return 1; }</span></span></span></span></code> </pre><br><br><pre> <code class="bash hljs">$ gcc test.c &amp;&amp; ./a.out Usage: dog [OPTION]... [FILE]... * *</code> </pre><br></div></div><br>  Un lector curioso puede notar que en la firma de la funci√≥n <code>int main(int argc, char* argv[])</code> hay un n√∫mero: el n√∫mero de argumentos, pero no se pasa nada por el estilo a la familia de funciones <code>exec*</code> .  Por qu√©  Porque cuando se inicia el programa, el control no se transfiere inmediatamente a main.  Antes de esto, se realizan algunas acciones definidas por glibc, incluido contar argc. <br><br><a name="waiting"></a><h3>  Estado pendiente </h3><br>  Algunas llamadas al sistema pueden tardar mucho tiempo, como las E / S.  En tales casos, el proceso pasa a un estado "pendiente".  Tan pronto como se complete la llamada al sistema, el kernel pondr√° el proceso en el estado "listo". <br>  En Linux, tambi√©n hay un estado de "espera" en el que el proceso no responde a las se√±ales de interrupci√≥n.  En este estado, el proceso se vuelve "indestructible" y todas las se√±ales entrantes permanecen en l√≠nea hasta que el proceso abandona este estado. <br>  El n√∫cleo mismo elige a qu√© estado transferir el proceso.  Con mayor frecuencia, los procesos que solicitan E / S est√°n en el estado "en espera (sin interrupciones)".  Esto es especialmente notable cuando se usa un disco remoto (NFS) con un Internet no muy r√°pido. <br><br><a name="stopped"></a><h3>  Estado de parada </h3><br>  Puede pausar un proceso en cualquier momento envi√°ndole una se√±al SIGSTOP.  El proceso pasar√° a un estado "detenido" y permanecer√° all√≠ hasta que reciba una se√±al para continuar trabajando (SIGCONT) o morir (SIGKILL).  Las se√±ales restantes se pondr√°n en cola. <br><br><a name="exit"></a><h3>  Proceso de finalizaci√≥n </h3><br>  Ning√∫n programa puede cerrarse solo.  Solo pueden pedir esto al sistema con la <code>_exit</code> sistema <code>_exit</code> o ser cancelado por el sistema debido a un error.  Incluso cuando devuelve un n√∫mero de <code>main()</code> , <code>_exit</code> todav√≠a se llama impl√≠citamente. <br>  Aunque el argumento de la llamada al sistema es int, solo el byte bajo del n√∫mero se toma como c√≥digo de retorno. <br><br><a name="zombie"></a><h3>  El estado de los "zombies" </h3><br>  Inmediatamente despu√©s de que el proceso se haya completado (sin importar si es correcto o no), el kernel escribe informaci√≥n sobre c√≥mo termin√≥ el proceso y lo coloca en el estado "zombie".  En otras palabras, un zombie es un proceso completo, pero su memoria todav√≠a est√° almacenada en el n√∫cleo. <br>  Adem√°s, este es el segundo estado en el que el proceso puede ignorar con seguridad la se√±al SIGKILL, porque no puede morir de nuevo. <br><br><a name="wait"></a><h3>  Olvido </h3><br>  El c√≥digo de retorno y el motivo de la finalizaci√≥n del proceso todav√≠a se almacenan en el kernel y deben tomarse desde all√≠.  Para hacer esto, puede usar las llamadas apropiadas del sistema: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">pid_t</span></span> wait(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *wstatus); <span class="hljs-comment"><span class="hljs-comment">/*  waitpid(-1, wstatus, 0) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pid_t</span></span> waitpid(<span class="hljs-keyword"><span class="hljs-keyword">pid_t</span></span> pid, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *wstatus, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> options);</code> </pre><br>  Toda la informaci√≥n sobre la finalizaci√≥n del proceso se ajusta al tipo de datos int.  Las macros descritas en la <code>waitpid(2)</code> del <code>waitpid(2)</code> man <code>waitpid(2)</code> se utilizan para obtener el c√≥digo de retorno y el motivo de la finalizaci√≥n del programa. <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de finalizaci√≥n correcta y recibo de un c√≥digo de retorno</b> <div class="spoiler_text"><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;unistd.h&gt; #include &lt;errno.h&gt; #include &lt;sys/wait.h&gt; #include &lt;sys/types.h&gt; int main() { int pid = fork(); switch(pid) { case -1: perror("fork"); return -1; case 0: // Child return 13; default: { // Parent int status; waitpid(pid, &amp;status, 0); printf("exit normally? %s\n", (WIFEXITED(status) ? "true" : "false")); printf("child exitcode = %i\n", WEXITSTATUS(status)); break; } } return 0; }</span></span></span></span></code> </pre><br><br><pre> <code class="bash hljs">$ gcc test.c &amp;&amp; ./a.out <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> normally? <span class="hljs-literal"><span class="hljs-literal">true</span></span> child exitcode = 13</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de finalizaci√≥n incorrecta</b> <div class="spoiler_text"><br>  Al pasar argv [0] como NULL, se produce un bloqueo. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;unistd.h&gt; #include &lt;errno.h&gt; #include &lt;sys/wait.h&gt; #include &lt;sys/types.h&gt; int main() { int pid = fork(); switch(pid) { case -1: perror("fork"); return -1; case 0: // Child execl("/bin/cat", NULL); return 13; default: { // Parent int status; waitpid(pid, &amp;status, 0); if(WIFEXITED(status)) { printf("Exit normally with code %i\n", WEXITSTATUS(status)); } if(WIFSIGNALED(status)) { printf("killed with signal %i\n", WTERMSIG(status)); } break; } } return 0; }</span></span></span></span></code> </pre><br><br><pre> <code class="bash hljs">$ gcc test.c &amp;&amp; ./a.out killed with signal 6</code> </pre><br></div></div><br>  Hay momentos en que un padre termina antes que el hijo.  En tales casos, <code>init</code> se convertir√° en el padre del ni√±o y usar√° la llamada de <code>wait(2)</code> cuando llegue el momento. <br><br>  Despu√©s de que el padre ha tomado informaci√≥n sobre la muerte del ni√±o, el n√∫cleo borra toda la informaci√≥n sobre el ni√±o para que otro proceso pronto tome su lugar. <br><br><a name="thanks"></a><h2>  Agradecimientos </h2><br>  Gracias a Sasha "Al" por la edici√≥n y asistencia en el dise√±o; <br><br>  Gracias a Sasha "Reisse" por las respuestas claras a preguntas dif√≠ciles. <br><br>  Soportaron la inspiraci√≥n que me atac√≥ y el aluvi√≥n de mis preguntas que me atacaron. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423049/">https://habr.com/ru/post/es423049/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423039/index.html">Hacemos autenticaci√≥n web a trav√©s de blockchain</a></li>
<li><a href="../es423041/index.html">Bizarre Story Super NES CD-ROM</a></li>
<li><a href="../es423043/index.html">Debido a una vulnerabilidad en el sistema de protecci√≥n del veh√≠culo el√©ctrico Tesla, un autom√≥vil puede ser robado en unos segundos</a></li>
<li><a href="../es423045/index.html">¬øQu√© impresora 3D elegir? Revisi√≥n de video de 3Dtool</a></li>
<li><a href="../es423047/index.html">Reservamos sistemas inform√°ticos por dinero razonable</a></li>
<li><a href="../es423051/index.html">La lucha por los recursos, Parte 1: Los fundamentos de los grupos C</a></li>
<li><a href="../es423053/index.html">Estructura y solo lectura: c√≥mo evitar la degradaci√≥n del rendimiento</a></li>
<li><a href="../es423055/index.html">Analistas de Wall Street: "Apple nos hizo comer nuestros sombreros"</a></li>
<li><a href="../es423057/index.html">Python tambi√©n rechaza parcialmente los t√©rminos maestro / esclavo</a></li>
<li><a href="../es423059/index.html">Mejor de lo que dicen: tres elementos esenciales para que el pr√≥ximo MacBook sea una de las mejores computadoras port√°tiles de Apple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>