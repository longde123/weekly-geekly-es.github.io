<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∑üèæ üõåüèª üõ¨ Meine Schritte, Erfolge und Fehler in der Spielentwicklungswelt am Beispiel eines Spielbot in Telegram üö® üö£üèæ üé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! Mein Name ist Maxim und ich m√∂chte Ihnen die Geschichte der Entstehung des Wasteland Wars-Projekts erz√§hlen. Ich hoffe, Sie werden i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Meine Schritte, Erfolge und Fehler in der Spielentwicklungswelt am Beispiel eines Spielbot in Telegram</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412805/">  Hallo allerseits!  Mein Name ist Maxim und ich m√∂chte Ihnen die Geschichte der Entstehung des Wasteland Wars-Projekts erz√§hlen.  Ich hoffe, Sie werden interessiert sein, und vielleicht kann Ihnen einiges davon helfen, meine Fehler zu vermeiden. <br><a name="habracut"></a><br><h2>  Plattformauswahl </h2><br>  Telegramm ist eine sehr ungew√∂hnliche Plattform zum Erstellen von Online-Spielen.  Besonders wenn es um MMORPGs geht.  Ich fragte mich, ob es √ºberhaupt m√∂glich war, auf dieser Plattform ein Qualit√§tsprodukt zu erstellen, und wenn ja, ob √ºberhaupt eine Nachfrage danach besteht.  Im Juni 2017 begann ich mit der Entwicklung von Wasteland Wars. <br><br><h2>  Viralit√§t </h2><br>  In den fr√ºhen Tagen der Entwicklung wurde beschlossen, eine Fokusgruppe aus meinen Freunden f√ºr einen Spieletest zusammenzustellen.  Schlie√ülich war das Testen allein im Umgang mit IMO problematisch.  Also habe ich den Closed Beta-Test des Spiels gestartet und √ºber einmalige Schl√ºssel auf den Bot zugegriffen.  Nachdem ich solche 10 St√ºcke erzeugt hatte, schickte ich sie an meine Freunde in TG.  Das √úberweisungssystem wurde bereits zu diesem Punkt hinzugef√ºgt, obwohl es angesichts der geschlossenen Tests tats√§chlich nicht funktionierte.  Das Wesentliche ist, dass f√ºr jede Person, die im Spiel registriert ist, gem√§√ü Ihrer Referenz.  Link, der Spieler erh√§lt +1 auf die maximale Ausdauer und einige Obergrenzen (lokale W√§hrung) f√ºr Taschenausgaben.  Dies f√ºhrte dazu, dass 2 Wochen nach Beginn der PTA 50 Personen daran teilnahmen und meine privaten Nachrichten mit Anfragen von Personen √ºberf√ºllt waren, ihnen weitere 1-2-10 Schl√ºssel f√ºr ihre Freunde zu geben.  Anstatt st√§ndig neue Schl√ºssel zu generieren, habe ich mich darauf konzentriert, die beim Testen festgestellten Fehler zu beheben und einen offenen Beta-Test zu starten, bei dem die Registrierung nach Schl√ºsseln aufgehoben wird.  Am ersten Tag von MBT haben sich 120 Personen f√ºr das Spiel angemeldet.  Einen Monat sp√§ter waren t√§glich 200 bis 250 Personen online, und die Gesamtzahl der registrierten Spieler n√§herte sich 800. Und dies alles ohne Bewegung seitens des PR-Spiels, wurde das Spiel ausschlie√ülich dank Mundpropaganda und Empfehlungssystem bekannt. <br><br><h2>  Projektfunktionen, die den Spielern gefallen haben </h2><br>  W√§hrend des Tests stellten die Spieler ein Spielgenre fest, das f√ºr dieses Format √§u√üerst ungew√∂hnlich war, vollwertige PVP-Schlachten und das Pumpsystem eines Spielers ohne klassische Fertigkeitspunkte und Level-Ups.  Was mich jedoch √ºberraschte: Am allermeisten lobten die Leute die Spieltexte, insbesondere die Qualit√§t des Humors, Hinweise auf die Popul√§rkultur und atmosph√§rische Situationen, im Gegensatz zum schwarzen Humor mit ihrem Drama. <br><br><h2>  Technische Details </h2><br>  Die ersten Schwierigkeiten im Zusammenhang mit der Bot-API-Plattform traten bereits in den ersten Tagen der Entwicklung auf.  Telegramm hat zwei Hauptsysteme, um ihre Bots mit Ihrem Server zu verbinden: das sogenannte Long Polling und Webhooks.  Der erste impliziert, dass Ihr Server das Telegramm in einem bestimmten Intervall st√§ndig nach neuen Anforderungen abfragt und es gegebenenfalls verarbeitet, indem er eine Bot-API-Antwort zur√ºckgibt.  Die zweite ist etwas schwieriger zu implementieren - sie besteht darin, dass Ihr Server Telegram mitteilt: "Wenn Sie Anfragen haben, legen Sie diese an dieser Adresse ab."  Dementsprechend sind zur Implementierung des Bots mithilfe der Webhooks-Technologie eine permanente IP-Adresse und ein SSL-Zertifikat erforderlich, die zumindest selbst signiert sind.  Nachdem ich mit der Entwicklung auf Basis von Long Polling begonnen hatte, bemerkte ich zu Beginn keine Probleme im Zusammenhang mit dieser Methode.  Nach einem Tag im Dauerbetrieb st√ºrzte der Bot jedoch unerwartet ab.  Das Telegramm gab einen Fehler zur√ºck, als es eine Anfrage erhielt.  Wie sich herausstellte, plagt dieses Problem absolut alle auf Long Polling basierenden Bots - das Telegramm schlie√üt die Anforderungsverarbeitung vom Bot nach einiger Zeit ab, weshalb Sie es st√§ndig neu starten m√ºssen.  Zuerst beschloss ich, den "Reanimations" -Prozess des Bots zu automatisieren, indem ich ein Cron-Skript schrieb, um den Puls des Prozesses zu √ºberpr√ºfen und neu zu starten, wenn der Patient nicht auf einen Stocksto√ü reagierte.  Dieser Prozess des st√§ndigen Neustarts verursachte den Spielern jedoch Unannehmlichkeiten  hat einige Zeit gedauert und auch die aktuellen Timer im Spiel zur√ºckgesetzt.  Infolgedessen wurde das Projekt auf Webhooks √ºbertragen, und dieses Problem verschwand sofort. <br><br>  In Bezug auf die Komplexit√§t der Bot-API selbst war alles ruhig.  Bis zu einem Moment. <br><br>  Das Projekt gewann an Umfang, baute sein Publikum auf und entwickelte sich st√§ndig weiter.  Irgendwann wurde der Bot nach Erhalt der Anfrage pl√∂tzlich "langweilig".  Genauer gesagt gab es eine Verz√∂gerung bei der Reaktion des Bots auf den Spieler.  Zun√§chst stieg ich auf den Server und dachte, dass er die wachsende Anzahl von Anfragen nicht mehr bew√§ltigen konnte.  Aber nein, die Serverlast hat in Spitzenzeiten 30% nicht √ºberschritten, es gab keine Probleme mit dem freien Speicher, es gab keine Fehler und Warnungen im Systemprotokoll.  Aber die Bremsen wuchsen weiter.  Wie sich herausstellte, begann der Bot, sich hinsichtlich der Anzahl gleichzeitiger Anforderungen an das Bot-API-Limit zu st√ºtzen.  Zuerst habe ich den Bot erfolgreich reduziert und optimiert, um diese Menge zu reduzieren.  Als sich das Spiel jedoch auf die Massen ausbreitete, wurde klar: Sehr bald wird der Bot diese Obergrenze erreichen und keine Optimierungen werden mir helfen.  Dann wurde beschlossen, zur Unterst√ºtzung von Telegram mit der Bitte zu schreiben, die Limits speziell f√ºr meinen Bot zu erh√∂hen.  Und zu meiner gro√üen √úberraschung antworteten sie am n√§chsten Tag und das Limit wurde erh√∂ht, obwohl sie keine neue Schwelle nannten.  Au√üerdem informierten sie mich, dass der Bot auf dem Limit f√ºr eine bestimmte Art von Anfrage ruht - R√ºckruf auf die sogenannte.  Inline-Schaltfl√§chen.  Dies ist die Tastatur im Telegramm, die unter einer bestimmten Meldung angezeigt wird.  Bei Textanforderungen (einschlie√ülich Anfragen mit normalen Schaltfl√§chen) ist das Limit viel h√∂her, und es gibt auch kein Limit von 15 Sekunden f√ºr eine Antwort vom Server.  Das Problem war, dass 70% der Benutzeroberfl√§che des Spiels auf Inline-Schaltfl√§chen basiert.  Ich musste es komplett verarbeiten, um dieses √úbel loszuwerden, so bequem und sch√∂n. <br><br>  Das n√§chste Problem, auf das das Projekt stie√ü, war bereits in meiner Entwicklungsumgebung und in meinem Code.  Insbesondere in Python 3 und wie es mit Threads funktioniert.  Jeder neue Thread in Python 3 wird zusammen mit Umgebungsvariablen erstellt und verbraucht viel Speicher.  Das Spiel ist voll von Timern (2 Minuten, um zwischen Orten zu wechseln, auf einen Kampf zu warten usw.), und das Starten in separaten Streams verursachte einen Speicherverlust.  W√§hrend das Online-Spiel w√§chst, hat das Leck ein verr√ºcktes Ausma√ü erreicht, das den gesamten m√∂glichen RAM verschlingt und den verbleibenden Speicher des SSD-Servers aufpumpt.  Das Problem wurde nat√ºrlich gel√∂st, indem Warteschlangen von Timern erstellt wurden, die f√ºr jeden Typ in einem Thread verarbeitet werden. <br><br><h2>  Visueller Teil in einem Textspiel </h2><br>  Eines der Hauptmerkmale von Wasteland Wars im Vergleich zu anderen √§hnlichen Spielen in Telegram war die Einf√ºhrung des visuellen Teils.  Ein interaktiver Avatar des Charakters wurde dem Spiel hinzugef√ºgt sowie eine visuelle Anzeige jedes Ausr√ºstungsgegenstandes im Spiel.  Wie bei RPGs in voller Gr√∂√üe auf Spielplattformen kann ein Spieler seinen Charakter in verschiedene R√ºstungen kleiden, ihm verschiedene Waffen geben und dann alle √Ñnderungen visuell sehen.  Wenig sp√§ter entwickelte ich diese Idee. Wenn sich jetzt ein anderer Spieler im Spiel trifft, wird auch sein Avatar angezeigt. Auf diese Weise wird es m√∂glich, das Pumpen des Feindes nicht zu kennen und seine Gefahr im Aussehen zu bewerten.  Zus√§tzlich zur Ausr√ºstung werden auf dem Avatar auch ‚ÄûMasken‚Äú angezeigt - sie k√∂nnen gegen Spende gekauft werden, sie bieten dem Spieler keinen Vorteil, aber sie √§ndern sein Aussehen im Avatar.  Au√üerdem wurde im Spiel eine vollst√§ndige interaktive Karte angezeigt.  Wenn ein Ort gefunden wird, wird er dem Spieler auf der Karte hinzugef√ºgt. <br><br>  Alle Bilder werden in einer relativ niedrigen Aufl√∂sung angezeigt, die ausreicht, um ihren Inhalt zu verstehen.  Dies liegt an der Tatsache, dass Avatare und Karten aus vielen verschiedenen Elementen f√ºr jeden Spieler gesammelt werden und bei einer gro√üen Anzahl gleichzeitiger Anforderungen ihre Zusammenstellung in hoher Aufl√∂sung den Spielserver erheblich belasten kann. <br><br><h2>  Projektentwicklungspl√§ne </h2><br>  Im Moment wird das Spiel nach Go kopiert - diese Sprache ist, wie sich herausstellte, viel besser f√ºr die Entwicklung eines solchen Projekts geeignet.  Mit meinem eigenen Webserver in Go und seiner Geschwindigkeit konnte ich meine eigene API f√ºr das Projekt erstellen, um es von einer einzigen Plattform in Telegram zu l√∂sen.  Mit der API k√∂nnen Sie Anforderungen von jedem Client empfangen und verarbeiten, und die gesamte Logik wird nur auf dem Server verarbeitet. <br><br>  Die Entwicklung eines Clients f√ºr jede Plattform ist so einfach wie der Client selbst. Dadurch werden viele Einschr√§nkungen von Telegram vermieden, Schwierigkeiten beim Blockieren vermieden und eine gro√üe Anzahl neuer Zuschauer f√ºr das Spiel gewonnen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de412805/">https://habr.com/ru/post/de412805/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de412795/index.html">Und lassen Sie uns Schlussfolgerungen aus der Diskussion des Artikels "Was ist los mit der R√ºckkehr von Geektimes nach Habr?"</a></li>
<li><a href="../de412797/index.html">√úber die Gefahren von CDN, Diensten und Schriftarten von Google</a></li>
<li><a href="../de412799/index.html">Immer in Kontakt: Mango Talker - Messenger und Softphone</a></li>
<li><a href="../de412801/index.html">Studie: Hacker stehlen Millionen von Dollar aufgrund der geringen Sicherheit des Kryptow√§hrungsaustauschs</a></li>
<li><a href="../de412803/index.html">Ein tieferer Blick auf die verschiedenen intelligenten Vertragsplattformen</a></li>
<li><a href="../de412807/index.html">Hinweise des IoT-Anbieters. Anstand</a></li>
<li><a href="../de412809/index.html">Zwei-Faktor-Authentifizierung auf der Site mithilfe eines USB-Tokens. Wie mache ich den Zugriff auf das Serviceportal sicher?</a></li>
<li><a href="../de412811/index.html">C DevTools on Elbrus: Lebendige Berichte von HolyJS 2018 Piter</a></li>
<li><a href="../de412813/index.html">Unn√∂tige HTTP-Header</a></li>
<li><a href="../de412815/index.html">Web Manager OpenVPN-Clientschl√ºssel VPNFace Lite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>