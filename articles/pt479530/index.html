<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèòÔ∏è üëçüèº üîΩ Sistema de coordenadas ultrass√¥nicas 2.0 üë©üèø‚Äçüîß ‚úåÔ∏è üêÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sistema de coordenadas ultrass√¥nicas 2.0 
 Sobre o que √© este artigo: Este artigo descreve os princ√≠pios de opera√ß√£o do meu sistema de determina√ß√£o de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sistema de coordenadas ultrass√¥nicas 2.0</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479530/"><h2>  Sistema de coordenadas ultrass√¥nicas 2.0 </h2><br>  <b>Sobre o que √© este artigo:</b> Este artigo descreve os princ√≠pios de opera√ß√£o do meu sistema de determina√ß√£o de coordenadas e minha experi√™ncia em sua fabrica√ß√£o.  Este artigo n√£o √© uma instru√ß√£o para a fabrica√ß√£o de um sistema de navega√ß√£o, porque n√£o √© t√£o simples de descrever em um artigo. <br><br><img src="https://habrastorage.org/webt/-r/zu/xp/-rzuxphjgpq9izjwplxls7rrwue.png"><br><br>  Este artigo √© um desenvolvimento das id√©ias do meu artigo anterior: <br>  <a href="https://habr.com/ru/post/451408/">habr.com/en/post/451408</a> <br><a name="habracut"></a><br><h3>  Estrutura do sistema </h3><br>  O sistema de determina√ß√£o de coordenadas possui o seguinte diagrama estrutural: <br><br><img src="https://habrastorage.org/webt/l1/-w/4j/l1-w4j5qkp9xuwk_2k8x7kvnqfg.png"><br>  Fig.  1 - Diagrama esquem√°tico do sistema de ultrassom para determina√ß√£o das coordenadas. <br><br>  Vamos considerar cada elemento mais de perto. <br><br><h3>  Receptor de ultrassom </h3><br><img src="https://habrastorage.org/webt/ix/cv/og/ixcvogrpoy4ntuu0qw9ytjbtyje.png"><br><br><img src="https://habrastorage.org/webt/nc/sr/tf/ncsrtfhxi-rsa8jstcwuuax0nfu.jpeg"><br><br><img src="https://habrastorage.org/webt/f4/83/bj/f483bjd1b0vfkn0a5yywlcv_a-g.jpeg"><br>  Fig.  2 - Desenvolvimento do receptor de ultrassom (de cima para baixo). <br><br>  Inicialmente, os receptores eram constitu√≠dos por um m√≥dulo e tinham uma √°rea de cobertura muito pequena da sala; naquela √©poca, eu n√£o digitalizava o sinal, mas simplesmente recebia do sensor o comprimento que o controlador comum fornecia. <br><br>  Ent√£o, para aumentar a cobertura, decidi fazer um m√≥dulo de tr√™s sensores, cujos dados foram simultaneamente digitalizados e transmitidos para um PC, onde foram calculadas a dist√¢ncia e as coordenadas.  Depois de testar um receptor de tr√™s componentes, vi que um receptor √© suficiente se voc√™ processar o sinal sozinho. <br><br>  Como resultado, o receptor tornou-se novamente um componente, mas devido ao fato de eu estar processando o sinal atualmente, a √°rea de cobertura tornou-se bastante grande.  O sinal agora √© processado no STM32 ap√≥s a digitaliza√ß√£o, emite apenas a dist√¢ncia at√© a sa√≠da. <br><br>  Composi√ß√£o: <br><ul><li>  STM32 - usado para digitalizar o sinal ultrass√¥nico e calcular a dist√¢ncia do emissor; </li><li>  HC-SR04 - Modifiquei um pouco e agora posso receber o sinal de sua entrada, mostrado na Figura 3; </li><li>  RS485 - para transmitir a dist√¢ncia do emissor ao PC. </li></ul><br><img src="https://habrastorage.org/webt/sd/xb/qp/sdxbqplmpwkrchgdlty-ptpigms.png"><br>  Fig.  3 - Sinal ultrass√¥nico digitalizado. <br><br><img src="https://habrastorage.org/webt/ty/8c/lf/ty8clfyeg2s3jxde_dbgtolirmo.png"><br>  Fig.  4 - sinal de ultrassom na √°rea 4700 - 5200 da figura acima. <br><br><h3>  Emissor ultrass√¥nico </h3><br><img src="https://habrastorage.org/webt/fv/ta/el/fvtael07m2b6_r2ybluysab17gk.jpeg"><br><br><img src="https://habrastorage.org/webt/gs/i2/7f/gsi27fd6sg6vyiw39z6rfwebmky.jpeg"><br><br><img src="https://habrastorage.org/webt/t5/s6/ai/t5s6aihoqrlyvq7o1uqyxkv90jy.jpeg"><br>  Fig.  5 - Desenvolvimento do emissor (de cima para baixo). <br><br>  Como voc√™ pode ver na Figura 5, no come√ßo eu apenas puxei o p√© Trig no sensor HC-SR04, n√£o era o melhor sistema, apenas porque n√£o consegui determinar quantas ondas de ultrassom eu poderia criar, n√£o consegui mudar sua pot√™ncia e esse emissor era volumoso o suficiente. <br><br>  Ent√£o criei uma segunda vers√£o, que era muito mais complicada, mas eu j√° podia regular tudo com o STM32 e o L293D, que estavam diretamente conectados ao alto-falante de ultrassom.  Agora, em vez dos 5 volts padr√£o, apliquei 17, e isso aumentou muito a √°rea de trabalho.  Tamb√©m adicionei um m√≥dulo de r√°dio e uma interface RS485, que tornaram esse m√≥dulo independente. <br><br>  Ap√≥s uma s√©rie de testes, decidi reduzir o emissor para um tamanho decente e mont√°-lo com mais for√ßa, como resultado do que voc√™ v√™ na √∫ltima foto. <br><br>  <b>Composi√ß√£o:</b> <br><ul><li>  STM32 - recebe o comando Trig (iniciar a medi√ß√£o das dist√¢ncias) via canal de r√°dio e emite um sinal ultrass√¥nico, tamb√©m transmite comandos recebidos do m√≥dulo de r√°dio para o RS485 (eu o uso para controle remoto da plataforma m√≥vel); </li><li>  RS485 - interface de informa√ß√µes do dispositivo para o usu√°rio; </li><li>  DC-DC boost - converte a fonte de alimenta√ß√£o 5V em 17V para o emissor; </li><li>  L293D - Utilizo para gerar um forte sinal ultrass√¥nico com tens√£o de 17V; </li><li>  nRF24 - canal de r√°dio; </li><li>  Emissores - 6 emissores que s√£o retirados do m√≥dulo HC-SR04. </li></ul><br><h3>  M√≥dulo base </h3><br><img src="https://habrastorage.org/webt/sh/ry/r5/shryr5oczq8ct0zjj-nw7ixvpx0.jpeg"><br>  Fig.  6 - O m√≥dulo b√°sico. <br><br>  <b>Composi√ß√£o:</b> <br><ul><li>  STM32 - envia Trig ao emissor e receptores, recebe comandos USB do PC para transmiss√£o pelo canal de r√°dio ao emissor (tamb√©m conhecido como m√≥dulo m√≥vel); </li><li>  nRF24 - transmitindo Trig para o emissor e transmitindo comandos para o emissor. </li></ul><br><h3>  M√≥dulo PC </h3><br>  O PC atrav√©s do adaptador RS485 est√° conectado a todos os receptores ultrass√¥nicos, nessa interface recebe todos os comprimentos deles e calcula as coordenadas do m√≥dulo m√≥vel.  Via USB, ele √© conectado ao m√≥dulo base e, atrav√©s dele, transfere os comandos de controle para o m√≥dulo m√≥vel. <br><br><h3>  Localiza√ß√£o dos m√≥dulos na √°rea de trabalho </h3><br>  O mapa de uma sala com receptores de ultrassom colocados nos cantos √© assim: <br><br><img src="https://habrastorage.org/webt/zf/my/cl/zfmyclsx5ihwv9bg1yay6x033ro.png"><br>  Fig.  7 - A ideia geral da localiza√ß√£o dos sensores. <br><br><img src="https://habrastorage.org/webt/r_/5p/bz/r_5pbz5hmgbxo4l0wmnfiiew3gi.png"><br>  Fig.  8 - Vista superior em uma escala (c√≠rculos, com n√∫meros dentro, sensores s√£o indicados). <br><br><h3>  O algoritmo de trabalho do sistema de determina√ß√£o de coordenadas ultrass√¥nicas </h3><br><ol><li>  O m√≥dulo base envia um comando Trig ao emissor (over the air) e aos receptores (over the wire). </li><li>  O emissor come√ßa a emitir e os receptores come√ßam a ouvir a transmiss√£o. </li><li>  Cada receptor, depois de ouvir o sinal ultrass√¥nico, registra o tempo entre o comando Trig e o tempo de recebimento desse sinal e o converte √† dist√¢ncia. </li><li>  Os receptores RS485 enviam dist√¢ncias do emissor para si mesmos em um PC. </li><li>  O PC calcula as coordenadas do emissor. </li></ol><br><h3>  Opera√ß√£o do sistema </h3><br>  Executando tudo isso, obtemos as coordenadas do objeto, a precis√£o depende do local na sala.  Nos melhores lugares, o erro n√£o excede alguns cent√≠metros e, no pior dos casos ... bem, voc√™ pode ver tudo na Figura 9. <br><br><img src="https://habrastorage.org/webt/f-/_p/dc/f-_pdck7ruxzuay-7y9gsfrh6tk.png"><br>  Fig.  9 - Movendo o emissor pela sala. <br><br>  Existem quatro conjuntos de coordenadas nesta figura, j√° que temos quatro receptores e, para determinar as coordenadas no espa√ßo tridimensional, precisamos apenas de tr√™s; ent√£o, temos quatro combina√ß√µes de receptores. <br><br>  Como pode ser visto na figura, em geral, o sistema determina as coordenadas corretamente, mas em locais diferentes o erro √© diferente.  Movi o emissor paralelamente aos eixos X e Y, em algum lugar com um intervalo entre as linhas em um metro, em algum lugar no meio metro, isso pode ser visto na figura.  A melhor precis√£o est√° no centro, e nas bordas tudo est√° ruim, porque a partir da√≠ o sinal ultrass√¥nico cai sobre o receptor em um √¢ngulo grande e isso cria distor√ß√µes no sinal digitalizado. <br><br>  Ap√≥s filtrar e calcular a m√©dia de quatro pares de coordenadas, obtemos a seguinte imagem: <br><br><img src="https://habrastorage.org/webt/ac/ny/6c/acny6c59da471karux9ty6u0h6m.png"><br>  Fig.  10 - Trajet√≥ria m√©dia. <br><br>  N√£o √© gelo, mas o que est√° l√°. <br><br>  Por divers√£o, mostrarei como tudo fica em 3D, porque tamb√©m temos uma terceira coordenada, embora n√£o seja necess√°ria no meu projeto, porque um rob√¥ m√≥vel se move apenas em um avi√£o. <br><br><img src="https://habrastorage.org/webt/-y/gr/uk/-ygrukcimy5ldmzsmpf3zbcqsqe.png"><br>  Fig.  11 - trajet√≥ria 3D. <br><br>  Como podemos ver, todos os pontos est√£o aproximadamente no mesmo plano, e isso est√° correto, porque eu dirigi o emissor pelo ch√£o sem retir√°-lo. <br><br>  E aqui est√° um exemplo de uma passagem malsucedida de uma plataforma m√≥vel com um emissor, sua trajet√≥ria √© claramente vis√≠vel.  De acordo com o plano, a plataforma deveria retornar ao ponto de partida, tendo passado por um caminho retangular, mas n√£o deu certo, nos artigos a seguir, explicarei por qu√™. <br><br><img src="https://habrastorage.org/webt/qj/nu/ez/qjnuezuiq9q3idwssbngqbdeqoc.png"><br>  Fig.  12 - A trajet√≥ria de movimento da plataforma m√≥vel. <br><br><h3>  Problemas reais </h3><br>  Atualmente, tenho v√°rios problemas urgentes e, se algu√©m puder sugerir algo, escreva nos coment√°rios ou no VK: <br>  <a href="https://vk.com/b__s__v" rel="nofollow">vk.com/b__s__v</a> <br><br>  1. <b>Qual √© a melhor maneira de receber um sinal de ultrassom?</b>  Os sensores HC-SR04 que agora uso para receber e amplificar um sinal de ultrassom n√£o s√£o a melhor op√ß√£o.  Primeiro, porque eles sempre recebem um sinal com apenas uma frequ√™ncia e voc√™ n√£o pode fazer uma separa√ß√£o de frequ√™ncias das fontes de sinal delas (o que √© interessante para mim tentar); al√©m disso, elas s√£o muito volumosas e eu sou muito dependente delas. <br>  2. <b>Como remover distor√ß√µes de coordenadas em diferentes cantos da sala?</b>  Na grade que desenhei no ch√£o, pode-se ver que, √†s vezes, as linhas retas come√ßam a se desviar, embora eu sempre movesse o m√≥dulo m√≥vel sem problemas e, de alguma forma, precisasse me livrar dele. <br>  3. <b>Para o nRF24, o sinal desaparece.</b>  Quando os m√≥dulos est√£o pr√≥ximos, n√£o h√° problemas, mas vale a pena estend√™-los alguns metros e ficar entre eles, √† medida que as mensagens chegam atrav√©s de um.  N√£o preciso reenviar mensagens para l√°, porque transmito sinais de rel√≥gio neste canal e eles devem sempre aparecer no mesmo segundo.  Eu tenho m√≥dulos com uma antena externa, e o m√≥dulo base funciona melhor sem uma antena do que com ela.  Eu n√£o entendo nada, a pot√™ncia √© m√°xima. <br>  4. <b>Locais de promo√ß√£o do projeto.</b>  Se algu√©m conhece sites internacionais como o Habr em ingl√™s, descarte os links; caso contr√°rio, n√£o encontrei nada decente, mas o stackoverflow, s√£o apenas perguntas e respostas, n√£o exatamente para publicar esses artigos. <br>  5. <b>Coment√°rios e sugest√µes.</b>  Se algu√©m quiser falar, terei prazer em receber cr√≠ticas e sugest√µes. <br><br>  Isso est√° longe do final do meu projeto, embora o tempo esteja chegando ao fim, mas se houver interesse, escreverei um artigo sobre como um rob√¥ m√≥vel viaja com base nesse sistema nas coordenadas fornecidas no meu quarto. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt479530/">https://habr.com/ru/post/pt479530/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt479514/index.html">Privacidade por design e privacidade por padr√£o (prote√ß√£o de dados projetada e privacidade padr√£o pelo GDPR)</a></li>
<li><a href="../pt479516/index.html">O que √© entropia no software e como gerenci√°-lo?</a></li>
<li><a href="../pt479518/index.html">A comunica√ß√£o dentro de uma equipe remota √© a nossa experi√™ncia</a></li>
<li><a href="../pt479522/index.html">Editora Peter. Venda de inverno</a></li>
<li><a href="../pt479524/index.html">Servi√ßo de Restaura√ß√£o Ativa ou o hist√≥rico de um projeto industrial em Innopolis</a></li>
<li><a href="../pt479534/index.html">Kubernetes 1.17 - como atualizar e n√£o gastar todo o or√ßamento de erros</a></li>
<li><a href="../pt479536/index.html">Balanceamento de carga no Zimbra Open-Source Edition com HAProxy</a></li>
<li><a href="../pt479538/index.html">A tecnologia est√° levando a humanidade ao decl√≠nio. √â hora de mudar alguma coisa</a></li>
<li><a href="../pt479540/index.html">Usando passwordstore.org - gerenciador de senhas no estilo KISS</a></li>
<li><a href="../pt479542/index.html">Como escrever seu pr√≥prio transliterador</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>