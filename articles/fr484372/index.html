<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∑Ô∏è üì° üéÖ Maison intelligente avec Xiaomi sur l'exemple d'un sauna ‚åöÔ∏è üë¨ üïó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a pas mal de critiques et de vid√©os sur Internet sur la construction de maisons intelligentes. Il y a une opinion que tout cela est assez cher et...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Maison intelligente avec Xiaomi sur l'exemple d'un sauna</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484372/">  Il y a pas mal de critiques et de vid√©os sur Internet sur la construction de maisons intelligentes.  Il y a une opinion que tout cela est assez cher et g√™nant dans l'organisation, c'est-√†-dire, en g√©n√©ral, le sort des geeks.  Mais les progr√®s ne sont pas en reste.  Les appareils deviennent moins chers et plus fonctionnels, et la conception et l'installation sont assez simples.  Cependant, les critiques se concentrent principalement sur 1-2 exemples d'utilisation, ne couvrant pratiquement pas les nuances et ne cr√©ant pas une image compl√®te.  Par cons√©quent, dans cet article, je veux faire un aper√ßu du projet termin√©, d√©montrer les cas d'utilisation et les pi√®ges rencontr√©s dans la construction d'une maison intelligente avec des appareils Xiaomi sur l'exemple d'un sauna.  Les id√©es d√©crites avec de petites variations peuvent √©galement √™tre appliqu√©es √† l'automatisation de l'appartement. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9h/lb/tj/9hlbtjf6rdghf--lzwsq-5bysk8.jpeg" alt="image"></div><br><h2>  Contexte ou pourquoi tout cela est n√©cessaire </h2><br>  Pour commencer, un peu de fond pour que le contexte puisse √™tre compris.  Au d√©but de l'automne 2018, le sauna √©tait termin√© et mis en service.  Le sauna est une structure de capital autonome avec chauffage et approvisionnement en eau toute l'ann√©e. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ns/wd/o5/nswdo5svyprgue1sgxhojmb83kk.jpeg" alt="image"></div><a name="habracut"></a><br>  Pour des raisons compr√©hensibles, personne ne vit en permanence dans les bains et ne contr√¥le pas l'√©tat des lieux.  Autant que je voudrais, visiter les bains publics n'est pas non plus tr√®s fr√©quent.  En cons√©quence, des r√©flexions sur la cr√©ation d'un bain "intelligent" √©taient pr√©sentes d√®s le d√©but du projet.  Tout d'abord, pour des raisons de s√©curit√© (incendie, inondation, contr√¥le d'acc√®s).  Par exemple, √©teindre le chauffage √† -35 degr√©s √† l'ext√©rieur (j'habite √† Novossibirsk) est une situation tr√®s dangereuse.  Cependant, contrairement √† la maison principale, je n'ai pas r√©fl√©chi au projet d'automatisation de la baignoire depuis le d√©but et je n'ai pas fait de c√¢blage suppl√©mentaire aux bons endroits.  D'autre part, le bain a √©t√© r√©alis√© par Internet, et l'apparition des deux autres b√¢timents est une surveillance vid√©o (vous pouvez √©valuer ce qui se passe visuellement). <br><br>  De retour d'un voyage d'affaires en novembre 2019, le soir je suis all√© aux bains publics, j'ai ouvert la porte d'entr√©e et j'ai √©t√© choqu√© par ce que j'ai vu.  Les LED du point WiFi clignotaient dans l'obscurit√© et un jet d'eau coulait sur mes pieds.  Il y a donc eu des inondations et le courant n'a pas √©t√© coup√©.  L'eau dans les bains est organis√©e √† l'aide de son propre puits, d'une pompe submersible et d'un syst√®me d'automatisation contr√¥lant le processus.  Comme il s'est av√©r√© plus tard, l'un des raccords de la jonction des toilettes a √©t√© d√©moli et toutes les pi√®ces ont √©t√© inond√©es.  Je n'ai jamais d√©couvert pourquoi l'automatisation √©tait compatissante et toujours ferm√©e, mais elle a r√©ussi √† pomper 15 cm d'eau par carr√© 30. Il faisait -14 degr√©s √† l'ext√©rieur ce jour-l√†.  Le sol chaud a r√©ussi √† maintenir la temp√©rature ambiante au bon niveau, mais il y avait 100% d'humidit√©.  Vous ne pouviez pas vous faufiler dans l'organisation d'une maison intelligente - vous devez commencer √† le faire. <br><br><h2>  Choix d'appareils </h2><br>  Pendant la construction de la maison principale, j'ai acquis une exp√©rience de travail avec les appareils Eldes (le c√¢blage appropri√© a √©t√© cr√©√©).  Une partie de l'automatisation se fait sur <a href="https://www.raspberrypi.org/">Raspberry PI</a> .  Une autre partie est faite sur les <a href="https://www.aqara.com/us/home.html">appareils Xiaomi Aqara</a> .  La variante avec Raspberry PI √©tait celle que j'aimais le plus et je l'ai d'abord envisag√©e pour le bain.  Mais, malheureusement, il faut beaucoup plus d'efforts pour s'organiser.  Ce n'est pas un appareil plug-and-play apr√®s tout - des exercices avec du fer √† √©crire des logiciels pour vos propres besoins.  Pour certaines raisons, MajorDoMo n'en √©tait pas satisfait.  Crossing Raspberry PI, ZigBee Adapter (pour utiliser les capteurs sans fil Xiaomi) et Apple HomeKit ont n√©cessit√© un apprentissage (et l'interface Apple HomeKit n'est pas tr√®s heureuse pour le moment).  Il n'y avait pas beaucoup de temps (je ne voulais pas que la situation se r√©p√®te) et il n'y avait pas de c√¢blage pour chaque point n√©cessaire, j'ai donc d√©cid√© de tout faire sur les appareils Xiaomi. <br><br>  Le p√©riph√©rique principal dans cette situation est le concentrateur.  Dans le cas de Xiaomi, il existe deux versions du concentrateur: Xiaomi Mi Smart Home Gateway 2 et Xiaomi Aqara Gateway.  Ce dernier est environ deux fois plus cher, plus adapt√© au march√© local et capable d'int√©grer des appareils dans Apple HomeKit.  Cependant, si vous installez l'application Aqara Home et s√©lectionnez la r√©gion "Russie", au moment de la r√©daction de ces lignes, seuls 13 appareils diff√©rents (interrupteurs, prises, capteurs) seront disponibles.  Si vous installez l'application Xiaomi Home, s√©lectionnez la r√©gion "Chine continentale", puis il y aura des centaines d'appareils disponibles pour la connexion.  Cependant, si vous s√©lectionnez la r√©gion "Chine continentale", vous ne pourrez pas connecter la prise europ√©enne et vice versa.  La s√©lection de la r√©gion ¬´Chine continentale¬ª dans l'application Aqara Home ne donne pas l'int√©gralit√© des appareils qui sont pr√©sents dans Xiaomi Home avec la m√™me r√©gion.  Craignant des incompatibilit√©s, j'ai d√©cid√© de m'arr√™ter au hub Xiaomi Mi Smart Home Gateway 2.  Soit dit en passant, le moyeu lui-m√™me est une lampe - cela peut √™tre pris en compte lors de l'installation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vs/ul/kx/vsulkxlnghjjindbwwmxw9aemxq.jpeg" alt="image"></div><br>  Une autre question int√©ressante est de savoir combien de temps cela va fonctionner.  Il ne s'agit m√™me pas de capteurs et de batteries, mais de synchronisation et de stockage de donn√©es dans le cloud.  Pour le moment, le compte est gratuit.  Toutes les informations sont stock√©es sur les serveurs Xiaomi.  Si demain les gars d√©cident que les utilisateurs de Russie ne devraient pas stocker de donn√©es dans la r√©gion "Chine continentale" ou que Roskomnadzor, pour une raison quelconque, bannira leurs serveurs, toute la maison intelligente risque de se transformer en citrouille.  J'ai d√©cid√© moi-m√™me que dans ce cas, les capteurs resteront et le concentrateur sera remplac√© par l'adaptateur Raspberri PI + ZigBee. <br><br><h2>  Surveillance et pr√©vention des fuites </h2><br>  Le premier et le plus important sc√©nario d'automatisation √©tait une continuation naturelle du probl√®me - lorsqu'une fuite se produit, l'alimentation en eau, c'est-√†-dire la pompe, doit √™tre coup√©e et une alerte de probl√®me doit √™tre envoy√©e au t√©l√©phone.  Il y avait deux emplacements de fuite potentiellement dangereux. <br><br>  En plus du concentrateur, ce sc√©nario n√©cessitait deux d√©tecteurs de fuite et une prise murale intelligente.  Les capteurs de fuite sont autonomes et fonctionnent sur piles.  Le constructeur affirme qu'une seule batterie suffira pendant 2 ans. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bt/d3/q2/btd3q2gftpvfsf_drdszmsisfwm.jpeg" alt="image"></div><br>  L'installation d'une prise intelligente √©tait un peu compliqu√©e par le fait que sous les prises chinoises, vous avez besoin de prises carr√©es, qui ne sont pas vendues dans nos magasins habituels (mais vous pouvez les apporter sur commande). <br><br>  Percer des trous carr√©s est toujours un plaisir.  De plus, vous avez besoin d'un adaptateur dans le bon sens, bien qu'il existe √©galement une prise pour la prise europ√©enne.  La version Aqara pour le march√© local n'a actuellement pas de prise murale, ce qui nous relie √† la r√©gion "Chine continentale".  Alternativement, vous pouvez installer une prise murale normale et y brancher une prise intelligente Xiaomi, mais cela n√©cessiterait deux adaptateurs suppl√©mentaires.  Une autre alternative √©tait un relais.  Mais je me suis arr√™t√© √† une prise murale. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qe/rg/pg/qergpgrjkaqqosy5xr2pqc_hli8.jpeg" alt="image"></div><br>  Dans l'application Xiaomi Home, une prise et un capteur ont √©t√© ajout√©s.  Ensuite, un sc√©nario "en cas de fuite" est √©crit pour deux actions: d√©sactiver le socket et envoyer une alerte. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p7/pj/ub/p7pjubzhpjzb6tt_aoxrdd20_fs.jpeg" alt="image"></div><br>  Le premier capteur de fuite a √©t√© install√© √† c√¥t√© de la pompe (et, en fait, √† c√¥t√© du moyeu).  Pour le test, de l'eau a √©t√© vers√©e dans une petite plaque et le capteur y a √©t√© abaiss√©.  J'ai fait toute l'action directement √† l'endroit o√π le capteur a √©t√© install√© pour rapprocher le plus possible la situation.  Le test a r√©ussi: la prise a √©t√© d√©branch√©e, l'alarme est venue sur le t√©l√©phone, plus le hub a clignot√© en mode d'urgence. <br><br>  Le deuxi√®me d√©tecteur de fuite devait √™tre install√© dans les toilettes pr√®s de la jonction des tuyaux.  Mais avec son installation, il y avait des nuances - le moyeu n'a pas vu le capteur, bien que la distance soit petite.  La faute √©tait la configuration des locaux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ce/33/gb/ce33gbivdrkzwq2f4t-vghi69ki.jpeg" alt="image"></div><br>  Entre le lieu d'installation du moyeu (salle de repos) et le lieu d'installation du deuxi√®me capteur de fuite (WC) il y avait un hammam.  Dans les meilleures traditions, le hammam √©tait cousu dans un cercle de papier d'aluminium, cr√©ant des probl√®mes avec le passage du signal. <br><br>  Le fabricant affirme que les appareils peuvent former un r√©seau maill√©, c'est-√†-dire qu'un appareil peut transmettre des donn√©es au concentrateur via un autre appareil.  J'ai vu quelque part des informations selon lesquelles seuls les appareils connect√©s au r√©seau (et non aliment√©s par batterie) peuvent agir en tant que tels √©metteurs sur le r√©seau maill√©.  Cependant, il me suffisait d'installer un capteur de temp√©rature dans le coin de la salle de bain pour que le signal du capteur de fuite ne soit plus perdu.  C'est peut-√™tre une co√Øncidence car un relais de contr√¥le d'√©clairage public a √©t√© install√© sous le plafond dans la salle de lavage (peut-√™tre qu'il agit comme un √©metteur dans le r√©seau maill√©).  Cependant, le probl√®me de la perte de signal du d√©tecteur de fuite dans les toilettes a √©t√© r√©solu.  De plus, la connexion de l'instrument au moyeu peut √™tre v√©rifi√©e en poussant le capteur au centre.  Si tout va bien, vous entendrez les informations du hub en chinois pur (dans le cas du hub Aqara, la communication est en anglais agr√©able). <br><br>  Une v√©rification pour voir si l'alimentation a √©t√© coup√©e puis rallum√©e au moyen de la machine montre que la prise intelligente s'√©teint.  Il existe un param√®tre appropri√© pour qu'il continue lorsque l'appareil est mis sous tension: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7m/mp/rv/7mmprvrfrwirqrveigp5hk5rbna.jpeg" alt="image"></div><br>  Un signe suppl√©mentaire d'inondation a √©t√© une augmentation de l'humidit√© √† 100%.  Veuillez vous r√©f√©rer √† la section suivante sur le contr√¥le de ce signe. <br><br><h2>  Contr√¥le de la fum√©e et de la temp√©rature </h2><br>  Un sauna √©tant une pi√®ce √† risque d'incendie, le sc√©nario suivant consistait √† d√©terminer les signes d'incendie.  Pour ce sc√©nario, deux d√©tecteurs de temp√©rature (et d'humidit√©) et de fum√©e √©taient n√©cessaires. <br><br>  Le capteur de fum√©e √©tait mont√© sur le plafond du couloir dans la salle de bain (en fait pr√®s du po√™le et de la sortie du hammam).  De plus, un appareil a √©t√© ajout√© √† l'application Xiaomi Home et un script "en cas de d√©tection de fum√©e" a √©t√© cr√©√©, suivi d'une notification au t√©l√©phone.  Le test a √©t√© effectu√© avec une allumette de chemin√©e.  Le capteur a r√©ussi le test.  Le concentrateur bloquait l'alarme et une alerte sonore fonctionnait.  Le capteur lui-m√™me √©tait √©galement tr√®s m√©chant et √©mettait un bip sonore, signalant un probl√®me. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zg/ej/jg/zgejjg01wv9ayueq8tzptcumzs8.jpeg" alt="image"></div><br>  Un autre signe d'incendie est une augmentation de la temp√©rature.  Deux capteurs ont √©t√© install√©s pour surveiller la temp√©rature: un dans la salle de pause et l'autre dans la salle de lavage.  Ensuite, un sc√©nario "en cas de temp√©rature sup√©rieure au point de consigne" a √©t√© mis en place dans l'application avec une notification correspondante sur le t√©l√©phone.  Pour le moment, j'ai d√©fini le seuil de d√©clenchement de la salle de repos √† 30 degr√©s (en √©t√©, il devra probablement √™tre reconfigur√©). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nq/0w/pj/nq0wpjrfwe3nsl6hfpnjxwsuzhq.jpeg" alt="image"></div><br>  En outre, il a √©t√© configur√© le sc√©nario "en cas de temp√©rature inf√©rieure √† un pr√©r√©glage" avec un seuil de d√©clenchement de 18 degr√©s et un avertissement sur le t√©l√©phone.  Si, pour une raison quelconque, le chauffage cesse de fonctionner, j'aimerais en √™tre inform√© d√®s que possible.  De m√™me, les sc√©narios "en cas de remont√©e d'humidit√©" ont √©t√© cr√©√©s pour les deux capteurs avec un seuil de d√©clenchement de 70%, un avertissement sur le t√©l√©phone et l'arr√™t de la pompe √† eau. <br><br>  Des bonus int√©ressants sur les capteurs de temp√©rature et d'humidit√©, des graphiques historiques sont disponibles dans l'application.  Vous pouvez, par exemple, d√©terminer √† quels moments le bain a √©t√© utilis√© aux fins pr√©vues (pics de temp√©rature dans le graphique ci-dessous) ou comparer si la temp√©rature actuelle est anormale. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cf/tb/av/cftbaviejmlpp8nndfwizm6un60.jpeg" alt="image"></div><br><h2>  Contr√¥le de la ventilation </h2><br>  Le hammam a une hotte aspirante forc√©e.  Apr√®s avoir termin√© les proc√©dures, il est souhaitable d'a√©rer la pi√®ce.  La ventilation est activ√©e au moyen d'un interrupteur √† cl√©, et la ventilation elle-m√™me prend au moins 30 minutes.  Cependant, le sauna se termine souvent √† la premi√®re ou √† la deuxi√®me heure de la nuit.  Il n'est pas toujours possible de tout faire √† l'avance et de s'asseoir au bout de 30 minutes suppl√©mentaires et d'attendre que le hammam soit a√©r√© - le plaisir est en dessous de la moyenne car vous voulez d√©j√† dormir. <br><br>  Pour ce sc√©nario, nous avions besoin d'un interrupteur √† cl√© de Xiaomi avec une ligne z√©ro et un montage mural.  Le prix de la question est d'environ 1900 p.  Les commutateurs sont disponibles dans la version d'Aqara pour le march√© local. <br><br>  Dans mon cas, vous ne pouvez pas simplement remplacer un interrupteur normal par un intelligent - une ligne √©lectrique est requise.  En cons√©quence, il √©tait n√©cessaire de tirer une ligne z√©ro vers l'ouverture d'installation pour le commutateur, c'√©tait une bonne opportunit√©.  Dans le cas d'un disjoncteur sans ligne z√©ro, l'installation aurait √©t√© plus facile. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q0/k2/p-/q0k2p-qvozvt_zk3e-i407jprhk.jpeg" alt="image"></div><br>  Apr√®s l'installation, le commutateur intelligent a √©t√© ajout√© √† l'application en tant que p√©riph√©rique et les performances ont √©t√© test√©es.  Les param√®tres de commutation ont une minuterie et vous pouvez r√©gler l'heure d'arr√™t.  Autrement dit, la minuterie d'arr√™t est maintenant r√©gl√©e pour 30 minutes suppl√©mentaires de ventilation avant de quitter le sauna, et vous pouvez vous coucher en toute tranquillit√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9e/4c/5g/9e4c5gckmsp0dsiekxkbvhk5imk.jpeg" alt="image"></div><br>  Une autre option est possible pour automatiser le processus.  Une fois les proc√©dures de bain termin√©es, la porte du hammam s'ouvre compl√®tement en plus de la ventilation.  Il en r√©sulte une augmentation de la temp√©rature dans la salle de lavage, o√π un capteur de temp√©rature est install√©.  Sur la base de ces lectures de capteur, il est possible de cr√©er des sc√©narios de ventilation marche / arr√™t.  Mais je n'ai pas encore ex√©cut√© cette option.  De plus, vous pouvez exp√©rimenter avec le capteur pour ouvrir la porte du hammam.  Mais j'ai peur qu'il meure rapidement ou tombe, car la porte est en verre et le hammam peut √™tre √† 120 degr√©s. <br><br><h2>  Contr√¥le d'√©clairage public </h2><br>  Une autre t√¢che que nous voulions automatiser √©tait de contr√¥ler l'√©clairage public de la v√©randa.  L'un des sc√©narios typiques consiste √† allumer la lumi√®re sur la v√©randa lorsque vous n'√™tes pas loin du b√¢timent et qu'il fait sombre √† l'ext√©rieur.  Le sauna est verrouill√©, l'interrupteur d'√©clairage public est √† l'int√©rieur de la pi√®ce.  Il fallait suivre la cl√© pour ouvrir la porte et allumer la lumi√®re.  √âteindre les lumi√®res a n√©cessit√© une proc√©dure similaire.  Un autre sc√©nario qui se produisait r√©guli√®rement √©tait d'allumer ou d'√©teindre les lumi√®res de la v√©randa lorsque vous √©tiez dans la maison principale.  J'ai souvent oubli√© d'√©teindre les lumi√®res de la v√©randa en sortant du sauna et j'ai constat√© que j'√©tais d√©j√† dans la maison: soit en regardant par la fen√™tre, soit en regardant les cam√©ras de s√©curit√©.  √Ä ce moment-l√†, j'√©tais g√©n√©ralement r√©ticent √† aller n'importe o√π, donc les lumi√®res se sont allum√©es toute la nuit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cc/tg/ex/cctgexbilx-hsr-tomjp9cs0gl8.jpeg" alt="image"></div><br>  Un relais √† deux canaux a √©t√© achet√© pour mettre en ≈ìuvre cette id√©e.  Le prix de la question est d'environ 2000 p.  Il n'y a pas de relais dans la version d'Aqara pour le march√© local pour le moment.  Mais il peut √™tre remplac√© par un interrupteur √† cl√© (il est clair que son installation dans le bo√Ætier distributeur est un processus plus g√™nant). <br><br>  Au d√©part, je devais monter le relais derri√®re l'interrupteur √† cl√©, mais il √©tait tr√®s difficile d'atteindre la ligne √©lectrique (le relais a encore besoin de puissance).  L'endroit id√©al est la bo√Æte de jonction o√π convergent la ligne √©lectrique, la ligne du disjoncteur et la ligne des r√©verb√®res.  Il √©tait sous un faux plafond, il a donc d√ª d√©monter certains rails de voiture.  Il √©tait souhaitable de r√©fl√©chir √† l'avance √† ce point.  Cependant, l'installation a r√©ussi.  Le sch√©ma de c√¢blage est beaucoup plus compliqu√© que pour les prises et interrupteurs (dans mon cas, quatre fils √† 3 conducteurs et 8 bornes sur le relais lui-m√™me).  Afin de ne pas le garder dans ma t√™te et de ne rien m√©langer, j'ai peint le sch√©ma √©lectrique sur papier avant de le monter.  Ensuite, j'ai fait un montage d'essai pour tout v√©rifier: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bz/n5/gd/bzn5gdba_obeh-ja73lxl2fdvjc.jpeg" alt="image"></div><br>  L'appareil a √©t√© branch√© sur l'application et la phase de test a commenc√©.  Les r√©verb√®res ont d√ª √™tre allum√©s / √©teints avec l'interrupteur √† cl√© pr√©c√©dent et l'application.  Il y a deux lampadaires, un √† gauche et un √† droite.  Le relais a deux canaux, mais cela n'avait aucun sens de les activer s√©par√©ment.  D'un autre c√¥t√©, vous ne vouliez pas non plus les activer alternativement avec deux clics dans l'application.  Le contr√¥le a donc √©t√© effectu√© sur un canal du relais.  Par une √©trange co√Øncidence, cette option ne fonctionnait pas normalement - il y avait un blocage dans l'une ou l'autre position.  Il n'y avait pas de temps pour les exp√©riences, car la journ√©e √©tait finie et nous voulions remonter la voiture au plafond.  J'ai donc simplement accroch√© les lanternes parall√®lement aux deux canaux et tout a fonctionn√© comme souhait√©.  Afin de faire fonctionner le commutateur physique et logiciel comme un commutateur de passerelle, l'option de verrouillage a √©t√© activ√©e dans les param√®tres du relais. <br><br>  Il serait √©galement possible d'organiser l'allumage / extinction des lumi√®res par minuterie.  Mais ce sc√©nario n'√©tait pas encore int√©ressant. <br><br><h2>  Contr√¥le d'acc√®s √† la salle </h2><br>  Un autre moment curieux a √©t√© le contr√¥le de l'ouverture de la porte de la rue.  Tout d'abord, pour d√©terminer et notifier que quelqu'un avait oubli√© cette porte m√™me normalement claqu√©e ou laiss√©e ouverte du tout. <br><br>  Pour ce sc√©nario, un capteur de fen√™tre / porte ouverte √©tait requis.  Le prix de la question est d'environ 1000 p.  Il existe des capteurs en version Aqara pour le march√© local (ils ont des bords moins arrondis). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pb/fy/id/pbfyidivjmpgggpxrwxowgeq-h8.jpeg" alt="image"></div><br>  L'installation est tr√®s simple - les capteurs sont mont√©s sur du ruban adh√©sif double face.  Avant le montage, il est pr√©f√©rable de connecter le capteur dans l'application pour voir √† quelle distance le capteur est d√©clench√©.  Les instructions indiquent jusqu'√† 20 mm de d√©gagement, mais ce n'est pas le moins du monde - le capteur et l'aimant de r√©ponse doivent √™tre mont√©s presque √©troitement.  Dans la maison principale, la porte de garage a un capteur similaire.  Il y a un joint de 1 cm de large entre le rail de guidage et la porte.  √Ä cette distance, le capteur a montr√© une position "ouverte" et l'aimant de r√©ponse a d√ª √™tre augment√©. <br><br>  Une fois qu'un nouvel appareil a √©t√© ajout√© √† l'application, vous pouvez passer √† l'automatisation.  Configurez le sc√©nario "si la porte est ouverte pendant plus d'une minute" avec une alarme sur le t√©l√©phone.  Dans la localisation en anglais, vous ne pouvez pas voir la partie de la phrase environ 1 minute, mais le seuil de d√©clenchement est le suivant.  Dans la variante du capteur Aqara et de l'application Aqara Home, vous pouvez configurer d'autres intervalles de d√©clenchement.  Dans l'application Xiaomi Home, malheureusement, il n'est pas encore possible de le faire.  Mais la pratique a montr√© que l'intervalle de 1 minute est plus que suffisant - il n'y a pas de fausses alarmes, toutes les alarmes √©taient sur le bo√Ætier.  Vous pouvez √©galement consulter les journaux par capteurs.  Ce capteur ne fait pas exception non plus.  Vous pouvez, par exemple, √† partir du journal pour d√©terminer quand le bain est arriv√© (premi√®re ouverture de la porte un jour donn√©) et quand il est parti (derni√®re fermeture de la porte), estimant ainsi le temps total pass√© dans la pi√®ce. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wk/uv/ry/wkuvryxsyoah4u-7dwoj0yct9a4.jpeg" alt="image"></div><br><h2>  Impressions d'utilisation </h2><br>  L'exp√©rience globale de l'exploitation est purement positive.  Bien s√ªr, il y a quelques nuances mineures, mais l'objectif principal de l'automatisation est atteint.  Tout d'abord, c'est la tranquillit√© d'esprit psychologique, confirm√©e par les r√©sultats des tests.  √âgalement important et confortable - a re√ßu la t√©l√©commande de l'√©clairage public, la hotte aspirante, il y a une veilleuse suppl√©mentaire.  Apr√®s √™tre parti en vacances, il est possible de se souvenir et √† distance de couper l'eau. <br><br>  Les co√ªts de tous les appareils ci-dessus sous forme approximative (sans r√©f√©rence √† un magasin particulier) sont indiqu√©s ci-dessous.  Lors de la commande avec AliExpress, les prix diff√©reront dans une direction plus petite. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i9/ij/pf/i9ijpffhxd2i-jaq00ieo58eupo.png" alt="image"></div><br>  Lors du choix d'un ensemble d'√©quipements, vous devez tenir compte de la compatibilit√© (pour quelle r√©gion l'√©quipement a √©t√© fabriqu√© et √† quelle famille il appartient).  Il ne sera pas possible de cr√©er un sc√©nario dans l'application qui, par exemple, contr√¥lera une prise pour une r√©gion europ√©enne en fonction d'un √©v√©nement de d√©tecteur de fum√©e (pour la r√©gion de Chine continentale).  Si vous n'avez pas besoin du type de capteur de fum√©e exotique, il est pr√©f√©rable de regarder les appareils Aqara pour le march√© local.  Apr√®s tout, le relais peut √™tre remplac√©, par exemple, par un interrupteur √† deux touches.  Un certain nombre de magasins vendant des appareils Xiaomi semblent les importer en gris (ces appareils sont destin√©s √† la r√©gion chinoise).  Mais, par exemple, Svyaznoy, il existe des appareils con√ßus pour notre march√©.  Outre la compatibilit√© des m√™mes prises, ils auront √©galement des instructions en anglais et en russe.  Voici des photos de deux capteurs identiques, mais pour diff√©rentes r√©gions: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uw/ph/x_/uwphx_titz3r1-hhwlduqxmzlwg.jpeg" alt="image"></div><br>  La r√©activit√© du contr√¥le via une application n'est pas toujours bonne.  Par exemple, vous pouvez parfois rencontrer une situation dans laquelle vous obtenez une erreur ¬´√âchec de la demande¬ª au lieu d'allumer la lumi√®re l'une apr√®s l'autre.  Le traitement d√©tect√© exp√©rimentalement - d√©charger l'application de la m√©moire et la red√©marrer - r√©sout ce probl√®me plus rapidement que d'attendre une r√©ponse √† la prochaine tentative.  Il y a aussi parfois des retards notables (jusqu'√† 20-30 secondes) avec la mise √† jour de l'√©tat d'un capteur particulier.  √Ä ces moments, il est pr√©f√©rable de ne pas appuyer √† nouveau sur les boutons marche / arr√™t, mais simplement d'attendre la mise √† jour de l'√©tat.  Lors du d√©marrage de l'application, dans certaines situations, vous pouvez voir une liste vierge au lieu de la liste des p√©riph√©riques.  Il n'y a pas lieu de paniquer - il appara√Æt g√©n√©ralement dans les prochaines secondes.  Les alertes sur le t√©l√©phone ne sont pas localis√©es et enregistrent le nom correct des √©v√©nements eux-m√™mes.  De plus, les auteurs de l'application utilisent p√©riodiquement le canal push-alert pour la publicit√© (toujours en chinois).  Bien s√ªr, je n'aime pas √ßa, mais je n'ai pas beaucoup de choix. <br><br>  J'esp√®re que cet article a aid√© √† se faire une bonne id√©e des capacit√©s d'un certain nombre d'appareils Xiaomi pour construire une maison intelligente et des sc√©narios pour leur application pratique.  Si vous avez encore des questions, des corrections et des ajouts, je serai heureux d'en discuter dans les commentaires. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484372/">https://habr.com/ru/post/fr484372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484356/index.html">Un projet int√©ressant dans une √©quipe sympathique, ou combien co√ªte le bon employ√©?</a></li>
<li><a href="../fr484358/index.html">Gestion de portefeuille en R</a></li>
<li><a href="../fr484364/index.html">√Ä 26 ans, Yana Harlan dirige le d√©veloppement d'un moteur spatial. L'ann√©e prochaine, ils pr√©voient de le lancer.</a></li>
<li><a href="../fr484368/index.html">Comment j'ai fait un moteur de recherche pour Telegram</a></li>
<li><a href="../fr484370/index.html">Slurm SRE - apprenez √† assurer le bonheur des utilisateurs</a></li>
<li><a href="../fr484374/index.html">Voyage au centre ... image docker. Ou comment t√©l√©charger une image du registre sans docker</a></li>
<li><a href="../fr484376/index.html">Samsung Moscow Center for Artificial Intelligence in stories des employ√©s</a></li>
<li><a href="../fr484378/index.html">SwayWM - UnixPorn vous-m√™me</a></li>
<li><a href="../fr484380/index.html">D√©m√©nagement - le si√®cle dernier! Alternatives √† std :: move dans ¬´C ++ of the Future¬ª</a></li>
<li><a href="../fr484382/index.html">Algorithme de Bellman-Ford</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>