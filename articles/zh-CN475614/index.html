<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔹 🧙🏻 🙇🏿 最小的自动化。 第二部分。 网络设计 🔃 🌨️ 🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在前两篇文章中，我提出了自动化的问题并概述了其框架，在第二篇文章中，我将重点放在网络虚拟化上，这是使服务配置自动化的第一种方法。 
 现在是时候绘制物理网络图了。 

 如果您对数据中心网络的设备不满意，那么我强烈建议您从有关它们的文章开始。 

 所有问题： 



- 0. ADSM。 零部分。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>最小的自动化。 第二部分。 网络设计</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475614/"> 在前两篇文章中，我提出了自动化的问题并概述了其框架，在第二篇文章中，我将重点放在网络虚拟化上，这是使服务配置自动化的第一种方法。 <br> 现在是时候绘制物理网络图了。 <br><br> 如果您对数据中心网络的设备不满意，那么我强烈建议您从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">有关它们</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文章</a>开始。 <br><br> 所有问题： <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">0. ADSM。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">零部分。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">规划中</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1. ADSM。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第一部分（零之后）。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">网络虚拟化</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2. ADSM。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第二部分。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">网络设计</a> </li></ul><br> 本系列中描述的实践应适用于任何类型，规模，任何厂商的网络（否）。 但是，无法描述这些方法的通用示例。 因此，我将重点介绍DC网络的现代体系结构： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Klose Factory</a> 。 <br>  DCI将在MPLS L3VPN上运行。 <br><br> 来自主机的覆盖网络运行在物理网络的顶部（可以是OpenStack VXLAN或Tungsten Fabric或仅需要网络中的基本IP连接的其他任何东西）。 <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e13/b5a/aa8/e13b5aaa8e2c2161e75084de878ed741.jpg" width="600"></a> <br><br> 在这种情况下，我们得到了一个相对简单的自动化方案，因为我们有许多以相同方式配置的设备。 <br><br> 我们将在真空中选择球形DC： <br><br><ul><li> 设计的一个版本随处可见。 </li><li> 两个供应商组成了网络的两个平面。 </li><li> 一个DC就像另一个DC，就像两滴水。 </li></ul><br><hr><br><a name="habracut"></a><br><h1> 目录内容 </h1><br><ul><li>  <b>物理拓扑</b> </li><li>  <b>路由选择</b> </li><li>  <b>知识产权计划</b> </li><li>  <b>拉巴</b> </li><li>  <b>结论</b> </li><li>  <b>有用的链接</b> </li></ul><br> 例如，让我们的LAN_DC服务提供商主持有关卡住的电梯中生存情况的培训视频。 <br><br> 在超大城市中，它非常流行，因此有很多物理机器。 <br><br> 首先，我将大致按照自己的意愿描述网络。 然后，我将其简化为实验室。 <br><br><hr><br><br><h1> 物理拓扑 </h1><br><h2> 地点 </h2><br>  LAN_DC将具有6个DC： <br><ul><li> 俄罗斯（ <b>RU</b> ）： <br><ul><li> 莫斯科（ <b>msk</b> ） </li><li> 喀山（ <b>kzn</b> ） </li></ul><br></li><li> 西班牙（ <b>SP</b> ）： <br><ul><li> 巴塞罗那（ <b>bcn</b> ） </li><li> 马拉加（ <b>mlg</b> ） </li></ul><br></li><li> 中国（ <b>CN</b> ）： <br><ul><li> 上海（ <b>沙</b> ） </li><li> 西安（ <b>sia</b> ） </li></ul><br></li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/c79/5f3/6f3/c795f36f3eb1553eaf32f909d570ed16.png" width="800"><br><hr><br><br><h2> 内部DC（内部DC） </h2><br> 在所有DC中，基于Clos拓扑的相同内部连接网络。 <br>  Klose是什么样的网络？为什么在单独的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文章中介绍</a>它们。 <br><br> 在每个配送中心中，有10个装有汽车的机架，它们将分别编号为<b>A</b> ， <b>B</b> ， <b>C</b>等。 <br><br> 每个机架有30辆车。 他们不会对我们感兴趣。 <br><br> 同样，在每个机架中都有一个交换机，所有机器都连接到该交换机-这是<b>机架顶部的交换机-ToR，</b>或者就Klose工厂而言，我们将其称为<b>Leaf</b> 。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3a/5da/d17/e3a5dad17c7aadf1cf95865deaa8e359.png" width="800"><br>  <i>工厂的总体方案。</i> <br><br> 我们将它们命名为<i><b>XXX</b> -leaf <b>Y</b></i> ，其中<b>XXX</b>是三个字母的缩写DC，而<b>Y</b>是序列号。 例如， <i>kzn-leaf11</i> 。 <br><blockquote> 在文章中，我允许自己轻率地使用术语Leaf和ToR作为同义词。 但是，必须记住，事实并非如此。 <br>  ToR是机器连接到的机架安装式交换机。 <br> 就Clos的拓扑而言，Leaf是设备在物理网络或一级交换机中的角色。 <br> 也就是说，Leaf！= ToR。 <br> 例如，Leaf可以是EndofRaw开关。 <br> 但是，在本文的框架内，我们仍将它们称为同义词。 <br></blockquote> 每个ToR交换机依次连接到四个上游聚合交换机<b>-Spine</b> 。 在Spine'y的领导下，DC分配了一个机架。 我们将以相同的方式命名它： <i><b>XXX</b> -spineY。</i> <br><br> 在同一机架中，将存在用于DC之间连接的网络设备-板载MPLS的2个路由器。 但总的来说-这些是相同的ToR。 也就是说，从骨干交换机的角度来看，是否有连接机器或用于DCI的路由器的普通ToR没关系-这是该死的事情。 <br><br> 这种特殊的ToR称为<b>Edge-leaf</b> 。 我们称它们为<i><b>XXX- edgeY。</b></i> <br><br> 它看起来像这样。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/62c/83f/d27/62c83fd278227f1740e5cf4e64eaed4e.png" width="800"><br><br> 在边缘和叶子上方的图表中，我确实放置在同一水平线上。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">古典的三级网络</a>已教会我们考虑将上行链路（实际上是从此处开始）作为链接。 事实证明，DCI的“上行链路”回落，这在一定程度上破坏了通常的逻辑。 对于大型网络，当将数据中心进一步划分为较小的单元<b>-POD</b> （交付点）时，会为DCI和访问外部网络分配单独的<b>Edge-POD</b> 。 <br><br> 为方便起见，将来我仍将在Edge上使用Edge，同时请记住，在使用普通Leaf和Edge-leaf时，对Spine并没有任何了解（尽管可能会有细微差别，但是总的来说是的。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca5/67d/9db/ca567d9db0c49c3baf63304443477102.png" width="600"><br>  <i>带有叶子的工厂布局。</i> <br><br>  Trinity Leaf，Spine和Edge构成Underlay网络或工厂。 <br><br> 正如我们在上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一期中</a>已经确定的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">那样</a> ，网络工厂的任务（请参阅Underlay）非常非常简单-在同一DC内和之间的机器之间提供IP连接。 <br> 这就是为什么将网络称为工厂的原因，就像模块化网络框内的交换工厂一样，可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SDSM14中</a>找到更多详细<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">信息</a> 。 <br><blockquote> 通常，这种拓扑称为工厂，因为转换中的结构是结构。 很难不同意： <br><img src="https://habrastorage.org/getpro/habr/post_images/7e9/db7/2c3/7e9db72c353e6b5b050eb63de72bb111.png" width="300"><br></blockquote><br> 工厂完全L3。 没有VLAN，没有广播-这些都是LAN_DC上的优秀程序员，他们可以编写生活在L3范式中的应用程序，并且虚拟机不需要实时迁移即可保存IP地址。 <br><br> 再次：在另<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一篇文章中</a> ，对为什么工厂和为什么使用L3的问题的答案。 <br><hr><br><br><h2>  DCI-数据中心互连（Inter-DC） </h2><br>  DCI将使用Edge-Leaf进行组织，也就是说，它们是我们通往高速公路的出口。 <br> 为简单起见，我们假定DC通过直接链接连接。 <br> 我们不考虑外部连接。 <br><blockquote> 我知道每次删除组件都会大大简化网络。 随着抽象网络的自动化，一切都会好起来，但拐杖将出现在真实的网络上。 <br> 就是这样 尽管如此，本系列文章的目的是思考和研究方法，而不是英勇地解决想象中的问题。 <br></blockquote><br> 在Edge-Leafs上，将底层放置在VPN中并通过MPLS主干网（同一直接链路）进行传输。 <br><br> 这是一个顶级方案。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4e/ad7/b78/e4ead7b7898490c29fa93f7375376aa8.png" width="800"><br><br><hr><br><br><h1> 路由选择 </h1><br><br> 对于DC内部的路由，我们将使用BGP。 <br> 在OSPF + LDP MPLS Trunk上 <br> 对于DCI，即下面的连接组织是MPLS上的BGP L3VPN。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a55/3b1/30b/a553b130b286a50fd1c97fe8bb2b5b5b.png" width="800"><br>  <i>通用路由方案</i> <br><br> 工厂没有OSPF和ISIS（俄罗斯联邦禁止路由协议）。 <br><br> 这意味着将没有自动发现和最短路径计算-只有手动（实际上是自动-我们在这里涉及自动化）来设置协议，邻居和策略。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/82b/426/251/82b4262513aeae7c12d6e1618182f272.png" width="600"><br>  <i>DC内部的BGP路由方案</i> <br><br>  <b>为什么选择bgp？</b> <br><br> 在此主题上有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一个</a>名为Facebook和Arista <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的完整RFC</a> ，它说明了如何使用BGP构建<b>非常大</b>的数据中心网络。 它读起来几乎像一本艺术作品，强烈推荐度过一个悠闲的夜晚。 <br><br> 在我的文章中，整个章节都专门讨论了这一点。 我要<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">送你到</a>哪里。 <br><br> 但是，总之，IGP不适用于大型数据中心的网络，在这种情况下，成千上万的网络设备都在使用。 <br><br> 此外，在任何地方都可以使用BGP，因此您无需依赖几种不同协议以及它们之间的同步。 <br><blockquote> 在我们的工厂中，动手做事的可能性很高，而OSPF不会迅速增长，OSPF就足够了。 这些实际上是大型定标器和云泰坦的问题。 但是，让我们想象一下我们需要解决的一些问题，并且正如Peter Lapukhov遗赠的那样，我们将使用BGP。 <br></blockquote><br><hr><br><br><h2> 路由策略 </h2><br> 在Leaf交换机上，我们从与网络的Underlay接口中导入BGP前缀。 <br> 我们将在<b>每个</b> Leaf-Spine对之间建立一个BGP会话，在其中将在水坑网络中宣布这些Underlay前缀。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85a/4b0/38d/85a4b038dc57c9fc54f1fb1ad10a5172.png" width="800"><br><br> 在一个数据中心内，我们将分发导入到ToRe的详细信息。 在Edge-Leafs上，我们将汇总它们并在远程DC中宣布它们，并将它们降低到ToR。 也就是说，每个ToR都会确切地知道如何到达同一DC中的另一个ToR，以及到达另一个DC中的ToR的入口点在哪里。 <br><br> 在DCI中，路由将作为VPNv4传输。 为此，在Edge-Leaf上，将工厂的接口放置在VRF中，我们将其称为UNDERLAY，并且Edge-Leaf上具有Spine的邻居将在VRF内以及VPNv4家族中的Edge-Leaf之间上升。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/231/d58/9d6/231d589d6ae0bcd63e4f60028771cd95.png" width="800"><br><br> 而且，我们还将禁止重新宣布从棘刺收到的路线，并将它们传回给他们。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3f0/f41/dfa/3f0f41dfa8510d48849ef8743f5b757a.png" width="500"><br><br> 在Leaf和Spine上，我们将不会导入回送。 我们只需要它们来确定路由器ID。 <br><br> 但是在Edge-Leafs上，我们将其导入Global BGP。 在Loopback地址之间，Edge Leafs将在IPv4 VPN系列中彼此建立BGP会话。 <br><br> 在EDGE设备之间，我们将有一个OSPF + LDP主干。 全部集中在一个区域中。 极其简单的配置。 <br><br> 这是路由的图片。 <br><hr><br><br><h2>  BGP ASN </h2><br><h3> 边缘叶ASN </h3><br> 在Edge-Leaf上，所有DC中都将有一个ASN。 重要的是，边缘叶之间必须有iBGP，并且不要碰到eBGP的细微差别。 设为65535。实际上，它可以是公共AS号。 <br><br><h3> 脊柱ASN </h3><br> 在Spine，每个DC我们将拥有一个ASN。 让我们从私有AS范围的第一个数字开始-64512、64513，依此类推。 <br><br> 为什么在DC上使用ASN？ <br><br> 我们将此问题分解为两个问题： <br><br><ul><li> 为什么在同一DC的所有刺上都具有相同的ASN？ </li><li> 为什么它们在不同的DC中有所不同？ </li></ul><br>  <b>为什么一个DC的所有刺上都具有相同的ASN</b> <br><br> 这是Edge-Leaf上的AS-Path Anderlay路由如下所示： <br> <code>[leafX_ASN, <b>spine_ASN</b> , edge_ASN]</code> <br> 如果您尝试将其发布回Spine，它将被删除，因为其AS（Spine_AS）已在列表中。 <br><br> 但是，在DC内部，我们完全感到满意的是，爬到Edge的Underlay路线将无法下降。  DC中主机之间的所有通信都应在主干级别内进行。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b3/cec/64c/0b3cec64c8666b0154f041bd64c9059b.png" width="800"><br><br> 同时，在任何情况下，其他DC的聚合路由都可以自由到达ToR-在它们的AS-Path中只有ASN 65535-AS Edge-Leaf的数量，因为它们是在它们上创建的。 <br><br>  <b>为什么在不同的DC中有所不同</b> <br><br> 从理论上讲，我们可能需要在DC之间拖动回送和某些服务虚拟机。 <br><br> 例如，在主机上，我们将运行路由反射器或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">相同的VNGW</a> （虚拟网络网关），它们将通过BGP与ToR锁定，并宣布其环回，所有DC都应可以使用。 <br><br> 因此，这是他的AS-Path的样子： <br> <code>[VNF_ASN, leafX_DC1_ASN, <b>spine_DC1_ASN</b> , edge_ASN, <b>spine_DC2_ASN</b> , leafY_DC2_ASN]</code> <br> <br> 在这里，任何地方都不应有重复的ASN。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fee/b97/61f/feeb9761f4964eda7f7519464927f61e.png" width="800"><br><br> 也就是说，Spine_DC1和Spine_DC2应该是不同的，就像leafX_DC1和leafY_DC2一样，这正是我们正在使用的方法。 <br><blockquote> 您可能知道，尽管有思科环回预防机制，仍有一些骇客可以使您通过重复的ASN接受路由。 它甚至具有相当合法的用途。 但这是网络弹性方面的潜在差距。 而且我个人几次陷入了困境。 <br><br> 如果我们有机会不使用危险物品，我们将使用它。 <br></blockquote><br><h3> 叶阿森 </h3><br> 我们将在整个网络的每个叶子交换机上都有一个单独的ASN。 <br> 出于上述原因，我们这样做：没有循环的AS-Path，没有书签的BGP配置。 <br><br> 为了使Leafs之间的路由不受阻碍地通过，AS-Path应该如下所示： <br> <code>[leafX_ASN, spine_ASN, leafY_ASN]</code> <br> 其中leafX_ASN和leafY_ASN可能会有所不同。 <br><br> 对于宣布DC之间的VNF回送的情况，这也是必需的： <br> <code>[VNF_ASN, <b>leafX_DC1_ASN</b> , spine_DC1_ASN, edge_ASN, spine_DC2_ASN, <b>leafY_DC2_ASN</b> ]</code> <br> <br> 我们将使用4字节的ASN并根据Spine的ASN和Leaf-switch编号生成它，例如： <i>Spine_ASN.0000X</i> 。 <br><hr><br><br> 这是带有ASN的图片。 <br><img src="https://habrastorage.org/getpro/habr/post_images/c4a/f3b/66c/c4af3b66cff4bb0589ee0c6ef98134cf.png" width="800"><br><hr><br><br><h1> 知识产权计划 </h1><br><br> 基本上，我们需要为以下连接分配地址： <br><br><ol><li>  ToR和机器之间的底层网络地址。 它们在整个网络中必须是唯一的，以便任何计算机都可以相互通信。 伟大的<b>10/8</b> 。 每个机架/ 26个带边距。 我们将为DC分配/ 19，为该区域分配/ 17。 <br></li><li>  Leaf / Tor和Spine之间的链接地址。 <br><br> 我想按算法分配它们，即根据需要连接的设备的名称进行计算。 <br><br> 设为169.254.0.0/16。 <br> 即<b>169.254.00X.Y / 31</b> ，其中<b>X</b>是主干号码， <b>Y</b>是P2P网络/ 31。 <br> 这将允许您最多运行128个机架，并且在DC中最多运行10个Spine。 链接地址可以（并且将）从DC重复到DC。 </li><li> 我们在<b>169.254.10X.Y / 31个</b>子网中组织Spine-Edge-Leaf联合，其中以同样的方式<b>X</b>是Spine编号， <b>Y</b>是P2P网络/ 31。 </li><li> 从Edge-Leaf到MPLS骨干网的链接地址。 这里的情况有所不同-将所有部分连接到一个饼图中的位置，因此重用相同的地址将不起作用-您需要选择下一个空闲子网。 因此，我们将以<b>192.168.0.0/16</b>为基础，并从中获取免费的。 </li><li> 回送地址。 给他们整个范围<b>172.16.0.0/12</b> 。 <br><ul><li> 叶子-每DC 25个-相同的128个机架。 按/ 23分配给该区域。 </li><li> 脊柱-DC处/ 28-最多16根脊柱。 按/ 26分配给该区域。 </li><li> 边缘叶-DC上的/ 29-最多8个盒子。 按/ 27分配给该区域。 </li></ul></li></ol><br> 如果在DC中我们没有足够的选定范围（但它们不会在那里-我们假装为hyper-skeylerostvo），只需选择下一个方块即可。 <br><br> 这是带有IP寻址的图片。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/def/f08/e49/deff08e49e0fee39e0799dfac4fad2a4.png" width="800"><br><br> 环回： <br><table border="2"><tbody><tr><td>  <b>前缀</b> </td><td>  <b>设备角色</b> </td><td>  <b>地区</b> </td><td>  <b>直流电</b> </td></tr><tr><td>  172.16.0.0/23 </td><td rowspan="10"> 边缘 </td><td></td><td></td></tr><tr><td>  172.16.0.0/27 </td><td rowspan="3">  RU </td><td></td></tr><tr><td>  172.16.0.0/29 </td><td>  MSK </td></tr><tr><td>  172.16.0.8/29 </td><td>  z </td></tr><tr><td>  172.16.0.32/27 </td><td rowspan="3">  SP </td><td></td></tr><tr><td>  172.16.0.32/29 </td><td>  bcn </td></tr><tr><td>  172.16.0.40/29 </td><td>  g </td></tr><tr><td>  172.16.0.64/27 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.0.64/29 </td><td> 沙 </td></tr><tr><td>  172.16.0.72/29 </td><td> 西亚 </td></tr><tr><td>  172.16.2.0/23 </td><td rowspan="10"> 脊柱 </td><td></td><td></td></tr><tr><td>  172.16.2.0/26 </td><td rowspan="3">  RU </td><td></td></tr><tr><td>  172.16.2.0/28 </td><td>  MSK </td></tr><tr><td>  172.16.2.16/28 </td><td>  z </td></tr><tr><td>  172.16.2.64/26 </td><td rowspan="3">  SP </td><td></td></tr><tr><td>  172.16.2.64/28 </td><td>  bcn </td></tr><tr><td>  172.16.2.80/28 </td><td>  g </td></tr><tr><td>  172.16.2.128/26 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.2.128/28 </td><td> 沙 </td></tr><tr><td>  172.16.2.144/28 </td><td> 西亚 </td></tr><tr><td>  172.16.8.0/21 </td><td rowspan="10"> 叶 </td><td></td><td></td></tr><tr><td>  172.16.8.0/23 </td><td rowspan="3">  RU </td><td></td></tr><tr><td>  172.16.8.0/25 </td><td>  MSK </td></tr><tr><td>  172.16.8.128/25 </td><td>  z </td></tr><tr><td>  172.16.10.0/23 </td><td rowspan="3">  SP </td><td></td></tr><tr><td>  172.16.10.0/25 </td><td>  bcn </td></tr><tr><td>  172.16.10.128/25 </td><td>  g </td></tr><tr><td>  172.16.12.0/23 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.12.0/25 </td><td> 沙 </td></tr><tr><td>  172.16.12.128/25 </td><td> 西亚 </td></tr></tbody></table><br><br> 底图： <br><table border="2"><tbody><tr><td>  <b>前缀</b> </td><td>  <b>地区</b> </td><td>  <b>直流电</b> </td></tr><tr><td>  10.0.0.0/17 </td><td rowspan="3">  RU </td><td></td></tr><tr><td>  10.0.0.0/19 </td><td>  MSK </td></tr><tr><td>  10.0.32.0/19 </td><td>  z </td></tr><tr><td>  10.0.128.0/17 </td><td rowspan="3">  SP </td><td></td></tr><tr><td>  10.0.128.0/19 </td><td>  bcn </td></tr><tr><td>  10.0.160.0/19 </td><td>  g </td></tr><tr><td>  10.1.0.0/17 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  10.1.0.0/19 </td><td> 沙 </td></tr><tr><td>  10.1.32.0/19 </td><td> 西亚 </td></tr></tbody></table><br><hr><br><br><h1> 拉巴 </h1><br> 两家供应商。 一个网络。  ADSM。 <br><br> 瞻博网络+ Arista。 的Ubuntu 前夕好。 <br><br> 我们在Miran的虚拟机上的资源数量仍然有限，因此，在实践中，我们将只使用这种简化的网络。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/477/a27/096/477a2709633866d53fec5972e9417421.png" width="800"><br><br> 两个数据中心：喀山和巴塞罗那。 <br><br><ul><li> 每个都有两个刺：瞻博网络和Arista。 </li><li> 每个中都有一个环（叶）-瞻博网络和Arista，并连接了一个主机（为此，我们以轻量级的Cisco IOL为例）。 </li><li> 一个Edge-Leaf节点（到目前为止只有Juniper）。 </li><li> 一台Cisco交换机将其全部统治。 </li><li> 除网络盒外，还启动了管理虚拟机。 运行Ubuntu。 <br> 她可以访问所有设备，IPAM / DCIM系统，一堆Python脚本，ansible，以及我们可能需要的其他任何东西。 </li></ul><br> 我们将尝试使用自动化来复制所有网络设备<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的完整配置</a> 。 <br><hr><br><br><h1> 结论 </h1><br> 还接受了吗？ 在每篇文章下做出简短结论？ <br><br> 因此，我们选择DC内的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">三级</a> Klose网络，因为我们期望有很多东西向流量，并且需要ECMP。 <br><br> 我们将网络分为物理网络（底层）和虚拟网络（叠加）。 在这种情况下，覆盖层从主体开始-从而简化了对底层层的要求。 <br><br> 我们选择BGP作为非中继网络的路由协议，因为它具有可扩展性和策略的灵活性。 <br><br> 我们将为DCI组织提供单独的节点-Edge-leaf。 <br> 中继上将有OSPF + LDP。 <br>  DCI将基于MPLS L3VPN实施。 <br> 对于P2P链接，我们将根据设备名称通过算法计算IP地址。 <br> 将根据设备的角色及其位置顺序分配Lupback。 <br> 底层前缀-仅在叶子交换机上根据其位置顺序排列。 <br><br> 假设我们现在没有安装设备。 <br> 因此，我们的下一步将是使它们进入系统（IPAM，清单），组织访问，生成配置并进行部署。 <br><br> 在下一篇文章中，我们将讨论Netbox，DC中的清单和IP空间管理系统。 <br><hr><br><br><h1> 谢谢啦 </h1><br><ul><li>  Andrey Glazkov aka @glazgoo，用于校对和编辑 </li><li>  Alexander Klimenko又名@ v00lk，用于校对和编辑 </li><li>  KDPV的Artyom Chernobay </li></ul><br><hr></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN475614/">https://habr.com/ru/post/zh-CN475614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN475600/index.html">我们如何联系普罗米修斯</a></li>
<li><a href="../zh-CN475604/index.html">在Zabbix 4.4上配置官方PostgreSQL模板</a></li>
<li><a href="../zh-CN475608/index.html">Google跟踪代码管理器：不明显且有用的触发器设置</a></li>
<li><a href="../zh-CN475610/index.html">保持视野的安全LED台灯</a></li>
<li><a href="../zh-CN475612/index.html">给定何时，何时断言和对实施的信心</a></li>
<li><a href="../zh-CN475618/index.html">如何在本体网络上编写智能Python合同。 第2部分：存储API</a></li>
<li><a href="../zh-CN475622/index.html">在虚幻引擎4中扩展UObject</a></li>
<li><a href="../zh-CN475624/index.html">PHP-Watcher：简化长期应用程序开发的工具</a></li>
<li><a href="../zh-CN475626/index.html">自动测试可以代替一个人寻找漏洞：采访亚历山德拉·斯瓦蒂科娃（Alexandra Svatikova）</a></li>
<li><a href="../zh-CN475630/index.html">Knative-基于k8s的平台即服务，无服务器支持</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>