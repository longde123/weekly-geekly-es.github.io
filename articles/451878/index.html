<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíáüèø ü§∞üèΩ üó∫Ô∏è Transmisi√≥n en vivo de video est√©reo a gafas VR (Oculus Go) üëµüèø üëáüèª ü§±üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No haremos una larga parte introductoria, iremos directamente al grano. 

 Entonces, hay una c√°mara est√©reo que puede entregar video H264 a trav√©s de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Transmisi√≥n en vivo de video est√©reo a gafas VR (Oculus Go)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451878/">  No haremos una larga parte introductoria, iremos directamente al grano. <br><br>  Entonces, hay una c√°mara est√©reo que puede entregar video H264 a trav√©s de varios protocolos.  Hay gafas Oculus Go.  ¬øC√≥mo ver una transmisi√≥n est√©reo en vivo desde una c√°mara con gafas VR?  Es deseable, con un retraso m√≠nimo y local, para que Youtube y otros servicios de video RTMP desaparezcan. <br><br>  Mirando hacia adelante, eso es lo que pas√≥.  Al principio: reproducci√≥n de un archivo de video previamente grabado desde est√©reo, luego reproducci√≥n de una transmisi√≥n en vivo con StereoPi (MPEG-TS a trav√©s de UDP). <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/MLPNXmZI8-8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><blockquote>  La c√°mara est√©reo que uso es StereoPi, por lo que dar√© ejemplos espec√≠ficos en relaci√≥n con ella.  De hecho, esta es una frambuesa ordinaria, pero con dos c√°maras, por lo que los ejemplos descritos se pueden probar en frambuesas comunes, si realmente lo desea.  Es cierto que necesitar√° instalar el firmware de StereoPi. </blockquote>  En primer lugar, hubo un intento de crear una aplicaci√≥n de Android normal que reproduzca la transmisi√≥n desde la c√°mara a pantalla completa, y llenarla en el oculus con el m√©todo de carga lateral (a trav√©s de adb). <br><br>  Despu√©s de buscar con el manifiesto, las gafas acordaron considerar esta aplicaci√≥n nativa.  Apareci√≥ en "Fuentes desconocidas" en la biblioteca, se inici√≥, mostr√≥ todo lo que se necesitaba, pero hab√≠a un problema: los movimientos de la cabeza no se ten√≠an en cuenta, el video de la c√°mara simplemente se mostraba est√∫pidamente en pantalla completa con gafas.  El efecto est√©reo fue, s√≠, pero tan pronto como mueves un poco la cabeza, el Moscovita comienza a volverse loco, lo que caus√≥ una sensaci√≥n muy, muy inc√≥moda. <br><br>  Si es as√≠, aqu√≠ est√° la aplicaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">.apk</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">StereoPi para Oculus Go</a> Al mismo tiempo en el archivo y en las mentiras adb, para que pueda intentar llenar los lentes de inmediato.  Solo mando <br><br><pre><code class="bash hljs">adb install StereoPi.apk</code> </pre> <br>  Despu√©s de eso, vaya a la Biblioteca -&gt; Fuentes desconocidas, la aplicaci√≥n com.virt2real.stereopi deber√≠a aparecer all√≠ <br><br><img src="https://habrastorage.org/webt/q6/gi/zf/q6gizfqbbj_cftbnek3l8aqupno.png"><br><br>  Lo iniciamos y si StereoPi est√° en la misma red de √°rea local que los anteojos, inmediatamente vemos la imagen est√©reo de la c√°mara. <br><br>  Pero esto es basura ... Quiero una aplicaci√≥n nativa normal para el oculus para ver el video.  Para que hubiera una pantalla inm√≥vil y para no asaltar al mover la cabeza.  Todav√≠a no estoy listo para aprender Unity para el oculus, as√≠ que tuve la idea de intentar usar las aplicaciones del reproductor de video que ya est√°n en la tienda Oculus.  Por lo general, veo pel√≠culas en 3D en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Skybox</a> , as√≠ que intent√© usarlo. <br><br>  Adem√°s de la visualizaci√≥n habitual de archivos multimedia desde la unidad flash incorporada y desde dispositivos de red, se encontr√≥ un elemento interesante de "Airscreen" en Skybox.  Result√≥ que puede instalar la aplicaci√≥n Skybox en una computadora con Windows (bueno, o en una Mac), alimentarlo con archivos de video y luego es posible ver estos archivos de video con gafas.  Es decir  La aplicaci√≥n de Windows es un servidor de video y gafas, un cliente.  No encontr√© el protocolo de comunicaci√≥n en ninguna parte, as√≠ que tuve que descubrir tcpdump. <br><br>  Despu√©s de una breve excavaci√≥n, result√≥ que Skybox usa mensajes de difusi√≥n UDP para buscar un servidor en LAN.  El mensaje se ve as√≠: <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"search"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"project"</span></span>:<span class="hljs-string"><span class="hljs-string">"direwolf"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceType"</span></span>:<span class="hljs-string"><span class="hljs-string">"vr"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"udpPort"</span></span>:<span class="hljs-string"><span class="hljs-string">"6881"</span></span>}</code> </pre> <br><br>  Todos los mensajes en JSON son muy convenientes. <br><br>  Para este mensaje, debemos enviar una respuesta al host y al puerto del remitente especificados en el mensaje, es decir,  6881 <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"udp"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-attr"><span class="hljs-attr">"project"</span></span>:<span class="hljs-string"><span class="hljs-string">"direwolf server"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"searchResult"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"computerId"</span></span>:<span class="hljs-string"><span class="hljs-string">"53709de962eba2f9695c8a926562486c"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"computerName"</span></span>:<span class="hljs-string"><span class="hljs-string">"STEREO-PI"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ip"</span></span>:<span class="hljs-string"><span class="hljs-string">"192.168.1.51"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ips"</span></span>:[<span class="hljs-string"><span class="hljs-string">"192.168.1.51"</span></span>],<span class="hljs-attr"><span class="hljs-attr">"port"</span></span>:<span class="hljs-number"><span class="hljs-number">6888</span></span>}</code> </pre><br>  Aqu√≠ indicamos nuestro host y puerto en el que tenemos el servidor WebSockets ejecut√°ndose.  Toda comunicaci√≥n posterior se realizar√° a trav√©s de websockets. <br><br>  Por ejemplo, el primer mensaje a trav√©s de los sockets web ser√° algo como esto: <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"addDevice"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Oculus Pacific"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceType"</span></span>:<span class="hljs-string"><span class="hljs-string">"vr"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"showLoginCode"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>}</code> </pre> <br>  Nosotros le respondemos: <br><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"addDevice"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Oculus Pacific"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceType"</span></span>:<span class="hljs-string"><span class="hljs-string">"vr"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"showLoginCode"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>}</code> </pre> <br>  Y despu√©s de eso, en el Skybox con gafas veremos nuestro StereoPi.  A continuaci√≥n habr√° un mont√≥n de solicitudes para las cuales debe enviar respuestas.  Contenido de la lista de reproducci√≥n, por ejemplo. <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de lista de reproducci√≥n para Skybox</b> <div class="spoiler_text">  [{id: 'livestream-rtsp', <br>  nombre: 'Live Stream RTSP', <br>  duraci√≥n: 0, <br>  tama√±o: 0, <br>  url: 'rtsp: //192.168.1.51: 554 / h264', <br>  miniatura: 'http://192.168.1.51/thumbnail/livestream.png', <br>  thumbnailWidth: 186, <br>  thumbnailHeight: 120, <br>  lastModified: 1, <br>  defaultVRSetting: 1, <br>  userVRSetting: 2, <br>  ancho: 1280, <br>  altura: 720, <br>  orientDegree: '0', <br>  subt√≠tulos: [], <br>  ratioTypeFor2DScreen: 'predeterminado', <br>  rotacionFor2DScreen: 0, <br>  existe: verdadero <br>  isBadMedia: falso, <br>  AddedTime: 1}, <br>  {id: 'livestream-mpegts', <br>  nombre: 'Live Stream MPEG-TS', <br>  duraci√≥n: 0, <br>  tama√±o: 0, <br>  url: 'udp: // @: 3001', <br>  miniatura: 'http://192.168.1.51/thumbnail/livestream.png', <br>  thumbnailWidth: 186, <br>  thumbnailHeight: 120, <br>  lastModified: 1, <br>  defaultVRSetting: 1, <br>  userVRSetting: 2, <br>  ancho: 1280, <br>  altura: 720, <br>  orientDegree: '0', <br>  subt√≠tulos: [], <br>  ratioTypeFor2DScreen: 'predeterminado', <br>  rotacionFor2DScreen: 0, <br>  existe: verdadero <br>  isBadMedia: falso, <br>  addTime: 1}] <br></div></div><br>  Esto es especialmente interesante ya que  En la lista de reproducci√≥n que forma la aplicaci√≥n de Windows, se descubri√≥ la codiciada abreviatura RTSP.  Result√≥ que la aplicaci√≥n del servidor transmite archivos de video a trav√©s de RTSP, que ya es adecuado para la transmisi√≥n de video en vivo, que, por supuesto, necesitamos.  M√°s precisamente, result√≥ que hay "RTSP" en la lista de reproducci√≥n, pero los enlaces a los archivos de video son http regulares.  Es decir  la aplicaci√≥n del servidor a√∫n env√≠a archivos a trav√©s de HTTP, pero esto no nos conviene.  En este punto, ya estaba molesto, pero pens√©, ¬øpor qu√© no intentar dar un enlace en la lista de reproducci√≥n en un formato en el que VLC generalmente entiende, es decir?  rtsp: //192.168.1.51: 554 / h264 Y saludos, Skybox comenz√≥ a reproducir la transmisi√≥n de video desde el servidor RTSP en el est√©reo.  La demora es muy grande, 20 segundos, por lo que sigue.  Estamos tratando de alimentar el flujo UDP a MPEG-TS.  Una vez m√°s, VLC generalmente come esto usando el enlace udp: // @: 3001, para Skybox intent√© especificarlo de la misma manera.  Entonces solo queda dirigir la secuencia MPEG-TS al host de gafas y al puerto UDP especificado.  GStreamer est√° involucrado en esto: <br><br><pre> <code class="bash hljs">raspivid -3d sbs -w 1280 -h 720 -o - | gst-launch-1.0 -q fdsrc ! h264parse ! mpegtsmux alignment=7 name=muxer ! rndbuffersize max=1316 min=1316 ! multiudpsink clients=<span class="hljs-string"><span class="hljs-string">"192.168.1.60:3001"</span></span> sync=<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  En el skybox, hacemos clic en el elemento de la lista de reproducci√≥n ‚ÄúLive Stream MPEG-TS‚Äù y listo, vemos una transmisi√≥n en vivo de MPEG-TS en la pantalla grande en un cine virtual.  El retraso es mucho menor que con RTSP, 2-3 segundos, pero a√∫n mucho m√°s que en mi aplicaci√≥n simple que recibe un flujo de H264 sin procesar a trav√©s de UDP (generalmente hay un retraso de 100-150 ms a una resoluci√≥n de 720p). <br><br>  Luego me encontr√© con un callej√≥n sin salida, hasta ahora no he logrado reducir el retraso.  Tal vez necesite deshabilitar el almacenamiento en b√∫fer en el propio Skybox, intentar√© escribir a los desarrolladores, tal vez hagan la opci√≥n "Deshabilitar almacenamiento en b√∫fer" :-) <br><br><h3>  En conclusi√≥n </h3><br>  En general, si de repente por alguna raz√≥n necesitaras ver una transmisi√≥n de video en vivo en el oculi u otras gafas de realidad virtual (Skybox est√° disponible en muchas plataformas como), puedes probar el m√©todo que describ√≠.  No s√© si esto funcionar√° con otras c√°maras est√©reo, pero con StereoPi est√° marcado, funciona. <br><br><h3>  Referencias </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuente del servidor para skybox</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tema del foro con discusi√≥n</a> <br><br>  Gracias a todos, todos son libres. <br><br>  Oh s√≠, casi lo olvido.  Si de repente alguien puede ayudar con la aplicaci√≥n nativa para el oculus (para que se vea como Skybox), escriba una carta personal, discutiremos los detalles. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/451878/">https://habr.com/ru/post/451878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451866/index.html">Elija los nodos m√°s cercanos en la red</a></li>
<li><a href="../451870/index.html">Funciones modernas de C ++ que todos los programadores deben conocer</a></li>
<li><a href="../451872/index.html">Python es un asistente para encontrar vuelos baratos para quienes les gusta viajar</a></li>
<li><a href="../451874/index.html">Principales tendencias de SEO en Google</a></li>
<li><a href="../451876/index.html">Centro de datos de Frankfurt: centro de datos de Telehouse</a></li>
<li><a href="../451880/index.html">DevPRO'19: vista desde el stand de Wrike</a></li>
<li><a href="../451884/index.html">Siete a√±os de trabajo como desarrollador: ¬øqu√© lecciones he aprendido?</a></li>
<li><a href="../451886/index.html">Usar matem√°ticas discretas en las pruebas</a></li>
<li><a href="../451890/index.html">Delegaci√≥n de una zona de subred inversa de menos de / 24 en BIND. Como funciona</a></li>
<li><a href="../451894/index.html">Una breve descripci√≥n general de la arquitectura del compilador</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>