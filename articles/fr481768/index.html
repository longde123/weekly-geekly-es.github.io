<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòô üÄÑÔ∏è üßëüèø‚Äçü§ù‚Äçüßëüèº Nous traitons WebKit dans 1C, par exemple, l'int√©gration de TinyMCE dans un formulaire g√©r√© dans UT 11.4 üë©üèª‚Äçüîß ‚úåüèº üâë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beaucoup savent d√©j√† que dans la sortie de la plate-forme 8.3.14.1565, le navigateur Internet Explorer a √©t√© remplac√© par le Web-Kit, c'est en fait un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous traitons WebKit dans 1C, par exemple, l'int√©gration de TinyMCE dans un formulaire g√©r√© dans UT 11.4</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481768/">  Beaucoup savent d√©j√† que dans la sortie de la plate-forme 8.3.14.1565, le navigateur Internet Explorer a √©t√© remplac√© par le Web-Kit, c'est en fait un grand pas en avant, mais je suis s√ªr, comme moi, que ce n'est pas encore clair.  Il y avait une exp√©rience d'utilisation de web-kit dans 1C, appelant JS de 1C et appelant 1C de JS.  Essayons de comprendre ensemble en quoi l'un diff√®re de l'autre et en m√™me temps, faisons quelque chose d'utile.  Oui, et s√ªrement beaucoup devront r√©√©crire leurs m√©tiers similaires apr√®s la mise √† jour vers une nouvelle plate-forme, donc j'esp√®re que mon exp√©rience sera utile. <br><a name="habracut"></a><br>  Tout a commenc√© avec le fait que la t√¢che a surgi: ¬´Nous voulons, en UT, entrer une description format√©e pour le produit afin qu'il vole plus tard vers la boutique en ligne¬ª, car la description standard du produit arrive en trait plein sans c√©sure et n'a pas l'air tr√®s bien.  Imm√©diatement, il y avait un d√©sir d'utiliser un document format√©, il y a un simple √©diteur, et vous pouvez le t√©l√©charger en HTML.  Mais d√®s que j'ai montr√© le code HTML g√©n√©r√© par le document format√© aux d√©veloppeurs Web, ils ont imm√©diatement agit√© la main et ont dit que cela ne fonctionnerait pas.  Le site a d√©j√† ses propres styles pour afficher les √©l√©ments de bloc n√©cessaires et le comportement de ce type de texte peut devenir impr√©visible. <br><br>  La fonction Get HTML d'un document format√© renvoie une page HTML enti√®rement form√©e, avec la structure enti√®re des balises, et ce qui est le plus d√©sagr√©able, avec des styles en ligne.  Cela ressemble √† ceci. <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"X-UA-Compatible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IE=Edge"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"format-detection"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"telephone=no"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">8px</span></span></span><span class="css">;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">p</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">line-height</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">1.15</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">white-space</span></span></span><span class="css">:pre-wrap;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">ol</span></span></span><span class="css">,</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">ul</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin-top</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin-bottom</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">img</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border</span></span></span><span class="css">:none;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">li</span></span></span><span class="css">&gt;</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">p</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">display</span></span></span><span class="css">:inline;} </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-decoration: underline;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"font-weight: bold;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color: #ff0000;font-weight: normal;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Et si obtenir le contenu de la balise body est une t√¢che simple, je ne voulais pas analyser et d√©couper les attributs de style des balises. <br><br>  TinyMCE ram√®ne une belle mise en page.  Vous autoriser les styles en ligne uniquement dans le cas de la couleur, ce qui est d√©j√† beaucoup mieux. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color: #ff0000;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Il a √©t√© d√©cid√© d'int√©grer TinyMCE, un √©diteur de texte tiers.  De plus, l'exp√©rience de son int√©gration avec la communaut√© 1C est d√©j√† assez large. <br><br>  C'√©tait peut-√™tre une erreur √† ce moment-l√†, et il suffisait d'analyser le texte g√©n√©r√© par un document format√©, mais nous avons ce que nous avons. <br><br><h4>  1. Caract√©ristiques de la solution </h4><br>  √âtant donn√© que 1C ne permet pas de t√©l√©charger des fichiers locaux du syst√®me de fichiers vers la page dans le champ HTML, pour cela, vous avez certainement besoin d'un serveur Web ou au moins l'adresse de ce fichier dans un stockage temporaire, placez la biblioth√®que Tiny js √† c√¥t√© de 1C et chargez-la dans les en-t√™tes du document HTML vous ne pouvez pas - vous devrez √©galement cr√©er un fichier avec une mise en page HTML qui forme en interne une fen√™tre d'√©diteur pr√™te √† l'emploi et qui est d√©j√† connect√© au document HTML. <br><br>  En g√©n√©ral, en fait, vous pouvez charger une biblioth√®que si vous obtenez une adresse dans le r√©f√©rentiel si elle a √©t√© compil√©e dans un fichier, et Tiny, en plus de la biblioth√®que principale, contient √©galement des fichiers js de plug-in, un gestionnaire de style et des styles, des fichiers de crack eux-m√™mes , ic√¥nes, etc., et comme vous le comprenez, cela complique grandement la t√¢che.  √Ä un moment donn√©, il y avait m√™me une id√©e de compiler toutes ces choses dans un seul fichier et de ne pas conna√Ætre les probl√®mes, mais il a fallu beaucoup de temps pour comprendre les outils.  Ensuite, TinyMCE Builder a √©t√© trouv√© sur le site officiel, qui compile tous les js dans un seul fichier et ce serait une petite victoire s'il faisait de m√™me avec css, mais non, css se trouvait toujours √† c√¥t√© de plusieurs dossiers. <br><br>  TinyMCE cr√©e un iframe pour la fen√™tre d'√©dition, qui est lui-m√™me un document HTML incorpor√© dans la page, donc les √©v√©nements qui se produisent dans cet iframe 1C ne peuvent pas √™tre suivis, plus √† ce sujet ci-dessous. <br><br>  La configuration de UT 11.4 au moment du d√©veloppement avait un mode de compatibilit√© de 8.3.12, donc en fait maintenant il utilisait IE comme navigateur int√©gr√©, mais une nouvelle mise √† jour impliquait une transition vers de nouvelles versions qui utilisent d√©j√† le web-kit. <br><br><h4>  2. Premi√®res √©tapes </h4><br>  Les principales diff√©rences dans l'utilisation du kit Web: <br><br>  L'objet principal des champs HTML a maintenant une structure diff√©rente et pour travailler avec le contenu de la page, vous devez utiliser la propri√©t√© <b>defaultView</b> <br><br><pre> <code class="1c hljs">.HTML.Document.DefaultView</code> </pre> <br>  pr√©c√©demment utilis√© la propri√©t√© <b>parentWindow</b> pour cette <br><br><pre> <code class="1c hljs">.HTML.Document.parentWindow</code> </pre> <br>  L'interdiction d'utiliser eval, qui √©tait utilis√© universellement pour appeler le code JS.  Quelque chose comme √ßa <br><br>  Elements.FieldHTML.Document.parentWindow.eval ("alert ('Call code from 1C')") <br>  Mais vous pouvez acc√©der aux m√©thodes directement depuis 1C. <br><br>  Elements.Description HTML.Document.DefaultView.NameMethodJS (); <br>  Et j'ai rapidement cr√©√© des fonctions d'encapsulation pour toutes les m√©thodes Tiny dont j'ai besoin. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tinyMCE.activeEditor.getContent({<span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">"text"</span></span>}); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tinyMCE.activeEditor.setContent(text); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHTML</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tinyMCE.activeEditor.getContent(); }</code> </pre> <br>  Qui s'est en outre adress√© √† partir de 1C afin <br><br><pre> <code class="1c hljs">HTML = .HTML.Document.DefaultView; HTML = HTML.GetHTML();  = HTML.GetText();</code> </pre> <br>  Bien que l'on puisse se d√©brouiller avec des appels directs √† l'objet √©diteur, par exemple, <br><br><pre> <code class="1c hljs">.HTML..defaultView.tinyMCE.activeEditor.getContent()</code> </pre> <br>  Le traitement de la publication a √©t√© imm√©diatement t√©l√©charg√© (un respect distinct pour l'auteur), ce qui m'a montr√© beaucoup de choses int√©ressantes.  Cela a plus ou moins fonctionn√© sur IE, mais le copier-coller ne fonctionnait pas sur le webkit, au d√©but, cela a caus√© une stupeur, mais plus tard, il est devenu clair que c'√©tait √† cause de l'iframe que le champ HTML n'√©tait pas activ√© en cliquant √† l'int√©rieur, car le clic s'est effectivement produit dans le document joint HTML dont les √©v√©nements se sont coinc√©s quelque part sur le chemin du 1C.  Par cons√©quent, si vous appuyez sur Ctrl + C √† un endroit du formulaire et essayez de le coller dans le champ de l'√©diteur, le texte sera ins√©r√© dans ce champ d'o√π il a √©t√© copi√© car le champ HTML du document n'est pas activ√©.  La m√™me chose se produit dans le cas contraire, les raccourcis clavier pour copier-coller ne fonctionnent pas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/759/7b5/9e3/7597b59e3048362a6cc6d715e64c43f3.gif" alt="image"><br><br>  Au d√©but, l'id√©e est venue qu'il s'agissait d'un jambage Tiny, et il bloque la p√¢te directe du tampon, comme CKEditor, qui offre une fen√™tre distincte pour le collage √† partir du tampon.  Mais pour v√©rifier que c'√©tait assez facile, j'ai cr√©√© un document vide avec un champ de saisie et j'ai essay√© de copier et coller <br><br><img src="https://habrastorage.org/getpro/habr/post_images/496/d00/ca5/496d00ca55f4a4ed0b593f56575b8336.gif" alt="image"><br><br>  Comme vous pouvez le voir, tout fonctionne.  Le probl√®me se situe donc quelque part dans Tiny ou en interaction avec 1C. <br><br><h4>  3. D√©cision </h4><br>  Pour r√©soudre le probl√®me avec l'interaction du navigateur et de 1C, l'astuce habituelle a √©t√© appliqu√©e, j'ai cr√©√© un bouton invisible sur la page HTML, et pr√©vu de cliquer dessus depuis JS lorsque les √©v√©nements n√©cessaires se sont produits √† l'int√©rieur de la page que 1C intercepterait dans l'√©v√©nement HTML Press.  Mais √† quel √©v√©nement r√©aliser un programme presse? <br><br>  La disposition ressemble √† ceci: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"editor"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button1c"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display: none"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Et une fonction pour d√©clencher un √©v√©nement de clic de bouton <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickButton</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ button1c.click(); }</code> </pre> <br>  Auparavant, il √©tait possible de transf√©rer un objet de forme 1C dans le champ HTML en tant qu'objet, et en raison du fait qu'IE connect√© √† 1C via COM, le formulaire lui-m√™me √©tait en quelque sorte converti en un objet que IE comprenait et il √©tait possible d'appeler des fonctions d'exportation de forme 1C directement √† partir du code JS .  Maintenant c'est impossible. <br><br>  Nous avons √©tudi√© la documentation de l'API Tiny et trouv√© une construction pour intercepter les gestionnaires d'√©v√©nements et une combinaison appropri√©e d'√©v√©nements qui devraient activer le champ HTML du document <br><br><pre> <code class="javascript hljs">tinymce.activeEditor.on(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{clickButton(e)}); tinymce.activeEditor.on(<span class="hljs-string"><span class="hljs-string">'KeyDown'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{clickButton(e)});</code> </pre> <br>  Vous devez mettre ce code √† l'endroit o√π Tiny a d√©j√† √©t√© initialis√©.  Je l'ai fait dans le gestionnaire de <b>chargement</b> de l'objet <b>fen√™tre</b> .  Mais vous pouvez le faire plus magnifiquement et placer le code lors de l'initialisation de Tiny dans le param√®tre: <br><br><pre> <code class="javascript hljs">init_instance_callback</code> </pre> <br>  Maintenant, tout devrait √™tre en ordre.  Et le formulaire devrait fonctionner comme il se doit ... <br><br>  C'est devenu beaucoup mieux, le champ HTML a vraiment commenc√© √† √™tre activ√©, mais pas toujours, pour une raison quelconque, certains clics n'ont pas entra√Æn√© le d√©placement du focus vers le champ: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e91/403/d67/e91403d6763d389bcbb7b95a884e07e9.gif" alt="image"><br><br>  Cet enregistrement montre que si vous cliquez sur la ligne o√π le curseur clignote, le focus du champ fonctionne comme il se doit, mais si vous cliquez ci-dessous, le champ ne s'active pas. <br><br>  C'√©tait un artefact ennuyeux, et les tentatives de comprendre ce qui se passait n'ont donn√© aucune solution.  J'ai √©mis des alertes vers le gestionnaire et des alertes ont √©t√© affich√©es, mais 1C n'a pas r√©pondu √† l'√©v√©nement <br><br><img src="https://habrastorage.org/getpro/habr/post_images/531/81f/f82/53181ff82d52da46e812d260056e6d79.gif" alt="image"><br><br>  Soudain, l'id√©e m'est venue √† l'esprit: que se passe-t-il si 1C ne parvient pas √† traiter l'√©v√©nement sur le terrain, et si vous ralentissez un peu l'ex√©cution du script JS et voyez ce qui se passe.  La fonction de pause dans JS a √©t√© rapidement impl√©ment√©e en utilisant des promesses et une attente asynchrone.  Comme vous pouvez le voir dans JS, il manque √©galement par d√©faut et rien, les gens vivent). <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleep</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ms</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> setTimeout(resolve, ms)); } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickButton</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>); button1c.click(); }</code> </pre> <br>  Ici, je r√®gle le retard sur une milliseconde, avant de cliquer sur le bouton.  Et le tour est jou√©.  1C a commenc√© √† traiter le clic d'un bouton √† temps. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4fd/c95/937/4fdc959377f0ec372414c1db88959d9e.gif" alt="image"><br><br><h4>  4. Nous finissons l'√©change </h4><br>  √âtant donn√© que pour stocker la nouvelle description au format HTML, un nouvel attribut a √©t√© ajout√© au r√©pertoire, nous devons remplacer la valeur du champ typique lors du d√©chargement.  Pour ce faire, dans le module ExchangeSiteRemoveable, ajoutez la fonction GetTexts of RequestsCatalog √† l'extension et √©crivez-y: <br><br><pre> <code class="1c hljs">. = <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(., <span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">".HTML_HTML"</span></span>);</code> </pre> <br>  C‚Äôest tout.  Nous entamons l'√©change et tout fonctionne, il ne reste plus qu'√† effectuer des modifications sur le site, si n√©cessaire, afin que la description du produit soit per√ßue comme une mise en page et non comme une cha√Æne. <br><br><h4>  R√©sum√© </h4><br>  Dans cet exemple, j'ai essay√© l'interaction de JS WebKit et 1C, collect√© le r√¢teau et trouv√© une solution. <br><br>  Peut-√™tre que pour r√©soudre ce probl√®me, il √©tait plus facile d'analyser et d'effacer le texte HTML d'un document format√©, mais ce ne serait pas si int√©ressant et pourrait poser des probl√®mes avec certaines options de mise en forme complexes. <br><br>  Merci d'avoir lu. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr481768/">https://habr.com/ru/post/fr481768/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr481754/index.html">Moi bot et mon poin√ßon</a></li>
<li><a href="../fr481756/index.html">Comment organiser les DDoS √† de bonnes fins?</a></li>
<li><a href="../fr481758/index.html">Statistiques de construction, d'approvisionnement et de visites √† l'ISS</a></li>
<li><a href="../fr481762/index.html">√âquations pour la cuisine sous le sapin de No√´l</a></li>
<li><a href="../fr481764/index.html">Pourquoi l'√©nergie verte a-t-elle un avenir difficile?</a></li>
<li><a href="../fr481776/index.html">Services de jeux 5G et cloud - testez comment cela fonctionne √† Moscou</a></li>
<li><a href="../fr481778/index.html">Analyse des logiciels malveillants Skeleton Key</a></li>
<li><a href="../fr481780/index.html">MyOffice a plus de 200 nouvelles fonctionnalit√©s</a></li>
<li><a href="../fr481782/index.html">A propos des probl√®mes de traducteur Python et repenser la langue</a></li>
<li><a href="../fr481784/index.html">Comment Kafka est devenu r√©alit√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>