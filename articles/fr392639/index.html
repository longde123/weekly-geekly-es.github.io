<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🚒 🚐 🤰🏽 Chaîne d'outils de développement Arduino pour les connaisseurs de ligne de commande: PlatformIO ou comment cesser d'utiliser l'IDE Arduino 🏼 💃 🌕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Au cours de la dernière année, j'ai écrit pas mal de code pour Arduino et changé simultanément plusieurs outils de développement. L'article mentionne ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Chaîne d'outils de développement Arduino pour les connaisseurs de ligne de commande: PlatformIO ou comment cesser d'utiliser l'IDE Arduino</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/392639/"><img align="left" src="https://habrastorage.org/files/609/41e/ed9/60941eed96084f9d81a6a47cc169ec67.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours de la dernière année, j'ai écrit pas mal de code pour Arduino et changé simultanément plusieurs outils de développement. </font><font style="vertical-align: inherit;">L'article mentionne les options que j'ai essayées et plus en détail sur ce à quoi je me suis arrêté. </font><font style="vertical-align: inherit;">Il s'agira d'un ensemble d'outils pour le cas où&gt; 10 projets pour différentes cartes et un peu sur le développement et l'installation de bibliothèques.</font></font><a name="habracut"></a><br>
<br clear="all">
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Environnement de développement</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel est le problème?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probablement parce que Arduino n'est pas axé sur les développeurs professionnels, l'écosystème autour de l'IDE standard se distingue par l'absence des outils habituels pour moi:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce n'est que dans les versions récentes qu'une sorte de gestion de bibliothèque est apparue, sans la similitude de Gemfile / requirements.txt / package.json, c'est-à-dire qu'il est impossible pour le projet de spécifier quelles versions sont utilisées</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aucune intégration avec git ou autres vcs</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un éditeur de texte ne se compare pas à </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mon éditeur de texte préféré</font></font></em></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il n'y a aucun moyen de sauvegarder la sélection du conseil d'administration dans le projet</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sortie gênante des erreurs de compilation</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le site Web Arduino a une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liste d'outils de développement alternatifs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans cette liste, il existe des options que, pour diverses raisons, je n'ai pas essayées. </font><font style="vertical-align: inherit;">Par exemple, Atmel Studio et Visual Studio CE n'ont pas pris en compte. </font><font style="vertical-align: inherit;">Je voulais trouver un outil supportant le travail à partir de la ligne de commande.</font></font><br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui a essayé</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ino</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ino</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - un projet de la société russe Amperka, un utilitaire de ligne de commande pour le firmware Arduino. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet était assez populaire,&gt; 200 fourchettes. </font><font style="vertical-align: inherit;">Le dernier commit date d'avril 2014, il ne fonctionne donc pas avec les dernières versions de l'IDE (il semble depuis la 1.5). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un fork live d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arturo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , je l'ai utilisé un peu, mais il y avait des problèmes dans certains cas exotiques.</font></font><br>
<br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino-makefile</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino-Makefile</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - compiler et télécharger avec make. </font><font style="vertical-align: inherit;">Arduino Due, Zero et les autres cartes 32 bits ne sont pas prises en charge. </font><font style="vertical-align: inherit;">La différence avec l'IDE standard est que les méthodes doivent être déclarées avant utilisation, donc lors du transfert de projets terminés, vous devrez peut-être modifier la source. </font><font style="vertical-align: inherit;">Si je me souviens bien, je n'ai pas pu me lier d'amitié avec Arduino-Makefile et SparkFun Pro Micro.</font></font><br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce que j'utilise</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlatformIO</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlatformIO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un excellent projet créé par des développeurs ukrainiens. </font><font style="vertical-align: inherit;">Il comprend un utilitaire de ligne de commande grâce auquel vous pouvez commencer à compiler et télécharger des programmes vers plusieurs familles de microcontrôleurs (Atmel AVR, Atmel SAM, ST STM32, TI MSP430 et autres). </font><font style="vertical-align: inherit;">Dans le même temps, différents ensembles de bibliothèques sont pris en charge (sur le site Web PlatformIO, ils sont appelés cadres): Arduino, Energia, mbed, ainsi que le code natif pour Atmel AVR, espressif, MSP430. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PlatformIO était initialement orienté pour fonctionner à partir de la ligne de commande, il existe également des plugins pour l'intégration avec les éditeurs de texte et les IDE: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atom, CLion, Eclipse, Emacs, NetBeans, Qt Creator, Sublime Text, Vim et Visual Studio</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PlatformIO est particulièrement adapté si vous avez:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un projet pour plusieurs conseils, c'est-à-dire </font><font style="vertical-align: inherit;">le même code devrait compiler pour différentes cartes</font></font></li>
<li>    , ..     ,      </li>
<li>    ssh,   PlatformIO   Raspberry Pi</li>
<li>   </li>
</ul><br>
<img src="http://docs.platformio.org/en/latest/_images/platformio-demo-wiring.gif" alt="image"><br>
<br>
<br>
<h5>  Arduino</h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne reviendrai pas sur la documentation, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voici les instructions d'installation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pour l'utilisation, voir la section </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Démarrage rapide</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La structure des dossiers du projet pour PlatformIO diffère du projet Arduino IDE, chaque projet contient un fichier platformio.ini qui indique quelles cartes sont utilisées. </font><font style="vertical-align: inherit;">Ainsi, vous n'avez pas à choisir la bonne planche à chaque fois. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais vous donner un exemple de la façon dont j'utilise PlatformIO lors du développement d'une bibliothèque pour Arduino. </font><font style="vertical-align: inherit;">La bibliothèque a deux exemples, chacun d'eux est un projet au format PlatformIO. </font><font style="vertical-align: inherit;">Le fichier de paramètres du projet platformio.ini répertorie toutes les cartes sur lesquelles la bibliothèque doit s'exécuter:</font></font><br>
<pre><code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">env</span></span>:<span class="hljs-type"><span class="hljs-type">nanoatmega328</span></span>]<font></font>
platform = atmelavr<font></font>
framework = arduino<font></font>
board = nanoatmega328<font></font>
<font></font>
[<span class="hljs-type"><span class="hljs-type">env</span></span>:<span class="hljs-type"><span class="hljs-type">sparkfun_promicro16</span></span>]<font></font>
platform = atmelavr<font></font>
framework = arduino<font></font>
board = sparkfun_promicro16<font></font>
<font></font>
[<span class="hljs-type"><span class="hljs-type">env</span></span>:<span class="hljs-type"><span class="hljs-type">due</span></span>]<font></font>
platform = atmelsam<font></font>
framework = arduino<font></font>
board = due<font></font>
<font></font>
[<span class="hljs-type"><span class="hljs-type">env</span></span>:<span class="hljs-type"><span class="hljs-type">teensy31</span></span>]<font></font>
platform = teensy<font></font>
framework = arduino<font></font>
board = teensy31<font></font>
<font></font>
[<span class="hljs-type"><span class="hljs-type">env</span></span>:<span class="hljs-type"><span class="hljs-type">nodemcu</span></span>]<font></font>
platform = espressif<font></font>
framework = arduino<font></font>
board = nodemcu<font></font>
<font></font>
[<span class="hljs-type"><span class="hljs-type">env</span></span>:<span class="hljs-type"><span class="hljs-type">uno</span></span>]<font></font>
platform = atmelavr<font></font>
framework = arduino<font></font>
board = uno<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez compiler un exemple pour toutes les cartes avec la commande:</font></font><br>
<pre><code class="bash hljs">platformio run</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez compiler uniquement pour uno comme ceci:</font></font><br>
<pre><code class="bash hljs">platformio run -e uno</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Téléchargez le firmware sur uno:</font></font><br>
<pre><code class="bash hljs">platformio run --target upload -e uno</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lancez le moniteur de port série:</font></font><br>
<pre><code class="bash hljs">platformio serialports monitor</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajout d'alias à .zshrc pour raccourcir les commandes:</font></font><br>
<pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> compile=<span class="hljs-string"><span class="hljs-string">"platformio run"</span></span>
<span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> upload=<span class="hljs-string"><span class="hljs-string">"platformio run --target upload"</span></span>
<span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> serial=<span class="hljs-string"><span class="hljs-string">"platformio serialports monitor"</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec eux la même séquence d'actions:</font></font><br>
<pre><code class="bash hljs">compile         <span class="hljs-comment"><span class="hljs-comment">#    </span></span>
compile -e uno  <span class="hljs-comment"><span class="hljs-comment">#   uno</span></span>
upload  -e uno  <span class="hljs-comment"><span class="hljs-comment">#  uno</span></span>
serial          <span class="hljs-comment"><span class="hljs-comment">#   </span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a aussi une intégration avec Travis CI et d'autres outils CI, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plus de détails ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, l'IDE Arduino a </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une interface en ligne de commande</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais elle est loin d'être parfaite.</font></font><br>
<br>
<br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlatformIO Nuances</font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PlatformIO accélère le travail; c'est un outil plus flexible que l'IDE Arduino et facilite l'automatisation des tâches de routine. </font><font style="vertical-align: inherit;">Il y a plusieurs points à considérer:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la compilation dans PlatformIO n'est pas toujours équivalente à la compilation dans Arduino IDE, ce qui a été compilé dans PlatformIO peut ne pas compiler dans Arduino IDE et vice versa</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la structure du dossier du projet ne correspond pas à la structure de l'IDE Arduino</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toutes les bibliothèques ne sont pas disponibles pour l'installation via </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">platformio lib</font></font></em></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serial.print ("Pourrait être mieux");</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel est le problème?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le Serial.print () standard est légèrement gênant si vous devez imprimer le </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nom et la valeur de la variable, par exemple, pour afficher "pin_2 = &lt;état pin 2&gt;, pin_3 = &lt;état broche 3&gt;", vous devez le faire:</font></font><br>
<pre><code class="cpp hljs">Serial.print(<span class="hljs-string"><span class="hljs-string">"pin_2 = "</span></span>);<font></font>
Serial.print(digitalRead(<span class="hljs-number"><span class="hljs-number">2</span></span>));<font></font>
<font></font>
Serial.print(<span class="hljs-string"><span class="hljs-string">", pin_3 = "</span></span>);<font></font>
Serial.println(digitalRead(<span class="hljs-number"><span class="hljs-number">3</span></span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, je souhaite désactiver partiellement ou complètement la sortie de la série, par exemple, si elle est utilisée uniquement pour le débogage. </font><font style="vertical-align: inherit;">Bien sûr, vous pouvez commenter les appels à Serial.print () pour cela, mais je voudrais une option plus élégante.</font></font><br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui a essayé</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arduinoLogging</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette bibliothèque utilise une syntaxe semblable à printf pour l'impression et vous permet également de définir LOGLEVEL et ainsi de désactiver la sortie de certains ou de tous les messages. </font><font style="vertical-align: inherit;">Les messages sont affichés à l'aide des méthodes Error, Info, Debug et Verbose. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un exemple:</font></font><br>
<pre><code class="cpp hljs">  <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Logging.h"</span></span></span></span><font></font>
<font></font>
  <span class="hljs-comment"><span class="hljs-comment">// LOGLEVEL   LOG_LEVEL_X,  X ∈ { NOOUTPUT, ERRORS, INFOS, DEBUG, VERBOSE }</span></span>
  <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOGLEVEL LOG_LEVEL_INFOS</span></span><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
    Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
    Log.Init(LOGLEVEL, &amp;Serial);<font></font>
<font></font>
    <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
    Log.Info(<span class="hljs-string"><span class="hljs-string">"pin_2 = %d, pin_3 = %d"</span></span>CR, digitalRead(<span class="hljs-number"><span class="hljs-number">2</span></span>), digitalRead(<span class="hljs-number"><span class="hljs-number">3</span></span>));<font></font>
<font></font>
    <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
    Log.Debug(<span class="hljs-string"><span class="hljs-string">"   ,   LOGLEVEL = LOG_LEVEL_INFOS"</span></span>);<font></font>
  }</code></pre><br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modificateurs disponibles</font></font></h5><br>
<table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caractère générique</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commenter</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% s</font></font></td>
<td>replace with an string (char*)</td>
<td>Log.Info("String %s", myString);</td>
</tr>
<tr>
<td>%c</td>
<td>replace with an character</td>
<td>Log.Info("use %c as input", myChar)</td>
</tr>
<tr>
<td>%d</td>
<td>replace with an integer value</td>
<td>Log.Info("current value %d",myValue);</td>
</tr>
<tr>
<td>%l</td>
<td>replace with an long value</td>
<td>Log.Info("current long %l", myLong);</td>
</tr>
<tr>
<td>%x</td>
<td>replace and convert integer value into hex</td>
<td>Log.Info ("as hex %x), myValue);</td>
</tr>
<tr>
<td>%X</td>
<td>like %x but combine with 0x123AB</td>
<td>Log.Info ("as hex %X), myValue);</td>
</tr>
<tr>
<td>%b</td>
<td>replace and convert integer value into binary</td>
<td>Log.Info ("as bin %b), myValue);</td>
</tr>
<tr>
<td>%B</td>
<td>like %x but combine with 0b10100011</td>
<td>Log.Info ("as bin %B), myValue);</td>
</tr>
<tr>
<td>%t</td>
<td>replace and convert boolean value into "t" or "f"</td>
<td>Log.Info ("is it true? %t), myBool);</td>
</tr>
<tr>
<td>%T</td>
<td>like %t but convert into "true" or "false"</td>
<td>Log.Info ("is it true? %T), myBool);</td>
</tr>
</tbody>
</table><br>
<h3> </h3><br>
<h4>advancedSerial</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les noms des niveaux de message Erreur, Info, Débogage et Verbose dans arduinoLogging ne sont pas neutres. L'erreur ne produit pas nécessairement une erreur, c'est juste un message qui s'affiche sur n'importe quel LOGLEVEL (sauf NOOUTPUT). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compte tenu également des inconvénients de printf, j'ai écrit ma propre version, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">advancedSerial</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, advancedSerial est deux choses: la possibilité d'appeler print () et println () dans les niveaux de chaîne et de message.</font></font><br>
<pre><code class="cpp hljs">  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">1</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">2</span></span>;<font></font>
<font></font>
  aSerial.print(<span class="hljs-string"><span class="hljs-string">"a = "</span></span>).print(a).print(<span class="hljs-string"><span class="hljs-string">"b = "</span></span>).println(b);<font></font>
<font></font>
  <span class="hljs-comment"><span class="hljs-comment">//     </span></span>
  aSerial.p(<span class="hljs-string"><span class="hljs-string">"a = "</span></span>).p(a).p(<span class="hljs-string"><span class="hljs-string">"b = "</span></span>).pln(b);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple complet de </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Basic.ino</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Étant donné que les noms des méthodes coïncident avec les noms des méthodes standard Serial.print () et Serial.println (), vous pouvez éventuellement remplacer Serial par aSerial dans les sources. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le nom des niveaux de message, j'ai choisi v, vv, vvv, vvvv, une manière assez courante d'indiquer les niveaux de détail des messages affichés, généralement trouvés comme les drapeaux -v, -vv, etc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec ces noms, il est plus facile de modifier un niveau à un autre, par exemple vv -&gt; vvv est plus facile que Info -&gt; Debug.</font></font><br>
<pre><code class="cpp hljs">  <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"advancedSerial.h"</span></span></span></span><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
    Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
<font></font>
    aSerial.setPrinter(Serial);    <span class="hljs-comment"><span class="hljs-comment">//      </span></span><font></font>
<font></font>
    <span class="hljs-comment"><span class="hljs-comment">//  ,      v  vv,  vvv  vvvv   </span></span><font></font>
    aSerial.setFilter(Level::vv);<font></font>
  }<font></font>
<font></font>
   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
     aSerial.l(Level::vv).pln(<span class="hljs-string"><span class="hljs-string">" "</span></span>);<font></font>
     aSerial.l(Level::vvv).pln(<span class="hljs-string"><span class="hljs-string">"  "</span></span>);<font></font>
<font></font>
     delay(<span class="hljs-number"><span class="hljs-number">3000</span></span>);<font></font>
   }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemple complet de </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advanced.ino</font></font></a><br>
<br>
<br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Économie de mémoire</font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous encapsulez la chaîne dans la macro F (), elle ne sera pas chargée en mémoire (SRAM), donc pour économiser de la mémoire, utilisez F ():</font></font><br>
<pre><code class="cpp hljs">  aSerial.print(F(<span class="hljs-string"><span class="hljs-string">" 16 "</span></span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, l'utilisation de advancedSerial ajoute des frais généraux par rapport au Serial standard, j'ai essayé d'estimer grossièrement lequel. </font><font style="vertical-align: inherit;">Ci-dessous, je présente les résultats de la compilation pour Arduino Uno, car il dispose de 2 Ko de mémoire et c'est le minimum parmi les cartes que j'utilise habituellement. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Série normale, sans aucune bibliothèque:</font></font></strong><br>
<pre><code class="cpp hljs">  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
   Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
    Serial.print(<span class="hljs-string"><span class="hljs-string">"test"</span></span>);<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"test"</span></span>);<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
espace de stockage: 5% de </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mémoire dynamique: 9% </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avancé</font></font></strong><br>
<pre><code class="cpp hljs">  <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;advancedSerial.h&gt;</span></span></span></span><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
   Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
<font></font>
   aSerial.setPrinter(Serial);<font></font>
   aSerial.setFilter(Level::vv);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
    aSerial.print(<span class="hljs-string"><span class="hljs-string">"test"</span></span>).println(<span class="hljs-string"><span class="hljs-string">"test"</span></span>);<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
espace de stockage: 5% </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mémoire dynamique: 10% </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemples / Advanced.ino</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
espace de stockage: 9% </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mémoire dynamique: 26% </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemples / Advanced.ino en utilisant la macro F ()</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
espace de stockage: 9% </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mémoire dynamique: 10% </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'avère que l'utilisation de la mémoire augmente légèrement. </font><font style="vertical-align: inherit;">Mais advancedSerial n'est pas une solution optimale en termes de ressources, il existe des implémentations alternatives, par exemple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation de la bibliothèque</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel est le problème?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par défaut, l'IDE Arduino installe les bibliothèques globalement et l'esquisse n'enregistre pas exactement quelles bibliothèques sont utilisées (à l'exception des directives #include, bien sûr) et quelles versions. </font><font style="vertical-align: inherit;">Pour cette raison, afin de compiler l'esquisse sur un autre ordinateur, vous devez savoir où télécharger les bibliothèques requises, encore une fois les versions de bibliothèque doivent également être spécifiées. </font><font style="vertical-align: inherit;">Pour éviter de tels problèmes, j'installe les bibliothèques uniquement localement, à l'intérieur du dossier d'esquisse. </font><font style="vertical-align: inherit;">Vous trouverez ci-dessous deux façons d'installer des bibliothèques localement pour l'IDE Arduino et PlatformIO.</font></font><br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino IDE</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'utilise rarement l'IDE Arduino, il y a peut-être une meilleure façon. </font><font style="vertical-align: inherit;">La méthode est la suivante: installez les bibliothèques dans un sous-dossier de votre projet et placez des liens symboliques (raccourcis?) Pour chaque bibliothèque dans le dossier des bibliothèques (dans le dossier où les bibliothèques Arduino IDE sont installées). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, si je me souviens bien, l'IDE Arduino compile toutes les bibliothèques du dossier des bibliothèques lors de la compilation de n'importe quelle esquisse, donc le temps de compilation augmente s'il y a beaucoup de bibliothèques dans les bibliothèques. </font><font style="vertical-align: inherit;">Une autre raison de ne pas utiliser l'IDE Arduino.</font></font><br>
<br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlatformIO</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque projet PlatformIO a un sous-dossier lib dans lequel les bibliothèques peuvent être placées. </font><font style="vertical-align: inherit;">C'est lors de l'installation manuelle des bibliothèques. </font><font style="vertical-align: inherit;">PlatformIO a également une commande distincte pour l'installation des bibliothèques lib platformio, malheureusement il installe les bibliothèques globalement par défaut, de sorte que les bibliothèques sont installées localement dans le sous-dossier lib, vous devez ajouter dans le projet platformio.ini:</font></font><br>
<pre><code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">platformio</span></span>]<font></font>
lib_dir = ./lib</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour plus d'informations sur platformio lib, consultez la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><cut></cut></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr392639/">https://habr.com/ru/post/fr392639/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr392629/index.html">Respirez plus profondément: les astronomes ont trouvé une naine blanche avec une atmosphère d'oxygène pur</a></li>
<li><a href="../fr392631/index.html">Swipebuster propose des services de suivi des utilisateurs de Tinder</a></li>
<li><a href="../fr392633/index.html">Journée de la cosmonautique 2016: événements par ville</a></li>
<li><a href="../fr392635/index.html">С днём рождения, лэптоп! 35 лет первому коммерчески успешному портативному компьютеру</a></li>
<li><a href="../fr392637/index.html">Toutes les ampoules LED IKEA</a></li>
<li><a href="../fr392641/index.html">Une machine de la taille d'un réfrigérateur peut imprimer des médicaments sur demande</a></li>
<li><a href="../fr392645/index.html">Difficultés de traduction et appleID</a></li>
<li><a href="../fr392647/index.html">Fonctionne bien, sinon interfère. Lightbridge dji phantom 3</a></li>
<li><a href="../fr392649/index.html">Les astronomes ont trouvé la première exoplanète dans le système des étoiles triples</a></li>
<li><a href="../fr392651/index.html">L'ordinateur a peint un nouveau tableau de Rembrandt 347 ans après la mort de l'artiste</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>