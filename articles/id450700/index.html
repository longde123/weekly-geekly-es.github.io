<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ûó üêØ üåΩ Lagi tentang abstraksi berlubang (atau tentang lingkungan yang tidak dapat diprediksi) üßê üë©‚Äçüè≠ üìº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jadi, bagian yang cukup sederhana dari program untuk Windows. Ada file yang berisi beberapa entri. Dan mereka perlu disaring dengan cara tertentu. 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lagi tentang abstraksi berlubang (atau tentang lingkungan yang tidak dapat diprediksi)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450700/">  Jadi, bagian yang cukup sederhana dari program untuk Windows.  Ada file yang berisi beberapa entri.  Dan mereka perlu disaring dengan cara tertentu. <br><br>  Solusinya cukup sederhana - buka file, baca catatan satu per satu, kami menulis yang diperlukan untuk file sementara.  Tutup file.  Kami menghapusnya.  Ganti nama sementara menjadi yang asli.  Semuanya sangat sederhana sehingga saya bahkan tidak akan memberikan kode.  Apakah ini alasan yang cukup untuk artikel ini? <br><br>  Sementara semuanya bekerja, sebenarnya tidak ada alasan untuk menulis tentang itu.  Tapi kemudian tiba-tiba suatu hari "semuanya jatuh", karena  penggantian nama tidak terjadi karena kesalahan Akses ditolak.  Ini sangat jarang terjadi, tetapi masih jauh lebih sering untuk mencurigai sinar kosmik. <br><a name="habracut"></a><br>  Kami memulai penggalian.  Petunjuk pertama yang ditemukan: dalam proses penggalian, kutipan dari dokumentasi Microsoft ini mengingatkan: <br><blockquote>  Fungsi DeleteFile menandai file untuk dihapus saat ditutup.  Oleh karena itu, penghapusan file tidak terjadi sampai pegangan terakhir ke file ditutup.  Panggilan selanjutnya ke CreateFile untuk membuka file gagal dengan ERROR_ACCESS_DENIED. </blockquote>  Dalam hal gejala, ini sangat mirip, tetapi dari mana "penangan lain" ini berasal, jika, selain kita, tidak ada yang melakukan dan tidak boleh melakukan apa pun dengan file ini?  Dan kami tidak memiliki utas lain dengan utas yang akan melakukan sesuatu dengan file ini? <br><br>  Pelakunya ditemukan berkat SysInternals dan ProcessMonitor mereka.  Kami meluncurkannya, memasang filter pada file lama kami dan mencoba mereproduksinya untuk waktu yang lama dan persisten.  Kami mereproduksi.  Kami melihat.  Dan apa yang kita lihat di sana? <br><blockquote>  01.2: 30: 28.3162097 PM our_prog.exe 1288 CreateFile our.file SUKSES Akses Yang Diinginkan: Generic Baca / Tulis <br>  02.2: 25: 28.3164513 PM our_prog.exe 1288 WriteFile our.file SUKSES Offset: 0, Panjang: 898, Prioritas: Normal <br>  ... <br>  34.2: 25: 28.3173405 PM our_prog.exe 1288 WriteFile our.file SUKSES Offset: 35.290, Panjang: 1.113 <br>  35.2: 25: 28.3173493 PM our_prog.exe 1288 WriteFile our.file SUKSES Offset: 36.403, Panjang: 1.128 <br>  36.2: 25: 28.3173736 PM our_prog.exe 1288 FlushBuffersFile our.file SUKSES <br>  37.2: 25: 28.3174212 PM our_prog.exe 1288 WriteFile our.file SUKSES Offset: 0, Panjang: 40.960, <br>  38.2: 25: 28.3175927 PM Explorer.EXE 1884 QueryBasicInformationFile our.file SUCCESS <br>  39.2: 25: 28.3176144 PM Explorer.EXE 1884 CloseFile SUKSES kami.file <br>  40.2: 25: 28.3263642 PM Explorer.EXE 1884 CreateFile our.file SUKSES Akses Yang Diinginkan: Baca Atribut, <br>  41.2: 25: 28.3294990 PM our_prog.exe 1288 CloseFile our.file SUKSES <br>  42.2: 25: 28.3351356 PM our_prog.exe 1288 CreateFile our.file SUKSES Akses Yang Diinginkan: Baca Atribut, Hapus, <br>  43.2: 25: 28.3351856 PM our_prog.exe 1288 QueryAttributeTagFile our.file SUKSES Atribut: A, ReparseTag: 0x0 <br>  44.2: 25: 28.3352020 PM our_prog.exe 1288 SetDispositionInformationFile our.file SUKSES Hapus: Benar <br>  45.2: 25: 28.3352218 PM our_prog.exe 1288 CloseFile SUKSES kami.file <br>  46.2: 25: 28.3358275 PM our_prog.exe 1288 CreateFile our.file DELETE PENDING Akses yang Diinginkan: Generic Read / Write, <br>  47.2: 25: 28.3362207 PM our_prog.exe 1288 CreateFile our.file DELETE PENDING Akses yang Diinginkan: Generic Read / Write, <br>  48.2: 25: 28.3367696 PM Explorer.EXE 1884 QueryBasicInformationFile our.file SUCCESS <br>  49.2: 25: 28.4279152 PM Explorer.EXE 1884 CloseFile SUKSES kami.file <br>  50.2: 25: 28.4282859 PM Explorer.EXE 1884 CreateFile our.file NAMA TIDAK DITEMUKAN Akses yang Diinginkan: Baca Atribut, <br>  ... <br>  83.2: 25: 29.3497760 PM our_prog.exe 1288 CreateFile our.file SUKSES Akses Yang Diinginkan: Generic Read / Write, </blockquote>  Dan kami melihat yang berikut di sana (data tambahan telah dihapus agar tidak berantakan).  Baris 1 hingga 36 - kami membuat file, menulis padanya, membuat flush.  Yang paling menarik dimulai pada baris 38-40.  Explorer.exe muncul entah dari mana dan mulai membaca file kami. <br><br>  Pada baris 41 kami menutup file kami.  Sejalan 42 - hapus.  Dan karena explorer.exe masih membacanya, file tersebut tidak dihapus.  Apa yang dapat kita lihat pada baris 46 dan 47 ketika kita mencoba mengubah nama file sementara kita menjadi yang utama (HAPUS status PENDING alih-alih SUKSES). <br><br>  Explorer.exe selesai membaca hanya pada baris 49. Hanya pada saat itu file tersebut dihapus secara fisik (seperti baris 50 memberitahu kita secara tidak langsung, di mana explorer.exe persisten kami lagi mencoba membuka file untuk dibaca, tetapi gagal karena file tersebut tidak lagi). <br><br>  Apa yang mengikuti dari ini?  Berkat Microsoft Windows, bahkan operasi penghapusan file sederhana sekarang perlu dilakukan dalam gaya pemrograman paranoid.  Mereka memanggil fungsi hapus, memastikan bahwa ia kembali OK, dan memasuki siklus tunggu "sampai file tersebut dihapus secara fisik."  Baik dan ya, tanpa mengetahui bahwa "dia memiliki neon di dalam," hampir tidak ada yang bisa dilakukan ... <br><br>  Tetapi sekarang keraguan menggerogoti saya bahwa pendekatan semacam itu adalah praktik yang diterima secara umum.  Untuk diingat selama bekerja dengan file di Windows bahwa OS setiap saat memutuskan untuk melakukan sesuatu dengan file tanpa sepengetahuan Anda, dan menulis kode yang tahan terhadap ini.  Dalam hubungan ini, survei lebih rendah. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id450700/">https://habr.com/ru/post/id450700/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id450686/index.html">Tiga fitur tersembunyi lainnya dari Zimbra Collaboration Suite yang akan membantu meningkatkan produktivitas karyawan</a></li>
<li><a href="../id450692/index.html">Bagaimana Perusahaan Menggunakan 7 Dosa Mematikan dalam Penjualan Produk</a></li>
<li><a href="../id450694/index.html">Mengapa Jeff Bezos merekomendasikan penskalaan kegagalan dan menonton fiksi ilmiah</a></li>
<li><a href="../id450696/index.html">Generator widget CRUD untuk Yii</a></li>
<li><a href="../id450698/index.html">Gears di Box2D</a></li>
<li><a href="../id450702/index.html">Tempatnya terkutuk?</a></li>
<li><a href="../id450704/index.html">Minggu Keamanan 19: Kerentanan dalam Kamera IP, Pelacak GPS dan Monitor Nirkabel</a></li>
<li><a href="../id450708/index.html">Python dalam Visual Studio Code - April 2019 Release</a></li>
<li><a href="../id450710/index.html">Rekonstruksi Midi dari video Synthesia (dan sejenisnya)</a></li>
<li><a href="../id450712/index.html">DotNetRu at DotNext 2019 Piter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>