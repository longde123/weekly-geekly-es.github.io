<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЪН ЁЯСиЁЯП╛тАНЁЯдЭтАНЁЯСиЁЯП╗ тЬи рдЬрд╝рд┐рдк рдЖрд░реНрдХрд╛рдЗрд╡ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ рдФрд░ рд╣рдо рдЗрд╕рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рднрд╛рдЧ 2 - рдбреЗрдЯрд╛ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ рдФрд░ рд╕рдВрдкреАрдбрд╝рди ЁЯЪгЁЯП┐ ЁЯНЫ ЁЯПп</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд▓реЗрдЦ рдХреА рдирд┐рд░рдВрддрд░рддрд╛ рдЬрд╝рд┐рдк рд╕рдВрдЧреНрд░рд╣ рдХреИрд╕реЗ рджрд┐рдЦрддрд╛ рд╣реИ рдФрд░ рд╣рдо рдЗрд╕рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ ред 
 рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛ 


 рд╢реБрдн рджрд┐рдиред 
 рдФрд░ рдлрд┐рд░ рд╕реЗ рд╣рд╡рд╛ рдореЗрдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ PHP рдореЗрдВ рдЕрдкрд░рдВрдкрд░рд╛рдЧрдд ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЬрд╝рд┐рдк рдЖрд░реНрдХрд╛рдЗрд╡ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ рдФрд░ рд╣рдо рдЗрд╕рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рднрд╛рдЧ 2 - рдбреЗрдЯрд╛ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ рдФрд░ рд╕рдВрдкреАрдбрд╝рди</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472966/"><p>  <i>рд▓реЗрдЦ рдХреА рдирд┐рд░рдВрддрд░рддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬрд╝рд┐рдк рд╕рдВрдЧреНрд░рд╣ рдХреИрд╕реЗ рджрд┐рдЦрддрд╛ рд╣реИ рдФрд░ рд╣рдо рдЗрд╕рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ</a> ред</i> </p><br><h3>  рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛ </h3><br><p> рд╢реБрдн рджрд┐рдиред <br>  рдФрд░ рдлрд┐рд░ рд╕реЗ рд╣рд╡рд╛ рдореЗрдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ PHP рдореЗрдВ рдЕрдкрд░рдВрдкрд░рд╛рдЧрдд рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рд╣реИред </p><br><p>  рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ рдореЗрдВ, рд╕рдореНрдорд╛рдирд┐рдд рдкрд╛рдардХреЛрдВ рдХреЛ рдЬрд┐рдк рд╕рдВрдкреАрдбрд╝рди рдФрд░ рдЬрд┐рдк рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдореЗрдВ рд░реБрдЪрд┐ рдереАред  рдЖрдЬ рд╣рдо рдЗрд╕ рд╡рд┐рд╖рдп рдХреЛ рдереЛрдбрд╝рд╛ рдЦреЛрд▓рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВрдЧреЗред </p><a name="habracut"></a><br><p>  рдЖрдЗрдП рдПрдХ рдирдЬрд░ рдбрд╛рд▓рддреЗ рд╣реИрдВ <br><br></p><div class="spoiler">  <b class="spoiler_title">рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ рд╕реЗ рдХреЛрдб</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//        (1.txt  2.txt)   : $entries = [ '1.txt' =&gt; 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc id ante ultrices, fermentum nibh eleifend, ullamcorper nunc. Sed dignissim ut odio et imperdiet. Nunc id felis et ligula viverra blandit a sit amet magna. Vestibulum facilisis venenatis enim sed bibendum. Duis maximus felis in suscipit bibendum. Mauris suscipit turpis eleifend nibh commodo imperdiet. Donec tincidunt porta interdum. Aenean interdum condimentum ligula, vitae ornare lorem auctor in. Suspendisse metus ipsum, porttitor et sapien id, fringilla aliquam nibh. Curabitur sem lacus, ultrices quis felis sed, blandit commodo metus. Duis tincidunt vel mauris at accumsan. Integer et ipsum fermentum leo viverra blandit.', '2.txt' =&gt; 'Mauris in purus sit amet ante tempor finibus nec sed justo. Integer ac nibh tempus, mollis sem vel, consequat diam. Pellentesque ut condimentum ex. Praesent finibus volutpat gravida. Vivamus eleifend neque sit amet diam scelerisque lacinia. Nunc imperdiet augue in suscipit lacinia. Curabitur orci diam, iaculis non ligula vitae, porta pellentesque est. Duis dolor erat, placerat a lacus eu, scelerisque egestas massa. Aliquam molestie pulvinar faucibus. Quisque consequat, dolor mattis lacinia pretium, eros eros tempor neque, volutpat consectetur elit elit non diam. In faucibus nulla justo, non dignissim erat maximus consectetur. Sed porttitor turpis nisl, elementum aliquam dui tincidunt nec. Nunc eu enim at nibh molestie porta ut ac erat. Sed tortor sem, mollis eget sodales vel, faucibus in dolor.', ]; //      Lorem.zip,      cwd (      ) $destination = 'Lorem.zip'; $handle = fopen($destination, 'w'); //      ,    ,     ,   "" Central Directory File Header $written = 0; $dictionary = []; foreach ($entries as $filename =&gt; $content) { //         Local File Header,     //        ,      . $fileInfo = [ //     'versionToExtract' =&gt; 10, //   0,        - 'generalPurposeBitFlag' =&gt; 0, //      ,    0 'compressionMethod' =&gt; 0, // -    mtime ,    ,      ? 'modificationTime' =&gt; 28021, //   , ? 'modificationDate' =&gt; 20072, //      .     ,       ,   ? 'crc32' =&gt; hexdec(hash('crc32b', $content)), //     .        . //       :) 'compressedSize' =&gt; $size = strlen($content), 'uncompressedSize' =&gt; $size, //    'filenameLength' =&gt; strlen($filename), //  .    ,   0. 'extraFieldLength' =&gt; 0, ]; //      . $LFH = pack('LSSSSSLLLSSa*', ...array_values([ 'signature' =&gt; 0x04034b50, //  Local File Header ] + $fileInfo + ['filename' =&gt; $filename])); //       ,       Central Directory File Header $dictionary[$filename] = [ 'signature' =&gt; 0x02014b50, //  Central Directory File Header 'versionMadeBy' =&gt; 798, //  .    ,  -  . ] + $fileInfo + [ 'fileCommentLength' =&gt; 0, //    . No comments 'diskNumber' =&gt; 0, //     0,        'internalFileAttributes' =&gt; 0, //    'externalFileAttributes' =&gt; 2176057344, //    'localFileHeaderOffset' =&gt; $written, //      Local File Header 'filename' =&gt; $filename, //  . ]; //      $written += fwrite($handle, $LFH); //    $written += fwrite($handle, $content); } // ,     ,    . //          End of central directory record (EOCD) $EOCD = [ //  EOCD 'signature' =&gt; 0x06054b50, //  .    ,   0 'diskNumber' =&gt; 0, //      -  0 'startDiskNumber' =&gt; 0, //       . 'numberCentralDirectoryRecord' =&gt; $records = count($dictionary), //    .    ,     'totalCentralDirectoryRecord' =&gt; $records, //   Central Directory Record. //      ,      'sizeOfCentralDirectory' =&gt; 0, // ,    Central Directory Records 'centralDirectoryOffset' =&gt; $written, //     'commentLength' =&gt; 0 ]; //     !   foreach ($dictionary as $entryInfo) { $CDFH = pack('LSSSSSSLLLSSSSSLLa*', ...array_values($entryInfo)); $written += fwrite($handle, $CDFH); } // ,   .  ,    $EOCD['sizeOfCentralDirectory'] = $written - $EOCD['centralDirectoryOffset']; //     End of central directory record $EOCD = pack('LSSSSLLS', ...array_values($EOCD)); $written += fwrite($handle, $EOCD); //  . fclose($handle); echo '  : ' . $written . ' ' . PHP_EOL; echo '     `unzip -tq ' . $destination . '`' . PHP_EOL; echo PHP_EOL;</span></span></code> </pre> <br></div></div><br><p>  рдЙрд╕рдХреА рд╕рдорд╕реНрдпрд╛ рдХреНрдпрд╛ рд╣реИ?  рдЦреИрд░, рдирд┐рд╖реНрдкрдХреНрд╖рддрд╛ рдореЗрдВ, рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдЗрд╕рдХрд╛ рдПрдХрдорд╛рддреНрд░ рдлрд╛рдпрджрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдФрд░ рд╡рд╣рд╛рдВ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреАред <br><br>  рдореЗрд░реА рд░рд╛рдп рдореЗрдВ, рдореБрдЦреНрдп рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдкрд╣рд▓реЗ <b>crc32</b> рдФрд░ рдлрд╝рд╛рдЗрд▓ рдХреА рд▓рдВрдмрд╛рдИ рдХреЗ рд╕рд╛рде <b>рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рд╣реИрдбрд░ (LFH)</b> рд▓рд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдлрд┐рд░ рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╣реАред <br>  рдЗрд╕рд╕реЗ рдХреНрдпрд╛ рдЦрддрд░рд╛ рд╣реИ?  рдпрд╛ рд╣рдо рдкреВрд░реА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рдХреЗ рд▓рд┐рдП crc32 рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ, <b>LFH</b> рд▓рд┐рдЦреЗрдВ, рдФрд░ рдлрд┐рд░ рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА I / O рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рдХрд┐рдлрд╛рдпрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдмрдбрд╝реА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде рд╕реНрд╡реАрдХрд╛рд░реНрдп рдирд╣реАрдВ рд╣реИред  рдпрд╛ рд╣рдо рдлрд╝рд╛рдЗрд▓ рдХреЛ 2 рдмрд╛рд░ рдкрдврд╝рддреЗ рд╣реИрдВ - рдкрд╣рд▓реЗ рд╣реИрд╢ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдФрд░ рдлрд┐рд░ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдкрдврд╝рдиреЗ рдФрд░ рд╕рдВрдЧреНрд░рд╣ рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП - рдЖрд░реНрдерд┐рдХ рд░реВрдк рд╕реЗ рд░рд╛рдо рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рд▓реЗрдХрд┐рди, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдпрд╣ рдбреНрд░рд╛рдЗрд╡ рдкрд░ рд▓реЛрдб рдХреЛ рджреЛрдЧреБрдирд╛ рдХрд░ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдЬрд░реВрд░реА рдирд╣реАрдВ рдХрд┐ рдПрдХ рдПрд╕рдПрд╕рдбреА рд╣реИред <br><br>  рдФрд░ рдЕрдЧрд░ рдлрд╝рд╛рдЗрд▓ рджреВрд░рд╕реНрде рд░реВрдк рд╕реЗ рд╕реНрдерд┐рдд рд╣реИ рдФрд░ рдЗрд╕рдХреА рдорд╛рддреНрд░рд╛, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, 1.5GB?  рдЦреИрд░, рдЖрдкрдХреЛ рдпрд╛ рддреЛ рд╕рднреА 1.5GB рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдпрд╛ рдЗрди рд╕рднреА 1.5GB рдХреЗ рдбрд╛рдЙрдирд▓реЛрдб рд╣реЛрдиреЗ рддрдХ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рд╣рдо рд╣реИрд╢ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рд╕рд╛рдордЧреНрд░реА рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдлрд┐рд░ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВрдЧреЗред  рдпрджрд┐ рд╣рдо рдордХреНрдЦреА рдкрд░ рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдбрдВрдк рдбреЗрдЯрд╛рдмреЗрд╕, рдЬрд┐рд╕реЗ рд╣рдо, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕реНрдЯрдбрдЖрдЙрдЯ рд╕реЗ рдкрдврд╝рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдЖрдо рддреМрд░ рдкрд░ рдЕрд╕реНрд╡реАрдХрд╛рд░реНрдп рд╣реИ - рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдбреЗрдЯрд╛ рдмрджрд▓ рдЧрдпрд╛ рд╣реИ, рдбрдВрдк рдбреЗрдЯрд╛ рдмрджрд▓ рдЬрд╛рдПрдЧрд╛, рдПрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд▓рдЧ-рдерд▓рдЧ рд╣реИ рдФрд░ рд╣рдореЗрдВ рдПрдХ рдЕрдорд╛рдиреНрдп рд╕рдВрдЧреНрд░рд╣ рдорд┐рд▓реЗрдЧрд╛ред  рд╣рд╛рдБ, рдЪреАрдЬреЗрдВ рдЦрд░рд╛рдм рд╣реИрдВ, рдмрд┐рд▓реНрдХреБрд▓ред </p><br><h3>  рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдЕрднрд┐рд▓реЗрдЦ рдЕрднрд┐рд▓реЗрдЦреЛрдВ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ рд╕рдВрд░рдЪрдирд╛ </h3><br><p>  рд▓реЗрдХрд┐рди рд╣рддреЛрддреНрд╕рд╛рд╣рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд╝рд┐рдк рд╡рд┐рдирд┐рд░реНрджреЗрд╢рди рд╣рдореЗрдВ рдкрд╣рд▓реЗ рдбреЗрдЯрд╛ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдбреЗрдЯрд╛ рдХреЗ рдмрд╛рдж <b>рдбреЗрдЯрд╛ рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрдЯрд░ (рдбреАрдбреА)</b> рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдЪрд┐рдкрдХрд╛ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА crc32, рдкреИрдХреНрдб рдбреЗрдЯрд╛ рдХреА рд▓рдВрдмрд╛рдИ рдФрд░ рдмрд┐рдирд╛ рд╕рдВрдкреАрдбрд╝рди рдХреЗ рдбреЗрдЯрд╛ рдХреА рд▓рдВрдмрд╛рдИ рд╣реЛрдЧреАред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ <b>LFH</b> рдореЗрдВ <strike>рдПрдХ рдЦрд╛рд▓реА рдкреЗрдЯ рдкрд░ рджрд┐рди рдореЗрдВ рдХреЗрд╡рд▓ 3 рдмрд╛рд░ рдХреА</strike> рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, <b>0P0008 рдХреЗ</b> рдмрд░рд╛рдмрд░ <b>generalPurposeBitFlag</b> рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ, рдФрд░ <b>crc32</b> , <b>рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд░реЗрдВ</b> рдФрд░ <b>0</b> рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред  рдлрд┐рд░, рдбреЗрдЯрд╛ рдХреЗ рдмрд╛рдж, рд╣рдо <b>DD</b> рд╕рдВрд░рдЪрдирд╛ рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рдЬреЛ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрд╛рдИ рджреЗрдЧреА: </p><br><br><pre> <code class="php hljs">pack(<span class="hljs-string"><span class="hljs-string">'LLLL'</span></span>, ...array_values([ <span class="hljs-string"><span class="hljs-string">'signature'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0x08074b50</span></span>, <span class="hljs-comment"><span class="hljs-comment">//  Data Descriptor 'crc32' =&gt; $crc32, //  crc32    'compressedSize' =&gt; $compressedSize, //    'uncompressedSize' =&gt; $uncompressedSize, //    . ]));</span></span></code> </pre> <br><p>  рдФрд░ <b>рд╕реЗрдВрдЯреНрд░рд▓ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдлрд╛рдЗрд▓ рд╣реИрдбрд░ (рд╕реАрдбреАрдПрдлрдПрдЪ) рдореЗрдВ</b> рдХреЗрд╡рд▓ <b>рд╕рд╛рдорд╛рдиреНрдпрдкрд╛рд░реНрдЯрдмрд┐рдЯрдмреНрд▓реИрдл рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ</b> , рдмрд╛рдХреА рдбреЗрдЯрд╛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рд▓реЗрдХрд┐рди рдпрд╣ рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рд╕рднреА рдбреЗрдЯрд╛ рдХреЗ рдмрд╛рдж <b>рд╕реАрдбреАрдПрдлрдПрдЪ</b> рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рдФрд░ рдбреЗрдЯрд╛ рд▓рдВрдмрд╛рдИ рдХреЗ рд╕рд╛рде рд╣реИрд╢ рдХрд┐рд╕реА рднреА рдорд╛рдорд▓реЗ рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдпрд╣ рд╕рдм, рдЬрд╝рд╛рд╣рд┐рд░ рд╣реИ, рдЕрдЪреНрдЫрд╛ рд╣реИред  рдпрд╣ рдХреЗрд╡рд▓ PHP рдореЗрдВ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдиреА рд╣реБрдИ рд╣реИред <br>  рдФрд░ рдорд╛рдирдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИрд╢</a> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╕реЗ рд╣рдореЗрдВ рдмрд╣реБрдд рдорджрдж рдорд┐рд▓реЗрдЧреАред  рд╣рдо рдПрдХ рд╣реИрд╢ рд╕рдВрджрд░реНрдн рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдпрд╣ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рд╡рд┐рдЦрдВрдбреВ рдХреЛ рднрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛, рдФрд░ рдЕрдВрдд рдореЗрдВ рд╣реИрд╢ рдорд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред  рдмреЗрд╢рдХ, рдпрд╣ рд╕рдорд╛рдзрд╛рди <i>рд╣реИрд╢ ('crc32b', $ рд╕рд╛рдордЧреНрд░реА) рдХреА</i> рддреБрд▓рдирд╛ рдореЗрдВ рдХреБрдЫ рдЕрдзрд┐рдХ рдмреЛрдЭрд┐рд▓ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рд╣рдореЗрдВ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдФрд░ рд╕рдордп рдХреЗ рдПрдХ рдЕрдХрд▓реНрдкрдиреАрдп рдЧреБрдЪреНрдЫрд╛ рд╕реЗ рдмрдЪрд╛рдПрдЧрд╛ред <br><br>  рдпрд╣ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: <br><br></p><pre> <code class="php hljs">$hashCtx = hash_init(<span class="hljs-string"><span class="hljs-string">'crc32b'</span></span>); $handle = fopen($source, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!feof($handle)) { $chunk = fread($handle, <span class="hljs-number"><span class="hljs-number">8</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span>); hash_update($hashCtx, $chunk); $chunk = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } $hash = hash_final($hashCtx);</code> </pre> <br>  рдпрджрд┐ рд╕рдм рдХреБрдЫ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдорд╛рди <i>hash_file ('crc32b', $ source)</i> рдпрд╛ <i>hash ('crc32b', file_get_content ($ source))</i> рд╕реЗ <i>рдмрд┐рд▓реНрдХреБрд▓</i> рдЕрд▓рдЧ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред <br><br><p>  рдЖрдЗрдП рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рдЗрд╕реЗ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд▓рдкреЗрдЯрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ, рддрд╛рдХрд┐ рд╣рдо рдЖрд╕рд╛рдиреА рд╕реЗ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрдврд╝ рд╕рдХреЗрдВ, рдФрд░ рдЕрдВрдд рдореЗрдВ рдЗрд╕рдХреА рд╣реИрд╢ рдФрд░ рд▓рдВрдмрд╛рдИ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВред  рдФрд░ рдЬрдирд░реЗрдЯрд░ рд╣рдореЗрдВ рдЗрд╕рдореЗрдВ рдорджрдж рдХрд░реЗрдВрдЧреЗ: <br><br></p><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $path)</span></span></span><span class="hljs-function">: \</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generator</span></span></span><span class="hljs-function"> </span></span>{ $length = <span class="hljs-number"><span class="hljs-number">0</span></span>; $handle = fopen($path, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); $hashCtx = hash_init(<span class="hljs-string"><span class="hljs-string">'crc32b'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!feof($handle)) { $chunk = fread($handle, <span class="hljs-number"><span class="hljs-number">8</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span>); $length += strlen($chunk); hash_update($hashCtx, $chunk); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> $chunk; $chunk = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } fclose($handle); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'length'</span></span> =&gt; $length, <span class="hljs-string"><span class="hljs-string">'crc32'</span></span> =&gt; hexdec(hash_final($hashCtx))]; }</code> </pre> <br>  рдФрд░ рдЕрдм рд╣рдо рдмрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ <br><br><pre> <code class="php hljs">$reader = read(<span class="hljs-string"><span class="hljs-string">'https://speed.hetzner.de/1GB.bin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($reader <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $chunk) { <span class="hljs-comment"><span class="hljs-comment">// -   . } //      . ['length' =&gt; $length, 'crc32' =&gt; $crc32] = $reader-&gt;getReturn(); echo round(memory_get_peak_usage(true) / 1024 / 1024, 2) . 'MB - Memory Peak Usage' . PHP_EOL;</span></span></code> </pre> <br>  рдореЗрд░реА рд░рд╛рдп рдореЗрдВ рдпрд╣ рдХрд╛рдлреА рд╕рд░рд▓ рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред  1GB рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕рд╛рде, рдореЗрд░реА рдЪрд░рдо рдореЗрдореЛрд░реА рдЦрдкрдд 2MB рдереАред <br><p>  рдЕрдм рд╣рдо рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ рд╕реЗ рдХреЛрдб рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╣рдо рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдВред <br><br></p><div class="spoiler">  <b class="spoiler_title">рдЕрдВрддрд┐рдо рд╕реНрдХреНрд░рд┐рдкреНрдЯ</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $path)</span></span></span><span class="hljs-function">: \</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generator</span></span></span><span class="hljs-function"> </span></span>{ $length = <span class="hljs-number"><span class="hljs-number">0</span></span>; $handle = fopen($path, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); $hashCtx = hash_init(<span class="hljs-string"><span class="hljs-string">'crc32b'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!feof($handle)) { $chunk = fread($handle, <span class="hljs-number"><span class="hljs-number">8</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span>); $length += strlen($chunk); hash_update($hashCtx, $chunk); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> $chunk; $chunk = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } fclose($handle); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'length'</span></span> =&gt; $length, <span class="hljs-string"><span class="hljs-string">'crc32'</span></span> =&gt; hexdec(hash_final($hashCtx))]; } $entries = [<span class="hljs-string"><span class="hljs-string">'https://speed.hetzner.de/100MB.bin'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>]; $destination = <span class="hljs-string"><span class="hljs-string">'test.zip'</span></span>; $handle = fopen($destination, <span class="hljs-string"><span class="hljs-string">'w'</span></span>); $written = <span class="hljs-number"><span class="hljs-number">0</span></span>; $dictionary = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($entries <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $entry) { $filename = basename($entry); $fileInfo = [ <span class="hljs-string"><span class="hljs-string">'versionToExtract'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-comment"><span class="hljs-comment">//       Data Descriptor,     00008, //   00000    . 'generalPurposeBitFlag' =&gt; 0x0008, 'compressionMethod' =&gt; 0, 'modificationTime' =&gt; 28021, 'modificationDate' =&gt; 20072, 'crc32' =&gt; 0, 'compressedSize' =&gt; 0, 'uncompressedSize' =&gt; 0, 'filenameLength' =&gt; strlen($filename), 'extraFieldLength' =&gt; 0, ]; $LFH = pack('LSSSSSLLLSSa*', ...array_values([ 'signature' =&gt; 0x04034b50, ] + $fileInfo + ['filename' =&gt; $filename])); $fileOffset = $written; $written += fwrite($handle, $LFH); //     $reader = read($entry); foreach ($reader as $chunk) { //      $written += fwrite($handle, $chunk); $chunk = null; } //       ['length' =&gt; $length, 'crc32' =&gt; $crc32] = $reader-&gt;getReturn(); //    fileInfo,     CDFH $fileInfo['crc32'] = $crc32; $fileInfo['compressedSize'] = $length; $fileInfo['uncompressedSize'] = $length; //  Data Descriptor $DD = pack('LLLL', ...array_values([ 'signature' =&gt; 0x08074b50, 'crc32' =&gt; $fileInfo['crc32'], 'compressedSize' =&gt; $fileInfo['compressedSize'], 'uncompressedSize' =&gt; $fileInfo['uncompressedSize'], ])); $written += fwrite($handle, $DD); $dictionary[$filename] = [ 'signature' =&gt; 0x02014b50, 'versionMadeBy' =&gt; 798, ] + $fileInfo + [ 'fileCommentLength' =&gt; 0, 'diskNumber' =&gt; 0, 'internalFileAttributes' =&gt; 0, 'externalFileAttributes' =&gt; 2176057344, 'localFileHeaderOffset' =&gt; $fileOffset, 'filename' =&gt; $filename, ]; } $EOCD = [ 'signature' =&gt; 0x06054b50, 'diskNumber' =&gt; 0, 'startDiskNumber' =&gt; 0, 'numberCentralDirectoryRecord' =&gt; $records = count($dictionary), 'totalCentralDirectoryRecord' =&gt; $records, 'sizeOfCentralDirectory' =&gt; 0, 'centralDirectoryOffset' =&gt; $written, 'commentLength' =&gt; 0 ]; foreach ($dictionary as $entryInfo) { $CDFH = pack('LSSSSSSLLLSSSSSLLa*', ...array_values($entryInfo)); $written += fwrite($handle, $CDFH); } $EOCD['sizeOfCentralDirectory'] = $written - $EOCD['centralDirectoryOffset']; $EOCD = pack('LSSSSLLS', ...array_values($EOCD)); $written += fwrite($handle, $EOCD); fclose($handle); echo '  : ' . memory_get_peak_usage(true) . ' ' . PHP_EOL; echo '  : ' . $written . ' ' . PHP_EOL; echo '   `unzip -tq ' . $destination . '`: ' . PHP_EOL; echo '&gt; ' . exec('unzip -tq ' . $destination) . PHP_EOL; echo PHP_EOL;</span></span></code> </pre> <br></div></div><br>  рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ, рд╣рдореЗрдВ рдирд╛рдо test.zip рдХреЗ рд╕рд╛рде рдПрдХ рдЬрд╝рд┐рдк рд╕рдВрдЧреНрд░рд╣ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдореЗрдВ рдЙрдкрд░реЛрдХреНрдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ 100 рдПрдордмреА.рдмрд┐рди рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╣реЛрдЧреА, рдЖрдХрд╛рд░ рдореЗрдВ рд▓рдЧрднрдЧ 100 рдПрдордмреАред <br><br><h3>  рдЬрд╝рд┐рдк рдЕрднрд┐рд▓реЗрдЦрд╛рдЧрд╛рд░ рдореЗрдВ рд╕рдВрдкреАрдбрд╝рди </h3><br><p>  рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ рд╕рдм рдХреБрдЫ рд╣реИ рдФрд░ рдпрд╣ рдордХреНрдЦреА рдкрд░ рднреА рд╣реИред <br>  рдЬрд┐рд╕ рддрд░рд╣ рд╣рдореЗрдВ рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ рд▓рд┐рдП рдЫреЛрдЯреЗ-рдЫреЛрдЯреЗ <i>рд╡рд┐рд░рд╛рдо</i> рджреЗрдиреЗ рд╕реЗ рдПрдХ рд╣реИрд╢ рдорд┐рд▓рддрд╛ рд╣реИ, рдЙрд╕реА рддрд░рд╣ рд╣рдо рдбреЗрдЯрд╛ рдХреЛ <i>рд▓рд╛рдЬрд╡рд╛рдм рдЬрд╝реНрд▓рд┐рдм</i> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдФрд░ рдЙрд╕рдХреЗ <i>рдбрд┐рдлреНрд▓реЗрдЯ_рдЗрдирд┐рдЯ</i> рдФрд░ <i>рдбрд┐рдлреНрд▓реЗрдЯ_рдПрдб рдХреЗ рдлрдВрдХреНрд╢рдиреНрд╕ рд╕реЗ</i> рднреА рдХрдВрдкреНрд░реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдпрд╣ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: <br><br></p><pre> <code class="php hljs">$deflateCtx = deflate_init(ZLIB_ENCODING_RAW, [<span class="hljs-string"><span class="hljs-string">'level'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>]); $handle = fopen($source, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!feof($handle)) { $chunk = fread($handle, <span class="hljs-number"><span class="hljs-number">8</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> deflate_add($deflateCtx, $chunk, feof($handle) ? ZLIB_FINISH : ZLIB_SYNC_FLUSH); $chunk = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre> <br>  <i>рдореБрдЭреЗ рдЗрд╕ рддрд░рд╣ рдХрд╛ рдПрдХ рд╡рд┐рдХрд▓реНрдк рдорд┐рд▓рд╛, рдЬреЛ рдкрд┐рдЫрд▓реЗ рдПрдХ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдВрдд рдореЗрдВ рдХреБрдЫ рд╢реВрдиреНрдп рдЬреЛрдбрд╝ рджреЗрдЧрд╛ред</i> <div class="spoiler">  <b class="spoiler_title">рд╕реНрдкрд╛рдпрд▓рд░ рд╣реЗрдбрд┐рдВрдЧ</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!feof($handle)) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> deflate_add($deflateCtx, $chunk, ZLIB_SYNC_FLUSH); } <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> deflate_add($deflateCtx, <span class="hljs-string"><span class="hljs-string">''</span></span>, ZLIB_FINISH);</code> </pre> <br></div></div>  <i>рд▓реЗрдХрд┐рди рдЕрдирдЭрд┐рдк рдХрд╕рдо, рдЗрд╕рд▓рд┐рдП рдореБрдЭреЗ рдЗрд╕ рддрд░рд╣ рдХреЗ рд╕рд░рд▓реАрдХрд░рдг рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдирд╛ рдерд╛ред</i> <br><br><p>  рдЖрдЗрдП рд╣рдорд╛рд░реЗ <i>рдкрд╛рдардХ рдХреЛ</i> рдареАрдХ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рддреБрд░рдВрдд рд╣рдорд╛рд░реЗ рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд░реЗ, рдФрд░ рдЕрдВрдд рдореЗрдВ рд╣рдореЗрдВ рдПрдХ рд╣реИрд╢ рджреЗрддрд╛ рд╣реИ, рдмрд┐рдирд╛ рд╕рдВрдкреАрдбрд╝рди рдХреЗ рдбреЗрдЯрд╛ рдХреА рд▓рдВрдмрд╛рдИ рдФрд░ рд╕рдВрдкреАрдбрд╝рди рдХреЗ рд╕рд╛рде рдбреЗрдЯрд╛ рдХреА рд▓рдВрдмрд╛рдИ: <br><br></p><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $path)</span></span></span><span class="hljs-function">: \</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generator</span></span></span><span class="hljs-function"> </span></span>{ $uncompressedSize = <span class="hljs-number"><span class="hljs-number">0</span></span>; $compressedSize = <span class="hljs-number"><span class="hljs-number">0</span></span>; $hashCtx = hash_init(<span class="hljs-string"><span class="hljs-string">'crc32b'</span></span>); $deflateCtx = deflate_init(ZLIB_ENCODING_RAW, [<span class="hljs-string"><span class="hljs-string">'level'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>]); $handle = fopen($path, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!feof($handle)) { $chunk = fread($handle, <span class="hljs-number"><span class="hljs-number">8</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span>); hash_update($hashCtx, $chunk); $compressedChunk = deflate_add($deflateCtx, $chunk, feof($handle) ? ZLIB_FINISH : ZLIB_SYNC_FLUSH); $uncompressedSize += strlen($chunk); $compressedSize += strlen($compressedChunk); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> $compressedChunk; $chunk = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; $compressedChunk = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } fclose($handle); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'uncompressedSize'</span></span> =&gt; $uncompressedSize, <span class="hljs-string"><span class="hljs-string">'compressedSize'</span></span> =&gt; $compressedSize, <span class="hljs-string"><span class="hljs-string">'crc32'</span></span> =&gt; hexdec(hash_final($hashCtx)) ]; }</code> </pre> <br>  рдФрд░ 100 mb рдлрд╝рд╛рдЗрд▓ рдкрд░ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ: <br><br><pre> <code class="php hljs">$reader = read(<span class="hljs-string"><span class="hljs-string">'https://speed.hetzner.de/100MB.bin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($reader <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $chunk) { <span class="hljs-comment"><span class="hljs-comment">// -   . } ['uncompressedSize' =&gt; $uncompressedSize, 'compressedSize' =&gt; $compressedSize, 'crc32' =&gt; $crc32] = $reader-&gt;getReturn(); echo 'Uncompressed size: ' . $uncompressedSize . PHP_EOL; echo 'Compressed size: ' . $compressedSize . PHP_EOL; echo round(memory_get_peak_usage(true) / 1024 / 1024, 2) . 'MB - Memory Peak Usage' . PHP_EOL;</span></span></code> </pre> <br>  рдореЗрдореЛрд░реА рдХреА рдЦрдкрдд рдЕрднреА рднреА рдмрддрд╛рддреА рд╣реИ рдХрд┐ рд╣рдордиреЗ рдкреВрд░реА рдлрд╛рдЗрд▓ рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдирд╣реАрдВ рдХрд┐рдпрд╛ред <br><br><p>  рдЖрдЗрдП рдЗрд╕реЗ рд╕рдм рдПрдХ рд╕рд╛рде рд░рдЦреЗрдВ рдФрд░ рдЕрдВрдд рдореЗрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рдВрдЧреНрд░рд╣ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред <br>  рдкрд┐рдЫрд▓реЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╡рд┐рдкрд░реАрдд, рд╣рдорд╛рд░рд╛ <b>рд╕рд╛рдорд╛рдиреНрдпрдкреНрд░рд╛рдердкрд┐рдЯрдмрд┐рдЯрдлрд▓</b> рдмрджрд▓ рдЬрд╛рдПрдЧрд╛ - рдЕрдм рдЗрд╕рдХрд╛ рдореВрд▓реНрдп <b>0x0018 рд╣реИ</b> , рд╕рд╛рде рд╣реА рд╕рд╛рде <b>рдХрдореНрдкреНрд░реЗрд╢рдирдореЗрдереЛрдб</b> - <b>8</b> (рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ <b>рдбрд┐рдлреНрд▓реИрдЯ</b> )ред <br><br></p><div class="spoiler">  <b class="spoiler_title">рдЕрдВрддрд┐рдо рд╕реНрдХреНрд░рд┐рдкреНрдЯ</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $path)</span></span></span><span class="hljs-function">: \</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generator</span></span></span><span class="hljs-function"> </span></span>{ $uncompressedSize = <span class="hljs-number"><span class="hljs-number">0</span></span>; $compressedSize = <span class="hljs-number"><span class="hljs-number">0</span></span>; $hashCtx = hash_init(<span class="hljs-string"><span class="hljs-string">'crc32b'</span></span>); $deflateCtx = deflate_init(ZLIB_ENCODING_RAW, [<span class="hljs-string"><span class="hljs-string">'level'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>]); $handle = fopen($path, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!feof($handle)) { $chunk = fread($handle, <span class="hljs-number"><span class="hljs-number">8</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span>); hash_update($hashCtx, $chunk); $compressedChunk = deflate_add($deflateCtx, $chunk, feof($handle) ? ZLIB_FINISH : ZLIB_SYNC_FLUSH); $uncompressedSize += strlen($chunk); $compressedSize += strlen($compressedChunk); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> $compressedChunk; $chunk = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; $compressedChunk = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } fclose($handle); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'uncompressedSize'</span></span> =&gt; $uncompressedSize, <span class="hljs-string"><span class="hljs-string">'compressedSize'</span></span> =&gt; $compressedSize, <span class="hljs-string"><span class="hljs-string">'crc32'</span></span> =&gt; hexdec(hash_final($hashCtx)) ]; } $entries = [<span class="hljs-string"><span class="hljs-string">'https://speed.hetzner.de/100MB.bin'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>]; $destination = <span class="hljs-string"><span class="hljs-string">'test.zip'</span></span>; $handle = fopen($destination, <span class="hljs-string"><span class="hljs-string">'w'</span></span>); $written = <span class="hljs-number"><span class="hljs-number">0</span></span>; $dictionary = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($entries <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $entry) { $filename = basename($entry); $fileInfo = [ <span class="hljs-string"><span class="hljs-string">'versionToExtract'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   ,        0x0018  0x0008 'generalPurposeBitFlag' =&gt; 0x0018, 'compressionMethod' =&gt; 8, //      : 8 - Deflate 'modificationTime' =&gt; 28021, 'modificationDate' =&gt; 20072, 'crc32' =&gt; 0, 'compressedSize' =&gt; 0, 'uncompressedSize' =&gt; 0, 'filenameLength' =&gt; strlen($filename), 'extraFieldLength' =&gt; 0, ]; $LFH = pack('LSSSSSLLLSSa*', ...array_values([ 'signature' =&gt; 0x04034b50, ] + $fileInfo + ['filename' =&gt; $filename])); $fileOffset = $written; $written += fwrite($handle, $LFH); $reader = read($entry); foreach ($reader as $chunk) { $written += fwrite($handle, $chunk); $chunk = null; } [ 'uncompressedSize' =&gt; $uncompressedSize, 'compressedSize' =&gt; $compressedSize, 'crc32' =&gt; $crc32 ] = $reader-&gt;getReturn(); $fileInfo['crc32'] = $crc32; $fileInfo['compressedSize'] = $compressedSize; $fileInfo['uncompressedSize'] = $uncompressedSize; $DD = pack('LLLL', ...array_values([ 'signature' =&gt; 0x08074b50, 'crc32' =&gt; $fileInfo['crc32'], 'compressedSize' =&gt; $fileInfo['compressedSize'], 'uncompressedSize' =&gt; $fileInfo['uncompressedSize'], ])); $written += fwrite($handle, $DD); $dictionary[$filename] = [ 'signature' =&gt; 0x02014b50, 'versionMadeBy' =&gt; 798, ] + $fileInfo + [ 'fileCommentLength' =&gt; 0, 'diskNumber' =&gt; 0, 'internalFileAttributes' =&gt; 0, 'externalFileAttributes' =&gt; 2176057344, 'localFileHeaderOffset' =&gt; $fileOffset, 'filename' =&gt; $filename, ]; } $EOCD = [ 'signature' =&gt; 0x06054b50, 'diskNumber' =&gt; 0, 'startDiskNumber' =&gt; 0, 'numberCentralDirectoryRecord' =&gt; $records = count($dictionary), 'totalCentralDirectoryRecord' =&gt; $records, 'sizeOfCentralDirectory' =&gt; 0, 'centralDirectoryOffset' =&gt; $written, 'commentLength' =&gt; 0 ]; foreach ($dictionary as $entryInfo) { $CDFH = pack('LSSSSSSLLLSSSSSLLa*', ...array_values($entryInfo)); $written += fwrite($handle, $CDFH); } $EOCD['sizeOfCentralDirectory'] = $written - $EOCD['centralDirectoryOffset']; $EOCD = pack('LSSSSLLS', ...array_values($EOCD)); $written += fwrite($handle, $EOCD); fclose($handle); echo '  : ' . memory_get_peak_usage(true) . ' ' . PHP_EOL; echo '  : ' . $written . ' ' . PHP_EOL; echo '   `unzip -tq ' . $destination . '`: ' . PHP_EOL; echo '&gt; ' . exec('unzip -tq ' . $destination) . PHP_EOL; echo PHP_EOL;</span></span></code> </pre> </div></div><br>  рдирддреАрдЬрддрди, рдореБрдЭреЗ рдЖрдХрд╛рд░ рдореЗрдВ 360183 рдмрд╛рдЗрдЯреНрд╕ рдХрд╛ рдПрдХ рд╕рдВрдЧреНрд░рд╣ рдорд┐рд▓рд╛ (рд╣рдорд╛рд░реА 100 рдПрдордмреА рдлрд╝рд╛рдЗрд▓ рдмрд╣реБрдд рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХреА рдЧрдИ рдереА, рдЬреЛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╕рдорд╛рди рдмрд╛рдЗрдЯреНрд╕ рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╣реИ), рдФрд░ <i>рдЕрдирдЬрд╝рд┐рдк</i> рдиреЗ рджрд┐рдЦрд╛рдпрд╛ рдХрд┐ рд╕рдВрдЧреНрд░рд╣ рдореЗрдВ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рдирд╣реАрдВ рдорд┐рд▓реАред <br><br><h3>  рдирд┐рд╖реНрдХрд░реНрд╖ </h3><br><p>  рдпрджрд┐ рдореЗрд░реЗ рдкрд╛рд╕ рдПрдХ рдФрд░ рд▓реЗрдЦ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдКрд░реНрдЬрд╛ рдФрд░ рд╕рдордп рд╣реИ, рддреЛ рдореИрдВ рдпрд╣ рджрд┐рдЦрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реВрдВрдЧрд╛ рдХрд┐ рдХреИрд╕реЗ рдФрд░ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рд╕рдм рдХреНрдпреЛрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br>  рдпрджрд┐ рдЖрдк рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ рдХрд┐рд╕реА рдФрд░ рдЪреАрдЬ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ - рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдореЗрдВ рд╕реБрдЭрд╛рд╡ рджреЗрдВ, рдореИрдВ рдЖрдкрдХреЗ рдкреНрд░рд╢реНрди рдХрд╛ рдЙрддреНрддрд░ рджреЗрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реВрдВрдЧрд╛ред  рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╣рдо рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд╕рд╛рде рд╕реМрджрд╛ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ, рдХреНрдпреЛрдВрдХрд┐ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкрд╣рд▓реЗ рд╣реА рдмрдврд╝ рдЧрдИ рд╣реИ, рдФрд░ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЬреАрд╡рди рдореЗрдВ рдРрд╕реЗ рдЕрднрд┐рд▓реЗрдЦрд╛рдЧрд╛рд░, рдРрд╕рд╛ рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ, рдмрд╣реБрдд рдмрд╛рд░ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><br><p>  рдЖрдкрдХрд╛ рдзреНрдпрд╛рди рдФрд░ рдЖрдкрдХреА рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рджред </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi472966/">https://habr.com/ru/post/hi472966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi472956/index.html">рдПрдХ рдХреИрдЯрд░рдкрд┐рд▓рд░ рд░реЛрдмреЛрдЯ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕</a></li>
<li><a href="../hi472958/index.html">Arduino рдореЗрдВ рд╡рд┐рдВрдбреЛрдЬ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреИрд╕реЗ рдмрдирд╛рдПрдВ</a></li>
<li><a href="../hi472960/index.html">рд╕реЛрдиреА рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдореВрд▓реНрдп / рдЧреБрдгрд╡рддреНрддрд╛ рд▓реЗрдВрд╕</a></li>
<li><a href="../hi472962/index.html">рд╡реАрдбрд┐рдпреЛ рдкреЛрд╕реНрдЯ: рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рджреГрд╢реНрдп рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдпреЛрдЧ</a></li>
<li><a href="../hi472964/index.html">рд╕реНрдерд┐рддрд┐: рдЕрдзрд┐рдХ рд╕реЗ рдЕрдзрд┐рдХ рдУрдкрди рд╕реЛрд░реНрд╕ рдХрдВрдкрдирд┐рдпрд╛рдВ рд▓рд╛рдЗрд╕реЗрдВрд╕ рдмрджрд▓ рд░рд╣реА рд╣реИрдВ - рд╣рдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд░рд╛рдп рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi472970/index.html">рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдФрд░ рд╕рдВрдЧрдардирд╛рддреНрдордХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рдЖрд▓реЛрдЪрдирд╛ред рднрд╛рдЧ 1, рддрдХрдиреАрдХреА: рдЦрд░реЛрдВрдЪ рд╕реЗ рдПрдХ рдХреНрд▓рд╛рдЗрдВрдЯ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдЕрдиреБрднрд╡ - рдЯреАрдПрд▓, рдПрдордЯреА</a></li>
<li><a href="../hi472972/index.html">рд╣рдо рдПрдХ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреНрд▓рд╛рд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдХреБрдХреАрдЬрд╝ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi472978/index.html">Arduino рдЕрдкрдиреЗ рдмреЗрдЯреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд▓реЗрдЦрди рдкрд╛рдареНрдпрдХреНрд░рдо</a></li>
<li><a href="../hi472980/index.html">рд╢реЙрд░реНрдЯреНрд╕ рдмреЗрд▓реЛрдХреБрдореЗрдВрдЯрд╕реЗрд╡рд╛</a></li>
<li><a href="../hi472982/index.html">"рдмреНрд░реЗрдХрдбрд╛рдЙрди рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрдиреЛ": рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрджреНрдпреЛрдЧрд┐рдХ рдорд╢реАрдиреЛрдВ рдХреА рдСрдбрд┐рдпреЛ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдкреНрд░рдХрд╛рд╢рд┐рдд рд╣реБрдИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>