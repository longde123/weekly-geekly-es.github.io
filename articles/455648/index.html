<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé≠ üßòüèø üèáüèø Life Cycle ML üíÉüèø üßù üòÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En una implementaci√≥n real de ML, el aprendizaje en s√≠ requiere una cuarta parte del esfuerzo. Los tres trimestres restantes son preparaci√≥n de datos ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Life Cycle ML</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/455648/">  En una implementaci√≥n real de ML, el aprendizaje en s√≠ requiere una cuarta parte del esfuerzo.  Los tres trimestres restantes son preparaci√≥n de datos a trav√©s del dolor y la burocracia, un despliegue complejo a menudo en un circuito cerrado sin acceso a Internet, configuraci√≥n de infraestructura, pruebas y monitoreo.  Documentos en cientos de hojas, modo manual, conflictos de versi√≥n de modelo, c√≥digo abierto y empresa dura: todo esto le espera a un cient√≠fico de datos.  Pero no est√° interesado en estos problemas operativos "aburridos", quiere desarrollar un algoritmo, lograr alta calidad, retribuir y no recordar m√°s. <br><br>  Quiz√°s, en alg√∫n lugar, ML se implemente m√°s f√°cil, m√°s simple, m√°s r√°pido y con un solo bot√≥n, pero no hemos visto tales ejemplos.  Todo lo que est√° arriba es la experiencia de Front Tier en fintech y telecomunicaciones.  Sergey Vinogradov, experto en arquitectura de sistemas altamente cargados, en grandes almacenes y en an√°lisis de datos pesados, habl√≥ sobre √©l en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HighLoad ++</a> . <br><br><img src="https://habrastorage.org/webt/ss/7n/cm/ss7ncmtdsij0wncwt-uuzxneit8.jpeg"><br><a name="habracut"></a><br><h2>  Ciclo de vida modelo </h2><br>  Por lo general, el ciclo de vida en nuestra √°rea tem√°tica consta de tres partes.  En el primero <strong>, una tarea proviene del negocio</strong> .  En el segundo, un <strong>ingeniero de datos y / o cient√≠fico de datos prepara datos</strong> , construye un modelo.  En la tercera parte, comienza el <strong>caos</strong> .  En los dos √∫ltimos, suceden diferentes situaciones interesantes. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/7GM9ac6ojtw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h3>  Jack de todos los oficios </h3><br>  La primera situaci√≥n frecuente es que un cient√≠fico de datos o ingeniero de datos tiene acceso a los productos, por lo que le dicen: "Hiciste todo esto, lo apostaste". <br><br>  Una persona toma un <strong>cuaderno Jupyter</strong> o un paquete de cuadernos, los considera √∫nicamente como un artefacto de una implementaci√≥n y comienza a replicarse con alegr√≠a en algunos servidores. <br><br>  Todo parece estar bien, pero no siempre.  M√°s tarde te dir√© por qu√©. <br><br><h3>  Explotaci√≥n despiadada </h3><br>  La segunda historia es m√°s compleja, y generalmente ocurre en empresas donde la explotaci√≥n ha alcanzado un estado de locura leve.  El cient√≠fico de datos trae su soluci√≥n a la operaci√≥n.  Abren esta caja negra y ven algo terrible: <br><br><ul><li>  cuadernos </li><li>  pepinillo de diferentes versiones; </li><li>  mont√≥n de scripts: no est√° claro d√≥nde y cu√°ndo ejecutarlos, d√≥nde guardar los datos que generan. </li></ul><br>  En este rompecabezas, la explotaci√≥n encuentra incompatibilidad de versiones.  Por ejemplo, un cient√≠fico de datos no especific√≥ una versi√≥n espec√≠fica de la biblioteca, y la operaci√≥n tom√≥ la √∫ltima.  Despu√©s de un tiempo, el cient√≠fico de datos recurre: <br><br>  <em>- Estableciste scikit-learn en la versi√≥n incorrecta, ¬°ahora todas las m√©tricas se han ido!</em>  <em>Necesita volver a la versi√≥n anterior.</em> <br><br>  Esto rompe completamente la producci√≥n y la explotaci√≥n sufre. <br><br><h3>  Burocracia </h3><br>  En las empresas con logotipos verdes, cuando el cient√≠fico de datos entra en funcionamiento y trae el modelo, generalmente recibe un documento de 800 hojas en respuesta: "Siga estas instrucciones, de lo contrario su producto nunca ver√° la luz del d√≠a". <br><br>  El triste cient√≠fico de datos se va, tira todo a la mitad y luego renuncia: no est√° interesado en hacer esto. <br><br><h3>  Implementar </h3><br>  Supongamos que un cient√≠fico de datos ha pasado por todos los c√≠rculos y al final todo se ha implementado.  Pero no podr√° entender que todo funciona como deber√≠a.  En mi experiencia, en los mismos bancos bendecidos no hay monitoreo de productos de ciencia de datos. <br><br>  Es bueno si el especialista escribe los resultados de su trabajo en la base de datos.  Despu√©s de un tiempo, los recibir√° y ver√° qu√© sucede dentro.  Pero esto no siempre sucede.  Cuando una empresa y un cient√≠fico de datos simplemente creen que todo est√° funcionando bien y es maravilloso, se traduce en casos fallidos. <br><br><h3>  IMF </h3><br>  De alguna manera, desarrollamos un motor de puntuaci√≥n para una gran organizaci√≥n de microfinanzas.  No los dejaron ir al producto, sino que simplemente nos quitaron una cascada de modelos, la instalaron y la lanzaron.  Los resultados de las pruebas de los modelos los satisfacen.  Pero despu√©s de 6 meses volvieron: <br><br>  <em>- Todo est√° mal.</em>  <em>El negocio no va, estamos empeorando cada vez m√°s.</em>  <em>Parece que los modelos son excelentes, pero los resultados est√°n cayendo, el fraude y el incumplimiento cada vez m√°s, y menos dinero.</em>  <em>¬øPor qu√© te pagamos?</em>  <em>Vamos a hacerlo bien.</em> <br><br>  Al mismo tiempo, el acceso al modelo nuevamente no se da.  Los registros se descargaron durante un mes, adem√°s, hace seis meses.  Estudiamos la descarga durante otro mes y llegamos a la conclusi√≥n de que en alg√∫n momento el departamento de TI de la IMF cambi√≥ los datos de entrada y, en lugar de documentos en json, comenzaron a enviar documentos en xml.  El modelo esperaba json, pero recibi√≥ xml, estaba triste y pens√≥ que no hab√≠a datos en la entrada. <br><br><blockquote>  Si no hay datos, entonces la evaluaci√≥n de lo que est√° sucediendo es diferente.  Sin monitoreo, esto no se puede detectar. </blockquote><br><h3>  Nueva versi√≥n, cascada y pruebas. </h3><br>  A menudo nos enfrentamos al hecho de que el modelo funciona bien, pero por alguna raz√≥n <strong>se ha</strong> desarrollado una <strong>nueva versi√≥n</strong> .  El modelo nuevamente necesita ser tra√≠do de alguna manera, y nuevamente para atravesar todos los c√≠rculos del infierno.  Es bueno si las versiones de la biblioteca son las mismas que en el modelo anterior, y si no, la implementaci√≥n comienza de nuevo ... <br><br>  A veces, antes de poner una nueva versi√≥n en la batalla, queremos <strong>probarla</strong> : ponerla en el producto, mirar el mismo flujo de tr√°fico, asegurarnos de que sea bueno.  Esta es nuevamente la cadena de implementaci√≥n completa.  Adem√°s, configuramos los sistemas para que, de acuerdo con este modelo, no se produzcan resultados reales, si se trata de puntuaci√≥n, sino que solo hubo monitoreo y an√°lisis de los resultados para un an√°lisis posterior. <br><br>  Hay situaciones en las <strong>que se usa</strong> una <strong>cascada de modelos.</strong>  Cuando los resultados de los siguientes modelos dependen de los anteriores, de alguna manera debe establecer la interacci√≥n entre ellos y, en alg√∫n lugar, todo esto debe guardarse. <br><br><h2>  ¬øC√≥mo resolver tales problemas? </h2><br>  A menudo, una persona resuelve problemas <strong>manualmente</strong> , especialmente en peque√±as empresas.  Sabe c√≥mo funciona todo, tiene en cuenta todas las versiones de modelos y bibliotecas, sabe d√≥nde y qu√© scripts funcionan, qu√© escaparates construyen.  Todo esto es maravilloso  Particularmente hermosas son las historias que deja el modo manual. <br><br>  <strong>La historia de la herencia</strong> .  Un buen hombre trabajaba en un peque√±o banco.  Una vez fue a un pa√≠s del sur y no regres√≥.  Despu√©s de eso, obtuvimos una herencia: un mont√≥n de c√≥digo que genera escaparates en los que funcionan los modelos de modelos.  El c√≥digo es hermoso, funciona, pero no sabemos la versi√≥n exacta del script que genera este o aquel escaparate.  En la batalla, todos los escaparates est√°n presentes y todos se lanzan.  Pasamos dos meses tratando de distinguir esta intrincada mara√±a y estructurarla de alguna manera. <br><br>  <strong>En una empresa dura, las</strong> personas no quieren molestarse con todo tipo de Python, J√∫piter, etc. Dicen: <br><br>  <em>- Compremos IBM SPSS, inst√°lelo y todo estar√° genial.</em>  <em>Problemas con el control de versiones, con las fuentes de datos, con la implementaci√≥n all√≠ resuelta de alguna manera.</em> <br><br>  Este enfoque tiene derecho a existir, pero no todos pueden permit√≠rselo.  En cualquier caso, esta es una aguja dentada de alta calidad.  Se sientan en √©l, pero no funciona para salir - muescas.  Y generalmente cuesta mucho. <br><br>  <strong>El c√≥digo abierto es lo</strong> opuesto al enfoque anterior.  Los desarrolladores navegaron por Internet, encontraron muchas soluciones de c√≥digo abierto que resuelven sus tareas en diversos grados.  Esta es una excelente manera, pero para nosotros no encontramos soluciones que satisfagan nuestros requisitos al 100%. <br><br>  Por lo tanto, hemos elegido la opci√≥n cl√°sica: <strong>nuestra decisi√≥n</strong> .  Sus muletas, bicicletas, todas propias, nativas. <br><br><h2>  ¬øQu√© queremos de nuestra decisi√≥n? </h2><br><br>  <strong>No escribas todo t√∫ mismo</strong> .  Queremos tomar componentes, especialmente los de infraestructura, que han demostrado ser buenos y est√°n familiarizados con la operaci√≥n en las instituciones con las que trabajamos.  Simplemente escribimos un entorno que aislar√° f√°cilmente el trabajo del cient√≠fico de datos del trabajo de DevOps. <br><br>  <strong>Procese datos en dos modos: ambos en modo por lotes: lote y en tiempo real</strong> .  Nuestras tareas incluyen ambos modos de operaci√≥n. <br><br>  <strong>Facilidad de despliegue, y en un per√≠metro cerrado</strong> .  Cuando se trabaja con datos privados confidenciales, no hay conexi√≥n a Internet.  En este momento, todo deber√≠a llegar r√°pida y exactamente a la producci√≥n.  Por lo tanto, comenzamos a mirar hacia Gitlab, la tuber√≠a de CI / CD dentro de √©l y Docker. <br><br><blockquote>  Un modelo no es un fin en s√≠ mismo.  No resolvemos el problema de construir un modelo, resolvemos un problema de negocios. </blockquote><br>  Dentro de la tuber√≠a, debe haber reglas y un conglomerado de modelos con soporte para <strong>versionar todos los</strong> componentes de la tuber√≠a. <br><br>  ¬øQu√© se entiende por tuber√≠a?  En Rusia, la Ley Federal 115 sobre la lucha contra el lavado de dinero y la financiaci√≥n del terrorismo est√° en vigor.  Solo el √≠ndice de las recomendaciones del Banco Central ocupa 16 pantallas.  Estas son reglas simples que un banco puede cumplir si tiene tales datos, o no puede hacerlo si no tiene datos. <br><br>  La evaluaci√≥n de un prestatario, una transacci√≥n financiera u otro proceso comercial es un flujo de datos que procesamos.  Una secuencia debe pasar por este tipo de regla.  Estas reglas son descritas de manera f√°cil por el analista.  No es un cient√≠fico de datos, pero conoce bien la ley u otras instrucciones.  El analista se sienta y, en lenguaje sencillo, describe las comprobaciones de los datos. <br><br>  <strong>Construye cascadas de modelos</strong> .  A menudo surge una situaci√≥n cuando el siguiente modelo utiliza para su trabajo los valores obtenidos en modelos anteriores. <br><br>  <strong>Probar hip√≥tesis r√°pidamente.</strong>  Repito la tesis anterior: un cient√≠fico de datos hizo alg√∫n tipo de modelo, gira en la batalla y funciona bien.  Por alguna raz√≥n, el especialista encontr√≥ una soluci√≥n mejor, pero no quiere arruinar el flujo de trabajo establecido.  El cient√≠fico de datos est√° colgando un nuevo modelo en el mismo tr√°fico de combate en el sistema de combate.  Ella no participa directamente en la toma de decisiones, pero sirve el mismo tr√°fico, considera algunas conclusiones y estas conclusiones se almacenan en alg√∫n lugar. <br><br>  <strong>Funci√≥n de reutilizaci√≥n f√°cil.</strong>  Muchas tareas tienen el mismo tipo de componentes, especialmente los relacionados con la extracci√≥n de caracter√≠sticas o reglas.  Queremos arrastrar estos componentes a otras tuber√≠as. <br><br><h2>  ¬øQu√© decidiste hacer? </h2><br>  Primero queremos monitoreo.  Y dos de su tipo. <br><br><h3>  Monitoreo </h3><br>  <strong>Monitoreo t√©cnico.</strong>  Si se implementan componentes de la tuber√≠a, en funcionamiento deber√≠an ver qu√© sucede con el componente: c√≥mo consume memoria, CPU, disco. <br><br>  <strong>Monitoreo de negocios.</strong>  Esta es una herramienta cient√≠fica de datos que le permite abstraerse de los matices t√©cnicos de la implementaci√≥n.  A nivel de dise√±o, la construcci√≥n ayuda a determinar qu√© m√©tricas del modelo deber√≠an estar disponibles en el monitoreo, por ejemplo, distribuci√≥n de caracter√≠sticas o resultados de servicios de puntuaci√≥n. <br><br>  Un cient√≠fico de datos define las m√©tricas y no debe preocuparse por c√≥mo ingresan al sistema de monitoreo.  Lo √∫nico importante es que defini√≥ estas m√©tricas y la apariencia del panel en el que se mostrar√°n las m√©tricas.  Luego, el especialista lanz√≥ todo lo relacionado con la producci√≥n, la implementaci√≥n y, despu√©s de un tiempo, las m√©tricas se volcaron en el monitoreo.  Entonces, un cient√≠fico de datos sin acceso al producto puede ver lo que est√° sucediendo dentro del modelo. <br><br><h3>  Prueba </h3><br>  Probar la <strong>tuber√≠a para la consistencia</strong> .  Dados los detalles de la tuber√≠a, este es un tipo de gr√°fico de computaci√≥n.  Queremos entender que estamos implementando un gr√°fico, podemos evitarlo y encontrar una manera de salir de √©l. <br><br>  El gr√°fico tiene componentes - m√≥dulos.  Todos los m√≥dulos deben pasar la unidad y las pruebas de integraci√≥n.  El proceso debe ser transparente y f√°cil para un cient√≠fico de datos. <br><br>  El desarrollador describe el modelo y las pruebas por s√≠ solo o con la ayuda de otra persona.  Pone todo en Gitlab, la canalizaci√≥n configurada por Continuous Integration aumenta, prueba, ve resultados.  Si todo est√° bien, va m√°s all√°, no, comienza de nuevo. <br><br>  El cient√≠fico de datos se centra en el modelo y no sabe qu√© hay debajo del cap√≥.  Para esto, se le dan varias cosas. <br><br><ul><li>  <strong>Una API para la integraci√≥n con el n√∫cleo del</strong> <strong>sistema a</strong> trav√©s del bus de datos - bus de mensajes.  En este caso, el especialista debe describir qu√© est√° entrando y qu√© est√° saliendo de su modelo, el punto de entrada y la uni√≥n con diferentes componentes dentro de la tuber√≠a. </li><li>  Despu√©s de entrenar al modelo, aparece un <strong>artefacto: un archivo XGBoost</strong> o <strong>pickle</strong> .  El cient√≠fico de datos tiene un ejecutor para trabajar con artefactos: debe integrar los componentes de la tuber√≠a en su interior. </li><li>  API f√°cil y transparente para el cient√≠fico de datos para monitorear el funcionamiento de los componentes de la tuber√≠a: monitoreo t√©cnico y comercial. </li><li>  <strong>Una infraestructura simple y transparente</strong> para integrarse con fuentes de datos y preservar los resultados del trabajo. </li></ul><br>  A menudo, los modelos funcionan para nosotros, y despu√©s de un tiempo llega una auditor√≠a que quiere elevar toda la historia del servicio.  La auditor√≠a quiere verificar la correcci√≥n del trabajo, la ausencia de fraude de nuestra parte.  Se necesitan herramientas simples para que cualquier auditor que conozca SQL pueda ingresar a un repositorio especial y ver c√≥mo funciona todo, qu√© decisiones se tomaron y por qu√©. <br><br>  Pusimos las bases para dos historias importantes para nosotros. <br><br>  <strong>Viaje del cliente.</strong>  Esta es una oportunidad para utilizar los mecanismos para preservar todo el historial del cliente, lo que le sucedi√≥ como parte de los procesos comerciales que se implementan en este sistema. <br><br>  Es posible que tengamos fuentes de datos externas, por ejemplo, plataformas DMP.  De ellos obtenemos informaci√≥n sobre el comportamiento humano en la red y en dispositivos m√≥viles.  Esto puede afectar el LTV de su modelo y los modelos de puntuaci√≥n.  Si el prestatario se atrasa en el pago, podemos predecir que esta no es una intenci√≥n maliciosa, simplemente hay problemas.  En este caso, aplicamos m√©todos suaves de exposici√≥n al prestatario.  Cuando se resuelven los problemas, el cliente cerrar√° el pr√©stamo.  Cuando venga la pr√≥xima vez, sabremos toda su historia.  El cient√≠fico de datos obtendr√° una historia visual del modelo y realizar√° una puntuaci√≥n en modo de luz. <br><br>  <strong>Identificaci√≥n de anomal√≠as</strong> .  Nos enfrentamos constantemente a un mundo muy complejo.  Por ejemplo, los puntos d√©biles dentro de la evaluaci√≥n acelerada de las IMF pueden ser una fuente de fraude autom√°tico. <br><br>  Customer Journey es un concepto de acceso r√°pido y f√°cil al flujo de datos que atraviesa el modelo.  El modelo facilita la detecci√≥n de anomal√≠as que son caracter√≠sticas del fraude en el momento de su ocurrencia masiva. <br><br><h2>  ¬øC√≥mo se arregla todo? </h2><br>  Sin dudarlo, tomamos <strong>Kafka</strong> como un parche de Message Bus.  Esta es una buena soluci√≥n que utilizan muchos de nuestros clientes, la operaci√≥n puede trabajar con ella. <br><br><img src="https://habrastorage.org/webt/uu/5k/3r/uu5k3rnxw7lu4iulruewhzmif8w.jpeg"><br><br><blockquote>  Es posible que algunos componentes del sistema ya se utilicen en la propia empresa.  No estamos construyendo el sistema nuevamente, sino reutilizando lo que ya tienen. </blockquote><br>  <strong>El almacenamiento de datos</strong> en este caso es el almacenamiento que el cliente generalmente ya tiene.  Puede ser Hadoop, bases de datos relacionales y no relacionales.  Podemos trabajar de forma nativa con HDFS, Hive, Impala, Greenplum y PostgreSQL.  Consideramos estos almacenes como una fuente de escaparates. <br><br>  Los datos llegan al almac√©n, pasan a trav√©s de nuestro ETL o el ETL del cliente, si tiene uno.  Estamos construyendo escaparates que se utilizan a√∫n m√°s dentro de los modelos.  El almacenamiento de datos se usa en modo de solo lectura. <br><br><h3>  Nuestros desarrollos </h3><br>  <strong>Pizarra</strong>  El nombre se toma de una pr√°ctica bastante extra√±a de matem√°ticos de los a√±os 30-40.  Este es el administrador de las tuber√≠as que viven en el sistema de administraci√≥n.  Blackboard tiene alg√∫n tipo de Meta Storage.  Almacena las tuber√≠as en s√≠ y las configuraciones necesarias para inicializar todos los componentes. <br><br>  Todo el trabajo del sistema comienza con Blackboard.  Por alg√∫n milagro, la tuber√≠a termin√≥ en Meta Storage, Blackboard despu√©s de un tiempo comprende esto, saca la versi√≥n actual de la tuber√≠a, la inicializa y env√≠a una se√±al dentro de Kafka. <br><br>  Hay un <strong>entorno de tiempo de ejecuci√≥n</strong> .  Est√° construido en Dockers y se puede replicar en servidores, incluso en la nube privada del cliente. <br><br>  Fuera de la caja viene el <strong>Actor</strong> principal <strong>:: Init</strong> - este es el inicializador.  Este es un genio que solo puede hacer dos cosas: <strong>construir</strong> y <strong>destruir componentes</strong> .  Recibe un comando de Blackboard: "Aqu√≠ est√° la canalizaci√≥n, debe iniciarse en tales servidores con tales recursos en cantidades tales, ¬°trabajo!"  Entonces el actor comienza todo. <br><br>  Matem√°ticamente, un actor es una funci√≥n que toma uno o m√°s objetos como entrada, en su interior cambia el estado de los objetos seg√∫n alg√∫n algoritmo, en la salida crea un nuevo objeto o cambia el estado de uno existente. <br><br>  T√©cnicamente, un actor es un programa de Python.  Se ejecuta en un contenedor Docker con su entorno. <br><br>  El actor no sabe sobre la existencia de otros actores.  La √∫nica entidad que sabe que, adem√°s del actor, existe toda la tuber√≠a en su conjunto: esto es Blackboard.  Monitorea el estado de ejecuci√≥n de todos los actores dentro del sistema y mantiene el estado actual, que se expresa en el monitoreo como una imagen de todo el proceso comercial en su conjunto. <br><br>  Actor :: Init genera muchos contenedores Docker.  Adem√°s, los actores pueden trabajar con el almacenamiento de datos. <br><br>  El sistema en s√≠ tiene un componente de <strong>almacenamiento de eventos</strong> .  Como almacenamiento de eventos usamos <strong>ClickHouse</strong> .  Su tarea es simple: toda la informaci√≥n intercambiada entre el actor a trav√©s de Kafka se almacena en ClickHouse.  Esto se hace <strong>para una auditor√≠a adicional</strong> .  Este es el registro de operaciones de canalizaci√≥n. <br><br>  Los actores tambi√©n se pueden desarrollar para <strong>Customer Journey</strong> .  Ven cambios en el registro de la tuber√≠a y pueden reconstruir sobre la marcha las ventanas necesarias para que los modelos o componentes trabajen con las reglas, que ya est√°n dentro de la tuber√≠a.  Este es un proceso continuo de cambio de datos. <br><br>  El monitoreo se construye de manera bastante primitiva en <strong>Prometeo</strong> .  El actor recibe una API b√°sica, y en un modo cerrado, pero lo suficientemente transparente para el desarrollador, env√≠a mensajes con m√©tricas a Kafka.  Prometheus lee las m√©tricas de Kafka y las guarda en su repositorio. <br><br>  Para la visualizaci√≥n usamos <strong>Grafana</strong> . <br><br><h3>  Dos puntos de integracion </h3><br>  El primero es el punto de integraci√≥n con las fuentes de datos que pasan por ETL al almac√©n de datos.  El segundo punto de integraci√≥n cuando un consumidor de datos ya utiliza un servicio, por ejemplo, un servicio de puntuaci√≥n. <br><br>  Tomamos <strong>Apache ServiceMix.</strong>  Por experiencia, estos puntos de integraci√≥n son del mismo tipo con el mismo tipo de protocolos: SOAP, RESTful, colas con menos frecuencia.  Cada vez que no queremos desarrollar nuestro propio constructor o servicio para generar el pr√≥ximo servicio SOAP.  Por lo tanto, tomamos ServiceMix, lo describimos en el SDL, en el que se construyen los modelos de datos de este servicio y los m√©todos que existen en √©l.  Luego empujamos a trav√©s del enrutador dentro de ServiceMix, y genera el servicio en s√≠. <br><br>  De nosotros mismos, agregamos una dif√≠cil conversi√≥n s√≠ncrono-as√≠ncrona.  Todas las solicitudes que viven dentro del sistema son as√≠ncronas y pasan por el bus de mensajes. <br><br>  La mayor√≠a de los servicios de puntuaci√≥n son sincr√≥nicos.  Las solicitudes de ServiceMix vienen a trav√©s de REST o SOAP.  En este punto, pasa a trav√©s de nuestro Gateway, que retiene el conocimiento de la sesi√≥n HTTP.  Luego env√≠a un mensaje a Kafka, se ejecuta a trav√©s de una tuber√≠a y se genera una soluci√≥n. <br><br>  Sin embargo, a√∫n puede no haber soluci√≥n.  Por ejemplo, algo se cay√≥, o hay un SLA dif√≠cil de tomar una decisi√≥n, y Gateway monitorea: "OK, recib√≠ una solicitud, √©l vino a m√≠ en otro tema de Kafka, o no me lleg√≥ nada, pero mi disparador de tiempo de espera funcion√≥".  Por otra parte, la conversi√≥n de s√≠ncrono a as√≠ncrono contin√∫a, y dentro de la misma sesi√≥n HTTP, hay una respuesta al consumidor con el resultado del trabajo.  Esto puede ser un error o un pron√≥stico normal. <br><br>  En este lugar, por cierto, comimos un perro sin sabor gracias al gran y poderoso Open Source.  Utilizamos ServiceMix de una de las √∫ltimas versiones y Kafka de versiones anteriores y todo funcion√≥ perfectamente.  Escribimos en este Gateway, basado en esos cubos que ya estaban en ServiceMix.  Cuando sali√≥ la nueva versi√≥n de Kafka, la agarramos felizmente, pero result√≥ que el apoyo a los encabezados dentro del mensaje en Kafka que exist√≠a anteriormente hab√≠a cambiado.  Gateway dentro de ServiceMix ya no puede trabajar con ellos.  Para entender esto, pasamos mucho tiempo.  Como resultado, creamos nuestro Gateway, que puede funcionar con nuevas versiones de Kafka.  Escribimos sobre el problema a los desarrolladores de ServiceMix y recibimos la respuesta: "¬°Gracias, definitivamente lo ayudaremos en las pr√≥ximas versiones!" <br><br>  Por lo tanto, nos vemos obligados a monitorear las actualizaciones y cambiar regularmente algo. <br><br>  <strong>La infraestructura es Gitlab.</strong>  Usamos casi todo lo que contiene. <br><br><ul><li>  Repositorio de c√≥digo. </li><li>  Contin√∫a la integraci√≥n / Contin√∫a la entrega de la tuber√≠a. </li><li>  Registro para mantener un registro de contenedores Docker. </li></ul><br><h3>  Componentes </h3><br>  Hemos desarrollado 5 componentes: <br><br><ul><li>  <strong>Pizarra</strong> : gesti√≥n del ciclo de vida de la tuber√≠a.  D√≥nde, qu√© y con qu√© par√°metros ejecutar desde la tuber√≠a. </li><li>  <strong>El extractor de caracter√≠sticas</strong> funciona de manera simple: informamos al extractor de caracter√≠sticas que obtenemos tal o cual modelo de datos en la entrada, seleccionamos los campos necesarios de los datos y los asignamos a ciertos valores.  Por ejemplo, obtenemos la fecha de nacimiento del cliente, la convertimos a la edad, la usamos como una caracter√≠stica en nuestro modelo.  El extractor de funciones es responsable del enriquecimiento de datos. </li><li>  <strong>Motor basado en reglas</strong> : verificaci√≥n de datos de acuerdo con las reglas.  Este es un lenguaje de descripci√≥n simple que le permite a una persona familiarizada con la construcci√≥n de &lt;code&gt; if, si no, &lt;code /&gt; bloquea describir las reglas para verificar dentro del sistema. </li><li>  <strong>Motor de aprendizaje autom√°tico</strong> : le permite ejecutar el ejecutor, inicializar el modelo entrenado y enviarlo a los datos de entrada.  En la salida, el modelo toma datos. </li><li>  <strong>Motor de</strong> decisi√≥n: motor de decisi√≥n, salir del gr√°fico.  Al tener una cascada de modelos, por ejemplo, diferentes ramas de la evaluaci√≥n del prestatario, debe decidir sobre el tema del dinero en alguna parte.  El conjunto de reglas para la soluci√≥n debe ser simple. ,     LTV- ‚Äî     ,     ,  . </li></ul><br><br><h3>   </h3><br>         .  ‚Äî  ,    .  ‚Äî      ,      . <br><br>   pipeline    . <br><img src="https://habrastorage.org/webt/o7/vy/dj/o7vydjrruyfittwhwzumh_gc_rq.jpeg"><br><ul><li>   <strong>Feature extractor</strong> :  ,        ,      . </li><li> <strong> </strong> . ,  -:  , ,       18. </li><li>  <strong> .</strong>    ,    .     ,      ,        pipeline. </li><li>  <strong>Decision engine</strong> .             . </li><li>  <strong></strong> . </li></ul><br>      yaml.         .    ,  ,        .           yaml. <br><br>  pipeline,   ,   : feature extractor, rules, models, decision engine,    .   ‚Äî <strong>      Docker-</strong> .    Registry,   Docker-. -,   ,    . ,  ,      Docker-       . <br><br><h3>  Tuber√≠a </h3><br>     ,     <strong>Python</strong> ‚Äî         . Feature extractor, ,   decision engine   Python. <br><br> Pipeline   <strong>yaml.</strong>      meta storage     ‚Äî   <strong></strong> . <br><br>  Runtime environment   10 ,  Blackboard  ,    pipeline    10 .  ,      : , , IP-    Kafka, , .       . <br><br>     GitLab.      Ansible. ,    .           ,      50 000    Ansible  . <br><br><h2>   ? </h2><br>  GitLab  pipeline.    GitLab. CI  ,   ,  ,  .   <strong>GitLab Runner</strong> ,    Docker-  ,    pipeline.    ‚Äî    Registry. <br><br><img src="https://habrastorage.org/webt/gz/dx/hr/gzdxhruymhjm2_wejqybqizdp0i.jpeg"><br><br>  Docker  ,       .   Docker-        .   CI pipeline    pipeline  -  Meta Storage,    Blackboard. <br><br> Blackboard    Meta Storage ‚Äî   , , ,   -.   Docker-     , , . <br><br> -   Blackboard  Meta Storage      :   ,  Kafka,   .  ,    ,   Docker-    ,     . <br><br>  ,    Docker-,  ‚Äî pipeline ! <br><br>      DigitalOcean.     AWS  Scaleway,     . <br><br>    ,        .  pipeline         . ,    . <br><br><h3>    ? </h3><br>   ‚Äî   .  ,   pipeline,     real-time   . <br><br><ul><li> 2 Feature extractor  .     1 , .. json    . </li><li> 8  ‚Äî 8  ML engine.      XGBoost. </li><li> 18     RB engine (115 ).   1000     . </li><li> 1 decision engine. </li></ul><br>       200   .  2 Feature extractor, 8 , 18   1 decision engine      1,2 . <br><br><h3>  </h3><br> <strong>Discovery .</strong>  ,   -   .  ,      ,    .    .      Meta Storage. <br><br> <strong>  pipeline</strong> .    ,  <strong>BPM</strong> .        yaml      ,     ,      . <br><br> <strong>    .</strong>       Java, Scala, R.    Python,       ,     .    API   ,   pipeline      . <br><br><h2>  Cual es el resultado? </h2><br>    ‚Äî     .    ‚Äî   .   <strong> </strong> ,      .  ,         .     ‚Äî     2018 . <br><br>         ,      .    ‚Äî    ,   ,    . <br><br> <strong>    ,   </strong> .     ,    ,    notebook   ,     . <br><br><blockquote> , -      ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> ,           .  ,     , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UseData Conf</a> .  ,    ,       ,   16 . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/455648/">https://habr.com/ru/post/455648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455638/index.html">Alan Kay no invent√≥ objetos</a></li>
<li><a href="../455640/index.html">"La m√°quina de la emoci√≥n" de Marvin Minsky: Cap√≠tulo 4. "C√≥mo reconocemos la conciencia"</a></li>
<li><a href="../455642/index.html">La arquitectura del servicio de cola de mensajes distribuidos en Yandex.Cloud</a></li>
<li><a href="../455644/index.html">Usamos datos en la pr√°ctica.</a></li>
<li><a href="../455646/index.html">Semana de la seguridad 24: puertas traseras de f√°brica en tel√©fonos inteligentes Android</a></li>
<li><a href="../455650/index.html">C√≥mo entrenamos una red neuronal para clasificar tornillos</a></li>
<li><a href="../455652/index.html">Aprendizaje profundo vs sentido com√∫n: desarrollar un bot de chat</a></li>
<li><a href="../455658/index.html">El legendario Intel Core i7-2600K: prueba de Sandy Bridge en 2019 (parte 3)</a></li>
<li><a href="../455662/index.html">Gran pantalla mec√°nica con mecanismo de leva como decodificador.</a></li>
<li><a href="../455666/index.html">Creaci√≥n de ventas salientes en una empresa de servicios de TI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>