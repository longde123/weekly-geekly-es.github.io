<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè§ üë®‚Äçüöí üö£üèª Redes para os mais experientes. Parte quinze. QoS ü§± üïäÔ∏è üòù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SDSM-15. Sobre QoS. Agora com a possibilidade de solicita√ß√µes pull . 

 E assim chegamos ao t√≥pico de QoS. 

 Voc√™ sabe por que apenas agora e por que...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Redes para os mais experientes. Parte quinze. QoS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420525/">  SDSM-15.  Sobre QoS.  Agora com a possibilidade de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">solicita√ß√µes pull</a> . <br><br>  E assim chegamos ao t√≥pico de QoS. <br><br>  Voc√™ sabe por que apenas agora e por que ser√° o artigo final de todo o curso SDSM?  Porque a QoS √© extraordinariamente complexa.  A coisa mais dif√≠cil que foi antes no ciclo. <br><br>  Este n√£o √© um tipo de arquivador m√°gico que inteligentemente comprime o tr√°fego em tempo real e empurra seu gigabit em um uplink de cem megabits.  QoS √© sobre como sacrificar algo desnecess√°rio, empurrando o n√£o comest√≠vel para dentro da estrutura do permitido. <br><br>  A QoS est√° t√£o emaranhada com a aura de xamanismo e inacessibilidade que todos os jovens engenheiros (e n√£o apenas) tentam ignorar cuidadosamente sua exist√™ncia, acreditando que basta lan√ßar problemas com dinheiro e expandir os v√≠nculos infinitamente.  √â verdade, at√© que eles percebam que, com essa abordagem, o fracasso os aguardar√° inevitavelmente.  Ou a empresa come√ßar√° a fazer perguntas desconfort√°veis ‚Äã‚Äãou haver√° muitos problemas que quase n√£o est√£o relacionados √† largura do canal, mas dependem diretamente da efici√™ncia de seu uso.  Sim, o VoIP est√° agitando ativamente uma caneta nos bastidores, e o tr√°fego multicast lhe d√° um golpe malicioso nas costas. <br><br>  Portanto, vamos apenas perceber que a QoS √© obrigat√≥ria, voc√™ precisar√° conhec√™-la de uma maneira ou de outra e, por algum motivo, n√£o comece agora, em um ambiente descontra√≠do. <br><br><img src="https://habrastorage.org/webt/sc/of/k6/scofk6lx2y49bzisp0pwsnrsywg.jpeg"><a name="habracut"></a><br><hr><br><h1>  Conte√∫do </h1><br>  1. <b>O que determina a QoS?</b> <br><br><ul><li>  Perda </li><li>  Atrasos </li><li>  Jitter </li></ul><br>  2. <b>Tr√™s modelos de QoS</b> <br><br><ul><li>  Melhores efeitos </li><li>  Servi√ßos integrados </li><li>  Servi√ßos diferenciados </li></ul><br>  3. <b>Mecanismos DiffServ</b> <br><br>  4. <b>Classifica√ß√£o e rotulagem</b> <br><br><ul><li>  Agrega√ß√£o de comportamento </li><li>  Campo m√∫ltiplo </li><li>  Baseado em interface </li></ul><br>  5. <b>Filas</b> <br><br>  6. <b>Evitar Congestionamentos</b> <br><br><ul><li>  Cauda da cauda e queda da cabe√ßa </li><li>  Vermelho </li><li>  Wred </li></ul><br>  7. <b>Gerenciamento de congestionamentos</b> <br><br><ul><li>  Primeiro a entrar, primeiro a sair </li><li>  Fila priorit√°ria </li><li>  Filas justas </li><li>  Pisco de peito vermelho redondo </li></ul><br>  8. <b>limite de velocidade</b> <br><br><ul><li>  Moldar </li><li>  Policiamento </li><li>  Balde com vazamento e balde de tokens </li></ul><br>  9. <b>Implementa√ß√£o de QoS por hardware</b> <br><hr><br><blockquote>  Antes que o leitor mergulhe nesse buraco, colocarei tr√™s configura√ß√µes nele: <br><br><ul><li>  Nem todos os problemas podem ser resolvidos expandindo a banda. </li><li>  QoS n√£o expande a banda. </li><li>  QoS sobre o gerenciamento de recursos limitados. </li></ul></blockquote><br><h1>  1. O que determina a QoS? </h1><br>  A empresa espera que a pilha de rede execute sua fun√ß√£o simples sem problemas - para fornecer um fluxo de bits de um host para outro: sem perdas e em um tempo previs√≠vel. <br><br>  A partir desta frase curta, todas as m√©tricas de qualidade de rede podem ser derivadas: <br><br><ul><li>  Perda </li><li>  Atrasos </li><li>  Jitter </li></ul><br>  Essas tr√™s caracter√≠sticas determinam a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">qualidade da rede,</a> independentemente de sua natureza: pacote, canal, IP, MPLS, r√°dio, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pombos</a> . <br><br><h2>  Perda </h2><br>  Essa m√©trica informa quantos pacotes enviados pela fonte chegaram ao destino. <br>  A causa da perda pode ser um problema na interface / cabo, congestionamento da rede, erros de bits que bloqueiam as regras da ACL. <br><br>  O que fazer em caso de perda √© decidido pelo aplicativo.  Ele pode ignor√°-los, como no caso de uma conversa telef√¥nica, onde um pacote atrasado n√£o √© mais necess√°rio ou reenvi√°-lo - √© isso que o TCP faz para garantir a entrega precisa dos dados de origem. <br><br><img src="https://habrastorage.org/webt/s9/vc/jj/s9vcjjwjb494cyrx19oby8ykvms.png" width="600"><br><br>  Como gerenciar perdas, se inevit√°veis, no cap√≠tulo Gerenciamento de congestionamentos. <br><br>  Como aproveitar as perdas no cap√≠tulo Preven√ß√£o de congestionamentos. <br><br><h2>  Atrasos </h2><br>  Esse √© o tempo que os dados precisam chegar da origem ao destino. <br><br><img src="https://habrastorage.org/webt/m6/xo/qa/m6xoqapl9y6v422k8c4d--xtmvm.png" width="600"><br><br>  O atraso cumulativo consiste nos seguintes componentes. <br><br><ul><li>  <b>Atraso de serializa√ß√£o</b> - o tempo que <b>leva</b> para um n√≥ decompor um pacote em bits e colocar um link para o pr√≥ximo n√≥.  √â determinado pela velocidade da interface.  Assim, por exemplo, a transfer√™ncia de um pacote de 1500 bytes de tamanho por meio de uma interface de 100 Mb / s levar√° 0,0001 se, por 56 Kb / s - 0,2 s. </li><li>  <b>Atraso na propaga√ß√£o</b> √© o resultado da limita√ß√£o infame da velocidade de propaga√ß√£o das ondas eletromagn√©ticas.  A f√≠sica n√£o permite que voc√™ v√° de Nova York a Tomsk na superf√≠cie do planeta mais rapidamente do que em 30 ms (na verdade, cerca de 70 ms). </li><li>  <b>Os atrasos introduzidos pela QoS</b> s√£o o definhamento de pacotes nas filas ( <b>Atraso na fila</b> ) e as consequ√™ncias da modelagem ( <b>Atraso na</b> modelagem).  Hoje falaremos muito sobre isso no cap√≠tulo Controle de velocidade. </li><li>  <b>Atraso no processamento de pacotes</b> ( <b>Processing Delay</b> ) - o tempo para decidir o que fazer com o pacote: pesquisa, ACL, NAT, DPI - e entreg√°-lo da interface de entrada para a sa√≠da.  Mas no dia em que a Juniper separou o Control and Data Plane em seu M40, os atrasos no processamento poderiam ser negligenciados. </li></ul><br>  Atrasos n√£o s√£o t√£o ruins para aplicativos onde n√£o h√° necessidade de pressa: compartilhamento de arquivos, navega√ß√£o, VoD, esta√ß√µes de r√°dio na Internet, etc.  Por outro lado, eles s√£o cr√≠ticos para os interativos: 200ms j√° √© desagrad√°vel de ouvido durante uma conversa telef√¥nica. <br><br>  Um termo relacionado a atraso que n√£o √© sin√¥nimo de <b>RTT</b> ( <b>Round Trip Time</b> ) √© a ida e volta.  Ao executar o ping e o rastreamento, voc√™ v√™ exatamente o RTT, e n√£o um atraso unidirecional, embora os valores tenham uma correla√ß√£o. <br><br><h2>  Jitter </h2><br>  A diferen√ßa de atraso entre a entrega de pacotes consecutivos √© chamada de instabilidade. <br><br><img src="https://habrastorage.org/webt/hv/-j/9z/hv-j9zu-h0eyuzkf9eaupcputhe.png" width="600"><br><br>  Como a lat√™ncia, o jitter n√£o importa para muitos aplicativos.  E at√©, ao que parece, qual √© a diferen√ßa - o pacote foi entregue, e da√≠? <br><br>  No entanto, para servi√ßos interativos, √© importante. <br><br>  Tome a mesma telefonia como exemplo.  De fato, √© uma digitaliza√ß√£o de sinais anal√≥gicos com uma divis√£o em blocos de dados separados.  A sa√≠da √© um fluxo de pacotes bastante uniforme.  No lado receptor, h√° um pequeno buffer de tamanho fixo no qual os pacotes que chegam sequencialmente se encaixam.  Para restaurar o sinal anal√≥gico, √© necess√°rio um certo n√∫mero deles.  Em condi√ß√µes de atrasos flutuantes, o pr√≥ximo bloco de dados pode n√£o chegar a tempo, o que equivale a uma perda, e o sinal n√£o pode ser restaurado. <br><br>  A maior contribui√ß√£o para a variabilidade do atraso √© feita apenas pela QoS.  Isso tamb√©m √© muito tedioso nos mesmos cap√≠tulos Limite de velocidade. <br><br><hr><br>  Essas s√£o as tr√™s principais caracter√≠sticas da qualidade da rede, mas h√° outras que tamb√©m desempenham um papel importante. <br><br><h2>  Entrega aleat√≥ria </h2><br>  V√°rios aplicativos, como telefonia, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NAS</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CES, s√£o</a> extremamente sens√≠veis √† entrega aleat√≥ria de pacotes quando chegam ao destinat√°rio na ordem errada em que foram enviados.  Isso pode levar √† perda de conectividade, erros, danos ao sistema de arquivos. <br><br>  Embora a entrega aleat√≥ria n√£o seja um recurso formal de QoS, ela definitivamente se refere √† qualidade da rede. <br><br>  Mesmo com o TCP tolerante a esse tipo de problema, ocorrem ACKs e retransmiss√µes duplicadas. <br><br><img src="https://habrastorage.org/webt/yu/51/63/yu5163hdbesjbypr34w4w5puhbo.png" width="600"><br><br><h2>  Largura de banda </h2><br>  N√£o se distingue como uma m√©trica da qualidade da rede, pois de fato sua desvantagem resulta nos tr√™s acima.  No entanto, em nossas realidades, quando deve ser garantido para algumas aplica√ß√µes ou, pelo contr√°rio, deve ser limitado por contrato, por exemplo, a MPLS TE reserva-a em todo o LSP, vale a pena mencionar, pelo menos como uma m√©trica fraca. <br>  Os mecanismos de controle de velocidade ser√£o discutidos nos cap√≠tulos Limite de velocidade. <br><br><hr><br>  Por que as especifica√ß√µes podem ficar ruins? <br><br>  Ent√£o, come√ßamos com uma id√©ia muito primitiva de que um dispositivo de rede (seja um switch, roteador, firewall, seja o que for) √© apenas mais um peda√ßo de tubo chamado canal de comunica√ß√£o, o mesmo que um fio de cobre ou um cabo √≥ptico. <br><br><img src="https://habrastorage.org/webt/r2/yh/hr/r2yhhr2urldnn3t6mqhhk6erz-u.png" width="600"><br><br>  Todos os pacotes voam na mesma ordem em que chegaram e n√£o sofrem atrasos adicionais - n√£o h√° lugar para ficar. <br><br>  Mas, de fato, cada roteador restaura bits e pacotes do sinal, faz algo com eles (ainda n√£o pensamos nisso) e depois converte os pacotes novamente em um sinal. <br><br>  Um atraso de serializa√ß√£o aparece.  Mas, em geral, isso n√£o √© assustador, porque √© constante.  N√£o √© assustador, desde que a largura da interface de sa√≠da seja maior que a entrada. <br><br>  Por exemplo, na entrada do dispositivo h√° uma porta gigabit e na sa√≠da h√° uma linha de rel√© de r√°dio de 620 Mb / s conectada √† mesma porta gigabit? <br><br>  Ningu√©m proibir√° a bala atrav√©s do tr√°fego de gigabit de link formalmente gigabit. <br>  N√£o h√° nada a ser feito - 380 Mb / s cair√£o no ch√£o. <br><br>  Aqui est√£o elas - perdas. <br><br>  Mas, ao mesmo tempo, eu gostaria muito da pior parte a ser derramada - um v√≠deo do youtube, e a conversa telef√¥nica do diretor executivo com o diretor da f√°brica n√£o interrompeu nem mesmo coaxou. <br><br>  Eu gostaria que a voz tivesse uma linha dedicada. <br><br>  Ou h√° cinco interfaces de entrada, mas uma sa√≠da e, ao mesmo tempo, cinco n√≥s come√ßaram a tentar injetar tr√°fego em um destinat√°rio. <br><br>  Adicione uma pitada da teoria do VoIP (um artigo sobre o qual ningu√©m escreveu) - √© muito sens√≠vel a atrasos e suas varia√ß√µes. <br><br>  Se para um fluxo de v√≠deo TCP do youtube (no momento da reda√ß√£o do artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">QUIC</a> - ainda permanece um experimento) atrasos, mesmo em segundos, s√£o completamente in√∫teis devido ao buffer, o diretor ap√≥s a primeira conversa com Kamchatka chamar√° o chefe do departamento t√©cnico. <br>  Nos tempos antigos, quando o autor do ciclo ainda fazia sua li√ß√£o de casa √† noite, o problema era especialmente grave.  As conex√µes de modem tinham uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">velocidade de 56k</a> . <br><br>  E quando um pacote de 1,5K entrou nessa conex√£o, ele ocupou toda a linha por 200 ms.  Ningu√©m mais poderia passar neste momento.  Uma voz?  N√£o, eu n√£o ouvi. <br><br>  Portanto, a quest√£o da MTU √© muito importante - o pacote n√£o deve ocupar a interface por muito tempo.  Quanto menor a velocidade, menor a MTU √© necess√°ria. <br><br>  Aqui est√£o eles - atrasos. <br><br>  Agora o canal est√° livre e o atraso est√° baixo, depois de um segundo algu√©m come√ßou a baixar um arquivo grande e os atrasos aumentaram.  Aqui est√° ele - nervosismo. <br><br>  Portanto, √© necess√°rio que os pacotes de voz voem atrav√©s do canal com atrasos m√≠nimos e o youtube espere. <br><br>  620 Mb / s dispon√≠veis devem ser usados ‚Äã‚Äãpara voz, v√≠deo e clientes B2B que compram VPNs.  Gostaria que um tr√°fego n√£o oprimisse o outro, por isso precisamos de uma garantia de banda. <br><br><hr><br>  Todas as caracter√≠sticas acima s√£o universais em rela√ß√£o √† natureza da rede.  No entanto, existem tr√™s abordagens diferentes para sua provis√£o. <br><br><h1>  2. Tr√™s modelos de QoS </h1><br><ul><li>  Melhor esfor√ßo - sem garantia de qualidade.  Todos s√£o iguais. </li><li>  O IntServ √© uma garantia de qualidade para cada fluxo.  Reservando recursos da origem ao destino. </li><li>  DiffServ - N√£o h√° reserva.  Cada n√≥ em si determina como garantir a qualidade certa. </li></ul><br><h2>  Melhor Esfor√ßo (BE) </h2><br>  <i>Sem garantias.</i> <br><br>  A abordagem mais simples para implementar a QoS, a partir da qual as redes IP come√ßaram e ainda s√£o praticadas at√© hoje - √†s vezes porque √© suficiente, mas mais frequentemente porque ningu√©m pensou em QoS. <br><br>  A prop√≥sito, quando voc√™ envia tr√°fego para a Internet, ele ser√° processado como BestEffort.  Portanto, por meio de uma VPN rolada na Internet (em oposi√ß√£o a uma VPN fornecida pelo provedor), tr√°fego importante, como uma conversa telef√¥nica, pode n√£o ser muito confiante. <br><br>  No caso de BE, todas as categorias de tr√°fego s√£o iguais; nenhuma prefer√™ncia √© dada a nenhuma.  Portanto, n√£o h√° garantia de atraso / instabilidade ou banda. <br><br>  Essa abordagem tem um nome um tanto contra-intuitivo - Melhor Esfor√ßo, que o rec√©m-chegado engana com a palavra "melhor". <br><br>  No entanto, a frase "farei o meu melhor" significa que o orador tentar√° fazer tudo o que puder, mas n√£o garante nada. <br><br>  Nada √© necess√°rio para implementar o BE - este √© o comportamento padr√£o.  √â barato fabricar, a equipe n√£o precisa de conhecimentos espec√≠ficos profundos; nesse caso, a QoS n√£o pode ser personalizada. <br><br>  No entanto, essa simplicidade e est√°tica n√£o levam ao fato de que a abordagem de melhor esfor√ßo n√£o √© usada em nenhum lugar.  Ele encontra aplica√ß√£o em redes com alta largura de banda e aus√™ncia de congestionamentos e explos√µes. <br><br>  Por exemplo, em linhas transcontinentais ou nas redes de alguns data centers em que n√£o h√° excesso de assinaturas. <br>  Em outras palavras, em redes sem congestionamento e onde n√£o h√° necessidade de se relacionar com nenhum tr√°fego (por exemplo, telefonia) de uma maneira especial, o BE √© bastante apropriado. <br><br><h2>  Interv </h2><br>  <i>Reserva antecipada de recursos para o fluxo desde a origem at√© o destino.</i> <br><br>  Os pais das redes MIT, Xerox e ISI decidiram adicionar o elemento de previsibilidade √† crescente Internet aleat√≥ria, mantendo sua operabilidade e flexibilidade. <br><br>  Assim, em 1994, a ideia do IntServ nasceu em resposta ao r√°pido crescimento do tr√°fego em tempo real e ao desenvolvimento do multicast.  Foi ent√£o reduzido para IS. <br><br>  O nome reflete o desejo na mesma rede de fornecer servi√ßos simultaneamente para tipos de tr√°fego em tempo real e n√£o em tempo real, fornecendo a primeira prioridade de direito de usar recursos atrav√©s da reserva da banda.  A capacidade de reutilizar a banda na qual todos ganham dinheiro, e gra√ßas √† qual o IP disparou, foi preservada. <br><br>  A miss√£o de backup foi atribu√≠da ao protocolo RSVP, que para <b>cada</b> fluxo reserva uma banda em <b>cada</b> dispositivo de rede. <br><br>  Grosso modo, antes de configurar uma sess√£o Single Rate Three Color MarkerP ou iniciar a troca de dados, os hosts finais enviam o caminho RSVP com a largura de banda necess√°ria.  E se ambos retornaram RSVP Resv - eles podem come√ßar a se comunicar.  Ao mesmo tempo, se n√£o houver recursos dispon√≠veis, o RSVP retornar√° um erro e os hosts n√£o poder√£o se comunicar ou seguir o BE. <br><br>  Agora, os mais bravos leitores imaginam que um canal ser√° sinalizado antecipadamente para <b>qualquer</b> fluxo na Internet hoje.  Considerando que isso requer custos de CPU e mem√≥ria diferentes de zero em <b>cada</b> n√≥ de tr√¢nsito, adia a intera√ß√£o real por algum tempo, fica claro por que o IntServ acabou sendo uma ideia praticamente natimortal - escalabilidade zero. <br><br>  Em certo sentido, a encarna√ß√£o moderna do IntServ √© o MPLS TE com uma vers√£o de rotulagem adaptada do RSVP - RSVP TE.  Embora aqui, √© claro, n√£o seja de ponta a ponta e nem por fluxo. <br><br>  O IntServ √© descrito na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 1633</a> . <br>  O documento √©, em princ√≠pio, curioso para avaliar o qu√£o ing√™nuo voc√™ pode ser nas previs√µes. <br><br><h2>  Diffserv </h2><br>  <i>DiffServ √© complicado.</i> <br><br>  Quando ficou claro, no final dos anos 90, que a abordagem IP IntServ de ponta a ponta falhou, a IETF convocou o grupo de trabalho Servi√ßos diferenciados em 1997, que desenvolveu os seguintes requisitos para o novo modelo de QoS: <br><br><ul><li>  Sem sinaliza√ß√£o (Adjos, confirma!). </li><li>  Com base na classifica√ß√£o de tr√°fego agregado, em vez de focar nos fluxos, clientes, etc. </li><li>  Possui um conjunto limitado e determin√≠stico de a√ß√µes para processar o tr√°fego de dados das classes. </li></ul><br>  Como resultado, o marco <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 2474</a> ( <i>defini√ß√£o do campo de servi√ßos diferenciados (campo DS) nos cabe√ßalhos IPv4 e IPv6</i> ) e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 2475</a> ( <i>uma arquitetura para servi√ßos diferenciados</i> ) nasceu em 1998. <br><br>  E mais adiante, falaremos apenas sobre o DiffServ. <br><br><blockquote>  Vale ressaltar que o nome DiffServ n√£o √© a ant√≠tese do IntServ.  Isso reflete que diferenciamos os servi√ßos fornecidos por v√°rios aplicativos, ou melhor, o tr√°fego deles, ou seja, compartilhamos / diferenciamos esses tipos de tr√°fego. <br>  O IntServ faz o mesmo - ele distingue entre os tipos de tr√°fego BE e Real-Time, transmitidos na mesma rede.  Ambos: e IntServ e DiffServ - referem-se a maneiras de diferenciar servi√ßos. </blockquote><br><hr><br><h1>  3. Mecanismos DiffServ </h1><br>  O que √© o DiffServ e por que ele vence o IntServ? <br><br>  Se for muito simples, o tr√°fego ser√° dividido em classes.  Um pacote na entrada de cada n√≥ √© classificado e um conjunto de ferramentas √© aplicado a ele, que processa pacotes de diferentes classes de maneiras diferentes, fornecendo-lhes um n√≠vel de servi√ßo diferente. <br><br>  Mas simplesmente <a href="">n√£o ser√°</a> . <br><br>  No cora√ß√£o do DiffServ est√° o conceito ideal de IP IP <b>PHB - Comportamento por salto</b> .  Cada n√≥ no caminho de tr√°fego toma uma decis√£o independente sobre como se comportar em rela√ß√£o ao pacote recebido, com base em seus cabe√ßalhos. <br><br>  As a√ß√µes do roteador de pacotes ser√£o chamadas de modelo de comportamento.  O n√∫mero de tais modelos √© determin√≠stico e limitado.  Em dispositivos diferentes, os modelos de comportamento em rela√ß√£o ao mesmo tr√°fego <i>podem</i> ser diferentes, portanto, s√£o por salto. <br><br>  <i>Os conceitos de <b>comportamento</b> e <b>PHB</b> usarei no artigo como sin√¥nimos.</i> <br><blockquote>  H√° uma ligeira confus√£o.  PHB √©, por um lado, o conceito geral de comportamento independente de cada n√≥ e, por outro, um modelo espec√≠fico em um n√≥ espec√≠fico.  Com isso, vamos descobrir. <br></blockquote><img src="https://habrastorage.org/webt/8w/jq/kq/8wjqkqc9e4jwrm1lokdaahlnod8.png" width="600"><br><br>  O modelo de comportamento √© determinado por um conjunto de ferramentas e seus par√¢metros: policiamento, descarte, enfileiramento, agendamento e modelagem. <br><br>  Usando os modelos de comportamento dispon√≠veis, a rede pode fornecer v√°rias classes de servi√ßo ( <b>Classe de Servi√ßo</b> ). <br><br>  Ou seja, diferentes categorias de tr√°fego podem receber diferentes n√≠veis de servi√ßo na rede aplicando PHBs diferentes a eles. <br><br>  Portanto, primeiro, voc√™ precisa determinar a qual classe de tr√°fego de servi√ßo se refere - <b>Classifica√ß√£o</b> . <br><br>  Cada n√≥ classifica independentemente os pacotes recebidos. <br><br><img src="https://habrastorage.org/webt/_o/lp/jm/_olpjmv8pc3bclzzg9qtvh1_vke.png" width="700"><br><br>  Ap√≥s a classifica√ß√£o, ocorre uma medi√ß√£o ( <b>Medi√ß√£o</b> ) - quantos bits / bytes de tr√°fego dessa classe chegaram ao roteador. <br><br>  Com base nos resultados, as embalagens podem ser pintadas ( <b>Colora√ß√£o</b> ): verde (dentro do limite estabelecido), amarelo (fora do limite), vermelho (seduziu completamente a costa). <br><br><img src="https://habrastorage.org/webt/3h/6g/xi/3h6gxiq2g_7lejnvonvxtft9pys.png" width="700"><br><br>  Se necess√°rio, ocorre o <b>policiamento</b> (desculpe-me por esse papel vegetal, existe uma op√ß√£o melhor - escreva, vou mudar).  Um polidor com base na cor de um pacote atribui uma a√ß√£o ao pacote - transmitir, descartar ou marcar novamente. <br><br><img src="https://habrastorage.org/webt/ft/gk/2k/ftgk2klys-yvgdicuzs1i8zg3lo.png" width="700"><br><br>  Depois disso, o pacote deve cair em uma das filas ( <b>Enfileiramento</b> ).  Uma fila separada √© alocada para cada classe de servi√ßo, o que permite que sejam diferenciadas usando PHBs diferentes. <br><br>  Por√©m, mesmo antes do pacote entrar na fila, ele pode ser descartado ( <b>Dropper</b> ) se a fila estiver cheia. <br><br>  Se estiver verde, ele passar√°, se estiver amarelo, provavelmente ser√° descartado se a linha estiver cheia e se vermelho for um bom ataque suicida.  Condicionalmente, a probabilidade de queda depende da cor do pacote e da plenitude da fila onde ela vai chegar. <br><br><img src="https://habrastorage.org/webt/er/q2/ks/erq2ksivfaq7yj2gch6ihcbezts.png" width="700"><br><br>  Na sa√≠da da fila, um <b>Shaper</b> funciona, cuja tarefa √© muito semelhante √† tarefa do polisador - limitar o tr√°fego a um determinado valor. <br><br>  Voc√™ pode configurar shapers arbitr√°rios para filas individuais ou mesmo dentro de filas. <br>  Sobre a diferen√ßa entre um modelador e um poliser no cap√≠tulo Limite de velocidade. <br><br>  Todas as filas devem eventualmente se fundir em uma √∫nica interface de sa√≠da. <br><br>  Lembre-se da situa√ß√£o em que, na estrada, 8 faixas se fundem em 3. Sem um controlador de tr√°fego, isso se transforma em caos.  A separa√ß√£o por turnos n√£o faria sentido se tiv√©ssemos a mesma sa√≠da que a entrada. <br><br>  Portanto, existe um despachante especial ( <b>Agendador</b> ), que retira ciclicamente pacotes de diferentes filas e os envia para a interface ( <b>Agendamento</b> ). <br><br>  De fato, uma combina√ß√£o de um conjunto de filas e um despachante √© o mecanismo de QoS mais importante que permite aplicar regras diferentes a diferentes classes de tr√°fego, uma fornecendo uma ampla largura de banda, a outra baixa lat√™ncia e a terceira falta de descargas. <br><br>  Ent√£o os pacotes j√° v√£o para a interface, onde os pacotes s√£o convertidos em um fluxo de bits - serializa√ß√£o ( <b>serializa√ß√£o</b> ) e depois no sinal do ambiente. <br><br><img src="https://habrastorage.org/webt/dy/i2/pk/dyi2pkpat1havyiz3ps3dmret-y.png" width="700"><br><br>  No DiffServ, o comportamento de cada n√≥ √© independente dos outros; n√£o h√° protocolos de sinaliza√ß√£o que indiquem qual pol√≠tica de QoS est√° na rede.  Ao mesmo tempo, na rede, eu gostaria que o tr√°fego fosse tratado da mesma maneira.  Se apenas um n√≥ se comportar de maneira diferente, toda a pol√≠tica de QoS estar√° no ralo. <br><br>  Para fazer isso, primeiro, em todos os roteadores, as mesmas classes e PHB s√£o configuradas para eles; segundo, √© usada a <b>marca√ß√£o do</b> pacote - sua perten√ßa a uma classe espec√≠fica √© registrada no cabe√ßalho (IP, MPLS, 802.1q). <br><br>  E a beleza do DiffServ √© que o pr√≥ximo n√≥ pode contar com esse r√≥tulo para classifica√ß√£o. <br><br>  Essa zona de confian√ßa, na qual as mesmas regras de classifica√ß√£o de tr√°fego e os mesmos comportamentos se aplicam, √© chamada de dom√≠nio <b>DiffServ</b> ( <b>DiffServ-Domain</b> ). <br><br><img src="https://habrastorage.org/webt/8o/7d/ex/8o7dexwfq0xawzyhsuix7-viewi.png" width="700"><br><br>  Assim, na entrada do dom√≠nio DiffServ, podemos classificar um pacote com base em 5 tuplas ou em uma interface, marc√°-lo ( <b>Observa√ß√£o / Reescrever</b> ) de acordo com as regras do dom√≠nio, e outros n√≥s confiar√£o nessa marca√ß√£o e n√£o far√£o uma classifica√ß√£o complexa. <br>  Ou seja, n√£o h√° sinaliza√ß√£o expl√≠cita no DiffServ, mas o n√≥ pode dizer a todos os seguintes que classe esse pacote precisa ser fornecido, esperando que seja confi√°vel. <br><br>  Nas jun√ß√µes entre dom√≠nios DiffServ, voc√™ precisa negociar pol√≠ticas de QoS (ou n√£o). <br><br>  A imagem inteira ser√° mais ou menos assim: <br><br><img src="https://habrastorage.org/webt/_-/7v/nt/_-7vntuvn9r1ugem7yenmxoj9fw.png" width="1000"><br><blockquote>  Para deixar claro, darei um an√°logo da vida real. <br>  V√¥o de avi√£o (n√£o vit√≥ria). <br>  Existem tr√™s classes de servi√ßo (CoS): Economia, Neg√≥cios, Primeiro. <br>  Ao comprar um bilhete, a Classifica√ß√£o ocorre - o passageiro recebe uma determinada classe de servi√ßo com base no pre√ßo. <br>  No aeroporto, h√° uma marca√ß√£o (Observa√ß√£o) - um bilhete √© emitido indicando a classe. <br>  Existem dois comportamentos (PHBs): Melhor Esfor√ßo e Pr√™mio. <br>  Existem mecanismos que implementam comportamentos: uma sala de espera comum ou VIP Lounge, um micro√¥nibus ou um √¥nibus compartilhado, assentos grandes confort√°veis ‚Äã‚Äãou filas estreitas, n√∫mero de passageiros por comiss√°rio de bordo, capacidade de pedir √°lcool. <br>  Dependendo da classe, os modelos de comportamento s√£o atribu√≠dos - √† economia de Melhor Esfor√ßo, aos Neg√≥cios - Premium b√°sico e ao Primeiro - SUPER-POWER-NINJA-TURBO-NEO-ULTRA-HIPER-MEGA-MULTI-ALFA-META-EXTRA-UBER-PREFIX! <br>  Ao mesmo tempo, dois pr√™mios diferem no fato de que, em um, eles d√£o um copo de meio-doce e, no outro, t√™m Bacardi ilimitado. <br><br>  Ent√£o, ao chegar ao aeroporto, todos passam por uma porta.  Aqueles que tentaram trazer armas com eles ou n√£o possuem ingresso n√£o s√£o permitidos (Drop).  Neg√≥cios e economia entram em diferentes salas de espera e diferentes transportes (filas).  Primeiro, eles deixam a Primeira Classe a bordo, depois os neg√≥cios, depois a Economia (Programa√ß√£o), mas depois todos voam para o seu destino com um avi√£o (interface). <br><br>  No mesmo exemplo, um voo em um avi√£o √© um atraso de propaga√ß√£o, o pouso √© um atraso de serializa√ß√£o, a espera de um avi√£o nos corredores √© na fila e o controle de passaporte √© em processamento.  Observe que aqui o atraso no processamento geralmente √© insignificante em termos de tempo total. <br><br>  O pr√≥ximo aeroporto pode lidar com passageiros de uma maneira completamente diferente - seu PHB √© diferente.  Mas, ao mesmo tempo, se o passageiro n√£o mudar de companhia a√©rea, provavelmente a atitude em rela√ß√£o a ele n√£o mudar√°, porque uma empresa √© um dom√≠nio DiffServ. <br></blockquote>  Como voc√™ deve ter notado, o DiffServ √© extremamente (ou infinitamente) complexo.  Mas vamos analisar tudo descrito acima.  Ao mesmo tempo, no artigo, n√£o abordarei as nuances da implementa√ß√£o f√≠sica (elas podem diferir mesmo em duas placas do mesmo roteador), n√£o falarei sobre HQoS e MPLS DS-TE. <br><br>  O limite para entrar no c√≠rculo de engenheiros que entendem a tecnologia para QoS √© muito maior do que para protocolos de roteamento, MPLS ou, desculpe-me, Radya, STP. <br><br>  Apesar disso, o DiffServ ganhou reconhecimento e implementa√ß√£o em redes em todo o mundo, porque, como eles dizem, s√£o altamente escal√°veis. <br><br>  No restante deste artigo, analisarei apenas o DiffServ. <br><br>  A seguir, analisaremos todas as ferramentas e processos indicados na ilustra√ß√£o. <br><br><img src="https://habrastorage.org/webt/qb/21/kg/qb21kgaqnsm6-pi2qwe0rdniqq4.png" width="600"><br><br><hr><br>  No decorrer da expans√£o do t√≥pico, mostrarei algumas coisas na pr√°tica. <br>  Trabalharemos com essa rede: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  Trisolarans √© um cliente provedor de linkmeup com dois pontos de conex√£o. <br><br>  A √°rea amarela √© o dom√≠nio DiffServ da rede linkmeup, onde uma √∫nica pol√≠tica de QoS est√° em vigor. <br>  Linkmeup_R1 √© um dispositivo CPE que √© gerenciado pelo provedor e, portanto, em uma zona confi√°vel.  O OSPF √© criado com ele e a intera√ß√£o ocorre atrav√©s de um IP limpo. <br><br>  Dentro do n√∫cleo da rede est√£o MPLS + LDP + MP-BGP com L3VPN, estendido de Linkmeup_R2 para Linkmeup_R4. <br>  Farei todos os outros coment√°rios, se necess√°rio. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O arquivo de configura√ß√£o inicial</a> . <br><br><hr><br><h1>  4. Classifica√ß√£o e rotulagem </h1><br>  Dentro de sua rede, o administrador define as classes de servi√ßo que ele pode fornecer tr√°fego. <br><br>  Portanto, a primeira coisa que cada n√≥ faz quando recebe um pacote √© classific√°-lo. <br><br>  Existem tr√™s maneiras: <br><br><ol><li>  <b>Agregado de comportamento</b> ( <b>BA</b> ) <br>  Apenas confie no r√≥tulo do pacote existente em seu cabe√ßalho.  Por exemplo, o campo IP DSCP. <br>  √â chamado assim porque, sob o mesmo r√≥tulo no campo DSCP, s√£o agregadas v√°rias categorias de tr√°fego que esperam o mesmo comportamento em rela√ß√£o a si mesmas.  Por exemplo, todas as sess√µes SIP ser√£o agregadas em uma classe. <br><br>  O n√∫mero de poss√≠veis classes de servi√ßo e, portanto, padr√µes de comportamento, √© limitado.  Portanto, √© imposs√≠vel para cada categoria (ou mais ainda para o fluxo) separar uma classe separada - √© necess√°rio agregar. </li><li>  <b>Baseado em interface</b> <br>  Tudo o que chega a uma interface espec√≠fica deve ser colocado em uma classe de tr√°fego.  Por exemplo, sabemos com certeza que o servidor de banco de dados est√° conectado a essa porta e nada mais.  E em outra esta√ß√£o de trabalho dos funcion√°rios. </li><li>  <b>MultiField</b> ( <b>MF</b> ) <br>  Analise os campos do cabe√ßalho do pacote - endere√ßos IP, portas, endere√ßos MAC.  De um modo geral, campos arbitr√°rios. <br><br>  Por exemplo, todo o tr√°fego que vai para a sub-rede 10.127.721.0/24 na porta 5000 precisa ser marcado como tr√°fego, exigindo condicionalmente a 5¬™ classe de servi√ßo. </li></ol><br>  O administrador determina o conjunto de classes de servi√ßo que a rede pode fornecer e mapeia algum valor digital. <br><br>  Na entrada do dom√≠nio DS, n√£o confiamos em ningu√©m, portanto a classifica√ß√£o √© realizada da segunda ou terceira maneira: com base nos endere√ßos, protocolos ou interfaces, a classe de servi√ßo e o valor digital correspondente s√£o determinados. <br><br>  Na sa√≠da do primeiro n√≥, esse d√≠gito √© codificado no campo DSCP do cabe√ßalho IP (ou outro campo da Classe de tr√°fego: Classe de tr√°fego MPLS, Classe de tr√°fego IPv6, Ethernet 802.1p) - ocorre uma observa√ß√£o. <br><br>  √â habitual confiar nessa rotulagem no dom√≠nio DS, portanto, os n√≥s de tr√¢nsito usam o primeiro m√©todo de classifica√ß√£o (BA) - o mais simples.  Nenhuma an√°lise de t√≠tulo complicada, basta olhar para o n√∫mero gravado. <br><br>  Na jun√ß√£o de dois dom√≠nios, voc√™ pode classificar com base em uma interface ou MF, conforme descrito acima, ou pode confiar na marca√ß√£o BA com reservas. <br><br>  Por exemplo, confie em todos os valores, exceto 6 e 7, e reatribua 6 e 7 a 5. <br><br>  Essa situa√ß√£o √© poss√≠vel quando o provedor conecta uma entidade legal que possui sua pr√≥pria pol√≠tica de rotulagem.  O provedor n√£o se importa em salv√°-lo, mas n√£o deseja que o tr√°fego caia na classe em que recebe pacotes de protocolo de rede. <br><br><img src="https://habrastorage.org/webt/8o/7d/ex/8o7dexwfq0xawzyhsuix7-viewi.png" width="900"><br><br><h2>  Agrega√ß√£o de comportamento </h2><br>  BA usa uma classifica√ß√£o muito simples - vejo um n√∫mero - entendo a classe. <br>  Ent√£o, qual √© a figura?  E em que campo est√° registrado? <br><br><ul><li>  Classe de tr√°fego IPv6 </li><li>  Classe de tr√°fego MPLS </li><li>  Ethernet 802.1p </li></ul><br>  A classifica√ß√£o √© baseada principalmente no cabe√ßalho da comuta√ß√£o. <br><br>  <i>Eu chamo um cabe√ßalho pendular com base no qual o dispositivo determina para onde enviar o pacote para que fique mais pr√≥ximo do destinat√°rio.</i> <br>  Ou seja, se um pacote IP chegar ao roteador, o cabe√ßalho IP e o campo DSCP ser√£o analisados.  Se o MPLS chegar, ele ser√° analisado - MPLS Traffic Class. <br><br>  Se um pacote Ethernet + VLAN + MPLS + IP chegou a um comutador L2 comum, o 802.1p ser√° analisado (embora isso possa ser alterado). <br><br><h3>  Termos de Servi√ßo IPv4 </h3><br>  O campo QoS nos acompanha exatamente tanto quanto o IP.  O campo TOS de oito bits - Tipo de servi√ßo - deveria ter a prioridade do pacote. <br><br>  Mesmo antes do advento do DiffServ, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 791</a> ( <i>INTERNET PROTOCOL</i> ) descreveu o campo da seguinte maneira: <br><br>  Preced√™ncia de IP (IPP) + DTR + 00. <br><br><img src="https://habrastorage.org/webt/fw/fe/of/fwfeofy_xr9dbft1vbap2djoszm.png" width="700"><br><br>  Ou seja, a prioridade do pacote vai, ent√£o os bits de exatid√£o para Atraso, Taxa de transfer√™ncia, Confiabilidade (0 - sem requisitos, 1 - com requisitos). <br><br>  Os dois √∫ltimos bits devem ser zero. <br><br><div class="spoiler">  <b class="spoiler_title">A prioridade determinou os seguintes valores ...</b> <div class="spoiler_text">  111 - Controle de Rede <br>  110 - Controle de rede <br>  101 - CRITIC / ECP <br>  100 - Substitui√ß√£o do Flash <br>  011 - Flash <br>  010 - Imediato <br>  001 - Prioridade <br>  000 - Rotina <br></div></div><br>  Posteriormente na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 1349</a> ( <i>Tipo de servi√ßo no Internet Protocol Suite</i> ), o campo TOS foi ligeiramente redefinido: <br><br><img src="https://habrastorage.org/webt/95/dz/pm/95dzpm400ckireeowdta1q_7lvg.png" width="700"><br><br>  Os tr√™s bits √† esquerda permaneceram Preced√™ncia de IP, os quatro seguintes se transformaram em TOS ap√≥s adicionar o bit de custo. <br><br>  Veja como ler as unidades nesses bits TOS: <br><br><ul><li>  D - "minimizar atrasos", </li><li>  T - "maximizar a taxa de transfer√™ncia", </li><li>  R - "maximizar a confiabilidade", </li><li>  C - "minimizar custos". </li></ul><br>  Descri√ß√µes obscuras n√£o contribu√≠ram para a popularidade dessa abordagem. <br><br>  N√£o havia uma abordagem sistem√°tica da QoS ao longo de todo o caminho, n√£o havia recomenda√ß√µes claras sobre como usar o campo priorit√°rio, a descri√ß√£o dos bits de atraso, taxa de transfer√™ncia e confiabilidade era extremamente vaga. <br><br>  Portanto, no contexto do DiffServ, o campo TOS foi novamente redefinido no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 2474</a> ( <i>Defini√ß√£o do campo de servi√ßos diferenciados (campo DS) nos cabe√ßalhos IPv4 e IPv6</i> ): <br><br><img src="https://habrastorage.org/webt/n_/ie/zm/n_iezmmdhv2tg7qlbxqad7c_4_m.png" width="700"><br><br>  Em vez dos bits IPP e DTRC, o campo de seis bits DSCP - <b>Ponto de C√≥digo de Servi√ßos Diferenciados foi</b> introduzido, os dois bits corretos n√£o foram utilizados. <br><br>  A partir desse momento, era o campo DSCP que deveria ter se tornado a principal marca√ß√£o do DiffServ: um certo valor (c√≥digo) √© gravado nele, o qual no dom√≠nio DS caracteriza a classe espec√≠fica de servi√ßo exigida pelo pacote e sua prioridade de queda.  Esta √© a mesma figura. <br><br>  O administrador pode usar todos os 6 bits do DSCP como desejar, compartilhando at√© um m√°ximo de 64 classes de servi√ßo. <br><br>  No entanto, por uma quest√£o de compatibilidade com a Preced√™ncia de IP, eles mantiveram o papel de Seletor de Classe nos tr√™s primeiros bits. <br><br>  Ou seja, como no IPP, 3 bits do Class Selector permitem definir 8 classes. <br><br><img src="https://habrastorage.org/webt/fw/vl/p0/fwvlp0wanilpj7_lrp8bxj7blqe.png" width="700"><br><br>  No entanto, isso ainda n√£o passa de um acordo que, dentro dos limites de seu dom√≠nio DS, o administrador pode facilmente ignorar e usar todos os 6 bits a seu crit√©rio. <br><br>  Al√©m disso, tamb√©m observo que, de acordo com as recomenda√ß√µes da IETF, quanto maior o valor registrado no CS, mais exigente √© esse tr√°fego para o servi√ßo. <br><br>  Mas isso n√£o deve ser tomado como uma verdade ineg√°vel. <br><br>  Se os tr√™s primeiros bits definirem a classe de tr√°fego, os pr√≥ximos tr√™s ser√£o usados ‚Äã‚Äãpara indicar a prioridade de queda de pacotes ( <b>Preced√™ncia de queda</b> ou <b>Prioridade de perda de pacote - PLP</b> ). <br><blockquote>  Oito aulas - √© muito ou pouco?  √Ä primeira vista, n√£o basta - afinal, h√° um tr√°fego diferente na rede que se deseja distinguir cada protocolo por classe.  No entanto, oito s√£o suficientes para todos os cen√°rios poss√≠veis. <br>  Para cada classe, voc√™ precisa definir um PHB que o manipule de maneira diferente de outras classes. <br>  E com um aumento no divisor, o dividendo (recurso) n√£o aumenta. <br>  N√£o estou deliberadamente falando sobre os valores exatos de qual classe de tr√°fego eles descrevem, pois n√£o h√° padr√µes e voc√™ pode us√°-los formalmente a seu crit√©rio.  Abaixo, mostrarei quais classes e seus valores correspondentes s√£o recomendados. <br></blockquote><div class="spoiler">  <b class="spoiler_title">Bits ECN ...</b> <div class="spoiler_text">  O campo ECN de dois bits apareceu apenas no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 3168</a> ( <i>notifica√ß√£o expl√≠cita de congestionamento</i> ).  O campo foi definido com o bom prop√≥sito de informar explicitamente aos hosts finais que algu√©m estava enfrentando congestionamento ao longo do caminho. <br>  Por exemplo, quando os pacotes ficam atrasados ‚Äã‚Äãnas filas do roteador por um longo tempo e os preenchem, por exemplo, em 85%, ele altera o valor do ECN, informando ao host final o que precisa ser mais lento - algo como Pause Frames on Ethernet. <br><br>  Nesse caso, o remetente deve reduzir a taxa de transmiss√£o e reduzir a carga no n√≥ afetado. <br><br>  Ao mesmo tempo, teoricamente, o suporte desse campo por todos os n√≥s de tr√¢nsito n√£o √© necess√°rio.  Ou seja, o uso do ECN n√£o interrompe a rede que n√£o o suporta. <br><br>  O objetivo √© bom, mas antes da aplica√ß√£o na vida, o ECN n√£o √© particularmente encontrado.  Atualmente, mega e hiperescalas olham para esses dois bits com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">novo interesse</a> . <br><br>  O ECN √© um dos mecanismos de preven√ß√£o de congestionamento descritos abaixo. <br></div></div><br><hr><br><h4>  Pr√°tica de classifica√ß√£o DSCP </h4><br>  N√£o d√≥i um pouco de pr√°tica. <br><br>  O esquema √© o mesmo. <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  Para come√ßar, basta enviar uma solicita√ß√£o ICMP: <br><br><pre><code class="hljs pgsql">Linkmeup_R1#ping ip <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> source <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">escape</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span>. Sending <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>-byte ICMP Echos <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>, timeout <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> seconds: Packet sent <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> a source address <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> !!!!! Success rate <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> percent (<span class="hljs-number"><span class="hljs-number">5</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span>), round-trip min/avg/max = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> ms</code> </pre> <br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><br><img src="https://habrastorage.org/webt/6g/zl/lp/6gzllpyfrbtsvqjd3sqn-rljc8g.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pcapng</a></i> <br><br>  E agora com o valor DSCP definido. <br><br><pre> <code class="hljs pgsql"> Linkmeup_R1#ping ip <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> source <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> tos <span class="hljs-number"><span class="hljs-number">184</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">escape</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span>. Sending <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>-byte ICMP Echos <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>, timeout <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> seconds: Packet sent <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> a source address <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> !!!!! Success rate <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> percent (<span class="hljs-number"><span class="hljs-number">5</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span>), round-trip min/avg/max = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> ms</code> </pre> <br>  O valor 184 √© a representa√ß√£o decimal do bin√°rio 10111000. Desses, os primeiros 6 bits s√£o 101110, ou seja, decimal 46, e essa √© a classe EF. <br><br><div class="spoiler">  <b class="spoiler_title">Tabela de valores TOS padr√£o para popingushki conveniente ...</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/z5/fx/ij/z5fxijhtpv24gndpefezlypbdju.png" width="500"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mais detalhes</a></i> <br>  Abaixo no texto no cap√≠tulo da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Recomenda√ß√£o</a> da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IETF,</a> vou lhe dizer de onde vieram esses n√∫meros e nomes. <br></div></div><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0</i> <br><br><img src="https://habrastorage.org/webt/y_/fn/gn/y_fngnyvicccbvsesftdw5lawrc.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pcapng</a></i> <br><br>  Uma observa√ß√£o curiosa: o destino de pingushka na resposta de eco do ICMP define o mesmo valor de classe que estava na solicita√ß√£o de eco.  Isso √© l√≥gico - se o remetente enviou um pacote com um certo n√≠vel de import√¢ncia, obviamente ele deseja receb√™-lo com garantia. <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0</i> <br><br><img src="https://habrastorage.org/webt/wk/uu/ea/wkuueaujq2oqgrgd6cu960kqezu.png" width="600"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Arquivo de configura√ß√£o de classifica√ß√£o DSCP.</a> <br><br><h3>  Classe de tr√°fego IPv6 </h3><br>  O IPv6 n√£o √© muito diferente em termos de QoS do que o IPv4.  O campo de oito bits, chamado de classe de tr√°fego, tamb√©m √© dividido em duas partes.  Os primeiros 6 bits - DSCP - desempenham exatamente o mesmo papel. <br><br><img src="https://habrastorage.org/webt/cu/xd/nf/cuxdnfexzlj8ls4zjd3qxwh8oa8.png" width="700"><br><br>  Sim, o Flow Label apareceu.  Eles dizem que poderia ser usado para diferencia√ß√£o adicional de classes.  Mas essa id√©ia ainda n√£o foi aplicada na vida. <br><br><h3>  Classe de tr√°fego MPLS </h3><br>  O conceito de DiffServ foi focado em redes IP com roteamento de cabe√ßalho IP.  Isso √© apenas azar - ap√≥s 3 anos, eles publicaram a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 3031</a> ( <i>Multiprotocol Label Switching Architecture</i> ).  E o MPLS come√ßou a assumir os provedores de rede. <br><br>  DiffServ n√£o p√¥de ser estendido a ele. <br><br>  Por uma coincid√™ncia de sorte, um campo EXP de tr√™s bits foi colocado no MPLS para qualquer caso experimental.  E, apesar de h√° muito tempo atr√°s na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 5462</a> ( <i>campo "EXP" renomeado para campo "Classe de tr√°fego"</i> ) se tornar oficialmente o campo Classe de tr√°fego, por in√©rcia √© chamado IExPi. <br><br>  H√° um problema: o comprimento √© de tr√™s bits, o que limita o n√∫mero de valores poss√≠veis a 9. N√£o √© apenas pequeno, √© tr√™s ordens bin√°rias a menos que o DSCP. <br><br><img src="https://habrastorage.org/webt/is/r0/tc/isr0tc7unhhkxs-bjevcbipjq6k.png" width="700"><br><br>  Como a classe de tr√°fego MPLS geralmente √© herdada do pacote IP do DSCP, temos um arquivamento com perda.  Ou ... N√£o, voc√™ n√£o quer saber disso ... <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">L-LSP</a> .  Usa uma combina√ß√£o de classe de tr√°fego + valor do r√≥tulo. <br><blockquote>  Geralmente, a situa√ß√£o √© estranha - o MPLS foi projetado como um aux√≠lio de IP para tomada de decis√£o r√°pida - o r√≥tulo MPLS √© instantaneamente detectado no CAM pelo Full Match, em vez do tradicional Longest Prefix Match.  Ou seja, eles sabiam sobre IP e participavam da comuta√ß√£o, mas n√£o previam um campo de prioridade normal. <br></blockquote>  De fato, j√° vimos acima que apenas os tr√™s primeiros bits do DSCP s√£o usados ‚Äã‚Äãpara determinar a classe de tr√°fego, e os outros tr√™s bits s√£o Preced√™ncia de descarte (ou PLP - Packet Loss Priority). <br><br>  Portanto, em termos de classes de servi√ßo, ainda temos uma correspond√™ncia 1: 1, perdendo apenas informa√ß√µes sobre a Preced√™ncia de descarte. <br><br>  No caso do MPLS, a classifica√ß√£o como no IP pode ser baseada na interface, MF, IP DSCP ou MPLS da classe de tr√°fego. <br><br>  Rotular significa escrever um valor no campo Classe de Tr√°fego do cabe√ßalho MPLS. <br><br>  Um pacote pode conter v√°rios cabe√ßalhos MPLS.  Para fins DiffServ, apenas a parte superior √© usada. <br><br>  H√° tr√™s cen√°rios diferentes de remarca√ß√£o ao mover um pacote de um segmento IP puro para outro pelo dom√≠nio MPLS: (este √© apenas um trecho do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> ). <br><br><ol><li>  Modo uniforme </li><li>  Modo de tubo </li><li>  Modo de tubo curto </li></ol><br><div class="spoiler">  <b class="spoiler_title">Modos de Opera√ß√£o ...</b> <div class="spoiler_text"><br><h3>  Modo uniforme </h3><br>  Este √© um modelo completo de ponta a ponta. <br><br><img src="https://habrastorage.org/web/e50/932/53b/e5093253bcf94dc091f88500be2b6f9d.png" width="1000"><br><br>  No Ingress PE, confiamos no IP DSCP e copiamos ( <i>estritamente falando, exibi√ß√£o, mas por simplicidade diremos "copiar"</i> ) seu valor no MPLS EXP (cabe√ßalhos de t√∫nel e VPN).  Na sa√≠da do Ingress PE, o pacote j√° √© processado de acordo com o valor do campo EXP do cabe√ßalho MPLS superior. <br><br>  Cada tr√¢nsito P tamb√©m processa pacotes com base na EXP superior.  Mas, ao mesmo tempo, ele pode alter√°-lo se o operador desejar. <br><br>  O pen√∫ltimo n√≥ remove o r√≥tulo de transporte (PHP) e copia o valor EXP para o cabe√ßalho da VPN.  N√£o importa o que estava l√° - no modo Uniforme, a c√≥pia ocorre. <br><br>  O PE de sa√≠da, removendo o r√≥tulo da VPN, tamb√©m copia o valor EXP para o IP DSCP, mesmo que algo mais esteja escrito l√°. <br><br>  Ou seja, se em algum lugar no meio o valor do r√≥tulo EXP no cabe√ßalho do t√∫nel tiver sido alterado, essa altera√ß√£o ser√° herdada pelo pacote IP. <br><br><h3>  Modo de tubo </h3><br><img src="https://habrastorage.org/web/5a1/f9a/a46/5a1f9aa46bb94ed88d62185535f5b41e.png" width="1000"><br><br>  Se no Ingress PE decidirmos n√£o confiar no valor DSCP, o valor EXP desejado pelo operador ser√° inserido nos cabe√ßalhos MPLS. <br><br>  Mas √© aceit√°vel copiar aqueles que estavam no DSCP.  Por exemplo, voc√™ pode redefinir valores - copiar tudo at√© EF e mapear CS6 e CS7 para EF. <br><br>  Cada tr√¢nsito P olha apenas para a EXP do cabe√ßalho MPLS superior. <br><br>  O pen√∫ltimo n√≥ remove o r√≥tulo de transporte (PHP) e <b>copia</b> o valor EXP para o cabe√ßalho da VPN. <br><br>  O PE de sa√≠da processa primeiro o pacote com base no campo EXP no cabe√ßalho MPLS e somente o remove, <b>sem copiar o</b> valor no DSCP. <br><br>  Ou seja, independentemente do que aconteceu com o campo EXP nos cabe√ßalhos MPLS, o IP DSCP permanece inalterado. <br><br>  Esse cen√°rio pode ser usado quando o operador possui seu pr√≥prio dom√≠nio Diff-Serv e n√£o deseja que o tr√°fego do cliente o influencie de alguma forma. <br><br><h3>  Modo de tubo curto </h3><br><img src="https://habrastorage.org/web/f80/1c8/e2d/f801c8e2dac84ff1b376a5f68824d93e.png" width="1000"><br><br>  Voc√™ pode considerar esse modo como uma varia√ß√£o do modo Pipe.  A √∫nica diferen√ßa √© que, na sa√≠da da rede MPLS, o pacote √© processado de acordo com seu campo IP DSCP, n√£o MPLS EXP. <br><br>  Isso significa que a prioridade do pacote na sa√≠da √© determinada pelo cliente, n√£o pelo operador. <br>  O Ingress PE n√£o confia nos pacotes de entrada IP DSCP <br>  O Transit Ps olha no campo EXP do cabe√ßalho superior. <br>  O pen√∫ltimo P remove o r√≥tulo de transporte e copia o valor no r√≥tulo da VPN. <br>  O PE de sa√≠da remove primeiro o r√≥tulo MPLS e depois processa o pacote nas filas. <br><br>  Explica√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cisco</a> . <br></div></div><br><hr><br><h4>  Pr√°tica de classifica√ß√£o MPLS Traffic Class </h4><br>  O esquema √© o mesmo: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O arquivo de configura√ß√£o √© o mesmo.</a> <br><br>  No diagrama da rede linkmeup, h√° uma transi√ß√£o de IP para MPLS para Linkmeup_R2. <br>  Vamos ver o que acontece com a marca√ß√£o quando o ping faz <b>ping no ip 172.16.2.2 source 172.16.1.1 to 184</b> . <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/lj/at/14/ljat14wahqfc91ojgigmlrwayzo.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pcapng</a></i> <br><br>  Portanto, vemos que o r√≥tulo EF original no IP DSCP foi transformado no valor 5 do campo EXP MPLS (tamb√©m √© a classe de tr√°fego, lembre-se disso) do cabe√ßalho da VPN e do cabe√ßalho de transporte. <br>  Aqui estamos testemunhando o modo uniforme de opera√ß√£o. <br><br><hr><br><h3>  Ethernet 802.1p </h3><br>  A falta de um campo priorit√°rio no 802.3 (Ethernet) √© explicada pelo fato de o Ethernet ter sido originalmente planejado exclusivamente como uma solu√ß√£o para o segmento de LAN.  Por um dinheiro modesto, voc√™ pode obter largura de banda excessiva, e o uplink sempre ser√° um gargalo - n√£o h√° nada com o que se preocupar em priorizar. <br><br>  No entanto, logo ficou claro que a atratividade financeira do Ethernet + IP leva esse pacote aos n√≠veis de backbone e WAN.  E a coabita√ß√£o em um segmento de LAN de torrents e telefonia precisa ser resolvida. <br><br>  Felizmente, o 802.1q (VLAN) chegou a tempo para isso, no qual um campo de 3 bits (novamente) foi alocado para prioridades. <br><br>  No plano DiffServ, este campo permite definir as mesmas 8 classes de tr√°fego. <br><br><img src="https://habrastorage.org/webt/oh/_i/1l/oh_i1l1omqt1rk8agowdenx6x7o.png" width="600"><br><br><hr><br>  Ao receber um pacote, o dispositivo de rede do dom√≠nio DS, na maioria dos casos, leva em considera√ß√£o o cabe√ßalho que ele usa para alternar: <br><br><ul><li>  Comutador Ethernet - 802.1p </li><li>  N√≥ MPLS - Classe de tr√°fego MPLS </li><li>  Roteador IP - IP DSCP </li></ul><br>  Embora esse comportamento possa ser alterado: Classifica√ß√£o baseada em interface e campos m√∫ltiplos.  E √†s vezes voc√™ pode at√© dizer explicitamente no campo CoS qual cabe√ßalho procurar. <br><br><hr><br><h2>  Baseado em interface </h2><br>  Essa √© a maneira mais f√°cil de classificar pacotes na testa.  Tudo o que √© derramado na interface especificada √© marcado com uma determinada classe. <br><br>  Em alguns casos, essa granularidade √© suficiente, portanto, a interface √© usada na vida. <br><br><h4>  Pr√°tica de classifica√ß√£o baseada em interface </h4><br>  O esquema √© o mesmo: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  A configura√ß√£o de pol√≠ticas de QoS no equipamento da maioria dos fornecedores √© dividida em est√°gios. <br><br><ol><li>  Primeiro, um classificador √© definido: <br> <code>class-map match-all TRISOLARANS_INTERFACE_CM <br> match input-interface Ethernet0/2</code> <br>  Tudo o que vem √† interface Ethernet0 / 2. <br></li><li>  Em seguida, √© criada uma pol√≠tica na qual o classificador e a a√ß√£o necess√°ria est√£o associados. <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-map TRISOLARANS_REMARK <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_INTERFACE_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp cs7</code> </pre> <br>  Se o pacote atender ao classificador TRISOLARANS_INTERFACE_CM, escreva CS7 ‚Äã‚Äãno campo DSCP. <br><blockquote>  Aqui estou √† frente de mim mesmo usando CS7 obscuro e depois EF, AF.  Abaixo, voc√™ pode ler sobre essas abrevia√ß√µes e acordos aceitos.  Enquanto isso, basta saber que existem classes diferentes com diferentes n√≠veis de servi√ßo. <br></blockquote></li><li>  E o √∫ltimo passo √© aplicar a pol√≠tica √† interface: <br><br><pre> <code class="hljs pgsql"> interface Ethernet0/<span class="hljs-number"><span class="hljs-number">2</span></span> service-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> TRISOLARANS_REMARK</code> </pre> <br><blockquote>  Aqui, o classificador √© um pouco redundante, o que verificar√° se o pacote chegou √† interface e0 / 2, onde aplicamos a pol√≠tica.  Pode-se escrever como qualquer: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_INTERFACE_CM match <span class="hljs-keyword"><span class="hljs-keyword">any</span></span></code> </pre> <br>  No entanto, a pol√≠tica pode realmente ser aplicada no vlanif ou na interface de sa√≠da, portanto √© poss√≠vel. <br></blockquote><br></li></ol><br>  Execute o ping usual em 172.16.2.2 (Trisolaran2) com Trisolaran1: <br><br><img src="https://habrastorage.org/webt/sm/gh/5j/smgh5j3nxjmen6yspkxl8tu9so8.png" width="400"><br><br>  E no dump entre Linkmeup_R1 e Linkmeup_R2, veremos o seguinte: <br><br><img src="https://habrastorage.org/webt/rh/qe/6z/rhqe6z4z98dxmkcrygfpb7zboee.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pcapng</a></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Classifica√ß√£o baseada em interface do arquivo de configura√ß√£o.</a> <br><br><h2>  Campo m√∫ltiplo </h2><br>  O tipo mais comum de classifica√ß√£o na entrada do dom√≠nio DS.  N√£o confiamos na rotulagem existente e, com base nos cabe√ßalhos dos pacotes, atribu√≠mos uma classe. <br><br>  Geralmente, essa √© uma maneira de "ativar" a QoS, no caso em que os remetentes n√£o marcam. <br><br>  Uma ferramenta bastante flex√≠vel, mas ao mesmo tempo complicada - voc√™ precisa criar regras dif√≠ceis para cada classe.  Portanto, dentro do dom√≠nio DS, BA √© mais relevante. <br><br><h4>  Pr√°tica de classifica√ß√£o MF </h4><br>  O esquema √© o mesmo: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  A partir dos exemplos pr√°ticos acima, pode-se ver que os dispositivos de rede, por padr√£o, confiam na rotulagem dos pacotes recebidos. <br><br>  Isso √© bom dentro do dom√≠nio do DS, mas n√£o √© aceit√°vel no ponto de entrada. <br><br>  E agora n√£o vamos confiar cegamente?  No <b>Linkmeup_R2, o</b> ICMP ser√° rotulado como EF (apenas por exemplo), TCP como AF12 e todo o resto √© CS0. <br>  Essa ser√° a classifica√ß√£o MF (Multi-Field). <br><br><ol><li>  O procedimento √© o mesmo, mas agora faremos a correspond√™ncia de ACLs que desengatam as categorias de tr√°fego necess√°rias; portanto, primeiro as criamos. <br><br>  No Linkmeup_R2: <br><br><pre> <code class="hljs pgsql"> ip <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-list extended TRISOLARANS_ICMP_ACL permit icmp <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> ip <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-list extended TRISOLARANS_TCP_ACL permit tcp <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> ip <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-list extended TRISOLARANS_OTHER_ACL permit ip <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span></code> </pre> <br></li><li>  Em seguida, definimos os classificadores: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_TCP_CM match <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> TRISOLARANS_TCP_ACL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_OTHER_CM match <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> TRISOLARANS_OTHER_ACL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_ICMP_CM match <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> TRISOLARANS_ICMP_ACL</code> </pre> <br></li><li>  E agora definimos as regras de observa√ß√£o na pol√≠tica: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-map TRISOLARANS_ADMISSION_CONTROL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_ICMP_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp ef <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_TCP_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp af11 <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_OTHER_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp <span class="hljs-keyword"><span class="hljs-keyword">default</span></span></code> </pre> <br></li><li>  E penduramos a pol√≠tica na interface.  Na entrada, respectivamente, porque a decis√£o deve ser tomada na entrada da rede. <br><br><pre> <code class="hljs pgsql"> interface Ethernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> service-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> TRISOLARANS_ADMISSION_CONTROL</code> </pre> <br></li></ol><br>  Teste de ICMP do hospedeiro final Trisolaran1.  N√£o especificamos conscientemente a classe - o padr√£o √© 0. <br><br>  <b>J√° removi a pol√≠tica com o Linkmeup_R1, portanto o tr√°fego vem com a marca√ß√£o CS0, n√£o CS7.</b> <br><br><img src="https://habrastorage.org/webt/_f/si/90/_fsi9012_fo5a8z1x14fdtxqz0m.png" width="400"><br><br>  Aqui est√£o dois dumps nas proximidades, com Linkmeup_R1 e Linkmeup_R2: <br><br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/cp/t5/ge/cpt5gersxbcrhjsba4lz8t-5z-i.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pcapng</a></i> <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/9x/0w/j7/9x0wj7gkztleiock6vnax33m-7c.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pcapng</a></i> <br><br>  Pode-se observar que, ap√≥s os classificadores e a nova identifica√ß√£o no Linkmeup_R2 nos pacotes ICMP, n√£o apenas o DSCP mudou para EF, mas a MPLS Traffic Class tornou-se igual a 5. <br><br>  Um teste semelhante com o telnet 172.16.2.2.  80 - ent√£o verifique o TCP: <br><br><img src="https://habrastorage.org/webt/rd/f1/xo/rdf1xovczuma9nuziqbawyyuqji.png" width="400"><br><br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/-i/nr/gj/-inrgjtler0zsvt2y3hq3cxvd8m.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pcapng</a></i> <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/mk/z_/qz/mkz_qz44dywl9kr5uw3ohauu9qa.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pcapng</a></i> <br><br>  LEIA - O que √© necess√°rio esperar.  O TCP √© transmitido como AF11. <br><br>  O pr√≥ximo teste testar√° o UDP, que deve passar para CS0 de acordo com nossos classificadores.  Usaremos o iperf para isso (leve-o para o Linux Tiny Core via Apps).  No lado remoto <b>iperf3 -s</b> - inicie o servidor, no local <b>iperf3 -c -u -t1</b> - cliente ( <b>-c</b> ), protocolo UDP ( <b>-u</b> ), teste por 1 segundo ( <b>-t1</b> ). <br><br><img src="https://habrastorage.org/webt/zw/gu/sb/zwgusb4bqnq7prgq_yw5ue44pqo.png" width="400"><br><br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/rm/sx/pq/rmsxpqgca2wmuhhcu5mcnvcth7y.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pcapng</a></i> <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0</i> <br><img src="https://habrastorage.org/webt/yt/9q/gv/yt9qgv2qcqun9rpr8me4nuyghym.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pcapng</a></i> <br><br>  A partir de agora, tudo o que vier a essa interface ser√° classificado de acordo com as regras configuradas. <br><br><hr><br><h2>  Marcando dentro do dispositivo </h2><br>  Mais uma vez: na entrada para a classifica√ß√£o do dom√≠nio DS pode ocorrer MF, Interface-based ou BA. <br>  Entre os n√≥s do dom√≠nio DS, o pacote no cabe√ßalho carrega um sinal sobre a classe de servi√ßo necess√°ria e √© classificado pela BA. <br><br>  Independentemente do m√©todo de classifica√ß√£o, depois dele, o pacote recebe uma classe interna no dispositivo, de acordo com o qual √© processado.  O cabe√ßalho √© removido e o pacote vazio (sem) viaja para a sa√≠da. <br>  E na sa√≠da, a classe interna √© convertida no campo CoS do novo cabe√ßalho. <br><br>  Ou seja, T√≠tulo 1 ‚áí Classifica√ß√£o ‚áí Classe interna de servi√ßo ‚áí T√≠tulo 2. <br><br>  Em alguns casos, voc√™ precisa exibir o campo de cabe√ßalho de um protocolo no campo de cabe√ßalho de outro, por exemplo, DSCP na classe de tr√°fego. <br><br>  Isso acontece apenas atrav√©s da marca√ß√£o interna intermedi√°ria. <br><br>  Por exemplo, DSCP Header ‚áí Classifica√ß√£o ‚áí Internal Service Class ‚áí Traffic Class Header. <br><br>  Formalmente, as classes internas podem ser chamadas como voc√™ quiser, ou simplesmente numeradas, e elas possuem apenas uma determinada fila atribu√≠da a elas. <br><br>  Na profundidade em que mergulhamos neste artigo, n√£o importa como eles s√£o chamados, √© importante que um modelo de comportamento espec√≠fico seja associado a valores espec√≠ficos de campos de QoS. <br><br>  Se estamos falando de implementa√ß√µes espec√≠ficas de QoS, o n√∫mero de classes de servi√ßo que o dispositivo pode fornecer n√£o passa do n√∫mero de filas dispon√≠veis.  Freq√ºentemente, existem oito deles (sob a influ√™ncia do IPP ou, √†s vezes, por acordo n√£o escrito).  No entanto, dependendo do fornecedor, dispositivo, placa, eles podem ser mais ou menos. <br><br>  Ou seja, se houver quatro filas, as classes de servi√ßo simplesmente n√£o fazem sentido para fazer mais do que quatro. <br><br>  Vamos falar sobre isso com mais detalhes no cap√≠tulo hardware. <br><br><div class="spoiler">  <b class="spoiler_title">Se voc√™ realmente quer um pouco de especificidade ...</b> <div class="spoiler_text"><blockquote>  As tabelas abaixo podem parecer convenientes √† primeira vista no relacionamento entre os campos de QoS e as classes internas, mas s√£o um tanto enganosas ao chamar os nomes das classes PHB.  Ainda assim, PHB √© o tipo de modelo de comportamento atribu√≠do ao tr√°fego de uma determinada classe, cujo nome, grosso modo, √© arbitr√°rio. <br><br>  Portanto, consulte as tabelas abaixo com uma parcela de ceticismo (portanto, abaixo do spoiler). </blockquote><br>  <i>No exemplo da Huawei</i> .  Aqui, Service-Class √© a classe muito interna do pacote. <br><br>  Ou seja, se BA for classificado na entrada, os valores DSCP ser√£o convertidos nos valores correspondentes de Classe de servi√ßo e Cor. <br><br><img src="https://habrastorage.org/webt/h-/xh/sp/h-xhspe0wg3zymljrw4fdcd8v-u.png" width="500"><br><br>  Vale a pena prestar aten√ß√£o ao fato de que muitos valores DSCP n√£o s√£o usados ‚Äã‚Äãe os pacotes com essas marca√ß√µes s√£o realmente processados ‚Äã‚Äãcomo BE. <br><br>  Aqui est√° uma tabela de correspond√™ncia reversa que mostra quais valores de DSCP ser√£o definidos para o tr√°fego quando a sa√≠da for remarcada. <br><br><img src="https://habrastorage.org/webt/as/t4/49/ast449vrq3tmkbo_xhxoqmvayjm.png" width="500"><br><br>  Observe que apenas o AF tem uma grada√ß√£o de cores.  BE, EF, CS6, CS7 - tudo apenas verde. <br><br>  Esta √© uma tabela para converter os campos IPP, MPLS Traffic Class e 802.1p Ethernet em classes de servi√ßo internas. <br><br><img src="https://habrastorage.org/webt/d7/nz/up/d7nzupuudz6mpvapmunecfol43a.png" width="500"><br><br>  E de volta. <br><br><img src="https://habrastorage.org/webt/nc/qz/zr/ncqzzr58m-3acsu1gid9xkowfxy.png" width="500"><br><br>  Observe que qualquer informa√ß√£o sobre prioridade de descarte geralmente √© perdida aqui. <br><br>  Deve ser repetido - este √© apenas um exemplo espec√≠fico de correspond√™ncias padr√£o do fornecedor selecionado <i>aleatoriamente</i> .  Para outros, isso pode ser diferente.  Os administradores podem configurar completamente diferentes classes de servi√ßos e PHBs em suas redes. <br><br></div></div><br>  Em termos de PHB, n√£o h√° absolutamente nenhuma diferen√ßa no que √© usado para classifica√ß√£o - DSCP, Traffic Class, 802.1p. <br><br>  Dentro do dispositivo, eles se transformam em classes de tr√°fego definidas pelo administrador da rede. <br>  Ou seja, todas essas marca√ß√µes s√£o uma maneira de dizer aos vizinhos qual classe de servi√ßo eles devem atribuir a este pacote.  √â como a Comunidade BGP, que n√£o significa nada por si s√≥, at√© que a pol√≠tica para interpret√°-los seja definida na rede. <br><br><hr><br><h2>  Recomenda√ß√µes da IETF (categorias de tr√°fego, classes de servi√ßo e comportamentos) </h2><br>  Os padr√µes n√£o padronizam em absoluto quais classes de servi√ßo espec√≠ficas devem existir, como classific√°-las e rotul√°-las e qual PHB aplicar a elas. <br><br>  Isso est√° √† merc√™ de fornecedores e administradores de rede. <br><br>  Temos apenas 3 bits - usamos como queremos. <br><br>  Isso √© bom: <br><br><ul><li>  Cada pe√ßa de ferro (fornecedor) escolhe independentemente quais mecanismos usar para PHB - sem sinaliza√ß√£o, sem problemas de compatibilidade. </li><li>  O administrador de cada rede pode distribuir de forma flex√≠vel o tr√°fego entre diferentes classes, escolher as pr√≥prias classes e o PHB correspondente. </li></ul><br>  Isso √© ruim: <br><br><ul><li>  Nos limites dos dom√≠nios do DS, surgem problemas de convers√£o. </li><li>  Em condi√ß√µes de total liberdade de a√ß√£o - alguns est√£o na floresta, outros s√£o dem√¥nios. </li></ul><br>  Portanto, a IETF em 2006 publicou um manual de treinamento sobre como abordar a diferencia√ß√£o de servi√ßo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 4594</a> ( <i>Diretrizes de configura√ß√£o para as classes de servi√ßo DiffServ</i> ). <br><br>  A seguir, √© apresentado um breve resumo desta RFC. <br><br><h3>  Modelos de comportamento (PHB) </h3><br>  <b>DF - Encaminhamento padr√£o</b> <br>  <i>Remessa padr√£o.</i> <br>  Se um modelo de tr√°fego n√£o receber um modelo de comportamento espec√≠fico, ele ser√° processado usando o encaminhamento padr√£o. <br><br>  Este √© o melhor esfor√ßo - o dispositivo far√° todo o poss√≠vel, mas n√£o garante nada.  Quedas, desordens, atrasos imprevis√≠veis e instabilidade flutuante s√£o poss√≠veis, mas isso n√£o √© exato. <br><br>  Este modelo √© adequado para aplicativos pouco exigentes, como downloads de correio ou arquivo. <br>  A prop√≥sito, h√° PHB e ainda menos definido - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um esfor√ßo menor</a> . <br><br>  <b>AF - Encaminhamento garantido</b> <br>  <i>Expedi√ß√£o garantida.</i> <br>  Este √© um BE melhorado.  Algumas garantias aparecem aqui, por exemplo, bandas.  Quedas e atrasos flutuantes ainda s√£o poss√≠veis, mas em uma extens√£o muito menor. <br><br>  O modelo √© adequado para multim√≠dia: streaming, videoconfer√™ncia, jogos online. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 2597</a> ( <i>Grupo PHB de Encaminhamento Assegurado</i> ). <br><br>  <b>EF - Encaminhamento acelerado</b> <br>  <i>Remessa de emerg√™ncia.</i> <br>  Todos os recursos e prioridades correm aqui.  Este √© um modelo para aplicativos que n√£o precisam de perdas, pequenos atrasos, instabilidade est√°vel, mas n√£o s√£o gananciosos para a banda.  Como, por exemplo, telefonia ou servi√ßo de emula√ß√£o de fio (CES - Circuit Emulation Service). <br><br>  Perdas, desordens e atrasos flutuantes na FE s√£o extremamente improv√°veis. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 3246</a> ( <i>um PHB de encaminhamento acelerado</i> ). <br><br>  <b>CS - Seletor de Classes</b> <br>  Esses s√£o comportamentos projetados para manter a compatibilidade com a preced√™ncia de IP em redes capazes de DS. <br><br>  As seguintes classes existem no IPP: CS0, CS1, CS2, CS3, CS4, CS5, CS6, CS7. <br>  Nem sempre para todos eles existe um PHB separado, geralmente existem dois ou tr√™s, e o restante √© simplesmente traduzido para a classe DSCP mais pr√≥xima e obt√©m o PHB correspondente. <br>  Por exemplo, um pacote rotulado CS 011000 pode ser classificado como 011010. <br><br>  Do CS, certamente apenas CS6, CS7, que s√£o recomendados para o NCP - Network Control Protocol e requerem um PHB separado, s√£o preservados no equipamento. <br><br>  Assim como a EF, o PHB CS6.7 foi desenvolvido para classes com requisitos de lat√™ncia e perda muito altos, mas que s√£o tolerantes √† discrimina√ß√£o de banda. <br>  A tarefa do PHB para CS6.7 √© fornecer um n√≠vel de servi√ßo que elimine quedas e atrasos, mesmo em caso de sobrecarga extrema da interface, chip e filas. <br><hr><br><br>  √â importante entender que o PHB √© um conceito abstrato - e, de fato, eles s√£o implementados atrav√©s de mecanismos dispon√≠veis em equipamentos reais. <br><br>  Assim, o mesmo PHB definido no dom√≠nio DS pode diferir no Juniper e na Huawei. <br><br>  Al√©m disso, um √∫nico PHB n√£o √© um conjunto est√°tico de a√ß√µes; por exemplo, um PHB AF pode consistir em v√°rias op√ß√µes que diferem no n√≠vel de garantias (banda, atrasos aceit√°veis). <br><br><hr><br><h3>  Classes de servi√ßo </h3><br>  A IETF cuidou dos administradores e identificou as principais categorias de aplicativos e suas classes de servi√ßo. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o estarei detalhado aqui, basta inserir algumas placas desta RFC de orienta√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Categorias de aplicativos: </font></font><br><br><img src="https://habrastorage.org/webt/an/hr/np/anhrnppkfmebfm7vaoarb1xv7s0.png" width="600"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requisitos para caracter√≠sticas da rede: </font></font><br><br><img src="https://habrastorage.org/webt/ih/5r/z2/ih5rz2jw4ifygst1mjgte9a_vc0.png" width="560"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, finalmente, nomes de classes recomendados e valores DSCP correspondentes: </font></font><br><br><img src="https://habrastorage.org/webt/jg/rp/4k/jgrp4kzhhhvz1-zygrsiexieeyy.png" width="560"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">combinando as classes acima de maneiras diferentes (para se ajustarem √†s 8 dispon√≠veis), voc√™ pode obter solu√ß√µes de QoS para redes diferentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Talvez o mais comum seja o seguinte: a </font></font><br><br><img src="https://habrastorage.org/webt/su/ft/ed/suftedkuzswznewqbj3uslcncru.png" width="560"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe DF (ou BE) marca tr√°fego absolutamente pouco exigente - recebe aten√ß√£o residual. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O PHB AF atende √†s classes AF1, AF2, AF3, AF4. Todos eles precisam fornecer uma faixa, em detrimento de atrasos e perdas. As perdas s√£o controladas pelos bits de Drop Precedence, e √© por isso que s√£o chamados AFxy, onde x √© a classe de servi√ßo e y √© Drop Precedence.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A EF precisa de algum tipo de garantia m√≠nima de banda, mas mais importante - uma garantia de atrasos, instabilidade e nenhuma perda. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O CS6, o CS7 exigem ainda menos largura de banda, porque esse √© um conjunto de pacotes de servi√ßos nos quais ainda s√£o poss√≠veis explos√µes (atualiza√ß√£o do BGP, por exemplo), mas perdas e atrasos s√£o inaceit√°veis ‚Äã‚Äã- qual √© o uso do BFD com um temporizador de 10 ms se o Hello travar Filas de 100 ms? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, 4 das 8 aulas dispon√≠veis foram ministradas sob AF. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E, apesar de geralmente fazerem exatamente isso, repito que essas s√£o apenas recomenda√ß√µes e nada impede que tr√™s classes no seu dom√≠nio DS atribuam EF e apenas duas √† AF.</font></font><br><br><hr><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Resumo da Classifica√ß√£o </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na entrada de um n√≥, um pacote √© classificado com base em uma interface, MF ou sua rotulagem (BA). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rotular √© o valor dos campos DSCP no IPv4, na Classe de Tr√°fego no IPv6 e no MPLS ou 802.1p no 802.1q. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem 8 classes de servi√ßo que agregam v√°rias categorias de tr√°fego. Cada classe recebe seu pr√≥prio PHB, atendendo aos requisitos da classe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De acordo com as recomenda√ß√µes da IETF, s√£o distinguidas as seguintes classes de servi√ßo: CS1, CS0, AF11, AF12, AF13, AF21, CS2, AF22, AF23, CS3, AF31, AF32, AF33, CS33, CS41, AF41, AF42, AF43, CS5, EF, CS6, CS7 na crescente import√¢ncia do tr√°fego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nelas, voc√™ pode escolher uma combina√ß√£o de 8, que pode realmente ser codificada nos campos CoS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A combina√ß√£o mais comum: CS0, AF1, AF2, AF3, AF4, EF, CS6, CS7 com 3 grada√ß√µes de cores para AF.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A cada classe √© atribu√≠do um PHB, dos quais existem 3 - Encaminhamento padr√£o, Encaminhamento garantido, Encaminhamento acelerado em ordem crescente de gravidade. </font><font style="vertical-align: inherit;">Um pouco √† parte √© o seletor de classe PHB. </font><font style="vertical-align: inherit;">Cada PHB pode variar de acordo com os par√¢metros da ferramenta, mas mais sobre isso posteriormente.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em uma rede descarregada, a QoS n√£o √© necess√°ria, disseram eles. </font><font style="vertical-align: inherit;">Quaisquer problemas de QoS s√£o resolvidos expandindo os links, disseram eles. </font><font style="vertical-align: inherit;">Com Ethernet e DWDM, nunca enfrentamos congestionamentos de linha, disseram eles. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eles s√£o aqueles que n√£o entendem o que √© QoS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas a realidade atinge a VPN no ILV.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nem em todo lugar h√° √≥ptica. </font><font style="vertical-align: inherit;">RRL √© a nossa realidade. </font><font style="vertical-align: inherit;">√Äs vezes, no momento do acidente (e n√£o apenas) no estreito link de r√°dio, deseja rastrear todo o tr√°fego da rede.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Explos√µes de tr√°fego s√£o a nossa realidade. </font><font style="vertical-align: inherit;">Explos√µes de tr√°fego a curto prazo enfileiram-se facilmente, for√ßando a queda dos pacotes muito necess√°rios.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telefonia, videoconfer√™ncia, jogos online s√£o a nossa realidade. </font><font style="vertical-align: inherit;">Se a fila estiver pelo menos um pouco ocupada, os atrasos come√ßar√£o a dan√ßar.</font></font></li></ol><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na minha pr√°tica, houve exemplos em que a telefonia se transformou em c√≥digo Morse em uma rede carregada em n√£o mais de 40%. </font><font style="vertical-align: inherit;">Apenas marc√°-lo novamente na EF resolveu o problema momentaneamente.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √â hora de lidar com ferramentas que permitem fornecer servi√ßos diferentes para diferentes classes. </font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ferramentas PHB </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Na verdade, existem apenas tr√™s grupos de ferramentas de QoS que manipulam ativamente os pacotes: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Preven√ß√£o de congestionamento - o que fazer para n√£o ser ruim. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gerenciamento de congestionamento - o que fazer quando j√° estiver ruim. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Limite de taxa - como n√£o colocar mais na rede do que deveria ser e n√£o liberar o m√°ximo que n√£o pode aceitar. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mas todos, em geral, seriam in√∫teis se n√£o fosse a fila. </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5. Filas </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No parque de divers√µes, voc√™ n√£o pode dar prioridade a algu√©m se n√£o organizar uma fila separada para quem pagou mais. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A mesma situa√ß√£o nas redes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se todo o tr√°fego estiver em uma fila, voc√™ n√£o poder√° extrair pacotes importantes do meio para dar prioridade a eles. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â por isso que, ap√≥s a classifica√ß√£o, os pacotes s√£o colocados na fila correspondente a esta classe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ent√£o uma fila (com dados de voz) se mover√° rapidamente, mas com uma banda limitada, outra mais lenta (streaming), mas com uma banda larga, e alguns recursos seguir√£o o princ√≠pio residual. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas dentro dos limites de cada fila separada, a mesma regra se aplica - voc√™ n√£o pode extrair um pacote do meio - apenas a partir da cabe√ßa.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada fila tem um certo comprimento limitado. Por um lado, isso √© ditado pelas limita√ß√µes de hardware e, por outro lado, n√£o faz sentido manter os pacotes na fila por muito tempo. Um pacote VoIP n√£o √© necess√°rio se houver atraso de 200 ms. O TCP solicitar√° o encaminhamento, condicionalmente, ap√≥s o t√©rmino do RTT (configurado em sysctl). Portanto, largar nem sempre √© ruim. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os desenvolvedores e designers de equipamentos de rede precisam encontrar um compromisso entre as tentativas de salvar o pacote o m√°ximo poss√≠vel e, pelo contr√°rio, evitar desperdi√ßar largura de banda, tentando entregar o pacote que n√£o √© mais necess√°rio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em uma situa√ß√£o normal, quando a interface / chip n√£o est√° sobrecarregada, a utiliza√ß√£o do buffer √© pr√≥xima de zero. Eles absorvem rajadas de curto prazo, mas isso n√£o causa seu enchimento prolongado.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se houver mais tr√°fego do que o chip de comuta√ß√£o ou a interface de sa√≠da pode suportar, as filas come√ßar√£o a se encher. </font><font style="vertical-align: inherit;">E a utiliza√ß√£o cr√¥nica acima de 20 a 30% j√° √© uma situa√ß√£o que precisa ser tratada.</font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Evitar Congestionamentos </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na vida de qualquer roteador, chega um momento em que a fila est√° cheia. </font><font style="vertical-align: inherit;">Onde colocar o pacote, se definitivamente n√£o houver lugar para coloc√°-lo - isso √© tudo, o buffer acabou e ele n√£o estar√° l√°, mesmo que seja bom visual, mesmo que voc√™ pague extra. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° duas maneiras: descartar este pacote ou aquelas que j√° marcaram o turno. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se eles j√° estiverem na fila, considere o que est√° faltando. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E se este, ent√£o considere que ele n√£o veio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essas duas abordagens s√£o chamadas de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drop Tail</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Head Drop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cauda da cauda e queda da cabe√ßa </font></font></h2><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tail Drop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o mecanismo mais simples de gerenciamento de filas - descarte todos os pacotes rec√©m-chegados que n√£o cabem no buffer. </font></font><br><br><img src="https://habrastorage.org/webt/gu/qu/lv/guqulvedyuzoyytzzbybxrzua9g.png" width="500"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Head Drop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> descarta pacotes que est√£o na fila h√° muito tempo. √â melhor jog√°-los fora do que economizar, porque eles provavelmente s√£o in√∫teis. Mas os pacotes mais relevantes que chegaram ao final da fila ter√£o mais chances de chegar a tempo. Al√©m disso, o Head Drop permite que voc√™ n√£o carregue a rede com pacotes desnecess√°rios. Naturalmente, os pacotes mais antigos s√£o aqueles que est√£o no in√≠cio da fila, da√≠ o nome da abordagem.</font></font><br><br><img src="https://habrastorage.org/webt/6h/0d/rq/6h0drqorglxgq9mjocqjm_bpwby.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Head Drop tem outra vantagem n√£o √≥bvia - se voc√™ soltar o pacote no in√≠cio da fila, o destinat√°rio descobrir√° rapidamente o congestionamento na rede e informar√° o remetente. No caso de Tail Drop, as informa√ß√µes sobre o pacote descartado chegar√£o, possivelmente, centenas de milissegundos depois - at√© que ele chegue do final da linha at√© a cabe√ßa dela. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ambos os mecanismos trabalham com diferencia√ß√£o por sua vez. Na verdade, n√£o √© necess√°rio que todo o buffer esteja cheio. Se a segunda fila estiver vazia e a zero nos globos oculares, somente os pacotes do zero ser√£o descartados. </font></font><br><br><img src="https://habrastorage.org/webt/as/nl/l7/asnll7xgflrxk_mvdxgmglgf2fm.png" width="400"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tail Drop e Head Drop podem funcionar simultaneamente.</font></font><br><br><img src="https://habrastorage.org/webt/bn/n1/wv/bnn1wvl9qene8f4xysetig6hemg.png" width="500"><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cauda e queda da cabe√ßa s√£o ‚Äútesta‚Äù para evitar congestionamentos. Voc√™ pode at√© dizer - essa √© a aus√™ncia dele. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o fazemos nada at√© que a fila esteja 100% cheia. E depois disso, come√ßamos a descartar todos os pacotes rec√©m-chegados (ou atrasados ‚Äã‚Äãpor um longo tempo). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ n√£o precisa fazer nada para atingir a meta, em algum lugar h√° uma nuance. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E essa nuance √© o TCP. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lembre-se (de forma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mais profunda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extremamente profunda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) de como o TCP funciona - estamos falando de implementa√ß√µes modernas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existe uma janela deslizante (janela deslizante ou </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rwnd - janela anunciada</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do destinat√°rio), que o destinat√°rio controla, informando ao remetente quanto pode ser enviado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E h√° uma janela de sobrecarga ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWND - Janela de congestionamento</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), que responde a problemas de rede e √© controlado pelo remetente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O processo de transfer√™ncia de dados come√ßa com um in√≠cio lento ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slow Start</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) com um aumento exponencial no CWND. Com cada segmento confirmado, 1 tamanho de MSS √© adicionado ao CWND, ou seja, ele dobra em um tempo igual ao RTT (dados l√°, ACK de volta) (Discurso sobre Reno / NewReno).</font></font><br><br>  Por exemplo <br><br><img src="https://habrastorage.org/webt/5n/5a/nd/5n5andpbm8lvmyeaio0i565c_ek.png" width="200"><br><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crescimento </font><u><font style="vertical-align: inherit;">exponencial</font></u><font style="vertical-align: inherit;"> continua at√© um valor chamado </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssthreshold</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Slow Start Threshold), especificado na configura√ß√£o de TCP no host. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, um </font><font style="vertical-align: inherit;">crescimento </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linear</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de 1 / CWND come√ßa para cada segmento confirmado at√© que repouse contra o RWND ou o in√≠cio das perdas (a perda √© confirmada por re-confirma√ß√£o (ACK duplicada) ou nenhuma confirma√ß√£o). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim que uma perda de segmento √© detectada, ocorre o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP Backoff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o TCP reduz drasticamente a janela, na verdade reduzindo a velocidade de envio - e o mecanismo de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recupera√ß√£o r√°pida</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© iniciado </font><font style="vertical-align: inherit;">:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enviar segmentos perdidos (retransmiss√£o r√°pida), </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a janela √© dobrada para baixo, </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O valor ssthreshold tamb√©m se torna igual √† metade da janela alcan√ßada, </font></font></li><li><font style="vertical-align: inherit;"></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crescimento </font><u><font style="vertical-align: inherit;">linear</font></u><font style="vertical-align: inherit;"> recome√ßa </font><font style="vertical-align: inherit;">at√© a primeira perda,</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Repita. </font></font></li></ol><br><img src="https://habrastorage.org/webt/of/0p/ar/of0park6tnishwa25_v_dgzwaya.png" width="700"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perda pode significar o colapso completo de um segmento de rede e, em seguida, considerar que est√° perdido, ou congestionamento na linha (leia o estouro do buffer e descartar um segmento desta sess√£o). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este √© o m√©todo do TCP de maximizar a utiliza√ß√£o da largura de banda dispon√≠vel e lidar com o congestionamento. </font><font style="vertical-align: inherit;">E √© bastante eficaz. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, o que leva o Tail Drop?</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digamos que atrav√©s de um roteador esteja o caminho de milhares de sess√µes TCP. </font><font style="vertical-align: inherit;">Em algum momento, o tr√°fego da sess√£o atingiu 1,1 Gb / s, velocidade da interface de sa√≠da - 1 Gb / s.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tr√°fego vem mais r√°pido do que as folhas, os buffers s√£o preenchidos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vsklyan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O Drop Drop √© ativado at√© o expedidor extrair alguns pacotes da fila. </font></font></li><li>           Fast Recovery (    Slow Start). </li><li>    ,  , Tail Drop . </li><li>   TCP-  ,          . </li><li>  . </li><li> Fast Recovery/Slow Start. </li><li> . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saiba mais sobre as altera√ß√µes nos mecanismos TCP no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 2001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in√≠cio lento do TCP, preven√ß√£o de congestionamentos, retransmiss√£o r√°pida e algoritmos de recupera√ß√£o r√°pida</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta √© uma ilustra√ß√£o t√≠pica de uma situa√ß√£o chamada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sincroniza√ß√£o Global de TCP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/wr/co/oq/wrcooqd2fjrix9jbimh-8si97h4.png" width="500"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Global,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> porque muitas sess√µes estabelecidas atrav√©s deste n√≥ sofrem. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sincroniza√ß√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , porque eles sofrem ao mesmo tempo. E a situa√ß√£o ser√° repetida at√© que haja uma sobrecarga. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - porque o UDP, que n√£o possui mecanismos de controle de congestionamento, n√£o √© afetado por ele.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nada de ruim teria acontecido nessa situa√ß√£o se n√£o tivesse causado o uso sub√≥timo da tira - os espa√ßos entre os dentes da serra - o dinheiro desperdi√ßado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O segundo problema √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP Starvation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - esgotamento de TCP. Enquanto o TCP diminui a velocidade para reduzir a carga (n√£o sejamos astutos - antes de tudo, para transmitir com seguran√ßa nossos dados), o UDP, todo esse sofrimento moral em geral pelo datagrama - envia o m√°ximo poss√≠vel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, a quantidade de tr√°fego TCP √© reduzida e o UDP est√° aumentando (possivelmente), o pr√≥ximo ciclo de Recupera√ß√£o Perda - R√°pida acontece em um limite mais baixo. O UDP ocupa espa√ßo. A quantidade total de tr√°fego TCP cai.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como resolver o problema, √© melhor evit√°-lo. </font><font style="vertical-align: inherit;">Vamos tentar reduzir a carga antes que ela preencha a fila usando o Fast Recovery / Slow Start, que acaba de ser contra n√≥s.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RED - Detec√ß√£o Precoce Aleat√≥ria </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas e se pegarmos e espalharmos gotas em alguma parte do buffer? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em termos relativos, comece a descartar pacotes aleat√≥rios quando a fila estiver 80% cheia, for√ßando algumas sess√µes TCP a reduzir a janela e, consequentemente, a velocidade. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E se a fila estiver 90% cheia, come√ßamos a eliminar aleatoriamente 50% dos pacotes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">90% - a probabilidade aumenta para Tail Drop (100% dos novos pacotes s√£o descartados). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os mecanismos que implementam esse gerenciamento de filas s√£o chamados </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AQM - Gerenciamento de Filas Adaptativo (ou Ativo) .√â</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assim que o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RED</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> funciona </font><font style="vertical-align: inherit;">. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detec√ß√£o Antecipada</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - corrige sobrecarga potencial; </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aleat√≥rio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - descarte pacotes aleatoriamente.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Äs vezes, eles decodificam o RED (na minha opini√£o, semanticamente mais corretamente), como o Random Early Discard. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graficamente, fica assim: </font></font><br><br><img src="https://habrastorage.org/webt/1n/zs/5v/1nzs5vsexsokkaepdxe_mo-klsg.png" width="600"><br><br><img src="https://habrastorage.org/webt/lp/rl/m7/lprlm7iiurfwklhdnun20iqdoci.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At√© que o buffer esteja 80% cheio, os pacotes n√£o s√£o descartados - a probabilidade √© de 0%. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De 80 a 100 pacotes come√ßam a ser descartados e, quanto mais, maior o preenchimento da fila. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, a porcentagem cresce de 0 a 30. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um efeito colateral do RED √© que as sess√µes TCP agressivas s√£o mais propensas a desacelerar, simplesmente porque h√° muitos pacotes e √© mais prov√°vel que sejam descartadas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A inefici√™ncia do uso da tira RED resolve entorpecendo uma parte muito menor das sess√µes sem causar um rebaixamento t√£o s√©rio entre os dentes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exatamente pelo mesmo motivo, o UDP n√£o pode ocupar tudo.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WRED - Detec√ß√£o precoce aleat√≥ria ponderada </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas na audi√™ncia de todos, provavelmente, ainda </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WRED</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O astuto leitor do linkmeup j√° sugeriu que este √© o mesmo RED, mas que pesa em turnos. E ele n√£o estava certo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O RED opera dentro da mesma fila. N√£o faz sentido olhar para a EF se o BE estiver cheio. Consequentemente, pesar em turnos n√£o trar√° nada. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui Drop Precedence simplesmente funciona. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E dentro da mesma fila, pacotes com prioridade de queda diferente ter√£o curvas diferentes. Quanto menor a prioridade, maior a probabilidade de ser atingida. </font></font><br><br><img src="https://habrastorage.org/webt/ef/rg/_v/efrg_vx4xacb4uwjrkvcdutemho.png" width="600"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem tr√™s curvas aqui: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vermelho - tr√°fego com menos prioridade (em termos de queda), amarelo - mais, verde - m√°ximo.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tr√°fego vermelho come√ßa a ser descartado quando o buffer est√° 20% cheio, de 20 a 40 cai para 20% e depois o Tail Drop. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O amarelo come√ßa mais tarde - de 30 a 50 √© descartado em at√© 10%, depois - Tail Drop. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O verde √© o menos suscet√≠vel: de 50 a 100 cresce suavemente para 5%. Em seguida √© Tail Drop. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No caso do DSCP, pode ser AF11, AF12 e AF13, respectivamente verde, amarelo e vermelho. </font></font><br><br><img src="https://habrastorage.org/webt/jv/jm/9q/jvjm9qul8wyhrhncvx8iylnbl5s.png" width="600"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â muito importante aqui que ele funcione com o TCP e n√£o seja absolutamente aplic√°vel ao UDP. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou um aplicativo usando UDP ignora perdas, como no caso de telefonia ou streaming de v√≠deo, e isso afeta negativamente o que o usu√°rio v√™.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou o pr√≥prio aplicativo controla a entrega e solicita que voc√™ reenvie o mesmo pacote. No entanto, ele n√£o precisa pedir √† fonte para baixar a taxa de transmiss√£o. E, em vez de reduzir a carga, um aumento √© devido √†s retransmiss√µes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â por isso que apenas Tail Drop √© usado para EF. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para CS6, CS7, o Tail Drop tamb√©m √© usado, pois n√£o h√° altas velocidades assumidas e o WRED n√£o resolver√° nada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para AF, WRED √© aplicado. AFxy, em que x √© a classe do servi√ßo, ou seja, a fila na qual ele cai e y √© a prioridade de descarte - da mesma cor. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para o BE, a decis√£o √© tomada com base no tr√°fego prevalecente nessa fila.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dentro de um √∫nico roteador, √© usada a rotulagem interna especial de pacotes, diferente daquela que carrega os cabe√ßalhos. </font><font style="vertical-align: inherit;">Portanto, MPLS e 802.1q, onde n√£o √© poss√≠vel codificar a Preced√™ncia de descarte, podem ser processados ‚Äã‚Äãem filas com prioridades de descarte diferentes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, um pacote MPLS chegou a um n√≥, n√£o possui rotulagem de Preced√™ncia da gota, no entanto, de acordo com os resultados do polimento, ficou amarelo e pode ser descartado antes de ser colocado na fila (que pode ser determinada pelo campo Classe de tr√°fego). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vale lembrar que todo esse arco-√≠ris existe apenas dentro do n√≥. </font><font style="vertical-align: inherit;">N√£o h√° conceito de cor na linha entre vizinhos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embora seja poss√≠vel, √© claro, codificar cores na parte Preced√™ncia de descarte do DSCP.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As gotas tamb√©m podem aparecer em uma rede descarregada, onde parece que n√£o deve haver excesso de fila. </font></font> Como <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A raz√£o para isso pode ser rajadas curtas - rajadas - de tr√°fego. </font><font style="vertical-align: inherit;">O exemplo mais simples - 5 aplicativos ao mesmo tempo decidiram transferir tr√°fego para um host final. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um exemplo √© mais complicado - o remetente √© conectado via interface de 10 Gb / se o receptor √© de 1 Gb / s. </font><font style="vertical-align: inherit;">O pr√≥prio ambiente permite criar pacotes mais rapidamente no remetente. </font><font style="vertical-align: inherit;">O controle de fluxo Ethernet do receptor solicita que o host mais pr√≥ximo desacelere e os pacotes come√ßam a se acumular nos buffers.</font></font><br></blockquote><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bem, o que fazer quando tudo piorar? </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. Gerenciamento de congestionamentos </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando tudo est√° ruim, a prioridade do processamento deve ser dada ao tr√°fego mais importante. A import√¢ncia de cada pacote √© determinada na fase de classifica√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas o que √© ruim? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nem todos os buffers precisam estar obstru√≠dos para que os aplicativos comecem a ter problemas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O exemplo mais simples s√£o os pacotes de voz, que se aglomeram em pacotes grandes de pacotes grandes de um aplicativo que est√£o baixando um arquivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso aumentar√° o atraso, arruinar√° a instabilidade e possivelmente causar√° quedas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, temos problemas em fornecer servi√ßos de qualidade na aus√™ncia de congestionamento real. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esse problema foi projetado para resolver o mecanismo de gerenciamento de congestionamentos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tr√°fego de diferentes aplicativos √© dividido em filas, como vimos acima.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas somente como resultado, tudo deve se fundir novamente em uma interface. </font><font style="vertical-align: inherit;">A serializa√ß√£o ainda acontece sequencialmente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como filas diferentes conseguem fornecer diferentes n√≠veis de servi√ßos? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remova pacotes de diferentes filas de maneiras diferentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O expedidor est√° envolvido nisso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hoje consideraremos a maioria dos despachantes, come√ßando pelo mais simples:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FIFO - apenas uma linha, tudo em BE, C - injusti√ßa. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PQ - o caminho para os oligarcas, lacaios ceder. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FQ - todos s√£o iguais. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DWRR - todos s√£o iguais, mas alguns s√£o mais uniformes. </font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FIFO - Primeiro a entrar, primeiro a sair </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O caso mais simples, de fato a aus√™ncia de QoS, √© que todo o tr√°fego √© tratado da mesma maneira - em uma fila. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os pacotes deixam a fila exatamente na ordem em que chegaram, da√≠ o nome: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primeiro inserido - primeiro e esquerdo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O FIFO n√£o √© um despachante no sentido completo da palavra, nem um mecanismo DiffServ em geral, uma vez que na verdade n√£o separa classes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a fila come√ßar a encher, os atrasos e a instabilidade come√ßarem a aumentar, voc√™ n√£o poder√° gerenci√°-los, porque n√£o poder√° extrair um pacote importante do meio da fila. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sess√µes agressivas de TCP com um tamanho de pacote de 1.500 bytes podem ocupar a fila inteira, causando pequenos pacotes de voz. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No FIFO, todas as classes s√£o mescladas no CS0.</font></font><br><br><img src="https://habrastorage.org/webt/am/-w/0k/am-w0kosnvx3ucg3qpdbnou1blk.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, apesar de todas essas defici√™ncias, √© assim que a Internet agora funciona. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maioria dos fornecedores FIFO agora √© o despachante padr√£o com uma fila para todo o tr√°fego de tr√¢nsito e mais um para pacotes de servi√ßos gerados localmente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â simples, √© extremamente barato. Se os canais s√£o amplos e h√° pouco tr√°fego, tudo est√° bem. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A quintess√™ncia da id√©ia de que a QoS - para os pobres - expande a banda, e os clientes ficam satisfeitos, e seu sal√°rio aumentar√° em v√°rios. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Somente assim os equipamentos de rede funcionavam uma vez. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas muito em breve o mundo se viu diante do fato de que simplesmente n√£o daria certo.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com a tend√™ncia de redes convergentes, ficou claro que diferentes tipos de tr√°fego (servi√ßo, voz, multim√≠dia, navega√ß√£o na Internet, compartilhamento de arquivos) t√™m requisitos de rede fundamentalmente diferentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O FIFO n√£o era suficiente, ent√£o eles criaram v√°rias filas e come√ßaram a produzir esquemas de agendamento de tr√°fego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, o FIFO nunca sai de nossas vidas: dentro de cada uma das filas, os pacotes s√£o sempre processados ‚Äã‚Äãde acordo com o princ√≠pio do FIFO.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PQ - Enfileiramento priorit√°rio </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O segundo mecanismo mais complicado e a tentativa de dividir o servi√ßo em classes √© uma </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fila de prioridade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tr√°fego agora est√° disposto em v√°rias filas de acordo com sua prioridade de classe (por exemplo, embora n√£o necessariamente, o mesmo BE, AF1-4, EF, CS6-7). O expedidor passa por uma fila ap√≥s a outra. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, ele pula todos os pacotes da fila de maior prioridade, depois de menos e depois de menos.</font></font> E assim em um c√≠rculo. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O expedidor n√£o come√ßa a recuperar pacotes de baixa prioridade at√© que a fila de alta prioridade esteja vazia. </font></font><br><br><img src="https://habrastorage.org/webt/4g/l0/sl/4gl0slzp0q6kybjw14xpvvs5xt0.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se, no momento do processamento de pacotes de baixa prioridade, um pacote chegar em uma fila de prioridade mais alta, o despachante muda para ele e somente ap√≥s o esvaziamento retorna aos outros. </font></font><br><br><img src="https://habrastorage.org/webt/xm/qk/v1/xmqkv1cbt_uidd4yj1nntt2jehq.gif"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O PQ funciona quase t√£o bem quanto o FIFO. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â √≥timo para tipos de tr√°fego como pacotes de protocolo e voz, onde os atrasos s√£o cr√≠ticos e o volume total n√£o √© muito grande. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, voc√™ deve admitir que n√£o deve manter o BFD Hello devido ao fato de v√°rios v√≠deos grandes do YouTube terem chegado? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas aqui est√° a falta de PQ - se a fila de prioridade estiver carregada com tr√°fego, o despachante nunca mudar√° para outros.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E se algum Doutor Mal, em busca de m√©todos para conquistar o mundo, decide marcar todo o seu tr√°fico de vil√µes com a maior marca negra, todos os outros esperam obedientemente e depois s√£o descartados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m n√£o √© necess√°rio falar sobre uma faixa garantida para cada linha. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As filas de alta prioridade podem ser cortadas pela velocidade do tr√°fego processado nelas. </font><font style="vertical-align: inherit;">Ent√£o outros n√£o morrer√£o de fome. </font><font style="vertical-align: inherit;">No entanto, controlar isso n√£o √© f√°cil.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os mecanismos a seguir passam por todas as filas, retirando uma certa quantidade de dados, proporcionando condi√ß√µes mais honestas. </font><font style="vertical-align: inherit;">Mas eles fazem isso de maneira diferente.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FQ-Fair Queuing </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O pr√≥ximo candidato ao papel de despachante ideal s√£o os </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mecanismos justos de enfileiramento</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FQ - Fila justa </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sua hist√≥ria come√ßou em 1985, quando John Nagle sugeriu a cria√ß√£o de uma fila para cada fluxo de dados. Em esp√≠rito, isso se aproxima da abordagem do IntServ e √© facilmente explicado pelo fato de que a id√©ia de classes de servi√ßo, como o DiffServ, n√£o existia na √©poca. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O FQ extraiu a mesma quantidade de dados de cada fila em ordem. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Honestidade reside no fato de que o expedidor </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> opera com o n√∫mero de </font><b><font style="vertical-align: inherit;">pacotes, mas com o n√∫mero de bits</font></b><font style="vertical-align: inherit;"> que podem ser transmitidos de cada fila. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, um fluxo TCP agressivo n√£o pode inundar a interface e todos obt√™m oportunidades iguais. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em teoria. O FQ nunca foi implementado na pr√°tica como um mecanismo para despachar filas em equipamentos de rede. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem tr√™s desvantagens:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O primeiro - √≥bvio - √© muito caro - iniciar uma fila para cada fluxo, contar o peso de cada pacote e sempre se preocupar com os bits a serem ignorados e o tamanho do pacote. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O segundo - menos √≥bvio - todos os threads obt√™m oportunidades iguais em termos de largura de banda. E se eu quero desigual? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A terceira honestidade - n√£o √≥bvia - do QF √© absoluta: todo mundo tem atrasos iguais, mas existem t√≥picos que s√£o mais importantes que o atraso do que a banda. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, entre os 256 fluxos, existem os de voz, o que significa que cada um deles alcan√ßar√° apenas 256 segmentos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E o que fazer com eles n√£o √© claro. </font></font><br><br><img src="https://habrastorage.org/webt/o_/cg/au/o_cgau4ggmorq1cj28jn3hf26iq.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui voc√™ pode ver que, devido ao grande tamanho do pacote no terceiro est√°gio, nos dois primeiros ciclos processamos um pacote dos dois primeiros.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A descri√ß√£o dos mecanismos bit a bit de Round Robin e GPS j√° est√° al√©m do escopo deste artigo e refiro o leitor a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um estudo independente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WFQ - Fila justa ponderada </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A segunda e parte terceira falhas do QF tentaram encerr√°-lo, publicado em 1989. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada fila era dotada de peso e, consequentemente, do direito de distribuir tr√°fego em m√∫ltiplos de peso por um ciclo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O peso foi calculado com base em dois par√¢metros: ainda relevante, em seguida, IP Precedence e o comprimento do pacote. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No contexto do WFQ, quanto mais peso, pior. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, quanto maior a Preced√™ncia de IP, menor o peso do pacote. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quanto menor o tamanho da embalagem, menor o seu peso. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim, pacotes pequenos de alta prioridade obt√™m mais recursos, enquanto gigantes de baixa prioridade est√£o esperando.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ilustra√ß√£o abaixo, os pacotes receberam tais pesos que, no primeiro, um pacote da primeira fila √© ignorado, depois dois do segundo, novamente do primeiro e somente ent√£o o terceiro √© processado. Assim, por exemplo, isso poderia acontecer se o tamanho dos pacotes no segundo est√°gio for relativamente pequeno. </font></font><br><br><img src="https://habrastorage.org/webt/dd/z9/v7/ddz9v7nahrtmewfrul4mbflc5b0.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre a dura engenharia do WFQ, com o tempo de t√©rmino dos pacotes, o tempo virtual e o Teorema de Wig, voc√™ pode ler em um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">curioso documento colorido</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, isso n√£o resolveu o primeiro e o terceiro problemas. A abordagem baseada em fluxo foi igualmente inconveniente e os fluxos que precisavam de pequenos atrasos e instabilidade est√°vel n√£o os receberam.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso, no entanto, n√£o impediu o uso do WFQ em alguns dispositivos da Cisco (principalmente antigos). </font><font style="vertical-align: inherit;">Havia at√© 256 filas nas quais os threads foram colocados com base no hash de seus cabe√ßalhos. </font><font style="vertical-align: inherit;">Um compromisso entre o paradigma baseado em fluxo e os recursos limitados.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CBWFQ - WFQ baseado em classe </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O CBWFQ fez a abordagem do problema de complexidade com o advento do DiffServ. O Behavior Aggregate classificou todas as categorias de tr√°fego em 8 classes e, consequentemente, em filas. Isso deu a ele um nome e uma fila bastante simplificada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O peso no CBWFQ adquiriu um significado diferente. O peso foi atribu√≠do √†s </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (n√£o threads) manualmente na configura√ß√£o, a pedido do administrador, porque o campo DSCP j√° foi usado para classifica√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, o DSCP determinou em qual fila colocar e o peso configurado - quantas faixas est√£o dispon√≠veis para essa fila.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais importante, isso indiretamente tornou a vida um pouco mais f√°cil e os fluxos de baixa lat√™ncia, que agora eram agregados em uma (duas a tr√™s ...) filas e recebiam seus pontos altos com muito mais frequ√™ncia. </font><font style="vertical-align: inherit;">A vida melhorou, mas ainda n√£o √© boa - n√£o h√° garantias - em geral, no WFQ tudo ainda √© igual em termos de atrasos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E a necessidade de monitoramento constante do tamanho dos pacotes, sua fragmenta√ß√£o e desfragmenta√ß√£o, n√£o desapareceu.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CBWFQ + LLQ - Fila de baixa lat√™ncia </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A abordagem final, o culminar de uma abordagem bit a bit, √© a uni√£o do CBWFQ com o PQ. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma das filas se torna o chamado </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LLQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (fila de baixa lat√™ncia) e, enquanto todas as outras filas s√£o processadas pelo gerente CBWFQ, o gerente PQ est√° em execu√ß√£o entre os LLQs e o restante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, enquanto existem pacotes no LLQ, as filas restantes est√£o aguardando, seus atrasos est√£o aumentando. </font><font style="vertical-align: inherit;">Assim que os pacotes no LLQ acabaram, fomos processar o restante. </font><font style="vertical-align: inherit;">Os pacotes apareceram no LLQ - eles esqueceram o resto e retornaram a ele. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O FIFO tamb√©m funciona no LLQ, portanto voc√™ n√£o deve empurrar tudo sem chegar l√°, aumentando a utiliza√ß√£o do buffer e o atraso ao mesmo tempo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, para que as filas n√£o priorit√°rias n√£o passem fome, vale a pena definir um limite de largura de banda no LLQ. </font></font><br><br><img src="https://habrastorage.org/webt/c6/4m/vt/c64mvts-kr2ij0o_zf2kfxy2cbu.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o as ovelhas est√£o cheias e os lobos est√£o seguros.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RR - Round-Robin </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De m√£os dadas com FQ andou e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um era honesto, mas n√£o simples. </font><font style="vertical-align: inherit;">O outro √© exatamente o oposto. </font></font><br><br><img src="https://habrastorage.org/webt/8p/nh/de/8pnhdeko9l5nkiss6mbtxbg9jvk.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O RR passou pelas filas, extraindo um n√∫mero igual de pacotes delas. </font><font style="vertical-align: inherit;">A abordagem √© mais primitiva que a QF e, portanto, desonesta em rela√ß√£o a v√°rios fluxos. </font><font style="vertical-align: inherit;">Fontes agressivas podem facilmente inundar a faixa com pacotes de 1500 bytes de tamanho. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, foi muito simples de implementar - voc√™ n√£o precisa saber o tamanho do pacote na fila, fragment√°-lo e colet√°-lo novamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, sua injusti√ßa na aloca√ß√£o da faixa bloqueou seu caminho para o mundo - no mundo das redes, o Round-Robin puro n√£o foi implementado.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WRR - Robin Redondo Ponderado </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O mesmo destino ocorre com o WRR, que adicionou peso √†s filas com base na Preced√™ncia de IP. </font><font style="vertical-align: inherit;">No WRR, n√£o foi retirado um n√∫mero igual de pacotes, mas um m√∫ltiplo do peso da fila. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seria poss√≠vel atribuir mais peso √†s filas com pacotes menores, mas fazer isso dinamicamente n√£o era poss√≠vel.</font></font><br><br><img src="https://habrastorage.org/webt/lx/4b/an/lx4bancel1tl9stwbeay0s6n1ma.png" width="800"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DWRR - Robin Redondo Ponderado pelo D√©ficit </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E de repente, uma abordagem extremamente curiosa em 1995 foi proposta por M. Shreedhar e G. Varghese. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada linha tem uma </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linha de cr√©dito</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> separada </font><font style="vertical-align: inherit;">em bits. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao passar da fila, s√£o emitidos tantos pacotes quanto h√° cr√©dito suficiente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tamanho do pacote no in√≠cio da fila √© deduzido do valor do empr√©stimo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a diferen√ßa for maior que zero, esse pacote ser√° removido e o pr√≥ximo ser√° verificado. Ent√£o, at√© que a diferen√ßa seja menor que zero. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se mesmo o primeiro pacote n√£o tem cr√©dito suficiente, bem, infelizmente, os fluxos de lama, ele permanece na fila. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes do pr√≥ximo passe, o cr√©dito de cada linha √© aumentado em uma certa quantia, chamada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quantum</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para filas diferentes, o quantum √© diferente - quanto maior a banda que voc√™ precisa fornecer, maior o quantum. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim, todas as filas recebem uma largura de banda garantida, independentemente do tamanho dos pacotes nela. </font></font><br><br><img src="https://habrastorage.org/webt/vr/hv/vk/vrhvvk-1opimw_vofynmrkosbv8.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pela explica√ß√£o acima, n√£o ficaria claro para mim como isso funciona.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos desenhar os passos ...</font></font></b> <div class="spoiler_text">   : <br><br><ul><li> DRR ( W), </li><li> 4 , </li><li>  0-    500 , </li><li>  1- ‚Äî  1000, </li><li>  2-  1500, </li><li>   3-     4000, </li><li>  ‚Äî 1600 . </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/64d/911/64e/64d91164edc5867e9009f54de10a50da.png"><br><br><h5>  1 </h5><br> <b> 1.  0</b> <br>   ,     1600  () <br>    0- .  : <br>      ‚Äî  (1600 ‚Äî 500 = 1100). <br>  ‚Äî  ‚Äî  (1100 ‚Äî 500 = 600). <br>  ‚Äî  ‚Äî  (600 ‚Äî 500 = 100). <br>  ‚Äî    (100 ‚Äî 500 = -400).    . <br>   ‚Äî 100 . <br><br><img src="https://habrastorage.org/webt/9y/4x/al/9y4xalhqrwwayufvjfcxlfevl20.png"><br><br> <b> 1.  1</b> <br>    ‚Äî  (1600 ‚Äî 1000 = 600). <br>    (600 ‚Äî 1000 = -400).    . <br>   ‚Äî 600 . <br><br><img src="https://habrastorage.org/webt/yw/mr/qh/ywmrqhm_deusdb04dez-3gjermc.png"><br><br> <b> 1.  2</b> <br>    ‚Äî  (1600 ‚Äî 1500 = 100). <br>    (100 ‚Äî 1000 = -900).    . <br>   ‚Äî 100 . <br><br><img src="https://habrastorage.org/webt/aj/el/k6/ajelk6xd9tpkl70r5hgt6q9q2u0.png"><br><br> <b> 1.  3</b> <br>     . (1600 ‚Äî 4000 = -2400). <br>    . <br>   ‚Äî   1600 . <br><br><img src="https://habrastorage.org/webt/jw/fo/3e/jwfo3eobllx5--quzb9qqt3zt0c.png"><br><br> ,       : <br><br><ul><li>  0 ‚Äî 1500 </li><li>  1 ‚Äî 1000 </li><li>  2 ‚Äî 1500 </li><li>  3 ‚Äî 0 </li></ul><br>  : <br><br><ul><li>  0 ‚Äî 100 </li><li>  1 ‚Äî 600 </li><li>  2 ‚Äî 100 </li><li>  3 ‚Äî 1600 </li></ul><br><h5>  2 </h5><br>          ‚Äî   1600 . <br><br> <b> 2.  0</b> <br>    1700 (100 + 1600). <br>       ‚Äî   (1700 ‚Äî 3*500 = 200). <br>     . <br>   ‚Äî 200 . <br><br><img src="https://habrastorage.org/webt/4z/di/2s/4zdi2se_gcciq1rbfkqqzzrumsa.png"><br><br> <b> 2.  1</b> <br>    2200 (600 + 1600). <br>       ‚Äî   (2200 ‚Äî 2*1000 = 200). <br>    . <br>   ‚Äî 200 . <br><img src="https://habrastorage.org/webt/9e/1z/sl/9e1zsl63ko7jxqjjuv4snupl6kw.png"><br><br> <b> 2.  2</b> <br>    1700 (100 + 1600). <br>      ‚Äî   (2200 ‚Äî 1500 = 200). <br>   ‚Äî  . <br>   ‚Äî 200 . <br><br><img src="https://habrastorage.org/webt/xf/v5/ni/xfv5nifo1wqvxfrhjqlfoygdk1w.png"><br><br> <b> 2.  3</b> <br>    3200 (1600 + 1600). <br>       (3200 ‚Äî 4000 = -800) <br>   ‚Äî 3200 . <br><img src="https://habrastorage.org/webt/wn/wj/pe/wnwjpenhub6ir2d8vi69oxan8-s.png"><br><br> ,       : <br><br><ul><li>  0 ‚Äî 3000 </li><li>  1 ‚Äî 3000 </li><li>  2 ‚Äî 3000 </li><li>  3 ‚Äî 0 </li></ul><br>  : <br><br><ul><li>  0 ‚Äî 200 </li><li>  1 ‚Äî 200 </li><li>  2 ‚Äî 200 </li><li>  3 ‚Äî 3200 </li></ul><br><h5>  3 </h5><br>          ‚Äî 1600 . <br><br> <b> 3.  0</b> <br>    1800 (200 + 1600). <br>        ‚Äî   (1800 ‚Äî 3*500 = 300). <br>     . <br>   ‚Äî 300 . <br><br><img src="https://habrastorage.org/webt/lk/sk/tq/lksktqj1g_7q6m2p8jwq0olnfuw.png"><br><br> <b> 3.  1</b> <br>    1800 (200 + 1600). <br>    ‚Äî  (1800 ‚Äî 1000 = 800). <br>   ‚Äî 800 . <br><br><img src="https://habrastorage.org/webt/fg/bd/jd/fgbdjdmydatamvpzxome7reb5pc.png"><br><br> <b> 3.  2</b> <br>    1800 (200 + 1600). <br>    ‚Äî  (1800 ‚Äî 1500 = 300). <br>   ‚Äî 300 . <br><br><img src="https://habrastorage.org/webt/s1/a7/iv/s1a7iv6mpfy1kesgzuazx9hsgkk.png"><br><br> <b> 3.  3</b> <br>    3-  ! <br>    4800 (3200 + 1600). <br>    ‚Äî  (4800 ‚Äî 4000 = 800). <br>   ‚Äî 800 . <br><br><img src="https://habrastorage.org/webt/fm/fh/tn/fmfhtnvh1utrr0yovddsambv_fe.png"><br><br> ,       : <br><br><ul><li>  0 ‚Äî 4500 </li><li>  1 ‚Äî 4000 </li><li>  2 ‚Äî 4500 </li><li>  3 ‚Äî 4000 </li></ul><br>  : <br><br><ul><li>  0 ‚Äî 300 </li><li>  1 ‚Äî 800 </li><li>  2 ‚Äî 300 </li><li>  3 ‚Äî 800 </li></ul><br><img src="https://habrastorage.org/webt/q5/q9/pj/q5q9pjzqa1be-uluk_eucxwga9w.png"><br><br>     DRR.          . <br><br>    ,  . <br><br><img src="https://habrastorage.org/webt/5l/6o/nd/5l6onduvx4djvafmxj7bhsoxwwm.gif"><br><br>  DWRR  DRR   ,        ,   ,     . <br><br><hr><br>     DRR,        ‚Äî    ,   . <br><br>     :  ,     .           . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com o DWRR, a quest√£o permanece com a garantia de atrasos e instabilidade - o peso n√£o resolve de maneira alguma. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teoricamente, voc√™ pode fazer o mesmo que com o CB-WFQ, adicionando o LLQ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, este √© apenas um dos cen√°rios poss√≠veis da crescente popularidade de hoje.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PB-DWRR - DWRR baseado em prioridade </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atualmente, o mainstream hoje est√° se tornando PB-DWRR - Robin Rodada Ponderada por D√©ficit Baseado em Prioridade. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este √© o mesmo DWRR mal antigo, no qual outra fila √© adicionada - prioridade, na qual os pacotes s√£o processados ‚Äã‚Äãcom uma prioridade mais alta. </font><font style="vertical-align: inherit;">Isso n√£o significa que ela recebe uma faixa maior, mas que os pacotes ser√£o retirados de l√° com mais frequ√™ncia. </font></font><br><br><img src="https://habrastorage.org/webt/wg/6g/ui/wg6guiijtoscyckwdwr49gkp0fq.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem v√°rias abordagens para implementar o PB-DWRR. </font><font style="vertical-align: inherit;">Em alguns deles, como no PQ, qualquer pacote que chega na fila de prioridade √© removido imediatamente. </font><font style="vertical-align: inherit;">Em outros, ele √© acessado toda vez que o expedidor se move entre filas. </font><font style="vertical-align: inherit;">Em terceiro lugar, um cr√©dito e um quantum s√£o introduzidos para ele, para que a fila de prioridade n√£o possa espremer toda a faixa. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Claro, n√£o vamos analis√°-los.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Um breve resumo sobre mecanismos de envio </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por d√©cadas, a humanidade vem tentando resolver o problema mais dif√≠cil de garantir o n√≠vel certo de servi√ßo e a distribui√ß√£o justa da banda. As filas eram a ferramenta principal; a √∫nica quest√£o era como obter pacotes das filas, tentando coloc√°-los em uma √∫nica interface. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Come√ßando com o FIFO, ele inventou o PQ - a voz era capaz de coexistir com o surf, mas n√£o havia como garantir a banda. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apareceram v√°rios QF monstruosos, WFQ, que funcionavam se n√£o por fluxo, ent√£o quase assim. O CB-WFQ chegou √† sociedade de classes, mas n√£o ficou mais f√°cil. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como alternativa, ele desenvolveu RR. Tornou-se um WRR e, em seguida, um DWRR. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E nas profundezas de cada um dos despachantes vive o FIFO.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, como voc√™ pode ver, n√£o existe um expedidor universal que lide com todas as classes conforme necess√°rio. </font><font style="vertical-align: inherit;">√â sempre uma combina√ß√£o de despachantes, um dos quais resolve o problema de garantir atrasos, instabilidade e falta de perdas, e o outro aloca uma banda. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBWFQ + LLQ ou PB-WDRR ou WDRR + PQ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em equipamentos reais, voc√™ pode especificar quais filas processar com qual despachante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBWFQ, WDRR e seus derivados s√£o os favoritos de hoje. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PQ, FQ, WFQ, RR, WRR - n√£o lamentamos e n√£o lembramos (a menos que, √© claro, estamos nos preparando para o CCIE Clipper).</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Portanto, os despachantes s√£o capazes de garantir velocidade, mas como limit√°-la de cima? </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8. limite de velocidade </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A necessidade de limitar a velocidade do tr√°fego √† primeira vista √© √≥bvia - n√£o deixe o cliente fora de sua banda de acordo com o contrato. </font></font><br><br>  Sim  Mas n√£o √© s√≥ isso.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suponha que exista um RRL de 620 Mb / s de largura conectado por uma porta de 1 Gb / s. Se voc√™ colocar o gigabit inteiro nele, ent√£o, em algum lugar do RRL, que, provavelmente, n√£o tem id√©ia de filas e QoS, ser√£o iniciadas quedas monstruosas de natureza aleat√≥ria, n√£o ligadas √†s prioridades reais do tr√°fego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, se voc√™ habilitar a modelagem de at√© 600 Mb / s no roteador, EF, CS6, CS7 n√£o ser√£o descartados e, em BE, AFx, a banda e as descargas ser√£o distribu√≠das de acordo com seus pesos. O RRL alcan√ßar√° 600 Mb / se obteremos uma imagem previs√≠vel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outro exemplo √© o Controle de Admiss√£o. Por exemplo, dois operadores concordaram em confiar nas marca√ß√µes um do outro, exceto no CS7 - se algo vier no CS7 - o descarte. Para CS6 e EF - forne√ßa uma fila separada com garantia de atraso e sem perda.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas e se o parceiro astuto come√ßasse a despejar torrents nessas linhas? </font><font style="vertical-align: inherit;">Adeus telefonia. </font><font style="vertical-align: inherit;">E os protocolos provavelmente ir√£o desmoronar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â l√≥gico neste caso concordar com um parceiro sobre a tira. </font><font style="vertical-align: inherit;">Tudo o que se encaixa no contrato √© ignorado. </font><font style="vertical-align: inherit;">O que n√£o cabe - descarte ou transfira para outra fila - BE, por exemplo. </font><font style="vertical-align: inherit;">Assim, protegemos nossa rede e nossos servi√ßos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem duas abordagens fundamentalmente diferentes para a limita√ß√£o de velocidade: polimento e modelagem. </font><font style="vertical-align: inherit;">Eles resolvem um problema, mas de maneiras diferentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Considere a diferen√ßa usando um exemplo desse perfil de tr√°fego:</font></font><br><br><img src="https://habrastorage.org/webt/5b/sj/st/5bsjstoglxkg7dspcxjrphdjsye.png" width="500"><br><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Policiamento de tr√¢nsito </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O policiamento limita a velocidade eliminando o excesso de tr√°fego. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tudo o que excede o valor definido, o polisador corta e joga fora. </font></font><br><br><img src="https://habrastorage.org/webt/a3/dl/xa/a3dlxapkcptfnfejftde0qxycjc.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© cortado √© esquecido. A imagem mostra que o pacote vermelho n√£o est√° em tr√¢nsito ap√≥s o polyser. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E aqui est√° a apar√™ncia do perfil selecionado ap√≥s o polisador: </font></font><br><br><img src="https://habrastorage.org/webt/jb/rw/52/jbrw52md7mynstgrt9-o1a1mo1s.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devido √† gravidade das medidas tomadas, isso √© chamado de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">policiamento r√≠gido</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, existem outras a√ß√µes poss√≠veis. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O vigilante geralmente trabalha em conjunto com um medidor de tr√°fego. O medidor colore as malas, como voc√™ se lembra, em verde, amarelo ou vermelho. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E com base nessa cor j√°, o polisador pode n√£o descartar o pacote, mas coloc√°-lo em outra classe. Essas s√£o medidas suaves - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Policiamento suave</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pode ser aplicado ao tr√°fego de entrada e ao tr√°fego de sa√≠da. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma caracter√≠stica distintiva do polisador √© a capacidade de absorver rajadas de tr√°fego e determinar a velocidade m√°xima permitida gra√ßas ao mecanismo Token Bucket. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isto √©, de fato, tudo o que n√£o est√° acima do valor definido n√£o √© cortado - √© permitido ir um pouco al√©m dele - pequenas explos√µes ou pequenos excessos da banda alocada s√£o ignorados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O nome "policiamento" √© ditado pela propor√ß√£o bastante r√≠gida da ferramenta em rela√ß√£o ao excesso de tr√°fego - descarte ou rebaixamento para uma classe baixa.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Modelagem de tr√°fego </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A modelagem limita a velocidade protegendo o excesso de tr√°fego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo o tr√°fego recebido passa pelo buffer. Um shaper remove pacotes desse buffer a uma velocidade constante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a taxa de chegada de pacotes ao buffer for menor que a sa√≠da, eles n√£o atrasam no buffer - eles passam direto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E se a taxa de chegada for maior que a produ√ß√£o, eles come√ßar√£o a se acumular. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A velocidade de sa√≠da √© sempre a mesma. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim, rajadas de tr√°fego s√£o adicionadas ao buffer e ser√£o enviadas quando atingirem a fila. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, juntamente com o agendamento nas filas, a modelagem √© a segunda ferramenta que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contribui para o atraso total</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/in/gc/vh/ingcvhgya0fzfiw2sxbeiix7hfw.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A ilustra√ß√£o mostra claramente como o pacote que chega no momento em que o buffer t2 chega no momento t3 na sa√≠da. </font><font style="vertical-align: inherit;">t3-t2 √© o atraso introduzido pelo modelador. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shaper √© geralmente aplicado ao tr√°fego de sa√≠da. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â assim que o perfil cuida do modelador. </font></font><br><br><img src="https://habrastorage.org/webt/iv/b7/sl/ivb7slyamvreja97npdjyr3ctwk.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O nome "Shaping" indica que a ferramenta d√° uma forma ao perfil de tr√°fego, suavizando-o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A principal vantagem dessa abordagem √© o uso ideal da banda existente - em vez de diminuir o tr√°fego excessivo, adiamos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A principal desvantagem √© um atraso imprevis√≠vel - quando o buffer estiver cheio, os pacotes permanecer√£o nele por um longo tempo. </font><font style="vertical-align: inherit;">Portanto, a modelagem n√£o √© adequada para todos os tipos de tr√°fego. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A modelagem usa o mecanismo Leaky Bucket.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Modelagem versus polimento </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O trabalho do polisador √© semelhante a uma faca que, movendo-se ao longo da superf√≠cie do √≥leo, corta o lado afiado do tub√©rculo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O trabalho de um modelador √© semelhante a um rolo, que suaviza os tub√©rculos, distribuindo-os uniformemente sobre a superf√≠cie. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Shaper tenta n√£o descartar pacotes enquanto eles s√£o armazenados em buffer ao custo de um atraso maior. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O polidor n√£o introduz atrasos, mas descarta mais prontamente os pacotes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os aplicativos que n√£o s√£o sens√≠veis a atrasos, mas cuja perda √© indesej√°vel, devem ser limitados a um modelador. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para aqueles para quem um pacote atrasado √© igual a um pacote perdido, √© melhor descart√°-lo imediatamente - e depois polisar.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um modelador n√£o afeta os cabe√ßalhos de pacotes e seu destino fora do n√≥, enquanto, ap√≥s o polimento, o dispositivo pode reclassificar a classe no cabe√ßalho. </font><font style="vertical-align: inherit;">Por exemplo, na entrada, o pacote tinha a classe AF11, a medi√ß√£o o pintou de amarelo dentro do dispositivo, na sa√≠da remarcou sua classe no AF12 - no pr√≥ximo n√≥, ele ter√° uma maior probabilidade de queda.</font></font><br><br><img src="https://habrastorage.org/webt/za/y6/kh/zay6khb7cgviroz-zbumfppdtz8.png" width="600"><br><br><hr><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pr√°tica de polimento e modelagem </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O esquema √© o mesmo: </font></font><br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo de configura√ß√£o. </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observamos esta imagem sem aplicar restri√ß√µes: </font></font><br><br><img src="https://habrastorage.org/webt/mg/nz/mv/mgnzmvc_36gtmgf5t3vi0wob1uk.png" width="900"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos proceder da seguinte forma:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na interface de entrada Linkmeup_R2 (e0 / 1), configuraremos o polimento - este ser√° o controle de entrada. </font><font style="vertical-align: inherit;">Nos termos do contrato, damos 10 Mb / s.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Na interface de sa√≠da Linkmeup_R4 (e0 / 2), configure o shaping em 20 Mb / s. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos come√ßar com o shaper no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linkmeup_R4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine tudo:</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_ALL_CM match <span class="hljs-keyword"><span class="hljs-keyword">any</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Forma at√© 20Mb / s: </font></font><br><br><pre> <code class="hljs swift"> policy-<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">TRISOLARANS_SHAPING</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TRISOLARANS_ALL_CM</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shape</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">average</span></span></span><span class="hljs-class"> 20000000</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aplique √† interface de sa√≠da: </font></font><br><br><pre> <code class="hljs kotlin"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ethernet0</span></span></span><span class="hljs-class">/2 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">service</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">policy</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">output</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TRISOLARANS_SHAPING</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tudo o que deve sair (de sa√≠da) da interface Ethernet0 / 2 √© de at√© 20 Mb / s. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquivo de configura√ß√£o do shaper. </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E aqui est√° o resultado: </font></font><br><br><img src="https://habrastorage.org/webt/tz/1i/sr/tz1isrb6mnjnirkxe46wbzed2yu.png" width="900"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resulta uma linha bastante plana de taxa de transfer√™ncia total e gr√°ficos rasgados para cada fluxo individual. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O fato √© que restringimos o modelador √† banda geral. </font><font style="vertical-align: inherit;">No entanto, dependendo da plataforma, os fluxos individuais tamb√©m podem ser modelados individualmente, ganhando oportunidades iguais.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora configure o polimento no Linkmeup_R2. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionaremos um polyser √† pol√≠tica existente.</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-map TRISOLARANS_ADMISSION_CONTROL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_TCP_CM police cir <span class="hljs-number"><span class="hljs-number">10000000</span></span> bc <span class="hljs-number"><span class="hljs-number">1875000</span></span> conform-action transmit exceed-action <span class="hljs-keyword"><span class="hljs-keyword">drop</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A pol√≠tica j√° foi aplicada √† interface: </font></font><br><br><pre> <code class="hljs pgsql"> interface Ethernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> service-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> TRISOLARANS_ADMISSION_CONTROL</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui, indicamos a velocidade m√©dia permitida CIR (10 Mb / s) e o burst permitido Bc (1.875.000 bytes, cerca de 14,6 MB). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais tarde, explicando como o polisador funciona, vou lhe dizer o que s√£o CIR e Bc e como determinar esses valores. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquivo de configura√ß√£o do Polyser. </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta imagem √© observada com polysing. </font><font style="vertical-align: inherit;">Mudan√ßas repentinas no n√≠vel de velocidade s√£o imediatamente aparentes:</font></font><br><br><img src="https://habrastorage.org/webt/wg/vb/iv/wgvbiv6biiv27f99npxfupqjdla.png" width="900"><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mas uma imagem t√£o interessante √© obtida se tornarmos o tamanho permitido de burst muito pequeno, por exemplo, 10.000 bytes. </font></font><br><br><pre> <code class="hljs powershell"> police cir <span class="hljs-number"><span class="hljs-number">10000000</span></span> bc <span class="hljs-number"><span class="hljs-number">10000</span></span> conform<span class="hljs-literal"><span class="hljs-literal">-action</span></span> transmit exceed<span class="hljs-literal"><span class="hljs-literal">-action</span></span> drop</code> </pre> <br><img src="https://habrastorage.org/webt/3a/cn/l0/3acnl01957rqgxcsonokebamdim.png" width="900"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A velocidade geral caiu imediatamente para cerca de 2Mb / s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenha cuidado com a configura√ß√£o de rajadas :) </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabela de teste.</font></font></a> <br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Balde com vazamento e balde de tokens </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece f√°cil e claro. </font><font style="vertical-align: inherit;">Mas como funciona na pr√°tica e √© implementado em hardware?</font></font><br><br>  Um exemplo <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O limite de 400 Mb / s √© muito (ou pouco)? </font><font style="vertical-align: inherit;">Em m√©dia, um cliente usa apenas 320. Mas √†s vezes sobe para 410 por 5 minutos. </font><font style="vertical-align: inherit;">E √†s vezes at√© 460 por minuto. </font><font style="vertical-align: inherit;">E √†s vezes at√© 500 por meio segundo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o linkmeup do fornecedor contratual pode dizer - 400 e √© isso! </font><font style="vertical-align: inherit;">Se voc√™ quiser mais, conecte-se √† tarifa de 1Gb / s + 27 canais de anime. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E podemos aumentar a fidelidade do cliente se isso n√£o interferir com os outros, permitindo tais surtos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como permitir 460 Mb / s por apenas um minuto, e n√£o 30 ou para sempre? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como permitir 500 Mb / s, se a banda √© gratuita, e pressionar 400, se outros consumidores aparecerem? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora fa√ßa uma pausa, despeje um balde de forte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos come√ßar com o mecanismo mais simples usado pelo shaper - um balde com vazamento.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algoritmo de bucket com vazamento </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Balde com vazamento √© um balde com vazamento. </font></font><br><br><img src="https://habrastorage.org/webt/te/qj/jv/teqjjvam2gz-gwlvfcfr1osqj5q.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos um balde com um buraco de um determinado tamanho na parte inferior. Os sacos s√£o derramados / derramados neste balde de cima. E de baixo, eles fluem a uma taxa de bits constante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando o balde est√° cheio, novos pacotes come√ßam a ser descartados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tamanho do furo √© determinado pelo limite de velocidade especificado, que para o Leaky Bucket √© medido em bits por segundo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O volume do balde, sua plenitude e velocidade de sa√≠da determinam o atraso introduzido pelo modelador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por conveni√™ncia, o volume da ca√ßamba √© geralmente medido em ms ou Œºs. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em termos de implementa√ß√£o, o Leaky Bucket √© um buffer regular baseado em SD-RAM.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesmo se a modelagem n√£o estiver configurada explicitamente, na presen√ßa de rajadas que n√£o passam na interface, os pacotes s√£o temporariamente armazenados em buffer e transmitidos quando a interface √© liberada. </font><font style="vertical-align: inherit;">Isso tamb√©m est√° moldando. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O balde com vazamento √© usado apenas para modelar e n√£o √© adequado para polimento.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algoritmo de bucket de token </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muitas pessoas pensam que Token Bucket e Leaking Bucket s√£o a mesma coisa. </font><font style="vertical-align: inherit;">Apenas Einstein estava muito mais enganado, acrescentando uma constante cosmol√≥gica. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os chips de comuta√ß√£o n√£o entendem realmente a que horas s√£o, eles ficam ainda piores quantos bits eles transmitiram por unidade de tempo. </font><font style="vertical-align: inherit;">O trabalho deles √© trilhar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esse bit se aproxima outro 400.000.000 de bits por segundo, ou j√° 400.000 001? </font></font><br><br><img src="https://habrastorage.org/webt/kh/pu/i6/khpui6xw0sle9wconrc6ouoeedg.png" width="400"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os desenvolvedores do ASIC tiveram um desafio de engenharia n√£o trivial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foi dividido em duas subtarefas:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na verdade, limitando a velocidade descartando pacotes desnecess√°rios com base em uma condi√ß√£o muito simples. </font><font style="vertical-align: inherit;">Realizado na troca de chips.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Criando essa condi√ß√£o simples, que lida com um chip mais complexo (mais especializado), acompanhando o tempo. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O algoritmo que resolve o segundo problema √© chamado de Token Bucket. </font><font style="vertical-align: inherit;">Sua ideia √© elegante e simples (n√£o). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tarefa do Token Bucket √© passar o tr√°fego se estiver dentro da restri√ß√£o e descartar / pintar em vermelho, se n√£o estiver. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â importante permitir rajadas de tr√°fego, pois isso √© normal. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E se, no Leaky Bucket, as explos√µes foram armazenadas em buffer, o Token Bucket n√£o armazena em buffer nada.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Taxa √∫nica - marca√ß√£o de duas cores </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por enquanto, n√£o preste aten√ß√£o ao nome =) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos um balde no qual as moedas caem a uma velocidade constante - 400 megamonets por segundo, por exemplo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O volume do balde √© de 600 milh√µes de moedas. Ou seja, √© preenchido em um segundo e meio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perto h√° duas correias transportadoras: uma entrega pacotes e a segunda leva embora. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para chegar ao transportador, o pacote deve pagar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para isso, ele pega moedas de um balde de acordo com seu tamanho. Grosso modo - quantos bits - tantas moedas. </font></font><br><br><img src="https://habrastorage.org/webt/2m/lh/kz/2mlhkzj9j1vezkils69vlszdgc0.png" width="800"><br><br><img src="https://habrastorage.org/webt/hj/o5/nn/hjo5nn2u7omtuighgtohqpx1y1k.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o balde estiver vazio e n√£o houver moedas suficientes na sacola, ele ser√° pintado na cor vermelha do sinal e descartado. Infelizmente, Selyava. Nesse caso, as moedas n√£o s√£o removidas do balde.</font></font><br><br><img src="https://habrastorage.org/webt/d-/bf/q9/d-bfq9l2tnj90-58kvi38zl3ufy.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O pr√≥ximo pacote de moedas j√° pode ser suficiente - primeiro, o pacote pode ser menor e, segundo, ataca mais moedas durante esse per√≠odo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o balde j√° estiver cheio, todas as novas moedas ser√£o jogadas fora. </font></font><br><br><img src="https://habrastorage.org/webt/cs/yn/yq/csynyq7ig1pfozdswqkxt59dt2e.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tudo depende da taxa de chegada de pacotes e do seu tamanho. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se for est√°vel ou inferior a 400 MB por segundo, sempre haver√° moedas suficientes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se superior, alguns dos pacotes ser√£o perdidos.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Um exemplo mais espec√≠fico com gifs, como todos gostamos. </font></font><br><br><img src="https://habrastorage.org/webt/o1/ds/ek/o1dsekpsi9nhg-plchkoivxrwm4.gif"><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° um balde com capacidade de 2500 bytes. </font><font style="vertical-align: inherit;">No momento inicial, ele cont√©m 550 tokens. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem tr√™s pacotes de 1000 bytes no pipeline que desejam ser enviados para a interface. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em cada intervalo de tempo, 500 bytes caem no intervalo (500 * 8 = 4.000 bits / intervalo de tempo - limite de poliser).</font></font></li><li>         500 .       .   1000 ,    1050  ‚Äî <b></b> .       . 1000    . <br>    50 . </li><li>          500  ‚Äî  550.     ‚Äî 1000 ‚Äî <b> </b> . <br>     ,   . </li><li>         500  ‚Äî  1050.    ‚Äî 1000 ‚Äî <b></b> . <br>      ,    . </li></ul><br>    2500   ,             2500  ‚Äî      .        MTU    ,      ,  ,  1,5-2 . <br><br>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> : <br><br> CBS = CIR (  )*1,5 ()/8 (  ) <br><br>       ,     (Bc),   ,     (1 875 000 )    .    (10 000 ),   ,     MTU,           . <br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que o volume da ca√ßamba? O fluxo de bits nem sempre √© uniforme, isso √© √≥bvio. Um limite de 400 Mb / s n√£o √© uma ass√≠ntota - o tr√°fego pode ultrapass√°-lo. O volume de moedas armazenadas permite que pequenas rajadas voem sem serem descartadas, mas mantenha a velocidade m√©dia em 400 Mb / s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, um fluxo est√°vel de 399 Mb / s em 600 segundos permitir√° que o balde seja preenchido at√© a borda. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, o tr√°fego pode subir para 1000Mb / se permanecer nesse n√≠vel por 1 segundo - 600 Mm (Megamonet) de estoque e banda garantida de 400 Mm / s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou o tr√°fego pode subir para 410 Mb / se permanecer assim por 60 segundos. </font></font><br><br><img src="https://habrastorage.org/webt/hq/yl/ib/hqylibyhmxkhepdt9mcf04m7rnk.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, o suprimento de moedas permite que voc√™ v√° um pouco al√©m da restri√ß√£o por um longo per√≠odo de tempo ou jogue uma onda curta, mas alta. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, para a terminologia.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A taxa de recebimento de moedas no balde - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIR - Committed Information Rate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (velocidade m√©dia garantida). Medido em bits por segundo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O n√∫mero de moedas que podem ser armazenadas no balde - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBS - Tamanho de Burst Confirmado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Tamanho m√°ximo permitido de rajada. Medido em bytes. √Äs vezes, como voc√™ deve ter notado, √© chamado de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - O n√∫mero de moedas (token) no balde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (CBS) no momento.</font></font><br><br><img src="https://habrastorage.org/webt/nm/rr/iv/nmrrivc2sdktqp4cfyhwfayjuze.png" width="600"><br><blockquote>      " <b>Tc</b> ",  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC 2697</a> ( <i>A Single Rate Three Color Marker</i> ). <br>     Tc,    ,       . <br>    . <br>    ,    ,     Token Bucket,    <b>TDM</b> (Time-Division Multiplexing) ‚Äî         . <br>          ‚Äî  , , . <br>          CIR .    . <br>   ,    ‚Äî   ,  ‚Äî   ,  ‚Äî   . <br>         ,      . <br>      (    Cisco) <b>Tc</b> ,     ‚Äî <b>Bc</b> .   <b>Bc = CIR*Tc</b> . <br>       Tc    Bc . <br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este √© o cen√°rio mais simples. </font><font style="vertical-align: inherit;">√â chamado </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taxa √önica - Duas Cores</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taxa √∫nica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> significa que existe apenas uma velocidade m√©dia permitida e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Duas cores</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - que voc√™ pode colorir o tr√°fego em uma das duas cores: verde ou vermelho.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o n√∫mero de moedas (bits) dispon√≠veis no balde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C for</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> maior que o n√∫mero de bits que precisam ser ignorados no momento, o pacote ser√° colorido em verde - uma baixa probabilidade de queda no futuro. </font><font style="vertical-align: inherit;">As moedas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o removidas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do balde.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso contr√°rio, a embalagem √© pintada de vermelho - uma alta probabilidade de queda (ou, mais frequentemente, queda moment√¢nea). </font><font style="vertical-align: inherit;">Moedas assim baldes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C √© retirado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usado para polir no PHB CS e EF, onde a velocidade n√£o √© esperada, mas se ocorrer, √© melhor descart√°-lo imediatamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, consideraremos mais dif√≠cil: Taxa √önica - Tr√™s Cores.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Taxa √∫nica - marca√ß√£o de tr√™s cores </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A desvantagem do esquema anterior √© que existem apenas duas cores. E se n√£o queremos deixar tudo acima da velocidade m√©dia permitida, mas queremos ser ainda mais fi√©is? </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o TCM-sr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">taxa √∫nica - a Tr√™s a A marca√ß√£o a cores</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) entra no segundo segmento em - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Neste momento, as moedas n√£o s√£o colocados num balde cheio com </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , s√£o vertida em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">O EBS √©</font></b></font><br><br><img src="https://habrastorage.org/webt/xq/wq/fb/xqwqfblgko9sadvpv_zg2khhoma.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adicionado ao CIR e CBS </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Excesso de tamanho de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rajada - tamanho permitido de rajada durante picos. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Te</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o n√∫mero de moedas em um balde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/un/tb/1v/untb1vhnskpben6jqecdqinvx4q.png" width="600"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digamos que um pacote de tamanho </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> veio ao longo do pipeline.</font></font> Ent√£o <br><br><ol><li>     <b>C</b> ,      .   <b>C</b>  <b>B</b>  (: Tc ‚Äî B). </li><li>     <b>C</b>  ,   <b>E</b> .     ,     (  ),   <b>E</b>  <b>B</b> . <br><br><img src="https://habrastorage.org/webt/oi/my/if/oimyif_nplc0auqsknrlbtatqe0.png" width="800"><br></li><li>     <b>E</b>   ,     ,    . <br><br><img src="https://habrastorage.org/webt/tn/44/ct/tn44ctwmh8zxmekxrr9y6sv4avm.png" width="800"><br></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observe que, para um pacote espec√≠fico, Tc e Te </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o </font><b><font style="vertical-align: inherit;">cumulativos</font></b><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, o tamanho do pacote de 8000 bytes n√£o vai funcionar, mesmo em um balde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© de 3.000 moedas, e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 7000. O </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o √© suficiente, na </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o √© o suficiente - n√≥s colocar um selo vermelho - shuruy aqui. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este √© um design muito elegante. Todo o tr√°fego que cai dentro da restri√ß√£o CIR + CBS m√©dia (o autor sabe que √© imposs√≠vel adicionar bits / se bytes t√£o diretamente) fica verde. Nos hor√°rios de pico, quando o cliente </font><font style="vertical-align: inherit;">fica </font><font style="vertical-align: inherit;">sem moedas no balde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ele ainda mant√©m o estoque de Te no balde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acumulado durante o tempo de inatividade </font><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, voc√™ pode pular um pouco mais, mas no caso de congestionamento, √© mais prov√°vel que eles sejam descartados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sr-TCM √© descrito na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 2697</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usado para polir no PHB AF. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, o √∫ltimo sistema √© o mais flex√≠vel e, portanto, complexo - Duas taxas - Tr√™s cores.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Marca√ß√£o de duas taxas - tr√™s cores </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O modelo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tr-TCM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nasceu da ideia de que n√£o √© em detrimento de outros usu√°rios e tipos de tr√°fego, por que n√£o dar ao cliente oportunidades um pouco mais agrad√°veis ‚Äã‚Äãou vender melhor. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos dizer a ele que ele tem garantia de 400 Mb / s e, se houver recursos gratuitos, 500. Voc√™ est√° pronto para pagar mais 30 rublos? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outro balde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P √©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adicionado </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - velocidade m√©dia garantida. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o mesmo tamanho de respingo permitido (volume </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C da</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ca√ßamba </font><font style="vertical-align: inherit;">). </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PIR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Peak Information Rate - velocidade m√©dia m√°xima. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EBS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - tamanho permitido de rajada durante picos (Volume da ca√ßamba </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diferentemente do sr-TCM, no tr-TCM, as moedas agora s√£o entregues de forma independente nos dois baldes. </font><font style="vertical-align: inherit;">Em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - com a velocidade do CIR, em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - PIR. </font></font><br><br><img src="https://habrastorage.org/webt/xd/gk/_d/xdgk_dfz6sd-mw6lsw_adkipcve.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quais s√£o as regras? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pacote de tamanho </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bytes </font><font style="vertical-align: inherit;">chega </font><font style="vertical-align: inherit;">.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se </font><font style="vertical-align: inherit;">n√£o houver </font><font style="vertical-align: inherit;">moedas </font><font style="vertical-align: inherit;">suficientes </font><font style="vertical-align: inherit;">no balde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o pacote ser√° marcado em vermelho. </font><font style="vertical-align: inherit;">As moedas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o </font><b><font style="vertical-align: inherit;">retiradas</font></b><font style="vertical-align: inherit;"> .</font></font> Caso contr√°rio: </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se </font><font style="vertical-align: inherit;">n√£o houver </font><font style="vertical-align: inherit;">moedas </font><font style="vertical-align: inherit;">suficientes </font><font style="vertical-align: inherit;">no balde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o pacote ser√° marcado em amarelo e as </font><font style="vertical-align: inherit;">moedas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B ser√£o retiradas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do balde </font><b><font style="vertical-align: inherit;">P.</font></b></font> Caso contr√°rio: </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O pacote est√° marcado em verde e as </font><font style="vertical-align: inherit;">moedas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B s√£o retiradas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dos </font><b><font style="vertical-align: inherit;">dois baldes</font></b><font style="vertical-align: inherit;"> .</font></font></li></ol><br><img src="https://habrastorage.org/webt/xz/ac/xl/xzacxlryw2kkvf1ms-nkgufteba.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, as regras no tr-TCM s√£o diferentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enquanto o tr√°fego estiver dentro da velocidade garantida, as moedas ser√£o removidas dos dois baldes. </font><font style="vertical-align: inherit;">Devido a isso, quando as </font><font style="vertical-align: inherit;">moedas acabarem </font><font style="vertical-align: inherit;">no balde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , elas permanecer√£o em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas apenas para n√£o exceder o PIR (se removidas apenas de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ent√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se encheria mais e daria uma velocidade muito mais r√°pida). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim, se estiver acima do garantido, mas abaixo do pico, as moedas s√£o removidas apenas de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , porque em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> j√° n√£o h√° nada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tr-TCM monitora n√£o apenas rajadas, mas tamb√©m uma velocidade de pico constante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tr-TCM √© descrito na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 2698</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tamb√©m usado para polimento em PHB AF. </font></font><br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Resumo do limite de velocidade </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enquanto moldar adia o tr√°fego quando excedido, o polimento o descarta. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A modelagem n√£o √© adequada para aplicativos sens√≠veis √† lat√™ncia e instabilidade. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para implementar o polimento em hardware, o algoritmo Token Bucket √© usado para modelar - Leaky Bucket. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Token Bucket pode ser:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com um balde - Taxa √∫nica - Marca√ß√£o de duas cores. </font><font style="vertical-align: inherit;">Permite rajadas v√°lidas.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com duas ca√ßambas - Taxa √∫nica - Marca√ß√£o de tr√™s cores (sr-TCM). </font><font style="vertical-align: inherit;">O excedente do balde C (CBS) √© derramado no balde E. Permite picos permitidos e redundantes.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com duas ca√ßambas - Marca√ß√£o de duas taxas - tr√™s cores (tr-TCM). </font><font style="vertical-align: inherit;">As ca√ßambas C e P (PBS) reabastecem independentemente em diferentes velocidades. </font><font style="vertical-align: inherit;">Permite velocidade m√°xima e rajadas permitidas e excessivas.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O sr-TCM concentra-se na quantidade de tr√°fego acima do limite. tr-TCM - na velocidade com que chega. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O polimento pode ser usado na entrada e na sa√≠da do dispositivo. A modelagem √© predominantemente na sa√≠da. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para PHB CS e EF, √© usada a marca√ß√£o de taxa √∫nica de duas cores. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para AF, sr-TCM ou tr-TCM. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para uma melhor compreens√£o, recomendo consultar a RFC original ou ler </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><blockquote>  Token Bucket     . ,       ,   ,       ,       . <br>     ,         ‚Äî ,  .   ,    ,       ,    ‚Äî  . <br>      ,     .          ‚Äî   .         . <br></blockquote><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acima, descrevi todos os mecanismos b√°sicos da QoS, se n√£o aprofundar na QoS hier√°rquica. </font><font style="vertical-align: inherit;">Um sistema sofisticado com muitas partes m√≥veis. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tudo estava bem (certo?) Soou at√© agora, mas o que est√° acontecendo sob o painel externo de baunilha do roteador? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao longo dos anos, os fornecedores adicionaram mais e mais contornos, desenvolveram chips sofisticados, buffers expandidos, por um lado, para acompanhar o crescente volume de tr√°fego e suas novas categorias e, por outro, para resolver os problemas crescentes causados ‚Äã‚Äãpelo primeiro par√°grafo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A corrida em andamento. </font><font style="vertical-align: inherit;">Os pacotes n√£o devem ser perdidos se o competidor n√£o os perder. </font><font style="vertical-align: inherit;">Voc√™ n√£o pode recusar a funcionalidade se um oponente estiver ao lado dele sob as portas do cliente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ida para o covil de propriedade!</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9. Implementa√ß√£o de QoS por hardware </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neste cap√≠tulo, assumo a tarefa ingrata. Se voc√™ o descrever da maneira mais simples poss√≠vel, sempre haver√° quem diga que nem tudo √© assim na realidade. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ o descrever como est√°, o leitor descartar√° o artigo, porque ele se tornar√° um desenho de um submarino, mais precisamente, desenhos de tr√™s barcos com l√°pis de cores diferentes em uma folha. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em geral, declaro que, na realidade, tudo n√£o √© o mesmo que na realidade, e irei de acordo com a vers√£o de uma apresenta√ß√£o simples. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perdoe-me, meu perfeccionista. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que controla o comportamento do n√≥ e aciona os mecanismos apropriados em rela√ß√£o ao pacote? A prioridade que ele tem em um dos t√≠tulos? Sim e n√£o </font></font><br><br><img src="https://habrastorage.org/webt/th/ie/l1/thiel1p000d6rgwchs-xo1hl4ys.png" width="250"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como mencionado acima, dentro de um dispositivo de rede, o cabe√ßalho de comuta√ß√£o padr√£o geralmente deixa de existir.</font></font><br><br><img src="https://habrastorage.org/webt/nj/h5/aq/njh5aquhoyypydjzrdttbespgr4.png" width="1000"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim que um pacote chega ao chip de comuta√ß√£o, os cabe√ßalhos s√£o removidos e enviados para an√°lise, e a carga √∫til permanece em algum tipo de buffer tempor√°rio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com base nos cabe√ßalhos, ocorre uma classifica√ß√£o (BA ou MF) e √© tomada uma decis√£o sobre o encaminhamento. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s um momento, um cabe√ßalho interno com metadados sobre o pacote fica pendurado no pacote. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esses metadados carregam muitas informa√ß√µes importantes - o endere√ßo do remetente e do receptor, o chip de sa√≠da, o n√∫mero de s√©rie da c√©lula, se houve fragmenta√ß√£o de pacotes e a marca√ß√£o de classe (CoS) e Preced√™ncia de queda s√£o obrigat√≥rias. Somente marca√ß√£o no formato interno - pode coincidir com o DSCP ou n√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em princ√≠pio, dentro da caixa, voc√™ pode definir um comprimento de marca√ß√£o arbitr√°rio sem estar vinculado aos padr√µes e definir a√ß√µes muito flex√≠veis com o pacote.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na Cisco, a marca√ß√£o interna √© chamada QoS Group, na Juniper - Forwarding Class, a Huawei n√£o decidiu: em algum lugar chama prioridades internas, em algum lugar prioridades locais, em algum lugar Service-Class e em algum lugar apenas CoS. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicione nomes para outros fornecedores nos coment√°rios - adicionarei.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Essa marca√ß√£o interna √© atribu√≠da com base na classifica√ß√£o que o n√≥ executou. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â importante que, a menos que seja indicado de outra forma, a rotulagem interna funcione apenas dentro do n√≥, mas n√£o apare√ßa na rotulagem nos cabe√ßalhos do pacote que ser√° enviado a partir do n√≥ - permanecer√° o mesmo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, na entrada do dom√≠nio DS ap√≥s a classifica√ß√£o, geralmente h√° uma nova marca√ß√£o em uma determinada classe de servi√ßo aceita nesta rede. Em seguida, a rotulagem interna √© convertida no valor aceito para esta classe na rede e √© registrada no cabe√ßalho do pacote que est√° sendo enviado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os r√≥tulos internos CoS e Drop Precedence definem o comportamento apenas dentro de um determinado n√≥ e n√£o s√£o explicitamente repassados ‚Äã‚Äãaos vizinhos, exceto pela re-rotulagem dos cabe√ßalhos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CoS e Preced√™ncia de Queda definem o PHB, seus mecanismos e par√¢metros: preven√ß√£o de congestionamentos, gerenciamento de congestionamentos, programa√ß√£o e remarca√ß√£o.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quais c√≠rculos passam os pacotes entre as interfaces de entrada e sa√≠da? Analisei em um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigo anterior</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Na verdade, acabou sendo programado, j√° que em algum momento ficou √≥bvio que, sem entender a arquitetura, era prematuro falar sobre QoS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, vamos repetir.</font></font><br><br><img src="https://habrastorage.org/webt/3k/s1/3e/3ks13e4uzagzrbopm5juuyun4j8.png" width="1000"><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O sinal atinge a interface de entrada f√≠sica e seu chip (PIC). </font><font style="vertical-align: inherit;">Um fluxo de bits flui dele e, em seguida, um pacote com todos os cabe√ßalhos.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao lado do chip de comuta√ß√£o de entrada (FE), onde os cabe√ßalhos s√£o separados do corpo do pacote. </font><font style="vertical-align: inherit;">A classifica√ß√£o ocorre e √© determinado para onde o pacote precisa ser enviado mais adiante.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao lado da fila de entrada (TM / VOQ). </font><font style="vertical-align: inherit;">J√° aqui os pacotes est√£o dispostos em diferentes filas com base em sua classe.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Al√©m da f√°brica de comuta√ß√£o (se houver). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ao lado da fila de sa√≠da (TM). </font></font></li><li>      (FE),    . </li><li>     (,    ) (PIC). </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, o roteador deve resolver uma equa√ß√£o complexa. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expanda tudo em classes, forne√ßa a algu√©m uma banda larga, algu√©m com baixa lat√™ncia, algu√©m que n√£o garanta perdas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E, ao mesmo tempo, tenha tempo para pular todo o tr√°fego, se poss√≠vel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, voc√™ precisa fazer a modelagem, possivelmente polindo. </font><font style="vertical-align: inherit;">Se ocorrer uma sobrecarga repentina, lide com ela. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E isso n√£o est√° contando as pesquisas, processamento ACL, contagem de estat√≠sticas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compartilhamento n√£o invej√°vel. </font><font style="vertical-align: inherit;">Mas rob√¥s injetam, n√£o um homem. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato, existem apenas dois locais onde os mecanismos de QoS funcionam - um chip de comuta√ß√£o e um chip / fila de Gerenciamento de Tr√°fego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao mesmo tempo, ocorrem opera√ß√µes no chip de comuta√ß√£o que requerem an√°lise ou a√ß√µes com cabe√ßalhos.</font></font><br><br><ul><li>  Classifica√ß√£o </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Polimento </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Remarca√ß√£o </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A TM cuida do resto. </font><font style="vertical-align: inherit;">Basicamente, s√£o opera√ß√µes de rotina com um algoritmo predefinido e par√¢metros personalizados:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Preven√ß√£o de congestionamento </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gerenciamento de congestionamento </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Moldar </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O TM √© um buffer inteligente, geralmente baseado em SD-RAM. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele √© inteligente porque, a) program√°vel, b) ele pode fazer todo tipo de coisas complicadas com filas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele √© frequentemente distribu√≠do - os chips SD-RAM est√£o localizados em cada placa de interface e, juntos, s√£o combinados no VOQ (Virtual Output Queue), que resolve o problema de bloqueio de chefe de linha. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O fato √© que, se o chip de comuta√ß√£o ou a interface de sa√≠da for bloqueada, eles pedem que o chip de entrada diminua a velocidade e n√£o envie tr√°fego por algum tempo. Se houver apenas uma fila em todas as dire√ß√µes, √© muito decepcionante que todos os outros sofram de uma interface de sa√≠da. Este √© o chefe da linha de bloqueio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O VOQ, na placa da interface de entrada, cria v√°rias filas de sa√≠da virtual para cada interface de sa√≠da existente.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, essas linhas de equipamentos modernos levam em considera√ß√£o a rotulagem da embalagem. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre o VOQ √© descrito em detalhes suficientes em uma s√©rie de notas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A prop√≥sito, eles s√£o realmente colocados na fila, est√£o sendo promovidos, n√£o s√£o os pr√≥prios pacotes que s√£o retirados deles, mas apenas os registros sobre eles. N√£o faz sentido fazer tantos gestos com grandes matrizes de bits. Enquanto a QoS est√° sendo ridicularizada nos registros, os pacotes est√£o perfeitamente em sua mem√≥ria e s√£o recuperados de l√° no endere√ßo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VOQ √© uma fila de software (o termo ingl√™s Fila de software √© mais preciso). Depois disso, imediatamente antes da interface, h√° tamb√©m uma fila de hardware, que sempre funciona estritamente de acordo com o FIFO. √â quase imposs√≠vel controlar qualquer um de seus par√¢metros (por exemplo, a Cisco permite configurar apenas a profundidade com o comando tx-ring-limit).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entre as filas de software e hardware, voc√™ pode executar expedidores arbitr√°rios. √â na fila do programa que o Head / Tail-drop e AQM, polindo e modelando, funcionam. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tamanho da fila de hardware √© muito pequeno (unidades de pacotes), porque o expedidor faz todo o trabalho de empilhar a taxa de linha. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infelizmente, aqui voc√™ pode fazer muitas reservas e, de fato, riscar tudo com uma caneta vermelha e dizer "o fornecedor X n√£o √© assim".</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gostaria de fazer mais um coment√°rio sobre os pacotes de servi√ßos. Eles s√£o tratados de maneira diferente dos pacotes de usu√°rio em tr√¢nsito. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sendo gerados localmente, eles n√£o s√£o verificados quanto √† conformidade com as regras da ACL e os limites de velocidade. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os pacotes externos destinados √† CPU do chip de comuta√ß√£o de sa√≠da caem em outras filas - para a CPU - com base no tipo de protocolo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, o BFD tem a prioridade mais alta, o OSPF pode esperar mais e o ICMP geralmente n√£o √© assustador. Ou seja, quanto mais importante for o pacote para a rede funcionar, maior ser√° sua classe de servi√ßo ao enviar para a CPU. √â por isso que √© normal observar atrasos variados no salto de tr√¢nsito no ping ou no rastreamento - o ICMP n√£o √© um tr√°fego priorit√°rio para a CPU. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, pacotes de protocolo s√£o aplicados</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CoPP - Control Plane Protection</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ou Policing) - limites de velocidade para evitar alta utiliza√ß√£o da CPU - novamente, quedas mais previs√≠veis nas filas de baixa prioridade antes do in√≠cio dos problemas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O CoPP ajudar√° tanto no DoS direcionado quanto no comportamento anormal da rede (por exemplo, loops) quando muito tr√°fego de broadcast come√ßar a chegar ao dispositivo.</font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Links √∫teis </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O melhor livro sobre a teoria e a filosofia da QoS: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">redes habilitadas para QOS: ferramentas e funda√ß√µes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alguns trechos podem ser lidos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas eu recomendaria a leitura de e para, sem troca.</font></font></li><li>         QoS  Huawei: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Special Edition QoS(v6.0)</a> .        PHB   . </li><li>    sr-TCM  tr-TCM  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Understanding Single-Rate and Dual-Rate Traffic Policing</a> . </li><li>  VOQ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">What is VOQ and why you should care?</a> </li><li>  QoS  MPLS: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MPLS and Quality of Service</a> . </li><li>     QoS   Juniper: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Juniper CoS notes</a> . </li><li>   QoS       TCP  UDP.       : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">The TCP/IP Guide</a> </li><li>    ,          ,       : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">         TCP</a> . </li><li>    ,        FQ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Queuing and Scheduling</a> . <br>      ,     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">An Introduction to Computer Networks</a> ,  ,     Introduction,      .    . <br></li><li>  WFQ  ,    , , ,   ,    : Weighted Fair Queueing: a packetized approximation for FFS/GP. <br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m h√° o mecanismo LFI, no qual n√£o toquei, porque tamb√©m √© dif√≠cil em nossas realidades de interfaces de cem gigabytes, mas pode ser interessante se familiarizar com: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmenta√ß√£o e intercala√ß√£o de links</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ul><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E, claro, a su√≠te RFC ...</font></font></b> <div class="spoiler_text"><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc791</a> ( <i>INTERNET PROTOCOL</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc1349</a> ( <i>Type of Service in the Internet Protocol Suite</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc1633</a> ( <i>Integrated Services in the Internet Architecture: an Overview</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc2474</a> ( <i>Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc2475</a> ( <i>An Architecture for Differentiated Services</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc2597</a> ( <i>Assured Forwarding PHB Group</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc2697</a> ( <i>A Single Rate Three Color Marker</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc2698</a> ( <i>A Two Rate Three Color Marker</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc3031</a> ( <i>Multiprotocol Label Switching Architecture</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc3168</a> ( <i>The Addition of Explicit Congestion Notification (ECN) to IP</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc3246</a> ( <i>An Expedited Forwarding PHB (Per-Hop Behavior)</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc3260</a> ( <i>New Terminology and Clarifications for Diffserv</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc3662</a> ( <i>A Lower Effort Per-Domain Behavior (PDB) for Differentiated Services</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc4594</a> ( <i>Configuration Guidelines for DiffServ Service Classes</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tools.ietf.org/html/rfc5462</a> ( <i>Multiprotocol Label Switching (MPLS) Label Stack Entry: ¬´EXP¬ª Field Renamed to ¬´Traffic Class¬ª Field</i> ) </li></ul><br></div></div><br><h1>  Conclus√£o </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta vers√£o teve muitos revisores. </font></font><br>  Obrigada <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fatin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;">LoxmatiyMamont</font></a><font style="vertical-align: inherit;"> ), por uma palavra introdut√≥ria e conselhos valiosos sobre a expressividade e clareza do texto. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander Clipper (@ metallicat20) por sua revis√£o por pares. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander Klimenko (@ v00lk) pelas cr√≠ticas duras e pelas mudan√ßas mais maci√ßas dos √∫ltimos dias. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andrey Glazkov (@glazgoo) por coment√°rios sobre estrutura, terminologia e v√≠rgulas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artyom Chernobay para KDPV. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anton Klochkov (@NAT_GTX) para contatos com Miran. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Miran (miran.ru) por organizar um servidor com Eva e transmitir. </font><font style="vertical-align: inherit;">Tradicionalmente, minha fam√≠lia, que, no entanto, desta vez sofreu menos por causa de sua aus√™ncia nos momentos mais dif√≠ceis.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt420525/">https://habr.com/ru/post/pt420525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt420515/index.html">Diariza√ß√£o baseada no modelo GMM-UBM e no algoritmo de adapta√ß√£o MAP</a></li>
<li><a href="../pt420517/index.html">Implementa√ß√£o de FPFT inteiro FFT</a></li>
<li><a href="../pt420519/index.html">Populariza√ß√£o da ci√™ncia</a></li>
<li><a href="../pt420521/index.html">Agora oficialmente: TLS 1.3 reconhecido como padr√£o</a></li>
<li><a href="../pt420523/index.html">An√°lise de gr√°ficos de op√ß√µes bin√°rias ou como mais uma vez provei para mim mesmo que brindes n√£o existem</a></li>
<li><a href="../pt420527/index.html">Um sorriso pode soar e √© contagioso</a></li>
<li><a href="../pt420529/index.html">Uso avan√ßado do Geeta ou como se aposentar seis meses antes?</a></li>
<li><a href="../pt420533/index.html">Emulando literais de propriedade com o Java 8 Method Reference</a></li>
<li><a href="../pt420537/index.html">Outra hist√≥ria de como o dinheiro √© relativamente honesto em um megafone</a></li>
<li><a href="../pt420539/index.html">Abordagem personalizada para normalizar e redefinir estilos (custom-reset.css)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>