<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ ğŸ‘©â€âš–ï¸ ğŸ¶ ä½¿ç”¨RoadRunnerå¯¹Magento Rest APIè¶…é¢‘ ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ ğŸŒ» â˜®ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åˆ›å»ºçš„PHPæ­»äº†ã€‚ ä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ï¼Œä½†æ˜¯æœ€è¿‘ä»–æ²¡æœ‰æœºä¼šè¿™æ ·åšã€‚ ä¸€å¹´å‰ï¼Œåœ¨ä¸­å¿ƒä¸Šï¼Œ å®£å¸ƒäº†RoadRunnerå·¥å…·ï¼Œè¿™è¿«ä½¿PHPè¿›ç¨‹ç¦»å¼€äº†æ­»äº¡å’Œå¤æ´»çš„æ— å°½å¾ªç¯ã€‚ 


 RoadRunnerçš„å·¥ä½œåŸç†æ˜¯ä¿æŒæ­£åœ¨è¿è¡Œçš„æµç¨‹å¹¶å‘å…¶ä¸­æŠ›å‡ºä¼ å…¥çš„è¯·æ±‚ï¼Œæ ¹æ®å¼€å‘äººå‘˜çš„è¯´æ³•ï¼Œè¿™å¯ä»¥æé«˜åº”ç”¨ç¨‹åºæ€§èƒ½ï¼ˆæœ‰æ—¶ç”šè‡³æ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨RoadRunnerå¯¹Magento Rest APIè¶…é¢‘</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466105/"><p><img src="https://habrastorage.org/webt/p2/kb/o0/p2kbo06xbl1z7zx0m4qyu1-jofe.jpeg" alt="ä½¿ç”¨RoadRunneråŠ é€ŸMagento"><br> åˆ›å»ºçš„PHPæ­»äº†ã€‚ ä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ï¼Œä½†æ˜¯æœ€è¿‘ä»–æ²¡æœ‰æœºä¼šè¿™æ ·åšã€‚ ä¸€å¹´å‰ï¼Œåœ¨ä¸­å¿ƒä¸Šï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®£å¸ƒäº†RoadRunnerå·¥å…·ï¼Œè¿™</a>è¿«ä½¿PHPè¿›ç¨‹ç¦»å¼€äº†æ­»äº¡å’Œå¤æ´»çš„æ— å°½å¾ªç¯ã€‚ </p><br><p>  RoadRunnerçš„å·¥ä½œåŸç†æ˜¯ä¿æŒæ­£åœ¨è¿è¡Œçš„æµç¨‹å¹¶å‘å…¶ä¸­æŠ›å‡ºä¼ å…¥çš„è¯·æ±‚ï¼Œæ ¹æ®å¼€å‘äººå‘˜çš„è¯´æ³•ï¼Œè¿™å¯ä»¥æé«˜åº”ç”¨ç¨‹åºæ€§èƒ½ï¼ˆæœ‰æ—¶ç”šè‡³æé«˜40å€ï¼‰ã€‚ </p><br><p>è‡ªä»æˆ‘ä¸Magentoä¸€èµ·å·¥ä½œäº†å¾ˆé•¿æ—¶é—´ä»¥æ¥ï¼Œä¼¼ä¹ä¸æ˜¯åœ¨ç¥è¯èˆ¬çš„æ¡†æ¶ä¸Šè€Œæ˜¯åœ¨ä¸€ä¸ªå®é™…çš„åº”ç”¨ç¨‹åºä¸Šæµ‹è¯•è¯¥å·¥å…·çš„å¥½ä¸»æ„ï¼ŒMagentoå¼€æºå¯¹æ­¤éå¸¸æœ‰ç”¨ã€‚ </p><a name="habracut"></a><br><h2 id="stoimost-inicializacii-magento-prilozheniya">  Magentoåº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–æˆæœ¬ </h2><br><p> åŠ é€ŸRoadRunneråº”ç”¨ç¨‹åºçš„æ–¹æ³•åŒ…æ‹¬é€šè¿‡å‡å°‘åˆå§‹åŒ–åº”ç”¨ç¨‹åºçš„å¼€é”€æ¥å‡å°‘å“åº”æ—¶é—´ï¼ˆåœ¨é¢„çƒ­å¯åŠ¨ä¹‹åï¼‰ã€‚ </p><br><p><img src="https://habrastorage.org/webt/mi/bt/ea/mibteawafee1aavgi4o1gz89u5y.jpeg" alt="Anton Tsitouçš„æ¼”ç¤ºæ–‡ç¨¿â€œä½¿ç”¨RoadRunnerè®¾è®¡æ··åˆGo / PHPåº”ç”¨ç¨‹åºâ€çš„å±å¹•æˆªå›¾"><br>  <em>Anton Tsitouçš„æ¼”ç¤ºæ–‡ç¨¿â€œä½¿ç”¨RoadRunnerè®¾è®¡æ··åˆGo / PHPåº”ç”¨ç¨‹åºâ€çš„å±å¹•æˆªå›¾</em> </p><br><p> ä»¥Magentoä¸ºä¾‹ï¼ŒèŠ±åœ¨å¯åŠ¨ä¸Šçš„ä¸»è¦æ—¶é—´æ˜¯ï¼š </p><br><ul><li> ä½œæ›²å®¶è‡ªåŠ¨åŠ è½½ </li><li> è‡ªä¸¾ </li></ul><br><p>  Composerè‡ªåŠ¨åŠ è½½å¹¶æœªå¼•èµ·æ³¨æ„ï¼Œå› ä¸ºå®ƒæ˜¯PHPåº”ç”¨ç¨‹åºçš„æ ‡å‡†é…ç½®ã€‚ </p><br><p><img src="https://habrastorage.org/webt/4_/ca/d0/4_cad0h0askyfnxnn6hdzlsrfbk.png" alt="ä¸Composerç›¸å…³çš„åˆ†æç»“æœã€‚"><br>  <em>ä¸Composerç›¸å…³çš„åˆ†æç»“æœã€‚</em> </p><br><p>  Magentoåº”ç”¨ç¨‹åºå¼•å¯¼åŒ…æ‹¬åˆå§‹åŒ–é”™è¯¯å¤„ç†ç¨‹åºï¼Œæ£€æŸ¥åº”ç”¨ç¨‹åºçŠ¶æ€<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç­‰ã€‚</a> </p><br><p> æœ€éš¾çš„éƒ¨åˆ†æ˜¯IoCå®¹å™¨ï¼ˆç”¨Magentoè¡¨ç¤ºâ€œ ObjectManagerâ€ï¼‰çš„åˆå§‹åŒ–ä»¥åŠé€šè¿‡å®ƒæ¥é€’å½’åˆ›å»ºä¾èµ–é¡¹å®ä¾‹ä»¥è·å¾—åº”ç”¨ç¨‹åºå¯¹è±¡ã€‚ </p><br><p><img src="https://habrastorage.org/webt/ww/88/ag/ww88ag1xoy2gv61wndt7mudf430.png" alt="ä¸å¼•å¯¼ç›¸å…³çš„åˆ†æç»“æœã€‚"><br>  <em>ä¸å¼•å¯¼ç›¸å…³çš„åˆ†æç»“æœã€‚</em> </p><br><h2 id="vnedrenie-roadrunner">  RoadRunnerå®æ–½ </h2><br><p> è¦å¯åŠ¨RoadRunnerï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªå·¥ä½œå™¨ï¼Œå…¶ä¸­å°†åŒ…å«ä¸€ä¸ªç”¨äºæ¥å—ä¼ å…¥è¯·æ±‚å’Œå‘é€å“åº”çš„å¾ªç¯ã€‚ æ­¤å¤–ï¼Œè¯¥å·¥å…·å¯ä¸å®æ–½PSR-7çš„è¯·æ±‚å’Œç­”æ¡ˆé…åˆä½¿ç”¨ã€‚ ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£çœ‹ï¼Œ</a>å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($req = $psr7-&gt;acceptRequest()) { $resp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Zend\Diactoros\Response(); $resp-&gt;getBody()-&gt;write(<span class="hljs-string"><span class="hljs-string">"hello world"</span></span>); $psr7-&gt;respond($resp); }</code> </pre> <br><h2 id="magento-i-psr-7">  Magentoå’ŒPSR-7 </h2><br><p>  Magentoå°šæœªå®ç°PSR-7ï¼Œå¼€ç®±å³ç”¨åœ°ä½¿ç”¨å…¶è¯·æ±‚å’Œå“åº”å®ç°ï¼Œå®ƒä»¬çš„æ–¹æ³•ä¸»è¦æ¥è‡ªäºå…ˆå‰çš„ç‰ˆæœ¬ã€‚ </p><br><p> ä¸ºäº†å®ç°RoadRunnerï¼Œæ‚¨éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå…¥å£ç‚¹ï¼Œè¯¥å…¥å£ç‚¹å°†ä»¥æŸç§å½¢å¼æ¥å—è¯·æ±‚å¹¶è¿”å›å“åº”ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://github.com/symfony/">Symfonyç¤ºä¾‹</a> ï¼‰ã€‚ </p><br><p>  <em>Magento \ Magento \ Framework \ AppInterface</em>ä¸­æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåªæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¯¥æ¥å£å¹¶éæ—¨åœ¨æ¥å—è¯·æ±‚ã€‚ ä½†æ˜¯ï¼Œç­‰ç­‰ï¼Œå®ƒä»å“ªé‡Œè¿›å…¥åº”ç”¨ç¨‹åºï¼Ÿ å€¼å¾—å›é¡¾çš„åˆè¡·<em>æ˜¯PHPçš„è¯ç”Ÿ</em> ã€‚ å› æ­¤ï¼Œåœ¨è®¾è®¡å’Œåˆ’åˆ†å±‚æ—¶ï¼Œç»å¤§å¤šæ•°åº“ï¼Œç¨‹åºåŒ…å’Œæ¡†æ¶éƒ½åªæ˜¯ç®€å•åœ°ä¸è®¤ä¸ºè¯¥è¯·æ±‚ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå…¨å±€è¯·æ±‚ã€‚ </p><br><p>  Magentoä¼ è¾“å±‚åŸºäºç›¸åŒçš„åŸç†æ„å»ºã€‚ å°½ç®¡æ–‡æ¡£<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æè¿°äº†å¯æ³¨å…¥å¯¹è±¡/å¯æ›´æ–°å¯¹è±¡ä¹‹é—´çš„å·®å¼‚</a> ï¼Œä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬å·²å°†è¯·æ±‚ç”¨ä½œå…¨å±€æœ‰çŠ¶æ€æœåŠ¡ï¼Œè¯¥æœåŠ¡ä»å…¨å±€å˜é‡ï¼ˆ$ _GETï¼Œ$ _POSTï¼‰åˆå§‹åŒ–è‡ªèº«ã€‚ é™¤äº†æ‰€æœ‰è¿™äº›ï¼Œå¯ä»¥åœ¨å†…æ ¸æœ¬èº«çš„åº”ç”¨ç¨‹åºçš„å„ä¸ªçº§åˆ«ä¸Šçœ‹åˆ°æ­¤æœåŠ¡çš„æ³¨å…¥ï¼Œæ›´ä¸ç”¨è¯´ç¬¬ä¸‰æ–¹æ¨¡å—çš„è´¨é‡äº†ã€‚ </p><br><p> åŸºäºä¸Šè¿°å†…å®¹ï¼Œäººä»¬å¸Œæœ›ä»…é€šè¿‡å°†è¯·æ±‚ä»PSR-7æ ·å¼è½¬æ¢ä¸ºMagentoæ ·å¼æ¥å®æ–½RoadRunnerã€‚ </p><br><h2 id="vnedrenie-psr-7-adaptera"> å®æ–½PSR-7é€‚é…å™¨ </h2><br><p> è€ƒè™‘åˆ°æ”¶åˆ°çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬åˆ¶å®šé—®é¢˜ã€‚ <br> æˆ‘æƒ³è¦ä¸€ä¸ªå¯ä»¥æ¥å—PSR-7è¯·æ±‚å¹¶è¿”å›PSR-7å“åº”çš„ç‰¹å®šåº”ç”¨ç¨‹åºæ¥å£ã€‚ è¿˜å¿…é¡»åˆ›å»ºä¸€ä¸ªå·²åˆ›å»ºæ¥å£çš„å®ç°ï¼Œä»¥ä½¿æ­¤äº¤äº’æ ¼å¼é€‚åˆMagentoåº”ç”¨ç¨‹åºã€‚ </p><br><p><img src="https://habrastorage.org/webt/ep/bg/ix/epbgix0lny5de_sx36up92v71fc.png" alt="PSR-7é€‚é…å™¨"><br>  <em>PSR-7é€‚é…å™¨</em> </p><br><p> å¦‚ä¸Šæ‰€è¿°ï¼Œmagentoåº”ç”¨ç¨‹åºå·²ç»è¿”å›äº†å“åº”ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å°†å…¶è½¬æ¢ä¸ºPSR-7æ ¼å¼å³å¯ã€‚ </p><br><p> å¯¹äºè¯·æ±‚ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªç±»æ¥ä»£ç†å¯¹å½“å‰è¯·æ±‚å¯¹è±¡çš„æ‰€æœ‰è°ƒç”¨ï¼Œè¯¥ç±»å°†æˆ‘ä»¬æ”¾å…¥ä¸€ä¸ªç‰¹æ®Šçš„å¯„å­˜å™¨ä¸­ï¼ˆæ˜¯çš„ï¼Œä½“ç³»ç»“æ„ä¹‹ç¥ä¼šåŸè°…æ­¤å˜æ€ï¼‰ã€‚ å¦å¤–ï¼Œå‘ç°è¯·æ±‚ç±»ä¸æ˜¯3ä¸ªï¼Œè€Œæ˜¯1ä¸ªï¼Œå› æ­¤è¦æ±‚é€šè¿‡å®¹å™¨çš„IoCé…ç½®å¯¹å…¶è¿›è¡Œé‡æ–°æ³¨å†Œã€‚ </p><br><p><img src="https://habrastorage.org/webt/5o/ep/nd/5oepndag_2d8xwlmw7q7rbysmpa.png" alt="Magentoä¸­ç”¨äºæŸ¥è¯¢çš„ä¸€ç»„ç±»"><br>  <em>Magentoä¸­ç”¨äºæŸ¥è¯¢çš„ä¸€ç»„ç±»</em> </p><br><h2 id="problemy-neumirayuschego-php-prilozheniya"> ä¸€ä¸ªä¸æœ½çš„PHPåº”ç”¨ç¨‹åºçš„é—®é¢˜ </h2><br><p> é€šè¿‡RoadRunnerå¯åŠ¨çš„åº”ç”¨ç¨‹åºä¸ä»»ä½•é•¿æœŸå­˜åœ¨çš„phpè¿›ç¨‹éƒ½å­˜åœ¨ç›¸åŒçš„é—®é¢˜ï¼Œåœ¨æ–‡æ¡£ä¸­å¯¹æ­¤è¿›è¡Œäº†æè¿°ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://roadrunner.dev/docs/usage-production</a> ï¼‰ </p><br><p> å¼€å‘äººå‘˜åº”ç›‘è§†çš„åº”ç”¨ç¨‹åºçº§åˆ«çš„ä¸»è¦é—®é¢˜æ˜¯ï¼š </p><br><ul><li> å†…å­˜æ³„æ¼ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.php.net/manual/ru/features.gc.php</a> ï¼‰ </li><li> æ•°æ®åº“è¿æ¥ï¼ˆçªç„¶ï¼‰å¯èƒ½ä¼šè¶…æ—¶ï¼Œå°±åƒå…¶ä»–ä»»ä½•è¿æ¥ä¸€æ ·æ‰çº¿ </li><li> ä¸»ç®¡å›½å®¶ç®¡ç† </li></ul><br><p> åœ¨Magentoçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œåº”è¯¥ç‰¹åˆ«æ³¨æ„çŠ¶æ€ç®¡ç†ï¼Œå› ä¸ºåœ¨å†…æ ¸å’Œç¬¬ä¸‰æ–¹æ¨¡å—ä¸­ï¼Œåœ¨æœåŠ¡å†…éƒ¨ç¼“å­˜å½“å‰ç”¨æˆ·/äº§å“/ç±»åˆ«æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æ–¹æ³•ã€‚ </p><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustomer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: ?</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomerInterface</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;customer) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;customerSession-&gt;isLoggedIn()) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;customer = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;customerRepository-&gt;getById(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;customerSession-&gt;getCustomerId()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;customer; }</code> </pre> <br><p>  <em>å†…æ ¸ä½¿ç”¨å¯¹è±¡çŠ¶æ€çš„æ–¹æ³•çš„ç¤ºä¾‹ã€‚</em> </p><br><h2 id="zapusk-magento-rest-api-servera-cherez-roadrunner"> é€šè¿‡RoadRunnerè¿è¡ŒMagento Rest APIæœåŠ¡å™¨ </h2><br><p> è€ƒè™‘åˆ°å…¨çƒçŠ¶æ€çš„æ½œåœ¨é—®é¢˜ï¼ŒåŸºäºå¼€å‘Magentoå‰ç«¯éƒ¨åˆ†çš„ç»éªŒï¼Œé€‰æ‹©äº†æœ€åˆé€‚ï¼Œæœ€è½»æ¾çš„WebApiéƒ¨åˆ†è¿›è¡Œå‘å¸ƒã€‚ </p><br><p> é¦–å…ˆè¦åšçš„æ˜¯åˆ›å»ºæˆ‘ä»¬çš„å·¥ä½œäººå‘˜ï¼Œè¯¥å·¥ä½œäººå‘˜å°†åœ¨RoadRunnerä¸Šè¿è¡Œå¹¶æ— é™æœŸåœ°ï¼ˆå‡ ä¹ï¼‰ç”Ÿæ´»ã€‚ ä¸ºæ­¤ï¼Œè¯·ä»RoadRunneræŒ‡å—ä¸­è·å–ä¸€æ®µä»£ç ï¼Œç„¶åå°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåŒ…è£…åœ¨ä¸€ä¸ªPSR-7é€‚é…å™¨ä¸­ã€‚ </p><br><pre> <code class="php hljs">$relay = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamRelay(STDIN, STDOUT); $psr7 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PSR7Client(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Worker($relay)); $bootstrap = \Magento\Framework\App\Bootstrap::create(BP, []); <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \Magento\Framework\App\Http $app */</span></span> $app = $bootstrap-&gt;createApplication(\Magento\Framework\App\Http::class); <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> ApplicationInterface $psr7Application */</span></span> $psr7Application = $bootstrap-&gt;getObjectManager()-&gt;create( \Isxam\M2RoadRunner\Application\MagentoAppWrapper::class, [ <span class="hljs-string"><span class="hljs-string">'magentoApp'</span></span> =&gt; $app ] ); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($request = $psr7-&gt;acceptRequest()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $response = $psr7Application-&gt;handle($request); $psr7-&gt;respond($response); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (\Throwable $e) { $psr7-&gt;getWorker()-&gt;error((string)$e); } }</code> </pre> <br><p>  <em>whileå¾ªç¯ä¹‹å‰çš„ä»£ç å°†åœ¨workerçš„å¼€å¤´æ‰§è¡Œï¼Œå…¶ä¸­åŒ…å«å¾ªç¯å†…çš„æ‰€æœ‰å†…å®¹-ä»¥åŠæ¯ä¸ªæ–°è¯·æ±‚ã€‚</em> </p><br><p> å·¥ä½œäººå‘˜å‡†å¤‡å°±ç»ªåï¼Œæˆ‘ä»¬å°†ç»§ç»­é…ç½®ç”¨Goç¼–å†™çš„RoadRunneræœåŠ¡å™¨ã€‚ è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œè€Œä¸”å¾ˆå¿«ï¼Œåªéœ€è¦ä¸‹è½½ä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶çš„composerç¨‹åºåŒ…å°±å¯ä»¥äº†ã€‚ æˆ‘ä»¬åˆ›å»ºæœåŠ¡å™¨çš„é…ç½®-æœ€ç®€å•çš„é…ç½®å¦‚ä¸‹æ‰€ç¤ºã€‚ </p><br><pre> <code class="plaintext hljs">http: address: 0.0.0.0:8086 workers: command: "php worker.php" pool: numWorkers: 1</code> </pre> <br><p>  <em>RoadRunneré…ç½®ã€‚</em> </p><br><p> è¯¥æ–‡æ¡£åŒ…å«å¤§é‡è®¾ç½®ï¼Œå¯è®©æ‚¨çµæ´»åœ°é…ç½®æœåŠ¡å™¨ï¼Œä»¥å…å‡ºç°å®Œå…¨ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶çš„æ„¿æœ›ã€‚ </p><br><pre> <code class="bash hljs">./rr serve -v -d</code> </pre> <br><p>  <em>æœåŠ¡å™¨å¯åŠ¨</em> </p><br><h2 id="testirovanie-resheniya"> è§£å†³æ–¹æ¡ˆæµ‹è¯• </h2><br><h3 id="instrumenty"> å·¥å…· </h3><br><p> ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬ä»¥ç®€å•çš„ä¸œè¥¿ä¸ºä¾‹ï¼Œä¾‹å¦‚artillery.ioã€‚ </p><br><p> æˆ‘ä»¬å°†åœ¨ä¸€ä¸ªç”¨æˆ·é¡ºåºæ‰§è¡ŒæŸ¥è¯¢çš„å¸®åŠ©ä¸‹æµ‹è¯•æ€§èƒ½ï¼ˆRoadRunnerè¿˜æ”¯æŒå¤šä¸ªçº¿ç¨‹ä¸­çš„æŸ¥è¯¢æ‰§è¡Œï¼Œæˆ‘ä»¬å°†æŠŠè¿™ä¸ªé—®é¢˜ç•™ç»™å…¶ä»–ç ”ç©¶äººå‘˜ä½¿ç”¨ï¼‰ </p><br><p> åœ¨è¾“å…¥ä¸­ï¼Œæˆ‘ä»¬æ‹¥æœ‰å¸¦æœ‰ä¸¤ä¸ªç¯å¢ƒçš„ç«ç‚®é…ç½®æ–‡ä»¶-Apacheå’ŒRoadRunnerã€‚ å®ƒä»¬éƒ½ä½¿ç”¨ç›¸åŒçš„Magentoå®ä¾‹ï¼Œå› æ­¤åœ¨è¿™é‡Œå®ƒä»¬å¤„äºå¹³ç­‰çš„åœ°ä½ã€‚ </p><br><h3 id="testovye-scenarii"> æµ‹è¯•åœºæ™¯ </h3><br><p> ä»¥ä¸‹æ–¹æ¡ˆç”¨äºè¡¡é‡ä¸¤ç§è§£å†³æ–¹æ¡ˆçš„æ€§èƒ½ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ–¹æ¡ˆ1.åˆ›å»ºç±»åˆ«</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> - name: "S1. Create category" flow: - loop: - post: url: "/rest/V1/categories" json: category: name: "name-{{prefix}}-{{ $loopCount }}" parent_id: 2 is_active: true count: 100</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">æ–¹æ¡ˆ2.è·å–å›½å®¶åˆ—è¡¨</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> - name: "S2. Countries list" flow: - loop: - get: url: "/rest/V1/directory/countries" count: 100</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">æ–¹æ¡ˆ3ï¼šåˆ—å‡ºäº§å“ç±»å‹</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> - name: "S3. Product types list" flow: - loop: - get: url: "/rest/V1/products/types" count: 100</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">æ–¹æ¡ˆ4.è·å–å±æ€§é›†åˆ—è¡¨</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> - name: "S4. Product attribute sets list" flow: - loop: - get: url: "/rest/V1/products/attribute-sets/sets/list?searchCriteria" count: 100</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">æ–¹æ¡ˆ5.è·å–ç±»åˆ«</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> - name: "S5. Category get" flow: - loop: - get: url: "/rest/V1/categories/2" count: 100</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">æ–¹æ¡ˆ6.äº§å“åˆ›å»º</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> - name: "S6. Create product" flow: - loop: - post: url: '/rest/V1/products' json: product: sku: "sku-{{prefix}}-{{ $loopCount }}" name: "name-{{prefix}}-{{ $loopCount }}" attribute_set_id: 4 price: 100 type_id: "simple" count: 100</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">æ–¹æ¡ˆ7.æ£€ç´¢äº§å“åˆ—è¡¨</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> - name: "S7. Get product list" flow: - loop: - get: url: "/rest/V1/products?searchCriteria[pageSize]=20" count: 100</code> </pre> </div></div><br><h3 id="rezultat"> ç»“æœ </h3><br><p> é€šè¿‡RoadRunnerå’ŒApacheäº¤æ›¿è¿è¡Œæ‰€æœ‰è„šæœ¬åï¼Œè·å¾—äº†æŸ¥è¯¢æŒç»­æ—¶é—´çš„ä¸­ä½æ•°ã€‚ æ ¹æ®ä¸­ä½æ•°ï¼Œæ‰€æœ‰æ–¹æ¡ˆçš„é€Ÿåº¦å¤§çº¦ç›¸å·®çº¦50msã€‚ </p><br><p><img src="https://habrastorage.org/webt/fa/fv/yh/fafvyh1ntgsdywljqiey9a7pqok.png" alt="æ€§èƒ½æµ‹è¯•ç»“æœã€‚"><br>  <em>æ€§èƒ½æµ‹è¯•ç»“æœã€‚</em> </p><br><h2 id="itog"> æ€»ç»“ </h2><br><p> ä¸€ä¸ªåŠ¨æ‰‹å®éªŒè¯å®äº†æœ‰å…³ç‰¹å®šåº”ç”¨ç¨‹åºä¸ŠRoadRunneræ€§èƒ½ç¨³å®šå¢é•¿çš„å‡è®¾ã€‚ ä½¿ç”¨æ­¤å·¥å…·å¯ä»¥ä½¿åº”ç”¨ç¨‹åºè¯·æ±‚çš„å¤„ç†é€Ÿåº¦ä¿æŒæ’å®šï¼Œè¯¥å¸¸æ•°ç­‰äºç¯å¢ƒå’Œä¾èµ–é¡¹çš„åˆå§‹åŒ–æ—¶é—´ã€‚ </p><br><p> åœ¨è½»é‡çº§å¤„ç†ç¨‹åºä¸Šï¼Œè¿™ä½¿æ‚¨æœ‰æ—¶å¯ä»¥åŠ å¿«åº”ç”¨ç¨‹åºçš„é€Ÿåº¦ï¼Œè€Œåœ¨é‡åº¦ä¸Šå‡ ä¹æ— æ³•äº§ç”Ÿæ˜æ˜¾çš„æ•ˆæœã€‚ å¦‚æœæ‚¨çš„ä»£ç å¾ˆæ…¢ï¼Œé‚£ä¹ˆè½¦å‰è‰å¾ˆå¯èƒ½ä¸ä¼šå¸®åŠ©ä»–ã€‚ </p><br><p> å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå†™å¾—å¾ˆå¥½ï¼Œé‚£ä¹ˆé€šè¿‡RoadRunnerè¿›è¡Œæ“ä½œçš„æ“ä½œå¾ˆå¯èƒ½ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœåº”ç”¨ç¨‹åºéœ€è¦è¿›è¡Œæ”¹ç¼–ä»¥ç”¨äºRoadRunnerï¼Œåˆ™å¾ˆå¯èƒ½åœ¨æ²¡æœ‰RoadRunnerçš„æƒ…å†µä¸‹ä¹Ÿéœ€è¦åŒæ ·çš„æ“ä½œï¼Œä»¥ä¾¿æ›´æ¸…æ¥šåœ°è§‚å¯Ÿä½“ç³»ç»“æ„çš„å„ä¸ªå±‚å¹¶éµå®ˆè¯¥é¢†åŸŸçš„å¼€å‘æ ‡å‡†ã€‚ </p><br><p>  Magentoå¼€æºé€šå¸¸é€‚åˆåœ¨ç»™å®šç¯å¢ƒä¸­å¯åŠ¨ï¼Œä½†æ˜¯ï¼Œå®ƒéœ€è¦æ”¹è¿›ä¼ è¾“å±‚å¹¶æ›´æ­£ä¸šåŠ¡é€»è¾‘ï¼Œä»¥é˜²æ­¢åœ¨åŒä¸€è¿‡ç¨‹ä¸­é‡å¤è¯·æ±‚æœŸé—´å‡ºç°é”™è¯¯è¡Œä¸ºã€‚ è€Œä¸”ï¼Œä½¿ç”¨RoadRunnerä¼šå¯¹å¼€å‘æ–¹æ³•æ–½åŠ æŸäº›é™åˆ¶ï¼Œä½†æ˜¯ï¼Œå®ƒä»¬ä¸å…¬è®¤çš„æƒ¯ä¾‹å¹¶ä¸çŸ›ç›¾ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æœ€åæ˜¯ä¸€ä¸ªä¸é”™çš„å±å¹•æˆªå›¾ã€‚</b>  <b class="spoiler_title">æ‚¨ä½•æ—¶ä»ä¼šåœ¨æ­¤å“åº”æ—¶é—´çœ‹åˆ°Magentoè¯·æ±‚ï¼Ÿ</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/0y/_y/bx/0y_ybxrixvx7ftceche2zd-u1ew.jpeg" alt="éœ‡æ’¼"></p></div></div><br><h2 id="ssylki"> å‚è€ƒæ–‡çŒ® </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« ä¸­çš„ç¤ºä¾‹</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RoadRunnerå®˜æ–¹ç½‘ç«™</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN466105/">https://habr.com/ru/post/zh-CN466105/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN466089/index.html">æ€ç»´ä¸æ„è¯†ç®—æ³•ï¼Œç¬¬2éƒ¨åˆ†</a></li>
<li><a href="../zh-CN466093/index.html">kubectl execå¦‚ä½•å·¥ä½œï¼Ÿ</a></li>
<li><a href="../zh-CN466097/index.html">ç›‘è§†.NETåº”ç”¨ç¨‹åº</a></li>
<li><a href="../zh-CN466099/index.html">æµ‹è¯•ç”¨äºè§†é¢‘æœåŠ¡çš„Webåº”ç”¨ç¨‹åºçš„åŠŸèƒ½</a></li>
<li><a href="../zh-CN466103/index.html">äº‘å®‰å…¨ç›‘æ§</a></li>
<li><a href="../zh-CN466107/index.html">è‡ªå·±åŠ¨æ‰‹çš„æ™ºèƒ½å®¶å±…ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN466109/index.html">ä½¿ç”¨pwnable.kr 22è§£å†³é—®é¢˜-Brainfuckã€‚ Ret2libcæ”»å‡»</a></li>
<li><a href="../zh-CN466111/index.html">åŸ¹è®­Cisco 200-125 CCNA v3.0ã€‚ ç¬¬32å¤©ã€‚å¯†ç æ¢å¤ï¼ŒXMODEM / TFTPDNLDå’Œæ€ç§‘è®¸å¯è¯æ¿€æ´»</a></li>
<li><a href="../zh-CN466113/index.html">åœ¨PHPä¸­å®šä¹‰æ–‡æœ¬ç¼–ç ï¼Œè€Œä¸æ˜¯mb_detect_encoding</a></li>
<li><a href="../zh-CN466121/index.html">ä½¿ç”¨æ”¯æŒå¤éŸ³çš„æ³¢è¡¨æ–¹æ³•åœ¨AVRå¾®æ§åˆ¶å™¨ä¸Šç”Ÿæˆå£°éŸ³</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>