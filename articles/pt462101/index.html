<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÖ üö¥üèº ü§∂üèæ Relat√≥rio do Java Virtual Machine Language Summit 2019 ü§ûüèª ‚ûø üêò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoje terminou a d√©cima segunda JVM LS Summit. Como sempre, foi um evento hardcore com apresenta√ß√µes t√©cnicas em m√°quinas virtuais e os idiomas que s√£o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Relat√≥rio do Java Virtual Machine Language Summit 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/JetBrains/blog/462101/"><img src="https://habrastorage.org/webt/nh/xk/cf/nhxkcfgwiztaulvnbccwhxgcpwe.png" align="right" width="250"><br><p>  Hoje terminou a d√©cima segunda <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JVM LS</a> Summit.  Como sempre, foi um evento hardcore com apresenta√ß√µes t√©cnicas em m√°quinas virtuais e os idiomas que s√£o executados nelas.  Como de costume, a c√∫pula foi realizada em Santa Clara, no campus da Oracle.  Como sempre, h√° muito mais pessoas que desejam chegar aqui do que lugares: o n√∫mero de participantes n√£o excede 120. Como sempre, n√£o houve marketing, apenas miudezas. </p><br><p>  Esta c√∫pula j√° √© a terceira para mim, e toda vez que a visito com grande prazer, apesar do terr√≠vel jetlag.  Aqui voc√™ pode ouvir n√£o apenas relat√≥rios, mas tamb√©m conhecer pessoas melhores do mundo da JVM, participar de conversas informais, fazer perguntas em workshops e geralmente se sente envolvido em grandes realiza√ß√µes. </p><br><p>  Se voc√™ n√£o compareceu √† c√∫pula, isso n√£o importa.  A maioria dos relat√≥rios √© publicada no YouTube quase imediatamente ap√≥s a c√∫pula.  Na verdade, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">eles j√° est√£o dispon√≠veis</a> .  Para facilitar a navega√ß√£o, descreverei brevemente aqui todos os relat√≥rios e workshops que consegui participar. </p><a name="habracut"></a><br><h1>  29 de julho </h1><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ghadi Shayban - Futuros de Clojure</a> </h1><br><p> N√£o se trata dos recursos da compila√ß√£o do futuro na linguagem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Clojure</a> , como muitos pensavam, mas simplesmente do desenvolvimento da linguagem, dos meandros da gera√ß√£o de c√≥digo e dos problemas que eles encontram.  Por exemplo, no Clojure, √© importante anular vari√°veis ‚Äã‚Äãlocais ap√≥s o √∫ltimo uso, porque, se o cabe√ßalho de uma lista que √© gerado lentamente em uma vari√°vel local, ignorando-o, os n√≥s que j√° foram ignorados podem n√£o ser coletados pelo coletor de lixo e o programa pode falhar com o OutOfMemory .  Em geral, o pr√≥prio compilador C2 JIT libera as vari√°veis ‚Äã‚Äãap√≥s o √∫ltimo uso, mas o padr√£o n√£o garante isso e, por exemplo, o interpretador HotSpot n√£o. </p><br><p>  Tamb√©m foi interessante aprender sobre a implementa√ß√£o do despacho din√¢mico de chamadas de fun√ß√£o.  Tamb√©m aprendi que, at√© recentemente, Clojure estava direcionado √† JVM 6 e somente recentemente mudou para a JVM 8. Agora, os autores do compilador analisam o invokedynamic. </p><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Alan Bateman e Rickard B√§ckman - Atualiza√ß√£o do Projeto Loom</a> </h1><br><p>  O projeto Loom √© uma fibra leve para Java.  Um ano atr√°s, Alan e Ron j√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conversaram</a> sobre esse projeto, e ent√£o parecia que tudo estava indo muito bem e estava prestes a ficar pronto.  No entanto, esse projeto ainda n√£o entrou oficialmente no Java e ainda est√° sendo desenvolvido em uma bifurca√ß√£o separada do reposit√≥rio.  Obviamente, foi necess√°rio resolver muitos detalhes. </p><br><p>  Muitas APIs padr√£o de ReentrantLock.lock a Socket.accept j√° est√£o adaptadas para fibras: se essa chamada for feita dentro de uma fibra, o estado de execu√ß√£o ser√° salvo, a pilha ser√° desenrolada e o encadeamento do sistema operacional ser√° liberado para outras tarefas at√© que um evento desperte a fibra (por exemplo, ReentrantLock.unlock).  No entanto, por exemplo, o bom e velho bloco sincronizado ainda n√£o funciona e, ao que parece, n√£o h√° como refatorar seriamente todo o suporte √† sincroniza√ß√£o na JVM.  Outro desenrolamento da pilha n√£o funcionar√° se houver quadros nativos na pilha entre o in√≠cio da fibra e o ponto de interrup√ß√£o.  Nos dois casos, nada explode, mas a fibra n√£o libera o fluxo. </p><br><p>  H√° muitas perguntas sobre como o Fiber se compara √† antiga classe java.lang.Thread.  H√° um ano, havia uma id√©ia de fazer do Fiber uma subclasse de Thread.  Agora eles a recusaram e a tornaram uma entidade independente, porque emular em todas as fibras todo o comportamento de um fluxo regular √© bastante caro.  Nesse caso, Thread.currentThread () dentro da fibra retornar√° o blende gerado, e n√£o o encadeamento real no qual tudo √© executado.  Mas o obst√°culo se comportar√° muito bem (embora possa retardar o trabalho).  A id√©ia importante √© nunca fornecer o fluxo de m√≠dia real no qual a fibra est√° sendo executada dentro da fibra.  Isso pode ser perigoso, pois uma fibra pode ser movida facilmente para outro segmento.  A decep√ß√£o continuar√°. </p><br><p>  √â curioso que os participantes do projeto j√° tenham introduzido algumas altera√ß√µes preparat√≥rias no reposit√≥rio principal do JDK para facilitar sua vida.  Por exemplo, no Java 13, o m√©todo doPrivileged foi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reescrito</a> inteiramente a partir do c√≥digo nativo em Java, obtendo um aumento de cerca de 50 vezes no desempenho.  Por que este √© um projeto Loom?  O fato √© que esse m√©todo espec√≠fico muitas vezes aparece no meio da pilha e, embora fosse nativo, as fibras dessa pilha n√£o pararam.  De uma forma ou de outra, o projeto j√° est√° se beneficiando. </p><br><p>  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina do projeto,</a> voc√™ pode ler a documenta√ß√£o e fazer o download da √°rvore de origem, e tamb√©m existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">assemblies bin√°rios</a> que voc√™ pode executar e reproduzir hoje.  Esperamos que nos pr√≥ximos anos tudo seja integrado. </p><br><h1>  Brian Goetz - Workshop "Projeto √Çmbar" </h1><br><p> Paralelamente, estava sendo realizado um workshop sobre o projeto Loom, mas eu fui para Amber.  Aqui discutimos brevemente os objetivos do projeto e os principais PEC em que o trabalho est√° em andamento - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">correspond√™ncia de padr√µes</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">registros</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tipos selados</a> .  Ent√£o toda a discuss√£o caiu na quest√£o privada do escopo.  Eu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">falei sobre isso</a> na confer√™ncia do Coringa no ano passado, em princ√≠pio, nada de novo foi dito.  Tentei fazer uma ideia com tipos de uni√£o impl√≠citos, como <code>if(obj instanceof Integer x || obj instanceof Long x) use(x.longValue())</code> , mas n√£o vi entusiasmo. </p><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jean Christophe Beyler, Arthur Eubanks e Man Cao - desinfetante de threads para Java</a> </h1><br><p>  Em todos os aspectos, um projeto maravilhoso do Google para procurar corridas usando dados na forma de leitura e grava√ß√£o do mesmo campo n√£o vol√°til ou elemento de matriz de diferentes fluxos sem estabelecer um relacionamento de antes do acontecido.  O projeto foi originalmente escrito como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um m√≥dulo LLVM</a> para c√≥digo nativo e agora foi adaptado para o HotSpot.  Este √© um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">projeto oficial do</a> OpenJDK com sua lista de discuss√£o e reposit√≥rio. </p><br><p>  Segundo os autores, a coisa agora est√° funcionando, voc√™ pode montar e brincar.  Al√©m disso, ela encontra corridas n√£o apenas no c√≥digo Java, mas tamb√©m no c√≥digo das bibliotecas nativas.  As corridas no c√≥digo da pr√≥pria m√°quina virtual n√£o s√£o pesquisadas, porque todas as primitivas de sincroniza√ß√£o s√£o gravadas √† sua maneira e o TSan n√£o pode detect√°-las.  Segundo os autores, o TSan n√£o fornece falsos positivos. </p><br><p>  O principal problema √© o desempenho.  Agora, apenas o int√©rprete √© instrumentado para o c√≥digo Java, respectivamente, a compila√ß√£o JIT est√° completamente desativada e o int√©rprete, que j√° √© lento, diminui a velocidade v√°rias vezes.  Mas se voc√™ tiver recursos suficientes (o Google, √© claro, o suficiente), ocasionalmente poder√° conduzir seus conjuntos de testes usando o TSan.  Tamb√©m est√° planejado adicionar instrumenta√ß√£o √† JIT, mas essa √© uma interven√ß√£o muito mais s√©ria na JVM. </p><br><p>  Algu√©m perguntou se a desativa√ß√£o da compila√ß√£o JIT n√£o afeta o resultado, porque algumas ra√ßas podem n√£o aparecer no int√©rprete.  O orador n√£o descartou essa possibilidade, mas disse que eles j√° haviam encontrado um grande n√∫mero de corridas que levariam muito tempo para serem feitas.  Portanto, tenha cuidado ao executar seu projeto no TSan: voc√™ pode descobrir a verdade desagrad√°vel. </p><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Brian Goetz - Atualiza√ß√£o em Valhalla</a> </h1><br><p>  Todo mundo est√° esperando por tipos de valor em Java, mas ningu√©m sabe quando eles aparecer√£o.  No entanto, os movimentos s√£o cada vez mais graves.  J√° existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">montagens bin√°rias de</a> teste com o marco L2 atual.  Nos planos atuais, o Valhalla completo chegar√° ao marco da L100, mas os autores ainda est√£o otimistas e acreditam que mais de dois por cento foram realizados. </p><br><p>  Portanto, do ponto de vista da linguagem, temos classes com o modificador inline, que s√£o processados ‚Äã‚Äãde maneira especial pela m√°quina virtual.  Inst√¢ncias de tais classes podem ser incorporadas em outros objetos, e matrizes simples contendo inst√¢ncias de classes embutidas tamb√©m s√£o poss√≠veis.  A inst√¢ncia n√£o possui um cabe√ßalho, o que significa que n√£o h√° identidade, o c√≥digo de hash √© calculado por campos, <code>==</code> tamb√©m por campos, uma tentativa de sincroniza√ß√£o ou <code>Object.wait()</code> nessa classe gerar√° uma IllegalMonitorStateException.  Gravar <code>null</code> em uma vari√°vel desse tipo, √© claro, n√£o funcionar√°.  No entanto, os autores oferecem uma alternativa: se voc√™ declarou um <code>Point</code> classe em linha, pode declarar um campo ou uma vari√°vel do tipo (surpresa-surpresa!) <code>Point?</code>  e, em seguida, haver√° um objeto completo no heap (como boxe) com um cabe√ßalho, identidade e <code>null</code> . </p><br><p>  Perguntas abertas s√©rias continuam sendo a especializa√ß√£o de gen√©ricos e a migra√ß√£o de classes existentes (por exemplo, <code>Optional</code> ) para uma classe embutida para n√£o quebrar o c√≥digo existente (sim, as pessoas escrevem <code>null</code> em vari√°veis ‚Äã‚Äãdo tipo <code>Optional</code> ).  No entanto, a imagem aparece e a diferen√ßa √© vis√≠vel. </p><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">David Wrighton e Neal Gafter - Tipos de valor no CLR</a> </h1><br><p>  Foi uma surpresa para mim que o mesmo Neil Gufter, co-autor dos quebra-cabe√ßas Java originais, agora trabalhe na Microsoft on .Net runtime.  Tamb√©m foi uma surpresa ver um relat√≥rio sobre o CLR (o chamado .Net runtime) na JVM LS.  Mas familiarizar-se com a experi√™ncia de colegas de outros mundos √© sempre √∫til.  O relat√≥rio fala sobre as variedades de refer√™ncias e ponteiros no CLR, sobre as instru√ß√µes de bytecode usadas para tipos de valor e sobre como fun√ß√µes generalizadas lindamente especializadas como reduzir.  Foi interessante saber que um dos objetivos dos tipos de valor em .Net √© uma interoperabilidade com c√≥digo nativo.  Por esse motivo, a localiza√ß√£o dos campos nos tipos de valor √© estritamente fixa e pode ser projetada em uma estrutura sem transforma√ß√µes.  A JVM nunca teve essa tarefa e o que fazer com a interoperabilidade nativa - veja abaixo. </p><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vladimir Ivanov e John Rose - Vetores e os Num√©ricos na JVM</a> </h1><br><p>  Atualize novamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o relat√≥rio do ano passado</a> .  Novamente, a pergunta √© por que eles ainda n√£o lan√ßaram nada, se h√° um ano tudo parecia muito bom. </p><br><p>  Um vetor √© uma cole√ß√£o de v√°rios n√∫meros, que no hardware podem ser representados por um √∫nico registro de vetor como zmm0 para AVX512.  Nos vetores, voc√™ pode carregar dados de matrizes, executar opera√ß√µes neles como multiplica√ß√£o por elementos e jog√°-los de volta.  Todas as opera√ß√µes para as quais existem instru√ß√µes do processador s√£o intrinsizadas pelo compilador JIT nessas instru√ß√µes.  O n√∫mero de opera√ß√µes √© simplesmente enorme.  Se algo estiver faltando, uma implementa√ß√£o lenta alternativa √© usada.  Idealmente, objetos intermedi√°rios de vetor n√£o s√£o criados; a an√°lise de escape funciona.  Todos os algoritmos de computa√ß√£o padr√£o s√£o vetorizados com um estrondo, usando toda a pot√™ncia do seu processador. </p><br><p>  Infelizmente, √© dif√≠cil para os autores n√£o terem valgalla: a an√°lise de escape √© fr√°gil e pode n√£o funcionar facilmente.  Esses vetores simplesmente devem ser classes embutidas, para que todos os problemas desapare√ßam.  N√£o est√° claro se essa API pode ser lan√ßada antes da primeira vers√£o do Valgalla.  Parece muito mais pronto.  Entre os problemas chamados dificuldades com o suporte do c√≥digo.  Existem muitas partes repetidas para diferentes tamanhos de registradores e diferentes tipos de dados; portanto, a maior parte do c√≥digo √© gerada a partir de modelos e √© dif√≠cil mant√™-lo. </p><br><p>  O uso tamb√©m √© imperfeito.  N√£o h√° sobrecarga de operador em Java; portanto, a matem√°tica parece feia: em vez de <code>max(va-vb*42, 0)</code> voc√™ deve escrever <code>va.lanewise(SUB, vb.lanewise(MUL, 42)).lanewise(MAX, 0)</code> .  Seria bom ter acesso √†s lambdas AST como em C #.  Em seguida, seria poss√≠vel gerar uma opera√ß√£o lambda personalizada como <code>MYOP = binOp((va, vb) -&gt; max(va-vb*42, 0))</code> e us√°-la. </p><br><h1>  30 de julho </h1><br><p>  O segundo dia passou sob a bandeira da compila√ß√£o. </p><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mark Stoodley - do AOT ao JIT e al√©m!</a> </h1><br><p>  Um funcion√°rio da IBM, membro do projeto JVM OpenJ9, fala sobre sua experi√™ncia com a compila√ß√£o JIT e AOT.  Sempre h√° problemas: o JIT √© uma inicializa√ß√£o lenta, porque est√° esquentando;  Custos de CPU para compila√ß√£o.  AOT - desempenho abaixo do ideal devido √† falta de um perfil (√© poss√≠vel criar um perfil, mas de maneira n√£o trivial e nem sempre o perfil durante a compila√ß√£o corresponde ao perfil na execu√ß√£o), √© mais dif√≠cil de usar, vincula-se √† plataforma de destino, SO, coletor de lixo.  Alguns dos problemas podem ser resolvidos combinando abordagens: come√ßando com o c√≥digo compilado pela AOT e finalizando com o JIT.  Uma boa alternativa para tudo isso √© o cache do JIT.  Se voc√™ tem muitas m√°quinas virtuais (ol√°, microsservi√ßos), todas elas recorrem a um servi√ßo separado - o compilador JIT (sim, JITaaS), onde tudo √© como um adulto, orquestra√ß√£o e balanceamento de carga.  Este servi√ßo √© compilado.  Muitas vezes, ele pode fornecer c√≥digo pronto para um determinado m√©todo, porque esse m√©todo j√° foi compilado em outra JVM.  Isso melhora muito o aquecimento, remove o consumo de recursos do seu servi√ßo JVM e geralmente reduz o consumo total de recursos. </p><br><p>  Em geral, o JITaaS poderia ser a pr√≥xima palavra da moda no mundo da JVM.  Infelizmente, n√£o entendi se isso poderia ser reproduzido no momento ou se ainda √© um desenvolvimento fechado. </p><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Christian Wimmer - Melhorando a imagem nativa do GraalVM</a> </h1><br><p>  O GraalVM Native Image √© um aplicativo Java compilado em c√≥digo nativo que √© executado sem a JVM (diferente dos m√≥dulos compilados usando um compilador AOT como o jaotc).  Mais precisamente, esse n√£o √© um aplicativo Java.  Para funcionar corretamente, ele precisa de um mundo fechado, ou seja, todo o c√≥digo deve estar vis√≠vel no est√°gio de compila√ß√£o, sem Class.forName.  Voc√™ pode refletir e manipular m√©todos, mas quando compila, precisa informar especificamente quais classes e m√©todos ser√£o usados ‚Äã‚Äãpor meio da reflex√£o. </p><br><p>  Outra coisa divertida √© a inicializa√ß√£o da classe.  Muitas classes s√£o inicializadas durante a compila√ß√£o.  Ou seja, digamos, seus campos est√°ticos ser√£o computados por padr√£o pelo compilador e o resultado ser√° gravado na imagem montada e, quando voc√™ inicia o aplicativo, ele √© simplesmente lido.  Isso √© necess√°rio para obter melhor qualidade de compila√ß√£o: qualquer dobra constante pode ser feita se os valores dos campos est√°ticos forem conhecidos pelo compilador.  Tudo est√° bem com o JIT, o int√©rprete executa a inicializa√ß√£o est√°tica e, depois de conhecer as constantes, voc√™ pode compilar.  E ao criar um aplicativo nativo, voc√™ precisa enganar.  Isso, √© claro, leva a divertidos efeitos psicod√©licos.  Portanto, as classes geralmente s√£o inicializadas na ordem em que s√£o acessadas e, durante a compila√ß√£o, essa ordem √© desconhecida e a inicializa√ß√£o em outra √© poss√≠vel.  Se houver refer√™ncias circulares entre inicializadores de classe, voc√™ poder√° ver a diferen√ßa no comportamento do c√≥digo da JVM e na imagem nativa. </p><br><h1>  Workshop Schatzl - Hotspot GC. </h1><br><p>  Resolvemos toda a dor associada aos coletores de lixo.  Infelizmente, eu ouvi a maioria.  Lembro-me de que a recupera√ß√£o da mem√≥ria do sistema operacional foi discutida, incluindo o Xmx nojento para todos.  H√° boas not√≠cias: no Java 13, uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nova op√ß√£o</a> -XX √© adicionada: SoftMaxHeapSize.  At√© o momento, ele √© suportado apenas pelo coletor ZGC, mas o G1 tamb√©m pode recuperar o atraso.  Ele define um limite para o tamanho da pilha, que n√£o deve ser excedido, exceto em situa√ß√µes de emerg√™ncia, quando n√£o funciona de maneira diferente.  Assim, voc√™ pode definir um Xmx grande (digamos, igual ao tamanho de toda a RAM) e um SoftMaxHeapSize razo√°vel.  Em seguida, a JVM se manter√° na maior parte do tempo, mas, no pico de carga, ainda n√£o lan√ßar√° OutOfMemoryError, mas consumir√° mais mem√≥ria do sistema operacional.  Quando a carga cair, a mem√≥ria retornar√°. </p><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mei-Chin Tsai - JIT e AOT no CLR</a> </h1><br><p>  O Microsoft Mei-Chin Tsai falou sobre os recursos da compila√ß√£o JIT e AOT no CLR.  A compila√ß√£o AOT vem sendo desenvolvida h√° muito tempo, mas inicialmente (ngen.exe) foi realizada na plataforma de destino, como na primeira vez em que foi iniciada (se voc√™ tiver o Windows, procure os arquivos * .ni.dll na pasta Windows).  Os arquivos s√£o obtidos dependendo da vers√£o do Windows local e at√© de outras DLL-ek.  Portanto, se a depend√™ncia for atualizada, todos os m√≥dulos nativos dever√£o ser recompilados.  Na segunda gera√ß√£o (crossgen), os autores pr√©-compilaram aplicativos e m√≥dulos relativamente independentes das vers√µes e depend√™ncias de hardware e SO.  Isso diminuiu a velocidade do c√≥digo porque as chamadas de depend√™ncia agora tinham que ser feitas honestamente virtuais.  Esse problema foi resolvido conectando o JIT e recompilando o c√≥digo quente durante o aplicativo.  Depois, conversamos sobre a compila√ß√£o em v√°rios n√≠veis (em camadas) (parece que no CLR isso ainda est√° engatinhando, enquanto ele se desenvolve em Java h√° pelo menos dez anos) e sobre planos futuros para tornar a AOT verdadeiramente multiplataforma. </p><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wei Kuai e Xiaoming Gu - Acelere o desempenho da JVM com o JWarmUp</a> </h1><br><p>  Os colegas do Alibaba apresentaram sua abordagem ao problema de aquecimento da JVM.  Eles usam a JVM para muitos servi√ßos da web.  Em princ√≠pio, uma inicializa√ß√£o muito r√°pida n√£o √© t√£o importante, porque o balanceador sempre pode esperar at√© a m√°quina inicializar e s√≥ ent√£o come√ßar a enviar solicita√ß√µes para ela.  No entanto, o problema √© que a m√°quina n√£o aquece sem solicita√ß√µes: o c√≥digo que descreve a l√≥gica para processar solicita√ß√µes n√£o √© chamado, o que significa que n√£o √© compilado.  Ele ser√° compilado quando as primeiras solicita√ß√µes chegarem, ou seja, n√£o importa quanto o balanceador espere, haver√° uma falha de desempenho nas primeiras solicita√ß√µes.  Anteriormente, eles tentavam resolver isso lan√ßando solicita√ß√µes falsas para o pr√≥ximo servi√ßo antes de enviar solicita√ß√µes reais para ele.  A abordagem √© interessante, mas √© bastante dif√≠cil gerar um fluxo t√£o falso que causaria a compila√ß√£o de todo o c√≥digo necess√°rio. </p><br><p>  Um problema separado √© a desoptimiza√ß√£o.  Nas primeiras mil consultas, uma <code>if</code> sempre percorresse a primeira ramifica√ß√£o, o compilador JIT geralmente fazia a segunda, inserindo uma armadilha de desotimiza√ß√£o para reduzir o tamanho do c√≥digo.  Mas a 1001¬™ solicita√ß√£o foi para a segunda ramifica√ß√£o, a desoptimiza√ß√£o funcionou e todo o m√©todo foi para o int√©rprete.  Enquanto as estat√≠sticas est√£o sendo compiladas novamente, enquanto o m√©todo √© compilado pelo compilador C1, e pelo perfil completo pelo compilador C2, os usu√°rios experimentam uma desacelera√ß√£o.  E ent√£o, no mesmo m√©todo, outro <code>if</code> pode ser desoptimizado, e tudo dar√° um novo. </p><br><p>  O JWarmUp resolve o problema da seguinte maneira.  Durante a primeira execu√ß√£o do servi√ßo, um registro de compila√ß√£o √© gravado por v√°rios minutos: registra quais m√©todos foram compilados e as informa√ß√µes de perfil necess√°rias por ramifica√ß√µes, tipos etc. Se esse servi√ßo for reiniciado, imediatamente ap√≥s a inicializa√ß√£o, todas as classes do log ser√£o inicializadas e os m√©todos registrados ser√£o compilados. levando em considera√ß√£o o perfil anterior.  Como resultado, o compilador funcionar√° bem na inicializa√ß√£o, ap√≥s o qual o balanceador come√ßar√° a enviar solicita√ß√µes para esta JVM.  Nesse momento, todo o c√≥digo quente que ela j√° foi compilado. </p><br><p>  Vale a pena notar que o problema de in√≠cio r√°pido n√£o √© resolvido aqui.  Um lan√ßamento pode ser ainda mais lento porque muitos m√©todos s√£o compilados, alguns dos quais podem ser necess√°rios apenas alguns minutos ap√≥s o lan√ßamento.  Mas o log acaba sendo reutiliz√°vel: diferente da AOT, voc√™ pode aumentar o servi√ßo em uma arquitetura diferente ou com um coletor de lixo diferente e reutilizar o log anterior. </p><br><p>  Os autores <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tentam</a> h√° muito tempo inserir o JWarmUp no OpenJDK.  At√© agora sem sucesso, mas o trabalho est√° se movendo.  O principal √© que um patch completo √© bastante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">acess√≠vel</a> para voc√™ no servidor de Revis√£o de C√≥digo, para que voc√™ possa aplic√°-lo facilmente √†s fontes do HotSpot e criar a JVM com o JWarmUp. </p><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Juan Fumero - Tornado</a> </h1><br><p>  Este √© um trabalho de pesquisa de Manchester, mas os autores afirmam que o projeto j√° foi implementado em alguns lugares.  Tamb√©m √© um complemento para o OpenJDK, o que facilita bastante a transfer√™ncia de determinados c√≥digos Java para GPU, iGPU, FPGA ou simplesmente o paralela aos n√∫cleos de seu processador.  Para compilar na GPU, eles usam o GraalVM no qual constru√≠ram seu back-end - TornadoJIT.  Um m√©todo Java corretamente escrito, transparente, vai para o dispositivo correspondente.  √â verdade que eles dizem que a compila√ß√£o no FPGA pode levar v√°rias horas, mas se sua tarefa √© considerada um m√™s, por que n√£o?  Alguns benchmarks (por exemplo, a transforma√ß√£o discreta de Fourier) s√£o cem vezes mais r√°pidos que o Java simples, o que √© esperado em princ√≠pio.  O projeto √© totalmente carregado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> , onde voc√™ tamb√©m pode encontrar publica√ß√µes cient√≠ficas sobre o t√≥pico. </p><br><h1>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Maurizio Cimadomore - Desconstruindo o Panam√°</a> </h1><br><p>  A mesma m√∫sica - um projeto de longa data, todas as apresenta√ß√µes da c√∫pula, um ano atr√°s, tudo parecia bem pronto, mas ainda n√£o havia lan√ßamento.  Acontece que, desde ent√£o, o foco mudou. </p><br><p>  A id√©ia do projeto √© um interope melhorado com c√≥digo nativo.  Todo mundo sabe como √© doloroso usar o JNI.  Isso realmente d√≥i.  O projeto Panam√° anula esse problema: o uso de classes Java jextract s√£o geradas a partir dos arquivos * .h da biblioteca nativa, que s√£o bastante convenientes de usar chamando m√©todos nativos.  No lado C / C ++, voc√™ n√£o precisa escrever uma √∫nica linha.  Al√©m disso, tudo ficou muito mais r√°pido: a sobrecarga nas chamadas para Java-&gt; nativo e nativo-&gt; Java caiu √†s vezes.  O que mais voc√™ poderia querer? </p><br><p>  H√° um problema que existe h√° algum tempo - a transfer√™ncia de matrizes de dados para o c√≥digo nativo.  At√© agora, o m√©todo recomendado √© o DirectByteBuffer, que apresenta muitos problemas.  Uma das mais graves √© a vida √∫til n√£o gerenciada (o buffer desaparece quando o coletor de lixo pega o objeto Java apropriado).  Devido a esse e outros problemas, as pessoas usam o Inseguro, que, com a devida dilig√™ncia, pode facilmente estabelecer toda a m√°quina virtual. </p><br><p>  Isso significa que voc√™ precisa de um novo acesso normal √† mem√≥ria fora do heap Java.  Aloca√ß√£o, acessadores estruturados, remo√ß√£o expl√≠cita.  Acessadores estruturados - para que voc√™ n√£o precise calcular as compensa√ß√µes por conta pr√≥pria se precisar escrever, por exemplo, <code>struct { byte x; int y; }[5]</code> <code>struct { byte x; int y; }[5]</code>  <code>struct { byte x; int y; }[5]</code>  Em vez disso, voc√™ descreve uma vez o layout dessa estrutura e, por exemplo, <code>VarHandle</code> , que pode ler todos os <code>x</code> saltando sobre <code>y</code> .  Nesse caso, √© claro, sempre deve haver verifica√ß√£o de borda, como em matrizes Java comuns.  Al√©m disso, deve haver uma proibi√ß√£o de acesso a uma √°rea j√° fechada.  E isso acaba sendo uma tarefa n√£o trivial, se queremos manter o desempenho no n√≠vel Inseguro e permitir o acesso a partir de v√°rios encadeamentos.  Em suma, assista ao v√≠deo, muito interessante. </p><br><h1>  Workshop: Vladimir Kozlov - Projeto Metropolis </h1><br><p>  O projeto Metropolis combina todas as tentativas de reescrever partes da JVM em Java.  Hoje, sua parte principal √© o compilador Graal.  Nos √∫ltimos anos, ele se desenvolveu muito bem e j√° se fala de um substituto completo para o envelhecimento do C2.  Costumava haver um problema de bootstrap: o graal come√ßava devagar, porque ele pr√≥prio tinha que ser compilado ou interpretado pelo JIT.  Em seguida, a compila√ß√£o do AOT apareceu (sim, o principal objetivo do projeto de compila√ß√£o do AOT √© o bootstrap do pr√≥prio graal).  Mas com o AOT, o grail consome uma parte decente do heap de um aplicativo Java que pode n√£o querer compartilhar seu heap.  Agora aprendemos a transformar o graal em uma biblioteca nativa usando o Graal Native Image, o que nos permitiu isolar o compilador da pilha geral.  Com o desempenho m√°ximo do c√≥digo compilado pelo graal, ainda existem problemas em alguns benchmarks.  Por exemplo, o graal fica atr√°s de C2 em intr√≠nseca e vetoriza√ß√£o.  No entanto, gra√ßas √† poderosa an√°lise de inlining e escape, ela simplesmente quebra C2 no c√≥digo funcional, onde muitos objetos imut√°veis ‚Äã‚Äãe muitas fun√ß√µes pequenas s√£o criadas.  Se voc√™ escreve sobre a rocha e ainda n√£o usa o graal, corra para us√°-lo.  Al√©m disso, nas vers√µes mais recentes do JDK, √© bastante trivial fazer algumas chaves, tudo j√° est√° no kit. </p><br><h1>  31 de julho </h1><br><h1>  Kevin Bourrillion - Anota√ß√µes de nulidade para Java </h1><br><p>  Kevin anunciou um novo projeto, mas pediu para n√£o falar publicamente e n√£o publicar uma grava√ß√£o de seu discurso no YouTube.  Sinto muito.  ,        . </p><br><h1> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dmitry Petrashko ‚Äî Gradual typing for Ruby at Scale with Sorbet</a> </h1><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sorbet</a>   (!) Ruby,       Ruby   .  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Stripe</a>         Ruby   , ,    .  ,     . </p><br><h1> Lightning Talks </h1><br><p> -     .   Remi Forax     ,       ,   .    ,      : </p><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1156627887165804544"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><p>      ,   -     ,   . </p><br><h1> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Erik Meijer ‚Äî Differentiable Programming</a> </h1><br><p>             ML  AI      ,     .     ,    Facebook   ‚Äî        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">getafix</a> , --,       ,   .          . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> ,    .  ,    ,        . </p><br><p>    .   .    OpenJDK Committer Workshop. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt462101/">https://habr.com/ru/post/pt462101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt462083/index.html">Estruturas de dados r√°pidas com exemplos. Parte um: lista vinculada</a></li>
<li><a href="../pt462087/index.html">Testando uma governanta inteligente (vodka, kefir, fotos de outras pessoas)</a></li>
<li><a href="../pt462091/index.html">Solu√ß√£o da tarefa com pwnable.kr cmd1, cmd2, asm, blukat. Ignorar a filtragem no Linux. Escrevendo shellcode com pwntools</a></li>
<li><a href="../pt462095/index.html">Trabalhar com luz e √≥ptica: como iniciar uma carreira na universidade - a experi√™ncia de graduados em quatro programas de mestrado especializados</a></li>
<li><a href="../pt462097/index.html">Passeio verde claro</a></li>
<li><a href="../pt462107/index.html">Maratona gr√°tis ‚ÄúBig Data e super-her√≥is: sua primeira experi√™ncia em an√°lise de dados‚Äù</a></li>
<li><a href="../pt462109/index.html">Veja quase invis√≠vel, tamb√©m em cores: uma t√©cnica para visualizar objetos atrav√©s de um difusor</a></li>
<li><a href="../pt462111/index.html">Como testamos v√°rios bancos de dados de s√©ries temporais</a></li>
<li><a href="../pt462113/index.html">Ambiente irrepreens√≠vel: ningu√©m deve escrever um c√≥digo de qualidade</a></li>
<li><a href="../pt462115/index.html">Ajuste o c√©u estrelado no WebGL em 1009 bytes de JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>