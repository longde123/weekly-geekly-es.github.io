<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📤 ⛄️ 🦕 如何从非接触式卡和Apple Pay窃钱 🐃 👩🏿‍🏫 🚍</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文以真实的POS终端，PayPass / payWave卡和具有Google Pay / Apple Pay功能的电话为例，探讨了非接触式支付欺诈的流行神话和场景。 

 涵盖的主题： 



- 将POS终端机放在口袋里真的有可能偷钱吗？ -我们将尝试使用真实的POS终端和实际情况下的支付卡从头...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何从非接触式卡和Apple Pay窃钱</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422551/"><img alt="如何从口袋里的非接触式卡中偷钱？PayPass和Apple Pay的安全性如何？" src="https://habrastorage.org/webt/gb/2f/ry/gb2frybl-08fyn1a0w1xxjap9f0.jpeg"><br><br> 本文以真实的POS终端，PayPass / payWave卡和具有Google Pay / Apple Pay功能的电话为例，探讨了非接触式支付欺诈的流行神话和场景。 <br><br> 涵盖的主题： <br><br><ul><li>  <b>将POS终端机放在口袋里真的有可能偷钱吗？</b>  -我们将尝试使用真实的POS终端和实际情况下的支付卡从头到尾完全重现这种欺诈情况。 </li><li>  <b>物理和虚拟Apple Pay卡有什么区别？</b>  -实体卡和Apple Pay令牌如何链接，以及为什么Apple Pay比普通卡安全得多。 </li><li>  <b>我们使用硬件NFC嗅探器（ISO 14443A）</b> -我们将使用HydraNFC设备在POS终端和卡之间拦截数据。 考虑可以从拦截的流量中提取哪些敏感数据。 </li><li>  <b>我们分析EMV协议</b> -卡与POS终端交换什么数据，使用的请求格式，防止欺诈和重播攻击的机制。 </li><li>  <b>我们研究无卡情况下的操作（CNP，MO / TO）</b> -实际上在什么情况下（！），您可以从卡中窃取资金，只读取详细信息而无需联系，这是不可能的。 </li></ul><br>  <font color="red"><b>注意！</b></font> <br><br> 本文通过欺诈者的眼光，从头到尾详细描述了欺诈的假想方案，以涵盖所有培养神话和错误的方面。 尽管标题具有挑衅性，但本文的主要结论是， <b>非接触式付款非常安全，对其进行攻击</b>既<b>费时又无利可图</b> 。 <br><br>  <font color="red">本文中的材料仅供参考。</font>  <font color="red">所有舞弊现场都是在有关各方同意的情况下上演和执行的。</font>  <font color="red">从卡中扣除的所有钱都退还给其所有者。</font>  <font color="red">盗窃卡上的钱是刑事犯罪，应受到法律制裁。</font> <a name="habracut"></a><br><h1> 如何运作？ </h1><br> 首先，请考虑以下基本概念：使用支付卡进行的任何货币转移都只能通过连接到支付系统的中介（例如VISA或MasterCard）进行。 与个人之间的转帐不同，从银行卡中借记的钱仅适用于与银行达成购买协议的法人实体（商人）。 <br><br><img src="https://habrastorage.org/webt/d5/1w/ce/d51wcetyqo_5ppr5467wwknaaus.png"><br>  <i><font color="99999">通过POS终端付款时的交易阶段</font></i> <br><br> 上图显示了通过POS终端的经典付款方案。 当在结帐处付款后，您正在等待终端上的确认时，就会发生此操作序列。 <br><br><ol><li> 买方申请/持有/将卡插入POS终端； </li><li>  POS终端通过互联网将数据发送到收单行； </li><li> 收单银行通过国际支付系统（MPS）与发卡银行联系，并询问特定的持卡人是否可以为购物付款； </li><li> 开证行确认或拒绝购买，然后打印单据（第二张支票）。 </li></ol><br> 该方案也有例外，例如离线交易，我们将对其进行进一步考虑。 另外，如果收款银行和发卡银行是同一银行，则在同一银行内执行步骤2和4。 <br><br>  <b>卖方</b> （商人）-提供商品或服务的个人或组织 <br><br> 收单行是通过银行卡为卖方提供付款接受服务的银行。 在这家银行中，通常会有一个卖家的银行帐户，将从卡中借记的钱记入贷方。 <br><br>  <b>发卡</b>银行- <b>发卡的</b>银行。 它包含持卡人的帐户，从该帐户中扣除钱款。 <br><br>  <b>国际支付系统</b> （MPS）是世界各地银行之间的国际中介系统，它使银行之间可以进行结算，而无需与每个银行分别达成协议。 连接到铁道部的所有银行都同意按照相同的规则进行工作，从而大大简化了互动。 例如，Visa，万事达卡，银联，美国运通， <s>MIR</s> （否，MIR在国外不起作用）。 <br><br>  <b>持卡人</b> -与发卡银行订立了卡服务协议的人。 <br><br><h1>  Apple Pay或Google Pay的普通卡有什么区别？ </h1><br> 由于流程的不可理解性，将银行卡链接到Apple Pay或Google Pay系统的过程经常会引起误解，即使在IT专业人员中也是如此。 我听说过许多关于这项技术的神话。 <br><br><h4> 流行的Apple Pay神话 </h4><br><ul><li>  <b><font color="D13CB8">卡已复制到手机</font></b> <br> 事实并非如此，微处理器卡包含一个受保护的存储区，该存储区具有在发行卡后无法提取的密码信息。 因此，根本无法以任何方式复制芯片卡。  <i><font color="99999">公平地讲，必须说这种攻击是可能的，但其代价超过了本文大多数读者一生所花费的总金额。</font></i> </li><li>  <b><font color="D13CB8">付款期间手机每次连接到Internet</font></b> <br> 在通过POS终端付款时，Google Pay / Apple Pay无法连接到Internet。 所有必要的信息都存储在本地电话中。 </li><li>  <b><font color="D13CB8">每次付款都会生成一个新的卡号（PAN）</font></b> <br> 如果您阅读Apple关于Apple Pay技术的新闻稿，则可能看起来是这样。 但这是对令牌概念的错误解释。 实际上，虚拟卡的详细信息很长一段时间都保持不变，您可以在付款时通过发票（银行支票）中卡号的最后一位数字进行检查。 </li><li>  <b><font color="D13CB8">通过Apple Pay / Google Pay付款时，需要支付额外费用</font></b> <br> 情况并非如此，您将按照与您所链接的发卡行的发卡行的协议条款，完全按照价格标签上的指示付款。 </li><li>  <b><font color="D13CB8">钱可以借记两次</font></b> <br> 这个神话不仅适用于Google Pay / Apple Pay，而且适用于普通银行卡。 我相信它的出现是由于公共交通支付系统的出现，在该系统中，候机楼每次出示票时都会从票中扣除钱，因此，如果您携带卡不正确，则可以两次或多次借记。 对于POS终端，这种风险不存在，因为一旦接收到必要的数据，终端就会停止与卡进行交换。 </li></ul><br><br><img src="https://habrastorage.org/webt/z5/mt/og/z5mtogccxmh5picpde0ng_nmnnk.png"><br>  <i><font color="99999">将实体卡与手机中的令牌相关联</font></i> <br><br> 像Apple Pay这样的系统都由<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">EMV Payment Tokenisation Specification支持</a> 。 尚未公开描述将实体卡和电话与Apple Pay关联的过程，因此我们将基于已知数据来分析该过程： <br><br><ol><li> 提供者（Google，Apple，Samsung）接收地图信息； </li><li> 提供商通过MPS要求此卡（发卡行）是否支持EMV令牌化； </li><li> 在MPS端，会生成一个虚拟卡（令牌），该虚拟卡将下载到手机中的安全存储中。  <i><font color="99999">我不知道虚拟卡的私钥到底是在哪里生成的，无论是通过Internet传输还是通过电话本地生成，在这种情况下都没有关系。</font></i> </li><li> 生成的虚拟令牌卡出现在电话上，发卡行将其解释为第一张物理卡上的操作。 在阻止物理卡的情况下，令牌也将被阻止。 </li></ol><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"> 您的浏览器不支持HTML5视频。 <source src="https://zhovner.com/forever/applepay_different_pan.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">Apple Pay允许您读取虚拟卡的详细信息。</font></i>  <i><font color="99999">PAN编号和到期日期与俄罗斯Alfa-Bank的链接卡不同。</font></i>  <i><font color="99999">虚拟卡的BIN（480099）由MBNA AMERICA BANK确定。</font></i> <br><br> 通过电话付款时，POS终端会看到常规的VISA或MasterCard，并以与物理卡相同的方式与之通信。 虚拟令牌卡包含常规卡的所有属性：PAN号，有效期等。 同时，虚拟卡号和有效期与随附的原始卡不同。 <br><br><h2> 方案1-常规POS终端 </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fw/jz/mj/fwjzmjgmj7beldkf8bh4hdwmlay.jpeg"></div><br>  <i><font color="99999">POS终端欺诈者</font></i> <br><br> 普通人心目中最流行的欺诈情节：终端已打开的欺诈者在人群中被压向他们，并注销了金钱。 我们将尝试在现实中重现这种情况。 <br><br>  <b>条件如下</b> ： <br><br><ul><li> 欺诈者具有一个正常运行的<b>普通POS终端</b> ，该<b>终端</b>连接到收单银行，与商店和快递公司一样。 终端的固件未修改。 在我们的案例中-Ingenico iWL250。 这是带有GPRS调制解调器的便携式POS终端，该终端支持非接触式付款，依靠电池供电并且完全可移动。 </li><li> 欺诈者不使用其他技术手段，仅使用POS终端 </li><li> 根据银行系统的所有规则，借记的资金将记入欺诈者的活期帐户中 </li></ul><br><h3> 法人实体 </h3><br><img src="https://habrastorage.org/webt/do/f_/qs/dof_qscba68g-7za5caz02pszqi.jpeg"><br><br> 首先，我们需要一个拥有经常账户并获得关联的法人实体。 我们像真正的骗子一样，不会以我们的名义冒名顶替，而是尝试购买现成的法律实体。 网站上的同一骗子用户。 为此，请在Google第一页上的“ buy ip”和“ buy ooo”广告中查看。 <br><br> <a href=""><img src="https://habrastorage.org/webt/lu/7v/yc/lu7vycgengac_zvziy7cltrjl-k.png"></a> <br>  <i><font color="99999">出售骗子的现成公司的报价（可点击）</font></i> <br><br> 在黑市上有经常账户的公司的价格在20到30万卢布之间。 我设法从200,000卢布中找到几个带有POS终端的LLC的要约。 这样的公司被假人框住，买主收到整包文件以及“缓存卡”-这是与虚拟公司的结算帐户绑定的银行卡。 有了这样的卡，欺诈者就可以在ATM机上兑现资金。 <br><br><blockquote> 为简单起见，我们假设LLC +银行帐户+收单以及POS终端将使欺诈者花费<b>100,000卢布</b> 。 实际上更多，但我们将简化假想诈骗者的生活，降低攻击成本。 毕竟，攻击成本越低，实施起来就越容易。 </blockquote><br><h2> 让我们偷钱 </h2><br> 因此，欺诈者获得了一个POS终端，并准备去一个拥挤的地方，靠着受害者，从他的口袋里偷钱。 在我们的实验中，所有受害人都被预先告知了我们的意图，所有勾销金钱的企图都是在他们的同意下进行的。 如果受试者没有自己的非接触式银行卡，则要求他们将我们的卡放在钱包中。 以前，受检者准确地知道了他们存储卡的位置和方式，因此欺诈者预先知道了非接触式卡在袋子/口袋中的位置。 <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"> 您的浏览器不支持HTML5视频。 <source src="https://zhovner.com/forever/nfc_fraud_in_public.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">视频：一个骗子在购物中心肆虐</font></i> <br><br> 如果成功注销，则通过终端菜单取消交易，并将钱退还给对象的帐户。 在整个实验过程中，我们试图从购物中心大楼和大街上的20个对象中“窃取”金钱。 测试结果如下所述。 <br><br><h1> 问题：无PIN的交易限额 </h1><br> 可以在POS终端本身（需要CVM的限制）和银行一侧设置最大交易金额的限制，而无需使用PIN码进行确认。 在俄罗斯，这项限制等于1000卢布。 <br><br><hr><br>  <font color="99999"><i><b>UPD</b>在卡设置中，可以将授权持卡人验证方法（CVM）的类型设置为支票上的签名。</i></font>  <font color="99999"><i>在这种情况下，无需PIN码即可进行任何金额的非接触式交易。</i></font> <br><br><hr><br> 我们的欺诈者决定一次注销999.99卢布。 如果要求您在短时间内再次注销低于限额的金额，还将要求您输入PIN码，在大多数情况下，将无法连续多次注销999.99卢布。 因此，最佳策略是从一张卡中收取不超过一笔费用。 <br><br><div style="text-align:center;"><img width="300" alt="POS终端机，金额为999.99" src="https://habrastorage.org/webt/at/kg/lt/atkgltocfv4dmqiutgb-8rbcej8.png"></div><br>  <i><font color="99999">在俄罗斯，没有PIN码的最大借方金额为1000卢布。</font></i> <br><br> 实际上，在短时间内大量注销999.99卢布的金额可能会触发收单行方面的反欺诈系统，因此该策略对于欺诈者而言并非最佳选择。 因此，在现实生活中，他将不得不选择更多不同的金额，从而减少潜在的收入。 <br><br> 顺便说一句，许多与此俄语主题有关的文章都说，您可以手动设置自己的非接触式交易限制，而无需输入PIN码。 在主要的俄罗斯银行中我找不到这样的选择。 也许您知道这种可能性？ 它是关于非接触式付款，而不是任何芯片和密码交易。 <br><br><h2> 问题：钱包中有多张卡 </h2><br> 在这种攻击情况下，这一点很重要，因为实际上几乎没有人在口袋里携带<b>一张卡</b> 。 在大多数情况下，卡与旅行卡或其他银行卡等其他非接触式卡一起存储在钱包中。 <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/im/x5/j1/imx5j1sci8ml-89qidz1_w8tdow.png" alt="卡肿的的钱包"></div><br> 具体而言，我的Igenico iWL250终端在操作字段中检测到多个卡且SAK表示支持14443-4协议时，返回错误：“出示一张卡”。 <br><br> 但是，并非所有终端都可以这样做。 例如，VeriFone Sberbank POS终端从几张中选择一张随机卡。 如果有多个卡，某些终端会简单地忽略所有卡，而不会显示错误消息。 <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"> 您的浏览器不支持HTML5视频。 <source src="https://zhovner.com/forever/pos_terminal_declines_few_cards.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">试图读取钱包中的多张卡。</font></i>  <i><font color="99999">POS终端返回错误。</font></i> <br><br><h3> 防撞ISO 14443-3 </h3><br> 从物理上读取一张特定的卡并非易事。 为了解决这个问题，存在一种防冲突的机制。 如果一次收到多张卡片的响应，则可以选择一张卡片。 这是在ISO-14443A协议中与非接触卡建立联系的第一步。 在此阶段，读者无法弄清所提供的哪些银行卡。 唯一的选择是根据SAK（选择确认）的响应选择与银行卡大致相同的货币。 <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/_k/ie/yz/_kieyz-qmexulctjyhmfnjyvff8.png"></div>  <i><font color="99999">SAK响应中的位值</font></i> <br><br> 因此，例如，莫斯科公共交通中使用的Troika卡（Mifare标准）的值<b>SAK = 0x08（b00001000）</b> ，其中第六位为零。 对于SAK响应中的所有银行卡，第六位为1，这表示支持ISO 14443-4协议。 <br><br> 因此，当同时检测到几张卡时，终端所能做的就是排除不支持ISO 14443-4的卡，并选择与银行类似的卡。 顺便说一下，对ISO 14443-4协议的支持不能保证此卡将是银行卡，但是很可能在普通人的钱包中不会有其他类型的卡支持ISO 14443-4。 <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/4l/q0/e_/4lq0e_bzubjholfmtdiu29fmlxe.png"></div><br>  <i><font color="99999">防冲突协议流程图</font></i> <br><br> 根据个人经验：尽管存在防冲突协议，但是如果您的钱包中至少有三张非接触式卡，那么很难<b><font color="red">成功地</font></b>读取所需的卡。 大多数尝试都会导致读取错误。 依附在别人的口袋和书包上，在奔跑中做这件事甚至更加困难。 <br><br> 但是，我们将认为我们的欺诈者是非常幸运的，而且这一限制不会打扰他。 <br><br><h2> 离线与在线交易 </h2><br> 在令人恐惧的新闻报道中，他们谈论的是地铁车厢中带有POS终端的骗子，他们马上就把钱记在口袋里。 这些故事没有提到骗子从地铁车厢那里获得移动互联网的地方。 也许他的终端支持离线交易？ <br><br>  EMV规范允许脱机交易。 在这种模式下，发生借记时没有发卡行的在线确认。 例如，这可以在莫斯科和圣彼得堡的公共交通中使用。 为了不使公共汽车入口处排队，航站楼在完成在线确认时，他们让您立即进入，而无需检查您的帐户中是否有足够的钱来支付车费。 最终，当Internet出现在终端上时，已签名的交易将发送到发行银行。 如果事实证明这时您没有钱支付车费，则该卡将被添加到城市所有航站楼的停靠站中。 您可以通过卡号通过您的个人帐户偿还债务。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">了解更多</a>有关在圣彼得堡购买公交车的信息。 <br><br> 我个人无法获得支持此功能的POS终端，因此在具有“平民” POS终端的情况下，我们将不考虑离线借记的可能性。 除了攻击者需要在终端上使用Internet之外，这没有任何改变，因此，例如在地铁中的攻击要复杂得多。 <br> 有支持WiFi的终端模型，从理论上讲，我们的诈骗者可以在都会区中使用WiFi，此前他曾负责为其POS终端的MAC地址购买无广告访问权，因此不需要通过强制门户进行身份验证，因为在POS上终端无法做到这一点。 <br><br><h2> 计算利润 </h2><br> 在我们的方案中，攻击成本为100,000卢布。 这意味着，为了至少收回投资，我们的英雄需要完成至少100笔交易，每笔交易额为1000卢布。 想象一下，他足够敏捷，整日在城市中奔波，紧紧抓住所有人，因此到一天结束时，他成功注销了120笔。 我们将不考虑收购佣金（平均2％），兑现佣金（4-10％）和其他佣金。 <br><br> 他可以使用绑定到活期账户的卡成功兑现吗？ <br><br> 实际上，并非一切都那么简单。  <b>仅几天之内，资金就会存入欺诈者的帐户！</b> 在此期间，我们的欺诈者应该希望一百二十个受害者中没有一个会挑战交易，这是极不可能的。 因此，实际上，欺诈者的帐户甚至在将钱记入帐户之前都将被冻结。 <br><br><blockquote>  <i>如果某人注意到在他的卡上进行了未购买的交易，则应联系发卡银行并提出索赔。</i> <i>         30 ,   ,    —  60 .    -   -,   -     ,          .</i> <br><br> <b> ,           ()</b> <br></blockquote><br><h2> 结论 </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的方案中，攻击的成本为100,000卢布。实际上，它会高出好几倍，因此欺诈者需要付出更多的努力才能获利。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的情况下，欺诈者总是注销999.99卢布，这很可能将使反欺诈系统在收单行一侧运作。实际上，欺诈者将需要注销较小的金额。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了至少收回投资，欺诈者将需要处理数百名受害者。如果甚至有十几个人联系发卡银行并对交易提出异议，则欺诈者的帐户很可能会被阻止。收购银行与欺诈者勾结的可能性不大，因为与MPS一起使用的许可证的成本远高于此类欺诈带来的任何潜在利润。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这20个科目中，只有3个设法从卡中注销了钱，占所有尝试成功的15％。这些是人为的情况，口袋里只有一张卡。如果有钱包和几张卡，则终端返回错误。在终端使用修改后的固件并实现防冲突机制的情况下，成功收费的百分比可能会更高。但是，即使在使用防冲突的情况下，在运行中的实际条件下，也很难从一张数中计算一张，因此可以认为在这种情况下成功借记是幸运的。实际上，成功注销的份额几乎不会超过尝试次数的10％。</font></font><br><br><blockquote> ,   ,      ,         .    -   ,     . <br></blockquote><br><h2>  2 —  POS- </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们的骗子在带有移动POS终端的商店或快递员的结帐处工作。</font><font style="vertical-align: inherit;">在这种情况下，他有机会捕获卡数据，在某些情况下，这些数据可能足以在Internet上支付。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，让我们弄清楚非接触式交易的外观，以及卡与POS终端交换什么样的数据。</font><font style="vertical-align: inherit;">由于我们太懒了，无法阅读数千页的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EMV非接触式规格</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档</font><font style="vertical-align: inherit;">，因此我们只需要使用HydraNFC嗅探器在物理层上拦截交换即可。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">万事达卡PayPass和Visa payWave的EMV规范之间存在一些差异。</font><font style="vertical-align: inherit;">这是签名格式和某些数据的区别。</font><font style="vertical-align: inherit;">但这对我们来说不是必需的。</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NFC嗅探器 </font></font></h2><br><img src="https://habrastorage.org/webt/bs/sx/oy/bssxoy5b-wmgyab33hakrihmfyc.png"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HydraNFC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个ISO-14443A完全开源的独立嗅探器，可将截获的APDU命令保存到SD卡。</font><font style="vertical-align: inherit;">嗅探天线位于终端和卡之间，并被动地捕获所有传输的信息。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关HydraBus和HydraNFC防护板的网站</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> → </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固件来源</font></font></a> <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"> 您的浏览器不支持HTML5视频。 <source src="https://zhovner.com/forever/hydranfc_pos_terminal_sniff.mp4" type="video/mp4"></video></div></div></div><br> <i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示使用Apple Pay拦截POS终端和电话之间的交换</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展望未来，我必须说，在这个级别上，通过电话和普通塑料卡付款没有什么不同。</font><font style="vertical-align: inherit;">对于POS终端，这是常规的VISA卡。</font><font style="vertical-align: inherit;">但是，通过电话付款比使用实体卡安全得多，然后我们将分析原因。</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EMV协议解析 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 这是使用Apple Pay支付总价值142.98卢布的巧克力和一瓶水时所记录的转储的样子： </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从嗅探器（开放扰流器）接收到的原始数据</font></font></b> <div class="spoiler_text"><a href=""><img width="200" src="https://habrastorage.org/webt/ia/by/xg/iabyxg1ocokwqruiq9ew3qmwqws.png"></a><br>
<i><font color="99999">      ()</font></i><br>
<br>
<b>R (READER)</b> — POS-<br>
<b>T (TAG)</b> —  (   )<br>
<code>R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
T&lt;&lt; 04 00<br>
R&gt;&gt; 93 20 <br>
T&lt;&lt; 08 fe e4 ec fe <br>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e <br>
T&lt;&lt; 20 fc 70 <br>
R&gt;&gt; 50 00 57 cd <br>
R&gt;&gt; 26 <br>
R&gt;&gt; 52 <br>
T&lt;&lt; 04 00 <br>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e <br>
T&lt;&lt; 20 fc 70 <br>
R&gt;&gt; e0 80 31 73 <br>
T&lt;&lt; 05 78 80 70 02 a5 46 <br>
R&gt;&gt; 02 00 a4 04 00 0e 32 50 41 59 2e 53 59 53 2e 44 44 46 30 31 00 e0 42 <br>
T&lt;&lt; 02 6f 23 84 0e 32 50 41 59 2e 53 59 53 2e 44 44 46 30 31 a5 11 bf 0c 0e 61 0c 4f 07 a0 00 00 00 03 10 10 87 01 01 90 00 4b b3 <br>
R&gt;&gt; 03 00 a4 04 00 07 a0 00 00 00 03 10 10 00 bc 41 <br>
T&lt;&lt; 03 6f 31 84 07 a0 00 00 00 03 10 10 a5 26 9f 38 18 9f 66 04 9f 02 06 9f 03 06 9f 1a 02 95 05 5f 2a 02 9a 03 9c 01 9f 37 04 bf 0c 08 9f 5a 05 60 08 40 06 43 90 00 1d 66 <br>
R&gt;&gt; 02 80 a8 00 00 23 83 21 36 a0 40 00 00 00 00 01 42 98 00 00 00 00 00 00 06 43 00 00 00 00 00 06 43 18 09 18 00 e0 11 01 03 00 f9 14 <br>
T&lt;&lt; 02 77 62 82 02 00 40 94 04 18 01 01 00 9f 36 02 02 06 9f 26 08 d6 f5 6b 8a be d7 8f 23 9f 10 20 1f 4a ff 32 a0 00 00 00 00 10 03 02 73 00 00 00 00 40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 9f 6c 02 00 80 57 13 48 00 99 72 50 51 17 56 d2 31 22 01 00 00 05 20 99 99 5f 9f 6e 04 23 88 00 00 9f 27 01 80 90 00 af c8 <br>
R&gt;&gt; 03 00 b2 01 1c 00 c9 05 <br>
T&lt;&lt; 03 70 37 5f 28 02 06 43 9f 07 02 c0 00 9f 19 06 04 00 10 03 02 73 5f 34 01 00 9f 24 1d 56 30 30 31 30 30 31 34 36 31 38 30 34 30 31 37 37 31 30 31 33 39 36 31 36 37 36 32 35 90 00 a7 7b <br>
</code><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们分别从拦截的转储中解析每一行。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R &gt;&gt;-通过POS终端</font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输的数据T &gt;&gt;-通过卡传输的数据（在我们的示例中为带Apple Pay的电话）</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14443-A选择</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在交换开始时，终端在通道级别与卡建立连接。</font><font style="vertical-align: inherit;">对于那些熟悉网络和OSI模型的人来说，将其表示为L2级别，并将卡的UID（唯一标识符）表示为主机的MAC地址将很方便。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在ISO-14443标准术语中：</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（邻近耦合设备）是读取器的名称，在我们的情况下是PIC终端</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PICC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（邻近的集成电路卡）是卡，在我们的情况下，电话扮演着这个角色</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apple Pay的常规支付卡之间的重要区别是，该卡始终可读，并且不允许您控制读取过程。可以随意读取衣服，而电话则落入读取器的作用范围，为用户提供了激活虚拟卡的功能。在用户确认之前，电话不会传输任何数据，并且读取器甚至不知道附近有虚拟卡。</font></font><br>
<br>
<pre><code class="plaintext">R&gt;&gt; 52 // WUPA (wake up)<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
T&lt;&lt; 04 00 // ATQA (Answer To Request type A) <font></font>
R&gt;&gt; 93 20 // Select cascade 1 (Anti Collision CL1 SEL)<font></font>
T&lt;&lt; 08 fe e4 ec fe // UID (4 bytes) + BCC (Bit Count Check)<font></font>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e // SEL (select tag 0x9370) + UID + CRC16<font></font>
T&lt;&lt; 20 fc 70  // SAK (Select Acknowledge 0x20) + CRC16 <font></font>
R&gt;&gt; 50 00 57 cd // HALT (Disable communocaion 0x5000) + CRC16<font></font>
R&gt;&gt; 26 // REQA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
T&lt;&lt; 04 00 // ATQA<font></font>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e // SELECT<font></font>
T&lt;&lt; 20 fc 70 // SAK<font></font>
R&gt;&gt; e0 80 31 73 // RATS (Request Answer to Select 0xE080) + CRC16<font></font>
T&lt;&lt; 05 78 80 70 02 a5 46 // ATS (Answer to select response)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
终端不断发送</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x52</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唤醒（WUPA）命令，并且一旦卡出现在操作字段中，</font><font style="vertical-align: inherit;">终端就会</font><font style="vertical-align: inherit;">以“应答请求类型A（ATQA）”命令做出响应，在本例中为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x04 0x00</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 ATQA响应可能因芯片制造商而异。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在接收到ATQA响应之后，终端开始冲突检测过程，以确定在行动领域中是否存在多于一张卡。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x93 0x20</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择级联级别1（SEL CL1）</font><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">要求操作字段中的所有卡报告其UID的第一部分。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
卡的响应为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x08 0xFE 0xE4 0xEC 0xFE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，前四个字节是Apple Pay虚拟卡的UID，最后是</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xFE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位计数检查（BCC）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
收到卡标识符后，读取器将使用命令</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x93 0x70</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（SELECT）</font><font style="vertical-align: inherit;">访问特定卡</font><font style="vertical-align: inherit;">。对于一个团队是UID卡</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x08的0xFE的0xe4 0xec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xFE时</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的BCC + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xdd 0x6e</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
卡以</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x20</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择应答（SAK）+ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xfc 0x70</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16进行</font><font style="vertical-align: inherit;">响应</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果在此步骤中收到了多个SAK响应，则读取器可以减少SELECT命令中UID的长度，直到单个卡响应为止。但是，如上所述，如果在此阶段检测到冲突，即同时存在多个卡，则某些POS终端拒绝继续操作。</font></font><br>
<br>
<blockquote> UID   4, 7  10 .    ,   ,      Apple Pay, UID   4 . ,  Apple Pay   UID   ,     ,  UID  . ,     ,         ,       UID     . <br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
阅读器发送命令</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x50 0x00</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HALT + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x57 0xcd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16。这是一个终止命令。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后再次重复该过程，读取器再次唤醒卡（WUPA），但是在不检查冲突的情况下，立即执行SELECT。为什么这样做-我不知道，也许这是确定碰撞的更可靠的方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
阅读器第二次已发送命令</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xE0 0x80</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择选择应答（RATS）+ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x31 0x73</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
卡响应</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x05 0x78 0x80 0x70 0x02</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择响应的答案（ATS）+ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xA5 0x46</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16。</font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择答案</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-答案类似于联系人卡片的重置答复（ATR）。</font><font style="vertical-align: inherit;">它包含有关最大帧大小和链路层参数的信息。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此阶段，“通道”级别完成，然后根据卡上包含的应用程序，在更高级别的协议上开始交换。</font><font style="vertical-align: inherit;">SELECT操作对于ISO 14443A标准的所有非接触卡都是相同的，包括NFC标签，公共交通票等。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">申请可用的应用程序-SELECT PPSE</font></font></h4><br>
<font color="grey"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">官方描述：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EMV非接触式规范-用于安全元素</font></font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
的</font><font color="grey"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">PPSE和应用程序管理</font></a></font><font style="vertical-align: inherit;">与EMV卡进行通信的始端始终是通过阅读PPSE（付款系统环境）来进行的。</font><font style="vertical-align: inherit;">终端询问卡上有什么支付应用程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常，这是一个应用程序，例如我们的示例-VISA。</font><font style="vertical-align: inherit;">但是，有些卡具有多个付款应用程序，例如，有些特殊的家用MIR卡内部有两个付款应用程序。</font><font style="vertical-align: inherit;">由于MIR支付系统无法在国外使用，因此第二张支付应用程序集成到了卡中，实际上是第二张卡。</font><font style="vertical-align: inherit;">这可以是JCB或银联支付系统应用程序。</font><font style="vertical-align: inherit;">这样的卡称为cobaging。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APDU SELECT PPSE命令</font></font></b><br>
<br>
<pre><code class="cpp">'00 A4 04 00 0E 32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 00'<font></font>
  00 A4 04 00 //  select <font></font>
   0E //  command data (14 )<font></font>
    32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 // command data 2PAY.SYS.DDF01<font></font>
    00 //  <font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回复SELECT PPSE</font></font></b><br>
<br>
<pre><code class="cpp">'6F 23 84 0E 32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 A5 11 BF 0C 0E 61 0C 4F 07 A0 00 00 00 03 10 10 87 01 01 90 00'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了方便起见，我们将使用TVL </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iso8583.info/lib/EMV/TLVs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式的在线解析器来分析答案</font><font style="vertical-align: inherit;">。解析器处理的答案相同：</font></font><br>
<br>
<img width="900" alt="EMV SELECT PPSE VISA RESPONE已解析" src="https://habrastorage.org/webt/yi/x_/_y/yix__y6me7kqdg9inwi05eyk1yq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在所有这些中，我们仅对支付应用程序标识符（AID）感兴趣。在这种情况下，此值为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A0000000031010</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，表示Visa International。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AID用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4F</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标记标记</font><font style="vertical-align: inherit;">。令牌后的第二位是它包含的数据的长度。尽管AID的长度可以在5到16个字节之间变化，但在大多数情况下为7个字节。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AID大清单：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eftlab.co.uk/knowledge-base/211-emv-aid-rid-pix</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
一些流行的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">AID</font></a></font><br>
<br>
<pre><code class="plaintext">A0000000031010 Visa International<font></font>
A0000000032020 Visa International<font></font>
A0000000041010 Mastercard International<font></font>
A0000000043060 Mastercard International United States Maestro (Debit)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应用程序优先级指示器-指示支付应用程序的优先级。</font><font style="vertical-align: inherit;">例如，在内部具有多个付款应用程序的MIR联包卡中，此字段指示两个应用程序中的哪个优先。</font><font style="vertical-align: inherit;">由于我们只有一个Visa International申请，因此它指向该申请，因此没有优先权。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动付款应用程序-SELECT AID</font></font></b><br>
<br>
<pre><code class="cpp">'00 A4 04 00 07 A0 00 00 00 03 10 10'<font></font>
  00 A4 04 00 //  select <font></font>
   07 //  command data (7 )<font></font>
    A0 00 00 00 03 10 10 // AID Visa International<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择了必要的支付应用程序后，终端将启动它。 </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PDOL（处理选项数据对象列表）</font></font></h4><br>
<pre><code class="cpp">'6f 31 84 07 a0 00 00 00 03 10 10 a5 26 9f 38 18 9f 66 04 9f 02 06 9f 03 06 9f 1a 02 95 05 5f 2a 02 9a 03 9c 01 9f 37 04 bf 0c 08 9f 5a 05 60 08 40 06 43 90 00'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们使用解析器</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lo/jr/dh/lojrdhsptl6kkauc02a5c0qwnme.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来</font><font style="vertical-align: inherit;">解析答案。为</font><font style="vertical-align: inherit;">响应支付应用程序的启动，该卡报告了它希望从终端接收的一组参数-PDOL（处理选项数据对象列表）。</font><font style="vertical-align: inherit;">终端必须严格按照此顺序进行响应。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不同卡的PDOL可能有所不同。</font><font style="vertical-align: inherit;">PDOL参数的总数为几十个。</font><font style="vertical-align: inherit;">可在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到PDOL参数的完整列表</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们仔细看看PDOL。</font><font style="vertical-align: inherit;">标记后指示的长度是从终端到此请求的严格预期的响应长度。</font><font style="vertical-align: inherit;">空答案将零填充为所需的长度。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PDOL请求解析：</font></font><br>
<br>
<pre><code class="cpp">9F 38 18 //   PDOL.  18 (24 ) <font></font>
 9F 66 ( 04) // Terminal Transaction Qualifiers (TTQ).    . <font></font>
  9F 02 ( 06) //  <font></font>
   9F 03 ( 06) //  <font></font>
   9F 1A ( 02) //     ISO3166-1<font></font>
   95 ( 05) // Terminal Verification Results<font></font>
    5F 2A ( 02) //  ,    ,   ISO4217<font></font>
     9A ( 03) //    YYMMDD<font></font>
      9C ( 01) //   <font></font>
       9F 37 ( 04) //   <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
到目前为止，此卡上的任何交易的所有传输数据都是相同的。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 收费请求-获取处理选项 </font></font></h4><br>
<pre><code class="cpp">'80A8000023832136A0400000000001429800000000000006430000000000064318091800E011010300'<font></font>
 80 A8 00 00 //  GET PROCESSING OPTIONS (GPO)<font></font>
  23 //    (35 )<font></font>
   83 //  PDOL-<font></font>
    21 //  PDOL- (33 )<font></font>
     36 A0 40 00 // Terminal Transaction Qualifiers (TTQ)<font></font>
      00 00 00 01 42 98 //   (142,98 )<font></font>
       00 00 00 00 00 00 //   <font></font>
        06 43 //    (643 - )<font></font>
         00 00 00 00 00 // Terminal Verification Results (TVR)<font></font>
          06 43 //  (643 - russian ruble) <font></font>
           18 09 18 //  (18  2018 )<font></font>
            00 //  <font></font>
             E0 11 01 03 //   <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该答案清楚地显示了位于俄罗斯的终端如何请求从卡中扣除142.98卢布。</font><font style="vertical-align: inherit;">我们提请注意结尾处的随机数（E0110103）。</font><font style="vertical-align: inherit;">这是参数</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9F37不可预测的数字</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是第一次提到密码学。</font><font style="vertical-align: inherit;">将来，该卡号以及交易数据将必须使用密码签名进行签名。</font><font style="vertical-align: inherit;">这使终端可以控制卡中签名的相关性，并防止重放攻击。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卡对“获取处理选项”的响应 </font></font></h4><br>
<pre><code class="cpp">'7762820200409404180101009F360202069F2608D6F56B8ABED78F239F10201F4AFF32A00000000010030273000000004000000000000000000000000000009F6C02008057134800997250511756D23122010000052099995F9F6E04238800009F2701809000'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此答案包含特定于VISA的数据字段，因此我使用了支持</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VISA非接触式支付规范（VCSP）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的解析器</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img width="600" src="https://habrastorage.org/webt/n-/b0/la/n-b0laaskytjo0ahyyvlo6e7js0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应用程序交换配置文件（AIP）-包含有关支付应用程序参数的信息。在我们的情况下，AIP为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00 40</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。考虑</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EMV 4.3规格书3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中此参数的值</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/rp/tc/ya/rptcyalvdwd6oaycintkbt02krq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我们的示例中，第二个字节中设置了一位，根据该表，该位保留供将来使用（RFU）。我不知道这意味着什么，以及投资Apple Pay的意义何在。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AIP包含有关受支持的付款验证方式（SDA，CDA，DDA）的重要信息。为什么在我的情况下所有这些标志都等于零-我不明白。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应用程序文件定位器（AFL）-包含特定AID中的SFI记录信息范围。基于此响应，终端将生成READ RECORD请求。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们更详细地分析AFL答案：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
短文件标识符（SFI）为0x18。此参数使用五位而不是八位编码。因此，将值0x18（b00011000）转换为b00000011，得到0x3。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第一条记录= 1</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上次纪录= 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
即在“ 3号文件夹”中，存在从1到1的条目，即一个条目。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应用程序事务计数器（ATC）是一个增量事务计数器，每当请求GET PROCESSING OPTIONS时，它就会递增1。达到值0xFFFF或0x7FFF后，付款应用程序将被永久阻止。我相信这样做是为了防止卡私钥的暴力破解。在我们的案例中，可以看出带有Apple Pay的iPhone已被用来支付518（0x206）次。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应用程序密码（AC）-卡使用其私钥计算的密码签名。该签名与其余数据一起传输到发卡行，并根据交易的真实性进行验证。由于无法从卡中提取卡的私钥（可访问的方式），因此消除了复制卡的可能性。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
发行者应用程序数据（IAD）-包含特定于VISA的专有数据。</font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我没有掌握这种结构的分析，对您有所帮助。</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
卡交易资格证明（CTQ）-VISA特定的受支持卡规格列表。例如，是否可以将这种非接触式卡用于ATM机中的交易，并且需要哪种确认。</font></font><br>
<br>
<img align="right" width="200" src="https://habrastorage.org/webt/vd/aw/ny/vdawnyz0tkkjbs-rradkbk0loiy.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Track 2等效数据</font></font><font color="red"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Oppa！</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该字段包含卡号和有效期，有关此信息的更多详细信息将在后面讨论。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
表格事实指示器（FFI）-VISA特定字段。</font><font style="vertical-align: inherit;">描述付款设备的外形和特性。</font><font style="vertical-align: inherit;">在我们的案例中，很明显这是一部手机。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
密码信息数据（CID）- </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我尚未掌握此结构的分析帮助。</font></font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取数据记录查询</font></font></h4><br>
<pre><code class="cpp">'00 b2 01 1c 00'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
终端发送请求以读取从AFL接收的记录：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/od/jw/mv/odjwmvemclc5gd4q6dhvlcmqfjy.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这种情况下，从字节</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x1C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始</font><font style="vertical-align: inherit;">，读取为两个值，其中前五个位是0x18（b000011）和SFI，后三个位是0x04（d100），并且组成记录号。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回复阅读记录</font></font></h2><br>
<pre><code class="cpp">'70375F280206439F0702C0009F19060400100302735F3401009F241D5630303130303134363138303430313737313031333936313637363235'
</code></pre><br>
<img src="https://habrastorage.org/webt/x9/ke/vv/x9kevvho_se85wg6vlgkwrd4jtw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应用程序使用控制（AUC）-确定是否允许在国外使用卡付款，以及允许的操作类型。</font></font><br>
<br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9F19显然是难以理解的-过时的动态数据身份验证数据对象列表（DDOL）</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
EMV令牌化，付款帐户参考（PAR）是令牌化（虚拟）卡特有的参数。</font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我没有掌握这种结构的分析，对您有所帮助。</font></font></font></i><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从拦截的交易中可以提取什么？</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们分析了一个带有链接的VISA卡的Apple Pay非接触式交易被拦截流量的具体示例。万事达卡协议略有不同，但总体上相似。从分析中可以看出，该事务受加密签名保护，并且该协议受到了重放攻击的保护。</font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁条（MSD）模式中有一种过时的非接触式支付协议，对于重播攻击的保护要少得多，但是在本文中，我不会反汇编它，因为据我所知，CIS几乎不支持它，也许我误会了。</font></font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/ys/kk/8_/yskk8_eztdatvwiziqusnqsa2ee.png"><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从截获的数据中，您可以提取卡号（PAN）和到期日期</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如您所见，您可以从拦截的流量中提取出完整的卡号和有效期。</font><font style="vertical-align: inherit;">尽管CVV不在此转储中，但此数据已经足以在某些在线商店中支付。</font><font style="vertical-align: inherit;">如果是普通的物理塑料卡，截获的数据将包含</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与卡本身上标记的相同的PAN和有效期！</font></font></b><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不使用CVV的互联网付款（CNP，MO / TO）</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我以前</font><font style="vertical-align: inherit;">关于基于Apple Pay的ACS的</font><font style="vertical-align: inherit;">文章</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“我们使用Apple Pay和Troika卡作为工作通行证”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我在评论中受到批评，说只有卡的最后10位数字您才能偷钱。在上面的转储中，不仅显示了我的卡的完整编号，而且还显示了到期日期。这些数据足以在Internet上的某些商店中支付。好吧，尝试做到这一点。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ue/-q/wt/ue-qwtah0au0uftojwdu8qsrs3m.png"><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">亚马逊添加卡表格不需要CVV</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果这是一个实际的卡号，则确实可以偷钱，但是当卡用密码签名对交易进行签名时，Apple Pay令牌数据只能用于“客户存在”（CP）操作。</font><font style="vertical-align: inherit;">此数据不能用于Internet和其他操作（例如不存在的卡（CNP））（即电话或电子邮件）上的付款。</font><font style="vertical-align: inherit;">就是这样！</font></font><br>
<br>
<font color="r"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于所有想验证这一点的人，我通知您，上面截取的Apple Pay转储中的详细信息目前是相关的，并与上面有钱的有效卡相关。</font><font style="vertical-align: inherit;">在撰写本文时，这是5千卢布。</font><font style="vertical-align: inherit;">我建议尝试偷他们：）</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为什么Apple Pay比普通卡更安全？</font></font></h2><br>
<div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/jz/cn/2n/jzcn2ndu1pfw-znat4mxtab6k8k.png"></div><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apple Pay与普通非接触式卡</font></font></font></i><br>
<br>
<ul>
<li> <b>Apple Pay   (  )    .</b>            POS-.  , «»        ,       ,   ,     ,   ,   .  Apple Pay  ,            ,       .</li>
<li><b>     </b> —    Apple Pay      (13,56 ),   ,           .       .     Apple Pay     ,     .</li>
<li><b>       </b> —         Card not present (CNP),      ,    ..     Apple Pay    . </li>
<li><b>   </b> —        (Cardholder name)    .   ,   ,    .  Apple Pay    . </li>
</ul><br>
<h2></h2><br>
     .     ,         .         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   </a>.<br>
<br>
  , Apple Pay     .      CNP- (  )    ,         .<br>
<br>
<hr><br>
 :<br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公司</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tehpos.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的硬件。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">乌拉尔复兴开发银行</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并亲自到亚历山大·帕德林（信息安全中心总经理）进行咨询。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aj.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为测试提供iPhone手机。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeria </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aquamine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供本文插图。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digital Security的</font><font style="vertical-align: inherit;">Gleb </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JRun</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供技术建议。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AlexGre</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就EMV协议进行了协商。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habrauser </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形状</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可提供出色的EMV解析器：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iso8583.info</font></font></a></li>
</ul></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN422551/">https://habr.com/ru/post/zh-CN422551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN422541/index.html">联盟漏洞的戏剧化成了幻影</a></li>
<li><a href="../zh-CN422543/index.html">像程序员一样思考。 任务课</a></li>
<li><a href="../zh-CN422545/index.html">同步浏览器标签的方法</a></li>
<li><a href="../zh-CN422547/index.html">为了消除Spectre和Meltdown，您可能必须创建一种全新的处理器</a></li>
<li><a href="../zh-CN422549/index.html">科尔达：科特林</a></li>
<li><a href="../zh-CN422553/index.html">大型官方浏览器扩展程序窃取文件共享数据和加密货币</a></li>
<li><a href="../zh-CN422555/index.html">Android多模块架构。 从A到Z</a></li>
<li><a href="../zh-CN422561/index.html">Yandex如何应用计算机视觉来提高视频广播的质量。 DeepHD技术</a></li>
<li><a href="../zh-CN422565/index.html">Skillbox星期五网络研讨会：面向程序员和设计师的一切</a></li>
<li><a href="../zh-CN422569/index.html">每小时，时间跟踪应用</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>