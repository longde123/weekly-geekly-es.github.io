<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎉 👂 💠 Aprende OpenGL. Lección 5.9 - Representación retrasada 😁 😒 🥞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En artículos anteriores, utilizamos iluminación directa (renderizado hacia adelante o sombreado hacia adelante) . Este es un enfoque simple en el que ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aprende OpenGL. Lección 5.9 - Representación retrasada</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420565/"><img src="https://habrastorage.org/getpro/habr/post_images/20f/e6a/5f3/20fe6a5f38cfacad9ea8355ca097e8f4.png" width="200" align="left"><br><p>  En artículos anteriores, utilizamos iluminación directa <em>(renderizado hacia adelante o sombreado hacia adelante)</em> .  Este es un enfoque simple en el que dibujamos un objeto teniendo en cuenta todas las fuentes de luz, luego dibujamos el siguiente objeto junto con toda la iluminación, y así sucesivamente para cada objeto.  Es bastante simple de entender e implementar, pero al mismo tiempo resulta bastante lento desde el punto de vista del rendimiento: para cada objeto debe clasificar todas las fuentes de luz.  Además, la iluminación directa funciona de manera ineficiente en escenas con una gran cantidad de objetos superpuestos entre sí, ya que la mayoría de los cálculos del sombreador de píxeles no son útiles y se sobrescribirán con valores para objetos más cercanos. </p><br><p>  La iluminación diferida o el sombreado diferido o la representación diferida omiten este problema y cambian drásticamente la forma en que dibujamos los objetos.  Esto brinda nuevas oportunidades para optimizar significativamente las escenas con una gran cantidad de fuentes de luz, lo que le permite dibujar cientos e incluso miles de fuentes de luz a una velocidad aceptable.  A continuación se muestra una escena con 1847 fuentes puntuales de luz dibujadas con iluminación diferida (imagen cortesía de Hannes Nevalainen).  Algo como esto sería imposible con un cálculo directo de la iluminación: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9f2/a49/463/9f2a49463bee47aa077aa59b8dfc7ca6.png" alt="img1"></p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Contenido</b> <div class="spoiler_text"><p>  Parte 1. Comenzando <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Opengl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Creación de ventanas</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Hola ventana</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Hola triangulo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sombreadores</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Texturas</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Transformaciones</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sistemas de coordenadas</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cámara</a> </li></ol><br><p>  Parte 2. Iluminación básica <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Colores</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Conceptos básicos de iluminación</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Materiales</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mapas de textura</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuentes de luz</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Múltiples fuentes de iluminación</a> </li></ol><br><p>  Parte 3. Descargar modelos 3D <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Biblioteca Assimp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Clase de polígono de malla</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Clase de modelo 3D</a> </li></ol><br><p>  Parte 4. Características avanzadas de OpenGL <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Prueba de profundidad</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Prueba de plantilla</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mezcla de colores</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Caras de recorte</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Buffer de trama</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tarjetas cúbicas</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Manejo avanzado de datos</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GLSL avanzado</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sombreador geométrico</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instancia</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Suavizado</a> </li></ol><br><p>  Parte 5. Iluminación avanzada <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Iluminación avanzada.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Modelo Blinn-Fong.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Corrección gamma</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cartas de sombra</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mapas de sombras omnidireccionales</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mapeo normal</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mapeo de paralaje</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HDR</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bloom</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Renderizado diferido</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SSAO</a> </li></ol><br><p>  Parte 6. PBR <br><br></p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Teoría</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuentes de luz analiticas</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IBL</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Radiación difusa.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IBL</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Exposición al espejo.</a> </li></ol></div></div><br><p>  La idea de la iluminación diferida es que diferimos las partes más complejas computacionalmente (como la iluminación) para más adelante.  La iluminación diferida consta de dos pasos: en el primer paso, el <em>paso de geometría (paso de geometría)</em> , se dibuja toda la escena y se almacena diversa información en un conjunto de texturas llamado G-buffer.  Por ejemplo: posiciones, colores, normales y / o reflejo de superficie para cada píxel.  La información gráfica almacenada en el G-buffer se usa luego para calcular la iluminación.  El siguiente es el contenido del G-buffer para un cuadro: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/046/982/04a/04698204af1866fdb21330aca39484b0.png" alt="img2"></p><br><p>  En el segundo pase, llamado pase de iluminación, usamos las texturas del G-buffer cuando dibujamos el rectángulo de pantalla completa.  En lugar de usar sombreadores de vértices y fragmentos por separado para cada objeto, dibujamos la escena completa píxel por píxel.  El cálculo de la iluminación permanece exactamente igual que con un pase directo, pero tomamos los datos necesarios solo del G-buffer y los sombreadores variables <em>(uniformes)</em> , y no del sombreador de vértices. </p><br><p>  La imagen a continuación muestra bien el proceso de dibujo general. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2d5/a9c/f88/2d5a9cf881383e8d058c7ef1a731ce9e.png" alt="img3"></p><br><p>  La principal ventaja es que la información almacenada en el G-buffer pertenece a los fragmentos más cercanos que no están ocultos por nada: la prueba de profundidad solo los deja.  Gracias a esto, calculamos la iluminación para cada píxel solo una vez, sin hacer demasiado trabajo.  Además, la iluminación diferida nos brinda oportunidades para nuevas optimizaciones, lo que nos permite utilizar muchas más fuentes de luz que en la iluminación directa. </p><br><p>  Sin embargo, hay un par de inconvenientes: el G-buffer almacena una gran cantidad de información sobre la escena.  Además, los datos del tipo de posición deben almacenarse con alta precisión, como resultado, el búfer G ocupa bastante espacio en la memoria.  Otro inconveniente es que no podremos usar objetos translúcidos (ya que el búfer almacena información solo para la superficie más cercana) y el suavizado como MSAA tampoco funcionará.  Existen varias soluciones para resolver estos problemas, se analizan al final del artículo. </p><br><p>  <em>(Note lane. - El G-buffer ocupa mucho espacio en la memoria. Por ejemplo, para una pantalla de 1920 * 1080 y con 128 bits por píxel, el búfer tomará 33mb. Hay requisitos crecientes para el ancho de banda de la memoria, hay muchos más datos escritos y leídos)</em> </p><br><h3 id="g-bufer">  G-buffer </h3><br><p>  G-buffer se refiere a las texturas utilizadas para almacenar información relacionada con la iluminación utilizada en la última pasada de representación.  Veamos qué información necesitamos para calcular la iluminación para el renderizado directo: </p><br><ul><li>  Vector de posición 3D: se utiliza para averiguar la posición del fragmento en relación con la cámara y las fuentes de luz. </li><li>  Color difuso del fragmento (reflectividad para rojo, verde y azul, en general, color). </li><li>  Vector normal 3d (para determinar a qué ángulo cae la luz en la superficie) </li><li>  flotador para almacenar el componente espejo </li><li>  La posición de la fuente de luz y su color. </li><li>  Posición de la cámara. </li></ul><br><p>  Usando estas variables, podemos calcular la cobertura usando el modelo Blinn-Fong que ya conocemos.  El color y la posición de la fuente de luz, así como la posición de la cámara pueden ser variables comunes, pero el resto de los valores serán diferentes para cada fragmento de imagen.  Si pasamos exactamente los mismos datos al paso final de iluminación diferida, que usaríamos para un pase directo, obtendremos el mismo resultado, a pesar de que dibujaremos fragmentos en un rectángulo 2D regular. </p><br><p>  OpenGL no tiene restricciones sobre lo que podemos almacenar en una textura, por lo que tiene sentido almacenar toda la información en una o más texturas del tamaño de una pantalla (llamada G-buffer) y usarlas todas en el pase de iluminación.  Dado que el tamaño de las texturas y la pantalla es el mismo, obtenemos los mismos datos de entrada que en la iluminación directa. </p><br><p>  En pseudocódigo, la imagen general se ve así: </p><br><pre><code class="plaintext hljs">while(...) // render loop { // 1.  :  /    g- glBindFramebuffer(GL_FRAMEBUFFER, gBuffer); glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); gBufferShader.use(); for(Object obj : Objects) { ConfigureShaderTransformsAndUniforms(); obj.Draw(); } // 2.  :  g-     glBindFramebuffer(GL_FRAMEBUFFER, 0); glClear(GL_COLOR_BUFFER_BIT); lightingPassShader.use(); BindAllGBufferTextures(); SetLightingUniforms(); RenderQuad(); }</code> </pre> <br><p>  Información necesaria para cada píxel: vector de <strong>posición</strong> , vector <strong>normal</strong> , vector de <strong>color</strong> y valor para el componente <strong>espejo</strong> .  En el paso geométrico, dibujamos todos los objetos en la escena y guardamos todos estos datos en el G-buffer.  Podemos usar <em>múltiples objetivos de renderizado</em> para llenar todos los buffers en un sorteo, este enfoque se discutió en el artículo anterior sobre la implementación del brillo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bloom</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">traducción en el centro</a> </p><br><p>  Para el pase geométrico, cree un framebuffer con el nombre obvio gBuffer, al que le agregaremos varios buffers de color y un buffer de profundidad.  Para almacenar posiciones y valores normales, es preferible utilizar una textura con alta precisión (valores flotantes de 16 o 32 bits para cada componente), almacenaremos el color difuso y los valores especulares en la textura de forma predeterminada (precisión de 8 bits por componente). </p><br><pre> <code class="plaintext hljs">unsigned int gBuffer; glGenFramebuffers(1, &amp;gBuffer); glBindFramebuffer(GL_FRAMEBUFFER, gBuffer); unsigned int gPosition, gNormal, gColorSpec; //   glGenTextures(1, &amp;gPosition); glBindTexture(GL_TEXTURE_2D, gPosition); glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB16F, SCR_WIDTH, SCR_HEIGHT, 0, GL_RGB, GL_FLOAT, NULL); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST); glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D, gPosition, 0); //   glGenTextures(1, &amp;gNormal); glBindTexture(GL_TEXTURE_2D, gNormal); glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB16F, SCR_WIDTH, SCR_HEIGHT, 0, GL_RGB, GL_FLOAT, NULL); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST); glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT1, GL_TEXTURE_2D, gNormal, 0); //    +    glGenTextures(1, &amp;gAlbedoSpec); glBindTexture(GL_TEXTURE_2D, gAlbedoSpec); glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, SCR_WIDTH, SCR_HEIGHT, 0, GL_RGBA, GL_UNSIGNED_BYTE, NULL); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST); glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT2, GL_TEXTURE_2D, gAlbedoSpec, 0); //  OpenGL,        unsigned int attachments[3] = { GL_COLOR_ATTACHMENT0, GL_COLOR_ATTACHMENT1, GL_COLOR_ATTACHMENT2 }; glDrawBuffers(3, attachments); //           . [...]</code> </pre> <br><p>  Como usamos varios objetivos de representación, debemos decirle explícitamente a OpenGL a qué búferes del GBuffer adjunto vamos a dibujar en <code>glDrawBuffers()</code> .  También vale la pena señalar que almacenamos posiciones y las normales tienen 3 componentes cada una, y las almacenamos en texturas RGB.  Pero al mismo tiempo, inmediatamente colocamos la misma textura RGBA tanto en el color como en el coeficiente de reflexión especular; gracias a esto, usamos un buffer menos.  Si su implementación de renderizado diferido se vuelve más compleja y utiliza más datos, puede encontrar fácilmente nuevas formas de combinar datos y organizarlos en texturas. </p><br><p>  En el futuro, debemos procesar los datos en el G-buffer.  Si cada objeto tiene color, normal y coeficiente de reflexión especular, podemos escribir algo como el siguiente sombreador: </p><br><pre> <code class="plaintext hljs">#version 330 core layout (location = 0) out vec3 gPosition; layout (location = 1) out vec3 gNormal; layout (location = 2) out vec4 gAlbedoSpec; in vec2 TexCoords; in vec3 FragPos; in vec3 Normal; uniform sampler2D texture_diffuse1; uniform sampler2D texture_specular1; void main() { //       G- gPosition = FragPos; //          G- gNormal = normalize(Normal); //   gAlbedoSpec.rgb = texture(texture_diffuse1, TexCoords).rgb; //       gAlbedoSpec.a = texture(texture_specular1, TexCoords).r; }</code> </pre> <br><p>  Como utilizamos varios objetivos de representación, con la ayuda del <code>layout</code> indicamos qué y en qué búfer del framebuffer actual representamos.  Tenga en cuenta que no almacenamos el coeficiente espejo en un búfer separado, ya que podemos almacenar el valor flotante en el canal alfa de uno de los búferes. </p><br><blockquote>  Tenga en cuenta que al calcular la iluminación es extremadamente importante almacenar todas las variables en el mismo espacio de coordenadas, en este caso almacenamos (y realizamos cálculos) en el espacio del mundo. </blockquote><p>  Si ahora procesamos varios nanosuits en un G-buffer y dibujamos su contenido proyectando cada buffer en un cuarto de la pantalla, veremos algo como esto: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/046/982/04a/04698204af1866fdb21330aca39484b0.png" alt="img4"></p><br><p>  Intente visualizar la posición y los vectores normales y asegúrese de que sean correctos.  Por ejemplo, los vectores normales que apuntan a la derecha serán rojos.  Del mismo modo con los objetos ubicados a la derecha del centro de la escena.  Una vez que esté satisfecho con el contenido del G-buffer, pasemos a la siguiente parte: el paso de la iluminación. </p><br><h3 id="prohod-osvescheniya">  Paso de iluminación </h3><br><p>  Ahora que tenemos una gran cantidad de información en el G-buffer, podemos calcular completamente la iluminación y los colores finales para cada píxel del G-buffer, utilizando su contenido como entrada para algoritmos de cálculo de iluminación.  Dado que los valores del G-buffer representan solo fragmentos visibles, realizaremos cálculos complejos de iluminación exactamente una vez para cada píxel.  Debido a esto, la iluminación diferida es bastante efectiva, especialmente en escenas complejas, en las que, cuando se procesa directamente para cada píxel, a menudo es necesario calcular la iluminación varias veces. </p><br><p>  Para el paso de la iluminación, vamos a representar un rectángulo de pantalla completa (un poco como el efecto de procesamiento posterior) y realizar un cálculo lento de la iluminación para cada píxel. </p><br><pre> <code class="plaintext hljs">glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); glActiveTexture(GL_TEXTURE0); glBindTexture(GL_TEXTURE_2D, gPosition); glActiveTexture(GL_TEXTURE1); glBindTexture(GL_TEXTURE_2D, gNormal); glActiveTexture(GL_TEXTURE2); glBindTexture(GL_TEXTURE_2D, gAlbedoSpec); //         shaderLightingPass.use(); SendAllLightUniformsToShader(shaderLightingPass); shaderLightingPass.setVec3("viewPos", camera.Position); RenderQuad();</code> </pre> <br><p>  <em>Vinculamos</em> todas las texturas de G-buffer necesarias antes de renderizar y, además, establecemos los valores variables relacionados con la iluminación en el sombreador. </p><br><p>  El sombreador de pasaje de fragmentos es muy similar al que usamos en las lecciones de la reunión.  Fundamentalmente nuevo es la forma en que obtenemos información para la iluminación directamente desde el G-buffer. </p><br><pre> <code class="plaintext hljs">#version 330 core out vec4 FragColor; in vec2 TexCoords; uniform sampler2D gPosition; uniform sampler2D gNormal; uniform sampler2D gAlbedoSpec; struct Light { vec3 Position; vec3 Color; }; const int NR_LIGHTS = 32; uniform Light lights[NR_LIGHTS]; uniform vec3 viewPos; void main() { //    G- vec3 FragPos = texture(gPosition, TexCoords).rgb; vec3 Normal = texture(gNormal, TexCoords).rgb; vec3 Albedo = texture(gAlbedoSpec, TexCoords).rgb; float Specular = texture(gAlbedoSpec, TexCoords).a; //     vec3 lighting = Albedo * 0.1; //    vec3 viewDir = normalize(viewPos - FragPos); for(int i = 0; i &lt; NR_LIGHTS; ++i) { //   vec3 lightDir = normalize(lights[i].Position - FragPos); vec3 diffuse = max(dot(Normal, lightDir), 0.0) * Albedo * lights[i].Color; lighting += diffuse; } FragColor = vec4(lighting, 1.0); }</code> </pre> <br><p>  El sombreador de iluminación acepta 3 texturas que contienen toda la información registrada en el pasaje geométrico y en la que consiste el G-buffer.  Si tomamos la entrada para la iluminación a partir de texturas, obtenemos exactamente los mismos valores que con el renderizado directo normal.  Al comienzo del sombreador de fragmentos, obtenemos los valores relacionados con las variables de iluminación simplemente leyendo la textura.  Tenga en cuenta que obtenemos tanto el color como el coeficiente de reflexión especular de una textura: <code>gAlbedoSpec</code> . </p><br><p>  Dado que para cada fragmento hay valores (así como variables de sombreado uniformes) necesarios para calcular la iluminación de acuerdo con el modelo Blinn-Fong, no necesitamos cambiar el código de cálculo de iluminación.  Lo único que se ha cambiado es la forma de obtener los valores de entrada. </p><br><p>  Comenzar una demostración simple con 32 fuentes de luz pequeñas se parece a esto: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/73d/9cf/044/73d9cf044e097e086fb317ac0c220339.png" alt="img5"></p><br><p>  Una de las desventajas de la iluminación diferida es la imposibilidad de mezclar, ya que todos los g-buffers para cada píxel contienen información sobre una sola superficie, mientras que la mezcla usa combinaciones de varios fragmentos.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">(Mezcla)</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">traducción</a> .  Otra desventaja de la iluminación diferida es que te obliga a usar un método común para calcular la iluminación de todos los objetos;  aunque esta limitación de alguna manera se puede eludir agregando información de material al g-buffer. </p><br><p>  Para hacer frente a estas deficiencias (especialmente la falta de mezcla), a menudo dividen el renderizado en dos partes: renderizado con iluminación diferida, y la segunda parte con renderizado directo destinado a aplicar algo a la escena o usar sombreadores que no son compatibles con la iluminación diferida.  <em>(Nota de los ejemplos: agregar humo translúcido, fuego, vidrio)</em> Para ilustrar el trabajo, dibujaremos las fuentes de luz como pequeños cubos usando renderizado directo, ya que los cubos de iluminación requieren un sombreador especial (brillan uniformemente en el mismo color). </p><br><h3 id="kombiniruem-otlozhennyy-renderig-s-pryamym">  Combina renderizado diferido con directo. </h3><br><p>  Suponga que queremos dibujar cada fuente de luz en forma de cubo 3D con un centro que coincida con la posición de la fuente de luz y que emita luz con el color de la fuente.  La primera idea que viene a la mente es renderizar cubos directamente para cada fuente de luz sobre los resultados de renderización diferidos.  Es decir, dibujamos cubos como de costumbre, pero solo después del renderizado diferido.  El código se verá así: </p><br><pre> <code class="plaintext hljs">//    [...] RenderQuad(); //          shaderLightBox.use(); shaderLightBox.setMat4("projection", projection); shaderLightBox.setMat4("view", view); for (unsigned int i = 0; i &lt; lightPositions.size(); i++) { model = glm::mat4(); model = glm::translate(model, lightPositions[i]); model = glm::scale(model, glm::vec3(0.25f)); shaderLightBox.setMat4("model", model); shaderLightBox.setVec3("lightColor", lightColors[i]); RenderCube(); }</code> </pre> <br><p>  Estos cubos renderizados no tienen en cuenta los valores de profundidad del renderizado diferido y, como resultado, siempre se dibujan sobre los objetos ya renderizados: esto no es lo que buscamos. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6a/59a/41b/e6a59a41b4c5ad658abae4841c9008de.png" alt="img6"></p><br><p>  Primero necesitamos copiar la información de profundidad del pasaje geométrico en el búfer de profundidad, y solo después de eso dibujar los cubos luminosos.  Por lo tanto, los fragmentos de cubos luminosos se dibujarán solo si están más cerca que los objetos ya dibujados. </p><br><p>  Podemos copiar el contenido del framebuffer a otro framebuffer usando la función <code>glBlitFramebuffer</code> .  Ya hemos usado esta función en el ejemplo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">suavizado</a> : ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">suavizado</a> ), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">traducción</a> .  La función <code>glBlitFramebuffer</code> copia la parte especificada por el usuario del framebuffer en la parte especificada de otro framebuffer. </p><br><p>  Para los objetos dibujados en el pasaje de iluminación diferido, guardamos la profundidad en el g-buffer del objeto framebuffer.  Si simplemente copiamos el contenido del búfer de profundidad del búfer g al búfer de profundidad predeterminado, los cubos luminosos se dibujarán como si toda la geometría de la escena se dibujara usando un pase de renderizado directo.  Como se explicó brevemente en el ejemplo anti-aliasing, necesitamos establecer framebuffers para leer y escribir: </p><br><pre> <code class="plaintext hljs">glBindFramebuffer(GL_READ_FRAMEBUFFER, gBuffer); glBindFramebuffer(GL_DRAW_FRAMEBUFFER, 0); //   - glBlitFramebuffer( 0, 0, SCR_WIDTH, SCR_HEIGHT, 0, 0, SCR_WIDTH, SCR_HEIGHT, GL_DEPTH_BUFFER_BIT, GL_NEAREST ); glBindFramebuffer(GL_FRAMEBUFFER, 0); //        [...]</code> </pre> <br><p>  Aquí copiamos todo el contenido del búfer de profundidad de framebuffer al búfer de profundidad predeterminado (si es necesario, puede copiar los búferes de color o el búfer stensil de la misma manera).  Si ahora renderizamos los cubos brillantes, se dibujarán como si la geometría de la escena fuera real (aunque se dibuja como simple). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ce2/92d/576/ce292d57678320f98fb946c2a28aefbb.png" alt="img7"></p><br><p>  El código fuente de la demostración se puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> . </p><br><p>  Con este enfoque, podemos combinar fácilmente la representación diferida con la representación directa.  Esto es excelente, ya que podemos aplicar mezclas y dibujar objetos que requieren sombreadores especiales que no son aplicables para el renderizado diferido. </p><br><h3 id="bolshe-istochnikov-sveta">  Más fuentes de luz </h3><br><p>  La iluminación diferida a menudo se elogia por poder atraer una gran cantidad de fuentes de luz sin una disminución significativa en el rendimiento.  La iluminación retrasada por sí sola no nos permite dibujar una gran cantidad de fuentes de luz, ya que todavía tenemos que calcular la contribución de todas las fuentes de luz para cada píxel.  Para dibujar una gran cantidad de fuentes de luz, se utiliza una optimización muy hermosa, aplicable al renderizado diferido, el área de acción de las fuentes de luz.  (volúmenes ligeros) </p><br><p>  Por lo general, cuando dibujamos fragmentos en una escena altamente iluminada, tenemos en cuenta la contribución de <strong>cada</strong> fuente de luz en la escena, independientemente de su distancia al fragmento.  Si la mayoría de las fuentes de luz nunca afectarán el fragmento, ¿por qué estamos perdiendo el tiempo calculando para ellas? </p><br><p>  La idea del alcance de la fuente de luz es encontrar el radio (o volumen) de la fuente de luz, es decir, el área en la que la luz puede alcanzar la superficie.  Como la mayoría de las fuentes de luz utilizan algún tipo de atenuación, podemos encontrar la distancia máxima (radio) que puede alcanzar la luz.  Después de eso, realizamos cálculos de iluminación complejos solo para aquellas fuentes de luz que afectan a este fragmento.  Esto nos salva de una gran cantidad de cálculos, ya que solo calculamos la iluminación donde se necesita. </p><br><p>  Con este enfoque, el truco principal es determinar el tamaño del área de acción de la fuente de luz. </p><br><h3 id="vychislenie-oblasti-deystviya-istochnika-sveta-radiusa">  Cálculo del alcance de una fuente de luz (radio) </h3><br><p>  Para obtener el radio de la fuente de luz, debemos resolver la ecuación de amortiguación para el brillo, que consideramos oscuro: puede ser 0.0 o algo un poco más iluminado, pero aún oscuro: por ejemplo, 0.03.  Para demostrar cómo calcular el radio, usaremos una de las funciones de atenuación más complejas y comunes del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ejemplo del lanzador de luz</a> </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-msubsup" id="MJXp-Span-2"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-4" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12"><font style="vertical-align: inherit;">f </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13"><font style="vertical-align: inherit;">r </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14"><font style="vertical-align: inherit;">a </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15"><font style="vertical-align: inherit;">c </font></span><span class="MJXp-mrow" id="MJXp-Span-16"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17"><font style="vertical-align: inherit;">I </font></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-msubsup" id="MJXp-Span-19"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">K </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-msubsup" id="MJXp-Span-19"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-21" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">c</font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"> + </font></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-msubsup" id="MJXp-Span-23"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">K </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-msubsup" id="MJXp-Span-23"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-25" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">l</font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"> ∗ </font></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27"><font style="vertical-align: inherit;">d </font></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-mo" id="MJXp-Span-28" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;">+ </font></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-msubsup" id="MJXp-Span-29"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">K </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-msubsup" id="MJXp-Span-29"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-31" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">q</font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-mo" id="MJXp-Span-32" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"> ∗ </font></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-msubsup" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">d </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-msubsup" id="MJXp-Span-33"><span class="MJXp-mn MJXp-script" id="MJXp-Span-35" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;">2</font></span></span></span></font><span class="MJXp-mtext" id="MJXp-Span-11">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow" id="MJXp-Span-16"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-msubsup" id="MJXp-Span-19"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-21" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-23"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-25" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-28" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-29"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-31" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-32" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-35" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"></font></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="36.662ex" height="3.142ex" viewBox="0 -987.6 15784.8 1352.7" role="img" focusable="false" style="vertical-align: -0.848ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-46" x="0" y="0"></use><g transform="translate(643,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-6C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-69" x="298" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-67" x="644" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-68" x="1124" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-74" x="1701" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-3D" x="2479" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-66" x="3785" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-72" x="4336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-61" x="4787" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-63" x="5317" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-49" x="5750" y="0"></use><g transform="translate(6255,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-63" x="1201" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-2B" x="1478" y="0"></use><g transform="translate(2478,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-6C" x="1201" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-2217" x="3861" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-64" x="4584" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-2B" x="5330" y="0"></use><g transform="translate(6330,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-71" x="1201" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-2217" x="7828" y="0"></use><g transform="translate(8551,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-32" x="741" y="583"></use></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> F_ {light} = \ frac {I} {K_c + K_l * d + K_q * d ^ 2} </script></p><br><p>  Queremos resolver esta ecuación para el caso cuando <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-36"><span class="MJXp-msubsup" id="MJXp-Span-37"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-39" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-45" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mn" id="MJXp-Span-46"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.184ex" height="2.66ex" viewBox="0 -780.1 4815.5 1145.2" role="img" focusable="false" style="vertical-align: -0.848ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-46" x="0" y="0"></use><g transform="translate(643,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-6C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-69" x="298" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-67" x="644" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-68" x="1124" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-74" x="1701" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-3D" x="2479" y="0"></use><g transform="translate(3535,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-30" x="779" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-2"> F_ {light} = 0.0 </script>  , es decir, cuando la fuente de luz es completamente oscura.  Sin embargo, esta ecuación nunca alcanzará el valor exacto de 0.0, por lo que no hay solución.  Sin embargo, podemos resolver la ecuación de brillo para un valor cercano a 0.0, que puede considerarse prácticamente oscuro.  En este ejemplo, consideramos aceptable el valor de brillo en <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-47"><span class="MJXp-mtext" id="MJXp-Span-48">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mrow" id="MJXp-Span-53"><span class="MJXp-mn" id="MJXp-Span-54"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-55"><span class="MJXp-mn" id="MJXp-Span-56"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">256</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.794ex" height="2.419ex" viewBox="0 -780.1 4217 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-66" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-72" x="800" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-61" x="1252" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMATHI-63" x="1781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-35" x="2215" y="0"></use><g transform="translate(2715,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/420565/&amp;usg=ALkJrhj0cQg0ZpV3c7vbry56Q7WgKxYJDw#MJMAIN-36" x="1001" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-3"> \ frac {5} {256} </script>  - dividido por 256, ya que el framebuffer de 8 bits puede contener 256 valores de brillo diferentes. </p><br><blockquote>  La función de atenuación seleccionada se vuelve casi oscura a una distancia de rango, si la limitamos a un brillo inferior a 5/256, entonces el rango de la fuente de luz será demasiado grande, esto no es tan efectivo.  Idealmente, una persona no debería ver un borde repentino de luz de una fuente de luz.  Por supuesto, esto depende del tipo de escena, un valor mayor del brillo mínimo proporciona áreas de acción más pequeñas de las fuentes de luz y aumenta la eficiencia de los cálculos, pero puede conducir a artefactos notables en la imagen: la iluminación se interrumpirá abruptamente en los bordes del área de acción de la fuente de luz. </blockquote><p>  La ecuación de atenuación que debemos resolver se convierte en: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-57"><span class="MJXp-mtext" id="MJXp-Span-58">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">c</span><span class="MJXp-mrow" id="MJXp-Span-63"><span class="MJXp-mn" id="MJXp-Span-64">5</span></span><span class="MJXp-mrow" id="MJXp-Span-65"><span class="MJXp-mn" id="MJXp-Span-66">256</span></span><span class="MJXp-mo" id="MJXp-Span-67" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-68">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72">c</span><span class="MJXp-mrow" id="MJXp-Span-73"><span class="MJXp-msubsup" id="MJXp-Span-74"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-75" style="margin-right: 0.05em;">I</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-76" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79">x</span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-80"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-83">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-85">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88">i</span><span class="MJXp-mrow" id="MJXp-Span-89"><span class="MJXp-mo" id="MJXp-Span-90" style="margin-left: 0em; margin-right: 0em;">ó</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">n</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-4"> \ frac {5} {256} = \ frac {I_ {max}} {Atenuación} </script></p><br><p>  Aqui <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-92"><span class="MJXp-msubsup" id="MJXp-Span-93"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94" style="margin-right: 0.05em;">I</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-95" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">x</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-5"> I_ {max} </script>  - El componente más brillante de la luz (de los canales r, g, b).  Usaremos el componente más brillante, ya que los otros componentes darán una restricción más débil en el alcance de la fuente de luz. </p><br><p>  Seguimos resolviendo la ecuación: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-99"><span class="MJXp-mtext" id="MJXp-Span-100">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-103">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">c</span><span class="MJXp-mrow" id="MJXp-Span-105"><span class="MJXp-mn" id="MJXp-Span-106">5</span></span><span class="MJXp-mrow" id="MJXp-Span-107"><span class="MJXp-mn" id="MJXp-Span-108">256</span></span><span class="MJXp-mtext" id="MJXp-Span-109">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-112">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">i</span><span class="MJXp-mrow" id="MJXp-Span-122"><span class="MJXp-mo" id="MJXp-Span-123" style="margin-left: 0em; margin-right: 0em;">ó</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">n</span><span class="MJXp-mo" id="MJXp-Span-125" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-126"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127" style="margin-right: 0.05em;">I</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-128" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">x</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> \ frac {5} {256} \ cdot Atenuación = I_ {max} </script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-132"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-138">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">i</span><span class="MJXp-mrow" id="MJXp-Span-141"><span class="MJXp-mo" id="MJXp-Span-142" style="margin-left: 0em; margin-right: 0em;">ó</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">n</span><span class="MJXp-mo" id="MJXp-Span-144" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-145"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146" style="margin-right: 0.05em;">I</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-147" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-149">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150">x</span></span></span><span class="MJXp-mtext" id="MJXp-Span-151">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-154">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">t</span><span class="MJXp-mtext" id="MJXp-Span-156">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-159">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">c</span><span class="MJXp-mrow" id="MJXp-Span-161"><span class="MJXp-mn" id="MJXp-Span-162">256</span></span><span class="MJXp-mrow" id="MJXp-Span-163"><span class="MJXp-mn" id="MJXp-Span-164">5</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-7"> Atenuación = I_ {max} \ cdot \ frac {256} {5} </script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-165"><span class="MJXp-msubsup" id="MJXp-Span-166"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-167" style="margin-right: 0.05em;">K</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-168" style="vertical-align: -0.4em;">c</span></span><span class="MJXp-mo" id="MJXp-Span-169" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-170"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-171" style="margin-right: 0.05em;">K</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-172" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mtext" id="MJXp-Span-173">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-177">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178">d</span><span class="MJXp-mo" id="MJXp-Span-179" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-180"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181" style="margin-right: 0.05em;">K</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-182" style="vertical-align: -0.4em;">q</span></span><span class="MJXp-mtext" id="MJXp-Span-183">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-184">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">t</span><span class="MJXp-msubsup" id="MJXp-Span-188"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189" style="margin-right: 0.05em;">d</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-190" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-191" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-192"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-193" style="margin-right: 0.05em;">I</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-194" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">x</span></span></span><span class="MJXp-mtext" id="MJXp-Span-198">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-199">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-201">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202">t</span><span class="MJXp-mtext" id="MJXp-Span-203">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">c</span><span class="MJXp-mrow" id="MJXp-Span-208"><span class="MJXp-mn" id="MJXp-Span-209">256</span></span><span class="MJXp-mrow" id="MJXp-Span-210"><span class="MJXp-mn" id="MJXp-Span-211">5</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-8"> K_c + K_l \ cdot d + K_q \ cdot d ^ 2 = I_ {max} \ cdot \ frac {256} {5} </script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-212"><span class="MJXp-msubsup" id="MJXp-Span-213"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214" style="margin-right: 0.05em;">K</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-215" style="vertical-align: -0.4em;">c</span></span><span class="MJXp-mo" id="MJXp-Span-216" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-217"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-218" style="margin-right: 0.05em;">K</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-219" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mtext" id="MJXp-Span-220">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225">d</span><span class="MJXp-mo" id="MJXp-Span-226" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-227"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228" style="margin-right: 0.05em;">K</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-229" style="vertical-align: -0.4em;">q</span></span><span class="MJXp-mtext" id="MJXp-Span-230">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-232">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">t</span><span class="MJXp-msubsup" id="MJXp-Span-235"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-236" style="margin-right: 0.05em;">d</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-237" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-238" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-239"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-240" style="margin-right: 0.05em;">I</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-241" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">x</span></span></span><span class="MJXp-mtext" id="MJXp-Span-245">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-246">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-247">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-248">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249">t</span><span class="MJXp-mtext" id="MJXp-Span-250">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-251">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-254">c</span><span class="MJXp-mrow" id="MJXp-Span-255"><span class="MJXp-mn" id="MJXp-Span-256">256</span></span><span class="MJXp-mrow" id="MJXp-Span-257"><span class="MJXp-mn" id="MJXp-Span-258">5</span></span><span class="MJXp-mo" id="MJXp-Span-259" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-260">0</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-9"> K_c + K_l \ cdot d + K_q \ cdot d ^ 2 - I_ {max} \ cdot \ frac {256} {5} = 0 </script></p><br><p>  La última ecuación es una ecuación cuadrática en la forma <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-261"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262">a</span><span class="MJXp-msubsup" id="MJXp-Span-263"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-265" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-266" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-268">x</span><span class="MJXp-mo" id="MJXp-Span-269" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">c</span><span class="MJXp-mo" id="MJXp-Span-271" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-272">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> a x ^ 2 + b x + c = 0 </script>  con la siguiente solución: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-273"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274">x</span><span class="MJXp-mo" id="MJXp-Span-275" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-276">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-277">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-278">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-279">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-280">c</span><span class="MJXp-mrow" id="MJXp-Span-281"><span class="MJXp-mo" id="MJXp-Span-282" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-283"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-284" style="margin-right: 0.05em;">K</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-285" style="vertical-align: -0.4em;">l</span></span><span class="MJXp-mo" id="MJXp-Span-286" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mtext" id="MJXp-Span-287">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-288">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-289">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-290">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-291">t</span><span class="MJXp-mrow" id="MJXp-Span-292"><span class="MJXp-msubsup" id="MJXp-Span-293"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-294" style="margin-right: 0.05em;">K</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-296">2</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-295">l</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-297" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-298">4</span><span class="MJXp-msubsup" id="MJXp-Span-299"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-300" style="margin-right: 0.05em;">K</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-301" style="vertical-align: -0.4em;">q</span></span><span class="MJXp-mo" id="MJXp-Span-302" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-303"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304" style="margin-right: 0.05em;">K</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-305" style="vertical-align: -0.4em;">c</span></span><span class="MJXp-mo" id="MJXp-Span-306" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-307"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308" style="margin-right: 0.05em;">I</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-309" style="vertical-align: -0.4em;">m</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-310">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311">x</span><span class="MJXp-mtext" id="MJXp-Span-312">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-315">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316">c</span><span class="MJXp-mrow" id="MJXp-Span-317"><span class="MJXp-mn" id="MJXp-Span-318">256</span></span><span class="MJXp-mrow" id="MJXp-Span-319"><span class="MJXp-mn" id="MJXp-Span-320">5</span></span><span class="MJXp-mo" id="MJXp-Span-321" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MJXp-mrow" id="MJXp-Span-322"><span class="MJXp-mn" id="MJXp-Span-323">2</span><span class="MJXp-msubsup" id="MJXp-Span-324"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325" style="margin-right: 0.05em;">K</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-326" style="vertical-align: -0.4em;">q</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-11"> x = \ frac {-K_l + \ sqrt {K_l ^ 2 - 4 K_q (K_c - I_max \ frac {256} {5})}} {2 K_q} </script></p><br><p>  Obtuvimos una ecuación general que nos permite sustituir los parámetros (atenuación constante, coeficientes lineales y cuadráticos) para encontrar x, el radio de la fuente de luz. </p><br><pre> <code class="plaintext hljs">float constant = 1.0; float linear = 0.7; float quadratic = 1.8; float lightMax = std::fmaxf(std::fmaxf(lightColor.r, lightColor.g), lightColor.b); float radius = (-linear + std::sqrtf(linear * linear - 4 * quadratic * (constant - (256.0 / 5.0) * lightMax))) / (2 * quadratic);</code> </pre> <br><p>  La fórmula devuelve un radio entre aproximadamente 1.0 y 5.0 dependiendo del brillo máximo de la fuente de luz. </p><br><p>  Encontramos este radio para cada fuente de luz en el escenario y lo usamos para tener en cuenta solo aquellas fuentes de luz dentro de las cuales se encuentra dentro del alcance de cada fragmento.  A continuación se muestra un paso de iluminación renovado que tiene en cuenta las áreas de acción de las fuentes de luz.  Tenga en cuenta que este enfoque se implementa solo con fines educativos y no es adecuado para un uso práctico (pronto discutiremos por qué). </p><br><pre> <code class="plaintext hljs">struct Light { [...] float Radius; }; void main() { [...] for(int i = 0; i &lt; NR_LIGHTS; ++i) { //         float distance = length(lights[i].Position - FragPos); if(distance &lt; lights[i].Radius) { //     [...] } } }</code> </pre> <br><p>  El resultado es exactamente el mismo que antes, pero ahora para cada fuente de luz, su efecto se tiene en cuenta solo dentro del área de su acción. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El código final es una demostración.</a>  . </p><br><h3 id="realnoe-primenenie-oblasti-deystviya-istochnika-sveta">  La aplicación real del alcance de la fuente de luz. </h3><br><p>  El sombreador de fragmentos que se muestra arriba no funcionará en la práctica y solo sirve para ilustrar cómo podemos deshacernos de los cálculos de iluminación innecesarios.  En realidad, la tarjeta de video y el lenguaje de sombreado GLSL optimizan muy mal los bucles y las ramas.  La razón de esto es que la ejecución del sombreador en la tarjeta de video se realiza en paralelo para diferentes píxeles, y muchas arquitecturas imponen la limitación de que en la ejecución en paralelo diferentes hilos deben calcular el mismo sombreador.  A menudo, esto lleva al hecho de que el sombreador en ejecución siempre calcula todas las ramas para que todos los sombreadores funcionen al mismo tiempo.  <em>(Note lane. Esto no afecta el resultado de los cálculos, pero puede reducir el rendimiento del sombreador).</em> Debido a esto, puede resultar que nuestra verificación de radio sea inútil: ¡calcularemos la iluminación para todas las fuentes! </p><br><p>  Un enfoque adecuado para usar el alcance de la luz es representar esferas con un radio como el de una fuente de luz.  El centro de la esfera coincide con la posición de la fuente de luz, de modo que la esfera contiene dentro de sí misma el rango de acción de la fuente de luz.  Aquí hay un pequeño truco: utilizamos básicamente el mismo sombreador de fragmentos diferidos para dibujar una esfera.  Al dibujar una esfera, el sombreador de fragmentos se llama específicamente para aquellos píxeles que se ven afectados por la fuente de luz, renderizamos solo los píxeles necesarios y omitimos todos los demás.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ilustración en la imagen a continuación: </font></font></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/873/902/ae4/873902ae47fa7d5ae40d3db3cbc4943a.png" alt="img8"></p><br><p>       ,      .     ,   ,             .       <em>_*__</em>  <br> <em>_ + __</em> ,             . </p><br><p>       :       (    ) ,   ,       , -      (    ).         stenil . </p><br><p>          ,     ,    ,     .     (  )      :  c <em>(deferred lighting)</em>     <em>(tile-based deferred shading)</em> .                   MSAA.             . </p><br><h3 id="otlozhennyy-rendering-vs-pryamoy">   vs  </h3><br><p>   (  )  -    ,           ,                .   ,     —   ,   MSAA,       . </p><br><p>               (  ),     (  g-  ..)        .         ,        . </p><br><p>     :   ,      ,        ,      . ,         ,      ,              .      .     parallax mapping,               ,    .       ,       . </p><br><h3 id="dopolnitelnye-ssylki">  Enlaces de sitio </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tutorial 35: Deferred Shading — Part 1</a> —   OGLDev      .           . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Deferred Rendering for Current and Future Rendering Pipelines</a> : c  Andrew Lauritzen     <em>(tile-based deferred shading)</em>   c <em>(deferred lighting)</em> . </li></ul><br><p> <strong>PS</strong>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">-</a>   .       ,   ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es420565/">https://habr.com/ru/post/es420565/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es420553/index.html">Jeff Bezos y su actitud hacia la filantropía, la caridad y los proyectos a escala global</a></li>
<li><a href="../es420555/index.html">Alan Kay: "Las computadoras son instrumentos cuya música son ideas"</a></li>
<li><a href="../es420559/index.html">Cómo IaaS ingresa a la venta minorista y la producción: quién y por qué cambió a infraestructura virtual</a></li>
<li><a href="../es420561/index.html">Reconstrucción de imagen: 1 km de fibra, red neuronal artificial y aprendizaje profundo</a></li>
<li><a href="../es420563/index.html">Análisis del informe de Dmitry Stolyarov sobre el monitoreo de Kubernetes</a></li>
<li><a href="../es420567/index.html">Cuando las pruebas a través del método público comienzan a apestar (ejemplo)</a></li>
<li><a href="../es420571/index.html">Auriculares inteligentes: tendencias 2018: filtrado ambiental, entrenador de audio, gestos con la cabeza y conexión directa con Alexa</a></li>
<li><a href="../es420573/index.html">Android Academy: ahora en Moscú</a></li>
<li><a href="../es420575/index.html">Qué leer sobre el sonido en películas, videos y juegos</a></li>
<li><a href="../es420577/index.html">El resumen de materiales interesantes para el desarrollador móvil # 266 (del 13 al 19 de agosto)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>