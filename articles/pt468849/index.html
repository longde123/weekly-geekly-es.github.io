<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¥üèΩ üï¶ üê¥ Engenharia reversa do processador desconhecido em um √∫nico programa üë©üèº‚Äçüåæ üñ•Ô∏è üö∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR: desenvolvemos engenharia reversa de um programa criado para uma arquitetura de CPU completamente desconhecida, sem nenhuma documenta√ß√£o na CPU...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Engenharia reversa do processador desconhecido em um √∫nico programa</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468849/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/mf/1z/aq/mf1zaqnw0lte41iurmzthf-qjbk.png"></div><br>  TL; DR: desenvolvemos engenharia reversa de um programa criado para uma arquitetura de CPU completamente desconhecida, sem nenhuma documenta√ß√£o na CPU (sem um emulador, sem ISA, sem tudo) em apenas dez horas.  A partir do artigo, voc√™ aprender√° como fizemos isso ... <br><br>  No final de semana passado, a equipe da CMU PPP e eu participamos da equipe CTF 2019 do Dragon Sector Teaser para relaxar e nos afastar do prazo final do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CHI 2020</a> .  O Dragon Sector √© uma equipe polonesa respeitada, com uma hist√≥ria de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CTFs</a> interessantes, ent√£o eu queria saber o que eles t√™m em estoque. <br><br>  Tendo resolvido o ‚Äúummmfpu‚Äù, uma tarefa que inclu√≠a a engenharia reversa de bytecode para o coprocessador de ponto flutuante Micromega uM-FPU, decidi participar de uma competi√ß√£o para resolver o problema de CPU Adventure, que na √©poca n√£o era resolvido por nenhuma das equipes (como resultado fomos os √∫nicos que conclu√≠ram a tarefa). <br><br>  Aqui est√° uma descri√ß√£o da tarefa CPU Adventure: <br><br><blockquote> Meu av√¥ nos anos 60 estava envolvido no desenvolvimento de computadores.  Colocando as coisas em ordem no s√≥t√£o, encontrei um carro estranho.  Ao lado da m√°quina havia uma pilha de cart√µes perfurados marcados com "Dragon Adventure Game".  Depois de algum tempo, consegui conect√°-lo a equipamentos modernos, mas o jogo √© muito complicado e n√£o consigo chegar ao fim sem trapacear.  Voc√™ pode me ajudar?  Estou anexando uma transcri√ß√£o de cart√µes perfurados usados ‚Äã‚Äãna m√°quina.  Alega-se que a m√°quina possui 4 registros de uso geral, 1 kibibyte de mem√≥ria de dados e 32 kibibyte de mem√≥ria de comando.  Para jogar, conecte-se ao servidor da seguinte maneira: <code>socat tcp4-connect:cpuadventure.hackable.software:1234 fd:0,rawer</code> Dica: o processador da m√°quina √© √∫nico, n√£o tente pesquisar informa√ß√µes nele. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">game.bin</a> </blockquote><a name="habracut"></a><br>  Ap√≥s conectar-se ao servidor, recebemos as seguintes informa√ß√µes: <br><br><blockquote> <code>THERE IS A TAVERN HERE. INSIDE THE TAVERN, YOU SEE VALIS. <br> <br> SELECT AN OPTION: <br> <br> - GO (N)ORTH <br> - GO (E)AST <br> - (T)ALK TO VALIS <br> - (D)RINK <br> - SHOW (I)NVENTORY <br> <br> YOUR CHOICE:</code> </blockquote> <br>  √ìtimo.  Este √© um jogo de aventura da velha escola.  Depois de jogar um pouco, percebemos que voc√™ pode lutar contra inimigos e obter uma bandeira desse personagem Valis, se quisermos: <br><br><blockquote> <code>YOUR CHOICE: T <br> <br> YOU ENTER THE TAVERN AND APPROACH VALIS. <br> <br> - HEY, I WAS WONDERING IF YOU COULD HELP ME FIND THE FLAG? <br> - THE FLAG? MAYBE, BUT FIRST, I NEED A REDBULL. <br> - I... I DON'T HAVE A REDBULL. <br> - WELL THEN, MAKE YOURSELF USEFUL AND FIND ONE. <br> <br> THERE IS A TAVERN HERE. INSIDE THE TAVERN, YOU SEE VALIS. <br> <br> SELECT AN OPTION: <br> <br> - GO (N)ORTH <br> - GO (E)AST <br> - (T)ALK TO VALIS <br> - (D)RINK <br> - SHOW (I)NVENTORY <br> <br> YOUR CHOICE:</code> </blockquote> <br><h3>  Primeiros passos </h3><br>  N√£o joguei o jogo por muito tempo, percebendo que provavelmente √© mais importante fazer a engenharia reversa do arquivo <code>game.bin</code> .  Abri-o em um editor hexadecimal, esperando ver valores bin√°rios.  Imagine minha surpresa quando vi isso: <br><br><pre>  110011111101000000111100110010001110000011001101000000000000110010011101010000001101001111100001111111001100111000000011 ... </pre><br><br>  Este <em>√© literalmente um</em> arquivo bin√°rio - um arquivo de texto que n√£o cont√©m nada al√©m dos caracteres ASCII 1 e 0. Sabemos que esse provavelmente √© o c√≥digo de m√°quina do processador, mas al√©m de ter 4 registros, 1 kbyte de mem√≥ria de dados e 32 kibibyte de mem√≥ria de instru√ß√µes, <em>nada se</em> sabe sobre ele.  Portanto, nossa primeira tarefa s√©ria ser√° determinar o tamanho da unidade desse arquivo bin√°rio (por exemplo, possui uma dimens√£o de 8 bits? Ou, talvez, uma dimens√£o de 12 ou 18 bits, como em algumas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquiteturas antigas</a> ?) <br><br>  Para descobrir o tamanho de um arquivo desconhecido, usei um truque antigo - redimensionei a caixa de texto at√© que o comprimento da quebra de linha correspondesse ao alinhamento.  Esse m√©todo √© √≥timo para coisas como v√°rios textos criptografados em XOR, formatos de arquivo desconhecidos (n√£o compactados) e c√≥digo de uma CPU desconhecida: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b0/264/13d/7b026413d2a0beb1ad79904ab78ffb15.gif"></div><br>  <i>Alterar o tamanho da caixa de texto</i> <br><br>  Nessa verifica√ß√£o r√°pida, descobri que o tamanho da unidade desse arquivo deve ser um divisor de 20 (a largura da janela alinhada).  Para descobrir o tamanho exato, escrevi rapidamente um script procurando longas linhas de repeti√ß√£o (supondo que qualquer c√≥digo tenha seq√º√™ncias repetidas estereotipadas).  A linha de repeti√ß√£o mais longa foi o seguinte bloco de 425 bits, encontrado em 43625 e 44510: <br><br><pre>  10000011111110000001010100011111110100000101100010111000001001000101000100001000100001010001011000101000000001111111111100010000011110010100100001010100111100000110000010100000101000101000011110001111001101111001010100001010000111110100001010000110010011011110011111000000111011101000000001100000110000111101011010111011000100100010100000111000100011100011000000000101010101100010111000001010000001101010010000000011000001100 </pre><br>  Como a dist√¢ncia entre as repeti√ß√µes √© 885, chegamos √† conclus√£o de que a dimens√£o deve ser de 5 bits, ou seja,  uma CPU desconhecida deve ter bytes de 5 bits.  Progresso! <br><br>  Pesquisamos codifica√ß√µes de cart√µes perfurados de 5 bits e rapidamente instalamos a codifica√ß√£o antiga <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">com o c√≥digo Baudot</a> .  E, de fato - quando usamos o decodificador on-line para decodificar alguns fragmentos, obtivemos texto leg√≠vel! <br><br><blockquote>  ‚á©DRAGON‚á©HERE‚áß; ‚á©SHE‚á©APPEARS‚á©TO‚á©BE‚á©GUARDING‚á© ALGUM‚á©KIND‚á©OF‚á©A‚á©BOTTLE‚áß; &amp;. &amp;. <br><br>  <i>C√≥digo LSB Baudot aprimorado de 425 bits</i> </blockquote><br>  Em seguida, tentamos decodificar o arquivo inteiro usando o c√≥digo Bodo, mas nos primeiros 20 mil bits conseguimos lixo, ap√≥s o qual havia um texto perfeitamente leg√≠vel.  Isso deixou claro para n√≥s que a primeira parte do arquivo pertence √† se√ß√£o "c√≥digo", seguida pela se√ß√£o "dados", que cont√©m linhas constantes.  Assumimos que a m√°quina provavelmente usa o c√≥digo Bodo para E / S e, portanto, armazena linhas constantes na codifica√ß√£o Bodo na mem√≥ria.  Para tornar o segmento de c√≥digo mais leg√≠vel, decidi codific√°-lo usando a codifica√ß√£o base-32, semelhante √† codifica√ß√£o hexadecimal, mas expandindo-o com o alfabeto 0-9a-v.  Aqui est√° como o arquivo game.bin se parece com a primeira parte codificada pela base-32 e a segunda parte decodificada pelo Bodo (o arquivo completo √© postado aqui: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">game.b32</a> ): <br><br><blockquote> <code>pv83pi70pk00p7a0qfgvpjg3f0kf13f28p5f3pv10pk40pn60f0sf1sf24p5f3r9c11qad0f0sf1df26p5f39c21qad0f05f1ff26p5f39c41qad0f08f1df26p5f39c81qad0f0hf1ef26p5f3r1c00qaq15c20qcl0f01f1of27p5f3p3g3psf35c10qal0f02f1nf27p5f3p3g3psf3rf0hf1nf27p5f3f05f16f27p5f3rf84f95101311fl0f510f84907qa40b518447qa40b514f84f95k9m0k9m0k9m0907qa40b511447qa40b512ruougf10f20g0i9g0i910931b320u2u1u0ro9f0o9f0ojh0o9f0o9f0o9f0olj0o9f0o9f0o9f0o9f0o9f0o9f0o9f0o9k1onp0o9f0o9f0o9f0o9f0onf0ot82odi0o9f0o9f0o9f0o9f0o9f0o9f0o9f0olg0o9f0f0gf1df24p5f3r9c11qa835548755 <br> [...] <br> 93e9n59ka8fo87r85g8ui8ml8ed87b9h89u291u82333333333456789abcdb01234567892)%c3BOTTLE OF SOPLICA PIGWOWAENEMY HEALTH: <br> <br> YOU ATTACK <br> <br> YOU APPROACH REDFORD. <br> <br> <br> <br> YOU ENTER THE TAVERN AND APPROACH VALIS. <br> [...]</code> </blockquote> <br>  Para simplificar, chamarei as unidades de cinco bits de "bytes" abaixo.  Entre os membros da equipe, criamos outros nomes para eles - eu os chamei de croquetes e Zak - hacks. <br><br><h3>  Engenharia reversa da arquitetura do processador desconhecido </h3><br>  Agora, chegamos √† parte dif√≠cil - a engenharia reversa de 4000 bytes de c√≥digo que roda em uma arquitetura de CPU exclusiva e completamente desconhecida.  A partir do c√≥digo, √© √≥bvio o suficiente para que este seja um conjunto de instru√ß√µes de <em>comprimento vari√°vel</em> , porque √© imposs√≠vel encontrar nele um padr√£o de repeti√ß√£o est√°vel e percept√≠vel.  Passei algumas horas nisso, mais tarde meu membro da equipe, Zachary Wade (@ zwad3) come√ßou a me ajudar.  Primeiro, comecei a procurar por partes duplicadas do c√≥digo, sugerindo que elas usariam frequentemente um pequeno n√∫mero de instru√ß√µes.  Comecei a dividir o c√≥digo em sequ√™ncias repetidas mais curtas, mais convenientes para an√°lise.  Eu gostaria de dizer que foi um processo rigoroso, mas, de fato, o seguinte algoritmo vago foi usado principalmente: <br><br><ul><li>  Examinamos o c√≥digo e verificamos se algo se repete com muita frequ√™ncia. </li><li>  Execute o procedimento de pesquisa e substitui√ß√£o para inserir uma nova linha ao lado desta repeti√ß√£o </li><li>  Explore as semelhan√ßas / diferen√ßas entre as linhas de divis√£o resultantes. </li><li>  Repita esse processo por cerca de uma hora ... </li></ul><br>  Por exemplo, um dos padr√µes que descobri foi "0f0.f", onde "."  indica um caractere desconhecido.  Eu quebrei a corda nesse padr√£o e obtive o seguinte: <br><br><blockquote> <code>pv83pi70pk00p7a0qfgvpjg3f0kf13f28p5f3pv10pk40pn60f0sf <br> 1sf24p5f3r9c11qad0f0sf <br> 1df26p5f39c21qad0f05f <br> 1ff26p5f39c41qad0f08f <br> 1df26p5f39c81qad0f0hf <br> 1ef26p5f3r1c00qaq15c20qcl0f01f <br> 1of27p5f3p3g3psf35c10qal0f02f</code> </blockquote> <br>  Muito √∫til!  A partir da segunda e terceira linhas, vemos que existem "... p5f3r9c ..." e "... p5f39c ...", e isso sugere que "r" √© um c√≥digo de opera√ß√£o de byte √∫nico, ou seja, "... 5f3" √© o fim de um c√≥digo de opera√ß√£o e " 9c .. ‚Äù√© o come√ßo de outro.  Nas duas √∫ltimas linhas, vemos "p5f3r1c ..." e isso significa que "1c .." √© outro c√≥digo de opera√ß√£o e "p3 ..." tamb√©m √© outro c√≥digo de opera√ß√£o. <br><br>  Continuei dividindo as instru√ß√µes repetidamente de maneira semelhante, usando as semelhan√ßas e diferen√ßas de blocos semelhantes para encontrar instru√ß√µes prov√°veis.  No final, consegui algo parecido com isto: <br><br><blockquote> <code>pv83 <br> pi70 <br> pk00 <br> p7a0 <br> qfgv <br> pjg3 <br> f0k <br> f13 <br> f28 <br> p5f3 <br> pv10 <br> pk40 <br> pn60 <br> f0s <br> f1s <br> f24 <br> p5f3 <br> r <br> 9c11 <br> qad0 <br> f0s <br> f1d <br> f26 <br> p5f3 <br> 9c21 <br> qad0 <br> f05 <br> f1f</code> </blockquote> <br>  Eu assumi que "p" e "q" eram instru√ß√µes com tr√™s bytes de operandos, "f0", "f1" e "f2" eram instru√ß√µes com um operando e "9c" era uma instru√ß√£o com dois operandos.  No entanto, eu n√£o sabia o que cada uma dessas instru√ß√µes √©. <br><br>  Ent√£o, virei para o diret√≥rio de todas as instru√ß√µes ‚Äúp‚Äù que destaquei e descobri que, no momento, as instru√ß√µes mais frequentes com ‚Äúp‚Äù eram ‚Äúp5f3‚Äù.  Al√©m disso, olhando para os locais onde ocorre, descobri que √© sempre precedido pelas instru√ß√µes ‚Äúf0‚Äù, ‚Äúf1‚Äù e ‚Äúf2‚Äù.  Observando todos os operandos ‚Äúf0‚Äù, ‚Äúf1‚Äù e ‚Äúf2‚Äù, notei que os operandos f2 est√£o sempre no intervalo 4-8.  Lembrando que a CPU possui 32 kb de mem√≥ria de programa para endere√ßamento que requer 15 bits, presumi que "f0", "f1" e "f2" carregavam algum endere√ßo com f2 como o byte alto.  Quando conectei alguns desses endere√ßos, descobri que todos eles apontam exatamente para o in√≠cio das linhas constantes na se√ß√£o de dados.  Eu encontrei a fun√ß√£o de <code>print</code> !  Imediatamente se seguiu que ‚Äúp5f3‚Äù √© realmente algum tipo de instru√ß√£o para imprimir uma linha ou chamada;  se voc√™ levar em conta o operando de tr√™s bytes, provavelmente √© uma "chamada".  Mais uma vez, observando as instru√ß√µes ‚Äúp‚Äù, percebi que os tr√™s bytes do operando indicam o endere√ßo em <em>ordem direta (little-endian)</em> , ou seja, o √∫ltimo byte do operando √© o byte mais alto do endere√ßo. <br><br>  Foi um grande avan√ßo!  Identificamos nossa primeira instru√ß√£o.  Tendo visto que ‚Äúf0‚Äù e ‚Äúf1‚Äù s√£o usados ‚Äã‚Äãem outros lugares, presumi que eles carregassem n√£o os endere√ßos, mas um dos quatro registros (por exemplo, f0 carrega o registro 0) com constantes de 5 bits com endere√ßamento direto.  Isso √© l√≥gico para p5f3 - ele carrega tr√™s argumentos de registro para a fun√ß√£o 3f5 (‚Äúprint_string‚Äù). <br><br>  Comecei a escrever um desmontador que reconhece o idioma "print" (f0x, f1x, f2x, p5f3), colocando a substitui√ß√£o da linha impressa no c√≥digo desmontado.  Devido ao grande n√∫mero de linhas no programa, o c√≥digo desmontado rapidamente se tornou muito leg√≠vel e ficou mais f√°cil descobrir a localiza√ß√£o dos blocos de fun√ß√µes (o c√≥digo desmontado completo est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ): <br><br><blockquote> <code>0: call 38v <br> 4: call 7i <br> 8: call k <br> c: call a7 <br> g: q vgf <br> <br> k: call 3gj <br> o: print 83k # 'SELECT AN OPTION\x0e:\r\n\r\n\x0f\x00' <br> 15: call 1v <br> 19: call 4k <br> 1d: call 6n <br> 1h: print 4ss # '\r\nYOUR CHOICE\x0e: \x0f\x00' <br> 1u: ret <br> <br> 1v: unk 9 <br> 20: unk c <br> 21: unk 1 <br> 22: unk 1 <br> 23: q 0da <br> 27: print 6ds # '\x0e- \x0fGO \x0e(\x0fS\x0e)\x0fOUTH\r\n\x00' <br> 2k: unk 9 <br> 2l: unk c <br> 2m: unk 2 <br> 2n: unk 1 <br> 2o: q 0da <br> 2s: print 6f5 # '\x0e- \x0fGO \x0e(\x0fN\x0e)\x0fORTH\r\n\x00' <br> 39: unk 9 <br> 3a: unk c <br> 3b: unk 4 <br> 3c: unk 1 <br> 3d: q 0da <br> 3h: print 6d8 # '\x0e- \x0fGO \x0e(\x0fE\x0e)\x0fAST\r\n\x00' <br> 3u: unk 9 <br> 3v: unk c <br> 40: unk 8 <br> 41: unk 1 <br> 42: q 0da <br> 46: print 6eh # '\x0e- \x0fGO \x0e(\x0fW\x0e)\x0fEST\r\n\x00' <br> 4j: ret</code> </blockquote> <br>  A partir deste pequeno peda√ßo de c√≥digo, consegui descobrir v√°rios aspectos: a instru√ß√£o "q0" deve indicar alguma ramifica√ß√£o condicional (porque √© usada para ignorar a impress√£o de dire√ß√µes desnecess√°rias na fun√ß√£o 1v) e as instru√ß√µes "9c11", "9c21", "9c41", " 9c81 ‚Äùdeve indicar algum tipo de instru√ß√£o AND - eles verificam os bits definidos para ver se essas instru√ß√µes s√£o permitidas (isso √© claramente sugerido pelo uso de‚Äú 1 ‚Äù,‚Äú 2 ‚Äù,‚Äú 4 ‚Äùe‚Äú 8 ‚Äùnestas instru√ß√µes). <br><br>  Nas duas horas seguintes, Zachary Wade (@ zwad3) e eu resolvemos as v√°rias instru√ß√µes, fazendo e refinando nossas suposi√ß√µes sobre o que estavam fazendo.  Ter muitas instru√ß√µes de impress√£o leg√≠veis tornou nosso trabalho muito mais f√°cil.  Decidimos que cada um de n√≥s escreveria seu pr√≥prio desmontador para que pud√©ssemos examinar as instru√ß√µes em nosso pr√≥prio ritmo e compartilhar nossas descobertas. <br><br><h3>  Engenharia reversa de c√≥digo </h3><br>  Depois de algumas horas, comecei a fazer grandes progressos na desmontagem.  Ap√≥s examinar o c√≥digo que funcionava com o invent√°rio do usu√°rio (mais especificamente, a fun√ß√£o "drink" e cada manipulador associado a ele), encontramos instru√ß√µes para salvar e carregar da mem√≥ria (n√£o esque√ßa que a CPU possui 1 kibibyte de mem√≥ria de dados).  Em seguida, descobrimos que algumas instru√ß√µes aritm√©ticas / l√≥gicas (ALU) usam operandos de mem√≥ria (por exemplo, ‚Äú9c41‚Äù significa ‚Äúexecute AND com valor no endere√ßo de dados 1 com valor 4‚Äù).  A partir disso, fomos capazes de recriar as vari√°veis ‚Äã‚Äãna mem√≥ria de dados, por exemplo, em [0] o identificador NPC √© armazenado no local atual e em [6,7] a sa√∫de atual do jogador √© armazenada (os 5 bits inferiores em [6], os 5 bits mais antigos em [7 ]).  Nesse est√°gio, mudei de instru√ß√µes de engenharia reversa para anotar meu c√≥digo desmontado e fazer engenharia reversa no pr√≥prio programa.  Abaixo est√° minha nota√ß√£o engra√ßada para valores de 5 bits: <br><br><blockquote> <code>_start: <br> call init <br> <br> L4: <br> call check_moves <br> call print_menu <br> call handle_command <br> br 4 <br> <br> print_menu: <br> call print_itemname <br> print 83k # 'SELECT AN OPTION\x0e:\r\n\r\n\x0f\x00' <br> call print_moves <br> call print_npcmenu <br> call print_itemmenu <br> print 4ss # '\r\nYOUR CHOICE\x0e: \x0f\x00' <br> ret <br> <br> print_moves: <br> and 0y1, [1] <br> brz 2k <br> print 6ds # '\x0e- \x0fGO \x0e(\x0fS\x0e)\x0fOUTH\r\n\x00' <br> 2k: and 0y2, [1] <br> brz 39 <br> print 6f5 # '\x0e- \x0fGO \x0e(\x0fN\x0e)\x0fORTH\r\n\x00' <br> 39: and 0y4, [1] <br> brz 3u <br> print 6d8 # '\x0e- \x0fGO \x0e(\x0fE\x0e)\x0fAST\r\n\x00' <br> 3u: and 0y8, [1] <br> brz 4j <br> print 6eh # '\x0e- \x0fGO \x0e(\x0fW\x0e)\x0fEST\r\n\x00' <br> 4j: ret <br> <br> print_npcmenu: <br> add 0y0, [0] <br> brz 6m <br> sub 0y2, [0] <br> br&lt;c&gt; 5p <br> print 7o1 # '\x0e- (\x0fT\x0e)\x0fALK TO \x00' <br> call print_npcname <br> call print_crlf <br> 5p: sub 0y1, [0] <br> brz 6m <br> print 7n2 # '\x0e- (\x0fF\x0e)\x0fIGHT \x00' <br> call print_npcname <br> call print_crlf <br> 6m: ret <br> <br> print_itemmenu: <br> print 7nh # '\x0e- (\x0fD\x0e)\x0fRINK\r\n\x00' <br> print 765 # '\x0e- \x0fSHOW \x0e(\x0fI\x0e)\x0fNVENTORY\r\n\x00' <br> ret</code> </blockquote> <br>  Ainda temos muitos c√≥digos de opera√ß√£o desconhecidos, por exemplo, embora tenhamos descoberto que "qa" √© uma ramifica√ß√£o condicional no zero (ramifica√ß√£o no zero, brz), n√£o conseguimos entender o que √© "qc" (indicado acima como br &lt;c&gt;).  Mas isso foi suficiente para come√ßar a entender a l√≥gica do programa. <br><br>  De fato, o jogo permite que o jogador se mova em torno de um mapa 8 √ó 8 no qual NPCs (drag√µes, touros vermelhos e humanos) s√£o colocados aleatoriamente.  Voc√™ pode lutar com qualquer NPC (mesmo Valis, apesar da falta de um item de menu correspondente).  Durante a batalha, voc√™ pode atacar o inimigo, causando uma quantidade aleat√≥ria de dano ou falha, ap√≥s o que o inimigo ataca o jogador, causando tamb√©m uma quantidade aleat√≥ria de dano ou falha.  Voc√™ tamb√©m pode escolher um bloqueio de escudo, gra√ßas ao qual o inimigo erra ou atinge o escudo sem causar danos.  Finalmente, voc√™ pode trapacear aumentando sua sa√∫de para 1000, mas, neste caso, a vari√°vel oculta ("trapaceado", endere√ßo 10) √© definida como 1. Se o jogador matar o inimigo com sucesso, um objeto cair√° dele, geralmente uma garrafa de √°lcool (obviamente, este jogo n√£o √© para crian√ßas). <br><br>  O NPC principal Valis, do qual o jogador deve receber a bandeira, tem uma m√°quina de estado na qual ele pede ao jogador v√°rios itens - um monte de bebidas Red Bull (obviamente obtidas ao derrotar inimigos Red Bull), v√°rias bebidas mistas (por exemplo, gim e t√¥nica) Para obt√™-los, voc√™ precisa derrotar o drag√£o azul e o drag√£o cinza e, em seguida, misturar os objetos que ca√≠ram deles) e a r√©gua de energia, que pode ser obtida se voc√™ derrotar outra pessoa do NPC no jogo (Redford) ou ajud√°-lo.  Se voc√™ atender a toda essa longa s√©rie de solicita√ß√µes, ele lhe dar√° a bandeira, mas <em>somente</em> se a vari√°vel "trapaceado" n√£o for igual a 1. Ou seja, nossa tarefa √© vencer o jogo sem trapacear.  Como come√ßamos com apenas 100 HP, como todos os inimigos, na passagem usual, ser√° imposs√≠vel derrotar todos os inimigos (para obter todas as coisas necess√°rias para derrotar cerca de 20 oponentes).  √â necess√°rio modificar o RNG de alguma forma, para que o inimigo sempre erre. <br><br>  Os n√∫meros aleat√≥rios s√£o gerados por uma fun√ß√£o que √© semelhante a algum tipo de PRNG (endere√ßo 37a), mas usa instru√ß√µes exclusivas que n√£o s√£o usadas em nenhum outro lugar, portanto, n√£o podemos fazer engenharia reversa.  No entanto, notamos que ele carrega seu vetor de estado de tr√™s endere√ßos na mem√≥ria ([11], [12] e [13]), ou seja, seu estado completo leva apenas 15 bits.  Isso significa que o RNG deve ter um per√≠odo curto - n√£o mais que 2 ^ 15 = 32768 de comprimento. <br><br>  Enquanto n√≥s (sem sucesso) tentamos reverter a implementa√ß√£o da RNG, Jay Bosamia (@ jay_f0xtr0t) e Matthew Savage (@thebluepichu) implementaram uma explora√ß√£o.  Simplesmente enviando o comando "shield" 100.000 vezes seguidas, conseguimos uma sequ√™ncia de "acertos" e "erros" inimigos correspondentes √† sa√≠da de bits do RNG.  Garantimos que essa sequ√™ncia se repita com um per√≠odo de 32767. Gra√ßas a isso, conseguimos montar nossa principal fa√ßanha - em uma luta com o primeiro inimigo que encontramos, fechamos nossos escudos 40 vezes para recriar a sequ√™ncia de acertos e faltas, procuramos por essa sequ√™ncia em uma grande sequ√™ncia peri√≥dica e descobrimos quando proteger e quando atacar para que o inimigo sempre erre.  Depois, percorremos todo o mapa no modo assassinato, matando todos e recolhendo seus itens.  No final, retornamos a Valis e pedimos educadamente nossa bandeira, que recebemos: <br><br><blockquote> <code>DrgnS{m4kin9-v4lis-happy-w1th-n4t1ve-b4ud0t-cpu}</code> </blockquote> <br>  Fuh!  De fato, uma verdadeira aventura.  Ainda n√£o acredito que viemos de uma sequ√™ncia bin√°ria e de uma completa falta de documenta√ß√£o do processador para dois desmontadores quase completos e um c√≥digo desmontado em menos de 10 horas!  Todo o c√≥digo est√° dispon√≠vel no GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">meu desmontador</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desmontador de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zachary</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">meu c√≥digo desmontado bruto</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">meu c√≥digo desmontado anotado</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cliente Exploit de Matt</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt468849/">https://habr.com/ru/post/pt468849/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt468837/index.html">Como conduzir uma entrevista t√©cnica: um plano de a√ß√£o para iniciantes</a></li>
<li><a href="../pt468841/index.html">Entrega cont√≠nua para sua biblioteca Multiplataforma Kotlin</a></li>
<li><a href="../pt468843/index.html">Voc√™ tem medo de implementar um sistema de CRM? Sua empresa pode estar doente</a></li>
<li><a href="../pt468845/index.html">Um curso de fisiologia da cidade, ou partes do corpo</a></li>
<li><a href="../pt468847/index.html">Compras p√∫blicas em outros pa√≠ses: por que as leis precisam de estruturas</a></li>
<li><a href="../pt468851/index.html">Implementa√ß√£o de anima√ß√£o no React Native</a></li>
<li><a href="../pt468853/index.html">A hist√≥ria de uma aplica√ß√£o bem-sucedida do SPR em um projeto Legacy</a></li>
<li><a href="../pt468859/index.html">‚ÄúRoteador para bombeamento‚Äù: ajuste do equipamento TP-Link para provedores de Internet</a></li>
<li><a href="../pt468861/index.html">Positive Technologies d√° vida √† 'cidade hacker' no ciberbeat de standoff na HITB + CyberWeek</a></li>
<li><a href="../pt468863/index.html">Internals Go: agrupar vari√°veis ‚Äã‚Äãde loop no fechamento</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>