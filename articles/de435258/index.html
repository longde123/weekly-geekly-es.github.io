<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôèüèª üîá üßõüèø Wir schreiben unsere Programmiersprache, Teil 2: Zwischendarstellung von Programmen üôÖüèº üëµüèæ üöè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einf√ºhrung 
 Gr√º√üe an alle, die vorbeigekommen sind, um meinen n√§chsten Artikel zu lesen. 

 Ich wiederhole, ich beschreibe die Erstellung einer Progr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir schreiben unsere Programmiersprache, Teil 2: Zwischendarstellung von Programmen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435258/"><img src="https://habrastorage.org/getpro/habr/post_images/a7b/73c/8de/a7b73c8de7e52b3cd9fa2869bae47119.png" alt="Bild"><br><br><h3>  Einf√ºhrung </h3><br>  Gr√º√üe an alle, die vorbeigekommen sind, um meinen n√§chsten Artikel zu lesen. <br><br>  Ich wiederhole, ich beschreibe die Erstellung einer Programmiersprachensprache basierend auf fr√ºheren Arbeiten, deren Ergebnisse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in diesem Beitrag beschrieben werden</a> . <br><br>  Im ersten Teil (Link: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/post/435202</a> ) habe ich die Phasen des Entwerfens und Schreibens einer Sprach-VM beschrieben, die unsere zuk√ºnftigen Anwendungen in unserer zuk√ºnftigen Sprache ausf√ºhren wird. <br>  In diesem Artikel m√∂chte ich die Hauptschritte beim Erstellen einer Zwischenprogrammiersprache beschreiben, die zu einem abstrakten Bytecode f√ºr die direkte Ausf√ºhrung auf unserer VM zusammengesetzt wird. <br><br>  Ich denke, dass es nicht schaden wird, sofort Links zur Projektwebsite und ihrem Repository bereitzustellen. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Website</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> <br><a name="habracut"></a><br>  Ich muss sofort sagen, dass der gesamte Code in FPC geschrieben ist und ich werde Beispiele daf√ºr geben. <br><br>  Also beginnen wir unsere Erleuchtung. <br><br><h3>  Warum haben wir die Zwischensprache aufgegeben? </h3><br>  Es lohnt sich zu verstehen, dass die Konvertierung eines Programms von einer Hochsprache direkt in einen ausf√ºhrbaren Bytecode, der aus einem begrenzten Satz von Anweisungen besteht, so trivial ist, dass es besser ist, es um eine Gr√∂√üenordnung zu vereinfachen, indem dem Projekt eine Zwischensprache hinzugef√ºgt wird.  Es ist viel besser, den Code schrittweise zu vereinfachen, als mathematische Ausdr√ºcke, Strukturen und Klassen sofort mit einer Reihe von Opcodes darzustellen.  Dies ist √ºbrigens die Art und Weise, wie die meisten √úbersetzer und Compiler von Drittanbietern arbeiten. <br><br>  In meinem vorherigen Artikel habe ich dar√ºber geschrieben, wie eine Sprach-VM implementiert wird.  Jetzt m√ºssen wir eine Assembler-√§hnliche Sprache und Funktionen zum weiteren Schreiben des √úbersetzers implementieren.  In diesen Phasen legen wir den Grundstein f√ºr das zuk√ºnftige Projekt.  Es lohnt sich zu verstehen, dass das Geb√§ude umso steiler ist, je besser das Fundament ist. <br><br><h3>  Wir machen den ersten Schritt, um dieses Wunder zu verwirklichen </h3><br>  Zun√§chst lohnt es sich, ein Ziel zu setzen.  Was werden wir eigentlich schreiben?  Welche Eigenschaften sollte der endg√ºltige Code haben und was sollte er tun? <br><br>  Ich kann eine Liste der Hauptfunktionsteile erstellen, aus denen dieser Teil des Projekts bestehen sollte: <br><br><ul><li>  Einfacher Assembler.  Konvertiert einfache Anweisungen in eine Reihe von Opcodes f√ºr VMs. </li><li>  Die grundlegende Implementierung der Funktion zum Implementieren von Variablen. </li><li>  Die grundlegende Implementierung der Funktion zum Arbeiten mit Konstanten. </li><li>  Funktionalit√§t zur Unterst√ºtzung von Einstiegspunkten in Methoden und zur Berechnung ihrer Adressen in der √úbersetzungsphase. </li><li>  Vielleicht noch ein paar funktionelle Br√∂tchen. </li></ul><br>  Die obige Abbildung zeigt ein Codefragment in einer Zwischensprache, das von einem primitiven √úbersetzer in Code f√ºr eine VM konvertiert wird. Dies wird erl√§utert. <br><br>  Nachdem die Ziele festgelegt wurden, fahren wir mit der Implementierung fort. <br><br><h3>  Einen einfachen Assembler schreiben </h3><br>  Wir fragen uns, was ist Assembler? <br><br>  Tats√§chlich ist dies ein Programm, das die Ersetzung von Opcodes anstelle ihrer Textbeschreibungen durchf√ºhrt. <br><br>  Betrachten Sie diesen Code: <br><br><pre><code class="bash hljs">push 0 push 1 add peek 2 pop</code> </pre> <br>  Nach der Verarbeitung des Assembler-Codes erhalten wir den ausf√ºhrbaren Code f√ºr die VM. <br><br>  Wir sehen, dass die Anweisungen einsilbig und bisilbig sein k√∂nnen.  Keine komplizierten Anweisungen mehr f√ºr die gestapelte VM. <br><br>  Wir ben√∂tigen einen Code, der Token aus einer Zeichenfolge extrahieren kann (wir ber√ºcksichtigen, dass sich m√∂glicherweise Zeichenfolgen unter ihnen befinden). <br><br>  Wir schreiben es: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; w: word)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (length(s) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (w &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'"'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Delete(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); Result := copy(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">'"'</span></span>, s) - <span class="hljs-number"><span class="hljs-number">1</span></span>); Delete(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">'"'</span></span>, s)); s := trim(s); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Pos(<span class="hljs-string"><span class="hljs-string">' '</span></span>, s) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := copy(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">' '</span></span>, s) - <span class="hljs-number"><span class="hljs-number">1</span></span>); Delete(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">' '</span></span>, s)); s := trim(s); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := s; s := <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; Dec(w); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Ok, jetzt m√ºssen wir f√ºr jede Anweisung so etwas wie ein Switch-Case-Konstrukt implementieren, und unser einfacher Assembler ist bereit. <br><br><h3>  Variablen </h3><br>  Denken Sie daran, dass unsere VM √ºber ein Array von Zeigern verf√ºgt, die Variablen und dementsprechend statische Adressierung unterst√ºtzen.  Dies bedeutet, dass die Funktion zum Arbeiten mit Variablen als TStringList dargestellt werden kann, in der Zeichenfolgen die Namen von Variablen und ihre Indizes ihre statischen Adressen sind.  Es versteht sich, dass das Duplizieren von Variablennamen in dieser Liste nicht akzeptabel ist.  Ich denke, Sie k√∂nnen sich den notwendigen Code vorstellen und / oder ihn sogar selbst schreiben. <br><br>  Wenn Sie sich die fertige Implementierung ansehen m√∂chten, sind Sie herzlich willkommen: /lang/u_variables.pas <br><br><h3>  Konstanten </h3><br>  Das Prinzip ist hier dasselbe wie bei Variablen, aber es gibt eine Sache.  Zur Optimierung ist es besser, nicht an die Namen von Konstanten, sondern an deren Werte zu binden.  Das hei√üt,  Jeder konstante Wert kann eine TStringList haben, in der die Namen von Konstanten mit diesem Wert gespeichert werden. <br>  F√ºr Konstanten sollten Sie den Datentyp angeben. Um sie der Sprache hinzuzuf√ºgen, m√ºssen Sie einen kleinen Parser schreiben. <br><br>  Implementierung: /lang/u_consts.pas <br><br><h3>  Methodeneintrittspunkte </h3><br>  Um Codeblockierung, Unterst√ºtzung f√ºr verschiedene Designs usw. zu implementieren.  Die Unterst√ºtzung f√ºr diese Funktionalit√§t sollte auf Assembler-Ebene implementiert werden. <br><br>  Betrachten Sie ein Codebeispiel: <br><br><pre> <code class="bash hljs">Summ: peek 0 pop peek 1 pop push 0 new peek 2 mov push 2 push 0 add jr</code> </pre> <br>  Das Obige ist eine Beispiel√ºbersetzung der Summ-Methode: <br><br><pre> <code class="ruby hljs">func Summ(a, b): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Es versteht sich, dass es keine Opcodes f√ºr Einstiegspunkte gibt.  Was ist ein Einstiegspunkt in die Summ-Methode?  Diese Primzahl ist der Versatz des n√§chsten Opcode-Einstiegspunkts.  (Der Offset des Opcodes ist die Nummer des Opcodes relativ zum Anfang des ausf√ºhrbaren abstrakten Bytecodes.)  Jetzt haben wir eine Aufgabe - wir m√ºssen diesen Offset in der Kompilierungsphase berechnen und optional die Summ-Konstante als diese Zahl deklarieren. <br><br>  Wir schreiben daf√ºr f√ºr jeden Bediener einen bestimmten Gewichtsz√§hler.  Wir haben einfache einsilbige Operatoren, zum Beispiel "Pop".  Sie belegen 1 Byte.  Es gibt komplexere, zum Beispiel "Push 123" - sie belegen 5 Bytes, 1 f√ºr den Opcode und 4 f√ºr den vorzeichenlosen Int-Typ. <br><br>  Das Wesentliche des Codes zum Hinzuf√ºgen von Unterst√ºtzung f√ºr Assembler f√ºr Einstiegspunkte: <br><br><ol><li>  Wir haben einen Z√§hler, sagen wir i = 0. </li><li>  Wir durchlaufen den Code, wenn wir eine Konstruktion vom Typ "Push 123" haben, f√ºgen wir 5 hinzu, wenn der einfache Opcode 1 ist. Wenn wir einen Einstiegspunkt haben, entfernen Sie ihn aus dem Code und deklarieren Sie die entsprechende Konstante mit dem Z√§hlerwert und dem Namen des Einstiegspunkts. </li></ol><br><h3>  Andere Funktionen </h3><br>  Dies ist beispielsweise eine einfache Codekonvertierung vor der Verarbeitung. <br><br><h3>  Zusammenfassung </h3><br>  Wir haben unseren kleinen Assembler implementiert.  Wir werden es brauchen, um einen komplexeren √úbersetzer basierend darauf zu implementieren.  Jetzt k√∂nnen wir kleine Programme f√ºr unsere VM schreiben.  Dementsprechend wird in weiteren Artikeln der Prozess des Schreibens eines komplexeren √úbersetzers beschrieben. <br><br>  Vielen Dank, dass Sie bis zum Ende gelesen haben. <br><br>  Wenn Ihnen etwas nicht klar ist, warte ich auf Ihre Kommentare. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de435258/">https://habr.com/ru/post/de435258/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de435248/index.html">Navigation in der Android-Anwendung</a></li>
<li><a href="../de435250/index.html">So funktioniert die ITMO University: ein Rundgang durch unser cyberphysikalisches Labor</a></li>
<li><a href="../de435252/index.html">Jessica Livingston: ‚ÄûWie wir Y Combinator erstellt haben. Die emotionale Komponente "</a></li>
<li><a href="../de435254/index.html">Funktionsfehlerbehandlung in Kotlin mit Arrow</a></li>
<li><a href="../de435256/index.html">Wir bewerten Personalvermittler anhand kalter Briefe</a></li>
<li><a href="../de435260/index.html">Implementierung eines Hot-Reloads von C ++ - Code unter Linux</a></li>
<li><a href="../de435262/index.html">Li-Fi: Die Zukunft des Internets</a></li>
<li><a href="../de435264/index.html">Preise in RMK bearbeiten. 1C: Handelsmanagement 11</a></li>
<li><a href="../de435268/index.html">Behandle mich nicht, Doktor</a></li>
<li><a href="../de435270/index.html">Bewahren Sie SSH-Schl√ºssel sicher auf</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>