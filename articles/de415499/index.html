<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè≠ üë©üèΩ‚Äçüéì üëú Wie man aufh√∂rt, Angst vor Proguard zu haben und anf√§ngt zu leben üìò üë©üèΩ‚Äçüé§ ü§πüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo, ich bin ein Android-Entwickler und habe keine Angst mehr vor ProGuard ... 


 Normalerweise wird an dieses Dienstprogramm erinnert, wenn ein Da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie man aufh√∂rt, Angst vor Proguard zu haben und anf√§ngt zu leben</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415499/"><p><img src="https://habrastorage.org/webt/ws/uk/rs/wsukrsowhkx1zzbqyocrumhhsmi.png"></p><br><p>  Hallo, ich bin ein Android-Entwickler und habe keine Angst mehr vor ProGuard ... </p><br><p> Normalerweise wird an dieses Dienstprogramm erinnert, wenn ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dalvik-Dex-Limit-Problem auftritt</a> oder die Anwendungssicherheit verbessert werden muss.  Leider ist es noch lange nicht das erste Mal, Proguard richtig zu konfigurieren.  Ich habe oft beobachtet, wie viele nach dem Brechen eines Projekts Proguard deaktiviert und den Mulditex-Support aktiviert haben, und jedes Mal war ich ein wenig traurig dar√ºber, weil Proguard sowohl die Gr√∂√üe der Anwendung reduziert als auch deren Leistung erh√∂ht. </p><br><p>  Am Ende habe ich beschlossen, einen Artikel zu schreiben, in dem ich alle n√ºtzlichen Informationen zusammenfassen kann, die ich √ºber mehrere Jahre in der Arbeit mit Proguard gelernt habe und die sowohl Anf√§ngern als auch denen helfen k√∂nnen, die bereits etwas wissen. </p><a name="habracut"></a><br><h2 id="o-chem-eto">  Worum geht es? </h2><br><p>  Proguard ist ein Open-Source-Dienstprogramm zur Optimierung und Verschleierung von Java-Code.  Dieses Tool verarbeitet bereits kompilierten Java-Code und sollte daher mit jeder JVM-Sprache funktionieren.  Genauer gesagt ist die Sprache selbst f√ºr Proguard gleichg√ºltig, nur der Bytecode ist wichtig.  Alle Proguard-Bytecode-Manipulationen k√∂nnen in drei Hauptkategorien unterteilt werden: <strong>Code-Verkleinerung</strong> , <strong>Optimierung</strong> und <strong>Verschleierung</strong> . </p><br><h3 id="code-shrinking">  Code schrumpft </h3><br><p>  Ja, es ist ein ziemlich seltsames Unterfangen, Code zu schreiben und dann zu l√∂schen, aber dies ist die Realit√§t der Android-Entwicklung.  Hier geht es nat√ºrlich nicht um den von Hand geschriebenen Code (obwohl dies passiert), sondern um Tonnen toter Fracht, die von Bibliotheken aller Art gebracht werden.  <strong>Guava</strong> , <strong>Apache Commons</strong> , <strong>Google Play Services</strong> und andere Leute k√∂nnen die Gr√∂√üe der Apk-Datei von 500 KB auf einige zehn Megabyte erh√∂hen.  Manchmal geht es so weit, dass ein Programm nicht kompiliert werden kann, weil das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dalvik-Methodenlimit √ºberschritten wird</a> .  Proguard hilft dabei, nicht verwendeten Code zu entfernen und die Gr√∂√üe der Anwendung auf einige Megabyte zu reduzieren. </p><br><h3 id="optimisation">  Optimierung </h3><br><p>  Proguard kann nicht nur unn√∂tigen Code entfernen, sondern auch den verbleibenden Code optimieren.  Das Arsenal umfasst Kontrollflussanalyse, Datenflussanalyse, Teilbewertung, statische Einzelzuweisung, Nummerierung globaler Werte und Lebendigkeitsanalyse.  Proguard kann Gucklochoptimierungen durchf√ºhren, die Anzahl der Zuweisungen von Variablen reduzieren, Schwanzrekursionen vereinfachen und vieles mehr ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wiki</a> ).  Zus√§tzlich zu solchen allgemeinen Vorg√§ngen verf√ºgt Proguard √ºber Optimierungen, die speziell f√ºr die Android-Plattform n√ºtzlich sind, z. B. das Ersetzen von Enum-Klassen durch Ints und das L√∂schen von Protokollierungsanweisungen. </p><br><h3 id="obfuscation">  Verschleierung </h3><br><p>  Schlie√ülich kann Proguard Ihren gesamten Code in ein unlesbares Chaos verwandeln, indem alle Klassen, Methoden und Felder in zuf√§llige (eigentlich nicht ganz zuf√§llige) Buchstaben umbenannt werden.  Dies ist eine sehr n√ºtzliche Option, da jeder Ihre APK-Datei dekompilieren kann und nicht jeder die Geduld hat, verschleierten Code zu verstehen. </p><br><h2 id="princip-raboty">  Arbeitsprinzip </h2><br><p>  Proguard arbeitet in 3 Schritten in der oben beschriebenen Reihenfolge: <strong>Code verkleinern</strong> ‚Üí <strong>Optimierung</strong> ‚Üí <strong>Verschleierung</strong> .  Jeder der Schritte ist optional. </p><br><p>  <em>Der Optimierungsschritt beim Android SDK ist standardm√§√üig deaktiviert.</em> </p><br><p>  Damit Proguard funktioniert, m√ºssen Sie drei Komponenten bereitstellen: </p><br><ul><li> Ihr kompilierter Code ist ein Archiv mit den <code>class</code> Ihres Programms und allen von Ihnen verwendeten Bibliotheken (jar, aar, apk, war, zip usw.).  Proguard √§ndert nur bereits kompilierten Code und hat nichts mit der Quelle zu tun. </li><li>  Konfigurationsdatei (en) - Datei (en) mit allen Regeln, Optionen und Einstellungen, mit denen Sie die Verarbeitung starten m√∂chten. </li><li>  Bibliotheksgl√§ser (aar, apks, ...) - Klassen der Plattform, auf der Ihr Programm ausgef√ºhrt wird.  Im Fall von Android ist dies <code>android.jar</code> .  Diese Archive werden nur f√ºr die korrekte Analyse Ihres Codes ben√∂tigt, sie werden nicht ge√§ndert (dies macht keinen Sinn, da <code>android.jar</code> "am Telefon" ist, haben wir keinen Zugriff darauf). </li></ul><br><p><img src="https://habrastorage.org/webt/sf/vb/b8/sfvbb8uuvqdacgnjvzmeka3zpa4.png" alt="Bild aus der Pr√§sentation von Jeb Ware, Link am Ende des Artikels"><br>  (Bild aus der Pr√§sentation von Jeb Ware, Link am Ende des Artikels) </p><br><p>  Mit Hilfe von Bibliotheksklassen und Ihren Konfigurationsdateien definiert Proguard alle Einstiegspunkte f√ºr Ihr Programm ( <strong>Seeds</strong> ).  Mit anderen Worten, es definiert diejenigen Klassen und Methoden, die von au√üen aufgerufen werden k√∂nnen und die nicht ber√ºhrt werden k√∂nnen.  Dann wird aus entdeckt <strong>Samen beginnen,</strong> Proguard rekursiv den gesamten Code durch das Kontrollk√§stchen Markierung alles ‚Äûgenutzt‚Äú , was erreichen konnte.  Alle anderen Codes werden gel√∂scht.  Sie m√ºssen mindestens einen Einstiegspunkt in der Konfiguration angeben.  F√ºr ein Standard-Java-Programm ist dies die Hauptfunktion.  Android hat keinen einzigen Einstiegspunkt in das Programm, sondern Standardkomponenten (Aktivit√§t, Service usw.), die vom System erstellt und aufgerufen werden.  Gl√ºcklicherweise m√ºssen wir hier nichts selbst angeben, das Android SDK erstellt die erforderliche Konfiguration f√ºr uns. </p><br><h3 id="soputstvuyuschie-fayly">  Begleitdateien </h3><br><p>  Nachdem alle Einstiegspunkte erkannt wurden, schreibt Proguard sie in die Datei <code>seeds.txt</code> . </p><br><p>  Der gesamte Code, den Proguard f√ºr unn√∂tig befunden hat, wird in die Datei <code>usage.txt</code> .  Dies ist ein ziemlich seltsamer Name f√ºr eine Datei, die Remote-Code enth√§lt. Es w√§re korrekter, sie ungew√∂hnlichage.txt zu nennen, aber wir haben das, was wir haben. Denken Sie daran. </p><br><p>  Im Verschleierungsschritt wird eine <code>mapping.txt</code> Datei erstellt, die die Paare &lt;urspr√ºnglicher Klassenname | Methode | Feld&gt; -&gt; &lt;verschleierter Klassenname | Methode | Feld&gt; enth√§lt.  Diese Datei ist n√ºtzlich, wenn Sie ein Programm deobfuscieren m√ºssen, z. B. Stacktrace lesen.  Das <code>proguardui</code> Dateien ist nicht erforderlich. Das Android SDK verf√ºgt <code>proguardui</code> Hilfsprogramme f√ºr <code>proguardui</code> und <code>proguardui</code> .  Wenn Sie Fabric Crashlytics verwenden, kann das Gradle-Plugin diese Datei unabh√§ngig voneinander finden und in die Konsole laden, sodass Sie sich dar√ºber keine Gedanken machen m√ºssen. </p><br><p>  Bei Android befinden sich diese Dateien normalerweise in <code>app/build/output/mapping/&lt;product-flavor-name&gt;/</code> . </p><br><p>  Proguard erstellt auch eine <code>dump.txt</code> Datei, die alles enth√§lt, was Proguard in das endg√ºltige Archiv gestellt hat.  Er hat sich f√ºr mich nie als n√ºtzlich erwiesen, aber vielleicht ist es f√ºr jemanden n√ºtzlich. </p><br><h3 id="kak-dela-obstoyat-v-android">  Wie l√§uft es auf Android? </h3><br><p>  Das Android Gradle Plugin kann Proguard selbst ausf√ºhren.  Sie m√ºssen lediglich diese Option aktivieren und die Konfigurationsdateien angeben. </p><br><pre> <code class="hljs cs">buildTypes { &lt;...&gt; release { minifyEnabled <span class="hljs-literal"><span class="hljs-literal">true</span></span> proguardFiles <span class="hljs-string"><span class="hljs-string">'proguard-rules.pro'</span></span>, getDefaultProguardFile(<span class="hljs-string"><span class="hljs-string">'proguard-android.txt'</span></span>) } }</code> </pre> <br><p>  <code>minifyEnabled true</code> - Aktiviert Proguard zur Erstellungszeit </p><br><p>  <code>proguardFiles</code> - eine Liste von Konfigurationsdateien.  Regeln aus allen Konfigurationsdateien werden der allgemeinen Liste in der Reihenfolge hinzugef√ºgt, in der sie angezeigt werden. </p><br><p>  <code>proguard-rules.pro</code> - das ist unsere Konfigurationsdatei mit spezifischen projektspezifischen Regeln </p><br><p>  <code>getDefaultProguardFile('proguard-android.txt')</code> - eine Funktion, die die Standardkonfigurationsdatei f√ºr Android-Anwendungen zur√ºckgibt.  Es liegt in <code>AndroidSDK/tools/proguard</code> </p><br><p>  Tats√§chlich verf√ºgt das Android SDK √ºber zwei <code>proguard-android.txt</code> : <code>proguard-android.txt</code> und <code>proguard-android-optimize.txt</code> .  Der erste hat die Option <code>-dontoptimize</code> , mit der alle Optimierungen <code>-dontoptimize</code> .  Wenn Sie die Optimierung aktivieren m√∂chten, verwenden Sie die zweite Konfiguration. </p><br><p>  Zus√§tzlich zu diesen Standardkonfigurationen generiert das Android SDK (aapt) automatisch eine Reihe von Regeln f√ºr Ressourcen: aapt √ºberpr√ºft alle XML-Dateien (einschlie√ülich des Manifests), um alle Aktivit√§ten, Dienste, Ansichten usw. zu finden.  und generieren Sie die notwendigen Regeln f√ºr sie.  Die generierten Regeln finden Sie in <code>app/build/intermediates/proguard-rules/&lt;flavor&gt;/aapt_rules.txt</code> .  Sie m√ºssen es nicht selbst angeben, das Android Gradle Plugin f√ºgt diese Regeln automatisch hinzu. </p><br><p><img src="https://habrastorage.org/webt/1r/w4/t6/1rw4t6egtvymigl79hnxc3n8t9a.png" alt="Bild aus der Pr√§sentation von Jeb Ware, Link am Ende des Artikels"><br>  (Bild aus der Pr√§sentation von Jeb Ware, Link am Ende des Artikels) </p><br><h2 id="konfigi">  Konfigurationen </h2><br><p>  Das Einrichten von Proguard ist der grundlegendste Teil der Arbeit damit und gleichzeitig der schwierigste.  Eine falsche Konfiguration kann die Kompilierung der Anwendung und der Anwendung selbst zur Laufzeit leicht unterbrechen.  Alle verf√ºgbaren Konfigurationsoptionen sind ausf√ºhrlich dokumentiert.  Website. </p><br><p>  Unter allen Optionen m√∂chte ich die drei wichtigsten Gruppen herausgreifen: </p><br><ul><li>  Regeln einhalten - Alle m√∂glichen Einstiegspunkte in das Programm.  Regeln, die Proguard mitteilen, welche Klassen oder Teile von Klassen unver√§ndert bleiben sollen oder welche der √Ñnderungen f√ºr bestimmte Klassen g√ºltig sind. </li><li>  Optimierungsoptimierung - Geben Sie an, welche Optimierungen akzeptabel sind und wie viele Optimierungszyklen durchgef√ºhrt werden m√ºssen. </li><li>  Arbeiten Sie mit Warnungen, Fehlern und Debugging </li></ul><br><h3 id="keep-rules">  Regeln einhalten </h3><br><p>  Dies ist eine Reihe von Optionen, die Ihren Code vor dem r√ºcksichtslosen Proguard sch√ºtzen sollen.  In ihrer allgemeinsten Form sieht diese Regel folgenderma√üen aus: </p><br><pre> <code class="hljs powershell"><span class="hljs-literal"><span class="hljs-literal">-keep</span></span> [,<span class="hljs-type"><span class="hljs-type">modifier</span></span>,<span class="hljs-type"><span class="hljs-type">...</span></span>] class_specification</code> </pre> <br><p>  <code>keep</code> ist die h√§ufigste dieser Optionen (es gibt andere) und weist Proguard an, die Klasse selbst und alle ihre Klassenmitglieder zu speichern: Felder und Methoden. </p><br><p>  <code>class_specification</code> - eine Vorlage, die auf die Klasse (n) oder ihre Teile (Klassenmitglieder) verweist.  Die allgemeine Ansicht der Vorlage ist sehr gro√ü und kann deaktiviert <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werden.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> .  Sie k√∂nnen ihn kontaktieren, aber im Allgemeinen k√∂nnen Sie sich nur daran erinnern, dass wir die M√∂glichkeit haben, eine Vorlage f√ºr diese Komponenten zu erstellen: </p><br><ul><li>  W√§hlen Sie alle Klassen mit einem bestimmten Namen und Paket aus </li><li>  W√§hlen Sie alle Klassen aus, die bestimmte Klassen / Schnittstellen erben / implementieren </li><li>  W√§hlen Sie alle Klassen mit bestimmten Modifikatoren und / oder bestimmten Anmerkungen aus </li><li>  W√§hlen Sie alle Methoden mit einem bestimmten Namen, Modifikatoren, Argumenten und R√ºckgabewert aus </li><li>  W√§hlen Sie alle Felder mit einem bestimmten Namen, Modifikatoren eines bestimmten Typs aus. </li><li><p>  Es ist m√∂glich, Platzhalter zu verwenden </p><br><p>  Auch dies ist keine strenge Beschreibung der Vorlage, sondern eine Liste der Funktionen, die wir haben.  Hier einige Beispiele: </p><br></li></ul><br><p> <code>-keep public class com.example.MyActivity</code> <br>  halten die Klasse <code>com.example.MyActivity</code> </p><br><p> <code>-keep public class * extends android.app.Activity</code> <br>  Speichern Sie alle √∂ffentlichen Klassen, die <code>android.app.Activity</code> erben </p><br><pre> <code class="hljs scala">-keep public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">android</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>); public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>, android.util.<span class="hljs-type"><span class="hljs-type">AttributeSet</span></span>); public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>, android.util.<span class="hljs-type"><span class="hljs-type">AttributeSet</span></span>, int); public void set*(...); }</code> </pre> <br><p>  Finden Sie alle √∂ffentlichen Klassen, die <code>android.view.View</code> erben, und speichern Sie darin 3 Konstruktoren mit bestimmten Parametern + alle √∂ffentlichen Methoden, mit dem Modifikator <code>void</code> , allen Argumenten und einem Namen, der mit <code>set</code> beginnt.  Alle anderen Teile der Klasse k√∂nnen ge√§ndert werden. </p><br><p> <code>-keep class com.habr.** { *; }</code> <br>  Speichern Sie alle Klassen und ihren gesamten Inhalt im Paket <code>com.habr</code> </p><br><p>  <code>modifiers</code> - Erg√§nzung zur Keep-Regel: </p><br><ul><li>  <code>includedescriptorclasses</code> - Zus√§tzlich zu der angegebenen Klasse / Methode / dem angegebenen Feld m√ºssen Sie alle Klassen speichern, die in ihren Deskriptoren vorkommen. </li><li>  <code>includecode</code> - Der Inhalt der Methode, auf die diese spezielle Regel <code>includecode</code> kann ebenfalls nicht ber√ºhrt werden. </li><li>  <code>allowshrinking</code> - Klassen, auf die in dieser Regel verwiesen wird, sind keine <code>allowshrinking</code> und k√∂nnen gel√∂scht werden, sondern nur, wenn sie nicht im Programm selbst verwendet werden.  Wenn dieser Code jedoch nach dem Schrumpfen des Codes erhalten bleibt (aufgrund der Tatsache, dass jemand ihn verwendet), ist es unm√∂glich, diesen Code zu optimieren / zu verschleiern. </li><li>  <code>allowoptimization</code> - Klassen, auf die sich diese Regel bezieht, k√∂nnen nur optimiert, aber nicht entfernt oder verschleiert werden. </li><li>  <code>allowobfuscation</code> - Klassen, auf die in dieser Regel verwiesen wird, k√∂nnen nur verschleiert, aber nicht entfernt oder optimiert werden. </li></ul><br><p>  Neben <code>keep</code> gibt es ein paar Optionen: </p><br><p>  <code>-keepclassmembers</code> - <code>-keepclassmembers</code> an, dass Klassenmitglieder gespeichert werden sollen, wenn die Klasse selbst nach dem Verkleinern des Codes erhalten bleibt. </p><br><p>  <code>-keepclasseswithmembers</code> - gibt an, dass Sie Klassen speichern m√∂chten, deren Inhalt unter die angegebene Vorlage f√§llt.  Beispiel: <code>-keepclasseswithmembers class * { public &lt;init&gt;(android.content.Context); }</code>  <code>-keepclasseswithmembers class * { public &lt;init&gt;(android.content.Context); }</code> - speichert alle Klassen, die einen √∂ffentlichen Konstruktor haben, mit einem Argument vom Typ <code>Context</code> . </p><br><p>  <code>-keepnames</code> - <code>-keepnames</code> f√ºr <code>-keep,allowshrinking</code> . </p><br><p>  <code>-keepclassmembernames</code> - Abk√ºrzung f√ºr <code>-keepclassmembers,allowshrinking</code> . </p><br><p>  <code>keepclasseswithmembernames</code> - <code>keepclasseswithmembernames</code> f√ºr <code>-keepclasseswithmembers,allowshrinking</code> . </p><br><h3 id="optimisation-tuning">  Optimierungstuning </h3><br><p>  Die wichtigste Option ist hier das Flag <code>-dontoptimize</code> .  Wenn es vorhanden ist, wird keine Optimierung durchgef√ºhrt und alle anderen Optimierungsoptionen werden ignoriert. </p><br><p>  Es gibt viele Optimierungsoptionen, aber die folgenden sind f√ºr mich am n√ºtzlichsten: </p><br><p>  <code>-optimizations optimization_filter</code> - listet alle M√∂glichkeiten auf, die Sie verwenden m√∂chten.  Es ist besser, die in <code>proguard-android-optimize.txt</code> angegebene Menge oder eine Teilmenge davon zu verwenden.  Eine Liste aller Optimierungen finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><p>  <code>-optimizationpasses n</code> - Anzahl der Optimierungszyklen.  Mehrere Zyklen k√∂nnen das Ergebnis verbessern.  Gleichzeitig ist Proguard intelligent genug, um Zyklen zu stoppen, wenn sich herausstellt, dass sich das Ergebnis seit dem letzten Mal nicht verbessert hat. </p><br><p>  <code>-assumenosideeffects class_specification</code> - gibt an, dass diese Methode keine Nebenwirkungen hat und nur einen bestimmten Wert zur√ºckgibt.  Proguard l√∂scht Aufrufe dieser Methode, wenn festgestellt wird, dass das zur√ºckgegebene Ergebnis nicht verwendet wird.  M√∂glicherweise wird diese Option am h√§ufigsten verwendet, um alle Debug-Protokolle zu l√∂schen: <code>-assumenosideeffects class android.util.Log { public static int d(...); }</code> <code>-assumenosideeffects class android.util.Log { public static int d(...); }</code> </p><br><p>  <code>-allowaccessmodification</code> - zeige alles, was versteckt ist :) Eine gro√üartige Option, mit der du eine Reihe k√ºnstlicher Zugriffsmethoden f√ºr verschachtelte Klassen loswerden kannst.  Funktioniert nur in Verbindung mit <code>-repackageclasses</code> </p><br><p>  <code>-repackageclasses</code> - <code>-repackageclasses</code> Verschieben aller Klassen in ein angegebenes Paket.  Dies gilt eher f√ºr die Verschleierung, f√ºhrt aber gleichzeitig zu guten Ergebnissen bei der Optimierung. </p><br><h3 id="prochie-poleznye-opcii">  Andere n√ºtzliche Optionen </h3><br><p>  <code>-dontwarn</code> und <code>-dontnote</code> </p><br><p>  Proguard ist sehr intelligent und meldet w√§hrend der Codeanalyse immer verd√§chtige Stellen. Manchmal sind dies Notizen, manchmal Warnungen.  Wenn Ihr Build nicht mit aktiviertem Proguard ausgef√ºhrt wird, lesen Sie unbedingt alle von ihm erstellten Protokolle. Es schreibt, was schief gelaufen ist, und zeigt Ihnen h√∂chstwahrscheinlich sogar, wie Sie das Problem beheben k√∂nnen.  Nachdem Sie alle Nachrichten gelesen haben, beheben Sie entweder das Problem oder ignorieren die Nachricht einer dieser Optionen, wenn Sie sicher sind, dass kein Problem vorliegt. </p><br><p>  Es kommt beispielsweise vor, dass einige Java-Bibliotheken Plattformklassen verwenden, die sich nicht in android.jar befinden, und Proguard warnt davor.  Wenn Sie sicher sind, dass diese Bibliothek in einer Android-Umgebung <code>-dontwarn java.lang.management.**</code> funktioniert, k√∂nnen Sie diese Warnung <code>-dontwarn java.lang.management.**</code> warnen <code>-dontwarn java.lang.management.**</code> </p><br><p>  <code>-whyareyoukeeping class_specification</code> ist eine n√ºtzliche Option, die den Grund druckt, warum Proguard beschlossen hat, diese Klasse / Methode nicht zu ber√ºhren. </p><br><p>  <code>-verbose</code> - <code>-verbose</code> detailliertere Protokolle und Ausnahmen </p><br><p>  <code>-printconfiguration</code> - druckt eine vollst√§ndige Liste der Optionen aus allen verwendeten Konfigurationsdateien, einschlie√ülich Regeln aus Bibliotheken, die √ºber aapt generiert wurden. </p><br><p>  <code>-keepattributes SourceFile, LineNumberTable</code> - speichert Metainformationen (Dateinamen, Zeilennummerierung), um Code in der IDE zu debuggen und eine aussagekr√§ftige Stapelverfolgung zu erhalten.  Stellen Sie sicher, dass Sie diese Option hinzuf√ºgen. </p><br><h3 id="praktika">  √úbe </h3><br><p>  Dies geschieht normalerweise: Schalten Sie Proguard ein und Sie brechen das gesamte Projekt ab, was zu einer Menge Fehlern f√ºhrt.  Viele schalten in diesem Schritt Proguard aus und versuchen, nicht dorthin zur√ºckzukehren.  Ich werde versuchen, einige Tipps zu geben, um diesen √úbergangsprozess zu vereinfachen. </p><br><h4 id="opredelitsya-s-nachalnymi-vhodnymi-tochkami">  Entscheiden Sie sich f√ºr die Startpunkte </h4><br><p>  Wenn Sie ein Android-Entwickler sind, ist alles √§u√üerst elementar - w√§hlen Sie einfach eine der beiden Standardkonfigurationen aus dem Android SDK aus: <code>proguard-android.txt</code> oder <code>proguard-android-optimize.txt</code> . Sie k√ºmmern sich um alles, was unber√ºhrt bleiben sollte. </p><br><h4 id="proverit-vse-biblioteki">  √úberpr√ºfen Sie alle Bibliotheken </h4><br><p>  In letzter Zeit werden immer mehr Bibliotheken mit vorgefertigten Proguard-Konfigurationen verteilt.  Proguard kann in das Archiv schauen, die Bibliothekskonfiguration finden und sie anderen Optionen hinzuf√ºgen.  √úberpr√ºfen Sie jede Bibliothek, die Sie f√ºr eine solche Konfiguration verwenden. </p><br><p><img src="https://habrastorage.org/webt/rf/dq/vn/rfdqvnztj-zagmqtzwctc73x3-k.png" alt="(Inhalt einer AAR-Datei einer der Bibliotheken)"><br>  (Inhalt einer AAR-Datei einer der Bibliotheken) </p><br><p>  Wenn Sie Google Play Services verwenden, w√§hlt das Plugin <code>com.google.gms.google-services</code> die <code>com.google.gms.google-services</code> Konfiguration selbst aus. </p><br><p>  Wenn die Autoren der Bibliothek die Konfiguration nicht in das Archiv packen, haben sie sich m√∂glicherweise darum gek√ºmmert und die Regeln auf ihre Website, Repository-Seite oder in die README-Datei geschrieben.  Versuchen Sie, die Konfiguration f√ºr die von Ihnen verwendete Version der Bibliothek selbst zu finden. </p><br><p>  Wenn Sie nirgendwo vorgefertigte Regeln finden, m√ºssen Sie die Protokolle lesen und das Problem einzeln l√∂sen.  H√∂chstwahrscheinlich m√ºssen Sie Keep-Regeln f√ºr den fehlerhaften Bibliothekscode hinzuf√ºgen.  Oder ignorieren Sie Fehler, wenn sie das Programm nicht beeintr√§chtigen. </p><br><h4 id="provesti-inspekciyu-svoego-koda">  √úberpr√ºfen Sie Ihren Code </h4><br><p>  Sie wissen besser, welchen Code Sie unter dem Messer senden k√∂nnen, sollten sich jedoch alle Stellen genau ansehen, an denen die Reflexion ohnehin verwendet wird: </p><br><ul><li>  Class.forName (...) (die Dokumentation verspricht, dass Proguard in der Lage ist, solchen Code zu definieren, es gab jedoch F√§lle, die es wert sind, √ºberpr√ºft zu werden) </li><li>  Modelle / Entit√§tsklassen, die bei der Serialisierung und Zuordnung verwendet werden.  Alle Klassen, deren Feldnamen (manchmal die Klassen selbst) wichtig sind (Gson, RealmIO usw.) </li><li>  native Bibliotheksaufrufe √ºber JNI </li></ul><br><h4 id="testy">  Tests </h4><br><p>  Wenn eine Klasse / Methode nur in Tests und nirgendwo anders verwendet wird, l√∂scht Proguard diesen Code.  Dies ist eine h√§ufige Situation, wenn Sie TDD haben :) In diesem Fall habe ich eine separate Konfiguration, in der ich Klassen hinzuf√ºge, die noch nicht in das Projekt integriert sind, nirgendwo verwendet werden, aber getestet werden m√ºssen. </p><br><p>  Im Android Gradle Plugin gibt es zus√§tzlich zu den Anweisungen f√ºr <code>proguardFiles</code> noch <code>testProguardFiles</code> .  Diese Anweisung wird ben√∂tigt, um die Konfigurationen anzugeben, die auf die Testanwendung angewendet werden, die generiert wird, um Ihre Anwendung zu testen, wenn Sie Instrumentierungstests ausf√ºhren.  Normalerweise wird dies verwendet, um die gleiche Optimierung / Verschleierung in beiden apk-Dateien zu erreichen, so dass keine Desynchronisation zwischen ihnen besteht.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> </p><br><h4 id="apk-analyzer">  APK Analyzer </h4><br><p>  Android Studio hat so ein tolles Tool.  Sie k√∂nnen es entweder √ºber Aktion suchen -&gt; APK analysieren oder durch √ñffnen der APK-Datei selbst in Android Studio √∂ffnen.  Analyzer zeigt viele n√ºtzliche Informationen, aber jetzt interessieren wir uns f√ºr den Code.  Um zu sehen, was schlie√ülich in eine APK-Datei <code>classes.dex</code> , m√ºssen Sie die Datei <code>classes.dex</code> ausw√§hlen </p><br><p><img src="https://habrastorage.org/webt/go/zz/o_/gozzo_o83s3e1mknkxhqldrzr3g.png"></p><br><p>  Standardm√§√üig wird genau der resultierende Code angezeigt, der die Schritte zum Verkleinern und Optimieren bestanden hat.  Sie k√∂nnen jedoch auf die <strong>Schaltfl√§che Load Proguard-Zuordnungen ...</strong> klicken, <code>seeds.txt</code> und <code>usage.txt</code> hinzuf√ºgen, um den gel√∂schten Code <code>usage.txt</code> . </p><br><p><img src="https://habrastorage.org/webt/gy/4a/gk/gy4agkxifirpyy95-exhk1xmguc.png"></p><br><p>  Wenn Proguard aus irgendeinem Grund den ben√∂tigten Code ge√§ndert hat, suchen Sie ihn in Analyzer und w√§hlen <strong>Sie Proguard Keep Rule</strong> √ºber RMB <strong>generieren</strong> .  Analyzer generiert eine Auswahl verschiedener Optionen f√ºr die Regeln, von der allgemeinsten bis zur spezifischsten. <strong>W√§hlen Sie eine</strong> davon aus. </p><br><p><img src="https://habrastorage.org/webt/ny/zc/ob/nyzcobecp45cnrrjgq3unu3_zba.png"></p><br><p><img src="https://habrastorage.org/webt/yq/wg/0m/yqwg0mwllbw9wauhemkvffgk_h8.png"></p><br><h4 id="dlya-avtorov-bibliotek">  F√ºr Bibliotheksautoren </h4><br><p>  Wenn Sie eine Android-Bibliothek erstellen, k√∂nnen Sie eine Proguard-Konfiguration f√ºr Ihre Clients wie folgt hinzuf√ºgen: </p><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">buildTypes</span></span> { <span class="hljs-section"><span class="hljs-section">release</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">consumerProguardFiles</span></span> <span class="hljs-string"><span class="hljs-string">'proguard-rules.pro'</span></span> } }</code> </pre> <br><p>  Meiner Meinung nach ist es besser, Ihre Bibliothek nicht eifrig zu optimieren und zu verschleiern, sondern Ihren Kunden diese M√∂glichkeit zu bieten.  Ein guter Ton ist, der Konfiguration hinzuzuf√ºgen, was Kunden noch hinzuf√ºgen m√ºssen, wenn sie Proguard enthalten.  Wenn Sie dennoch Sicherheit hinzuf√ºgen m√∂chten, m√ºssen Sie nat√ºrlich die gesamte Pulic-API Ihrer Bibliothek vor Proguard sch√ºtzen, einschlie√ülich Deskriptoren und Signaturen. </p><br><h3 id="r8-dexguard-i-redex">  R8, DexGuard und Redex </h3><br><p>  R8 ist das neue Tool von Google, das den aktuellen Proguard ersetzt.  Warten Sie, versuchen Sie nicht, alles zu vergessen, was Sie gerade im Artikel gelesen haben. Behandeln Sie es einfach wie den neuen Proguard.  Google verspricht, die gesamte √∂ffentliche API beizubehalten, damit alle Konfigurationen wie zuvor funktionieren.  Das Projekt befindet sich noch in der Beta-Phase, aber Sie k√∂nnen es selbst ausprobieren. </p><br><p>  DexGuard ist ein kostenpflichtiges Dienstprogramm der Entwickler von Proguard.  Es kann zusammen oder anstelle von Proguard verwendet werden.  Es wird argumentiert, dass DexGuard alles kann, was Proguard kann, aber besser.  Leider hatte ich keine Gelegenheit, es zu versuchen. Wenn jemand Erfahrung hat, teilen Sie diese bitte mit. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Redex</a> ist ein weiterer Dex-Optimierer von Facebook.  Es wird berichtet, dass Sie damit die Produktivit√§t um bis zu 25% steigern und die Gr√∂√üe der Anwendung reduzieren k√∂nnen, indem Sie das Tool auf den bereits von Proguard verarbeiteten Code anwenden. </p><br><h2 id="vmesto-zaklyucheniya">  Anstelle einer Schlussfolgerung </h2><br><p>  Haben Sie keine Angst, Proguard zu verwenden, seien Sie nicht faul und verbringen Sie einige Zeit mit dem Einrichten.  Dies reduziert die Gr√∂√üe, erh√∂ht die Arbeitsgeschwindigkeit und erh√∂ht die Loyalit√§t Ihrer Benutzer.  Versuchen Sie gleichzeitig, effektive Proguard-Konfigurationen zu erstellen, schreiben Sie keine "Teppich" -Regeln, sonst kommt ein w√ºtender Jake Wharton zu Ihnen und schimpft mit Ihnen. </p><br><p><img src="https://habrastorage.org/webt/ma/tf/kz/matfkzxceoougdvn7pfyx4klnho.png"></p><br><h2 id="resursy">  Ressourcen </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Proguard-Website</a> .  Es gibt auch Informationen √ºber DexGuard. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verschiedene Beispielregeln</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R8</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufzeichnung einer Pr√§sentation der Funktionsweise von Proguard mit DroidCon</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Effektive ProGuard-Regeln f√ºr die Aufzeichnung von Pr√§sentationen kleinerer Anwendungen (Google I / O '18)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen zum Aktivieren und Konfigurieren von Proguard f√ºr Android</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wiki-Seite</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Redex</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de415499/">https://habr.com/ru/post/de415499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de415485/index.html">Fahren Sie Kingston A1000 - ein Krankenwagen f√ºr den Laptop?</a></li>
<li><a href="../de415487/index.html">Seiten der Intel-Geschichte. Erster Chip, Intel 3101</a></li>
<li><a href="../de415489/index.html">Facebook schlie√üt Projekt zur Verbreitung des Internets mittels Drohnen auf Solarenergie ab</a></li>
<li><a href="../de415493/index.html">Eine neue Berechnung nach der Drake-Formel ergab: Die Menschheit ist in ihrer Galaxie mit einer Wahrscheinlichkeit von 53‚Äì99,6% einsam</a></li>
<li><a href="../de415497/index.html">Sammlermotor + Digispark = $ 50 Elektrofahrrad</a></li>
<li><a href="../de415501/index.html">Die virtuelle Halle der Eremitage - Der erste Schritt in die Zukunft von Pelevin</a></li>
<li><a href="../de415503/index.html">NetScaler SD-WAN-Benutzeroberfl√§che</a></li>
<li><a href="../de415509/index.html">Tiefes Lernen in der Programmierung: was, warum und wie</a></li>
<li><a href="../de415529/index.html">Juli IT Events Digest</a></li>
<li><a href="../de415533/index.html">Das Buch "Programmieren f√ºr Kinder. Meine ersten Scratch-Programme ¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>