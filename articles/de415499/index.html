<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏭 👩🏽‍🎓 👜 Wie man aufhört, Angst vor Proguard zu haben und anfängt zu leben 📘 👩🏽‍🎤 🤹🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo, ich bin ein Android-Entwickler und habe keine Angst mehr vor ProGuard ... 


 Normalerweise wird an dieses Dienstprogramm erinnert, wenn ein Da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie man aufhört, Angst vor Proguard zu haben und anfängt zu leben</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415499/"><p><img src="https://habrastorage.org/webt/ws/uk/rs/wsukrsowhkx1zzbqyocrumhhsmi.png"></p><br><p>  Hallo, ich bin ein Android-Entwickler und habe keine Angst mehr vor ProGuard ... </p><br><p> Normalerweise wird an dieses Dienstprogramm erinnert, wenn ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dalvik-Dex-Limit-Problem auftritt</a> oder die Anwendungssicherheit verbessert werden muss.  Leider ist es noch lange nicht das erste Mal, Proguard richtig zu konfigurieren.  Ich habe oft beobachtet, wie viele nach dem Brechen eines Projekts Proguard deaktiviert und den Mulditex-Support aktiviert haben, und jedes Mal war ich ein wenig traurig darüber, weil Proguard sowohl die Größe der Anwendung reduziert als auch deren Leistung erhöht. </p><br><p>  Am Ende habe ich beschlossen, einen Artikel zu schreiben, in dem ich alle nützlichen Informationen zusammenfassen kann, die ich über mehrere Jahre in der Arbeit mit Proguard gelernt habe und die sowohl Anfängern als auch denen helfen können, die bereits etwas wissen. </p><a name="habracut"></a><br><h2 id="o-chem-eto">  Worum geht es? </h2><br><p>  Proguard ist ein Open-Source-Dienstprogramm zur Optimierung und Verschleierung von Java-Code.  Dieses Tool verarbeitet bereits kompilierten Java-Code und sollte daher mit jeder JVM-Sprache funktionieren.  Genauer gesagt ist die Sprache selbst für Proguard gleichgültig, nur der Bytecode ist wichtig.  Alle Proguard-Bytecode-Manipulationen können in drei Hauptkategorien unterteilt werden: <strong>Code-Verkleinerung</strong> , <strong>Optimierung</strong> und <strong>Verschleierung</strong> . </p><br><h3 id="code-shrinking">  Code schrumpft </h3><br><p>  Ja, es ist ein ziemlich seltsames Unterfangen, Code zu schreiben und dann zu löschen, aber dies ist die Realität der Android-Entwicklung.  Hier geht es natürlich nicht um den von Hand geschriebenen Code (obwohl dies passiert), sondern um Tonnen toter Fracht, die von Bibliotheken aller Art gebracht werden.  <strong>Guava</strong> , <strong>Apache Commons</strong> , <strong>Google Play Services</strong> und andere Leute können die Größe der Apk-Datei von 500 KB auf einige zehn Megabyte erhöhen.  Manchmal geht es so weit, dass ein Programm nicht kompiliert werden kann, weil das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dalvik-Methodenlimit überschritten wird</a> .  Proguard hilft dabei, nicht verwendeten Code zu entfernen und die Größe der Anwendung auf einige Megabyte zu reduzieren. </p><br><h3 id="optimisation">  Optimierung </h3><br><p>  Proguard kann nicht nur unnötigen Code entfernen, sondern auch den verbleibenden Code optimieren.  Das Arsenal umfasst Kontrollflussanalyse, Datenflussanalyse, Teilbewertung, statische Einzelzuweisung, Nummerierung globaler Werte und Lebendigkeitsanalyse.  Proguard kann Gucklochoptimierungen durchführen, die Anzahl der Zuweisungen von Variablen reduzieren, Schwanzrekursionen vereinfachen und vieles mehr ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wiki</a> ).  Zusätzlich zu solchen allgemeinen Vorgängen verfügt Proguard über Optimierungen, die speziell für die Android-Plattform nützlich sind, z. B. das Ersetzen von Enum-Klassen durch Ints und das Löschen von Protokollierungsanweisungen. </p><br><h3 id="obfuscation">  Verschleierung </h3><br><p>  Schließlich kann Proguard Ihren gesamten Code in ein unlesbares Chaos verwandeln, indem alle Klassen, Methoden und Felder in zufällige (eigentlich nicht ganz zufällige) Buchstaben umbenannt werden.  Dies ist eine sehr nützliche Option, da jeder Ihre APK-Datei dekompilieren kann und nicht jeder die Geduld hat, verschleierten Code zu verstehen. </p><br><h2 id="princip-raboty">  Arbeitsprinzip </h2><br><p>  Proguard arbeitet in 3 Schritten in der oben beschriebenen Reihenfolge: <strong>Code verkleinern</strong> → <strong>Optimierung</strong> → <strong>Verschleierung</strong> .  Jeder der Schritte ist optional. </p><br><p>  <em>Der Optimierungsschritt beim Android SDK ist standardmäßig deaktiviert.</em> </p><br><p>  Damit Proguard funktioniert, müssen Sie drei Komponenten bereitstellen: </p><br><ul><li> Ihr kompilierter Code ist ein Archiv mit den <code>class</code> Ihres Programms und allen von Ihnen verwendeten Bibliotheken (jar, aar, apk, war, zip usw.).  Proguard ändert nur bereits kompilierten Code und hat nichts mit der Quelle zu tun. </li><li>  Konfigurationsdatei (en) - Datei (en) mit allen Regeln, Optionen und Einstellungen, mit denen Sie die Verarbeitung starten möchten. </li><li>  Bibliotheksgläser (aar, apks, ...) - Klassen der Plattform, auf der Ihr Programm ausgeführt wird.  Im Fall von Android ist dies <code>android.jar</code> .  Diese Archive werden nur für die korrekte Analyse Ihres Codes benötigt, sie werden nicht geändert (dies macht keinen Sinn, da <code>android.jar</code> "am Telefon" ist, haben wir keinen Zugriff darauf). </li></ul><br><p><img src="https://habrastorage.org/webt/sf/vb/b8/sfvbb8uuvqdacgnjvzmeka3zpa4.png" alt="Bild aus der Präsentation von Jeb Ware, Link am Ende des Artikels"><br>  (Bild aus der Präsentation von Jeb Ware, Link am Ende des Artikels) </p><br><p>  Mit Hilfe von Bibliotheksklassen und Ihren Konfigurationsdateien definiert Proguard alle Einstiegspunkte für Ihr Programm ( <strong>Seeds</strong> ).  Mit anderen Worten, es definiert diejenigen Klassen und Methoden, die von außen aufgerufen werden können und die nicht berührt werden können.  Dann wird aus entdeckt <strong>Samen beginnen,</strong> Proguard rekursiv den gesamten Code durch das Kontrollkästchen Markierung alles „genutzt“ , was erreichen konnte.  Alle anderen Codes werden gelöscht.  Sie müssen mindestens einen Einstiegspunkt in der Konfiguration angeben.  Für ein Standard-Java-Programm ist dies die Hauptfunktion.  Android hat keinen einzigen Einstiegspunkt in das Programm, sondern Standardkomponenten (Aktivität, Service usw.), die vom System erstellt und aufgerufen werden.  Glücklicherweise müssen wir hier nichts selbst angeben, das Android SDK erstellt die erforderliche Konfiguration für uns. </p><br><h3 id="soputstvuyuschie-fayly">  Begleitdateien </h3><br><p>  Nachdem alle Einstiegspunkte erkannt wurden, schreibt Proguard sie in die Datei <code>seeds.txt</code> . </p><br><p>  Der gesamte Code, den Proguard für unnötig befunden hat, wird in die Datei <code>usage.txt</code> .  Dies ist ein ziemlich seltsamer Name für eine Datei, die Remote-Code enthält. Es wäre korrekter, sie ungewöhnlichage.txt zu nennen, aber wir haben das, was wir haben. Denken Sie daran. </p><br><p>  Im Verschleierungsschritt wird eine <code>mapping.txt</code> Datei erstellt, die die Paare &lt;ursprünglicher Klassenname | Methode | Feld&gt; -&gt; &lt;verschleierter Klassenname | Methode | Feld&gt; enthält.  Diese Datei ist nützlich, wenn Sie ein Programm deobfuscieren müssen, z. B. Stacktrace lesen.  Das <code>proguardui</code> Dateien ist nicht erforderlich. Das Android SDK verfügt <code>proguardui</code> Hilfsprogramme für <code>proguardui</code> und <code>proguardui</code> .  Wenn Sie Fabric Crashlytics verwenden, kann das Gradle-Plugin diese Datei unabhängig voneinander finden und in die Konsole laden, sodass Sie sich darüber keine Gedanken machen müssen. </p><br><p>  Bei Android befinden sich diese Dateien normalerweise in <code>app/build/output/mapping/&lt;product-flavor-name&gt;/</code> . </p><br><p>  Proguard erstellt auch eine <code>dump.txt</code> Datei, die alles enthält, was Proguard in das endgültige Archiv gestellt hat.  Er hat sich für mich nie als nützlich erwiesen, aber vielleicht ist es für jemanden nützlich. </p><br><h3 id="kak-dela-obstoyat-v-android">  Wie läuft es auf Android? </h3><br><p>  Das Android Gradle Plugin kann Proguard selbst ausführen.  Sie müssen lediglich diese Option aktivieren und die Konfigurationsdateien angeben. </p><br><pre> <code class="hljs cs">buildTypes { &lt;...&gt; release { minifyEnabled <span class="hljs-literal"><span class="hljs-literal">true</span></span> proguardFiles <span class="hljs-string"><span class="hljs-string">'proguard-rules.pro'</span></span>, getDefaultProguardFile(<span class="hljs-string"><span class="hljs-string">'proguard-android.txt'</span></span>) } }</code> </pre> <br><p>  <code>minifyEnabled true</code> - Aktiviert Proguard zur Erstellungszeit </p><br><p>  <code>proguardFiles</code> - eine Liste von Konfigurationsdateien.  Regeln aus allen Konfigurationsdateien werden der allgemeinen Liste in der Reihenfolge hinzugefügt, in der sie angezeigt werden. </p><br><p>  <code>proguard-rules.pro</code> - das ist unsere Konfigurationsdatei mit spezifischen projektspezifischen Regeln </p><br><p>  <code>getDefaultProguardFile('proguard-android.txt')</code> - eine Funktion, die die Standardkonfigurationsdatei für Android-Anwendungen zurückgibt.  Es liegt in <code>AndroidSDK/tools/proguard</code> </p><br><p>  Tatsächlich verfügt das Android SDK über zwei <code>proguard-android.txt</code> : <code>proguard-android.txt</code> und <code>proguard-android-optimize.txt</code> .  Der erste hat die Option <code>-dontoptimize</code> , mit der alle Optimierungen <code>-dontoptimize</code> .  Wenn Sie die Optimierung aktivieren möchten, verwenden Sie die zweite Konfiguration. </p><br><p>  Zusätzlich zu diesen Standardkonfigurationen generiert das Android SDK (aapt) automatisch eine Reihe von Regeln für Ressourcen: aapt überprüft alle XML-Dateien (einschließlich des Manifests), um alle Aktivitäten, Dienste, Ansichten usw. zu finden.  und generieren Sie die notwendigen Regeln für sie.  Die generierten Regeln finden Sie in <code>app/build/intermediates/proguard-rules/&lt;flavor&gt;/aapt_rules.txt</code> .  Sie müssen es nicht selbst angeben, das Android Gradle Plugin fügt diese Regeln automatisch hinzu. </p><br><p><img src="https://habrastorage.org/webt/1r/w4/t6/1rw4t6egtvymigl79hnxc3n8t9a.png" alt="Bild aus der Präsentation von Jeb Ware, Link am Ende des Artikels"><br>  (Bild aus der Präsentation von Jeb Ware, Link am Ende des Artikels) </p><br><h2 id="konfigi">  Konfigurationen </h2><br><p>  Das Einrichten von Proguard ist der grundlegendste Teil der Arbeit damit und gleichzeitig der schwierigste.  Eine falsche Konfiguration kann die Kompilierung der Anwendung und der Anwendung selbst zur Laufzeit leicht unterbrechen.  Alle verfügbaren Konfigurationsoptionen sind ausführlich dokumentiert.  Website. </p><br><p>  Unter allen Optionen möchte ich die drei wichtigsten Gruppen herausgreifen: </p><br><ul><li>  Regeln einhalten - Alle möglichen Einstiegspunkte in das Programm.  Regeln, die Proguard mitteilen, welche Klassen oder Teile von Klassen unverändert bleiben sollen oder welche der Änderungen für bestimmte Klassen gültig sind. </li><li>  Optimierungsoptimierung - Geben Sie an, welche Optimierungen akzeptabel sind und wie viele Optimierungszyklen durchgeführt werden müssen. </li><li>  Arbeiten Sie mit Warnungen, Fehlern und Debugging </li></ul><br><h3 id="keep-rules">  Regeln einhalten </h3><br><p>  Dies ist eine Reihe von Optionen, die Ihren Code vor dem rücksichtslosen Proguard schützen sollen.  In ihrer allgemeinsten Form sieht diese Regel folgendermaßen aus: </p><br><pre> <code class="hljs powershell"><span class="hljs-literal"><span class="hljs-literal">-keep</span></span> [,<span class="hljs-type"><span class="hljs-type">modifier</span></span>,<span class="hljs-type"><span class="hljs-type">...</span></span>] class_specification</code> </pre> <br><p>  <code>keep</code> ist die häufigste dieser Optionen (es gibt andere) und weist Proguard an, die Klasse selbst und alle ihre Klassenmitglieder zu speichern: Felder und Methoden. </p><br><p>  <code>class_specification</code> - eine Vorlage, die auf die Klasse (n) oder ihre Teile (Klassenmitglieder) verweist.  Die allgemeine Ansicht der Vorlage ist sehr groß und kann deaktiviert <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werden.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> .  Sie können ihn kontaktieren, aber im Allgemeinen können Sie sich nur daran erinnern, dass wir die Möglichkeit haben, eine Vorlage für diese Komponenten zu erstellen: </p><br><ul><li>  Wählen Sie alle Klassen mit einem bestimmten Namen und Paket aus </li><li>  Wählen Sie alle Klassen aus, die bestimmte Klassen / Schnittstellen erben / implementieren </li><li>  Wählen Sie alle Klassen mit bestimmten Modifikatoren und / oder bestimmten Anmerkungen aus </li><li>  Wählen Sie alle Methoden mit einem bestimmten Namen, Modifikatoren, Argumenten und Rückgabewert aus </li><li>  Wählen Sie alle Felder mit einem bestimmten Namen, Modifikatoren eines bestimmten Typs aus. </li><li><p>  Es ist möglich, Platzhalter zu verwenden </p><br><p>  Auch dies ist keine strenge Beschreibung der Vorlage, sondern eine Liste der Funktionen, die wir haben.  Hier einige Beispiele: </p><br></li></ul><br><p> <code>-keep public class com.example.MyActivity</code> <br>  halten die Klasse <code>com.example.MyActivity</code> </p><br><p> <code>-keep public class * extends android.app.Activity</code> <br>  Speichern Sie alle öffentlichen Klassen, die <code>android.app.Activity</code> erben </p><br><pre> <code class="hljs scala">-keep public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">android</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>); public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>, android.util.<span class="hljs-type"><span class="hljs-type">AttributeSet</span></span>); public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>, android.util.<span class="hljs-type"><span class="hljs-type">AttributeSet</span></span>, int); public void set*(...); }</code> </pre> <br><p>  Finden Sie alle öffentlichen Klassen, die <code>android.view.View</code> erben, und speichern Sie darin 3 Konstruktoren mit bestimmten Parametern + alle öffentlichen Methoden, mit dem Modifikator <code>void</code> , allen Argumenten und einem Namen, der mit <code>set</code> beginnt.  Alle anderen Teile der Klasse können geändert werden. </p><br><p> <code>-keep class com.habr.** { *; }</code> <br>  Speichern Sie alle Klassen und ihren gesamten Inhalt im Paket <code>com.habr</code> </p><br><p>  <code>modifiers</code> - Ergänzung zur Keep-Regel: </p><br><ul><li>  <code>includedescriptorclasses</code> - Zusätzlich zu der angegebenen Klasse / Methode / dem angegebenen Feld müssen Sie alle Klassen speichern, die in ihren Deskriptoren vorkommen. </li><li>  <code>includecode</code> - Der Inhalt der Methode, auf die diese spezielle Regel <code>includecode</code> kann ebenfalls nicht berührt werden. </li><li>  <code>allowshrinking</code> - Klassen, auf die in dieser Regel verwiesen wird, sind keine <code>allowshrinking</code> und können gelöscht werden, sondern nur, wenn sie nicht im Programm selbst verwendet werden.  Wenn dieser Code jedoch nach dem Schrumpfen des Codes erhalten bleibt (aufgrund der Tatsache, dass jemand ihn verwendet), ist es unmöglich, diesen Code zu optimieren / zu verschleiern. </li><li>  <code>allowoptimization</code> - Klassen, auf die sich diese Regel bezieht, können nur optimiert, aber nicht entfernt oder verschleiert werden. </li><li>  <code>allowobfuscation</code> - Klassen, auf die in dieser Regel verwiesen wird, können nur verschleiert, aber nicht entfernt oder optimiert werden. </li></ul><br><p>  Neben <code>keep</code> gibt es ein paar Optionen: </p><br><p>  <code>-keepclassmembers</code> - <code>-keepclassmembers</code> an, dass Klassenmitglieder gespeichert werden sollen, wenn die Klasse selbst nach dem Verkleinern des Codes erhalten bleibt. </p><br><p>  <code>-keepclasseswithmembers</code> - gibt an, dass Sie Klassen speichern möchten, deren Inhalt unter die angegebene Vorlage fällt.  Beispiel: <code>-keepclasseswithmembers class * { public &lt;init&gt;(android.content.Context); }</code>  <code>-keepclasseswithmembers class * { public &lt;init&gt;(android.content.Context); }</code> - speichert alle Klassen, die einen öffentlichen Konstruktor haben, mit einem Argument vom Typ <code>Context</code> . </p><br><p>  <code>-keepnames</code> - <code>-keepnames</code> für <code>-keep,allowshrinking</code> . </p><br><p>  <code>-keepclassmembernames</code> - Abkürzung für <code>-keepclassmembers,allowshrinking</code> . </p><br><p>  <code>keepclasseswithmembernames</code> - <code>keepclasseswithmembernames</code> für <code>-keepclasseswithmembers,allowshrinking</code> . </p><br><h3 id="optimisation-tuning">  Optimierungstuning </h3><br><p>  Die wichtigste Option ist hier das Flag <code>-dontoptimize</code> .  Wenn es vorhanden ist, wird keine Optimierung durchgeführt und alle anderen Optimierungsoptionen werden ignoriert. </p><br><p>  Es gibt viele Optimierungsoptionen, aber die folgenden sind für mich am nützlichsten: </p><br><p>  <code>-optimizations optimization_filter</code> - listet alle Möglichkeiten auf, die Sie verwenden möchten.  Es ist besser, die in <code>proguard-android-optimize.txt</code> angegebene Menge oder eine Teilmenge davon zu verwenden.  Eine Liste aller Optimierungen finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><p>  <code>-optimizationpasses n</code> - Anzahl der Optimierungszyklen.  Mehrere Zyklen können das Ergebnis verbessern.  Gleichzeitig ist Proguard intelligent genug, um Zyklen zu stoppen, wenn sich herausstellt, dass sich das Ergebnis seit dem letzten Mal nicht verbessert hat. </p><br><p>  <code>-assumenosideeffects class_specification</code> - gibt an, dass diese Methode keine Nebenwirkungen hat und nur einen bestimmten Wert zurückgibt.  Proguard löscht Aufrufe dieser Methode, wenn festgestellt wird, dass das zurückgegebene Ergebnis nicht verwendet wird.  Möglicherweise wird diese Option am häufigsten verwendet, um alle Debug-Protokolle zu löschen: <code>-assumenosideeffects class android.util.Log { public static int d(...); }</code> <code>-assumenosideeffects class android.util.Log { public static int d(...); }</code> </p><br><p>  <code>-allowaccessmodification</code> - zeige alles, was versteckt ist :) Eine großartige Option, mit der du eine Reihe künstlicher Zugriffsmethoden für verschachtelte Klassen loswerden kannst.  Funktioniert nur in Verbindung mit <code>-repackageclasses</code> </p><br><p>  <code>-repackageclasses</code> - <code>-repackageclasses</code> Verschieben aller Klassen in ein angegebenes Paket.  Dies gilt eher für die Verschleierung, führt aber gleichzeitig zu guten Ergebnissen bei der Optimierung. </p><br><h3 id="prochie-poleznye-opcii">  Andere nützliche Optionen </h3><br><p>  <code>-dontwarn</code> und <code>-dontnote</code> </p><br><p>  Proguard ist sehr intelligent und meldet während der Codeanalyse immer verdächtige Stellen. Manchmal sind dies Notizen, manchmal Warnungen.  Wenn Ihr Build nicht mit aktiviertem Proguard ausgeführt wird, lesen Sie unbedingt alle von ihm erstellten Protokolle. Es schreibt, was schief gelaufen ist, und zeigt Ihnen höchstwahrscheinlich sogar, wie Sie das Problem beheben können.  Nachdem Sie alle Nachrichten gelesen haben, beheben Sie entweder das Problem oder ignorieren die Nachricht einer dieser Optionen, wenn Sie sicher sind, dass kein Problem vorliegt. </p><br><p>  Es kommt beispielsweise vor, dass einige Java-Bibliotheken Plattformklassen verwenden, die sich nicht in android.jar befinden, und Proguard warnt davor.  Wenn Sie sicher sind, dass diese Bibliothek in einer Android-Umgebung <code>-dontwarn java.lang.management.**</code> funktioniert, können Sie diese Warnung <code>-dontwarn java.lang.management.**</code> warnen <code>-dontwarn java.lang.management.**</code> </p><br><p>  <code>-whyareyoukeeping class_specification</code> ist eine nützliche Option, die den Grund druckt, warum Proguard beschlossen hat, diese Klasse / Methode nicht zu berühren. </p><br><p>  <code>-verbose</code> - <code>-verbose</code> detailliertere Protokolle und Ausnahmen </p><br><p>  <code>-printconfiguration</code> - druckt eine vollständige Liste der Optionen aus allen verwendeten Konfigurationsdateien, einschließlich Regeln aus Bibliotheken, die über aapt generiert wurden. </p><br><p>  <code>-keepattributes SourceFile, LineNumberTable</code> - speichert Metainformationen (Dateinamen, Zeilennummerierung), um Code in der IDE zu debuggen und eine aussagekräftige Stapelverfolgung zu erhalten.  Stellen Sie sicher, dass Sie diese Option hinzufügen. </p><br><h3 id="praktika">  Übe </h3><br><p>  Dies geschieht normalerweise: Schalten Sie Proguard ein und Sie brechen das gesamte Projekt ab, was zu einer Menge Fehlern führt.  Viele schalten in diesem Schritt Proguard aus und versuchen, nicht dorthin zurückzukehren.  Ich werde versuchen, einige Tipps zu geben, um diesen Übergangsprozess zu vereinfachen. </p><br><h4 id="opredelitsya-s-nachalnymi-vhodnymi-tochkami">  Entscheiden Sie sich für die Startpunkte </h4><br><p>  Wenn Sie ein Android-Entwickler sind, ist alles äußerst elementar - wählen Sie einfach eine der beiden Standardkonfigurationen aus dem Android SDK aus: <code>proguard-android.txt</code> oder <code>proguard-android-optimize.txt</code> . Sie kümmern sich um alles, was unberührt bleiben sollte. </p><br><h4 id="proverit-vse-biblioteki">  Überprüfen Sie alle Bibliotheken </h4><br><p>  In letzter Zeit werden immer mehr Bibliotheken mit vorgefertigten Proguard-Konfigurationen verteilt.  Proguard kann in das Archiv schauen, die Bibliothekskonfiguration finden und sie anderen Optionen hinzufügen.  Überprüfen Sie jede Bibliothek, die Sie für eine solche Konfiguration verwenden. </p><br><p><img src="https://habrastorage.org/webt/rf/dq/vn/rfdqvnztj-zagmqtzwctc73x3-k.png" alt="(Inhalt einer AAR-Datei einer der Bibliotheken)"><br>  (Inhalt einer AAR-Datei einer der Bibliotheken) </p><br><p>  Wenn Sie Google Play Services verwenden, wählt das Plugin <code>com.google.gms.google-services</code> die <code>com.google.gms.google-services</code> Konfiguration selbst aus. </p><br><p>  Wenn die Autoren der Bibliothek die Konfiguration nicht in das Archiv packen, haben sie sich möglicherweise darum gekümmert und die Regeln auf ihre Website, Repository-Seite oder in die README-Datei geschrieben.  Versuchen Sie, die Konfiguration für die von Ihnen verwendete Version der Bibliothek selbst zu finden. </p><br><p>  Wenn Sie nirgendwo vorgefertigte Regeln finden, müssen Sie die Protokolle lesen und das Problem einzeln lösen.  Höchstwahrscheinlich müssen Sie Keep-Regeln für den fehlerhaften Bibliothekscode hinzufügen.  Oder ignorieren Sie Fehler, wenn sie das Programm nicht beeinträchtigen. </p><br><h4 id="provesti-inspekciyu-svoego-koda">  Überprüfen Sie Ihren Code </h4><br><p>  Sie wissen besser, welchen Code Sie unter dem Messer senden können, sollten sich jedoch alle Stellen genau ansehen, an denen die Reflexion ohnehin verwendet wird: </p><br><ul><li>  Class.forName (...) (die Dokumentation verspricht, dass Proguard in der Lage ist, solchen Code zu definieren, es gab jedoch Fälle, die es wert sind, überprüft zu werden) </li><li>  Modelle / Entitätsklassen, die bei der Serialisierung und Zuordnung verwendet werden.  Alle Klassen, deren Feldnamen (manchmal die Klassen selbst) wichtig sind (Gson, RealmIO usw.) </li><li>  native Bibliotheksaufrufe über JNI </li></ul><br><h4 id="testy">  Tests </h4><br><p>  Wenn eine Klasse / Methode nur in Tests und nirgendwo anders verwendet wird, löscht Proguard diesen Code.  Dies ist eine häufige Situation, wenn Sie TDD haben :) In diesem Fall habe ich eine separate Konfiguration, in der ich Klassen hinzufüge, die noch nicht in das Projekt integriert sind, nirgendwo verwendet werden, aber getestet werden müssen. </p><br><p>  Im Android Gradle Plugin gibt es zusätzlich zu den Anweisungen für <code>proguardFiles</code> noch <code>testProguardFiles</code> .  Diese Anweisung wird benötigt, um die Konfigurationen anzugeben, die auf die Testanwendung angewendet werden, die generiert wird, um Ihre Anwendung zu testen, wenn Sie Instrumentierungstests ausführen.  Normalerweise wird dies verwendet, um die gleiche Optimierung / Verschleierung in beiden apk-Dateien zu erreichen, so dass keine Desynchronisation zwischen ihnen besteht.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> </p><br><h4 id="apk-analyzer">  APK Analyzer </h4><br><p>  Android Studio hat so ein tolles Tool.  Sie können es entweder über Aktion suchen -&gt; APK analysieren oder durch Öffnen der APK-Datei selbst in Android Studio öffnen.  Analyzer zeigt viele nützliche Informationen, aber jetzt interessieren wir uns für den Code.  Um zu sehen, was schließlich in eine APK-Datei <code>classes.dex</code> , müssen Sie die Datei <code>classes.dex</code> auswählen </p><br><p><img src="https://habrastorage.org/webt/go/zz/o_/gozzo_o83s3e1mknkxhqldrzr3g.png"></p><br><p>  Standardmäßig wird genau der resultierende Code angezeigt, der die Schritte zum Verkleinern und Optimieren bestanden hat.  Sie können jedoch auf die <strong>Schaltfläche Load Proguard-Zuordnungen ...</strong> klicken, <code>seeds.txt</code> und <code>usage.txt</code> hinzufügen, um den gelöschten Code <code>usage.txt</code> . </p><br><p><img src="https://habrastorage.org/webt/gy/4a/gk/gy4agkxifirpyy95-exhk1xmguc.png"></p><br><p>  Wenn Proguard aus irgendeinem Grund den benötigten Code geändert hat, suchen Sie ihn in Analyzer und wählen <strong>Sie Proguard Keep Rule</strong> über RMB <strong>generieren</strong> .  Analyzer generiert eine Auswahl verschiedener Optionen für die Regeln, von der allgemeinsten bis zur spezifischsten. <strong>Wählen Sie eine</strong> davon aus. </p><br><p><img src="https://habrastorage.org/webt/ny/zc/ob/nyzcobecp45cnrrjgq3unu3_zba.png"></p><br><p><img src="https://habrastorage.org/webt/yq/wg/0m/yqwg0mwllbw9wauhemkvffgk_h8.png"></p><br><h4 id="dlya-avtorov-bibliotek">  Für Bibliotheksautoren </h4><br><p>  Wenn Sie eine Android-Bibliothek erstellen, können Sie eine Proguard-Konfiguration für Ihre Clients wie folgt hinzufügen: </p><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">buildTypes</span></span> { <span class="hljs-section"><span class="hljs-section">release</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">consumerProguardFiles</span></span> <span class="hljs-string"><span class="hljs-string">'proguard-rules.pro'</span></span> } }</code> </pre> <br><p>  Meiner Meinung nach ist es besser, Ihre Bibliothek nicht eifrig zu optimieren und zu verschleiern, sondern Ihren Kunden diese Möglichkeit zu bieten.  Ein guter Ton ist, der Konfiguration hinzuzufügen, was Kunden noch hinzufügen müssen, wenn sie Proguard enthalten.  Wenn Sie dennoch Sicherheit hinzufügen möchten, müssen Sie natürlich die gesamte Pulic-API Ihrer Bibliothek vor Proguard schützen, einschließlich Deskriptoren und Signaturen. </p><br><h3 id="r8-dexguard-i-redex">  R8, DexGuard und Redex </h3><br><p>  R8 ist das neue Tool von Google, das den aktuellen Proguard ersetzt.  Warten Sie, versuchen Sie nicht, alles zu vergessen, was Sie gerade im Artikel gelesen haben. Behandeln Sie es einfach wie den neuen Proguard.  Google verspricht, die gesamte öffentliche API beizubehalten, damit alle Konfigurationen wie zuvor funktionieren.  Das Projekt befindet sich noch in der Beta-Phase, aber Sie können es selbst ausprobieren. </p><br><p>  DexGuard ist ein kostenpflichtiges Dienstprogramm der Entwickler von Proguard.  Es kann zusammen oder anstelle von Proguard verwendet werden.  Es wird argumentiert, dass DexGuard alles kann, was Proguard kann, aber besser.  Leider hatte ich keine Gelegenheit, es zu versuchen. Wenn jemand Erfahrung hat, teilen Sie diese bitte mit. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Redex</a> ist ein weiterer Dex-Optimierer von Facebook.  Es wird berichtet, dass Sie damit die Produktivität um bis zu 25% steigern und die Größe der Anwendung reduzieren können, indem Sie das Tool auf den bereits von Proguard verarbeiteten Code anwenden. </p><br><h2 id="vmesto-zaklyucheniya">  Anstelle einer Schlussfolgerung </h2><br><p>  Haben Sie keine Angst, Proguard zu verwenden, seien Sie nicht faul und verbringen Sie einige Zeit mit dem Einrichten.  Dies reduziert die Größe, erhöht die Arbeitsgeschwindigkeit und erhöht die Loyalität Ihrer Benutzer.  Versuchen Sie gleichzeitig, effektive Proguard-Konfigurationen zu erstellen, schreiben Sie keine "Teppich" -Regeln, sonst kommt ein wütender Jake Wharton zu Ihnen und schimpft mit Ihnen. </p><br><p><img src="https://habrastorage.org/webt/ma/tf/kz/matfkzxceoougdvn7pfyx4klnho.png"></p><br><h2 id="resursy">  Ressourcen </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Proguard-Website</a> .  Es gibt auch Informationen über DexGuard. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verschiedene Beispielregeln</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R8</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufzeichnung einer Präsentation der Funktionsweise von Proguard mit DroidCon</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Effektive ProGuard-Regeln für die Aufzeichnung von Präsentationen kleinerer Anwendungen (Google I / O '18)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen zum Aktivieren und Konfigurieren von Proguard für Android</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wiki-Seite</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Redex</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de415499/">https://habr.com/ru/post/de415499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de415485/index.html">Fahren Sie Kingston A1000 - ein Krankenwagen für den Laptop?</a></li>
<li><a href="../de415487/index.html">Seiten der Intel-Geschichte. Erster Chip, Intel 3101</a></li>
<li><a href="../de415489/index.html">Facebook schließt Projekt zur Verbreitung des Internets mittels Drohnen auf Solarenergie ab</a></li>
<li><a href="../de415493/index.html">Eine neue Berechnung nach der Drake-Formel ergab: Die Menschheit ist in ihrer Galaxie mit einer Wahrscheinlichkeit von 53–99,6% einsam</a></li>
<li><a href="../de415497/index.html">Sammlermotor + Digispark = $ 50 Elektrofahrrad</a></li>
<li><a href="../de415501/index.html">Die virtuelle Halle der Eremitage - Der erste Schritt in die Zukunft von Pelevin</a></li>
<li><a href="../de415503/index.html">NetScaler SD-WAN-Benutzeroberfläche</a></li>
<li><a href="../de415509/index.html">Tiefes Lernen in der Programmierung: was, warum und wie</a></li>
<li><a href="../de415529/index.html">Juli IT Events Digest</a></li>
<li><a href="../de415533/index.html">Das Buch "Programmieren für Kinder. Meine ersten Scratch-Programme »</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>