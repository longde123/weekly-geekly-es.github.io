<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôáüèæ üëçüèª üëéüèæ Aceleraci√≥n instagram.com. Parte 1 üò¶ ‚úãüèΩ üèúÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En los √∫ltimos a√±os, han aparecido muchas cosas nuevas en instagram.com . Mucho Por ejemplo: herramientas para contar historias, filtros, herramientas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aceleraci√≥n instagram.com. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/468227/">  En los √∫ltimos a√±os, han aparecido muchas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cosas</a> nuevas en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instagram.com</a> .  Mucho  Por ejemplo: herramientas para contar historias, filtros, herramientas creativas, notificaciones, mensajes directos.  Sin embargo, a medida que el proyecto creci√≥, todo esto produjo un efecto secundario triste, que fue que el rendimiento de instagram.com comenz√≥ a disminuir.  Durante el a√±o pasado, el equipo de desarrollo de Instagram ha hecho esfuerzos continuos para solucionar esto.  Esto llev√≥ al hecho de que el tiempo total de carga del feed de Instagram (p√°gina de feed) disminuy√≥ en casi un 50%. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/wl/oy/ns/wloynshoivqpdf3vtudd3xypwxq.jpeg"></a> <br><br>  Hoy publicamos una traducci√≥n del primer material de una serie de art√≠culos dedicados a la historia de c√≥mo se aceler√≥ instagram.com. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Acerca de optimizar el rendimiento de proyectos web</font> </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/032/871/987/0328719872d42adf9b7690c1a6b63693.png"></div><br>  <i><font color="#999999">Mejora del rendimiento durante el a√±o pasado (feed de Instagram, m√©trica Display Done, ms)</font></i> <br><br>  Uno de los enfoques m√°s importantes para mejorar el rendimiento de las aplicaciones web es priorizar adecuadamente los recursos de carga y procesamiento y reducir el tiempo de inactividad del navegador durante la carga de la p√°gina.  En nuestro caso, muchas de estas optimizaciones han demostrado ser m√°s efectivas que reducir el tama√±o del c√≥digo.  Como regla general, no tuvimos quejas sobre el tama√±o del c√≥digo.  Era lo suficientemente compacto.  Sus dimensiones comenzaron a molestarnos solo despu√©s de que se hicieron muchas peque√±as mejoras al proyecto (tambi√©n planeamos informar sobre la optimizaci√≥n del tama√±o del c√≥digo).  Dichas mejoras, adem√°s, tuvieron menos impacto en el proceso de desarrollo del proyecto.  Requer√≠an menos cambios de c√≥digo y menos refactorizaci√≥n.  Como resultado, inicialmente concentramos nuestros esfuerzos precisamente en esta √°rea, comenzando con la precarga de recursos. <br><br><h2>  <font color="#3AC1EF">Una historia sobre la carga previa de im√°genes, el c√≥digo JavaScript y los materiales necesarios para completar las consultas, as√≠ como sobre d√≥nde tener cuidado</font> </h2><br>  El principio general de nuestras optimizaciones era informar al navegador lo antes posible sobre los recursos necesarios para cargar la p√°gina.  Nosotros, como desarrolladores de proyectos, en muchos casos sab√≠amos de antemano qu√© se necesitar√≠a exactamente para esto.  Pero el navegador no podr√≠a tener idea hasta que una cierta parte de los materiales de la p√°gina se haya cargado y procesado.  Los recursos en cuesti√≥n, en su mayor parte, incluyeron aquellos que se cargan din√°micamente usando JavaScript (por ejemplo, otros scripts, im√°genes, materiales necesarios para ejecutar solicitudes XHR).  El hecho es que el navegador no puede detectar estos recursos dependientes hasta que analiza y ejecuta alg√∫n c√≥digo JavaScript. <br><br>  En lugar de esperar hasta que el navegador mismo encuentre estos recursos, podr√≠amos darle una pista, despu√©s de lo cual podr√≠a comenzar a descargarlos de inmediato.  Lo hicimos usando los atributos HTML de <code>preload</code> .  Se parece a esto: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-js-file.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  Utilizamos sugerencias similares para dos tipos de recursos en rutas cr√≠ticas de carga de p√°ginas.  Este es un c√≥digo JavaScript cargado din√°micamente y materiales cargados din√°micamente de solicitudes de datos GraphQL XHR.  Las secuencias de comandos cargadas din√°micamente son secuencias de comandos que se cargan utilizando construcciones del formulario de <code>import('...')</code> para rutas espec√≠ficas del cliente.  Mantenemos una lista de correspondencia de los puntos de entrada del servidor y los scripts de ruta del cliente.  Como resultado, cuando nosotros, en el servidor, recibimos una solicitud para cargar la p√°gina, conocemos las secuencias de comandos para las rutas de cliente que necesita descargar.  Como resultado, podemos, al generar el c√≥digo HTML de la p√°gina, agregarle sugerencias apropiadas. <br><br>  Por ejemplo, cuando trabaje con el punto de entrada <code>FeedPage</code> sabemos que el enrutador del cliente completar√° una solicitud para descargar <code>FeedPageContainer.js</code> .  Como resultado, podemos agregar la siguiente construcci√≥n al c√≥digo de p√°gina: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/FeedPageContainer.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  Del mismo modo, si sabemos que se planea ejecutar una consulta GraphQL para el punto de entrada de una p√°gina en particular, esto significa que debemos precargar los materiales para acelerar la ejecuci√≥n de esta consulta.  Esto es especialmente importante debido al hecho de que la ejecuci√≥n de tales consultas GraphQL a veces lleva mucho tiempo, y la p√°gina no se puede procesar hasta que se devuelvan los resultados de la consulta.  Debido a esto, debemos hacer que el servidor lo antes posible participe en la formaci√≥n de respuestas a tales solicitudes. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/graphql/query?id=12345"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fetch"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application/json"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  Los cambios en las caracter√≠sticas de carga de la p√°gina son especialmente notables en conexiones lentas.  Al simular una conexi√≥n 3G r√°pida (el primer gr√°fico en cascada a continuaci√≥n, que ilustra la situaci√≥n en la que no se usa la precarga de recursos), podemos ver que cargar <code>FeedPageContainer.js</code> y ejecutar la consulta GraphQL asociada solo comienza despu√©s de cargar <code>Consumer.js</code> .  Sin embargo, en el caso de que se use la precarga, la carga del script <code>FeedPageContainer.js</code> y la ejecuci√≥n de la consulta GraphQL pueden comenzar inmediatamente despu√©s de que la p√°gina HTML est√© disponible.  Esto, adem√°s, reduce el tiempo requerido para descargar cualquier script menor que use mecanismos de carga diferida.  Aqu√≠, <code>FeedSidebarContainer.js</code> y <code>ActivityFeedBox.js</code> (que dependen de <code>FeedPageContainer.js</code> ) comienzan a cargarse casi inmediatamente despu√©s de procesar <code>Consumer.js</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fe0/10c/222/fe010c2222b31034b109f5cc0d378613.png"></div><br>  <i><font color="#999999">Precarga no utilizada</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e3f/e33/b78/e3fe33b78b3b5fe1c04fa3175809e25d.png"></div><br>  <i><font color="#999999">Precarga utilizada</font></i> <br><br><h2>  <font color="#3AC1EF">Beneficios de priorizar la precarga</font> </h2><br>  Adem√°s de usar el atributo de <code>preload</code> para comenzar a cargar recursos m√°s r√°pido, usar este mecanismo tiene otra ventaja.  Consiste en aumentar la prioridad de red de la carga as√≠ncrona de scripts.  Esto se vuelve importante cuando se usan scripts cargados de forma as√≠ncrona en rutas cr√≠ticas para cargar p√°ginas, ya que de manera predeterminada se cargan con baja prioridad.  Como resultado, la prioridad de las solicitudes XHR e im√°genes relacionadas con el √°rea de la p√°gina visible para los usuarios ser√° mayor que la de los materiales fuera del √°rea de visualizaci√≥n.  Pero esto puede conducir a situaciones en las que los scripts cr√≠ticos necesarios para representar la p√°gina se bloquean o se ven obligados a compartir el ancho de banda con otros recursos.  Si est√° interesado, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠ hay una</a> cuenta detallada de las prioridades de recursos de Chrome.  El uso cuidadoso del mecanismo de precarga (hablaremos m√°s sobre esto a continuaci√≥n) le da al desarrollador un cierto nivel de control sobre c√≥mo el navegador prioriza el proceso de carga inicial de la p√°gina.  Esto es especialmente cierto para aquellos casos en que el desarrollador sabe qu√© recursos son importantes para la visualizaci√≥n correcta de la p√°gina. <br><br><h2>  <font color="#3AC1EF">Problemas de priorizaci√≥n de precarga</font> </h2><br>  El problema de la precarga de recursos radica precisamente en el hecho de que le da al desarrollador una influencia adicional para influir en la prioridad de la carga de recursos.  Esto significa que el desarrollador tiene m√°s responsabilidad para la priorizaci√≥n adecuada.  Por ejemplo, al probar un sitio en regiones en las que la velocidad de las redes m√≥viles y WiFi es muy baja, y en las que se observa un gran porcentaje de p√©rdida de paquetes, notamos que la solicitud se ejecut√≥ durante el procesamiento de <code>&lt;link rel="preload" as="script"&gt;</code> obtiene una prioridad m√°s alta que la solicitud que se ejecuta al procesar la <code>&lt;script /&gt;</code> paquetes <code>&lt;script /&gt;</code> JavaScript utilizados en las rutas cr√≠ticas de representaci√≥n de p√°ginas.  Esto lleva a un aumento en el tiempo total de carga de la p√°gina. <br><br>  La fuente de este problema fue c√≥mo colocamos las etiquetas de precarga en nuestras p√°ginas.  Es decir, agregamos sugerencias de precarga solo para paquetes, que son parte de la p√°gina actual, que √≠bamos a cargar de forma asincr√≥nica con el enrutador del cliente. <br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--   ,    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SomeConsumerRoute.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"..."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> /&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!-- ,      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Common.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Consumer.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Por ejemplo, en la p√°gina de cierre de sesi√≥n, <code>SomeConsumerRoute.js</code> en <code>Common.js</code> y <code>Consumer.js</code> , y dado que los recursos de precarga se cargan con una prioridad m√°s alta, pero no se <code>Common.js</code> , esto bloquea <code>Common.js</code> y <code>Consumer.js</code> parsing <code>Consumer.js</code> .  El equipo de desarrollo de Chrome Data Saver encontr√≥ un problema de precarga similar y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">describi√≥</a> su soluci√≥n a este problema.  En su caso, se decidi√≥ colocar siempre construcciones para precargar recursos as√≠ncronos despu√©s de las etiquetas <code>&lt;script /&gt;</code> de esos recursos que usan estos recursos as√≠ncronos.  Decidimos precargar todos los scripts y colocar las construcciones correspondientes en el c√≥digo en el orden en que ser√≠an necesarias.  Esto nos da la oportunidad de comenzar a precargar todos los recursos de script de la p√°gina lo m√°s r√°pido posible.  Esto incluye etiquetas para cargar s√≠ncronos scripts que no se pueden agregar a HTML hasta que se coloquen datos espec√≠ficos del servidor en la p√°gina.  Esto nos permite controlar el orden de carga de los scripts. <br><br>  Aqu√≠ est√° el marcado que precarga todos los paquetes de JavaScript. <br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Common.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Consumer.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   ,    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preload"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SomeConsumerRoute.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">as</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script"</span></span></span><span class="hljs-tag"> /&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!-- ,      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Common.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Consumer.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SomeConsumerRoute.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Precarga de imagen</font> </h2><br>  Una de las principales √°reas de trabajo de instagram.com es Feed.  Es una p√°gina de imagen y video que admite desplazamiento sin fin.  Llenamos esta p√°gina as√≠.  Primero, descargue el conjunto inicial de publicaciones y luego, a medida que el usuario se desplaza por la p√°gina, cargue conjuntos adicionales de materiales.  Sin embargo, no queremos que el usuario espere a que se carguen nuevos materiales cada vez que llegue al final de la cinta.  Como resultado, para facilitar el trabajo con esta p√°gina, cargamos nuevos conjuntos de materiales antes de que el usuario llegue al final de la cinta. <br><br>  En la pr√°ctica, esto, por varias razones, no es una tarea f√°cil: <br><br><ul><li>  Necesitamos descargar materiales que no son visibles para el usuario, para que no tomen recursos de red y procesador de los materiales que est√° viendo. </li><li>  No quisi√©ramos transmitir datos innecesarios a trav√©s de la red, tratando demasiado de precargar publicaciones que el usuario ni siquiera puede ver.  Pero, por otro lado, si no precargamos una cantidad suficiente de materiales, esto a menudo significar√° el riesgo de que el usuario "se encuentre" con el extremo de la cinta. </li><li>  El proyecto instagram.com est√° dise√±ado para funcionar en varios dispositivos y en pantallas de varios tama√±os.  Como resultado, mostramos las im√°genes en la cinta usando el atributo <code>srcset</code> de la <code>&lt;img&gt;</code> .  Este atributo permite al navegador, dado el tama√±o de la pantalla, decidir qu√© resoluci√≥n de imagen usar.  Esto significa que no es tan f√°cil para nosotros determinar la resoluci√≥n de las im√°genes que deben descargarse por adelantado.  Adem√°s, existe el riesgo de precargar im√°genes que el navegador no utilizar√°. </li></ul><br>  El enfoque que utilizamos para resolver este problema fue crear una abstracci√≥n de la tarea de priorizaci√≥n, que es responsable de poner en cola las tareas asincr√≥nicas (en este caso, estas son tareas para precargar el siguiente conjunto de publicaciones para la salida en la cinta).  Inicialmente, una tarea similar se pone en cola con prioridad <code>idle</code> (aqu√≠ <code>requestIdleCallback</code> utiliza <code>requestIdleCallback</code> ).  Esto significa que la ejecuci√≥n de dicha tarea no comenzar√° mientras el navegador est√© ocupado con cualquier otro trabajo importante.  Sin embargo, si el usuario desplaza la p√°gina lo suficientemente cerca del lugar donde finaliza el conjunto actual de publicaciones descargadas, la prioridad de esta tarea de precargar materiales cambia a <code>high</code> .  Esto se hace cancelando la devoluci√≥n de llamada en espera, despu√©s de lo cual el proceso de precarga comienza inmediatamente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b62/701/f67/b62701f67c074ca53154fe434123c756.png"></div><br>  <i><font color="#999999">Al principio y en el medio de la cinta, la tarea de precarga de datos tiene prioridad inactiva, y al final de la cinta, la prioridad es alta</font></i> <br><br>  Despu√©s de completar la descarga de datos JSON para el pr√≥ximo lote de publicaciones, ponemos en cola una tarea de fondo repetitiva para precargar las im√°genes de este lote.  La precarga de im√°genes se realiza en el orden en que se muestran las publicaciones en el feed en lugar de en paralelo.  Esto nos permite priorizar las tareas de carga de datos y mostrar im√°genes de las publicaciones m√°s cercanas al lugar de la p√°gina que ve el usuario.  Para descargar im√°genes del tama√±o correcto, utilizamos un componente multimedia oculto, cuyos par√°metros corresponden a los par√°metros de la cinta actual.  Dentro de este componente hay un elemento <code>&lt;img&gt;</code> que usa el atributo <code>srcset</code> , el mismo que se usa para mostrar publicaciones reales en el feed.  Esto significa que podemos proporcionar al navegador la capacidad de tomar decisiones sobre qu√© im√°genes precargar.  Como resultado, el navegador usar√° la misma l√≥gica cuando muestre las im√°genes que us√≥ al precargarlas.  Tambi√©n significa que nosotros, utilizando un componente de medios similar, podemos precargar im√°genes para otras √°reas del sitio.  Tales como p√°ginas de perfil de usuario. <br><br>  El efecto general de las mejoras anteriores result√≥ en una reducci√≥n del 25% en el tiempo requerido para cargar fotos.  Estamos hablando del per√≠odo de tiempo entre el momento en que el c√≥digo de publicaci√≥n se agrega al DOM y el momento en que se carga y muestra la imagen de la publicaci√≥n.  Adem√°s, esto condujo a una reducci√≥n del 56% en el tiempo que los usuarios, al llegar al final del feed, pasaban esperando para descargar nuevos materiales. <br><br>  <b>Estimados lectores!</b>  ¬øUtiliza mecanismos de precarga de datos para optimizar sus proyectos web? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/468227/">https://habr.com/ru/post/468227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../468211/index.html">"Solo quer√≠a hacer una broma, pero nadie entendi√≥" o c√≥mo no enterrarme en la presentaci√≥n del proyecto</a></li>
<li><a href="../468213/index.html">tinc-boot - red de malla completa sin dolor</a></li>
<li><a href="../468217/index.html">Dr. Jekyll y Mr. Hyde Cultura corporativa</a></li>
<li><a href="../468219/index.html">Mecanismos de extensibilidad extensible en JavaScript</a></li>
<li><a href="../468223/index.html">Habr Weekly # 19 / BT-door para el gato, por qu√© la IA est√° enga√±ando, qu√© preguntarle al futuro empleador, un d√≠a con iPhone 11 Pro</a></li>
<li><a href="../468229/index.html">Una nota sobre vac√≠o en JavaScript y TypeScript</a></li>
<li><a href="../468231/index.html">¬øEs la seguridad en AEM un problema de plataforma o implementaci√≥n?</a></li>
<li><a href="../468233/index.html">La forma de escribir comprobando 4 millones de l√≠neas de c√≥digo Python. Parte 1</a></li>
<li><a href="../468235/index.html">La forma de escribir comprobando 4 millones de l√≠neas de c√≥digo Python. Parte 2</a></li>
<li><a href="../468237/index.html">La forma de escribir comprobando 4 millones de l√≠neas de c√≥digo Python. Parte 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>