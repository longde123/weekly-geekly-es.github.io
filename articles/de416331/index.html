<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∏Ô∏è üëç üßö Die Geschichte der Umgestaltung der Citimobil-Anwendung ü§ñ üò∫ üìï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor etwas mehr als einem Jahr trat ich als Android-Entwickler dem CityMobil-Team bei. Ich habe mich an ein neues Projekt gew√∂hnt, an neue Ans√§tze und ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die Geschichte der Umgestaltung der Citimobil-Anwendung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/416331/"><img src="https://habrastorage.org/webt/0x/uf/e0/0xufe0ffghyddfihpobtxjywqpe.jpeg"><br><br>  Vor etwas mehr als einem Jahr trat ich als Android-Entwickler dem CityMobil-Team bei.  Ich habe mich an ein neues Projekt gew√∂hnt, an neue Ans√§tze und Technologien.  Zu dieser Zeit hatte Citimobil bereits eine ziemlich lange Geschichte, wie das Projekt, das ich angenommen habe, eine Android-Anwendung f√ºr die Bestellung eines Taxis.  Wie in solchen F√§llen jedoch h√§ufig, enthielt der Code die charakteristischen Spuren alter L√∂sungen.  Und jetzt, nachdem ich den Code erfolgreich √ºberarbeitet habe, m√∂chte ich Ideen teilen, die meiner Meinung nach f√ºr diejenigen n√ºtzlich sein k√∂nnen, die ein vorhandenes Projekt umgestalten m√ºssen.  Und vor allem kann es f√ºr kleine Unternehmen mit kleinen Entwicklungsteams n√ºtzlich sein. <br><a name="habracut"></a><br>  Ein Unternehmen testet h√§ufig seine Ideen, leitet begrenzte Ressourcen an es weiter und versucht, Feedback zu erhalten. Testen Sie seine Hypothesen so schnell wie m√∂glich.  In solchen Momenten tritt in der Regel ein qualitativ hochwertiges √úberdenken und Implementieren der Projektarchitektur unter Ber√ºcksichtigung der Zukunft in den Hintergrund.  Allm√§hlich erh√§lt das Projekt neue Funktionen, neue Gesch√§ftsanforderungen werden angezeigt, und all dies wirkt sich auf die Codebasis aus.  "CityMobil" war in dieser Hinsicht keine Ausnahme.  Das Projekt wurde nacheinander von mehreren Teams im alten B√ºro entwickelt, dann w√§hrend des Umzugs unterst√ºtzt und teilweise mit Outsourcing korrespondiert.  Dann bildeten sie ein neues Team und gaben mir die Arbeit an dem Projekt. <br><br>  Zu dieser Zeit zog ‚ÄûEntwicklung‚Äú in das Moskauer B√ºro, die Arbeit war in vollem Gange - es tauchten st√§ndig neue interessante und ehrgeizige Aufgaben auf.  Das Erbe steckte jedoch immer mehr St√∂cke in die R√§der, und als wir merkten, dass die Zeit f√ºr gro√üe Ver√§nderungen gekommen war.  Leider wurde damals nicht so viel n√ºtzliche Literatur gefunden.  Es ist verst√§ndlich, es ist aus Erfahrung bekannt, es ist kaum m√∂glich, das perfekte Rezept zu finden, das in 100% der F√§lle funktioniert. <br><br>  Das erste, was Sie tun m√ºssen, ist zu verstehen, ob Sie wirklich ein Refactoring ben√∂tigen.  Dies sollte ber√ºcksichtigt werden, wenn: <br><br><ol><li>  Die Geschwindigkeit der Einf√ºhrung neuer Funktionen ist trotz des hohen Niveaus an Spezialisten im Team unangemessen gering. </li><li>  √Ñnderungen am Code in einem Teil des Programms k√∂nnen zu unerwartetem Verhalten in einem anderen Teil f√ºhren. </li><li>  Die Anpassung neuer Teammitglieder verz√∂gert sich. </li><li>  Code-Tests werden durch starke Konnektivit√§t behindert. </li></ol><br>  Nachdem man das Vorhandensein eines Problems erkannt hat, sollte man Antworten auf die folgenden Fragen finden: <br><br><ol><li>  Was ist eigentlich falsch? </li><li>  Was hat dazu gef√ºhrt? </li><li>  Was muss getan werden, um dies zu verhindern? </li><li>  Wie kann man die Situation beheben? </li></ol><br>  Es ist fast unm√∂glich, ein gutes Langzeitprojekt zu erstellen, ohne eine bestimmte Architektur zu legen.  In unserem Projekt haben wir uns entschlossen, eine ‚Äûgeschichtete‚Äú Architektur einzuf√ºhren, die sich bereits bew√§hrt hat. <br><br>  Urspr√ºnglich wurde das Projekt haupts√§chlich mit Hilfe der vom Android SDK selbst bereitgestellten Tools geschrieben.  Der Ansatz funktioniert zweifellos, zwingt Sie jedoch dazu, viel Code f√ºr das Boilerplate zu schreiben, was die Entwicklung stark behindert.  Und wenn man bedenkt, dass heutzutage viele an bestimmte Technologiepakete gew√∂hnt sind, dauerte die Anpassung neuer Entwickler l√§nger.  Allm√§hlich kamen wir zu bequemeren Technologien, die viele kennen und sch√§tzen und die ihre Zuverl√§ssigkeit und Konsistenz bewiesen haben: <br><br><ul><li>  MVP - User Interface Design Pattern (Modellansicht-Pr√§sentator). </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dolch 2</a> ist ein Framework zum Implementieren von Abh√§ngigkeiten. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RxJava2</a> ist eine Implementierung von ReactiveX - einer Bibliothek zum Erstellen asynchroner und ereignisbasierter Programme unter Verwendung des Observer-Musters f√ºr die JVM. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cicerone</a> ist eine Bibliothek, mit der Sie die Navigation in der Anwendung vereinfachen k√∂nnen. </li><li>  Eine Reihe spezifischer Bibliotheken f√ºr die Arbeit mit Karten und Orten. </li></ul><br>  Es ist sehr wichtig, einen gemeinsamen Codestil f√ºr das Team zu verwenden, um eine Reihe von Best Practices zu entwickeln.  Sie sollten sich auch um die Infrastruktur und Prozesse k√ºmmern.  Es ist besser, sofort Tests f√ºr den neuen Code zu schreiben, da es viele Informationen zu diesem Thema gibt. <br><br>  Innerhalb des Teams haben wir begonnen, eine Code√ºberpr√ºfung durchzuf√ºhren. Es dauert nicht so lange, aber die Qualit√§t des Codes ist viel h√∂her geworden.  Selbst wenn Sie alleine im Team sind, empfehle ich, an Git Flow zu arbeiten, Zusammenf√ºhrungsanforderungen zu erstellen und diese zumindest selbst zu √ºberpr√ºfen. <br><br>  Alle "schmutzigen" Arbeiten k√∂nnen an CI delegiert werden - in unserem Fall ist dies TeamCity mit Fastlane.  Wir haben es so konfiguriert, dass Feature-Zweige erstellt, die Tests ausgef√ºhrt und der interne Test erstellt werden.  Bei uns haben wir Assemblys f√ºr die Produktions- / Staging-Umgebung separat konfiguriert, Feature- (wir nennen sie bei der Aufgabennummer mit der Vorlage TASK # task_number) und Release-Zweige.  Dies erleichtert das Testen und wenn ein Fehler auftritt, wissen wir sofort, was wo behoben werden muss. <br><br>  Nachdem wir alle vorbereitenden Ma√ünahmen durchgef√ºhrt haben, machen wir uns an die Arbeit.  Wir haben ein neues Leben in einem alten Projekt begonnen, indem wir ein Paket (cleanarchitecture) erstellt haben.  Es ist wichtig, den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aktivit√§tsalias</a> nicht zu vergessen, wenn Sie Einstiegspunkte in die Anwendung verschieben (a-la ActivitySplash).  Wenn Sie dies vernachl√§ssigen, verlieren Sie im besten Fall das Symbol im Launcher, und im schlimmsten Fall wird die Kompatibilit√§t mit anderen Anwendungen verletzt. <br><br><pre><code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- android:name=".SplashActivity" - old launcher activity --&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- android:targetActivity=".cleanarchitecture.presentation.SplashActivity" - new launcher activity --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity-alias</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".SplashActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:targetActivity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".cleanarchitecture.presentation.SplashActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity-alias</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Wie die Erfahrung zeigt, ist es besser, mit kleineren kleinen Bildschirmen und Teilen der Anwendung mit dem Refactoring zu beginnen.  Und wenn es Zeit ist, den komplexesten und umfangreichsten Teil des Programms zu verarbeiten, wird ein betr√§chtlicher Teil des Codes bereits f√ºr andere Module geschrieben und kann wiederverwendet werden. <br><br>  Au√üerdem hatten wir dann eine gro√üe Aufgabe, die Anwendung komplett neu zu gestalten, was zeitweise zu einem vollst√§ndigen Umschreiben der Bildschirme f√ºhrte.  Wir haben zun√§chst die Zusatzbildschirme verbessert und uns darauf vorbereitet, mit der Hauptsache fortzufahren. <br><br>  Nachdem wir den n√§chsten Teil der Anwendung neu geschrieben hatten, suchten wir im alten Teil der Anwendung nach Codeabschnitten und markierten sie mit @ Veralteten Anmerkungen und Analoga davon: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/VitalyNikonorov/UsefulAnnotation</a> .  In ihnen haben wir angegeben, was beim Umschreiben dieses Teils des Programms zu tun ist, welche Funktionen und wo es implementiert ist. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * This class deprecated, you have to use * com.project.company.cleanarchitecture.utils.ResourceUtils * for new refactored classes */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Deprecated</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceHelper</span></span></span><span class="hljs-class"> </span></span>{...}</code> </pre> <br>  Nachdem alles bereit war, auf dem Hauptbildschirm zu arbeiten, beschlossen sie, 6-8 Wochen lang keine neuen Funktionen zu ver√∂ffentlichen.  Wir haben in unserer eigenen Niederlassung ein globales Umschreiben durchgef√ºhrt, zu dem wir dann Zusammenf√ºhrungsanforderungen hinzugef√ºgt haben.  Am Ende des Refactorings erhielten sie die begehrte Pull-Anfrage und eine fast vollst√§ndig aktualisierte Anwendung. <br><img src="https://habrastorage.org/getpro/habr/post_images/1eb/062/3a2/1eb0623a2c56f5c26cc0d67925541049.png" width="500"><br>  Nach dem Refactoring wurden √Ñnderungen an der Funktionalit√§t der Anwendung viel einfacher.  So haben wir uns k√ºrzlich wieder mit der Bearbeitung von Autorisierungsbildschirmen besch√§ftigt. <br><br>  Anfangs sahen sie wie folgt aus: <br><br><img src="https://habrastorage.org/webt/1o/c1/7c/1oc17clds4-xv0qli25p5c8klqo.png"><br><br>  Nach der ersten Verarbeitung und Umgestaltung sahen sie folgenderma√üen aus: <br><br><img src="https://habrastorage.org/webt/cn/xn/00/cnxn00lr34u_gaj889l2uyzwwgi.png"><br><br>  Jetzt sehen sie so aus: <br><br><img src="https://habrastorage.org/webt/x-/bi/wc/x-biwc7n6mtpg4y2jj5gdfpfpkg.png"><br><br>  Infolgedessen dauerte die erste Iteration mehr als doppelt so lange wie die zweite.  Da ich zus√§tzlich zur Verarbeitung der Benutzeroberfl√§che den an derselben Stelle befindlichen Gesch√§ftslogikcode verstehen musste, war dies zwar nicht erforderlich, der Fehler wurde jedoch behoben, wodurch sich die f√ºr die Aufgabe in der zweiten Iteration aufgewendete Zeit verringerte. <br><br>  Was haben wir im Moment? <br><br>  Um den Code f√ºr die zuk√ºnftige Verwendung und Entwicklung bequem zu machen, halten wir uns an das Prinzip der "sauberen Architektur".  Ich w√ºrde nicht sagen, dass wir Canonical Clean haben, aber wir haben viele Ans√§tze gew√§hlt.  Die Pr√§sentationsebene wird mit dem MVP-Muster (Model-View-Presenter) geschrieben. <br><br><ul><li>  Zuvor mussten wir jeden Schritt endlos miteinander diskutieren, um zu kl√§ren, ob sich die √Ñnderung in einem Modul auf die Funktionalit√§t eines anderen auswirkt.  Und jetzt ist der Aufwand f√ºr Korrespondenz erheblich gesunken. </li><li>  Aufgrund der Vereinheitlichung einzelner Komponenten und Fragmente hat sich das Volumen der Codebasis stark verringert. </li><li>  Aufgrund der gleichen Vereinheitlichung und Verarbeitung der Architektur gibt es viel mehr Klassen, aber jetzt gibt es eine klare Aufteilung der Verantwortlichkeiten in ihnen, was das Verst√§ndnis des Projekts vereinfacht. </li><li>  Die Codebasis ist in Schichten unterteilt, f√ºr deren Trennung und Interaktion wird das Abh√§ngigkeitsinjektions-Framework Dolch 2 verwendet. Dies verringert die Koh√§renz des Codes und erh√∂ht die Testgeschwindigkeit. </li></ul><br>  Es gibt viele weitere interessante Punkte im Zusammenhang mit dem Refactoring von Legacy-Code.  Wenn die Leser interessiert sind, werde ich beim n√§chsten Mal mehr dar√ºber schreiben.  Ich w√ºrde mich auch freuen, wenn Sie auch Ihre Erfahrungen teilen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de416331/">https://habr.com/ru/post/de416331/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de416319/index.html">Hintergrund: IMEI- und Rossvyaz-Whitelists</a></li>
<li><a href="../de416321/index.html">Wie man ein Sprecher internationaler IT-Konferenzen wird</a></li>
<li><a href="../de416323/index.html">Die Option des wahlfreien Zugriffs auf die Einstellungen und Aufzeichnungen des Autokennzeichners von √ºberall im Internet</a></li>
<li><a href="../de416327/index.html">Was ist neu am neuen Standard 802.11ax (High Efficiency WLAN) und wann muss darauf gewartet werden?</a></li>
<li><a href="../de416329/index.html">Die R√ºckkehr der sowjetischen interplanetaren Station. Vorl√§ufige Prognose</a></li>
<li><a href="../de416333/index.html">New Wave: Warum die Wasserk√ºhlung im Rechenzentrum immer beliebter wird</a></li>
<li><a href="../de416335/index.html">Ein kleiner R√ºckblick auf die QCon 2018</a></li>
<li><a href="../de416339/index.html">Ethereum Account and Contract Ownership Guide</a></li>
<li><a href="../de416341/index.html">Wie wir Bewertungen, Eink√§ufe und Reisen vor Betr√ºgern sch√ºtzen</a></li>
<li><a href="../de416343/index.html">Woher kamen die neuronalen Netze und was passiert jetzt?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>