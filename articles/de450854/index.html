<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔪 🥖 🙋🏾 Erfahrung in der Entwicklung eines Unity-Assets zur Suche nach einem Pfad im 3D-Raum 👨🏻‍🍳 👨🏿‍🤝‍👨🏽 🚓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Willkommen im Graceful Algorithms Team! 

 Als Experiment haben wir beschlossen, „Tagebücher“ von Entwicklern zu führen, in denen wir Erfahrungen aust...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erfahrung in der Entwicklung eines Unity-Assets zur Suche nach einem Pfad im 3D-Raum</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450854/">  Willkommen im Graceful Algorithms Team! <br><br>  Als Experiment haben wir beschlossen, „Tagebücher“ von Entwicklern zu führen, in denen wir Erfahrungen austauschen und einige interessante Ergebnisse unserer Experimente hervorheben werden.  Dies ist unser Debütartikel zum "Pathfinder 3D" -Projekt - eine Bereicherung für die Unity-Spiel-Engine, mit der Sie nach Pfaden im dreidimensionalen Raum suchen können.  Darin werden wir über den Weg vom Ursprung der Idee zu einem vollwertigen Produkt und über einige der Probleme sprechen, auf die wir gestoßen sind.  Dieses Material ist nützlich für Personen, die ihr Projekt starten und in Zukunft unterstützen möchten, sowie für Personen, die eine Suche nach einem Pfad im Weltraum durchführen möchten. <br><a name="habracut"></a><br>  Ein Team von zwei Personen begann mit der Arbeit an dem Vermögenswert.  Der erste hatte einige Entwicklungen, die es ermöglichten, den kürzesten Weg in komplexen Graphen so schnell wie möglich zu finden, um in Echtzeit zu arbeiten, und den Wunsch, eine praktische Anwendung für sie zu finden. Der zweite hatte einige Erfahrungen mit Unity und suchte nach einer Idee für ein Startup.  Da sie oft miteinander kommunizierten, ist es nicht verwunderlich, dass irgendwann die Idee entstand, einen Vermögenswert für die Suche nach einem Pfad im dreidimensionalen Raum zu schaffen. <br><br>  Bei der Untersuchung des Unity-Asset-Katalogs wurden viele Lösungen gefunden, um den Pfad im zweidimensionalen Raum zu finden, nicht jedoch im dreidimensionalen.  Es wurde deutlich, dass dies eine großartige Gelegenheit war, in den Markt für Unity-Software-Add-Ons einzusteigen, insbesondere angesichts der Sichtbarkeit und Unterhaltung des erwarteten Ergebnisses. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sl/g0/mm/slg0mmebuga20hyrv4hiic-j2ho.jpeg"></div><br>  Ziel war es, die Suche nach einem Pfad im dreidimensionalen Raum und die typischen Fähigkeiten bestehender Lösungen zum Auffinden eines Pfades im zweidimensionalen Raum direkt zu implementieren.  Wir begannen zu arbeiten: Einer entwickelte direkt den Pfadsuchmechanismus, die zweiten Klassen und Methoden zur Verwaltung des Pfadsuchprozesses, Konfigurationsschnittstellen, Testszenen, Dokumentation und den Projektstandort und war auch an der Registrierung und Einrichtung von Servicekonten beteiligt, die für den Verkauf des Assets erforderlich sind. <br><br>  Kurz nach Arbeitsbeginn wurde klar, dass das Team einige gemeinsame Ressourcen benötigt, um sich Notizen zu machen: eine Liste der Aufgaben und Probleme, die gelöst werden mussten, Informationen über die getroffenen Entscheidungen, Ideen und Forschungsergebnisse, die für die Zukunft interessant waren.  Nachdem wir die vorhandenen Lösungen analysiert hatten, stoppten wir bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Trello</a> aufgrund seiner Funktionalität, Einfachheit, Bequemlichkeit und eines angenehmen Erscheinungsbilds.  Wie die Praxis gezeigt hat, ist dieser Service für kleine Teams sehr praktisch.  Wenn das Team mehr als 5 Personen hat, empfehlen wir die Verwendung eines vollwertigen Projektmanagementsystems. <br><br>  Als Nächstes beschreiben wir die Entscheidungen, die während der Entwicklung der ersten Version des Assets getroffen wurden, und die Logik, die wir bei ihrer Entscheidung befolgt haben.  Menschen, die Erfahrung mit Unity haben und mit Wegfindungsalgorithmen vertraut sind, werden sofort verstehen, wo in Zukunft Probleme auftreten werden.  An diesen Stellen haben wir eine einfache Lösung verwendet, um die Entwicklungszeit bis zum Eingang der ersten funktionierenden Version des Assets zu verkürzen und nicht ins Stocken zu geraten, da die Begeisterung begrenzt und unbeständig ist.  Daher haben wir uns mit einem der häufigsten Gründe für die Schließung solcher Startups befasst, aufgrund derer viele Projekte sterben, ohne geboren zu werden.  Alle Problembereiche wurden nach Veröffentlichung des Vermögenswerts korrigiert. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jk/ri/sp/jkrisph5ng_tz1slmdzfttxdoie.gif"></div><br>  Um den Pfad zu finden, wurde der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">A *</a> -Algorithmus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">(A-Stern)</a> aufgrund seiner hohen Betriebsgeschwindigkeit in großen offenen Räumen gewählt.  Die meisten Pfadsuchalgorithmen arbeiten mit Graphen, die durch eine diskrete Matrix dargestellt werden.  Es wäre möglich, diese Matrix im Voraus zu konstruieren, aber der einmalige Prozess ihrer Konstruktion im dreidimensionalen Raum mit Hindernissen sah diese Zeit als ziemlich schwierige Aufgabe an.  Darüber hinaus war nicht klar, wie dies ohne Leistungseinbußen zu tun ist, da zum Zeitpunkt des Beginns der Arbeit an dem Asset keine Erfahrung mit Hintergrundprozessen und Multithreading in Unity sowie mit Multithreading im Allgemeinen vorhanden war.  Der Graph wurde in Echtzeit erstellt, indem der Raum mit physikalischen Strahlen (Physics.BoxCast) in Suchrichtung untersucht wurde.  Die gefundenen Trajektorien wurden auf gebrochene mit weniger Zwischenpunkten reduziert und dann durch Splines geglättet. <br><br>  Die Hauptschwierigkeit war die Unmöglichkeit, die physikalischen Methoden der Engine asynchron zu verwenden, da sie ausschließlich im Haupt-Thread arbeiten können.  Bei nicht zu komplexen Szenen hatte die gleichzeitige Verwendung der Suchfunktion durch nicht mehr als zwanzig Agenten keinen signifikanten Einfluss auf die Bildrate.  Um seltene starke FPS-Verluste zu vermeiden, wurde die Rechenlast mithilfe von Coroutinen zeitlich verteilt.  Dies verlangsamte die Suche, jedoch nicht wesentlich. <br><br>  Bevor Sie ein Asset zur Moderation einreichen, müssen Sie den Code ordnen und eine detaillierte Dokumentation gemäß den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anforderungen</a> erstellen, Support-E-Mails registrieren und konfigurieren.  Es ist auch ratsam, eine Projektwebsite zu erstellen, auf der Entwicklungsnachrichten und Demos bequem angezeigt werden.  Dies ist sowohl während der Moderation als auch bei der Untersuchung Ihres Vermögens durch den Benutzer vor dem Kauf ein großes Plus.  Hosting- und Postdienste wurden von uns bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BeGet bestellt</a> , da es zu diesem Zeitpunkt die günstigsten Angebote bot und uns 1000 R / Jahr kostete. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7u/h4/7q/7uh47qdtjz_vkhribjsh19_xcc8.png"></div><br>  Die Asset-Moderation dauerte 22 Tage und verlief zum ersten Mal, da wir uns sehr sorgfältig mit der Dokumentation und dem Design der Asset-Seite im Unity Store befasst haben.  Nach der Veröffentlichung fiel das Asset sofort auf den ersten Platz in der Kategorie Scripting / AI.  Von diesem Moment an gingen Briefe an die Support-Mail, in denen um Hilfe bei der Lösung bestimmter Probleme gebeten wurde.  Manchmal ein paar pro Tag, manchmal nicht einen Monat.  Wenn Sie durchschnittlich sind, dann haben 2 Personen einen Monat lang Fragen gestellt, deren Korrespondenz insgesamt 2-3 Stunden dauerte.  Nicht so sehr, aber es sollte bedacht werden, dass Sie unabhängig von Ihrer aktuellen Arbeitsbelastung sehr schnell reagieren müssen, damit verärgerte Benutzer keine schlechten Bewertungen über das Produkt schreiben, sondern im Gegenteil, wenn Sie von Qualitätsunterstützung begeistert sind, positive hinterlassen.  Außerdem werden viele Fragen an die E-Mail gestellt, z. B. "Funktioniert Ihr Asset, wenn ...".  Solche Briefe sollten auch nicht ignoriert werden, da dies ein potenzieller Käufer ist, der gehen kann. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x8/3b/kd/x83bkdcsm3bxsxmeor0yhe8xij0.jpeg"></div><br>  Als Beschwerden von Erstkäufern eingingen, wurde klar, dass viele Benutzer Assets für komplexe Szenen verwenden, die die Konfiguration eines Labyrinths oder eines anderen verbundenen Hohlraums haben.  In solchen Projekten war unser Pfadfindungsschema, das auf Kollisionsprüfungen und sogar im Hauptstrom basiert, nicht effektiv genug.  Aus diesem Grund haben wir mit der Implementierung der frühen Konstruktion des Diagramms begonnen, damit der Pfad im Seitenstrom gesucht werden kann, ohne Physik zu verwenden und auf Szenenobjekte zuzugreifen. <br><br>  Die Diskretisierung des dreidimensionalen Raums zerlegt ihn in Würfel.  Das Speichern von Informationen zu allen Partitionswürfeln ist redundant und sehr speicherintensiv.  Daher ist es logisch, nur die Koordinaten unpassierbarer Zellen zu speichern, was getan wurde. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2k/kl/5p/2kkl5pn7lgswpe_7bwixkioulpw.jpeg"></div><br>  Spielhindernisse sind polygonale Figuren und bestehen aus Dreiecken.  Um Hindernisse im Suchdiagramm zu berücksichtigen, müssen Sie alle Würfel der Partition finden, die ein Dreieck eines Hindernisses schneiden.  Bereits zu diesem Zeitpunkt wurde die Möglichkeit geschaffen, Hindernisse dynamisch zu entfernen und der Bühne hinzuzufügen, und es wurden nicht nur die Koordinaten der besetzten Würfel gespeichert, sondern auch die Kennungen der darin enthaltenen Hindernisse.  Jetzt ist es möglich, vor Beginn des Spielprozesses ein Navigationsdiagramm zu erstellen. Aufgrund der Eliminierung einer großen Anzahl komplexer Berechnungen bei der Suche nach einem Pfad können mehr als zweihundert Agenten es gleichzeitig erstellen, ohne die Leistung zu beeinträchtigen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6o/yn/bd/6oynbdbckmzfhtzu289blvzhqcu.jpeg"></div><br>  Ein weiteres uns bekanntes Problem machte sich ebenfalls bemerkbar: Der A * -Algorithmus und seine Modifikationen funktionieren auf engstem Raum in Hochleistungsgraphen äußerst schlecht.  Da ihr Algorithmus die Richtung der Route zur Annäherung an den Zielpunkt bevorzugt, verlangsamte jeder zum Ziel führende Deadlock die Suche nach dem Pfad erheblich, da der Algorithmus vor der Wahl einer anderen Richtung der „Keimung“ zunächst den gesamten Raum innerhalb der Sackgasse „ausfüllt“. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ff/ph/is/ffphis2un_0wdpsehrnwra1fiha.gif"></div><br>  In solchen Situationen erweist sich der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wellensuchalgorithmus (Lee-Algorithmus)</a> aufgrund der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">geringeren Anzahl von Operationen, die</a> erforderlich sind, um den Raum zu „füllen“, als sehr effektiv.  Daher wurde es alternativ zum Vermögenswert hinzugefügt.  Beim Testen auf einer Bühne, die ein Labyrinth ist, wurde die Suchzeit für den Pfad um mehr als das 30-fache reduziert. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eq/lt/nd/eqltndonsivsvukp1t6lhn_awmo.jpeg"></div><br>  Um die vorläufige Verarbeitung der Szene zu beschleunigen und den Pfad zum Asset zu finden, wurde die Möglichkeit der parallelen Ausführung von Prozessen hinzugefügt. Die Parallelitätseffizienz war jedoch äußerst gering, da bei der Arbeit mit einem Container, in dem die Koordinaten der belegten Zellen gespeichert sind, die Flüsse synchronisiert werden müssen, die mithilfe von ausgeführt wurden Mutexe, da wettbewerbsfähige Sammlungen und viele andere Tools zur Gewährleistung einer effizienten Synchronisierung nur im .NET Framework 4.5-Standard und in Unity implementiert wurden, wurde die .NE-Version bis zur Version 2018 verwendet.  T Framework 3.5.  Wir haben versucht, dieses Problem mit den verfügbaren Tools zu lösen, aber sie hatten eine sehr mittelmäßige Leistung und wir haben das gewünschte Ergebnis erst nach dem Wechsel zur Unity-Version 2018 erhalten.  Die Verwendung wettbewerbsfähiger Sammlungen eröffnete auch die Möglichkeit, den dynamischen Wandel der Hindernisse in der Szene zu realisieren. <br><br>  Zu einem bestimmten Zeitpunkt kam es im Team zu Meinungsverschiedenheiten hinsichtlich der Gewinnverteilung, und eine dritte Person trat dem Team bei, die ein System zur Bewertung des Zeitaufwands jedes Teammitglieds einführte und sich auch mit Code-Inspektionen und -Tests befasste, wodurch die Qualität des Produkts erheblich verbessert wurde. <br><br>  Das derzeitige System zur Schätzung der Zeitkosten wird in Form einer Excel-Tabelle erstellt und ist ein automatisiertes System, bei dem einmal im Monat Informationen zu Verkäufen und Aufgaben eingegeben werden müssen, die im letzten Monat ausgeführt wurden.  Die Teammitglieder müssen bewerten, wie viel Zeit sie zur Lösung eines bestimmten Problems benötigen würden.  Bei der Beurteilung der zeitlichen Komplexität von Aufgaben wird daher die Geschwindigkeit jedes Teilnehmers berücksichtigt.  Eine abnormale Überschätzung oder Untertreibung durch einen der Teilnehmer wird sofort aus den gesammelten Statistiken seiner früheren Bewertungen ersichtlich.  In Ermangelung einer zufriedenstellenden Erklärung wird dieses Problem vom gesamten Team entschieden.  Dieser Ansatz erwies sich für sechs Monate als gut und ermöglichte es, interessante Statistiken zu sammeln.  Wir haben keine fertige kostenlose Lösung gefunden, die die beschriebenen Funktionen bietet.  Für kleine Teams erscheint uns daher die Implementierung in Form von Excel-Tabellen derzeit optimal.  Bei relativ großen Teams müssen Sie höchstwahrscheinlich Ihre Datenbank entwerfen, den Serverteil und den Client entwickeln oder eine Erweiterung für eines der vorhandenen Projektmanagementsysteme implementieren. <br><br>  <strong>Zusammenfassend.</strong>  Seit Beginn der Entwicklung ist ein Jahr bis zur ersten Version mit der minimal erforderlichen Funktionalität und ausreichenden Leistung für den Einsatz in realen Projekten vergangen.  Weitere sechs Monate wurden für die Verbesserung der Leistung und die Implementierung von Multithread-Arbeiten des Assets aufgewendet.  Derzeit haben wir die Zeitkosten für dieses Projekt auf 1065 Mannstunden geschätzt (dies ist eine eher optimistische Schätzung), und der durchschnittliche Gewinn für den Monat beträgt 9,5 t.  Es ist leicht zu berechnen, dass die durchschnittlichen Kosten einer Arbeitsstunde derzeit etwa 160 Rubel betragen, was nicht so viel ist.  Die Hauptsache bei dieser Veranstaltung ist jedoch die Erfahrung, die jeder Teilnehmer gesammelt hat.  Einschließlich Teamwork-Erfahrung und Erfahrung im Support von Softwareprodukten.  Das Projekt kann als erfolgreich angesehen werden. <br><br>  Jetzt hat unser Team begonnen, zusätzliche nützliche Funktionen zu implementieren: Überprüfung der algorithmischen Erreichbarkeit;  die Fähigkeit, Spielobjekte Portalen zuzuweisen;  dynamische Hindernisunterstützung;  Lokale Navigation zwischen Agenten, um Kollisionen zu vermeiden und lokale Routen zu planen. <br><br>  Wir hoffen, dass dieses Material jemandem hilft, sein Projekt ins Ziel zu bringen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450854/">https://habr.com/ru/post/de450854/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450840/index.html">Die letzte Taschenlampe ist müde oder wird das Flackern Weißrussland retten (upd. Spinner?)</a></li>
<li><a href="../de450844/index.html">Einführung in die Beispielzuordnung</a></li>
<li><a href="../de450846/index.html">Die Wunder der Verpackung von Microsoft: der Linux-Kernel in Windows 10 und die IE-Engine in Chromium Edge</a></li>
<li><a href="../de450848/index.html">Über gelben Phosphor und die Panik des Menschen</a></li>
<li><a href="../de450850/index.html">Auf dem Weg zu einer besseren Zukunft für intelligente Compiler</a></li>
<li><a href="../de450858/index.html">Open Source Networking-Treffen - jetzt in Yandex.Cloud # 3.2019</a></li>
<li><a href="../de450860/index.html">Smart Sockel REDMOND SkyPort 100S</a></li>
<li><a href="../de450862/index.html">@ Pythonetc April 2019</a></li>
<li><a href="../de450864/index.html">Tipps und Tricks von meinem Telegramm-Kanal @pythonetc, April 2019</a></li>
<li><a href="../de450868/index.html">Videoberichte vom FunTech QA-Automation Meetup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>