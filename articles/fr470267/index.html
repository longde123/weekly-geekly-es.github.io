<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🚒 ☯️ 👨🏿‍🤝‍👨🏼 Surveillance de température certifiée 🖍️ 🥑 🤙🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Notre entreprise utilise un système de gestion de la qualité (SMQ). Dans le cadre de l'une des certifications ISO: 9001, il a été ordonné de collecter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Surveillance de température certifiée</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470267/">  Notre entreprise utilise un système de gestion de la qualité (SMQ).  Dans le cadre de l'une des certifications ISO: 9001, il a été ordonné de collecter des relevés de température et d'humidité dans certaines pièces, par exemple dans la salle des serveurs ou dans les entrepôts. <br><br>  Parce que  Étant donné que toutes les procédures bureaucratiques nécessitent des morceaux de papier, la collecte des données doit être effectuée par un appareil vérifié. <br><br>  À cet égard, l'hygromètre le plus courant a été pendu et pendant plusieurs années, des gens ont écrit des preuves quotidiennes dans un journal.  D'accord, mal à l'aise. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jj/9j/ct/jj9jctuhgtvzcrraj130gdtlvw8.jpeg"></div><a name="habracut"></a><br>  Afin d'automatiser cette procédure, la recherche d'un appareil pour collecter la température et l'humidité a été lancée. <br><br>  L'objectif était de collecter les données et de les transférer vers Zabbix.  (Zabbix, aucun emplacement de stockage n'est requis pour le QMS, mais je ne voulais pas créer un autre système distinct pour la surveillance de la température). <br><br>  En principe, il y avait de nombreux kits prêts à l'emploi pour cela, par exemple Equicom PING3 ou netping, et il y a encore un tas de tels exemples, vous pouvez également construire votre système sur arduino ou raspeberry, <br>  mais toutes ces options ne convenaient pas, car  tous n'ont pas de certification, ou plutôt de vérification métrologique, et ne peuvent donc pas être considérés comme des instruments de mesure officiels et ne conviennent pas pour passer ISO: 9001. <br><br>  En conséquence, un appareil a été trouvé capable de transmettre des données via Ethernet et inclus dans le registre des instruments de mesure.  Il s'est avéré être "Ivit-M.E".  développé à Novossibirsk, également produit là-bas.  Commandé (en passant, la commande prend beaucoup de temps. Le délai de production est d'environ un mois, plus la vérification, plus la livraison à Moscou). <br><br>  Tout cela se présente sous cette forme.  Lorsque vous le ramassez, vous réalisez immédiatement qu'il s'agit d'une production russe :-) <br><br><img src="https://habrastorage.org/webt/9u/jk/mm/9ujkmmy75n9dcyue1iooepwvjy0.jpeg"><br><br><img src="https://habrastorage.org/webt/i3/vz/qw/i3vzqwl5ma_-zf8drk3wqcfgwdk.jpeg"><br><br>  L'alimentation (commandée séparément) n'est pas connectée au capteur. <br><br>  Par conséquent, nous le démontons et commençons à nous connecter. <br><br><img src="https://habrastorage.org/webt/rv/qj/my/rvqjmyg8w6aa-xh0_ikm2lyjcao.jpeg"><br><br><img src="https://habrastorage.org/webt/if/hj/f_/ifhjf_9isaqmdaxdb67aa7qwxaw.jpeg"><br><br>  Nous connectons quand même l'entrée.  Courant alternatif.  J'ai utilisé un câble d'alimentation ordinaire à partir d'un ordinateur. <br><br>  La sortie est en courant continu.  Le plus et le moins sont signés directement sur le tableau. <br><br>  Ensuite, nous connectons les fils directement au capteur lui-même.  Selon les instructions <br><br><img src="https://habrastorage.org/webt/xb/qx/us/xbqxusu7jvesq9svw960mq-pd5k.jpeg"><br><br>  Les terminaux eux-mêmes ressemblent à ceci: <br><br><img src="https://habrastorage.org/webt/s8/tk/r6/s8tkr6huza-zgrm1eabxt5y5n5y.jpeg"><br><br><img src="https://habrastorage.org/webt/ur/xr/3d/urxr3disznpftdmba3jsqxrwigc.jpeg"><br><br>  Éteignez, retirez et retirez la doublure de la moitié en forme de L. <br>  Nous connectons l'alimentation et le réseau. <br><br><img src="https://habrastorage.org/webt/bs/xn/ca/bsxncadqz9e4jtpmjazgquvdup4.jpeg"><br><br>  Le résultat est quelque chose comme ceci: <br><br><img src="https://habrastorage.org/webt/et/pc/4z/etpc4zrfp4w8dmow-d5xczmdzoi.jpeg"><br><br>  Parmi les inconvénients de cet appareil - il ne sait pas comment envoyer des données via SNMP, il fonctionne en utilisant le protocole Modbus. <br><br>  En principe, il existe de nombreux systèmes SCADA et serveurs OPC qui peuvent lire via Modbus, mais la plupart d'entre eux sont soit payés, soit collectés dans une base de données qui leur est propre, d'où il n'est pas clair non plus comment extraire des données pour les transmettre aux futurs zabbiks. <br><br>  Par conséquent, un petit script python a été écrit pour accéder directement au capteur. <br>  Les données dans les registres sont stockées sous forme de flottant et arrivent lors de leur accès sous cette forme <br><br><pre><code class="plaintext hljs">READ_INPUT_REGISTERS (16855, 57976)</code> </pre> <br>  Pour configurer le capteur, il existe une application config-ivit.exe <br><br>  Il n'y a pas beaucoup de paramètres là-bas.  Vous pouvez configurer le réseau, le courrier. <br><br><img src="https://habrastorage.org/webt/mi/ru/43/miru43odnhhe8akvavumircfave.jpeg"><br><br>  dans le configurateur, les registres sont spécifiés dans le système hexadécimal, mais dans le script Python, vous devez spécifier les registres dans le système à 10 décimales. <br><br>  Nous amenons les données sous une forme lisible normale selon la norme ieee-754. <br><br>  Il existe deux façons de mettre en œuvre le transfert des données reçues du script vers le zabbix. <br><br>  La première façon: en utilisant userparametr, sur un nœud où l'agent python et zabbiks est installé.  Par exemple, j'avais sur le serveur zabbix lui-même. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.defines <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cst <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_reg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reg,ip)</span></span></span><span class="hljs-function">:</span></span> reg = int(reg) master = modbus_tcp.TcpMaster(host=ip, port=int(<span class="hljs-number"><span class="hljs-number">502</span></span>)) master.set_timeout(<span class="hljs-number"><span class="hljs-number">1.0</span></span>) getDI = master.execute(<span class="hljs-number"><span class="hljs-number">1</span></span>,cst.READ_INPUT_REGISTERS, reg, <span class="hljs-number"><span class="hljs-number">2</span></span>) Num1 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">0</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num1) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num1 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num1 Num2 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">1</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num2) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num2 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num2 res = Num1 + Num2 znak = int(res[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) znak2 = (<span class="hljs-number"><span class="hljs-number">0</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) ** znak e = int(res[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) - <span class="hljs-number"><span class="hljs-number">127</span></span> exp = <span class="hljs-number"><span class="hljs-number">2</span></span> ** e m = <span class="hljs-number"><span class="hljs-number">1</span></span> + (int(res[<span class="hljs-number"><span class="hljs-number">9</span></span>:], <span class="hljs-number"><span class="hljs-number">2</span></span>) / float(<span class="hljs-number"><span class="hljs-number">2</span></span> ** <span class="hljs-number"><span class="hljs-number">23</span></span>)) F = znak2 * exp * m print(round(F, <span class="hljs-number"><span class="hljs-number">1</span></span>)) check_reg(sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>],sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>])</code> </pre><br>  Du côté du zabbix dans zabbix_agentd.conf, spécifiez: <br><br><pre> <code class="plaintext hljs">UserParameter=check_reg[*], /usr/bin/python /home/appliance/scada.py $1 $2</code> </pre> <br>  Dans le zabbix lui-même, nous devrons transférer uniquement le numéro de registre et l'adresse IP de l'appareil auquel nous voulons contacter: <br><br>  par exemple: <code>check_reg[22,192.168.100.100]</code> <br><br>  Numéros d'enregistrement: <br><br>  22 - Humidité <br>  34 - Température <br>  36 - point de rosée <br><br>  La deuxième façon: passer des valeurs via zabbix_sender.  Cette méthode est pratique dans la mesure où vous pouvez créer un nœud de réseau distinct qui ne possède pas d'agent et, par conséquent, il sera possible de créer un modèle pour de nombreux périphériques. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.defines <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cst <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys, os <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_reg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reg,ip)</span></span></span><span class="hljs-function">:</span></span> reg = int(reg) master = modbus_tcp.TcpMaster(host=ip, port=int(<span class="hljs-number"><span class="hljs-number">502</span></span>)) master.set_timeout(<span class="hljs-number"><span class="hljs-number">1.0</span></span>) getDI = master.execute(<span class="hljs-number"><span class="hljs-number">1</span></span>,cst.READ_INPUT_REGISTERS, reg, <span class="hljs-number"><span class="hljs-number">2</span></span>) Num1 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">0</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num1) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num1 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num1 Num2 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">1</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num2) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num2 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num2 res = Num1 + Num2 znak = int(res[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) znak2 = (<span class="hljs-number"><span class="hljs-number">0</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) ** znak e = int(res[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) - <span class="hljs-number"><span class="hljs-number">127</span></span> exp = <span class="hljs-number"><span class="hljs-number">2</span></span> ** e m = <span class="hljs-number"><span class="hljs-number">1</span></span> + (int(res[<span class="hljs-number"><span class="hljs-number">9</span></span>:], <span class="hljs-number"><span class="hljs-number">2</span></span>) / float(<span class="hljs-number"><span class="hljs-number">2</span></span> ** <span class="hljs-number"><span class="hljs-number">23</span></span>)) F = znak2 * exp * m <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> round(F, <span class="hljs-number"><span class="hljs-number">1</span></span>) os.system(<span class="hljs-string"><span class="hljs-string">'zabbix_sender -z 127.0.0.1 -s '</span></span>+ sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]+<span class="hljs-string"><span class="hljs-string">' -k Humidity -o '</span></span>+ str(check_reg(<span class="hljs-number"><span class="hljs-number">22</span></span>,sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]))) os.system(<span class="hljs-string"><span class="hljs-string">'zabbix_sender -z 127.0.0.1 -s '</span></span>+sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]+<span class="hljs-string"><span class="hljs-string">' -k Temper -o '</span></span>+ str(check_reg(<span class="hljs-number"><span class="hljs-number">34</span></span>,sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]))) os.system(<span class="hljs-string"><span class="hljs-string">'zabbix_sender -z 127.0.0.1 -s '</span></span>+sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]+<span class="hljs-string"><span class="hljs-string">' -k Rosa -o '</span></span>+ str(check_reg(<span class="hljs-number"><span class="hljs-number">36</span></span>,sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>])))</code> </pre><br>  Il ne reste plus qu'à exécuter ce script à exécuter sur la couronne, en spécifiant uniquement l'adresse IP des périphériques et le nom d'hôte de l'hôte <br><br><pre> <code class="plaintext hljs">*/1 * * * * /home/ivitsender.py 192.168.100.100 Ivit1</code> </pre> <br><pre> <code class="plaintext hljs">*/1 * * * * /home/ivitsender.py 192.168.100.200 Ivit2</code> </pre> <br><br>  Ensuite, configurez les déclencheurs, qui sont considérés comme critiques pour nous.  Par exemple, température minimale ou maximale, humidité. <br><br>  C’est tout.  Ainsi, nous avons obtenu un contrôle de température certifié, qui est adapté pour passer par le QMS et ISO: 9001 <br><br>  <b>UPD:</b> mise à jour du script à envoyer via l'expéditeur pour se connecter à plusieurs capteurs </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470267/">https://habr.com/ru/post/fr470267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470247/index.html">RESHI.RU - un robot résout et explique les problèmes de texte scolaire en mathématiques</a></li>
<li><a href="../fr470251/index.html">Comment j'ai fait une application de bureau sur Flutter (+ bonus)</a></li>
<li><a href="../fr470255/index.html">Optimisation du portefeuille obligataire avec ALGLIB</a></li>
<li><a href="../fr470259/index.html">Aimybox dans la recherche: le cadre pour créer des assistants vocaux a besoin d'un assistant iOS</a></li>
<li><a href="../fr470265/index.html">Aide-mémoire de l'abréviation C ++ et plus encore. Partie 1: C ++</a></li>
<li><a href="../fr470269/index.html">ReactOS 0.4.12: 华为 ， 你 认为 这个 怎么 样？</a></li>
<li><a href="../fr470271/index.html">F # 6: Tuples</a></li>
<li><a href="../fr470273/index.html">F # 7: Records</a></li>
<li><a href="../fr470275/index.html">F # 8: Syndicats discriminés</a></li>
<li><a href="../fr470277/index.html">Comment le réseau mondial de la Fédération de Russie est-il organisé et organisé?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>