<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüöí ‚òØÔ∏è üë®üèø‚Äçü§ù‚Äçüë®üèº Surveillance de temp√©rature certifi√©e üñçÔ∏è ü•ë ü§ôüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Notre entreprise utilise un syst√®me de gestion de la qualit√© (SMQ). Dans le cadre de l'une des certifications ISO: 9001, il a √©t√© ordonn√© de collecter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Surveillance de temp√©rature certifi√©e</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470267/">  Notre entreprise utilise un syst√®me de gestion de la qualit√© (SMQ).  Dans le cadre de l'une des certifications ISO: 9001, il a √©t√© ordonn√© de collecter des relev√©s de temp√©rature et d'humidit√© dans certaines pi√®ces, par exemple dans la salle des serveurs ou dans les entrep√¥ts. <br><br>  Parce que  √âtant donn√© que toutes les proc√©dures bureaucratiques n√©cessitent des morceaux de papier, la collecte des donn√©es doit √™tre effectu√©e par un appareil v√©rifi√©. <br><br>  √Ä cet √©gard, l'hygrom√®tre le plus courant a √©t√© pendu et pendant plusieurs ann√©es, des gens ont √©crit des preuves quotidiennes dans un journal.  D'accord, mal √† l'aise. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jj/9j/ct/jj9jctuhgtvzcrraj130gdtlvw8.jpeg"></div><a name="habracut"></a><br>  Afin d'automatiser cette proc√©dure, la recherche d'un appareil pour collecter la temp√©rature et l'humidit√© a √©t√© lanc√©e. <br><br>  L'objectif √©tait de collecter les donn√©es et de les transf√©rer vers Zabbix.  (Zabbix, aucun emplacement de stockage n'est requis pour le QMS, mais je ne voulais pas cr√©er un autre syst√®me distinct pour la surveillance de la temp√©rature). <br><br>  En principe, il y avait de nombreux kits pr√™ts √† l'emploi pour cela, par exemple Equicom PING3 ou netping, et il y a encore un tas de tels exemples, vous pouvez √©galement construire votre syst√®me sur arduino ou raspeberry, <br>  mais toutes ces options ne convenaient pas, car  tous n'ont pas de certification, ou plut√¥t de v√©rification m√©trologique, et ne peuvent donc pas √™tre consid√©r√©s comme des instruments de mesure officiels et ne conviennent pas pour passer ISO: 9001. <br><br>  En cons√©quence, un appareil a √©t√© trouv√© capable de transmettre des donn√©es via Ethernet et inclus dans le registre des instruments de mesure.  Il s'est av√©r√© √™tre "Ivit-M.E".  d√©velopp√© √† Novossibirsk, √©galement produit l√†-bas.  Command√© (en passant, la commande prend beaucoup de temps. Le d√©lai de production est d'environ un mois, plus la v√©rification, plus la livraison √† Moscou). <br><br>  Tout cela se pr√©sente sous cette forme.  Lorsque vous le ramassez, vous r√©alisez imm√©diatement qu'il s'agit d'une production russe :-) <br><br><img src="https://habrastorage.org/webt/9u/jk/mm/9ujkmmy75n9dcyue1iooepwvjy0.jpeg"><br><br><img src="https://habrastorage.org/webt/i3/vz/qw/i3vzqwl5ma_-zf8drk3wqcfgwdk.jpeg"><br><br>  L'alimentation (command√©e s√©par√©ment) n'est pas connect√©e au capteur. <br><br>  Par cons√©quent, nous le d√©montons et commen√ßons √† nous connecter. <br><br><img src="https://habrastorage.org/webt/rv/qj/my/rvqjmyg8w6aa-xh0_ikm2lyjcao.jpeg"><br><br><img src="https://habrastorage.org/webt/if/hj/f_/ifhjf_9isaqmdaxdb67aa7qwxaw.jpeg"><br><br>  Nous connectons quand m√™me l'entr√©e.  Courant alternatif.  J'ai utilis√© un c√¢ble d'alimentation ordinaire √† partir d'un ordinateur. <br><br>  La sortie est en courant continu.  Le plus et le moins sont sign√©s directement sur le tableau. <br><br>  Ensuite, nous connectons les fils directement au capteur lui-m√™me.  Selon les instructions <br><br><img src="https://habrastorage.org/webt/xb/qx/us/xbqxusu7jvesq9svw960mq-pd5k.jpeg"><br><br>  Les terminaux eux-m√™mes ressemblent √† ceci: <br><br><img src="https://habrastorage.org/webt/s8/tk/r6/s8tkr6huza-zgrm1eabxt5y5n5y.jpeg"><br><br><img src="https://habrastorage.org/webt/ur/xr/3d/urxr3disznpftdmba3jsqxrwigc.jpeg"><br><br>  √âteignez, retirez et retirez la doublure de la moiti√© en forme de L. <br>  Nous connectons l'alimentation et le r√©seau. <br><br><img src="https://habrastorage.org/webt/bs/xn/ca/bsxncadqz9e4jtpmjazgquvdup4.jpeg"><br><br>  Le r√©sultat est quelque chose comme ceci: <br><br><img src="https://habrastorage.org/webt/et/pc/4z/etpc4zrfp4w8dmow-d5xczmdzoi.jpeg"><br><br>  Parmi les inconv√©nients de cet appareil - il ne sait pas comment envoyer des donn√©es via SNMP, il fonctionne en utilisant le protocole Modbus. <br><br>  En principe, il existe de nombreux syst√®mes SCADA et serveurs OPC qui peuvent lire via Modbus, mais la plupart d'entre eux sont soit pay√©s, soit collect√©s dans une base de donn√©es qui leur est propre, d'o√π il n'est pas clair non plus comment extraire des donn√©es pour les transmettre aux futurs zabbiks. <br><br>  Par cons√©quent, un petit script python a √©t√© √©crit pour acc√©der directement au capteur. <br>  Les donn√©es dans les registres sont stock√©es sous forme de flottant et arrivent lors de leur acc√®s sous cette forme <br><br><pre><code class="plaintext hljs">READ_INPUT_REGISTERS (16855, 57976)</code> </pre> <br>  Pour configurer le capteur, il existe une application config-ivit.exe <br><br>  Il n'y a pas beaucoup de param√®tres l√†-bas.  Vous pouvez configurer le r√©seau, le courrier. <br><br><img src="https://habrastorage.org/webt/mi/ru/43/miru43odnhhe8akvavumircfave.jpeg"><br><br>  dans le configurateur, les registres sont sp√©cifi√©s dans le syst√®me hexad√©cimal, mais dans le script Python, vous devez sp√©cifier les registres dans le syst√®me √† 10 d√©cimales. <br><br>  Nous amenons les donn√©es sous une forme lisible normale selon la norme ieee-754. <br><br>  Il existe deux fa√ßons de mettre en ≈ìuvre le transfert des donn√©es re√ßues du script vers le zabbix. <br><br>  La premi√®re fa√ßon: en utilisant userparametr, sur un n≈ìud o√π l'agent python et zabbiks est install√©.  Par exemple, j'avais sur le serveur zabbix lui-m√™me. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.defines <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cst <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_reg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reg,ip)</span></span></span><span class="hljs-function">:</span></span> reg = int(reg) master = modbus_tcp.TcpMaster(host=ip, port=int(<span class="hljs-number"><span class="hljs-number">502</span></span>)) master.set_timeout(<span class="hljs-number"><span class="hljs-number">1.0</span></span>) getDI = master.execute(<span class="hljs-number"><span class="hljs-number">1</span></span>,cst.READ_INPUT_REGISTERS, reg, <span class="hljs-number"><span class="hljs-number">2</span></span>) Num1 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">0</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num1) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num1 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num1 Num2 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">1</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num2) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num2 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num2 res = Num1 + Num2 znak = int(res[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) znak2 = (<span class="hljs-number"><span class="hljs-number">0</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) ** znak e = int(res[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) - <span class="hljs-number"><span class="hljs-number">127</span></span> exp = <span class="hljs-number"><span class="hljs-number">2</span></span> ** e m = <span class="hljs-number"><span class="hljs-number">1</span></span> + (int(res[<span class="hljs-number"><span class="hljs-number">9</span></span>:], <span class="hljs-number"><span class="hljs-number">2</span></span>) / float(<span class="hljs-number"><span class="hljs-number">2</span></span> ** <span class="hljs-number"><span class="hljs-number">23</span></span>)) F = znak2 * exp * m print(round(F, <span class="hljs-number"><span class="hljs-number">1</span></span>)) check_reg(sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>],sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>])</code> </pre><br>  Du c√¥t√© du zabbix dans zabbix_agentd.conf, sp√©cifiez: <br><br><pre> <code class="plaintext hljs">UserParameter=check_reg[*], /usr/bin/python /home/appliance/scada.py $1 $2</code> </pre> <br>  Dans le zabbix lui-m√™me, nous devrons transf√©rer uniquement le num√©ro de registre et l'adresse IP de l'appareil auquel nous voulons contacter: <br><br>  par exemple: <code>check_reg[22,192.168.100.100]</code> <br><br>  Num√©ros d'enregistrement: <br><br>  22 - Humidit√© <br>  34 - Temp√©rature <br>  36 - point de ros√©e <br><br>  La deuxi√®me fa√ßon: passer des valeurs via zabbix_sender.  Cette m√©thode est pratique dans la mesure o√π vous pouvez cr√©er un n≈ìud de r√©seau distinct qui ne poss√®de pas d'agent et, par cons√©quent, il sera possible de cr√©er un mod√®le pour de nombreux p√©riph√©riques. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.defines <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cst <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys, os <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_reg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reg,ip)</span></span></span><span class="hljs-function">:</span></span> reg = int(reg) master = modbus_tcp.TcpMaster(host=ip, port=int(<span class="hljs-number"><span class="hljs-number">502</span></span>)) master.set_timeout(<span class="hljs-number"><span class="hljs-number">1.0</span></span>) getDI = master.execute(<span class="hljs-number"><span class="hljs-number">1</span></span>,cst.READ_INPUT_REGISTERS, reg, <span class="hljs-number"><span class="hljs-number">2</span></span>) Num1 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">0</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num1) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num1 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num1 Num2 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">1</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num2) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num2 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num2 res = Num1 + Num2 znak = int(res[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) znak2 = (<span class="hljs-number"><span class="hljs-number">0</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) ** znak e = int(res[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) - <span class="hljs-number"><span class="hljs-number">127</span></span> exp = <span class="hljs-number"><span class="hljs-number">2</span></span> ** e m = <span class="hljs-number"><span class="hljs-number">1</span></span> + (int(res[<span class="hljs-number"><span class="hljs-number">9</span></span>:], <span class="hljs-number"><span class="hljs-number">2</span></span>) / float(<span class="hljs-number"><span class="hljs-number">2</span></span> ** <span class="hljs-number"><span class="hljs-number">23</span></span>)) F = znak2 * exp * m <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> round(F, <span class="hljs-number"><span class="hljs-number">1</span></span>) os.system(<span class="hljs-string"><span class="hljs-string">'zabbix_sender -z 127.0.0.1 -s '</span></span>+ sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]+<span class="hljs-string"><span class="hljs-string">' -k Humidity -o '</span></span>+ str(check_reg(<span class="hljs-number"><span class="hljs-number">22</span></span>,sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]))) os.system(<span class="hljs-string"><span class="hljs-string">'zabbix_sender -z 127.0.0.1 -s '</span></span>+sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]+<span class="hljs-string"><span class="hljs-string">' -k Temper -o '</span></span>+ str(check_reg(<span class="hljs-number"><span class="hljs-number">34</span></span>,sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]))) os.system(<span class="hljs-string"><span class="hljs-string">'zabbix_sender -z 127.0.0.1 -s '</span></span>+sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]+<span class="hljs-string"><span class="hljs-string">' -k Rosa -o '</span></span>+ str(check_reg(<span class="hljs-number"><span class="hljs-number">36</span></span>,sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>])))</code> </pre><br>  Il ne reste plus qu'√† ex√©cuter ce script √† ex√©cuter sur la couronne, en sp√©cifiant uniquement l'adresse IP des p√©riph√©riques et le nom d'h√¥te de l'h√¥te <br><br><pre> <code class="plaintext hljs">*/1 * * * * /home/ivitsender.py 192.168.100.100 Ivit1</code> </pre> <br><pre> <code class="plaintext hljs">*/1 * * * * /home/ivitsender.py 192.168.100.200 Ivit2</code> </pre> <br><br>  Ensuite, configurez les d√©clencheurs, qui sont consid√©r√©s comme critiques pour nous.  Par exemple, temp√©rature minimale ou maximale, humidit√©. <br><br>  C‚Äôest tout.  Ainsi, nous avons obtenu un contr√¥le de temp√©rature certifi√©, qui est adapt√© pour passer par le QMS et ISO: 9001 <br><br>  <b>UPD:</b> mise √† jour du script √† envoyer via l'exp√©diteur pour se connecter √† plusieurs capteurs </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470267/">https://habr.com/ru/post/fr470267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470247/index.html">RESHI.RU - un robot r√©sout et explique les probl√®mes de texte scolaire en math√©matiques</a></li>
<li><a href="../fr470251/index.html">Comment j'ai fait une application de bureau sur Flutter (+ bonus)</a></li>
<li><a href="../fr470255/index.html">Optimisation du portefeuille obligataire avec ALGLIB</a></li>
<li><a href="../fr470259/index.html">Aimybox dans la recherche: le cadre pour cr√©er des assistants vocaux a besoin d'un assistant iOS</a></li>
<li><a href="../fr470265/index.html">Aide-m√©moire de l'abr√©viation C ++ et plus encore. Partie 1: C ++</a></li>
<li><a href="../fr470269/index.html">ReactOS 0.4.12: Âçé‰∏∫ Ôºå ‰Ω† ËÆ§‰∏∫ Ëøô‰∏™ ÊÄé‰πà Ê†∑Ôºü</a></li>
<li><a href="../fr470271/index.html">F # 6: Tuples</a></li>
<li><a href="../fr470273/index.html">F # 7: Records</a></li>
<li><a href="../fr470275/index.html">F # 8: Syndicats discrimin√©s</a></li>
<li><a href="../fr470277/index.html">Comment le r√©seau mondial de la F√©d√©ration de Russie est-il organis√© et organis√©?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>