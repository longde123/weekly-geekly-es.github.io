<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßóüèæ üë©üèΩ‚Äçüíª üìÇ Las aventuras de los esquivos Malvari, Parte I üéÜ üë©üèΩ‚Äçü§ù‚Äçüë©üèª üóæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Con este art√≠culo, comenzamos una serie de publicaciones sobre el esquivo malvari. Los programas de pirater√≠a que no dejan marcas de ataque, tambi√©n c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Las aventuras de los esquivos Malvari, Parte I</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/varonis/blog/456440/"><img src="https://habrastorage.org/webt/t5/7j/ep/t57jepsiopn5j3zbxlikd2ago-e.jpeg"><br><br>  Con este art√≠culo, comenzamos una serie de publicaciones sobre el esquivo malvari.  Los programas de pirater√≠a que no dejan marcas de ataque, tambi√©n conocidos como sin archivos, generalmente usan PowerShell en los sistemas Windows para ejecutar comandos de forma encubierta para buscar y recuperar contenido valioso.  Detectar actividad de hackers sin archivos maliciosos es una tarea dif√≠cil, porque  los antivirus y muchos otros sistemas de detecci√≥n funcionan en funci√≥n del an√°lisis de firmas.  Pero la buena noticia es que ese software existe.  Por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sistemas UBA</a> que pueden detectar actividad maliciosa en sistemas de archivos. <br><a name="habracut"></a><br>  Cuando comenc√© a estudiar el tema de los hackers geniales que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">no usaban m√©todos tradicionales de infecci√≥n</a> , sino solo herramientas y software disponibles en la computadora de la v√≠ctima, no sospechaba que pronto se convertir√≠a en un m√©todo de ataque popular.  Los profesionales de seguridad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dicen que</a> esto se est√° convirtiendo en una tendencia, y los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">t√≠tulos de art√≠culos aterradores</a> son prueba de ello.  Por lo tanto, decid√≠ hacer una serie de publicaciones sobre este tema. <br><br><h2>  Gran y terrible PowerShell </h2><br>  Escrib√≠ sobre algunas de estas ideas anteriormente en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la serie de ofuscaci√≥n de PowerShell</a> , pero m√°s en teor√≠a.  M√°s tarde me encontr√© con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio para an√°lisis h√≠brido</a> , donde puedes encontrar muestras de malvari, "capturadas" en la naturaleza.  Decid√≠ intentar usar este sitio para buscar muestras de malware sin archivos.  Y lo hice  Por cierto, si desea realizar su propia expedici√≥n para buscar malware, tendr√° que pasar un chequeo en este sitio para que sepan que est√° haciendo el trabajo como especialista de sombrero blanco.  Como blogger que escribe sobre seguridad, lo revis√© sin dudarlo.  Estoy seguro de que t√∫ tambi√©n puedes. <br><br>  Adem√°s de las muestras en s√≠, puede ver en el sitio lo que hacen estos programas.  El an√°lisis h√≠brido lanza malware en su propia caja de arena y rastrea las llamadas del sistema, ejecuta procesos y acciones en la red, y tambi√©n extrae cadenas de texto sospechosas.  Para archivos binarios y otros ejecutables, es decir  Donde ni siquiera puede mirar el c√≥digo real de alto nivel, el an√°lisis h√≠brido decide si el software es malicioso o simplemente sospechoso en funci√≥n de su actividad en tiempo de ejecuci√≥n.  Y despu√©s de eso, la muestra ya est√° evaluada. <br><br>  En el caso de PowerShell y otros scripts de muestra (Visual Basic, JavaScript, etc.), pude ver el c√≥digo en s√≠.  Por ejemplo, me encontr√© con una instancia de PowerShell: <br><br><img src="https://habrastorage.org/webt/6l/vo/9a/6lvo9a-5fjn2damwm8vivmh2goc.jpeg"><br><br><p>  <i>Tambi√©n puede ejecutar PowerShell codificado en base64 para evitar la detecci√≥n.</i>  <i>Preste atenci√≥n al uso de par√°metros no interactivos y ocultos.</i> </p><br>  Si lees mis entradas de ofuscaci√≥n, entonces sabes que la opci√≥n -e indica que el contenido est√° codificado en base64.  Por cierto, el an√°lisis h√≠brido tambi√©n ayuda con esto, decodificando todo de nuevo.  Si desea intentar decodificar usted mismo PowerShell base64 (en adelante, PS), debe ejecutar este comando: <br><br><pre><code class="plaintext hljs">[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))</code> </pre> <br><h2>  Ir m√°s profundo </h2><br>  Decodifiqu√© nuestro script PS usando este m√©todo, el texto del programa se presenta a continuaci√≥n, aunque lo modifiqu√© un poco: <br><br><img src="https://habrastorage.org/webt/ro/ef/zi/roefzis_uwim8flbumkfqsvrvlu.jpeg"><br><p>  <i>Tenga en cuenta que el crujido estaba vinculado a la fecha del 4 de septiembre de 2017 y aprob√≥ las cookies de sesi√≥n.</i> </p><br>  Escrib√≠ sobre este estilo de ataque en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la serie de ofuscaci√≥n de PS</a> , en la que el script codificado en base64 descarga el malware <i>faltante</i> de otro sitio, usando el objeto WebClient de la biblioteca .Net Framework para hacer todo el trabajo duro. <br><br>  ¬øPara qu√© es esto? <br><br>  Para el software de seguridad que escanea los registros de eventos de Windows o los firewalls, la codificaci√≥n base64 evita la detecci√≥n de la cadena de WebClient mediante un patr√≥n de texto simple para proteger contra dicha solicitud web.  Y dado que todo el malware "malvado" se descarga y transfiere a nuestro PowerShell, este enfoque le permite evitar por completo la detecci√≥n.  M√°s bien, eso pens√© al principio. <br><br>  Resulta que con la inclusi√≥n del registro avanzado de los registros de Windows PowerShell (consulte mi art√≠culo), puede ver la l√≠nea cargada en el registro de eventos.  Yo (como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">otros</a> ) creo que Microsoft deber√≠a habilitar este nivel de registro de forma predeterminada.  Por lo tanto, cuando se activa el registro extendido, veremos en el registro de eventos de Windows una solicitud completa para cargar desde un script PS de acuerdo con el ejemplo que examinamos anteriormente.  Por lo tanto, tiene sentido activarlo, ¬øde acuerdo? <br><br><h2>  Agregar scripts adicionales </h2><br>  Los hackers ocultan h√°bilmente un ataque de PowerShell en las macros de Microsoft Office escritas en Visual Basic y otros lenguajes de secuencias de comandos.  La idea es que la v√≠ctima reciba un mensaje, por ejemplo, de un servicio de entrega, con un informe adjunto en formato .doc.  Abre este documento, que contiene una macro, y finalmente lanza el mismo PowerShell malicioso. <br><br>  A menudo, el script de Visual Basic se ofusca para evadir libremente los antivirus y otros esc√°neres de malware.  En el esp√≠ritu de lo anterior, decid√≠ como ejercicio codificar el PowerShell anterior en JavaScript.  A continuaci√≥n se muestran los resultados de mi trabajo: <br><br><img src="https://habrastorage.org/webt/z6/4f/ek/z64fekt9zmny-mmfxihe8qgyfy8.jpeg"><br><p>  <i>JavaScript ofuscado que oculta nuestro PowerShell.</i>  <i>Los verdaderos hackers lo hacen una o dos veces.</i> </p><br>  Esta es otra de las t√©cnicas que he encontrado en la red: usar Wscript.Shell para ejecutar PowerShell codificado.  Por cierto, JavaScript en s√≠ mismo es un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">medio para</a> entregar malware.  Muchas versiones de Windows tienen un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Windows Script Host</a> incorporado, que puede ejecutar JS. <br>  En nuestro caso, el script JS malicioso se adjunta como un archivo con la extensi√≥n .doc.js.  Normalmente, Windows solo muestra el primer sufijo, por lo que aparecer√° a la v√≠ctima como un documento de Word. <br><br><img src="https://habrastorage.org/webt/ge/jy/pt/gejyptu4-xcxc87lweigj9yckqq.jpeg"><br><p>  <i>El icono JS se muestra solo en el icono de desplazamiento.</i>  <i>No es sorprendente que muchas personas abran este archivo adjunto, pensando que es un documento de Word.</i> </p><br>  En mi ejemplo, modifiqu√© el PowerShell anterior para descargar el script de mi sitio web.  El script remoto de PS simplemente imprime Evil Malware.  Como puede ver, √©l no es del todo malo.  Por supuesto, los hackers reales est√°n interesados ‚Äã‚Äãen obtener acceso a una computadora port√°til o servidor, por ejemplo, a trav√©s de un shell de comandos.  En el siguiente art√≠culo, mostrar√© c√≥mo hacer esto usando PowerShell Empire. <br><br>  Espero que para el primer art√≠culo introductorio no profundicemos demasiado en el tema.  Ahora te dejar√© tomar un respiro, y la pr√≥xima vez comenzaremos a analizar ejemplos de ataques de la vida real usando malvari sin archivos sin palabras introductorias adicionales y preparaci√≥n. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/456440/">https://habr.com/ru/post/456440/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456428/index.html">C√≥mo implementar un enfoque de BI para el an√°lisis de datos: recomendaciones pr√°cticas</a></li>
<li><a href="../456430/index.html">La eterna cuesti√≥n de la deuda t√©cnica.</a></li>
<li><a href="../456432/index.html">Semana de la seguridad 25: vulnerabilidad de Evernote y cientos de tiendas en l√≠nea pirateadas</a></li>
<li><a href="../456434/index.html">Profesiones del futuro: "¬øCon qui√©n trabajar√°s en Marte?"</a></li>
<li><a href="../456436/index.html">Tarea corta de JS para el lunes</a></li>
<li><a href="../456442/index.html">Admisi√≥n al programa de pregrado de la Universidad Estatal de San Petersburgo con el apoyo de Yandex y JetBrains</a></li>
<li><a href="../456446/index.html">Ceph - de "en la rodilla" a "producci√≥n"</a></li>
<li><a href="../456448/index.html">Reglas para elegir un marco JS</a></li>
<li><a href="../456450/index.html">DO-RA. Avia para monitorear la radiaci√≥n c√≥smica en la aviaci√≥n</a></li>
<li><a href="../456452/index.html">Ejemplos de c√≥digo C ++ antes y despu√©s de Rangos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>