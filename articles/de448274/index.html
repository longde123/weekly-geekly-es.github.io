<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèΩ üèª üë± SMS-√úberwachung des Gewichts von drei Bienenst√∂cken f√ºr 35 US-Dollar ‚úãüèæ üë®‚Äçüé® üéöÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seit der vorherigen Ver√∂ffentlichung √ºber das System f√ºr 30 US-Dollar ist eine Weile vergangen. 


 Was hat sich im letzten Mondmonat ge√§ndert? 


1. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SMS-√úberwachung des Gewichts von drei Bienenst√∂cken f√ºr 35 US-Dollar</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448274/"><p><img src="https://habrastorage.org/getpro/habr/post_images/77d/797/12a/77d79712a55957a17ca74a0995a7844d.jpg" alt="Newbee"></p><br><p>  Seit der vorherigen Ver√∂ffentlichung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√ºber das System f√ºr 30 US-Dollar</a> ist eine Weile vergangen. </p><br><p>  Was hat sich im letzten Mondmonat ge√§ndert? </p><br><ol><li>  Eine Solarbatterie wurde hinzugef√ºgt - die Betriebszeit ist nahezu unbegrenzt. </li><li>  Sendeinformationen zu einem Anruf hinzugef√ºgt. </li><li>  Die F√§higkeit, mit allen Arten von Kommunikationsmodulen zu arbeiten, die mir in den Sinn gekommen sind - AiThinker, Goouu Tech, SIM800 / 900, Neoway M590 * </li></ol><br><p>  Das Wichtigste ist jedoch, dass das Kommunikationsmodul und der Mikrocontroller jetzt physisch getrennt sind, wodurch St√∂rungen im Betrieb des HX711 vermieden werden. </p><br><p>  Und das alles dank konstruktiver Kritik an den Bewohnern und Imkern der Habrovsk, die sich der Diskussion √ºber das System angeschlossen haben. </p><br><p>  Die √ºbrigen Leistungsmerkmale blieben unver√§ndert - das maximale Gewicht der Bienenst√∂cke betr√§gt 200 kg. Nach Sonnenuntergang wird die Messung durchgef√ºhrt und die Indikatoren werden gesendet. </p><br><p>  Ich antizipiere Kritik bez√ºglich der Nichtverwendung von Schlafmodi und zus√§tzlichen Signalleitungen von GSM-Modulen und sage Folgendes: </p><br><p>  Jedes Kommunikationsmodul hat seine eigenen Besonderheiten - einige schlafen bei niedrigem Signalpegel ein, andere bei hohem Pegel, andere mit doppeltem Tippen. </p><br><p>  Die Besonderheiten von "Do it yourself" implizieren einen bestimmten kreativen Teil, und es lohnt sich, ihn hier zu zeigen. </p><br><p>  Ich habe auch ein System mit Blick auf die Weiterentwicklung der √úberwachung anderer Parameter des Bienenstocks entwickelt, bei denen Schlaf nicht besonders ben√∂tigt wird. </p><br><p>  Im Allgemeinen in der Titeltabelle - <del>  reines Android </del>  Basissystem, von dem aus Sie mit dem Design und der Anzahl / dem Satz von Sensoren, Modulen usw. √ºberall tanzen k√∂nnen. </p><br><p>  In diesem Artikel geht es um Skalen und unter dem Strich um meine pers√∂nliche Vision und Implementierung des Systems. </p><br><p>  Mit einem Wort - WILLKOMMEN!  Lass uns gehen! </p><a name="habracut"></a><br><p>  Zun√§chst schl√§ft dieses System √ºberhaupt nicht ... weil eine 6-Volt-Zweizellen-Solarbatterie selbst bei bew√∂lktem Wetter 5 Volt und bis zu hundert Milliampere erzeugt. </p><br><p>  Der Verbrauch des gesamten Systems betr√§gt 17 mA im Standby-Modus (im GSM1800-Standard) und etwa drei√üig beim GSM900. </p><br><p>  Dar√ºber hinaus wurde dies, wie bereits erw√§hnt, mit dem Ziel durchgef√ºhrt, zus√§tzliche √úberwachungsfunktionen in Echtzeit zu implementieren (ein Schwarm kann beispielsweise in 5 Minuten ausgehen) - es ist keine Zeit zum Schlafen ;-) </p><br><p>  Sie m√∂chten absolut Energie sparen, so wird es in der n√§chsten Ver√∂ffentlichung sein, aber es wird v√∂llig anders sein <del>  die Geschichte </del>  das System. </p><br><h4 id="da-esche-po-povodu-snoski-o-modulyah-svyazi---ne-to-chtoby-ya-stal-adeptom-aithinker-prosto-neoway-nuzhno-esche-samomu-sobirat-a-moduli-sim800l-trebuyut-otdelnoy-stati-s-likbezom-po-rabote-s-nimi">  * Ja, was die Fu√ünote zu Kommunikationsmodulen betrifft, ist es nicht so, dass ich ein AiThinker-Anh√§nger geworden bin, ich muss nur Neoway selbst zusammenbauen, und f√ºr SIM800L-Module ist ein separater Artikel mit einem Schulungsprogramm zur Arbeit mit ihnen erforderlich. </h4><br><p>  Mit einem Wort, die ausgew√§hlten GSMs sind IMHO, die einzigen, die an 4 Dr√§hten, einschlie√ülich Strom, ohne zus√§tzliche T√§nze mit Tamburinen arbeiten k√∂nnen. </p><br><p>  Wir ben√∂tigen die folgenden Ger√§te / Materialien: </p><br><ol><li>  Arduino Pro Mini 3V <br>  Sie sollten auf den Mikrochip des Linearwandlers achten - er muss genau 3,3 V betragen - auf dem Markierungs-Chip KB 33 / LB 33 / DE A10 - die Chinesen haben etwas mit mir und der ganzen Charge verwechselt <br>  Es stellte sich heraus, dass die Leiterplatten im Laden mit 5-Volt-Reglern und 16-MHz-Quarz ausgestattet waren. </li><li>  USB-Ttl auf einem CH340-Chip - Sie k√∂nnen sogar 5 Volt erzeugen, aber w√§hrend der Firmware des Mikrocontrollers muss Arduino vom GSM-Modul getrennt werden, um letzteres nicht zu verbrennen. <br>  Karten auf dem PL2303-Chip funktionieren unter Windows 10 nicht. </li><li>  GSM-Kommunikationsmodul Goouu Tech IOT GA-6-B oder AI-THINKER A-6 Mini. </li><li>  GSM-Antenne GPRS "YG-01" <br><img src="https://habrastorage.org/getpro/habr/post_images/ff7/aa9/69e/ff7aa969e86e53e60122bcdb2ca47c04.jpg"><br>  Wie sie einen solchen Anstieg erreicht haben - ein R√§tsel - ist vielleicht relativ zu dessen v√∂lliger Abwesenheit ;-). </li><li>  Starterpaket f√ºr einen Bediener mit guter Abdeckung am Standort Ihres Bienenhauses. <br>  Ja, das Paket muss zuerst in einem normalen Telefon aktiviert werden. Deaktivieren Sie die PIN-Anfrage am Eingang und f√ºllen Sie das Konto auf. </li><li>  Draht Dupont 20cm Mutter Mutter - 4 Stk.  (zum Anschlie√üen von Arduino an USB-TTL) </li><li>  3St  HX711 - ADC f√ºr Waagen </li><li>  6 W√§gezellen mit einem Gewicht von bis zu 50 kg </li><li>  15 Meter 4-adriges Telefonkabel - zum Anschluss von Gewichtsmodulen und GSM mit ARDUINO. </li><li>  Fotowiderstand GL5528 (dies ist wichtig, mit einem Dunkelwiderstand von 1 MOhm und einem Lichtwiderstand von 10-20 kOhm). </li><li>  zwei Paar Stecker und Buchsen 6P6C - Telefon, Buchsen - mit "Schw√§nzen" </li><li>  50 cm doppelseitiges Klebeband 10 mm breit - zur Befestigung des Solarpanels am Geh√§use des GSM-Moduls. </li><li>  TP4056-basierte Ladekarte f√ºr LiIon-Akkus </li><li>  Der 18650 Batteriehalter und in der Tat die Batterie selbst. </li><li>  Ein wenig Wachs oder Paraffin (Aromalampentablettenkerze) - zum Feuchtigkeitsschutz HX711 </li><li>  Ein St√ºck Holzbalken 25x50x300mm f√ºr die Basis von W√§gezellen. </li><li>  Ein Dutzend selbstschneidende Schrauben mit einer 4,2 x 19 mm Pressscheibe zur Montage von Sensoren an der Basis. </li><li>  5-6V 2W Solarbatterie <br><img src="https://habrastorage.org/getpro/habr/post_images/397/805/59c/39780559cbbd169641e5371eba3ec8e3.jpg" alt="R√ºckansicht der Paneele"><br>  Es gibt keinen R√ºckstrom durch das Ladeger√§t, aber parallele Solarmodule sollten ordnungsgem√§√ü √ºber Dioden eingeschaltet werden </li><li>  Eine Box f√ºr ein Kommunikationsmodul und eine Solarbatterie (Gr√∂√üe 60x100mm) - Sie k√∂nnen eine geeignete Verteilung von Elektroger√§ten nehmen, mein Kunststoff aus Visitenkarten 30x60x100 ist ideal geeignet. </li></ol><br><p>  Dar√ºber hinaus sind krumme H√§nde, ein EPSN-25-L√∂tkolben, Kolophonium und POS-60-Lot erforderlich. </p><br><p>  F√ºr die Tischlerei reichen eine B√ºgels√§ge f√ºr Holz / Metall, ein Mei√üel und ein Bohrer mit einem 3-mm-Bohrer aus. </p><br><p>  Das Layout des Systems ist wie folgt: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d34/875/ffc/d34875ffca19e80ac4658a8e439f749e.jpg" alt="Layout"></p><br><p>  In jedem Fall sollten Sie das GSM-Modul nicht n√§her als einen Meter vom Arduino entfernt platzieren. Bei einer hohen Signalleistung im GSM900-Standard kann dies dazu f√ºhren, dass der Mikrocontroller neu gestartet wird! </p><br><p>  Nun, das Kommunikationsmodul mit der Solarbatterie - sollte an einer Stange installiert werden - und der Empfang wird besser und weiter von den Bienen entfernt sein. </p><br><p>  Beginnen wir nun mit der Montage: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/eba/218/027/eba21802786557630e811458e9a07eaa.jpg" alt="GSM A6"></p><br><p>  F√ºr den Anfang werden zwei LEDs vom GSM-Modul (der Stelle, an der sie in einem orangefarbenen Oval eingekreist waren) verl√∂tet. </p><br><p>  Wir legen die SIM-Karte mit den Pads in die Leiterplatte ein, die abgeschr√§gte Ecke auf dem Foto ist durch den Pfeil gekennzeichnet. </p><br><p>  Au√üerdem wird die Batterie und das Kabel, das zur Steuerung f√ºhrt, direkt mit dem Kondensator (4) verl√∂tet. </p><br><p>  Tatsache ist, dass das Kommunikationsmodul selbst 3,4-4,2 V f√ºr seine Stromversorgung ben√∂tigt und sein PWR-Kontakt mit einem Abw√§rts-Abw√§rtswandler verbunden ist, so dass f√ºr den Betrieb mit Li-Ionen-Spannung unter Umgehung dieses Teils der Schaltung angelegt werden muss. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b89/f94/1c2/b89f941c27d96e91f2d7ec3c970e453d.jpg" alt="Arduino Pro Mini 3v"></p><br><p>  Dann f√ºhren wir einen √§hnlichen Vorgang mit der LED auf der Arduino-Platine durch (das Oval rechts vom quadratischen Chip). </p><br><p>  Wir l√∂ten den Kamm in vier Kontakte (1), immer horizontal - entlang der Platine. </p><br><p>  Wir k√ºrzen die Fotowiderstandsschenkel auf 10 mm und l√∂ten sie mit 20-cm-Leitern an die Klemmen GND und D2 der Platine (2). </p><br><p>  Wir liefern Strom √ºber einen Linearwandler - bei niedrigen Str√∂men betr√§gt der Spannungsabfall 0,1 V. </p><br><p>  Durch Anlegen einer stabilisierten Spannung an die HX711-Module entf√§llt jedoch die Notwendigkeit, sie unter einer niedrigeren Spannung zu verfeinern (und gleichzeitig das Rauschen infolge dieses Vorgangs zu erh√∂hen). </p><br><p>  Jetzt m√ºssen Sie 5 Meter eines vieradrigen Telefonkabels nehmen und es gem√§√ü dem Diagramm am Anfang des Artikels zwischen dem Mikrocontroller und dem Kommunikationsmodul l√∂ten (die Farben der Dr√§hte entsprechen der Realit√§t). </p><br><p>  Wir l√∂ten auch den Batteriehalter, den Rest erledigen wir etwas sp√§ter. </p><br><p>  Und jetzt schweifen wir f√ºr einige Zeit vom L√∂tkolben ab und gehen zum Software-Teil √ºber. <br>  Ich werde die Reihenfolge der Aktionen f√ºr Windows beschreiben: <br>  Zun√§chst m√ºssen Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Arduino IDE-</a> Programm herunterladen und installieren / entpacken - die aktuelle Version ist 1.8.9, aber ich verwende 1.6.4 </p><br><p>  Der Einfachheit halber entpacken wir das Archiv in den Ordner C: \ arduino- "your_version_number". Darin befinden sich die Ordner / dist, Treiber, Beispiele, Hardware, Java, lib, Bibliotheken, Referenz, Tools sowie die ausf√ºhrbare Datei von arduino (unter anderem). </p><br><p>  Jetzt brauchen wir eine Bibliothek f√ºr die Arbeit mit dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HX711</a> ADC - die gr√ºne Schaltfl√§che "Klonen oder Herunterladen" - ZIP herunterladen. </p><br><p>  Der Inhalt (Ordner HX711-master) befindet sich im Verzeichnis C: \ arduino- "Ihre_Versionsnummer" \ Bibliotheken </p><br><p>  Und nat√ºrlich stammt der Treiber f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">USB-TTL</a> vom selben Github - aus dem entpackten Archiv wird die SETUP-Datei des Installationsprogramms einfach gestartet. </p><br><p>  F√ºr diejenigen, die sich nur ungern mit Bibliotheken besch√§ftigen, habe ich meine Baugruppe des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Arduino IDE-</a> Programms gepackt - einfach herunterladen und entpacken. </p><br><p>  Wir starten und konfigurieren das Programm C: \ arduino- "your_version_number" \ arduino </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2fd/429/2d5/2fd4292d54f67c31052b54ca853be5b3.jpg" alt="Programmschnittstelle"></p><br><p>  Wir gehen zum Punkt "Extras" - w√§hlen Sie die Karte "Arduino Pro oder Pro Mini", den Atmega 328 3,3 V 8 MHz Prozessor, der Port ist die andere Nummer als das System COM1 (erscheint nach der Installation des CH340-Treibers mit angeschlossenem USB-TTL-Adapter). </p><br><p>  Ok, kopieren Sie die folgende Skizze (Programm) und f√ºgen Sie sie in das Arduino IDE-Fenster ein </p><br><pre><code class="plaintext hljs">char phone_no[]="+123456789012"; // Your phone number that receive SMS with counry code // NeverSleep #include &lt;SoftwareSerial.h&gt; // Sofrware serial library #include "HX711.h" // HX711 lib. https://github.com/bogde/HX711 #include &lt;EEPROM.h&gt; // EEPROM lib. HX711 scale0(10, 14); HX711 scale1(11, 14); HX711 scale2(12, 14); #define SENSORCNT 3 HX711 *scale[SENSORCNT]; SoftwareSerial mySerial(5, 4); // Set I/O-port TXD, RXD of GSM-shield float delta00; // delta weight from start float delta10; float delta20; float delta01; // delta weight from yesterday float delta11; float delta21; float raw00; //raw data from sensors on first start float raw10; float raw20; float raw01; //raw data from sensors on yesterday float raw11; float raw21; float raw02; //actual raw data from sensors float raw12; float raw22; word calibrate0=20880; //calibration factor for each sensor word calibrate1=20880; word calibrate2=20880; word daynum=0; //numbers of day after start int notsunset=0; boolean setZero=false; boolean forceSend=false; char ch = 0; char ch1 = 0; char ch2 = 0; char ch3 = 0; char ch4 = 0; void readVcc() // read battery capacity { ch = mySerial.read(); while (mySerial.available() &gt; 0) { ch = mySerial.read(); } // empty input buffer from modem mySerial.println("AT+CBC?"); //ask gprs for battery status (for sim800 and neoway command must be "AT+CBC" ) delay(200); while (mySerial.available() &gt; 0) { //read input string between coma and CR ch = mySerial.read(); if (ch ==','){ ch1 = mySerial.read(); ch2 = mySerial.read(); ch3 = mySerial.read(); ch4 = mySerial.read(); } } } // ********************************************************************** void SendStat() { detachInterrupt(digitalPinToInterrupt(0)); // turn off external interrupt digitalWrite(13, HIGH); if (!forceSend){ notsunset=0; for (int i=0; i &lt;= 250; i++){ if ( !digitalRead(2) ){ notsunset++; } //is a really sunset now? you shure? delay(360); } } if ( notsunset==0 || forceSend ) { raw01=raw02; raw11=raw12; raw21=raw22; raw02=scale0.get_units(16); //read data from scales raw12=scale1.get_units(16); raw22=scale2.get_units(16); daynum++; delta00=(raw02-raw00)/calibrate0; // calculate weight changes delta01=(raw02-raw01)/calibrate0; delta10=(raw12-raw10)/calibrate1; delta11=(raw12-raw11)/calibrate1; delta20=(raw22-raw20)/calibrate2; delta21=(raw22-raw21)/calibrate2; readVcc(); delay(200); mySerial.println("AT+CMGF=1"); // Part of SMS sending delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.print("Turn "); mySerial.println(daynum); mySerial.print("Hive1 "); mySerial.print(delta01); mySerial.print(" "); mySerial.println(delta00); mySerial.print("Hive2 "); mySerial.print(delta11); mySerial.print(" "); mySerial.println(delta10); mySerial.print("Hive3 "); mySerial.print(delta21); mySerial.print(" "); mySerial.println(delta20); mySerial.print("Battery capacity is "); mySerial.print(ch1); mySerial.print(ch2); mySerial.print(ch3); mySerial.print(ch4); mySerial.println(" %"); if (forceSend) {mySerial.print("Forced SMS");} mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); } forceSend=false; digitalWrite(13, LOW); attachInterrupt(0, SendStat , RISING); // Interrupt by HIGH level } // ************************************************************************************************* void switchto9600() { mySerial.begin(115200); // Open software serial port delay(16000); // wait for boot mySerial.println("AT"); delay(200); mySerial.println("AT"); delay(200); mySerial.println("AT+IPR=9600"); // Change Serial Speed delay(200); mySerial.begin(9600); mySerial.println("AT&amp;W0"); delay(200); mySerial.println("AT&amp;W"); } void setup() { // Setup part run once, at start pinMode(13, OUTPUT); // Led pin init pinMode(2, INPUT_PULLUP); // Set pullup voltage Serial.begin(9600); // ------------------------------------------------------------------------------- switchto9600(); // switch module port speed // ------------------------------------------------------------------------------- mySerial.begin(9600); delay(200); scale[0] = &amp;scale0; //init scale scale[1] = &amp;scale1; scale[2] = &amp;scale2; scale0.set_scale(); scale1.set_scale(); scale2.set_scale(); delay(200); setZero=digitalRead(2); //if (EEPROM.read(500)==EEPROM.read(501) || setZero) // first boot/reset with hiding photoresistor if (setZero) { raw00=scale0.get_units(16); //read data from scales raw10=scale1.get_units(16); raw20=scale2.get_units(16); EEPROM.put(500, raw00); //write data to eeprom EEPROM.put(504, raw10); EEPROM.put(508, raw20); for (int i = 0; i &lt;= 24; i++) { //blinking LED13 on reset/first boot digitalWrite(13, HIGH); delay(500); digitalWrite(13, LOW); delay(500); } } else { EEPROM.get(500, raw00); // read data from eeprom after battery change EEPROM.get(504, raw10); EEPROM.get(508, raw20); digitalWrite(13, HIGH); // turn on LED 13 on 12sec. delay(12000); digitalWrite(13, LOW); } delay(200); // Test SMS at initial boot readVcc(); delay(200); mySerial.println("AT+CMGF=1"); delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.println("INITIAL BOOT OK"); mySerial.print("Battery capacity is "); mySerial.print(ch1); mySerial.print(ch2); mySerial.print(ch3); mySerial.print(ch4); mySerial.println(" %"); mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); raw02=raw00; raw12=raw10; raw22=raw20; attachInterrupt(0, SendStat , RISING); // Interrupt by HIGH level } void loop() { digitalWrite(13, LOW); ch=mySerial.read(); if ( ch=='R' ) { //wait first lerrer from "RING" string forceSend=true; mySerial.println("ATH"); SendStat(); ch=' '; } }</code> </pre> <br><p>  In der ersten Zeile in Anf√ºhrungszeichen char phone_no [] = "+ 123456789012";  - Anstelle von 123456789012 geben wir unsere Telefonnummer mit der Landesvorwahl an, an die die SMS gesendet wird. </p><br><p>  Klicken Sie auf das Kontrollk√§stchen (√ºber der Nummer eins im obigen Screenshot) - wenn unten (unter dem Dreifachen im Screenshot) "Kompilierung ist abgeschlossen" - k√∂nnen wir den Mikrocontroller flashen. </p><br><p>  Also, USB-TTL ist mit dem ARDUINO und dem Computer verbunden (wie auf dem Foto oben), wir legen den geladenen Akku in die Halterung (normalerweise beginnt bei einem neuen Arduino die LED einmal pro Sekunde zu blinken). </p><br><p>  Jetzt die Firmware - wir trainieren, um den roten (silbernen) Knopf des Mikrocontrollers zu dr√ºcken - dies muss unbedingt zu einem bestimmten Zeitpunkt erfolgen !!! </p><br><p>  Ist da  Klicken Sie auf die Schaltfl√§che "Hochladen" (√ºber den beiden im Screenshot) und sehen Sie sich die Zeile am unteren Rand der Benutzeroberfl√§che (unter den drei Bildschirmen) genau an. </p><br><p>  Sobald die Beschriftung "Zusammenstellung" durch "Herunterladen" ersetzt wird - dr√ºcken Sie die rote Taste (Zur√ºcksetzen) - wenn alles in Ordnung ist - blinkt der USB-TTL-Adapter freudig und die Beschriftung "Heruntergeladen" am unteren Rand der Benutzeroberfl√§che </p><br><p>  W√§hrend wir darauf warten, dass die Test-SMS am Telefon eintrifft, erkl√§re ich Ihnen, wie das Programm funktioniert: </p><br><p>  Beim ersten Einschalten des Systems werden die Bytes 500 und 501 des EEPROM √ºberpr√ºft. Wenn sie gleich sind, wurden die Kalibrierungsdaten nicht aufgezeichnet, und der Algorithmus f√§hrt mit dem Setup-Abschnitt fort. </p><br><p>  Das gleiche passiert, wenn der Fotowiderstand beim Einschalten schattiert ist (mit einer Kappe von einem Stift) - der Parameter-Reset-Modus ist aktiviert. </p><br><p>  Dehnungsmessstreifen sollten bereits unter den Bienenst√∂cken installiert sein, da wir einfach den Anfangspegel von Null festlegen und dann die Gewichts√§nderung messen (jetzt werden Nullen kommen, da wir noch nichts angeschlossen haben). </p><br><p>  Auf Arduino blinkt die eingebaute LED von Pin 13. <br>  Wenn der Reset nicht erfolgt, leuchtet die LED 12 Sekunden lang auf. <br>  Danach wird eine Test-SMS mit der Meldung "INITIAL BOOT OK" und dem Prozentsatz der Batterieladung gesendet. </p><br><p>  Au√üerdem haben wir einen Interrupt am Fotosensor, der am zweiten Stift arbeitet (plus das Anheben wird durch die Pullup-Funktion aktiviert). <br>  In diesem Fall wird nach weiteren 3 Minuten Ausl√∂sen der Zustand des Fotowiderstands √ºberpr√ºft, um wiederholte / falsch positive Ergebnisse auszuschlie√üen. <br>  Um zu verhindern, dass das System bei jedem Einschalten zur√ºckgesetzt wird, muss mindestens das erste HX711-Modul angeschlossen sein (Pins DT-D10, SCK-A0). </p><br><p>  Dann werden die W√§gezellenablesungen vorgenommen, die Gewichts√§nderung gegen√ºber dem vorherigen Vorgang (die erste Zahl in der Zeile nach Hive) berechnet und vom ersten Start an wird die Batteriespannung √ºberpr√ºft und diese Informationen werden in Form von SMS gesendet: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c63/a89/992/c63a89992a1311d828e3d9380ba45036.jpg" alt="Probensystem"></p><br><p>  Hast du √ºbrigens SMS erhalten?  Gl√ºckwunsch!  Wir sind auf halbem Weg!  W√§hrend der Akku aus der Halterung entfernt werden kann, ben√∂tigen wir keinen weiteren Computer. </p><br><p>  Wir fahren mit der Herstellung von Sensoren fort. Lassen Sie uns zun√§chst das Layout der Sensoren ansprechen: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/182/43b/cec/18243bcecc904c4018d7b2217cc72d9b.jpg" alt="Sensorposition"></p><br><p>  Dies ist der Plan der Bienenstock-Draufsicht. </p><br><p>  Klassischerweise sind 4 Sensoren in den Ecken installiert (1,2,3,4) </p><br><p>  Wir werden anders messen.  Oder besser gesagt, sogar im dritten.  Wie die Jungs von BroodMinder es anders machen: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b49/fbe/1f3/b49fbe1f378d3e5b4b7320bf6ac83520.jpg" alt="Brutminder"></p><br><p>  Bei dieser Konstruktion sind die Sensoren an den Positionen 1 und 2 installiert, die Punkte 3.4 basieren auf dem Strahl. <br>  Dann f√§llt nur die H√§lfte des Gewichts auf die Sensoren. <br>  Ja, eine solche Methode ist weniger genau, aber es ist schwer vorstellbar, dass die Bienen alle Rahmen mit ‚ÄûZungen‚Äú aus den Waben entlang einer Wand des Bienenstocks aufgebaut haben. </p><br><p>  Daher schlage ich vor, die Sensoren auf Punkt 5 zu reduzieren - dann muss das System nicht abgeschirmt werden, und bei Verwendung von leichten Bienenst√∂cken muss unbedingt ein Sensor verwendet werden. </p><br><p>  In einem Bienenstock werden also zwei W√§gezellen und ein HX711-Modul installiert. Der Schaltplan lautet wie folgt: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6d2/39b/bef/6d239bbef099b427b0f6127a323a7e69.jpg"></p><br><p>  Von der ADC-Karte bis zum Arduino gibt es 5 Meter eines 4-adrigen Telefonkabels (bei Modulen mit Gewicht 2 und 3), der erste Sensor ist mit einem 10-cm-Schwanz verbunden, aber dazu sp√§ter mehr. </p><br><p>  Im Allgemeinen lassen wir bei den Sensoren "Schw√§nze" von 8 cm, reinigen das verdrillte Paar und l√∂ten alles wie auf dem Foto oben. </p><br><p>  Legen Sie vor Beginn der Tischlerei Wachs / Paraffin in einen geeigneten Beh√§lter, um es in einem Wasserbad zu schmelzen. </p><br><p>  Jetzt nehmen wir unseren Strahl und teilen ihn in drei Segmente von 100 mm </p><br><p>  Als n√§chstes markieren Sie eine 25 mm breite, 7-8 mm tiefe L√§ngsnut mit einer B√ºgels√§ge und einem Mei√üel. Wir entfernen den √úberschuss - ein U-f√∂rmiges Profil sollte herauskommen. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/509/226/d98/509226d98d5b52f993b21c9e6679fc1a.jpg" alt="Die Grundlagen"></p><br><p>  Tats√§chlich brauchen wir einen H-f√∂rmigen Teil 1 und zwei - P-shki, alle 10 cm lang. </p><br><p>  Warum N-ka - glaube es nicht, verstecke das Arduino darin: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/096/e6b/89d/096e6b89d4442e3bf898be19dae38566.jpg" alt="das Wunder der feindlichen Technologie"></p><br><p>  Zus√§tzlich sind hier 6P6C-Buchsen zum Anschluss der Sensoren 2 und 3 angebracht. </p><br><p>  Wachs aufgew√§rmt?  - Wir tauchen unsere ADC-Platten dort ein - dies sch√ºtzt sie vor Feuchtigkeit / Nebel: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/672/7f1/a576727f1b4385933b640b0dd1ef2a01.jpg" alt="ADC-Schutz gegen Feuchtigkeit"></p><br><p>  Wir haben alles auf einem Holzsockel (es ist notwendig, es mit einem Antiseptikum gegen Verfall zu behandeln): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/a6b/347/a57a6b34743c1f8b8add453e729fadea.jpg" alt="Montage"></p><br><p>  Und zum Schluss befestigen wir die Sensoren mit Schrauben: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/94d/e43/541/94de435418f3d001e47b181935612e5f.jpg" alt="Sensor bereit"></p><br><p>  Als n√§chstes l√∂ten wir alle verbleibenden Komponenten gem√§√ü dem Schema im Header und im gesunden Menschenverstand. </p><br><h4 id="v-plane-raspolozheniya-komponentov-zhelatelno-proyavit-fantaziyu-stoit-uchityvat-odno---rasstoyanie-mezhdu-mikrokontrollerom-i-gsm-modulem-dolzhno-sostavlyat-ne-menee-odnogo-metra">  In Bezug auf die Position der Komponenten ist es ratsam, Vorstellungskraft zu zeigen. Beachten Sie Folgendes: Der Abstand zwischen dem Mikrocontroller und dem GSM-Modul sollte mindestens einen Meter betragen! </h4><br><p>  Ich habe folgendes Design: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/828/60b/f5a/82860bf5acb8465591e4fa82f0d284da.jpg" alt="Finale"></p><br><p>  Ja, ich habe den Einbauwinkel der Paneele auf 45 Grad gesch√§tzt - aufgrund der einfachen Herstellung, aber er liegt nahe an den optimalen vierzig Grad f√ºr den Sommer auf dem Breitengrad von Kiew. </p><br><p>  Jetzt k√∂nnen Sie zur letzten √úberpr√ºfung die Sensoren in den Kreissektoren oben platzieren - ein St√ºck Sperrholz, den Controller auf Null stellen (schalten Sie das System mit der Kappe auf der Fotodiode vom F√ºllfederhalter aus ein). </p><br><p>  In diesem Fall sollte die LED am Arduino blinken und eine Test-SMS sollte kommen. </p><br><p>  Dann nehmen wir die Kappe von der Fotozelle ab und sammeln Wasser in einer 6-Liter-Plastikflasche. <br>  Wir stellen die Flasche auf Sperrholz und setzen nach dem Einschalten bereits einige Minuten auf den Fotowiderstand (simuliert den Sonnenuntergang). </p><br><p>  Gleichzeitig leuchtet die LED am Arduino auf und Sie sollten an allen Positionen eine SMS mit einem Gewichtswert von ca. 4 kg erhalten. </p><br><p>  Gl√ºckwunsch!  Das System ist erfolgreich montiert! </p><br><p>  Wenn wir das System jetzt wieder zum Laufen bringen, erhalten wir in der ersten Spalte des Gewichts Nullen. </p><br><p>  Ja, unter realen Bedingungen ist es w√ºnschenswert, den Fotowiderstand vertikal nach oben auszurichten. </p><br><p>  Jetzt werde ich ein kurzes Handbuch zur Verwendung von: </p><br><ol><li>  Installieren Sie Dehnungsmessstreifen unter den R√ºckw√§nden der Bienenst√∂cke (unter der Vorderseite ersetzen Sie einen Balken / eine Platte mit einer Dicke von ~ 30 mm). </li><li>  Installieren Sie ein Kommunikationsmodul mit Sonnenkollektoren auf einer H√∂he, einige Meter von den Bienenst√∂cken entfernt. <br>  Die Ausrichtung der Sonnenkollektoren - nach S√ºden - kann erfasst werden (wir werden die wahre nicht erfassen). </li><li>  Schattieren Sie den Fotowiderstand und legen Sie den Akku ein - die LED sollte blinken und eine Test-SMS mit dem Text "INITIAL BOOT OK" sollte kommen <br>  Jeden Abend nach Sonnenuntergang kommt SMS mit einer Gewichts√§nderung pro Tag und ab dem Start an. <br>  Wenn Sie die SIM-Kartennummer des GSM-Moduls anrufen, geht der Controller ab (wir h√∂ren ‚ÄûDer Teilnehmer kann den Anruf nicht empfangen‚Äú) und die SMS enth√§lt au√üergew√∂hnliche Messwerte. <br>  In einer solchen Nachricht wird eine zus√§tzliche Zeile angezeigt - "Forced SMS"; </li></ol><br><p>  Von der vollst√§ndigen Sch√∂nheit des Systems ist nur noch sehr wenig √ºbrig: </p><br><ol><li>  F√ºgen Sie das automatische Ger√§tesystem zum Fotosensor hinzu. </li><li>  √úberpr√ºfen Sie andere Arten von Kommunikationsmodulen. </li><li>  Um alles unter ESP-8266 zu erledigen - erstens werden Firmware-Updates "drahtlos" unterst√ºtzt - ist dies praktisch. </li></ol><br><p>  Zweitens - es kann Statistiken in Form von einfachen Webseiten geben. <br>  Und schlie√ülich, wenn Sie Wi-Fi haben, k√∂nnen Sie GSM-ki vollst√§ndig ablehnen. </p><br><p>  Oh ja, ich habe es satt, mit Kabeln herumzuspielen, und ich habe ein System mit "absoluter" Energieeinsparung versprochen. </p><br><p>  Mit einem Wort, ich beschloss, einen kleinen "Narren" zu spielen und alles zu tun. <br>  Wie viel Erfolg - lesen Sie die Publikation in einem Monat! </p><br><p>  Wir sehen uns auf den Seiten von Habr-a, <br>  Elektrischer Imker Andrey </p><br><p>  PS F√ºr neue Ver√∂ffentlichungen zu diesem Thema siehe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beefree.xyz</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de448274/">https://habr.com/ru/post/de448274/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de448264/index.html">Lipid kalt nichts: Verhindert die Kristallisation von Wasser bei -263 ¬∞ C.</a></li>
<li><a href="../de448266/index.html">Telefoniert! So bauen Sie Ihren Web-Dialer in einer Stunde zusammen</a></li>
<li><a href="../de448268/index.html">Boxed Telephone Systems</a></li>
<li><a href="../de448270/index.html">√Ñndern Sie die Programmeinstellungen, w√§hrend Sie die pers√∂nlichen Einstellungen beibehalten</a></li>
<li><a href="../de448272/index.html">Warum das Flugzeug vor dem Abflug speziell √ºbergossen und was passiert, wenn dies nicht getan wird?</a></li>
<li><a href="../de448276/index.html">Wie die Alfa Bank in einer Zeit des Wandels lebt und was wir durch die Kombination von IT-Entwicklung und Alfa Lab geschafft haben</a></li>
<li><a href="../de448278/index.html">Technische Hypothek: Was und wem schuldet das Team?</a></li>
<li><a href="../de448280/index.html">Probefahrt nanoCAD SPDS Metalwork 1.2. Teil 2</a></li>
<li><a href="../de448286/index.html">Nachrichten aus der Welt von OpenStreetMap Nr. 455 (04/02/2019 - 04/04/2019)</a></li>
<li><a href="../de448288/index.html">Verwenden von C ++ und Vorlagen mit einer variablen Anzahl von Argumenten beim Programmieren von Mikrocontrollern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>