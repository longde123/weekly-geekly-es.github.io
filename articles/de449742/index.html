<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÇ üßñüèº üò• Entwicklungs- und Testprozess mit Docker und Gitlab CI üë®üèΩ‚Äçüî¨ üßÄ üÜó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich schlage vor, dass Sie sich mit dem Protokoll des Berichts von Alexander Sigachev von Inventos "Der Entwicklungs- und Testprozess mit Docker + Gitl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entwicklungs- und Testprozess mit Docker und Gitlab CI</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449742/"><p>  <strong>Ich schlage vor, dass Sie sich mit dem Protokoll des Berichts von Alexander Sigachev von Inventos "Der Entwicklungs- und Testprozess mit Docker + Gitlab CI" vertraut machen.</strong> </p><br><p>  Diejenigen, die gerade erst mit der Implementierung des Entwicklungs- und Testprozesses auf Basis von Docker + Gitlab CI beginnen, stellen h√§ufig grundlegende Fragen.  Wo soll ich anfangen?  Wie organisieren?  Wie teste ich? </p><br><p>  Dieser Bericht ist gut geeignet, um Sie strukturiert √ºber den Entwicklungs- und Testprozess mit Docker und Gitlab CI zu informieren.  2017 Bericht selbst.  Ich denke, dass Sie aus diesem Bericht die Grundlagen, Methoden, Ideen und Nutzungserfahrungen ziehen k√∂nnen. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/lJsqRwULRVA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Wen k√ºmmert es bitte unter der Katze. <a name="habracut"></a></p><br><p>  Ich hei√üe Alexander Sigachev.  Ich arbeite f√ºr Inventos.  Ich erz√§hle Ihnen von meinen Erfahrungen mit Docker und wie wir es schrittweise in Projekten im Unternehmen implementieren. </p><br><p>  Thema: Entwicklungsprozess mit Docker und Gitlab CI. </p><br><p><img src="https://habrastorage.org/webt/iu/r2/qt/iur2qtjwp2qa_f4vdvmetzii-no.png"></p><br><p>  Dies ist mein zweiter Vortrag √ºber Docker.  Zum Zeitpunkt des ersten Berichts haben wir Docker nur in der Entwicklung auf Entwicklungsmaschinen verwendet.  Die Anzahl der Mitarbeiter, die Docker verwendeten, betrug ca. 2-3 Personen.  Allm√§hlich wurden Erfahrungen gesammelt und wir gingen etwas weiter.  Link zu unserem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ersten Bericht</a> . </p><br><p>  Was wird in diesem Bericht stehen?  Wir werden unsere Erfahrungen dar√ºber teilen, welchen Rechen wir gesammelt haben, welche Probleme wir gel√∂st haben.  Nicht √ºberall war es sch√∂n, aber man durfte weitermachen. </p><br><p>  Unser Motto lautet: Dockerisieren Sie alles, was unsere H√§nde erreichen. </p><br><p><img src="https://habrastorage.org/webt/rg/wx/pb/rgwxpblyvmjf0hb0ly4eecmntf0.png"></p><br><p>  Welche Probleme l√∂sen wir? </p><br><p>  Wenn ein Unternehmen mehrere Teams hat, ist der Programmierer eine gemeinsam genutzte Ressource.  Es gibt Phasen, in denen ein Programmierer aus einem Projekt herausgezogen und f√ºr einige Zeit einem anderen Projekt √ºbergeben wird. </p><br><p>  Damit der Programmierer schnell darauf eingehen kann, muss er den Quellcode des Projekts herunterladen und die Umgebung so schnell wie m√∂glich starten, damit er die Aufgaben dieses Projekts weiter l√∂sen kann. </p><br><p>  Wenn Sie bei Null anfangen, reicht die Dokumentation im Projekt normalerweise nicht aus.  Nur Oldtimer haben Informationen zur Einrichtung.  Mitarbeiter richten ihren Arbeitsplatz in ein bis zwei Tagen selbst√§ndig ein.  Um dies zu beschleunigen, haben wir Docker verwendet. </p><br><p>  Der n√§chste Grund ist die Standardisierung der Einstellungen in der Entwicklung.  Nach meiner Erfahrung ergreifen Entwickler immer die Initiative.  In jedem f√ºnften Fall wird eine benutzerdefinierte Domain eingegeben, z. B. vasya.dev.  In der N√§he befindet sich der Nachbar Petya, dessen Domain petya.dev ist.  Sie entwickeln eine Website oder eine Komponente des Systems unter Verwendung dieses Domainnamens. </p><br><p>  Wenn das System w√§chst und diese Dom√§nennamen in die Konfiguration fallen, liegt ein Konflikt zwischen den Entwicklungsumgebungen vor und der Pfad der Site wird neu geschrieben. </p><br><p> Das gleiche passiert mit den Datenbankeinstellungen.  Jemand k√ºmmert sich nicht um die Sicherheit und arbeitet mit einem leeren Root-Passwort.  Jemand in der Installationsphase forderte MySQL ein Kennwort an, und es stellte sich heraus, dass das Kennwort eins 123 war. Es kommt h√§ufig vor, dass sich die Datenbankkonfiguration abh√§ngig vom Commit des Entwicklers st√§ndig √§ndert.  Jemand hat korrigiert, jemand hat die Konfiguration nicht korrigiert.  Es gab Tricks, als wir eine Art <code>.gitignore</code> in <code>.gitignore</code> und jeder Entwickler eine Datenbank installieren musste.  Dies erschwerte den Startvorgang.  Unter anderem m√ºssen Sie sich an die Datenbank erinnern.  Die Datenbank muss initialisiert werden, ein Passwort muss registriert sein, ein Benutzer muss registriert sein, eine Platte muss erstellt werden und so weiter. </p><br><p>  Ein weiteres Problem sind die verschiedenen Versionen von Bibliotheken.  Es kommt oft vor, dass ein Entwickler mit verschiedenen Projekten arbeitet.  Es gibt ein Legacy-Projekt, das vor f√ºnf Jahren begann (ab 2017 - Anmerkung. Ed.).  Zu Beginn haben wir mit MySQL 5.5 begonnen.  Es gibt auch moderne Projekte, in denen wir versuchen, modernere Versionen von MySQL einzuf√ºhren, zum Beispiel 5.7 oder √§lter (2017 - Anmerkung. Ed.) </p><br><p>  Jeder, der mit MySQL arbeitet, wei√ü, dass diese Bibliotheken Abh√§ngigkeiten ziehen.  Es ist ziemlich problematisch, zwei Basen zusammen zu betreiben.  Zumindest ist es f√ºr alte Kunden problematisch, eine Verbindung zur neuen Datenbank herzustellen.  Dies verursacht wiederum mehrere Probleme. </p><br><p>  Das n√§chste Problem ist, wenn der Entwickler auf dem lokalen Computer arbeitet, lokale Ressourcen, lokale Dateien und lokalen RAM verwendet.  Die gesamte Interaktion zum Zeitpunkt der Entwicklung der L√∂sung des Problems erfolgt im Rahmen der Tatsache, dass sie auf einer Maschine funktioniert.  Ein Beispiel ist, wenn wir Backend-Server in Production 3 haben und der Entwickler die Dateien im Stammverzeichnis speichert und von dort aus nginx die Dateien verwendet, um auf die Anfrage zu antworten.  Wenn ein solcher Code in die Produktion f√§llt, stellt sich heraus, dass die Datei auf einem der drei Server vorhanden ist. </p><br><p>  Jetzt entwickelt sich die Richtung der Mikrodienste.  Wenn wir unsere gro√üen Anwendungen in einige kleine Komponenten aufteilen, die miteinander interagieren.  Auf diese Weise k√∂nnen Sie die Technologie f√ºr einen bestimmten Aufgabenstapel ausw√§hlen.  Au√üerdem k√∂nnen Sie die Arbeit und den Verantwortungsbereich zwischen Entwicklern teilen. </p><br><p>  Der auf JS entwickelte Frondend-Entwickler hat praktisch keinen Einfluss auf das Backend.  Der Backend-Entwickler wiederum entwickelt in unserem Fall Ruby on Rails und st√∂rt Frondend nicht.  Die Interaktion erfolgt √ºber die API. </p><br><p>  Als Bonus konnten wir mit Docker Ressourcen f√ºr Staging nutzen.  Jedes Projekt erforderte aufgrund seiner Spezifit√§t bestimmte Einstellungen.  Physisch war es notwendig, entweder einen virtuellen Server auszuw√§hlen und separat zu konfigurieren oder eine variable Umgebung gemeinsam zu nutzen, und Projekte konnten sich je nach Version der Bibliotheken gegenseitig beeinflussen. </p><br><p><img src="https://habrastorage.org/webt/ue/fu/5h/uefu5hbokfkhivcwpffwt5xi4hi.png"></p><br><p>  Werkzeuge  Was benutzen wir? </p><br><ul><li>  Direkt Docker selbst.  Dockerfile beschreibt Abh√§ngigkeiten einer Anwendung. </li><li>  Docker-Compose ist ein Bundle, das einige unserer Docker-Anwendungen zusammenf√ºhrt. </li><li>  GitLab verwenden wir zum Speichern des Quellcodes. </li><li>  Wir verwenden GitLab-CI f√ºr die Systemintegration. </li></ul><br><p><img src="https://habrastorage.org/webt/yq/z-/zb/yqz-zbkwsjbklpjpkxf6pzqasya.png"></p><br><p>  Der Bericht besteht aus zwei Teilen. </p><br><p>  Im ersten Teil wird erl√§utert, wie Docker auf Entwicklungsmaschinen ausgef√ºhrt wird. </p><br><p>  Im zweiten Teil wird erl√§utert, wie Sie mit GitLab interagieren, wie wir Tests ausf√ºhren und wie wir Staging einf√ºhren. </p><br><p><img src="https://habrastorage.org/webt/tk/4w/lm/tk4wlm_ul847kzentzlw1ikjypq.png"></p><br><p>  Docker ist eine Technologie, mit der (unter Verwendung eines deklarativen Ansatzes) die erforderlichen Komponenten beschrieben werden k√∂nnen.  Dies ist ein Beispiel f√ºr eine Docker-Datei.  Hier geben wir bekannt, dass wir vom offiziellen Ruby Docker-Image erben: 2.3.0.  Es enth√§lt die installierte Ruby-Version 2.3.  Wir installieren die notwendigen Build-Bibliotheken und NodeJS.  Wir beschreiben, dass wir das Verzeichnis <code>/app</code> erstellen.  Weisen Sie das App-Verzeichnis dem Arbeitsverzeichnis zu.  In diesem Verzeichnis platzieren wir das erforderliche Minimum Gemfile und Gemfile.lock.  Dann erstellen wir die Projekte, die dieses Abh√§ngigkeitsimage installieren.  Wir geben an, dass der Container bereit ist, den externen Port 3000 abzuh√∂ren. Der letzte Befehl ist der Befehl, der unsere Anwendung direkt startet.  Wenn wir den Projektstartbefehl ausf√ºhren, versucht die Anwendung, den angegebenen Befehl auszuf√ºhren und zu starten. </p><br><p><img src="https://habrastorage.org/webt/yc/vn/mp/ycvnmp4_o5pcl9r9hobxbchmntw.png"></p><br><p>  Dies ist ein minimales Beispiel f√ºr eine Docker-Compose-Datei.  In diesem Fall zeigen wir, dass eine Verbindung zwischen den beiden Containern besteht.  Dies ist direkt an den Datenbankdienst und den Webdienst.  Unsere Webanwendungen erfordern in den meisten F√§llen eine Datenbank als Backend zum Speichern von Daten.  Da wir MySQL verwenden, ist das Beispiel MySQL - aber nichts hindert uns daran, eine Art Freundesdatenbank (PostgreSQL, Redis) zu verwenden. </p><br><p>  Wir nehmen das MySQL 5.7.14-Image aus der offiziellen Quelle mit unver√§ndertem Docker-Hub.  Das Bild, das f√ºr unsere Webanwendung verantwortlich ist, sammeln wir aus dem aktuellen Verzeichnis.  Er sammelt beim ersten Start ein Bild f√ºr uns.  Dann wird der Befehl gestartet, den wir hier ausf√ºhren.  Wenn wir zur√ºckgehen, werden wir sehen, dass der Startbefehl √ºber Puma definiert wurde.  Puma ist ein in Ruby geschriebener Dienst.  Im zweiten Fall definieren wir neu.  Dieser Befehl kann je nach unseren Anforderungen oder Aufgaben beliebig sein. </p><br><p>  Wir beschreiben auch, was Sie ben√∂tigen, um den Port auf unserem Host-Computer von 3000 auf 3000 Portcontainer weiterzuleiten.  Dies erfolgt automatisch mithilfe von iptables und eines eigenen Mechanismus, der direkt in Docker eingebettet ist. </p><br><p>  Der Entwickler kann nach wie vor eine beliebige verf√ºgbare IP-Adresse anwenden, z. B. 127.0.0.1 lokale oder externe IP-Adresse des Computers. </p><br><p>  Die letzte Zeile besagt, dass der Webcontainer vom Datenbankcontainer abh√§ngig ist.  Wenn wir den Start des Webcontainers aufrufen, startet Docker-Compose die Datenbank f√ºr uns.  Bereits zu Beginn der Datenbank (tats√§chlich nach dem Start des Containers! Dies garantiert nicht die Bereitschaft der Datenbank) starten wir eine Anwendung, unser Backend. </p><br><p>  Auf diese Weise k√∂nnen Sie Fehler vermeiden, wenn die Datenbank nicht ausgel√∂st wird, und Ressourcen sparen, wenn wir den Datenbankcontainer stoppen und die Ressourcen f√ºr andere Projekte freigeben. </p><br><p><img src="https://habrastorage.org/webt/s3/r1/9g/s3r19gc5pybevceyecewxzsdyxq.png"></p><br><p>  Was gibt uns die Verwendung der Docker-Datenbank f√ºr das Projekt.  Wir alle Entwickler korrigieren die Version von MySQL.  Auf diese Weise k√∂nnen Sie einige Fehler vermeiden, die bei unterschiedlichen Versionen auftreten k√∂nnen, wenn sich Syntax, Konfiguration und Standardeinstellungen √§ndern.  Auf diese Weise k√∂nnen Sie einen gemeinsamen Hostnamen f√ºr die Datenbank, die Anmeldung und das Kennwort angeben.  Wir entfernen uns von den Zoonamen und Konflikten in den Konfigurationsdateien, die fr√ºher waren. </p><br><p>  Wir k√∂nnen eine optimalere Konfiguration f√ºr die Entwicklungsumgebung verwenden, die sich von der Standardkonfiguration unterscheidet.  MySQL ist standardm√§√üig auf schwachen Computern konfiguriert und die sofort einsatzbereite Leistung ist sehr gering. </p><br><p><img src="https://habrastorage.org/webt/b2/qh/uz/b2qhuzt2zgbx5upj9etfnoilrnw.png"></p><br><p>  Mit Docker k√∂nnen Sie den Python-, Ruby-, NodeJS- und PHP-Interpreter der gew√ºnschten Version verwenden.  Wir m√ºssen keinen Versionsmanager mehr verwenden.  Zuvor verwendete Ruby das RPM-Paket, mit dem die Version je nach Projekt ge√§ndert werden konnte.  Auf diese Weise kann der Docker-Container auch Code reibungslos migrieren und zusammen mit Abh√§ngigkeiten versionieren.  Wir haben kein Problem damit, die Version sowohl des Interpreters als auch des Codes zu verstehen.  Um die Version zu aktualisieren, senken Sie den alten Container und heben Sie den neuen Container an.  Wenn etwas schief gelaufen ist, k√∂nnen wir den neuen Container absenken und den alten Container anheben. </p><br><p>  Nach dem Zusammenstellen des Bildes sind die Container in Entwicklung und Produktion identisch.  Dies gilt insbesondere f√ºr gro√üe Installationen. </p><br><p><img src="https://habrastorage.org/webt/c3/vy/yx/c3vyyxestdms3fuo6vqpst5hhus.png">  Im Frontend verwenden wir JavaScipt und NodeJS. </p><br><p>  Jetzt haben wir das neueste Projekt bei ReacJS.  Der Entwickler hat den gesamten Container ausgef√ºhrt und mithilfe von Hot-Reload entwickelt. </p><br><p>  Als n√§chstes wird die Aufgabe des Zusammenstellens von JavaScipt gestartet und der in der Statik gesammelte Code wird durch nginx-Speicherressourcen bereitgestellt. </p><br><p><img src="https://habrastorage.org/webt/6k/8y/ds/6k8yds401e1tmspqtvsnpv9hyq8.png"></p><br><p>  Hier habe ich ein Diagramm unseres letzten Projekts gegeben. </p><br><p>  Welche Aufgaben haben Sie gel√∂st?  Wir m√ºssen ein System aufbauen, mit dem mobile Ger√§te interagieren.  Sie bekommen Daten.  Eine der Optionen besteht darin, Push-Benachrichtigungen an dieses Ger√§t zu senden. </p><br><p>  Was haben wir daf√ºr getan? </p><br><p>  Wir haben in Anwendungskomponenten unterteilt, wie zum Beispiel: den Admin-Teil in JS, das Backend, das √ºber die REST-Schnittstelle unter Ruby on Rails funktioniert.  Das Backend interagiert mit der Datenbank.  Das generierte Ergebnis wird an den Client weitergegeben.  Der Administrator mit Backend und Datenbank interagiert √ºber die REST-Schnittstelle. </p><br><p>  Wir mussten auch Push-Benachrichtigungen senden.  Zuvor hatten wir ein Projekt, in dem ein Mechanismus implementiert wurde, der f√ºr die Zustellung von Benachrichtigungen an mobile Plattformen verantwortlich ist. </p><br><p>  Wir haben ein solches Schema entwickelt: Der Bediener des Browsers interagiert mit dem Admin-Panel, das Admin-Panel interagiert mit dem Backend, die Aufgabe besteht darin, Push-Benachrichtigungen zu senden. </p><br><p>  Push-Benachrichtigungen interagieren mit einer anderen Komponente, die auf NodeJS implementiert ist. </p><br><p>  Warteschlangen werden erstellt, und das Senden von Benachrichtigungen folgt einem eigenen Mechanismus. </p><br><p>  Hier werden zwei Datenbanken gezeichnet.  Derzeit verwenden wir mit Hilfe von Docker zwei unabh√§ngige Datenbanken, die in keiner Weise mit sich selbst verbunden sind.  Dar√ºber hinaus verf√ºgen sie √ºber ein gemeinsames virtuelles Netzwerk, und die physischen Daten werden in verschiedenen Verzeichnissen auf dem Computer des Entwicklers gespeichert. </p><br><p><img src="https://habrastorage.org/webt/7l/vd/iz/7lvdizkbaiozesiqkfy6zeu0ila.png"></p><br><p>  Das Gleiche, aber in Zahlen.  Die Wiederverwendung von Code ist hier wichtig. </p><br><p>  Wenn wir fr√ºher √ºber die Wiederverwendung von Code in Form von Bibliotheken gesprochen haben, wird in diesem Beispiel unser Dienst, der auf Push-Benachrichtigungen reagiert, als vollst√§ndiger Server wiederverwendet.  Es bietet eine API.  Und schon mit unserer Neuentwicklung interagiert damit. </p><br><p>  Zu diesem Zeitpunkt haben wir Version 4 von NodeJS verwendet.  Jetzt (in 2017 - Anmerkung. Hrsg.) In j√ºngsten Entwicklungen verwenden wir Version 7 von NodeJS.  Kein Problem bei neuen Komponenten, um neue Versionen von Bibliotheken anzuziehen. </p><br><p>  Bei Bedarf k√∂nnen Sie die NodeJS-Version des Push-Benachrichtigungsdienstes umgestalten und aktualisieren. </p><br><p>  Und wenn wir die API-Kompatibilit√§t beibehalten k√∂nnen, k√∂nnen wir sie durch andere Projekte ersetzen, die zuvor verwendet wurden. </p><br><p><img src="https://habrastorage.org/webt/wd/xv/4a/wdxv4acjvor1iz_4ay2iaxhwylg.png"></p><br><p>  Was ben√∂tigen Sie, um Docker hinzuzuf√ºgen?  F√ºgen Sie unserem Repository eine Docker-Datei hinzu, die die erforderlichen Abh√§ngigkeiten beschreibt.  In diesem Beispiel sind die Komponenten nach Logik unterteilt.  Dies ist eine minimale Anzahl von Backend-Entwicklern. </p><br><p>  Erstellen Sie beim Erstellen eines neuen Projekts eine Docker-Datei und beschreiben Sie das gew√ºnschte √ñkosystem (Python, Ruby, NodeJS).  Das Docker-Compose beschreibt die notwendige Abh√§ngigkeit - die Datenbank.  Wir beschreiben, dass wir eine Datenbank dieser und jener Version ben√∂tigen, um die Daten dort irgendwo zu speichern. </p><br><p>  Wir verwenden einen separaten dritten Container mit Nginx, um statisch zu rendern.  Sie k√∂nnen Bilder hochladen.  Das Backend legt sie in einem vorbereiteten Volume ab, das ebenfalls in einem Container mit Nginx montiert ist, der statisch ist. </p><br><p>  Um die Nginx- und MySQL-Konfiguration zu speichern, haben wir den Docker-Ordner hinzugef√ºgt, in dem wir die erforderlichen Konfigurationen speichern.  Wenn ein Entwickler ein Git-Klon-Repository auf seinem Computer erstellt, bereitet er bereits ein Projekt f√ºr die lokale Entwicklung vor.  Es stellt sich nicht die Frage, welcher Port oder welche Einstellungen angewendet werden sollen. </p><br><p><img src="https://habrastorage.org/webt/vx/by/f2/vxbyf2i8sss85npgtavlhvgoe10.png"></p><br><p>  Dar√ºber hinaus haben wir mehrere Komponenten: Admin, Inform-API, Push-Benachrichtigungen. </p><br><p>  Um alles auszuf√ºhren, haben wir ein weiteres Repository namens dockerized-app erstellt.  Derzeit verwenden wir mehrere Repositorys f√ºr jede Komponente.  Sie unterscheiden sich nur logisch - in GitLab sieht es aus wie ein Ordner und auf dem Entwicklercomputer wie ein Ordner f√ºr ein bestimmtes Projekt.  Eine Ebene darunter sind die Komponenten, die kombiniert werden. </p><br><p><img src="https://habrastorage.org/webt/jd/ny/wq/jdnywqfo2xha1huuqqmnhb1bvpm.png"></p><br><p>  Dies ist nur ein Beispiel f√ºr den Inhalt der Docker-App.  Wir bringen hier auch den Docker-Katalog mit, in dem wir die Konfigurationen eintragen, die f√ºr die Interaktion aller Komponenten erforderlich sind.  Es gibt README.md, in dem kurz beschrieben wird, wie ein Projekt gestartet wird. </p><br><p>  Hier haben wir zwei Docker-Compose-Dateien verwendet.  Dies geschieht, um schrittweise ausgef√ºhrt werden zu k√∂nnen.  Wenn ein Entwickler mit dem Kernel arbeitet, ben√∂tigt er keine Push-Benachrichtigungen. Dann startet er einfach die Docker-Compose-Datei und die Ressource wird entsprechend gespeichert. </p><br><p>  Wenn eine Integration mit Push-Benachrichtigungen erforderlich ist, werden docker-compose.yaml und docker-compose-push.yaml gestartet. </p><br><p>  Da sich docker-compose.yaml und docker-compose-push.yaml im Ordner befinden, wird automatisch ein einzelnes virtuelles Netzwerk erstellt. </p><br><p><img src="https://habrastorage.org/webt/hb/sj/ua/hbsjuao3tzaozzkhtv97lzhinn8.png"></p><br><p>  Beschreibung der Komponenten.  Dies ist eine erweiterte Datei, die f√ºr das Sammeln von Komponenten verantwortlich ist.  Was ist hier bemerkenswert?  Hier stellen wir die Balancer-Komponente vor. </p><br><p>  Dies ist ein vorgefertigtes Docker-Image, in dem nginx gestartet wird, und eine Anwendung, die den Docker-Socket abh√∂rt.  Dynamisch, wenn Container ein- und ausgeschaltet werden, wird die nginx-Konfiguration neu generiert.  Wir verteilen den Umgang mit Komponenten √ºber Domainnamen der dritten Ebene. </p><br><p>  F√ºr die Entwicklungsumgebung verwenden wir die .dev-Dom√§ne - api.informer.dev.  Anwendungen mit der .dev-Dom√§ne sind auf dem Computer des lokalen Entwicklers verf√ºgbar. </p><br><p>  Anschlie√üend werden Konfigurationen auf jedes Projekt √ºbertragen und alle Projekte gleichzeitig gestartet. </p><br><p><img src="https://habrastorage.org/webt/ew/i0/_u/ewi0_udkilodmivdjgfjoqt9try.png"></p><br><p>  Wenn grafisch dargestellt, stellt sich heraus, dass der Client unser Browser oder ein Tool ist, mit dem wir Anforderungen f√ºr den Balancer ausf√ºhren. </p><br><p>  Der Domain Name Balancer bestimmt, auf welchen Container zugegriffen werden soll. </p><br><p>  Es kann Nginx sein, das den JS-Administratorbereich angibt.  Dies kann nginx sein, das die API oder statische Dateien angibt, die nginx in Form von Ladebildern √ºbergeben werden. </p><br><p>  Das Diagramm zeigt, dass die Container √ºber ein virtuelles Netzwerk verbunden und hinter dem Proxy versteckt sind. </p><br><p>  Auf dem Computer des Entwicklers k√∂nnen Sie sich an den Container wenden, der die IP kennt, aber wir verwenden diese grunds√§tzlich nicht.  Der Bedarf an direkter Behandlung entsteht praktisch nicht. </p><br><p><img src="https://habrastorage.org/webt/6j/wa/af/6jwaaff9m7e_lwmgvxi88fxxkbi.png"></p><br><p>  Welches Beispiel sollte verwendet werden, um die Anwendung anzudocken?  Meiner Meinung nach ist das offizielle Docker-Image f√ºr MySQL ein gutes Beispiel. </p><br><p>  Es ist ziemlich kompliziert.  Es gibt viele Versionen.  Dank seiner Funktionalit√§t k√∂nnen Sie jedoch viele Anforderungen abdecken, die im Verlauf der Weiterentwicklung auftreten k√∂nnen.  Wenn Sie Zeit verbringen und herausfinden, wie all dies zusammenwirkt, werden Sie wahrscheinlich keine Probleme bei der Selbstimplementierung haben. </p><br><p>  In hub.docker.com gibt es normalerweise Links zu github.com, die Rohdaten direkt bereitstellen, aus denen Sie das Bild selbst zusammenstellen k√∂nnen. </p><br><p>  Weiter in diesem Repository befindet sich das Skript docker-endpoint.sh, das f√ºr die Erstinitialisierung und die weitere Verarbeitung des Anwendungsstarts verantwortlich ist. </p><br><p>  Auch in diesem Beispiel besteht die M√∂glichkeit der Konfiguration mithilfe von Umgebungsvariablen.  Durch Definieren der Umgebungsvariablen beim Starten eines einzelnen Containers oder √ºber Docker-Compose k√∂nnen wir sagen, dass wir ein leeres Kennwort f√ºr Docker f√ºr Root in MySQL festlegen m√ºssen oder was auch immer wir wollen. </p><br><p>  Es besteht die M√∂glichkeit, ein zuf√§lliges Passwort zu erstellen.  Wir sagen, wir brauchen einen Benutzer, wir m√ºssen ein Passwort f√ºr den Benutzer festlegen und wir m√ºssen eine Datenbank erstellen. </p><br><p>  In unseren Projekten haben wir das Dockerfile, das f√ºr die Initialisierung verantwortlich ist, leicht vereinheitlicht.  Dort haben wir unsere Anforderungen korrigiert, um nur eine Erweiterung der Benutzerrechte vorzunehmen, die die Anwendung verwendet.  Dies erm√∂glichte es in Zukunft, einfach eine Datenbank √ºber die Anwendungskonsole zu erstellen.  Ruby-Anwendungen verf√ºgen √ºber einen Befehl zum Erstellen, √Ñndern und L√∂schen von Datenbanken. </p><br><p><img src="https://habrastorage.org/webt/sj/cn/jy/sjcnjytvgchv17vawenbd66upls.png"></p><br><p>  Dies ist ein Beispiel daf√ºr, wie eine bestimmte Version von MySQL auf github.com aussieht.  Sie k√∂nnen die Docker-Datei √∂ffnen und sehen, wie die Installation dort abl√§uft. </p><br><p>  Skript docker-endpoint.sh, das f√ºr den Einstiegspunkt verantwortlich ist.  W√§hrend der Erstinitialisierung sind einige Vorbereitungsschritte erforderlich, und alle diese Aktionen werden nur f√ºr das Initialisierungsskript ausgef√ºhrt. </p><br><p><img src="https://habrastorage.org/webt/7h/z4/hy/7hz4hyunbt1ftm38hf9lnmesv3q.png"></p><br><p>  Wir gehen zum zweiten Teil √ºber. </p><br><p>  Um den Quellcode zu speichern, haben wir zu gitlab gewechselt.  Dies ist ein ziemlich leistungsf√§higes System mit einer visuellen Oberfl√§che. </p><br><p>  Eine der Komponenten von Gitlab ist Gitlab CI.  Hier k√∂nnen Sie die Folgebefehle beschreiben, die anschlie√üend verwendet werden, um ein Code√ºbermittlungssystem zu organisieren oder automatische Tests durchzuf√ºhren. </p><br><p>  Bericht √ºber Gitlab CI 2 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://goo.gl/uohKjI</a> - ein Bericht des Ruby Russia Clubs - ziemlich detailliert und vielleicht wird es Sie interessieren. </p><br><p><img src="https://habrastorage.org/webt/9f/s8/pk/9fs8pkzbqq4uozrmd2bu4tq0-dg.png"></p><br><p>  Nun werden wir uns √ºberlegen, was zur Aktivierung von Gitlab CI erforderlich ist.  Um Gitlab CI zu starten, reicht es aus, die Datei .gitlab-ci.yml im Stammverzeichnis des Projekts abzulegen. </p><br><p>  Hier beschreiben wir, dass wir eine Folge von Zust√§nden wie test, deploy ausf√ºhren m√∂chten. </p><br><p>  Wir f√ºhren Skripte aus, die Docker-Compose direkt aufrufen und die Assembly unserer Anwendung zusammenstellen.  Dies ist nur ein Beispiel f√ºr ein Backend. </p><br><p>  Als n√§chstes sagen wir, dass es notwendig ist, Migrationen voranzutreiben, um die Datenbank zu √§ndern und Tests auszuf√ºhren. </p><br><p>  Wenn die Skripte korrekt ausgef√ºhrt werden und keinen Fehlercode zur√ºckgeben, f√§hrt das System dementsprechend mit der zweiten Stufe der Bereitstellung fort. </p><br><p>  Die Bereitstellungsphase ist derzeit f√ºr die Bereitstellung implementiert.  Wir haben keinen reibungslosen Neustart organisiert. </p><br><p>  Wir l√∂schen alle Beh√§lter gewaltsam aus und heben dann alle Beh√§lter wieder an, die in der ersten Phase w√§hrend des Tests gesammelt wurden. </p><br><p>  Wir f√ºhren es f√ºr die aktuelle variable Umgebung der Datenbankmigration aus, die von den Entwicklern geschrieben wurde. </p><br><p>  Es gibt einen Hinweis, der dies nur auf den Hauptzweig anwendet. </p><br><p>  Beim √Ñndern anderer Zweige wird nicht ausgef√ºhrt. </p><br><p>  Es ist m√∂glich, Rollouts in Filialen zu organisieren. </p><br><p><img src="https://habrastorage.org/webt/2x/vc/6t/2xvc6tp0zrtrewnpnekatolnipm.png"></p><br><p>  Um dies weiter zu organisieren, m√ºssen wir Gitlab Runner installieren. </p><br><p>  Dieses Dienstprogramm ist in Golang geschrieben.  Es ist eine einzelne Datei, wie es in der Golang-Welt √ºblich ist, f√ºr die keine Abh√§ngigkeiten erforderlich sind. </p><br><p>  Beim Start registrieren wir den Gitlab Runner. </p><br><p>  Wir bekommen den Schl√ºssel in der Weboberfl√§che von Gitlab. </p><br><p>  Dann rufen wir den Befehl init in der Befehlszeile auf. </p><br><p>  Konfigurieren Sie Gitlab Runner im Dialogmodus (Shell, Docker, VirtualBox, SSH). </p><br><p>  Der Code auf Gitlab Runner wird bei jedem Commit ausgef√ºhrt, abh√§ngig von der Einstellung .gitlab-ci.yml. </p><br><p><img src="https://habrastorage.org/webt/jj/nx/c-/jjnxc-msfkvaey7qs-t6n3kbzww.png"></p><br><p>  Wie es in Gitlab in einer Weboberfl√§che visuell aussieht.  Nach dem Verbinden von GItlab CI wird ein Flag angezeigt, das den aktuellen Status des Builds anzeigt. </p><br><p>  Wir sehen, dass vor 4 Minuten ein Commit durchgef√ºhrt wurde, das alle Tests bestanden hat und keine Probleme verursachte. </p><br><p><img src="https://habrastorage.org/webt/da/vg/3h/davg3h0aqnoewa2xlu3eebuz5jg.png"></p><br><p>  Wir k√∂nnen uns Builds genauer ansehen.  Hier sehen wir, dass zwei Staaten bereits vergangen sind.  Teststatus und Bereitstellungsstatus beim Staging. </p><br><p>  Wenn wir auf einen bestimmten Build klicken, wird eine Konsolenausgabe der Befehle angezeigt, die im Prozess gem√§√ü .gitlab-ci.yml gestartet wurden. </p><br><p><img src="https://habrastorage.org/webt/dg/zq/a5/dgzqa5difiuz1yw0e4i99jzgfik.png"></p><br><p>  So sieht die Geschichte unseres Produkts aus.  Wir sehen, dass es erfolgreiche Versuche gab.  Wenn Tests eingereicht werden, wird nicht mit dem n√§chsten Schritt fortgefahren, und der Code f√ºr die Bereitstellung wird nicht aktualisiert. </p><br><p><img src="https://habrastorage.org/webt/cp/g9/rv/cpg9rvvjttpmkvdmi-ve-ugtoh0.png"></p><br><p>  Welche Aufgaben haben wir beim Staging gel√∂st, als wir Docker eingef√ºhrt haben?           ,   ,     ,     . </p><br><p>         . </p><br><p>              Docker-compose           . </p><br><p>    ,     Docker .  Docker-compose        . </p><br><p>    ,           . </p><br><p>   ‚Äî   staging   . </p><br><p>            production   80  443 ,     WEB. </p><br><p><img src="https://habrastorage.org/webt/7w/4n/_d/7w4n_dfgts6p7pxijvb6eznq0m0.png"></p><br><p>    ?    Gitlab Runner   . </p><br><p> Gitlab     Gitlab Runner,    -      ,  . </p><br><p>             Gitlab Runner,       . </p><br><p>   nginx-proxy           . </p><br><p>      ,        .       . </p><br><p>        80      ,    . </p><br><p><img src="https://habrastorage.org/webt/az/ke/y8/azkey8kpxp3ruww8fbdc1bnfowk.png"></p><br><p>    ?           root.  root  root  . </p><br><p>     ,    root  ,         root. </p><br><p>         - ,   ,    ,        ,     . </p><br><p>    ?   ,    . </p><br><p>   ,    ? </p><br><p>        ID  (UID)  ID  (GID). </p><br><p>           ID 1000. </p><br><p>               Ubuntu.    Ubuntu    ID 1000. </p><br><p><img src="https://habrastorage.org/webt/wx/th/35/wxth352n7tza8gkpdfcmtaern3m.png"></p><br><p>    ? </p><br><p>    Docker.   ,  . ,    -  ,   . </p><br><p>  ,         . </p><br><p>         . </p><br><p>       Docker    Docker Swarm,    .   -     Docker Swarm. </p><br><p>       .   .    .          web-. </p><br><p><img src="https://habrastorage.org/webt/k8/uh/lw/k8uhlwuir8yffyugvdrupropoba.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de449742/">https://habr.com/ru/post/de449742/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de449722/index.html">Eckeffekte</a></li>
<li><a href="../de449724/index.html">Stahlliquidatoren</a></li>
<li><a href="../de449728/index.html">Verkehr oder Verschl√ºsselung des Verkehrs in Direct Connect, Teil 3</a></li>
<li><a href="../de449730/index.html">Kryptow√§hrung: lebt oder stirbt? Teil 2. Politische und wirtschaftliche Trends</a></li>
<li><a href="../de449740/index.html">Wir schauen uns ‚ÄûFenster zur Stadt‚Äú in hoher Qualit√§t an</a></li>
<li><a href="../de449744/index.html">Globales Zwischenspeichern von Abfrageergebnissen in ASP.NET CORE</a></li>
<li><a href="../de449746/index.html">DockerHub gehackt</a></li>
<li><a href="../de449748/index.html">Wer ist wer in Open Source - Teil 2: Geek-Biografien</a></li>
<li><a href="../de449750/index.html">Ein offenes Netzwerk√ºberwachungstool mit IoT-Ger√§ten</a></li>
<li><a href="../de449752/index.html">Selbstgemachte Magnetkarten f√ºr Taschenrechner Casio PRO fx-1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>