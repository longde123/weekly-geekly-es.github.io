<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐅 👴 🚴🏼 Comment économiser de la mémoire sur les onglets du navigateur, mais ne pas perdre leur contenu. L'expérience de l'équipe Yandex.Browser 🧑🏿‍🤝‍🧑🏽 ☹️ 👩🏼‍🤝‍👨🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lorsque les navigateurs manquent de mémoire, ils en déchargent les onglets les plus anciens. C'est ennuyeux car cliquer sur un tel onglet force le rec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment économiser de la mémoire sur les onglets du navigateur, mais ne pas perdre leur contenu. L'expérience de l'équipe Yandex.Browser</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/423507/"> Lorsque les navigateurs manquent de mémoire, ils en déchargent les onglets les plus anciens.  C'est ennuyeux car cliquer sur un tel onglet force le rechargement d'une page.  Aujourd'hui, nous expliquerons aux lecteurs de Habr comment l'équipe Yandex.Browser résout ce problème en utilisant la technologie Hibernate. <br><br>  Les navigateurs à base de chrome créent un processus pour chaque onglet.  Cette approche présente de nombreux avantages.  Il s'agit de la sécurité (isolement des sites les uns des autres), de la stabilité (le plantage d'un processus ne fait pas glisser tout le navigateur) et l'accélération du travail sur les processeurs modernes avec un grand nombre de cœurs.  Mais il y a aussi un inconvénient - une consommation de mémoire plus élevée que lors de l'utilisation d'un processus pour tout.  Si les navigateurs ne faisaient rien avec cela, leurs utilisateurs verraient constamment quelque chose comme ceci: <br><br><img src="https://habrastorage.org/webt/s6/b-/yc/s6b-yc753-ksq2bjrj2n4_xm_z8.png"><br><br>  Dans le projet Chromium, ils luttent avec la consommation de mémoire des onglets d'arrière-plan en effaçant divers caches.  Il ne s'agit pas du cache dans lequel les images des pages chargées sont stockées.  Il n'y a aucun problème avec lui - il vit sur le disque dur.  Dans un navigateur moderne, de nombreuses autres informations mises en cache sont stockées dans la RAM. <br><br>  De plus, Chromium travaille depuis un certain temps pour arrêter les temporisateurs JS dans les onglets d'arrière-plan.  Sinon, vider les caches n'a aucun sens, car  les activités des onglets d'arrière-plan les restaurent.  On pense que si les sites veulent travailler en arrière-plan, vous devez utiliser un technicien de service, pas des minuteries. <br><br><a name="habracut"></a>  Si ces mesures ne vous aident pas, il ne reste qu'une chose: décharger le processus de rendu des onglets de la mémoire.  Un site ouvert cesse simplement d'exister.  Si vous basculez vers l'onglet, le téléchargement commence à partir du réseau.  S'il y avait une vidéo de pause dans l'onglet, la lecture commencera depuis le début.  Si le formulaire a été rempli sur la page, les informations saisies peuvent être perdues.  Si une application JS lourde fonctionnait dans l'onglet, vous devrez la redémarrer. <br><br>  Le problème du déchargement des onglets est particulièrement désagréable lorsqu'il n'y a pas d'accès au réseau.  Avez-vous reporté un onglet avec Habr pour lire à bord d'un avion?  Soyez prêt qu'un article utile deviendra une citrouille. <br><br>  Les développeurs de navigateurs comprennent que cette mesure extrême est agaçante pour les utilisateurs (il suffit de se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tourner vers la recherche</a> pour estimer l'étendue), ils l'appliquent donc au dernier moment.  À l'heure actuelle, l'ordinateur ralentit déjà en raison d'un manque de mémoire, les utilisateurs le remarquent et recherchent d'autres moyens de résoudre le problème.Par exemple, l'extension <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Great Suspender</a> compte plus de 1,4 million d'utilisateurs. <br><br>  Les gens veulent que les navigateurs et la mémoire soient enregistrés, et ils ne commencent pas à ralentir.  Pour ce faire, les onglets ne doivent pas être déchargés au dernier moment, mais un peu plus tôt.  Et pour cela, vous devez arrêter de perdre le contenu des onglets, c'est-à-dire  rendre le processus d'économie invisible.  Mais alors, sur quoi économiser?  Le cercle est fermé.  Mais une solution a été trouvée. <br><br><h2>  Hibernation sur le navigateur Yandex </h2><br>  De nombreux lecteurs Habr pourraient déjà deviner quoi effacer la mémoire, mais enregistrer l'état de l'onglet est tout à fait possible si vous déchargez d'abord l'état sur le disque dur.  Si vous cliquez sur un onglet pour restaurer l'onglet à partir du disque dur, l'utilisateur ne remarquera rien. <br><br>  Notre équipe est impliquée dans le développement du projet Chromium, où il envoie d'importantes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modifications d'optimisation</a> et de nouvelles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctionnalités</a> .  En 2015, nous avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">discuté</a> avec des collègues du projet de l'idée de maintenir l'état des onglets sur le disque dur et avons même réussi à apporter un certain nombre d'améliorations, mais ils ont décidé de geler cette direction dans Chromium.  Nous avons décidé différemment et avons poursuivi le développement de Yandex.Browser.  Cela a pris plus de temps que prévu, mais cela en valait la peine.  Ci-dessous, nous parlerons du bourrage technique de la technologie Hibernate, mais pour l'instant, commençons par la logique générale. <br><br>  Plusieurs fois par minute, Yandex.Browser vérifie la quantité de mémoire disponible, et si elle est inférieure à la valeur seuil de 600 mégaoctets, Hibernate entre en jeu.  Tout commence par le fait que le navigateur trouve l'onglet d'arrière-plan le plus ancien (à utiliser).  Soit dit en passant, l'utilisateur moyen a 7 onglets ouverts, mais 5% en ont plus de 30. <br><br>  Vous ne pouvez pas décharger un ancien onglet de la mémoire - vous pouvez casser quelque chose de vraiment important.  Par exemple, jouer de la musique ou discuter dans un messager Web.  Il existe actuellement 28 exceptions de ce type. Si l'onglet ne correspondait pas à au moins l'une d'entre elles, le navigateur passe à la vérification suivante. <br><br>  Si un onglet est trouvé qui répond aux exigences, le processus de sauvegarde commence. <br><br><h2>  Enregistrement et restauration d'onglets dans Hibernate </h2><br>  Toute page peut être divisée en deux grandes parties, associées aux moteurs V8 (JS) et Blink (HTML / DOM).  Prenons un petit exemple: <br><br><pre><code class="javascript hljs">&lt;html&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="javascript"><span class="xml"><span class="javascript"> </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function"> </span></span></span><span class="hljs-title"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-title">onLoad</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"></span><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span></span><span class="xml"><span class="javascript">{ </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> div = </span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">document</span></span></span></span><span class="xml"><span class="javascript">.createElement(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"div"</span></span></span></span><span class="xml"><span class="javascript">); div.textContent = </span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"Look ma, I can set div text"</span></span></span></span><span class="xml"><span class="javascript">; </span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">document</span></span></span></span><span class="xml"><span class="javascript">.body.appendChild(div); } </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;body onload=<span class="hljs-string"><span class="hljs-string">"onLoad()"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/html&gt;</span></span></code> </pre> <br><br>  Nous avons un arbre DOM et un petit script qui ajoute simplement un div au corps.  Du point de vue de Blink, cette page ressemble à ceci: <br><br><img src="https://habrastorage.org/webt/rt/tk/am/rttkamwsawvme_06mcommdyiqky.png"><br><br>  Examinons la relation entre Blink et V8 à l'aide de l'exemple HTMLBodyElement: <br><br><img src="https://habrastorage.org/webt/yb/rr/-b/ybrr-bppoiru848txkj63eplpne.png"><br><br>  Vous pouvez remarquer que Blink et V8 ont des représentations différentes des mêmes entités et sont étroitement liés les uns aux autres.  Nous sommes donc arrivés à l'idée originale: enregistrer l'état complet de la V8 et que Blink ne stocke que les attributs HTML sous forme de texte.  Mais c'était une erreur, car nous avons perdu ces états d'objets DOM qui n'étaient pas stockés dans des attributs.  Nous avons également perdu des états qui n'étaient pas stockés dans le DOM.  La solution à ce problème était de sauver complètement Blink.  Mais pas si simple. <br><br>  Vous devez d'abord collecter des informations sur les objets Blink.  Par conséquent, au moment de l'enregistrement de la V8, nous arrêtons non seulement JS et le castons, mais nous collectons également des références aux objets DOM et autres objets auxiliaires disponibles pour JS en mémoire.  Nous parcourons également tous les objets accessibles depuis les objets Document - les éléments racine de chaque cadre de page.  Nous collectons donc des informations sur tout ce qui est important à préserver.  La partie la plus difficile est d'apprendre à économiser. <br><br>  Si nous comptons toutes les classes Blink qui représentent l'arborescence DOM, ainsi que différentes API HTML5 (par exemple, canvas, media, géolocalisation), nous obtenons des milliers de classes.  Il est presque impossible d'écrire la logique de sauvegarde de toutes les classes avec vos mains.  Mais le pire, c'est que même si vous faites cela, il sera impossible à maintenir, car nous mettons régulièrement à jour de nouvelles versions de Chromium qui apportent des modifications inattendues à n'importe quelle classe. <br><br>  Notre navigateur pour toutes les plateformes est construit en utilisant clang.  Pour résoudre le problème de la préservation des classes Blink, nous avons créé un plugin pour clang, qui construit un AST (arbre de syntaxe abstraite) pour les classes.  Par exemple, ce code: <br><br><div class="spoiler">  <b class="spoiler_title">Code de classe</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bar</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> foo_namespace::Foo { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarInternal</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> int_field_; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> float_field_; } bar_internal_field_; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> string_field_; };</code> </pre> <br></div></div><br>  Il se transforme en un tel XML: <br><br><div class="spoiler">  <b class="spoiler_title">Le résultat du plugin en XML</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>bar_namespace::Bar::BarInternal<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_union</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_union</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_abstract</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_abstract</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">decl_source_file</span></span></span><span class="hljs-tag">&gt;</span></span>src/bar.h<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">decl_source_file</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base_class_names</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base_class_names</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fields</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>int_field_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">builtin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_const</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_const</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>int<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">builtin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>float_field_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">builtin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_const</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_const</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>float<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">builtin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>bar_namespace::Bar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_union</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_union</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_abstract</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_abstract</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">decl_source_file</span></span></span><span class="hljs-tag">&gt;</span></span>src/bar.h<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">decl_source_file</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base_class_names</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class_name</span></span></span><span class="hljs-tag">&gt;</span></span>foo_namespace::Foo<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base_class_names</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fields</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>bar_internal_field_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_const</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_const</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>bar_namespace::Bar::BarInternal<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>string_field_<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_const</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is_const</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>std::string<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fields</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  De plus, d'autres scripts écrits par nous génèrent du code C ++ à partir de ces informations pour enregistrer et restaurer des classes, qui tombe dans l'assembly Yandex.Browser. <br><br><div class="spoiler">  <b class="spoiler_title">Code de sauvegarde C ++ obtenu par script à partir de XML</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serialize_bar_namespace_Bar_BarInternal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( WriteVisitor* writer, Bar::BarInternal* instance)</span></span></span><span class="hljs-function"> </span></span>{ writer-&gt;WriteBuiltin&lt;<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>&gt;(instance-&gt;int_vector_field_.size()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; item : instance-&gt;int_vector_field_) { writer-&gt;WriteBuiltin&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(item); } writer-&gt;WriteBuiltin&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;(instance-&gt;float_field_); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serialize_bar_namespace_Bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WriteVisitor* writer, Bar* instance)</span></span></span><span class="hljs-function"> </span></span>{ serialize_foo_namespace_Foo(writer, instance); serialize_bar_namespace_Bar_BarInternal( writer, &amp;instance-&gt;bar_internal_field_); writer-&gt;WriteString(instance-&gt;string_field_); }</code> </pre> <br></div></div><br>  Au total, nous générons du code pour environ 1000 classes Blink.  Par exemple, nous avons appris à enregistrer une classe aussi complexe que Canvas.  Vous pouvez en dessiner dans le code JS, définir de nombreuses propriétés, définir des paramètres de pinceau pour le dessin, etc.  Nous sauvegardons toutes ces propriétés, paramètres et l'image elle-même. <br><br>  Après avoir correctement chiffré et enregistré toutes les données sur le disque dur, le processus de tabulation est déchargé de la mémoire jusqu'à ce que l'utilisateur revienne à cet onglet.  Dans l'interface, comme précédemment, il ne se démarque pas. <br><br>  La récupération des onglets n'est pas instantanée, mais beaucoup plus rapide que lors du téléchargement depuis le réseau.  Néanmoins, nous avons fait un geste délicat afin de ne pas déranger les utilisateurs avec des flashs d'un écran blanc.  Nous montrons une capture d'écran de la page créée pendant la phase de sauvegarde.  Cela permet de faciliter la transition.  Sinon, le processus de récupération est similaire à la navigation normale, la seule différence étant que le navigateur ne fait pas de demande réseau.  Il recrée la structure de trame et les arborescences DOM qu'ils contiennent, puis remplace l'état de V8. <br><br>  Nous avons enregistré une vidéo avec une démonstration claire de la façon dont Hibernate décharge et restaure les onglets de clic tout en préservant la progression dans le jeu JS saisie dans la position du texte et de la vidéo: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/T6Gtc1TVAdM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Résumé </h2><br>  Dans un avenir proche, la technologie Hibernate sera disponible pour tous les utilisateurs de Yandex.Browser pour Windows.  Nous prévoyons également de commencer à l'expérimenter dans la version alpha pour Android.  Avec lui, le navigateur économise la mémoire plus efficacement qu'auparavant.  Par exemple, pour les utilisateurs avec un grand nombre d'onglets ouverts, Hibernate enregistre en moyenne plus de 330 mégaoctets de mémoire et ne perd pas d'informations dans les onglets, qui restent accessibles en un clic dans n'importe quelle condition de réseau.  Nous comprenons qu'il serait utile que les webmasters envisagent de décharger les onglets d'arrière-plan, nous prévoyons donc de prendre en charge l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API Page Lifecycle</a> . <br><br>  Hibernate n'est pas notre seule solution visant à économiser des ressources.  Ce n'est pas la première année que nous travaillons pour nous assurer que le navigateur s'adapte aux ressources disponibles dans le système.  Par exemple, sur les appareils faibles, le navigateur passe en mode simplifié et lorsque l'ordinateur portable est déconnecté de la source d'alimentation, il réduit la consommation d'énergie.  Économiser des ressources est une histoire grande et compliquée, sur laquelle nous reviendrons certainement à Habré. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423507/">https://habr.com/ru/post/fr423507/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423497/index.html">Essayons de parler des machines à états hiérarchiques en général et de leur support dans SObjectizer-5 en particulier</a></li>
<li><a href="../fr423499/index.html">DevBoy - comment j'ai créé un projet d'appareil open source et lancé un projet sur Kickstarter</a></li>
<li><a href="../fr423501/index.html">Recherche et création de style visuel pour un projet de design</a></li>
<li><a href="../fr423503/index.html">Mon expérience de déménagement, de vie et d'études en Allemagne</a></li>
<li><a href="../fr423505/index.html">Zuckerberg vend des actions Facebook pour 13 milliards de dollars afin que «nos enfants ne tombent jamais malades»</a></li>
<li><a href="../fr423511/index.html">Interception de l'installation de Firefox et Chrome sur Windows 10</a></li>
<li><a href="../fr423513/index.html">Nous économisons sur un contrôleur RAID, ou comment nourrir Varia avec Iops</a></li>
<li><a href="../fr423515/index.html">Est-ce que DRY est bon ou peut-il casser O de SOLID</a></li>
<li><a href="../fr423519/index.html">Monstre errant: comment se débarrasser des problèmes sur la carte</a></li>
<li><a href="../fr423521/index.html">Sept règles de base pour expérimenter avec des sites Web</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>