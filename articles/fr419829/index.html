<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦇 🚴🏽 🧑🏽‍🤝‍🧑🏻 Le chiffrement de clé par défaut d'OpenSSH est pire que rien 👩‍👧‍👧 👈🏾 🧘🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les auteurs de cet article s'opposent aux mécanismes de cryptage de clé standard dans OpenSSH. 


 Les attaquants ont récemment utilisé le package npm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Le chiffrement de clé par défaut d'OpenSSH est pire que rien</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wirex/blog/419829/">  <i>Les auteurs de cet article s'opposent aux mécanismes de cryptage de clé standard dans OpenSSH.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6k/km/om/6kkmom9aovguj47f3092gm95xlw.jpeg"></div><br>  Les attaquants ont récemment utilisé le package npm eslint-scope pour voler des jetons npm dans les répertoires personnels des utilisateurs.  À la lumière de cet événement, nous avons commencé à vérifier d'autres vulnérabilités similaires et réfléchi à la manière de réduire les risques et les conséquences de tels incidents. <br><br>  La plupart d'entre nous ont une clé RSA SSH sous la main.  Cette clé donne au propriétaire une variété de privilèges: en règle générale, elle est utilisée pour accéder à l'environnement de production ou dans GitHub.  Contrairement aux jetons nmp, les clés SSH sont cryptées, et il est donc généralement admis que rien de mauvais ne se produira, même si elles tombent entre de mauvaises mains.  Mais est-ce vraiment le cas?  Voyons. <a name="habracut"></a><br><br><blockquote><code>user@work /tmp $ ssh-keygen <br> Generating public/private rsa key pair. <br> Enter file in which to save the key (/home/user/.ssh/id_rsa): mykey <br> ... <br> user@work /tmp $ head -n 5 mykey <br> -----BEGIN RSA PRIVATE KEY----- <br> Proc-Type: 4,ENCRYPTED <br> DEK-Info: AES-128-CBC,CB973D5520E952B8D5A6B86716C6223F <br> <br> +5ZVNE65kl8kwZ808e4+Y7Pr8IFstgoArpZJ/bkOs7rB9eAfYrx2CLBqLATk1RT/</code> </blockquote> <br>  Cette clé est cryptée, comme indiqué par l'une des premières lignes du fichier.  De plus, au début, il n'y a pas de clé de codage MII - base64 utilisée dans RSA.  Et, bien sûr, AES attire votre attention!  C'est bon, non?  Et CBC, à première vue, avec un vecteur d'initialisation aléatoire.  Il n'y a pas de code d'authentification (MAC).  Eh bien, il n'y aura pas d'attaque oracle de rembourrage, non? <br><br>  Découvrir ce que signifie réellement le contenu de DEK-Info n'est pas si simple.  Une recherche du mot-clé «DEK-Info» dans le référentiel openssh-portable ne montre que des exemples de clés.  Mais le fait est que la clé AES n'est rien d'autre qu'un simple hachage MD5 (mot de passe || vecteur d'initialisation [: 8]).  Et c'est mauvais, car les meilleures pratiques pour le stockage des mots de passe disent que les mots de passe sous leur forme pure, en raison de leur faible entropie, sont de mauvais supports de chiffrement.  Et pour le rendre meilleur, vous avez besoin d'une fonction coûteuse comme Argon2.  Mais MD5, contrairement à ce dernier, est facile à calculer. <br><br>  Le seul point positif de ce schéma est que le sel est placé après le mot de passe, par conséquent, il ne fonctionnera pas pour calculer l'état intermédiaire MD5 (IV [8:]) et trouver les mots de passe en fonction de celui-ci.  Mais ce n'est pas une grande consolation, en particulier à une époque où des machines qui effectuent des milliards d'appels MD5 par seconde sont à notre disposition - plus que des mots de passe ne peuvent arriver. <br><br>  Vous vous demandez peut-être comment OpenSSH a vécu pour voir cela.  Hélas, la réponse est simple: l'outil de ligne de commande OpenSSL utilisait initialement ce schéma par défaut, et il est simplement devenu la norme. <br><br>  En fin de compte, il devient vrai que les clés standard cryptées par mot de passe ne valent pas mieux que les clés ordinaires non cryptées simplement parce que le mécanisme de cryptage est inefficace.  Cependant, nous parlerions encore plus audacieux - ils sont pires.  Et c'est facile de discuter. <br><br>  Il est peu probable que de nombreuses personnes utilisent un gestionnaire de mots de passe pour stocker le mot de passe de la clé SSH.  Au contraire, l'utilisateur s'en souviendra simplement.  Et, comme il s'agit de l'une des combinaisons mémorisées, il est probable que l'utilisateur l'ait déjà utilisée ailleurs.  Peut-être qu'il correspond même au mot de passe utilisateur de l'appareil.  Il est tout à fait possible de le deviner (sa fonction formatrice est trop peu fiable), et si le mot de passe est connu, vous pouvez probablement le vérifier avec la clé publique. <br><br>  Il n'y a rien à redire sur la paire de clés RSA elles-mêmes: la seule question est les méthodes de cryptage symétrique de la clé privée.  Il est impossible de réaliser l'attaque décrite ci-dessus, en ne connaissant que la clé publique. <br><br><h3>  Comment puis-je régler la situation? </h3><br>  OpenSSH fournit un nouveau format de clé à utiliser.  Par nouveau, on entend introduit en 2013.  Ce format utilise bcrypt_pbkdf, qui est essentiellement un bcrypt à complexité fixe implémenté sous la norme PBKDF2. <br><br>  De manière pratique, vous recevez automatiquement une clé dans un nouveau format lors de la génération de clés Ed25519, car l'ancien format de clé SSH ne prend pas en charge les nouveaux types de clés.  C'est assez étrange, car en fait, nous n'avons pas vraiment besoin du format de clé pour déterminer comment fonctionne la sérialisation Ed25519, car l'Ed25519 lui-même définit le travail de sérialisation.  Mais si vous avez vraiment besoin d'une bonne fonction formatrice, vous ne pouvez pas vous embêter avec de telles bagatelles.  Par conséquent, l'une des réponses est <i>ssh-keygen -t ed25519</i> . <br><br>  Si, pour des raisons de compatibilité, vous devez adhérer à RSA, vous pouvez utiliser ssh-keygen -o.  Ainsi, un nouveau format peut être obtenu même pour les anciens types de clés.  Vous pouvez mettre à jour les anciennes clés avec la commande <i>ssh-keygen -p -o -f key name</i> .  Si vos clés vivent sur Yubikey ou sur des cartes à puce, ces modifications ont déjà été prises en compte. <br><br>  D'une manière ou d'une autre, nous visons une sortie plus optimale.  D'une part, il existe un bon exemple d'aws-vault, dans lequel les informations d'identification ont été déplacées du disque vers les trousseaux.  Il existe une autre approche: déplacer le développement vers des environnements partagés.  Enfin, la plupart des startups devraient envisager d'abandonner le stockage à long terme des clés SSH et de passer à un centre de certification SSH avec un temps de stockage des clés limité couplé à un système d'authentification unique.  Malheureusement, dans le cas de GitHub, cette approche n'est pas possible. <br><br>  <b>PS</b> Il est difficile de vérifier ces informations dans une source faisant autorité, mais si la mémoire nous sert bien, le paramètre versionné dans les clés privées du format OpenSSH PEM affecte uniquement la méthode de cryptage.  Cependant, cela ne joue aucun rôle: le problème est la fonction de formation des clés, et nous pensons que c'est un autre argument contre la discussion des protocoles en plusieurs parties.  Il y aura un article séparé sur ce sujet dans notre blog. <br><br>  Et enfin - un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> vers la clé complète.  C'est au cas où vous êtes prêt à pirater quoi que ce soit aujourd'hui. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/4bd/bf6/597/4bdbf659775744b1bdbb4d8a00a0a980.png" alt="image"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419829/">https://habr.com/ru/post/fr419829/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419815/index.html">Secrets de tolérance aux fautes de notre front office</a></li>
<li><a href="../fr419817/index.html">Lancement du cluster RabbitMQ dans Kubernetes</a></li>
<li><a href="../fr419819/index.html">Biomarqueurs du vieillissement. Panel de fragilité. 2e partie</a></li>
<li><a href="../fr419823/index.html">Duo insolite - phrases de passe et images mnémoniques</a></li>
<li><a href="../fr419825/index.html">Test des performances de plusieurs types de disques dans un environnement virtuel</a></li>
<li><a href="../fr419831/index.html">Fonctionnement de JS: éléments personnalisés</a></li>
<li><a href="../fr419833/index.html">Travail à distance, comment ça marche</a></li>
<li><a href="../fr419835/index.html">Comment motiver les auteurs, négocier avec des experts et généralement rédiger de bons articles</a></li>
<li><a href="../fr419837/index.html">Moi, RoboLoyer, ou comment rechercher des anomalies dans les documents</a></li>
<li><a href="../fr419839/index.html">Piratage ATM NCR de bas niveau</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>