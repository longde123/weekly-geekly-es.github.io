<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë© üëåüèº üõåüèº Yandex: une maison intelligente pour adultes ‚èÆÔ∏è üëáüèΩ üö∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, Yandex a lanc√© son syst√®me de maison intelligente. On nous propose d'acheter des appareils Wi-Fi bon march√©: un adaptateur dans une prise d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Yandex: une maison intelligente pour adultes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465537/"><img src="https://habrastorage.org/webt/rs/l_/lm/rsl_lmpzna0pj3o9ahxzsawpsn0.png"><br><br>  R√©cemment, Yandex a lanc√© son syst√®me de maison intelligente.  On nous propose d'acheter des appareils Wi-Fi bon march√©: un adaptateur dans une prise de courant, une ampoule et une t√©l√©commande IR.  Il est int√©ressant que les d√©veloppeurs d'appareils ¬´intelligents¬ª aient la possibilit√© de cr√©er leurs comp√©tences ¬´maison intelligente¬ª, cela vous permettra de connecter des appareils au syst√®me Yandex et de g√©rer leur voix via Alice.  De plus en plus de nouvelles marques apparaissent sur les listes de comp√©tences.  Alice comprend parfaitement le discours russe, ce qui fait d'elle la leader incontest√©e des assistants vocaux sur le march√© russe. <br>  Cependant, tout n'est pas si fluide ... <br><a name="habracut"></a><br>  Premier inconv√©nient: fondamentalement, tous les syst√®mes propos√©s sont ¬´nuageux¬ª.  Leur fiabilit√© est parfois mise en doute, car leurs performances d√©pendent directement de la qualit√© de la connexion avec les serveurs du constructeur.  Et lorsque vous d√©sactivez Internet, les appareils se transforment compl√®tement en ¬´citrouille¬ª. <br><br>  Deuxi√®me inconv√©nient: syst√®me de script.  Les scripts sont une partie importante d'une maison intelligente.  Et ici, ils sont tr√®s primitifs: si ¬´la phrase est telle ou telle¬ª, alors activez ¬´l'appareil est tel ou tel¬ª.  Pour ma maison intelligente, c'√©tait trop peu. <br><br>  Les inconv√©nients ne s'arr√™tent pas l√†, mais le reste est plus probablement li√© √† l'immaturit√© du syst√®me.  L'√©quipe de d√©veloppement Yandex continue d'ajouter activement diverses fonctionnalit√©s et bogues √† modifier, dont beaucoup gr√¢ce √† eux! <br><br>  Apr√®s avoir √©tudi√© la documentation, j'ai d√©cid√© de cr√©er la comp√©tence Yandex UD et d'y connecter le contr√¥leur de maison intelligente.  Cela vous permettra de ne pas d√©pendre des serveurs cloud, de mettre en ≈ìuvre des scripts localement sur le contr√¥leur et en m√™me temps de contr√¥ler le syst√®me par la voix via Alice.  Pour cela, j'ai √©crit le plugin "yandex2mqtt" sur Node.js. <br><br><h4>  Un peu de th√©orie </h4><br>  - Alice, allume la lumi√®re. <br>  Apr√®s cette phrase, la magie op√®re et la lumi√®re s'allume.  Mais qu'est-ce qui se cache dans les coulisses?  Voyons comment tout cela fonctionne. <br><br>  La station Yandex, apr√®s avoir entendu une commande famili√®re, envoie des donn√©es au serveur Yandex, auquel nous avons sp√©cifi√© √† l'avance l'adresse de notre contr√¥leur.  Le serveur traite les informations et les redirige vers le contr√¥leur sous la forme d'une post-demande.  Sur le contr√¥leur, l'API interm√©diaire (dans notre cas, c'est le plugin yandex2mqtt) traite la demande et la redirige vers la rubrique MQTT.  Ensuite, le script est trait√© dans le programme Node-Red. <br><br>  Node-Red d√©cide quoi faire ensuite.  S'il est pr√©vu par le script, il envoie une commande pour allumer la lumi√®re dans le sujet MQTT correspondant.  Le pilote wb-mqtt-serial r√©pond en envoyant une commande Modbus au module relais, qui commute le relais.  Et enfin, la lumi√®re s'allume!  Oui, le chemin n'est pas proche, mais quelques fractions de seconde pour l'utilisateur. <br><br>  Examinons de plus pr√®s le plugin yandex2mqtt.  La premi√®re chose dont Yandex a besoin pour que la comp√©tence fonctionne est le service oAuth pour regrouper les comptes dans l'application Yandex.  Une fois que Yandex a re√ßu le jeton d'autorisation du service oAuth, il demande une liste de p√©riph√©riques.  Le plugin yandex2mqtt r√©pond avec une liste de p√©riph√©riques avec toutes les propri√©t√©s au format json.  Ils apparaissent ensuite dans la liste des appareils disponibles pour le contr√¥le (dans le soi-disant quasar).  Maintenant, si vous dites √† Alice d'allumer un appareil de la liste, Yandex enverra une demande de publication avec les donn√©es de l'appareil qu'il veut allumer au contr√¥leur.  En r√©ponse, le plugin confirme l'inclusion et √©crit le nouvel √©tat dans la rubrique mqtt sp√©cifi√©e dans les param√®tres du m√™me plugin.  Si le p√©riph√©rique a chang√© son statut sans la participation de Yandex, le plug-in, en voyant les nouvelles donn√©es dans la rubrique mqtt, les enverra √† Yandex lors de la demande du statut, ce qui ne se produit d√©sormais que si vous acc√©dez au p√©riph√©rique lui-m√™me dans quasar.  Dans d'autres cas, Yandex n'interroge pas les statuts. <br>  Je vais maintenant parler de certaines des propri√©t√©s des appareils Yandex UD. <br><br><h4>  Type d'appareil </h4><br>  Pour un affichage correct dans le ¬´quasar¬ª et une d√©finition plus pr√©cise des commandes par Alice, Yandex sugg√®re d'affecter diff√©rents types d'appareils aux appareils.  Total types 10: <br><br><ul><li>  <b>devices.types.light</b> - Toute lampe, lustre, ampoule, etc. </li><li>  <b>devices.types.socket</b> - Prise </li><li>  <b>devices.types.switch</b> - Commutateur </li><li>  <b>devices.types.thermostat</b> - Thermostat </li><li>  <b>devices.types.thermostat.ac</b> - Climatisation </li><li>  <b>devices.types.media_device</b> - P√©riph√©rique multim√©dia </li><li>  <b>devices.types.media_device.tv</b> - TV </li><li>  <b>devices.types.cooking</b> - Appareils de cuisine </li><li>  <b>devices.types.cooking.kettle</b> - Cr√©ateur </li><li>  <b>devices.types.other</b> - Tout ce qui ne correspondait pas aux paragraphes pr√©c√©dents. </li></ul><br><h5>  Capacit√© </h5><br>  De plus, chaque appareil doit avoir au moins une <b>capacit√©</b> . <br><br>  Au total, Yandex UD dispose de 5 types de comp√©tences.  Chaque comp√©tence a une fonction <b>(instance) diff√©rente</b> , et certaines comp√©tences ont plusieurs de ces fonctions, ce qui ajoute de la flexibilit√© lors de la configuration des appareils. <br><br>  <b>Capacit√©s:</b> <br><br>  1. <b>devices.capabilities.on_off</b> - Activez et d√©sactivez. <br><br>  exemple: <br><br><ul><li>  sur </li></ul><br>  2. <b>devices.capabilities.color_setting</b> - Gestion des couleurs. <br><br>  exemple: <br><br><ul><li>  rgb </li><li>  hsv </li><li>  temperature_k </li></ul><br>  3. <b>devices.capabilities.mode - Changer de mode.</b> <br><br>  exemple: <br><br><ul><li>  thermostat </li><li>  fan_speed </li></ul><br>  4. <b>devices.capabilities.range - Contr√¥le de plage.</b> <br><br>  exemple: <br><br><ul><li>  luminosit√© </li><li>  temp√©rature </li><li>  volume </li><li>  canal </li></ul><br>  5. <b>devices.capabilities.toggle - Muet.</b> <br><br>  exemple: <br><br><ul><li>  muet </li></ul><br><br>  Avec la bonne combinaison de toutes les propri√©t√©s de l'appareil, Alice comprend sans aucun probl√®me toutes les commandes de gestion du Smart Home qui lui sont donn√©es.  Ici, bien s√ªr, il y a quelques difficult√©s √† combiner les comp√©tences.  La documentation n'indique clairement pas quelles comp√©tences peuvent √™tre combin√©es et lesquelles ne le peuvent pas.  Mais la ¬´m√©thode scientifique du poke¬ª nous y aidera. <br><br>  Ainsi, par exemple, j'ai d√©couvert que la climatisation contient quatre comp√©tences: <br><br>  Type d'appareil: <br><br>  <b>devices.types.thermostat.ac</b> <br><br>  Type de comp√©tence: <br><br>  <b>devices.capabilities.on_off</b> <br><br>  exemple: <br><br><ul><li>  sur </li></ul><br>  <b>devices.capabilities.range</b> <br>  exemple: <br><br><ul><li>  temp√©rature </li></ul><br>  <b>devices.capabilities.mode</b> <br>  exemple: <br><br><ul><li>  thermostat </li></ul><br>  <b>devices.capabilities.mode</b> <br>  exemple: <br><br><ul><li>  fan_speed </li></ul><br>  Je ne d√©crirai pas les propri√©t√©s restantes, tout y est assez simple. <br><br>  Pour le faire fonctionner, vous avez besoin de: <br><br><ul><li>  <b>Contr√¥leur</b> </li><li>  <b>Tout domaine</b> </li><li>  <b>Certificat SSL</b> </li><li>  <b>Node.js</b> </li><li>  <b>Plugin Yandex2mqtt</b> </li><li>  <b>Courtier MQTT</b> </li><li>  <b>Rouge-noeud</b> </li></ul><br><h3>  Contr√¥leur </h3><br>  Mon appartement ¬´intelligent¬ª est contr√¥l√© par le Wiren Board 6. Mais vous pouvez utiliser n'importe quel autre contr√¥leur Linux qui tirera Node.js et Node-Red.  Par exemple, Raspberry pi ou PC. <br><br><h4>  Domaine </h4><br>  Bien s√ªr, il est souhaitable d'avoir une adresse IP blanche et d'acheter un domaine, mais ce n'est pas n√©cessaire.  Vous pouvez utiliser DDNS - par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.noip.com</a> . <br><br>  Ici, tout est simple: inscrivez-vous, cr√©ez un nom d'h√¥te gratuit, entrez votre adresse IP.  Certains routeurs ont un param√®tre DDNS sp√©cial o√π vous pouvez entrer des donn√©es noip.com.  Le routeur enverra automatiquement une adresse IP lorsqu'elle sera modifi√©e.  S'il n'y a pas un tel param√®tre dans le routeur, vous pouvez installer le programme noip sur le contr√¥leur et l'ajouter √† l'ex√©cution automatique.  Le programme fera exactement la m√™me chose qu'un routeur avec des param√®tres DDNS sp√©ciaux - mettez √† jour votre adresse IP dans la base de donn√©es noip.com <br><br>  Ainsi, nous avons une adresse statique qui redirige toutes les demandes vers notre contr√¥leur. <br><br><h4>  Ports 443 et 80 </h4><br>  Maintenant, presque tout le monde √† la maison a un routeur.  En plus de ses fonctions √©videntes, il constitue √©galement une barri√®re au r√©seau local pour les invit√©s ind√©sirables de l'ext√©rieur.  Mais dans certains cas, nous avons besoin d'acc√©der au r√©seau interne de l'ext√©rieur.  Les fabricants de routeurs l'ont envisag√© et ont ajout√© la fonction NAT (traduction d'adresse r√©seau). <br><br>  Je ne d√©crirai pas le moment de la configuration du routeur, car il est diff√©rent pour chaque fabricant.  Pour ce faire, lisez les instructions de votre routeur.  Mots-cl√©s Google: Port Forwarding, Port Mapping, NAT. <br><br>  Il est n√©cessaire de rediriger le port pour acc√©der √† yandex2mqtt (il peut √™tre n'importe lequel, j'ai choisi 443) et au port 80 (il est seulement n√©cessaire de recevoir un certificat SSL. Apr√®s avoir re√ßu le certificat, le port 80 peut √™tre ferm√©). <br><br><h4>  Certificat SSL </h4><br>  Mettez imm√©diatement tous les points sur le ¬´et¬ª: les certificats auto-sign√©s ne fonctionneront pas. <br>  La plupart des bureaux d'enregistrement de domaine (par exemple, reg.ru) offrent √† leurs clients des certificats SSL gratuits pour le domaine principal (www.votredomaine.ru).  Si vous avez achet√© un domaine sp√©cifiquement pour Alice, vous pouvez utiliser le certificat SSL fourni. <br><br>  Si vous n'avez pas votre propre domaine, ou si vous avez un autre sous-domaine allou√© pour Alice (par exemple, alice.votredomaine.ru), vous devez obtenir un certificat pour ce sous-domaine ou pour l'adresse fournie par le service DDNS. <br><br>  Pour ce faire, je propose d'utiliser le service gratuit pour obtenir un certificat SSL aupr√®s de letsencrypt.org. <br><br>  Pour obtenir un certificat, vous devez installer le programme certbot, ex√©cuter et sp√©cifier toutes les donn√©es qu'il demande.  Dans le m√™me temps, le port 80 doit √™tre libre et accessible de l'ext√©rieur, je vous conseille d'√©tudier attentivement les instructions de letsencrypt. <br><br><div class="spoiler">  <b class="spoiler_title">Installer et configurer certbot</b> <div class="spoiler_text"><pre><code class="bash hljs">apt-get update apt-get install certbot</code> </pre> <br><br>  Arr√™tez les services de surveillance et nginx. <br><br><pre> <code class="bash hljs">service watchdog stop service nginx stop</code> </pre> <br>  Nous transmettons le 80e port du routeur. <br><br>  Ex√©cutez le programme certbot: <br><br><pre> <code class="bash hljs">certbot certonly --standalone</code> </pre> <br>  Apr√®s le d√©marrage, le programme posera quelques questions simples. <br><br>  1. Votre e-mail.  Entrez simplement l'adresse et appuyez sur Entr√©e <br><br><img src="https://habrastorage.org/webt/mn/gf/si/mngfsiaatuo6txsrtc6wyyz4v_o.png"><br><br>  2. Vous √™tes invit√© √† lire les accords d'utilisation.  Si vous √™tes d'accord avec tout, entrez simplement ¬´A¬ª, ce qui signifie Accepter, c'est-√†-dire que je suis d'accord. <br><br><img src="https://habrastorage.org/webt/y8/zz/to/y8zztosybjouwmncxuawmbq-55c.png"><br><br>  3. Le programme demande la permission d'envoyer votre adresse e-mail aux d√©veloppeurs.  Entrez N. <br><br><img src="https://habrastorage.org/webt/pn/y_/yw/pny_ywp5pjfj7gupd09m3hnbmg4.png"><br><br>  4. Entrez votre domaine pour lequel vous souhaitez recevoir un certificat (vous pouvez entrer celui que nous avons re√ßu dans noip plus t√¥t).  Ici, je donne un exemple de saisie erron√©e.  Le pr√©fixe http: // n'est pas requis. <br><br><img src="https://habrastorage.org/webt/mt/bj/py/mtbjpyenb63jqv3gvtd_oyh9qze.png"><br><br>  Si vous avez tout fait correctement, vous verrez ce qui suit: <br><br><img src="https://habrastorage.org/webt/ug/7c/kf/ug7ckfuvos8bkgfgzvaepqvu48s.png"><br><br>  Cela signifie que le certificat a √©t√© re√ßu avec succ√®s.  N'oubliez pas le chemin d'acc√®s au certificat et √† la cl√©, il sera requis lors de la configuration du plugin yandex2mqtt.  Pour des raisons de s√©curit√©, fermez le port 80 dans les param√®tres du routeur, il ne sera plus utile. <br><br>  Nous activons les services de surveillance et nginx. <br><br><pre> <code class="bash hljs">service nginx start service watchdog start</code> </pre> <br>  Le certificat de letsencrypt est d√©livr√© pour <b>3</b> mois.  <b>N'oubliez pas de mettre √† jour.</b> <br><br></div></div><br><h4>  Node.js et le plugin yandex2mqtt </h4><br><div class="spoiler">  <b class="spoiler_title">L'installation</b> <div class="spoiler_text">  Configuration du r√©f√©rentiel node.js <br><br><pre> <code class="bash hljs">curl -sL https://deb.nodesource.com/setup_10.x | bash -</code> </pre> <br>  Ensuite, installez ou mettez √† jour tous les composants n√©cessaires <br><br><pre> <code class="bash hljs">apt-get install -y nodejs git make g++ gcc build-essential</code> </pre> <br>  Une fois l'installation r√©ussie, copiez le r√©f√©rentiel yandex2mqtt sur le contr√¥leur. <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/munrexio/yandex2mqtt.git /mnt/data/root/yandex2mqtt</code> </pre> <br>  Nous fixons les droits. <br><br><pre> <code class="bash hljs">chown -R root:root /mnt/data/root/yandex2mqtt</code> </pre> <br>  Nous allons dans le dossier. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /mnt/data/root/yandex2mqtt</code> </pre> <br>  Nous commen√ßons l'installation. <br><br><pre> <code class="bash hljs">npm install</code> </pre> <br>  Installation termin√©e. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">D√©marrage automatique</b> <div class="spoiler_text">  <b>Cr√©ez une unit√© systemd:</b> <br><br>  Acc√©dez au dossier <b>/ etc / systemd / system /</b> sur le contr√¥leur et cr√©ez un fichier appel√© <b>yandex2mqtt.service</b> .  Copiez-y les √©l√©ments suivants: <br><br><pre> <code class="bash hljs">[Unit] Description=yandex2mqtt After=network.target [Service] ExecStart=/usr/bin/npm start WorkingDirectory=/mnt/data/root/yandex2mqtt StandardOutput=inherit StandardError=inherit Restart=always User=root [Install] WantedBy=multi-user.target</code> </pre> <br>  Apr√®s cela, enregistrez les modifications et fermez le fichier. <br><br>  Pour activer l'unit√©, entrez la commande dans la console: <br><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> yandex2mqtt.service</code> </pre> <br><br>  Vous pouvez maintenant d√©marrer et arr√™ter le plugin avec des commandes <br><br><pre> <code class="bash hljs">service yandex2mqtt start service yandex2mqtt stop service yandex2mqtt restart</code> </pre> <br></div></div><br>  <b>Configuration:</b> <br><br>  Tous les param√®tres de plug-in n√©cessaires se trouvent dans le fichier <b>/mnt/data/root/yandex2mqtt/config.js</b> <br>  Modifiez ce fichier en fonction de vos param√®tres. <br>  Le certificat SSL doit √™tre <b>fullchain</b> . <br><br>  Apr√®s la configuration, ex√©cutez yandex2mqtt avec la commande: <br><br><pre> <code class="bash hljs">service yandex2mqtt start</code> </pre> <br>  Apr√®s avoir mis en place et d√©marr√© le pont, je vous conseille de v√©rifier le certificat sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce site</a> . <br><br>  Entrez simplement votre domaine que vous allez utiliser pour acc√©der √† Alice.  Pour un bon fonctionnement, le certificat doit r√©ussir tous les contr√¥les.  Sinon, rien ne fonctionnera. <br><br><h4>  Skill Yandex UD </h4><br><div class="spoiler">  <b class="spoiler_title">Cr√©ation de comp√©tences</b> <div class="spoiler_text">  1. Acc√©dez √† la page <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dialogs.yandex.ru/developer</a> <br>  2. Connectez-vous avec votre compte. <br>  3. Cliquez sur ¬´cr√©er un dialogue¬ª <br>  4. S√©lectionnez ¬´Smart Home¬ª <br>  5. Saisissez les param√®tres requis: <br><br><ul><li>  <b>Nom</b> - N'importe quel nom. </li><li>  <b>URL du point de terminaison</b> - une adresse du type <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">votredomaine / fournisseur</a></b> , o√π au lieu de <b>¬´votredomaine</b> ¬ª est l'adresse de noip ou de votre domaine pour laquelle un certificat ssl est re√ßu. </li></ul><br><img src="https://habrastorage.org/webt/6w/sn/oc/6wsnoczljzsap2fdrldsgi47qr8.png" width="400"><br><br><ul><li>  <b>Confidentialit√©</b> - s√©lectionnez <b>"Ne pas afficher dans le catalogue" (Obligatoire! Sinon, la comp√©tence ne passera pas la mod√©ration instantan√©e)</b> </li><li>  <b>Nom et email du d√©veloppeur</b> - indiquez vos coordonn√©es. </li><li>  <b>Description</b> - n'importe quel texte </li><li>  <b>Ic√¥ne</b> - n'importe quelle ic√¥ne. </li></ul><br><img src="https://habrastorage.org/webt/70/7q/pv/707qpvhwz4bp8-g7anzd6yocavw.png" width="400"><br><br>  6. Ensemble de comptes: <br><br><img src="https://habrastorage.org/webt/z4/vg/ep/z4vgep4de2sngw6byx34eo5s5te.png" width="400"><br><br>  Cliquez sur "ajouter un nouveau" <br><ul><li>  Les deux premiers points - <b>sp√©cifiez les donn√©es de config.js / clients</b> : </li></ul><br>  1. <b>L'identifiant d'application</b> est clientId <br><br>  2. <b>Secret d'application</b> - clientSecret <br><br><ul><li>  <b>URL d'autorisation</b> - votre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">domaine / bo√Æte de dialogue / autoriser</a> </li><li>  <b>URL du jeton</b> - votre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">domaine / oauth / token</a> </li><li>  <b>URL de mise √† jour du jeton</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">votredomaine / oauth / token</a> </li></ul><br><img src="https://habrastorage.org/webt/im/pg/zi/impgzifephas4rycqhvyll0_7uq.png" width="400"><br><br>  7. Enregistrez la comp√©tence <br><br><img src="https://habrastorage.org/webt/fj/ud/xy/fjudxydpqb3mwv5ksihpr277j2u.png" width="400"><br><br>  8. Cliquez sur "Mod√©ration" <br><br><img src="https://habrastorage.org/webt/a2/ah/ji/a2ahjiezupvml9wo3a1pboif3pc.png"><br><br>  9. Cliquez sur ¬´Publier¬ª <br><br><img src="https://habrastorage.org/webt/7a/jv/83/7ajv8394tns4icumhxj1qqp-eea.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ajout d'appareils √† Yandex UD.</b> <div class="spoiler_text">  1. Acc√©dez √† l'application Yandex sur le t√©l√©phone <br><br><img src="https://habrastorage.org/webt/ki/fk/t6/kifkt6ims4epu1zm2hsa2z3bef0.jpeg" width="230"><br><br>  2. Dans le menu, s√©lectionnez Appareils / Smart Home <br><br><img src="https://habrastorage.org/webt/up/ec/ee/upeceeae_jjtrocticjinlinxmq.jpeg" width="230"><br><br>  3. Cliquez sur "Ajouter un appareil" <br><br><img src="https://habrastorage.org/webt/-c/yn/k3/-cynk3sjwga2frnsung0wp8mtre.jpeg" width="230"><br><br>  4. Choisissez votre comp√©tence <br><br><img src="https://habrastorage.org/webt/ew/4h/jd/ew4hjdahl4eunc4kvygka1eftrs.jpeg" width="230"><br><br>  5. Cliquez sur "Fusionner les comptes" <br><br><img src="https://habrastorage.org/webt/ov/k7/hk/ovk7hkqe6oe0j7jvkw6eghcnycy.jpeg" width="230"><br><br>  6. La page d'autorisation s'ouvre <br><br>  <i>Entrez l'identifiant et le mot de passe (d√©finis dans le fichier config.js dans le bloc utilisateurs)</i> <br><br><img src="https://habrastorage.org/webt/ly/lr/gw/lylrgwlzw5wcuy1c4wov6ez-2fm.jpeg" width="230"><br><br>  7. Cliquez sur "Autoriser". <br><br><img src="https://habrastorage.org/webt/y2/pu/tn/y2putnokvnlac9h4tuypa1sny9y.jpeg" width="230"><br><br>  8. Cliquez sur ¬´Mettre √† jour la liste des appareils¬ª <br><br><img src="https://habrastorage.org/webt/cq/qd/gw/cqqdgwhp-zhmq5_ax3zbgohgrt4.jpeg" width="230"><br></div></div><br>  D√©sormais, Alice peut recevoir des commandes pour g√©rer les appareils ajout√©s.  Les √©quipes correspondantes viendront sur les sujets indiqu√©s par mqtt. <br><br>  Il reste √† lier certaines actions √† ces sujets. <br><br><h4>  Rouge-noeud </h4><br>  Node-Red a √©t√© choisi pour le syst√®me d'automatisation.  Il s'agit d'un excellent outil de programmation visuelle.  La proc√©dure d'installation et de configuration peut √™tre consult√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Le processus de configuration et d'automatisation d'une maison intelligente n√©cessitera un article entier, voire deux.  Et il existe d√©j√† de nombreux articles de ce type.  Au lieu de cela - un petit exemple d'utilisation du plugin, comment activer la voix de l'ampoule. <br><br>  Pour plus de commodit√©, nous cr√©ons un p√©riph√©rique virtuel sur le contr√¥leur Wiren Board 6 dans l'interface Web. <br>  Dans le moteur de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√®gles wb-rules</a> , vous devez entrer <br><br><pre> <b><code class="javascript hljs">defineVirtualDevice(<span class="hljs-string"><span class="hljs-string">"yandex"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"yandex controls"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cells</span></span>: { <span class="hljs-attr"><span class="hljs-attr">light1</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"switch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, } });</code></b> </pre> <b><br></b> <br><img src="https://habrastorage.org/webt/3t/mn/qh/3tmnqhsdi1vnkdd_wr4ucnsvusc.jpeg"><br><br>  <b>Nous √©crirons les</b> rubriques MQTT de cet appareil virtuel dans <b>config.js</b> pour le type de comp√©tence "on" de l'appareil "Light": <br><br><pre> <code class="json hljs"> devices: [ //_______________   ______________// { name: '', room: '', type: 'devices.types.light', mqtt: [ { type: 'on', set: '/devices/yandex/controls/light1/on', //   stat: '/devices/yandex/controls/light1' //   }, ], capabilities: [ { type: 'devices.capabilities.on_off', retrievable: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, state: { instance: 'on', value: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }, ] }, //_______________   _______________// ]</code> </pre><br>  Maintenant, avec la phrase ¬´Alice, allume / √©teins la lumi√®re¬ª, l'appareil virtuel bascule. <br><br>  Passons √† Node-Red, qui a √©t√© install√© conform√©ment aux instructions. <br><br>  Pour un travail pratique avec Wiren Board 6, vous pouvez √©galement utiliser le ¬´node¬ª suppl√©mentaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">node-red-contrib-wirenboard</a> . <br><br>  Le module d'extension <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WBE2R-R-ZIGBEE</a> est install√© dans le contr√¥leur, ce qui a permis de se connecter √† la lampe intelligente IKeevskaya de la s√©rie TRODFRY en utilisant le protocole ZigBee. <br><br>  Maintenant, c'est aux petits.  Jetez quelques blocs dans l'espace de travail Node-Red, connectez-les avec des ¬´cha√Ænes¬ª et cliquez sur D√©ployer. <br><br><img src="https://habrastorage.org/webt/ev/p8/zn/evp8zn84umdssgxcecq9rmosgm8.jpeg"><br><br>  L'ampoule ikeevsky est connect√©e via le plugin zigbee2mqtt, donc dans mqtt le sujet de l'ampoule doit √™tre envoy√© json pour contr√¥le.  Pour ce faire, nous allons ins√©rer une fonction simple entre le p√©riph√©rique virtuel WB et la rubrique bulbe mqtt. <br><br><img src="https://habrastorage.org/webt/y1/e6/9h/y1e69hfghaemcayotpvugppiqz8.jpeg"><br><br>  Cliquez sur D√©ployer.  Nous v√©rifions. <br><br>  Alice, allume la lumi√®re! <br><br>  Aujourd'hui, nous avons donc appris √† connecter Alice √† un syst√®me d'automatisation.  Dans certains cas, c'est peut-√™tre trop compliqu√©, il est plus facile d'acheter une ampoule wi-fi ordinaire, et c'est suffisant.  Mais si vous envisagez de construire une maison vraiment intelligente pour vous-m√™me, des moyens simples ne peuvent pas √™tre utilis√©s ici.  Mais cela en vaut-il la peine ou non, chacun d√©cidera pour lui-m√™me.  Merci de votre attention! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465537/">https://habr.com/ru/post/fr465537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465525/index.html">Rapports mobiles sur Oracle BI EE 12c - un, deux, trois. M√©thodologie du cours de CAO Oracle BI EE 12c</a></li>
<li><a href="../fr465527/index.html">Le long voyage de la RFC 4357 √† la RFC 8645 ou comment g√©rer les cl√©s de chiffrement</a></li>
<li><a href="../fr465529/index.html">Suspension sur blocage</a></li>
<li><a href="../fr465531/index.html">D√©ballage des listes imbriqu√©es de profondeur ind√©finie</a></li>
<li><a href="../fr465535/index.html">Qui impl√©mente IPv6 et ce qui entrave son d√©veloppement</a></li>
<li><a href="../fr465539/index.html">766 km - un nouveau record d'autonomie pour LoRaWAN</a></li>
<li><a href="../fr465541/index.html">De l'entreprise √† la PME: nous partageons notre exp√©rience dans l'adaptation de solutions d'entreprise pour les petites et moyennes entreprises avec la mon√©tisation en utilisant le mod√®le SaaS</a></li>
<li><a href="../fr465545/index.html">De diff√©rents c√¥t√©s de l'√âtat: comment Facebook a √©t√© frit au Congr√®s am√©ricain, tandis que Telegram se battait avec le FSB</a></li>
<li><a href="../fr465547/index.html">Guide SQL: comment mieux √©crire des requ√™tes (partie 1)</a></li>
<li><a href="../fr465551/index.html">R√©sum√© des √©v√©nements informatiques de septembre (premi√®re partie)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>