<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤜🏽 🤳🏻 🤸🏿 Smart.js - (plus que) nouveau firmware pour ESP8266 👩🏾‍🤝‍👨🏿 👵🏽 😒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sur le habr assez souvent, des articles sont publiés sur divers projets basés sur la puce ESP8266 populaire, donc je n'en parlerai pas moi-même. 
 
 T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Smart.js - (plus que) nouveau firmware pour ESP8266</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/382189/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur le habr assez souvent, des articles sont publiés sur divers projets basés sur la puce ESP8266 populaire, donc je n'en parlerai pas moi-même. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout en bas: nous avons développé un nouveau firmware pour cet appareil, proposant d'utiliser Javascript pour le développement. </font><font style="vertical-align: inherit;">Mais, Smart.js n'est pas seulement un firmware d'interpréteur JS, c'est aussi un «kit» différent pour travailler avec des équipements et une infrastructure cloud. </font></font><br>
<br>
<img src="https://habrastorage.org/files/d0c/4c1/ca4/d0c4c1ca4a2b453faf77decff24d5b13.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour plus de détails - veuillez, sous cat.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je dois dire tout de suite que cet article est un article de synthèse, dans lequel j'essaierai de parler de ce que Smart.js peut faire, et je toucherai très peu à la façon dont tout cela est organisé. Si vous souhaitez savoir comment cela fonctionne, cela peut être le sujet du prochain article (et vous pouvez également voir la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors qu'avons-nous sous le capot? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, c'est un moteur JS appelé </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> développé par Cesanta. Sans m'y attarder trop en détail, je note seulement que ce moteur a été développé à l'origine pour les plates-formes embarquées, il se distingue donc par sa petite taille, sa faible consommation de mémoire, son excellente portabilité et son haut degré de configurabilité. Cependant, un simple interprète JS sur l'ESP8266 serait une chose en soi, afin que Smart.js puisse communiquer avec le monde extérieur.</font></font><br>
<ul>
<li>I2C.  API    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>,      «»  (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">EEPROM</a>). I2C   bit-bang,      ; </li>
<li>SPI. ESP   SPI ,       SPI  HSPI,  HSPI,  ,  Hardware SPI. «» SPI       ,     .     bit-bang',      ,   HSPI (,     ESP,      SPI, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>).   API  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>;</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wifi. </font><font style="vertical-align: inherit;">Il serait étrange de ne pas prendre en charge le WiFi. </font><font style="vertical-align: inherit;">Par conséquent, nous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soutenons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Système de fichiers. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> basé sur SPIFFS;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe également une API pour travailler avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPIO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et un simple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://github.com/cesanta/smart.js/blob/master/README.md&amp;usg=ALkJrhji-lJrkDlknGW2vhxufH0upamDnA#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">client HTTP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et un ensemble de diverses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctions auxiliaires</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, si c'est intéressant - lisez le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous avons essayé de décrire tout ce qui est. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, un petit démarrage rapide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Téléchargement depuis l'archive </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash'n'Chips</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Flash'n'chips est un pilote flash «propriétaire». </font><font style="vertical-align: inherit;">Vous pouvez en utiliser n'importe quel, mais Flash'n'chips génère immédiatement l'identifiant et le mot de passe de l'appareil nécessaires pour se connecter au cloud. </font><font style="vertical-align: inherit;">Il existe une version pour OS X et Windows.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et Linux.</font></font></b><div class="spoiler_text"> Linux    ,   ,    .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du flasher lui-même, l'archive contient également le firmware «release» (c'est-à-dire Alpha). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous connectons l'ESP8266 à l'USB, lançons Flash'n'chips, et nous voyons quelque chose comme ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/files/ad9/a25/fd9/ad9a25fd9fcf452f9e3066080d20a87a.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cliquez sur «Charger le firmware» - et le firmware envahira l'appareil. </font><font style="vertical-align: inherit;">Selon votre ESP, des mouvements corporels supplémentaires peuvent être nécessaires. </font><font style="vertical-align: inherit;">Par exemple, j'utilise le ESP01 le plus simple, donc avant de flasher, je dois connecter GPIO0 à GND. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes connectés par le terminal. </font><font style="vertical-align: inherit;">(Il y a aussi un Flash'N'Chips intégré, je suis plus familier avec picocom, mais ce n'est pas important). </font><font style="vertical-align: inherit;">Vitesse - 115200.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous voyons la console.</font></font></b><div class="spoiler_text">    ,     .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette console, vous pouvez immédiatement taper du code JS. («Smartjs NNN / MM $» est une invite de ligne de commande, NNN est la quantité de mémoire libre, MM est la quantité de mémoire actuellement consommée directement par l'interpréteur). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela ressemble à une console ordinaire. </font></font><br>
<br>
<img src="https://habrastorage.org/files/afa/c9c/7d3/afac9c7d37e24b7f8b007648dcb37783.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous appuyez sur Entrée, la commande est exécutée et son résultat s'affiche dans la console, c'est-à-dire vous pouvez vous passer de beaucoup d’impressions. Une autre façon d'écrire et d'exécuter du code JS consiste à le saisir dans votre éditeur préféré, à l'enregistrer dans un fichier et à le télécharger sur votre appareil. La façon la plus simple de le faire est d'utiliser le même Flash'n'Chips - dans la zone de liste déroulante Sélectionner une action, sélectionnez «Télécharger le fichier». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier peut maintenant être exécuté à l'aide de la commande File.load («nom de fichier») en tapant cette commande dans la console ou en l'ajoutant au fichier init.js (le fichier sera alors automatiquement exécuté au démarrage de l'appareil).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le micrologiciel pour ESP8266 Smart.js n'est pas limité. Comme je l'ai écrit ci-dessus, il y a toujours un nuage où vous pouvez envoyer des données à partir de l'appareil, les y stocker, les prendre à partir de là ou simplement regarder les graphiques. Une API pour l'envoi de données vers le cloud est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jointe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour un démarrage rapide, nous avons enregistré une courte vidéo:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/6DYfGsqQzCg%3Ffeature%3Doembed&amp;usg=ALkJrhip5QeZVJMy90ojSJ1qqs_Mo0NWKQ" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ceux. si vous avez besoin, par exemple, de surveiller la température dans l'appartement, vous n'aurez presque rien à faire. Il suffit de connecter un capteur de température à l'ESP, d'écrire un «driver» (ou de s'en préparer un) sur JS, de s'inscrire dans le cloud, d'écrire un petit script qui lit la température et l'envoie au cloud. Et puis allez sur le site et regardez le tableau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, le firmware fonctionnera sans cloud. Mais c'est plus pratique avec le cloud, une partie du travail de routine est interrompue. Il y a un lien vers le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur le github </font><font style="vertical-align: inherit;">, et si vous avez un compte github ou G +, l'enregistrement dans celui-ci tiendra en quelques clics.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, si vous manquez de certaines fonctions, vous pouvez toujours utiliser C. Vous pouvez simplement écrire de nouvelles fonctionnalités en C sans avoir à les associer à JS. Dans le même temps, il restera possible d'utiliser presque toutes les API qui sont (dans la plupart des cas, l'API JS est un wrapper fin sur les fonctions syshny), en plus, vous pouvez utiliser les fonctions ESP SDK. Il n'est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas difficile d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assembler le firmware à partir de la source </font><font style="vertical-align: inherit;">, grâce à la présence d'images docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez développer JS. Pour ce faire, nous écrivons les fonctionnalités nécessaires en C, puis les rendons disponibles dans JS. Ce n'est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas non plus difficile</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ceux qui ont affaire à l'ESP8266, Smart.js semblera similaire à NodeMCU. Je ne discuterai pas - tant qu'il semble. Mais nous avons de grands projets pour le développement de Smart.js et pour le portage vers d'autres appareils, donc au fil du temps, je pense, il y aura moins de similitudes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En parlant de nos plans. Maintenant, le statut de Smart.js est ALPHA 1. La prochaine version est prévue pour l'automne (ce qui, bien sûr, n'interfère pas avec ceux qui veulent assembler le firmware à partir des sources avec n'importe quelle fréquence). À l'automne, nous augmenterons la quantité de mémoire disponible pour l'utilisateur, mettrons à jour les scripts à partir du cloud (c'est-à-dire qu'il serait théoriquement possible de ne jamais connecter l'ESP8266 à l'ordinateur), de rendre le port vers d'autres plates-formes, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, il est important pour nous d'obtenir une rétroaction. Aimes-tu? Que manque-t-il? Qu'est-ce qui est superflu? Tout est intéressant!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors - téléchargez le firmware - essayez-le, nous serons heureux. </font><font style="vertical-align: inherit;">Double licence, GPLv2 pour tous les arrivants et commerciale pour ceux qui n'ont pas la GPL et / ou qui ont besoin de support.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr382189/">https://habr.com/ru/post/fr382189/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr382179/index.html">Fallout Shelter pour Android OS apparaîtra le 13 août</a></li>
<li><a href="../fr382181/index.html">JiT-JiS SCM ou "Comment les voitures le font"</a></li>
<li><a href="../fr382183/index.html">Apple a obtenu un brevet pour une télécommande biométrique pour maison intelligente</a></li>
<li><a href="../fr382185/index.html">4 technologies pour aider à sauver les océans</a></li>
<li><a href="../fr382187/index.html">Moniteur sans cadre EIZO Foris FS2434</a></li>
<li><a href="../fr382191/index.html">Kepler-452b. Un autre "double" de la Terre dans la constellation du Cygne. La première exoplanète dont l'existence est considérée comme prouvée</a></li>
<li><a href="../fr382193/index.html">La Chine a mis en orbite deux autres satellites de navigation pour le système BeiDou</a></li>
<li><a href="../fr382195/index.html">Journalistes robots: les algorithmes sont plus un outil qu'une menace</a></li>
<li><a href="../fr382199/index.html">Pourquoi l'exoplanète de la NASA n'est pas un si bon événement</a></li>
<li><a href="../fr382201/index.html">7 meilleurs forums, blogs et chaînes YouTube pour quadcopter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>