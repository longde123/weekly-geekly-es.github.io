<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà∂ üëéüèæ üö£üèº Office 365 Outlook encontr√≥ API no documentadas con registros detallados de actividad del usuario ‚ôæ üëØ üåã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Registros detallados de Office 365 Outlook extra√≠dos por Magic-Unicorn-Tool : un atacante est√° buscando una factura de pago. La primera letra de la co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Office 365 Outlook encontr√≥ API no documentadas con registros detallados de actividad del usuario</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/globalsign/blog/415899/"><img src="https://habrastorage.org/webt/ss/4n/1h/ss4n1hztnfofodcmqntzih5xmee.png"><br><br>  <i><font color="gray">Registros detallados de Office 365 Outlook extra√≠dos por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Magic-Unicorn-Tool</a> : un atacante est√° buscando una factura de pago.</font></i>  <i><font color="gray">La primera letra de la consulta de b√∫squeda se ingres√≥ a las 10: 42: 44.548, la √∫ltima a las 10: 43: 07.214.</font></i>  <i><font color="gray">La informaci√≥n de la actividad se almacena en los registros durante seis meses.</font></i> <br><br>  Durante mucho tiempo, hubo rumores de que Office 365 tiene una herramienta secreta incorporada para registrar la actividad del usuario.  En junio de 2018, estos rumores se confirmaron por completo.  Todo comenz√≥ con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">video</a> publicado por <i>An√≥nimo</i> , y luego los especialistas de CrowdSrtike subieron un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe detallado</a> . <br><br>  Microsoft introdujo la API de Actividades en el cliente de correo electr√≥nico no con fines maliciosos, sino para las tareas de an√°lisis forense digital, es decir, investigar incidentes relacionados con pirater√≠a de correo corporativo y otras filtraciones de datos.  Para hacer esto, se mantiene un registro de actividad detallado durante seis meses, <i>incluso si el usuario ha deshabilitado el registro</i> . <br><a name="habracut"></a><br><h1>  Epidemia de pirater√≠a de cuentas de correo electr√≥nico </h1><br>  La pirater√≠a de cuentas de correo electr√≥nico corporativo en todo el mundo se ha generalizado tanto que algunos expertos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">llaman a esto una epidemia</a> .  Los atacantes obtienen acceso a hojas de c√°lculo con n√∫meros de seguridad social, informaci√≥n detallada sobre facturas financieras y secretos comerciales.  Buscan informaci√≥n sobre transferencias bancarias y roban dinero, aprovechando la falta de una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">firma digital en los documentos</a> .  Los diversos tipos de fraude a trav√©s del correo comercial comprometido se describen en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">folleto CrowdStrike</a> . <br><br>  Por ejemplo, a principios de junio, el FBI realiz√≥ una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">operaci√≥n internacional</a> y detuvo a 74 personas en varios pa√≠ses que estaban involucradas en este negocio. <br><br>  Cuando se conoce el hecho de la pirater√≠a, es importante comprender: a qu√© datos obtuvo acceso el cracker, qu√© vio y qu√© informaci√≥n copi√≥.  ¬øSe han filtrado datos confidenciales?  La investigaci√≥n de incidentes se hace m√°s dif√≠cil porque el inicio de sesi√≥n en Office 365 est√° desactivado de manera predeterminada.  En ausencia de informaci√≥n real, la empresa est√° obligada por ley a anunciar p√∫blicamente una fuga de datos con todas las consecuencias resultantes: costos de reputaci√≥n, multas, etc. <br><br>  Pero ahora se sabe que hay API de Actividades con registro detallado en Office 365, y muchos de estos esc√°ndalos podr√≠an evitarse si las empresas conocieran esta API.  Quiz√°s, el acceso a estos registros secretos fue recibido solo por algunos clientes privilegiados.  Hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informaci√≥n</a> que algunas empresas que se especializan en an√°lisis forense digital conoc√≠an sobre la herramienta secreta de auditor√≠a de Office 365 el a√±o pasado, o incluso antes.  Alguien consider√≥ sus declaraciones como bravuconer√≠a de marketing, pero result√≥ ser cierto.  Sorprendentemente, existe la API de Actividades, y Microsoft realmente ocult√≥ la existencia de una herramienta tan importante y √∫til, llamada Magic Unicorn profesional, de ah√≠ el nombre del programa para el autoan√°lisis de registros, que se menciona a continuaci√≥n. <br><br> <a href=""><img src="https://habrastorage.org/webt/ji/-f/e0/ji-fe0abu-a7c-v-x6xnh6cbogc.png"></a> <br><br>  <i><font color="gray">Un atacante escanea mensajes que contienen una factura de pago y el formulario W-9.</font></i>  <i><font color="gray">Registros detallados extra√≠dos por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Magic-Unicorn-Tool</a></font></i> <br><br><h1>  CrowdStrike Investigation </h1><br>  CrowdStrike <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">describi√≥ en detalle</a> c√≥mo funciona el diario de Office 365 para todos los usuarios de manera predeterminada.  La caracter√≠stica consiste en una API web que recupera informaci√≥n de la actividad de Office 365 Outlook a trav√©s de los Servicios web de Exchange (EWS).  El acceso a la API est√° abierto a cualquiera que conozca el punto final y el encabezado HTTP espec√≠fico. <br><br>  La API de Actividades no documentadas es un subconjunto de las tres versiones de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">API REST de Outlook</a> (1.0, 2.0 y beta).  Al igual que con el resto de los subconjuntos, la llamada a la API debe autenticarse utilizando OAuth 2.0 o autenticaci√≥n b√°sica. <br><br>  El punto final es el siguiente: <br><br><pre><code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/outlook.office.com/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/v2.0/</span></span>{user_context}/Activities</code> </pre> <br>  Todas las solicitudes se env√≠an como paquetes HTTP GET, que deben incluir el siguiente encabezado HTTP: <br><br><pre> <code class="hljs objectivec">Prefer: exchange.behavior=<span class="hljs-string"><span class="hljs-string">"ActivityAccess"</span></span></code> </pre> <br>  Las solicitudes sin este encabezado devolver√°n una <code>HTTP 400 Bad Request</code> . <br><br>  El encabezado de <code>Authorization</code> tambi√©n es <code>Authorization</code> : <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Authorization</span></span>: Bearer &lt;<span class="hljs-keyword"><span class="hljs-keyword">access</span></span> token&gt;</code> </pre> <br>  Las solicitudes sin este encabezado devolver√°n una respuesta <code>HTTP 403 Unauthorized</code> . <br><br>  Para fines de prueba, se puede generar un token de acceso OAuth 2.0 en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">entorno limitado de Oauth</a> .  Es v√°lido por 60 minutos. <br><br>  La llamada m√°s simple a la API es solicitar las √∫ltimas diez de sus actividades. <br><br><pre> <code class="hljs ruby">GET <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/outlook.office.com/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/v2.0/me</span></span><span class="hljs-regexp"><span class="hljs-regexp">/Activities</span></span></code> </pre> <br>  Un ejemplo de respuesta de la API en formato JSON muestra propiedades de actividad est√°ndar: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"Id"</span></span>:<span class="hljs-string"><span class="hljs-string">"WOGVSAiPKrfJ4apAPcBksT2en7whzDz4NIbUs3=="</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ActivityCreationTime"</span></span>:<span class="hljs-string"><span class="hljs-string">"2010-04-01T12:34:56.789Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ActivityIdType"</span></span>:<span class="hljs-string"><span class="hljs-string">"ReadingPaneDisplayStart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AppIdType"</span></span>:<span class="hljs-string"><span class="hljs-string">"Outlook"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ClientVersion"</span></span>:<span class="hljs-string"><span class="hljs-string">"15.00.0000.000"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ClientSessionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"679126f3-02de-3513-e336-0eac1294b120"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ActivityItemId"</span></span>:<span class="hljs-string"><span class="hljs-string">"NjKG5m6OmaCjGKq6WlbjIzvp94czUDg30qGopD=="</span></span>, <span class="hljs-attr"><span class="hljs-attr">"TimeStamp"</span></span>:<span class="hljs-string"><span class="hljs-string">"2010-04-01T12:34:56.789Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"TenantId"</span></span>:<span class="hljs-string"><span class="hljs-string">"679126f3-02de-3513-e336-0eac1294b120"</span></span>, } ] }</code> </pre> <br>  A trav√©s de la API, puede solicitar actividad no solo para usted, sino tambi√©n para otros usuarios, si se obtiene el permiso a trav√©s de Buz√≥n compartido o Permiso de aplicaci√≥n: <br><br><pre> <code class="hljs ruby">GET <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/outlook.office.com/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/v2.0/</span></span>Users(<span class="hljs-string"><span class="hljs-string">'victim@contoso.com'</span></span>)/Activities</code> </pre> <br>  La API de actividades admite varios par√°metros de consulta: <br><br><ul><li>  <code>$orderby</code> : ordena los resultados por la expresi√≥n dada </li><li>  <code>$filter</code> : filtra los resultados por fecha y / o tipo de actividad </li><li>  <code>$select</code> : selecciona propiedades de devoluci√≥n </li><li>  <code>$top</code> : n√∫mero m√°ximo de actividades devueltas </li><li>  <code>$skip</code> : n√∫mero de actividades omitidas en los resultados </li></ul><br>  Por el momento, CrowdStrike ha identificado 30 tipos de actividades, pero en realidad puede haber m√°s.  Aqu√≠ est√°n los m√°s √∫tiles: <br><br><ul><li>  <code>Delete</code> : eliminar una carta </li><li>  <code>Forward</code> : reenv√≠o de correo electr√≥nico </li><li>  <code>LinkClicked</code> : haciendo clic en un enlace en un correo electr√≥nico </li><li>  <code>MarkAsRead</code> : mensaje marcado como le√≠do </li><li>  <code>MarkAsUnread</code> : mensaje marcado como no le√≠do </li><li>  <code>MessageDelivered</code> entregado: carta entregada al buz√≥n </li><li>  <code>MessageSent</code> : correo electr√≥nico enviado desde el buz√≥n </li><li>  <code>Move</code> : el correo electr√≥nico ha sido reprogramado </li><li>  <code>OpenedAnAttachment</code> : aplicaci√≥n abierta </li><li>  <code>ReadingPaneDisplayEnd</code> : <code>ReadingPaneDisplayEnd</code> letra en el panel de vista </li><li>  <code>ReadingPaneDisplayStart</code> : seleccione un resaltado para escribir en el panel de vista. </li><li>  <code>Reply</code> : responder a la carta </li><li>  <code>SearchResult</code> : generar resultados de b√∫squeda </li><li>  <code>ServerLogon</code> : evento de autorizaci√≥n </li></ul><br>  Hay otros tipos interesantes de actividades √∫tiles para investigar incidentes: <code>SenderSmtpAddress</code> , <code>Recipients</code> , <code>Subject</code> , <code>SentTime</code> , <code>InternetMessageId</code> , <code>ClientIP</code> , <code>UserAgent</code> , etc. <br><br>  Los especialistas de CrowdStrike han publicado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un m√≥dulo de Python</a> que extrae informaci√≥n de la API de Actividades de Outlook de Office 365 y escribe los datos recibidos en un archivo CSV. <br><br><h1>  Herramienta m√°gica de unicornio </h1><br>  El programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Magic-Unicorn-Tool</a> analiza los registros de la API de Actividades obtenidos por el m√≥dulo Python mencionado anteriormente.  Por el momento, puede analizar y mostrar la siguiente informaci√≥n: <br><br><ul><li>  Buscar consultas en el buz√≥n, tiempo para ver mensajes y / o sesiones autorizadas. </li><li>  Eventos de autorizaci√≥n (Logon y ServerLogon), fecha, hora, direcci√≥n IP y tipo de navegador. </li><li>  Toda la actividad de correo en entregado y marcado como cartas le√≠das. </li><li>  Buscar eventos grabados desde la ID de sesi√≥n con referencia al √∫ltimo evento de autorizaci√≥n. </li><li>  Leyendo el panel. </li><li>  Ver archivos adjuntos. </li></ul><br><img src="https://habrastorage.org/webt/fj/xw/n9/fjxwn9xwhiceprwy0hk8whevtu4.png"><br>  <i><font color="gray">Inicie sesi√≥n en su cuenta desde diferentes direcciones IP</font></i> <br><br>  Magic-Unicorn-Tool se distribuye sin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">firma de c√≥digo</a> , pero con c√≥digo abierto. <br><br>  La implementaci√≥n de herramientas como la API de Actividades sin el conocimiento de los usuarios plantea una serie de problemas pr√°cticos y √©ticos para toda la industria forense digital.  De forma predeterminada, el registro en diario est√° deshabilitado en las cuentas de Office 365. No forma parte de los planes ProPlus y E1 est√°ndar.  Las compa√±√≠as tienen que pagar dinero extra por la auditor√≠a de cuentas, y debido a la falta de registros (como pensaban), muchas compa√±√≠as sufrieron p√©rdidas.  Al mismo tiempo, la granularidad del registro de la API de actividad supera con creces la granularidad de los m√©todos de registro documentados, como el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Registro de auditor√≠a unificado</a> . <br><br>  Los expertos forenses digitales de LMG Security est√°n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pidiendo la</a> adopci√≥n de est√°ndares para el registro de actividades y colocarlo como una carga obligatoria para los proveedores de la nube, ya que el sistema de alarma contra incendios en los centros de datos ahora es una carga obligatoria. <br><br>  Se requiere la adopci√≥n de est√°ndares para que los proveedores no solo mantengan registros, sino que tambi√©n los proporcionen en forma est√°ndar para clientes y compa√±√≠as de auditor√≠a, y no guarden secretos para clientes seleccionados como parte de un plan tarifario m√°s costoso o como un servicio pagado por separado. <br><br><hr><br>  <b>GMO GlobalSign Russia ACTION para suscriptores de Habr</b> <b><br><img src="https://habrastorage.org/webt/u3/my/b4/u3myb4ifqihiox-vpuqxbx4kij0.jpeg"></b> <br><br>  Puede obtener informaci√≥n adicional comunic√°ndose con el gerente de GlobalSign por tel√©fono: +7 (499) 678 2210, o complete el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">formulario en el sitio web,</a> indicando el c√≥digo de promoci√≥n CS002HBFR. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es415899/">https://habr.com/ru/post/es415899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es415887/index.html">¬øQu√© tipo de robots ara√±a vuelan sobre estadios y disparan al f√∫tbol? Entrevista con el creador de Robycam</a></li>
<li><a href="../es415891/index.html">¬øCu√°les son los juegos secuelas geniales?</a></li>
<li><a href="../es415893/index.html">C√≥mo hacer que los procesos Java que se ejecutan en Linux / Docker sean simples y directos</a></li>
<li><a href="../es415895/index.html">El patr√≥n m√°s importante en la programaci√≥n.</a></li>
<li><a href="../es415897/index.html">Funciones para documentar bases de datos PostgreSQL. Parte dos</a></li>
<li><a href="../es415901/index.html">La Comisi√≥n del Consejo de la Federaci√≥n apoy√≥ la idea de crear una base IMEI para todos los tel√©fonos blancos</a></li>
<li><a href="../es415903/index.html">Bienvenido al verano DIYorDIE Meetup el 7 de julio</a></li>
<li><a href="../es415905/index.html">C√≥mo cultivar un producto saludable (ejemplo de Juno)</a></li>
<li><a href="../es415907/index.html">C√≥mo despedir empleados sin arriesgar la imagen de la empresa</a></li>
<li><a href="../es415909/index.html">Extensi√≥n web entre navegadores para scripts personalizados Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>