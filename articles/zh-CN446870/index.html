<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💔 🤾🏽 ⛔️ 粒子系统：圣诞节的故事 ☝🏾 ↘️ 🤵🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="圣诞节一直是一年中我最喜欢的时间之一。 对我来说，圣诞节是一个充满爱，欢笑，幸福和其他神奇事物的季节。 

 我在西班牙出生和成长，尤其是在特内里费岛，特内里费岛是一个阳光明媚的亚热带岛屿，就在非洲海岸附近的大西洋中间。 我必须说，特内里费岛的圣诞节与自加入Badoo以来在伦敦度过的最近两个圣诞节有...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>粒子系统：圣诞节的故事</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/446870/"><img src="https://habrastorage.org/webt/9s/eo/zq/9seozqwk1lhhha-t9kjesviqs14.jpeg"><br><br> 圣诞节一直是一年中我最喜欢的时间之一。 对我来说，圣诞节是一个充满爱，欢笑，幸福和其他神奇事物的季节。 <br><br> 我在西班牙出生和成长，尤其是在特内里费岛，特内里费岛是一个阳光明媚的亚热带岛屿，就在非洲海岸附近的大西洋中间。 我必须说，特内里费岛的圣诞节与自加入Badoo以来在伦敦度过的最近两个圣诞节有很大不同。 <br><br> 在伦敦生活的一个奇妙之处在于，我有生以来第一次看到雪，真正的雪花从天上掉下来。 太不可思议了！ <br><br> 谈到雪花，我有一个有趣的故事，向您介绍去年圣诞节那天在办公室发生的事。 就在我回家特内里费岛与家人度过几天之前。 <br><br> 碰巧的是，去年12月，我被分配了一张非常有趣的机票，内容如下 <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/lt/df/wd/ltdfwdnu7xreylndpr6of3vkbt8.png"><br><br> 嗯，非常有趣。  Badoo希望为我们的iOS应用程序创建一个圣诞节动画，其中包括雪花，我很幸运能得到这份工作，我喜欢这个主意！ 但是我不知道从哪里开始。 <br><br> 像往常一样，有一个素描文件链接到我的票证，幸运的是，还有一个外观如下的设计： <br><br><img src="https://habrastorage.org/webt/_d/q9/tl/_dq9tlxzvrca0jhk0lxjx3rnmhu.png"><br><br> 因此，至少我知道我们想要什么，但是我不确定这些雪花到底是什么。 我去了设计团队了解更多。 <br><br> 正如我所怀疑的那样，他们已经使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ After Effects”</a>构建了一个惊人的动画版本。 <br> 基本上，他们告诉我，这个想法是添加动画雪花，该雪花将在现有应用启动动画期间从屏幕顶部掉落（他们还希望看到徽标中添加了圣诞老人的帽子，但作为简单的资产替换，它不会t本文中的数字）。 <br><br> 我知道iOS的启动动画使用了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lottie，</a>因为我在实现它之前已经去过一段时间了（有关该细节的更多信息，请查看<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Radek Cieciwa的</a>这篇<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文章</a> 。但是，我告诉设计师我会考虑一些想法，因为也许有一种无需使用Lottie即可添加雪花的简单方法，我开始研究各种不同的方法。 <br><br> 这是Radek实施的Badoo中的启动动画。 干净！ <br><br><img src="https://habrastorage.org/webt/8e/cg/jj/8ecgjj7a9ywk34vr-_idw4ckb-a.gif"><br><br> 这是我在上面制作的雪花动画。 想知道我是怎么做到的吗？ 继续阅读。 <br><br><img src="https://habrastorage.org/webt/rq/yd/gh/rqydgh5ar15k2f42kwxusdr3iq4.gif"><br><br><h1> 粒子系统 </h1><br> 阅读了一些有趣的动画文档后，我被提醒“粒子系统”是在电影和视频游戏中实现这种动画的一种常用技术。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">维基百科</a>完美地描述了这一点： <br><br><blockquote>  “粒子系统是游戏物理学，运动图形和计算机图形学中的一种技术，它使用大量非常小的精灵，3D模型或其他图形对象来模拟某些种类的“模糊”现象，否则很难做到这一点。使用传统的渲染技术进行复制-通常是高度混乱的系统，自然现象或由化学反应引起的过程。” </blockquote><br><div class="spoiler">  <b class="spoiler_title">这项技术是在1982年的电影《星际迷航II：可汗的愤怒》中引入的，目的是创造虚构的《创世纪》效果。</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/zXFNypyMJCc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br> 粒子系统由一个或多个单独的图形图元组成，例如点，线或称为粒子的图像。 这些粒子由粒子系统显示/发射。 <br><br> 这些粒子中的每一个都具有直接或间接影响粒子行为的属性，并定义了渲染粒子的方式和位置。 它们可以大量移动并沿不同方向移动，以产生流畅的效果。 <br><br> 当粒子由其粒子系统生成或发射时，动画将生效。 该系统在其自身区域内的任意位置发射粒子。 该区域可以具有不同的形状，例如圆形，长方体，直线，点，矩形，球形等。 <br><br> 该系统还定义了一些影响其几何形状，生成速度和其他方面的属性。 对于用于粒子发射器系统的每个API，都有相似的行为使用不同的属性名称。 <br><br> 当粒子系统同时发射所有这些图像时，它会创建令人惊叹的动画，看起来像雨，火甚至是雪！ <br><br><img src="https://habrastorage.org/webt/m1/rj/jo/m1rjjoaqdn9cnn5gqkzjnu1o2iw.gif"><img src="https://habrastorage.org/webt/ti/zj/yi/tizjyikmqt6nvvztyycatujepgs.gif"><img src="https://habrastorage.org/webt/3e/vq/4d/3evq4dymfm0o-qaoy8qqs0jhkti.gif"><br><br><h1> 动手 </h1><br> 我猜想苹果可能会在某些API中提供对粒子系统的支持。 我检查了，是的，我是对的！ <br><br> 该粒子系统是iOS中“核心动画”的一部分，我在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CAEmitterLayer</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CAEmitterCell中</a>找到了关于它的很好的文档。 <br><br> 一旦获得了有关iOS中粒子系统和受支持的API的所有信息，就可以开始我最喜欢的部分，实际上是为我的雪花动画实现代码。 <br><br> 可悲的是，圣诞节并不会永远持续下去，因此需要对其进行远程控制，以便可以在12月25日之后将其删除。 <br><br> 如前所述，应用启动动画是在Lottie中实现的。 然后，我必须弄清楚如何在不破坏现有代码的情况下将雪花添加到现有动画中，因为在发行后不久必须将其删除。 <br><br> 我找到了一种非常简单的方法。 我将注入一个新的透明UIView，以在徽标动画和背景之间显示雪花动画，然后使用远程标志控制此视图的外观。 <br><br><img src="https://habrastorage.org/webt/rm/_l/zk/rm_lzk5j94unwv3h5lqj9mqv65a.png"><br><br> 上面的图像显示了最终动画中使用的视图。 <br><br><ol><li> 包含粒子系统动画的<b>视图</b> ； 基本上，雪花 <br></li><li> 用于制作徽标动画的<b>视图</b> ：使用Lottie进行动画处理的<b>视图</b> 。 <br></li></ol><br> 解决此问题后，我只需要创建一个可重用的UIView类，其中包含粒子发射器的逻辑即可生成令人难以置信的动画雪花。 <br><br> 我首先需要的是用于表示实际雪花的单元发射器内容的图像资产。 但是它们很简单，对吧？ <br><br> 每个雪花只是一个大的白色圆圈，再加上另一个大的模糊白色圆圈。 我是使用Sketch自己创建的。 <br><br><img src="https://habrastorage.org/webt/9p/va/zd/9pvazdqkilhjtvjtidqvl1nwsh4.png" width="500"><br><br><h1> 一些实施细节 </h1><br>  CAEmitterLayer是一种特殊的CALayer，可以发射，设置动画和渲染粒子系统。 它具有一些属性，可以自定义图层的几何形状，定位和渲染模式等。 <br><br> 我通过创建发射器层开始动画： <br><br><pre><code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> snowEmitterLayer.emitterShape = <span class="hljs-type"><span class="hljs-type">CAEmitterLayerEmitterShape</span></span>.line snowEmitterLayer.beginTime = <span class="hljs-type"><span class="hljs-type">CACurrentMediaTime</span></span>() snowEmitterLayer.timeOffset = <span class="hljs-number"><span class="hljs-number">10.0</span></span></code> </pre> <br> 我只需要三个属性即可设置我的图层： <br><br><ul><li>  <b>itterShape</b> ：定义层的形状。 就我而言，我使用线性形状是因为它可以使雪花在所有屏幕上右移 <br></li></ul><br><ul><li>  <b>beginTime</b> ：此属性是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CAMediaTiming</a>协议的一部分，表示将动画添加到图层后该图层在视觉上出现的时间 <br></li></ul><br><ul><li>  <b>timeOffset</b> ：所需的效果是从动画开始就立即在整个屏幕上看到雪花。 此属性是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CAMedia Timing</a>协议的一部分，并且基本上像动画的快进一样起作用。 我将其设置为10.0秒，可以有效地快进动画并用雪花覆盖屏幕（如果我将其设置为0.0秒，则雪花将从顶部开始缓慢下落，并且需要花费一些时间才能覆盖整个雪花屏幕。 <br></li></ul><br> 准备好发射极层之后，我创建了2个不同的发射极单元。 第一个代表圆形的“较重”雪花，另一个代表“较轻”的雪花。 <br><br> 对于“较重”的雪花效果，我使用了此发射器单元： <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> flakeEmitterCell = <span class="hljs-type"><span class="hljs-type">CAEmitterCell</span></span>() flakeEmitterCell.contents = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"snowflake_dot"</span></span>)!.cgImage flakeEmitterCell.emissionRange = .pi flakeEmitterCell.lifetime = <span class="hljs-number"><span class="hljs-number">20.0</span></span> flakeEmitterCell.birthRate = <span class="hljs-number"><span class="hljs-number">30</span></span> flakeEmitterCell.scale = <span class="hljs-number"><span class="hljs-number">0.15</span></span> flakeEmitterCell.scaleRange = <span class="hljs-number"><span class="hljs-number">0.6</span></span> flakeEmitterCell.velocity = <span class="hljs-number"><span class="hljs-number">30.0</span></span> flakeEmitterCell.velocityRange = <span class="hljs-number"><span class="hljs-number">20</span></span> flakeEmitterCell.spin = -<span class="hljs-number"><span class="hljs-number">0.5</span></span> flakeEmitterCell.spinRange = <span class="hljs-number"><span class="hljs-number">1.0</span></span> flakeEmitterCell.yAcceleration = <span class="hljs-number"><span class="hljs-number">30.0</span></span> flakeEmitterCell.xAcceleration = <span class="hljs-number"><span class="hljs-number">5.0</span></span></code> </pre> <br> 如您所见，我必须为单元设置许多属性，所有这些属性都很重要，以实现所需的视觉效果。 <br><br><ul><li>  content：用于表示雪花的CGImage。 在这种情况下，它只是上面“动手操作”部分所述的资产之一 <br></li></ul><br><ul><li>  <b>missionRange</b> ：以弧度定义角度，定义围绕发射角度的圆锥。 我将PI设置为允许粒子以任何角度在屏幕上可见 <br></li></ul><br><ul><li>  <b>寿命</b> ：定义细胞/粒子应该存活多少秒 <br></li><li>  <b>birthRate</b> ：定义每秒由发射器层生成的这种特定粒子类型的数量 <br></li></ul><br><ul><li>  <b>scale</b>和<b>scaleRange</b> ：设置应有多大的粒子，1.0是最大大小。 该范围定义了由发射器单元同时创建的粒子之间大小的变化，从而允许使用不同大小的随机单元 <br></li></ul><br><ul><li>  <b>velocity</b>和<b>velocityRange</b> ：定义像元的初始速度。 这在velocityRange属性指定的范围内随机变化 <br></li></ul><br><ul><li>  <b>spin</b>和<b>spinRange</b> ：这些定义旋转速度，以弧度/秒为单位，并在spinRange属性指定的范围内以随机量变化 <br></li><li>  <b>yAcceleration</b>和<b>xAcceleration</b> ：应用于单元的加速度矢量的分量 <br></li></ul><br> 我还需要第二个发射器来创建柔软的雪花。 对于此发射器，我要做的就是为所有属性设置相同的值，但以下两个除外： <br><br><ul><li>  <b>内容</b> ：在这种情况下，它将是巨大的，模糊的圆形图像资产 <br></li><li>  <b>速度</b> ：为了模拟更轻的雪花，我放慢了“下降”速度 <br></li></ul><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> blurryFlakeEmitterCell = <span class="hljs-type"><span class="hljs-type">CAEmitterCell</span></span>() blurryFlakeEmitterCell.contents = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"snowflake_blurry_dot"</span></span>)?.cgImage blurryFlakeEmitterCell.velocity = <span class="hljs-number"><span class="hljs-number">40</span></span> ... <span class="hljs-comment"><span class="hljs-comment">// the rest of the properties has the same values as "flakeEmitterCell"</span></span></code> </pre> <br><br> 其余的非常简单，我只需要将图层和单元链接在一起。 结果！ <br><br><pre> <code class="swift hljs">snowEmitterLayer.emitterCells = [flakeEmitterCell, blurryFlakeEmitterCell] <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.layer.addSublayer(snowEmitterLayer)</code> </pre> <br><h1> 结论 </h1><br> 很快，我就为雪花动画找到了一个可行的Badoo解决方案，并且最终结果看起来非常不错。 我以简单干净的实现方式回到了设计师手中，他们喜欢它。 <br><br> 只要您拥有正确的工具，使用粒子系统创建的动画就可以给人留下深刻的印象，并且相对易于实施。 <br><br><h1> 有关粒子发射器的扩展信息 </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">维基百科</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">雷·温德利奇</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">团结</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">艾伦·马丁论粒子系统</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN446870/">https://habr.com/ru/post/zh-CN446870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN446858/index.html">如何部署SAP HANA：解析不同的方法</a></li>
<li><a href="../zh-CN446860/index.html">3dfx Voodoo1的历史</a></li>
<li><a href="../zh-CN446862/index.html">设计师对DUMP-2019的期望：设计部分概述</a></li>
<li><a href="../zh-CN446864/index.html">能源，热量和水</a></li>
<li><a href="../zh-CN446866/index.html">操作系统：三个简单的部分。 第2部分：抽象：流程（翻译）</a></li>
<li><a href="../zh-CN446872/index.html">在StereoPi上探索OpenCV：视频深度图</a></li>
<li><a href="../zh-CN446876/index.html">莫斯科，4月18日-QIWI SERVER PARTY 4.0</a></li>
<li><a href="../zh-CN446880/index.html">图表不正确：我们的经验</a></li>
<li><a href="../zh-CN446882/index.html">MIPT有权在2020年在莫斯科举办ICPC编程世界杯</a></li>
<li><a href="../zh-CN446884/index.html">可以从新鲜的科幻小说中阅读和观看的内容：火星，机器人和叛逆的AI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>