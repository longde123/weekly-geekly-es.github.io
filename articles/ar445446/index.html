<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ณ๐ฟ ๐ โข๏ธ ููู ุงุณุชุฎุฏููุง ุงููุณุฎ ุงููุชูุงุซู ุงููุคุฌู ูุงุณุชุฑุฏุงุฏ ุงูุจูุงูุงุช ุจุนุฏ ุนุทู ูุงุฏุญ ูุน PostgreSQL ๐จ๐ผโ๐ผ ๐ค๐ฟ ๐ฉโโ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงููุณุฎ ุงููุชูุงุซู ููุณ ูุณุฎุฉ ุงุญุชูุงุทูุฉ. ุฃู ูุงุ ุฅููู ููููุฉ ุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซู ุงููุคุฌู ููุงุณุชุฑุฏุงุฏ ุนู ุทุฑูู ุญุฐู ุงูุงุฎุชุตุงุฑุงุช ุจุทุฑูู ุงูุฎุทุฃ. 


 ูุนุฏ ูุชุฎุตุตู ุงูุจููุฉ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููู ุงุณุชุฎุฏููุง ุงููุณุฎ ุงููุชูุงุซู ุงููุคุฌู ูุงุณุชุฑุฏุงุฏ ุงูุจูุงูุงุช ุจุนุฏ ุนุทู ูุงุฏุญ ูุน PostgreSQL</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/445446/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/d5/ij/ht/d5ijhtuldyyxn2aomtg2r4sdvum.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ุงููุณุฎ ุงููุชูุงุซู ููุณ ูุณุฎุฉ ุงุญุชูุงุทูุฉ.  ุฃู ูุงุ  ุฅููู ููููุฉ ุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซู ุงููุคุฌู ููุงุณุชุฑุฏุงุฏ ุนู ุทุฑูู ุญุฐู ุงูุงุฎุชุตุงุฑุงุช ุจุทุฑูู ุงูุฎุทุฃ. </p><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุนุฏ ูุชุฎุตุตู ุงูุจููุฉ ุงูุชุญุชูุฉ</a> ูู GitLab ูุณุคูููู ุนู ุชุดุบูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GitLab.com</a> ุ ุฃูุจุฑ ูุซุงู ุนูู GitLab ูู ุงูุทุจูุนุฉ.  ููุงู 3 ููุงููู ูุณุชุฎุฏู ูุญูุงูู 7 ููุงููู ูุดุฑูุน ุ ููุฐุง ูุงุญุฏ ูู ุฃูุจุฑ ููุงูุน SaaS ููุชูุญุฉ ุงููุตุฏุฑ ูุน ุจููุฉ ูุฎุตุตุฉ.  ุจุฏูู ูุธุงู ูุงุนุฏุฉ ุจูุงูุงุช PostgreSQL ุ ูู ุชุฐูุจ ุงูุจููุฉ ุงูุชุญุชูุฉ ูู GitLab.com ุฅูู ุฃุจุนุฏ ูู ุฐูู ุ ููุญู ูุง ููุนู ุฐูู ููุชุณุงูุญ ูุน ุงูุฃุฎุทุงุก ูู ุญุงูุฉ ุญุฏูุซ ุฃู ุฃุนุทุงู ูู ุญุงูุฉ ููุฏ ุงูุจูุงูุงุช.  ูู ุบูุฑ ุงููุญุชูู ุฃู ุชุญุฏุซ ูุซู ูุฐู ุงููุงุฑุซุฉ ุ ููููุง ุนูู ุงุณุชุนุฏุงุฏ ุฌูุฏ ูุชุฎุฒูููุง ูุน ุขููุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุชูุฑุงุฑ ุงููุฎุชููุฉ. </p><br><p style=";text-align:right;direction:rtl"> ุงููุณุฎ ุงููุชูุงุซู ููุณ ุฃุฏุงุฉ ูุณุฎ ุงุญุชูุงุทู ููุงุนุฏุฉ ุงูุจูุงูุงุช ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุธุฑ ุฃุฏูุงู</a> ).  ูููู ุงูุขู ุณูุฑู ููููุฉ ุงุณุชุฑุฏุงุฏ ุงูุจูุงูุงุช ุงููุญุฐููุฉ ุนู ุทุฑูู ุงูุฎุทุฃ ุจุณุฑุนุฉ ุจุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซู ุงููุชุฃุฎุฑ: ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GitLab.com ุ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุญุฐู</a> ุงููุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุงุฎุชุตุงุฑ</a> ููุดุฑูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>gitlab-ce</code></a> ูููุฏ ุงูุงุชุตุงู ูุน ุทูุจุงุช ุงูุฏูุฌ ูุงูููุงู. </p><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ูุณุฎุฉ ูุชูุงุซูุฉ ูุชุฃุฎุฑุฉ ุ ุงุณุชุฑุฏูุง ุงูุจูุงูุงุช ุฎูุงู 1.5 ุณุงุนุฉ ููุท.  ุงูุธุฑ ููู ูุงู. </p><a name="habracut"></a><br><h3 id="vosstanovlenie-na-moment-vremeni-s-postgresql" style=";text-align:right;direction:rtl">  ุงูุงูุชุนุงุด ูู ุงูููุช ุงูููุงุณุจ ูุน PostgreSQL </h3><br><p style=";text-align:right;direction:rtl">  ูุญุชูู PostgreSQL ุนูู ูุธููุฉ ูุถููุฉ ุชููู ุจุงุณุชุนุงุฏุฉ ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ููุช ูุญุฏุฏ.  ูุทูู ุนููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Point-in-Time Recovery</a> (PITR) ููุณุชุฎุฏู ููุณ ุงูุขููุงุช ุงูุชู ุชุญุงูุธ ุนูู ุฃูููุฉ ุงููุณุฎุฉ ุงููุชูุงุซูุฉ: ุจุฏุกูุง ูู ููุทุฉ ุณุฑูุนุฉ ูู ูุฌููุนุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุฃููููุง (ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุฃุณุงุณู) ุ ูุทุจู ุนุฏุฏูุง ูู ุชุบููุฑุงุช ุงูุญุงูุฉ ุญุชู ููุทุฉ ุฒูููุฉ ูุนููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุงุณุชุฎุฏุงู ูุฐู ุงููุธููุฉ ููุญุตูู ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุจุงุฑุฏุฉ ุ ูููู ุจุงูุชุธุงู ุจุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุฃุณุงุณูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุฎุฒูููุง ูู ุงูุฃุฑุดูู (ุชูุฌุฏ ุฃุฑุดููุงุช GitLab ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชุฎุฒูู ุงูุณุญุงุจู</a> ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Google</a> ).  ูููู ุฃูุถูุง ุจูุฑุงูุจุฉ ุงูุชุบููุฑุงุช ูู ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุฎูุงู ุฃุฑุดูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณุฌู ุณุฌู ุงูุฏุฎูู</a> (WAL).  ููุน ูู ูุฐุง ุ ูููููุง ุฃุฏุงุก PITR ูู ุฃุฌู ุงูุงุณุชุฑุฏุงุฏ ุจุนุฏ ุนุทู ูุงุฏุญ: ูุจุฏุฃ ุจุงูุตูุฑุฉ ุงูุชู ุชู ุงูุชูุงุทูุง ูุจู ุงูุฎุทุฃ ููุทุจู ุงูุชุบููุฑุงุช ูู ุฃุฑุดูู WAL ุญุชู ุงููุดู. </p><br><h3 id="chto-takoe-otlozhennaya-replikaciya" style=";text-align:right;direction:rtl">  ูุง ูู ุงูุชูุฑุงุฑ ุงููุคุฌูุ </h3><br><p style=";text-align:right;direction:rtl">  ุงููุณุฎ ุงููุชูุงุซู ุงููุคุฌู ูู ุชุทุจูู ุชุบููุฑุงุช WAL ุงููุคุฌูุฉ.  ุจูุนูู ุ ุญุฏุซุช ุงููุนุงููุฉ ูู ุงูุณุงุนุฉ <code>X</code> ุ ูููููุง ุณุชุธูุฑ ูู ุงููุณุฎุฉ ุงููุชูุงุซูุฉ ูุน ุชุฃุฎูุฑ <code>d</code> ูู ุงูุณุงุนุฉ <code>X + d</code> . </p><br><p style=";text-align:right;direction:rtl">  ูุญุชูู PostgreSQL ุนูู ุทุฑููุชูู ูุชูููู ุงููุณุฎุฉ ุงููุชูุงุซูุฉ ุงููุนููุฉ ููุงุนุฏุฉ ุงูุจูุงูุงุช: ุงูุงุณุชุนุงุฏุฉ ูู ุงูุฃุฑุดูุฉ ูุชูุฑุงุฑ ุงูุจุซ.  ูู ุงููุงูุน ุ ุชุนูู ุงูุงุณุชุนุงุฏุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ุงูุฃุฑุดูู</a> ุ ูุซู PITR ุ ูููู ุจุดูู ูุณุชูุฑ: ูุณุชุฎุฑุฌ ุจุงุณุชูุฑุงุฑ ุงูุชุบููุฑุงุช ูู ุฃุฑุดูู WAL ููุทุจููุง ุนูู ุงููุณุฎุฉ ุงููุชูุงุซูุฉ.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุชุฏูู ุงููุณุฎ ุงููุชูุงุซู</a> ูุจุงุดุฑุฉ ุจุงุณุชุฑุฏุงุฏ ุฏูู WAL ูู ูุถูู ูุงุนุฏุฉ ุงูุจูุงูุงุช upstream.  ูุญู ููุถู ุงูุงุณุชุฑุฏุงุฏ ูู ุงูุฃุฑุดูู - ูู ุงูุฃุณูู ุฅุฏุงุฑุชู ููุฏูู ุฃุฏุงุก ุนุงุฏู ุ ูุงูุฐู ูุง ูุชุฎูู ุนู ูุฌููุนุฉ ุงูุนูู. </p><br><h3 id="kak-nastroit-otlozhennoe-vosstanovlenie-iz-arhiva" style=";text-align:right;direction:rtl">  ููููุฉ ุฅุนุฏุงุฏ ุงูุงูุชุนุงุด ุงููุคุฌู ูู ุงูุฃุฑุดูู </h3><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุชู</a> ูุตู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฎูุงุฑุงุช ุงูุงุณุชุฑุฏุงุฏ</a> ูู ููู <code>recovery.conf</code> .  ูุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">standby_mode = 'on' restore_command = '/usr/bin/envdir /etc/wal-ed/env /opt/wal-e/bin/wal-e wal-fetch -p 4 "%f" "%p"' recovery_min_apply_delay = '8h' recovery_target_timeline = 'latest'</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ูุฐู ุงููุนููุงุช ุ ุฃูุดุฃูุง ูุณุฎุฉ ูุชูุงุซูุฉ ูุณูู ูุน ุงุณุชุฑุฏุงุฏ ูู ุงูุฃุฑุดูู.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุชู ุงุณุชุฎุฏุงู wal-e ููุง</a> ูุงุณุชุฎุฑุงุฌ ููุงุทุน WAL ( <code>restore_command</code> ) ูู ุงูุฃุฑุดูู ุ ูุณูุชู ุชุทุจูู ุงูุชุบููุฑุงุช ุจุนุฏ ุซูุงูู ุณุงุนุงุช ( <code>recovery_min_apply_delay</code> ).  ุณุชุฑุงูุจ ุงููุณุฎุฉ ุงููุชูุงุซูุฉ ุงูุชุบููุฑุงุช ูู ุงููุฎุทุท ุงูุฒููู ูู ุงูุฃุฑุดูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุจุณุจุจ ุงููุดู ูู ุงููุฌููุนุฉ ( <code>recovery_target_timeline</code> ). </p><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู <code>recovery_min_apply_delay</code> ููููู ุชูููู ุงููุณุฎ ุงููุชูุงุซู ุงููุชุฃุฎุฑ ููุจุซ ุ ูููู ููุงู ุจุนุถ ุงูุญูู ุงูููุชุฑูุฉ ุจูุชุญุงุช ุงููุณุฎ ุงููุชูุงุซู ูุงูุชุนูููุงุช ุงูุงุญุชูุงุทูุฉ ุงูุณุงุฎูุฉ ููุง ุฅูู ุฐูู.  ูุณูุญ ูู ุฃุฑุดูู WAL ุจุชูุงุฏููุง. </p><br><p style=";text-align:right;direction:rtl">  ุธูุฑุช ุงููุนููุฉ <code>recovery_min_apply_delay</code> ููุท ูู PostgreSQL 9.3.  ูู ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ ุ ูููุณุฎ ุงููุชูุงุซู ุงููุคุฌู ุ ุชุญุชุงุฌ ุฅูู ุชูููู ูุฌููุนุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ูุธุงุฆู ุฅุฏุงุฑุฉ ุงูุงุณุชุฑุฏุงุฏ</a> ( <code>pg_xlog_replay_pause(), pg_xlog_replay_resume()</code> ) ุฃู ุงูุงุญุชูุงุธ ุจูุทุงุนุงุช WAL ูู ุงูุฃุฑุดูู ูุชุฃุฎูุฑ ุงูููุช. </p><br><h3 id="kak-postgresql-eto-delaet" style=";text-align:right;direction:rtl">  ููู ููุนู ุจูุณุชุฌุฑุณ ูุฐุงุ </h3><br><p style=";text-align:right;direction:rtl">  ูุถููู ููุนุฑูุฉ ููู ูููู PostgreSQL ุจุชุทุจูู ุงูุงุณุชุฑุฏุงุฏ ุงููุคุฌู.  ุฏุนููุง ูููู ูุธุฑุฉ ุนูู <a href=""><code>recoveryApplyDelay(XlogReaderState)</code></a> .  ูุชู ุงุณุชุฏุนุงุคู ูู <a href="">ุงูุญููุฉ ุงูุฑุฆูุณูุฉ</a> ููู ุฅุฏุฎุงู ูู WAL. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">static bool recoveryApplyDelay(XLogReaderState *record) { uint8 xact_info; TimestampTz xtime; long secs; int microsecs; /* nothing to do if no delay configured */ if (recovery_min_apply_delay &lt;= 0) return false; /* no delay is applied on a database not yet consistent */ if (!reachedConsistency) return false; /* * Is it a COMMIT record? * * We deliberately choose not to delay aborts since they have no effect on * MVCC. We already allow replay of records that don't have a timestamp, * so there is already opportunity for issues caused by early conflicts on * standbys. */ if (XLogRecGetRmid(record) != RM_XACT_ID) return false; xact_info = XLogRecGetInfo(record) &amp; XLOG_XACT_OPMASK; if (xact_info != XLOG_XACT_COMMIT &amp;&amp; xact_info != XLOG_XACT_COMMIT_PREPARED) return false; if (!getRecordTimestamp(record, &amp;xtime)) return false; recoveryDelayUntilTime = TimestampTzPlusMilliseconds(xtime, recovery_min_apply_delay); /* * Exit without arming the latch if it's already past time to apply this * record */ TimestampDifference(GetCurrentTimestamp(), recoveryDelayUntilTime, &amp;secs, &amp;microsecs); if (secs &lt;= 0 &amp;&amp; microsecs &lt;= 0) return false; while (true) { // Shortened: // Use WaitLatch until we reached recoveryDelayUntilTime // and then break; } return true; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฎูุงุตุฉ ุงูููู ูู ุฃู ุงูุชุฃุฎูุฑ ูุนุชูุฏ ุนูู ุงูููุช ุงููุนูู ุงููุณุฌู ูู ุงูุทุงุจุน ุงูุฒููู ูุงุฑุชูุงุจ ุงููุนุงููุฉ ( <code>xtime</code> ).  ููุง ุชุฑู ุ ูุฅู ุงูุชุฃุฎูุฑ ููุทุจู ููุท ุนูู ุงูุฅูุชุฒุงูุงุช ููุง ููุณ ุงูุณุฌูุงุช ุงูุฃุฎุฑู - ูุชู ุชุทุจูู ุฌููุน ุงูุชุบููุฑุงุช ูุจุงุดุฑุฉ ุ ููุชู ุชุฃุฎูุฑ ุงูุงูุชุฒุงู ุ ุญุชู ูุฑู ุงูุชุบููุฑุงุช ููุท ุจุนุฏ ุชูููู ุงูุชุฃุฎูุฑ. </p><br><h3 id="kak-ispolzovat-otlozhennuyu-repliku-dlya-vosstanovleniya-dannyh" style=";text-align:right;direction:rtl">  ููููุฉ ุงุณุชุฎุฏุงู ูุณุฎุฉ ูุชูุงุซูุฉ ูุณูู ูุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช </h3><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูููู ูุฏููุง ูุชูุฉ ูุงุนุฏุฉ ุจูุงูุงุช ูู ุงูุฅูุชุงุฌ ููุณุฎุฉ ูุชูุงุซูุฉ ูุน ุชุฃุฎูุฑ ููุฏุฉ ุซูุงูู ุณุงุนุงุช.  ุฏุนููุง ูุฑู ููููุฉ ุงุณุชุฑุฏุงุฏ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ูุซุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุญุฐู ุงูุงุฎุชุตุงุฑุงุช ุจุทุฑูู ุงูุฎุทุฃ</a> . </p><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ุนูููุง ุจุงููุดููุฉ ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃููููุง ุงูุงุณุชุฑุฏุงุฏ ูุคูุชูุง ูู ุงูุฃุฑุดูู</a> ูููุณุฎุฉ ุงููุชูุงุซูุฉ ุงูุจุทูุฆุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">SELECT pg_xlog_replay_pause();</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุน ุชููู ูุคูุช ุ ูู ููู ูุฏููุง ุฃู ุฎุทุฑ ูู ุฃู ุงููุณุฎุฉ ุงููุชูุงุซูุฉ ุณุชูุฑุฑ ุทูุจ <code>DELETE</code> .  ุดูุก ูููุฏ ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ููุช ููุนุฑูุฉ ุฐูู. </p><br><p style=";text-align:right;direction:rtl">  ุฎูุงุตุฉ ุงูููู ูู ุฃู ุงููุณุฎุฉ ุงููุชูุงุซูุฉ ุงููุคุฌูุฉ ูุฌุจ ุฃู ุชุตู ุฅูู ุงูููุทุฉ ูุจู ุทูุจ <code>DELETE</code> .  ููุง ูุนุฑู ุชูุฑูุจุง ุงูููุช ุงููุงุฏู ููุฅุฒุงูุฉ.  ููุฏ ุฃุฒููุง <code>recovery_min_apply_delay</code> ูุฃุถููุง <code>recovery_target_time</code> ุฅูู <code>recovery.conf</code> .  ุญุชู ุชุตู ุงููุณุฎุฉ ุงููุชูุงุซูุฉ ุฅูู ุงููุญุธุฉ ุงูููุงุณุจุฉ ุฏูู ุชุฃุฎูุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">recovery_target_time = '2018-10-12 09:25:00+00'</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุน ุงูุทูุงุจุน ุงูุฒูููุฉ ุ ูู ุงูุฃูุถู ุชูููู ุงููุงุฆุถ ุญุชู ูุง ุชููุช.  ุตุญูุญ ุ ูููุง ูุงู ุงูุงูุฎูุงุถ ุฃูุจุฑ ุ ูููุง ููุฏุช ุงูุจูุงูุงุช.  ูุฑุฉ ุฃุฎุฑู ุ ุฅุฐุง ุชุฌุงูุฒูุง ุทูุจ <code>DELETE</code> ุ ูุณูุชู ุญุฐู ูู ุดูุก ูุฑุฉ ุฃุฎุฑู ูุณูููู ุนููู ุงูุจุฏุก ูู ุฌุฏูุฏ (ุฃู ุญุชู ุงูุงุญุชูุงุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ ุจุงุฑุฏุฉ ูู PITR). </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ุฃุนุฏูุง ุชุดุบูู ูุซูู Postgres ุงููุคุฌู ุ ูุชูุฑุฑุช ููุงุทุน WAL ุญุชู ุงูููุช ุงููุญุฏุฏ.  ููููู ุชุชุจุน ุงูุชูุฏู ุงููุญุฑุฒ ูู ูุฐู ุงููุฑุญูุฉ ุญุณุจ ุงูุทูุจ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">SELECT -- current location in WAL pg_last_xlog_replay_location(), -- current transaction timestamp (state of the replica) pg_last_xact_replay_timestamp(), -- current physical time now(), -- the amount of time still to be applied until recovery_target_time has been reached '2018-10-12 09:25:00+00'::timestamptz - pg_last_xact_replay_timestamp() as delay;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูู ูุชุบูุฑ ุงูุทุงุจุน ุงูุฒููู ุจุนุฏ ุงูุขู ุ ูุณูุชู ุฅููุงู ุงูุงุณุชุฑุฏุงุฏ.  ููููู ุชูููู ุฅุฌุฑุงุก <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>recovery_target_action</code></a> ูุฅุบูุงู ูุซูู ุฃู ุชูุฏูู ุฃู ุฅููุงูู ูุคูุชูุง ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู (ุจุดูู ุงูุชุฑุงุถู ุ ูุชููู ูุคูุชูุง). </p><br><p style=";text-align:right;direction:rtl">  ุฌุงุกุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅูู ุญุงูุฉ ูุจู ูุฐุง ุงูุทูุจ ุงููุดุคูู.  ููููู ุงูุขู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชุตุฏูุฑ ุงูุจูุงูุงุช.  ูููุง ุจุชุตุฏูุฑ ุงูุจูุงูุงุช ุงููุญุฐููุฉ ุญูู ุงูุงุฎุชุตุงุฑ ูุฌููุน ุงูุงุชุตุงูุงุช ูุน ุงูููุงู ูุฏูุฌ ุงูุทูุจุงุช ูููููุง ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุนุงููุฉ.  ุฅุฐุง ูุงูุช ุงูุฎุณุงุฆุฑ ูุงุฆูุฉ ุ ููููู ุจุจุณุงุทุฉ ุงูุชุฑููุฌ ูููุณุฎุฉ ุงููุชูุงุซูุฉ ูุงุณุชุฎุฏุงููุง ูุฎูููุฉ ุฑุฆูุณูุฉ.  ูููู ุจุนุฏ ุฐูู ุณูู ุชุถูุน ูู ุงูุชุบููุฑุงุช ุจุนุฏ ุงููุญุธุฉ ุงูุชู ุงุณุชุนุงุฏูุง ูููุง ุนุงููุชู. </p><br><p style=";text-align:right;direction:rtl">  ุจุฏูุงู ูู ุงูุทูุงุจุน ุงูุฒูููุฉ ุ ูู ุงูุฃูุถู ุงุณุชุฎุฏุงู ูุนุฑูุงุช ุงููุนุงููุงุช.  ูู ุงููููุฏ ูุชุงุจุฉ ูุฐู ุงููุนุฑูุงุช ุ ุนูู ุณุจูู ุงููุซุงู ุ <code>log_statements = 'ddl'</code> DDL (ูุซู <code>DROP TABLE</code> ) ุ ุจุงุณุชุฎุฏุงู <code>log_statements = 'ddl'</code> .  ุฅุฐุง ูุงู ูุฏููุง ูุนุฑูู ูุนุงููุฉ ุ ูุณูุฃุฎุฐ <code>recovery_target_xid</code> ููุนูู ูู ุดูุก ูุตููุงู ุฅูู ุงููุนุงููุฉ ูุจู ุทูุจ <code>DELETE</code> . </p><br><p style=";text-align:right;direction:rtl">  ุงูุนูุฏุฉ ุฅูู ุงูุนูู ุจุณูุทุฉ ููุบุงูุฉ: ูู ุจุฅุฒุงูุฉ ุฌููุน ุงูุชุบููุฑุงุช ูู <code>recovery.conf</code> ุซู ุฃุนุฏ ุชุดุบูู Postgres.  ูุฑูุจุงู ุ ุณูุธูุฑ ุชุฃุฎูุฑ ููุฏุฉ ุซูุงูู ุณุงุนุงุช ูู ุงููุณุฎุฉ ุงููุชูุงุซูุฉ ูุฑุฉ ุฃุฎุฑู ุ ููุญู ูุณุชุนุฏูู ูููุดุงูู ุงููุณุชูุจููุฉ. </p><br><h3 id="preimuschestva-dlya-vosstanovleniya" style=";text-align:right;direction:rtl">  ููุงุฆุฏ ุงูุงูุชุนุงุด </h3><br><p style=";text-align:right;direction:rtl">  ูุน ูุณุฎุฉ ูุชูุงุซูุฉ ูุชุฃุฎุฑุฉ ุ ุจุฏูุงู ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุจุงุฑุฏุฉ ุ ูุง ููุฒู ุงุณุชุนุงุฏุฉ ุงูุตูุฑุฉ ุจุฃููููุง ูู ุงูุฃุฑุดูู ูุณุงุนุงุช.  ุนูู ุณุจูู ุงููุซุงู ุ ูุญุชุงุฌ ุฅูู ุฎูุณ ุณุงุนุงุช ููุญุตูู ุนูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุงูุฃุณุงุณูุฉ ุงููุงููุฉ ุงูุจุงูุบุฉ 2 ุชูุฑุงุจุงูุช.  ุซู ูุง ูุฒุงู ูุชุนูู ุนููู ุชุทุจูู WAL ุงููููู ุจุงููุงูู ูุงุณุชุนุงุฏุฉ ุงูุญุงูุฉ ุงููุทููุจุฉ (ูู ุฃุณูุฃ ุงูุญุงูุงุช). </p><br><p style=";text-align:right;direction:rtl">  ูุณุฎุฉ ูุชูุงุซูุฉ ูุคุฌูุฉ ุฃูุถู ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุจุงุฑุฏุฉ ุจุทุฑููุชูู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ุญุงุฌุฉ ููุญุตูู ุนูู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุฃุณุงุณู ุจุฃูููู ูู ุงูุฃุฑุดูู. </li><li style=";text-align:right;direction:rtl">  ููุงู ูุงูุฐุฉ ุซุงุจุชุฉ ููุฏุฉ ุซูุงูู ุณุงุนุงุช ูู ููุงุทุน WAL ุชุญุชุงุฌ ุฅูู ุงูุชูุฑุงุฑ. </li></ol><br><p style=";text-align:right;direction:rtl">  ูุญู ุฃูุถูุง ูุชุญูู ุจุงุณุชูุฑุงุฑ ูู ุฅููุงููุฉ ุฅุนุฏุงุฏ PITR ูู WAL ุ ูุณููุงุญุธ ุจุณุฑุนุฉ ุญุฏูุซ ุชูู ุฃู ูุดุงูู ุฃุฎุฑู ูู ุฃุฑุดูู WAL ุ ูุน ูุฑุงูุจุฉ ุชุฃุฎุฑ ุงููุณุฎุฉ ุงููุชูุงุซูุฉ ุงููุชุฃุฎุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุงููุซุงู ุ ุงุณุชุบุฑููุง 50 ุฏูููุฉ ูุงุณุชุฑุฏุงุฏ ุ ุฃู ุฃู ุงูุณุฑุนุฉ ูุงูุช 110 ุฌูุฌุงุจุงูุช ูู ุจูุงูุงุช WAL ูู ุงูุณุงุนุฉ (ูุงู ุงูุฃุฑุดูู ูุง ูุฒุงู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">AWS S3 ุจุนุฏ ุฐูู</a> ).  ูู ุงููุฌููุน ุ ุญููุง ุงููุดููุฉ ูุงุณุชุนุฏูุง ุงูุจูุงูุงุช ูู 1.5 ุณุงุนุฉ. </p><br><h3 id="itogi-gde-prigoditsya-otlozhennaya-replika-a-gde-net" style=";text-align:right;direction:rtl">  ุฎูุงุตุฉ ุงูููู: ุญูุซ ุชุฃุชู ุงููุณุฎุฉ ุงููุชูุงุซูุฉ ุงููุชุฃุฎุฑุฉ ูู ูุชูุงูู ูุฏู (ูุญูุซ ูุง) </h3><br><p style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏู ุงููุณุฎ ุงููุชูุงุซู ุงูุจุทูุก ูุฅุณุนุงูุงุช ุฃูููุฉ ุฅุฐุง ููุฏุช ุงูุจูุงูุงุช ุนู ุทุฑูู ุงูุฎุทุฃ ููุงุญุธุช ูุฐู ุงููุงุฑุซุฉ ุถูู ุงูุชุฃุฎูุฑ ุงูููููู. </p><br><blockquote style=";text-align:right;direction:rtl">  ูููู ุถุน ูู ุงุนุชุจุงุฑู: ุงููุณุฎ ุงููุชูุงุซู ููุณ ูุณุฎุฉ ุงุญุชูุงุทูุฉ. </blockquote><p style=";text-align:right;direction:rtl">  ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุชูุฑุงุฑ ููุง ุฃูุฏุงู ูุฎุชููุฉ.  ูููู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุจุงุฑุฏ ูููุฏูุง ุฅุฐุง ููุช <code>DELETE</code> ุฃู <code>DROP TABLE</code> ุจุทุฑูู ุงูุฎุทุฃ.  ูููู ุจุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุงูุชุฎุฒูู ุงูุจุงุฑุฏ ูุงุณุชุนุงุฏุฉ ุงูุญุงูุฉ ุงูุณุงุจูุฉ ููุฌุฏูู ุฃู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุฃููููุง.  ูููู ูู ููุณ ุงูููุช ุ ูุชู ุชุดุบูู ุงุณุชุนูุงู <code>DROP TABLE</code> ุนูู ุงูููุฑ ุชูุฑูุจูุง ูู ุฌููุน ุงููุณุฎ ุงููุชูุงุซูุฉ ุนูู ูุฌููุนุฉ ุงูุนูู ุ ูุฐูู ูู ูุญูุธู ุงููุณุฎ ุงููุชูุงุซู ุงูุนุงุฏู ููุง.  ูุญุงูุธ ุงููุณุฎ ุงููุชูุงุซู ููุณู ุนูู ุฅููุงููุฉ ุงููุตูู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุนูุฏูุง ูุชู ุชุฃุฌูุฑ ุฎูุงุฏู ูููุตูุฉ ูุชูุฒูุน ุงูุญูู. </p><br><p style=";text-align:right;direction:rtl">  ุญุชู ูุน ูุฌูุฏ ูุณุฎุฉ ูุชูุงุซูุฉ ูุชุฃุฎุฑุฉ ุ ูุญุชุงุฌ ุฃุญูุงููุง ุฅูู ูุณุฎ ุงุญุชูุงุทู ุจุงุฑุฏ ูู ููุงู ุขูู ุฅุฐุง ุชุนุทู ูุฑูุฒ ุจูุงูุงุช ุฃู ุชูููุง ุฎูููุง ุฃู ุฃุญุฏุงุซ ุฃุฎุฑู ูู ุชูุงุญุธูุง ุนูู ุงูููุฑ.  ูุง ููุฌุฏ ุฃู ูุนูู ูู ุชูุฑุงุฑ ูุงุญุฏ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงููุฐูุฑุฉ.</strong>  ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GitLab.com ุ</a> ูุญู ุงูุขู ูุญูู ูู ููุฏุงู ุงูุจูุงูุงุช ููุท ุนูู ูุณุชูู ุงููุธุงู ููุง ูุณุชุนูุฏ ุงูุจูุงูุงุช ุนูู ูุณุชูู ุงููุณุชุฎุฏู. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar445446/">https://habr.com/ru/post/ar445446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar445434/index.html">ุฃูุถู ูุธููุฉ ูู ุงูุนุงูู: ุงูุจุญุซ ุนู ุญุจูุจุฉ</a></li>
<li><a href="../ar445436/index.html">ุฅุนุงุฏุฉ ุงูุชุฏุฑูุจ ูู DevOps - ูุงุฐุง ุชุนุฏ ููุณู</a></li>
<li><a href="../ar445438/index.html">ุงูุชุนุฑูู ุนูู ุงูุนูุงุตุฑ ุงููุถุงุกุฉ ูุนูุงุตุฑ ุงูููุจ ุงููุณุชูุฏุฉ ุฅูููุง</a></li>
<li><a href="../ar445440/index.html">ูุฑุงุฌุนุฉ ุงูููุฏ: ูุตุงุฆุญ ุณูุฆุฉ ูููุณุงูู ูุงููุฑุงุฌุน</a></li>
<li><a href="../ar445444/index.html">ุชุญุฏูุซ ูุญุฏุงุช ุงูุทุงูุฉ ุงูุดูุณูุฉ ุนุงููุฉ ุงูุฃุฏุงุก ูู REC ู Trina (Solar)</a></li>
<li><a href="../ar445448/index.html">ุชูุตูู ุงูุงุณุชูุงู ุงูุชููุงุฆู ูุดูุงุฏุงุช allowencrypt ุจุงุณุชุฎุฏุงู ูุญุฏุฉ ุงูููู ูู ูุธุงู ุงูุชุดุบูู linux</a></li>
<li><a href="../ar445450/index.html">ุชูุฏูุฏ ุงููุชุตูุญ ู toster.ru</a></li>
<li><a href="../ar445452/index.html">ูุณุชูุฏุนุงุช ูููุฏุฉ ูุน Eloquentุ</a></li>
<li><a href="../ar445454/index.html">ุชูุช ุงูุนููู ุจู ุงูุตูุฑ ุฏุงุฎู ูุงูุฏู ุชู ุงููุดุท ุณุชุงุฑ 40 ุนุฑุถ ุจุฑุงูู</a></li>
<li><a href="../ar445456/index.html">ุงูุจุญุซ ูู 1 ุชูุฑุงุจุงูุช / ุซุงููุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>