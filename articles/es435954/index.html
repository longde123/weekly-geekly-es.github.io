<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÄ ‚ò¶Ô∏è üÜó Desarrollo de m√≥dulos para t√≠teres con kit de desarrollo de t√≠teres ü•• üßóüèº üéüÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace aproximadamente un mes, tuve una opci√≥n: si escribir el m√≥dulo para t√≠teres "a la mesa" (es decir, para la infraestructura interna) o hacerlo uni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desarrollo de m√≥dulos para t√≠teres con kit de desarrollo de t√≠teres</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435954/"><p>  Hace aproximadamente un mes, tuve una opci√≥n: si escribir el m√≥dulo para t√≠teres "a la mesa" (es decir, para la infraestructura interna) o hacerlo universal, abrir la fuente y publicarlo en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">falsificaci√≥n de t√≠teres</a> .  Por supuesto, ser√≠a m√°s r√°pido y m√°s f√°cil esbozar r√°pidamente 2-3 clases para usted y calmarse, pero la experiencia adquirida en el proceso de publicaci√≥n del m√≥dulo es valiosa y quiero compartirla.  En RuNet, no hay informaci√≥n sobre el uso del kit de desarrollo de t√≠teres (en adelante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PDK</a> ), por lo que puede considerar esto como una especie de tutorial. </p><br><h2 id="o-chyom-statya">  ¬øDe qu√© trata el art√≠culo? </h2><br><p>  En el proceso de desarrollo de un m√≥dulo (o m√°s bien, dos), descubr√≠ PDK, que facilita enormemente tanto el desarrollo como el mantenimiento de los m√≥dulos.  A saber: </p><br><ul><li> Formatee <code>metadata.json</code> autom√°ticamente cuando actualice por √∫ltima vez </li><li>  Generaci√≥n de configuraci√≥n para varios sistemas de CI que pueden hacer lo siguiente: <br><ul><li>  Comprobaci√≥n del c√≥digo ruby ‚Äã‚Äãcon rubocop linter </li><li>  Ejecuci√≥n de pruebas unitarias </li><li>  Bajo ciertas condiciones: llenado autom√°tico del c√≥digo de trabajo de falsificaci√≥n de marionetas </li></ul></li><li>  Generando documentaci√≥n basada en etiquetas en comentarios usando yard </li><li>  Placa <code>[PDK]</code> para el m√≥dulo en forja de marionetas.  Un poco, pero agradable! </li></ul><br><p>  Todos interesados <a name="habracut"></a>  ¬°Pido un gato! </p><br><h4 id="v-kachestve-primerov">  Como ejemplos </h4><br><p>  Si desea ver y sentir lo que se entiende durante el proceso de lectura, puede abrir uno de los dos (o ambos) m√≥dulos mencionados: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">clickhouse</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">xmlsimple</a> .  Ambos fueron desarrollados utilizando el PDK y otras herramientas descritas en el art√≠culo. </p><br><h2 id="soderzhanie">  Contenido </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øDe qu√© trata el art√≠culo?</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Como ejemplos</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øQu√© es PDK?</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instalaci√≥n</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contenido PDK</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Crear un m√≥dulo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nueva clase</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuevo tipo_definido</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuevo proveedor y tarea</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Generando documentaci√≥n con t√≠teres</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Personalizaci√≥n de plantillas</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ejecutando varios CI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bonificaci√≥n: escribimos pruebas unitarias para clases, tipos y funciones</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En lugar de salida</a> </li></ul><br><h1 id="chto-zhe-takoe-pdk">  ¬øQu√© es PDK? </h1><br><p>  De la documentaci√≥n oficial: </p><br><blockquote>  Cree un m√≥dulo completo con clases, tipos definidos y tareas, y pruebe y valide su trabajo a medida que avanza.  PDK proporciona una estructura de m√≥dulo completa, plantillas para clases, tipos definidos y tareas, y una infraestructura de prueba.  Puede validar y probar su m√≥dulo contra varios sistemas operativos y m√∫ltiples versiones de Puppet. </blockquote><p>  En mi traducci√≥n libre: </p><br><blockquote>  Le permite crear un m√≥dulo completo con clases, tipos, tareas y pruebas para verificar el funcionamiento del m√≥dulo.  PDK proporciona una estructura completa y plantillas para todo lo anterior.  Con esta herramienta, puede verificar el funcionamiento del m√≥dulo con varias versiones de Puppet, as√≠ como en varios sistemas operativos. </blockquote><p>  Suena bien?  Bueno, as√≠ es realmente.  Hasta el momento en que comenc√© a trabajar en el m√≥dulo, que se decidi√≥ escribir inmediatamente para c√≥digo abierto, no sospech√© de esta herramienta, y ahora tengo la intenci√≥n de transferir toda la infraestructura interna para usar el PDK. </p><br><p>  Describir√© c√≥mo ponerlo, y qu√© herramientas y comandos contiene. </p><br><h2 id="ustanovka">  Instalaci√≥n </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La p√°gina oficial de instalaci√≥n</a> .  Al usar este enlace, es casi seguro que encontrar√° la manera correcta de instalar PDK en su host.  Si por alguna raz√≥n no tiene suerte y su sistema operativo no est√° all√≠, siempre hay una rotonda en el formulario: </p><br><pre> <code class="bash hljs">gem install pdk</code> </pre> <br><p>  De hecho, PDK es solo una joya, y est√° configurado de esa manera. </p><br><h2 id="soderzhimoe-pdk">  Contenido PDK </h2><br><p>  En general, PDK no es m√°s que un conjunto de gemas para facilitar el desarrollo del m√≥dulo.  Contiene las siguientes herramientas: </p><br><table><thead><tr><th>  Utilidad </th><th>  Descripci√≥n </th></tr></thead><tbody><tr><td>  metadata-json-lint </td><td>  Comprueba metadata.json para buscar gu√≠as de estilo de marionetas </td></tr><tr><td>  pdk </td><td>  Una herramienta para generar y probar m√≥dulos y sus contenidos (clases, tipos, etc.) desde la l√≠nea de comandos </td></tr><tr><td>  pelusa t√≠tere </td><td>  Comprueba el c√≥digo de t√≠teres para las gu√≠as de estilo de Puppet Language </td></tr><tr><td>  sintaxis de marionetas </td><td>  Verificar la sintaxis del manifiesto </td></tr><tr><td>  puppetlabs_spec_helper </td><td>  Proporciona clases, m√©todos y tareas de Rake para pruebas espec√≠ficas de c√≥digo de t√≠teres. </td></tr><tr><td>  rspec-puppet </td><td>  Prueba el comportamiento de la marioneta mientras compila manifiestos en el directorio de recursos (?) </td></tr><tr><td>  rspec-puppet-facts </td><td>  Le permite ejecutar rspec-puppet con hechos especificados por el usuario puppet </td></tr></tbody></table><br><h2 id="sozdayom-modul">  Crear un m√≥dulo </h2><br><p>  PDK instalado, ahora puedes jugar.  El comando de <code>pdk help</code> m√°s simple mostrar√° los comandos disponibles.  Supongamos que estamos en la carpeta donde tiene todos los dem√°s m√≥dulos.  Entonces creemos uno nuevo: </p><br><pre> <code class="plaintext hljs">$ pdk new module --template-url=https://github.com/puppetlabs/pdk-templates.git *** We need to create the metadata.json file for this module, so we're going to ask you 5 questions. *** [Q 1/5] If you have a name for your module, add it here. --&gt; dummy [Q 2/5] If you have a Puppet Forge username, add it here. --&gt; felixoid [Q 3/5] Who wrote this module? --&gt; Mikhail f. Shiryaev [Q 4/5] What license does this module code fall under? --&gt; MIT [Q 5/5] What operating systems does this module support? --&gt; RedHat based Linux, Debian based Linux, Windows Metadata will be generated based on this information, continue? Yes pdk (INFO): Module 'dummy' generated at path '/tmp/dummy', from template 'https://github.com/puppetlabs/pdk-templates.git'.</code> </pre> <br><p>  La utilidad hace preguntas para completar el archivo metadata.json, y la salida tiene exactamente lo que se indica: el m√≥dulo y los archivos auxiliares compilados a partir de plantillas del git. </p><br><p>  Una peque√±a observaci√≥n: los temlites cambian con bastante frecuencia, incluidos algunos errores cr√≠ticos que se han solucionado recientemente.  Por lo tanto, es mejor usar no los valores predeterminados del PDK instalado, sino la √∫ltima versi√≥n.  Es cierto, hay un lado <code>--template-url</code> : cuando se usa el argumento <code>--template-url</code> , PDK agrega este par√°metro al <code>~.pdk/cache/answers.json</code> y, a juzgar por los retrasos en la ejecuci√≥n posterior de cualquiera de los comandos <code>pdk</code> , intenta descargarlos.  Por lo tanto, elimine este par√°metro de <code>answers.json</code> o no lo use al crear un m√≥dulo y c√°mbielo en <code>metadata.json</code> . </p><br><p>  Veamos los pasos adicionales que se pueden realizar con el PDK. </p><br><h3 id="new-class">  nueva clase </h3><br><pre> <code class="plaintext hljs">$ pdk new class dummy::class pdk (INFO): Creating '/tmp/dummy/manifests/class.pp' from template. pdk (INFO): Creating '/tmp/dummy/spec/classes/class_spec.rb' from template. $ cat manifests/class.pp # A description of what this class does # # @summary A short summary of the purpose of this class # # @example # include dummy::class class dummy::class { } $ cat spec/classes/class_spec.rb require 'spec_helper' describe 'dummy::class' do on_supported_os.each do |os, os_facts| context "on #{os}" do let(:facts) { os_facts } it { is_expected.to compile } end end end</code> </pre> <br><p>  Este comando crea 2 archivos: el manifiesto en s√≠ para la clase y el archivo de especificaciones para probarlo.  Me detendr√© en las etiquetas para la documentaci√≥n m√°s adelante con m√°s detalle. </p><br><h3 id="new-defined_type">  nuevo tipo_definido </h3><br><pre> <code class="plaintext hljs">$ pdk new defined_type type pdk (INFO): Creating '/tmp/dummy/manifests/type.pp' from template. pdk (INFO): Creating '/tmp/dummy/spec/defines/type_spec.rb' from template.</code> </pre> <br><p>  De todos modos: manifiesto para el tipo de recurso y el archivo de especificaciones. </p><br><h4 id="new-provider--task">  nuevo proveedor y tarea </h4><br><p>  PDK tambi√©n puede crear un nuevo proveedor o tarea, pero no trabaj√© estrechamente con ellos, por lo que honestamente dir√© que es mejor estudiar este tema m√°s profundamente si es necesario. </p><br><h2 id="generaciya-dokumentacii-pri-pomoschi-puppet-strings">  Generando documentaci√≥n con t√≠teres </h2><br><p>  Realmente no entiendo por qu√© las <code>puppet strings</code> no <code>puppet strings</code> parte del kit de herramientas PDK, pero esto es a la vie.  Si durante el desarrollo coloc√≥ correctamente las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">etiquetas</a> para el patio, entonces hay 2 formas principales de proporcionar documentaci√≥n al usuario: </p><br><ul><li>  Genere como HTML / Markdown / JSON y col√≥quelo junto al c√≥digo.  Esto se hace con el comando <code>puppet string generate [--format FORMAT]</code> , donde el formato puede omitirse o establecerse en <code>json</code> / <code>markdown</code> . <br><ul><li>  Es habitual tener el archivo <code>REFERENCE.md</code> en la ra√≠z del repositorio como el est√°ndar de documentaci√≥n, que es generado por las <code>puppet strings generate --format markdown</code> . </li></ul></li><li>  Publicar en el repositorio con c√≥digo (siempre que est√© en github) github-pages.  Esto es bastante simple, necesita 3 comandos: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  Gemfile.lock,    PDK rm -f Gemfile.lock #     Gemfile   bundle bundle install --path vendor/bundle #   gh-pages   rake-task bundle exec rake strings:gh_pages:update</span></span></code> </pre> </li></ul><br><p>  Parece que no es magia, pero en la salida tenemos un m√≥dulo con instrucciones.  La ventaja es que, incluso si no describe, por ejemplo, cada uno de los par√°metros que utilizan la etiqueta <code>@param</code> , la salida seguir√° siendo una clase / tipo / funci√≥n con una descripci√≥n m√≠nima de los par√°metros con el tipo y el valor predeterminado.  En mi humilde opini√≥n, incluso esto es mejor que nada, y har√° que el m√≥dulo sea m√°s atractivo para su uso. </p><br><p>  Por supuesto, todo esto puede automatizarse y agregarse como una etapa de CI.  Eso ser√≠a perfecto  Mis manos a√∫n no han llegado, pero est√° acumulando polvo en el trabajo atrasado.  Si de repente alguien tiene algo que decir sobre este tema, se lo agradecer√©.  Como pensamientos: al menos agregue una marca para ver si REFERENCE.md cambia despu√©s de ejecutar las cadenas de marionetas.  Y si es as√≠, considere que las pruebas fallaron. </p><br><h2 id="nastroyka-shablonov">  Personalizaci√≥n de plantillas </h2><br><p>  La documentaci√≥n de las plantillas se encuentra en el <a href="">repositorio de pdk-templates</a> .  En resumen, todo se configura usando el archivo <code>.sync.yml</code> en el directorio ra√≠z del m√≥dulo, y los cambios se aplican usando el comando <code>pdk update</code> .  Cada uno de los par√°metros de este archivo es el nombre de otro archivo en el directorio del m√≥dulo, que debe cambiarse de una forma u otra.  La mayor√≠a de los par√°metros para cada una de las plantillas que tuve que seleccionar "al tacto", mirando el c√≥digo fuente, a menudo, por prueba y error.  La documentaci√≥n aqu√≠ a veces va muy por detr√°s.  Desafortunadamente, no hay casi nada m√°s que decir, excepto dar un enlace a <a href="">un ejemplo</a> desde su propio repositorio. </p><br><p>  Describir√© muy r√°pidamente algunos par√°metros que cambi√© usando <code>.sync.yml</code> del ejemplo anterior: </p><br><ul><li>  <code>Gemfile</code> : se agregaron dos <code>Gemfile</code> como dependencias en diferentes grupos: pdk en el grupo de desarrollo;  xml-simple en el grupo de dependencias.  Al iniciar las pruebas, el grupo system_tests no est√° instalado, por lo que agrego la dependencia a otro grupo. </li><li>  <code>spec/spec_helper.rb</code> : se ha cambiado el m√©todo de simulaci√≥n, se ha agregado el umbral m√≠nimo de cobertura de prueba, por debajo del cual las pruebas se consideran fallidas. </li><li>  <code>.travis.yml</code> : este archivo ha sido pulido durante mucho tiempo, ya que se usa para verificar la base del c√≥digo y cargar el m√≥dulo terminado en Puppet-Forge.  Cambios: <br><ul><li>  Usuario y contrase√±a encriptada para llenar el m√≥dulo en Puppet-Forge.  Puede leer m√°s sobre la implementaci√≥n de la forja de marionetas con Travis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </li><li>  Se cre√≥ una secuencia de pruebas ‚Üí implementaci√≥n con el lanzamiento de este √∫ltimo solo con pruebas exitosas. </li><li>  Se agreg√≥ la etapa de implementaci√≥n del m√≥dulo a Puppet-forge, siempre que el CI se inicie desde la etiqueta que comienza con el car√°cter "v". </li></ul></li><li>  <code>Rakefile</code> : se agregaron algunas excepciones para el linter. </li></ul><br><h2 id="zapusk-razlichnyh-ci">  Ejecutando varios CI </h2><br><p>  Aqu√≠ todo es bastante simple.  Inmediatamente despu√©s de generar el m√≥dulo utilizando el PDK, la validaci√≥n comienza en appveyor, travis y gitlab-ci.  Para ejecutar las pruebas, todo est√° listo de inmediato, para el ajuste, <code>.sync.yml</code> el mismo <code>.sync.yml</code> .  No tengo preferencias particulares, por lo que no recomendar√© nada.  Solo usa lo que sea m√°s conveniente. </p><br><h2 id="bonus-pishem-yunit-testy-dlya-klassov-tipov-i-funkciy">  Bonificaci√≥n: escribimos pruebas unitarias para clases, tipos y funciones </h2><br><p>  Este punto va un poco m√°s all√° del material b√°sico que plane√© describir, pero me parece muy √∫til. </p><br><p>  Entonces, tenemos un m√≥dulo con manifiestos y una biblioteca, que, a su vez, contiene clases, tipos y funciones (tampoco nos olvidamos de las tareas y los proveedores, pero no tengo ninguna experiencia en esta parte).  Dado que cualquier c√≥digo existe con el prop√≥sito de cambiar, ser√≠a bueno, obviamente, superponerlo con pruebas para asegurarse de 2 cosas: </p><br><ul><li>  Los cambios no rompen el comportamiento actual (o los cambios de comportamiento con las pruebas) </li><li>  Sus manifiestos hacen exactamente lo que espera y utilizan todos los recursos que espera. </li></ul><br><p>  Puppetlabs proporciona una extensi√≥n para el marco rspec llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">puppet-rspec</a> .  Enlaces a documentaci√≥n para probar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">clases</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tipos</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">funciones</a> .  No seas demasiado vago para mirar de cerca, hay otras secciones. </p><br><p>  Comenzar a usarlo es bastante simple, sin siquiera saber rub√≠.  Si se crearon clases o tipos, como se muestra arriba, usando <code>pdk new &lt;thing&gt;</code> , entonces el archivo <code>*_spec.rb</code> tambi√©n ya existe.  Entonces, supongamos que tenemos una <code>dummy::class</code> .  Para probarlo, se debe <code>spec/classes/class_spec.rb</code> archivo <code>spec/classes/class_spec.rb</code> con el siguiente contenido: </p><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'spec_helper'</span></span> describe <span class="hljs-string"><span class="hljs-string">'dummy::class'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> on_supported_os.each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|os, os_facts|</span></span> context <span class="hljs-string"><span class="hljs-string">"on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{os}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> let(<span class="hljs-symbol"><span class="hljs-symbol">:facts</span></span>) { os_facts } it { is_expected.to compile } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Puede verificar ejecutando <code>pdk test unit</code> desde el directorio ra√≠z del m√≥dulo. </p><br><p>  Eso es casi todo lo que necesitamos.  Ahora queda por completar <code>class_spec.rb</code> necesario <code>is_expected</code> con las condiciones apropiadas.  Por ejemplo, para verificar que la clase contiene el <code>file {'/file/path': }</code> con ciertos par√°metros, puede hacer esto: </p><br><pre> <code class="ruby hljs">it <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> is_expected.to contain_file(<span class="hljs-string"><span class="hljs-string">'/file/path'</span></span>).with( <span class="hljs-string"><span class="hljs-string">'ensure'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'file'</span></span>, <span class="hljs-string"><span class="hljs-string">'mode'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0644'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Puede establecer los par√°metros de clase usando <code>let(:params) { {'param1' =&gt; 'value'} }</code> , es posible realizar pruebas bajo varias condiciones de entrada al colocar cada <code>it</code> dentro de las secciones seleccionadas del <code>context 'some description' {}</code> .  Es posible verificar ambas dependencias entre recursos y entre clases: si se supone, por ejemplo, que la declaraci√≥n de clase contiene <code>inherits</code> , entonces puede agregar la <code>is_expected.to contain_class('parent_class_name')</code> .  ¬øNecesita verificar el comportamiento en diferentes sistemas operativos?  Tambi√©n es posible: simplemente indicamos en un contexto separado los hechos necesarios: </p><br><pre> <code class="ruby hljs">context <span class="hljs-string"><span class="hljs-string">'with Debian'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> let(<span class="hljs-symbol"><span class="hljs-symbol">:facts</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">os:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">architecture:</span></span> <span class="hljs-string"><span class="hljs-string">'amd64'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">distro:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">codename:</span></span> <span class="hljs-string"><span class="hljs-string">'stretch'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">release:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">full:</span></span> <span class="hljs-string"><span class="hljs-string">'9.6'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">major:</span></span> <span class="hljs-string"><span class="hljs-string">'9'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">minor:</span></span> <span class="hljs-string"><span class="hljs-string">'6'</span></span>, }, }, <span class="hljs-symbol"><span class="hljs-symbol">family:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">name:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">release:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">full:</span></span> <span class="hljs-string"><span class="hljs-string">'9.6'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">major:</span></span> <span class="hljs-string"><span class="hljs-string">'9'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">minor:</span></span> <span class="hljs-string"><span class="hljs-string">'6'</span></span>, }, <span class="hljs-symbol"><span class="hljs-symbol">selinux:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">enabled:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }, }, <span class="hljs-symbol"><span class="hljs-symbol">osfamily:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> it { is_expected.to something } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  En general, por lo que pude notar en el proceso de redacci√≥n de pruebas, el marco le permite verificar casi todo lo que pueda necesitar.  Y la presencia de pruebas una vez me ayud√≥ cuando algunos par√°metros se movieron de las clases secundarias a la clase superior del m√≥dulo: mostraron que la refactorizaci√≥n no rompi√≥ nada, y el comportamiento de todo el m√≥dulo no cambi√≥. </p><br><h1 id="vmesto-vyvoda">  En lugar de salida </h1><br><p>  Como ya podr√≠a entenderse por la entonaci√≥n general del art√≠culo, estoy muy animado por lo mucho que Puppet hizo que trabajar con m√≥dulos y manifiestos sea m√°s f√°cil gracias a PDK.  Las acciones de rutina son autom√°ticas, las plantillas se usan siempre que sea posible, las configuraciones para CI populares est√°n disponibles de f√°brica.  Puede parecer una especie de sobrecarga, y el uso puede no traer la fruta esperada, pero definitivamente vale la pena.  Si compara c√≥mo desarrollar m√≥dulos sin y con PDK, entonces para m√≠ se ve as√≠: </p><br><table><thead><tr><th>  Desarrollo sin <del>  barba </del>  PDK </th><th>  Desarrollo PDK </th></tr></thead><tbody><tr><td><img src="https://habrastorage.org/webt/hb/gg/xd/hbggxdj1znic1fgofyl-sb3oz0c.jpeg" width="300"></td><td><img src="https://habrastorage.org/webt/rw/4n/j-/rw4nj-vux8ricpk46hih5iu_3js.jpeg" width="300"></td></tr></tbody></table><br><p>  Intente, ponga, haga la vida m√°s f√°cil para usted y sus colegas.  Estar√© encantado de responder posibles preguntas. </p><br><p>  ¬°Que la atomizaci√≥n nos acompa√±e! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es435954/">https://habr.com/ru/post/es435954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es435944/index.html">Food Design Digest, diciembre de 2018</a></li>
<li><a href="../es435946/index.html">C√°mara termogr√°fica de bricolaje en Raspberry PI o "Ahora creo que s√© lo que har√© este verano"</a></li>
<li><a href="../es435948/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 23: Econom√≠a de la seguridad, parte 3</a></li>
<li><a href="../es435950/index.html">Centro de datos modular al servicio del Gran Colisionador de Hadrones</a></li>
<li><a href="../es435952/index.html">¬øQui√©nes son los "hosters sin lavar"?</a></li>
<li><a href="../es435956/index.html">PHP Digest No. 147 (1 al 14 de enero de 2019)</a></li>
<li><a href="../es435958/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 347 (7 al 13 de enero de 2019)</a></li>
<li><a href="../es435960/index.html">Experimento de pensamiento: aleteo en marcha</a></li>
<li><a href="../es435962/index.html">25 aniversario de Aeron: sensaciones e impresiones de la versi√≥n actualizada de Aeron Remastered</a></li>
<li><a href="../es435964/index.html">Ethereum planea ser 99% m√°s econ√≥mico</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>