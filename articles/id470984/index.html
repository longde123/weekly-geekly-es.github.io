<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍⚕️ 🕴🏾 ♎️ Analisis komitmen dan permintaan tarik di Travis CI, Buddy dan AppVeyor menggunakan PVS-Studio 🅰️ 🌬️ 👨‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dimulai dengan versi 7.04, penganalisa PVS-Studio untuk bahasa C dan C ++ di Linux dan macOS memiliki kemampuan uji untuk memeriksa daftar file yang d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Analisis komitmen dan permintaan tarik di Travis CI, Buddy dan AppVeyor menggunakan PVS-Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/470984/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac4/d08/0e7/ac4d080e7661626569ef514abe190662.png" alt="Gambar 11"></div><br>  Dimulai dengan versi 7.04, penganalisa PVS-Studio untuk bahasa C dan C ++ di Linux dan macOS memiliki kemampuan uji untuk memeriksa daftar file yang ditentukan.  Dengan menggunakan mode baru, Anda dapat mengonfigurasikan penganalisis untuk memeriksa komit dan menarik permintaan.  Artikel ini akan menunjukkan kepada Anda cara mengkonfigurasi memeriksa daftar file yang dimodifikasi dari proyek GitHub di sistem CI (Continuous Integration) populer seperti Travis CI, Buddy dan AppVeyor. <br><a name="habracut"></a><br><h2>  Mode Pemeriksaan Daftar File </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PVS-Studio</a> adalah alat untuk mendeteksi kesalahan dan kerentanan potensial dalam kode sumber program yang ditulis dalam C, C ++, C # dan Java.  Ini bekerja pada sistem 64-bit pada Windows, Linux dan macOS. <br><br>  Dalam PVS-Studio versi 7.04 untuk Linux dan macOS, mode memeriksa daftar file sumber muncul.  Ini berfungsi untuk proyek yang sistem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bangunnya</a> memungkinkan file <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">compile_commands.json</a> dihasilkan.  Diperlukan agar penganalisa untuk mengekstrak informasi tentang kompilasi file yang ditentukan.  Jika sistem build Anda tidak mendukung pembuatan file compile_commands.json, Anda dapat mencoba membuat file seperti itu menggunakan utilitas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bear</a> . <br><br>  Juga, mode pemeriksaan daftar file dapat digunakan bersama dengan strace trace log dari compiler dimulai (pvs-studio-analyzer trace).  Untuk melakukan ini, pertama-tama Anda perlu melakukan perakitan lengkap proyek dan melacaknya sehingga penganalisa mengumpulkan informasi lengkap tentang parameter kompilasi semua file yang diuji. <br><br>  Namun, opsi ini memiliki kelemahan yang signifikan - Anda harus membuat jejak lengkap dari seluruh perakitan proyek di setiap permulaan, yang dengan sendirinya bertentangan dengan gagasan pengecekan cepat komit.  Atau, jika hasil penelusuran itu sendiri di-cache, maka penganalisis yang dimulai mungkin tidak lengkap jika struktur dependensi dari file sumber berubah setelah jejak (misalnya, #include baru ditambahkan ke salah satu file sumber). <br><br>  Oleh karena itu, kami tidak menyarankan menggunakan mode pemeriksaan daftar file dengan log jejak untuk memeriksa komit atau menarik permintaan.  Jika Anda dapat melakukan rakitan tambahan saat memeriksa komit, pertimbangkan untuk menggunakan mode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">analisis tambahan</a> . <br><br>  Daftar file sumber untuk analisis disimpan dalam file teks dan ditransfer ke analyzer menggunakan parameter <i>-S</i> : <br><br><pre><code class="bash hljs">pvs-studio-analyzer analyze ... -f build/compile_commands.json -S check-list.txt</code> </pre> <br>  Dalam file ini, jalan relatif atau absolut ke file ditunjukkan, dan setiap file baru harus di baris baru.  Diijinkan untuk menentukan tidak hanya nama file untuk analisis, tetapi juga berbagai teks.  Penganalisa akan melihat bahwa ini bukan file, dan akan mengabaikan baris.  Ini berguna untuk berkomentar jika file ditentukan secara manual.  Namun, sering kali daftar file akan dihasilkan selama analisis dalam CI, misalnya, ini mungkin file dari permintaan komit atau tarik. <br><br>  Sekarang menggunakan mode ini, Anda dapat dengan cepat memeriksa kode baru sebelum masuk ke cabang pengembangan utama.  Agar sistem verifikasi menanggapi peringatan penganalisa, bendera <i>--indicate-warnings</i> telah ditambahkan ke <i>utilitas</i> <i>plog-converter</i> : <br><br><pre> <code class="bash hljs">plog-converter ... --indicate-warnings ... -o /path/to/report.tasks ...</code> </pre> <br>  Dengan tanda ini, konverter akan mengembalikan kode bukan nol jika ada peringatan dalam laporan analisa.  Dengan menggunakan kode pengembalian, Anda dapat memblokir kait pra-komit, melakukan atau menarik permintaan, dan menampilkan laporan analisa yang dihasilkan di layar, membagikan atau mengirim melalui surat. <br><br>  <i>Catatan</i>  <i>Pertama kali Anda menjalankan analisis daftar file, seluruh proyek akan dianalisis, karena</i>  <i>penganalisa perlu menghasilkan file dependensi dari file sumber proyek dari file header.</i>  <i>Ini adalah fitur analisis file C dan C ++.</i>  <i>Di masa depan, file dependensi dapat di-cache dan akan diperbarui secara otomatis oleh penganalisa.</i>  <i>Keuntungan memeriksa komit ketika menggunakan mode verifikasi daftar file daripada menggunakan mode analisis tambahan adalah bahwa Anda hanya perlu men-cache file ini, bukan file objek.</i> <br><br><h2>  Prinsip umum analisis permintaan tarik </h2><br>  Analisis keseluruhan proyek membutuhkan banyak waktu, jadi masuk akal untuk memeriksa hanya bagian tertentu saja.  Masalahnya adalah Anda harus memisahkan file baru dari sisa file proyek. <br><br>  Pertimbangkan contoh pohon komit dengan dua cabang: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/722/646/68c/72264668c4a90b96ccb63f363a46c683.png" alt="Gambar 5"></div><br><br>  Mari kita bayangkan komit <i>A1</i> berisi sejumlah besar kode yang telah diuji.  Beberapa waktu sebelumnya, kami membuat cabang dari komit <i>A1</i> dan mengubah beberapa file. <br><br>  Tentu saja, Anda perhatikan bahwa setelah <i>A1</i> ada dua komitmen lagi, tetapi ini juga merger dari cabang-cabang lain, karena kami tidak berkomitmen pada <i>master</i> .  Dan sekarang saatnya telah tiba ketika <i>perbaikan terbaru</i> siap.  Oleh karena itu, muncul permintaan tarik untuk penggabungan <i>B3</i> dan <i>A3</i> . <br><br>  Tentu saja, orang dapat memeriksa seluruh hasil merger mereka, tetapi ini akan terlalu lama dan tidak dapat dibenarkan, karena hanya beberapa file yang diubah.  Oleh karena itu, lebih efisien untuk menganalisis hanya yang berubah. <br><br>  Untuk melakukan ini, kita mendapatkan perbedaan antara cabang-cabang, berada di KEPALA cabang yang ingin kita gabungkan menjadi master: <br><br><pre> <code class="bash hljs">git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list</code> </pre> <br>  <i>$ MERGE_BASE</i> akan kami pertimbangkan secara rinci nanti.  Faktanya adalah bahwa tidak setiap layanan CI menyediakan informasi yang diperlukan tentang dasar untuk penggabungan, jadi setiap kali Anda harus menemukan cara baru untuk mendapatkan data ini.  Ini akan dirinci di bawah ini di setiap layanan web yang dijelaskan. <br><br>  Jadi, kami mendapat perbedaan antara cabang, atau lebih tepatnya, daftar nama file yang telah diubah.  Sekarang kita perlu memberikan file <i>.pvs-pr.list</i> (kita mengarahkan hasilnya ke atas) ke penganalisa: <br><br><pre> <code class="bash hljs">pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ -S .pvs-pr.list</code> </pre> <br>  Setelah analisis, kita perlu mengkonversi file log (PVS-Studio.log) ke dalam format yang mudah dibaca: <br><br><pre> <code class="bash hljs">plog-converter -t errorfile PVS-Studio.log --cerr -w</code> </pre> <br>  Perintah ini akan mencantumkan kesalahan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">stderr</a> (aliran output pesan kesalahan standar). <br><br>  Hanya sekarang kita perlu tidak hanya menampilkan kesalahan, tetapi juga menginformasikan layanan kami untuk perakitan dan pengujian masalah.  Untuk melakukan ini, bendera <i>-W</i> ( <i>--indikasikan-peringatan</i> ) telah ditambahkan ke konverter.  Jika setidaknya ada satu penganalisa peringatan, kode pengembalian utilitas <i>plog-converter</i> akan berubah menjadi 2, yang, pada gilirannya, akan menginformasikan layanan CI tentang adanya kesalahan potensial dalam file permintaan tarik. <br><br><h2>  Travis ci </h2><br>  Konfigurasi dibuat sebagai file <i>.travis.yml</i> .  Untuk kenyamanan, saya menyarankan Anda untuk meletakkan semuanya dalam skrip bash terpisah dengan fungsi yang akan dipanggil dari file <i>.travis.yml</i> ( <i>bash script_name.sh function_name</i> ). <br><br>  Kami akan menambahkan kode yang diperlukan ke skrip <i>bash</i> , jadi kami mendapatkan lebih banyak fungsi.  Di bagian <i>instal</i> , tulis yang berikut ini: <br><br><pre> <code class="xml hljs">install: - bash .travis.sh travis_install</code> </pre> <br>  Jika Anda memiliki instruksi, Anda dapat mentransfernya ke skrip dengan menghapus tanda hubung. <br><br>  Buka file <i>.travis.sh</i> dan tambahkan instalasi analyzer ke fungsi <i>travis_install ()</i> : <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_install</span></span></span></span>() { wget -q -O - https://files.viva64.com/etc/pubkey.txt \ | sudo apt-key add - sudo wget -O /etc/apt/sources.list.d/viva64.list \ https://files.viva64.com/etc/viva64.list sudo apt-get update -qq sudo apt-get install -qq pvs-studio }</code> </pre> <br>  Sekarang tambahkan analisis lari ke bagian <i>skrip</i> : <br><br><pre> <code class="xml hljs">script: - bash .travis.sh travis_script</code> </pre> <br>  Dan dalam skrip bash: <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_script</span></span></span></span>() { pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TRAVIS_PULL_REQUEST</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">"false"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> git diff --name-only origin/HEAD &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ -S .pvs-pr.list \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w }</code> </pre> <br>  Kode ini perlu dijalankan setelah membangun proyek, misalnya, jika Anda memiliki build di CMake: <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_script</span></span></span></span>() { CMAKE_ARGS=<span class="hljs-string"><span class="hljs-string">"-DCMAKE_EXPORT_COMPILE_COMMANDS=On </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CMAKE_ARGS}</span></span></span><span class="hljs-string">"</span></span> cmake <span class="hljs-variable"><span class="hljs-variable">$CMAKE_ARGS</span></span> CMakeLists.txt make -j8 }</code> </pre> <br>  Ini akan menjadi seperti ini: <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_script</span></span></span></span>() { CMAKE_ARGS=<span class="hljs-string"><span class="hljs-string">"-DCMAKE_EXPORT_COMPILE_COMMANDS=On </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CMAKE_ARGS}</span></span></span><span class="hljs-string">"</span></span> cmake <span class="hljs-variable"><span class="hljs-variable">$CMAKE_ARGS</span></span> CMakeLists.txt make -j8 pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TRAVIS_PULL_REQUEST</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">"false"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> git diff --name-only origin/HEAD &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ -S .pvs-pr.list \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w }</code> </pre> <br>  Anda mungkin sudah memperhatikan variabel lingkungan yang ditentukan <i>$ TRAVIS_PULL_REQUEST</i> dan <i>$ TRAVIS_BRANCH</i> .  Travis CI mengumumkannya sendiri: <br><br><ul><li>  <i>$ TRAVIS_PULL_REQUEST</i> menyimpan nomor <i>permintaan</i> tarik atau <i>salah</i> jika itu cabang biasa; </li><li>  <i>$ TRAVIS_REPO_SLUG</i> menyimpan nama repositori proyek. </li></ul><br>  Algoritma dari fungsi ini: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e2/d21/1c5/9e2d211c559a48b4bf144bdd606e4bc7.png" alt="Gambar 7"></div><br>  Travis CI merespons kode kembali, sehingga keberadaan peringatan akan memberi tahu layanan untuk menandai komit sebagai berisi kesalahan. <br><br>  Sekarang, mari kita lihat lebih dekat pada baris kode ini: <br><br><pre> <code class="bash hljs">git diff --name-only origin/HEAD &gt; .pvs-pr.list</code> </pre> <br>  Faktanya adalah bahwa Travis CI secara otomatis menggabungkan cabang selama analisis permintaan tarik: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/443/986/1f4/4439861f46637d41119e83f83e2e440b.png" alt="Gambar 8"></div><br>  Oleh karena itu, kami menganalisis <i>A4</i> , bukan <i>B3-&gt; A3</i> .  Karena fitur ini, kita perlu menghitung selisihnya dengan <i>A3</i> , yang tepatnya merupakan puncak cabang dari <i>asalnya</i> . <br><br>  Satu detail penting tetap ada - dependensi caching file header pada unit terjemahan yang dikompilasi (* .c, * .cc, * .cpp, dll.).  Alat analisis menghitung dependensi ini pada awal pertama dalam mode memeriksa daftar file dan kemudian menyimpannya dalam direktori .PVS-Studio.  Travis CI memungkinkan Anda untuk melakukan cache folder, jadi kami akan menyimpan data dari <i>direktori .PVS-Studio /</i> : <br><br><pre> <code class="xml hljs">cache: directories: - .PVS-Studio/</code> </pre> <br>  Kode ini perlu ditambahkan ke file <i>.travis.yml</i> .  Direktori ini menyimpan berbagai data yang dikumpulkan setelah analisis, yang secara signifikan akan mempercepat peluncuran analisis daftar file berikutnya atau analisis tambahan.  Jika ini tidak dilakukan, maka penganalisa akan benar-benar menganalisis semua file setiap saat. <br><br><h2>  Sobat </h2><br>  Seperti Travis CI, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Buddy</a> menyediakan kemampuan untuk secara otomatis membangun dan menguji proyek yang disimpan di GitHub.  Tidak seperti Travis CI, ini dikonfigurasi dalam antarmuka web (dukungan bash tersedia), sehingga tidak perlu menyimpan file konfigurasi dalam proyek. <br><br>  Pertama-tama, kita perlu menambahkan tindakan baru ke jalur perakitan: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75e/2fd/36e/75e2fd36e9a4420ff74256429ff73e0c.gif" alt="Gambar 1"></div><br>  Kami menunjukkan kompiler yang digunakan untuk membangun proyek.  Perhatikan wadah buruh pelabuhan yang dipasang dalam tindakan ini.  Misalnya, ada wadah khusus untuk GCC: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95b/837/7ad/95b8377adbac7e50e55d97c5b318f56c.png" alt="Gambar 6"></div><br>  Sekarang instal PVS-Studio dan utilitas yang diperlukan: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/fba/02b/88efba02b5a4c34f55c4344744812cc7.gif" alt="Gambar 2"></div><br>  Tambahkan baris berikut ke editor: <br><br><pre> <code class="bash hljs">apt-get update &amp;&amp; apt-get -y install wget gnupg jq wget -q -O - https://files.viva64.com/etc/pubkey.txt | apt-key add - wget -O /etc/apt/sources.list.d/viva64.list \ https://files.viva64.com/etc/viva64.list apt-get update &amp;&amp; apt-get -y install pvs-studio</code> </pre> <br>  Sekarang buka tab Run (ikon pertama) dan tambahkan kode berikut ke bidang editor yang sesuai: <br><br><pre> <code class="bash hljs">pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BUDDY_EXECUTION_PULL_REQUEST_NO</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">''</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BUDDY_EXECUTION_PULL_REQUEST_NO</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${BUDDY_REPO_SLUG}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck \ -S .pvs-pr.list <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w</code> </pre> <br>  Jika Anda membaca bagian tentang Travs-CI, maka kode ini sudah tidak asing lagi bagi Anda, namun sekarang telah muncul tahapan baru: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/615/40f/ec9/61540fec9bc7edf2032a84bdaf5a28fe.png" alt="Gambar 9"></div><br>  Faktanya adalah bahwa sekarang kita menganalisis bukan hasil merger, tetapi KEPALA cabang dari mana permintaan tarik dibuat: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/722/646/68c/72264668c4a90b96ccb63f363a46c683.png" alt="Gambar 10"></div><br>  Oleh karena itu, kita berada dalam komit <i>B3</i> bersyarat dan kita perlu mendapatkan perbedaan dengan <i>A3</i> : <br><br><pre> <code class="bash hljs">PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BUDDY_EXECUTION_PULL_REQUEST_NO</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${BUDDY_REPO_SLUG}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list</code> </pre> <br>  Untuk menentukan <i>A3,</i> gunakan API GitHub: <br><br><pre> <code class="bash hljs">https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${USERNAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${REPO}</span></span>/pulls/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span></code> </pre> <br>  Kami menggunakan variabel berikut yang disediakan oleh Sobat: <br><br><ul><li>  <i>$ BUDDY_EXECUTION_PULL_REQEUST_NO</i> - tarik nomor <i>permintaan</i> ; </li><li>  <i>$ BUDDY_REPO_SLUG</i> - kombinasi nama pengguna dan repositori (misalnya maks / pengujian). </li></ul><br>  Sekarang simpan perubahan menggunakan tombol di bawah ini dan aktifkan analisis permintaan tarik: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74c/5d6/876/74c5d6876c07c0b2e0c10cdabb8b0f78.gif" alt="Gambar 3"></div><br>  Tidak seperti Travis CI, kita tidak perlu menentukan <i>.pvs-studio</i> untuk caching, karena Buddy secara otomatis menyimpan semua file untuk peluncuran selanjutnya.  Karena itu, hal terakhir yang tersisa adalah menyimpan login dan kata sandi untuk PVS-Studio di Buddy.  Setelah menyimpan perubahan, kami akan kembali ke Pipeline.  Kita perlu melanjutkan untuk mengatur variabel dan menambahkan login dan kunci untuk PVS-Studio: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eb1/816/e3e/eb1816e3e4aff72ad55b187ec1ebf0a2.gif" alt="Gambar 4"></div><br>  Setelah itu, tampilan permintaan tarik baru atau komit akan memicu cek.  Jika komit berisi kesalahan, maka Sobat akan menunjukkan ini pada halaman permintaan tarik. <br><br><h2>  Pengantar </h2><br>  Pengaturan AppVeyor mirip dengan Buddy, karena semuanya terjadi di antarmuka web dan tidak perlu menambahkan file * .yml ke repositori proyek. <br><br>  Buka tab Pengaturan di ikhtisar proyek: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f11/2fc/576/f112fc576fc1f8bf7552625578093292.png" alt="Gambar 12"></div><br>  Gulir halaman ini ke bawah dan nyalakan penyimpanan cache untuk membuat permintaan tarikan: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be8/8f3/f34/be88f3f34708075a49bdd13c65f5bc26.png" alt="Gambar 18"></div><br>  Sekarang buka tab Lingkungan, di mana kita menentukan gambar untuk perakitan dan variabel lingkungan yang diperlukan: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/453/26a/80c/45326a80c62211c6b29bd16fad1ef0d1.png" alt="Gambar 19"></div><br>  Jika Anda membaca bagian sebelumnya, Anda sangat mengenal kedua variabel ini - <i>PVS_KEY</i> dan <i>PVS_USERNAME</i> .  Jika tidak, maka saya mengingatkan Anda bahwa mereka diperlukan untuk memeriksa lisensi alat analisa PVS-Studio.  Di masa depan, kita akan bertemu mereka lagi dalam skrip Bash. <br><br>  Pada halaman yang sama di bawah ini kami menunjukkan folder untuk caching: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e2/967/dbf/4e2967dbfb796e2d0104d5b6539be65a.png" alt="Gambar 15"></div><br>  Jika tidak, maka kami akan menganalisis seluruh proyek alih-alih sepasang file, tetapi kami akan mendapatkan output dari file yang ditentukan.  Oleh karena itu, penting untuk memasukkan nama direktori yang benar. <br><br>  Sekarang saatnya skrip memeriksa.  Buka tab Tes dan pilih Script: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5f/dbd/0d6/b5fdbd0d6d448174bc05222fe1965c1c.png" alt="Gambar 20"></div><br>  Masukkan kode berikut ke dalam formulir ini: <br><br><pre> <code class="bash hljs">sudo apt-get update &amp;&amp; sudo apt-get -y install jq wget -q -O - https://files.viva64.com/etc/pubkey.txt \ | sudo apt-key add - sudo wget -O /etc/apt/sources.list.d/viva64.list \ https://files.viva64.com/etc/viva64.list sudo apt-get update &amp;&amp; sudo apt-get -y install pvs-studio pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> PWD=$(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span> -L) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">''</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${APPVEYOR_REPO_NAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck \ --dump-files --dump-log pvs-dump.log \ -S .pvs-pr.list <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w</code> </pre> <br>  Perhatikan bagian kode berikut: <br><br><pre> <code class="bash hljs">PWD=$(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span> -L) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">''</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${APPVEYOR_REPO_NAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck \ --dump-files --dump-log pvs-dump.log \ -S .pvs-pr.list <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br>  Tugas yang agak spesifik dari nilai perintah pwd ke variabel yang seharusnya menyimpan nilai default ini tampak aneh pada pandangan pertama, namun, saya akan menjelaskan semuanya sekarang. <br><br>  Saat mengkonfigurasi penganalisis di AppVeyor, saya menemukan perilaku penganalisa yang sangat aneh.  Di satu sisi, semuanya bekerja dengan benar, tetapi analisisnya tidak dimulai.  Saya menghabiskan banyak waktu untuk memperhatikan bahwa kita berada di direktori / home / appveyor / proyek / testcalc /, dan penganalisa yakin bahwa kita berada di / opt / appveyor / build-agent /.  Kemudian saya menyadari bahwa variabel $ PWD berbohong sedikit.  Untuk alasan ini, saya memperbarui nilainya secara manual sebelum memulai analisis. <br><br>  Dan kemudian semuanya, seperti sebelumnya: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0aa/4b9/a33/0aa4b9a3398ce2f52cc8e1df0833f459.png" alt="Gambar 17"></div><br>  Sekarang pertimbangkan cuplikan berikut: <br><br><pre> <code class="bash hljs">PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${APPVEYOR_REPO_NAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>`</code> </pre> <br>  Di dalamnya, kita mendapatkan perbedaan antara cabang tempat permintaan tarik diumumkan.  Untuk melakukan ini, kita memerlukan variabel lingkungan berikut: <br><br><ul><li>  $ APPVEYOR_PULL_REQUEST_NUMBER - jumlah permintaan tarik; </li><li>  $ APPVEYOR_REPO_NAME - nama pengguna dan repositori proyek. </li></ul><br><h2>  Kesimpulan </h2><br>  Tentu saja, kami tidak mempertimbangkan semua layanan yang memungkinkan untuk integrasi berkelanjutan, namun, semuanya memiliki kemiripan satu sama lain untuk pekerjaan tertentu.  Dengan pengecualian caching, setiap layanan membuat "sepeda" sendiri, jadi semuanya selalu berbeda. <br><br>  Di suatu tempat, seperti di Travis-CI, beberapa baris kode dan caching berfungsi dengan sempurna;  di suatu tempat, seperti di AppVeyor, Anda hanya perlu menentukan folder di pengaturan;  tetapi di suatu tempat Anda perlu membuat kunci unik dan mencoba meyakinkan sistem untuk memberi Anda kesempatan untuk menimpa fragmen yang di-cache.  Oleh karena itu, jika Anda ingin mengonfigurasi analisis permintaan tarik pada layanan integrasi berkelanjutan, yang tidak dibahas di atas, pertama-tama pastikan bahwa Anda tidak akan mengalami masalah dengan caching. <br><br>  Terima kasih atas perhatian anda  Jika sesuatu tidak berhasil, jangan ragu untuk menulis surat kepada kami sebagai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dukungan</a> .  Kami akan meminta dan membantu. <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  Jika Anda ingin berbagi artikel ini dengan audiens yang berbahasa Inggris, silakan gunakan tautan ke terjemahan: Maxim Zvyagintsev.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Analisis komitmen dan tarik permintaan di Travis CI, Buddy, dan AppVeyor menggunakan PVS-Studio</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id470984/">https://habr.com/ru/post/id470984/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id470974/index.html">DNS pasif di tangan analis</a></li>
<li><a href="../id470976/index.html">Song of Ice (Bloody Enterprise) dan Flames (DevOps and IaC)</a></li>
<li><a href="../id470978/index.html">Riset pasar analis: di mana mereka belajar, alat apa yang mereka gunakan dan berapa banyak yang mereka hasilkan</a></li>
<li><a href="../id470980/index.html">Tugas yang diselesaikan robot perangkat lunak (RPA) di sektor perbankan</a></li>
<li><a href="../id470982/index.html">Analisis komitmen dan tarik permintaan di Travis CI, Buddy, dan AppVeyor menggunakan PVS-Studio</a></li>
<li><a href="../id470988/index.html">Pendaftaran terbuka untuk Slerm DevOps di Moskow</a></li>
<li><a href="../id470990/index.html">Perangkat pemasaran online: 3 Aplikasi untuk meningkatkan komunikasi visual</a></li>
<li><a href="../id470994/index.html">JavaScript Pewarisan dari Sudut Pandang Seorang Nerd yang Bosan: Pabrik Konstruktor</a></li>
<li><a href="../id470996/index.html">Bagaimana tag <img> sederhana bisa menjadi risiko tinggi untuk bisnis?</a></li>
<li><a href="../id470998/index.html">Mainan Kayu, Bagian Sepuluh - 1996</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>