<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯТЖЁЯП╗ ЁЯУг ЁЯП╕ .NET / C # рдореЗрдВ SIMD рдХрд╛ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдЕрд╡рд▓реЛрдХрди ЁЯПи ЁЯРа тЫУя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЖрдкрдХрд╛ рдзреНрдпрд╛рди .NET рдлреНрд░реЗрдорд╡рд░реНрдХ рдФрд░ .NETCORE рдореЗрдВ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рд╡реИрд╢реНрд╡реАрдХрд░рдг рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдЕрд╡рд▓реЛрдХрди рдХреЗ рд▓рд┐рдП рдЖрдордВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рд▓реЗрдЦ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЙрди рд▓реЛрдЧреЛ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>.NET / C # рдореЗрдВ SIMD рдХрд╛ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдЕрд╡рд▓реЛрдХрди</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435840/"><p> рдЖрдкрдХрд╛ рдзреНрдпрд╛рди .NET рдлреНрд░реЗрдорд╡рд░реНрдХ рдФрд░ .NETCORE рдореЗрдВ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рд╡реИрд╢реНрд╡реАрдХрд░рдг рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдЕрд╡рд▓реЛрдХрди рдХреЗ рд▓рд┐рдП рдЖрдордВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд▓реЗрдЦ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЙрди рд▓реЛрдЧреЛрдВ рдХреЛ рдЗрди рддрдХрдиреАрдХреЛрдВ рд╕реЗ рдкрд░рд┐рдЪрд┐рдд рдХрд░рд╛рдирд╛ рд╣реИ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рдереЗ рдФрд░ рдпрд╣ рдмрддрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рдереЗ рдХрд┐ рдиреЗрдЯ рджреЗрд╢реА рдХреЗ рд▓рд┐рдП "рд╡рд╛рд╕реНрддрд╡рд┐рдХ, рд╕рдВрдХрд▓рд┐рдд" рднрд╛рд╖рд╛рдУрдВ рд╕реЗ рдмрд╣реБрдд рдкреАрдЫреЗ рдирд╣реАрдВ рд╣реИред <br>  рд╡рд┐рдХрд╛рд╕ред </p><a name="habracut"></a><br><p>  рдореИрдВ рдХреЗрд╡рд▓ рд╡реИрд╢реНрд╡реАрдХрд░рдг рддрдХрдиреАрдХреЛрдВ рдХреЛ рд╕реАрдЦрдирд╛ рд╢реБрд░реВ рдХрд░ рд░рд╣рд╛ рд╣реВрдВ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рд╕рдореБрджрд╛рдп рдХрд╛ рдХреЛрдИ рд╡реНрдпрдХреНрддрд┐ рдореБрдЭреЗ рдПрдХ рд╕реНрдкрд╖реНрдЯ рдХреИрдВрдЯ рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдпрд╛ рдиреАрдЪреЗ рд╡рд░реНрдгрд┐рдд рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рдмреЗрд╣рддрд░ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрддрд╛ рд╣реИ, рддреЛ рдореИрдВ рдмреЗрддрд╣рд╛рд╢рд╛ рдЦреБрд╢ рд╣реЛ рдЬрд╛рдКрдВрдЧрд╛ред </p><br><h2 id="nemnogo-istorii">  рдереЛрдбрд╝рд╛ рд╕рд╛ рдЗрддрд┐рд╣рд╛рд╕ </h2><br><p>  .NET рдореЗрдВ, SIMD рдкрд╣рд▓реА рдмрд╛рд░ .NET рдлреНрд░реЗрдорд╡рд░реНрдХ 4.6 рдХреА рд░рд┐рд▓реАрдЬ рдХреЗ рд╕рд╛рде рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛ред  рдлрд┐рд░ рдкреНрд░рдХрд╛рд░ рдореИрдЯреНрд░рд┐рдХреНрд╕ 3 рдПрдХреНрд╕ 2, рдореИрдЯреНрд░рд┐рдХреНрд╕ 4 рдПрдХреНрд╕ 4, рдкреНрд▓реЗрди, рдХреНрд╡рд╛рдЯрд░реНрдирд┐рдпрди, рд╡реЗрдХреНрдЯрд░ 2, рд╡реЗрдХреНрдЯрд░ 3 рдФрд░ рд╡реЗрдХреНрдЯрд░ 4 рдХреЛ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛, рдЬрд┐рд╕рдиреЗ рд╡реЗрдХреНрдЯрд░рдХреГрдд рдЧрдгрдирд╛ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдЕрдиреБрдорддрд┐ рджреАред  рдмрд╛рдж рдореЗрдВ, рд╡реЗрдХреНрдЯрд░ &lt;T&gt; рдкреНрд░рдХрд╛рд░ рдХреЛ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛, рдЬрд┐рд╕рдиреЗ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЛ рд╡реЗрдХреНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рдЕрдзрд┐рдХ рдЕрд╡рд╕рд░ рдкреНрд░рджрд╛рди рдХрд┐рдПред  рд▓реЗрдХрд┐рди рдХрдИ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдЕрднреА рднреА рдирд╛рдЦреБрд╢ рдереЗ рдХреНрдпреЛрдВрдХрд┐  рдЙрдкрд░реЛрдХреНрдд рдкреНрд░рдХрд╛рд░реЛрдВ рдиреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдХреЗ рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреЗ рдкреНрд░рд╡рд╛рд╣ рдХреЛ рд╕реАрдорд┐рдд рдХрд░ рджрд┐рдпрд╛ рдФрд░ рдЖрдзреБрдирд┐рдХ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЗ SIMD рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреА рдкреВрд░реА рд╢рдХреНрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреАред  рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╣рдорд╛рд░реЗ рд╕рдордп рдореЗрдВ, .NET рдХреЛрд░ 3.0 рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди рдореЗрдВ, System.Runtime.Intrinsics рдирд╛рдо рд╕реНрдерд╛рди рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛ рд╣реИ, рдЬреЛ рдирд┐рд░реНрджреЗрд╢ рдЪреБрдирдиреЗ рдореЗрдВ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╕реНрд╡рддрдВрддреНрд░рддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рдЧрддрд┐ рдореЗрдВ рд╕рд░реНрд╡реЛрддреНрддрдо рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ RyuJit рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░ рдпрд╛ рддреЛ x64 рдкрд░ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВ рдпрд╛ 32-рдмрд┐рдЯ рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдВ рдФрд░ AnyCPU рдкрд░ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВред  рд╕рднреА рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдЬрд┐рдиреНрд╣реЗрдВ рдореИрдВрдиреЗ Intel Core i7-6700 рдкреНрд░реЛрд╕реЗрд╕рд░ 3.40GHz (Skylake) рдХреЗ рд╕рд╛рде рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рдЪрд▓рд╛рдпрд╛ рдерд╛ред </p><br><h2 id="summiruem-elementy-massiva">  рд╕рд░рдгреА рдХреЗ рддрддреНрд╡реЛрдВ рдХреЛ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рд▓рд┐рдЦреЗрдВ </h2><br><p>  рдореИрдВрдиреЗ рдХреНрд▓рд╛рд╕рд┐рдХ рд╕рдорд╕реНрдпрд╛ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛, рдЬреЛ рдЕрдХреНрд╕рд░ рд╡реЗрдХреНрдЯрд░рд╛рдЗрдЬреЗрд╢рди рдХреА рдмрд╛рдд рдЖрдиреЗ рдкрд░ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рд╕рд░рдгреА рдХреЗ рддрддреНрд╡реЛрдВ рдХрд╛ рдпреЛрдЧ рдЦреЛрдЬрдиреЗ рдХрд╛ рдХрд╛рд░реНрдп рд╣реИред  рд╣рдо рдЗрд╕ рдХрд╛рд░реНрдп рдХреЗ рдЪрд╛рд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд▓рд┐рдЦреЗрдВрдЧреЗ, рд╣рдо рдПрд░реЗ рд╕рд░рдгреА рдХреЗ рддрддреНрд╡реЛрдВ рдХреЛ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд░реЗрдВрдЧреЗ: </p><br><p>  рд╕рдмрд╕реЗ рд╕реНрдкрд╖реНрдЯ рд╣реИ </p><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Naive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Array) { result += i; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  LINQ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LINQ</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; Array.Aggregate&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>, (current, i) =&gt; current + i);</code> </pre> <br><p>  System.Numerics рд╕реЗ рд╡реИрдХреНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Vectors</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vectorSize = Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Count; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> accVector = Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Zero; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> array = Array; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; array.Length - vectorSize; i += vectorSize) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(array, i); accVector = Vector.Add(accVector, v); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = Vector.Dot(accVector, Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.One); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; array.Length; i++) { result += array[i]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  System.Runtime.Intrinsics рд╕реНрдерд╛рди рд╕реЗ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsafe</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Intrinsics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vectorSize = <span class="hljs-number"><span class="hljs-number">256</span></span> / <span class="hljs-number"><span class="hljs-number">8</span></span> / <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> accVector = Vector256&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Zero; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> array = Array; <span class="hljs-keyword"><span class="hljs-keyword">fixed</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* ptr = array) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; array.Length - vectorSize; i += vectorSize) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = Avx2.LoadVector256(ptr + i); accVector = Avx2.Add(accVector, v); } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temp = <span class="hljs-keyword"><span class="hljs-keyword">stackalloc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[vectorSize]; Avx2.Store(temp, accVector); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; vectorSize; j++) { result += temp[j]; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; array.Length; i++) { result += array[i]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  рдореИрдВрдиреЗ рдЕрдкрдиреЗ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рдЗрди 4 рддрд░реАрдХреЛрдВ рдкрд░ рдПрдХ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдФрд░ рдпрд╣ рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓рд╛: </p><br><div class="scrollable-table"><table><thead><tr><th>  рд╡рд┐рдзрд┐ </th><th>  ItemsCount </th><th>  рдордВрдЭрд▓рд╛ </th></tr></thead><tbody><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  10 </td><td>  75.12 рдПрди.рдПрд╕. </td></tr><tr><td>  LINQ </td><td>  10 </td><td>  1 186.85 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  10 </td><td>  60.09 рдПрди.рдПрд╕. </td></tr><tr><td>  intrinsics </td><td>  10 </td><td>  255.40 рдПрди.рдПрд╕. </td></tr><tr><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  100 </td><td>  360.56 рдПрди.рдПрд╕. </td></tr><tr><td>  LINQ </td><td>  100 </td><td>  2 719.24 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  100 </td><td>  60.09 рдПрди.рдПрд╕. </td></tr><tr><td>  intrinsics </td><td>  100 </td><td>  345.54 рдПрди.рдПрд╕. </td></tr><tr><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  1000 </td><td>  1 847.88 рдПрди.рдПрд╕. </td></tr><tr><td>  LINQ </td><td>  1000 </td><td>  12 033.78 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  1000 </td><td>  240.38 рдПрди.рдПрд╕. </td></tr><tr><td>  intrinsics </td><td>  1000 </td><td>  630.98 рдПрди.рдПрд╕. </td></tr><tr><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  10000 </td><td>  18 403.72 рдПрди.рдПрд╕. </td></tr><tr><td>  LINQ </td><td>  10000 </td><td>  102 489.96 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  10000 </td><td>  7 316.42 рдПрди.рдПрд╕. </td></tr><tr><td>  intrinsics </td><td>  10000 </td><td>  3 365.25 рдПрди.рдПрд╕. </td></tr><tr><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  100000 </td><td>  176 630.67 рдПрди.рдПрд╕. </td></tr><tr><td>  LINQ </td><td>  100000 </td><td>  975 998.24 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  100000 </td><td>  78 828.03 рдПрдирдПрд╕ </td></tr><tr><td>  intrinsics </td><td>  100000 </td><td>  41 269.41 рдПрди.рдПрд╕. </td></tr></tbody></table></div><br><p>  рдпрд╣ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рд╕реНрдкрд╖реНрдЯ рд╕рдорд╛рдзрд╛рди рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рд╡реИрдХреНрдЯрд░ рдФрд░ рдЗрдВрдЯреНрд░рд┐рдВрд╕рд┐рдХреНрд╕ рдХреЗ рд╕рдорд╛рдзрд╛рди рдмрд╣реБрдд рддреЗрдЬреА рд╕реЗ рдФрд░ LINQ рдХреЗ рд╕рд╛рде рд╣реИрдВред  рдЕрдм рд╣рдореЗрдВ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдХрд┐ рдЗрди рджреЛ рддрд░реАрдХреЛрдВ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИред </p><br><p>  рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡реИрдХреНрдЯрд░ рд╡рд┐рдзрд┐ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">рд╡реИрдХреНрдЯрд░</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Vectors</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vectorSize = Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Count; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> accVector = Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Zero; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> array = Array; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; array.Length - vectorSize; i += vectorSize) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(array, i); accVector = Vector.Add(accVector, v); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = Vector.Dot(accVector, Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.One); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; array.Length; i++) { result += array[i]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> </div></div><br><ul><li>  int VectorSize = рд╡реЗрдХреНрдЯрд░ &lt;int&gt; .Count;  - рдпрд╣ рдПрдХ рд╡реЗрдХреНрдЯрд░ рдореЗрдВ рдХрд┐рддрдиреЗ 4 рдмрд╛рдЗрдЯ рдирдВрдмрд░ рд╣реИрдВред  рдпрджрд┐ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рддреНрд╡рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдорд╛рди рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдПрдХ SIMD рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ рдХрд┐рддрдиреЗ 4-рдмрд╛рдЗрдЯ рдирдВрдмрд░ рд░рдЦреЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрд┐рддрдиреЗ рддрддреНрд╡ рдЖрдк рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рд╕рдВрдЪрд╛рд▓рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ; </li><li>  accVector - рдПрдХ рд╡реЗрдХреНрдЯрд░ рдЬрд┐рд╕рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдЬрдорд╛ рд╣реЛрдЧрд╛; <br>  var v = рдирдпрд╛ рд╡реЗрдХреНрдЯрд░ &lt;int&gt; (рд╕рд░рдгреА, i);  - рдбреЗрдЯрд╛ рдХреЛ рдЗрдВрдбреЗрдХреНрд╕ рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реБрдП, рд╕рд░рдгреА рд╕реЗ, рдПрдХ рдирдпрд╛ рд╡реЗрдХреНрдЯрд░ рд╡реА рдореЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╡реЗрдХреНрдЯрд░рд╕рд╛рдЗрдЬрд╝ рдбреЗрдЯрд╛ рд▓реЛрдб рд╣реЛ рдЬрд╛рдПрдЧрд╛ред </li><li>  accVector = Vector.Add (accVector, v);  - рджреЛ рд╡реИрдХреНрдЯрд░ рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВред <br>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдРрд░реЗ 8 рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ: {0, 1, 2, 3, 4, 5, 6, 7} рдФрд░ рд╡реЗрдХреНрдЯрд░рд╕рд╛рдЗрдЬ == 4, рдлрд┐рд░: <br>  рд▓реВрдк accVector рдХреЗ рдкрд╣рд▓реЗ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдореЗрдВ = {0, 0, 0, 0}, v = {0, 1, 2, 3}, accVector рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрд╛рдж рдпрд╣ рд╣реЛрдЧрд╛: {0, 0, 0, 0} + {0, 1, 2 , 3} = {0, 1, 2, 3}ред <br>  рджреВрд╕рд░реА рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдореЗрдВ, v = {4, 5, 6, 7} рдФрд░ рдЗрд╕рдХреЗ рдмрд╛рдж accVector = {0, 1, 2, 3} + {4, 5, 6, 7} = {4, 6, 8, 10}ред </li><li>  рдпрд╣ рдХреЗрд╡рд▓ рдХрд┐рд╕реА рди рдХрд┐рд╕реА рд░реВрдк рдореЗрдВ рд╡реЗрдХреНрдЯрд░ рдХреЗ рд╕рднреА рддрддреНрд╡реЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд░рд╣рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдо рдЗрдХрд╛рдЗрдпреЛрдВ рд╕реЗ рднрд░реЗ рд╡реЗрдХреНрдЯрд░ рджреНрд╡рд╛рд░рд╛ рд╕реНрдХреЗрд▓рд░ рдЧреБрдгрди рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: int result = Vector.Dot (accVector, рд╡реЗрдХреНрдЯрд░ &lt;int .One); <br>  рдлрд┐рд░ рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛: {4, 6, 8, 10} <em>{1, 1, 1, 1} = 4</em> 1 + 6 <em>1 + 8</em> 1 + 10 * 1 = 28ред </li><li>  рдЕрдВрдд рдореЗрдВ, рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рд╕рдВрдЦреНрдпрд╛рдПрдБ рдЬреЛрдбрд╝реА рдЬрд╛рддреА рд╣реИрдВ рдЬреЛ рдЕрдВрддрд┐рдо рд╡реЗрдХреНрдЯрд░ рдореЗрдВ рдлрд┐рдЯ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВред </li></ul><br><p>  рдпрджрд┐ рдЖрдк рдЖрдВрддрд░рд┐рдХ рдкрджреНрдзрддрд┐ рдХреЛрдб рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">intrinsics</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsafe</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Intrinsics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vectorSize = <span class="hljs-number"><span class="hljs-number">256</span></span> / <span class="hljs-number"><span class="hljs-number">8</span></span> / <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> accVector = Vector256&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Zero; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> array = Array; <span class="hljs-keyword"><span class="hljs-keyword">fixed</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* ptr = array) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; array.Length - vectorSize; i += vectorSize) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = Avx2.LoadVector256(ptr + i); accVector = Avx2.Add(accVector, v); } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temp = <span class="hljs-keyword"><span class="hljs-keyword">stackalloc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[vectorSize]; Avx2.Store(temp, accVector); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; vectorSize; j++) { result += temp[j]; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; array.Length; i++) { result += array[i]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> </div></div><br><p>  рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдХреБрдЫ рдЕрдкрд╡рд╛рджреЛрдВ рдХреЗ рд╕рд╛рде рд╡реИрдХреНрдЯрд░ рдХреЗ рд╕рдорд╛рди рд╣реИ: </p><br><ul><li>  рд╡реЗрдХреНрдЯрд░рд╕рд╛рдЗрдЬ рдирд┐рд░рдВрддрд░ рджреНрд╡рд╛рд░рд╛ рджреА рдЬрд╛рддреА рд╣реИред  рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ Avx2 рдирд┐рд░реНрджреЗрд╢ рдЬреЛ 256 рдмрд┐рдЯ рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдкрд░ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕ рдкрджреНрдзрддрд┐ рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ, рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЬрд╛рдВрдЪ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рд╡рд░реНрддрдорд╛рди Avx2 рдкреНрд░реЛрд╕реЗрд╕рд░ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рджреВрд╕рд░рд╛ рдХреЛрдб рдХреЙрд▓ рдХрд░реЗрдВред  рдпрд╣ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Avx2.IsSupported) { DoThingsForAvx2(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Avx.IsSupported) { DoThingsForAvx(); } ... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Sse2.IsSupported) { DoThingsForSse2(); } ...</code> </pre> </li><li>  var accVector = рд╡реЗрдХреНрдЯрд░256 &lt;int&gt; .Zero;  accVector рдХреЛ рд╢реВрдиреНрдп рдмрд┐рдЯ рд╡реЗрдХреНрдЯрд░ рд╕реЗ рднрд░рд╛ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </li><li>  рдлрд┐рдХреНрд╕реНрдб (int * ptr = Array) - рдПрдХ рдкреЙрдЗрдВрдЯрд░ рдХрд╛ рдкреЙрдЗрдВрдЯрд░ ptr рдореЗрдВ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li><li>  рдлрд┐рд░ рд╡реИрдХреНрдЯрд░ рдореЗрдВ рд╕рдорд╛рди рд╕рдВрдЪрд╛рд▓рди: рдПрдХ рд╡реЗрдХреНрдЯрд░ рдореЗрдВ рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдирд╛ рдФрд░ рджреЛ рд╡реИрдХреНрдЯрд░ рдЬреЛрдбрд╝рдирд╛ред </li><li>  рд╡реЗрдХреНрдЯрд░ рдХреЗ рддрддреНрд╡реЛрдВ рдХреЛ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рдзрд┐ рд▓рд╛рдЧреВ рдХреА рдЧрдИ рдереА: <br><ul><li>  рдПрдХ рд╕рд░рдгреА рд╕реНрдЯреИрдХ рдкрд░ рдмрдирд╛рдИ рдЧрдИ рд╣реИ: var рдЕрд╕реНрдерд╛рдпреА = рд╕реНрдЯреИрдХрд▓реЛрдХ рдЗрдВрдЯ [рд╡реЗрдХреНрдЯрд░рд╕рд╛рдЗрдЬрд╝]; </li><li>  рд╡реЗрдХреНрдЯрд░ рдХреЛ рдЗрд╕ рд╕рд░рдгреА рдореЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: Avx2.Store (рдЕрд╕реНрдерд╛рдпреА, accVector); </li><li>  рдПрдХ рд▓реВрдк рдореЗрдВ рдРрд░реЗ рдХреЗ рддрддреНрд╡ рд╕рдореНтАНрдорд┐рд▓рд┐рдд рд╣реИрдВред </li></ul></li><li>  рдлрд┐рд░ рдЕрдВрддрд┐рдо рд╡реЗрдХреНрдЯрд░ рдореЗрдВ рдирд╣реАрдВ рд░рдЦреА рдЧрдИ рд╕рд░рдгреА рдХреЗ рддрддреНрд╡реЛрдВ рдХреЛ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ </li></ul><br><h2 id="sravnivaem-dva-massiva">  рджреЛ рд╕рд░рдгрд┐рдпреЛрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░реЗрдВ </h2><br><p>  рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рджреЛ рд╕рд░рдгрд┐рдпреЛрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рд╡рд╣ рд╕рдорд╕реНрдпрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рдХрд╛рд░рдг рдореИрдВрдиреЗ .NET рдореЗрдВ SIMD рд╕реАрдЦрдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ред  рдлрд┐рд░, рд╣рдо рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдХреЗ рд▓рд┐рдП рдХрдИ рддрд░реАрдХреЗ рд▓рд┐рдЦреЗрдВрдЧреЗ, рд╣рдо рджреЛ рд╕рд░рдгрд┐рдпреЛрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░реЗрдВрдЧреЗ: ArrayA рдФрд░ ArrayB: </p><br><p>  рд╕рдмрд╕реЗ рд╕реНрдкрд╖реНрдЯ рд╕рдорд╛рдзрд╛рди: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Naive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; ArrayA.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ArrayA[i] != ArrayB[i]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><p>  LINQ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдорд╛рдзрд╛рди: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LINQ</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; ArrayA.SequenceEqual(ArrayB);</code> </pre> <br><p>  MemCmp рд╕рдорд╛рд░реЛрд╣ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдорд╛рдзрд╛рди: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DllImport(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"msvcrt.dll"</span></span></span><span class="hljs-meta">, CallingConvention = CallingConvention.Cdecl)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">memcmp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] b1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] b2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MemCmp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; memcmp(ArrayA, ArrayB, ArrayA.Length) == <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><p>  System.Numerics рд╕реЗ рд╡реИрдХреНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Vectors</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vectorSize = Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>&gt;.Count; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; ArrayA.Length - vectorSize; i += vectorSize) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> va = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>&gt;(ArrayA, i); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>&gt;(ArrayB, i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Vector.EqualsAll(va, vb)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; ArrayA.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ArrayA[i] != ArrayB[i]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><p>  рдЖрдВрддрд░рд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsafe</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Intrinsics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vectorSize = <span class="hljs-number"><span class="hljs-number">256</span></span> / <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> equalsMask = <span class="hljs-keyword"><span class="hljs-keyword">unchecked</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (<span class="hljs-number"><span class="hljs-number">0b1111</span></span>_1111_1111_1111_1111_1111_1111_1111)); <span class="hljs-keyword"><span class="hljs-keyword">fixed</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>* ptrA = ArrayA) <span class="hljs-keyword"><span class="hljs-keyword">fixed</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>* ptrB = ArrayB) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; ArrayA.Length - vectorSize; i += vectorSize) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> va = Avx2.LoadVector256(ptrA + i); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vb = Avx2.LoadVector256(ptrB + i); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> areEqual = Avx2.CompareEqual(va, vb); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Avx2.MoveMask(areEqual) != equalsMask) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; ArrayA.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ArrayA[i] != ArrayB[i]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> <br><p>  рдореЗрд░реЗ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдХрд╛ рдкрд░рд┐рдгрд╛рдо: </p><br><div class="scrollable-table"><table><thead><tr><th>  рд╡рд┐рдзрд┐ </th><th>  ItemsCount </th><th>  рдордВрдЭрд▓рд╛ </th></tr></thead><tbody><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  10000 </td><td>  66 719.1 рдПрди.рдПрд╕. </td></tr><tr><td>  LINQ </td><td>  10000 </td><td>  71 211.1 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  10000 </td><td>  3 695.8 рдПрдирдПрд╕ </td></tr><tr><td>  memcmp </td><td>  10000 </td><td>  600.9 рдПрди.рдПрд╕. </td></tr><tr><td>  intrinsics </td><td>  10000 </td><td>  1 607.5 рдПрди.рдПрд╕. </td></tr><tr><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  100000 </td><td>  588 633.7 рдПрдирдПрд╕ </td></tr><tr><td>  LINQ </td><td>  100000 </td><td>  651 191.3 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  100000 </td><td>  34 659.1 рдПрди.рдПрд╕. </td></tr><tr><td>  memcmp </td><td>  100000 </td><td>  5 513.6 рдПрдирдПрд╕ </td></tr><tr><td>  intrinsics </td><td>  100000 </td><td>  12,078.9 рдПрди.рдПрд╕. </td></tr><tr><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  1000000 </td><td>  5 637 293.1 рдПрди.рдПрд╕. </td></tr><tr><td>  LINQ </td><td>  1000000 </td><td>  6 622 666.0 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  1000000 </td><td>  777 974.2 рдПрди.рдПрд╕. </td></tr><tr><td>  memcmp </td><td>  1000000 </td><td>  361 704.5 рдПрди.рдПрд╕. </td></tr><tr><td>  intrinsics </td><td>  1000000 </td><td>  рекрейрек реирелреи. n рдПрди.рдПрд╕. </td></tr></tbody></table></div><br><p>  рдЗрди рддрд░реАрдХреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рднреА рдХреЛрдб, рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ, рдЖрдВрддрд░рд┐рдХ рдореЗрдВ рджреЛ рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> areEqual = Avx2.CompareEqual(va, vb); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Avx2.MoveMask(areEqual) != equalsMask) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br><p>  рдкрд╣рд▓реЗ рдореЗрдВ, рджреЛ рд╡реИрдХреНрдЯрд░ рдХреА рд╕рдорд╛рдирддрд╛ рдХреЗ рд▓рд┐рдП рддреБрд▓рдирд╛ рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдЗрд░рд┐рдХреНрд╡рд╛рд▓ рд╡реЗрдХреНрдЯрд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рднреА рдмрд┐рдЯреНрд╕ рдХреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реНрдерд╛рди рдкрд░ рдПрдХ рддрддреНрд╡ рдореЗрдВ 1 рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрджрд┐ va рдФрд░ vb рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рддрддреНрд╡ рд╕рдорд╛рди рд╣реЛрдВред  рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдЕрдЧрд░ рдмрд╛рдЗрдЯреНрд╕ рд╡реАрдП рдФрд░ рд╡реАрдмреА рд╕реЗ рд╡реИрдХреНрдЯрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдмрд░рд╛рдмрд░ рд╣реИрдВ, рддреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╕рднреА рддрддреНрд╡реЛрдВ рдореЗрдВ 255 (11111111b) рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдХреНрдпреЛрдВрдХрд┐  Avx2.CompareEqual _mm256_cmpeq_epi8 рдкрд░ рдПрдХ рдЖрд╡рд░рдг рд╣реИ, рддрдм <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрдВрдЯреЗрд▓ рд╕рд╛рдЗрдЯ рдкрд░</a> рдЖрдк рдЗрд╕ рдСрдкрд░реЗрд╢рди рдХрд╛ рдЫрджреНрдо рдХреЛрдб рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: <br>  рдПрдХ рд╡реЗрдХреНрдЯрд░ рд╕реЗ MoveMask рд╡рд┐рдзрд┐ рдПрдХ 32-рдмрд┐рдЯ рд╕рдВрдЦреНрдпрд╛ рдмрдирд╛рддреА рд╣реИред  рдмрд┐рдЯ рдорд╛рди рд╡реЗрдХреНрдЯрд░ рдХреЗ 32 рдПрдХрд▓-рдмрд╛рдЗрдЯ рддрддреНрд╡реЛрдВ рдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рдЙрдЪреНрдЪ рдмрд┐рдЯреНрд╕ рд╣реИрдВред  рд╕реНрдпреВрдбреЛрдХреЛрдб <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ</a> рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ред </p><br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрджрд┐ va рдФрд░ vb рдореЗрдВ рдХреБрдЫ рдмрд╛рдЗрдЯреНрд╕ рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддреЗ рд╣реИрдВ, рддреЛ рд╕рдорд╛рдиреНрдп рдореЗрдВ рдмрд╛рдЗрдЯреНрд╕ 0 рд╣реЛрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдЗрди рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд┐рдЯреНрд╕ рднреА 0 рд╣реЛрдВрдЧреЗ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ Avx2 .Mask рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рдмрд┐рдЯреНрд╕ рднреА 0 рдФрд░ рддреБрд▓рдирд╛рддреНрдордХ рд╣реЛрдВрдЧреЗред рдмрд░рд╛рдмрд░реА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред </p><br><p>  рдЪрд▓реЛ рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдЙрджрд╛рд╣рд░рдг рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддреЗ рд╣реИрдВ, рдпрд╣ рдорд╛рдирддреЗ рд╣реБрдП рдХрд┐ рд╡реЗрдХреНрдЯрд░ рдХреА рд▓рдВрдмрд╛рдИ 8 рдмрд╛рдЗрдЯреНрд╕ рд╣реИ (рдпрд╣ рд▓рд┐рдЦрдирд╛ рдХрдо рдерд╛): </p><br><ul><li>  рдЪрд▓реЛ va = {100, 10, 20, 30, 100, 40, 50, 100}, рдФрд░ vb = {100, 20, 10, 30, 100, 40, 80, 90}; </li><li>  рдлрд┐рд░ рдИрдХреНрд╡рд▓ {255, 0, 0, 255, 255, 255, 0, 0} рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдЧрд╛; </li><li>  рдореВрд╡рдорд╕реНрдХ рд╡рд┐рдзрд┐ 10011100 рдмреА рд▓реМрдЯреЗрдЧреА, рдЬрд┐рд╕реЗ рдорд╛рд╕реНрдХ 11111111 рдмреА рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдХреНрдпреЛрдВрдХрд┐  рдЪреВрдВрдХрд┐ рдпреЗ рдореБрдЦреМрдЯреЗ рдЕрд╕рдорд╛рди рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рд╡реИрдХреНрдЯрд░ va рдФрд░ vb рд╕рдорд╛рди рдирд╣реАрдВ рд╣реИрдВред </li></ul><br><h2 id="podschityvaem-skolko-raz-element-vstrechaetsya-v-kollekcii">  рдЧрдгрдирд╛ рдХрд░реЗрдВ рдХрд┐ рд╕рдВрдЧреНрд░рд╣ рдореЗрдВ рдПрдХ рддрддреНрд╡ рдХрд┐рддрдиреА рдмрд╛рд░ рд╣реЛрддрд╛ рд╣реИ </h2><br><p>  рдХрднреА-рдХрднреА рдпрд╣ рдЧрдгрдирд╛ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ рдХрд┐рд╕реА рд╕рдВрдЧреНрд░рд╣ рдореЗрдВ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рддрддреНрд╡ рдХреЛ рдХрд┐рддрдиреА рдмрд╛рд░ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХреЛ рднреА рддреНрд╡рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЖрдЗрдП рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рддрд░реАрдХреЗ рд▓рд┐рдЦреЗрдВ, рд╣рдо рдПрд░реЗ рд╕рд░рдгреА рдореЗрдВ рдЖрдЗрдЯрдо рддрддреНрд╡ рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВрдЧреЗред </p><br><p>  рд╕рдмрд╕реЗ рд╕реНрдкрд╖реНрдЯ: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Naive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Array) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == Item) { result++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  LINQ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LINQ</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; Array.Count(i =&gt; i == Item);</code> </pre> <br><p>  System.Numerics.Vectors рд╕реЗ рд╡реИрдХреНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Vectors</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mask = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(Item); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vectorSize = Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Count; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> accResult = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> array = Array; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; array.Length - vectorSize; i += vectorSize) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(array, i); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> areEqual = Vector.Equals(v, mask); accResult = Vector.Subtract(accResult, areEqual); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; array.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (array[i] == Item) { result++; } } result += Vector.Dot(accResult, Vector&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.One); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  рдЖрдВрддрд░рд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsafe</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Intrinsics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vectorSize = <span class="hljs-number"><span class="hljs-number">256</span></span> / <span class="hljs-number"><span class="hljs-number">8</span></span> / <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-comment"><span class="hljs-comment">//var mask = Avx2.SetAllVector256(Item); //var mask = Avx2.SetVector256(Item, Item, Item, Item, Item, Item, Item, Item); var temp = stackalloc int[vectorSize]; for (int j = 0; j &lt; vectorSize; j++) { temp[j] = Item; } var mask = Avx2.LoadVector256(temp); var accVector = Vector256&lt;int&gt;.Zero; int i; var array = Array; fixed (int* ptr = array) { for (i = 0; i &lt; array.Length - vectorSize; i += vectorSize) { var v = Avx2.LoadVector256(ptr + i); var areEqual = Avx2.CompareEqual(v, mask); accVector = Avx2.Subtract(accVector, areEqual); } } int result = 0; Avx2.Store(temp, accVector); for(int j = 0; j &lt; vectorSize; j++) { result += temp[j]; } for(; i &lt; array.Length; i++) { if (array[i] == Item) { result++; } } return result; }</span></span></code> </pre> <br><p>  рдореЗрд░реЗ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдХрд╛ рдкрд░рд┐рдгрд╛рдо: </p><br><div class="scrollable-table"><table><thead><tr><th>  рд╡рд┐рдзрд┐ </th><th>  ItemsCount </th><th>  рдордВрдЭрд▓рд╛ </th></tr></thead><tbody><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  1000 </td><td>  2 824.41 рдПрди.рдПрд╕. </td></tr><tr><td>  LINQ </td><td>  1000 </td><td>  12 138.95 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  1000 </td><td>  961.50 рдПрди.рдПрд╕. </td></tr><tr><td>  intrinsics </td><td>  1000 </td><td>  691.08 рдПрди.рдПрд╕. </td></tr><tr><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  10000 </td><td>  27 072.25 рдПрди.рдПрд╕. </td></tr><tr><td>  LINQ </td><td>  10000 </td><td>  113 967.87 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  10000 </td><td>  7 571.82 рдПрди.рдПрд╕. </td></tr><tr><td>  intrinsics </td><td>  10000 </td><td>  4,296.71 рдПрди.рдПрд╕. </td></tr><tr><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  100000 </td><td>  361 028.46 рдПрди.рдПрд╕. </td></tr><tr><td>  LINQ </td><td>  100000 </td><td>  1,091,994.28 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  100000 </td><td>  82 839.29 рдПрди.рдПрд╕. </td></tr><tr><td>  intrinsics </td><td>  100000 </td><td>  40 307.91 рдПрди.рдПрд╕. </td></tr><tr><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  1000000 </td><td>  1 634 175.46 рдПрди.рдПрд╕. </td></tr><tr><td>  LINQ </td><td>  1000000 </td><td>  6 194 257.38 рдПрди.рдПрд╕. </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  1000000 </td><td>  583 901.29 рдПрди.рдПрд╕. </td></tr><tr><td>  intrinsics </td><td>  1000000 </td><td>  413 520.38 рдПрди.рдПрд╕. </td></tr></tbody></table></div><br><p>  рд╡реИрдХреНрдЯрд░ рдФрд░ рдЗрдВрдЯреНрд░рд┐рдирд┐рдХреНрд╕ рд╡рд┐рдзрд┐рдпрд╛рдВ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рддрд░реНрдХ рдореЗрдВ рд╕рдорд╛рди рд╣реИрдВ, рдЕрдВрддрд░ рдХреЗрд╡рд▓ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрдЪрд╛рд▓рди рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рд╣реИрдВред  рд╕рдордЧреНрд░ рд░реВрдк рдореЗрдВ рд╡рд┐рдЪрд╛рд░ рд╣реИ: </p><br><ul><li>  рдПрдХ рдореБрдЦреМрдЯрд╛ рд╡реЗрдХреНрдЯрд░ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рд╕рдВрдЦреНрдпрд╛ рдкреНрд░рддреНрдпреЗрдХ рддрддреНрд╡ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИ; </li><li>  рд╕рд░рдгреА рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╡реЗрдХреНрдЯрд░ v рдореЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдорд╛рд╕реНрдХ рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХреА рдЬрд╛рддреА рд╣реИ, рдлрд┐рд░ рд╕рднреА рдмрд┐рдЯреНрд╕ рдХреЛ рд╕рдорд╛рди рддрддреНрд╡реЛрдВ рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  areEqual ints рд╕реЗ рдПрдХ рд╡реЗрдХреНрдЯрд░ рд╣реИ, рддреЛ рдпрджрд┐ рдЖрдк рдПрдХ рддрддреНрд╡ рдХреЗ рд╕рднреА рдмрд┐рдЯреНрд╕ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдЗрд╕ рддрддреНрд╡ рдореЗрдВ -1 рдорд┐рд▓рддрд╛ рд╣реИ ((int) (1111_1111_1111_1111_1111_1111_1111_1111b == -1); </li><li>  рд╡реЗрдХреНрдЯрд░ areEqual рдХреЛ accVector рд╕реЗ рдШрдЯрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ accVector рдХреЛ рдЗрд╕ рдмрд╛рдд рдХрд╛ рдпреЛрдЧ рд╣реЛрдЧрд╛ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рд╡реИрдХреНрдЯрд░ v рдореЗрдВ рдХрд┐рддрдиреА рдмрд╛рд░ рдЖрдЗрдЯрдо рддрддреНрд╡ рд╣реБрдЖ рд╣реИ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП (рдорд╛рдЗрдирд╕ рдорд┐рдирдЯ рдПрдХ рдкреНрд▓рд╕ рджреЗрддрд╛ рд╣реИ)ред </li></ul><br><p>  рд▓реЗрдЦ рдХреЗ рд╕рднреА рдХреЛрдб <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GitHub</a> рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджреЗрдЦреЗ</a> рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ </p><br><h2 id="zaklyuchenie">  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br><p>  рдореИрдВрдиреЗ рдХреЗрд╡рд▓ рд╕рдВрднрд╛рд╡рдирд╛рдУрдВ рдХреЗ рдПрдХ рдмрд╣реБрдд рдЫреЛрдЯреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬреЛ .NET рдХрдореНрдкреНрдпреВрдЯрд┐рдВрдЧ рдХрдореНрдкреНрдпреВрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  X86 рдХреЗ рддрд╣рдд .NETCORE рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдЖрдВрддрд░рд┐рдХ рдХреА рдкреВрд░реНрдг рдФрд░ рдЕрджреНрдпрддрд┐рдд рд╕реВрдЪреА рдХреЗ рд▓рд┐рдП, рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реНрд░реЛрдд рдХреЛрдб рдХрд╛</a> рдЙрд▓реНрд▓реЗрдЦ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдЖрдВрддрд░рд┐рдХ рдХреЗ рд╕рд╛рд░рд╛рдВрд╢ рдореЗрдВ C # рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ C рдХреА рджреБрдирд┐рдпрд╛ рдХрд╛ рдЕрдкрдирд╛ рдирд╛рдо рд╣реИ, рдЬреЛ рдЗрд╕ рдЖрдВрддрд░рд┐рдХ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рдФрд░ рдореМрдЬреВрджрд╛ C ++ / C рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рдЕрдиреБрд╡рд╛рдж рдХреА рд╕рдордЭ рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рддрд╛ рд╣реИред  System.Numerics.Vector рдкреНрд░рд▓реЗрдЦрди <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">msdn</a> рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИред </p><br><p>  рдореЗрд░реА рд░рд╛рдп рдореЗрдВ, .NET рдХрд╛ C ++ рд╕реЗ рдЕрдзрд┐рдХ рд▓рд╛рдн рд╣реИ, рдХреНрдпреЛрдВрдХрд┐  рдЬреЗрдЖрдИрдЯреА рд╕рдВрдХрд▓рди рдХреНрд▓рд╛рдЗрдВрдЯ рдорд╢реАрди рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╣реЛрддрд╛ рд╣реИ, рдлрд┐рд░ рдХрдВрдкрд╛рдЗрд▓рд░ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреНрд▓рд╛рдЗрдВрдЯ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдХрд╛ рдЕрдиреБрдХреВрд▓рди рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЕрдзрд┐рдХрддрдо рдкреНрд░рджрд░реНрд╢рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рдЙрд╕реА рд╕рдордп, рддреЗрдЬ рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдПрдХ рднрд╛рд╖рд╛ рдФрд░ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдХреЗ рдврд╛рдВрдЪреЗ рдХреЗ рднреАрддрд░ рд░рд╣ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  UPD (09/15/2019): </p><br><div class="spoiler">  <b class="spoiler_title">рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдореЗрдВ рдПрдХ рдЬрд╛рдо рдерд╛</b> <div class="spoiler_text"><p>  рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдореЗрдВ, рдореИрдВрдиреЗ IterationSetup рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛, рдЬреЛ рдХрд┐, рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдирд┐рдХрд▓рд╛, рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдмрд╣реБрдд рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ 100ms рд╕реЗ рдХрдо рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдЗрд╕реЗ GlobalSetup рдкрд░ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдкрд░рд┐рдгрд╛рдо рдЗрд╕ рддрд░рд╣ рд╣реЛрдВрдЧреЗред </p><br><p>  рд╕рд░рдгреА рддрддреНрд╡реЛрдВ рдХрд╛ рдпреЛрдЧ: </p><br><div class="scrollable-table"><table><thead><tr><th>  рд╡рд┐рдзрд┐ </th><th>  ItemsCount </th><th>  рдореАрди </th><th>  рддреНрд░реБрдЯрд┐ </th><th>  StdDev </th><th>  рдЕрдиреБрдкрд╛рдд </th></tr></thead><tbody><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  10 </td><td>  3.531 рдПрди.рдПрд╕. </td><td>  0.0336 рдПрди.рдПрд╕. </td><td>  0.0314 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  10 </td><td>  76.925 рдПрди.рдПрд╕. </td><td>  0.4166 рдПрди.рдПрд╕. </td><td>  0.3897 рдПрди.рдПрд╕. </td><td>  21.79 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  10 </td><td>  2.750 рдПрди.рдПрд╕. </td><td>  0.0210 рдПрди.рдПрд╕. </td><td>  0.0196 рдПрди.рдПрд╕. </td><td>  0.78 </td></tr><tr><td>  intrinsics </td><td>  10 </td><td>  6.513 рдПрди.рдПрд╕. </td><td>  0.0623 рдПрди.рдПрд╕. </td><td>  0.0582 рдПрди.рдПрд╕. </td><td>  1.84 </td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  100 </td><td>  47.982 рдПрди.рдПрд╕. </td><td>  0.3975 рдПрди.рдПрд╕. </td><td>  0.3524 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  100 </td><td>  590.414 рдПрди.рдПрд╕. </td><td>  3.8808 рдПрди.рдПрд╕. </td><td>  рей.рекрекрежреи рдПрди.рдПрд╕. </td><td>  12.31 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  100 </td><td>  10.122 рдПрди.рдПрд╕. </td><td>  0.0747 рдПрди.рдПрд╕. </td><td>  0.0699 рдПрди.рдПрд╕. </td><td>  0.21 </td></tr><tr><td>  intrinsics </td><td>  100 </td><td>  14.277 рдПрди.рдПрд╕. </td><td>  0.0566 рдПрди.рдПрд╕. </td><td>  0.0529 рдПрди.рдПрд╕. </td><td>  0.30 </td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  1000 </td><td>  569.910 рдПрди.рдПрд╕. </td><td>  реи. .реи реп s рдПрди.рдПрд╕. </td><td>  2.6469 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  1000 </td><td>  5,658.570 рд░реБрдкрдпреЗ </td><td>  31.7465 рдПрди.рдПрд╕. </td><td>  29.6957 рдПрди.рдПрд╕. </td><td>  9.93 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  1000 </td><td>  79.598 рдПрди.рдПрд╕. </td><td>  0.3498 рдПрди.рдПрд╕. </td><td>  0.3272 рдПрди.рдПрд╕. </td><td>  0.14 </td></tr><tr><td>  intrinsics </td><td>  1000 </td><td>  66.970 рдПрдирдПрд╕ </td><td>  0.3937 рдПрди.рдПрд╕. </td><td>  0.3682 рдПрди.рдПрд╕. </td><td>  0.12 </td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  10000 </td><td>  5,637.571 рдПрди.рдПрд╕. </td><td>  37.5050 рдПрди.рдПрд╕. </td><td>  29.2814 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  10000 </td><td>  56,498.987 рдПрди.рдПрд╕. </td><td>  294.8776 рдПрди.рдПрд╕. </td><td>  275.8287 рдПрди.рдПрд╕. </td><td>  10.02 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  10000 </td><td>  772.900 рдПрди.рдПрд╕. </td><td>  2.6802 рдПрди.рдПрд╕. </td><td>  2.5070 рдПрди.рдПрд╕. </td><td>  0.14 </td></tr><tr><td>  intrinsics </td><td>  10000 </td><td>  579.152 рдПрди.рдПрд╕. </td><td>  2.8371 рдПрди.рдПрд╕. </td><td>  реи.ремрелрейs рдПрди.рдПрд╕. </td><td>  0.10 </td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  100000 </td><td>  56,352.865 рдПрди.рдПрд╕. </td><td>  230.7916 рдПрди.рдПрд╕. </td><td>  215.8826 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  100000 </td><td>  562,610.571 рдПрди.рдПрд╕. </td><td>  3,775.7631 рдПрди.рдПрд╕. </td><td>  3,152.9332 рдПрдирдПрд╕ </td><td>  9.98 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  100000 </td><td>  8,389.647 рдПрди.рдПрд╕. </td><td>  165.9590 рд░реБрдкрдпреЗ </td><td>  227.1666 рдПрди.рдПрд╕. </td><td>  0.15 </td></tr><tr><td>  intrinsics </td><td>  100000 </td><td>  7,261.334 рдПрди.рдПрд╕. </td><td>  89.6468 рдПрди.рдПрд╕. </td><td>  69.9903 рдПрди.рдПрд╕. </td><td>  0.13 </td></tr></tbody></table></div><br><p>  рджреЛ рд╕рд░рдгрд┐рдпреЛрдВ рдХреА рддреБрд▓рдирд╛: </p><br><div class="scrollable-table"><table><thead><tr><th>  рд╡рд┐рдзрд┐ </th><th>  ItemsCount </th><th>  рдореАрди </th><th>  рддреНрд░реБрдЯрд┐ </th><th>  StdDev </th><th>  рдЕрдиреБрдкрд╛рдд </th></tr></thead><tbody><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  10000 </td><td>  7,033.8 рдПрди.рдПрд╕. </td><td>  50.636 рдПрди.рдПрд╕. </td><td>  47.365 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  10000 </td><td>  64,841.4 рдПрдирдПрд╕ </td><td>  289.157 рдПрди.рдПрд╕. </td><td>  270.478 рдПрди.рдПрд╕. </td><td>  9.22 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  10000 </td><td>  504.0 рдПрди.рдПрд╕. </td><td>  реи.рекрежрем рдПрди.рдПрд╕. </td><td>  реи.реирелрез рдПрди.рдПрд╕. </td><td>  0.07 </td></tr><tr><td>  memcmp </td><td>  10000 </td><td>  368.1 рдПрди.рдПрд╕. </td><td>  2.637 рдПрди.рдПрд╕. </td><td>  реи.рекремрем рдПрди.рдПрд╕. </td><td>  0.05 </td></tr><tr><td>  intrinsics </td><td>  10000 </td><td>  283.6 рдПрдирдПрд╕ </td><td>  рез.резрейрел рдПрди.рдПрд╕. </td><td>  1.061 рдПрди.рдПрд╕. </td><td>  0.04 </td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  100000 </td><td>  85,214.4 рдПрди.рдПрд╕. </td><td>  903.868 рдПрди.рдПрд╕. </td><td>  845.478 рдПрдирдПрд╕ </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  100000 </td><td>  702,279.4 рдПрди.рдПрд╕. </td><td>  2,846.609 рдПрди.рдПрд╕. </td><td>  2,662.720 рдПрди.рдПрд╕. </td><td>  8.24 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  100000 </td><td>  5,179.2 рдПрди.рдПрд╕. </td><td>  45.337 рдПрди.рдПрд╕. </td><td>  42.409 рдПрди.рдПрд╕. </td><td>  0.06 </td></tr><tr><td>  memcmp </td><td>  100000 </td><td>  4,510.5 рдПрди.рдПрд╕. </td><td>  24.292 рдПрди.рдПрд╕. </td><td>  22.723 рдПрди.рдПрд╕. </td><td>  0.05 </td></tr><tr><td>  intrinsics </td><td>  100000 </td><td>  2,957.0 рдПрди.рдПрд╕. </td><td>  11.452 рдПрди.рдПрд╕. </td><td>  10.712 рдПрдирдПрд╕ </td><td>  0.03 </td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  1000000 </td><td>  844,006.1 рдПрди.рдПрд╕. </td><td>  3,552.478 рдПрдирдПрд╕ </td><td>  3,322.990 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  1000000 </td><td>  6,483,079.3 рдПрдирдПрд╕ </td><td>  42,641.040 рдПрди.рдПрд╕. </td><td>  39,886.455 рдПрди.рдПрд╕. </td><td>  7.68 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  1000000 </td><td>  54,180.1 рдПрди.рдПрд╕. </td><td>  357.258 рдПрди.рдПрд╕. </td><td>  334.180 рдПрди.рдПрд╕. </td><td>  0.06 </td></tr><tr><td>  memcmp </td><td>  1000000 </td><td>  49,480.1 рдПрди.рдПрд╕. </td><td>  515.675 рдПрди.рдПрд╕. </td><td>  457.133 рдПрди.рдПрд╕. </td><td>  0.06 </td></tr><tr><td>  intrinsics </td><td>  1000000 </td><td>  36,633.9 рдПрди.рдПрд╕. </td><td>  680.525 рдПрди.рдПрд╕. </td><td>  636.564 рдПрди.рдПрд╕. </td><td>  0.04 </td></tr></tbody></table></div><br><p>  рдХрд┐рд╕реА рд╕рд░рдгреА рдореЗрдВ рдХрд┐рд╕реА рддрддреНрд╡ рдХреЗ рд╣реЛрдиреЗ рдХреА рд╕рдВрдЦреНрдпрд╛: </p><br><div class="scrollable-table"><table><thead><tr><th>  рд╡рд┐рдзрд┐ </th><th>  ItemsCount </th><th>  рдореАрди </th><th>  рддреНрд░реБрдЯрд┐ </th><th>  StdDev </th><th>  рдЕрдиреБрдкрд╛рдд </th></tr></thead><tbody><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  10 </td><td>  8.844 рдПрди.рдПрд╕. </td><td>  0.0772 рдПрди.рдПрд╕. </td><td>  0.0603 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  10 </td><td>  87.456 рдПрди.рдПрд╕. </td><td>  0.9496 рдПрди.рдПрд╕. </td><td>  0.8883 рдПрди.рдПрд╕. </td><td>  9.89 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  10 </td><td>  3.140 рдПрди.рдПрд╕. </td><td>  0.0406 рдПрди.рдПрд╕. </td><td>  0.0380 рдПрди.рдПрд╕. </td><td>  0.36 </td></tr><tr><td>  intrinsics </td><td>  10 </td><td>  резрей.резрей рдПрди.рдПрд╕. </td><td>  0.0825 рдПрди.рдПрд╕. </td><td>  0.0772 рдПрди.рдПрд╕. </td><td>  1.56 </td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  100 </td><td>  резреж ..рейрезреж рдПрди.рдПрд╕. </td><td>  0.6975 рдПрди.рдПрд╕. </td><td>  0.6183 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  100 </td><td>  626.285 рдПрди.рдПрд╕. </td><td>  5.7677 рдПрди.рдПрд╕. </td><td>  5.3951 рдПрди.рдПрд╕. </td><td>  5.83 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  100 </td><td>  11.844 рдПрди.рдПрд╕. </td><td>  0.2113 рдПрди.рдПрд╕. </td><td>  0.1873 рдПрди.рдПрд╕. </td><td>  0.11 </td></tr><tr><td>  intrinsics </td><td>  100 </td><td>  19.616 рдПрди.рдПрд╕. </td><td>  0.1018 рдПрди.рдПрд╕. </td><td>  0.0903 рдПрди.рдПрд╕. </td><td>  0.18 </td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  1000 </td><td>  1,032.466 рдПрди.рдПрд╕. </td><td>  6.3799 рд░реБрдкрдпреЗ </td><td>  5.6556 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  1000 </td><td>  6,266.605 рдПрди.рдПрд╕. </td><td>  42.6585 рдПрди.рдПрд╕. </td><td>  39.9028 рдПрди.рдПрд╕. </td><td>  6.07 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  1000 </td><td>  83.417 рдПрди.рдПрд╕. </td><td>  0.5393 рдПрди.рдПрд╕. </td><td>  0.4780 рдПрди.рдПрд╕. </td><td>  0.08 </td></tr><tr><td>  intrinsics </td><td>  1000 </td><td>  88.358 рдПрди.рдПрд╕. </td><td>  0.4921 рдПрди.рдПрд╕. </td><td>  0.4603 рдПрди.рдПрд╕. </td><td>  0.09 </td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  10000 </td><td>  9,942.503 рдПрди.рдПрд╕. </td><td>  47.9732 рдПрди.рдПрд╕. </td><td>  40.0598 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  10000 </td><td>  62,305.598 рдПрди.рдПрд╕. </td><td>  643.8775 рдПрди.рдПрд╕. </td><td>  502.6972 рдПрди.рдПрд╕. </td><td>  6.27 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  10000 </td><td>  914.967 рдПрди.рдПрд╕. </td><td>  7.2959 рдПрди.рдПрд╕. </td><td>  6.8246 рдПрди.рдПрд╕. </td><td>  0.09 </td></tr><tr><td>  intrinsics </td><td>  10000 </td><td>  931.698 рдПрди.рдПрд╕. </td><td>  6.3444 рдПрди.рдПрд╕. </td><td>  5.9346 рдПрди.рдПрд╕. </td><td>  0.09 </td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  100000 </td><td>  94,834.804 рдПрди.рдПрд╕. </td><td>  793.8585 рдПрди.рдПрд╕. </td><td>  703.7349 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  100000 </td><td>  626,620.968 рдПрди.рдПрд╕. </td><td>  4,696.9221 рдПрди.рдПрд╕. </td><td>  4,393.5038 рдПрди.рдПрд╕. </td><td>  6.61 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  100000 </td><td>  9,000.827 рдПрди рдПрд╕ </td><td>  179.5351 рдПрди.рдПрд╕. </td><td>  192.1005 рдПрди.рдПрд╕. </td><td>  0.09 </td></tr><tr><td>  intrinsics </td><td>  100000 </td><td>  8,690.771 рдПрдирдПрд╕ </td><td>  101.7078 рдПрдирдПрд╕ </td><td>  95.1376 рдПрди.рдПрд╕. </td><td>  0.09 </td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  рдЕрдиреБрднрд╡рд╣реАрди </td><td>  1000000 </td><td>  959,302.249 рдПрди.рдПрд╕. </td><td>  4,268.2488 рдПрди.рдПрд╕. </td><td>  3,783.6914 рдПрди.рдПрд╕. </td><td>  1.00 </td></tr><tr><td>  LINQ </td><td>  1000000 </td><td>  6,218,681.888 ns </td><td>  31,321.9277 рдПрди.рдПрд╕. </td><td>  29,298.5506 рдПрди.рдПрд╕. </td><td>  6.48 </td></tr><tr><td>  рд╡реИрдХреНрдЯрд░ </td><td>  1000000 </td><td>  99,778.488 рдПрди.рдПрд╕. </td><td>  1,975.6001 рдПрди.рдПрд╕. </td><td>  4,252.6877 рдПрди.рдПрд╕. </td><td>  0.10 </td></tr><tr><td>  intrinsics </td><td>  1000000 </td><td>  96,449.350 рдПрди.рдПрд╕. </td><td>  1,171.8067 рдПрди.рдПрд╕. </td><td>  978.5116 рдПрди.рдПрд╕. </td><td>  0.10 </td></tr></tbody></table></div></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi435840/">https://habr.com/ru/post/hi435840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi435828/index.html">рдЧрд╛рдореЗрджреЗрд╡ рдореЗрдВ рдорда рд╕рд░рд▓ рд╣реИред рдмрд╛рд░рд┐рд╢ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЗ рд▓рд┐рдП рдПрдХрддрд╛ рдШрдЯрддрд╛ рд╣реИ рдФрд░ рд▓рд╣рд░ рдЖрддреА рд╣реИ</a></li>
<li><a href="../hi435830/index.html">рдУрдореЗрдЧрд╛ - рдЦреЗрд▓ рдХреА рдШрдЯрдирд╛рдУрдВ рдХреЗ рд╕рдордп рдХрд╛ рд╕реНрд╡рдЪрд╛рд▓рди</a></li>
<li><a href="../hi435834/index.html">рдкрд░реАрдХреНрд╖рд╛ - рдЕрддреНрдпрд╛рдзреБрдирд┐рдХ рдкрд╛рда рд╡рд░реНрдЧреАрдХрд░рдг рд╡рд┐рдзрд┐</a></li>
<li><a href="../hi435836/index.html">рд╡реЙрд▓ рд╕реНрдЯреНрд░реАрдЯ рдХреА рд╕рдмрд╕реЗ рдмрдбрд╝реА рдлрд░реНрдо рдиреИрд╕реНрдбреИрдХ рдФрд░ рдПрдирд╡рд╛рдИрдПрд╕рдИ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирдП рдПрдХреНрд╕рдЪреЗрдВрдЬ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╣рдордд рд╣реИрдВ</a></li>
<li><a href="../hi435838/index.html">рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЖрд▓рд╕реА рдХрд╛рд░реНрдп</a></li>
<li><a href="../hi435842/index.html">рдЧрд░реАрдмреЛрдВ рдХреЗ рд▓рд┐рдП 3 рдбреА рдЧреЗрдорд┐рдВрдЧ рдореЙрдбрд▓ рдмрдирд╛рдирд╛: рдЗрдВрдбреА рд╡реЗ</a></li>
<li><a href="../hi435846/index.html">рд╕реНрдХреВрд▓реА рдмрдЪреНрдЪреЛрдВ рдФрд░ рдЫрд╛рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдореНрдореЗрд▓рди рдФрд░ рд╣реИрдХрдереЙрди: 11 рд╡рд┐рд╖рдпрдЧрдд рдХрд╛рд░реНрдпрдХреНрд░рдо</a></li>
<li><a href="../hi435848/index.html">Microsoft рдФрд░ рднрд╛рдЧреАрджрд╛рд░реЛрдВ рд╕реЗ CES 2019 рдХреЗ рд╕рд╛рде рдирдП рдЙрдкрдХрд░рдг рдФрд░ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХрд┐рдпрд╛рдВ</a></li>
<li><a href="../hi435854/index.html">рдлрд╛рдЗрдЯреЛрдХреЗрдорд┐рд╕реНрдЯ рдХреЗ рдиреЛрдЯреНрд╕ред рдХреЗрд▓реЗ рдХрд╛ рд░реЗрдбрд┐рдпреЛ</a></li>
<li><a href="../hi435856/index.html">рдЖрдзреБрдирд┐рдХ рдлрд╛рдпрд░рд╡реЙрд▓ рдореЗрдВ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рдХрд╛ рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>