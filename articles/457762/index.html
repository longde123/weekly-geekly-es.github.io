<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëáüèΩ üìã üÖ±Ô∏è Regla CCD: con qu√© se come üçæ üñ•Ô∏è üôèüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo quiero presentar mi experiencia en el uso de un fotodetector CCD lineal. Tal l√≠nea CCD se puede usar en el dise√±o de un espectr√≥metro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Regla CCD: con qu√© se come</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457762/"><img src="https://habrastorage.org/webt/6f/ss/-0/6fss-0mg8davzerthbljhhg9ora.jpeg"><br>  En este art√≠culo quiero presentar mi experiencia en el uso de un fotodetector CCD lineal.  Tal l√≠nea CCD se puede usar en el dise√±o de un espectr√≥metro improvisado, lector de c√≥digo de barras, sensor de posici√≥n o desviaci√≥n del rayo l√°ser, un esc√°ner para fotograf√≠a o pel√≠cula, y mucho m√°s.  En mi caso, era un esc√°ner l√°ser, que no puedo describir en la red. <br><a name="habracut"></a><br>  <b>¬øQu√© es un dispositivo de carga acoplada?</b> <br><br>  Muy a menudo, cuando se habla de CCD, se refieren a varios fotodetectores.  Con menos frecuencia, estos son dispositivos de memoria: registros de desplazamiento, l√≠neas de retardo.  En esencia, este dispositivo recuerda de alguna manera la memoria en dominios magn√©ticos cil√≠ndricos, solo en silicio, con la ayuda de una onda viajera de un campo el√©ctrico creado por un sistema de electrodos, grupos de portadores de carga que de alguna manera se han formado en √©l antes se mueven a trav√©s del semiconductor.  Por lo tanto, obtenemos un registro de desplazamiento que tiene una estructura extremadamente simple y es capaz de recordar no solo una secuencia de unidades digitales y ceros, sino tambi√©n una se√±al anal√≥gica. <br><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/webt/at/dl/gv/atdlgvfbnsok-t_geekshblchyo.gif"></div><br>  En los receptores de im√°genes CCD, es precisamente esta capacidad de esta estructura la que se utiliza para emitir secuencialmente las cargas acumuladas debajo de cada uno de los p√≠xeles de la estructura.  Adem√°s, el mismo sistema de compuerta que se usa para mover las cargas durante la exposici√≥n crea pozos potenciales en los que se acumulan estas cargas (o estos agujeros se crean durante la formaci√≥n de la estructura, similar a los canales incorporados e inducidos del transistor MOS).  Las estructuras m√°s complejas incluyen una puerta resistiva a lo largo de la cual se forma una pendiente de potencial suave (as√≠ es como se organizan las l√≠neas CCD Hamamatsu S11155), as√≠ como la separaci√≥n de la acumulaci√≥n de carga y las zonas de transferencia: las cargas acumuladas de toda la l√≠nea se transfieren primero a la l√≠nea de amortiguaci√≥n y luego avanzan salir por la √∫ltima. <br>  La simplicidad de la estructura interna se traduce en la complejidad de administrarla.  Incluso la versi√≥n m√°s simple de la l√≠nea CCD requiere la generaci√≥n de una se√±al de dos o tres fases de forma compleja con diferentes niveles de voltaje con bordes empinados (con una alta capacitancia de entrada de 1000 pF o m√°s), desplazados uno con respecto al otro.  Las reglas de tipo Hamamatsu S11155 requieren hasta ocho se√±ales diferentes con diferentes niveles de alto y bajo voltaje en ambos lados de cero. <br>  Afortunadamente, algunas compa√±√≠as (por ejemplo, Sony) lanzaron una l√≠nea en la que toda esta complejidad se forma directamente en el chip.  Y para su trabajo, solo necesita generar dos se√±ales: el obturador electr√≥nico que se abre durante la exposici√≥n y el reloj.  En nuestro dise√±o, esta es exactamente la l√≠nea ILX554: (como regla, usada, pero bastante funcional) es f√°cil de comprar a los chinos en Aliexpress. <br><br>  <b>Veamos la hoja de datos.</b> <br><br>  Y vemos que solo 6 de los 22 pines est√°n involucrados. Estas son fuentes de alimentaci√≥n de + 5V, se√±ales de entrada ROG y CLK, se√±al de salida Vout, entrada de selecci√≥n de modo SHSW y tierra.  Y eso es todo. <br>  ROG es el control de obturador electr√≥nico (y el inicio de la transferencia de carga desde la l√≠nea fotosensible al registro de desplazamiento directo).  Tiene un nivel activo: cero.  Para exponer la matriz, debe presionarse a cero y mantenerse durante el tiempo que sea necesario, desde 5 Œºs hasta varios segundos.  Y luego, dej√°ndolo ir, espere al menos 3 Œºs (durante este tiempo, el circuito de transferencia de carga funciona).  Todo este tiempo en la entrada de CLK mantenemos un alto nivel.  Y luego puede leer la l√≠nea, aplicando a la entrada CLK un meandro con una frecuencia de varias decenas de kilohercios a 2 MHz.  En este caso, en cada diferencia de unidad a cero, el siguiente p√≠xel ser√° empujado a la salida.  Hay 2088 de esos p√≠xeles en la alineaci√≥n, de los cuales 2048 est√°n funcionando, fotosensibles (en realidad, hay varios m√°s, pero los p√≠xeles m√°s externos est√°n parcialmente oscurecidos).  Datashit recomienda aplicar al menos 2090 pulsos CLK a la matriz para un funcionamiento correcto. <br>  Y c√≥mo se empujar√° depende de lo que est√© en la entrada de SHSW.  Si es una unidad l√≥gica, la salida producir√° una se√±al bastante compleja: <br><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/webt/dz/xq/qb/dzxqqbdg8vq_r_jgxg4gwek-6lg.gif"></div><br>  Adem√°s, cuando el CLK pasa de cero a uno, se produce un restablecimiento y de la unidad a cero, la emisi√≥n de una se√±al √∫til. <br>  Y a cero en la entrada SHSW, el circuito de almacenamiento de muestreo incorporado se activa, lo que simplifica esta se√±al a una se√±al de video simple paso a paso, donde con cada nueva transici√≥n de CLK a cero, el nivel de se√±al del siguiente p√≠xel simplemente aparece y se mantiene durante todo el per√≠odo de la se√±al CLK. <br>  El rango √∫til de la se√±al de salida proviene de un cierto nivel oscuro, que seg√∫n la hoja de datos es de 2.85 V, pero en realidad puede ser diferente (en mi l√≠nea, aproximadamente 3 V), y cuando est√° saturado, el nivel de la se√±al de salida cae a 1.5-2 B. <br>  En general, eso es todo lo que necesitamos saber sobre esta l√≠nea. <br><br>  <b>Circuito de inclusi√≥n</b> <br><br><div style="text-align:center;"><img width="60%" src="https://habrastorage.org/webt/th/vo/xs/thvoxsmrevwageaehbzgex4j054.png"></div><br>  Es simple y obvio.  Generamos se√±ales CLK y ROG mediante programaci√≥n usando MK, y los disparadores Schmitt en la entrada son la forma m√°s sencilla de cambiar de 3.3 V a 5 V. El hecho es que no hay buffers en estas l√≠neas en la l√≠nea, y que los circuitos internos de la matriz funcionen correctamente. debe enviarles un meandro con una escala completa de cero a cinco voltios y una buena inclinaci√≥n de los frentes.  Los NC7SZ14M5X indicados en el diagrama son disparadores de inversi√≥n Schmitt individuales muy convenientes con frentes empinados y mayor capacidad de carga, y los uso a menudo en mis proyectos. <br>  Usando DA1, el nivel de se√±al de video de la l√≠nea "acelera" al rango en el que opera el ADC, mientras que se elimina el "soporte" de aproximadamente 1.5 V correspondiente al nivel de saturaci√≥n.  Dado que la diferencia entre la amplitud de la se√±al y el valor de "soporte" var√≠a mucho entre los diferentes conjuntos de l√≠neas CCD, las resistencias R1 y R3 deben seleccionarse "colocando" la se√±al de salida en el rango requerido.  Debe tenerse en cuenta que no solo el desplazamiento, sino tambi√©n la ganancia dependen de la resistencia R1, por lo que primero debe seleccionarlo. <br>  L1 y L2 son perlas de ferrita o peque√±os estranguladores para 1-2 ŒºG de tama√±o de marco 0805 o 0603. Se utilizan resistencias y condensadores del mismo tama√±o.  El circuito se ensambla en una placa de doble cara mediante montaje en superficie.  No traigo el dise√±o del tablero, ya que todav√≠a tengo muchas cosas en √©l. <br><br>  <b>Implementaci√≥n de software en MK</b> <br><br>  La tarea MK es generar una se√±al ROG de alto nivel (¬°no se olvide de los inversores!) De la duraci√≥n requerida, luego una pausa corta (3-10 Œºs), y luego una secuencia de 2090 pulsos de alto nivel separados por pausas iguales en duraci√≥n.  Durante estos pulsos (o pausas), alg√∫n tiempo despu√©s del frente, el valor de iluminaci√≥n de p√≠xeles se toma usando un ADC interno o externo.  Despu√©s de leer el cuadro, tambi√©n debe pausar hasta que aparezca un nuevo pulso ROG, los mismos 3-10 Œºs.  Despu√©s de encender la alimentaci√≥n y, como result√≥, despu√©s de un largo (m√°s de 100 ms) no uso de la regla, debe "limpiarla" aplicando un tren de pulsos est√°ndar gratuito al CLK un par de veces. <br>  En STM32, es aconsejable hacer todo esto en una interrupci√≥n del temporizador.  Al configurar el temporizador para generar interrupciones con una frecuencia correspondiente a la frecuencia de p√≠xeles duplicados, obtenemos cada operaci√≥n del temporizador en una interrupci√≥n, donde alternativamente emitimos cero o uno al puerto, y cuando emitimos cero, leemos las lecturas del ADC.  Y despu√©s de contar 2090 ciclos, detenemos el temporizador.  Para leer el siguiente cuadro, debe restablecer el contador de ciclos a cero, iniciar el temporizador y esperar hasta que se cuente todo. <br>  Algo como esto, como se muestra en estos fragmentos de c√≥digo. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> clkState = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> frameOk = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> pixCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> ccdFrame[<span class="hljs-number"><span class="hljs-number">2090</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> uint16_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readADC1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//            { . . . } void Delay(unsigned int Val) //     { for( ; Val != 0; Val--) __NOP(); } void readCCD(void) //   - { pixCount = 0; //    frameOk = false; //   TIM_Cmd(TIM6, ENABLE); //   while(frameOk == false); // ,     } // ...    ... // void TIM6_IRQHandler(void) /*      -     CLK       */ { if (TIM_GetITStatus(TIM4, TIM_IT_Update) != RESET) { if(clkState == true) //   (.0)      { clkState = false; GPIOB-&gt;ODR &amp;= ~GPIO_ODR_ODR_1; //      Delay(3); //  ,        ccdFrame[pixCount] = readADC1(); } else //   (.1) { pixCount++; clkState = true; GPIOB-&gt;ODR |= GPIO_ODR_ODR_1; //      } if(pixCount &gt;= 2090) //    ,      { pixCount = 0; frameOk = true; TIM_Cmd(TIM6, DISABLE); } TIM_ClearITPendingBit(TIM4, TIM_IT_Update); } }</span></span></span></span></code> </pre> <br><br>  <b>Y aqu√≠ est√° el resultado.</b> <br>  El resultado no es malo.  A pesar de que el ADC incorporado no tiene ninguna caracter√≠stica, sus caracter√≠sticas de ruido corresponden totalmente al ruido de la l√≠nea CCD.  La pista de ruido de la se√±al oscura con un tiempo de acumulaci√≥n de aproximadamente 1 ms resulta ser de ~ 3-4 niveles de cuantificaci√≥n, y cuando se usa un ADC externo de 14 bits con excelentes caracter√≠sticas, los resultados son solo ligeramente mejores.  Con el aumento de la iluminaci√≥n, el ruido aumenta por una simple raz√≥n: el n√∫mero de fotoelectrones en cada uno de los p√≠xeles no es tan grande (seg√∫n mis c√°lculos, alrededor de 30 mil en la saturaci√≥n).  Para los mejores dispositivos, este valor alcanza los 200 mil. <br>  En el cuadro a continuaci√≥n hay un ejemplo de una "imagen" registrada por la regla, en la cual, contra el fondo de la pared iluminada, hay un soporte oscuro en el que una bola hueca de vidrio con un di√°metro de 1 cm fijo en su interior se llena con una soluci√≥n negra.  Un pico es un reflejo de la superficie exterior de esta bola.  El ruido en las √°reas brillantes es la estructura de la pared misma, reforzada por motas del l√°ser, de cuadro a cuadro permanece estacionaria.  El ruido real de la l√≠nea es mucho menor. <br><div style="text-align:center;"><img width="65%" src="https://habrastorage.org/webt/ce/bt/jw/cebtjw-j6wmi1icilzg_oprfxnc.png" alt="imagen"></div><br><br>  <b>Otras lineas similares</b> <br>  Algunas otras l√≠neas CCD SONY en blanco y negro de 2048 p√≠xeles de ILX511, ILX551 (esta √∫ltima tiene un pinout diferente y requiere dos voltajes de alimentaci√≥n: 5 y 9 V), que difieren en el tama√±o de p√≠xel transversal (de 14 a 200 micras) funcionan exactamente de la misma manera. y sensibilidad espectral (ILX554A es sensible al rojo e IR, similar al √≠ndice B tiene una sensibilidad reducida en la regi√≥n IR y tiene una sensibilidad cercana al ojo, e ILX511B es m√°s sensible al azul).  Sus caracter√≠sticas din√°micas son diferentes: el rango din√°mico del ILX551B debido al peque√±o tama√±o de p√≠xel alcanza los 6000 (nuestra l√≠nea alcanza este DD con velocidades de obturaci√≥n cortas de aproximadamente 10 Œºs). <br><br>  * * * <br>  Este art√≠culo discute la conexi√≥n de quiz√°s la l√≠nea CCD m√°s f√°cil de usar.  Esta simplicidad se debe al hecho de que toda la complejidad est√° oculta en ella debajo del cap√≥.  Si no fuera por los controladores integrados, tendr√≠a que generar muchas se√±ales multinivel. <br>  Desafortunadamente, seg√∫n los est√°ndares modernos, una l√≠nea CCD con controladores incorporados no tiene las mejores caracter√≠sticas.  Entonces, en esta l√≠nea, el rango din√°mico, definido como la relaci√≥n de la se√±al de saturaci√≥n a la se√±al oscura, es 333: 1, y se define como la relaci√≥n de la se√±al de saturaci√≥n a la se√±al m√≠nima detectada en el fondo del ruido, aproximadamente 1000: 1.  Pero tales dispositivos no solo son dif√≠ciles de usar, sino que a menudo son dif√≠ciles de acceder (el mismo Hamamatsu requiere formalidades burocr√°ticas complicadas al comprar sus conjuntos CCD y otros fotodetectores debido al doble prop√≥sito de estos productos).  Sin embargo, no siempre se requiere un rendimiento tan alto, y para muchos prop√≥sitos los par√°metros de estos dispositivos son bastante aceptables. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/457762/">https://habr.com/ru/post/457762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457752/index.html">No rovers lunares ni bromistas. ¬øQu√© sabemos sobre los robots en Fukushima?</a></li>
<li><a href="../457754/index.html">Estado y asesinos en T</a></li>
<li><a href="../457756/index.html">El libro Kafka Streams en acci√≥n. Aplicaciones y microservicios en tiempo real ¬ª</a></li>
<li><a href="../457758/index.html">Los ingenieros salvan a las personas perdidas en el bosque, pero el bosque a√∫n no se ha rendido</a></li>
<li><a href="../457760/index.html">C√≥mo hacer que los contenedores est√©n a√∫n m√°s aislados: una revisi√≥n de las tecnolog√≠as de sandbox de contenedores</a></li>
<li><a href="../457764/index.html">10 errores del joven PO (parte II)</a></li>
<li><a href="../457766/index.html">Generamos niveles de mosaico y ocultamos cuadrados del jugador</a></li>
<li><a href="../457768/index.html">C√≥mo me volv√≠ vulnerable: escaneando la infraestructura de TI con Qualys</a></li>
<li><a href="../457770/index.html">Escribimos transformadores personalizados AST en TypeScript</a></li>
<li><a href="../457774/index.html">Estudiar como piloto privado en la Tierra Media: mudarse y vivir en una aldea de Nueva Zelanda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>