<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🎤 🖲️ 🐚 Raspberry Pi Roboter Vision: Tiefenkarte 🌏 👉🏿 🌧️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Heute wird die gesamte Technologie des "Drohnenbaus" aktiv billiger. Bis auf eine: eine Karte des umgebenden Raums bekommen. Es gibt zwei Extreme: ent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Raspberry Pi Roboter Vision: Tiefenkarte</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/388259/"><img src="https://habrastorage.org/files/174/cb5/63e/174cb563ec424e5aabb4fc27afb4ad23.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute wird die gesamte Technologie des "Drohnenbaus" aktiv billiger. </font><font style="vertical-align: inherit;">Bis auf eine: eine Karte des umgebenden Raums bekommen. </font><font style="vertical-align: inherit;">Es gibt zwei Extreme: entweder teure Lidars (Tausende von Dollar) und optische Lösungen zum Erstellen einer Tiefenkarte (viele Hundert Dollar) oder ganz normale Lösungen wie Ultraschall-Entfernungsmesser. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus diesem Grund entstand auf der Grundlage eines kostengünstigen Raspberry Pi mit einer Kamera die Idee, eine Lösung zu finden, die sich in einer leeren Nische befindet und es Ihnen ermöglicht, eine Tiefenkarte „kostengünstig“ zu erhalten. </font><font style="vertical-align: inherit;">Und dies in einer einfachen Programmiersprache wie Python, damit Anfänger experimentieren können. </font><font style="vertical-align: inherit;">Eigentlich wollte ich über meine Ergebnisse erzählen. </font><font style="vertical-align: inherit;">Die resultierenden Skripte mit Beispielfotos können auch auf dem Desktop ausgeführt werden.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiefenkarte von einer Kamera.</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst ein paar Worte zum optischen Teil. Um eine Tiefenkarte zu erstellen, werden immer zwei Bilder verwendet - von der linken und rechten Kamera. Und wir haben Himbeeren mit einer Kamera. Daher wurde ein optischer Splitter entwickelt, der der Kamera ein Stereopaar verleiht. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einfachen Worten - wenn Sie sich das Foto ansehen, sehen Sie aus der Blackbox zwei Augen der Kamera an. Aber eigentlich ist die Kamera eine. Nur ein bisschen optische Magie.</font></font><br>
<br>
<img src="https://habrastorage.org/files/5b0/c19/5f5/5b0c195f51cb4550b910a49f925b0389.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Foto zeigt die zwölfte Iteration des Geräts. </font><font style="vertical-align: inherit;">Es hat lange gedauert, ein zuverlässiges stabiles Design zu erhalten, das gleichzeitig kostengünstig wäre. </font><font style="vertical-align: inherit;">Der schwierigste Teil sind die Innenspiegel, die durch Vakuumabscheidung von Aluminium auf Bestellung gefertigt wurden. </font><font style="vertical-align: inherit;">Wenn Sie Standardspiegel verwenden, bei denen sich die reflektierende Schicht unter dem Glas und nicht darüber befindet, bilden sie an der Verbindungsstelle eine Lücke, die das gesamte Bild radikal beeinträchtigt.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Woran werden wir arbeiten?</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Himbeer-Image von Raspbian Wheezy wurde als Basis verwendet, Python 2.7 und OpenCV 2.4 wurden installiert, also die erforderlichen Pakete für die kleinen Dinge - Matplotlib, Numpy und andere. </font><font style="vertical-align: inherit;">Alle Arten und ein Link zum fertigen Bild der Karte finden Sie am Ende des Artikels. </font><font style="vertical-align: inherit;">Eine Beschreibung der Skripte in Form von Lektionen finden Sie auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der Projektwebsite</font></font></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorbereiten eines Bildes zum Erstellen einer Tiefenkarte</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da unsere Lösung nicht aus Metall und ohne hochpräzise Optik besteht, sind durch die Montage kleine Abweichungen von der idealen Geometrie möglich. </font><font style="vertical-align: inherit;">Außerdem wird die Kamera mit Schrauben am Gerät befestigt, sodass ihre Position möglicherweise nicht ideal ist. </font><font style="vertical-align: inherit;">Das Problem mit der Position der Kamera wird manuell gelöst, und die Kompensation der "Krümmung" der Baugruppe der Struktur erfolgt in der Software.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skript Eins - Kameraausrichtung</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verbindung der Spiegel im Bild sollte idealerweise vertikal und zentriert sein. </font><font style="vertical-align: inherit;">Es ist schwer, es mit den Augen zu tun, daher wurde das erste Skript erstellt. </font><font style="vertical-align: inherit;">Es nimmt nur das Bild von der Kamera im Live-Vorschaumodus auf, zeigt es auf dem Bildschirm an und zeichnet in der Mitte der Überlagerung einen weißen Streifen, entlang dessen die Ausrichtung stattfindet. </font><font style="vertical-align: inherit;">Nachdem die Kamera richtig ausgerichtet ist, ziehen wir die Schrauben fester an und die Montage ist abgeschlossen.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/Kjx__P1AhKY%3Ffeature%3Doembed&amp;usg=ALkJrhgvUcHkGCJVHtBwgXAv98jxntHNEg" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist interessant im Code des ersten Skripts</font></font></b><div class="spoiler_text"><ul>
<li>    – <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a></li>
<li>           –        ,       cv.imshow()      ,    .       ,     .   ,   ,       .</li>
<li>  –         , ..     .   «»  ,  camera.hflip = True</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das zweite Skript - wir bekommen ein "sauberes" Stereopaar</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unsere linken und rechten Bilder werden in der Bildmitte zusammengefügt. </font><font style="vertical-align: inherit;">Die Fuge auf dem Foto hat eine Breite ungleich Null - Sie können sie nur entfernen, indem Sie die Spiegel vom Gerät entfernen, wodurch die Struktur vergrößert wird. </font><font style="vertical-align: inherit;">Bei der Kamera der Himbeere ist der Fokus auf unendlich eingestellt, und nahe gelegene Objekte (in unserem Fall ist dies eine Kreuzung) verschwimmen einfach. </font><font style="vertical-align: inherit;">Daher müssen Sie nur dem Skript mitteilen, das unserer Meinung nach eine „schlechte“ Zone ist, damit das Stereopaar sauber in Bilder geschnitten wird. </font><font style="vertical-align: inherit;">Es wurde ein zweites Skript erstellt, das ein Bild anzeigt und es Ihnen ermöglicht, mit den Tasten die zu schneidende Zone anzugeben. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht der Prozess aus:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/4eCGq_mEot8%3Ffeature%3Doembed&amp;usg=ALkJrhhKZUJxrQcLC3AgHeCvLTk3a6P0Vw" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist interessant im Code des zweiten Skripts</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a></li>
<li> ,  ,     cv2.rectangle().   ,          ,       .  , ,    Enter     .</li>
<li>   ,         .           ,        .</li>
<li>         JSON.    ,   ,      .</li>
<li>   . ,     ,        ,      .       ,      ./src          .        .     pf_1280_720.txt –       ,     .</li>
<li>           ,       .             .       :<br>
<pre><code class="python hljs">loadImagePath = <span class="hljs-string"><span class="hljs-string">""</span></span>
<span class="hljs-comment"><span class="hljs-comment"># loadImagePath = "./src/scene_1280x720_1.png"</span></span></code></pre></li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das dritte Skript - eine Reihe von Fotos zur Kalibrierung</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Grundlagenforschung sagt, dass das Stereopaar kalibriert werden muss, um eine Tiefenkarte erfolgreich zu erstellen. Alle wichtigen Punkte des linken Bildes sollten sich nämlich auf derselben Höhe und im rechten Bild befinden. In dieser Situation kann die StereoBM-Funktion, die unsere einzige Echtzeitfunktion ist, ihre Aufgabe erfolgreich erfüllen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Kalibrierung müssen wir ein Referenzbild drucken, eine Reihe von Fotos erstellen und es dem Kalibrierungsalgorithmus übergeben, der alle Verzerrungen berechnet und die Parameter speichert, um die Bilder wieder normal zu machen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Drucken Sie also das „ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schachbrett</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “ aus und kleben Sie es auf eine harte, flache Oberfläche. Der Einfachheit halber wurde für das Serienfoto ein Skript mit einem Countdown-Timer erstellt, das über dem Video angezeigt wird. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht das Skript für Serienfotografie bei der Arbeit aus:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/3COWaa2dW8s%3Ffeature%3Doembed&amp;usg=ALkJrhhy8J8ikQLNMZ-MYBX-iJvOt28V8g" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist interessant im 3. Skriptcode</font></font></b><div class="spoiler_text"><ul>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a></li>
<li>   . ,         . ,     ,   «»  .   ,          –      ,     .          camera.capture ()  ,   use_video_port=True.</li>
<li>       –   camera.annotate_text()          .     5  –           .</li>
<li>-,             ,          ./src</li>
</ul><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist zu beachten, dass die „Richtigkeit“ der erstellten Serie für die Kalibrierungsergebnisse entscheidend ist. </font><font style="vertical-align: inherit;">Wenig später werden wir uns das Ergebnis ansehen, das mit falsch aufgenommenen Fotos erzielt wird.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skript 4 - Schneiden von Fotos auf Stereopaaren</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem eine Reihe von Fotos aufgenommen wurde, erstellen wir ein weiteres Service-Skript, das die gesamte aufgenommene Fotoserie in Bildpaare schneidet - links und rechts - und die Paare in einem Ordner speichert. Zonen in der Bildmitte. </font><font style="vertical-align: inherit;">Das Skript ist ziemlich gewöhnlich, deshalb habe ich das Video unter einem Spoiler versteckt.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Arbeitsbeispiel und ein Link zu den Quellen des 4. Skripts</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4- </a></li>
<li>    :<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/NvzUPVe2qvo%3Ffeature%3Doembed&amp;usg=ALkJrhg-Jut_tmVdh01FMlNnKUIr_tRPNQ" frameborder="0" allowfullscreen=""></iframe></li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das Interessanteste ist die Kalibrierung, das fünfte Skript </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Kalibrierungsskript führt alle Stereopaare aus dem Ordner ./src in die Kalibrierungsfunktion ein und taucht in Gedanken ein. </font><font style="vertical-align: inherit;">Nach seiner schwierigen Arbeit (für 15 Bilder 1280x720 auf der ersten Himbeere dauert es ungefähr 5 Minuten) nimmt er das letzte Stereopaar, „korrigiert“ die Bilder (korrigiert) und zeigt bereits korrigierte Versionen, mit denen Sie eine Tiefenkarte erstellen können. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht das Skript in der Arbeit aus:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/mktMyDSskRM%3Ffeature%3Doembed&amp;usg=ALkJrhjOmcNeGs6BvY4WjoFVr0fvhGYBFA" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist interessant im Code des 5. Skripts</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a></li>
<li>     StereoVision. ,       ,       ,         «» .</li>
<li>                ,     .    .     «» ,    ,   </li>
<li><pre><code class="python hljs">calibrator.add_corners((imgLeft, imgRight), <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code></pre>  True  False –    ,    .</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Etwas ist schief gelaufen."</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt Zeiten, in denen Kalibrierungsergebnisse unerwartet sind. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier einige bemerkenswerte Beispiele: </font></font><br>
<br>
<img src="https://habrastorage.org/files/ff2/0f1/11f/ff20f111fa8e4a59a068fb054bc13831.jpg" alt="Schlechte Disparitätskarte"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tatsächlich ist die Kalibrierung ein entscheidender Moment. </font><font style="vertical-align: inherit;">Was wir bei der Erstellung einer Tiefenkarte erhalten, hängt direkt von ihrer Qualität ab. </font><font style="vertical-align: inherit;">Nach einer großen Anzahl von Experimenten zeichnete sich die folgende Liste der Schießanforderungen ab:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Schachbild </font><font style="vertical-align: inherit;">sollte </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parallel zur Ebene des Fotos sein - immer in unterschiedlichen Winkeln. </font><font style="vertical-align: inherit;">Aber auch ohne Fanatismus - wenn Sie das Brett fast senkrecht zur Ebene des Fotos halten, findet das Skript das Schach einfach nicht auf dem Bild.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Licht, gutes Licht. </font><font style="vertical-align: inherit;">Bei schwacher Raumbeleuchtung und selbst beim Herausziehen von Bildern aus dem Video nimmt die Bildqualität ab. </font><font style="vertical-align: inherit;">In meinem Fall korrigierte Licht in 90% der Fälle sofort die Situation.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schreiben Sie im Internet, dass die Karte nach Möglichkeit den maximalen Platz im Bild einnehmen soll. </font><font style="vertical-align: inherit;">Hilft wirklich.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht ein „festes“ Stereopaar mit guten Kalibrierungsergebnissen aus:</font></font><br>
<br>
<img src="https://habrastorage.org/files/b1a/080/c51/b1a080c51edc481685ad2ec4c266791f.jpg" alt="Bild"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skript 6 - der erste Versuch, eine Tiefenkarte zu erstellen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als ob alles fertig wäre - Sie können bereits eine Tiefenkarte erstellen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir </font><font style="vertical-align: inherit;">laden die Kalibrierungsergebnisse, machen ein Foto und erstellen mutig eine Tiefenkarte mit cv2.StereoBM. </font><font style="vertical-align: inherit;">Wir </font><font style="vertical-align: inherit;">erhalten ungefähr Folgendes </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/files/038/1a8/87f/0381a887fa0c4e1eac31f2e810b0ee78.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Ergebnis ist nicht sehr beeindruckend, offensichtlich müssen wir etwas verdrehen. </font><font style="vertical-align: inherit;">Nun, lassen Sie uns im nächsten, siebten Skript mit der Feinabstimmung fortfahren. </font><font style="vertical-align: inherit;">Dort werden wir für die Konstruktion nicht 2 Parameter verwenden, wie in StereoBM (), sondern fast 10, was viel interessanter ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier sind die Quellen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des 6. Skripts</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skript 7 - Tiefenkarte mit erweiterten Einstellungen </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Parameter nicht 2, sondern 10 sind, ist das Sortieren ihrer Optionen mit einem ständigen Neustart der Skripte falsch. </font><font style="vertical-align: inherit;">Daher wurde ein Skript zur bequemen interaktiven Abstimmung der Tiefenkarte erstellt. </font><font style="vertical-align: inherit;">Die Aufgabe bestand nicht darin, den Code mit der Schnittstelle zu komplizieren, daher wurde alles auf matplotlib erledigt. </font><font style="vertical-align: inherit;">Das Zeichnen der Oberfläche in matplotlib auf Himbeeren ist ziemlich langsam, daher übertrage ich normalerweise den Arbeitsordner von Himbeeren auf den Laptop und wähle dort die Parameter aus. </font><font style="vertical-align: inherit;">So funktioniert das Skript:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/cNpMje5AKTQ%3Ffeature%3Doembed&amp;usg=ALkJrhimJeESuzHh9Q2H_zWGvf5ShyVYMA" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie die Parameter ausgewählt haben, speichert das Skript über die Schaltfläche Speichern das Ergebnis in der Datei 3dmap_set.txt im JSON-Format.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist interessant im Code des 7. Skripts</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">7- </a></li>
<li>       . ,   -     ,        .</li>
<li>   ,         . , numOfDisparities    16,            .           update(val),            .   numOfDisparities    65.57     64.         ,            .</li>
<li>      matplotlib       ,     .</li>
</ul><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die praktische Arbeit mit der Tiefenkarte hat gezeigt, dass Sie zunächst den Parameter minDisparity und in Verbindung damit numOfDisparities auswählen müssen. </font><font style="vertical-align: inherit;">Denken Sie daran, dass sich numOfDisparities mit Schritt 16 tatsächlich diskret ändert. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie dieses Paar eingerichtet haben, können Sie mit anderen Parametern </font><font style="vertical-align: inherit;">herumspielen </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Funktionen der Karteneinstellungen sind bereits eine Frage des Geschmacks des Benutzers und hängen von der zu lösenden Aufgabe ab. </font><font style="vertical-align: inherit;">Sie können die Karte auf eine große Anzahl kleiner Teile bringen oder vergrößerte Bereiche anzeigen. </font><font style="vertical-align: inherit;">Für eine einfache Vermeidung von Hindernissen durch Roboter ist die zweite besser geeignet. </font><font style="vertical-align: inherit;">Für eine Punktwolke treten hier die ersten, aber Leistungsprobleme auf (wir werden darauf zurückkommen).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was wollen wir sehen?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, vielleicht ist einer der wichtigsten Punkte die Einstellung der "Weitsichtigkeit" unseres Geräts. </font><font style="vertical-align: inherit;">Beim Einrichten der Tiefenkarte platziere ich normalerweise ein Objekt in einem Abstand von etwa 30 cm, das zweite in einem Meter und den Rest zwei Meter weiter. </font><font style="vertical-align: inherit;">Und wenn ich die ersten beiden Parameter (minDisparity und numOfDisparities) im 7. Skript einrichte, erreiche ich Folgendes:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nächstes Objekt (30 cm) - rot</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objekt in einem halben Meter - gelb oder grün</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objekte 2-3 Meter - grün oder hellblau</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis erhalten wir ein System, das so konfiguriert ist, dass es die "nahe" Zone von Hindernissen in einem Radius von 5 bis 10 Metern erkennt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arbeiten mit Video on the fly - Skript 8., endgültig</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun haben wir ein vorgefertigtes kundenspezifisches System, und wir müssten ein praktisches Ergebnis erzielen. </font><font style="vertical-align: inherit;">Wir versuchen, mithilfe von Videos von unserer Kamera eine Tiefenkarte in Echtzeit zu erstellen und diese beim Aktualisieren in Echtzeit anzuzeigen.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/-qTayRg8skA%3Ffeature%3Doembed&amp;usg=ALkJrhiZgJeuvlBAHElaxOyOXHNDoBzJnA" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist interessant im Code des 8. Skripts</font></font></b><div class="spoiler_text">  –   .   ,     ,        overlay.      ,  :<br>
<br>
<ul>
<li>Overlay        R, G  B,      -   .    grayscale   </li>
<li><pre><code class="python hljs">disparity_color = cv2.applyColorMap(disparity_grayscale, cv2.COLORMAP_JET)</code></pre></li>
<li>  overlay    RGB,     BGR –        cv2.cvtColor()</li>
<li>Overlay      16.     16 —    .</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Rennen um die Geschwindigkeit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste Messung wurde also an der ersten Himbeere mit einem Single-Core-Prozessor durchgeführt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 Sekunden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Erstellen einer Karte auf dem Bild von 1280x720 Das ist viel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,5 Sekunden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - auf dem Raspberry Pi 2 schon besser. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Analyse ergab, dass in diesem Fall nur ein Kern für die zweite Himbeere verwendet wird. Durcheinander! Ich habe OpenCV mithilfe der TBB-Parallelisierungsbibliothek neu erstellt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,5 Sekunden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Starten Sie die zweite Himbeere mit Multi-Core. Tatsächlich stellte sich heraus, dass nur 2 Kerne verwendet werden - daran muss noch gebastelt werden. Es stellte sich heraus, dass </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht nur ich</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf dieses Problem </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">gestoßen bin</font></a><font style="vertical-align: inherit;"> , </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">sondern auch</font></a><font style="vertical-align: inherit;"> noch Bewegungsspielraum besteht.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem Algorithmus sollte die Betriebsgeschwindigkeit linear von der Größe der verarbeiteten Daten abhängen. </font><font style="vertical-align: inherit;">Wenn Sie also die Auflösung um das Zweifache reduzieren, sollte theoretisch alles viermal schneller funktionieren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3 Sekunden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder etwa 3-4 FPS - mit einer halb reduzierten Auflösung von 640 x 360. </font><font style="vertical-align: inherit;">Die Theorie wurde bestätigt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weitere Pläne</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst wollte ich das Beste aus dem Multicore der zweiten Himbeere herausholen. </font><font style="vertical-align: inherit;">Ich werde mir die Quellen der StereoBM-Funktion genauer ansehen und versuchen zu verstehen, warum die Arbeit nicht vollständig verläuft. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die nächste Stufe verspricht viel mehr Abenteuer - dies ist die Verwendung einer Himbeer-GPU, um die Berechnungen zu beschleunigen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier werden drei mögliche Wege gezeichnet:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>      GPU,     10 FPS,      .     —  ,     « »   OpenCV,    .</li>
<li>        Koichi Nakamura,    GPU    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a>.  ,     -  OpenCV,     . </li>
<li>              Jan Newmarch "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Programming AudioVideo on the Raspberry Pi GPU</a>" </li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie Erfahrung mit TBB für Raspberry OpenCV hatten oder sich mit der Codierung für Himbeer-GPUs befassten, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin ich Ihnen für weitere Hinweise dankbar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ich habe es aus einem einfachen Grund geschafft, einige vorgefertigte Entwicklungen zu finden - Himbeeren mit zwei Kameras sind selten. </font><font style="vertical-align: inherit;">Wenn Sie zwei Webcams über USB anschließen, treten große Bremsen auf, und nur Raspberry Pi Compute kann mit zwei nativen Kameras arbeiten, für die auch ein kräftiges Devboard mit Schnürsenkeln und Adaptern erforderlich ist.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nützliche Links:</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arbeitsskripte:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quellen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aller 8 Skripte auf Github</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kartenbild</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">2,6 GB im Archiv</font></a><font style="vertical-align: inherit;"> )</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenCV und Python auf Himbeeren einrichten:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toller Blog "python-OpenCV-shnik" und ein Handbuch </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zum Einrichten von Python und OpenCV auf Himbeeren</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
StereoVision-Bibliothek:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meine Arbeitsgabel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">am Github</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original von Egret </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf dem Github</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beschreibung des StereoVision-Autors in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seinem Blog</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GPU-Arbeit</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der japanische </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liebits</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Koichi Nakamura </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">über Github</font></a><font style="vertical-align: inherit;"> - Assembler für Python für GPU</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jan Newmarch Buch " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programmieren von Audio-Video auf der Raspberry Pi GPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie mit einer Himbeerkamera arbeiten müssen Wie ein Boss: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Picamera- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentation</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, ein interessanter Artikel über den Habr über " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um Bilder zu erkennen, müssen Sie keine Bilder erkennen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de388259/">https://habr.com/ru/post/de388259/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de388243/index.html">Hausüberwachung und Fernüberwachung über das Internet</a></li>
<li><a href="../de388245/index.html">Das erste modulare Telefon wurde zum Verkauf angeboten</a></li>
<li><a href="../de388247/index.html">Cassini flog zum letzten Mal neben Enceladus</a></li>
<li><a href="../de388253/index.html">Im Jahr 2015 erhielt Costa Rica rund 99% seines Stroms aus erneuerbaren Quellen.</a></li>
<li><a href="../de388257/index.html">DIY порошок для посудомойки: разбираем промышленные средства и улучшаем рецепт</a></li>
<li><a href="../de388261/index.html">Erinnerungen eines untermenschlichen Roboters, Kapitel 3-4</a></li>
<li><a href="../de388263/index.html">Missverständnisse über das Universum [Voiceover Vert Dider]</a></li>
<li><a href="../de388265/index.html">Wi-Fi-Modem für Commodore - wie sieht es aus?</a></li>
<li><a href="../de388267/index.html">Wir fliegen und setzen uns mit dem Falcon 9R</a></li>
<li><a href="../de388271/index.html">Kruglendar 2016 - Tagebuchplakat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>