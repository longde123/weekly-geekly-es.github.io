<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😣 👨‍👩‍👧 🈺 Ekstensi SIMD ke C ++ OpenMP di Visual Studio 🤴🏽 👆🏼 👩🏿‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Di era aplikasi AI di mana-mana ada permintaan yang muncul dari compiler mempercepat komputasi-mesin belajar kode intensif untuk perangkat keras yang ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ekstensi SIMD ke C ++ OpenMP di Visual Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/446688/"><p>  Di era aplikasi AI di mana-mana ada permintaan yang muncul dari compiler mempercepat komputasi-mesin belajar kode intensif untuk perangkat keras yang ada.  Kode seperti itu biasanya melakukan perhitungan matematis seperti transformasi dan manipulasi matriks dan biasanya dalam bentuk loop.  Perpanjangan SIMD dari OpenMP memberikan pengguna cara yang mudah untuk mempercepat loop dengan secara eksplisit memanfaatkan unit vektor prosesor modern.  Kami bangga mulai menawarkan C / C ++ OpenMP SIMD vectorization di Visual Studio 2019. </p><br><p>  Antarmuka program aplikasi OpenMP C / C ++ pada awalnya dirancang untuk meningkatkan kinerja aplikasi dengan mengaktifkan kode yang akan dieksekusi secara paralel secara paralel pada beberapa prosesor pada 1990-an.  Selama bertahun-tahun standar OpenMP telah diperluas untuk mendukung konsep tambahan seperti paralelisasi berbasis tugas, vektorisasi SIMD, dan pembongkaran prosesor.  Sejak 2005, Visual Studio telah mendukung standar OpenMP 2.0 yang berfokus pada paralelisasi multithreaded.  Ketika dunia bergerak ke era AI, kami melihat peluang yang berkembang untuk meningkatkan kualitas kode dengan memperluas dukungan standar OpenMP di Visual Studio.  Kami melanjutkan perjalanan kami di Visual Studio 2019 dengan menambahkan dukungan untuk OpenMP SIMD. </p><br><img src="https://habrastorage.org/webt/74/-s/cs/74-scsh4qdjqqdw-qj3ynz5ircc.jpeg"><a name="habracut"></a><br><br><p>  OpenMP SIMD, pertama kali diperkenalkan dalam standar OpenMP 4.0, terutama menargetkan vektorisasi loop.  Sejauh ini fitur OpenMP yang paling banyak digunakan dalam pembelajaran mesin menurut penelitian kami.  Dengan menganotasi loop dengan arahan OpenMP SIMD, kompiler dapat mengabaikan dependensi vektor dan membuat vektorisasi loop sebanyak mungkin.  Kompiler menghormati niat pengguna untuk menjalankan beberapa perulangan yang dijalankan secara bersamaan. </p><br><pre><code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp simd for (i = 0; i &lt; count; i++) { a[i] = b[i] + 1; }</span></span></code> </pre> <br><p>  Seperti yang Anda ketahui, C ++ di Visual Studio sudah menyediakan <strong>pragma</strong> loop non-OpenMP serupa seperti <strong>#pragma vector</strong> dan <strong>#pragma ivdep</strong> .  Namun, kompiler dapat berbuat lebih banyak dengan OpenMP SIMD.  Sebagai contoh: </p><br><ol><li>  Kompilator selalu diizinkan untuk mengabaikan dependensi vektor apa pun yang ada. </li><li>  / fp: fast diaktifkan di dalam loop. </li><li>  Loop dengan pemanggilan fungsi adalah vektor. </li><li>  Lingkaran luar vektor. </li><li>  Loop bersarang dapat digabung menjadi satu loop dan di-vektor-kan. </li><li>  Akselerasi hybrid dapat dicapai dengan <strong>#pragma omp for simd</strong> untuk memungkinkan multithreading berbutir kasar dan vektorisasi berbutir halus. </li></ol><br><p>  Selain itu, arahan OpenMP SIMD dapat mengambil klausa berikut untuk lebih meningkatkan vektorisasi: </p><br><ul><li>  <strong>simdlen (</strong> <em>panjang</em> <strong>):</strong> tentukan jumlah jalur vektor </li><li>  <strong>safelen (</strong> <em>panjang</em> <strong>):</strong> tentukan jarak ketergantungan vektor </li><li>  <strong>linear (</strong> <em>daftar [</em> <strong>:</strong> <em>linear-langkah]</em> <strong>):</strong> pemetaan linear dari variabel induksi loop ke langganan array </li><li>  <strong>aligned (</strong> <em>list [</em> <strong>:</strong> <em>alignment]</em> <strong>):</strong> penyelarasan data </li><li>  <strong>pribadi (</strong> <em>daftar</em> <strong>):</strong> tentukan privatisasi data </li><li>  <strong>lastprivate (</strong> <em>daftar</em> <strong>):</strong> tentukan privatisasi data dengan nilai akhir dari iterasi terakhir </li><li>  <strong>reduksi (</strong> <em>pengurang reduksi</em> <strong>:</strong> <em>daftar</em> <strong>):</strong> tentukan operasi reduksi yang disesuaikan </li><li>  <strong>collapse (</strong> <em>n</em> <strong>):</strong> coalescing loop nest </li></ul><br><h3>  <em>-Openmp</em> Baru <em>:</em> sakelar <em>eksperimental</em> </h3><br><p>  Program beranotasi OpenMP-SIMD dapat dikompilasi dengan saklar CL baru <strong>-openmp: eksperimental.</strong>  Switch baru ini memungkinkan fitur OpenMP tambahan tidak tersedia di bawah <strong>-opmp</strong> .  Sementara nama sakelar ini adalah "eksperimental", sakelar itu sendiri, dan fungsi yang diaktifkan sepenuhnya didukung dan siap produksi.  Namanya mencerminkan bahwa itu tidak memungkinkan subset lengkap atau versi standar OpenMP.  Iterasi kompiler di masa mendatang dapat menggunakan sakelar ini untuk mengaktifkan fitur OpenMP tambahan dan sakelar terkait OpenMP baru dapat ditambahkan.  <strong>-Openmp:</strong> sakelar <strong>eksperimental menggunakan</strong> sakelar <strong>-openmp</strong> yang artinya kompatibel dengan semua fitur OpenMP 2.0.  Perhatikan bahwa direktif SIMD dan klausulnya tidak dapat dikompilasi dengan sakelar <strong>-openmp</strong> . </p><br><p>  Untuk loop yang tidak di-vector, compiler akan mengeluarkan pesan untuk masing-masingnya seperti di bawah ini.  Misalnya, </p><br><p>  cl -O2 -openmp: eksperimental mycode.cpp </p><br><p>  mycode.cpp (84): info C5002: Omp simd loop tidak di-vectorized karena alasan '1200' </p><br><p>  mycode.cpp (90): info C5002: Omp simd loop tidak di-vectorized karena alasan '1200' </p><br><p>  Untuk loop yang di-vektor-kan, kompiler tetap diam kecuali sakelar logging vektorisasi disediakan: </p><br><p>  cl -O2 -openmp: eksperimental -Qvec-report: 2 mycode.cpp </p><br><p>  mycode.cpp (84): info C5002: Omp simd loop tidak di-vectorized karena alasan '1200' </p><br><p>  mycode.cpp (90): info C5002: Omp simd loop tidak di-vectorized karena alasan '1200' </p><br><p>  mycode.cpp (96): info C5001: Omp simd loop di-vectorized </p><br><p>  Sebagai langkah pertama mendukung OpenMP SIMD, pada dasarnya kami telah menghubungkan pragma SIMD dengan backend vectorizer di bawah saklar baru.  Kami fokus pada vektorisasi loop paling dalam dengan meningkatkan vectorizer dan analisis alias.  Tidak ada klausa SIMD yang efektif dalam Visual Studio 2019 pada saat penulisan ini.  Mereka akan diurai tetapi diabaikan oleh kompiler dengan peringatan yang dikeluarkan untuk kesadaran pengguna.  Sebagai contoh, kompiler akan mengeluarkan </p><br><p>  peringatan C4849: Klausa 'simdlen' OpenMP diabaikan dalam arahan 'simd' </p><br><p>  untuk kode berikut: </p><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp simd simdlen(8) for (i = 1; i &lt; count; i++) { a[i] = a[i-1] + 1; b[i] = *c + 1; bar(i); }</span></span></code> </pre> <br><h3>  Lebih lanjut tentang semantik arahan OpenMP SIMD </h3><br><p>  Arahan OpenMP SIMD memberikan pengguna cara untuk mendikte kompiler untuk membuat vektor loop.  Kompiler diizinkan untuk mengabaikan legalitas yang tampak dari vektorisasi tersebut dengan menerima janji kebenaran dari pengguna.  Ini adalah tanggung jawab pengguna ketika perilaku tak terduga terjadi dengan vektorisasi.  Dengan menganotasi loop dengan arahan OpenMP SIMD, pengguna berniat untuk menjalankan beberapa iterasi loop secara bersamaan.  Ini memberi kompiler banyak kebebasan untuk menghasilkan kode mesin yang memanfaatkan sumber daya SIMD atau vektor pada prosesor target.  Sementara kompiler tidak bertanggung jawab untuk mengeksplorasi kebenaran dan keuntungan paralelisme yang ditentukan pengguna tersebut, ia masih <strong>harus</strong> memastikan perilaku berurutan dari satu iterasi loop tunggal. </p><br><p>  Sebagai contoh, loop berikut dijelaskan dengan arahan OpenMP SIMD.  Tidak ada paralelisme sempurna di antara iterasi loop karena ada ketergantungan ke belakang dari [i] ke [i-1].  Tetapi karena direktif SIMD kompiler masih diperbolehkan untuk mengemas iterasi berturut-turut dari pernyataan pertama ke dalam satu instruksi vektor dan menjalankannya secara paralel. </p><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp simd for (i = 1; i &lt; count; i++) { a[i] = a[i-1] + 1; b[i] = *c + 1; bar(i); }</span></span></code> </pre> <br><p>  Oleh karena itu, bentuk vektor yang ditransformasikan berikut dari loop adalah <strong>legal</strong> karena kompiler menjaga perilaku berurutan dari setiap iterasi loop asli.  Dengan kata lain, [i] dieksekusi setelah [-1], b [i] setelah [i] dan panggilan ke bilah akhirnya terjadi. </p><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp simd for (i = 1; i &lt; count; i+=4) { a[i:i+3] = a[i-1:i+2] + 1; b[i:i+3] = *c + 1; bar(i); bar(i+1); bar(i+2); bar(i+3); }</span></span></code> </pre> <br><p>  Adalah ilegal untuk memindahkan referensi memori <em>* c</em> dari loop jika mungkin alias dengan <em>[i]</em> atau <em>b [i]</em> .  Juga ilegal untuk menyusun ulang pernyataan di dalam satu iterasi asli jika melanggar ketergantungan berurutan.  Sebagai contoh, loop yang diubah berikut ini <strong>tidak</strong> sah. </p><br><pre> <code class="cs hljs">c = b; t = *c; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp simd for (i = 1; i &lt; count; i+=4) { a[i:i+3] = a[i-1:i+2] + 1; bar(i); // illegal to reorder </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> bar[i] depends on b[i] b[i:i+3] = t + 1; // illegal to move *c out of the loop bar(i+1); bar(i+2); bar(i+3); }</span></span></code> </pre> <br><h3>  Rencana dan Umpan Balik di masa depan </h3><br><p>  Kami mendorong Anda untuk mencoba fitur baru ini.  Seperti biasa, kami menyambut umpan balik Anda.  Jika Anda melihat loop SIMP OpenMP yang Anda harapkan menjadi vektor, tetapi tidak atau kode yang dihasilkan tidak optimal, beri tahu kami.  Kami dapat dihubungi melalui komentar di bawah ini, melalui email ( <a href="">visualcpp@microsoft.com</a> ), twitter (@visualc), atau melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Komunitas Pengembang</a> . </p><br><p>  Ke depan, kami senang mendengar kebutuhan Anda akan fungsionalitas OpenMP yang hilang di Visual Studio.  Karena ada beberapa evolusi besar dalam OpenMP sejak standar 2.0, OpenMP sekarang memiliki fitur luar biasa untuk memudahkan usaha Anda membangun program berkinerja tinggi.  Misalnya, pemrograman konkurensi berbasis tugas tersedia mulai dari OpenMP 3.0.  Komputasi heterogen (CPU + akselerator) didukung dalam OpenMP 4.0.  Vektorisasi SIMD lanjutan dan dukungan paralelisasi loop DOACROSS juga tersedia dalam standar OpenMP terbaru sekarang.  Silakan periksa revisi standar lengkap dan set fitur dari situs web resmi OpenMP: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://www.openmp.org</a> .  Kami dengan tulus meminta pendapat Anda tentang fitur OpenMP spesifik yang ingin Anda lihat.  Kami juga tertarik mendengar tentang bagaimana Anda menggunakan OpenMP untuk mempercepat kode Anda.  Umpan balik Anda sangat penting karena akan membantu mengarahkan arahan dukungan OpenMP di Visual Studio. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/f42/a43/b5a/f42a43b5aa8fbbbee8c5c57453dcf1ed.jpg" alt="Avatar" width="96" height="96"><br><h5>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Hongtao Yu</a> </h5></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id446688/">https://habr.com/ru/post/id446688/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id446674/index.html">Kami memodelkan algoritma MUSIK untuk menentukan arah kedatangan gelombang elektromagnetik</a></li>
<li><a href="../id446676/index.html">Membuat Kunci yang Hilang untuk Commodore 116 Keyboard Karet</a></li>
<li><a href="../id446678/index.html">Pertempuran Langsung: Final ICPC Porto</a></li>
<li><a href="../id446680/index.html">Naluri utama pembuat enkode adalah menghilangkan solusi yang tidak efektif dari mana-mana</a></li>
<li><a href="../id446682/index.html">Mempercepat WebGL / Three.js dengan OffscreenCanvas dan Pekerja Web</a></li>
<li><a href="../id446690/index.html">Electrolux meluncurkan pembersih udara pintar untuk kota-kota yang paling tercemar</a></li>
<li><a href="../id446694/index.html">Penyimpanan modular JBOD dan derajat kebebasan</a></li>
<li><a href="../id446696/index.html">Mitos tentang 152-FZ, yang bisa mahal untuk operator data pribadi</a></li>
<li><a href="../id446700/index.html">Lazydocker - GUI untuk Docker langsung di terminal</a></li>
<li><a href="../id446702/index.html">Dan headphone aneh lainnya - untuk tidur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>