<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçé üë©üèΩ‚Äçü§ù‚Äçüë®üèæ üö∂üèª Comment Dark d√©ploie le code 50 ms üë®üèø‚ÄçüöÄ üëÑ üìò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Plus le processus de d√©veloppement est rapide, plus la soci√©t√© technologique se d√©veloppe rapidement. 


 Malheureusement, les applications modernes f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment Dark d√©ploie le code 50 ms</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/462027/"><p><img src="https://habrastorage.org/webt/o4/lk/bi/o4lkbi449pbpjqw84e0wt-tywlq.png"></p><br><p>  Plus le processus de d√©veloppement est rapide, plus la soci√©t√© technologique se d√©veloppe rapidement. </p><br><p>  Malheureusement, les applications modernes fonctionnent contre nous - nos syst√®mes doivent √™tre mis √† jour en temps r√©el et en m√™me temps pour ne pas interf√©rer avec qui que ce soit et ne pas entra√Æner de temps d'arr√™t et d'interruptions.  Le d√©ploiement dans de tels syst√®mes devient une t√¢che complexe et n√©cessite des pipelines de livraison continue complexes, m√™me dans de petites √©quipes. </p><br><p>  Ces pipelines ont g√©n√©ralement une application √©troite, fonctionnent lentement et ne sont pas fiables.  Les d√©veloppeurs doivent d'abord les cr√©er manuellement, puis les g√©rer, et les entreprises engagent souvent des √©quipes DevOps enti√®res pour cela. </p><br><p>  La vitesse de d√©veloppement d√©pend de la vitesse de ces pipelines.  Pour les meilleures √©quipes, le d√©ploiement prend 5 √† 10 minutes, mais il prend g√©n√©ralement beaucoup plus de temps et pour un d√©ploiement, il prend plusieurs heures. </p><a name="habracut"></a><br><p>  Dans l'obscurit√©, cela prend 50 ms.  <em>Cinquante.</em>  <em>Millisecondes</em>  Dark est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une solution compl√®te avec un langage de programmation, un √©diteur et une infrastructure</a> sp√©cialement con√ßus pour une livraison continue, et tous les aspects de Dark, y compris le langage lui-m√™me, sont construits avec une vue de d√©ploiement instantan√© s√©curis√©. </p><br><h3 id="pochemu-konveyery-nepreryvnoy-postavki-takie-medlennye">  Pourquoi les convoyeurs continus sont-ils si lents? </h3><br><p> Disons que nous avons une application Web Python et que nous avons d√©j√† cr√©√© un pipeline de livraison continue merveilleux et moderne.  Pour un d√©veloppeur qui est quotidiennement occup√© par ce projet, le d√©ploiement d'un changement mineur ressemblera √† ceci: </p><br><h3 id="vnesenie-izmeneniy">  Apporter des changements </h3><br><ul><li>  Cr√©er une nouvelle branche dans git </li><li>  Faire des changements derri√®re le commutateur de fonction </li><li>  Test unitaire pour v√©rifier les changements avec et sans interrupteur de fonction </li></ul><br><h3 id="pul-rekvest">  Demande de piscine </h3><br><ul><li>  Commit commit </li><li>  Publier des modifications dans un r√©f√©rentiel distant sur github </li><li>  Demande de piscine </li><li>  CI se construit automatiquement en arri√®re-plan </li><li>  Examen du code </li><li>  Quelques r√©visions suppl√©mentaires, si n√©cessaire </li><li>  Fusionnez les modifications avec l'assistant git. </li></ul><br><h3 id="ci-vypolnyaetsya-na-mastere">  CI s'ex√©cute sur l'assistant </h3><br><ul><li>  D√©finition des d√©pendances frontales via npm </li><li>  Cr√©ation et optimisation des ressources HTML + CSS + JS </li><li>  Ex√©cuter √† l'extr√©mit√© avant des tests unitaires et fonctionnels </li><li>  Installer les d√©pendances Python depuis PyPI </li><li>  Ex√©cuter dans le backend des tests unitaires et fonctionnels </li><li>  Test d'int√©gration aux deux extr√©mit√©s </li><li>  Envoyer des ressources frontales √† CDN </li><li>  Construire un conteneur pour un programme Python </li><li>  Envoi d'un conteneur au registre </li><li>  Mise √† jour du manifeste Kubernetes </li></ul><br><h3 id="zamena-starogo-koda-novym">  Remplacement de l'ancien code par un nouveau </h3><br><ul><li>  Kubernetes lance plusieurs instances d'un nouveau conteneur </li><li>  Kubernetes attend que les instances deviennent op√©rationnelles </li><li>  Kubernetes ajoute des instances √† l'√©quilibreur de charge HTTP </li><li>  Kubernetes attend que les anciennes instances cessent d'√™tre utilis√©es </li><li>  Kubernetes arr√™te les anciennes instances </li><li>  Kubernetes r√©p√®te ces op√©rations jusqu'√† ce que de nouvelles instances remplacent toutes les anciennes </li></ul><br><h3 id="vklyuchenie-novogo-pereklyuchatelya-funkcii">  Allumez le nouveau commutateur de fonction </h3><br><ul><li>  Le nouveau code est inclus uniquement pour moi, pour m'assurer que tout va bien </li><li>  Un nouveau code est inclus pour 10% des utilisateurs; les mesures op√©rationnelles et commerciales sont suivies </li><li>  Un nouveau code est inclus pour 50% des utilisateurs; les mesures op√©rationnelles et commerciales sont suivies </li><li>  Le nouveau code est inclus pour 100% des utilisateurs, les mesures op√©rationnelles et commerciales sont suivies </li><li>  Enfin, vous r√©p√©tez toute la proc√©dure pour supprimer l'ancien code et basculer </li></ul><br><p>  Le processus d√©pend des outils, du langage et de l'utilisation des architectures orient√©es services, mais en termes g√©n√©raux, il ressemble √† ceci.  Je n'ai pas mentionn√© les d√©ploiements de migration de base de donn√©es car cela n√©cessite une planification minutieuse, mais ci-dessous, je vais d√©crire comment Dark g√®re cela. </p><br><p>  Il existe de nombreux composants ici, et beaucoup d'entre eux peuvent facilement ralentir, planter, provoquer une concurrence temporaire ou faire tomber le syst√®me de travail. </p><br><p>  Et puisque ces pipelines sont presque toujours cr√©√©s pour une occasion sp√©ciale, il est difficile de s'y fier.  Beaucoup de gens ont des jours o√π le code ne peut pas √™tre d√©ploy√©, car il y a des probl√®mes dans le Dockerfile, l'une des dizaines de services en panne ou le bon sp√©cialiste en vacances. </p><br><p>  Pire encore, bon nombre de ces √©tapes ne font rien du tout.  Nous en avions besoin auparavant lorsque nous avons d√©ploy√© le code imm√©diatement pour les utilisateurs, mais nous avons maintenant des commutateurs pour le nouveau code, et ces processus sont divis√©s.  En cons√©quence, l'√©tape √† laquelle le code est d√©ploy√© (l'ancien est remplac√© par le nouveau) est maintenant devenue un risque suppl√©mentaire. </p><br><p>  Bien s√ªr, c'est un pipeline tr√®s r√©fl√©chi.  L'√©quipe qui l'a cr√©√© a pris du temps et de l'argent pour se d√©ployer rapidement.  Les pipelines de d√©ploiement sont g√©n√©ralement beaucoup plus lents et plus peu fiables. </p><br><h3 id="realizaciya-nepreryvnoy-postavki-v-dark">  Impl√©mentation de la livraison continue dans l'obscurit√© </h3><br><p>  La livraison continue est si importante pour Dark que nous visons le temps en moins d'une seconde.  Nous avons parcouru toutes les √©tapes du pipeline pour supprimer tout ce qui n'√©tait pas n√©cessaire et nous avons pens√© au reste.  C'est ainsi que nous avons supprim√© les √©tapes. </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jessie Frazelle a</a> invent√© le nouveau mot sans d√©ploiement lors de la conf√©rence Future of Software Development √† Reykjavik </blockquote><p>  Nous avons imm√©diatement d√©cid√© que Dark serait bas√© sur le concept de ¬´sans d√©ploiement¬ª (merci √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jesse Frazel</a> pour le n√©ologisme).  Sans d√©ploiement signifie que tout code est instantan√©ment d√©ploy√© et pr√™t √† √™tre utilis√© en production.  Bien s√ªr, nous ne manquerons pas un code d√©fectueux ou incomplet (je d√©crirai les principes de s√©curit√© ci-dessous). </p><br><p>  Lors de la d√©monstration Dark, on nous a souvent demand√© comment nous avions r√©ussi √† acc√©l√©rer le d√©ploiement.  √âtrange question.  Les gens pensent probablement que nous avons mis au point une sorte de supertechnologie qui compare le code, le compile, l'emballe dans un conteneur, lance une machine virtuelle, lance un conteneur sur une machine froide et des trucs comme √ßa - et tout cela en 50 ms.  Ce n'est gu√®re possible.  Mais nous avons cr√©√© un moteur de d√©ploiement sp√©cial, qui n'a pas besoin de tout cela. </p><br><p>  Dark lance des interpr√®tes dans le cloud.  Supposons que vous √©criviez du code dans une fonction ou un gestionnaire pour HTTP ou des √©v√©nements.  Nous envoyons diff √† l'arborescence de syntaxe abstraite (l'impl√©mentation du code utilis√© en interne par notre √©diteur et nos serveurs) √† nos serveurs, puis ex√©cutons ce code lorsque les demandes sont re√ßues.  Le d√©ploiement ressemble donc √† un enregistrement modeste dans la base de donn√©es - instantan√© et √©l√©mentaire.  Le d√©ploiement est si rapide car il inclut le strict minimum. </p><br><p>  √Ä l'avenir, nous pr√©voyons de cr√©er un compilateur d'infrastructure √† partir de Dark, qui cr√©era et ex√©cutera l'infrastructure id√©ale pour des performances et une fiabilit√© √©lev√©es des applications.  Le d√©ploiement instantan√©, bien s√ªr, ne va nulle part. </p><br><h2 id="bezopasnoe-razvertyvanie">  D√©ploiement s√©curis√© </h2><br><h3 id="strukturirovannyy-redaktor">  √âditeur structur√© </h3><br><p>  Le code dans Dark est √©crit dans l'√©diteur Dark.  L'√©diteur structur√© ne fait pas d'erreurs de syntaxe.  En fait, Dark n'a m√™me pas d'analyseur.  Au fur et √† mesure que vous tapez, nous travaillons directement avec l'arbre de syntaxe abstraite (AST) comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Paredit</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sketch-n-Sketch</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tofu</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Prune</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MPS</a> . </p><br><p>  Tout code incomplet dans Dark a une s√©mantique d'ex√©cution valide, un peu comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les trous tap√©s dans Hazel</a> .  Par exemple, si vous modifiez un appel de fonction, nous conservons l'ancienne fonction jusqu'√† ce que la nouvelle devienne utilisable. </p><br><p>  Chaque programme dans Dark a sa propre signification, donc le code incomplet n'interf√®re pas avec le travail fini. </p><br><h3 id="rezhimy-redaktirovaniya">  Modes d'√©dition </h3><br><p>  Vous √©crivez du code dans Dark dans deux cas.  Premi√®rement: vous √©crivez un nouveau code et √™tes le seul utilisateur.  Par exemple, il se trouve dans le REPL, et les autres utilisateurs n'y auront jamais acc√®s, ou c'est une nouvelle route HTTP √† laquelle vous ne faites r√©f√©rence nulle part.  Vous pouvez travailler ici sans aucune pr√©caution, et maintenant vous travaillez approximativement dans l'environnement de d√©veloppement. </p><br><p>  Deuxi√®me situation: le code est d√©j√† utilis√©.  Si le trafic passe par le code (fonctions, gestionnaires d'√©v√©nements, bases de donn√©es, type), il faut faire attention.  Pour ce faire, nous bloquons tout le code utilis√© et demandons l'utilisation d'outils plus structur√©s pour le modifier.  Je vais parler des outils structurels ci-dessous: des commutateurs de fonction pour HTTP et les gestionnaires d'√©v√©nements, une puissante plate-forme de migration pour les bases de donn√©es et une nouvelle m√©thode de contr√¥le de version pour les fonctions et les types. </p><br><h3 id="pereklyuchateli-funkciy">  Commutateurs de fonction </h3><br><p>  Une fa√ßon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de supprimer la complexit√© suppl√©mentaire</a> dans Dark est de r√©soudre plusieurs probl√®mes avec une seule solution.  Les commutateurs de fonction effectuent de nombreuses t√¢ches diff√©rentes: remplacement de l'environnement de d√©veloppement local, branches git, d√©ploiement de code et, bien s√ªr, la publication traditionnelle lente et contr√¥l√©e de nouveau code. </p><br><p>  La cr√©ation et le d√©ploiement d'un commutateur de fonction se fait dans notre √©diteur en une seule op√©ration.  Il cr√©e un espace vide pour le nouveau code et fournit des contr√¥les d'acc√®s pour l'ancien et le nouveau code, ainsi que des boutons et des commandes pour une transition progressive vers le nouveau code ou son exclusion. </p><br><p>  Les commutateurs de fonction sont int√©gr√©s dans le langage sombre, et m√™me les commutateurs incomplets accomplissent leur t√¢che - si la condition dans le commutateur n'est pas remplie, l'ancien code bloqu√© sera ex√©cut√©. </p><br><h3 id="sreda-razrabotki">  Environnement de d√©veloppement </h3><br><p>  Les commutateurs de fonction remplacent l'environnement de d√©veloppement local.  Aujourd'hui, il est difficile pour les √©quipes de s'assurer que tout le monde utilise les m√™mes versions d'outils et de biblioth√®ques (formateurs de code, linters, gestionnaires de packages, compilateurs, pr√©processeurs, outils de test, etc.) Avec Dark, vous n'avez pas besoin d'installer les d√©pendances localement, de contr√¥ler l'installation locale de Docker ou prendre d'autres mesures pour assurer au moins un semblant d'√©galit√© entre l'environnement de d√©veloppement et la production.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âtant donn√© qu'une telle √©galit√© est encore impossible</a> , nous ne pr√©tendrons m√™me pas que nous nous y effor√ßons. </p><br><p>  Au lieu de cr√©er un environnement local clon√©, les commutateurs dans Dark cr√©ent un nouveau sandbox en production qui remplace l'environnement de d√©veloppement.  √Ä l'avenir, nous pr√©voyons √©galement de cr√©er un sandbox pour d'autres parties de l'application (par exemple, les clones de bases de donn√©es instantan√©es), bien que cela ne semble pas si important pour l'instant. </p><br><h3 id="vetki-i-razvertyvaniya">  Succursales et d√©ploiements </h3><br><p>  Il existe maintenant plusieurs fa√ßons d'entrer un nouveau code dans les syst√®mes: les branches git, la phase de d√©ploiement et les commutateurs de fonction.  Ils r√©solvent un probl√®me dans diff√©rentes parties du flux de travail: git - aux √©tapes avant le d√©ploiement, d√©ploiement - au moment de la transition de l'ancien code au nouveau, et commutateurs de fonction - pour la lib√©ration contr√¥l√©e du nouveau code. </p><br><p>  Le moyen le plus efficace est les commutateurs de fonction (en m√™me temps les plus faciles √† comprendre et √† utiliser).  Avec eux, vous pouvez abandonner compl√®tement les deux autres m√©thodes.  Il est particuli√®rement utile de supprimer le d√©ploiement - si nous utilisons de toute fa√ßon des commutateurs de fonction pour inclure le code, l'√©tape de transfert des serveurs vers le nouveau code ne cr√©e que des risques inutiles. </p><br><p>  Git est difficile √† utiliser, surtout pour les d√©butants, et il le limite vraiment, mais il a des branches pratiques.  Nous avons corrig√© de nombreux d√©fauts de git.  Dark est √©dit√© en temps r√©el et offre la possibilit√© de travailler ensemble dans le style de Google Docs, afin que vous n'ayez pas √† envoyer de code et que vous puissiez moins souvent effectuer une relocalisation et une fusion. </p><br><p>  Les commutateurs de fonctionnalit√©s sous-tendent le d√©ploiement s√©curis√©.  Associ√©s √† des d√©ploiements instantan√©s, ils vous permettent de tester rapidement des concepts en petits fragments √† faible risque, au lieu d'appliquer un changement majeur susceptible de faire tomber le syst√®me. </p><br><h3 id="versionirovanie">  Versioning </h3><br><p>  Pour changer les fonctions et les types, nous utilisons le versioning.  Si vous souhaitez modifier une fonction, Dark cr√©e une nouvelle version de cette fonction.  Ensuite, vous pouvez appeler cette version √† l'aide du commutateur dans le gestionnaire HTTP ou d'√©v√©nements.  (Si cette fonction est profond√©ment dans le graphique d'appel, une nouvelle version de chaque fonction est cr√©√©e dans le processus. Cela peut sembler trop, mais les fonctions n'interf√®rent pas si vous ne les utilisez pas, donc vous ne le remarquerez m√™me pas.) </p><br><p>  Pour les m√™mes raisons, nous proposons des types de version.  Nous avons parl√© de notre syst√®me de type en d√©tail <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans un pr√©c√©dent post</a> . </p><br><p>  En fonction des versions et des types de versions, vous pouvez modifier progressivement l'application.  Vous pouvez v√©rifier que chaque gestionnaire individuel fonctionne avec la nouvelle version, vous n'avez pas besoin d'apporter imm√©diatement toutes les modifications aux applications (mais nous avons des outils pour le faire rapidement si vous le souhaitez). </p><br><p>  C'est beaucoup plus s√ªr que de d√©ployer tout en une seule fois, comme c'est le cas actuellement. </p><br><h3 id="novye-versii-paketov-i-standartnaya-biblioteka">  Nouvelles versions de packages et biblioth√®que standard </h3><br><p>  Lorsque vous mettez √† jour un package dans Dark, nous ne rempla√ßons pas imm√©diatement l'utilisation de chaque fonction ou type dans la base de code enti√®re.  Ce n'est pas s√ªr.  Le code continue d'utiliser la m√™me version qu'il a utilis√© et vous mettez √† jour l'utilisation des fonctions et des types vers une nouvelle version pour chaque cas individuel √† l'aide des commutateurs. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/rh/t3/4w/rht34wyibolrgracbz88tnqqhg0.png"></a> <br>  <em>Une capture d'√©cran d'une partie d'un processus automatique dans Dark montrant deux versions de la fonction Dict :: get.</em>  <em>Dict :: get_v0 a renvoy√© le type Any (ce que nous refusons) et Dict :: get_v1 a renvoy√© le type Option.</em> </p><br><p>  Nous fournissons souvent une nouvelle fonctionnalit√© dans la biblioth√®que standard et excluons les anciennes versions.  Les utilisateurs ayant d'anciennes versions dans le code y conserveront l'acc√®s, mais les nouveaux utilisateurs ne pourront pas les obtenir.  Nous allons fournir des outils pour transf√©rer les utilisateurs des anciennes versions vers les nouvelles en 1 √©tape, et √† nouveau en utilisant des commutateurs de fonction. </p><br><p>  Dark offre √©galement une opportunit√© unique: une fois que nous avons ex√©cut√© votre code de travail, nous pouvons tester les nouvelles versions nous-m√™mes, en comparant la sortie des nouvelles et anciennes demandes pour vous informer des changements.  Par cons√©quent, les mises √† jour de packages, qui sont souvent effectu√©es √† l'aveugle (ou n√©cessitent des tests de s√©curit√© rigoureux), posent beaucoup moins de risques et peuvent se produire automatiquement. </p><br><h3 id="novye-versii-dark">  Nouvelles versions sombres </h3><br><p>  La transition de Python 2 √† Python 3 s'est √©tal√©e sur une d√©cennie et reste toujours un probl√®me.  Une fois que nous avons cr√©√© Dark pour une livraison continue, ces changements de langue doivent √™tre pris en compte. </p><br><p>  Lorsque nous apportons de petites modifications √† la langue, nous cr√©ons une nouvelle version de Dark.  L'ancien code reste dans l'ancienne version de Dark et le nouveau code est utilis√© dans la nouvelle version.  Pour passer √† la nouvelle version de Dark, vous pouvez utiliser les commutateurs ou versions de fonctions. </p><br><p>  Ceci est particuli√®rement utile √©tant donn√© que Dark est apparu r√©cemment.  De nombreuses modifications apport√©es √† la langue ou √† la biblioth√®que peuvent √©chouer.  La version progressive de la langue nous permet de faire des mises √† jour mineures, c'est-√†-dire que nous ne pouvons pas nous pr√©cipiter et reporter de nombreuses d√©cisions sur la langue jusqu'√† ce que nous ayons plus d'utilisateurs, et donc plus d'informations. </p><br><h3 id="migracii-baz-dannyh">  Migrations de bases de donn√©es </h3><br><p>  Il existe une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">formule standard</a> pour une migration s√©curis√©e des bases de donn√©es: </p><br><ul><li>  R√©√©crire le code pour prendre en charge les nouveaux et les anciens formats </li><li>  Convertissez toutes les donn√©es dans un nouveau format </li><li>  Supprimer l'ancien acc√®s aux donn√©es </li></ul><br><p>  Par cons√©quent, la migration de la base de donn√©es est retard√©e et n√©cessite beaucoup de ressources.  Et nous accumulons des sch√©mas obsol√®tes, car m√™me des t√¢ches simples, telles que la correction du nom d'une table ou d'une colonne, ne valent pas la peine. </p><br><p>  Dark a une plateforme de migration de base de donn√©es efficace qui (nous l'esp√©rons) simplifiera tellement le processus que vous n'en aurez plus peur.  Tous les magasins de donn√©es dans Dark (paires cl√©-valeur ou tables de hachage persistantes) sont de type.  Pour migrer un entrep√¥t de donn√©es, il vous suffit de lui affecter un nouveau type et une fonction de restauration et de restauration pour convertir les valeurs entre les deux types. </p><br><p>  L'acc√®s aux entrep√¥ts de donn√©es dans Dark se fait via des noms de variable versionn√©s.  Par exemple, le magasin de donn√©es des utilisateurs s'appellerait initialement Users-v0.  Lorsqu'une nouvelle version avec un type diff√©rent est cr√©√©e, le nom change en Users-v1.  Si les donn√©es sont enregistr√©es via Users-v0 et que vous y acc√©dez via Users-v1, la fonction de substitution est appliqu√©e.  Si les donn√©es sont enregistr√©es via Users-v1 et que vous y acc√©dez via Users-v0, la fonction de restauration est utilis√©e. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ui/sl/wd/uislwdrfrvact0d1ts5icnk-4ka.png"></a> <br>  <em>√âcran de migration de la base de donn√©es avec des noms de champs pour l'ancienne base de donn√©es, des expressions de restauration et de restauration, et des instructions pour activer la migration.</em> </p><br><p>  Utilisez les commutateurs de fonction pour router les appels vers Users-v0 vers Users-v1.  Vous pouvez effectuer ce gestionnaire HTTP √† la fois pour r√©duire les risques, et les commutateurs fonctionnent √©galement pour les utilisateurs individuels afin que vous puissiez v√©rifier que tout fonctionne comme pr√©vu.  Lorsque Users-v0 n'est pas laiss√©, Dark convertit toutes les donn√©es restantes en arri√®re-plan de l'ancien format vers le nouveau.  Vous ne le remarquerez m√™me pas. </p><br><h3 id="testirovanie">  Test </h3><br><p>  Dark est un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">langage de programmation fonctionnel avec un typage statique</a> et des valeurs immuables; par cons√©quent, sa surface de test est nettement plus petite que les langages orient√©s objet avec un typage dynamique.  Mais vous devez toujours tester. <br>  Dans Dark, l'√©diteur ex√©cute automatiquement des tests unitaires en arri√®re-plan pour le code modifiable et, par d√©faut, ex√©cute ces tests pour tous les commutateurs de fonction.  √Ä l'avenir, nous voulons utiliser les types statiques pour flouer automatiquement le code pour trouver des bogues. </p><br><p>  De plus, Dark g√®re votre infrastructure en production, ce qui ouvre de nouvelles possibilit√©s.  Nous enregistrons automatiquement les requ√™tes HTTP dans l'infrastructure Dark (pour l'instant, nous enregistrons toutes les requ√™tes, mais nous voulons ensuite passer √† la r√©cup√©ration).  Nous testons de nouveaux codes sur eux et effectuons des tests unitaires, et si vous le souhaitez, vous pouvez facilement convertir des requ√™tes int√©ressantes en tests unitaires. </p><br><h3 id="ot-chego-my-izbavilis">  Ce dont nous nous sommes d√©barrass√©s </h3><br><p>  Comme nous n'avons pas de d√©ploiement, mais qu'il existe des commutateurs de fonction, environ 60% du pipeline de d√©ploiement reste √† la mer.  Nous n'avons pas besoin de branches git ou de demandes de pool, de la cr√©ation de ressources et de conteneurs backend, de l'envoi de ressources et de conteneurs aux registres ou aux √©tapes de d√©ploiement dans Kubernetes. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/gc/9e/g-/gc9eg-szouq0dtrxxr8jd6c6dyo.jpeg"></a> <br>  <em>Comparaison du pipeline de livraison continue standard (√† gauche) et de l'approvisionnement continu de Dark (√† droite).</em>  <em>Dans Dark, la livraison se compose de 6 √©tapes et d'un cycle, tandis que la version traditionnelle comprend 35 √©tapes et 3 cycles.</em> </p><br><p>  Dans Dark, il n'y a que 6 √©tapes et 1 cycle dans le d√©ploiement (√©tapes r√©p√©t√©es plusieurs fois), tandis que le pipeline d'approvisionnement continu moderne comprend 35 √©tapes et 3 cycles.  Dans Dark, les tests s'ex√©cutent automatiquement et vous ne le voyez m√™me pas;  les d√©pendances sont install√©es automatiquement;  tout ce qui concerne git ou github n'est plus n√©cessaire;  Il n'est pas n√©cessaire de collecter, tester et envoyer des conteneurs Docker;  Le d√©ploiement de Kubernetes n'est plus n√©cessaire. </p><br><p>  M√™me les √©tapes restantes dans Dark sont devenues plus faciles.  √âtant donn√© que les commutateurs de fonction peuvent √™tre contr√¥l√©s en une seule action, vous n'avez pas √† parcourir l'int√©gralit√© du pipeline de d√©ploiement une deuxi√®me fois pour supprimer l'ancien code. </p><br><p>  Nous avons simplifi√© la livraison du code autant que possible, r√©duisant le temps et les risques de livraison continue.  Nous avons √©galement consid√©rablement simplifi√© les mises √† jour des packages, les migrations de bases de donn√©es, les tests, le contr√¥le de version, l'installation des d√©pendances, l'√©galit√© entre l'environnement de d√©veloppement et la production, et les mises √† niveau rapides et s√ªres des versions linguistiques. </p><br><p>  Je r√©ponds aux questions √† ce sujet sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HackerNews</a> . </p><br><p>  Pour en savoir plus sur l'appareil Dark, lisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'article Dark</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">suivez-nous sur Twitter</a> (ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">moi</a> ), ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">inscrivez-vous pour une version b√™ta et recevez des notifications des articles suivants</a> .  Si vous venez √† StrangeLoop en septembre, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">venez √† notre lancement</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr462027/">https://habr.com/ru/post/fr462027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr462013/index.html">Historique des probl√®mes de migration du stockage Docker (racine Docker)</a></li>
<li><a href="../fr462015/index.html">Univers de reporting SAP</a></li>
<li><a href="../fr462021/index.html">Comment arr√™ter de faire la m√™me chose</a></li>
<li><a href="../fr462023/index.html">Cascadeur: L'avenir de l'animation de jeux</a></li>
<li><a href="../fr462025/index.html">Mod√®le de donn√©es de r√©seau relationnel</a></li>
<li><a href="../fr462029/index.html">19 fonctionnalit√©s utiles du fichier .htaccess</a></li>
<li><a href="../fr462031/index.html">Comme si vous lisiez les journaux!: Lancez Hotspot 2.0 sur le r√©seau Wi-Fi du m√©tro</a></li>
<li><a href="../fr462033/index.html">La derni√®re c√®ne des d√©veloppeurs</a></li>
<li><a href="../fr462035/index.html">Python Vs R - Science des donn√©es</a></li>
<li><a href="../fr462041/index.html">Approches de segmentation mobile - Traduction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>