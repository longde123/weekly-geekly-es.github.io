<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ñ∂Ô∏è üë®üèΩ‚Äçüî¨ ‚úñÔ∏è Eu, RoboLoyer, ou como procurar anomalias nos documentos üññ ü¶î üöæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voc√™ pode imaginar quantos documentos regulat√≥rios por hora um advogado corporativo deve examinar e quais consequ√™ncias o descuido dele pode levar? Um...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eu, RoboLoyer, ou como procurar anomalias nos documentos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/digdes/blog/419837/">  Voc√™ pode imaginar quantos documentos regulat√≥rios por hora um advogado corporativo deve examinar e quais consequ√™ncias o descuido dele pode levar?  Um colega pobre advogado deve ler todos os contratos, especialmente se n√£o houver um modelo padr√£o para ele, o que acontece com frequ√™ncia. <br><br>  Olhando nos olhos cansados ‚Äã‚Äãde nosso advogado corporativo, decidimos criar um servi√ßo que encontrar√° problemas nos documentos e os sinalizar√° ao advogado cochilando.  Como resultado, criamos uma solu√ß√£o com a agrega√ß√£o de conhecimento em uma certa base de contratos e dicas para advogados, que deve receber aten√ß√£o especial.  Claro, n√£o sem m√°gica.  Magia matem√°tica chamada Anomaly Detection. <br><br>  Basicamente, as abordagens de detec√ß√£o de anomalias s√£o usadas para analisar o comportamento de uma variedade de equipamentos para detectar falhas ou no setor banc√°rio para determinar fraudes.  E tentamos aplicar esses algoritmos para a an√°lise de documentos legais.  Siga o corte para descobrir como fizemos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/31/gl/sl/31glslalfw7bbz4avc_vxy-yjro.jpeg"></div><a name="habracut"></a><br><h3>  1. Lidamos com informa√ß√µes estruturadas </h3><br>  Temos sorte porque  Os textos dos contratos s√£o suficientemente estruturados, secos e compilados de acordo com determinados modelos.  Para trabalhar no projeto, foi proposta a id√©ia de implementar um prot√≥tipo baseado em contratos e contratos do site zakupki.gov.ru (recebemos 200.000 documentos).  Em 170.000 contratos, conseguimos identificar a estrutura: pre√¢mbulo, cap√≠tulos, par√°grafos e anexos do contrato, levando em considera√ß√£o as palavras-chave, posi√ß√£o no texto e numera√ß√£o. <br><br>
<h3>  2. V√°rios tipos de contratos </h3><br>  √â necess√°rio levar em considera√ß√£o o fato de que os contratos podem ser de tipos diferentes.  Todos eles diferem muito em conte√∫do, assunto do contrato, cap√≠tulos principais, etc. Para otimizar a an√°lise de cada tipo de contrato, √© necess√°rio realizar trabalhos sobre sua classifica√ß√£o ou agrupamento. <br>  Talvez voc√™ j√° saiba quais tipos de contratos est√£o presentes no seu banco de dados e saiba os sinais pelos quais eles podem ser determinados.  No nosso caso, temos um corpo bruto de contratos sem informa√ß√µes adicionais sobre cada contrato e sem nenhuma premissa sobre a classifica√ß√£o dos contratos de aquisi√ß√£o.  Portanto, fomos for√ßados a recorrer ao agrupamento de nossa base de contratos. <br><br>  Voc√™ pode padronizar o cluster usando o vetor de apresenta√ß√£o de documento tf-idf, mas decidimos tentar o algoritmo Doc2Vec, apenas por divers√£o.  Usando o algoritmo Doc2Vec, os contratos foram convertidos em vetores e os vetores de contrato resultantes foram enviados para a entrada do algoritmo de agrupamento.  Utilizamos o algoritmo K-means para agrupar vetores.  Como a similaridade √© geralmente medida usando a dist√¢ncia do cosseno, usamos em vez da dist√¢ncia euclidiana. <br><br>  Depois de receber 20 grupos de documentos, era necess√°rio verificar a qualidade do cluster.  Como n√£o temos nenhuma classifica√ß√£o de contratos, n√£o podemos comparar os clusters resultantes com a parti√ß√£o existente.  Ent√£o decidimos olhar para as palavras que descrevem o cluster.  Para fazer isso, pegamos os itens "Assunto do Contrato" para cada cluster, removemos palavras de parada, n√∫meros e palavras encontradas na maioria dos clusters.  Em seguida, selecionamos as 5 palavras mais comuns para cada cluster como palavras-chave.  De maneira t√£o direta, pode-se avaliar subjetivamente a qualidade do agrupamento. <br><br>  Exemplos de palavras que descrevem clusters: <br><br><ul><li>  inquilino, propriet√°rio, apartamento, aluguel, desenvolvedor </li><li>  compet√™ncia, ensino, educacional, acad√™mico, em per√≠odo integral </li><li>  empreiteiro geral, subempreiteiro, constru√ß√£o geral, designer, planejamento urbano </li><li>  farm√°cia, quarentena, despesa, fitossanit√°ria, herm√©tica </li><li>  detetive, seguran√ßa, supress√£o, ansiedade, ofensa </li><li>  licenciado, sublicenciado, filme, licenciante, retransmiss√£o </li><li>  mutu√°rio, compromisso, credor, empr√©stimo, promotor </li><li>  centralizado, fornecimento de energia, intrazona, encanamento, esgoto </li></ul><br><h3>  3. Que anomalias podemos encontrar nos contratos </h3><br>  Vamos determinar quais casos consideraremos anormais e o que podemos fazer com eles.  Identificamos os seguintes cen√°rios: <br><br><ol><li>  Uma cl√°usula extra foi adicionada ao contrato que nunca havia sido vista neste contexto antes.  √â necess√°rio chamar a aten√ß√£o de um advogado para ele. </li><li>  N√£o h√° cl√°usula no contrato que foi encontrada anteriormente em tais contratos.  Devemos aconselhar o advogado a adicion√°-lo. </li><li>  Um par√°grafo √© semelhante a algum ponto da hist√≥ria, mas, de alguma forma, √© reformulado, algumas palavras s√£o adicionadas ou exclu√≠das.  Voc√™ pode informar o advogado e aconselh√°-lo a editar. </li></ol><br><h3>  4. De que forma enviar contratos </h3><br>  Como j√° mencionado, o contrato consiste em cap√≠tulos, os cap√≠tulos s√£o divididos em par√°grafos, cada par√°grafo pode conter par√°grafos, etc.  Para dividir o contrato em cap√≠tulos e par√°grafos, levamos em conta a numera√ß√£o, as transfer√™ncias, as palavras-chave: ‚ÄúCap√≠tulo‚Äù, ‚ÄúArtigo‚Äù etc.  Cada item consiste em uma ou mais frases.  Para dividir um item em frases, foi usado o sent_tokenize do m√≥dulo nltk.tokenize. <br><br>  O contrato em si cont√©m v√°rios cap√≠tulos globais, cuja ess√™ncia e conte√∫do podem ser encontrados pelos t√≠tulos: o assunto do contrato, os direitos e as obriga√ß√µes das partes, o pre√ßo e o procedimento de liquida√ß√£o ... Tentamos combinar os cap√≠tulos com os mesmos t√≠tulos e trabalhar com diferentes cap√≠tulos independentemente.  Os t√≠tulos dos cap√≠tulos s√£o frequentemente reformulados, t√™m erros de digita√ß√£o ou sinais de pontua√ß√£o extras.  Para aumentar o tamanho dos grupos de cap√≠tulos, combinamos os t√≠tulos pr√≥ximos √† dist√¢ncia de Levenshtein em um grupo. <br><br>  Um dos problemas que podemos encontrar definitivamente √© o enorme volume de entidades nomeadas em contratos, que geralmente s√£o √∫nicos e podem ser confundidos com uma anomalia.  Existem muitas entidades nos contratos, como nomes, nomes de empresas, datas, endere√ßos etc., que variam de contrato para contrato.  √â necess√°rio encontrar e eliminar essas entidades do contrato, ou seja,  traga o contrato para algum formul√°rio de modelo.  Tivemos sorte com o conjunto de dados, porque  no descarregamento de contratos, havia uma grande propor√ß√£o de contratos-modelo, denominados entidades nos quais s√£o substitu√≠dos por sublinhados.  Identificamos entre quais sublinhados de frases geralmente ocorrem para encontrar essas frases em documentos completos e remover delas as entidades nomeadas.  √â claro que dessa maneira n√£o exclu√≠mos todas as entidades nomeadas.  Portanto, mais uma vez percorremos o casco com a biblioteca Natasha e exclu√≠mos as entidades que ela encontrou. <br><br><h3>  5. Defini√ß√£o de cl√°usulas anormais no contrato </h3><br>  J√° conseguimos separar os contratos por tipo usando clustering e conseguimos identificar grupos de cap√≠tulos semelhantes.  Agora, usando o conhecimento acumulado sobre uma determinada cl√°usula de um determinado tipo de contrato, podemos entender o que precisa ser corrigido no atual.  Vamos calcular a probabilidade de sua anomalia para cada senten√ßa do cap√≠tulo. <br><br>  Para cada grupo de cap√≠tulos, armazenamos todas as ofertas que encontramos em nosso conjunto de documentos de treinamento das compras do Estado.  Porque  existem muitos deles, para cada grupo de cap√≠tulos o modelo Word2Vec foi treinado e cada senten√ßa est√° associada a um vetor de soma ponderada (por tf-idf) dos vetores das palavras inclu√≠das nele.  Al√©m disso, os vetores de frases foram divididos em grupos de maneira semelhante √† divis√£o de vetores para documentos. <br><br>  Agora, quando uma proposta nos chega, determinamos de qual cluster de contratos √©, de qual grupo de cap√≠tulos, de qual cluster de propostas est√° mais pr√≥ximo e nesse cluster encontramos o mais pr√≥ximo.  A dist√¢ncia para a oferta mais pr√≥xima pode ser considerada como uma medida de qu√£o anormal √© essa oferta.  Se a dist√¢ncia at√© a oferta mais pr√≥xima for zero, nossa oferta n√£o ser√° anormal.  Com o aumento dessa dist√¢ncia, duvidamos cada vez mais que a proposta n√£o contenha anomalias.  Provavelmente algo est√° errado com ele. <br><br><h3>  6. O que fazer com os itens que est√£o faltando </h3><br>  N√≥s descobrimos como encontrar pontos an√¥malos no contrato, mas n√£o aprendemos como encontrar anomalias na forma de senten√ßas ou pontos ausentes.  Essa anomalia pode ser facilmente encontrada se tivermos em m√£os um modelo para esse tipo de contrato, mas, por exemplo, h√° momentos em que outra empresa nos enviou um contrato elaborado de acordo com nosso pr√≥prio modelo. <br>  Para detectar tais anomalias, precisamos criar um modelo para o contrato com um conjunto de ofertas / cl√°usulas obrigat√≥rias, novamente com base apenas na base de nossos contratos. <br><br>  Criamos e testamos o algoritmo para a constru√ß√£o do modelo.  Esse algoritmo sup√µe que em nosso banco de dados de contratos exista um cap√≠tulo semelhante com o conjunto correto de itens, que queremos identificar e indicar como modelo. <br><br>  Algoritmo: <br><img src="https://habrastorage.org/webt/8q/35/xn/8q35xnsqxvbts0bmro19vjegnji.png"><br><br><ol><li>  Para cada grupo de cap√≠tulos, pr√©-treine um modelo baseado no algoritmo MinHashLSH, que permite localizar rapidamente textos pr√≥ximos. </li><li>  Para cada cap√≠tulo do contrato baixado, encontre uma lista de par√°grafos pr√≥ximos a ele no banco de dados. </li><li>  Com base nos par√°grafos pr√≥ximos obtidos, construa um modelo de linguagem e selecione como um par√°grafo de modelo com a maior probabilidade prevista pelo modelo de linguagem. </li></ol><br>  Depois de receber um modelo para cada cap√≠tulo, podemos identificar os itens ausentes que est√£o presentes no modelo, mas n√£o est√£o no contrato atual, e aconselhamos o advogado a adicion√°-los. <br><br><h3>  7. Pipeline completo </h3><br>  Para resumir e coletar todas as etapas juntas: <br><br><div class="spoiler">  <b class="spoiler_title">I. Coleta, processamento e armazenamento do corpo de contratos</b> <div class="spoiler_text">  A. Monte o corpo dos contratos do modelo. <br>  B. Classificar / agrupar contratos por tipo. <br>  C. Divida o contrato em cap√≠tulos, par√°grafos e frases. <br>  D. Remova as entidades nomeadas dos contratos. <br>  E. Agrupe os cap√≠tulos por seus t√≠tulos. <br>  F. Para cada grupo de cap√≠tulos, treine o Word2Vec. <br>  G. Combine cada senten√ßa com o vetor da soma ponderada dos vetores das palavras inclu√≠das nela. <br>  H. Agrupe os vetores de senten√ßa recebidos e armazene cada cluster separadamente para procurar rapidamente o vetor mais pr√≥ximo no cluster mais pr√≥ximo. <br>  I. Para cada grupo de cap√≠tulos, treine MinHashLSH. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">II. Procure anomalias em um novo documento</b> <div class="spoiler_text">  <u>A. Destacando pontos anormais</u> <br>  1. Defina o tipo de contrato (classe ou cluster) <br>  2. Divida o documento em cap√≠tulos, par√°grafos e frases <br>  3. Para cada cap√≠tulo, encontre o grupo correspondente de cap√≠tulos no banco de dados <br>  4. Combine cada frase com um vetor <br>  5. Encontre para cada oferta do contrato o conjunto de ofertas mais pr√≥ximo e nele a oferta mais pr√≥xima <br>  6. Calcule as dist√¢ncias entre os vetores da proposta e pinte as frases com base nas dist√¢ncias obtidas. <br>  7. Pinte apenas partes das frases, se, com as mais pr√≥ximas, diferirem em poucas palavras. <br>  8. Aconselhe a edi√ß√£o na forma da pr√≥xima frase. <br>  <u>B. Procure por itens ausentes</u> <br>  1. Para cada cap√≠tulo, crie um modelo <br>  2. Aconselhe para adicionar os itens ausentes do modelo <br></div></div><br><h3>  8. Avalia√ß√£o da qualidade </h3><br>  Para avaliar a qualidade das solu√ß√µes para o problema, um conjunto de testes de contratos foi formado.  Anomalias foram adicionadas artificialmente aos contratos na forma de excluir parte de palavras, inserir palavras / frases em frases, inserir frases de outros cap√≠tulos, excluir frases.  Avaliamos a qualidade de cada tipo de anomalia e obtivemos a seguinte distribui√ß√£o de erros de determina√ß√£o: <br> <a href=""><img src="https://habrastorage.org/webt/yc/ui/qc/ycuiqcieu9q55hh_bq5v5wquvqu.png"></a> <a href=""><img src="https://habrastorage.org/webt/vm/p-/iv/vmp-ivtswrpjwkqlqoluzzw1bqu.png"></a> <br><br>  Ou seja, o algoritmo proposto nos permite determinar inclus√µes incorretas em 4 de 5 casos.  Note-se que, com o aumento do volume da amostra de treinamento e o agrupamento de contratos para diferentes tipos, podemos obter uma melhoria nessa avalia√ß√£o. <br><br><h3>  9. Visualiza√ß√£o </h3><br>  Para visualizar essa solu√ß√£o para o problema, foi implementada uma interface da Web na qual um novo contrato pode ser carregado, cujo texto ser√° exibido na p√°gina e as ofertas anormais ser√£o destacadas.  Quanto mais escura a cor da frase, mais forte temos a certeza de que √© an√¥mala.  Porque  encontramos a oferta mais pr√≥xima, recomendamos a edi√ß√£o para o usu√°rio na forma da pr√≥xima oferta ou recomendamos alterar a parte espec√≠fica da oferta se a pr√≥xima tiver uma pequena diferen√ßa com o original. <br><br><img src="https://habrastorage.org/webt/t3/3j/lw/t33jlwllhryjaptkeqv_aqkm4xy.gif"><br><br><h3>  10. Onde aplic√°vel? </h3><br>  A aplica√ß√£o pr√°tica do servi√ßo resultante √© mais apropriada nos casos em que √© necess√°rio um exame "fluxo" da pureza legal de um grande n√∫mero de documentos do mesmo tipo: por exemplo, ao emitir empr√©stimos colaterais ao p√∫blico (hipotecas, empr√©stimos para autom√≥veis e seguros).  Por exemplo, no caso de uma hipoteca, trata-se de contratos de venda de im√≥veis, contratos de seguros imobili√°rios e de mutu√°rios, contratos de avalia√ß√£o de propriedades, etc.  - centenas de p√°ginas de texto nos dossi√™s de cada cliente, que podem ser analisadas quase instantaneamente, e locais anormais ser√£o "destacados" ao advogado para an√°lise de riscos ou fraudes. <br><br>  Portanto, advogados de carne e osso n√£o podem prescindir completamente, mas as tecnologias modernas permitem que eles facilitem a vida. <br><br>  Material preparado por Elena Sannikova ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">helen_sunny</a> ). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt419837/">https://habr.com/ru/post/pt419837/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt419825/index.html">Testando o desempenho de v√°rios tipos de unidades em um ambiente virtual</a></li>
<li><a href="../pt419829/index.html">A criptografia de chave padr√£o do OpenSSH √© pior que nenhuma</a></li>
<li><a href="../pt419831/index.html">Como o JS funciona: elementos personalizados</a></li>
<li><a href="../pt419833/index.html">Trabalho remoto, como funciona</a></li>
<li><a href="../pt419835/index.html">Como motivar autores, negociar com especialistas e geralmente escrever bons artigos</a></li>
<li><a href="../pt419839/index.html">Hacking ATM de baixo n√≠vel da NCR</a></li>
<li><a href="../pt419843/index.html">GeekUniversity abre inscri√ß√µes na Faculdade de Intelig√™ncia Artificial</a></li>
<li><a href="../pt419845/index.html">Vers√£o 0.4.9: Implica√ß√µes</a></li>
<li><a href="../pt419847/index.html">De 0,01 TFlops HPL a ASC'18 Application Innovation</a></li>
<li><a href="../pt419849/index.html">Investiga√ß√£o da placa-m√£e: como os cibercriminosos roubam n√∫meros de celular com a ajuda de empresas de telecomunica√ß√µes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>