<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¥üèº üôåüèø üîö Replicaci√≥n cruzada entre PostgreSQL y MySQL üåû üë©‚Äçüé® üå≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Describir√© la replicaci√≥n cruzada entre PostgreSQL y MySQL, as√≠ como los m√©todos para configurar la replicaci√≥n cruzada entre estos dos servidores de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Replicaci√≥n cruzada entre PostgreSQL y MySQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/467313/"><p><img src="https://habrastorage.org/webt/ze/m9/h6/zem9h6cpvow7junwu4saxpddvpa.jpeg"></p><br><p>  Describir√© la replicaci√≥n cruzada entre PostgreSQL y MySQL, as√≠ como los m√©todos para configurar la replicaci√≥n cruzada entre estos dos servidores de bases de datos.  Por lo general, las bases de datos de replicaci√≥n cruzada se denominan homog√©neas, y este es un m√©todo conveniente para pasar de un servidor de base de datos relacional a otro. </p><br><p>  Las bases de datos PostgreSQL y MySQL se consideran relacionales, pero con extensiones adicionales ofrecen funciones NoSQL.  Aqu√≠ discutiremos la replicaci√≥n entre PostgreSQL y MySQL, en t√©rminos de DBMS relacional. </p><br><p>  No describiremos toda la cocina interior, solo los principios b√°sicos, para que tenga una idea de c√≥mo configurar la replicaci√≥n entre servidores de bases de datos, las ventajas, limitaciones y escenarios de uso. </p><a name="habracut"></a><br><p>  Por lo general, la replicaci√≥n entre dos servidores de bases de datos id√©nticos se realiza en modo binario o mediante solicitudes entre el nodo maestro (es el editor, maestro o activo) y el esclavo (suscriptor, pendiente o pasivo).  El prop√≥sito de la replicaci√≥n es proporcionar una copia en tiempo real de la base de datos maestra en el lado esclavo.  En este caso, los datos se transfieren del maestro al esclavo, es decir, de activo a pasivo, porque la replicaci√≥n se realiza solo en una direcci√≥n.  Pero puede configurar la replicaci√≥n entre dos bases de datos en ambas direcciones, de modo que los datos se transfieran del esclavo al maestro en la configuraci√≥n activo-activo.  Todo esto, incluida la replicaci√≥n en cascada, posiblemente entre dos o m√°s servidores de bases de datos id√©nticos. La configuraci√≥n activo-activo o activo-pasivo depende de la necesidad, la disponibilidad de tales caracter√≠sticas en la configuraci√≥n inicial o el uso de soluciones de configuraci√≥n externas y compensaciones existentes. . </p><br><p> La configuraci√≥n descrita es posible entre diferentes servidores de bases de datos.  El servidor se puede configurar para recibir datos replicados de otro servidor de bases de datos y a√∫n as√≠ guardar instant√°neas en tiempo real de los datos replicados.  MySQL y PostgreSQL ofrecen la mayor√≠a de estas configuraciones por s√≠ mismas o con extensiones de terceros, incluidos los m√©todos de registro binario, bloqueos de disco y m√©todos basados ‚Äã‚Äãen sentencias y cadenas. </p><br><p>  La replicaci√≥n cruzada entre MySQL y PostgreSQL es necesaria para una √∫nica migraci√≥n de un servidor de base de datos a otro.  Estas bases de datos utilizan diferentes protocolos, por lo que no pueden conectarse directamente.  Para establecer el intercambio de datos, puede usar una herramienta externa de c√≥digo abierto, por ejemplo pg_chameleon. </p><br><h3 id="chto-takoe-pg_chameleon">  ¬øQu√© es pg_chameleon? </h3><br><p>  pg_chameleon es un sistema de replicaci√≥n de MySQL a PostgreSQL en Python 3. Utiliza la biblioteca de c√≥digo abierto mysql-replication, tambi√©n en Python.  Las im√°genes de cadena se extraen de las tablas MySQL y se almacenan como objetos JSONB en la base de datos PostgreSQL, y luego se descifran mediante la funci√≥n pl / pgsql y se reproducen en la base de datos PostgreSQL. </p><br><h3 id="vozmozhnosti-pg_chameleon">  Pg_chameleon caracter√≠sticas </h3><br><p>  Se pueden replicar m√∫ltiples esquemas MySQL del mismo cl√∫ster en la misma base de datos de destino PostgreSQL con una configuraci√≥n de uno a muchos <br>  Los nombres de los esquemas de origen y destino no pueden coincidir. <br>  Los datos de replicaci√≥n se pueden recuperar de una r√©plica en cascada de MySQL. <br>  Se excluyen las tablas que no pueden replicarse o generar errores. <br>  Cada funci√≥n de replicaci√≥n est√° controlada por demonios. <br>  Control utilizando par√°metros y archivos de configuraci√≥n basados ‚Äã‚Äãen YAML. </p><br><h3 id="primer">  Ejemplo </h3><br><div class="scrollable-table"><table><thead><tr><th>  Anfitri√≥n </th><th>  vm1 </th><th>  vm2 </th></tr></thead><tbody><tr><td>  <strong>Versi√≥n del sistema operativo</strong> </td><td>  CentOS Linux 7.6 x86_64 </td><td>  CentOS Linux 7.5 x86_64 </td></tr><tr><td>  <strong>Versi√≥n del servidor de base de datos</strong> </td><td>  MySQL 5.7.26 </td><td>  PostgreSQL 10.5 </td></tr><tr><td>  <strong>Puerto DB</strong> </td><td>  3306 </td><td>  5433 </td></tr><tr><td>  <strong>Direcci√≥n IP</strong> </td><td>  192.168.56.102 </td><td>  192.168.56.106 </td></tr></tbody></table></div><br><p>  Para comenzar, prepare todos los componentes necesarios para instalar pg_chameleon.  En este ejemplo, se instala Python 3.6.8, que crea un entorno virtual y lo activa. </p><br><pre><code class="plaintext hljs">$&gt; wget https://www.python.org/ftp/python/3.6.8/Python-3.6.8.tar.xz $&gt; tar -xJf Python-3.6.8.tar.xz $&gt; cd Python-3.6.8 $&gt; ./configure --enable-optimizations $&gt; make altinstall</code> </pre> <br><p>  Despu√©s de instalar con √©xito Python3.6, debe cumplir con los otros requisitos, por ejemplo, crear y activar un entorno virtual.  Adem√°s, el m√≥dulo pip se actualiza a la √∫ltima versi√≥n y se utiliza para instalar pg_chameleon.  En los comandos a continuaci√≥n, pg_chameleon 2.0.9 se instala intencionalmente, aunque la √∫ltima versi√≥n es 2.0.10.  Esto es necesario para evitar nuevos errores en la versi√≥n actualizada. </p><br><pre> <code class="plaintext hljs">$&gt; python3.6 -m venv venv $&gt; source venv/bin/activate (venv) $&gt; pip install pip --upgrade (venv) $&gt; pip install pg_chameleon==2.0.9</code> </pre> <br><p>  Luego llamamos a pg_chameleon (chameleon es un comando) con el argumento set_configuration_files para habilitar pg_chameleon y crear directorios y archivos de configuraci√≥n predeterminados. </p><br><pre> <code class="plaintext hljs">(venv) $&gt; chameleon set_configuration_files creating directory /root/.pg_chameleon creating directory /root/.pg_chameleon/configuration/ creating directory /root/.pg_chameleon/logs/ creating directory /root/.pg_chameleon/pid/ copying configuration example in /root/.pg_chameleon/configuration//config-example.yml</code> </pre> <br><p>  Ahora creamos una copia de config-example.yml como default.yml para que se convierta en el archivo de configuraci√≥n predeterminado.  A continuaci√≥n se muestra un archivo de configuraci√≥n de muestra para este ejemplo. </p><br><pre> <code class="plaintext hljs">$&gt; cat default.yml --- #global settings pid_dir: '~/.pg_chameleon/pid/' log_dir: '~/.pg_chameleon/logs/' log_dest: file log_level: info log_days_keep: 10 rollbar_key: '' rollbar_env: '' # type_override allows the user to override the default type conversion into a different one. type_override: "tinyint(1)": override_to: boolean override_tables: - "*" #postgres destination connection pg_conn: host: "192.168.56.106" port: "5433" user: "usr_replica" password: "pass123" database: "db_replica" charset: "utf8" sources: mysql: db_conn: host: "192.168.56.102" port: "3306" user: "usr_replica" password: "pass123" charset: 'utf8' connect_timeout: 10 schema_mappings: world_x: pgworld_x limit_tables: # - delphis_mediterranea.foo skip_tables: # - delphis_mediterranea.bar grant_select_to: - usr_readonly lock_timeout: "120s" my_server_id: 100 replica_batch_size: 10000 replay_max_rows: 10000 batch_retention: '1 day' copy_max_memory: "300M" copy_mode: 'file' out_dir: /tmp sleep_loop: 1 on_error_replay: continue on_error_read: continue auto_maintenance: "disabled" gtid_enable: No type: mysql skip_events: insert: - delphis_mediterranea.foo #skips inserts on the table delphis_mediterranea.foo delete: - delphis_mediterranea #skips deletes on schema delphis_mediterranea update:</code> </pre> <br><p>  El archivo de configuraci√≥n en este ejemplo es un archivo de muestra con pg_chameleon con cambios menores de acuerdo con los entornos de origen y destino, y la siguiente es una descripci√≥n general de las diversas secciones del archivo de configuraci√≥n. </p><br><p>  En el archivo de configuraci√≥n default.yml, hay una secci√≥n de configuraci√≥n global donde puede controlar configuraciones como la ubicaci√≥n del archivo de bloqueo, la ubicaci√≥n de los registros, el per√≠odo de almacenamiento de registros, etc. La siguiente secci√≥n es la secci√≥n de anulaci√≥n de tipo, donde el conjunto reglas para anular tipos durante la replicaci√≥n.  El ejemplo predeterminado usa una regla de redefinici√≥n de tipo que convierte tinyint (1) en un valor booleano.  En la siguiente secci√≥n, indicamos los detalles de la conexi√≥n a la base de datos de destino.  En nuestro caso, esta es una base de datos PostgreSQL designada como pg_conn.  En la √∫ltima secci√≥n, indicamos los datos de origen, es decir, los par√°metros de conexi√≥n de la base de datos de origen, el esquema de mapeo de las bases de datos de origen y destino, las tablas a omitir, el tiempo de espera, la memoria y el tama√±o del paquete.  Tenga en cuenta que "fuentes" se indica en plural, es decir, podemos agregar varias bases de datos de origen para el mismo objetivo para configurar la configuraci√≥n de muchos a uno. </p><br><p>  La base de datos world_x en el ejemplo contiene 4 tablas con filas que la comunidad MySQL ofrece para el ejemplo.  Se puede descargar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  La base de datos de muestra viene en forma de tar y un archivo comprimido con instrucciones para crear e importar cadenas. </p><br><p>  Se crea un usuario especial en las bases de datos MySQL y PostgreSQL con el mismo nombre usr_replica.  En MySQL, se le otorgan derechos adicionales para leer todas las tablas replicadas. </p><br><pre> <code class="plaintext hljs">mysql&gt; CREATE USER usr_replica ; mysql&gt; SET PASSWORD FOR usr_replica='pass123'; mysql&gt; GRANT ALL ON world_x.* TO 'usr_replica'; mysql&gt; GRANT RELOAD ON *.* to 'usr_replica'; mysql&gt; GRANT REPLICATION CLIENT ON *.* to 'usr_replica'; mysql&gt; GRANT REPLICATION SLAVE ON *.* to 'usr_replica'; mysql&gt; FLUSH PRIVILEGES;</code> </pre> <br><p>  En el lado de PostgreSQL, se crea la base de datos db_replica, que aceptar√° cambios de la base de datos MySQL.  El usuario usr_replica de PostgreSQL se configura autom√°ticamente como el propietario de dos esquemas pgworld_x y sch_chameleon que contienen tablas replicadas reales y tablas con directorios de replicaci√≥n respectivamente.  El argumento create_replica_schema es responsable de la configuraci√≥n autom√°tica, como ver√° a continuaci√≥n. </p><br><pre> <code class="plaintext hljs">postgres=# CREATE USER usr_replica WITH PASSWORD 'pass123'; CREATE ROLE postgres=# CREATE DATABASE db_replica WITH OWNER usr_replica; CREATE DATABASE</code> </pre> <br><p>  La base de datos MySQL est√° configurada con algunos cambios para prepararla para la replicaci√≥n, como se muestra a continuaci√≥n.  Deber√° reiniciar el servidor de la base de datos para que los cambios surtan efecto. </p><br><pre> <code class="plaintext hljs">$&gt; vi /etc/my.cnf binlog_format= ROW binlog_row_image=FULL log-bin = mysql-bin server-id = 1</code> </pre> <br><p>  Ahora es importante verificar la conexi√≥n a ambos servidores de bases de datos para que no haya problemas al ejecutar los comandos pg_chameleon. </p><br><p>  En el nodo PostgreSQL: </p><br><pre> <code class="plaintext hljs">$&gt; mysql -u usr_replica -Ap'admin123' -h 192.168.56.102 -D world_x</code> </pre> <br><p>  En el nodo MySQL: </p><br><pre> <code class="plaintext hljs">$&gt; psql -p 5433 -U usr_replica -h 192.168.56.106 db_replica</code> </pre> <br><p>  Los siguientes tres comandos pg_chameleon (chameleon) preparan el entorno, agregan la fuente e inicializan la r√©plica.  El argumento create_replica_schema en pg_chameleon crea el esquema predeterminado (sch_chameleon) y el esquema de replicaci√≥n (pgworld_x) en la base de datos PostgreSQL, como ya dijimos.  El argumento add_source agrega la base de datos original a la configuraci√≥n leyendo el archivo de configuraci√≥n (default.yml), y en nuestro caso es mysql, y init_replica inicializa la configuraci√≥n en funci√≥n de los par√°metros en el archivo de configuraci√≥n. </p><br><pre> <code class="plaintext hljs">$&gt; chameleon create_replica_schema --debug $&gt; chameleon add_source --config default --source mysql --debug $&gt; chameleon init_replica --config default --source mysql --debug</code> </pre> <br><p>  La salida de estos tres comandos obviamente indica su ejecuci√≥n exitosa.  Todos los bloqueos o errores de sintaxis se indican en mensajes simples y claros con consejos para la soluci√≥n de problemas. </p><br><p>  Finalmente, inicie la replicaci√≥n con start_replica y obtenga un mensaje de √©xito. </p><br><pre> <code class="plaintext hljs">$&gt; chameleon start_replica --config default --source mysql output: Starting the replica process for source mysql</code> </pre> <br><p>  El estado de replicaci√≥n se puede solicitar usando el argumento show_status, y los errores se pueden ver usando el argumento show_errors. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Resultado</a> </p><br><p>  Como dijimos antes, cada funci√≥n de replicaci√≥n est√° controlada por demonios.  Para verlos, consultamos la tabla de proceso con el comando ps de Linux, como se muestra a continuaci√≥n. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Resultado</a> </p><br><p>  La replicaci√≥n no se considera configurada hasta que la probamos en tiempo real, como se muestra a continuaci√≥n.  Creamos una tabla, insertamos un par de registros en la base de datos MySQL y llamamos al argumento sync_tables en pg_chameleon para actualizar los demonios y replicar la tabla con los registros en la base de datos PostgreSQL. </p><br><pre> <code class="plaintext hljs">mysql&gt; create table t1 (n1 int primary key, n2 varchar(10)); Query OK, 0 rows affected (0.01 sec) mysql&gt; insert into t1 values (1,'one'); Query OK, 1 row affected (0.00 sec) mysql&gt; insert into t1 values (2,'two'); Query OK, 1 row affected (0.00 sec)</code> </pre> <br><pre> <code class="plaintext hljs">$&gt; chameleon sync_tables --tables world_x.t1 --config default --source mysql Sync tables process for source mysql started.</code> </pre> <br><p>  Para confirmar los resultados de la prueba, consultamos la tabla de la base de datos PostgreSQL y mostramos las filas. </p><br><pre> <code class="plaintext hljs">$&gt; psql -p 5433 -U usr_replica -d db_replica -c "select * from pgworld_x.t1"; n1 | n2 ----+------- 1 | one 2 | two</code> </pre> <br><p>  Si realizamos la migraci√≥n, los siguientes comandos pg_chameleon ser√°n su final.  Los comandos deben ejecutarse despu√©s de asegurarnos de que las filas de todas las tablas de destino se hayan replicado, y el resultado ser√° una base de datos PostgreSQL perfectamente migrada sin referencia a la base de datos de origen o al esquema de replicaci√≥n (sch_chameleon). </p><br><pre> <code class="plaintext hljs">$&gt; chameleon stop_replica --config default --source mysql $&gt; chameleon detach_replica --config default --source mysql --debug</code> </pre> <br><p>  Si lo desea, los siguientes comandos pueden eliminar la configuraci√≥n original y el esquema de replicaci√≥n. </p><br><pre> <code class="plaintext hljs">$&gt; chameleon drop_source --config default --source mysql --debug $&gt; chameleon drop_replica_schema --config default --source mysql --debug</code> </pre> <br><h3 id="preimuschestva-pg_chameleon">  Beneficios de pg_chameleon </h3><br><p>  F√°cil instalaci√≥n y configuraci√≥n. <br>  Soluci√≥n de problemas y detecci√≥n de anomal√≠as con mensajes de error claros. <br>  Puede agregar tablas especiales adicionales a la replicaci√≥n despu√©s de la inicializaci√≥n sin cambiar el resto de la configuraci√≥n. <br>  Puede configurar varias bases de datos de origen para un destino, y esto es muy conveniente si combina datos de una o varias bases de datos MySQL en una base de datos PostgreSQL. <br>  No puede replicar tablas seleccionadas. </p><br><h3 id="nedostatki-pg_chameleon">  Desventajas de pg_chameleon </h3><br><p>  Solo es compatible con MySQL 5.5 y superior como fuente y PostgreSQL 9.5 y superior como base de datos de destino. <br>  Cada tabla debe tener una clave primaria o √∫nica; de lo contrario, las tablas se inicializan en el proceso init_replica, pero no se replican. <br>  Replicaci√≥n unidireccional: solo de MySQL a PostgreSQL.  Por lo tanto, es adecuado solo para el esquema activo-pasivo. <br>  Solo la base de datos MySQL puede ser la fuente y el soporte para la base de datos PostgreSQL ya que la fuente es solo experimental y con limitaciones (obtenga m√°s informaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> ) </p><br><h3 id="itogi-po-pg_chameleon">  Pg_chameleon resultados </h3><br><p>  El m√©todo de replicaci√≥n en pg_chameleon es excelente para migrar una base de datos de MySQL a PostgreSQL.  Una desventaja significativa es que la replicaci√≥n es solo unidireccional, por lo que es poco probable que los expertos en bases de datos quieran usarla para otra cosa que no sea la migraci√≥n.  Pero el problema de la replicaci√≥n unidireccional puede resolverse con otra herramienta de c√≥digo abierto: SymmetricDS. </p><br><p>  Lea m√°s en la documentaci√≥n oficial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Puede encontrar ayuda en la l√≠nea de comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://pgchameleon.org/documents/usage.html&amp;usg=ALkJrhjLwD2kURGnafaZtDnzuQJkDZl_ag#">aqu√≠</a> . </p><br><h3 id="obzor-symmetricds">  Descripci√≥n general de SymmetricDS </h3><br><p>  SymmetricDS es una herramienta de c√≥digo abierto que replica cualquier base de datos a cualquier otra base de datos com√∫n: Oracle, MongoDB, PostgreSQL, MySQL, SQL Server, MariaDB, DB2, Sybase, Greenplum, Informix, H2, Firebird y otras instancias de bases de datos en la nube, por ejemplo Redshift y Azure, etc. Funciones disponibles: sincronizaci√≥n de bases de datos y archivos, replicaci√≥n de varias bases de datos l√≠deres, sincronizaci√≥n filtrada, conversi√≥n y otras.  Esta es una herramienta de Java y requiere una versi√≥n est√°ndar de JRE o JDK (versi√≥n 8.0 o superior).  Aqu√≠ puede registrar los cambios de datos en los desencadenantes en la base de datos de origen y enviarlos a la base de datos de destino correspondiente en forma de paquetes. </p><br><h3 id="vozmozhnosti-symmetricds">  Caracter√≠sticas de SymmetricDS </h3><br><p>  La herramienta es independiente de la plataforma, es decir, dos o m√°s bases de datos diferentes pueden intercambiar datos. <br>  Las bases de datos relacionales se sincronizan escribiendo cambios de datos, y las bases de datos basadas en el sistema de archivos utilizan la sincronizaci√≥n de archivos. <br>  Replicaci√≥n bidireccional utilizando los m√©todos Push y Pull basados ‚Äã‚Äãen un conjunto de reglas. <br>  La transmisi√≥n de datos es posible a trav√©s de redes seguras y redes con bajo ancho de banda. <br>  Recuperaci√≥n autom√°tica cuando los nodos se reanudan despu√©s de una falla y resoluci√≥n autom√°tica de conflictos. <br>  API de extensi√≥n potente y compatible con la nube. </p><br><h3 id="primer-1">  Ejemplo </h3><br><p>  SymmetricDS se puede configurar de una de dos maneras: <br>  Un nodo maestro (padre) que coordina centralmente la replicaci√≥n de datos entre dos nodos esclavos (hijo), y el intercambio de datos entre nodos hijos se realiza solo a trav√©s del padre. <br>  El nodo activo (nodo 1) puede intercambiar datos para la replicaci√≥n con otro nodo activo (nodo 2) sin un intermediario. </p><br><p>  En ambos casos, los datos se intercambian mediante Push y Pull.  En este ejemplo, veremos la configuraci√≥n activo-activo.  Describa toda la arquitectura durante demasiado tiempo, as√≠ que consulte la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gu√≠a</a> para obtener m√°s informaci√≥n sobre SymmetricDS. </p><br><p>  Instalar SymmetricDS es muy simple: descargue la versi√≥n de c√≥digo abierto del archivo zip <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desde aqu√≠</a> y extr√°igala donde desee.  La siguiente tabla proporciona informaci√≥n sobre la ubicaci√≥n de instalaci√≥n y la versi√≥n de SymmetricDS en este ejemplo, as√≠ como las versiones de la base de datos, las versiones de Linux, las direcciones IP y los puertos para ambos nodos. </p><br><div class="scrollable-table"><table><thead><tr><th>  Anfitri√≥n </th><th>  vm1 </th><th>  vm2 </th></tr></thead><tbody><tr><td>  <strong>Versi√≥n del sistema operativo</strong> </td><td>  CentOS Linux 7.6 x86_64 </td><td>  CentOS Linux 7.6 x86_64 </td></tr><tr><td>  <strong>Versi√≥n del servidor de base de datos</strong> </td><td>  MySQL 5.7.26 </td><td>  PostgreSQL 10.5 </td></tr><tr><td>  <strong>Puerto DB</strong> </td><td>  3306 </td><td>  5832 </td></tr><tr><td>  <strong>Direcci√≥n IP</strong> </td><td>  192.168.1.107 </td><td>  192.168.1.112 </td></tr><tr><td>  <strong>Versi√≥n SymmetricDS</strong> </td><td>  SymmetricDS 3.9 </td><td>  SymmetricDS 3.9 </td></tr><tr><td>  <strong>Ruta de instalaci√≥n de SymmetricDS</strong> </td><td>  /usr/local/symmetric-server-3.9.20 </td><td>  /usr/local/symmetric-server-3.9.20 </td></tr><tr><td>  <strong>Nombre de nodo de SymmetricDS</strong> </td><td>  corp-000 </td><td>  tienda-001 </td></tr></tbody></table></div><br><p>  Aqu√≠ instalamos SymmetricDS en /usr/local/symmetric-server-3.9.20, y all√≠ se almacenar√°n diferentes subdirectorios y archivos.  Estamos interesados ‚Äã‚Äãen los directorios y ejemplos de directorios anidados.  El directorio de muestras contiene archivos de configuraci√≥n de muestra con propiedades de host, as√≠ como scripts SQL de muestra para comenzar r√°pidamente la demostraci√≥n. </p><br><p>  En el directorio de ejemplos, vemos tres archivos de configuraci√≥n con propiedades de nodo: el nombre muestra la naturaleza del nodo en un esquema particular. </p><br><pre> <code class="plaintext hljs">corp-000.properties store-001.properties store-002.properties</code> </pre> <br><p>  SymmetricDS tiene todos los archivos de configuraci√≥n necesarios para un esquema base de 3 nodos (opci√≥n 1), y los mismos archivos se pueden usar para un esquema de 2 nodos (opci√≥n 2).  Copie el archivo de configuraci√≥n deseado del directorio de muestras a los motores en el host vm1.  Resulta as√≠: </p><br><pre> <code class="plaintext hljs">$&gt; cat engines/corp-000.properties engine.name=corp-000 db.driver=com.mysql.jdbc.Driver db.url=jdbc:mysql://192.168.1.107:3306/replica_db?autoReconnect=true&amp;useSSL=false db.user=root db.password=admin123 registration.url= sync.url=http://192.168.1.107:31415/sync/corp-000 group.id=corp external.id=000</code> </pre> <br><p>  Este nodo en la configuraci√≥n de SymmetricDS se llama corp-000, y la conexi√≥n de la base de datos es procesada por el controlador mysql jdbc, que utiliza la cadena de conexi√≥n especificada anteriormente y las credenciales de inicio de sesi√≥n.  Nos conectamos a la base de datos replica_db, y las tablas se crear√°n durante la creaci√≥n del esquema.  sync.url muestra el sitio de comunicaci√≥n con el nodo para la sincronizaci√≥n. </p><br><p>  El nodo 2 en el host vm2 est√° configurado como store-001, y el resto se especifica en el archivo node.properties a continuaci√≥n.  El nodo store-001 ejecuta la base de datos PostgreSQL y pgdb_replica es la base de datos para la replicaci√≥n.  registration.url permite que el host vm2 se ponga en contacto con el host vm1 y obtenga detalles de configuraci√≥n de este. </p><br><pre> <code class="plaintext hljs">$&gt; cat engines/store-001.properties engine.name=store-001 db.driver=org.postgresql.Driver db.url=jdbc:postgresql://192.168.1.112:5832/pgdb_replica db.user=postgres db.password=admin123 registration.url=http://192.168.1.107:31415/sync/corp-000 group.id=store external.id=001</code> </pre> <br><p>  El ejemplo precompilado de SymmetricDS contiene opciones para configurar la replicaci√≥n bidireccional entre dos servidores de bases de datos (dos nodos).  Los pasos a continuaci√≥n se realizan en el host vm1 (corp-000), que crear√° un esquema de ejemplo con 4 tablas.  Luego, la ejecuci√≥n de create-sym-tables con el comando symadmin crea tablas de directorio donde se almacenar√°n las reglas y la direcci√≥n de replicaci√≥n entre los nodos.  Finalmente, los datos de muestra se cargan en las tablas. </p><br><pre> <code class="plaintext hljs">vm1$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm1$&gt; ./dbimport --engine corp-000 --format XML create_sample.xml vm1$&gt; ./symadmin --engine corp-000 create-sym-tables vm1$&gt; ./dbimport --engine corp-000 insert_sample.sql</code> </pre> <br><p>  En el ejemplo, las tablas item y item_selling_price se configuran autom√°ticamente para replicar de corp-000 a store-001, y las tablas de venta (sale_transaction y sale_return_line_item) se configuran autom√°ticamente para replicar de store-001 a corp-000.  Ahora cree el esquema en la base de datos PostgreSQL en el host vm2 (store-001) para prepararlo para recibir datos de corp-000. </p><br><pre> <code class="plaintext hljs">vm2$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm2$&gt; ./dbimport --engine store-001 --format XML create_sample.xml</code> </pre> <br><p>  Aseg√∫rese de verificar que la base de datos MySQL en vm1 tenga tablas de muestra y tablas de directorio SymmetricDS.  Tenga en cuenta que las tablas del sistema SymmetricDS (con el prefijo sym_) ahora est√°n disponibles solo en el host corp-000, porque all√≠ ejecutamos el comando create-sym-tables y gestionaremos la replicaci√≥n.  Y en la base de datos en el nodo store-001 solo habr√° 4 tablas de ejemplo sin datos. </p><br><p>  Eso es todo.  El entorno est√° listo para ejecutar procesos del servidor sym en ambos nodos, como se muestra a continuaci√≥n. </p><br><pre> <code class="plaintext hljs">vm1$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm1$&gt; sym 2&gt;&amp;1 &amp;</code> </pre> <br><p>  Las entradas de registro se env√≠an al archivo de registro de fondo (symmetric.log) en la carpeta de registro en el directorio donde est√° instalado SymmetricDS, as√≠ como a la salida est√°ndar.  El servidor sym ahora se puede iniciar en el nodo store-001. </p><br><pre> <code class="plaintext hljs">vm2$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm2$&gt; sym 2&gt;&amp;1 &amp;</code> </pre> <br><p>  Si ejecuta el proceso del servidor sym en el host vm2, tambi√©n crear√° las tablas del cat√°logo SymmetricDS en la base de datos PostgreSQL.  Si ejecuta el proceso del servidor sym en ambos nodos, se coordinan entre s√≠ para replicar los datos de corp-000 a store-001.  Si despu√©s de unos segundos consultamos las 4 tablas en ambos lados, veremos que la replicaci√≥n es exitosa.  O puede enviar el bootstrap a store-001 desde corp-000 con el siguiente comando. </p><br><pre> <code class="plaintext hljs">vm1$&gt; ./symadmin --engine corp-000 reload-node 001</code> </pre> <br><p>  En este punto, se inserta un nuevo registro en la tabla de elementos en la base de datos MySQL en el host corp-000 (host: vm1), y puede verificar su replicaci√≥n en la base de datos PostgreSQL en el host store-001 (host: vm2).  Vemos una operaci√≥n Pull para mover datos de corp-000 a store-001. </p><br><pre> <code class="plaintext hljs">mysql&gt; insert into item values ('22000002','Jelly Bean'); Query OK, 1 row affected (0.00 sec)</code> </pre> <br><pre> <code class="plaintext hljs">vm2$&gt; psql -p 5832 -U postgres pgdb_replica -c "select * from item" item_id | name ----------+----------- 11000001 | Yummy Gum 22000002 | Jelly Bean (2 rows)</code> </pre> <br><p>  Para realizar una operaci√≥n Push para mover datos desde store-001 a corp-000, inserte un registro en la tabla sale_transaction y verifique que la replicaci√≥n se haya completado. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Resultado</a> </p><br><p>  Vemos una configuraci√≥n exitosa de la replicaci√≥n bidireccional de tablas de muestra entre las bases de datos MySQL y PostgreSQL.  Para configurar la replicaci√≥n para nuevas tablas de usuario, haga lo siguiente:  Creamos la tabla t1 como ejemplo y configuramos las reglas para su replicaci√≥n de la siguiente manera.  Por lo tanto, solo configuramos la replicaci√≥n de corp-000 a store-001. </p><br><pre> <code class="plaintext hljs">mysql&gt; create table t1 (no integer); Query OK, 0 rows affected (0.01 sec)</code> </pre> <br><pre> <code class="plaintext hljs">mysql&gt; insert into sym_channel (channel_id,create_time,last_update_time) values ('t1',current_timestamp,current_timestamp); Query OK, 1 row affected (0.01 sec)</code> </pre> <br><pre> <code class="plaintext hljs">mysql&gt; insert into sym_trigger (trigger_id, source_table_name,channel_id, last_update_time, create_time) values ('t1', 't1', 't1', current_timestamp, current_timestamp); Query OK, 1 row affected (0.01 sec)</code> </pre> <br><pre> <code class="plaintext hljs">mysql&gt; insert into sym_trigger_router (trigger_id, router_id, Initial_load_order, create_time,last_update_time) values ('t1', 'corp-2-store-1', 1, current_timestamp,current_timestamp); Query OK, 1 row affected (0.01 sec)</code> </pre> <br><p>  Luego se notifica a la configuraci√≥n un cambio de esquema, es decir, la adici√≥n de una nueva tabla, utilizando el comando symadmin con el argumento sync-triggers, que recrea los activadores para que coincidan con las definiciones de la tabla.  Send-schema se ejecuta para enviar los cambios de esquema al nodo store-001 y se configura la replicaci√≥n de la tabla t1. </p><br><pre> <code class="plaintext hljs">vm1$&gt; ./symadmin -e corp-000 --node=001 sync-triggers vm1$&gt; ./symadmin send-schema -e corp-000 --node=001 t1</code> </pre> <br><h3 id="preimuschestva-symmetricds">  Beneficios de SymmetricDS </h3><br><p>  F√°cil instalaci√≥n y configuraci√≥n, que incluye un conjunto de archivos listos para usar con par√°metros para crear un circuito con tres o dos nodos. <br>  Bases de datos multiplataforma e independencia de plataforma, incluidos servidores, port√°tiles y dispositivos m√≥viles. <br>  Replicar cualquier base de datos a cualquier otra base de datos localmente, en una WAN o en la nube. <br>  La capacidad de trabajar de manera √≥ptima con un par de bases de datos o varios miles para una f√°cil replicaci√≥n. <br>  Versi√≥n de pago con interfaz gr√°fica y excelente soporte. </p><br><h3 id="nedostatki-symmetricds">  Desventajas de SymmetricDS </h3><br><p>  Es necesario determinar manualmente las reglas y la direcci√≥n de replicaci√≥n a trav√©s de las instrucciones SQL en la l√≠nea de comando para cargar tablas de directorio, lo cual es inconveniente. <br>  La configuraci√≥n de muchas tablas para la replicaci√≥n puede ser tediosa si no utiliza scripts para crear sentencias SQL que definan las reglas y la direcci√≥n de la replicaci√≥n. <br>  Se ingresa demasiada informaci√≥n en los registros, y a veces necesita limpiar el archivo de registro para que no ocupe demasiado espacio. </p><br><h3 id="itogi-po-symmetricds">  Resumen de SymmetricDS </h3><br><p>  SymmetricDS le permite configurar la replicaci√≥n bidireccional entre dos, tres o incluso varios miles de nodos para replicar y sincronizar archivos.  Esta es una herramienta √∫nica que realiza de forma independiente muchas tareas, por ejemplo, recuperaci√≥n autom√°tica de datos despu√©s de un largo tiempo de inactividad en un nodo, intercambio seguro y eficiente de datos entre nodos a trav√©s de HTTPS, gesti√≥n autom√°tica de conflictos basada en un conjunto de reglas, etc. SymmetricDS se replica entre cualquier base de datos, por lo tanto, se puede usar para una variedad de escenarios, incluida la migraci√≥n, actualizaci√≥n, distribuci√≥n, filtrado y conversi√≥n de datos en todas las plataformas. </p><br><p>  La muestra se basa en la Gu√≠a oficial de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">inicio</a> r√°pido de SymmetricDS.  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gu√≠a del usuario</a> detalla varios conceptos relacionados con la configuraci√≥n de la replicaci√≥n usando SymmetricDS. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/467313/">https://habr.com/ru/post/467313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../467295/index.html">El enlace de vistas tan esperado en Android</a></li>
<li><a href="../467299/index.html">Conceptos: simplificar la implementaci√≥n de las clases de utilidad STD</a></li>
<li><a href="../467301/index.html">C√≥mo funciona la IA en Hitman (2016)</a></li>
<li><a href="../467303/index.html">La historia del programador m√°s joven de PSB: el hackathon se convirti√≥ en la puerta del banco</a></li>
<li><a href="../467305/index.html">Cuando la ciudad es inteligente: la experiencia de las megaciudades</a></li>
<li><a href="../467317/index.html">C√≥mo SoftBank se trag√≥ el mundo</a></li>
<li><a href="../467323/index.html">Descripci√≥n general de las caracter√≠sticas de programaci√≥n del microcontrolador Qt Creator 4.10 y QBS 1.14</a></li>
<li><a href="../467327/index.html">C√≥mo me convert√≠ en programador a los 35 a√±os</a></li>
<li><a href="../467329/index.html">Los mejores productos parten de problemas reales: Intercomunicador sobre trabajos por hacer. Parte 1</a></li>
<li><a href="../467331/index.html">Vender + una hermosa tienda en l√≠nea en WordPress por $ 269 "desde cero" - nuestra experiencia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>