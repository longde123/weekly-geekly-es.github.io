<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüåæ üò• üñ§ 5 choses que j'aimerais savoir quand j'ai commenc√© √† utiliser Angular üë©‚Äçüè≠ üôéüèª üôåüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Modern Angular est un cadre puissant avec de nombreuses fonctionnalit√©s, avec lequel √† premi√®re vue des concepts et des m√©canismes complexes viennent....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>5 choses que j'aimerais savoir quand j'ai commenc√© √† utiliser Angular</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/480782/"><p>  Modern Angular est un cadre puissant avec de nombreuses fonctionnalit√©s, avec lequel √† premi√®re vue des concepts et des m√©canismes complexes viennent.  Cela est particuli√®rement visible pour ceux qui viennent de commencer √† travailler √† la fois dans le front-end en principe, et avec Angular en particulier. </p><br><p>  J'ai √©galement rencontr√© le m√™me probl√®me lorsque je suis arriv√© √† Tinkoff au poste de d√©veloppeur frontend junior il y a environ deux ans et que j'ai plong√© dans le monde d'Angular.  Par cons√©quent, je vous propose une courte histoire sur cinq choses, dont la compr√©hension faciliterait consid√©rablement mon travail au d√©but. </p><br><p><img src="https://habrastorage.org/webt/er/qq/op/erqqope6skve-m43vun9ivrjyda.png"></p><a name="habracut"></a><br><h2 id="dependency-injection-di">  Injection de d√©pendance (DI) </h2><br><p>  Au d√©but, je suis all√© dans le composant et j'ai vu qu'il y avait des arguments dans le constructeur de classe.  J'ai fait une petite analyse du travail des m√©thodes de classe, et il est devenu clair que ce sont des d√©pendances externes.  Mais comment sont-ils entr√©s en classe?  O√π a √©t√© appel√© le constructeur? </p><br><p>  Je sugg√®re imm√©diatement de comprendre un exemple, mais pour cela nous avons besoin d'un cours.  Si en JavaScript "normal", la POO est pr√©sente avec certains "hacks", alors avec ES6 il y a une "vraie" syntaxe.  Angular utilise TypeScript d√®s la sortie de la bo√Æte, dans laquelle la syntaxe est √† peu pr√®s la m√™me.  Par cons√©quent, je propose de l'utiliser davantage. </p><br><p> Imaginez qu'il existe une classe <code>JokerService</code> dans notre application qui g√®re les blagues.  La m√©thode <code>getJokes()</code> renvoie une liste de blagues.  Supposons que nous l'utilisions √† trois endroits.  Comment obtenir des blagues √† trois endroits diff√©rents dans le code?  Il existe plusieurs fa√ßons: </p><br><ol><li>  Cr√©ez une instance de la classe √† chaque endroit.  Mais pourquoi devons-nous obstruer la m√©moire et cr√©er autant de services identiques?  Et s'il y a 100 si√®ges? </li><li>  Rendez la m√©thode statique et r√©cup√©rez les donn√©es √† l'aide de JokerService.getJokes (). </li><li>  Mettez en ≈ìuvre l'un des mod√®les de conception.  Si nous avons besoin que le service soit un pour toute l'application, alors ce sera Singleton.  Mais pour cela, vous devez √©crire une nouvelle logique dans la classe. </li></ol><br><p>  Nous avons donc trois options tout √† fait fonctionnelles.  Le premier ne nous conviendra pas - dans ce cas, il est inefficace.  Nous ne voulons pas cr√©er de copies suppl√©mentaires, car elles seront compl√®tement identiques.  Il reste deux options. </p><br><p>  Compliquons la t√¢che pour comprendre quelle m√©thode nous convient le mieux.  Supposons qu'en troisi√®me place, nous ayons besoin pour une raison quelconque de cr√©er notre propre service avec certains param√®tres.  Il peut s'agir d'un auteur sp√©cifique, de la dur√©e de la blague, de la langue, etc.  Que ferons-nous alors? </p><br><p>  Dans le cas de la m√©thode statique, vous devrez passer les param√®tres √† chaque appel, car la classe est commune √† tous les endroits.  Autrement dit, dans chaque appel √† <code>getJokes()</code> nous passerons tous les param√®tres uniques √† cet endroit.  Bien s√ªr, il vaut mieux les passer lorsque vous instanciez puis appelez simplement la m√©thode <code>getJokes()</code> . </p><br><p>  Il s'av√®re que la deuxi√®me option ne nous conviendra pas non plus: elle nous fera toujours dupliquer beaucoup de code √† chaque endroit.  Il ne reste que Singleton, qui devra √† nouveau mettre √† jour la logique, mais avec des variantes.  Mais comment comprendre de quelle option nous avons besoin? </p><br><p>  Si vous pensiez que vous pouvez simplement cr√©er un objet et utiliser la cl√© pour prendre le service souhait√©, je peux vous f√©liciter: vous venez de r√©aliser comment l' <em>injection de d√©pendance</em> fonctionne en g√©n√©ral.  Mais allons un peu plus loin. </p><br><p>  Pour vous assurer qu'un m√©canisme est n√©cessaire pour nous aider √† obtenir les bonnes instances, imaginez que JokerService a besoin de deux autres services, dont l'un est facultatif, et le second devrait donner un r√©sultat sp√©cial √† un certain endroit.  Ce n'est pas difficile. </p><br><h3 id="dependency-injection-v-angular">  Injection de d√©pendance angulaire </h3><br><p>  Comme l'indique la <a href="https://angular.io/guide/dependency-injection">documentation</a> , DI est un mod√®le de conception important pour une application.  Angular a son propre framework de d√©pendance, qui est utilis√© dans Angular lui-m√™me pour augmenter l'efficacit√© et la modularit√©. </p><br><p>  D'une mani√®re g√©n√©rale, l' <em>injection de d√©pendances</em> est un m√©canisme puissant dans lequel une classe re√ßoit les d√©pendances n√©cessaires quelque part √† l'ext√©rieur, plut√¥t que de cr√©er des instances par elle-m√™me. </p><br><p>  Ne laissez pas la syntaxe et les fichiers avec l'extension <code>html</code> vous d√©router.  Chaque composant dans Angular est un objet JavaScript standard, une instance d'une classe.  En termes g√©n√©raux: lorsque vous ins√©rez un composant dans un mod√®le, une instance de la classe de composant est cr√©√©e.  Par cons√©quent, √† ce moment, vous pouvez transmettre les d√©pendances n√©cessaires au constructeur.  Prenons maintenant un exemple: </p><br><pre> <code class="plaintext hljs">@Component({ selector: 'jokes', template: './jokes.template.html', }) export class JokesComponent { private jokes: Observable&lt;IJoke[]&gt;; constructor(private jokerService: JokerService) { this.jokes = this.jokerService.getJokes(); } }</code> </pre> <br><p>  Dans le constructeur du composant, nous indiquons simplement que nous avons besoin d'un <code>JokerService</code> .  Nous ne le cr√©ons pas nous-m√™mes.  S'il y a cinq autres composants qui l'utilisent, ils se r√©f√©reront tous √† la m√™me instance.  Tout cela nous permet de gagner du temps, d'√©liminer le passe-partout et d'√©crire des applications tr√®s productives. </p><br><h3 id="providers">  Fournisseurs </h3><br><p>  Et maintenant, je propose de traiter le cas lorsque vous avez besoin d'obtenir diff√©rentes instances du service.  Tout d'abord, jetez un ≈ìil au service lui-m√™me: </p><br><pre> <code class="plaintext hljs">@Injectable({ providedIn: 'root', //   ,   ¬´¬ª  }) export class JokerService { getJokes(): Observable&lt;IJoke[]&gt; { //     } }</code> </pre> <br><p>  Lorsque le service est un pour l'ensemble de l'application, cette option sera suffisante.  Mais que faire si nous avons, disons, deux impl√©mentations de <code>JokerService</code> ?  Ou est-ce juste pour une raison quelconque qu'un composant sp√©cifique a besoin de sa propre instance de service?  La r√©ponse est simple: <a href="https://angular.io/guide/providers"><code>provider</code></a> . </p><br><p>  Pour plus de commodit√©, j'appellerai <code>provider</code> <em>fournisseur</em> et le processus de substitution d'une valeur dans une classe sera <em>v√©rifi√©</em> .  Ainsi, nous pouvons fournir des services de diff√©rentes mani√®res et √† diff√©rents endroits.  Commen√ßons par le dernier.  Trois options sont disponibles: </p><br><ul><li>  Dans l'application enti√®re - sp√©cifiez <code>provideIn: 'root'</code> dans le d√©corateur de service lui-m√™me. </li><li>  Dans le module - sp√©cifiez le fournisseur dans le d√©corateur de service en tant que <code>provideIn: JokesModule</code> ou dans le d√©corateur du module <code>@NgModule  providers: [JokerService]</code> . </li><li>  Dans le composant - sp√©cifiez le fournisseur dans le d√©corateur du composant, comme dans le module. </li></ul><br><p>  L'endroit est choisi en fonction de vos besoins.  Nous avons compris l'endroit, passons au m√©canisme lui-m√™me.  Si nous sp√©cifions simplement <code>provideIn: root</code> dans le service, cela √©quivaudrait √† l'entr√©e suivante dans le module: </p><br><pre> <code class="plaintext hljs">@NgModule({ // ...     providers: [{provide: JokerService, useClass: JokerService}], }) //  </code> </pre> <br><p>  Cela peut √™tre lu quelque chose comme ceci: "Si un <code>JokerService</code> demand√©, alors donnez une instance de la classe <code>JokerService¬ª</code>  De l√†, vous pouvez obtenir une instance sp√©cifique de diff√©rentes mani√®res: </p><br><ul><li><p>  Par jeton - vous devez sp√©cifier un <code>InjectionToken</code> et obtenir un service dessus.  Notez que dans les exemples ci-dessous dans <code>provide</code> vous pouvez transmettre le m√™me jeton: </p><br><pre> <code class="plaintext hljs">const JOKER_SERVICE_TOKEN = new InjectionToken&lt;string&gt;('JokerService'); // ...     [{provide: JOKER_SERVICE_TOKEN, useClass: JokerService}];</code> </pre> <br></li><li><p>  Par classe - vous pouvez remplacer la classe.  Par exemple, nous demanderons <code>JokerService</code> et donnerons - <code>JokerHappyService</code> : </p><br><pre> <code class="plaintext hljs">[{provide: JokerService, useClass: JokerHappyService}];</code> </pre> <br></li><li><p>  Par valeur - vous pouvez imm√©diatement renvoyer l'instance souhait√©e: </p><br><pre> <code class="plaintext hljs">[{provide: JokerService, useValue: jokerService}];</code> </pre> <br></li><li><p>  Par usine - vous pouvez remplacer la classe par une usine qui cr√©era l'instance souhait√©e lors de son acc√®s: </p><br><pre> <code class="plaintext hljs">[{provide: JokerService, useFactory: jokerServiceFactory}];</code> </pre> <br></li></ul><br><p>  C‚Äôest tout.  Autrement dit, pour r√©soudre l'exemple avec une instance sp√©ciale, vous pouvez utiliser l'une des m√©thodes ci-dessus.  Choisissez le plus adapt√© √† vos besoins. </p><br><p>  Soit dit en passant, DI fonctionne non seulement pour les services, mais en g√©n√©ral pour toute entit√© que vous obtenez dans le constructeur de composants.  Il s'agit d'un m√©canisme tr√®s puissant qui devrait √™tre utilis√© √† son plein potentiel. </p><br><h3 id="nebolshoy-itog">  Un petit r√©sum√© </h3><br><p>  Pour une compr√©hension compl√®te, je propose de consid√©rer le m√©canisme d'injection de d√©pendance simplifi√© en angulaire par √©tapes en utilisant l'exemple de service: </p><br><ol><li>  Lors de l'initialisation de l'application, le service a un jeton.  Si nous ne l'avons pas sp√©cifi√© sp√©cifiquement dans le fournisseur, il s'agit de JokerService. </li><li>  Lorsqu'un service est demand√© dans un composant, le m√©canisme DI v√©rifie si le jeton transf√©r√© existe. </li><li>  Si le jeton n'existe pas, DI lancera une erreur.  Dans notre cas, le jeton existe et le JokerService s'y trouve. </li><li>  Lorsque le composant est cr√©√©, une instance de JokerService est pass√©e au constructeur comme argument. </li></ol><br><h2 id="change-detection">  D√©tection de changement </h2><br><p>  Nous entendons souvent, comme argument pour utiliser des frameworks, quelque chose comme ¬´Le framework fera tout pour vous - plus rapidement et plus efficacement.  Vous n'avez besoin de penser √† rien.  G√©rez simplement les donn√©es.  C'est peut-√™tre vrai avec une application tr√®s simple.  Mais si vous devez travailler avec des entr√©es utilisateur et op√©rer constamment sur des donn√©es, il vous suffit de savoir comment fonctionne le processus de d√©tection des modifications et de rendu. </p><br><p>  Dans Angular, <em>Change Detection</em> est responsable de la v√©rification des modifications.  √Ä la suite de diverses op√©rations - modification de la valeur d'une propri√©t√© de classe, ex√©cution d'une op√©ration asynchrone, r√©ponse √† une requ√™te HTTP, etc. - le processus de v√©rification commence tout au long de l'arborescence des composants. </p><br><p>  √âtant donn√© que l'objectif principal du processus est de comprendre comment restituer un composant, l'essentiel est de v√©rifier les donn√©es utilis√©es dans les mod√®les.  S'ils sont diff√©rents, le mod√®le est marqu√© comme ¬´modifi√©¬ª et sera redessin√©. </p><br><h3 id="zonejs">  Zone.js </h3><br><p>  Comprendre comment Angular assure le suivi des propri√©t√©s de classe et des op√©rations synchrones est assez simple.  Mais comment effectue-t-il le suivi asynchrone?  La biblioth√®que Zone.js, cr√©√©e par l'un des d√©veloppeurs Angular, en est responsable. </p><br><p>  Voici ce que c'est.  Une zone en soi est un ¬´contexte d'ex√©cution¬ª, pour le dire franchement, l'endroit et l'√©tat dans lesquels le code est ex√©cut√©.  Une fois l'op√©ration asynchrone termin√©e, la fonction de rappel est ex√©cut√©e dans la m√™me zone o√π elle a √©t√© enregistr√©e.  Angular d√©couvre donc o√π le changement s'est produit et ce qu'il faut v√©rifier. </p><br><p>  Zone.js remplace par ses impl√©mentations presque toutes les fonctions et m√©thodes asynchrones natives.  Par cons√©quent, il peut suivre le moment o√π le <code>callback</code> une fonction asynchrone sera appel√©.  Autrement dit, Zone indique √† Angular quand et o√π commencer le processus de validation des modifications. </p><br><h3 id="strategii-obnaruzheniya-izmeneniy">  Changer les strat√©gies de d√©tection </h3><br><p>  Nous avons compris comment Angular surveille un composant et ex√©cute la v√©rification des modifications.  Imaginez maintenant que vous avez une √©norme application avec des dizaines de composants.  Et pour chaque clic, chaque op√©ration asynchrone, chaque demande ex√©cut√©e avec succ√®s, une v√©rification est lanc√©e sur l'ensemble de l'arborescence des composants.  Tr√®s probablement, une telle application aura de s√©rieux probl√®mes de performances. </p><br><p>  Les d√©veloppeurs angulaires ont r√©fl√©chi √† cela et nous ont donn√© la possibilit√© d'√©tablir une strat√©gie de d√©tection des changements, dont le bon choix peut augmenter de mani√®re tr√®s significative la productivit√©. </p><br><p>  Vous avez le choix entre deux options: </p><br><ul><li>  Par d√©faut - comme son nom l'indique, il s'agit de la strat√©gie par d√©faut lorsqu'un CD est lanc√© pour chaque action. </li><li>  OnPush est une strat√©gie dans laquelle un CD n'est lanc√© que dans quelques cas: <br><ul><li>  si la valeur de <code>@Input()</code> a chang√©; </li><li>  si un √©v√©nement s'est produit √† l'int√©rieur du composant ou de ses descendants; </li><li>  si la v√©rification a √©t√© lanc√©e manuellement; </li><li>  si un nouvel √©v√©nement arrive dans Async Pipe. </li></ul></li></ul><br><p>  Sur la base de ma propre exp√©rience de d√©veloppement sur Angular, ainsi que de l'exp√©rience de mes coll√®gues, je peux dire avec certitude qu'il vaut mieux toujours indiquer la strat√©gie <code>OnPush</code> , sauf si le <code>default</code> vraiment n√©cessaire.  Cela vous donnera plusieurs avantages: </p><br><ul><li>  Une compr√©hension claire du fonctionnement du processus CD. </li><li>  Travail <code>@Input()</code> avec les propri√©t√©s <code>@Input()</code> . </li><li>  Gain de performance. </li></ul><br><h2 id="rabota-s-input">  Travailler avec <code>@Input()</code> </h2><br><p>  Comme d'autres frameworks populaires, Angular utilise un flux de donn√©es en aval.  Le composant accepte les param√®tres d'entr√©e marqu√©s avec le d√©corateur <code>@Input()</code> .  Prenons un exemple: </p><br><pre> <code class="plaintext hljs">interface IJoke { author: string; text: string; } @Component({ selector: 'joke', template: './joke.template.html', }) export class JokeComponent { @Input() joke: IJoke; }</code> </pre> <br><p>  Supposons qu'il existe un composant d√©crit ci-dessus qui affiche le texte de la blague et l'auteur.  Le probl√®me avec cette √©criture est que vous pouvez muter accidentellement ou sp√©cifiquement l'objet transf√©r√©.  Par exemple, remplacez le texte ou l'auteur. </p><br><pre> <code class="plaintext hljs">setAuthorNameOnly() { const name = this.joke.author.split(' ')[0]; this.joke.author = name; }</code> </pre> <br><p>  Je constate tout de suite que c'est un mauvais exemple, mais cela montre clairement ce qui pourrait arriver.  Pour vous prot√©ger contre de telles erreurs, vous devez rendre les param√®tres d'entr√©e en lecture seule.  Gr√¢ce √† cela, vous comprendrez comment travailler correctement avec les donn√©es et cr√©er un CD.  Sur cette base, la meilleure fa√ßon d'√©crire une classe ressemblera √† ceci: </p><br><pre> <code class="plaintext hljs">@Component({ selector: 'joke', template: './joke.template.html', changeDetection: ChangeDetectionStrategy.OnPush, }) export class JokeComponent { @Input() readonly joke: IJoke; @Output() updateName = new EventEmitter&lt;string&gt;(); setAuthorNameOnly() { const name = this.joke.author.split(' ')[0]; this.updateName.emit(name); } }</code> </pre> <br><p>  L'approche d√©crite n'est pas une r√®gle, mais seulement une recommandation.  Il existe de nombreuses situations o√π cette approche sera g√™nante et inefficace.  Au fil du temps, vous apprendrez √† comprendre dans quel cas vous pouvez refuser la m√©thode propos√©e de travail avec les entr√©es. </p><br><h2 id="rxjs">  Rxjs </h2><br><p>  Bien s√ªr, je peux me tromper, mais il semble que ReactiveX et la programmation r√©active en g√©n√©ral soient une nouvelle tendance.  Angular a succomb√© √† cette tendance (ou l'a peut-√™tre cr√©√©e) et utilise RxJS par d√©faut.  La logique de base de l'ensemble du framework fonctionne sur cette biblioth√®que, il est donc tr√®s important de comprendre les principes de la programmation r√©active. </p><br><p>  Mais qu'est-ce que RxJS?  Il combine trois id√©es que je vais r√©v√©ler dans un langage assez simple avec quelques omissions: </p><br><ul><li>  <em>Le mod√®le ¬´Observateur¬ª</em> est une entit√© qui produit des √©v√©nements et un auditeur re√ßoit des informations sur ces √©v√©nements. </li><li>  <em>Le mod√®le d'it√©rateur</em> - vous permet d'obtenir un acc√®s s√©quentiel aux √©l√©ments d'un objet sans r√©v√©ler sa structure interne. </li><li>  <em>La programmation fonctionnelle avec des collections</em> est un mod√®le dans lequel la logique bat en petits composants tr√®s simples, chacun ne r√©solvant qu'un seul probl√®me. </li></ul><br><p>  La combinaison de ces mod√®les nous permet de d√©crire tr√®s simplement des algorithmes complexes √† premi√®re vue, par exemple: </p><br><pre> <code class="plaintext hljs">private loadUnreadJokes() { this.showLoader(); //   fromEvent(document, 'load') .pipe( switchMap( () =&gt; this.http .get('/api/v1/jokes') //   .pipe(map((jokes: any[]) =&gt; jokes.filter(joke =&gt; joke.unread))), //   ), ) .subscribe( (jokes: any[]) =&gt; (this.jokes = jokes), //   error =&gt; { /*   */ }, () =&gt; this.hideLoader(), //       ); }</code> </pre> <br><p>  Seulement 18 lignes avec toute la belle indentation.  Essayez maintenant de r√©√©crire cet exemple sur Vanilla ou au moins sur jQuery.  Pr√®s de 100% de cela vous prendra au moins deux fois plus d'espace et ne sera pas aussi expressif.  Ici, vous pouvez simplement suivre la ligne avec vos yeux et lire le code comme un livre. </p><br><h3 id="observable">  Observable </h3><br><p>  Comprendre que toutes les donn√©es peuvent √™tre repr√©sent√©es sous forme de flux ne vient pas imm√©diatement.  Par cons√©quent, je propose de passer √† une analogie simple.  Imaginez un flux est un tableau de donn√©es tri√©es par le temps.  Par exemple, dans ce mode de r√©alisation: </p><br><pre> <code class="plaintext hljs">const observable = []; let counter = 0; const intervalId = setInterval(() =&gt; { observable.push(counter++); }, 1000); setTimeout(() =&gt; { clearInterval(intervalId); }, 6000);</code> </pre> <br><p>  Nous consid√©rerons que la derni√®re valeur du tableau est pertinente.  Chaque seconde, un nombre sera ajout√© au tableau.  Comment savoir ailleurs dans l'application qu'un √©l√©ment a √©t√© ajout√© au tableau?  Dans une situation normale, nous appelons une sorte de <code>callback</code> et mettons √† jour la valeur du tableau dessus, puis prenons simplement le dernier √©l√©ment. </p><br><p>  Gr√¢ce √† une programmation r√©active, il n'est pas n√©cessaire non seulement d'√©crire beaucoup de nouvelles logiques, mais aussi de penser √† mettre √† jour les informations.  Cela peut √™tre compar√© √† un simple √©couteur: </p><br><pre> <code class="plaintext hljs">document.addEventListener('click', event =&gt; {});</code> </pre> <br><p>  Vous pouvez mettre beaucoup d' <code>EventListener</code> dans toute l'application, et ils fonctionneront, sauf, bien s√ªr, si vous vous occupez de l'oppos√© √† dessein. </p><br><p>  La programmation r√©active fonctionne √©galement.  √Ä un endroit, nous cr√©ons simplement un flux de donn√©es et y d√©posons p√©riodiquement de nouvelles valeurs, et √† un autre, nous nous abonnons √† ce flux et √©coutons simplement ces valeurs.  Autrement dit, nous apprenons toujours la mise √† jour et pouvons la g√©rer. </p><br><p>  Voyons maintenant un exemple r√©el: </p><br><pre> <code class="plaintext hljs">export class JokesListComponent implements OnInit { jokes$: Observable&lt;IJoke&gt;; authors$ = new Subject&lt;string[]&gt;(); unread$ = new Subject&lt;number&gt;(); constructor(private jokerService: JokerService) {} ngOnInit() { //  ,    subscribe()    this.jokes$ = this.jokerService.getJokes(); this.jokes$.subscribe(jokes =&gt; { this.authors$.next(jokes.map(joke =&gt; joke.author)); this.unread$.next(jokes.filter(joke =&gt; joke.unread).length); }); } }</code> </pre> <br><p>  Gr√¢ce √† cette logique, lors de la modification des donn√©es en <code>jokes</code> , nous mettons automatiquement √† jour les donn√©es sur le nombre de blagues non lues et la liste des auteurs.  Si vous avez quelques autres composants, dont l'un recueille des statistiques sur le nombre de blagues lues par un auteur, et le second calcule la dur√©e moyenne des blagues, alors les avantages deviennent √©vidents. </p><br><h2 id="testbed">  Banc d'essai </h2><br><p>  T√¥t ou tard, le d√©veloppeur comprend que si le projet n'est pas MVP, vous devez √©crire des tests.  Et plus les tests seront √©crits, plus leur description sera claire et d√©taill√©e, plus il sera facile, rapide et fiable d'apporter des modifications et de mettre en ≈ìuvre de nouvelles fonctionnalit√©s. </p><br><p>  Angular a probablement pr√©vu cela et nous a donn√© un outil de test puissant.  De nombreux d√©veloppeurs essaient d'abord de ma√Ætriser une sorte de technologie ¬´d√®s le d√©part¬ª sans entrer dans la documentation.  J'ai fait de m√™me, c'est pourquoi j'ai r√©alis√© assez tard toutes les capacit√©s de test disponibles ¬´pr√™tes √† l'emploi¬ª. </p><br><p>  Vous pouvez tester n'importe quoi dans Angular, mais si vous avez juste besoin d'instancier et de commencer √† appeler des m√©thodes pour tester une classe ou un service normal, la situation avec le composant est compl√®tement diff√©rente. </p><br><p>  Comme nous l'avons d√©j√† d√©couvert, gr√¢ce aux DI, les d√©pendances sont prises en dehors du composant.  D'une part, cela complique un peu l'ensemble du syst√®me, d'autre part, cela nous donne de grandes opportunit√©s pour mettre en place des tests et v√©rifier de nombreux cas.  Je propose de comprendre l'exemple d'un composant: </p><br><pre> <code class="plaintext hljs">@Component({ selector: 'app-joker', template: '&lt;some-dependency&gt;&lt;/some-dependency&gt;', styleUrls: ['./joker.component.less'], }) export class JokerComponent { constructor( private jokesService: JokesService, @Inject(PARTY_TOKEN) private partyService: PartyService, @Optional() private sleepService: SleepService, ) {} makeNewFriend(): IFriend { if (this.sleepService &amp;&amp; this.sleepService.isSleeping) { this.sleepService.wakeUp(); } const joke = this.jokesService.generateNewJoke(); this.partyService.goToParty('Pacha'); this.partyService.toSay(joke.text); const laughingPeople = this.partyService.getPeopleByReaction('laughing'); const girl = laughingPeople.find(human =&gt; human.sex === 'female'); const friend = this.partyService.makeFriend(girl); return friend; } }</code> </pre> <br><p>  Ainsi, dans l'exemple actuel, il existe trois services.  L'un est import√© de la mani√®re habituelle, un par jeton et un autre service est facultatif.  Comment configurer le module de test?  Je vais imm√©diatement montrer la vue termin√©e: </p><br><pre> <code class="plaintext hljs">beforeEach(async(() =&gt; { TestBed.configureTestingModule({ imports: [SomeDependencyModule], declarations: [JokerComponent], //  ,    providers: [{provide: PARTY_TOKEN, useClass: PartyService}], }).compileComponents(); fixture = TestBed.createComponent(JokerComponent); component = fixture.componentInstance; fixture.detectChanges(); //    ,     }));</code> </pre> <br><p>  <code>TestBed</code> nous permet de faire une simulation compl√®te du module requis.  Vous pouvez y connecter n'importe quel service, remplacer des modules, obtenir des instances de classes √† partir d'un composant, et bien plus encore.  Maintenant que le module est d√©j√† configur√©, passons aux possibilit√©s. </p><br><h3 id="mozhno-izbegat-lishnih-zavisimostey">  Les d√©pendances inutiles peuvent √™tre √©vit√©es </h3><br><p>  Une application angulaire se compose de modules, qui peuvent inclure d'autres modules, services, directives, etc.  Dans le test, nous devons, en fait, recr√©er le fonctionnement du module.  Si dans notre exemple, nous utilisons <code>&lt;some-dependency&gt;&lt;/some-dependency&gt;</code> dans le mod√®le, cela signifie que nous devons √©galement importer <code>SomeDependencyModule</code> dans le test.  Et s'il y a des addictions l√†-bas?  Donc, ils doivent √©galement √™tre import√©s. <br>  Si l'application est complexe, il y aura beaucoup de telles d√©pendances.  L'importation de toutes les d√©pendances entra√Ænera le fait que dans chaque test, l'application enti√®re sera localis√©e et toutes les m√©thodes seront appel√©es.  Peut-√™tre que cela ne nous convient pas. </p><br><p>  Il existe au moins un moyen de se d√©barrasser des d√©pendances n√©cessaires - il suffit de r√©√©crire le mod√®le.  Supposons que vous ayez des tests de capture d'√©cran ou des tests d'int√©gration et qu'il ne soit pas n√©cessaire de tester l'apparence du composant.  Ensuite, il suffit de simplement v√©rifier les m√©thodes.  Dans ce cas, vous pouvez √©crire la configuration comme suit: </p><br><pre> <code class="plaintext hljs">TestBed.configureTestingModule({ declarations: [JokerComponent], providers: [{provide: PARTY_TOKEN, useClass: PartyService}], }) .overrideTemplate(JokerComponent, '') //   ,   .compileComponents();</code> </pre> <br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, ce n'est pas pour tout le monde. </font><font style="vertical-align: inherit;">√Ä l'int√©rieur de Tinkoff, nous avons convenu de n'utiliser cette approche que dans les cas o√π il n'est pas n√©cessaire de v√©rifier l'affichage du composant. </font><font style="vertical-align: inherit;">Par exemple, lorsque vous travaillez uniquement avec des donn√©es ou lorsque vous communiquez avec la partie. </font><font style="vertical-align: inherit;">S'il est n√©cessaire de v√©rifier comment les donn√©es sont transf√©r√©es vers les composants enfants ou, par exemple, comment les entr√©es utilisateur sont trait√©es, cette option ne fonctionnera pas. </font><font style="vertical-align: inherit;">Si vous avez un tel cas - passez au paragraphe suivant.</font></font></p><br><h3 id="mozhno-mokirovat-vse-zavisimosti-iz-konstruktora"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vous pouvez mouiller toutes les d√©pendances du constructeur </font></font></h3><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous nous sommes d√©j√† familiaris√©s avec le </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeton d'injection</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , je propose donc de passer imm√©diatement aux choses s√©rieuses. </font><font style="vertical-align: inherit;">Dans l'exemple ci-dessus, j'ai d√©j√† v√©rifi√© le service de jeton dans le test. </font><font style="vertical-align: inherit;">Si vous n'√©crivez pas de test d'int√©gration, cela n'a aucun sens d'appeler les m√©thodes d'un vrai service, faites simplement une simulation.</font></font></p><br><p>        <code>ts-mockito</code> ,     ,    . Angular    ¬´ ¬ª. </p><br><pre> <code class="plaintext hljs">//    export class MockPartyService extends PartyService { meetFriend(): IFriend { return {} as IFriend; } goToParty() {} toSay(some: string) { console.log(some); } } // ... TestBed.configureTestingModule({ declarations: [JokerComponent, MockComponent], providers: [{provide: PARTY_TOKEN, useClass: MockPartyService}], //    }).compileComponents();</code> </pre> <br><p>  C‚Äôest tout.         . </p><br><h3 id="mnozhestvo-keysov">   </h3><br><p>       .    ,  ‚Äî  ,   ‚Äî . ,              : </p><br><ul><li>          . </li><li>      ‚Äî ,      .    ‚Äî    . </li></ul><br><p>  ‚Äî       .          ,          .   ‚Äî     . </p><br><h2 id="itog">  R√©sum√© </h2><br><p>       Angular,           .     ,   ,        ¬´¬ª. </p><br><p>      , Angular       - .    HTTP-, , lazy-loading  .            <a href="https://angular.io/docs"> Angular</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr480782/">https://habr.com/ru/post/fr480782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr480762/index.html">V&V ne signifie pas vendetta</a></li>
<li><a href="../fr480772/index.html">Raisons simples de l'in√©vitabilit√© de la dette technique</a></li>
<li><a href="../fr480774/index.html">Not Nginx Unified: H√©bergement Ayhor - Dash-Scratch Live</a></li>
<li><a href="../fr480776/index.html">Nous d√©ployons Active Directory par toutes les m√©thodes possibles.</a></li>
<li><a href="../fr480780/index.html">Comment assembler une illustration √† partir de cubes et de pictogrammes</a></li>
<li><a href="../fr480786/index.html">Clonage profond ind√©pendant d'objets en JavaScript</a></li>
<li><a href="../fr480788/index.html">Sapin de No√´l sur la ligne de commande</a></li>
<li><a href="../fr480790/index.html">"Efficacit√© d'usine". Trouver un goulot d'√©tranglement et mettre en ≈ìuvre un syst√®me de traction pour augmenter la productivit√©</a></li>
<li><a href="../fr480792/index.html">Ing√©nierie des cadeaux</a></li>
<li><a href="../fr480794/index.html">Un peu sur le cas particulier de la mise en ≈ìuvre d'algorithmes de recherche de portes ouvertes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>