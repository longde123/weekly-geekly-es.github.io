<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óΩÔ∏è ü§¥üèº üíáüèº Vit√≥ria na PHDays 9. Compartilhamos hacks em tr√™s partes. Parte 1 üö° üì¥ üéÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! Meu nome √© Vitaliy Malkin. Sou chefe do departamento de an√°lise de seguran√ßa da Informzashchita e capit√£o em tempo parcial da equipe True...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vit√≥ria na PHDays 9. Compartilhamos hacks em tr√™s partes. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453834/">  Ol√° pessoal!  Meu nome √© Vitaliy Malkin.  Sou chefe do departamento de an√°lise de seguran√ßa da Informzashchita e capit√£o em tempo parcial da equipe True0xA3.  Com este artigo, iniciamos um ciclo de 3 materiais dedicados ao nosso desempenho no PHDays IX Standoff.  Neste artigo, explicaremos por que a prepara√ß√£o competente √© metade do sucesso, por que √© t√£o importante coletar "frutos" a tempo e como voc√™ pode organizar a intera√ß√£o da equipe mais experiente em um √∫nico projeto. <br><br>  O artigo TL; DR cont√©m um grande n√∫mero de inglesismos e termos t√©cnicos complexos, pelos quais pe√ßo desculpas separadamente. <br><a name="habracut"></a><br><h3>  <b>I. Entrada</b> </h3><br>  T√≠nhamos 16 pentesters selecionados, 4 trainees, 6 servidores, nossa pr√≥pria esta√ß√£o CUDA e um grande desejo de vencer. <br><br>  Iniciamos a fase de prepara√ß√£o ativa 8 dias antes do in√≠cio do StandOff.  Esta foi a nossa terceira tentativa como atacante, e muitos de n√≥s j√° possu√≠am experi√™ncia suficiente para entender o que procurar este ano.  Vimos cinco √°reas priorit√°rias para elabora√ß√£o: <br><br><ol><li>  Coordena√ß√£o eficaz; </li><li>  Coleta de frutas baixas; </li><li>  Explora√ß√£o de vulnerabilidades de tecnologias at√≠picas (para n√≥s) (ACS TP, IoT, GSM); </li><li>  Prepara√ß√£o de infraestrutura e equipamentos externos; </li><li>  Adicionar desenvolvimento.  m√©todos de persist√™ncia e endurecimento. </li></ol><br>  Vamos tentar analisar esses itens em ordem. <br><br><h3>  1. Coordena√ß√£o eficaz </h3><br>  √â mais f√°cil falar sobre esse ponto, porque a decis√£o geral de que eu era respons√°vel por sua implementa√ß√£o.  Durante o StandOff, o problema mais comum para iniciantes, na minha opini√£o, √© a falta de coordena√ß√£o.  Os membros da equipe resolvem as mesmas tarefas, n√£o h√° um entendimento claro do que j√° foi assistido e do que n√£o √©.  As informa√ß√µes recebidas na tarefa n√£o s√£o transmitidas umas √†s outras, como resultado, a efici√™ncia do trabalho diminui bastante.  E quanto mais participantes, mais a efici√™ncia cai.  Al√©m disso, √© muito √∫til ter uma pessoa que entenda bem a imagem geral da infraestrutura e possa vincular vulnerabilidades individuais a um vetor de ataque completo. <br><br>  Este ano, a plataforma Discord foi escolhida para a intera√ß√£o da equipe.  Em geral, √© muito semelhante ao bom e velho bate-papo do IRC com recursos adicionais, como upload de arquivos a e comunica√ß√£o por voz.  Pegamos uma descri√ß√£o de todos os objetos das competi√ß√µes do Agend e criamos um canal para cada um deles, no qual as informa√ß√µes foram postadas.  Assim, qualquer pessoa que se conectasse √† tarefa poderia ver tudo o que surgia, incluindo os resultados do lan√ßamento de v√°rias ferramentas e pesquisas manuais.  Em todos os canais de informa√ß√µes, foi definido um limite de uma mensagem por minuto para evitar inunda√ß√µes.  E toda a discuss√£o foi conduzida em bate-papos separados, que tamb√©m foram criados para cada objeto. <br><br><img src="https://habrastorage.org/webt/ed/2m/lk/ed2mlkxo5tkfjhbpxucchbb6vv4.png"><br><br>  Tamb√©m foram tomadas v√°rias decis√µes organizacionais para melhorar a coordena√ß√£o.  Em geral, n√£o √© habitual definir tarefas com a reda√ß√£o ‚ÄúNECESS√ÅRIO‚Äù em nossa equipe.  Tentamos discutir por que essa ou aquela tarefa est√° definida, a que sua implementa√ß√£o levar√° e tamb√©m como realiz√°-la com mais efici√™ncia.  Por√©m, dentro da estrutura do StandOff, esse modelo pode levar a discuss√µes desnecess√°rias, por isso decidimos confiar ao coordenador autoridade completa sobre o processo.  Dentro de 28 horas da competi√ß√£o, suas decis√µes praticamente n√£o foram discutidas, o que certamente nos poupou muito tempo.  Embora possa ter afetado a qualidade das comunica√ß√µes.  Al√©m disso, decidimos delinear claramente as √°reas de responsabilidade: apesar do fato de alguns membros da equipe n√£o terem as tarefas mais emocionantes. <br><br><h3>  2. Coleta de frutas baixas </h3><br>  Na minha opini√£o, o principal segredo do nosso sucesso foi: uma enorme experi√™ncia di√°ria de projetos e a correta prioriza√ß√£o de tarefas.  No ano passado, conseguimos capturar um escrit√≥rio inteiro e mant√™-lo durante todo o jogo simplesmente devido a vulnerabilidades simples hackeadas rapidamente.  Este ano, abordamos o problema centralmente e compilamos uma lista dessas vulnerabilidades. <br><br>  ms17-010;  ms08-67;  SMBCRY  LibSSH RCE;  Protectoer HP DATA;  HP iLo;  ipmi  Instala√ß√£o inteligente da Cisco  Java RMI  JDWP;  JBOSS;  drupalgeddon2;  weblogic  com cora√ß√£o  shellshock;  ibm websphere  iis-webdav;  servi√ßos;  vnc;  ftp-anon;  NFS  smb-null;  Tomcat <br><br>  Em seguida, foram escritos dois servi√ßos de verificador e penetrador, que de modo automatizado, usando explora√ß√µes p√∫blicas e metasploit, primeiro checaram as vulnerabilidades e depois tentaram explor√°-las.  O utilit√°rio recebeu um relat√≥rio nmap na entrada, o que acabou acelerando o processo. <br><br><h3>  3. Explora√ß√£o de vulnerabilidades de tecnologias at√≠picas (para n√≥s) (ACS TP, IoT, GSM) </h3><br>  Na maioria das vezes, fazemos projetos para bancos e outras organiza√ß√µes financeiras.  Os sistemas SCADA, se houver, s√£o mais prov√°veis ‚Äã‚Äãno estilo: "Se voc√™ conseguiu obter acesso √† rede ao scada, corrija isso e conte-o como um dos crit√©rios para o sucesso do projeto".  Portanto, n√£o temos uma boa experi√™ncia aplicada na an√°lise da seguran√ßa dos sistemas de controle de processos.  Por sua vez, isso levou ao fato de que uma semana antes do StandOff nos sent√°vamos com urg√™ncia para estudar vulnerabilidades t√≠picas.  Com a IoT e o GSM, a situa√ß√£o √© ainda pior: se a IoT √†s vezes √© encontrada em projetos, vimos o GSM apenas nos StandOffs anteriores. <br><br>  Assim, durante a prepara√ß√£o, identificamos duas pessoas separadas no sistema de controle de processo automatizado e mais duas no GSM e IoT.  Durante a semana preparat√≥ria, o 1¬∫ grupo escreveu abordagens t√≠picas para os mais avan√ßados sistemas SCADA e tamb√©m estudou em detalhes um v√≠deo sobre a infraestrutura ICS do ano passado.  Os caras tamb√©m lan√ßaram cerca de 200 GB de v√°rias IHMs, drivers e outros softwares diretamente relacionados aos controladores.  Quanto ao GSM e √† IoT, preparamos aqui v√°rias pe√ßas de ferro, lemos todos os artigos dispon√≠veis sobre o GSM e esperamos que isso fosse suficiente.  (SPOILER: Na verdade n√£o!) <br><br><h3>  4. Prepara√ß√£o de infraestrutura e equipamentos externos </h3><br>  Entendendo que nossa equipe ser√° grande o suficiente este ano, decidimos imediatamente que precis√°vamos de equipamento adicional.  A seguir, √© apresentada uma lista de sugest√µes que coletamos dentro da equipe. O sinal "+" indica que finalmente recebemos: <br><br>  - m√°quina de caf√©; <br>  + - servidor CUDA (eles n√£o levaram com eles, mas usaram); <br>  + laptop de reposi√ß√£o; <br>  + Roteador Wi-Fi; <br>  + switch gerenciado; <br>  + cabos de rede de v√°rios comprimentos (20 pe√ßas); <br>  + piloto (3 pe√ßas); <br>  + Wi-fi Alfa (3 pe√ßas); <br>  + pato de borracha (2 pe√ßas); <br>  - proxmark; <br>  uma c√¢mera <br><br>  Quanto √† infraestrutura, esta √© uma m√∫sica separada.  No ano passado, percebemos o qu√£o √∫til √© usar uma esta√ß√£o CUDA, quebrando v√°rios apertos de m√£o, portanto n√£o havia d√∫vida sobre a necessidade de us√°-la.  √â importante que este ano, assim como no passado, todos os atacantes estivessem por tr√°s do NATth, que geralmente rejeitava a possibilidade de conex√µes reversas da DMZ.  Mas absolutamente todos os hosts devem ter acesso √† Internet, exceto os n√≥s do ICS.  Nesse sentido, decidimos criar tr√™s servidores ouvintes, acess√≠veis a partir da Internet.  Al√©m disso, para simplificar a din√¢mica e a consolida√ß√£o, usamos nosso pr√≥prio servidor OpenVpn com o modo cliente a cliente ativado.  Infelizmente, √© imposs√≠vel automatizar o processo de conex√£o de um gateway; portanto, por cerca de 12 horas em 28, um dos membros da equipe estava trabalhando com gateways. <br><br><h3>  5. Desenvolvimento de add.  m√©todos de persist√™ncia e endurecimento </h3><br>  Nossa experi√™ncia anterior com o StandOff mostrou claramente que n√£o √© suficiente invadir um servidor com √™xito: √© importante n√£o deixar que outras pessoas se estabele√ßam nele.  Portanto, foi dada aten√ß√£o suficiente ao RAT com novas assinaturas e scripts para fortalecer a prote√ß√£o do Windows.  Usamos nosso RAT padr√£o, alterando ligeiramente os m√©todos de ofusca√ß√£o.  As regras eram um pouco mais complicadas.  Em geral, determinamos por n√≥s mesmos o seguinte conjunto de scripts: <br><br><ul><li>  fechamento de SMB e RPC; </li><li>  portando o RDP para uma porta n√£o padr√£o; </li><li>  Desativando criptografia revers√≠vel, contas de convidado e outras configura√ß√µes da linha de base de seguran√ßa. </li></ul><br>  Para Linux, foi desenvolvido um script init especial que fechou todas as portas, abriu o SSH em uma porta n√£o padr√£o e registrou as chaves p√∫blicas do comando para acessar o SSH. <br><br><h3>  <b>II</b>  <b>Briefing</b> </h3><br>  Em 17 de maio, 5 dias antes do StandOff, foi realizado um briefing para os atacantes.  No decorrer disso, muitas informa√ß√µes surgiram que influenciaram nosso treinamento. <br><br>  Em primeiro lugar, os organizadores publicaram um mapa da rede, e isso se tornou uma grande ajuda para n√≥s.  Conseguimos dividir as √°reas de responsabilidade antecipadamente, atualizar os segmentos da rede e, o mais importante, entender o que √© a rede.  Na minha opini√£o, a declara√ß√£o mais importante feita no briefing foi a frase de que a rede ICS seria acess√≠vel a partir de apenas um segmento, e esse segmento n√£o seria protegido.  Al√©m disso, o ICS e os escrit√≥rios seguros receber√£o mais pontos, e os organizadores incentivam diretamente a luta por redes entre hackers. <br><br>  Pegamos essas informa√ß√µes assim: "Quem captura o grande grupo provavelmente ganhar√° o jogo".  O fato √© que nossa experi√™ncia nos disse: n√£o importa quais puni√ß√µes os organizadores inventariam por um servi√ßo simples, os defensores abandonariam os servi√ßos vulner√°veis ‚Äã‚Äãse n√£o pudessem corrigi-los.  Afinal, √© muito pior quando eles anunciam, desde o est√°gio da maior confer√™ncia de seguran√ßa da informa√ß√£o, que voc√™ estragou os hackers do que se eles tirassem alguns pontos do jogo.  Nossa teoria foi confirmada, mas falaremos sobre isso em detalhes no 2¬∫ artigo. <br><br>  Como resultado, decidimos dividir toda a equipe em 4 partes: <br><br>  <b>1. Bigbrogroup.</b>  Essa foi a tarefa √† qual atribu√≠mos a maior prioridade.  A equipe envolveu as pessoas que t√™m mais experi√™ncia em invadir a infraestrutura interna de diferentes clientes.  No total, essa mini equipe era composta por 5 pessoas.  Seu objetivo era conquistar uma posi√ß√£o no dom√≠nio o mais r√°pido poss√≠vel e impedir que outras equipes acessassem o ICS. <br><br>  <b>2. Rede sem fio.</b>  A equipe respons√°vel pelo monitoramento do Wi-Fi acompanhou novos pontos, interceptou os apertos de m√£o e os brutalizou.  O GSM tamb√©m entrou em suas tarefas, mas antes de tudo era necess√°rio capturar o Wi-Fi e interromper outros comandos. <br><br>  <b>3. Redes desprotegidas.</b>  A equipe que durante as primeiras quatro horas escolheu todas as redes desprotegidas quanto a vulnerabilidades.  Entendemos que nessas quatro horas nada de importante acontecer√° nos segmentos protegidos e, se isso acontecer, os defensores o reverter√£o.  Portanto, eles se concentraram no que poderia ter mudado irreversivelmente.  Como se viu - n√£o em v√£o.  Quatro horas depois, o mesmo grupo come√ßou a analisar segmentos protegidos. <br><br>  <b>4. Grupo de scanners.</b>  Os organizadores declararam diretamente que as redes mudar√£o, ent√£o t√≠nhamos duas pessoas que pesquisavam continuamente a rede em busca de mudan√ßas.  N√£o foi t√£o f√°cil automatizar, porque em redes diferentes, configura√ß√µes diferentes eram necess√°rias em momentos diferentes.  Por exemplo, na primeira hora na rede fe.phd, o nmap funcionou bem para n√≥s no modo T3 e, ap√≥s 12 horas, mal funcionou no T1. <br><br>  Outro vetor importante para n√≥s foi a lista de software e tecnologias publicada pelos organizadores.  Para cada tecnologia, tentamos criar nosso pr√≥prio centro de compet√™ncia, o que poderia ajudar muito rapidamente e ver vulnerabilidades t√≠picas. <br><br>  Para alguns servi√ßos, encontramos vulnerabilidades muito interessantes, mas n√£o houve explora√ß√µes p√∫blicas.  Assim foi, por exemplo, com o RCE p√≥s-explora√ß√£o Redis.  T√≠nhamos certeza de que essa vulnerabilidade apareceria na infraestrutura de jogos, por isso decidimos escrever nossa pr√≥pria explora√ß√£o de 1 dia.  N√£o foi poss√≠vel escrever um dia especificamente para esta vulnerabilidade, mas no geral, t√≠nhamos cerca de cinco explora√ß√µes n√£o p√∫blicas em m√£os que est√°vamos prontas para usar. <br><br><img src="https://habrastorage.org/webt/kt/sc/ze/ktsczeslu1oszbpflccstfktb0w.png"><br><br>  Infelizmente, n√£o conseguimos compartilhar todas as tecnologias, mas n√£o foi t√£o assustador.  Cobrimos o cen√°rio principal, e isso foi suficiente.  Havia tamb√©m uma lista de controladores de processo, que tamb√©m resolvemos e tentamos preparar para isso. <br><br>  Em prepara√ß√£o para a batalha, preparamos v√°rias ferramentas para conectar-se perfeitamente √† rede f√≠sica do ICS.  Por exemplo, implementamos um an√°logo barato de abacaxi - usando framboesa.  O m√≥dulo foi conectado via Ethernet √† rede industrial e via GSM ao servi√ßo de gerenciamento.  Em seguida, poder√≠amos configurar remotamente a conex√£o Ethernet e distribu√≠-la no local usando o m√≥dulo Wi-Fi embutido.  Infelizmente, no briefing, os organizadores deixaram claro que voc√™ n√£o pode se conectar fisicamente ao ICS, ent√£o deixamos este m√≥dulo at√© tempos melhores. <br><br>  Muita informa√ß√£o era sobre o banco, o banco offshore e o trabalho antifraude.  Mas, tendo aprendido que n√£o h√° muito dinheiro, decidimos n√£o nos preparar para isso com anteced√™ncia, mas apresentar algo ao longo do caminho. <br><br>  Resumindo, fizemos uma quantidade bastante grande de trabalho em prepara√ß√£o.  √â importante observar que, al√©m das vantagens √≥bvias na forma de um desempenho bem-sucedido no StandOff, tamb√©m n√£o havia as √≥bvias. <br><br><ul><li>  Essa prepara√ß√£o √© uma √≥tima maneira de me distrair e fazer algo que h√° muito tempo queria tentar explorar, e simplesmente n√£o havia tempo na estrutura da atividade do projeto. </li><li>  N√£o temos projetos que envolvam toda a equipe como parte de uma tarefa; por isso, constru√≠mos uma boa equipe, buscando objetivos espec√≠ficos. </li><li>  Muito do que fizemos pode ser usado em projetos reais; portanto, al√©m de expandir nossas compet√™ncias, tamb√©m temos ferramentas prontas. </li></ul><br>  Agora, tendo descrito tudo isso no texto, entendo que n√£o realizamos nada t√£o grandioso quanto parecia antes.  Em geral, parece-me que o est√°gio de prepara√ß√£o corretamente organizado se tornou o principal motivo da vit√≥ria de nossa equipe.  E o que aconteceu diretamente durante o StandOff - contarei no segundo artigo do ciclo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt453834/">https://habr.com/ru/post/pt453834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt453822/index.html">Caixas registradoras on-line como uma retirada legal de dinheiro de uma empresa</a></li>
<li><a href="../pt453824/index.html">Como ser√° a colabora√ß√£o e a visualiza√ß√£o de conte√∫do de v√≠deo com o advento do 5G</a></li>
<li><a href="../pt453828/index.html">Evitando mentir com as estat√≠sticas: o b√°sico da visualiza√ß√£o de dados</a></li>
<li><a href="../pt453830/index.html">Compara√ß√£o de repetidores celulares. RF-Link 1800 / 2100-75-23 e AliExpress Noname</a></li>
<li><a href="../pt453832/index.html">19 cabe√ßas de hidra. Excelente revis√£o do programa</a></li>
<li><a href="../pt453836/index.html">Mitos e realidade de POO</a></li>
<li><a href="../pt453838/index.html">Como automatizar o monitoramento de compras p√∫blicas gratuitamente</a></li>
<li><a href="../pt453840/index.html">Eles dizem que aprender Python e se tornar um programador √© f√°cil. Certo?</a></li>
<li><a href="../pt453842/index.html">Como a Microsoft reduz o ru√≠do para criar um mundo sonoro √∫til e bonito</a></li>
<li><a href="../pt453844/index.html">Bilhete para LANIT. Estar no jogo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>