<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💜 🔕 🕷️ Corotinas personalizadas em união com preferência e cortesãs 👨🏿‍⚖️ ✍️ 🛤️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Você já é tão legal que roda rotinas em torno de todos os eixos ao mesmo tempo; de uma só vez, elas executam yield break e se escondem atrás da tela d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Corotinas personalizadas em união com preferência e cortesãs</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442820/"><p><img src="https://habrastorage.org/webt/ba/4v/xo/ba4vxoon1fdwi28pizrv99yg6cy.jpeg"></p><br><p> Você já é tão legal que roda rotinas em torno de todos os eixos ao mesmo tempo; de uma só vez, elas executam <code>yield break</code> e se escondem atrás da tela do IDE.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Invólucros</a> simples são um estágio distante. </p><br><p>  Você sabe como cozinhá-los tão bem que poderia conseguir uma estrela <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Michelin</a> (ou até duas) se tivesse seu próprio restaurante.  Claro!  Ninguém ficará indiferente ao provar seu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bouillabaisse</a> com molho de corotina. </p><br><p>  Durante uma semana inteira, o código no prod não cai!  Wrappers, <code>callback</code> 'e <code>Start/Stop Coroutine</code> são muitos escravos.  Você precisa de mais controle e liberdade de ação.  Você está pronto para subir o próximo passo (mas não saia das corotinas, é claro). </p><br><p>  Se você se reconhece nessas linhas, bem-vindo ao gato. </p><br><p><a name="habracut"></a>  Aproveito a oportunidade para dizer olá a um dos meus padrões favoritos - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Comando</a> . </p><br><h2 id="vvedenie">  1. Introdução </h2><br><p>  Para todas as instruções de <code>yield</code> fornecidas pelo Unity ( <code>Coroutine</code> , <code>AsyncOperation</code> , <code>WaiForSeconds</code> e outros), a classe base é a classe <code>YieldInstruction</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">docs</a> ) não digna de <code>YieldInstruction</code> : </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">StructLayout (LayoutKind.Sequential)</span></span>] [UsedByNativeCode] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YieldInstruction</span></span> { }</code> </pre> <br><p>  Sob o capô, as corotinas são enumeradores comuns ( <code>IEnumerator</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">docs</a> )).  Cada quadro é chamado pelo método <code>MoveNext()</code> .  Se o valor de retorno for <code>true</code> , a execução será atrasada até a próxima instrução de <code>yield</code> ; se <code>false</code> , será interrompida. </p><br><p>  Para <code>yield</code> instruções de <code>yield</code> personalizadas, o Unity fornece a <code>CustomYieldInstruction</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">docs</a> ) com o mesmo nome. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomYieldInstruction</span></span> : <span class="hljs-title"><span class="hljs-title">IEnumerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> keepWaiting { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Current =&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveNext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Reset</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre><br><p>  Basta herdar e implementar a propriedade keepWaiting.  Já discutimos sua lógica acima.  Ele deve retornar <code>true</code> enquanto a corotina for executada. </p><br><p>  Exemplo da documentação: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaitForMouseDown</span></span> : <span class="hljs-title"><span class="hljs-title">CustomYieldInstruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> keepWaiting { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !Input.GetMouseButtonDown(<span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForMouseDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Debug.Log(<span class="hljs-string"><span class="hljs-string">"Waiting for Mouse right button down"</span></span>); } }</code> </pre> <br><p>  Segundo ela, o <code>keepWating</code> executado todos os quadros após <code>Update()</code> e antes de <code>LateUpdate()</code> . </p><br><p>  <em>Se você estiver trabalhando com código no qual certas coisas devem funcionar em um determinado momento e ainda não tiver estudado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esta</a> página, recomendo que você decida esse feito.</em> </p><br><h2 id="kastomnye-yield-instrukcii">  Instruções de rendimento personalizadas </h2><br><p><img src="https://habrastorage.org/webt/4p/wt/xf/4pwtxfv0kjogj_2zwcrm-sputhc.jpeg"></p><br><p>  Mas não viemos aqui com invólucros regulares, como o <code>CustomYieldInstruction</code> herdar.  Para isso, você pode ficar sem Michelin. </p><br><p>  Portanto, fumamos ainda mais a documentação e quase na parte inferior da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mesma</a> página encontramos o parágrafo mais importante. </p><br><p>  <strong>Para ter mais controle e implementar instruções de rendimento mais complexas, você pode herdar diretamente da</strong> <strong>classe</strong> <code>System.Collections.IEnumerator</code> <strong>.</strong>  <strong>Nesse caso, implemente</strong> <strong>o método</strong> <code>MoveNext()</code> <strong>da mesma maneira que implementaria a</strong> <strong>propriedade</strong> <code>keepWaiting</code> <strong>.</strong>  <strong>Além disso, você também pode retornar um objeto na propriedade <code>Current</code> , que será processado pelo agendador de rotinas de rotina da Unity após executar o</strong> <strong>método</strong> <strong>MoveNext</strong> <code>MoveNext()</code> <strong>.</strong>  <strong>Por exemplo, se</strong> <code>Current</code> <strong>retornasse outro objeto herdado de</strong> <code>IEnumerator</code> <strong>, o enumerador atual seria suspenso até que o retornado fosse concluído.</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Em russo</b> <div class="spoiler_text"><p>  <strong>Para obter mais controle e implementar</strong> <strong>instruções de</strong> <code>yield</code> <strong>mais complexas</strong> <strong>, você pode herdar diretamente da interface</strong> <code>System.Collections.IEnumerator</code> <strong>.</strong>  <strong>Nesse caso, implemente o método</strong> <code>MoveNext()</code> <strong>da mesma maneira que a propriedade</strong> <code>keepWaiting</code> <strong>.</strong>  <strong>Além disso, você pode usar o objeto na propriedade</strong> <code>Current</code> <strong>, que será processada pelo agendador de rotinas de rotina Unity após executar o método</strong> <code>MoveNext()</code> <strong>.</strong>  <strong>Por exemplo, se a propriedade</strong> <code>Current</code> <strong>retornar outro objeto que implemente a interface</strong> <code>IEnumerator</code> <strong>, a execução do enumerador atual será atrasada até a conclusão do novo.</strong> </p></div></div><br><p>  Amêijoas sagradas!  Esses são os controles e a liberdade de ação que eu tanto queria.  Bem, é isso, agora você embrulha tão corutins que nenhum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gimbal Lock</a> é assustador.  A principal coisa, da felicidade, incita a vertukha a não bater. </p><br><h3 id="interfeys">  Interface </h3><br><p>  Bem, seria bom começar decidindo qual interface de interação com nossa instrução queremos ter.  Algum conjunto mínimo. </p><br><p>  Eu sugiro a seguinte opção </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IInstruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExecuting { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsPaused { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-function">Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pause</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Resume</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Terminate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Started; <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Paused; <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Cancelled; <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Done; }</code> </pre> <br><p>  Quero chamar sua atenção para o fato de <code>IsExecuting</code> e <code>IsPaused</code> não <code>IsPaused</code> o oposto aqui.  Se a execução da corotina estiver em pausa, ela ainda está sendo executada. </p><br><h3 id="pasyans-i-kurtizanki">  Paciência e cortesã </h3><br><p>  Como a documentação diz, você precisa implementar a interface <code>IEnumerator</code> .  Em alguns lugares, por enquanto, vamos deixar os stubs, já que sua implementação depende diretamente da funcionalidade que queremos colocar nele. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Instruction</span></span> : <span class="hljs-title"><span class="hljs-title">IEnumerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Instruction current; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> IEnumerator.Current =&gt; current; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IEnumerator.Reset() { } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IEnumerator.MoveNext() { } }</code> </pre> <br><p>  Vale a pena considerar que existem pelo menos duas maneiras pelas quais nossas instruções podem ser lançadas: </p><br><ol><li><p>  Método <code>StartCoroutine(IEnumerator routine)</code> : </p><br><pre> <code class="plaintext hljs">StartCoroutine(new ConcreteInstruction());</code> </pre> <br></li><li><p>  <code>yield</code> rendimento: </p><br><pre> <code class="plaintext hljs">private IEnumerator SomeRoutine() { yield return new ConcreteInstruction(); }</code> </pre> <br></li></ol><br><p>  O método <code>Execute</code> , que descrevemos acima na interface <code>IInstruction</code> , usará o primeiro método.  Portanto, adicionamos alguns campos que ajudarão a gerenciar as instruções nesse caso. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> routine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Parent { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><p>  Agora propriedades e eventos para <code>IInstruction</code> . </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Instruction</span></span> : <span class="hljs-title"><span class="hljs-title">IEnumerator</span></span>, <span class="hljs-title"><span class="hljs-title">IInstruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Instruction current; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> IEnumerator.Current =&gt; current; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> routine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Parent { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExecuting { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsPaused { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsStopped { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Started; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Paused; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Terminated; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruciton&gt; Done; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IEnumerator.Reset() { } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IEnumerator.MoveNext() { } Instruction(MonoBehaviour parent) =&gt; Parent = parent; }</code> </pre> <br><p>  Além disso, métodos para manipular eventos em classes filho: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPaused</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnResumed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTerminated</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDone</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { }</code> </pre> <br><p>  Eles serão chamados manualmente imediatamente antes dos eventos correspondentes para dar às classes filhas a prioridade de seu processamento. </p><br><p>  Agora os métodos restantes. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pause</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsExecuting &amp;&amp; !IsPaused) { IsPaused = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; OnPaused(); Paused?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Resume</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsExecuting) { IsPaused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; OnResumed(); } }</code> </pre> <br><p>  Tudo é simples aqui.  A instrução pode ser pausada apenas se estiver sendo executada e se não tiver sido suspensa, e continuar a execução somente se estiver suspensa. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Terminate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Stop()) { OnTerminated(); Terminate?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsExecuting) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (routine <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Coroutine) Parent.StopCoroutine(routine <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Coroutine); (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IEnumerator).Reset(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsStopped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br><p>  A lógica principal para parar as instruções é feita no método <code>Stop</code> .  Isso é necessário para poder executar uma parada silenciosa (sem disparar eventos). <br>  Verificando <code>if (routine is Coroutine)</code> necessário porque, como escrevi acima, a instrução pode ser iniciada pela <code>yield</code> (ou seja, sem chamar <code>StartCoroutine</code> ), o que significa que pode não haver link para uma instância específica da <code>Coroutine</code> .  Nesse caso, a <code>routine</code> terá apenas um objeto de stub. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is currently waiting for another one and can't be stared right now."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsExecuting) { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; routine = (Parent = parent).StartCoroutine(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is already executing."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre> <br><p>  O método principal de inicialização também é extremamente simples - a inicialização será realizada apenas se a instrução ainda não tiver sido lançada. </p><br><p>  Resta concluir a implementação do <code>IEnumerator</code> , porque deixamos espaços vazios em alguns métodos. </p><br><pre> <code class="cs hljs">IEnumerator.Reset() { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; IsPaused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; IsStopped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; routine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><p>  E o mais interessante, mas não mais complicado, é o <code>MoveNext</code> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IEnumerator.MoveNext() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsStopped) { (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IEnumerator).Reset(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsExecuting) { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; routine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(); OnStarted(); Started?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsPaused) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Update()) { OnDone(); Done?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); IsStopped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><p>  <code>if (!IsExecuting)</code> - se a instrução não foi iniciada por meio do <code>StartCoroutine</code> e essa linha de código for executada, a <code>yield</code> a <code>StartCoroutine</code> .  Escrevemos um esboço na <code>routine</code> e nos eventos de incêndio. </p><br><p>  <code>if (current != null)</code> - <code>current</code> usado para instruções filho.  Se de repente isso apareceu, estamos aguardando o seu fim.  Observe que sentirei falta do processo de adicionar suporte para instruções para crianças neste artigo para não aumentar ainda mais.  Portanto, se você não estiver interessado em adicionar mais essa funcionalidade, basta remover essas linhas. </p><br><p>  <code>if (!Update())</code> - o método <code>Update</code> em nossas instruções funcionará exatamente como <code>keepWaiting</code> em <code>CustomYieldInstruction</code> e deve ser implementado em uma classe filho.  <code>Instruction</code> é apenas um método abstrato. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Código de instrução completo</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Instruction</span></span> : <span class="hljs-title"><span class="hljs-title">IEnumerator</span></span>, <span class="hljs-title"><span class="hljs-title">IInstruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Instruction current; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> IEnumerator.Current =&gt; current; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> routine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Parent { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExecuting { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsPaused { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsStopped { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Started; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Paused; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Terminated; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;Instruction&gt; Done; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IEnumerator.Reset() { IsPaused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; IsStopped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; routine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IEnumerator.MoveNext() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsStopped) { (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IEnumerator).Reset(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsExecuting) { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; routine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(); OnStarted(); Started?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsPaused) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Update()) { OnDone(); Done?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); IsStopped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Instruction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">)</span></span> =&gt; Parent = parent; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pause</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsExecuting &amp;&amp; !IsPaused) { IsPaused = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; OnPaused(); Paused?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Resume</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IsPaused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; OnResumed(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Terminate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Stop()) { OnTerminated(); Terminated?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsExecuting) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (routine <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Coroutine) Parent.StopCoroutine(routine <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Coroutine); (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IEnumerator).Reset(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsStopped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is currently waiting for another one and can't be stared right now."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsExecuting) { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; routine = Parent.StartCoroutine(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is already executing."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is currently waiting for another one and can't be stared right now."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsExecuting) { IsExecuting = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; routine = (Parent = parent).StartCoroutine(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">$"Instruction </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ GetType().Name}</span></span></span><span class="hljs-string"> is already executing."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Reset</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Terminate(); Started = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Paused = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Terminated = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Done = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPaused</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnResumed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTerminated</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDone</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> </div></div><br><h2 id="primery">  Exemplos </h2><br><p>  A classe base está pronta.  Para criar qualquer instrução, basta herdá-la e implementar os membros necessários.  Sugiro dar uma olhada em alguns exemplos. </p><br><h3 id="peredvizhenie-k-tochke">  Mover para o ponto </h3><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">Instruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform Transform { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 Target { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Speed { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Threshold { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveToPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parent</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Transform.position = Vector3.Lerp(Transform.position, Target, Time.deltaTime * Speed); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vector3.Distance(Transform.position, Target) &gt;= Threshold; } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Opções de inicialização</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> move = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MoveToPoint(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { Actor = transform, Target = target, Speed = <span class="hljs-number"><span class="hljs-number">1.0F</span></span>, Threshold = <span class="hljs-number"><span class="hljs-number">0.05F</span></span> }; move.Execute(); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> move = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MoveToPoint(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); move.Execute(transform, target, <span class="hljs-number"><span class="hljs-number">1.0F</span></span>, <span class="hljs-number"><span class="hljs-number">0.05F</span></span>); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveToPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span></span><span class="hljs-function">)</span></span> { Actor = transform, Target = target, Speed = <span class="hljs-number"><span class="hljs-number">1.0F</span></span>, Threshold = <span class="hljs-number"><span class="hljs-number">0.05F</span></span> }; }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> move = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MoveToPoint(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { Actor = transform, Target = target, Speed = <span class="hljs-number"><span class="hljs-number">1.0F</span></span>, Threshold = <span class="hljs-number"><span class="hljs-number">0.05F</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> move; }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> move = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MoveToPoint(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> move.Execute(transform, target, <span class="hljs-number"><span class="hljs-number">1.0F</span></span>, <span class="hljs-number"><span class="hljs-number">0.05F</span></span>); }</code> </pre> </div></div><br><h3 id="obrabotka-vvoda">  Processamento de entrada </h3><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaitForKeyDown</span></span> : <span class="hljs-title"><span class="hljs-title">Instruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KeyCode Key { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !Input.GetKeyDown(Key); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForKeyDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parent</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">KeyCode key</span></span></span><span class="hljs-function">)</span></span> { Key = key; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Execute(); } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Exemplos de Lançamento</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { car wait = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WaitForKeyDown(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); wait.Execute(KeyCode.Space).Done += (i) =&gt; DoSomething(); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForKeyDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span></span><span class="hljs-function">)</span></span> { Key = KeyCode.Space }; <span class="hljs-comment"><span class="hljs-comment">// do something; }</span></span></code> </pre> </div></div><br><h3 id="ozhidanie-i-pauza">  Aguarde e faça uma pausa </h3><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Wait</span></span> : <span class="hljs-title"><span class="hljs-title">Instruction</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Delay { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> startTime; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Time.time - startTime &lt; Delay; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Wait</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour parent</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parent</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Wait</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delay, MonoBehaviour parent</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parent</span></span></span><span class="hljs-function">)</span></span> { Delay = delay; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { startTime = Time.time; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Instruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delay</span></span></span><span class="hljs-function">)</span></span> { Delay = delay; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Execute(); } }</code> </pre> <br><p>  Aqui, ao que parece, tudo é o mais simples possível.  Primeiro, registramos a hora de início e depois verificamos a diferença entre a hora atual e o <code>StartTime</code> .  Mas há uma nuance que você não pode perceber imediatamente.  Se durante a execução de uma instrução você a pausar (usando o método <code>Pause</code> ) e aguardar, depois de reiniciar ( <code>Resume</code> ), ela será executada instantaneamente.  E tudo porque agora esta instrução não leva em conta que eu posso pausá-la. </p><br><p>  Vamos tentar consertar essa injustiça: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPaused</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Delay -= Time.time - startTime; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnResumed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { startTime = Time.time; }</code> </pre> <br><p>  Feito.  Agora, após o final da pausa, a instrução continuará sendo executada pelo tempo que faltava antes de começar. </p><br><div class="spoiler">  <b class="spoiler_title">Exemplos de Lançamento</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wait = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Wait(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); wait.Execute(<span class="hljs-number"><span class="hljs-number">5.0F</span></span>).Done += (i) =&gt; DoSomething; }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Wait</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5.0F</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-comment"><span class="hljs-comment">// do something; }</span></span></code> </pre> </div></div><br><h2 id="itog">  Sumário </h2><br><p>  As corotinas no Unity permitem fazer coisas surpreendentes e funcionais.  Mas quão complexas elas serão e se você precisa delas é a escolha pessoal de todos. </p><br><p>  Estender a funcionalidade do corutin não é a tarefa mais difícil.  Tudo que você precisa fazer é decidir qual interface você deseja interagir com eles e qual será o algoritmo do trabalho deles. </p><br><p>  Obrigado pelo seu tempo.  Deixe suas perguntas / comentários / acréscimos nos comentários.  Ficarei feliz em me comunicar. </p><br><hr><br><p>  PS Se, de repente, você se cansou de usar corutin, leia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este</a> comentário e beba algo legal. <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt442820/">https://habr.com/ru/post/pt442820/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt442810/index.html">Mitos da Física Popular, continuação: Gravidade</a></li>
<li><a href="../pt442812/index.html">"Não vejo razão para usar o Python para trabalhar com o Spark, exceto a preguiça"</a></li>
<li><a href="../pt442814/index.html">10 anos se passaram e ninguém descobriu como usar o blockchain. E aqui de novo?</a></li>
<li><a href="../pt442816/index.html">Crie seu próprio controlador de jogo</a></li>
<li><a href="../pt442818/index.html">10 erros comuns no inglês escrito e como lidar com eles</a></li>
<li><a href="../pt442822/index.html">Data center no mar e em órbita: eles têm significado prático?</a></li>
<li><a href="../pt442824/index.html">Bem-vindo ao Vale do Silício</a></li>
<li><a href="../pt442826/index.html">Engenharia social como dramaturgia, ou o que o domínio de phishing e o rifle Chekhov têm em comum</a></li>
<li><a href="../pt442828/index.html">Gerenciamento de TI sem nós e com problemas</a></li>
<li><a href="../pt442830/index.html">Criador de Anubis preso</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>