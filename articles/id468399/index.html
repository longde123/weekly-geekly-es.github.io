<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤞🏼 🍿 🖐🏿 C / C ++. Cara menggunakan sumber daya aplikasi tertanam saat bekerja di GCC di Linux 😮 📔 📐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya ingin entah bagaimana menggunakan sumber daya tertanam Linux, apalagi, secara otomatis. Secara umum, tugasnya adalah ini: 


1. Ada program proye...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C / C ++. Cara menggunakan sumber daya aplikasi tertanam saat bekerja di GCC di Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468399/"><p>  Saya ingin entah bagaimana menggunakan sumber daya tertanam Linux, apalagi, secara otomatis.  Secara umum, tugasnya adalah ini: </p><br><ol><li>  Ada program proyek Eclipse di C ++. </li><li>  OS: Linux Ubuntu.  Kompiler: G ++ </li><li>  Proyek ini menggunakan data dari file eksternal: string pelokalan, kueri SQL, gambar, suara, dll. </li><li>  Semua sumber daya harus tertanam dalam file yang dapat dieksekusi, karena program ini direncanakan untuk didistribusikan sebagai perangkat portabel. </li><li>  Selain itu, saya ingin prosesnya seotomatis mungkin, karena malas. </li></ol><a name="habracut"></a><br><p> Untuk mulai dengan, pencarian di forum menyediakan beberapa cara yang mungkin untuk menyelesaikan masalah.  Di antara yang ditemukan sebagai yang paling universal, menurut saya, saya menggunakan <code>--format=binary</code> " <code>--format=binary</code> " " <code>ld</code> ".  Posting forum menjanjikan tim formulir: <br><br></p><pre> <code class="bash hljs">g++ -Wl,--format=binary -Wl,my.res -Wl,--format=default</code> </pre> <br>  akan menautkan file "my.res" ke aplikasi dan membuat dua karakter - <code>_binary_my_res_start</code> dan <code>_binary_my_res_end</code> , yang mengindikasikan, masing-masing, awal dan akhir dari data yang sama yang ada di file yang ditautkan.  Oleh karena itu, mengakses data dari C ++ dapat dilakukan seperti ini: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> my_res_start[] <span class="hljs-keyword"><span class="hljs-keyword">asm</span></span>(<span class="hljs-string"><span class="hljs-string">"_binary_my_res_start"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> my_res_end[] <span class="hljs-keyword"><span class="hljs-keyword">asm</span></span>(<span class="hljs-string"><span class="hljs-string">"_binary_my_res_end"</span></span>);</code> </pre><br><p>  Tapi itu dia.  Kami menulis semuanya sebagaimana mestinya, dan kompiler tidak senang.  Simbol <code>«_binary_my_res_start»</code> , Anda lihat, tidak dapat ditemukan.  Yah, tidak ada, <code>nm</code> untuk membantu kami.  Kami menulis perintah berikut: <br><br></p><pre> <code class="bash hljs">nm MyProgramm |grep -w -o -P -e <span class="hljs-string"><span class="hljs-string">'_binary_[\w\d_]+'</span></span></code> </pre> <br>  Dan kita mendapatkan: <br><br><pre> <code class="bash hljs">_binary__home_unknown_workspace_MyProgramm_res_my_res_sql_end _binary__home_unknown_workspace_MyProgramm_res_my_res_sql_start</code> </pre><br><p>  Ternyata nama simbol tersebut mencakup seluruh jalur ke sana, yang, di masa depan, dapat mengarah pada kebutuhan untuk menulis ulang konstan file header yang berisi tautan ke sumber daya.  Masalahnya terpecahkan jika skrip berikut ditambahkan ke acara PostBuild di pengaturan proyek Eclipse: <br><br></p><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash OUTPUT=$1/resources.h printf '#ifndef __RESOURCES_H__\n' &gt; "$OUTPUT" printf '#define __RESOURCES_H__\n\n' &gt;&gt; "$OUTPUT" printf '#include &lt;inttypes.h&gt;\n\n' &gt;&gt; "$OUTPUT" SYMBOLS=$(nm NewsParser |grep -w -o -P -e '_binary_[\w\d_]+') &gt;&gt; "$OUTPUT" VAR_SIZES_LIST='' for SYMBOL in $SYMBOLS do VAR_NAME=$(echo $SYMBOL | grep -o -P -e 'res_[\w\d_]+'|cut -c 5-) if [[ -z $(echo $SYMBOL|grep _size) ]] then printf '\textern const uint8_t '$VAR_NAME'[]\tasm("'$SYMBOL'");\n\n' &gt;&gt; "$OUTPUT" else START_VAR=$(echo $VAR_NAME|rev|cut -c 5-|rev)'start' END_VAR=$(echo $VAR_NAME|rev|cut -c 5-|rev)'end' VAR_SIZES_LIST=$VAR_SIZES_LIST$(printf '\\tconst uint64_t '$VAR_NAME'\\t=\\t'$END_VAR' - '$START_VAR';\\n\\n') fi done printf "$VAR_SIZES_LIST" &gt;&gt; "$OUTPUT" printf '#endif\n' &gt;&gt; "$OUTPUT" printf 'File '$OUTPUT' is generated.\n'</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Cara menambahkan skrip “update_resource.sh”, yang merupakan root dari proyek, ke acara PostBuild di pengaturan proyek Eclipse.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xg/iw/t6/xgiwt6ysf51nfgqvv3w-knrabea.png"><br></div></div><br>  Bagus  Sekarang file header akan seperti baru setiap kali, dan Anda dapat mengakses data dengan nama variabel yang tidak akan berubah kecuali jika Anda mengubah nama file sumber itu sendiri.  Selain itu, skrip ini menghitung ukuran untuk setiap sumber daya.  Tidak hanya membawa pointer ke awal dari pointer ke akhir adalah masalah besar, tetapi, bagaimanapun, itu lebih nyaman. <br><br><p>  Tapi ini, untuk saat ini, belum semuanya.  Lagi pula, menambahkan setiap sumber daya baru ke proyek akan berubah menjadi AD berbentuk.  Dan masalah ini juga dapat diselesaikan dengan bantuan skrip, hanya pada tahap penautan: <br><br></p><pre> <code class="bash hljs">FLAGS=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> OUTPUT_FLAG=<span class="hljs-variable"><span class="hljs-variable">$2</span></span> OUTPUT_PREFIX=<span class="hljs-variable"><span class="hljs-variable">$3</span></span> OUTPUT=<span class="hljs-variable"><span class="hljs-variable">$4</span></span> INPUTS=<span class="hljs-variable"><span class="hljs-variable">$5</span></span> RESOURCE_PATH=<span class="hljs-variable"><span class="hljs-variable">$6</span></span> RESOURCES=<span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> res_file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $(ls <span class="hljs-variable"><span class="hljs-variable">$RESOURCE_PATH</span></span>/*) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> RESOURCES=<span class="hljs-variable"><span class="hljs-variable">$RESOURCES</span></span><span class="hljs-string"><span class="hljs-string">' '</span></span>-Wl,<span class="hljs-variable"><span class="hljs-variable">$res_file</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span><span class="hljs-variable"><span class="hljs-variable">$res_file</span></span><span class="hljs-string"><span class="hljs-string">'   '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> g++ <span class="hljs-variable"><span class="hljs-variable">$FLAGS</span></span> <span class="hljs-variable"><span class="hljs-variable">$OUTPUT_FLAG</span></span> <span class="hljs-variable"><span class="hljs-variable">$OUTPUT_PREFIX</span></span><span class="hljs-variable"><span class="hljs-variable">$OUTPUT</span></span> <span class="hljs-variable"><span class="hljs-variable">$INPUTS</span></span> -Wl,--format=binary <span class="hljs-variable"><span class="hljs-variable">$RESOURCES</span></span> -Wl,--format=default</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Cara mengganti panggilan tautan standar dengan skrip khusus di pengaturan proyek Eclipse.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/--/k_/nx/--k_nxk9lebtel3krzbtxzx87aw.png"><br><br><ul><li>  Tempat <font color="red">berwarna merah</font> ditandai pada gambar, di mana alih-alih perintah standar untuk memanggil penghubung, jalur ke skrip “link.sh” terletak di akar proyek. </li><li>  <font color="green">Hijau</font> dalam gambar adalah tempat di mana linker lain ditambahkan ke parameter linker biasa, yang memberi tahu script lokasi direktori dengan sumber daya. </li><li>  <font color="blue">Selain itu</font> , penting untuk tidak lupa membungkus parameter yang tersisa dengan tanda kutip ganda sehingga mereka tidak sengaja memecah dengan spasi dalam urutan yang salah di mana skrip menunggu mereka. </li></ul><br></div></div><br>  Bagus  Sekarang semua file yang ada di subdirektori "res" akan dengan sendirinya jatuh ke sumber daya selama setiap perakitan. <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id468399/">https://habr.com/ru/post/id468399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id468387/index.html">Intisari materi menarik untuk pengembang ponsel # 316 (pada 16 - 22 September)</a></li>
<li><a href="../id468389/index.html">Artyom Galonsky, STO Biro Biro: "Saya menentang hal seperti insinyur DevOps"</a></li>
<li><a href="../id468393/index.html">Dengan mikrokontroler yang baik dan waktu berlalu dengan cepat atau osiloskop akhir pekan</a></li>
<li><a href="../id468395/index.html">Pemantauan Keamanan Cloud. Bagian 2</a></li>
<li><a href="../id468397/index.html">Berita dari dunia OpenStreetMap No. 477 (09/03/2019 - 09.09.2019)</a></li>
<li><a href="../id468401/index.html">Cara aman untuk bertukar JWT di ASP.NET Core + SPA</a></li>
<li><a href="../id468403/index.html">Kontrol runtime aplikasi perangkat lunak internal</a></li>
<li><a href="../id468405/index.html">Dua browser masuk entah ke mana scrollbar ...</a></li>
<li><a href="../id468407/index.html">5G - teknologi yang cenderung memperlambat web</a></li>
<li><a href="../id468409/index.html">Pekerja Layanan dalam Klien Slack: Pada Percepatan Unduhan dan Mode Offline</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>