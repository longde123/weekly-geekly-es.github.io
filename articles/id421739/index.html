<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👰🏼 🎿 👅 Bagaimana saya mengganti RxJava dengan coroutine di proyek saya dan mengapa Anda mungkin juga harus melakukan ini 👨🏽‍🎨 👩🏿‍🎨 ❕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Saya mempersembahkan kepada Anda terjemahan sebuah artikel oleh Paulo Sato tentang penggunaan Kotlin Coroutines alih-alih RxJava dalam pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana saya mengganti RxJava dengan coroutine di proyek saya dan mengapa Anda mungkin juga harus melakukan ini</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421739/">  Halo, Habr!  Saya mempersembahkan kepada Anda terjemahan sebuah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> oleh Paulo Sato tentang penggunaan Kotlin Coroutines alih-alih RxJava dalam proyek Android mereka. <br><br>  RxJava sebagai bazooka, sebagian besar aplikasi bahkan tidak menggunakan setengah daya tembaknya.  Artikel ini akan membahas cara menggantinya dengan coroutine Kotlin (coroutine). <br><br>  Saya telah bekerja dengan RxJava selama beberapa tahun.  Ini jelas merupakan salah satu perpustakaan terbaik untuk setiap proyek Android, yang masih mengejutkan saat ini, terutama jika Anda pemrograman di Jawa.  Jika Anda menggunakan Kotlin, maka kita dapat mengatakan bahwa kota ini memiliki sheriff baru. <br><br>  Sebagian besar menggunakan RxJava hanya untuk mengontrol utas dan untuk mencegah panggilan balik neraka (jika Anda tidak tahu apa itu, anggap diri Anda beruntung dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">itulah sebabnya</a> ).  Faktanya adalah bahwa kita harus ingat bahwa kekuatan sebenarnya dari RxJava adalah pemrograman reaktif dan tekanan balik.  Jika Anda menggunakannya untuk mengontrol permintaan asinkron, Anda menggunakan bazoka untuk membunuh laba-laba.  Dia akan melakukan pekerjaannya, tapi itu berlebihan. <br><br>  Salah satu kekurangan RxJava adalah jumlah metode.  Ini sangat besar dan cenderung menyebar ke seluruh kode.  Di Kotlin, Anda bisa menggunakan coroutine untuk mengimplementasikan sebagian besar perilaku yang Anda buat sebelumnya menggunakan RxJava. <br><br>  Tapi ... apa itu coroutine? <br><br>  Corutin adalah cara untuk menangani tugas kompetitif di utas.  Utas akan berfungsi sampai dihentikan dan konteksnya akan berubah untuk setiap coroutine tanpa membuat utas baru. <br>  Coroutine di Kotlin masih eksperimental, tetapi mereka dimasukkan dalam Kotlin 1.3, jadi saya menulis kelas UseCase baru (untuk arsitektur bersih) dengan menggunakannya di bawah ini.  Dalam contoh ini, panggilan coroutine dienkapsulasi dalam satu file.  Dengan demikian, layer lain tidak akan bergantung pada coroutine yang dieksekusi, memberikan arsitektur yang lebih terputus. <br><a name="habracut"></a><br><pre><code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** * (C) Copyright 2018 Paulo Vitor Sato Open Source Project * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. * */</span></span> package com.psato.devcamp.interactor.usecase <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> kotlinx.coroutines.experimental.* <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> kotlinx.coroutines.experimental.android.UI <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> kotlin.coroutines.experimental.CoroutineContext <span class="hljs-comment"><span class="hljs-comment">/** * Abstract class for a Use Case (Interactor in terms of Clean Architecture). * This interface represents a execution unit for different use cases (this means any use case * in the application should implement this contract). * &lt;p&gt; * By convention each UseCase implementation will return the result using a coroutine * that will execute its job in a background thread and will post the result in the UI thread. */</span></span> abstract <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> UseCase&lt;T&gt; { protected var parentJob: Job = Job() //var backgroundContext: CoroutineContext = IO var backgroundContext: CoroutineContext = CommonPool var foregroundContext: CoroutineContext = UI protected abstract suspend fun executeOnBackground(): T fun <span class="hljs-keyword"><span class="hljs-keyword">execute</span></span>(onComplete: (T) -&gt; Unit, onError: (Throwable) -&gt; Unit) { parentJob.cancel() parentJob = Job() launch(foregroundContext, parent = parentJob) { try { val result = withContext(backgroundContext) { executeOnBackground() } onComplete.invoke(result) } catch (e: CancellationException) { <span class="hljs-keyword"><span class="hljs-keyword">Log</span></span>.d("UseCase", "canceled by user") } catch (e: <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>) { onError(e) } } } protected suspend fun &lt;X&gt; background(context: CoroutineContext = backgroundContext, block: suspend () -&gt; X): <span class="hljs-keyword"><span class="hljs-keyword">Deferred</span></span>&lt;X&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> async(context, parent = parentJob) { block.invoke() } } fun unsubscribe() { parentJob.cancel() } }</code> </pre> <br>  Pertama-tama, saya membuat tugas orang tua.  Ini adalah kunci untuk membatalkan semua coroutine yang dibuat di kelas UseCase.  Ketika kami memanggil eksekusi, penting agar tugas lama dibatalkan, untuk memastikan bahwa kami tidak melewatkan satu coroutine (ini juga akan terjadi jika kami berhenti berlangganan dari UseCase ini). <br><br>  Juga, saya meminta startup (UI).  Ini berarti bahwa saya ingin membuat coroutine yang akan dieksekusi di utas UI.  Setelah itu, saya memanggil metode latar belakang yang menciptakan async di CommonPool (pendekatan ini sebenarnya akan memiliki kinerja yang buruk).  Pada gilirannya, async akan mengembalikan Deffered, dan kemudian, saya akan memanggil metode menunggu.  Dia menunggu penyelesaian coroutine latar belakang, yang akan membawa hasil atau kesalahan. <br><br>  Ini dapat digunakan untuk mengimplementasikan sebagian besar semua yang kami lakukan dengan RxJava.  Berikut ini beberapa contohnya. <br><br><h4>  <b>Peta</b> </h4><br>  Saya mengunduh hasil pencarianShow dan mengubahnya untuk mengembalikan nama pertunjukan pertama. <br>  Kode RxJava: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SearchShows</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UseCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ShowRepository showRepository; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ResourceRepository resourceRepository; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String query; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchShows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ShowRepository showRepository, ResourceRepository resourceRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showRepository = showRepository; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.resourceRepository = resourceRepository; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setQuery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String query)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.query = query; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Single&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildUseCaseObservable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> showRepository.searchShow(query).map(showInfos -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (showInfos != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; !showInfos.isEmpty() &amp;&amp; showInfos.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getShow() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> showInfos.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getShow().getTitle(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resourceRepository.getNotFoundShow(); } }); } }</code> </pre><br>  Kode Coroutine: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SearchShows</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> showRepository: ShowRepository, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resourceRepository: ResourceRepository) : UseCase&lt;String&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> query: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeOnBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String { query?.let { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> showsInfo = showRepository.searchShow(it) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> showName: String? = showsInfo?.getOrNull(<span class="hljs-number"><span class="hljs-number">0</span></span>)?.show?.title <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> showName ?: resourceRepository.notFoundShow } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> } }</code> </pre><br><h4>  <b>ZIP</b> </h4><br>  Zip akan mengambil dua emisi dari Observer dan menyatukannya dalam emisi baru.  Perhatikan bahwa dengan RxJava Anda harus menentukan untuk melakukan panggilan secara paralel menggunakan subscribeOn di masing-masing Tunggal.  Kami ingin mendapatkan keduanya secara bersamaan dan mengembalikannya bersama. <br><br>  Kode RxJava: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ShowDetail</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UseCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ShowRepository showRepository; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String id; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchShows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ShowRepository showRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showRepository = showRepository; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Single&lt;Show&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildUseCaseObservable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Single&lt;ShowDetail&gt; singleDetail = showRepository.showDetail(id).subscribeOn(Schedulers.io()); Single&lt;ShowBanner&gt; singleBanner = showRepository.showBanner(id).subscribeOn(Schedulers.io()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Single.zip(singleDetail, singleBanner, (detail, banner) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Show(detail,banner)); }</code> </pre><br>  Kode Coroutine: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SearchShows</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> showRepository: ShowRepository, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resourceRepository: ResourceRepository) : UseCase&lt;Show&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeOnBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Show { id?.let { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> showDetail = background{ showRepository.showDetail(it) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> showBanner = background{ showRepository.showBanner(it) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Show(showDetail.await(), showBanner.await()) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Show() } }</code> </pre><br><h4>  <b>Flatmap</b> </h4><br>  Dalam hal ini, saya mencari acara yang memiliki string kueri dan untuk setiap hasil (terbatas pada 200 hasil), saya juga mendapatkan peringkat acara tersebut.  Pada akhirnya, saya mengembalikan daftar acara dengan peringkat yang sesuai. <br><br>  Kode RxJava: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SearchShows</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UseCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ShowRepository showRepository; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String query; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchShows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ShowRepository showRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showRepository = showRepository; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setQuery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String query)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.query = query; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Single&lt;List&lt;ShowResponse&gt;&gt; buildUseCaseObservable() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> showRepository.searchShow(query).flatMapPublisher( (Function&lt;List&lt;ShowInfo&gt;, Flowable&lt;ShowInfo&gt;&gt;) Flowable::fromIterable) .flatMapSingle((Function&lt;ShowInfo, SingleSource&lt;ShowResponse&gt;&gt;) showInfo -&gt; showRepository.showRating(showInfo.getShow().getIds().getTrakt()) .map(rating -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ShowResponse(showInfo.getShow().getTitle(), rating .getRating())).subscribeOn(Schedulers.io()), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>).toList(); } }</code> </pre><br>  Kode Coroutine: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SearchShows</span></span></span><span class="hljs-class"> </span><span class="hljs-meta"><span class="hljs-class"><span class="hljs-meta">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">constructor</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> showRepository: ShowRepository) : UseCase&lt;List&lt;ShowResponse&gt;&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> query: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeOnBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;ShowResponse&gt; { query?.let { query -&gt; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> showRepository.searchShow(query).map { background { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rating: Rating = showRepository.showRating(it.show!!.ids!!.trakt!!) ShowResponse(it.show.title!!, rating.rating) } }.map { it.await() } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> arrayListOf() } }</code> </pre><br>  Biarkan saya jelaskan.  Menggunakan RxJava, repositori saya mengembalikan satu emisi Daftar, jadi saya perlu beberapa emisi, satu untuk setiap ShowInfo.  Untuk melakukan ini, saya menelepon flatMapPublisher.  Untuk setiap masalah, saya harus menyoroti ShowResponse, dan pada akhirnya kumpulkan semuanya ke dalam daftar. <br><br>  Kita berakhir dengan konstruksi ini: List foreach → (ShowInfo → ShowRating → ShowResponse) → List. <br><br>  Dengan coroutine, saya membuat peta untuk setiap elemen Daftar untuk mengubahnya menjadi Daftar &lt;Disediakan&gt;. <br><br>  Seperti yang Anda lihat, sebagian besar yang kami lakukan dengan RxJava lebih mudah diterapkan dengan panggilan sinkron.  Coroutines bahkan dapat menangani flatMap, yang, saya percaya, adalah salah satu fungsi paling kompleks di RxJava. <br><br>  Sudah diketahui bahwa coroutine bisa ringan (di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini adalah</a> contoh), tetapi hasilnya membingungkan saya.  Dalam contoh ini, RxJava dimulai dalam waktu sekitar 3,1 detik, sementara coroutine membutuhkan waktu sekitar 5,8 detik untuk berjalan di CommonPool. <br><br>  Hasil ini menimbulkan pertanyaan di hadapan saya bahwa mungkin ada sesuatu yang tidak pantas di dalamnya.  Kemudian, saya menemukan ini.  Saya menggunakan panggilan retrofit, yang memblokir aliran. <br><br>  Ada dua cara untuk memperbaiki kesalahan ini, pilihan tergantung pada versi Android Studio yang Anda gunakan.  Di Android Studio 3.1, kita perlu memastikan bahwa kita tidak memblokir utas latar belakang.  Untuk ini, saya menggunakan perpustakaan ini: <br><blockquote>  implementasi 'ru.gildor.coroutines: kotlin-coroutines-retrofit: 0.12.0' <br></blockquote><br>  Kode ini menciptakan ekstensi fungsi Panggilan retrofit untuk menjeda aliran: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T : Any&gt;</span></span></span><span class="hljs-function"> Call</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">await</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> suspendCancellableCoroutine { continuation -&gt; enqueue(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : Callback&lt;T&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(call: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Call</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;?, response: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Response</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">?&gt;)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.isSuccessful) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> body = response.body() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (body == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { continuation.resumeWithException( NullPointerException(<span class="hljs-string"><span class="hljs-string">"Response body is null: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$response</span></span></span><span class="hljs-string">"</span></span>) ) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { continuation.resume(body) } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { continuation.resumeWithException(HttpException(response)) } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(call: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Call</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, t: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Throwable</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// Don't bother with resuming the continuation if it is already cancelled. if (continuation.isCancelled) return continuation.resumeWithException(t) } }) registerOnCompletion(continuation) } }</span></span></code> </pre><br>  Di Android Studio 3.2, Anda dapat memperbarui perpustakaan corutin ke versi 0.25.0.  Versi ini memiliki CoroutineContext IO (Anda dapat melihat komentar yang sesuai di kelas UseCase saya). <br><br>  Berjalan di CommonPool tanpa pemblokiran panggilan memakan waktu 2,3 ​​detik dan 2,4 detik dengan IO dan memblokir panggilan. <br><br><img src="https://cdn-images-1.medium.com/max/1000/1*vUG7SROZLpFXX6PJk8CVmw.png" alt="gambar"><br><br>  Saya harap artikel ini akan menginspirasi Anda untuk menggunakan corutin, alternatif yang lebih ringan dan mungkin lebih cepat untuk RxJava dan membuatnya sedikit lebih mudah untuk memahami bahwa Anda menulis kode tersinkronisasi yang berjalan secara tidak sinkron. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id421739/">https://habr.com/ru/post/id421739/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id421729/index.html">Timlid adalah seorang sersan di divisi IT</a></li>
<li><a href="../id421731/index.html">Berapa biaya untuk membangun perangkat lunak: terdiri dari apa anggaran pengembangan aplikasi</a></li>
<li><a href="../id421733/index.html">Ambillah dan lakukan itu: mengapa kadang-kadang berguna untuk menilai untuk analisis dan hanya mengembangkan</a></li>
<li><a href="../id421735/index.html">"Virus" dalam ekstensi menggunakan FastProxy sebagai contoh</a></li>
<li><a href="../id421737/index.html">Perusahaan Amerika telah memotong karyawannya selama satu tahun sekarang. Mengapa bisa ada masa depan?</a></li>
<li><a href="../id421741/index.html">Mengapa seorang pria di dunia Jawa menjadi pendukung Node.js dan JavaScript yang bersemangat?</a></li>
<li><a href="../id421745/index.html">Bagaimana Ubisoft Meluncurkan Starlink-nya: Battle for Atlas Hybrid Game Suite</a></li>
<li><a href="../id421747/index.html">Parktronic di Arduino</a></li>
<li><a href="../id421749/index.html">“Sangat sedikit yang benar-benar menulis backend di Kotlin” - sebuah wawancara dengan Pasha Finkelstein</a></li>
<li><a href="../id421751/index.html">Editor gratis terbaik untuk pengembangan dan dokumentasi: Atom</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>