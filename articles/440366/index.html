<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐋 ♑️ 🛀🏼 Ciclo de vida de un artículo sobre Habré: escribimos un habraparser 💅🏼 💂🏼 🚚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola habr 

 Muchos lectores y autores habituales del sitio probablemente pensaron en el ciclo de vida de los artículos publicados aquí. Y aunque intu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ciclo de vida de un artículo sobre Habré: escribimos un habraparser</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440366/">  Hola habr <br><br>  Muchos lectores y autores habituales del sitio probablemente pensaron en el ciclo de vida de los artículos publicados aquí.  Y aunque intuitivamente esto es más o menos claro (es obvio, por ejemplo, que el artículo en la primera página tiene el número máximo de visitas), pero ¿cuánto específicamente? <br><br><img src="https://habrastorage.org/webt/_y/ev/-u/_yev-um5ws2wgjqm59zu_uzklca.png"><br><br>  Para recopilar estadísticas, usaremos Python, Pandas, Matplotlib y Raspberry Pi. <br><br>  Aquellos que estén interesados ​​en lo que surgió, por favor, debajo del gato. <a name="habracut"></a><br><br><h2>  Recogida de datos </h2><br>  Primero, decidamos las métricas, lo que queremos saber.  Todo es simple, cada artículo tiene 4 parámetros principales que se muestran en la página: esta es la cantidad de vistas, me gusta, marcadores y comentarios.  Los analizaremos. <br><br>  Aquellos que quieran ver los resultados inmediatamente, pueden pasar a la tercera parte, pero por ahora se tratará de la programación. <br><br>  Plan general: analizaremos los datos necesarios de la página web, los guardaremos con CSV y veremos qué obtenemos durante un período de varios días.  Primero, cargue el texto del artículo (manejo de excepciones omitido para mayor claridad): <br><br><pre><code class="python hljs">link = <span class="hljs-string"><span class="hljs-string">"https://habr.com/ru/post/000001/"</span></span> f = urllib.urlopen(link) data_str = f.read()</code> </pre> <br>  Ahora necesitamos extraer datos de la línea data_str (es, por supuesto, en HTML).  Abra el código fuente en el navegador (se eliminan los elementos sin principios): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post-stats post-stats_post js-user_"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"infopanel_post_438514"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post-stats__item post-stats__item_voting-wjt"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"voting-wjt__counter voting-wjt__counter_positive js-score"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  448: ↑434  ↓14"</span></span></span><span class="hljs-tag">&gt;</span></span>+420<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn_inner"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icon-svg_bookmark"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">use</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xlink:href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://habr.com/images/1550155671/common-svg-sprite.svg#book"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bookmark__counter js-favs_count"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" ,    "</span></span></span><span class="hljs-tag">&gt;</span></span>320<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post-stats__item post-stats__item_views"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post-stats__views"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post-stats__views-count"</span></span></span><span class="hljs-tag">&gt;</span></span>219k<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post-stats__item post-stats__item_comments"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://habr.com/ru/post/438514/#comments"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post-stats__comments-link"</span></span></span><span class="hljs-tag"> &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post-stats__comments-count"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag">&gt;</span></span>577<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post-stats__item"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icon-svg_report"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icon-svg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"32"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"32"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">viewBox</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0 0 32 32"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">aria-hidden</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"img"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">path</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"M0 0h32v32h-32v-32zm14 6v12h4v-12h-4zm0 16v4h4v-4h-4z"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Es fácil ver que el texto que necesitamos está dentro del bloque '&lt;ul class = "post-stats post-stats_post js-user_&gt;', y los elementos necesarios están en bloques con los nombres vote-wjt__counter, bookmark__counter, post-stats__views-count y post- stats__comments-count.  Por nombre, todo es bastante obvio. <br><br>  Heredaremos la clase str y le agregaremos el método de extracción de la subcadena ubicada entre las dos etiquetas: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Str</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(str)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_between</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, first, last)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: start = self.index(first) + len(first) end = self.index(last, start) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Str(self[start:end]) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Str(<span class="hljs-string"><span class="hljs-string">""</span></span>)</code> </pre><br>  Podría prescindir de la herencia, pero esto le permitirá escribir código más conciso.  Con él, toda la extracción de datos cabe en 4 líneas: <br><br><pre> <code class="python hljs">votes = data_str.find_between(<span class="hljs-string"><span class="hljs-string">'span class="voting-wjt__counter voting-wjt__counter_positive js-score"'</span></span>, <span class="hljs-string"><span class="hljs-string">'span'</span></span>).find_between(<span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span>) bookmarks = data_str.find_between(<span class="hljs-string"><span class="hljs-string">'span class="bookmark__counter js-favs_count"'</span></span>, <span class="hljs-string"><span class="hljs-string">'span'</span></span>).find_between(<span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span>) views = data_str.find_between(<span class="hljs-string"><span class="hljs-string">'span class="post-stats__views-count"'</span></span>, <span class="hljs-string"><span class="hljs-string">'span'</span></span>).find_between(<span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span>) comments = data_str.find_between(<span class="hljs-string"><span class="hljs-string">'span class="post-stats__comments-count"'</span></span>, <span class="hljs-string"><span class="hljs-string">'span'</span></span>).find_between(<span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span>)</code> </pre><br>  Pero eso no es todo.  Como puede ver, el número de comentarios o vistas se puede almacenar como una cadena como "12.1k", que no se traduce directamente a int. <br><br>  Agregue una función para convertir dicha cadena en un número: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_int</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> s = self.lower().replace(<span class="hljs-string"><span class="hljs-string">","</span></span>, <span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s[<span class="hljs-number"><span class="hljs-number">-1</span></span>:] == <span class="hljs-string"><span class="hljs-string">"k"</span></span>: <span class="hljs-comment"><span class="hljs-comment"># "1.23k" =&gt; 1.23*1000 =&gt; 1230 return int(1000*float(s.replace("k", ""))) return int(self)</span></span></code> </pre><br>  Solo queda agregar la marca de tiempo, y puede guardar los datos en csv: <br><br><pre> <code class="python hljs">timestamp = strftime(<span class="hljs-string"><span class="hljs-string">"%Y-%m-%dT%H:%M:%S.000"</span></span>, gmtime()) str_out = <span class="hljs-string"><span class="hljs-string">"{},votes:{},bookmarks:{},views:{},comments:{};"</span></span>.format(timestamp, votes.to_int(), bookmarks.to_int(), views.to_int(), comments.to_int())</code> </pre><br>  Como estamos interesados ​​en analizar varios artículos, agregamos la capacidad de especificar un enlace a través de la línea de comando.  También generaremos el nombre del archivo de registro por la ID del artículo: <br><br><pre> <code class="python hljs">link = sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-comment"><span class="hljs-comment"># "https://habr.com/ru/post/000001/" link_path = urlparse.urlparse(link.strip("/")).path # https://habr.com/ru/post/000001/ =&gt; /ru/post/000001 link_parts = os.path.split(link_path) # /ru/post/000001=&gt; ('/ru/post', '000001') log_file = "habr_log%s.txt" % link_parts[1]</span></span></code> </pre><br>  Y el último paso.  Eliminamos el código en la función, en el bucle encuestamos los datos y escribimos los resultados en el registro. <br><br><pre> <code class="python hljs">delay_s = <span class="hljs-number"><span class="hljs-number">5</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-comment"><span class="hljs-comment"># Get data data_str = get_as_str(link) data_csv = extract_as_csv(data_str) print data_csv # Append data to log with open(log_file, "a") as logfile: logfile.write(data_csv + '\n') sleep(delay_s)</span></span></code> </pre><br>  Como puede ver, los datos se actualizaron cada 5 minutos para no crear una carga en el servidor.  Guardé el archivo del programa con el nombre habr_parse.py, cuando se inicie, guardará datos hasta que se cierre el programa. <br><br>  Además, es deseable guardar los datos, al menos durante unos días.  Porque  Somos reacios a mantener la computadora encendida durante varios días, tomamos la Raspberry Pi: es suficiente energía para tal tarea y, a diferencia de una PC, la Raspberry Pi no hace ruido y casi no consume electricidad.  Repasamos SSH y ejecutamos nuestro script: <br><br><pre> <code class="bash hljs">nohup python habr_parse.py https://habr.com/ru/post/0000001/ &amp;</code> </pre><br>  El comando nohup deja el script en segundo plano después de cerrar la consola. <br><br>  Como beneficio adicional, puede ejecutar un servidor http en segundo plano ingresando el comando "nuhup python -m SimpleHTTPServer 8000 &amp;".  Esto le permitirá ver los resultados directamente en el navegador en cualquier momento, abriendo un enlace del formulario <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://192.168.1.101:8000</a> (la dirección, por supuesto, puede ser diferente). <br><br>  Ahora puede dejar la Raspberry Pi encendida y volver al proyecto en unos días. <br><br><h2>  Análisis de datos </h2><br>  Si todo se hizo correctamente, la salida debería ser algo así como este registro: <br><br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span>T22:<span class="hljs-number"><span class="hljs-number">26</span></span>:<span class="hljs-number"><span class="hljs-number">28.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">12</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">0</span></span>,views:<span class="hljs-number"><span class="hljs-number">448</span></span>,comments:<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span>T22:<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-number"><span class="hljs-number">29.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">12</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">0</span></span>,views:<span class="hljs-number"><span class="hljs-number">467</span></span>,comments:<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span>T22:<span class="hljs-number"><span class="hljs-number">36</span></span>:<span class="hljs-number"><span class="hljs-number">30.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">14</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">1</span></span>,views:<span class="hljs-number"><span class="hljs-number">482</span></span>,comments:<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span>T22:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">30.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">14</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">2</span></span>,views:<span class="hljs-number"><span class="hljs-number">497</span></span>,comments:<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span>T22:<span class="hljs-number"><span class="hljs-number">46</span></span>:<span class="hljs-number"><span class="hljs-number">31.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">14</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">2</span></span>,views:<span class="hljs-number"><span class="hljs-number">513</span></span>,comments:<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span>T22:<span class="hljs-number"><span class="hljs-number">51</span></span>:<span class="hljs-number"><span class="hljs-number">32.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">14</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">2</span></span>,views:<span class="hljs-number"><span class="hljs-number">527</span></span>,comments:<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span>T22:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">32.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">14</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">2</span></span>,views:<span class="hljs-number"><span class="hljs-number">543</span></span>,comments:<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span>T23:<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">33.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">14</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">2</span></span>,views:<span class="hljs-number"><span class="hljs-number">557</span></span>,comments:<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span>T23:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">34.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">14</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">2</span></span>,views:<span class="hljs-number"><span class="hljs-number">567</span></span>,comments:<span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span>T23:<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">35.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">13</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">2</span></span>,views:<span class="hljs-number"><span class="hljs-number">590</span></span>,comments:<span class="hljs-number"><span class="hljs-number">4</span></span>; ... <span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">47</span></span>:<span class="hljs-number"><span class="hljs-number">03.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">15</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">3</span></span>,views:<span class="hljs-number"><span class="hljs-number">1100</span></span>,comments:<span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>T02:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">04.000</span></span>,votes:<span class="hljs-number"><span class="hljs-number">15</span></span>,bookmarks:<span class="hljs-number"><span class="hljs-number">3</span></span>,views:<span class="hljs-number"><span class="hljs-number">1200</span></span>,comments:<span class="hljs-number"><span class="hljs-number">20</span></span>;</code> </pre><br>  Veamos cómo se puede procesar.  Para comenzar, cargue csv en un marco de datos de pandas: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime log_path = <span class="hljs-string"><span class="hljs-string">"habr_data.txt"</span></span> df = pd.read_csv(log_path, header=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, names=[<span class="hljs-string"><span class="hljs-string">'datetime'</span></span>, <span class="hljs-string"><span class="hljs-string">'votes'</span></span>, <span class="hljs-string"><span class="hljs-string">'bookmarks'</span></span>, <span class="hljs-string"><span class="hljs-string">'views'</span></span>, <span class="hljs-string"><span class="hljs-string">'comments'</span></span>])</code> </pre><br>  Agregue funciones para la conversión y el promedio, y extraiga los datos necesarios: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_float</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># "bookmarks:22" =&gt; 22.0 num = ''.join(i for i in s if i.isdigit()) return float(num) def running_mean(l, N=2): sum = 0 result = len(l)*[0] for i in range(0, N): sum = sum + l[i] result[i] = sum / (i + 1) for i in range(N, len(l)): sum = sum - l[i - N] + l[i] result[i] = sum / N return result log_path = "habr_data.txt" df = pd.read_csv(log_path, header=None, names=['datetime', 'votes', 'bookmarks', 'views', 'comments']) print df.head() dates = pd.to_datetime(df['datetime'], format='%Y-%m-%dT%H:%M:%S.%f') dates += datetime.timedelta(hours=3) views = df["views"].map(to_float, na_action=None) views_avg = running_mean(views.values.tolist()) votes = df["votes"].map(to_float, na_action=None) bookmarks = df["bookmarks"].map(to_float, na_action=None) comments = df["comments"].map(to_float, na_action=None) viewspervotes = views/votes viewsperbookmarks = views/bookmarks</span></span></code> </pre><br>  El promedio es necesario porque el número de vistas en el sitio se muestra en incrementos de 100, lo que conduce a un horario "desgarrado".  En principio, esto no es necesario, pero con el promedio se ve mejor.  La zona horaria de Moscú también se agrega en el código (la hora en el Raspberry Pi resultó ser GMT). <br><br>  Finalmente, puede mostrar los gráficos y ver qué sucedió. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt <span class="hljs-comment"><span class="hljs-comment"># Draw fig, ax = plt.subplots() # plt.plot(dates, votes, 'ro', markersize=1, label='Votes') # plt.plot(dates, bookmarks, 'go', markersize=1, label='Bookmarks') # plt.plot(dates, comments, 'go', markersize=1, label='Comments') ax.plot(dates, views_avg, 'bo', markersize=1, label='Views') # plt.plot(dates, views_g, 'bo', markersize=1, label='Views') # plt.plot(dates, viewspervotes, 'ro', markersize=1, label='Views/Votes') # plt.plot(dates, viewsperbookmarks, 'go', markersize=1, label='Views/Bookmarks') ax.xaxis.set_major_formatter(mdates.DateFormatter("%d-%d-%Y")) ax.xaxis.set_major_locator(mdates.DayLocator()) ax.xaxis.set_minor_locator(mdates.HourLocator(interval=1)) fig.autofmt_xdate() plt.legend(loc='best') plt.xticks(rotation=45, ha="right") plt.tight_layout() plt.show()</span></span></code> </pre><br><h2>  Resultados </h2><br>  Al comienzo de cada gráfico hay un espacio vacío, que se explica simplemente: cuando se lanzó el script, los artículos ya estaban publicados, por lo que los datos no se recopilaron desde cero.  El punto "cero" se agregó manualmente a partir de la descripción del tiempo de publicación del artículo. <br><br>  Todos los gráficos presentados son generados por matplotlib y el código anterior. <br><br>  Según los resultados, dividí los artículos investigados en 3 grupos.  La división es condicional, aunque todavía tiene algún sentido. <br><br><h4>  Artículo caliente </h4><br>  Este artículo trata sobre un tema popular y relevante, con un título como "Cómo MTS deduce dinero" o "Roskomnadzor bloqueó <s>el</s> centro de git <s>porno</s> ". <br><br>  Dichos artículos tienen una gran cantidad de puntos de vista y comentarios, pero el "bombo" dura un máximo de varios días.  También puede ver una ligera diferencia en el crecimiento en el número de vistas durante el día y la noche (pero no tan significativo como se esperaba, aparentemente, Habr se lee desde casi todas las zonas horarias). <br><br><img src="https://habrastorage.org/webt/fk/2n/u9/fk2nu9lkkekbnziiikyhgm1virq.png"><br><br><img src="https://habrastorage.org/webt/4b/de/tz/4bdetzaosgzh76gh-05id_hwrke.png"><br><br>  El número de "me gusta" está creciendo significativamente, mientras que el número de marcadores está disminuyendo notablemente.  Esto es lógico porque  A alguien le puede gustar el artículo, pero la especificidad del texto es tal que simplemente no es necesario marcarlo. <br><br><img src="https://habrastorage.org/webt/op/00/0q/op000qawvtsdd70fa62cp0il7ss.png"><br><br>  La proporción de vistas y me gusta sigue siendo aproximadamente la misma y es aproximadamente 400: 1: <br><br><img src="https://habrastorage.org/webt/so/69/ps/so69pssddcef2ehhtcnpzknx4hq.png"><br><br><h4>  Artículo "técnico" </h4><br>  Este es un artículo más especializado, como "Configuración de scripts para el nodo JS".  Tal artículo, por supuesto, gana muchas veces menos visitas que el "hot", el número de comentarios también es notablemente menor (en este caso, solo hubo 4). <br><br><img src="https://habrastorage.org/webt/ni/e7/lk/nie7lkawiivwc73acbkwsnaxclo.png"><br><br><img src="https://habrastorage.org/webt/nv/pc/pi/nvpcpiw5wz0gwno4sxsllsbzubo.png"><br><br>  Pero el siguiente punto es más interesante: el número de "me gusta" para tales artículos está creciendo notablemente más lento que el número de "marcadores".  Aquí es al revés en comparación con la versión anterior: muchos encuentran útil el artículo para guardarlo en el futuro, pero el lector no tiene que hacer clic en "me gusta". <br><br><img src="https://habrastorage.org/webt/ex/cn/v2/excnv2knkpmzaspwst4jdifuu_c.png"><br><br>  Por cierto, en este punto me gustaría llamar la atención de los administradores del sitio: al calcular las calificaciones de los artículos, debe contar los marcadores en paralelo con los me gusta (por ejemplo, combinando conjuntos por OR).  De lo contrario, esto lleva a un sesgo en la calificación, cuando un artículo conocido tiene muchos marcadores (es decir, a los lectores definitivamente les gustó), pero estas personas olvidaron o fueron demasiado flojas para hacer clic en "me gusta". <br><br>  Y finalmente, la proporción de vistas y me gusta: puede ver que es notablemente más alta que en la primera realización y es aproximadamente 150: 1, es decir  La calidad del contenido también puede considerarse indirectamente como superior. <br><br><img src="https://habrastorage.org/webt/e3/xz/36/e3xz36bykgehnt3sinisvblh9_c.png"><br><br><h4>  Artículo "sospechoso" (pero esto no es exacto) </h4><br>  Para el siguiente artículo examinado, el número de "me gusta" aumentó en un tercio en un intervalo de 5 minutos (inmediatamente en 10 con un total de 30 anotados durante todos los días). <br><br><img src="https://habrastorage.org/webt/g1/b-/51/g1b-51eseul3tpennsf2pss7fe0.png"><br><br>  Uno podría sospechar un engaño, pero la "teoría de colas" en principio permite tales oleadas.  O tal vez el autor acaba de enviar el enlace a todos sus 10 amigos, lo que, por supuesto, no está prohibido por las reglas. <br><br><h2>  Conclusiones </h2><br>  La conclusión principal es que todo es descomposición y maya.  Incluso el material más popular, que gana miles de visitas, irá "en el pasado" en solo 3-4 días.  Tales, por desgracia, los detalles de la Internet moderna, y probablemente de toda la industria de los medios modernos en su conjunto.  Y estoy seguro de que las cifras que se muestran son específicas no solo para Habr, sino también para cualquier recurso similar de Internet. <br><br>  De lo contrario, es más probable que este análisis sea de naturaleza "viernes" y, por supuesto, no pretende ser un estudio serio.  También espero que alguien haya encontrado algo nuevo al usar Pandas y Matplotlib. <br><br>  Gracias por su atencion </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440366/">https://habr.com/ru/post/440366/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440356/index.html">Cómo Habr ayuda a cumplir sueños y a recoger pelotas</a></li>
<li><a href="../440358/index.html">Habro suicidio. Disco rural</a></li>
<li><a href="../440360/index.html">¿Bofetada y producción? Porque no</a></li>
<li><a href="../440362/index.html">El scooter eléctrico Xiaomi m365 es susceptible de piratería con la capacidad de controlar de forma remota</a></li>
<li><a href="../440364/index.html">Sabes kilo, mega y concierto. ¿Qué hay de Ronne y Cuecca?</a></li>
<li><a href="../440370/index.html">Términos de servicio: el 99% de los usuarios simplemente no los entienden</a></li>
<li><a href="../440372/index.html">Mi compilador Pascal y arte contemporáneo polaco</a></li>
<li><a href="../440374/index.html">Las funciones de Yandex envían correo</a></li>
<li><a href="../440376/index.html">20 juegos para enseñarle a tu hijo a programar</a></li>
<li><a href="../440378/index.html">Volver a los microservicios con Istio. Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>