<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÅ üî™ ü§µüèº Automatizaci√≥n para los aut√≥nomos: c√≥mo integrar los impuestos con un proyecto de TI ‚òùÔ∏è üèöÔ∏è üêç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El 1 de enero de 2019, se aprob√≥ una ley para cuatro entidades constitutivas de la Federaci√≥n de Rusia (regiones de Mosc√∫, Mosc√∫ y Kaluga, as√≠ como la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatizaci√≥n para los aut√≥nomos: c√≥mo integrar los impuestos con un proyecto de TI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436656/">  El 1 de enero de 2019, se aprob√≥ una ley para cuatro entidades constitutivas de la Federaci√≥n de Rusia (regiones de Mosc√∫, Mosc√∫ y Kaluga, as√≠ como la Rep√∫blica de Tatarst√°n), introduciendo un nuevo Impuesto Profesional (NAP) como un proyecto piloto.  En resumen, su tarea principal es salvar a las figuras profesionales de todas las dificultades de las peque√±as empresas: 6% de impuestos (en el caso de empresarios privados), contribuciones obligatorias de pensi√≥n, cuyo monto cada a√±o solo para una persona se acerca a la marca de 50 mil rublos, declaraci√≥n de impuestos.  Por lo tanto, el estado apoya a las peque√±as empresas al proporcionar a los emprendedores de nueva creaci√≥n un bajo impuesto (4% para los ingresos de las personas y 6% para las entidades legales).  Si desea m√°s detalles, puede ver informaci√≥n detallada en Internet. <br><br>  Incluso las personas que trabajan en el campo de TI tienen derecho a usar NAP.  ¬øC√≥mo puede ayudar esto?  Por ejemplo, si ha desarrollado un servicio que funciona en Internet, desea aceptar pagos.  No tiene que registrar una entidad legal por el bien de dicha actividad empresarial y resolver un mont√≥n de problemas desde el principio.  Es suficiente registrarse como aut√≥nomo y, en libertad condicional, martillar manualmente en cada servicio o producto.  En ese mismo momento, el desarrollador del servicio piensa: "¬øSe puede automatizar este proceso?"  Y la respuesta aqu√≠ es "¬°Por supuesto que puedes!"  El art√≠culo, de hecho, es para decirte c√≥mo hacerlo. <a name="habracut"></a><blockquote>  Nota importante: el autor del art√≠culo utiliza los conocimientos adquiridos como resultado del estudio de la aplicaci√≥n solo para bien: la automatizaci√≥n de la rutina.  √âl quiere los mismos motivos para ti. </blockquote><br><h3>  Paso 1. Identificar el tr√°fico HTTP </h3><br>  Aqu√≠ necesitar√° la aplicaci√≥n oficial del contribuyente "Mi impuesto".  Puedes descargarlo a trav√©s de Google Play. <br><br>  Para este art√≠culo, ser√° suficiente determinar sourceDeviceId (sospecho que esto es lo mismo que el ID de Android) y refreshToken, sin embargo, puede explorar absolutamente todos los m√©todos API propuestos por la aplicaci√≥n para su estudio.  Para determinarlo, debe recibir solicitudes HTTPS desde el tel√©fono inteligente.  Para un dispositivo est√°ndar sin derechos de root, puede usar una computadora, el programa gratuito Fiddler.  Para comprender el trabajo del programa, utilic√© una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gu√≠a</a> no muy actualizada, sin embargo, fue suficiente para interceptar el tr√°fico https del tel√©fono inteligente y mostrar la aplicaci√≥n en la pantalla de la computadora. <br><br>  Despu√©s de instalar todo lo que necesita para registrarse como contribuyente y cerrar la aplicaci√≥n.  Luego active el programa Fiddler, establezca una conexi√≥n proxy en su tel√©fono inteligente y vuelva a iniciar la aplicaci√≥n.  La aplicaci√≥n realizar√° una solicitud de autorizaci√≥n con un token de actualizaci√≥n, que en el momento de este art√≠culo se crea con una duraci√≥n ilimitada: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/56e/95f/110/56e95f11079ba61fb902f9a1872f768c.jpg" alt="imagen"><br><br>  Como puede ver en la captura de pantalla, la aplicaci√≥n tiene el dominio base lknpd.nalog.ru (subdominio del sitio web del servicio de impuestos ruso) y la versi√≥n de API 1. La autorizaci√≥n para los m√©todos es utilizada por Bearer, el token se genera a trav√©s del m√©todo / auth / token.  Los datos de los campos de solicitud sourceDeviceId y refreshToken son extremadamente necesarios para usted.  Verifiqu√© el trabajo de refreshToken 3 d√≠as despu√©s del experimento; funciona, por lo tanto, puede tomar el token de forma segura durante 1 hora, obviamente teniendo un refresco real. <br><br>  El m√©todo de env√≠o de paquetes en s√≠ tiene este aspecto y tiene todos los campos necesarios: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c3/938/bee/8c3938bee0be7d3bc0bfe6fb81065130.jpg" alt="imagen"><br><br>  Tenga en cuenta que todos los campos son obligatorios.  El campo de servicios puede hacer que desee enviar varios servicios en la matriz, sin embargo, solo se mostrar√° el primer servicio en el cheque, aunque el costo final estar√° completo.  A√∫n as√≠, el servicio es bastante h√∫medo, y se lanz√≥ recientemente, no nos detendremos en esto (aunque es una pena, de hecho, a veces son necesarias varias posiciones). <br><br>  Tambi√©n debe prestar atenci√≥n a la respuesta: certifiedReceiptUuid: el campo contiene un c√≥digo de verificaci√≥n √∫nico, que sin ning√∫n problema puede obtenerlo con su TIN y UUID de la verificaci√≥n. <br><br><h3>  Paso 2. Desarrollo de guiones </h3><br>  Para demostrar r√°pidamente el concepto de automatizaci√≥n, Python 3.7.2 se usa con la biblioteca de solicitudes: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> shutil TIME_OFFSET = <span class="hljs-string"><span class="hljs-string">'+03:00'</span></span> DEVICE_ID = <span class="hljs-string"><span class="hljs-string">''</span></span> REFRESH_TOKEN = <span class="hljs-string"><span class="hljs-string">''</span></span> API_PROVIDER = <span class="hljs-string"><span class="hljs-string">'https://lknpd.nalog.ru/api/v1/'</span></span> TOKEN = <span class="hljs-string"><span class="hljs-string">''</span></span> INN = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DO</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(method, params)</span></span></span><span class="hljs-function">:</span></span> headers = {<span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>:<span class="hljs-string"><span class="hljs-string">"Bearer "</span></span>+TOKEN} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> TOKEN != <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {} r = requests.post(API_PROVIDER+method, json=params, headers=headers) print(r.text) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r.json() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_token</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> reqparam = { <span class="hljs-string"><span class="hljs-string">"deviceInfo"</span></span>: { <span class="hljs-string"><span class="hljs-string">"appVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"metaDetails"</span></span>: { <span class="hljs-string"><span class="hljs-string">"browser"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"browserVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"os"</span></span>: <span class="hljs-string"><span class="hljs-string">"android"</span></span> }, <span class="hljs-string"><span class="hljs-string">"sourceDeviceId"</span></span>: DEVICE_ID, <span class="hljs-string"><span class="hljs-string">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"android"</span></span> }, <span class="hljs-string"><span class="hljs-string">"refreshToken"</span></span>: REFRESH_TOKEN } res = DO(<span class="hljs-string"><span class="hljs-string">'auth/token'</span></span>, reqparam) <span class="hljs-comment"><span class="hljs-comment"># </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">  tokenExpireIn       return res['token'] # </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">    TOKEN = get_token() def new_transaction(service, amount): trans_time = datetime.datetime.now().isoformat()[:-3]+TIME_OFFSET reqparam = { "ignoreMaxTotalIncomeRestriction": False, "operationTime": trans_time, "paymentType": "CASH", "requestTime": trans_time, "services": [ { "amount": amount, "name": service, "quantity": 1 } ], "totalAmount": amount } res = DO('income', reqparam) return res['approvedReceiptUuid'] def get_receipt(receipt_uuid): headers = {"Authorization":"Bearer "+TOKEN} r = requests.get( 'https://lknpd.nalog.ru/api/v1/receipt/'+INN+"/"+receipt_uuid+"/print", stream=True, headers=headers ) with open('receipt.png', 'wb') as f: r.raw.decode_content = True shutil.copyfileobj(r.raw, f) if __name__ == '__main__': rec = new_transaction(' ', '1.00') get_receipt(rec)</span></span></code> </pre> <br>  Sustituya los valores requeridos: el script funcionar√° como deber√≠a.  Puede agregar controladores de errores y mejorar la entrega: la secuencia de comandos anterior solo muestra el principio de trabajo con el NAP de API de impuestos. <br><blockquote>  <b>Nota</b> Quiz√°s en el futuro el impuesto publique la API, pero ahora no lo hace solo porque pocas personas lo necesitan.  Por lo tanto, este negocio se pospone hasta m√°s tarde.  Sin embargo, me apresuro a se√±alar que si se publica la gu√≠a oficial, tendr√° informaci√≥n similar o mejorar√° ligeramente, en t√©rminos de autorizaci√≥n, seguro. <br><br>  <b>UPD:</b> Encontr√© documentaci√≥n sobre automatizaci√≥n, que est√° escrita ... se siente como un diputado a mano: muy sofisticado y no estructurado.  Ya habr√° tiempo: escribir√© un art√≠culo decente sobre automatizaci√≥n a trav√©s de la API oficial.  Spoiler: all√≠ todo es casi lo mismo que aprendimos a trav√©s del tr√°fico, solo se describen los m√©todos oficiales con solicitudes de correo electr√≥nico y otras dificultades. </blockquote><br><br><h3>  Conclusi√≥n </h3><br>  En conclusi√≥n, quiero se√±alar: <s>no repitas esto en casa,</s> no hay nada imposible.  Incluso una cosa tan rutinaria puede automatizarse f√°cilmente.  Copie el c√≥digo, modif√≠quelo a su manera.  Quiz√°s entonces implemente la biblioteca para que la automatizaci√≥n sea mucho m√°s accesible para todos.  Espero su cr√≠tica objetiva y contin√∫o investigando la API.  Mi pr√≥ximo objetivo es idealizar el principio de autorizaci√≥n y crear una biblioteca para Python. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es436656/">https://habr.com/ru/post/es436656/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es436646/index.html">Transl√∫cido en Android y ajuste.</a></li>
<li><a href="../es436648/index.html">Combinando proyectos en diferentes centros de datos</a></li>
<li><a href="../es436650/index.html">3 estrategias ganadoras de monetizaci√≥n de aplicaciones en 2019</a></li>
<li><a href="../es436652/index.html">MPS 2018.3: planes de generaci√≥n, mejoras en el lenguaje de ensamblaje y empaquetado y en el lenguaje del editor, interfaz actualizada</a></li>
<li><a href="../es436654/index.html">Desarrollo de un equipo para consultar datos de la base de datos - parte 4, concluyendo</a></li>
<li><a href="../es436658/index.html">El futuro del comercio minorista: tendencias digitales clave basadas en el Big Show 2019 de NRF Retail</a></li>
<li><a href="../es436660/index.html">Mapa de ruta del c√≥digo VS 2019 - BORRADOR</a></li>
<li><a href="../es436662/index.html">1 de febrero de 2019 su sitio puede dejar de funcionar</a></li>
<li><a href="../es436664/index.html">Presentamos la serie .NET Community Standup</a></li>
<li><a href="../es436668/index.html">¬øSe pueden leer las estad√≠sticas con una peque√±a cantidad de datos?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>