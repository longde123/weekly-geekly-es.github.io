<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧕🏽 🍀 ‼️ Server web sederhana untuk SPA / PWA dalam 5 menit 👨🏽‍✈️ 🛌🏼 🧑🏿‍🤝‍🧑🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cara membuat server web sederhana hanya menggunakan instruksi nodejs standar 


 Seringkali, server web sederhana diperlukan untuk mengembangkan aplik...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Server web sederhana untuk SPA / PWA dalam 5 menit</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481898/"><h1 id="kak-sozdat-prostoy-veb-server-ispolzuya-tolko-standartnye-instrukcii-nodejs">  Cara membuat server web sederhana hanya menggunakan instruksi nodejs standar </h1><br><p> Seringkali, server web sederhana diperlukan untuk mengembangkan aplikasi MPA / SPA / PWA.  Suatu hari, pada rapat umum besar menanggapi pertanyaan: "Apa yang kamu lakukan?", Saya mengatakan bahwa saya sedang meningkatkan server web untuk hosting aplikasi PWA.  Kami semua tertawa untuk waktu yang lama dan ya, omong-omong, PWA bukanlah lem.  Seperti SPA, ini bukan salon kecantikan.  Ini semua jenis aplikasi web.  Dan SSR bukan negara :-).  Jika Anda meluncurkan aplikasi seperti itu hanya dengan membuka halaman awal index.html melalui browser, itu tidak akan berfungsi sebagaimana mestinya, dalam skenario kasus terbaik kita akan mendapatkan versi offline.  Saya suka JavaScript dan akan menyelesaikan masalah hanya dengan menggunakan sarana yang tersedia untuk saya, jadi untuk berbicara di luar kotak. </p><a name="habracut"></a><br><p>  Mari kita mulai dengan rencananya: </p><br><ol><li>  Jika tidak ada <a href="https://nodejs.org/dist/">NodeJS,</a> unduh LTS, instal, jangan ubah pengaturan, klik berikutnya </li><li>  Di tempat terpencil kami, tempat semua proyek dikumpulkan, buat folder <strong>server web sederhana</strong> </li><li>  Dalam folder proyek, jalankan perintah npm init --yes // tanpa --yes, initializer akan menanyakan banyak pertanyaan </li><li>  Dalam file <strong>package.json</strong> di bagian <strong>skrip</strong> , tambahkan properti dan nilainya - <strong>"main": "index.js"</strong> - sehingga kami dapat dengan cepat memulai server kami menggunakan perintah run npm </li><li>  Buat folder <strong>lib</strong> Disarankan untuk memasukkan semua kode Anda ke dalamnya, yang tidak memerlukan perakitan dan langkah tambahan untuk operasinya </li><li>  Buat file <strong>index.js</strong> di folder <strong>lib</strong> <strong>.</strong> Ini adalah server kami di masa depan. </li><li>  Buat folder <strong>dist</strong> - ini akan menjadi folder di mana akan ada file yang dapat diakses publik, termasuk index.html, dengan kata lain, statis yang akan didistribusikan server kami </li><li>  Buka file /index.js </li><li>  Tulis beberapa kode </li></ol><br><p>  Jadi apa yang kita ketahui tentang apa yang harus dilakukan server kita? </p><br><ol><li>  Tangani permintaan </li><li>  Baca file </li><li>  Balas untuk meminta dengan konten file </li></ol><br><p>  Pertama, buat server kami, impor ke file <strong>idex.js</strong> </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {createServer} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>);</code> </pre> <br><p>  Instruksi ini merusak objek modul <a href="http.html"><strong>http</strong></a> dan memberikan ekspresi, fungsi <a href="http_createserver.asp"><strong>createServer</strong></a> , ke <a href="http_createserver.asp"><strong>pengenal</strong></a> variabel <a href="http_createserver.asp"><strong>createServer</strong></a> . </p><br><p>  Buat server baru menggunakan pernyataan berikut </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = createServer();</code> </pre> <br><p>  Ketika Anda pertama kali pergi ke host server, browser mengirim permintaan untuk menerima dokumen.  Oleh karena itu, untuk memproses acara ini, kita perlu mendengarkan permintaan tersebut.  Server yang kami buat memiliki metode <strong>mendengarkan</strong> , sebagai parameter kami melewati nomor port 3000. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> eventsEmitter = server.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>);</code> </pre> <br><p>  Ekspresi metode ini akan menjadi objek <a href="https://nodejs.org/api/events.html"><strong>EventEmitter</strong></a> yang akan disimpan dalam variabel dengan identifier <strong>eventsEmitter</strong> .  Objek ini bisa diamati.  Kami berlangganan aktivitasnya menggunakan pemanggilan metode <a href="https://nodejs.org/api/events.html"><strong>on / addEventListener</strong></a> dengan dua parameter <strong>fungsi</strong> <strong>string yang</strong> diperlukan.  Parameter pertama menunjukkan acara mana yang menarik bagi kami; <a href="&amp;xid=17259,15700023,15700186,15700191,15700259,15700271,15700302&amp;usg=ALkJrhjRPxCONDTXFVtNuI8qMZrDpNQkyA#"><strong>permintaan yang</strong></a> kedua adalah fungsi yang akan memproses acara ini. </p><br><pre> <code class="javascript hljs"> eventsEmitter.on(<span class="hljs-string"><span class="hljs-string">'request'</span></span>, (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">debugger</span></span>; });</code> </pre> <br><p>  Buka <a href="http://localhost:3000/">tautan</a> di browser </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ad7/533/9ab/ad75339aba986a5e052325240422696c.png" alt="gambar"></p><br><p>  Jadi, kami sepakat dengan instruksi debugger.  Kita melihat bahwa sebagai parameter kita mendapatkan dua objek <a href="&amp;xid=17259,15700023,15700186,15700191,15700259,15700271,15700302&amp;usg=ALkJrhjRPxCONDTXFVtNuI8qMZrDpNQkyA#http_class_"><strong>req</strong></a> , <a href="&amp;xid=17259,15700023,15700186,15700191,15700259,15700271,15700302&amp;usg=ALkJrhjRPxCONDTXFVtNuI8qMZrDpNQkyA#http_class_"><strong>res</strong></a> . Objek ini adalah instance dari objek tipe <a href="https://nodejs.org/api/stream.html">stream,</a> oleh karena itu <a href="https://nodejs.org/api/stream.html"><strong>req</strong></a> adalah stream read, dan <a href="https://nodejs.org/api/stream.html"><strong>res</strong></a> adalah stream tulis. </p><br><p>  Kami memproses permintaan itu dan kami dapat mengatakan bahwa "masalahnya ada di topi."  Yang tersisa adalah membaca dan mengembalikan file.  Pertama, Anda perlu memahami jenis file apa yang kami butuhkan.  Di debugger, setelah mempelajari semua properti dari parameter <strong>req</strong> , saya melihat bahwa ia memiliki properti <strong>url</strong> .  Tetapi hanya tidak ada yang seperti <strong>index.html di dalamnya</strong> . </p><br><p>  Mari kita lihat lagi browser kita: kita melihat bahwa kita belum mengindikasikan ini secara eksplisit.  Mari kita coba lagi, tetapi kita sudah secara eksplisit menentukan <a href="http://localhost:3000/index.html">index.html</a> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b98/ff2/fb4/b98ff2fb48f53fd0e89b94103a2802b7.png" alt="gambar"></p><br><p>  Sekarang jelas bahwa nama file datang dalam permintaan di properti <strong>url</strong> dan tidak lebih dari ini, kami tidak perlu membaca file dari permintaan.  Kami merusaknya menggunakan sepasang kurung kurawal, tentukan nama properti <strong>url</strong> dan, melalui operator <strong>:,</strong> tetapkan nama arbitrer menggunakan pengenal variabel yang valid, dalam kasus saya <strong>requestUrl</strong> . </p><br><pre> <code class="javascript hljs"> eventsEmitter.addListener(<span class="hljs-string"><span class="hljs-string">'request'</span></span>, ({<span class="hljs-attr"><span class="hljs-attr">url</span></span>: requestUrl}, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">debugger</span></span> });</code> </pre> <br><p>  Hebat, selanjutnya apa?  Sebenarnya, saya tidak terlalu suka fakta bahwa index.html akan selalu perlu ditentukan secara eksplisit, jadi mari kita selesaikan masalah ini segera.  Saya memutuskan bahwa cara termudah untuk melakukan ini adalah dengan menggunakan fungsi <a href="https://nodejs.org/api/path.html"><strong>extname</strong></a> standar <a href="https://nodejs.org/api/path.html"><strong>,</strong></a> termasuk dalam paket standar <br>  NodeJS dari modul <a href="https://nodejs.org/api/path.html"><strong>path yang</strong></a> kami impor menggunakan pernyataan berikut. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {extname} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>);</code> </pre> <br><p>  Sekarang Anda dapat memanggilnya dengan mengirimkan ekspresi requestUrl identifier sebagai parameter dan mendapatkan ekspresi untuk string dari format perkiraan <code>'.extension'</code> .  Jika permintaan tidak secara spesifik menentukan file, string kosong akan dikembalikan.  Dengan menggunakan prinsip ini, kami akan menambahkan nilai default <strong>'index.html'</strong> .  Kami menulis instruksi berikut </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = extname(requestUrl) === <span class="hljs-string"><span class="hljs-string">''</span></span> ? DEFAULT_FILE_NAME : requestUrl;</code> </pre> <br><p>  Saya yakin bahwa pengguna server akan ingin menimpa nama ini dan juga mengatur variabel lingkungan menggunakan pernyataan berikut </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {<span class="hljs-attr"><span class="hljs-attr">env</span></span>: {DEFAULT_FILE_NAME = <span class="hljs-string"><span class="hljs-string">'/index.html'</span></span>}} = process;<span class="hljs-string"><span class="hljs-string">`</span></span></code> </pre> <br><p>  dalam <a href="https://nodejs.org/api/process.html"><strong>proses</strong></a> variabel global banyak informasi yang berguna, saya hanya mengubur sebagian darinya, khususnya, properti <a href="https://nodejs.org/api/process.html"><strong>env</strong></a> yang berisi semua properti dari lingkungan pengguna dan kami akan mencari <strong>DEFAULT_FILE_NAME</strong> di dalamnya jika pengguna tidak menentukannya - kami menggunakan index.html secara default. </p><br><blockquote>  PENTING: jika nilai properti lingkungan DEFAULT_FILE_NAME sama sekali tidak terdefinisi, menetapkan nilai default tidak akan berfungsi.  Ini patut diingat, tetapi tidak sekarang, kami melakukan semuanya seminimal mungkin :-) </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/0db/3cf/e97/0db3cfe97b528ef15c02994bad3781f3.png" alt="gambar"></p><br><p>  Sekarang kita memiliki tautan relatif ke file, kita perlu mendapatkan path absolut ke file di sistem file server kita.  Kami memutuskan bahwa semua file publik akan disimpan di folder <strong>dist</strong> , jadi untuk mendapatkan <strong>path absolut ke file tersebut</strong> , kami akan menggunakan fungsi <a href="https://nodejs.org/api/path.html"><strong>tekad</strong></a> lain dari modul yang sudah kita ketahui <br>  <a href="https://nodejs.org/api/path.html"><strong>path</strong></a> cukup mengindikasikannya dalam instruksi yang dibuat sebelumnya pada baris 5 </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {resolve, extname} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>);</code> </pre> <br><p>  Selanjutnya pada baris 10, kita menulis instruksi yang akan menerima dan menyimpan <strong>path absolut ke</strong> variabel <strong>filePath.</strong> Saya juga "wang" sebelumnya bahwa nama folder ini dapat didefinisikan ulang untuk fleksibilitas.  Oleh karena itu, saya memperluas instruksi pada baris 6, menambahkan nama <br>  variabel lingkungan <strong>DIST_FOLDER</strong> ! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/128/919/e1f/128919e1ffb4aed7911e31764414ee4b.png" alt="gambar"></p><br><p>  Sekarang semuanya siap untuk membaca file.  Anda dapat membaca file dengan berbagai cara Asinkron, Sinkron, atau Anda dapat menggunakan <a href="https://nodejs.org/api/stream.html">stream</a> .  Saya akan menggunakan stream :-) itu indah dan lebih efektif, dari sudut pandang sumber daya yang dikeluarkan.  Pertama, buat file uji di folder <strong>dist</strong> sehingga ada sesuatu untuk dibaca :-) </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> TESTING 1,2,3... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Sekarang kita membutuhkan fungsi yang akan membuat aliran pembacaan file, itu juga termasuk dalam distribusi NodeJS standar, kita mengekstraknya dari modul <a href="https://nodejs.org/api/fs.html"><strong>fs</strong></a> menggunakan instruksi berikut </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {createReadStream} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>);</code> </pre> <br><p>  dan pada baris 12 di badan prosesor permintaan kami menggunakan pernyataan berikut </p><br><pre> <code class="javascript hljs"> createReadStream(filePath)</code> </pre> <br><p>  sebagai hasilnya, instance objek read-stream akan dikembalikan menggunakannya <br>  kita dapat mengalihkan aliran baca ke aliran tulis, kita juga dapat mengubah aliran dan banyak hal berguna lainnya.  Jadi parameter <strong>res</strong> adalah aliran baca, kan? </p><br><p>  Mari kita coba untuk segera beralih aliran baca file yang kami buat ke aliran <strong>res</strong> tulis <br>  dari ini, pada baris 12 kami melanjutkan instruksi dengan memanggil metode <strong>pipa</strong> , dan sebagai parameter kami melewati <strong>res</strong> stream stream kami </p><br><pre> <code class="javascript hljs"> createReadStream(filePath).pipe(res);</code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/412/712/851/412712851c4ce2bcc2bf4a2bcb36ef86.png" alt="gambar"></p><br><p>  Hanya itu semua  Tidaaaak  Dan siapa yang akan menangani kesalahan?  Kesalahan macam apa?  Mari mencoba mengunggah file css ke file index.html, tetapi kami tidak akan membuatnya dan melihat apa yang terjadi :-) </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"index1.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> TESTING 1,2,3... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/487/052/185/487052185b1c4adc32a05f658c7dafb6.jpg" alt="gambar"></p><br><p>  Diharapkan, tetapi server macet!  Ini tidak terjadi sama sekali.  Faktanya adalah bahwa secara default kesalahan tidak terperangkap dalam aliran dan Anda perlu melakukan ini sendiri :-) <strong>createReadStream</strong> mengembalikan aliran di mana kesalahan terjadi.  Oleh karena itu, kami menambahkan penangan kesalahan.  Menggunakan panggilan ke metode <strong>aktif</strong> Menentukan nama acara <strong>kesalahan</strong> dan pawang fungsi.  Ini akan menghentikan aliran baca baca dengan kode respons 404. </p><br><pre> <code class="javascript hljs"> createReadStream(filePath) .on(<span class="hljs-string"><span class="hljs-string">'error'</span></span>, error =&gt; res.writeHead(<span class="hljs-number"><span class="hljs-number">404</span></span>).end()) .pipe(res);</code> </pre> <br><p>  periksa! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/747/29e/584/74729e584b652a032a34c5a82d754a2d.jpg" alt="gambar"></p><br><p>  Satu hal lagi.  Ngomong-ngomong, server belum siap dan jika kami mencoba membukanya di browser lain, halaman tidak akan berfungsi dengan benar :-) siapa yang menebaknya, silakan tulis di komentar, apa yang Anda lupa lakukan?  Faktanya adalah ketika server menjawab permintaan server dengan file, satu ekstensi tidak cukup bagi browser untuk memahami jenis file ini dan browser lainnya: baik chrome maupun versi yang lebih lama tidak akan bekerja dengan file yang diunduh tanpa menentukan header respons Tipe-Konten. memproses file, antara lain, server kami harus menentukan <a href="https://developer.mozilla.org/ru/docs/Web/HTTP/Basics_of_HTTP/MIME_types">jenis MIME.</a> Untuk melakukan ini, kami akan membuat variabel terpisah dengan semua jenis Mei yang umum.  Kami juga memberikan kesempatan untuk memperluas mereka dengan melewati sebagai variabel lingkungan </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {<span class="hljs-attr"><span class="hljs-attr">env</span></span>: {DEFAULT_FILE_NAME = <span class="hljs-string"><span class="hljs-string">'/index.html'</span></span>, DIST_FOLDER = <span class="hljs-string"><span class="hljs-string">'dist'</span></span>, DEFAULT_MIME_TYPES = <span class="hljs-string"><span class="hljs-string">'{}'</span></span>}} = process; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {text} = mimeTypes = { <span class="hljs-string"><span class="hljs-string">'html'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>, <span class="hljs-string"><span class="hljs-string">'jpeg'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>, <span class="hljs-string"><span class="hljs-string">'jpg'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>, <span class="hljs-string"><span class="hljs-string">'png'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span>, <span class="hljs-string"><span class="hljs-string">'js'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/javascript'</span></span>, <span class="hljs-string"><span class="hljs-string">'css'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/css'</span></span>, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'plain/text'</span></span>, <span class="hljs-string"><span class="hljs-string">'json'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, ...JSON.parse(DEFAULT_MIME_TYPES) };</code> </pre> <br><p>  Nah, sekarang Anda perlu menentukan tipe MIME sebelum mengalihkan aliran baca ke aliran tulis.  Saya menggunakan nama ekstensi file sebagai kunci, jadi kita akan mendapatkan ekstensi file dengan fungsi <strong>extname yang</strong> sudah <strong>dikenal</strong> </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fileExtension = extname(url).split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>).pop();</code> </pre> <br><p>  dan dengan bantuan pengendali acara <strong>pipa</strong> , kami mengatur jenis MIME yang diinginkan </p><br><pre> <code class="plaintext hljs">res.on('pipe', () =&gt; res.setHeader(contentType, mimeTypes[fileExtension] || text));</code> </pre> <br><p>  Periksa </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b9e/bad/f34/b9ebadf34d25b2fa8991387d880bc331.jpg" alt="gambar"></p><br><p>  Itu saja - server sudah siap.  Tentu saja itu tidak sempurna, tetapi untuk permulaan yang cepat, itu saja.  Jika Anda tertarik mengembangkan ide ini, silakan tulis di komentar :-) </p><br><p>  <a href="http-server">Kode proyek lengkap</a> </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/5YhIxvbMLp8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/TssbLe5I2Ec" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id481898/">https://habr.com/ru/post/id481898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id481886/index.html">Cara cepat membuat jurnal kehadiran</a></li>
<li><a href="../id481890/index.html">Impor uranium Jerman ke Rusia. Bagian 2. Pengayaan</a></li>
<li><a href="../id481892/index.html">Qubit alih-alih bit: masa depan apa yang dimiliki komputer kuantum bagi kita?</a></li>
<li><a href="../id481894/index.html">Bagaimana biotek Rusia memulai membantu melawan kanker</a></li>
<li><a href="../id481896/index.html">PHP Vs ASP.NET: Bagaimana Memilih Yang Tepat?</a></li>
<li><a href="../id481902/index.html">Memodelkan operasi pembangkit listrik termal nyata untuk mengoptimalkan mode: uap dan matematika</a></li>
<li><a href="../id481904/index.html">Vladimir Marshinin alias mavl: "Panggilan" Jangan menyalin kartu lain "memungkinkan Anda menghindari masalah lisensi OpenStreetMap"</a></li>
<li><a href="../id481906/index.html">Otak Cina, atau membela Spring</a></li>
<li><a href="../id481910/index.html">Menulis Perilaku Vertikal Fleksibel</a></li>
<li><a href="../id481912/index.html">Seminggu saya bekerja magang di SRE-engineer. Perhatikan melalui mata seorang insinyur perangkat lunak</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>