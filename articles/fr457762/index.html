<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜò üö´ ‚úãüèª R√®gle CCD: avec quoi il est mang√© ‚úä üßõüèΩ üé≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je veux pr√©senter mon exp√©rience dans l'utilisation d'un photod√©tecteur CCD lin√©aire. Une telle ligne CCD peut √™tre utilis√©e dans la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√®gle CCD: avec quoi il est mang√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457762/"><img src="https://habrastorage.org/webt/6f/ss/-0/6fss-0mg8davzerthbljhhg9ora.jpeg"><br>  Dans cet article, je veux pr√©senter mon exp√©rience dans l'utilisation d'un photod√©tecteur CCD lin√©aire.  Une telle ligne CCD peut √™tre utilis√©e dans la conception d'un spectrom√®tre de fortune, d'un lecteur de code-barres, d'un capteur de position ou de d√©viation de faisceau laser, d'un scanner pour photo ou film, et bien plus encore.  Dans mon cas, c'√©tait un scanner laser, que je ne peux pas d√©crire sur le r√©seau. <br><a name="habracut"></a><br>  <b>Qu'est-ce qu'un appareil √† couplage de charge?</b> <br><br>  Le plus souvent, lorsque l'on parle de CCD, ils signifient divers photod√©tecteurs.  Plus rarement, ce sont des dispositifs de m√©moire: registres √† d√©calage, lignes √† retard.  √Ä la base, cet appareil rappelle quelque peu la m√©moire des domaines magn√©tiques cylindriques, uniquement sur le silicium - √† l'aide d'une onde progressive d'un champ √©lectrique cr√©√©e par un syst√®me d'√©lectrodes, des amas de porteurs de charge qui s'y sont form√©s d'une mani√®re ou d'une autre se d√©placent plus t√¥t dans le semi-conducteur.  Ainsi, nous obtenons un registre √† d√©calage qui a une structure extr√™mement simple et est capable de m√©moriser non seulement une s√©quence d'unit√©s num√©riques et de z√©ros, mais aussi un signal analogique. <br><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/webt/at/dl/gv/atdlgvfbnsok-t_geekshblchyo.gif"></div><br>  Dans les r√©cepteurs d'images CCD, c'est pr√©cis√©ment cette capacit√© de cette structure qui est utilis√©e pour sortir s√©quentiellement les charges accumul√©es sous chacun des pixels de la structure.  De plus, le m√™me syst√®me de grille qui est utilis√© pour d√©placer les charges pendant l'exposition cr√©e des puits potentiels dans lesquels ces charges s'accumulent (ou ces trous sont cr√©√©s pendant la formation de la structure - similaire aux canaux int√©gr√©s et induits du transistor MOS).  Les structures plus complexes comprennent une porte r√©sistive le long de laquelle une pente de potentiel lisse est form√©e (c'est ainsi que les lignes Hamamatsu S11155 CCD sont dispos√©es), ainsi que la s√©paration des zones d'accumulation et de transfert de charge - les charges accumul√©es de la ligne enti√®re sont d'abord transf√©r√©es vers la ligne tampon, puis avanc√©es par la suite. sortir le dernier. <br>  La simplicit√© de la structure interne se traduit par la complexit√© de sa gestion.  M√™me la version la plus simple de la ligne CCD n√©cessite la g√©n√©ration d'un signal biphas√© ou triphas√© de forme complexe avec diff√©rents niveaux de tension avec des bords raides (avec une capacit√© d'entr√©e √©lev√©e de 1000 pF ou plus), d√©cal√©s les uns par rapport aux autres.  Les r√®gles de type Hamamatsu S11155 n√©cessitent jusqu'√† huit signaux diff√©rents avec diff√©rents niveaux de haute et basse tension des deux c√¥t√©s de z√©ro. <br>  Heureusement, certaines entreprises (par exemple, Sony) ont publi√© une ligne dans laquelle toute cette complexit√© se forme directement sur la puce.  Et pour leur travail, vous devez g√©n√©rer seulement deux signaux: l'obturateur √©lectronique d'ouverture pour la dur√©e de l'exposition et l'horloge.  Dans notre conception, c'est exactement la ligne ILX554: elle (en r√®gle g√©n√©rale, utilis√©e, mais assez fonctionnelle) est facile √† acheter aupr√®s des Chinois sur Aliexpress. <br><br>  <b>Regardons la fiche technique</b> <br><br>  Et nous voyons que seules 6 des 22 broches sont impliqu√©es: alimentation + 5V, signaux d'entr√©e ROG et CLK, signal de sortie Vout, entr√©e de s√©lection de mode SHSW et masse.  Et c'est tout. <br>  ROG est la commande √©lectronique de l'obturateur (et le d√©but du transfert de charge de la ligne photosensible au registre √† d√©calage direct).  Il a un niveau actif - z√©ro.  Pour exposer la matrice, elle doit √™tre maintenue √† z√©ro et maintenue aussi longtemps que n√©cessaire - de 5 Œºs √† plusieurs secondes.  Et puis, en l√¢chant prise, attendez au moins 3 Œºs (pendant ce temps, le circuit de transfert de charge fonctionne).  Pendant tout ce temps √† l'entr√©e de CLK nous gardons un haut niveau.  Et puis vous pouvez lire la ligne, en appliquant √† l'entr√©e CLK un m√©andre avec une fr√©quence de plusieurs dizaines de kilohertz √† 2 MHz.  Dans ce cas, √† chaque diff√©rence de l'unit√© √† z√©ro, le pixel suivant sera pouss√© vers la sortie.  Il y a 2088 pixels de ce type dans la gamme, dont 2048 fonctionnent, photosensibles (en r√©alit√©, il y en a plusieurs autres, mais les pixels les plus externes sont partiellement masqu√©s).  Datashit recommande d'appliquer au moins 2090 impulsions CLK √† la matrice pour un fonctionnement correct. <br>  Et comment il sera pouss√© d√©pend de ce qui est √† l'entr√©e de SHSW.  S'il s'agit d'une unit√© logique, la sortie produira un signal assez complexe: <br><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/webt/dz/xq/qb/dzxqqbdg8vq_r_jgxg4gwek-6lg.gif"></div><br>  De plus, lorsque le CLK passe de z√©ro √† un, une r√©initialisation se produit, et de l'unit√© √† z√©ro - l'√©mission d'un signal utile. <br>  Et √† z√©ro √† l'entr√©e SHSW, le circuit d'√©chantillonnage-stockage int√©gr√© est activ√©, ce qui simplifie ce signal en un simple signal vid√©o √©tape par √©tape, o√π √† chaque nouvelle transition de CLK √† z√©ro, le niveau de signal du pixel suivant appara√Æt simplement et est maintenu pendant toute la p√©riode du signal CLK. <br>  La plage utile du signal de sortie provient d'un certain niveau d'obscurit√©, qui selon la fiche technique est de 2,85 V, mais en r√©alit√©, il peut √™tre diff√©rent (dans ma ligne - environ 3 V), et lorsqu'il est satur√©, le niveau du signal de sortie tombe √† 1,5-2 B. <br>  En g√©n√©ral, c'est tout ce que nous devons savoir sur cette ligne. <br><br>  <b>Circuit d'inclusion</b> <br><br><div style="text-align:center;"><img width="60%" src="https://habrastorage.org/webt/th/vo/xs/thvoxsmrevwageaehbzgex4j054.png"></div><br>  C'est simple et √©vident.  Nous g√©n√©rons des signaux CLK et ROG par programmation en utilisant MK, et les d√©clencheurs Schmitt √† l'entr√©e sont le moyen le plus simple de passer de 3,3 V √† 5 V. Le fait est qu'il n'y a pas de tampons dans ces lignes dans la ligne et que les circuits matriciels fonctionnent correctement. vous devez leur soumettre un m√©andre avec une pleine √©chelle de z√©ro √† cinq volts et une bonne raideur des fronts.  Les NC7SZ14M5X indiqu√©s sur le sch√©ma sont des d√©clencheurs inverseurs Schmitt simples tr√®s pratiques avec des fronts raides et une capacit√© de charge accrue, et je les utilise souvent dans mes projets. <br>  En utilisant DA1, le niveau du signal vid√©o de la gamme ¬´acc√©l√®re¬ª jusqu'√† la plage dans laquelle l'ADC fonctionne, tandis que le ¬´stand¬ª d'environ 1,5 V correspondant au niveau de saturation est supprim√©.  √âtant donn√© que la diff√©rence entre l'amplitude du signal et la valeur ¬´stand¬ª varie consid√©rablement entre les diff√©rents r√©seaux CCD, les r√©sistances R1 et R3 doivent √™tre s√©lectionn√©es en ¬´posant¬ª le signal de sortie dans la plage requise.  Il ne faut pas oublier que non seulement le d√©placement, mais aussi le gain d√©pendent de la r√©sistance R1, vous devez donc d'abord le s√©lectionner. <br>  L1 et L2 sont des billes de ferrite ou de petites selfs pour 1-2 ŒºG de taille de cadre 0805 ou 0603. Les r√©sistances et les condensateurs sont utilis√©s de la m√™me taille.  Le circuit est assembl√© sur une carte double face par montage en surface.  Je n'apporte pas la disposition du tableau, car j'ai encore beaucoup de choses dessus. <br><br>  <b>Impl√©mentation logicielle sur MK</b> <br><br>  La t√¢che MK est de g√©n√©rer un signal ROG de haut niveau (n'oubliez pas les onduleurs!) De la dur√©e requise, puis une courte pause (3-10 Œºs), puis une s√©quence de 2090 impulsions de haut niveau s√©par√©es par des pauses √©gales dans la dur√©e.  Pendant ces impulsions (ou pauses), quelque temps apr√®s le front, la valeur d'√©clairage des pixels est prise √† l'aide d'un ADC int√©gr√© ou externe.  Apr√®s avoir lu la trame, vous devez √©galement faire une pause jusqu'√† ce qu'une nouvelle impulsion ROG - les m√™mes 3-10 Œºs.  Apr√®s avoir mis l'appareil sous tension et, comme il s'est av√©r√©, apr√®s une longue (plus de 100 ms) non utilisation de la r√®gle, vous devez la "nettoyer" en appliquant un train d'impulsions standard gratuit au CLK plusieurs fois. <br>  Sur STM32, il est sage de faire tout cela sur une interruption de minuterie.  En r√©glant la minuterie pour g√©n√©rer des interruptions avec une fr√©quence correspondant √† une fr√©quence de pixel doubl√©e, nous obtenons chaque op√©ration de minuterie dans une interruption, o√π nous √©mettons alternativement z√©ro ou un sur le port, et lorsque nous √©mettons z√©ro, nous lisons ensuite les lectures de l'ADC.  Et apr√®s avoir compt√© 2090 cycles, nous arr√™tons le chronom√®tre.  Pour lire la trame suivante, vous devez remettre le compteur de cycles √† z√©ro, d√©marrer la minuterie et attendre que tout soit compt√©. <br>  Quelque chose comme √ßa, comme indiqu√© dans ces extraits de code. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> clkState = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> frameOk = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> pixCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> ccdFrame[<span class="hljs-number"><span class="hljs-number">2090</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> uint16_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readADC1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//            { . . . } void Delay(unsigned int Val) //     { for( ; Val != 0; Val--) __NOP(); } void readCCD(void) //   - { pixCount = 0; //    frameOk = false; //   TIM_Cmd(TIM6, ENABLE); //   while(frameOk == false); // ,     } // ...    ... // void TIM6_IRQHandler(void) /*      -     CLK       */ { if (TIM_GetITStatus(TIM4, TIM_IT_Update) != RESET) { if(clkState == true) //   (.0)      { clkState = false; GPIOB-&gt;ODR &amp;= ~GPIO_ODR_ODR_1; //      Delay(3); //  ,        ccdFrame[pixCount] = readADC1(); } else //   (.1) { pixCount++; clkState = true; GPIOB-&gt;ODR |= GPIO_ODR_ODR_1; //      } if(pixCount &gt;= 2090) //    ,      { pixCount = 0; frameOk = true; TIM_Cmd(TIM6, DISABLE); } TIM_ClearITPendingBit(TIM4, TIM_IT_Update); } }</span></span></span></span></code> </pre> <br><br>  <b>Et voici le r√©sultat</b> <br>  Le r√©sultat n'est pas mauvais.  Malgr√© le fait que l'ADC int√©gr√© ne poss√®de aucune caract√©ristique, ses caract√©ristiques de bruit correspondent enti√®rement au bruit de la ligne CCD.  La piste de bruit du signal sombre avec un temps d'accumulation d'environ 1 ms se r√©v√®le √™tre ~ 3-4 niveaux de quantification, et lorsque vous utilisez un ADC externe 14 bits avec d'excellentes caract√©ristiques, les r√©sultats ne sont que l√©g√®rement meilleurs.  Avec l'augmentation de l'√©clairage, le bruit augmente pour une raison simple: le nombre de photo√©lectrons dans chacun des pixels n'est pas si grand (selon mes calculs, environ 30 000 √† saturation).  Pour les meilleurs appareils, cette valeur atteint 200 000. <br>  Sur le tableau ci-dessous est un exemple d'une ¬´image¬ª enregistr√©e par la r√®gle, sur laquelle sur le fond du mur illumin√© se trouve un support sombre sur lequel une boule creuse en verre d'un diam√®tre de 1 cm fix√© √† l'int√©rieur est remplie de mortier noir.  Un pic est un reflet de la surface ext√©rieure de cette balle.  Le bruit dans les zones lumineuses est la structure du mur lui-m√™me, renforc√©e par les mouchetures du laser, d'un cadre √† l'autre, il reste stationnaire.  Le bruit r√©el de la ligne est bien moindre. <br><div style="text-align:center;"><img width="65%" src="https://habrastorage.org/webt/ce/bt/jw/cebtjw-j6wmi1icilzg_oprfxnc.png" alt="image"></div><br><br>  <b>Autres lignes similaires</b> <br>  Certaines autres lignes SONY CCD 2048 pixels en noir et blanc d'ILX511, ILX551 (ce dernier a un brochage diff√©rent et n√©cessite deux tensions d'alimentation - 5 et 9 V), diff√©rant par la taille des pixels transversaux (de 14 √† 200 microns) fonctionnent exactement de la m√™me mani√®re. et sensibilit√© spectrale (ILX554A est sensible au rouge et √† l'IR, similaire √† l'indice B a une sensibilit√© r√©duite dans la r√©gion IR et est proche de la sensibilit√© √† l'≈ìil, et ILX511B est plus sensible au bleu).  Leurs caract√©ristiques dynamiques sont diff√©rentes: la plage dynamique de l'ILX551B en raison de la petite taille des pixels atteint 6000 (notre gamme atteint ce DD avec des vitesses d'obturation courtes d'environ 10 Œºs). <br><br>  * * * <br>  Cet article traite de la connexion de la ligne CCD la plus simple √† utiliser.  Cette simplicit√© est due au fait que toute la complexit√© se cache en elle sous le capot.  S'il n'y avait pas les pilotes int√©gr√©s, je devrais g√©n√©rer beaucoup de signaux √† plusieurs niveaux. <br>  Malheureusement, selon les normes modernes, une telle ligne CCD avec pilotes int√©gr√©s n'a pas les meilleures caract√©ristiques.  Ainsi, dans cette ligne, la plage dynamique, d√©finie comme le rapport du signal de saturation au signal sombre, est de 333: 1, et d√©finie comme le rapport du signal de saturation au signal minimum d√©tect√© sur fond de bruit - environ 1000: 1.  Mais de tels appareils sont non seulement difficiles √† utiliser, mais souvent difficiles d'acc√®s (le m√™me Hamamatsu n√©cessite des formalit√©s bureaucratiques compliqu√©es lors de l'achat de ses matrices CCD et d'autres photod√©tecteurs en raison du double objectif de ces produits).  Cependant, de telles performances √©lev√©es ne sont pas toujours requises, et √† de nombreuses fins, les param√®tres de ces appareils sont tout √† fait acceptables. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr457762/">https://habr.com/ru/post/fr457762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr457752/index.html">Pas des rovers lunaires et pas des farceurs. Que savons-nous des robots √† Fukushima</a></li>
<li><a href="../fr457754/index.html">State et T-killers</a></li>
<li><a href="../fr457756/index.html">Le livre Kafka Streams en action. Applications et microservices en temps r√©el ¬ª</a></li>
<li><a href="../fr457758/index.html">Les ing√©nieurs sauvent les gens perdus dans la for√™t, mais la for√™t ne s'est pas encore rendue</a></li>
<li><a href="../fr457760/index.html">Comment rendre les conteneurs encore plus isol√©s: un examen des technologies de bac √† sable pour conteneurs</a></li>
<li><a href="../fr457764/index.html">10 erreurs de PO jeune (partie II)</a></li>
<li><a href="../fr457766/index.html">Nous g√©n√©rons des niveaux de tuiles et cachons des carr√©s au joueur</a></li>
<li><a href="../fr457768/index.html">Comment je suis devenu vuln√©rable: analyser l'infrastructure informatique avec Qualys</a></li>
<li><a href="../fr457770/index.html">Nous √©crivons un transformateur personnalis√© AST sur TypeScript</a></li>
<li><a href="../fr457774/index.html">√âtudier en tant que pilote priv√© en Terre du Milieu: se d√©placer et vivre dans un village n√©o-z√©landais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>