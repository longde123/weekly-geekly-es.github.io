<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÉ üí° ‚óæÔ∏è Neue x86 SIMD-Bibliothek - Immintrin-Debug üö† üïã üèùÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mit jeder neuen Generation von Intel-Prozessoren entstehen neue und immer komplexer werdende Vektoranweisungen. Obwohl die L√§nge des Vektors (512 Bit)...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Neue x86 SIMD-Bibliothek - Immintrin-Debug</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/intel/blog/450964/">  Mit jeder neuen Generation von Intel-Prozessoren entstehen neue und immer komplexer werdende Vektoranweisungen.  Obwohl die L√§nge des Vektors (512 Bit) in naher Zukunft nicht zunehmen wird, werden neue Arten von Daten und Arten von Anweisungen erscheinen.  Wer kann zum Beispiel auf einen Blick verstehen, was eine solche Eigenart (und die entsprechende Prozessoranweisung) bewirkt? <br><br>  Bitweise tern√§re Logik, die die F√§higkeit bietet, jede Bin√§rfunktion mit drei Operanden zu implementieren;  Die spezifische Bin√§rfunktion wird durch den Wert in imm8 angegeben. <br><br><pre><code class="matlab hljs">__m512i _mm512_mask_ternarylogic_epi32 (__m512i src, __mmask8 k, __m512i a, __m512i b, int imm8) FOR <span class="hljs-built_in"><span class="hljs-built_in">j</span></span> := <span class="hljs-number"><span class="hljs-number">0</span></span> to <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> := <span class="hljs-built_in"><span class="hljs-built_in">j</span></span>*<span class="hljs-number"><span class="hljs-number">32</span></span> IF k[<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>] FOR h := <span class="hljs-number"><span class="hljs-number">0</span></span> to <span class="hljs-number"><span class="hljs-number">31</span></span> index[<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] := (src[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>+h] &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) OR (a[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>+h] &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) OR b[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>+h] dst[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>+h] := imm8[index[<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]] ENDFOR ELSE dst[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>+<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] := src[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>+<span class="hljs-number"><span class="hljs-number">31</span></span>:<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] FI ENDFOR dst[MAX:<span class="hljs-number"><span class="hljs-number">512</span></span>] := <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  OK, sagen wir, wir haben herausgefunden, wie es funktioniert.  Die n√§chste Komplexit√§tsstufe ist das Debuggen von Code, der solche Eigenheiten intensiv nutzt. <br><a name="habracut"></a><br>  Diejenigen, die regelm√§√üig Intrinsics verwenden, kennen eine so n√ºtzliche Website - den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Intel Intrinsics Guide</a> .  Wenn Sie sich genau ansehen, wie es funktioniert, k√∂nnen Sie leicht feststellen, dass das Javascript-Frontend die Datei data-3.xxxml herunterl√§dt, in der alle Eigenheiten mit √§hnlichem Code wie Matlab ausf√ºhrlich beschrieben werden.  (Zum Beispiel die, die ich im Post-Titel kopiert habe.) <br><br>  Wenn wir jedoch Intrinsics verwenden, um den Code zu beschleunigen, schreiben wir nicht in Matlab, sondern in C und C ++!  Vor drei Monaten fragte mich ein Client, ob es in C eine Implementierung von Vektor-Intrinsics zum Debuggen gibt, und ich entschied mich, einen Parser zu schreiben, der den Code aus dem Intrinsics-Handbuch nach C √ºbersetzt. Es stellt sich heraus, dass eine Bibliothek fast alle Intrinsics implementiert, sodass Sie mit einem schrittweisen Debugger hineingehen k√∂nnen ( oder Debug hinzuf√ºgen printf). <br><br>  Beispielsweise wird eine Operation aus einem Post-Titel zu <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt;= <span class="hljs-number"><span class="hljs-number">15</span></span>; j++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k &amp; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; j)) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h = <span class="hljs-number"><span class="hljs-number">0</span></span>; h &lt;= <span class="hljs-number"><span class="hljs-number">31</span></span>; h++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = ((((src_vec[j] &amp; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; h)) &gt;&gt; h) &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) | (((a_vec[j] &amp; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; h)) &gt;&gt; h) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) | ((b_vec[j] &amp; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; h)) &gt;&gt; h)) &amp; <span class="hljs-number"><span class="hljs-number">0x7</span></span>; dst_vec[j] = (dst_vec[j] &amp; ~(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; h)) | ((((imm8 &amp; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; index)) &gt;&gt; index)) &lt;&lt; h); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { dst_vec[j] = src_vec[j]; } }</code> </pre><br>  Stimmt das, ist das viel verst√§ndlicher?  Nicht sehr?  Nun, ich habe nur eine komplexe Funktion als Beispiel gew√§hlt.  Wenn Sie Code mit Intrinsics (z. B. DSP) debuggen, m√ºssen Sie normalerweise sowohl den Algorithmus als auch die Funktionen der einzelnen Anweisungen ber√ºcksichtigen.  In Anbetracht der Tatsache, dass die Anweisungen mit langen Vektoren arbeiten und DSP-Algorithmen h√§ufig auf seri√∂ser Mathematik basieren, kommt mein Kopf nicht zurecht - es gibt nicht gen√ºgend Kurzzeitged√§chtnis und Konzentration.  Ich vermute, dass ich nicht allein bin - mehrmals dachte ich sogar, ich h√§tte einen Fehler in der Anleitung gefunden.  Dann stellte sich nat√ºrlich jedes Mal heraus, dass ich falsch lag, und es funktionierte nicht, einen neuen FDIV-Fehler zu √∂ffnen.  Wenn ich in diesen F√§llen jedoch Schritt f√ºr Schritt innerhalb der Anweisungen debuggen k√∂nnte, w√ºrde ich sofort verstehen, unter welchen Bedingungen ein Wert in der Komponente meines Vektors erscheint, den ich nicht erwartet hatte. <br><br>  Kunden sagten mir, dass sie diese Bibliothek verwenden, um einzelne Funktionen mit AVX-512-Intrinsics auf einem Laptop zu debuggen, der nur AVX2 unterst√ºtzt.  Nat√ºrlich ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Intel SDE</a> daf√ºr viel besser geeignet - weil es alle Befehlss√§tze √§u√üerst genau imitiert.  Ich habe eine Reihe von Unit-Tests (ebenfalls automatisch generiert), die f√ºr jedes Intrinsic aus der Bibliothek das Ergebnis seiner Arbeit mit dem Ergebnis der Ausf√ºhrung der entsprechenden Assembler-Anweisung vergleichen.  Wie es sich f√ºr Unit-Tests geh√∂rt, funktionieren die meisten wie erwartet.  Einige Debugging-Eigenschaften mit einem Gleitkomma (doppelte und einfache Genauigkeit) funktionieren jedoch nicht immer zu 100% korrekt.  Ich w√ºrde sagen, dass es manchmal eine Art <i>Schnellmathematik ist</i> .  Und es gibt verschiedene Rundungsmechanismen!  IEE754 hat viele Feinheiten ... <br><br>  Es gibt noch eine weitere wichtige Funktion bei der Verwendung von Immintrin-Debug anstelle von SDE (die ich in keiner Weise guthei√üe, aber nicht stoppen kann).  Wenn Sie gcc oder clang mit der Option kompilieren, z. B. <i>-march = nehalem</i> , geben gcc und clang 512-Bit-Vektoren aus den Funktionen auf dem Stapel aus den Funktionen zur√ºck, und ICC gibt sie weiterhin an ZMM0 zur√ºck.  Daher kann der Intel-Compiler in diesem Modus nicht verwendet werden.  Und gcc hat eine n√ºtzliche Option <i>-Og</i> , die beim Debuggen hilft, einschlie√ülich beim Debuggen immintrin. <br><br>  Es gibt mehrere Eigenheiten, deren Hauptaktion darin besteht, beispielsweise den Inhalt des Registers oder der Flags zu √§ndern.  Ich habe solche Anweisungen nicht implementiert.  Nun, w√§hrend mein Parser noch nicht ganz fertig ist, ist die Implementierung von ungef√§hr 10% der Intrinsics noch nicht verf√ºgbar. <br><br>  Die Verwendung von immintrin debug ist sehr einfach - Sie m√ºssen die Quelle nicht √§ndern, m√ºssen jedoch eine bedingte Kompilierung hinzuf√ºgen, um immintrin_dbg.h anstelle von immintrin.h im Falle einer Debug-Erstellung einzuschlie√üen. <br><br>  Sie k√∂nnen es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf Github</a> herunterladen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450964/">https://habr.com/ru/post/de450964/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450952/index.html">Mittlerer Index und Antibank</a></li>
<li><a href="../de450954/index.html">Wie wir gelernt haben, Java in Docker auszunutzen</a></li>
<li><a href="../de450956/index.html">Vergleich der industriellen COB: ISIM vs. Kics</a></li>
<li><a href="../de450958/index.html">AnyStub, Java-Verbindungsstubbibliothek</a></li>
<li><a href="../de450962/index.html">Insulinpumpen, manipulationssichere Mikrochips und softwaredefiniertes Radio</a></li>
<li><a href="../de450966/index.html">Video von einem alten Computer aufnehmen - Methoden von LGR</a></li>
<li><a href="../de450970/index.html">Wie man die Apple-Preise in den USA und in Russland wirklich vergleicht. Pers√∂nliche Erfahrung</a></li>
<li><a href="../de450972/index.html">Wie organisiere ich ein Fotostudio? Fall von Bolshakova Studio</a></li>
<li><a href="../de450974/index.html">Xiaomi Sleep Tracker - Sleepace Sleep Dot Bewertung</a></li>
<li><a href="../de450976/index.html">Studentengespr√§che: Analytik. Startermaterialien</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>