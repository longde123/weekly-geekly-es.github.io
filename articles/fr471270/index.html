<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧗🏼 👨🏽‍🤝‍👨🏻 🔒 Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle] ✍🏿 ✌️ ♐️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Surveillez régulièrement la vitesse de téléchargement de dizaines ou de centaines d'URL? Vous souhaitez analyser la vitesse de téléchargement des site...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/promopult/blog/471270/"><p>  Surveillez régulièrement la vitesse de téléchargement de dizaines ou de centaines d'URL?  Vous souhaitez analyser la vitesse de téléchargement des sites de l'industrie ou page par page sur votre site?  Entrer des URL à chaque fois dans PageSpeed ​​Insights et transférer des données vers Excel est long. </p><br><p>  Nous avons trouvé une solution simple - elle vous permet d'obtenir des métriques de PageSpeed ​​Insights sur un calendrier et sur une machine complète.  La configuration vous prendra 5 à 10 minutes, mais vous économiserez des heures. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/54/av/h6/54avh6zwawbdvbmcjp_p1q6uejw.png" alt="Automatisez la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><a name="habracut"></a><br><p>  Lorsque nous préparions une étude sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vitesse de chargement des sites dans le commerce électronique</a> , nous avons été sérieusement perplexes face à l'automatisation de l'obtention des données de PageSpeed ​​Insights.  Ouvrez chaque URL du service, exécutez une analyse, transférez des mesures - tout cela prend beaucoup de temps. </p><br><p>  Dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> James_McNulty pour MOZ, nous avons trouvé une solution.  Cet article présente le modèle Google Sheets, qui utilise l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API PageSpeed ​​Insights V5 pour</a> prendre les données de bureau par cinq mesures.  Nous avons modifié le modèle - maintenant avec son aide, vous pouvez prendre des données par huit mesures (non seulement pour le bureau, mais aussi pour le mobile). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nk/vz/zq/nkvzzq0hcrohkbhr_am50r3lqpo.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><h2>  Pourquoi surveiller la vitesse de chargement des pages </h2><br><p>  Les données de vitesse de chargement de page sont utiles pour les optimiseurs et les développeurs dans un certain nombre de cas: </p><br><ul><li>  Pour auditer la vitesse de téléchargement dans le contexte de pages spécifiques du site - vous pouvez déterminer lesquelles ralentissent le téléchargement; </li><li>  pour surveiller la vitesse à la suite de changements sur le site - vous comprendrez ainsi comment ces changements ou d'autres ont affecté la vitesse de chargement des pages; </li><li>  pour la comparaison avec les concurrents, vous comprendrez à quelle vitesse votre site se charge par rapport aux concurrents, et déciderez si vous devez l'accélérer ou si vous pouvez le laisser tel quel pour l'instant. </li></ul><br><h2>  Comment utiliser le modèle </h2><br><p>  Tout d'abord, créez une copie du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modèle d'outil API PageSpeed ​​Insights automatisé</a> . </p><br><p>  Il y a trois onglets dans le fichier (ne changez pas les noms des onglets!): </p><br><ul><li>  Paramètres - la clé API et le calendrier de collecte des données sont indiqués ici. </li><li> Résultats - il s'agit de la feuille sur laquelle les données sont collectées à l'URL spécifiée (les données de la feuille sont mises à jour après chaque exécution de script). </li><li>  Journal - les données collectées (y compris pour les périodes passées) sont transférées sur cette feuille. </li></ul><br><h3>  Préparation préliminaire du modèle </h3><br><p>  Pour un fonctionnement correct, vous avez besoin de: </p><br><ul><li>  obtenir la clé API, </li><li>  activer l'API PageSpeed. </li></ul><br><p>  Pour obtenir une clé API, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">accédez</a> à la section "Informations d'identification" du service API Google et cliquez sur le bouton "Créer des informations d'identification". </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uf/4v/cw/uf4vcwxoc-dficfqeju_kyclqtg.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Dans la liste déroulante, sélectionnez "Clé API". </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d6/ds/ua/d6dsuabwj6cwfkqpevjwhcxqipw.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Copiez la clé générée. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/en/ao/jz/enaojzeklud0igpwh3i-qzniydo.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Insérez-le dans le modèle sur la feuille «Paramètres». </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nj/su/sw/njsuswhtbe2mdl5mexeesckdy7y.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Mais le modèle de clé n'est pas suffisant pour que la clé fonctionne - vous devez toujours activer l'API PageSpeed.  Pour ce faire, accédez à la page <a href="">API PageSpeed</a> et cliquez sur le bouton "Activer". </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8u/pk/w3/8upkw3vwsnoym4fg5mnltsal8ji.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Important!  Si vous n'activez pas l'API PageSpeed, le script dans le modèle ne fonctionnera pas et vous verrez des erreurs dans le tableau. </p><br><blockquote><p>  Contexte professionnel et sans agence - dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le système PromoPult</a> .  Sélection automatique des mots, génération automatique d'annonces, gestion des enchères «intelligente».  Solutions industrielles prêtes à l'emploi.  Statistiques en temps réel. </p></blockquote><br><h2>  Récupération des données de PageSpeed ​​Insights </h2><br><p>  Cliquez sur l'onglet Résultats et entrez une liste d'URL.  Ouvrez le menu PageSpeed ​​et appuyez sur Rapport push manuel.  Immédiatement après cela, le script commencera à s'exécuter et après un certain temps, vous recevrez les données. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ts/lj/zv/tsljzvauwdjamarwjmpg8ezmei4.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Les mesures suivantes sont collectées dans le modèle: </p><br><ul><li>  Temps de téléchargement des interactions (TTI) </li><li>  premier temps de chargement de contenu (FCP); </li><li>  temps de chargement pour une partie suffisante du contenu (FMP); </li><li>  temps de chargement du premier octet (vitesse de réponse du serveur); </li><li>  télécharger l'indice de vitesse (Speed ​​Index); </li><li>  Heure de fin du processeur </li><li>  premier retard d'entrée; </li><li>  évaluation des performances. </li></ul><br><p>  La réussite de la collecte des données est indiquée par le statut «terminé» dans la ligne avec l'URL. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/li/h0/jj/lih0jj-r80c5_0m3cgbm7o7vqxe.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><h3>  Comment changer le type d'appareil </h3><br><p>  Par défaut, le modèle collecte des données de vitesse lors de la simulation de téléchargements à partir d'un appareil mobile. </p><br><p>  Si vous avez besoin de données de bureau, accédez à la section «Outils» / «Éditeur de script» de Google Sheets, recherchez la fonction runCheck et modifiez la valeur du paramètre «stratégie» de «mobile» à «bureau» dans la variable serviceUrl (ligne 587).  Enregistrez les modifications. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nn/gy/jd/nngyjdblndwdxtwcxuqazpq4uvg.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Le modèle va maintenant collecter des données pour les mêmes URL, mais pour les bureaux. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8e/bs/lo/8ebslosq5pojwopgfn_c4fmhpvm.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Si vous devez surveiller régulièrement les versions mobile et de bureau, il sera plus pratique de créer deux copies du modèle - ne changez rien en un et définissez «stratégie = bureau» dans le second. </p><br><h2>  Planifier la récupération des données à partir de PageSpeed ​​Insights </h2><br><p>  Dans l'onglet Paramètres, spécifiez quel jour et à quelle heure commencer la collecte de données (modifiez uniquement les données de la première ligne).  Par exemple, nous avons indiqué jeudi 8 heures (l'heure est définie en fonction de l'heure locale indiquée dans votre compte Google). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mq/xv/9g/mqxv9gv4voonqnunaapcr4zgf_e.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Après avoir défini le jour de la semaine et l'heure dans le modèle, l'heure de collecte des données est en outre affectée à 9, 10 et 11 heures du matin.  Cela est nécessaire pour contourner les limitations définies par l'API PageSpeed. </p><br><h3>  Restrictions de collecte de données API </h3><br><p>  Le modèle Google Sheets utilise le script Google Apps pour collecter des données à partir de PageSpeed ​​Insights.  Chaque fois qu'un rapport est exécuté, Google Apps Scripts définit une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">limite d'exécution de 6 minutes</a> (pour les utilisateurs réguliers). </p><br><p>  Ce temps sera suffisant pour analyser au moins 30 URL.  Passé ce délai (si vous avez défini plusieurs URL), vous recevrez un message: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yb/pb/is/ybpbisi12njgilbkgd8pdljbsog.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Pour continuer à collecter des données, il suffit de réexécuter le script.  C'est pourquoi le programme indique les heures auxquelles le rapport est redémarré.  De cette façon, vous collecterez des données d'au moins 120 URL. </p><br><p>  Mais ici, nous sommes confrontés à un autre obstacle - maintenant du côté de Google Sheets.  Le script dans le modèle est déclenché selon un calendrier donné en raison de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">déclencheurs</a> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yc/2q/z2/yc2qz2vyqdxiqd-zp8yyfj1zyao.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Le problème est que l'utilisation de déclencheurs plus de quatre fois de suite provoque une erreur - «Service utilisant trop de temps d'ordinateur pendant une journée».  Cela signifie que le script Google Apps a dépassé le temps d'exécution total autorisé en une journée. </p><br><p>  La solution consiste à exécuter le script manuellement. </p><br><p>  Si vous avez plus de 120 URL à vérifier, exécutez simplement le script via le «Menu PageSpeed» («Rapport push manuel»).  Dans ce cas, il n'y aura pas de limite sur le nombre de déclencheurs déclenchés et vous pouvez vérifier autant d'URL que nécessaire. </p><br><h2>  Planifier le téléchargement des données </h2><br><p>  Dans l'onglet "Paramètres", dans le champ "Résultats du journal tous les", spécifiez le jour de la semaine et l'heure de téléchargement.  Gardez à l'esprit le calendrier de collecte des données.  Par exemple, si vous définissez la collecte de données le jeudi à 8 heures, il est préférable de la télécharger au plus tôt 12 jours - afin qu'elles soient probablement collectées. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v3/h3/sv/v3h3svg1edwpsnmuoil0auhnuaa.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Une fois que vous avez configuré un calendrier de collecte et de téléchargement des données, assurez-vous d'aller dans le «Menu PageSpeed» et cliquez sur «Définir le calendrier des rapports et des journaux».  Cette action active le planning. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ia/_q/sl/ia_qsl4c4f3gg6wnsrcwzd4nba4.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  Si vous souhaitez annuler le téléchargement planifié, cliquez sur «Réinitialiser le calendrier». </p><br><p>  Après le temps indiqué dans les horaires, le script transférera les données de la feuille "Résultats" vers la feuille "Journal".  Dans ce cas, les données de la feuille "Résultats" disparaîtront (à l'exception de l'URL), et sur la feuille "Journal" seront accumulées à chaque fois après le déchargement.  Ainsi, vous aurez un historique des changements de vitesse de téléchargement. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mt/u-/tc/mtu-tcgktjre27baucvvkghrv7y.png" alt="Nous automatisons la réception de données sur la vitesse de chargement d'un site à partir de Google PageSpeed ​​Insights [modèle]"></div><br><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PageSpeed ​​Insights API V5</a> vous permet de télécharger toutes les données présentées dans les audits de Lighthouse.  Autrement dit, si nécessaire, vous pouvez compléter le script et obtenir plus de données en utilisant le modèle. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr471270/">https://habr.com/ru/post/fr471270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr471260/index.html">Kali Linux NetHunter sur Android Partie 2: attaques sur les réseaux sans fil</a></li>
<li><a href="../fr471262/index.html">Holivar. Histoire de Runet. Partie 5. Trolls: apprendre, imprimante frénétique, cuivre</a></li>
<li><a href="../fr471264/index.html">Choisir une alternative à Mailchimp: pourquoi changer et quel produit choisir</a></li>
<li><a href="../fr471266/index.html">L'avenir est ici ou encodé directement dans le navigateur</a></li>
<li><a href="../fr471268/index.html">Comprendre les courtiers de messages. Apprentissage de la mécanique de la messagerie via ActiveMQ et Kafka. Chapitre 2. ActiveMQ</a></li>
<li><a href="../fr471272/index.html">Les avantages de la frappe forte en C ++: expérience pratique</a></li>
<li><a href="../fr471278/index.html">Génération de texte en russe par des modèles</a></li>
<li><a href="../fr471282/index.html">Recherche de pneumonie aux rayons X avec Fast.ai</a></li>
<li><a href="../fr471288/index.html">Création du visage d'un personnage pour le jeu "OnAir"</a></li>
<li><a href="../fr471294/index.html">Poèmes sur Haskell, C ++ et les programmeurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>