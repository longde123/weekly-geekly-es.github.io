<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСиЁЯП╜тАНЁЯдЭтАНЁЯСиЁЯП╗ ЁЯОБ ЁЯО┤ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреНрд▓рд╕реНрдЯрд░ рдкреНрд░рддрд┐ рдорд╛рд╣ $ 20 рдХреЗ рд▓рд┐рдП ЁЯТЗЁЯП╜ ЁЯЧСя╕П тЫИя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЯреА рдПрд▓; рдбреЙ 


 рд╣рдо рдХреНрдпреВрдмреНрд╕рдкреНрд░рд╛рдп, рдХреБрдмреЗрджрдо рдФрд░ рдХрд┐рд╕реА рднреА рдЕрдиреНрдп рдЬреИрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рди рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛, рдирд┐рдЧрд▓рдирд╛ , Letencrypt рдХреЗ рд╕рд╛рде рд╕реНрдЯреЗрдЯрд▓реЗрд╕ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд░реЛрд╕рдиреЗ рдХ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреНрд▓рд╕реНрдЯрд░ рдкреНрд░рддрд┐ рдорд╛рд╣ $ 20 рдХреЗ рд▓рд┐рдП</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iponweb/blog/435228/"><h1 id="tl-dr">  рдЯреА рдПрд▓;  рдбреЙ </h1><br><p>  рд╣рдо рдХреНрдпреВрдмреНрд╕рдкреНрд░рд╛рдп, рдХреБрдмреЗрджрдо рдФрд░ рдХрд┐рд╕реА рднреА рдЕрдиреНрдп рдЬреИрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рди рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирд┐рдЧрд▓рдирд╛</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Letencrypt рдХреЗ</a> рд╕рд╛рде <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реНрдЯреЗрдЯрд▓реЗрд╕</a> рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд░реЛрд╕рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╕реНрдЯрд░ рдмрдврд╝рд╛рддреЗ рд╣реИрдВред <br>  рдкрдврд╝рдиреЗ рдХрд╛ рд╕рдордп: ~ 45-60 рдорд┐рдирдЯ, рдкреНрд▓реЗрдмреИрдХ рд╕рдордп: 3 рдШрдВрдЯреЗ рд╕реЗред </p><br><h1 id="preambula">  рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛ </h1><br><p>  рдореБрдЭреЗ рдкреНрд░рдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдХреБрдмреЗрд░рдиреЗрдЯ рдХреЗ рдЕрдкрдиреЗ рдХреНрд▓рд╕реНрдЯрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдПрдХ рд▓реЗрдЦ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЗрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдЦреБрд▓реЗ рд╕реНрд░реЛрдд рд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рдорд╛рдзрд╛рди рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреЗ рдереЗ, рдХреНрдпреЛрдВрдХрд┐ рдореИрдВрдиреЗ рдЧреИрд░-рдореБрдЦреНрдпрдзрд╛рд░рд╛ рд▓рд┐рдирдХреНрд╕ рд╡рд┐рддрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдерд╛ред  IPONWEB рдореЗрдВ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдЧрд╣рди рдХрд╛рд░реНрдп рдЖрдкрдХреЛ рдЗрд╕ рддрд░рд╣ рдХреЗ рдПрдХ рдордВрдЪ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрддреНрд╕рд╛рд╣рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЕрдкрдиреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдПрдХ рдЖрд░рд╛рдорджрд╛рдпрдХ рддрд░реАрдХреЗ рд╕реЗ рд╣рд▓ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдШрд░реЗрд▓реВ рдкрд░рд┐рдпреЛрдЬрдирд╛рдПрдВ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВред </p><br><h1 id="komponenty">  рдШрдЯрдХреЛрдВ </h1><br><p>  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдШрдЯрдХ рд▓реЗрдЦ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдВрдЧреЗ: </p><br><p>  - <em>рдЖрдкрдХрд╛ рдкрд╕рдВрджреАрджрд╛</em> рд▓рд┐рдирдХреНрд╕ - рдореИрдВрдиреЗ рдЬреЗрдВрдЯреВ (рдиреЛрдб -1: рд╕рд┐рд╕реНрдЯрдордб / рдиреЛрдб -2: рдУрдкрди рдЖрд░реНрдХ), рдЙрдмрдВрдЯреВ 18.04.1 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╕рд░реНрд╡рд░</a> - рдХреНрдпреВрдм-рдПрдкреЗрд╕реЗрд╡рд░, рдХреНрдпреВрдм-рдХрдВрдЯреНрд░реЛрд▓рд░-рдореИрдиреЗрдЬрд░, рдХреНрдпреВрдм-рд╢реЗрдбреНрдпреВрд▓рд░, рдХреНрдпреВрдмрд▓реЗрдЯ, рдХреНрдпреВрдм-рдкреНрд░реЙрдХреНрд╕реАред <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрдВрдЯреЗрдирд░</a> + <a href="">рд╕реАрдПрдирдЖрдИ рдкреНрд▓рдЧрдЗрдиреНрд╕ (0.7.4)</a> - рдХрдВрдЯреЗрдирд░реАрдХрд░рдг рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо <a href="">рдбреЙрдХрдЯрд░ рдХреЗ</a> рдмрдЬрд╛рдп рдХрдВрдЯреЗрдирд░ + рд╕реАрдПрдирдЖрдИ рд▓реЗрдВрдЧреЗ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╢реБрд░реБрдЖрдд рдореЗрдВ рдкреВрд░реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдбреЙрдХрдЯрд░ рдкрд░ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЗрд╕рд▓рд┐рдП рдХреБрдЫ рднреА рдЗрд╕реЗ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдиреЗ рдкрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдирд╣реАрдВ рд░реЛрдХреЗрдЧрд╛)ред <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреЛрд░рдбрдПрдирдПрд╕</a> - рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЕрдВрджрд░ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдШрдЯрдХреЛрдВ рдХреА рд╕реЗрд╡рд╛ рдЦреЛрдЬ рдХреЗ рдЖрдпреЛрдЬрди рдХреЗ рд▓рд┐рдПред  1.2.5 рд╕реЗ рдХрдо рд╕рдВрд╕реНрдХрд░рдг рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдмрд╛рд╣рд░ рдЪрд▓рдиреЗ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрд░рдбрдиреНрд╕ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рд╣реИред <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд▓рд╛рд▓реИрди</a> - рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдЯреИрдХ рдХреЗ рдЖрдпреЛрдЬрди рдХреЗ рд▓рд┐рдП, рдЖрдкрд╕ рдореЗрдВ рдЪреВрд▓реНрд╣рд╛ рдФрд░ рдХрдВрдЯреЗрдирд░реЛрдВ рдХрд╛ рд╕рдВрдЪрд╛рд░ рдХрд░рдирд╛ред <br>  - <em>рдЖрдкрдХрд╛ рдкрд╕рдВрджреАрджрд╛</em> рдбреА.рдмреА. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/423/a71/5fc/423a715fc68fed1101c86d3335b0a8a8.jpg" alt="рд╕рднреА рдХреЗ рд▓рд┐рдП"></p><a name="habracut"></a><br><h1 id="ogranicheniya-i-dopuscheniya">  рд╕реАрдорд╛рдПрдБ рдФрд░ рдорд╛рдиреНрдпрддрд╛рдПрдБ </h1><br><ul><li>  рд▓реЗрдЦ рдмрд╛рдЬрд╛рд░ рдкрд░ vps / vds рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреА рд▓рд╛рдЧрдд рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рдЗрди рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рдорд╢реАрдиреЛрдВ рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рднреА рд╣реИред  рдпрд╣ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХреБрдЫ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╣реИ, рдпрд╛ рдЖрдк рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдкрдХреЗ рдкрд╕рдВрджреАрджрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдФрд░ рдирд┐рдЬреА рдбреЙрдХрд░реНрд╕ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреА рд╕реНрдерд╛рдкрдирд╛ / рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди, рдпрджрд┐ рдЖрдкрдХреЛ рдПрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдХрд╡рд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </li><li>  рд╣рдо рджреЛрдиреЛрдВ рдХрдВрдЯреЗрдирдб + cni plugins рдФрд░ docker рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рд▓реЗрдЦ рдбреЙрдХрдЯрд░ рдХреЛ рдПрдХ рдХрдВрдЯреЗрдирд░реАрдХрд░рдг рдЙрдкрдХрд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдбреЙрдХрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рд╕реНрд╡рдпрдВ рдХреЗ <a href="">рдЕрдиреБрд╕рд╛рд░ рдлрд▓рд╛рд▓реИрди</a> рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ, рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдЖрдкрдХреЛ рдХреНрдпреВрдмрд▓реЗрдЯ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЕрд░реНрдерд╛рддреН, рдХрдВрдЯреЗрдирд░ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рднреА рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рд╣рдЯрд╛ рджреЗрдВред  рдЬреИрд╕рд╛ рдХрд┐ рдореЗрд░реЗ рдкреНрд░рдпреЛрдЧреЛрдВ рдиреЗ рджрд┐рдЦрд╛рдпрд╛ рд╣реИ, рдХрдВрдЯреЗрдирд░ рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдиреЛрдбреНрд╕ рдкрд░ рдбреЙрдХрдЯрд░ рдФрд░ рдХрдВрдЯреЗрдирд░ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░реЗрдВрдЧреЗред </li><li> рд╣рдо рдлрд▓рд╛рд▓реИрди рдХреЗ рд▓рд┐рдП <code>host-gw</code> рдмреИрдХрдПрдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд▓рд╛рд▓реИрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди</a> рдЕрдиреБрднрд╛рдЧ рдкрдврд╝реЗрдВ </li><li>  рд╣рдо рдирд┐рдЧрд░рд╛рдиреА, тАЛтАЛрдмреИрдХрдЕрдк, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝рд╛рдЗрд▓реЛрдВ (рд╕реНрдерд┐рддрд┐) рдХреЛ рдмрдЪрд╛рдиреЗ, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛрдб (git / hg / svn / etc) рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рднреА рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред </li></ul><br><h1 id="vvedenie">  рдкрд░рд┐рдЪрдп </h1><br><p>  рдХрд╛рдо рдХреЗ рджреМрд░рд╛рди, рдореИрдВрдиреЗ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рд╕реНрд░реЛрддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛, рд▓реЗрдХрд┐рди рдореИрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╡рд┐рд╕реНрддреГрдд <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕</a> рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реВрдВ рдЬреЛ рдХрдард┐рди рддрд░реАрдХрд╛</a> рдЧрд╛рдЗрдб рд╣реИ, рдЬреЛ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдореВрд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рд▓рдЧрднрдЧ 90% рдХрд╡рд░ рдХрд░рддрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрд╕ рдореИрдиреБрдЕрд▓ рдХреЛ рдкрдврд╝ рдЪреБрдХреЗ рд╣реИрдВ, рддреЛ рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд╝реНрд▓реЗрдирд▓рд╛рдЗрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди</a> рдЕрдиреБрднрд╛рдЧ рдкрд░ рд╕реАрдзреЗ рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред </p><br><div class="spoiler">  <b class="spoiler_title">рдкрджрдирд╛рдо</b> <div class="spoiler_text"><h2 id="spisok-terminov--glossariy">  рд╢рдмреНрджреЛрдВ рдХреА рд╕реВрдЪреА / рд╢рдмреНрджрд╛рд╡рд▓реА </h2><br><ul><li>  рдПрдкреАрдЖрдИ-рд╕рд░реНрд╡рд░ - рдПрдХ рднреМрддрд┐рдХ рдпрд╛ рдЖрднрд╛рд╕реА рдорд╢реАрди рдЬрд┐рд╕ рдкрд░ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреНрдпреВрдм-рдПрдкреЗрд╕реНрд╡рд░ рдЪрд▓рд╛рдиреЗ рдФрд░ рд╕рд╣реА рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╕реНрдерд┐рдд рд╣реИред  рдЗрд╕ рд▓реЗрдЦ рдХреЗ рдкреНрд░рдпреЛрдЬрдиреЛрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдПрджреНрдб, рдХреНрдпреВрдм-рдПрдкреЗрд╕реНрд╡рд░, рдХреНрдпреВрдм-рдХрдВрдЯреНрд░реЛрд▓рд░-рдореИрдиреЗрдЬрд░, рдХреНрдпреВрдм-рд╢реЗрдбреНрдпреВрд▓рд░ рд╣реИред </li><li>  рдорд╛рд╕реНрдЯрд░ - рдПрдХ рд╕рдорд░реНрдкрд┐рдд рд╡рд░реНрдХрд╕реНрдЯреЗрд╢рди рдпрд╛ рд╡реАрдкреАрдПрд╕ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди, рдПрдкреАрдЖрдИ-рд╕рд░реНрд╡рд░ рдХрд╛ рдПрдХ рдкрд░реНрдпрд╛рдпред </li><li>  рдиреЛрдб-рдПрдХреНрд╕ - рдПрдХ рд╕рдорд░реНрдкрд┐рдд рд╡рд░реНрдХрд╕реНрдЯреЗрд╢рди рдпрд╛ рд╡реАрдкреАрдПрд╕ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди, <code>X</code> рд╕реНрдЯреЗрд╢рди рдХреЗ рд╕реАрд░рд┐рдпрд▓ рдирдВрдмрд░ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╕рднреА рд╕рдВрдЦреНрдпрд╛рдПрдВ рдЕрджреНрд╡рд┐рддреАрдп рд╣реИрдВ рдФрд░ рд╕рдордЭрдиреЗ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВ: <br><ul><li>  рдиреЛрдб -1 - рдорд╢реАрди рдирдВрдмрд░ 1 </li><li>  рдиреЛрдб -2 - рдорд╢реАрди рдирдВрдмрд░ 2 </li></ul></li><li>  vCPU - рд╡рд░реНрдЪреБрдЕрд▓ рд╕реАрдкреАрдпреВ, рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЛрд░ред  рд╕рдВрдЦреНрдпрд╛ рдХреЛрд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреА рд╣реИ: 1vCPU - рдПрдХ рдХреЛрд░, 2vCPU - рджреЛ, рдФрд░ рдЗрд╕реА рддрд░рд╣ред </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ - рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рдиред  рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдирд┐рд░реНрджреЗрд╢реЛрдВ рдореЗрдВ <code>user$</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рд╢рдмреНрдж рдХрд┐рд╕реА рднреА рдЧреНрд░рд╛рд╣рдХ рдорд╢реАрди рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИред </li><li>  рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ - рдХрд╛рд░реНрдп рдиреЛрдб рдЬрд┐рд╕ рдкрд░ рдкреНрд░рддреНрдпрдХреНрд╖ рдЧрдгрдирд╛ рдХреА рдЬрд╛рдПрдЧреА, <code>node-X</code> рд╕рд╛рде рдкрд░реНрдпрд╛рдпрд╡рд╛рдЪреА рд░реВрдк рд╕реЗ </li><li>  рд╕рдВрд╕рд╛рдзрди рд╡рд╣ рдЗрдХрд╛рдИ рд╣реИ рдЬрд┐рд╕ рдкрд░ рдХреБрдмреЗрд░рдиреЗрдЯ рд╕рдореВрд╣ рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рд╣реЛрддрд╛ рд╣реИред  рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдореЗрдВ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдВрдмрдВрдзрд┐рдд рдирд┐рдХрд╛рдп рд╢рд╛рдорд┐рд▓ рд╣реИрдВ</a> ред </li></ul></div></div><br><h1 id="setevaya-arhitektura-resheniya">  рдиреЗрдЯрд╡рд░реНрдХ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рд╕рдорд╛рдзрд╛рди </h1><br><p>  рдХреНрд▓рд╕реНрдЯрд░ рдмрдврд╝рд╛рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ, рдореИрдВрдиреЗ рдкреНрд░рддрд┐ рдорд╛рд╣ $ 20 рдХреЗ рдмрдЬрдЯ рдореЗрдВ рдлрд┐рдЯ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рд▓реЛрд╣реЗ рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░реНрдп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ред  рдХрдо рд╕реЗ рдХрдо рджреЛ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдиреЛрдбреНрд╕ (рдиреЛрдбреНрд╕) рдХреЗ рд╕рд╛рде рдПрдХ рдХрд╛рд░реНрдпрд╢реАрд▓ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдерд╛ред  рдЗрд╕рд▓рд┐рдП, рд╢реБрд░реВ рдореЗрдВ рдХреНрд▓рд╕реНрдЯрд░ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рдерд╛: </p><br><ul><li>  2 рд╡реАрд╕реАрдкреАрдпреВ / 4 рдЬреА рд░реИрдо рдХреЗ рд╕рд╛рде рдорд╢реАрди: рдПрдкреАрдЖрдИ-рд╕рд░реНрд╡рд░ + рдиреЛрдб -1 [20 $] </li><li>  2 рд╡реАрд╕реАрдкреАрдпреВ / 4 рдЬреА рд░реИрдо рдХреЗ рд╕рд╛рде рдорд╢реАрди: рдиреЛрдб -2 [$ 20] </li></ul><br><p>  рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдкрд╣рд▓реЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдореИрдВрдиреЗ рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ рддрд╛рдХрд┐ рдХреНрд▓рд╕реНрдЯрд░ (рдХрд╛рд░реНрдп рдиреЛрдбреНрд╕, рд╡реЗ рднреА рд╢реНрд░рдорд┐рдХ рд╣реИрдВ) рдФрд░ рдорд╛рд╕реНрдЯрд░ рд╕рд░реНрд╡рд░ рдХреЗ рдПрдкреАрдЖрдИ рдХреЗ рднреАрддрд░ рдЪрд▓ рд░рд╣реЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рдиреЛрдбреНрд╕ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░ рд╕рдХреЗрдВред </p><br><p>  рдирддреАрдЬрддрди, рдореБрдЭреЗ рдЗрд╕ рд╕рд╡рд╛рд▓ рдХрд╛ рдЬрд╡рд╛рдм рдорд┐рд▓рд╛: "рдпрджрд┐ рдХрдо рдпрд╛ рдЬреНрдпрд╛рджрд╛ рд╕рд╕реНрддреА, рд▓реЗрдХрд┐рди рдХрд╛рдордХрд╛рдЬреА рдХреНрд▓рд╕реНрдЯрд░ рдХреИрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИ, рдЕрдЧрд░ рдореИрдВ рд╡рд╣рд╛рдВ рд╕рдмрд╕реЗ рдореЛрдЯреЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ рдирд╣реАрдВ рд░рдЦрдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВред" </p><br><div class="spoiler">  <b class="spoiler_title">$ 20 рдирд┐рд░реНрдгрдп</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/getpro/habr/post_images/216/89c/a88/21689ca889156d11108e5f5327c606cc.png" alt="рдбрд┐рдЬрд╝рд╛рдЗрди"><br>  (рдРрд╕рд╛ рд╣реЛрдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рдИ) </p></div></div><br><div class="spoiler">  <b class="spoiler_title">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рд╕рд╛рдорд╛рдиреНрдп рдЬрд╛рдирдХрд╛рд░реА</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/getpro/habr/post_images/820/462/882/820462882e7cc92479190c067ac4a4f8.jpg" alt="рдбрд┐рдЬрд╝рд╛рдЗрди"><br>  (рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдЪреЛрд░реА рдЕрдЧрд░ рдХрд┐рд╕реА рдХреЛ рдЕрднреА рднреА рдкрддрд╛ рдирд╣реАрдВ рд╣реИ рдпрд╛ рдирд╣реАрдВ рджреЗрдЦрд╛ рд╣реИ) </p></div></div><br><h2 id="komponenty-i-ih-proizvoditelnost">  рдЕрд╡рдпрд╡ рдФрд░ рдЙрдирдХрд╛ рдкреНрд░рджрд░реНрд╢рди </h2><br><p>  рдкрд╣рд▓рд╛ рдХрджрдо рдпрд╣ рд╕рдордЭрдирд╛ рдерд╛ рдХрд┐ рдХреНрд▓рд╕реНрдЯрд░ рд╕реЗ рд╕реАрдзреЗ рдЬреБрдбрд╝реЗ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдкреИрдХреЗрдЬреЛрдВ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдЭреЗ рдХрд┐рддрдиреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  "рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ" рдХреА рдЦреЛрдЬ рдиреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд░рд┐рдгрд╛рдо рдирд╣реАрдВ рджрд┐рдП, рдЗрд╕рд▓рд┐рдП рдореБрдЭреЗ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рдХрд╛рд░реНрдп рдХреЛ рдЕрдкрдирд╛рдирд╛ рдкрдбрд╝рд╛ред  MEM рдФрд░ CPU рдХреА рдорд╛рдк рдХреЗ рд░реВрдк рдореЗрдВ, рдореИрдВрдиреЗ systemd рд╕реЗ рдЖрдВрдХрдбрд╝реЗ рд▓рд┐рдП - рд╣рдо рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдорд╛рдк рдмрд╣реБрдд рд╣реА рд╢реМрдХрд┐рдпрд╛ рддрд░реАрдХреЗ рд╕реЗ рдХрд┐рдП рдЧрдП рдереЗ, рд▓реЗрдХрд┐рди рдореЗрд░реЗ рдкрд╛рд╕ рд╕рдЯреАрдХ рдорд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░реНрдп рдирд╣реАрдВ рдерд╛, рдХреНрдпреЛрдВрдХрд┐ рдореБрдЭреЗ рдЕрднреА рднреА $ 5 рдкреНрд░рддрд┐ рдЙрджрд╛рд╣рд░рдг рд╕реЗ рд╕рд╕реНрддрд╛ рдХреЛрдИ рд╡рд┐рдХрд▓реНрдк рдирд╣реАрдВ рдорд┐рд▓рд╛ред </p><br><div class="spoiler">  <b class="spoiler_title">рдХреНрдпреЛрдВ $ 5 рдмрд┐рд▓реНрдХреБрд▓?</b> <div class="spoiler_text"><p>  рд░реВрд╕ рдпрд╛ рд╕реАрдЖрдИрдПрд╕ рдореЗрдВ рд╕рд░реНрд╡рд░ рдХреА рдореЗрдЬрдмрд╛рдиреА рдХрд░рддреЗ рд╕рдордп рд╡реАрдкреАрдПрд╕ / рд╡реАрдбреАрдПрд╕ рдХреЛ рд╕рд╕реНрддрд╛ рдЦреЛрдЬрдирд╛ рд╕рдВрднрд╡ рдерд╛, рд▓реЗрдХрд┐рди рдЖрдИрдПрд▓рд╡реА рдФрд░ рдЗрд╕рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рд╕реЗ рдЬреБрдбрд╝реА рджреБрдЦрдж рдХрд╣рд╛рдирд┐рдпрд╛рдВ рдХреБрдЫ рдЬреЛрдЦрд┐рдо рдкреИрджрд╛ рдХрд░рддреА рд╣реИрдВ рдФрд░ рдЙрдирд╕реЗ рдмрдЪрдиреЗ рдХреА рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рдЗрдЪреНрдЫрд╛ рдХреЛ рдЬрдиреНрдо рджреЗрддреА рд╣реИрдВред </p></div></div><br><p>  рддреЛ: </p><br><ul><li>  рдорд╛рд╕реНрдЯрд░ рд╕рд░реНрд╡рд░ / рд╕рд░реНрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди (рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕): <br><ul><li>  рдЕрдиреНрдбрд░ (3.2.17): 80 - 100 рдореАрдЯрд░, рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЪрдпрдирд┐рдд рд╕рдордп рдкрд░ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  Etcd рдФрд╕рдд рдореЗрдореЛрд░реА рдХреА рдЦрдкрдд 300M рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рдереА; </li><li>  рдХреНрдпреВрдм-рдПрдкреЗрд╕реНрд╡рд░ (1.12.x - 1.13.0): 237.6M ~ 300M; </li><li>  рдХреНрдпреВрдм-рдХрдВрдЯреНрд░реЛрд▓рд░-рдореИрдиреЗрдЬрд░ (1.12.x - 1.13.0): рд▓рдЧрднрдЧ 90M, 100M рд╕реЗ рдКрдкрд░ рдирд╣реАрдВ рдмрдврд╝рд╛; </li><li>  рдХреНрдпреВрдм-рд╢реЗрдбреНрдпреВрд▓рд░ (1.12.x - 1.13.0): рд▓рдЧрднрдЧ 20M, 30-50M рд╕реЗ рдКрдкрд░ рдХреА рдЦрдкрдд рддрдп рдирд╣реАрдВ рд╣реИред </li></ul></li><li>  рд╡рд░реНрдХрд░ рд╕рд░реНрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди (рд╡рд░реНрдХрд░ рдиреЛрдбреНрд╕): <br><ul><li>  рдХреНрдпреВрдмрд▓реЗрдЯ (1.12.3 - 1.13.1): рд▓рдЧрднрдЧ 35 рдПрдордмреА, 50M рд╕реЗ рдКрдкрд░ рдХреА рдЦрдкрдд рддрдп рдирд╣реАрдВ рд╣реИ; </li><li>  рдХреНрдпреВрдм-рдкреНрд░реЙрдХреНрд╕реА (1.12.3 - 1.13.1): рд▓рдЧрднрдЧ 7.5 - 10M; </li><li>  рдлрд▓рд╛рд▓реИрди (0.10.0): рд▓рдЧрднрдЧ 15-20 рдореАрдЯрд░; </li><li>  coredns (1.3.0): рд▓рдЧрднрдЧ 25M; </li><li>  рдХрдВрдЯреЗрдирд░ (1.2.1): рдХрдВрдЯреЗрдирд░ рдХреА рдЦрдкрдд рдХрдо рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдВрдХрдбрд╝реЗ рднреА рдбреЗрдорди рджреНрд╡рд╛рд░рд╛ рд╢реБрд░реВ рдХрд┐рдП рдЧрдП рдХрдВрдЯреЗрдирд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВред </li></ul></li></ul><br><div class="spoiler">  <b class="spoiler_title">рдХреНрдпрд╛ рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдкрд░ рдХрдВрдЯреЗрдирд░ / рдбреЙрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ?</b> <div class="spoiler_text"><p>  <strong>рдирд╣реАрдВ, рдЬрд░реВрд░рдд рдирд╣реАрдВ</strong> ред  рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдХреЛ рдкреНрд░рддрд┐ secker рдпрд╛ рдХрдВрдЯреЗрдирд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдореИрдиреБрдЕрд▓ рд╣реИрдВ рдХрд┐ рдХрд┐рд╕реА рдЙрджреНрджреЗрд╢реНрдп рдпрд╛ рдЕрдиреНрдп рдХреЗ рд▓рд┐рдП рдХрдВрдЯреЗрдирд░реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рд╡рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред  рдкреНрд░рд╢реНрди рдореЗрдВ рд╡рд┐рдиреНрдпрд╛рд╕ рдореЗрдВ, рдХрдВрдЯреЗрдирд░рдб рдХреЛ рдирд┐рд░реНрднрд░рддрд╛ рдХреА рд╕реВрдЪреА рд╕реЗ рдЬрд╛рдирдмреВрдЭрдХрд░ рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд╣рд╛рд▓рд╛рдВрдХрд┐, рдореИрдВ рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рдХрд┐рд╕реА рднреА рд╕реНрдкрд╖реНрдЯ рдлрд╛рдпрджреЗ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реВрдВред </p><br><p>  рдХреНрд▓рд╕реНрдЯрд░ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдКрдкрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдиреНрдпреВрдирддрдо рдФрд░ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред  рдЬрдм рддрдХ рдЖрдк рдЕрдкрдиреА рдЗрдЪреНрдЫрд╛рдиреБрд╕рд╛рд░ рдХреБрдЫ рдЬреЛрдбрд╝рдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ, рдХреЛрдИ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд╛рд░реНрд░рд╡рд╛рдИ / рдШрдЯрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </p></div></div><br><p>  рдШрд░ рдХреА рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрд░реАрдХреНрд╖рдг рдХреНрд▓рд╕реНрдЯрд░ рдпрд╛ рдХреНрд▓рд╕реНрдЯрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, 1vCPU / 1G RAM рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдХреЛ рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред  рдмреЗрд╢рдХ, рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдкрд░ рд▓реЛрдб рд╢рд╛рдорд┐рд▓ рд╢реНрд░рдорд┐рдХреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛, рд╕рд╛рде рд╣реА рдПрдкреАрдЖрдИ-рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рдФрд░ рдорд╛рддреНрд░рд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣реЛрдЧрд╛ред </p><br><p>  рдореИрдВрдиреЗ рдорд╛рд╕реНрдЯрд░ рдФрд░ рд╡рд░реНрдХрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рд╡рд┐рд╕реНрдлреЛрдЯ рдХрд┐рдпрд╛: </p><br><ul><li>  рд╕реНрдерд╛рдкрд┐рдд рдШрдЯрдХреЛрдВ рдХреЗ рд╕рд╛рде 1x рдорд╛рд╕реНрдЯрд░: рд╡рдЧреИрд░рд╣, рдХреНрдпреВрдм-рдПрдкреЗрд╕реНрд╡рд░, рдХреНрдпреВрдм-рдХрдВрдЯреНрд░реЛрд▓рд░-рдореИрдиреЗрдЬрд░, рдХреНрдпреВрдм-рд╢реЗрдбреНрдпреВрд▓рд░ </li><li>  рд╕реНрдерд╛рдкрд┐рдд рдШрдЯрдХреЛрдВ рдХреЗ рд╕рд╛рде 2x рд╢реНрд░рдорд┐рдХ: рдХрдВрдЯреЗрдирд░, рдХреЛрд░рдбрдиреНрд╕, рдлрд▓рд╛рд▓реИрди, рдХреНрдпреВрдмрд▓реЗрдЯ, рдХреНрдпреВрдм-рдкреНрд░реЙрдХреНрд╕реА </li></ul><br><h1 id="konfiguraciya">  рд╡рд┐рдиреНрдпрд╛рд╕ </h1><br><p>  рд╡рд┐рдЬрд╝рд╛рд░реНрдб рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдШрдЯрдХреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ: </p><br><ul><li><p>  рдЖрджрд┐ - рдПрдкреАрдЖрдИ-рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рд╛рде рд╣реА рдлрд▓рд╛рд▓реИрди рдХреЗ рд▓рд┐рдП; </p><br></li><li><p>  kube-apiserver - рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдПрдкреАрдЖрдИ-рд╕рд░реНрд╡рд░; </p><br></li><li><p>  рдХреНрдпреВрдм-рдирд┐рдпрдВрддреНрд░рдХ-рдкреНрд░рдмрдВрдзрдХ - рдШрдЯрдирд╛рдУрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП; </p><br></li><li><p>  рдХреНрдпреВрдм-рд╢реЗрдбреНрдпреВрд▓рд░ - рдПрдкреАрдЖрдИ-рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрдВрдЬреАрдХреГрдд рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд╡рд┐рддрд░рдг рдХреЗ рд▓рд┐рдП - рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЪреВрд▓реНрд╣рд╛</a> ред <br>  рд╡рд░реНрдХрд╣реЙрд░реНрд╕ рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдШрдЯрдХреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ: </p><br></li><li><p>  рдХреНрдпреВрдмрд▓реЗрдЯ - рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪреВрд▓реНрд╣рд╛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП; </p><br></li><li><p>  рдХреНрдпреВрдм-рдкреНрд░реЙрдХреНрд╕реА - рдХреБрдмреЗрд░рдиреЗрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реЗрд╡рд╛рдУрдВ рдХреЗ</a> рдорд╛рд░реНрдЧ / рдЖрдпреЛрдЬрди рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП; </p><br></li><li><p>  coredns - рд░рдирд┐рдВрдЧ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╕реЗрд╡рд╛ рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП; </p><br></li><li><p>  рдлрд▓рд╛рд▓реИрди - рд╡рд┐рднрд┐рдиреНрди рдиреЛрдбреНрд╕ рдкрд░ рдХрд╛рдо рдХрд░ рд░рд╣реЗ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рдиреЗрдЯрд╡рд░реНрдХ рдПрдХреНрд╕реЗрд╕ рдХреЗ рдЖрдпреЛрдЬрди рдХреЗ рд▓рд┐рдП, рд╕рд╛рде рд╣реА рдХреНрд▓рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ (рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдиреЛрдб) рдХреЗ рдмреАрдЪ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЧрддрд┐рд╢реАрд▓ рд╡рд┐рддрд░рдг рдХреЗ рд▓рд┐рдПред </p><br></li></ul><br><div class="spoiler">  <b class="spoiler_title">CoreDNS</b> <div class="spoiler_text"><p>  рдпрд╣рд╛рдВ рдПрдХ рдЫреЛрдЯрд╛ рд╡рд┐рд╖рдпрд╛рдВрддрд░ рдмрдирд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП: рдорд╛рд╕реНрдЯрд░ рд╕рд░реНрд╡рд░ рдкрд░ рднреА рдХреЛрд░рдбреЛрди рд▓реЙрдиреНрдЪ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдХреЛрдИ рднреА рдкреНрд░рддрд┐рдмрдВрдз рдирд╣реАрдВ рд╣реИ рдЬреЛ coredns рдХреЛ рдХрд╛рдо рдиреЛрдбреНрд╕ рдкрд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдзреНрдп рдХрд░реЗрдЧрд╛, coredns.service рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдмрд╛рд░реАрдХрд┐рдпреЛрдВ рдХреЛ рдЫреЛрдбрд╝рдХрд░, рдЬреЛ рд╕рд┐рд╕реНрдЯрдо-рд╣рд▓ рдХреА рдЧрдИ рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рд╕рдВрдШрд░реНрд╖ рдХреЗ рдХрд╛рд░рдг рдорд╛рдирдХ / рдЕрдирдореЙрдбрд┐рдлрд╛рдЗрдб Ubuntu рд╕рд░реНрд╡рд░ рдкрд░ рд╢реБрд░реВ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред  рдореИрдВрдиреЗ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдирд╣реАрдВ рдХреА, рдХреНрдпреЛрдВрдХрд┐ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдиреЛрдбреНрд╕ рдкрд░ рд╕реНрдерд┐рдд 2 рдПрдирдПрд╕ рд╕рд░реНрд╡рд░ рдореБрдЭрд╕реЗ рдХрд╛рдлреА рдЦреБрд╢ рдереЗред </p></div></div><br><p>  рдШрдЯрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рднреА рд╡рд┐рд╡рд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдЦреБрдж рдХреЛ рдкрд░рд┐рдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдм рд╕рдордп рдмрд░реНрдмрд╛рдж рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореЗрд░рд╛ рд╕реБрдЭрд╛рд╡ рд╣реИ рдХрд┐ рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕</a> рдореЗрдВ рдЙрдирдХреЗ рд╕рд╛рде рдЦреБрдж рдХреЛ рдкрд░рд┐рдЪрд┐рдд рдХрд░реЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреЛ рдХрдард┐рди рд░рд╛рд╕реНрддрд╛</a> рдЧрд╛рдЗрдб рд╣реИред  рдореИрдВ рдЕрдкрдиреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╡рд┐рдХрд▓реНрдк рдХреА рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░реВрдВрдЧрд╛ред </p><br><h2 id="fayly">  рдлрд╝рд╛рдЗрд▓реЗрдВ </h2><br><p>  рд╡рд┐рдЬрд╝рд╛рд░реНрдб рдФрд░ рдХрд╛рд░реНрдп рдиреЛрдбреНрд╕ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╕реНрдЯрд░ рдШрдЯрдХреЛрдВ рдХреЗ рдХрд╛рдордХрд╛рдЬ рдХреЗ рд▓рд┐рдП рд╕рднреА рдлрд╛рдЗрд▓реЗрдВ рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП <strong>/ var / lib / kubernetes /</strong> рдореЗрдВ рд░рдЦреА рдЧрдИ рд╣реИрдВред  рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рдЖрдк рдЙрдиреНрд╣реЗрдВ рджреВрд╕рд░реЗ рддрд░реАрдХреЗ рд╕реЗ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред </p><br><h2 id="sertifikaty">  рдкреНрд░рдорд╛рдгрдкрддреНрд░ </h2><br><p>  рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреА рдкреАрдврд╝реА рдХреЗ рд▓рд┐рдП рдЖрдзрд╛рд░ рдЕрднреА рднреА рдПрдХ рд╣реА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХрдард┐рди рддрд░реАрдХрд╛ рд╣реИ</a> , рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд░реВрдк рд╕реЗ рдХреЛрдИ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЕрдВрддрд░ рдирд╣реАрдВ рд╣реИрдВред  рдЕрдзреАрдирд╕реНрде рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, <a href="">рд╕реАрдПрдлрдПрд╕рдПрд▓</a> рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рдЖрд╕рдкрд╛рд╕ рд╕рд░рд▓ рдмреИрд╢ рд▓рд┐рдкрд┐рдпреЛрдВ рдХреЛ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдерд╛ - рдбрд┐рдмрдЧрд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдпрд╣ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рдерд╛ред </p><br><p>  рдЖрдк рдиреАрдЪреЗ рджреА рдЧрдИ рд▓рд┐рдкрд┐рдпреЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ рдЕрдкрдиреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдг рдкрддреНрд░ рддреИрдпрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ</a> рд╡реНрдпрдВрдЬрдиреЛрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреЛ рдХрдард┐рди рддрд░реАрдХрд╛</a> рдпрд╛ рдЕрдиреНрдп рдЙрдкрдпреБрдХреНрдд рдЙрдкрдХрд░рдгред </p><br><div class="spoiler">  <b class="spoiler_title">рдмреИрд╢ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдЬреЗрдирд░реЗрд╢рди</b> <div class="spoiler_text"><p>  рдЖрдк рдпрд╣рд╛рдВ рд╕реНрдХреНрд░рд┐рдкреНрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рд╛рдкреНрдд</a> рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдмреВрдЯрд╕реНрдЯреНрд░реИрдк</a> ред  рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдлрд╝рд╛рдЗрд▓ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ <a href="">/ env.sh рдХреЛ</a> рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ, рдЕрдкрдиреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред  рдПрдХ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> certs <span class="hljs-comment"><span class="hljs-comment">#:   certs$ ./generate-keys.sh # ... certificate generate output #:  kubeconfig     certs$ ./generate-configkube.sh</span></span></code> </pre> <br><p>  рдпрджрд┐ рдЖрдкрдиреЗ <code>env.sh</code> рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИ рдФрд░ рд╕рднреА рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЙрддреНрдкрдиреНрди рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЛ рдЫреВрдиреЗ рдХреА рдХреЛрдИ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рдпрджрд┐ рдЖрдкрдиреЗ рдХрд┐рд╕реА рдмрд┐рдВрджреБ рдкрд░ рдЧрд▓рддреА рдХреА рд╣реИ, рддреЛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЛ рднрд╛рдЧреЛрдВ рдореЗрдВ рдкреБрдирд░реНрдЬреАрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЙрдкрд░реЛрдХреНрдд рдмреИрд╢ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рддреБрдЪреНрдЫ рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рдЫрд╛рдВрдЯрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рд╣реИред </p><br><p>  рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдиреЛрдЯ - рдЖрдкрдХреЛ рдЕрдХреНрд╕рд░ <code>ca.pem</code> рдФрд░ <code>ca-key.pem</code> рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдирд╣реАрдВ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рд╕рднреА рдмрд╛рдж рдХреЗ рдкреНрд░рдорд╛рдг рдкрддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдореВрд▓ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рд╣реИрдВ, рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдЖрдкрдХреЛ рд╕рднреА рд╕рд╛рде рд╡рд╛рд▓реЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╕рднреА рдорд╢реАрдиреЛрдВ рдФрд░ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪрд╛рдирд╛ рд╣реЛрдЧрд╛ред </p></div></div><br><h3 id="master">  рдЧреБрд░реБ </h3><br><p>  рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдкрд░ рд╕реЗрд╡рд╛рдПрдВ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЛ <code>/var/lib/kubernetes/</code> : рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><ul><li>  ca.pem - рдпрд╣ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рд╣рд░ рдЬрдЧрд╣ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕реЗ рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдмрд┐рдирд╛ рдмрджрд▓рд╛рд╡ рдХреЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВред  рдЬрдм рдЖрдк рдЗрд╕реЗ рдкреБрдирд░реНрдЬреАрд╡рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рд╕рднреА рдиреЛрдбреНрд╕ рдкрд░ рдХреЙрдкреА рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рд╕рд╛рде рд╣реА рд╕рд╛рде рдЗрд╕реЗ (рд╕рднреА рдорд╢реАрдиреЛрдВ рдкрд░ рднреА) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреБрдмреЗрдХреЙрдиреНрдЧ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </li><li>  ca-key.pem рдиреЛрдбреНрд╕ рдкрд░ рдирдХрд▓ рдХрд░рдиреЗ рдХреЗ рд╕рдорд╛рди рд╣реИред </li><li>  рдХреНрдпреВрдм-рдХрдВрдЯреНрд░реЛрд▓рд░- manager.pem - рдХреЗрд╡рд▓ рдХреНрдпреВрдм-рдХрдВрдЯреНрд░реЛрд▓рд░-рдореИрдиреЗрдЬрд░ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред </li><li>  рдХреНрдпреВрдм-рдХрдВрдЯреНрд░реЛрд▓рд░-рдореИрдиреЗрдЬрд░- key.pem - рдХреЗрд╡рд▓ рдХреНрдпреВрдм-рдХрдВрдЯреНрд░реЛрд▓рд░-рдореИрдиреЗрдЬрд░ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред </li><li><p>  kubernetes.pem - рдлрд▓рд╛рд▓реИрди рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдХреЙрд░реНрдб-рдХреНрдпреБрдб-рдПрд╡реЗрд░реНрд╡рд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╕рдордп рдХреЙрд░реНрдбрдиред </p><br><div class="spoiler">  <b class="spoiler_title">рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рдкреАрдЫреЗ рд╣рдЯрдирд╛</b> <div class="spoiler_text"><p>  рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Kubernetes рд╣рд╛рд░реНрдб рддрд░реАрдХрд╛</a> рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд▓реЙрдЬрд┐рдХ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИред <br>  рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣рд░ рдЬрдЧрд╣ рд╣реЛрдЧреА - рд╡рд┐рдЬрд╝рд╛рд░реНрдб рдкрд░ рдФрд░ рдХрд╛рд░реНрдп рдиреЛрдбреНрд╕ рдкрд░ред  рдореИрдВрдиреЗ рдореВрд▓ рдореИрдиреБрдЕрд▓ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рдирд╣реАрдВ рдмрджрд▓рд╛, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреА рдорджрдж рд╕реЗ рдХреНрд▓рд╕реНрдЯрд░ рдСрдкрд░реЗрд╢рди рдХреЛ рддреЗрдЬреА рд╕реЗ рдФрд░ рдЕрдзрд┐рдХ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдирд╛ рдФрд░ рдирд┐рд░реНрднрд░рддрд╛ рдХреЗ рдкреВрд░реЗ рдЧреБрдЪреНрдЫрд╛ рдХреЛ рд╕рдордЭрдирд╛ рд╕рдВрднрд╡ рд╣реИред </p><br><p>  рдореЗрд░реА рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░рд╛рдп рд╣реИ рдХрд┐ etcd рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬреЛ kubernetes рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред </p><br></div></div><br></li></ul><br><ul><li>  kubernetes-key.pem - рдорд╛рд╕реНрдЯрд░ рд╕рд░реНрд╡рд░ рдкрд░ рд░рд╣рддрд╛ рд╣реИред </li><li>  рд╕реЗрд╡рд╛- account.pem - рдХреЗрд╡рд▓ рдШрди-рдирд┐рдпрдВрддреНрд░рдХ-рдкреНрд░рдмрдВрдзрдХ рдбреЗрдореЙрди рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред </li><li>  service-account-key.pem - рдЗрд╕реА рддрд░рд╣ред </li></ul><br><h3 id="rabochie-uzly">  рдХрд╛рдо рдХреА рдЗрдХрд╛рдЗрдпрд╛рдБ </h3><br><ul><li>  ca.pem - рдХрд╛рдо рдиреЛрдбреНрд╕ (рдХреНрдпреВрдмрд▓реЗрдЯ, рдХреНрдпреВрдм-рдкреНрд░реЙрдХреНрд╕реА) рдкрд░ рд╢рд╛рдорд┐рд▓ рд╕рднреА рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рд╕рд╛рде рд╣реА рдлрд▓рд╛рд▓реИрди, рдХреЛрд░рдбрдиреНрд╕ рдХреЗ рд▓рд┐рдП рднреАред  рдЕрдиреНрдп рдЪреАрдЬреЛрдВ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдХреБрдмреЗрдХреЙрдиреНрдл рдлрд╛рдЗрд▓ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрдм рд╡реЗ рдХреБрдмреНрд▓реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрддреНрдкрдиреНрди рд╣реЛрддреЗ рд╣реИрдВред </li><li>  kubernetes-key.pem - рдХреЛ рдлреЗрд▓реНрдб рдФрд░ рдХреЙрд░реНрдбрди рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдХреЙрд░реНрдб рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬреЛ рдПрдкреА рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдкрд░ рд╕реНрдерд┐рдд рд╣реИред </li><li>  kubernetes.pem - рдкрд┐рдЫрд▓реЗ рдПрдХ рдХреЗ рд╕рдорд╛рди, рдХреЗрд╡рд▓ рдлрд▓рд╛рд▓реИрди рдФрд░ рдХреЙрд░реНрдбрди рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХред </li><li>  kubelet / node-1.pem - рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдиреЛрдб -1 рдХреЗ рд▓рд┐рдП рдХреБрдВрдЬреАред </li><li>  kubelet / node-1-key.pem - рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдиреЛрдб -1 рдХреЗ рд▓рд┐рдП рдХреБрдВрдЬреАред </li></ul><br><p>  <strong>рдорд╣рддреНрд╡рдкреВрд░реНрдг!</strong>  рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдиреЛрдб рд╣реИрдВ, рддреЛ рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдореЗрдВ <code>node-X.kubeconfig</code> рдЕрдВрджрд░ рдиреЛрдб- <code>node-X-key.pem</code> , <code>node-X.pem</code> рдФрд░ <code>node-X.kubeconfig</code> рдлрд╛рдЗрд▓реЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВрдЧреАред </p><br><div class="spoiler">  <b class="spoiler_title">рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдбреАрдмрдЧ рдХрд░рдирд╛</b> <div class="spoiler_text"><h4 id="otladka-sertifikatov">  рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдбреАрдмрдЧ рдХрд░рдирд╛ </h4><br><p>  рдХрднреА-рдХрднреА рдЖрдкрдХреЛ рдпрд╣ рджреЗрдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рдХрд┐ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХрд┐рд╕ IP / DNS рд╣реЛрд╕реНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  <code>cfssl-certinfo -cert &lt;cert&gt;</code> рдХрдорд╛рдВрдб рд╣рдореЗрдВ рдЗрд╕рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо <code>node-1.pem</code> рд▓рд┐рдП рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА <code>node-1.pem</code> : </p><br><pre> <code class="bash hljs">$ cfssl-certinfo -cert node-1.pem</code> </pre> <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"subject"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"common_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"system:node:node-1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>: <span class="hljs-string"><span class="hljs-string">"RU"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"organization"</span></span>: <span class="hljs-string"><span class="hljs-string">"system:nodes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"organizational_unit"</span></span>: <span class="hljs-string"><span class="hljs-string">"Infrastructure Unit"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"locality"</span></span>: <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"province"</span></span>: <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"RU"</span></span>, <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-string"><span class="hljs-string">"system:nodes"</span></span>, <span class="hljs-string"><span class="hljs-string">"Infrastructure Unit"</span></span>, <span class="hljs-string"><span class="hljs-string">"system:node:node-1"</span></span> ] }, <span class="hljs-attr"><span class="hljs-attr">"issuer"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"common_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Kubernetes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>: <span class="hljs-string"><span class="hljs-string">"RU"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"organization"</span></span>: <span class="hljs-string"><span class="hljs-string">"Kubernetes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"organizational_unit"</span></span>: <span class="hljs-string"><span class="hljs-string">"Infrastructure"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"locality"</span></span>: <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"province"</span></span>: <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"RU"</span></span>, <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-string"><span class="hljs-string">"Kubernetes"</span></span>, <span class="hljs-string"><span class="hljs-string">"Infrastructure"</span></span>, <span class="hljs-string"><span class="hljs-string">"Kubernetes"</span></span> ] }, <span class="hljs-attr"><span class="hljs-attr">"serial_number"</span></span>: <span class="hljs-string"><span class="hljs-string">"161113741562559533299282037709313751074033027073"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sans"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"w40k.net"</span></span>, <span class="hljs-string"><span class="hljs-string">"node-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"178.79.168.130"</span></span>, <span class="hljs-string"><span class="hljs-string">"192.168.164.230"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"not_before"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-01-04T14:24:00Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"not_after"</span></span>: <span class="hljs-string"><span class="hljs-string">"2029-01-01T14:24:00Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sigalg"</span></span>: <span class="hljs-string"><span class="hljs-string">"SHA256WithRSA"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"authority_key_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"6:C8:94:67:59:55:19:82:AD:ED:6D:50:F1:89:B:8D:46:78:FD:9A"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"subject_key_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"A1:5E:B3:3C:45:14:3D:C6:C:A:97:82:1:D5:2B:75:1A:A6:9D:B0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pem"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;pem content&gt;"</span></span> }</code> </pre> </div></div><br><p>  рдХреНрдпреВрдмрд▓реЗрдЯ рдФрд░ рдХреНрдпреВрдм-рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рд╕рднреА рдкреНрд░рдорд╛рдг рдкрддреНрд░ рд╕реАрдзреЗ рд╕рдВрдмрдВрдзрд┐рдд kubeconfig рдореЗрдВ рдПрдореНрдмреЗрдбреЗрдб рд╣реИрдВред </p><br><h2 id="kubeconfig">  kubeconfig </h2><br><p>  рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдХреБрдмреЗрдХреЙрдиреНрдлрд┐рдЧ рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХрд╛</a> рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрдард┐рди рддрд░реАрдХреЗ рд╕реЗ</a> рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣рд╛рдВ рдХреБрдЫ рдорддрднреЗрдж рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВред  рдореИрдиреБрдЕрд▓ <code>kubedns</code> рдФрд░ <code>cni bridge</code> <code>kubedns</code> рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">coredns</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">flannel</a> рднреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВред  рдмрджрд▓реЗ рдореЗрдВ, рдпреЗ рджреЛрдиреЛрдВ рд╕реЗрд╡рд╛рдПрдВ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ <code>kubeconfig</code> рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>kubeconfig</code> рдХрд╛ рдЙрдкрдпреЛрдЧ <code>kubeconfig</code> ред </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> certs <span class="hljs-comment"><span class="hljs-comment">#:  kubeconfig     certs$ ./generate-configkube.sh</span></span></code> </pre> <br><h3 id="master-1">  рдЧреБрд░реБ </h3><br><p>  рд╡рд┐рдЬрд╝рд╛рд░реНрдб рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрди kubeconfig рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ (рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдкреАрдврд╝реА рдХреЗ рдмрд╛рдж рдЙрдиреНрд╣реЗрдВ <code>certs/kubeconfig</code> рдореЗрдВ рд▓рд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ): </p><br><pre> <code class="plaintext hljs">master /var/lib/kubernetes/$ tree -L 2 . +-- kube-controller-manager.kubeconfig L-- kube-scheduler  L-- kube-scheduler.kubeconfig</code> </pre> <br><p>  рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕реЗрд╡рд╛ рдШрдЯрдХреЛрдВ рдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдЧрд╛ред </p><br><h3 id="rabochie-uzly-1">  рдХрд╛рдо рдХреА рдЗрдХрд╛рдЗрдпрд╛рдБ </h3><br><p>  рдХрд╛рдо рдиреЛрдбреНрд╕ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрди рдХреБрдмреЗрдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ: </p><br><pre> <code class="plaintext hljs">node-1 /var/lib/kubernetes/$ tree -L 2 . +-- coredns ┬ж  L-- coredns.kubeconfig +-- flanneld ┬ж  L-- flanneld.kubeconfig +-- kubelet ┬ж  L-- node-1.kubeconfig L-- kube-proxy  L-- kube-proxy.kubeconfig</code> </pre> <br><h2 id="zapusk-servisov">  рд╕реЗрд╡рд╛ рдХрд╛ рд╢реБрднрд╛рд░рдВрдн </h2><br><div class="spoiler">  <b class="spoiler_title">рд╕реЗрд╡рд╛рдПрдВ</b> <div class="spoiler_text"><p>  рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ рдореЗрд░реЗ рдХрд╛рдо рдХреЗ рдиреЛрдбреНрд╕ рд╡рд┐рднрд┐рдиреНрди рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдФрд░ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕рд┐рд╕реНрдЯрдордб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рдХрд▓реНрдк рджреЗрддреЗ рд╣реИрдВред  рдЙрдирдХреА рдорджрдж рд╕реЗ, рдпрд╣ рд╕рдордЭрдирд╛ рдЖрд╕рд╛рди рд╣реИ рдХрд┐ рдХреМрди рд╕реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдФрд░ рдХрд┐рди рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рдЖрдкрдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЧрдВрддрд╡реНрдп рдЭрдВрдбреЗ рдХреЗ рд╕рд╛рде рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рддреЗ рд╕рдордп рдЙрдиреНрд╣реЗрдВ рдмрдбрд╝реА рд╕рдорд╕реНрдпрд╛рдПрдВ рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред </p></div></div><br><p>  рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ <code>service-name.service</code> рдХреЛ <code>/lib/systemd/system/</code> рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдХреЙрдкреА рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдБ systemd рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛рдПрдБ рд╕реНрдерд┐рдд рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдЪрд╛рд▓реВ рдХрд░реЗрдВ рдФрд░ рд╕реЗрд╡рд╛ рд╢реБрд░реВ рдХрд░реЗрдВред  рдХреНрдпреВрдм-рдЕрдкреАрдЬрд╝рд░ рдХреЗ рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="bash hljs">$ systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> kube-apiserver.service $ systemctl start kube-apiserver.service</code> </pre> <br><p>  рдмреЗрд╢рдХ, рд╕рднреА рд╕реЗрд╡рд╛рдУрдВ рдХреЛ <em>рд╣рд░рд╛</em> рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП (рдпрд╛рдиреА, рдЪрд▓ рд░рд╣рд╛ рд╣реИ рдФрд░ рдХрд╛рд░реНрдп рдХрд░ рд░рд╣рд╛ рд╣реИ)ред  рдпрджрд┐ рдЖрдк рдХреЛрдИ рдЧрд▓рддреА рдХрд░рддреЗ рд╣реИрдВ, рддреЛ <code>journal -f -t kube-apiserver</code> <code>journalct -xe</code> рдпрд╛ <code>journal -f -t kube-apiserver</code> рдЖрдкрдХреЛ рдпрд╣ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ рдХрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреНрдпрд╛ рдЧрд▓рдд рд╣реИред </p><br><p>  рдПрдХ рдмрд╛рд░ рдореЗрдВ рд╕рднреА рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рдореЗрдВ рдЬрд▓реНрджрдмрд╛рдЬреА рди рдХрд░реЗрдВ, рдПрдХ рд╢реБрд░реБрдЖрдд рдХреЗ рд▓рд┐рдП рдпрд╣ рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдХрдмрд╛рдбрд╝ рдФрд░ рдХреНрдпреВрдм-рдПрдкреЗрд╕реНрд╡рд░ рдХреЛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред  рдпрджрд┐ рд╕рдм рдХреБрдЫ рдареАрдХ рд╣реЛ рдЧрдпрд╛, рдФрд░ рдЖрдкрдиреЗ рддреБрд░рдВрдд рд╡рд┐рдЬрд╝рд╛рд░реНрдб рдореЗрдВ рд╕рднреА рдЪрд╛рд░ рд╕реЗрд╡рд╛рдПрдВ рдЕрд░реНрдЬрд┐рдд рдХреАрдВ, рддреЛ рд╡рд┐рдЬрд╝рд╛рд░реНрдб рдХреЗ рд▓реЙрдиреНрдЪ рдХреЛ рд╕рдлрд▓ рдорд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><h3 id="master-2">  рдЧреБрд░реБ </h3><br><p>  рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд┐рд╕реНрдЯрдордб</a> рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП рдЗрдирд┐рдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рд╣реА рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЧреБрд░реБ рдХреЗ рд▓рд┐рдП: </p><br><p>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">systemd / etcd</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">systemd / kube-apiserver</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд┐рд╕реНрдЯрдордб / рдХреНрдпреВрдм-рдХрдВрдЯреНрд░реЛрд▓рд░-рдореИрдиреЗрдЬрд░</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">systemd / kube-рдЕрдиреБрд╕реВрдЪрдХ</a> </p><br><h3 id="rabochie-uzly-2">  рдХрд╛рдо рдХреА рдЗрдХрд╛рдЗрдпрд╛рдБ </h3><br><p>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд┐рд╕реНрдЯрдордб / рдХрдВрдЯреЗрдирд░</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд┐рд╕реНрдЯрдордб / рдХреНрдпреВрдмрд▓реЗрдЯ</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд┐рд╕реНрдЯрдордб / рдХреНрдпреВрдм-рдкреНрд░реЙрдХреНрд╕реА</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд┐рд╕реНрдЯрдордб / рдХреЛрд░рдбрдиреНрд╕</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд┐рд╕реНрдЯрдордб / рдлрд▓рд╛рд▓реИрди</a> </p><br><h3 id="klient">  рдЧреНрд░рд╛рд╣рдХ </h3><br><p>  рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, <code>${HOME}/.kube/config</code> рдХреЗрд╡рд▓ <code>certs/kubeconfig/admin.kubeconfig</code> (рдЗрд╕реЗ рдЬреЗрдирд░реЗрдЯ рдХрд░рдиреЗ рдпрд╛ рдЗрд╕реЗ рдЦреБрдж рд▓рд┐рдЦрдиреЗ рдХреЗ рдмрд╛рдж) рдХреЙрдкреА рдХрд░реЗрдВ <code>${HOME}/.kube/config</code> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Kubectl</a> рдбрд╛рдЙрдирд▓реЛрдб <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд░реЗрдВ</a> рдФрд░ kube-apiserver рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред  рдореИрдВ рдЖрдкрдХреЛ рдПрдХ рдмрд╛рд░ рдлрд┐рд░ рдпрд╛рдж рджрд┐рд▓рд╛ рджреВрдВ рдХрд┐ рдЗрд╕ рд╕реНрддрд░ рдкрд░, рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпреВрдм-рдПрдкреЗрд╕реЗрд░рд╡рд░ рдХреЗ рд▓рд┐рдП, рдХреЗрд╡рд▓ рдЖрджрд┐ рдХреЛ рдХрд╛рд░реНрдп рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдереЛрдбрд╝реА рджреЗрд░ рдмрд╛рдж рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдкреВрд░реНрдг рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд▓рд┐рдП рд╢реЗрд╖ рдШрдЯрдХреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред </p><br><p>  рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдХрд┐ рдХреНрдпреВрдм-рдЕрдкреАрдЬрд╝рд░ рдФрд░ рдХреБрдмреЗрдЯрд▓ рдХрд╛рд░реНрдп: </p><br><pre> <code class="bash hljs">$ kubectl version Client Version: version.Info{Major:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, Minor:<span class="hljs-string"><span class="hljs-string">"13"</span></span>, GitVersion:<span class="hljs-string"><span class="hljs-string">"v1.13.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"extra info"</span></span>: <span class="hljs-string"><span class="hljs-string">"..."</span></span>} Server Version: version.Info{Major:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, Minor:<span class="hljs-string"><span class="hljs-string">"13"</span></span>, GitVersion:<span class="hljs-string"><span class="hljs-string">"v1.13.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"extra info"</span></span>: <span class="hljs-string"><span class="hljs-string">"..."</span></span>}</code> </pre> <br><h1 id="konfiguraciya-flannel">  рдлрд▓рд╛рд▓реИрди рд╡рд┐рдиреНрдпрд╛рд╕ </h1><br><p>  рдПрдХ рдлрд▓рд╛рд▓реИрди рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗ рд░реВрдк рдореЗрдВ, рдореИрдВ <code>vxlan</code> рдмреИрдХреЗрдВрдб рдкрд░ рдмрд╕ рдЧрдпрд╛ред  <a href="">рдпрд╣рд╛рдВ</a> рдмреИрдХрдПрдВрдб рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдкрдврд╝реЗрдВред </p><br><div class="spoiler">  <b class="spoiler_title">рд╣реЛрд╕реНрдЯ-рдЬреАрдбрдмреНрд▓реНрдпреВ рдФрд░ рдЗрд╕рдиреЗ рдХрд╛рдо рдХреНрдпреЛрдВ рдирд╣реАрдВ рдХрд┐рдпрд╛</b> <div class="spoiler_text"><p>  рдореБрдЭреЗ рддреБрд░рдВрдд рдХрд╣рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ VPS рдкрд░ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░ рдЪрд▓рд╛рдиреЗ рд╕реЗ <code>host-gw</code> рдмреИрдХрдПрдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИред  рдЕрдиреБрднрд╡реА рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЬреАрдирд┐рдпрд░ рдирд╣реАрдВ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рдореИрдВрдиреЗ рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ рджреЛ рджрд┐рди рдбрд┐рдмрдЧрд┐рдВрдЧ рдореЗрдВ рдмрд┐рддрд╛рдП рдХрд┐ рд▓реЛрдХрдкреНрд░рд┐рдп VDS / VPS рдкреНрд░рджрд╛рддрд╛рдУрдВ рдкрд░ рдЗрд╕рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛ рдХреНрдпрд╛ рдереАред </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Linode.com</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">digitalocean</a> рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рд╛рд░ рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░рджрд╛рддрд╛ рдПрдХ рдирд┐рдЬреА рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд▓рд┐рдП рдИрдорд╛рдирджрд╛рд░ L2 рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдмрджрд▓реЗ рдореЗрдВ, рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдиреЛрдбреНрд╕ рдХреЗ рдмреАрдЪ рдиреЗрдЯрд╡рд░реНрдХ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рдЕрд╕рдВрднрд╡ рдмрдирд╛рддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e0c/c7e/add/e0cc7eadd6253cf4921df17ca6fe5d47.png" alt="рдпрд╛рддрд╛рдпрд╛рдд"></p><br><p>  рдиреЗрдЯрд╡рд░реНрдХ рдЯреНрд░реИрдлрд┐рдХ рдХреЗ рд▓рд┐рдП рдиреЛрдбреНрд╕ рдХреЗ рдмреАрдЪ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рд╛рдорд╛рдиреНрдп рд░реВрдЯрд┐рдВрдЧ рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред  рдпрд╣ рдордд рднреВрд▓реЛ рдХрд┐ net.ipv4.ip_forward рдХреЛ 1 рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдлрд╝рд┐рд▓реНрдЯрд░ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ FORWARD рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рдиреЛрдбреНрд╕ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реЗрдз рдирд┐рдпрдо рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><pre> <code class="bash hljs">node1$ ip route add 10.200.12.0/24 via 192.168.1.2 node2$ ip route add 10.200.8.0/24 via 192.168.1.1</code> </pre> <br><pre> <code class="plaintext hljs">[10.200.80.23 container-1]-&gt;[192.168.1.1 node-1]-&gt;[192.168.1.2 node-2]-&gt;[10.200.12.5 container-2]</code> </pre> <br><p>  рдпрд╣ рдареАрдХ рд╡рд╣реА рд╣реИ рдЬреЛ рд╕рдВрдХреЗрддрд┐рдд рдкрд░ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ (рдФрд░, рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ, рдЖрдорддреМрд░ рдкрд░ рд╕рднреА рдкрд░) рд╡реАрдкреАрдПрд╕ / рд╡реАрдбреАрдПрд╕ред </p><br><p>  рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдиреЛрдбреНрд╕ рдХреЗ рдмреАрдЪ рдЙрдЪреНрдЪ рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдорд╛рдзрд╛рди рдХрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЖрдкрдХреЗ <strong>рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ</strong> , рддреЛ рдЖрдкрдХреЛ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП $ 20 рд╕реЗ рдЕрдзрд┐рдХ рдЦрд░реНрдЪ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </p></div></div><br><p>  рдЖрдк рд╡рд╛рдВрдЫрд┐рдд рдлрд▓рд╛рд▓реИрди рд╡рд┐рдиреНрдпрд╛рд╕ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрджрд┐ / рдлрд▓рд╛рд▓реИрди</a> рд╕реЗ <code>set-flannel-config.sh</code> рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  <strong>рдпрд╣ рдпрд╛рдж рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ</strong> : рдпрджрд┐ рдЖрдк рдмреИрдХрдПрдВрдб рдХреЛ рдмрджрд▓рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдХреЙрдиреНрдЯрд░реНрдб рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╣рдЯрд╛рдиреЗ рдФрд░ рд╕рднреА рдиреЛрдбреНрд╕ рдкрд░ рд╕рднреА рдлрд╝реНрд▓реЗрдирд▓рд╛рдЗрди рдбреЗрдореЙрди рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдмреБрджреНрдзрд┐рдорд╛рдиреА рд╕реЗ рдЪреБрдиреЗрдВред  рдбрд┐рдлрд╝реЙрд▓реНрдЯ vxlan рд╣реИред </p><br><pre> <code class="bash hljs">master$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ETCDCTL_CA_FILE=<span class="hljs-string"><span class="hljs-string">'/var/lib/kubernetes/ca.pem'</span></span> master$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ETCDCTL_CERT_FILE=<span class="hljs-string"><span class="hljs-string">'/var/lib/kubernetes/kubernetes.pem'</span></span> master$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ETCDCTL_KEY_FILE=<span class="hljs-string"><span class="hljs-string">'/var/lib/kubernetes/kubernetes-key.pem'</span></span> master$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ETCDCTL_ENDPOINTS=<span class="hljs-string"><span class="hljs-string">'https://127.0.0.1:2379'</span></span> master$ etcdctl ls /coreos.com/network/subnets/ /coreos.com/network/subnets/10.200.8.0-24 /coreos.com/network/subnets/10.200.12.0-24 master$ etcdctl get /coreos.com/network/subnets/10.200.8.0-24 {<span class="hljs-string"><span class="hljs-string">"PublicIP"</span></span>:<span class="hljs-string"><span class="hljs-string">"178.79.168.130"</span></span>,<span class="hljs-string"><span class="hljs-string">"BackendType"</span></span>:<span class="hljs-string"><span class="hljs-string">"vxlan"</span></span>,<span class="hljs-string"><span class="hljs-string">"BackendData"</span></span>:{<span class="hljs-string"><span class="hljs-string">"VtepMAC"</span></span>:<span class="hljs-string"><span class="hljs-string">"22:ca:ac:15:71:59"</span></span>}}</code> </pre> <br><p>  рдЬрдм рдЖрдк etcd рдореЗрдВ рд╡рд╛рдВрдЫрд┐рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкрдВрдЬреАрдХреГрдд рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдкреНрд░рддреНрдпреЗрдХ рдХрд╛рд░реНрдп рдиреЛрдб рдкрд░ рдЗрд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </p><br><h2 id="flannelservice">  flannel.service </h2><br><p>  рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрджрд╛рд╣рд░рдг рдпрд╣рд╛рдВ рд▓рд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">systemd / flannel</a> </p><br><div class="spoiler">  <b class="spoiler_title">flannel.service</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[Unit] Description=Flanneld overlay address etcd agent After=network.target [Service] Type=notify #: current host ip. don't change if ip have not changed Environment=PUBLIC_IP=178.79.168.130 Environment=FLANNEL_ETCD=https://192.168.153.60:2379 ExecStart=/usr/bin/flanneld \ -etcd-endpoints=${FLANNEL_ETCD} -etcd-prefix=${FLANNEL_ETCD_KEY} \ -etcd-cafile=/var/lib/kubernetes/ca.pem \ -etcd-certfile=/var/lib/kubernetes/kubernetes.pem \ -etcd-keyfile=/var/lib/kubernetes/kubernetes-key.pem \ -etcd-prefix=/coreos.com/network \ -healthz-ip=127.0.0.1 \ -subnet-file=/run/flannel/subnet.env \ -public-ip=${PUBLIC_IP} \ -kubeconfig-file=/var/lib/kubernetes/config/kubeconfig/flanneld.kubeconfig \ $FLANNEL_OPTIONS ExecStartPost=/usr/libexec/flannel/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/docker Restart=on-failure RestartSec=5 [Install] RequiredBy=docker.service</code> </pre> </div></div><br><h2 id="nastroyka">  рд╕рдорд╛рдпреЛрдЬрди </h2><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╣рдореЗрдВ cad.pem, kubernetes.pem рдФрд░ kubernetes-key.pem рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдореЗрдВ рдкреНрд░рд╛рдзрд┐рдХреГрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЕрдиреНрдп рд╕рднреА рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛрдИ рднреА рдкрд╡рд┐рддреНрд░ рдЕрд░реНрде рдирд╣реАрдВ рд░рдЦрддреЗ рд╣реИрдВред  рдХреЗрд╡рд▓ рдПрдХ рдЪреАрдЬ рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рд╡рд╣ рд╡реИрд╢реНрд╡рд┐рдХ рдЖрдИрдкреА рдкрддреЗ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдкреИрдХреЗрдЯ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдмреАрдЪ рдЬрд╛рдПрдВрдЧреЗ: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/037/e54/803/037e5480319cedd1e662c925bce23b3e.png" alt="рдлрд▓рд╛рд▓реИрди рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ"><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд▓рд╛рд▓реИрди рдХреЗ рд╕рд╛рде рдорд▓реНрдЯреА-рд╣реЛрд╕реНрдЯ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рдУрд╡рд░рд▓реЗ</a> ) </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#:   node-1$ systemctl enable flanneld.service #:  node-1$ systemctl start flanneld</span></span></code> </pre> <br><p>  рдлрд▓рд╛рд▓реИрди рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╢реБрд░реВ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рдЕрдкрдиреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдлрд▓рд╛рд▓реИрди.рдПрди рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдЦреЛрдЬрдирд╛ рдЪрд╛рд╣рд┐рдП: </p><br><pre> <code class="plaintext hljs">node-1$ ifconfig flannel.100: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1450 inet 10.200.8.0 netmask 255.255.255.255 broadcast 0.0.0.0 inet6 fe80::20ca:acff:fe15:7159 prefixlen 64 scopeid 0x20&lt;link&gt; ether 22:ca:ac:15:71:59 txqueuelen 0 (Ethernet) RX packets 18853 bytes 1077085 (1.0 MiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 11856 bytes 264331154 (252.0 MiB) TX errors 0 dropped 47 overruns 0 carrier 0 collisions 0</code> </pre> <br><p>  рдЬрд╛рдБрдЪрдирд╛ рдХрд┐ рдЖрдкрдХреЗ рдЗрдВрдЯрд░рдлреЗрд╕ рд╕рднреА рдиреЛрдбреНрд╕ рдкрд░ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИред  рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдиреЛрдб -1 рдФрд░ рдиреЛрдб -2 рдореЗрдВ рдХреНрд░рдорд╢рдГ 10.200.8.0/24 рдФрд░ 10.200.12.0/24 рдиреЗрдЯрд╡рд░реНрдХ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдПрдХ рдирд┐рдпрдорд┐рдд icmp рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде рд╣рдо рдЙрдирдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">#:  node-2  node-1 node-1 $ ping -c 1 10.200.12.0 PING 10.200.12.0 (10.200.12.0) 56(84) bytes of data. 64 bytes from 10.200.12.0: icmp_seq=1 ttl=64 time=4.58 ms #:  node-1  node-2 node-2 $ ping -c 1 10.200.8.0 PING 10.200.8.0 (10.200.8.0) 56(84) bytes of data. 64 bytes from 10.200.8.0: icmp_seq=1 ttl=64 time=1.44 ms</code> </pre> <br><p>  рдХрд┐рд╕реА рднреА рд╕рдорд╕реНрдпрд╛ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдореЗрдЬрдмрд╛рдиреЛрдВ рдХреЗ рдмреАрдЪ рдпреВрдбреАрдкреА рдкрд░ iptables рдореЗрдВ рдХреЛрдИ рдХрд╛рдЯрдиреЗ рдХреЗ рдирд┐рдпрдо рд╣реИрдВред </p><br><h1 id="konfiguraciya-containerd">  рдХрдВрдЯреЗрдирд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди </h1><br><p>  рдЬрдЧрд╣ <a href="">рдЖрджрд┐ / рдХрдВрдЯреЗрдирд░ / config.toml</a> in <code>/etc/containerd/config.toml</code> рдпрд╛ рдЬрд╣рд╛рдБ рднреА рдЖрдкрдХреЗ рд▓рд┐рдП рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛ, рдореБрдЦреНрдп рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рд╕реЗрд╡рд╛ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдкрде рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╛рдж рд░рдЦреЗрдВ <a href="">(рдХрдВрдЯреЗрдирд░рдб</a> . рд╕реЗрд╡рд╛, рдиреАрдЪреЗ рд╡рд░реНрдгрд┐рдд)ред </p><br><p>  рдорд╛рдирдХ рдХреЗ рдХреБрдЫ рд╕рдВрд╢реЛрдзрдиреЛрдВ рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рдиред  <strong>рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг</strong> <code>enable_tls_streaming = true</code> рдХрд┐ рдЖрдк <code>enable_tls_streaming = true</code> <strong>рдХреЛ рд╕реЗрдЯ рди рдХрд░реЗрдВ</strong> рдпрджрд┐ рдЖрдк рдпрд╣ рдирд╣реАрдВ рд╕рдордЭрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк рдРрд╕рд╛ рдХреНрдпреЛрдВ рдХрд░ рд░рд╣реЗ рд╣реИрдВред    <code>kubectl exec</code>        ,      . </p><br><h2 id="containerdservice"> containerd.service </h2><br><div class="spoiler"> <b class="spoiler_title">containerd.service</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[Unit] Description=containerd container runtime Documentation=https://containerd.io After=network.target [Service] ; uncomment this if your overlay module are built as module ; ExecStartPre=/sbin/modprobe overlay ExecStart=/usr/bin/containerd \ -c /etc/containerd/config.toml Restart=always RestartSec=5 Delegate=yes KillMode=process OOMScoreAdjust=-999 LimitNOFILE=1048576 LimitNPROC=infinity LimitCORE=infinity [Install] WantedBy=multi-user.target</code> </pre> </div></div><br><h2 id="nastroyka-1">  рд╕рдорд╛рдпреЛрдЬрди </h2><br><p>  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">cri-tools</a> . <br>  <a href="">etc/crictl.yaml</a>  <code>/etc/crictl.yaml</code> .      : </p><br><pre> <code class="bash hljs">node-1$ CONTAINERD_NAMESPACE=k8s.io crictl ps CONTAINER ID IMAGE CREATED STATE NAME ATTEMPT POD ID</code> </pre> <br><p>  ,    -    kubernetes , crictl       , ,    . </p><br><h1 id="konfiguraciya-cni-plugins">  CNI Plugins </h1><br><p>  CNI    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>   ,    ,   . </p><br><h1 id="nastroyka-2">  рд╕рдорд╛рдпреЛрдЬрди </h1><br><p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">cni plugins</a>        <code>/opt/cni/bin/</code> </p><br><p>  <a href="">/etc/cni/net.d</a>      : </p><br><div class="spoiler"> <b class="spoiler_title">/etc/cni/net.d/10-flannel.conflist</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">{ "cniVersion": "0.3.0", "name": "cbr0", "plugins": [ { "type": "flannel", "name": "kubenet", "delegate": { "hairpinMode": true, "isDefaultGateway": true } }, { "type": "portmap", "capabilities": { "portMappings": true }, "externalSetMarkChain": "KUBE-MARK-MASQ" } ] }</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title">/etc/cni/net.d/99-loopback.conf</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">{ "cniVersion": "0.3.0", "type": "loopback" }</code> </pre> </div></div><br><p>       ,    .  ,       ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Red Hat  Docker  Podman</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Intro to Podman</a> </p><br><h1 id="konfiguraciya-kubelet">  Kubelet </h1><br><p>     kubelet  (     cni) тАФ    .   kubelet    hostname.         ,      ""   <code>kubectl logs</code> , <code>kubectl exec</code> , <code>kubectl port-forward</code> . </p><br><div class="spoiler"> <b class="spoiler_title"> kubelet-config.yaml</b> <div class="spoiler_text"><p>  ,   <a href="">etc/kubelet-config.yaml</a>   ,        ,     .     : </p><br><pre> <code class="plaintext hljs">systemReserved: cpu: 200m memory: 600Mi</code> </pre> <br><p>  ,        GO  kubernetes,  ,       .        .           0.2 vCPU  600 MB     . </p><br><p>   ,  , kubelet, kube-proxy, coredns, flannel    . ,               тАФ     2 vCPU / 4G ram,           ,     kubernetes + postgresql . </p><br><p>    - (micro nodes)        . </p></div></div><br><h2 id="kubeletservice"> kubelet.service </h2><br><p>  service    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">systemd/kubelet</a> </p><br><div class="spoiler"> <b class="spoiler_title">kubelet.service</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[Unit] Description=Kubernetes Kubelet Documentation=https://github.com/kubernetes/kubernetes Requires=containerd.service [Service] #Environment=NODE_IP=192.168.164.230 Environment=NODE_IP=178.79.168.130 #: node name given by env Environment=NODE_NAME=w40k.net ExecStart=kubelet \ --allow-privileged \ --root-dir=/var/lib/kubernetes/kubelet \ --config=/var/lib/kubernetes/kubelet/kubelet-config.yaml \ --kubeconfig=/var/lib/kubernetes/kubelet/node-1.kubeconfig \ --cni-bin-dir=/opt/cni/bin \ --cni-conf-dir=/etc/cni/net.d/ \ --network-plugin=cni \ --container-runtime=remote \ --container-runtime-endpoint=unix:///var/run/containerd/containerd.sock \ --image-pull-progress-deadline=10m \ --node-ip=${NODE_IP} \ --hostname-override=${NODE_NAME} \ --v=1 Restart=on-failure RestartSec=5 [Install] WantedBy=multi-user.target</code> </pre> </div></div><br><h2 id="nastroyka-3">  рд╕рдорд╛рдпреЛрдЬрди </h2><br><p>      ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">RBAC</a> ,                kubelet. </p><br><p>  <a href="">etc/kubelet-default-rbac.yaml</a>  ,  kubelet        : </p><br><pre> <code class="bash hljs">user$ kubectl apply -f etc/kubelet-default-rbac.yaml</code> </pre> <br><p>  ,    ,        . </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#:   node-1$ systemctl enable kubelet.service #:  node-1$ systemctl start kubelet</span></span></code> </pre> <br><p>    ,           api : </p><br><pre> <code class="plaintext hljs">$ kubectl get nodes -o wide NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME w40k.net Ready &lt;none&gt; 5m v1.13.1 178.79.168.130 &lt;none&gt; Gentoo/Linux 4.18.16-x86_64-linode118 containerd://1.2.1</code> </pre> <br><h1 id="konfiguraciya-kube-proxy">  Kube Proxy </h1><br><p> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">systemd/kubelet</a> .   ,   , <code>kube-proxy-config.yaml</code>     : <a href="">etc/kube-proxy</a> </p><br><h2 id="kube-proxyservice"> kube-proxy.service </h2><br><div class="spoiler"> <b class="spoiler_title">kube-proxy.service</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[Unit] Description=Kubernetes Proxy Documentation=https://github.com/kubernetes/kubernetes After=network.target [Service] ExecStart=kube-proxy \ --config=/var/lib/kubernetes/kube-proxy/kube-proxy-config.yaml Restart=on-failure RestartSec=5 [Install] WantedBy=multi-user.target</code> </pre> </div></div><br><h2 id="nastroyka-4">  рд╕рдорд╛рдпреЛрдЬрди </h2><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#:   node-1$ systemctl enable kube-proxy.service #:  node-1$ systemctl start kube-proxy</span></span></code> </pre> <br><p>   kube-proxy   ""   iptables,         ,   -   kubernetes  (- ).   . </p><br><h1 id="konfiguraciya-coredns">  CoreDNS </h1><br><p> Corefile   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">etc/coredns/Corefile</a> ,    : </p><br><div class="spoiler"> <b class="spoiler_title">/etc/coredns/Corefile</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">.:53 { errors log stdout health :8081 kubernetes cluster.local 10.200.0.0/16 { endpoint https://178.79.148.185:6443 tls /var/lib/kubernetes/kubernetes.pem /var/lib/kubernetes/kubernetes-key.pem /var/lib/kubernetes/ca.pem pods verified upstream /etc/resolv.conf kubeconfig /var/lib/kubernetes/config/kubeconfig/coredns.kubeconfig default } proxy . /etc/resolv.conf cache 30 }</code> </pre> </div></div><br><p>     coredns.kubeconfig  pem- (    )   worker . , coredns      systemd-resolved. ,         Ubuntu ,  ,  ,  ,  .        . </p><br><h2 id="corednsservice"> coredns.service </h2><br><div class="spoiler"> <b class="spoiler_title">coredns.service</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[Unit] Description=CoreDNS Documentation=https://coredns.io/ After=network.target [Service] ExecStart=/usr/bin/coredns -conf /etc/coredns/Corefile Restart=on-failure RestartSec=5 [Install] WantedBy=multi-user.target</code> </pre> </div></div><br><h2 id="nastroyka-5">  рд╕рдорд╛рдпреЛрдЬрди </h2><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#:   node-1$ systemctl enable coredns.service #:  node-1$ systemctl start coredns</span></span></code> </pre> <br><p> ,   ,   : </p><br><pre> <code class="plaintext hljs">node-1$ dig kubernetes.default.svc.cluster.local @127.0.0.1 #:    ;kubernetes.default.svc.cluster.local. IN A ;; ANSWER SECTION: kubernetes.default.svc.cluster.local. 5 IN A 10.32.0.1</code> </pre> <br><p>   , coredns   ip   kubernetes . <br> <strong></strong> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">kubernetes.default </a>   <strong></strong> kube-controller-manager,      : </p><br><pre> <code class="plaintext hljs">$ kubectl get svc -n default NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.32.0.1 &lt;none&gt; 443/TCP 26h</code> </pre> <br><h1 id="nginx-ingress--cert-manager"> nginx-ingress &amp; cert-manager </h1><br><p>   ,    .        nginx-ingress  cert-manager. </p><br><p> тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">nginx kubernetes ingress</a> (master),  : </p><br><pre> <code class="bash hljs"> user$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/nginxinc/kubernetes-ingress.git user$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> kubernetes-ingress/deployments user$ kubectl apply -f common/ns-and-sa.yaml user$ kubectl apply -f common/nginx-config.yaml user$ kubectl apply -f common/default-server-secret.yaml user$ kubectl apply -f daemon-set/nginx-ingress.yaml user$ kubectl apply -f rbac/rbac.yaml</code> </pre> <br><p> тАФ <a href="">cert manager</a> (v0.5.2) </p><br><pre> <code class="bash hljs"> user$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/jetstack/cert-manager.git user$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> cert-manager &amp;&amp; git co v0.5.2 user$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> contrib/manifests/cert-manager user$ kubectl apply -f with-rbac.yaml</code> </pre> <br><p>  ,    ,  ,    : </p><br><pre> <code class="plaintext hljs">NAMESPACE NAME READY STATUS RESTARTS AGE cert-manager cert-manager-554c76fbb7-t9762 1/1 Running 0 3h38m nginx-ingress nginx-ingress-sdztf 1/1 Running 0 10h nginx-ingress nginx-ingress-vrf85 1/1 Running 0 10h</code> </pre> <br><p>  cert-manager  nginx-ingress    running state,   ,    .          ,         <code>Running</code> .            . </p><br><h1 id="zapuskaem-prilozhenie">   </h1><br><p>   ,     .      ,   kubernetes resource : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">app/k8s</a> </p><br><pre> <code class="bash hljs">user$ kube apply -f ns-and-sa.yaml user$ kube apply -f configmap.yaml <span class="hljs-comment"><span class="hljs-comment">#:  secret-example.yaml       #: secret.yaml user$ kube apply -f secret.yaml user$ kube apply -f tls-production.yaml user$ kube apply -f deployment.yaml user$ kube apply -f service.yaml user$ kube apply -f ingress-production.yaml</span></span></code> </pre> <br><p>   ,     - .  ,    (      kubernetes-example.w40k.net),     ,    ,  cert-manager    nginx-ingress              .   ,    ingress  tls/ssl. </p><br><p>      : </p><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=http://no-">http://no-https.kubernetes-example.w40k.net/</a> тАФ  ssl;  ,  -   ,     . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://kubernetes-example.w40k.net/</a> тАФ   (,   ,   ),  ,     ,       kubernetes     . </li></ul><br><p>       ,      -   .    -       ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> ,        . </p><br><h1 id="ssylki">  рд╕рдВрджрд░реНрдн </h1><br><p> ,     ,   : </p><br><p> тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Kubernetes the hard way</a> <br> тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Multi-Host Networking Overlay with Flannel</a> <br> тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Intro to Podman</a> <br> тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Stateless Applications</a> <br> тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">What is ingress</a> </p><br><p>   : </p><br><p> тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Kubernetes Networking: Behind the scenes</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> ) <br> тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">A Guide to the Kubernetes Networking Model</a> <br> тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Understanding kubernetes networking: services</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> ) </p><br><h1 id="qa"> Q&amp;A </h1><br><p> &lt;tbd&gt;,           . </p><br><h1 id="otladochnaya-informaciya">   </h1><br><p>     , ,     .    ,       ,  -  ,    ,  . </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><h2 id="api-server"> Api Server </h2><br><p>   <code>kube-apiserver.service</code>    ,       api-server'   curl    http .            - . <br>     admin.kubeconfig  ${HOME}/.kube/config,   kubectl      api-server (kube-apiserver). </p><br><p>    (   )  HTTP 200 OK + ,  api-server  : </p><br><pre> <code class="plaintext hljs">curl -H "Authorization: Bearer e5qXNAtwwCHUUwyLilZmAoFPozrQwUpw" -k -L https://&lt;api-server-address&gt;:6443/api/v1/</code> </pre> <br><h2 id="kube-controller-manager"> Kube Controller Manager </h2><br><p>  ,  controller manager   api    ,      .        ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">service account'</a> : </p><br><pre> <code class="plaintext hljs">$ kubectl get sa NAME SECRETS AGE default 1 19h</code> </pre> <br><p>    ,   ,  kube-controller-manager  . </p><br><h2 id="kube-scheduler"> Kube Scheduler </h2><br><p>       .  ,    ,    <a href="">debug/job.yaml</a>        <code>kubectl describe &lt;type/resource&gt;</code> . <br>    <strong> </strong>  ,  kube controller manager . </p><br><pre> <code class="plaintext hljs">#:   job user$ kubectl apply -f debug/job.yaml job.batch/app created #:  ,   job user$ kubectl get pods -l job-name=app NAME READY STATUS RESTARTS AGE app-9kr9z 0/1 Completed 0 54s #: ,        #:   user$ kubectl describe pods app-9kr9z # ...   ... Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 12s default-scheduler Successfully assigned example/app-9kr9z to w40k.net</code> </pre> <br><p>   , default-scheduler   pod   w40k.net.    -  ,            тАФ    . </p><br><p>              . , ,   , тАФ      "".       systemd        . </p><br><p>   kube scheduler  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> </p><br><h2 id="kubelet"> Kubelet </h2><br><p> Kubelet    kubernetes     .  kubelet       .     kubernetes event ( <code>kubectl get events -o wide</code> )         . </p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> (  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> ) </p><br><h2 id="kube-proxy-i-servisy"> Kube Proxy   </h2><br><p>     kube-proxy    : </p><br><ul><li>      (     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> Flannel</a> ,      ); </li><li>  iptables,   filter  nat . </li></ul><br><p> <strong></strong> , 10.32.0.0/24   "".  ,        .     iptables,     ,   ,     -    +.  <strong> </strong>  icmp    ,      ping'  .        ,     . </p><br><p>  ,     kube-proxy,               : </p><br><pre> <code class="plaintext hljs">#:    user$ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE backend ClusterIP 10.32.0.195 &lt;none&gt; 80/TCP 5m #:     user$ kubectl get pods -o wide #:     ' NAME READY STATUS RESTARTS AGE IP NODE backend-896584448-4r94s 1/1 Running 0 11h 10.200.8.105 w40k.net backend-896584448-np992 1/1 Running 0 11h 10.200.12.68 docker.grart.net #:  10   /status/ endpoint ,       #:       node-1$ for i in `seq 10`; do curl -L http://10.32.0.195/status/; done okokokokokokokokokok node-1$ conntrack -L -d 10.32.0.195 tcp 6 62 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62158 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62158 [ASSURED] mark=0 use=1 tcp 6 60 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62144 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62144 [ASSURED] mark=0 use=1 tcp 6 58 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62122 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62122 [ASSURED] mark=0 use=1 tcp 6 59 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62142 dport=80 src=10.200.8.105 dst=10.200.8.1 sport=8000 dport=62142 [ASSURED] mark=0 use=1 tcp 6 58 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62130 dport=80 src=10.200.8.105 dst=10.200.8.1 sport=8000 dport=62130 [ASSURED] mark=0 use=1 tcp 6 61 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62150 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62150 [ASSURED] mark=0 use=1 tcp 6 56 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62116 dport=80 src=10.200.8.105 dst=10.200.8.1 sport=8000 dport=62116 [ASSURED] mark=0 use=1 tcp 6 57 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62118 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62118 [ASSURED] mark=0 use=1 tcp 6 59 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62132 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62132 [ASSURED] mark=0 use=1 tcp 6 56 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62114 dport=80 src=10.200.8.105 dst=10.200.8.1 sport=8000 dport=62114 [ASSURED] mark=0 use=1</code> </pre> <br><p>      src/dst (9  10 ).   ,  src      : </p><br><ul><li> 10.200.8.105 </li><li> 10.200.12.68 </li></ul><br><p>  ,    .      ,  -  ( ,    )  .         . </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#: node-1   10.200.8.105, node-2 10.200.12.68, #:      8000  #:  node-1 node-1$ curl -L http://10.200.8.105:8000/status/ ok node-1$ curl -L http://10.200.12.68:8000/status/ ok #:  node-2 node-2$ curl -L http://10.200.8.105:8000/status/ ok node-2$ curl -L http://10.200.12.68:8000/status/ ok</span></span></code> </pre> <br><p>    ,    ,    conntrack        ,  ,      kube-proxy.   ,       nat : </p><br><p> <code>node-1$ iptables -t nat -vnL</code> </p> <br><p>          . </p><br><p>                  .  ,    ,      .   ,       .  -       , ,   . </p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> </p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi435228/">https://habr.com/ru/post/hi435228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi435214/index.html">рд▓рд┐рдирдХреНрд╕ 4.20 рдЬрд╛рд░реА - рдирдП рдХрд░реНрдиреЗрд▓ рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдХреНрдпрд╛ рдмрджрд▓ рдЧрдпрд╛ рд╣реИ</a></li>
<li><a href="../hi435216/index.html">рдХреЛрдб рдХреА рджреЛ рд▓рд╛рдЗрдиреЛрдВ рд╕реЗ 200 рдХреИрд╕реЗ рдмрдирд╛рдПрдВ, рдФрд░ рдЖрдкрдХреЛ рдРрд╕рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреНрдпреЛрдВ рд╣реИ</a></li>
<li><a href="../hi435220/index.html">рдХреЛрдЯрд▓рд┐рди рдиреЗрдЯрд┐рд╡: рдлрд╛рдЗрд▓реЛрдВ рдХрд╛ рдЯреНрд░реИрдХ рд░рдЦреЗрдВ</a></li>
<li><a href="../hi435224/index.html">рдЕрдВрдЧреНрд░реЗрдЬреА рднрд╛рд╖рд╛ рдХреЗ рдХрд╛рд░реНрдпрд╛рд▓рдп рдореЗрдВ рд╕рдВрд╡рд╛рдж рдХреИрд╕реЗ рдХрд░реЗрдВ: 14 рдЙрдкрдпреЛрдЧреА рдореБрд╣рд╛рд╡рд░реЗ</a></li>
<li><a href="../hi435226/index.html">рдЦрд░реЛрдВрдЪ рд╕реЗ рдбреЗрдЯрд╛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ</a></li>
<li><a href="../hi435234/index.html">рд╣реЛрд╢рд┐рдпрд╛рд░, рдЖрдЧреЗ, рдФрд░ рдЕрдзрд┐рдХ рд╕рдЯреАрдХ: рдПрдЖрдИ рдХреИрд╕реЗ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рдЙрдбрд╝рд╛рдиреЛрдВ рдХреЛ рдмрджрд▓рддрд╛ рд╣реИ</a></li>
<li><a href="../hi435236/index.html">рдХрд┐рд▓реЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдЯ рдорд╢реАрди (рдФрд░ рди рдХреЗрд╡рд▓) рдореВрд▓ рдЕрдореЗрд░рд┐рдХреА рдореЗрдВ (рднрд╛рдЧ 3)</a></li>
<li><a href="../hi435240/index.html">рдЕрд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЗрдВрдЬрди 4 - рдкреЛрд╕реНрдЯрдкреНрд░реЛрд╕реЗрд╕ рд╕реНрдХреИрди рдкреНрд░рднрд╛рд╡</a></li>
<li><a href="../hi435242/index.html">рдореИрдВ "рдкрдВрдкреЗрдб рдореИрди" рдмрдирдиреЗ рд╕реЗ рдХреНрдпреЛрдВ рдбрд░рддрд╛ рд╣реВрдБ</a></li>
<li><a href="../hi435244/index.html">2018 рдореЗрдВ ITER рдкреНрд░реЛрдЬреЗрдХреНрдЯ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>