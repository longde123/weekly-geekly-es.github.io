<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§µüèø üë®üèΩ‚Äç‚öïÔ∏è üë®üèø‚Äçü§ù‚Äçüë®üèΩ Wie SystemUI in Android funktioniert üèß üï∫üèø üé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel werde ich die Architektur und das Funktionsprinzip der Hauptanwendung von Android - SystemUI - analysieren. Ich habe mich f√ºr dieses...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie SystemUI in Android funktioniert</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433620/"><img src="https://habrastorage.org/webt/ku/m2/2u/kum22urbaazxg7rq-uvmucnkbm8.png"><br><br>  In diesem Artikel werde ich die Architektur und das Funktionsprinzip der Hauptanwendung von Android - SystemUI - analysieren.  Ich habe mich f√ºr dieses Thema interessiert, weil ich mich frage, wie das System funktioniert, das von einer so gro√üen Anzahl von Benutzern verwendet wird und f√ºr das t√§glich Tausende von Anwendungen auf Google Play oder einfach im Internet heruntergeladen werden.  Au√üerdem interessiert mich das Problem der Informationssicherheit von Android und die daf√ºr erstellten Anwendungen. <br><br>  Unter Android ist SystemUI eine Anwendung, deren Quellcodepfad sich in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">platform_frameworks_base / packages / SystemUI / befindet</a> , auf dem Ger√§t in system / priv-app / -SystemUI. <br><br><a name="habracut"></a>  Die priv-App ist das Verzeichnis, in dem privilegierte Anwendungen gespeichert sind.  Auf dem System- / App-Pfad befinden sich √ºbrigens vorinstallierte Anwendungen, und normale Anwendungen, die wir selbst auf unserem Ger√§t installieren, werden in Daten / Apps gespeichert. <br><br>  Dies wirft sofort die Frage auf: Warum k√∂nnen nicht alle vorinstallierten und privilegierten Anwendungen in ein Verzeichnis verschoben werden, warum ist diese Trennung erforderlich? <br><br>  Tatsache ist, dass einige Anwendungen systematischer sind als andere :) Und diese Trennung ist erforderlich, um die Exploit-Abdeckung von Systemanwendungen zu verringern und Zugriff auf gesch√ºtzte Vorg√§nge zu erhalten.  Sie k√∂nnen eine Anwendung erstellen, die √ºber eine spezielle ApplicationInfo.FLAG_SYSTEM verf√ºgt und mehr Rechte im System erh√§lt. Eine apk-Datei mit dieser Berechtigung wird jedoch im Systemabschnitt abgelegt. <br><br>  SystemUI ist also eine APK-Datei, die im Wesentlichen eine normale Anwendung ist.  Wenn Sie sich jedoch das komplexe SystemUI-Ger√§t ansehen, scheint es nicht mehr nur eine einfache Anwendung zu sein, oder? <br><br><h4>  Diese Anwendung f√ºhrt sehr wichtige Funktionen aus: </h4><br><ul><li>  Navigation </li><li>  Aktuelle Anwendungen </li><li>  Schnelleinstellungen </li><li>  Benachrichtigungsleiste </li><li>  Bildschirm sperren </li><li>  Lautst√§rkeregler </li><li>  Startbildschirm </li><li>  ... </li></ul><br><h3>  Starten Sie SystemUI </h3><br>  Wie ich oben sagte, ist SystemUI nicht wie eine regul√§re Anwendung, so dass der Start nicht mit dem Start von Aktivit√§ten einhergeht, wie dies bei den meisten Anwendungen der Fall ist.  SystemUI ist eine <a href="">globale Benutzeroberfl√§che</a> , die w√§hrend des Systemstartvorgangs gestartet wird und nicht abgeschlossen werden kann. <br><br><pre><code class="java hljs">&lt;application android:name=<span class="hljs-string"><span class="hljs-string">".SystemUIApplication"</span></span> android:persistent=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:allowClearUserData=<span class="hljs-string"><span class="hljs-string">"false"</span></span> android:allowBackup=<span class="hljs-string"><span class="hljs-string">"false"</span></span> android:hardwareAccelerated=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:label=<span class="hljs-string"><span class="hljs-string">"@string/app_label"</span></span> android:icon=<span class="hljs-string"><span class="hljs-string">"@drawable/icon"</span></span> android:process=<span class="hljs-string"><span class="hljs-string">"com.android.systemui"</span></span> android:supportsRtl=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:theme=<span class="hljs-string"><span class="hljs-string">"@style/Theme.SystemUI"</span></span> android:defaultToDeviceProtectedStorage=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:directBootAware=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:appComponentFactory=<span class="hljs-string"><span class="hljs-string">"androidx.core.app.CoreComponentFactory"</span></span>&gt;</code> </pre> <br>  Wenn wir uns mit SystemServer befassen, einer der beiden S√§ulen in der Android-Welt (die zweite ist Zygote, aber ich werde ein anderes Mal dar√ºber sprechen), k√∂nnen wir den Ort finden, an dem <a href="">SystemUI startet,</a> wenn das System <a href="">startet</a> . <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startSystemUi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, WindowManagerService windowManager)</span></span></span><span class="hljs-function"> </span></span>{ Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(); intent.setComponent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ComponentName(<span class="hljs-string"><span class="hljs-string">"com.android.systemui"</span></span>, <span class="hljs-string"><span class="hljs-string">"com.android.systemui.SystemUIService"</span></span>)); intent.addFlags(Intent.FLAG_DEBUG_TRIAGED_MISSING); <span class="hljs-comment"><span class="hljs-comment">//Slog.d(TAG, "Starting service: " + intent); context.startServiceAsUser(intent, UserHandle.SYSTEM); windowManager.onSystemUiStarted(); }</span></span></code> </pre> <br>  Hier sehen wir, wie der SystemUI-Dienst die nicht √∂ffentliche API startServiceAsUser verwendet.  Wenn Sie dies nutzen m√∂chten, m√ºssen Sie auf Reflexion zur√ºckgreifen.  Wenn Sie sich jedoch f√ºr die Verwendung der Reflection-API in Android entscheiden, √ºberlegen Sie ein paar Mal, ob es sich lohnt.  <s>Denk hundertmal nach :)</s> <br><br>  Hier erstellen wir also einen separaten Prozess f√ºr die Anwendung. Tats√§chlich ist jeder Abschnitt der <a href="">SystemUI</a> ein separater Dienst oder ein unabh√§ngiges Modul. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SystemUI</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SysUiServiceProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Context mContext; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Map&lt;Class&lt;?&gt;, Object&gt; mComponents; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConfigurationChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Configuration newConfig)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FileDescriptor fd, PrintWriter pw, String[] args)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBootCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings</span></span>(<span class="hljs-string"><span class="hljs-string">"unchecked"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; interfaceType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) (mComponents != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? mComponents.get(interfaceType) : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T, C extends T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; interfaceType, C component)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mComponents != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { mComponents.put(interfaceType, component); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overrideNotificationAppName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Notification.Builder n, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> system)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Bundle extras = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); String appName = system ? context.getString(com.android.internal.R.string.notification_app_name_system) : context.getString(com.android.internal.R.string.notification_app_name_settings); extras.putString(Notification.EXTRA_SUBSTITUTE_APP_NAME, appName); n.addExtras(extras); } }</code> </pre><br>  Die Methode start () wird aufgerufen, um <a href="">jeden Dienst</a> zu starten, die unten aufgef√ºhrt sind. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string-array</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"config_systemUIServiceComponents"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translatable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.Dependency<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.util.NotificationChannels<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.statusbar.CommandQueue$CommandQueueStart<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.keyguard.KeyguardViewMediator<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.recents.Recents<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.volume.VolumeUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.stackdivider.Divider<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.SystemBars<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.usb.StorageNotification<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.power.PowerUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.media.RingtonePlayer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.keyboard.KeyboardUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.pip.PipUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.shortcut.ShortcutKeyDispatcher<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>@string/config_systemUIVendorServiceComponent<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.util.leak.GarbageMonitor$Service<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.LatencyTester<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.globalactions.GlobalActionsComponent<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.ScreenDecorations<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.fingerprint.FingerprintDialogImpl<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.SliceBroadcastRelayHandler<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string-array</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  Lautst√§rkeregler </h3><br>  Wir verwenden regelm√§√üig die Lautst√§rketasten auf unseren Ger√§ten, denken jedoch nicht dar√ºber nach, welche Prozesse im System ablaufen sollen, damit wir den Ton erh√∂hen oder verringern k√∂nnen.  Die Bedienung scheint in Worten recht einfach zu sein, aber wenn Sie sich die VolumeUI ansehen, die sich in einem Unterordner von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SystenUI / volume befindet</a> , hat die Benutzeroberfl√§che ihre eigenen Variationen in verschiedenen Modi. <br><br><img src="https://habrastorage.org/webt/tp/a0/nv/tpa0nvqhpyj6oeijp8dupz5poqw.png"><br>  Ich habe bereits gesagt, dass SystemUI-Dienste mit der Methode start () gestartet werden.  Wenn wir uns die <a href="">VolumeUI-</a> Klasse <a href="">ansehen</a> , erbt sie auch von SystemUI. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VolumeUI</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SystemUI</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TAG = <span class="hljs-string"><span class="hljs-string">"VolumeUI"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> LOGD = Log.isLoggable(TAG, Log.DEBUG); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Handler mHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> mEnabled; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> VolumeDialogComponent mVolumeComponent; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> enableVolumeUi = mContext.getResources().getBoolean(R.bool.enable_volume_ui); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> enableSafetyWarning = mContext.getResources().getBoolean(R.bool.enable_safety_warning); mEnabled = enableVolumeUi || enableSafetyWarning; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mEnabled) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; mVolumeComponent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VolumeDialogComponent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, mContext, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); mVolumeComponent.setEnableDialogs(enableVolumeUi, enableSafetyWarning); putComponent(VolumeComponent.class, getVolumeComponent()); setDefaultVolumeController(); } ‚Ä¶</code> </pre> <br>  Hier sehen wir, dass wir mit mEnabled festlegen, ob wir ein Panel mit Soundeinstellungen anzeigen m√∂chten.  Nach der VolumeDialogComponent zeigt VolumeUI die Soundbar als Dialogfeld an.  Alle Aktionen zum Dr√ºcken der Lautst√§rketasten werden jedoch in <a href="">PhoneWindow ausgef√ºhrt</a> . <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onKeyDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> featureId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> keyCode, KeyEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (keyCode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_UP: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_DOWN: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_MUTE: { <span class="hljs-comment"><span class="hljs-comment">// If we have a session send it the volume command, otherwise // use the suggested stream. if (mMediaController != null) { mMediaController.dispatchVolumeButtonEventAsSystemService(event); } else { getMediaSessionManager().dispatchVolumeKeyEventAsSystemService(event, mVolumeControlStreamType); } return true; } ... protected boolean onKeyUp(int featureId, int keyCode, KeyEvent event) { final KeyEvent.DispatcherState dispatcher = mDecor != null ? mDecor.getKeyDispatcherState() : null; if (dispatcher != null) { dispatcher.handleUpEvent(event); } //Log.i(TAG, "Key up: repeat=" + event.getRepeatCount() // + " flags=0x" + Integer.toHexString(event.getFlags())); switch (keyCode) { case KeyEvent.KEYCODE_VOLUME_UP: case KeyEvent.KEYCODE_VOLUME_DOWN: { // If we have a session send it the volume command, otherwise // use the suggested stream. if (mMediaController != null) { mMediaController.dispatchVolumeButtonEventAsSystemService(event); } else { getMediaSessionManager().dispatchVolumeKeyEventAsSystemService( event, mVolumeControlStreamType); } return true; } ‚Ä¶</span></span></code> </pre> <br>  Soweit wir sehen k√∂nnen, wird KEYCODE_VOLUME_UP (+) nicht verarbeitet und geht in die Verarbeitung von KEYCODE_VOLUME_DOWN (-) √ºber.  In beiden F√§llen, sowohl onKeyDown als auch onKeyUp, wird die <a href="">dispatchVolumeButtonEventAsSystemService-</a> Methode aufgerufen. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatchVolumeButtonEventAsSystemService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NonNull KeyEvent keyEvent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (keyEvent.getAction()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.ACTION_DOWN: { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> direction = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (keyEvent.getKeyCode()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_UP: direction = AudioManager.ADJUST_RAISE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; ... mSessionBinder.adjustVolume(mContext.getPackageName(), mCbStub, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, direction, ... }</code> </pre><br>  Hier rufen wir also die adjustVolume-Methode auf, damit wir unsere Richtung √ºberpr√ºfen k√∂nnen, der der Ereignisparameter zugewiesen wird. <br><br>  Wenn wir zum <a href="">AudioService gelangen,</a> wird <a href="">sendVolumeUpdate</a> aufgerufen, und zus√§tzlich zum Aufrufen der postVolumeChanged-Methode wird die HDMI-Schnittstelle installiert. <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">// UI update and Broadcast Intent protected void sendVolumeUpdate(int streamType, int oldIndex, int index, int flags) { ... mVolumeController.postVolumeChanged(streamType, flags); } private int updateFlagsForSystemAudio(int flags) { ... if (mHdmiSystemAudioSupported &amp;&amp; ((flags &amp; AudioManager.FLAG_HDMI_SYSTEM_AUDIO_VOLUME) == 0)) { flags &amp;= ~AudioManager.FLAG_SHOW_UI; } ... } return flags; } public void postVolumeChanged(int streamType, int flags) { ... mController.volumeChanged(streamType, flags); ... }</span></span></code> </pre> <br><h3>  Klingelton-Player </h3><br>  RingtonePlayer in Android fungiert als Player.  Es erbt auch von SystemUI und in der <a href="">start ()</a> -Methode sehen wir: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... mAudioService.setRingtonePlayer(mCallback); ... }</code> </pre> <br>  Hier installieren wir mCallback, eine Instanz von <a href="">IRingtonePlayer</a> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IRingtonePlayer mCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IRingtonePlayer.Stub() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token, Uri uri, AudioAttributes aa, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> volume, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> looping)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> RemoteException </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPlaying</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPlaybackProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> volume, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> looping)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playAsync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Uri uri, UserHandle user, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> looping, AudioAttributes aa)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopAsync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTitle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Uri uri)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ParcelFileDescriptor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openRingtone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Uri uri)</span></span></span><span class="hljs-function"> </span></span>{ ... } };</code> </pre> <br>  Am Ende k√∂nnen Sie RingtonePlayerService mithilfe des Binders zum Abspielen von Audiodateien steuern. <br><br><h3>  Powerui </h3><br>  <a href="">PowerUI</a> ist f√ºr die Energieverwaltung und Benachrichtigungen verantwortlich.  Es wird ebenfalls von SystemUI geerbt und verf√ºgt √ºber eine start () -Methode. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mPowerManager = (PowerManager) mContext.getSystemService(Context.POWER_SERVICE); mHardwarePropertiesManager = (HardwarePropertiesManager) mContext.getSystemService(Context.HARDWARE_PROPERTIES_SERVICE); mScreenOffTime = mPowerManager.isScreenOn() ? -<span class="hljs-number"><span class="hljs-number">1</span></span> : SystemClock.elapsedRealtime(); mWarnings = Dependency.get(WarningsUI.class); mEnhancedEstimates = Dependency.get(EnhancedEstimates.class); mLastConfiguration.setTo(mContext.getResources().getConfiguration()); ContentObserver obs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContentObserver(mHandler) { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> selfChange)</span></span></span><span class="hljs-function"> </span></span>{ updateBatteryWarningLevels(); } }; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ContentResolver resolver = mContext.getContentResolver(); resolver.registerContentObserver(Settings.Global.getUriFor( Settings.Global.LOW_POWER_MODE_TRIGGER_LEVEL), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, obs, UserHandle.USER_ALL); updateBatteryWarningLevels(); mReceiver.init(); showThermalShutdownDialog(); initTemperatureWarning(); }</code> </pre> <br>  Wie aus dem obigen Code <a href="">ersichtlich</a> ist, werden die √Ñnderungen von Settings.Global.LOW_POWER_MODE_TRIGGER_LEVEL abonniert, und danach wird der Aufruf von <a href="">mReceiver.init ()</a> aufgerufen. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Register for Intent broadcasts for... IntentFilter filter = new IntentFilter(); filter.addAction(PowerManager.ACTION_POWER_SAVE_MODE_CHANGED); filter.addAction(Intent.ACTION_BATTERY_CHANGED); filter.addAction(Intent.ACTION_SCREEN_OFF); filter.addAction(Intent.ACTION_SCREEN_ON); filter.addAction(Intent.ACTION_USER_SWITCHED); mContext.registerReceiver(this, filter, null, mHandler); }</span></span></code> </pre> <br>  Hier wird der Rundfunkempf√§nger registriert, mit dessen Hilfe die √Ñnderungsverfolgung durchgef√ºhrt wird. <br><br><h3>  Die Aufgaben </h3><br>  <a href="">Recents</a> ist eine prim√§re und h√§ufig verwendete Funktion in Android-Mobilger√§ten. <br><br><h4>  Die Hauptfunktionen: </h4><br><ul><li>  Alle Aufgaben anzeigen </li><li>  Zwischen Aufgaben wechseln </li><li>  Aufgaben l√∂schen </li></ul><br><br>  Dar√ºber hinaus wird Recents auch von SystemUI geerbt.  RecentsActivity erstellt und aktualisiert die neuesten Aufgaben, damit wir sie auf unserem Bildschirm sehen k√∂nnen. <br><br><img src="https://habrastorage.org/webt/82/m5/ms/82m5ms1gauzrja6tv5-m47jq62k.png"><br>  Und mit <a href="">RecentTaskInfo k√∂nnen</a> wir Informationen √ºber eine bestimmte Aufgabe erhalten. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecentTaskInfo</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parcelable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> persistentId; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Intent baseIntent; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ComponentName origActivity; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ComponentName realActivity; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CharSequence description; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stackId; ...</code> </pre> <br>  Im Allgemeinen k√∂nnen laufende Aufgaben in einem separaten Thema platziert werden.  Ich habe es von allen Seiten studiert, weil ich den Anwendungsbildschirm verwischen wollte, bevor ich die Anwendung in den Hintergrund schaltete, damit in RecentsTask eine unlesbare Version des Snapshots angezeigt wurde.  Das Problem ist jedoch, dass der Anwendungs-Snapshot erstellt wird, bevor onPause () aufgerufen wird.  Dieses Problem kann auf verschiedene Arten gel√∂st werden.  Oder setzen Sie das Flag so, dass das System einfach den Inhalt des Bildschirms mit verbirgt <br><br><pre> <code class="java hljs">getWindow().setFlags(WindowManager.LayoutParams.FLAG_SECURE, WindowManager.LayoutParams.FLAG_SECURE);</code> </pre> <br>  Wor√ºber ich in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fr√ºheren Artikel</a> nur √ºber Schnappsch√ºsse gesprochen habe. <br><br>  Sie k√∂nnen im Allgemeinen sicherstellen, dass die spezifische Aktivit√§t der Anwendung nicht in Aufgaben angezeigt wird, indem Sie sie im Manifest ablegen <br><br><pre> <code class="xml hljs">android:excludeFromRecents = "true"</code> </pre> <br>  Oder Sie k√∂nnen den Trick mit verwenden <br><br><pre> <code class="java hljs">Intent.FLAG_ACTIVITY_MULTIPLE_TASK</code> </pre> <br>  Sie k√∂nnen die Hauptaktivit√§t √ºber dem Flag <i>excludeFromRecents = true setzen</i> , damit sich der Bildschirm nicht in den ausgef√ºhrten Aufgaben befindet. Wenn die Anwendung geladen wird, f√ºhren Sie eine separate Aufgabe aus, die entweder einen verschwommenen Screenshot der Hauptaktivit√§t oder ein anderes Bild anzeigt.  Wie dies getan werden kann, wird in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offiziellen Dokumentation</a> am Beispiel von Google Drive beschrieben. <br><br><h3>  Bildschirm sperren </h3><br>  Keyguard ist bereits komplizierter als alle oben genannten Module.  Es ist ein Dienst, der in SystemUI ausgef√ºhrt und mit KeyguardViewMediator verwaltet wird. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupLocked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">// Assume keyguard is showing (unless it's disabled) until we know for sure, unless Keyguard // is disabled. if (mContext.getResources().getBoolean( com.android.keyguard.R.bool.config_enableKeyguardService)) { setShowingLocked(!shouldWaitForProvisioning() &amp;&amp; !mLockPatternUtils.isLockScreenDisabled( KeyguardUpdateMonitor.getCurrentUser()), mAodShowing, mSecondaryDisplayShowing, true /* forceCallbacks */); } else { // The system's keyguard is disabled or missing. setShowingLocked(false, mAodShowing, mSecondaryDisplayShowing, true); } ... mLockSounds = new SoundPool(1, AudioManager.STREAM_SYSTEM, 0); String soundPath = Settings.Global.getString(cr, Settings.Global.LOCK_SOUND); if (soundPath != null) { mLockSoundId = mLockSounds.load(soundPath, 1); } ... int lockSoundDefaultAttenuation = mContext.getResources().getInteger( com.android.internal.R.integer.config_lockSoundVolumeDb); mLockSoundVolume = (float)Math.pow(10, (float)lockSoundDefaultAttenuation/20); ... }</span></span></code> </pre> <br>  In der Realit√§t arbeitet KeyguardService jedoch nicht unabh√§ngig mit der Sperrbildschirmschnittstelle, sondern √ºbertr√§gt nur Informationen an das StatusBar-Modul, in dem bereits Ma√ünahmen hinsichtlich des visuellen Erscheinungsbilds des Bildschirms und der Anzeige von Informationen ergriffen wurden. <br><br><h3>  Benachrichtigungsleiste </h3><br>  <a href="">SystemBars</a> hat ein ziemlich komplexes Ger√§t und eine ziemlich komplexe Struktur.  Seine Arbeit gliedert sich in zwei Phasen: <br><ol><li>  SystemBars initialisieren </li><li>  Benachrichtigungen anzeigen </li></ol><br>  Wenn Sie sich den Start von SystemBars ansehen <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStatusBarFromConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String clsName = mContext.getString(R.string.config_statusBarComponent); ... cls = mContext.getClassLoader().loadClass(clsName); ... mStatusBar = (SystemUI) cls.newInstance(); ... }</code> </pre> <br>  Dann sehen wir einen Link zu der Ressource, aus der <a href="">der Klassenname gelesen</a> und eine Instanz erstellt wird. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"config_statusBarComponent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translatable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.statusbar.phone.StatusBar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Wir sehen also, dass hier eine Statusleiste aufgerufen wird, die mit der Benachrichtigungs- und UI-Ausgabe funktioniert. <br><br>  Ich denke, niemand hat daran gezweifelt, dass Android sehr kompliziert ist und viele Tricks enth√§lt, die in einer Vielzahl von Codezeilen beschrieben werden.  SystemUI ist einer der wichtigsten Teile dieses Systems und ich habe es genossen, dar√ºber zu lernen.  Aufgrund der Tatsache, dass es zu diesem Thema nur sehr wenig Material gibt, korrigieren Sie mich bitte, wenn Sie Fehler bemerken. <br><br>  PS Ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">stelle</a> immer eine Auswahl an Material und k√ºrzeren Artikeln auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@paradisecurity</a> in Telegrammen zur Verf√ºgung. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de433620/">https://habr.com/ru/post/de433620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de433608/index.html">Das Auto der Zukunft. Bildschirme statt Autoglas?</a></li>
<li><a href="../de433610/index.html">Notizen eines Phytochemikers. Persimmon</a></li>
<li><a href="../de433612/index.html">FCC: SpaceX-Satelliten im Orbit - eine Quelle von Tr√ºmmern, die f√ºr die Bewohner der Erde gef√§hrlich sind</a></li>
<li><a href="../de433614/index.html">So √ºbernehmen Sie die Kontrolle √ºber Ihre Netzwerkinfrastruktur. Kapitel Eins Aufbewahrung</a></li>
<li><a href="../de433618/index.html">"Warm Tube" Sound mit eigenen H√§nden. Was ist, wenn Sie ein Gesch√§ft, einen Club und eine Werkstatt durchqueren?</a></li>
<li><a href="../de433624/index.html">Learning Rust: Wie ich UDP-Chat mit Azul gemacht habe</a></li>
<li><a href="../de433628/index.html">Feedback-Kultur: Wie man nicht in Anschuldigungen ger√§t</a></li>
<li><a href="../de433630/index.html">Ein Schritt n√§her am HIV-Impfstoff: Affentiter von serumneutralisierenden Antik√∂rpern</a></li>
<li><a href="../de433632/index.html">Eine andere mobile Anwendung "leckte" die Daten ihrer Benutzer</a></li>
<li><a href="../de433634/index.html">Bienenstock√ºberwachung | Ich Dadan und Halbukrainer | Datenredundanz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>