<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóæ ü¶í üëø Typescript asynchrone dans une application Internet riche et des d√©corateurs pour le combattre üö£üèø üõ°Ô∏è ‚õπÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Depuis l'av√®nement de async / wait , Typescript a publi√© de nombreux articles qui vantent cette approche de d√©veloppement ( hackernoon , blog.bitsrc.i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Typescript asynchrone dans une application Internet riche et des d√©corateurs pour le combattre</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464773/"><p> Depuis l'av√®nement de <code>async</code> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wait</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Typescript</a> a publi√© de nombreux articles qui vantent cette approche de d√©veloppement ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hackernoon</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">blog.bitsrc.io</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com</a> ).  Nous les utilisons depuis le tout d√©but c√¥t√© client (lorsque les g√©n√©rateurs ES6 prenaient en charge moins de 50% des navigateurs).  Et maintenant, je veux partager mon exp√©rience, car l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ex√©cution parall√®le</a> n'est pas tout ce qui serait bien de savoir le long de ce chemin. </p><a name="habracut"></a><br><p>  Je n'aime pas vraiment le dernier article: quelque chose peut √™tre incompr√©hensible.  En partie √† cause du fait que je ne peux pas fournir de code propri√©taire - uniquement pour d√©crire l'approche g√©n√©rale.  Par cons√©quent: </p><br><ul><li>  n'h√©sitez pas √† fermer l'onglet sans lire </li><li>  si vous y parvenez, demandez des d√©tails peu clairs </li><li>  J'accepterai volontiers les conseils et les critiques des plus persistants et minutieusement d√©couverts. </li></ul><br><p>  <strong>Liste des technologies de base:</strong> </p><br><ul><li>  Le projet est √©crit principalement en Typescript en utilisant plusieurs biblioth√®ques Javascript.  La biblioth√®que principale est ExtJS.  Il est inf√©rieur en termes de mode √† React, mais il convient le mieux √† un produit d'entreprise avec une interface riche: de nombreux composants pr√™ts √† l'emploi, des tables bien con√ßues et pr√™tes √† l'emploi, un riche √©cosyst√®me de produits connexes pour simplifier le d√©veloppement. </li><li>  Serveur multithread asynchrone. </li><li>  RPC via Websocket est utilis√© comme transport entre le client et le serveur.  L'impl√©mentation est similaire √† .NET WCF. <br><ul><li>  Tout objet est un service. </li><li>  Tout objet peut √™tre transmis √† la fois par valeur et par r√©f√©rence. </li></ul></li><li>  L'interface de demande de donn√©es ressemble √† GraphQL de Facebook, uniquement sur Typescript. </li><li>  Communication bidirectionnelle: l'initialisation de la mise √† jour des donn√©es peut √™tre lanc√©e √† la fois depuis le client et depuis le serveur. </li><li>  Le code asynchrone est √©crit s√©quentiellement gr√¢ce √† l'utilisation des fonctions <code>async</code> / <code>await</code> de Typesrcipt. </li><li>  L'API du serveur est g√©n√©r√©e en Typescript: si elle change, la build l'affichera imm√©diatement en cas d'erreur. </li></ul><br><p>  <strong>Quelle est la sortie</strong> </p><br><p>  Je vais vous dire comment nous travaillons avec cela et ce que nous avons fait pour une ex√©cution s√ªre et non comp√©titive du code asynchrone: nos d√©corateurs Typesrcipt qui impl√©mentent la fonctionnalit√© des files d'attente.  Des principes de base √† la solution de la condition de concurrence et d'autres difficult√©s qui surviennent au cours du processus de d√©veloppement. </p><br><h2 id="kak-strukturirovany-dannye-poluchaemye-s-servera">  Structure des donn√©es re√ßues du serveur </h2><br><p>  Le serveur renvoie un objet parent qui contient des donn√©es (autres objets, collections d'objets, lignes, etc.) dans ses propri√©t√©s sous la forme d'un graphique.  Cela est d√ª, entre autres, √† l'application elle-m√™me: </p><br><ul><li>  il fait de l'analyse des donn√©es / ML un graphe orient√© des n≈ìuds de gestionnaire. </li><li>  chaque n≈ìud √† son tour peut contenir son propre graphique int√©gr√© </li><li>  les graphes ont des d√©pendances: les n≈ìuds peuvent √™tre ¬´h√©rit√©s¬ª, et de nouveaux n≈ìuds sont cr√©√©s par leur ¬´classe¬ª. </li></ul><br><p>  Mais la structure de requ√™te sous la forme d'un graphique peut √™tre appliqu√©e dans presque toutes les applications, et GraphQL, pour autant que je sache, le mentionne √©galement dans sa sp√©cification. </p><br><p>  Exemple de structure de donn√©es: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   interface IParent { ServerId: string; Nodes: INodes; // INodes -     INode } //     interface INodes&lt;TNode extends INode&gt; extends ICollection { IndexOf(item: TNode): number; Item(index: number): TNode; // ...     } //    interface INode extends IItem { Guid: string; Name: string; DisplayName: string; Links: ILinks; // ILinks -    Info: INodeInfo; //    -  } //      interface ILink { Guid: string; DisplayName: string; SourceNode: INode; //   -  TargetNode: INode; //   ,   } interface INodeInfo { Component: IComponent; ConfigData: IData; }</span></span></code> </pre><br><h2 id="kak-klient-poluchaet-dannye">  Comment un client re√ßoit-il des donn√©es </h2><br><p>  C'est simple: lorsque vous demandez une propri√©t√© d'un objet d'un type non scalaire, RPC renvoie <code>Promise</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Nodes = Parent.Nodes; <span class="hljs-comment"><span class="hljs-comment">// Nodes -&gt; Promise&lt;INodes&gt;</span></span></code> </pre><br><h3 id="asinhronnost-bez-callback-hell">  Asynchronie sans "Hell Callback". </h3><br><p>  Pour organiser un code asynchrone "s√©quentiel", la fonctionnalit√© <code>async</code> / <code>await</code> Typescript est utilis√©e: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowNodes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parent: IParent</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    let Nodes = await parent.Nodes; //       await Nodes.forEachParallel(async function(node): Promise&lt;void&gt; { await RenderNode(node); //          }); }</span></span></code> </pre><br><p>  Cela n'a aucun sens de s'y attarder en d√©tail, sur le moyeu il y a d√©j√† suffisamment de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mat√©riel d√©taill√©</a> .  Ils sont apparus dans Typescript en 2016.  Nous utilisons cette approche depuis qu'elle est apparue dans la branche des fonctionnalit√©s du r√©f√©rentiel Typescript, c'est pourquoi nous avons des bosses depuis longtemps et maintenant nous travaillons avec plaisir.  Depuis quelque temps maintenant, et en production. </p><br><p>  En bref, l'essence pour ceux qui ne connaissent pas le sujet: </p><br><p>  D√®s que vous ajoutez le mot cl√© <code>async</code> √† la fonction, il renverra automatiquement la <code>Promise&lt;_&gt;</code> .  Caract√©ristiques de ces fonctions: </p><br><ul><li>  Les expressions √† l'int√©rieur des fonctions <code>async</code> avec <code>await</code> (qui renvoient <code>Promise</code> ) arr√™teront l'ex√©cution de la fonction et continueront apr√®s la r√©solution de la <code>Promise</code> attendue. </li><li>  Si une exception se produit dans la fonction <code>async</code> , la <code>Promise</code> retourn√©e sera rejet√©e avec cette exception. </li><li>  Lors de la compilation en code Javascript, il y aura des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">g√©n√©rateurs</a> pour le standard ES6 ( <code>function*</code> au lieu de <code>async function</code> et <code>yield</code> au lieu d' <code>await</code> ) ou code effrayant avec <code>switch</code> pour ES5 (machine d'√©tat).  <code>await</code> est un mot cl√© qui attend le r√©sultat d'une promesse.  Au moment de la r√©union, pendant l'ex√©cution du code, la fonction <code>ShowNodes</code> s'arr√™te, et en attendant les donn√©es, Javascript peut ex√©cuter un autre code. </li></ul><br><p>  Dans le code ci-dessus, la collection a une m√©thode <code>forEachParallel</code> qui appelle un rappel asynchrone pour chaque n≈ìud en parall√®le.  En m√™me temps, <code>await</code> avant que <code>Nodes.forEachParallel</code> n'attende tous les rappels.  A l'int√©rieur de l'impl√©mentation - <code>Promise.all</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** *            * @param items  * @param callbackfn  * @param [thisArg]   ,      this  callbackfn */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forEachParallel</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items: IItemArray&lt;T&gt;, callbackfn: (value: T, index: int, items: IItemArray&lt;T&gt;</span></span></span><span class="hljs-function">) =&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> | </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">any</span></span></span><span class="hljs-function">&gt;, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thisArg</span></span></span><span class="hljs-function">?: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">any</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xCount = items ? <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> items.Count : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!xCount) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> | any&gt;&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xCount</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">for</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">let</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">; i &lt; xCount; i++</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">let</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xItem</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Item</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xActions</span></span></span><span class="hljs-function">[</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function">] = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ExecuteCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xItem, callbackfn, i, items, thisArg</span></span></span><span class="hljs-function">); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">await</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Promise</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">all</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xActions</span></span></span><span class="hljs-function">); } /**   </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">   </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callbackfn</span></span></span><span class="hljs-function"> */ </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">async</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ExecuteCallback</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Promise</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;T&gt; | T, callbackfn: (value: T, index: int, items: IItemArray&lt;T&gt;</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> | any&gt;, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: int, <span class="hljs-attr"><span class="hljs-attr">items</span></span>: IItemArray&lt;T&gt;, thisArg?: any): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xItem = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> item; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> callbackfn.call(thisArg, xItem, index, items); }</code> </pre><br><p>  C'est du sucre syntaxique: de telles m√©thodes doivent √™tre utilis√©es non seulement pour leurs collections, mais aussi pour les tableaux Javascript standard. </p><br><p>  La fonction <code>ShowNodes</code> semble extr√™mement non optimale: lorsque nous demandons une autre entit√©, nous l'attendons √† chaque fois.  La commodit√© est qu'un tel code peut √™tre √©crit rapidement, donc cette approche est bonne pour le prototypage rapide.  Dans la version finale, vous devez utiliser le langage de requ√™te pour r√©duire le nombre d'appels au serveur. </p><br><h2 id="yazyk-zaprosov">  Langue de la requ√™te </h2><br><p>  Il existe plusieurs fonctions permettant de ¬´cr√©er¬ª une demande de donn√©es √† partir du serveur.  Ils ¬´indiquent¬ª au serveur quels n≈ìuds du graphe de donn√©es retourner dans la r√©ponse: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** *       item    Promise  , *      properties */</span></span> selectAsync&lt;T extends IItem&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: T, properties: (</span></span></span><span class="hljs-function">) =&gt;</span></span> any[]): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;T&gt;; <span class="hljs-comment"><span class="hljs-comment">/** *   items,       properties */</span></span> selectAsyncAll&lt;T extends ICollection&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items: T[], properties: (</span></span></span><span class="hljs-function">) =&gt;</span></span> any[]): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;T[]&gt;; <span class="hljs-comment"><span class="hljs-comment">/**    selectAsync     */</span></span> select&lt;T&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: T, properties: (</span></span></span><span class="hljs-function">) =&gt;</span></span> any[]): T; <span class="hljs-comment"><span class="hljs-comment">/**    selectAsync     */</span></span> selectAll&lt;T&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items: T[], properties: (</span></span></span><span class="hljs-function">) =&gt;</span></span> any[]): T[];</code> </pre><br><p>  Examinons maintenant l'application de ces fonctions pour demander les donn√©es int√©gr√©es n√©cessaires en un seul appel au serveur: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowNodes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parentPoint: IParent</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       IParent -    selectAsync ( // Promise,  ). let Parent = await selectAsync(parentPoint, parent =&gt; [ //           selectAll(parent.Nodes, nodes =&gt; [node.Name, node.DisplayName]) // [node.Name, node.DisplayName] -        ]); //      Parent.Nodes ... }</span></span></code> </pre><br><p>  Un exemple d'une requ√™te l√©g√®rement plus complexe avec des informations profond√©ment int√©gr√©es: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     parent.Nodes  selectAsyncAll,    let Parent = await selectAsyncAll(parent.Nodes, nodes =&gt; [ //    : select(node, node =&gt; [ node.Name, node.DisplayName, selectAll(node.Links, link =&gt; [ link.Guid, link.DisplayName, select(link.TargetNode, targetNode =&gt; [targetNode.Guid]) ]), select(node.Info, info =&gt; [info.Component]) //    IInfo    IComponent,   ,   ,        ]) ]);</span></span></code> </pre><br><p>  Le langage de requ√™te permet d'√©viter les demandes inutiles au serveur.  Mais le code n'est jamais parfait, et il contiendra certainement plusieurs demandes concurrentielles et, par cons√©quent, des conditions de concurrence. </p><br><h2 id="race-condition-i-puti-resheniya">  Condition de course et solutions </h2><br><p>  Comme nous nous abonnons aux √©v√©nements du serveur et √©crivons du code avec un grand nombre de demandes asynchrones, une condition de <code>FuncOne</code> peut se produire lorsque la fonction <code>async</code> <code>FuncOne</code> interrompue, en attente de <code>Promise</code> .  √Ä ce moment, un √©v√©nement de serveur (ou de la prochaine action de l'utilisateur) peut survenir et, apr√®s ex√©cution concurrentielle, changer le mod√®le sur le client.  Ensuite, <code>FuncOne</code> apr√®s avoir r√©solu la promesse, peut se tourner, par exemple, vers des ressources d√©j√† supprim√©es. </p><br><p>  Imaginez une telle situation simplifi√©e: l'objet <code>IParent</code> a un <code>IParent</code> serveur <code>IParent</code> . </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/**   */</span></span> Parent.OnSynchronize.AddListener(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  .   ,  . });</span></span></code> </pre><br><p>  Il est appel√© lorsque la liste des n≈ìuds <code>INodes</code> sur le serveur est mise √† jour.  Ensuite, dans le sc√©nario suivant, une condition de concurrence est possible: </p><br><ol><li>  Nous provoquons la suppression asynchrone du n≈ìud du client, en attendant la fin pour supprimer l'objet client <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnClickRemoveNode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node: INode</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> removedOnServer: boolean = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Parent.RemoveNode(node); <span class="hljs-comment"><span class="hljs-comment">//     if (removedOnServer) .... }</span></span></code> </pre> </li><li>  Par le biais de <code>Parent.OnSynchronize</code> , une mise √† jour de l'√©v√©nement de liste de n≈ìuds se produit. </li><li>  <code>Parent.OnSynchronize</code> trait√© et supprime l'objet client. </li><li>  <code>async OnClickRemoveNode()</code> continue de s'ex√©cuter apr√®s la premi√®re <code>await</code> et une tentative est faite pour supprimer un objet client d√©j√† supprim√©. </li></ol><br><p>  Vous pouvez v√©rifier l'existence d'un objet client dans <code>OnClickRemoveNode</code> .  Il s'agit d'un exemple simplifi√© et une v√©rification similaire est normale.  Mais que faire si la cha√Æne d'appel est plus compliqu√©e?  Par cons√©quent, l'utilisation d'une approche similaire apr√®s chaque <code>await</code> est une mauvaise pratique: </p><br><ul><li>  Le code tellement gonfl√© est compliqu√© √† prendre en charge et √† √©tendre. </li><li>  Le code ne fonctionne pas comme pr√©vu: la suppression dans <code>OnClickRemoveNode</code> et la suppression r√©elle de l'objet client se produit ailleurs.  Il ne doit pas y avoir de violation de la s√©quence d√©finie par le d√©veloppeur, sinon il y aura des erreurs de r√©gression. </li><li>  Ce n'est pas assez fiable: si vous oubliez de v√©rifier quelque part, il y aura une erreur.  Le danger est, tout d'abord, qu'une v√©rification oubli√©e ne conduise pas √† une erreur localement et dans un environnement de test, et pour les utilisateurs avec un d√©lai r√©seau plus long, elle se produira. </li><li>  Et si le contr√¥leur auquel appartiennent ces gestionnaires peut √™tre d√©truit?  Apr√®s chaque <code>await</code> pour v√©rifier sa destruction? </li></ul><br><p>  Une autre question se pose: que se passe-t-il s'il existe de nombreuses m√©thodes de concurrence similaires?  Imaginez qu'il y en ait plus: </p><br><ul><li>  Ajout d'un n≈ìud </li><li>  Mise √† jour du n≈ìud </li><li>  Ajouter / supprimer des liens </li><li>  M√©thode de conversion √† n≈ìuds multiples </li><li>  Comportement complexe de l'application: nous changeons l'√©tat d'un n≈ìud et le serveur commence √† mettre √† jour les n≈ìuds qui en d√©pendent. </li></ul><br><p>  Une mise en ≈ìuvre architecturale est requise, ce qui √©limine en principe la possibilit√© d'erreurs dues √† la condition de concurrence, aux actions utilisateur parall√®les, etc.  La bonne solution pour √©liminer le changement simultan√© du mod√®le du client ou du serveur est d'impl√©menter une section critique avec une file d'attente d'appels.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les d√©corateurs dactylographi√©s</a> seront utiles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> pour baliser de mani√®re d√©clarative ces fonctions de contr√¥leur asynchrones comp√©titives. </p><br><p>  <strong>Nous d√©crivons les exigences et les principales caract√©ristiques de ces d√©corateurs:</strong> </p><br><ol><li>  A l'int√©rieur, une file d'attente d'appels aux fonctions asynchrones doit √™tre impl√©ment√©e.  Selon le type de d√©corateur, un appel de fonction peut √™tre mis en file d'attente ou rejet√© s'il contient d'autres appels. </li><li>  Les fonctions marqu√©es n√©cessiteront un contexte d'ex√©cution pour se lier √† la file d'attente.  Vous devez soit cr√©er explicitement une file d'attente, soit le faire automatiquement en fonction de la vue √† laquelle appartient le contr√¥leur. </li><li>  Des informations sont requises sur la destruction de l'instance de contr√¥leur (par exemple, la propri√©t√© <code>IsDestroyed</code> ).  Pour emp√™cher les d√©corateurs de faire des appels en file d'attente apr√®s la destruction du contr√¥leur. </li><li>  Pour le contr√¥leur View, nous ajoutons la fonctionnalit√© d'appliquer un masque translucide pour exclure les actions au moment de l'ex√©cution de la file d'attente et indiquer visuellement le traitement en cours. </li><li>  Tous les d√©corateurs doivent terminer par un appel √† <code>Promise.done()</code> .  Dans cette m√©thode, vous devez impl√©menter le <code>handler</code> exceptions non g√©r√©es.  Une chose tr√®s utile: <br><ul><li>  les exceptions qui se sont produites dans <code>Promise</code> ne sont pas intercept√©es par le gestionnaire d'erreurs standard (qui, par exemple, affiche une fen√™tre avec du texte et une trace de piquage), vous pouvez donc ne pas les remarquer (si vous ne surveillez pas la console tout le temps pendant le d√©veloppement).  Et l'utilisateur ne les verra pas du tout - cela rendra le support difficile.  Remarque: il est possible de s'abonner pour g√©rer l'√©v√©nement de <code>unhandledrejection</code> , mais toujours seul Chrome et Edge le prennent en charge: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'unhandledrejection'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// handling... });</span></span></code> </pre> </li><li>  puisque nous marquons la fonction de gestionnaire d'√©v√©nements <code>async</code> la plus √©lev√©e en tant que d√©corateurs, nous obtenons l'erreur de trace de la pile enti√®re. </li></ul></li></ol><br><p>  Maintenant, nous donnons une liste approximative de ces d√©corateurs avec une description, puis montrons comment ils peuvent √™tre appliqu√©s. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * : * 1.      * 2.      ,   . * *  ,  :   ,         */</span></span> @Lock <span class="hljs-comment"><span class="hljs-comment">/** * : *     ,     . * *  ,     :   ,   . */</span></span> @LockQueue <span class="hljs-comment"><span class="hljs-comment">/** *  LockQueue .  -         * *   ,       . ,   . */</span></span> @LockBetween <span class="hljs-comment"><span class="hljs-comment">/** * : *       ,   . *     . :     ,     300 .       . */</span></span> @LockDeferred(<span class="hljs-number"><span class="hljs-number">300</span></span>) <span class="hljs-comment"><span class="hljs-comment">// ,    ,     : interface ILockTarget { /** * ,   View,   .   ,        ,     ,        */ GetControllerView?(): IView; /**  true     */ IsDestroyed: boolean; }</span></span></code> </pre><br><p>  Les descriptions sont assez abstraites, mais d√®s que vous verrez un exemple d'utilisation avec des explications, tout deviendra plus clair: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphController</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILockTarget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** ,      .      */</span></span> private View: IView; public GetControllerView(): IView { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.View; } <span class="hljs-comment"><span class="hljs-comment">/**      . */</span></span> @Lock private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnClickRemoveNode(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**     . */</span></span> @Lock private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnClickRemoveLink(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**     */</span></span> @Lock private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnClickAddNewNode(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    " " */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerUpdateNode(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    " " */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerAddLink(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    " " */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerAddNode(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    -   */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerRemoveNode(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    -       */</span></span> @LockBetween private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerSynchronize(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    -    (/warning/error/...) */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerUpdateNodeStatus(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**       */</span></span> @LockDeferred(<span class="hljs-number"><span class="hljs-number">300</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnSearchFieldChange(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } }</code> </pre><br><p>  Nous allons maintenant analyser quelques sc√©narios typiques d'erreurs possibles et leur √©limination par les d√©corateurs: </p><br><ol><li>  L'utilisateur lance une action: <code>OnClickRemoveNode</code> , <code>OnClickRemoveLink</code> .  Pour un traitement correct, il est n√©cessaire qu'il n'y ait aucun autre gestionnaire en cours d'ex√©cution dans la file d'attente (client ou serveur).  Sinon, par exemple, une telle erreur est possible: <br><ul><li>  Le mod√®le sur le client est toujours mis √† jour vers l'√©tat actuel du serveur </li><li>  Nous initialisons la suppression de l'objet avant la fin de la mise √† jour (la file d'attente a un gestionnaire <code>OnServerSynchronize</code> ).  Mais cet objet n'est plus l√† - la synchronisation compl√®te n'est pas encore termin√©e et elle est toujours affich√©e sur le client. <br>  Par cons√©quent, toutes les actions initi√©es par l'utilisateur, le d√©corateur de <code>Lock</code> doit rejeter s'il existe d'autres gestionnaires dans la file d'attente avec le m√™me contexte de file d'attente.  √âtant donn√© que le serveur est asynchrone, cela est particuli√®rement important.  Oui, Websocket envoie les demandes de mani√®re s√©quentielle, mais si le client rompt la s√©quence, nous obtenons une erreur sur le serveur. </li></ul></li><li>  Nous <code>OnClickAddNewNode</code> l'ajout d'un n≈ìud: <code>OnClickAddNewNode</code> .  <code>OnServerSynchronize</code> , les √©v√©nements <code>OnServerAddNode</code> proviennent du serveur. <br><ul><li>  <code>OnClickAddNewNode</code> pris la file d'attente (s'il y avait quelque chose, le d√©corateur de <code>Lock</code> de cette m√©thode rejetterait l'appel) </li><li>  <code>OnServerSynchronize</code> , <code>OnServerAddNode</code> en <code>OnServerAddNode</code> d' <code>OnServerAddNode</code> , ex√©cut√© s√©quentiellement apr√®s <code>OnClickAddNewNode</code> , sans concurrence avec lui. </li></ul></li><li>  La file d'attente a des <code>OnServerSynchronize</code> et <code>OnServerUpdateNode</code> .  Supposons que lors de l'ex√©cution du premier, l'utilisateur ferme le <code>GraphController</code> .  Ensuite, le deuxi√®me appel √† <code>OnServerUpdateNode</code> ne doit pas √™tre effectu√© automatiquement afin de ne pas prendre de mesures sur le contr√¥leur d√©truit, ce qui garantit une erreur.  Pour cela, l'interface <code>ILockTarget</code> a <code>IsDestroyed</code> - le d√©corateur v√©rifie l'indicateur sans ex√©cuter le prochain gestionnaire de la file d'attente. <br>  B√©n√©fice: pas besoin d'√©crire <code>if (!this.IsDestroyed())</code> apr√®s chaque <code>await</code> . </li><li>  Les modifications apport√©es √† plusieurs n≈ìuds sont d√©clench√©es.  <code>OnServerSynchronize</code> , les √©v√©nements <code>OnServerUpdateNode</code> proviennent du serveur.  Leur ex√©cution comp√©titive entra√Ænera des erreurs irr√©prochables.  Mais depuis  <code>LockQueue</code> sont marqu√©s par les <code>LockBetween</code> <code>LockQueue</code> et <code>LockBetween</code> , ils seront ex√©cut√©s s√©quentiellement. </li><li>  Imaginez que les n≈ìuds puissent contenir des graphiques de n≈ìuds imbriqu√©s.  <code>GraphController #1</code> ,       ‚Äî   <code>GraphController #2</code> . , <code>GraphController</code> -    ,   (  ‚Äî         ), ..     .  : <br><ul><li>  </li><li>    </li><li>    <code>GraphController #2</code> ,     ,    . </li></ul></li><li> <code>OnSearchFieldChange</code>   ,       .         -  .  <code>@LockDeferred(300)</code>     300 :         ,     ,    300 .  ,       .  : <br><ul><li>   ,   500 ,         .     ‚Äî        <code>OnSearchFieldChange</code> ,     . </li><li>      <code>OnSearchFieldChange</code>    ‚Äî        ,   . </li></ul></li></ol><br><h2 id="chto-nuzhno-znat-pri-ispolzovanii-dekoratorov">       </h2><br><ol><li>  Deadlock:     <code>Handler1</code> ,    ,   <code>await</code>   <code>Handler2</code> ,  <code>LockQueue</code> ,    <code>Handler2</code> ‚Äî <code>Handler1</code>    . </li><li>  ,     View      . :            ,      ‚Äî                . </li></ol><br><h2 id="profilirovanie-zaprosov-k-serveru">     </h2><br><p>    ,     ,        .  : </p><br><ul><li>       - <code>&lt;Class&gt;</code> . <code>&lt;Method&gt;</code> =&gt; <code>&lt;Time&gt;</code> (  ). </li><li>       . </li><li>        . </li></ul><br><h2 id="desert">  </h2><br><p> ,    ,           ,    .        ?         ?  : </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphController</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILockTarget</span></span></span><span class="hljs-class"> </span></span>{ private View: IView; public GetControllerView(): IView { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.View; } <span class="hljs-comment"><span class="hljs-comment">/**     . */</span></span> @Lock private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> RunBigDataCalculations(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Start(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> UpdateSmth(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> End(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> CleanUp(); } <span class="hljs-comment"><span class="hljs-comment">/**   . */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnChangeNodeState(node: INode): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> GetNodeData(node); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> UpdateNode(node); } }</code> </pre><br><p>   : </p><br><ol><li>  <code>RunBigDataCalculations</code> . </li><li>  <code>await Start();</code> </li><li>   /  (  ) </li><li>   <code>await Start();</code> ,   <code>await UpdateSmth();</code>      . </li></ol><br><p> : </p><br><ol><li>  <code>RunBigDataCalculations</code> . </li><li>    <code>OnChangeNodeState</code> ,          (..  ). </li><li>   <code>await GetNodeData(node);</code> </li><li>   /  (  ) </li><li>   <code>await GetNodeData(node);</code> ,   <code>await UpdateNode(node);</code>      . </li></ol><br><p>      - .  : </p><br><ul><li>   : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** *       ,      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface IQueuedDisposableLockTarget extends ILockTarget { <span class="hljs-comment"><span class="hljs-comment">/**     . Lock          IsDisposing() === true */</span></span> IsDisposing(): boolean; SetDisposing(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; }</code> </pre> <br><ul><li>        : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">QueuedDispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">controller: IQueuedDisposableLockTarget</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      let xQueue = GetQueue(controller); // 1. ,     -,   -   if (xQueue.Empty) { controller.Dispose(); return; } // 2.  ,     " ",     ,   . controller.SetDisposing(); // 3.   finally   xQueue.finally(() =&gt; { debug.assert(!IsDisposed(controller), "-      ,  "); controller.Dispose(); }); }</span></span></code> </pre><br><p>  ,          .    <code>QueuedDispose</code>     : </p><br><ul><li>         .       . </li><li>   <code>QueuedDispose</code>     <code>controller</code> .         ‚Äî  ExtJS     . </li></ul><br><p> <strong></strong> </p><br><p>  ,          , ..         . ,      ?    ,  . </p><br><p>    ,      : </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    vk.com</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    Telegram</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464773/">https://habr.com/ru/post/fr464773/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464757/index.html">Am√©liorer votre profil LinkedIn avant de trouver un emploi</a></li>
<li><a href="../fr464759/index.html">Des dizaines de livres agiles dont le chef de projet aura besoin en 2020</a></li>
<li><a href="../fr464761/index.html">Un petit mod transforme Tesla en station de vid√©osurveillance</a></li>
<li><a href="../fr464763/index.html">Benchmarks pour les serveurs sous Linux: une s√©lection d'outils ouverts</a></li>
<li><a href="../fr464765/index.html">Configuration de FreePBX + GoIP</a></li>
<li><a href="../fr464775/index.html">21 septembre Badoo PHP Meetup # 3: Performances</a></li>
<li><a href="../fr464777/index.html">Pourquoi const n'acc√©l√®re-t-il pas le code C / C ++?</a></li>
<li><a href="../fr464779/index.html">√Ä propos des abeilles h√©donistes, de la fa√ßon dont les gens les font fonctionner et des drones</a></li>
<li><a href="../fr464785/index.html">Avantages non comp√©titifs de Beeline</a></li>
<li><a href="../fr464787/index.html">Je suis s√ªr que le d√©veloppeur mobile senior ne viendra que sur recommandation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>