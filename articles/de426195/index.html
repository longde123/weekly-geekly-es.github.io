<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☝🏽 🧑🏽‍🤝‍🧑🏼 🙇 Wie ich in Space Engineers einen Hexapod gebaut habe. Teil 1 🤛🏼 👩🏼‍🏫 🈂️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo. Ich möchte über das Design und die Programmierung eines Gliedmaßensteuerungssystems in dem in Space Engineers gebauten Hexapod sprechen. 

 Mit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie ich in Space Engineers einen Hexapod gebaut habe. Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426195/">  Hallo.  Ich möchte über das Design und die Programmierung eines Gliedmaßensteuerungssystems in dem in Space Engineers gebauten Hexapod sprechen. <br><br>  Mit Blick auf die Zukunft werde ich sagen, dass alles, was mit der Programmierung in Space Engineer zu tun hat, im nächsten Artikel behandelt wird.  In diesem Artikel werde ich über die umgekehrte Kinematik sprechen und einen Prototyp auf HTML Canvas zeigen, in dem ich Algorithmen debuggt habe. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xj/tn/eo/xjtneoatofct-nmcczqob0lkioc.png"></div><a name="habracut"></a><br><h4>  Hintergrund und Erklärung des Problems. </h4><br>  Ursprünglich wurde ein Gelenkchassis gebaut und dann eine Grabeinheit darauf.  Diese Konfiguration stellte den Kontakt aller Räder mit der Oberfläche bei großen Unregelmäßigkeiten einschließlich Verdrehen sicher. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/624/606/4b8/6246064b8bd63bb3eebe9a5cd53442a6.jpg" alt="Bild"></div><br>  <i>So.</i> <br><br>  Ich war jedoch mit der Unmöglichkeit konfrontiert, es genau auf dem Feld zu platzieren, da die Räder oft herunterrutschten (physikalisches Problem - die meisten Blöcke (einschließlich Räder) haben einen zu niedrigen Reibungskoeffizienten).  Die Radplattform mit allradmontierten Radmodulen war zu umständlich und litt unter einer periodischen Explosion der Physik.  Infolgedessen wurde beschlossen, einen Laufroboter - nämlich einen Hexapod - als stabilste Laufplattform zu bauen. <br><br>  Wo fängt ein normaler Mensch an, Hexapoden zu bauen?  Er wird wahrscheinlich ins Spiel gehen und anfangen, einen Roboterkörper mit Gliedmaßen zu bauen, und dann darüber nachdenken, wie er alles wiederbeleben kann.  Dies ist jedoch nicht unsere Methode (c) <br><br><h4>  Ich habe mit der Theorie angefangen </h4><br>  Für die Struktur der Beine wurde folgendes Schema gewählt: <br><br>  Innengelenk - das innere Gelenk, das entlang der Gierachse schwankt (Gier) <br>  Mittelgelenk und Außengelenk - Außengelenke, die entlang der Nickachse (Pitch) schwingen.  Die Referenzrichtung ist von der Fußbasis bis zum Fußende. <br><br><img src="https://habrastorage.org/webt/gb/pf/lk/gbpflkpwfqchpytnnzuisf8_xss.png"><br><br>  Ein Winkel von 0 für alle Gelenke bedeutet, dass das Bein vollständig gestreckt ist (es ist einfacher, im Spiel ein gerades Bein zu bauen). <br><br>  Die Aufgabe besteht darin, solche Drehwinkel der Gelenke für einen bestimmten Zielpunkt zu finden, so dass sich das Beinende an einem bestimmten Punkt befindet.  Bedeutet Zeit, sich an die Trigonometrie zu erinnern. <br><br>  Der Winkel des inneren Gelenks kann durch den Arkustangens der horizontalen Koordinaten des Ziels ermittelt werden. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> yawRad = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan2(esimatedLegPosition.x, esimatedLegPosition.y);</code> </pre> <br>  Mit zwei anderen Gelenken ist es schwieriger.  Wir haben die Länge aller Gelenke.  Sie finden den Winkel zum Horizont und den Abstand zwischen dem Mittelgelenk und dem Boden sowie den Abstand zum Zielpunkt. <br><br>  Als nächstes müssen Sie durch den Kosinussatz die Winkel des Dreiecks auf bekannten Seiten finden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/309/9e4/26c/3099e426c99f78fad697fbba0bbcdaac.png" alt="Bild"></div><br><div style="text-align:center;"><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/73466cc603b04dff114de759f29e794e6e61f185" alt="Bild"></div><br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dreieckslösung</a> <br><br>  So sieht es im Code aus: <br><br><pre> <code class="javascript hljs">getLegAngles(esimatedLegPosition) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> yawRad = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan2(esimatedLegPosition.x, esimatedLegPosition.y); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dx = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(esimatedLegPosition.x, esimatedLegPosition.y) - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.innerJoint.length; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dz = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.step.idlePosition.z + esimatedLegPosition.z; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hyp = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(dx, dz); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hyp &gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.midJoint.length + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.outerJoint.length) {<span class="hljs-comment"><span class="hljs-comment">//out of reach hyp = this.midJoint.length + this.outerJoint.length; } const innerAngleRad = Math.acos((this.outerJoint.length * this.outerJoint.length - this.midJoint.length * this.midJoint.length - hyp * hyp) / (-2 * this.midJoint.length * hyp)) + Math.atan2(dz, dx); const outerAngleRad = Math.acos((hyp * hyp - this.midJoint.length * this.midJoint.length - this.outerJoint.length * this.outerJoint.length) / (-2 * this.midJoint.length * this.outerJoint.length)) - Math.PI; return { yaw: yawRad, midPitch: innerAngleRad, outerPitch: outerAngleRad }; }</span></span></code> </pre> <br><h4>  Bewegung </h4><br>  Weiter.  Der Roboter muss laufen, oder?  Das heißt, wir müssen N-mal pro Sekunde die Koordinaten einer bestimmten Position an jedes Bein senden.  Angesichts der Tatsache, dass sich die Beine von 6 und 3 gegenphasig bewegen, fällt es irgendwie schwierig aus.  Wir müssen eine neue Abstraktionsebene einführen. <br><br>  Aber was ist, wenn wir uns vorstellen, dass sich der Fuß in einem Kreis bewegt und einen Winkel übertragen muss, der die Position auf diesem Kreis angibt?  Das Entfernen zur Seite wird dauerhaft und Sie müssen nur einen Parameter übergeben, der sich zyklisch ändert.  Dann werden die Zielkoordinaten durch Sinus und Cosinus gefunden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q9/pc/a1/q9pca1u_u5aysu0uigf8af-mssc.gif"></div><br>  <i>Genug für jetzt</i> <br><br>  Als ich darüber nachdachte, wie alles funktionieren wird, wurde mir klar, dass die Aufgabe zu kompliziert ist, als dass sie beim ersten Mal funktionieren könnte (beim Debuggen in Space Engineers ist alles schlecht, aber mehr dazu im nächsten Teil). <br><br>  Also habe ich beschlossen, einen Visualizer zu schreiben.  Ich wollte es ohne zusätzliche Bibliotheken machen und es mit einem Klick und ohne Bezug zur Umgebung ausführen können. <br>  Daher wurde JS + HTML Canvas ausgewählt. <br><br>  Jetzt zeichnen wir eine Eule. <br><br>  Code: <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler Überschrift</b> <div class="spoiler_text">  Vektor: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vector</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(x, y, z) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = x; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y = y; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.z = z; }; distanceTo(vector) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sqrt(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x - vector.x, <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y - vector.y, <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.z - vector.z, <span class="hljs-number"><span class="hljs-number">2</span></span>)); } diff(vector) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x - vector.x, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y - vector.y, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.z - vector.z ); } add(vector) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x + vector.x, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y + vector.y, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.z + vector.z ); } }</code> </pre><br>  Joint: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Joint</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(angle, position, length) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle = angle; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.position = position; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length = length; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.targetAngle = angle; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.previousAngle = angle; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.velocity = <span class="hljs-number"><span class="hljs-number">0</span></span>; }; setTargetAngle(targetAngle) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.targetAngle = targetAngle; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.velocity = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.targetAngle - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.normalizeAngle(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle); } normalizeAngle(angle) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (angle &lt;= -<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI) angle += <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI * <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (angle &gt; <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI) angle -= <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI * <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> angle; } getCurrentVelocity() {<span class="hljs-comment"><span class="hljs-comment">//per tick return this.normalizeAngle(this.angle - this.previousAngle); } tick() { this.previousAngle = this.angle; this.angle = this.angle + this.velocity; } }</span></span></code> </pre><br>  Schritt - Datenstruktur zur Steuerung des Fußes: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Step</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>( idlePosition,//vector relative to inner joint angle,//step direction length,//step length height,//step height phaseShift// ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idlePosition = idlePosition; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle = angle;<span class="hljs-comment"><span class="hljs-comment">//radians this.length = length; this.height = height; this.phaseShift = phaseShift; } }</span></span></code> </pre><br>  Bein: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Leg</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>( vehicleCenter, innerJoint, midJoint, outerJoint, step, phaseStep ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vehicleCenter = vehicleCenter; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.innerJoint = innerJoint; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.midJoint = midJoint; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.outerJoint = outerJoint; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.step = step; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.phaseStep = phaseStep; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.innerJoint.length = innerJoint.position.distanceTo(midJoint.position);<span class="hljs-comment"><span class="hljs-comment">//calculate this.midJoint.length = midJoint.position.distanceTo(outerJoint.position);//calculate //this.outerJoint.length = 100; this.joints = [innerJoint, midJoint, outerJoint]; this.preCalculateAngles(); } preCalculateAngles() { this.angles = {}; for (let phase = 0; phase &lt; 360; phase += this.phaseStep) { this.angles[phase] = this.getLegAngles(this.getEsimatedLegPosition(phase, this.step.phaseShift)) } } applyStepHeight(z) { const idleYawRad = Math.atan2(this.step.idlePosition.x, this.step.idlePosition.y); const diffHypot = Math.hypot(this.step.idlePosition.x, this.step.idlePosition.y); const minZ = Math.abs(this.midJoint.length - this.outerJoint.length); const maxZ = (this.midJoint.length + this.outerJoint.length) * 0.6; if (Math.hypot(z, 0) &gt; maxZ) { z = z &gt; 0 ? maxZ : -maxZ; } const safeY = (this.innerJoint.length + this.midJoint.length * 0.5 + this.outerJoint.length * 0.5) * Math.cos(idleYawRad); const vAngle = Math.asin(z / safeY); const y = safeY * Math.cos(vAngle) * Math.cos(idleYawRad); this.step.idlePosition.z = z; this.step.idlePosition.y = this.step.idlePosition.y &gt; 0 ? y : -y; this.preCalculateAngles(); } applyStepAngle(angle) { this.step.angle = angle; this.preCalculateAngles(); } applyPhase(phase/*0-360*/) { const legAngles = this.angles[phase]; this.innerJoint.setTargetAngle(legAngles.yaw); this.midJoint.setTargetAngle(legAngles.midPitch); this.outerJoint.setTargetAngle(legAngles.outerPitch); } getEsimatedLegPosition(phase, phaseShift) { phase = (phase + phaseShift) % 360; const stepX = ((phase &lt; 180 ? phase : 180 - phase % 180) / 180 - 0.5) * this.step.length;//linear movement along step direction const stepZ = Math.max(Math.sin(phase * Math.PI / 180), -0.2) * this.step.height / 1.2; //const stepZ = Math.max((phase &gt; 180 ? Math.cos(phase * Math.PI / 360) + 0.9 : Math.cos((phase - 120) * Math.PI / 360)) * .9 - .1, 0) * this.step.height; const x = this.step.idlePosition.x + stepX * Math.cos(this.step.angle); const y = this.step.idlePosition.y + stepX * Math.sin(this.step.angle); return new Vector(x, y, stepZ); } getLegAngles(esimatedLegPosition) { const yawRad = Math.atan2(esimatedLegPosition.x, esimatedLegPosition.y); const dx = Math.hypot(esimatedLegPosition.x, esimatedLegPosition.y) - this.innerJoint.length; const dz = this.step.idlePosition.z + esimatedLegPosition.z; const hyp = Math.hypot(dx, dz); if (hyp &gt; this.midJoint.length + this.outerJoint.length) {//out of reach hyp = this.midJoint.length + this.outerJoint.length; } const innerAngleRad = Math.acos((this.outerJoint.length * this.outerJoint.length - this.midJoint.length * this.midJoint.length - hyp * hyp) / (-2 * this.midJoint.length * hyp)) + Math.atan2(dz, dx); const outerAngleRad = Math.acos((hyp * hyp - this.midJoint.length * this.midJoint.length - this.outerJoint.length * this.outerJoint.length) / (-2 * this.midJoint.length * this.outerJoint.length)) - Math.PI; if (isNaN(yawRad) || isNaN(innerAngleRad) || isNaN(outerAngleRad)) { console.log(yawRad, innerAngleRad, outerAngleRad); console.log(dx, dz); return; } return { yaw: yawRad, midPitch: innerAngleRad, outerPitch: outerAngleRad }; } getMaxMinAngles() { const angles = [0, 90, 180, 270].map((phase) =&gt; { return this.getLegAngles(getEsimatedLegPosition(phase, 0)); }); return { yawMin: Math.min(angles.map((x) =&gt; { return x.yaw })), yawMax: Math.max(angles.map((x) =&gt; { return x.yaw })), midPitchMin: Math.min(angles.map((x) =&gt; { return x.midPitch })), midPitchMax: Math.max(angles.map((x) =&gt; { return x.midPitch })), outerPitchMin: Math.min(angles.map((x) =&gt; { return x.outerPitch })), outerPitchMax: Math.max(angles.map((x) =&gt; { return x.outerPitch })), } } tick() { this.joints.forEach(function (joint) { joint.tick(); }); } getVectors() { const res = []; const sinYaw = Math.sin(this.innerJoint.angle); const cosYaw = Math.cos(this.innerJoint.angle); let currentVector = this.vehicleCenter; res.push(currentVector); currentVector = currentVector.add(this.innerJoint.position); res.push(currentVector); currentVector = currentVector.add(new Vector( this.innerJoint.length * sinYaw, this.innerJoint.length * cosYaw, 0 )); res.push(currentVector); const dxMid = Math.cos(this.midJoint.angle) * this.midJoint.length; const dzMid = Math.sin(this.midJoint.angle) * this.midJoint.length; currentVector = currentVector.add(new Vector( dxMid * sinYaw, dxMid * cosYaw, dzMid )); res.push(currentVector); const c = this.midJoint.angle + this.outerJoint.angle; const dxOuter = Math.cos(c) * this.outerJoint.length; const dzOuter = Math.sin(c) * this.outerJoint.length; currentVector = currentVector.add(new Vector( dxOuter * sinYaw, dxOuter * cosYaw, dzOuter )); res.push(currentVector); return res; } }</span></span></code> </pre><br>  Roboter: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hexapod</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(phaseStep) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idleHeight = <span class="hljs-number"><span class="hljs-number">-70</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.turnAngle = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength = <span class="hljs-number"><span class="hljs-number">70</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepHeight = <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.debugPoints = []; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> vehicleCenter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.legs = [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Leg( vehicleCenter, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">-70</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">-70</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">-70</span></span>, <span class="hljs-number"><span class="hljs-number">110</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">70</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Step(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">-30</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idleHeight), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepHeight, <span class="hljs-number"><span class="hljs-number">0</span></span>), phaseStep ), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Leg( vehicleCenter, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">-70</span></span>, <span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">-70</span></span>, <span class="hljs-number"><span class="hljs-number">-60</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">-70</span></span>, <span class="hljs-number"><span class="hljs-number">-110</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">70</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Step(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">-30</span></span>, <span class="hljs-number"><span class="hljs-number">-90</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idleHeight), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepHeight, <span class="hljs-number"><span class="hljs-number">180</span></span>), phaseStep ), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Leg( vehicleCenter, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">110</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">70</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Step(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idleHeight), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepHeight, <span class="hljs-number"><span class="hljs-number">180</span></span>), phaseStep ), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Leg( vehicleCenter, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-60</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-110</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">70</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Step(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idleHeight), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepHeight, <span class="hljs-number"><span class="hljs-number">0</span></span>), phaseStep ), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Leg( vehicleCenter, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">110</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">70</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Step(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idleHeight), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepHeight, <span class="hljs-number"><span class="hljs-number">0</span></span>), phaseStep ), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Leg( vehicleCenter, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">-60</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Joint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">-110</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">70</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Step(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">-90</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idleHeight), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepHeight, <span class="hljs-number"><span class="hljs-number">180</span></span>), phaseStep ), ]; } applyPhase(phase<span class="hljs-comment"><span class="hljs-comment">/*0-360*/</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.legs.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">leg</span></span></span><span class="hljs-function">) </span></span>{ leg.applyPhase(phase); }); } changeHeight(value) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.legs.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">leg</span></span></span><span class="hljs-function">) </span></span>{ leg.applyStepHeight(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idleHeight + value); }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } changeStepLength(value) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength += value; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.legs.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">leg</span></span></span><span class="hljs-function">) </span></span>{ leg.step.length = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength; leg.preCalculateAngles(); }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } applyTurn1(centerX, centerY) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> angleToAxis = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan2(centerX, centerY); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> distanceToAxis = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(centerX, centerY); distanceToAxis = <span class="hljs-number"><span class="hljs-number">1000</span></span>/distanceToAxis; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.legs.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">leg</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dx = leg.step.idlePosition.x + leg.innerJoint.position.x + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin(angleToAxis)*distanceToAxis || <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dy = leg.step.idlePosition.y + leg.innerJoint.position.y + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.cos(angleToAxis)*distanceToAxis || <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> angle = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan2(dy,dx); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hypIdle = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(dx, dy); leg.applyStepAngle(angle+<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI/<span class="hljs-number"><span class="hljs-number">2</span></span>); leg.step.length = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength *hypIdle/ ((distanceToAxis || <span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-number"><span class="hljs-number">1000</span></span>); }); } applyTurn(centerX, centerY) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan2(centerX, centerY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle &gt; <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI / <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle -= <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle &lt; -<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI / <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle += <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mults = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.legs.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">leg</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(leg.step.idlePosition.y + leg.innerJoint.position.y, leg.step.idlePosition.x + leg.innerJoint.position.x) / <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(leg.step.idlePosition.y + leg.innerJoint.position.y + centerY*<span class="hljs-number"><span class="hljs-number">.3</span></span>, leg.step.idlePosition.x + leg.innerJoint.position.x + centerX*<span class="hljs-number"><span class="hljs-number">.3</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> minMult = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.min(...mults); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> maxMult = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.max(...mults); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mult = minMult / maxMult; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.max(...this.legs.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">leg</span></span></span><span class="hljs-function"> =&gt;</span></span><span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(leg.step.idlePosition.y + leg.innerJoint.position.y, leg.step.idlePosition.x + leg.innerJoint.position.x))),<span class="hljs-number"><span class="hljs-number">2</span></span>)/<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(centerX,centerY); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan2(centerX,centerY); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.legs.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">leg</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dx = leg.step.idlePosition.x + leg.innerJoint.position.x; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dy = leg.step.idlePosition.y + leg.innerJoint.position.y; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> idleAngle = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan2(dx, dy) + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> turnAngle = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan2(dx + centerX, dy + centerY); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hypIdle = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(dx, dy); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hyp = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(dx + centerX, dy + centerY); leg.applyStepAngle(turnAngle - idleAngle); leg.step.length = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength * hyp / hypIdle * mult; }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.debugPoints = [<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin(a)*-d,<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.cos(a)*-d,<span class="hljs-number"><span class="hljs-number">0</span></span>)]; } tick() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.legs.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">leg</span></span></span><span class="hljs-function">) </span></span>{ leg.tick(); }); } getVectors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.legs.map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">leg</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> leg.getVectors() }); } }</code> </pre><br>  Aber zum Zeichnen benötigen Sie noch ein paar Klassen: <br><br>  Leinwand umwickeln: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Canvas</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(id, label, axisSelectorX, axisSelectorY) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label = label; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvas = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(id); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ctx = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvas.getContext(<span class="hljs-string"><span class="hljs-string">'2d'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.axisSelectorX = axisSelectorX; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.axisSelectorY = axisSelectorY; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvasHeight = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvas.offsetHeight; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvasWidth = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvas.offsetWidth; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.initialY = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvasHeight / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.initialX = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvasWidth / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.traceCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.maxTraces = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.traces = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> axisSize = <span class="hljs-number"><span class="hljs-number">150</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.axisVectors = [ [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(-axisSize, -axisSize, -axisSize), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(-axisSize, -axisSize, axisSize) ], [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(-axisSize, -axisSize, -axisSize), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(-axisSize, axisSize, -axisSize) ], [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(-axisSize, -axisSize, -axisSize), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector(axisSize, -axisSize, -axisSize) ], ] <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mouseOver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mousePos = { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> };<span class="hljs-comment"><span class="hljs-comment">//relative to center this.clickPos = { x: 0, y: 0 };//relative to center this.canvas.addEventListener("mouseenter", function (event) { self.mouseOver = true; }, false); this.canvas.addEventListener("mouseleave", function (event) { self.mouseOver = false; }, false); this.canvas.addEventListener("mousemove", function (event) { if (self.mouseOver) { self.mousePos = { x: event.offsetX - self.initialX, y: event.offsetY - self.initialY }; } }, false); this.canvas.addEventListener("mouseup", function (event) { if (self.mouseOver) { self.clickPos = { x: event.offsetX - self.initialX, y: event.offsetY - self.initialY }; } }, false); }; clear(drawAxis) { this.ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight); this.ctx.strokeStyle = "#000000"; this.ctx.strokeText(this.label, 10, 10); if (drawAxis) { this.axisVectors.forEach(function (vectors, i) { this.ctx.moveTo(this.initialX, this.initialY); this.ctx.beginPath(); vectors.forEach(function (vector) { this.ctx.lineTo(this.initialX + this.axisSelectorX(vector), this.initialY - this.axisSelectorY(vector)); }, this); this.ctx.stroke(); const lastVector = vectors[vectors.length - 1]; this.traces[[this.traceCounter, i]] = lastVector }, this); } } drawVectors(vectors) {/*2d array*/ vectors.forEach(function (vectors, i) { this.ctx.moveTo(this.initialX, this.initialY); this.ctx.beginPath(); vectors.forEach(function (vector) { this.ctx.lineTo(this.initialX + this.axisSelectorX(vector), this.initialY - this.axisSelectorY(vector)); }, this); this.ctx.stroke(); const lastVector = vectors[vectors.length - 1]; this.traces[[this.traceCounter, i]] = lastVector }, this); for (const key in this.traces) { const vector = this.traces[key]; this.ctx.fillStyle = "#FF0000";//red this.ctx.fillRect(this.initialX + this.axisSelectorX(vector), this.initialY - this.axisSelectorY(vector), 1, 1); } this.ctx.strokeStyle = "#000000"; this.ctx.beginPath(); this.ctx.arc(this.clickPos.x + this.initialX, this.clickPos.y + this.initialY, 5, 0, 2 * Math.PI); this.ctx.stroke(); if (this.mouseOver) { this.ctx.strokeStyle = "#00FF00"; this.ctx.beginPath(); this.ctx.arc(this.mousePos.x + this.initialX, this.mousePos.y + this.initialY, 10, 0, 2 * Math.PI); this.ctx.stroke(); } this.traceCounter = (this.traceCounter + 1) % this.maxTraces; } drawPoints(points) { this.ctx.fillStyle = "#00ff00";//green points.forEach(function (point) { this.ctx.fillRect(this.initialX + this.axisSelectorX(point), this.initialY - this.axisSelectorY(point), 3, 3); }, this); } }</span></span></code> </pre><br>  In der Beinklasse gibt es eine Methode zum Abrufen der aktuellen Koordinaten der Gelenke.  Dies sind die Koordinaten, die wir zeichnen werden. <br><br>  Also habe ich auch eine Zeichnung der Punkte hinzugefügt, an denen sich der Fuß in den N letzten Zecken befand. <br><br>  Und schließlich ein Mitarbeiter, der die Simulation ausführt: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(tickTime) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.phaseStep = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tickTime = tickTime; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tan30 = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.tan(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI / <span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> scale = <span class="hljs-number"><span class="hljs-number">0.7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvases = [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(<span class="hljs-string"><span class="hljs-string">'canvasForward'</span></span>, <span class="hljs-string"><span class="hljs-string">'yz Forward'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vy }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vz }), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(<span class="hljs-string"><span class="hljs-string">'canvasSide'</span></span>, <span class="hljs-string"><span class="hljs-string">'xz Side'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vx }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vz }), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(<span class="hljs-string"><span class="hljs-string">'canvasTop'</span></span>, <span class="hljs-string"><span class="hljs-string">'xy Top'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vx }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -vy }), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(<span class="hljs-string"><span class="hljs-string">'canvasIso'</span></span>, <span class="hljs-string"><span class="hljs-string">'xyz Iso'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vx * scale + vy * scale }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vz * scale + vx * tan30 * scale - vy * tan30 * scale }), ]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bot = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hexapod(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.phaseStep); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.phase = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.focus = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'focus'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'focus'</span></span>); self.focus = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'blur'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'blur'</span></span>); self.focus = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.start(); } tick(argument) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> canvasForward = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvases[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bot = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bot; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (canvasForward.mouseOver) { bot.changeHeight(-canvasForward.mousePos.y); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { bot.changeHeight(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> canvasTop = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvases[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (canvasTop.mouseOver) { bot.applyTurn(-canvasTop.mousePos.x, -canvasTop.mousePos.y); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { bot.applyTurn(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.phase = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.phase + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.phaseStep) % <span class="hljs-number"><span class="hljs-number">360</span></span>; bot.applyPhase(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.phase); bot.tick(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> vectors = bot.getVectors(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.canvases.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function">) </span></span>{ c.clear(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); c.drawVectors(vectors); c.drawPoints(bot.debugPoints); }); } start() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stop(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.interval = setInterval((<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.focus) { self.tick(); } } })(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tickTime); } stop() { clearInterval(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.interval); } }</code> </pre><br></div></div><br>  Ergebnis: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ut/rv/2k/utrv2kzjrrigx19ickf04bduuqm.gif"></div><br>  <i>Wirklich schön?</i> <br><br>  Hier können Sie sehen, dass sich die Flugbahn der Beine vom Kreis unterscheidet.  Die vertikale Bewegung ähnelt einer getrimmten Sinuswelle, und die horizontale Bewegung ist linear.  Dies sollte die Belastung der Beine verringern. <br><br>  Nun ein paar Erklärungen, was im Code passiert. <br><br><h4>  Wie bringt man einem Roboter das Drehen bei? </h4><br>  Um mich umzudrehen, habe ich mir 2 Situationen angesehen: <br><br>  Wenn der Roboter steht, bewegen sich die Beine im Kreis. <br><br>  Das einzige ist, dass die Bewegung um den Umfang den Code mit der aktuellen Implementierung erheblich komplizieren würde.  Daher bewegen sich die Beine tangential zum Kreis. <br><br>  Wenn sich der Roboter bewegt, müssen Sie so etwas wie eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ackermann-Lenkgeometrie</a> mit einem Differential implementieren. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d72/b14/527/d72b145276aa480e90b63522bb1a40e0.png" alt="Bild"><br><br>  Das heißt, die Schrittlänge der Beine, die sich entlang eines kleineren Radius bewegen, ist geringer.  Und der Drehwinkel ist größer. <br><br>  Um eine Änderung des Drehwinkels für jedes Bein zu implementieren, habe ich den folgenden Algorithmus entwickelt: <br><br>  <b>1.</b> Wir betrachten den Winkel von der Ausgangsposition des Beins zur Mitte des Roboters: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> idleAngle = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan2(dx, dy) + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepAngle;</code> </pre> <br>  <b>2.</b> Wir betrachten den Winkel von der Anfangsposition des Beins bis (die Mitte des Roboters + der Versatz, der für die Drehung verantwortlich ist, ist ein variabler Parameter): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> turnAngle = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.atan2(dx + centerX, dy + centerY);</code> </pre> <br>  <b>3.</b> Drehen Sie den Schritt auf die Differenz dieser Winkel: <br><br><pre> <code class="javascript hljs">leg.applyStepAngle(turnAngle - idleAngle);</code> </pre> <br>  Aber das ist noch nicht alles.  Die Schrittlänge muss noch geändert werden.  Die Erkenntnis in der Stirn - die Schrittlänge durch Ändern des Abstands zur Mitte zu multiplizieren - hatte einen fatalen Fehler - die äußeren Beine gingen zu weit und begannen sich gegenseitig zu verletzen. <br><br>  Daher musste ich die Implementierung komplizieren: <br><br>  <b>1.</b> Wir betrachten die Änderung des Abstands zur Mitte für jedes Bein: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mults = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.legs.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">leg</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(leg.step.idlePosition.y + leg.innerJoint.position.y, leg.step.idlePosition.x + leg.innerJoint.position.x) / <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(leg.step.idlePosition.y + leg.innerJoint.position.y + centerY*<span class="hljs-number"><span class="hljs-number">.3</span></span>, leg.step.idlePosition.x + leg.innerJoint.position.x + centerX*<span class="hljs-number"><span class="hljs-number">.3</span></span>));</code> </pre> <br>  0,3 - magische Zahl <br><br>  <b>2.</b> Finden Sie die Beziehung zwischen der minimalen und der maximalen Änderung <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> minMult = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.min(...mults); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> maxMult = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.max(...mults); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mult = minMult / maxMult;</code> </pre> <br>  Dieser Faktor spiegelt die Differenz zwischen den minimalen und maximalen Änderungen im Abstand zum Zentrum wider.  Sie ist immer kleiner als 1, und wenn Sie die Schrittlänge damit multiplizieren, erhöht sie sich beim Drehen nicht, selbst bei Beinen, die außerhalb der Drehrichtung liegen. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hypIdle = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(dx, dy); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hyp = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.hypot(dx + centerX, dy + centerY); leg.step.length = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stepLength * hyp / hypIdle * mult;</code> </pre><br>  So funktioniert es (gif 2 Megabyte): <br><br><div class="spoiler">  <b class="spoiler_title">gif 2 Megabyte</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pg/qt/ja/pgqtjaz9vvzddchtveho6hc1x1o.gif"><br></div></div><br>  → Hier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">können</a> Sie mit dem Ergebnis spielen <br><br>  Für einen genaueren Blick empfehle ich, den Inhalt in einer HTML-Datei zu speichern und in Ihrem bevorzugten Texteditor fortzufahren. <br><br>  Im nächsten Beitrag werde ich Ihnen erzählen, wie ich das alles dazu gebracht habe, in Space Engineers zu arbeiten. <br>  Spoiler: In Programmable Block können Sie in C # fast die neueste Version schreiben. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de426195/">https://habr.com/ru/post/de426195/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de426175/index.html">So sichern Sie den SQL-Failovercluster korrekt</a></li>
<li><a href="../de426179/index.html">Frühstücken Sie selbst, teilen Sie Ihre Arbeit mit der "Wolke"</a></li>
<li><a href="../de426183/index.html">Skillbox Friday Webinare: Freiberuflich und Programmierung</a></li>
<li><a href="../de426191/index.html">Freitag. Bullshit Programmer 2.0</a></li>
<li><a href="../de426193/index.html">Gemeinsamer Online-Hackathon von OpenGift und Philtech Initiative</a></li>
<li><a href="../de426197/index.html">Unwissenheit über die Grundlagen von React, die Sie möglicherweise zerstören</a></li>
<li><a href="../de426201/index.html">Sub-Zero: Antiker mechanischer Taschenrechner. Wie man es benutzt (mit Grüßen aus dem 18. Jahrhundert)</a></li>
<li><a href="../de426203/index.html">Design für Front-End-Entwickler, Teil 1</a></li>
<li><a href="../de426205/index.html">Mit der Veröffentlichung von Chrome werden 70.000 Websites, die durch Symantec-Zertifikate geschützt sind, nicht mehr vertrauenswürdig</a></li>
<li><a href="../de426207/index.html">Es wird bald kalt: Lernen Sie Pekatherm kennen und wählen Sie beheizte Handschuhe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>