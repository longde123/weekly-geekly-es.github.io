<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÜüèΩ üíÜüèæ üë®üèæ‚Äçüíª SNA Hackathon 2019 ü•ä ‚õπüèæ üìè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De fevereiro a mar√ßo de 2019, foi realizada uma competi√ß√£o para classificar o feed da rede social SNA Hackathon 2019 , no qual nossa equipe ficou em p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SNA Hackathon 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447376/"><p>  De fevereiro a mar√ßo de 2019, foi realizada uma competi√ß√£o para classificar o feed da rede social <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SNA Hackathon 2019</a> , no qual nossa equipe ficou em primeiro lugar.  Neste artigo, falarei sobre a organiza√ß√£o do concurso, os m√©todos que tentamos e as configura√ß√µes do catboost para treinamento em big data. </p><br><p><img src="https://habrastorage.org/webt/8b/bd/vv/8bbdvvg9ih5_0h5tdqmx4fho3io.jpeg"></p><a name="habracut"></a><br><p>  <strong>SNA Hackathon</strong> </p><br><p>  A hackathon com esse nome √© realizada pela terceira vez.  Ele √© organizado pela rede social ok.ru, respectivamente, a tarefa e os dados est√£o diretamente relacionados a essa rede social. <br>  O SNA (an√°lise de redes sociais), nesse caso, √© melhor entendido n√£o como uma an√°lise de um gr√°fico social, mas como uma an√°lise de uma rede social. </p><br><ul><li>  Em 2014, a tarefa era prever o n√∫mero de curtidas que o post obteria. </li><li>  Em 2016, o objetivo da VVZ (talvez voc√™ esteja familiarizado), mais pr√≥ximo da an√°lise do gr√°fico social. </li><li>  Em 2019 - classifica√ß√£o do feed de um usu√°rio pela probabilidade de o usu√°rio gostar da postagem. </li></ul><br><p>  N√£o posso dizer sobre 2014, mas em 2016 e 2019, al√©m da capacidade de analisar dados, tamb√©m foram necess√°rias habilidades no trabalho com big data.  Penso que foi a combina√ß√£o de tarefas de aprendizado de m√°quina e processamento de big data que me atraiu para esses concursos, e a experi√™ncia nessas √°reas ajudou a vencer. </p><br><p>  <strong>mlbootcamp</strong> </p><br><p>  Em 2019, o concurso foi organizado na plataforma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://mlbootcamp.ru</a> . </p><br><p>  A competi√ß√£o come√ßou on-line em 7 de fevereiro e consistia em 3 tarefas.  Todos podem se registrar no site, baixar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">linha de base</a> e carregar o carro por v√°rias horas.  No final do est√°gio online, em 15 de mar√ßo, os 15 principais de cada show foram convidados para o escrit√≥rio Mail.ru, para o est√°gio offline, que ocorreu de 30 de mar√ßo a 1 de abril. </p><br><h1 id="zadacha">  Desafio </h1><br><p>  Os dados de origem fornecem identificadores de usu√°rio (userId) e identificadores de postagem (objectId).  Se foi mostrada uma postagem ao usu√°rio, os dados conter√£o uma linha contendo userId, objectId, rea√ß√µes do usu√°rio a essa postagem (feedback) e um conjunto de v√°rios sinais ou links para figuras e textos. </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th>  ownerId </th><th>  feedback </th><th>  imagens </th></tr></thead><tbody><tr><td>  3555 </td><td>  22 </td><td>  5677 </td><td>  [gostei, clicou] </td><td>  [hash1] </td></tr><tr><td>  12842 </td><td>  55 </td><td>  32144 </td><td>  [n√£o gostei] </td><td>  [hash2, hash3] </td></tr><tr><td>  13145 </td><td>  35 </td><td>  5677 </td><td>  [clicado, compartilhado novamente] </td><td>  [hash2] </td></tr></tbody></table><br><p>  O conjunto de dados de teste cont√©m uma estrutura semelhante, mas o campo de feedback est√° ausente.  O objetivo √© prever a presen√ßa de uma rea√ß√£o 'curtida' no campo de feedback. <br>  O arquivo de envio possui a seguinte estrutura: </p><br><table><thead><tr><th>  userId </th><th>  SortedList [objectId] </th></tr></thead><tbody><tr><td>  123 </td><td>  78.13.54.22 </td></tr><tr><td>  128 </td><td>  35.61.55 </td></tr><tr><td>  131 </td><td>  35,68,129,11 </td></tr></tbody></table><br><p>  M√©trica - AUC m√©dia do ROC por usu√°rios. </p><br><p>  Uma descri√ß√£o mais detalhada dos dados pode ser encontrada no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site da perfei√ß√£o</a> .  Voc√™ tamb√©m pode fazer o download dos dados, incluindo testes e imagens. </p><br><p>  <strong>Est√°gio online</strong> </p><br><p>  No est√°gio online, a tarefa foi dividida em 3 partes </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sistema colaborativo</a> - inclui todos os sinais, exceto imagens e textos; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Imagens</a> - inclui apenas informa√ß√µes sobre imagens; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Textos</a> - inclui informa√ß√µes apenas sobre textos. </li></ul><br><p>  <strong>Est√°gio offline</strong> </p><br><p>  No est√°gio offline, os dados inclu√≠am todos os atributos, enquanto os textos e imagens eram escassos.  Havia 1,5 vezes mais linhas no conjunto de dados, das quais j√° havia muitas. </p><br><h1 id="reshenie-zadachi">  Resolu√ß√£o de problemas </h1><br><p>  Como estou trabalhando no curr√≠culo, comecei minha jornada nesta competi√ß√£o com a tarefa "Imagens".  Os dados fornecidos s√£o userId, objectId, ownerId (o grupo em que a postagem √© publicada), carimbos de data e hora de cria√ß√£o e exibi√ß√£o da postagem e, √© claro, a imagem dessa postagem. <br>  Depois de gerar v√°rios recursos com base no registro de data e hora, a pr√≥xima id√©ia foi pegar a pen√∫ltima camada de um neur√¥nio pr√©-treinado em imagenet e enviar essas incorpora√ß√µes para aumentar. </p><br><p><img src="https://habrastorage.org/webt/g6/pq/id/g6pqidmcs0hqgilcqvmii7qdzz0.png"></p><br><p>  Os resultados n√£o foram impressionantes.  Casamentos do neur√¥nio imagenet s√£o irrelevantes, pensei, preciso arquivar meu codificador autom√°tico. </p><br><p><img src="https://habrastorage.org/webt/8b/n_/pu/8bn_pui29109tsvwsf_s5sktlgq.png"></p><br><p>  Demorou muito tempo e o resultado n√£o melhorou. </p><br><p>  <strong>Gera√ß√£o de recursos</strong> </p><br><p>  Trabalhar com imagens leva muito tempo e decidi fazer algo mais simples. <br>  Como voc√™ pode ver imediatamente, existem v√°rios sinais categ√≥ricos no conjunto de dados e, para n√£o incomodar muito, eu apenas peguei o catboost.  A solu√ß√£o foi excelente, sem configura√ß√µes, cheguei imediatamente √† primeira linha da tabela de classifica√ß√£o. </p><br><p>  H√° muitos dados, e eles s√£o dispostos em formato de parquet; portanto, sem pensar duas vezes, peguei o scala e comecei a escrever tudo com fagulha. </p><br><p>  Os recursos mais simples, que deram mais crescimento do que as imagens incorporadas: </p><br><ul><li>  quantas vezes objectId, userId e ownerId se encontraram nos dados (devem se correlacionar com a popularidade); </li><li>  quantas postagens de userId o ownerId viu (deve se correlacionar com o interesse do usu√°rio no grupo); </li><li>  quantas postagens assistidas por userId exclusivas por ownerId (refletem o tamanho do p√∫blico do grupo). </li></ul><br><p>  A partir dos registros de data e hora, era poss√≠vel obter a hora do dia em que o usu√°rio assistia √† fita (manh√£ / dia / tarde / noite).  Ao combinar essas categorias, voc√™ pode continuar a gerar recursos: </p><br><ul><li>  quantas vezes o userId efetuou login √† noite; </li><li>  a que horas essa postagem geralmente √© exibida (objectId) e assim por diante. </li></ul><br><p>  Tudo isso melhorou gradualmente a m√©trica.  Mas o tamanho do conjunto de dados de treinamento √© de cerca de 20 milh√µes de registros, portanto, a adi√ß√£o de recursos desacelerou bastante o aprendizado. </p><br><p>  Redefini a abordagem de uso de dados.  Embora os dados dependam do tempo, n√£o vi nenhum vazamento expl√≠cito de informa√ß√µes no futuro; no entanto, por precau√ß√£o, eu os quebrei da seguinte maneira: </p><br><p><img src="https://habrastorage.org/webt/jf/zr/gq/jfzrgq7s0l3q465pa-cc0x-rkxq.png"></p><br><p>  O conjunto de treinamento fornecido a n√≥s (fevereiro e 2 semanas de mar√ßo) foi dividido em 2 partes. <br>  Nos dados dos √∫ltimos N dias, ele treinou o modelo.  As agrega√ß√µes descritas acima foram constru√≠das em todos os dados, incluindo o teste.  Ao mesmo tempo, surgiram dados nos quais v√°rios codificadores da vari√°vel de destino podem ser constru√≠dos.  A abordagem mais simples √© reutilizar o c√≥digo que j√° est√° criando novos recursos e simplesmente fornecer dados que n√£o ser√£o treinados e segmentar = 1. </p><br><p>  Assim, temos recursos semelhantes: </p><br><ul><li>  Quantas vezes o userId viu uma postagem no grupo ownerId; </li><li>  Quantas vezes userId gostou da postagem em ownerId; </li><li>  A porcentagem de postagens que userId gostou de ownerId. </li></ul><br><p>  Ou seja, resultou na <em>codifica√ß√£o de destino m√©dio</em> por parte do conjunto de dados de acordo com v√°rias combina√ß√µes de recursos categ√≥ricos.  Em princ√≠pio, o catboost tamb√©m cria codifica√ß√£o de destino e, desse ponto de vista, n√£o h√° benef√≠cio, mas, por exemplo, tornou-se poss√≠vel contar o n√∫mero de usu√°rios √∫nicos que gostam de postagens neste grupo.  Ao mesmo tempo, o principal objetivo foi alcan√ßado - meu conjunto de dados diminuiu v√°rias vezes e foi poss√≠vel continuar gerando recursos. </p><br><p>  Enquanto o catboost s√≥ pode criar codificadores de acordo com a rea√ß√£o desejada, o feedback tem outras rea√ß√µes: compartilhadas de novo, n√£o curtidas, n√£o curtidas, clicadas, ignoradas, o que pode ser feito manualmente.  Contei todos os tipos de agregados e selecionei os recursos com pouca import√¢ncia, para n√£o aumentar o conjunto de dados. </p><br><p>  Naquela √©poca, eu estava em primeiro lugar por uma ampla margem.  O √∫nico constrangimento foi o fato de a incorpora√ß√£o das imagens quase n√£o ter ganho.  A id√©ia veio para dar tudo para aumentar o poder.  Agrupe imagens do Kmeans e obtenha um novo recurso categ√≥rico imageCat. </p><br><p>  Aqui est√£o algumas classes depois de filtrar e mesclar manualmente os clusters obtidos do KMeans. </p><br><p><img src="https://habrastorage.org/webt/i3/s5/m2/i3s5m2ftpdmvr0m_0dvpau4eggs.png"></p><br><p>  Com base no imageCat, geramos: </p><br><ul><li>  Novos recursos categ√≥ricos: <br><ul><li>  Que imageCat mais parecia userId; </li><li>  Qual imageCat √© mostrado com mais frequ√™ncia pelo ownerId; </li><li>  Qual imageCat gostou mais do userId; </li></ul></li><li>  V√°rios contadores: <br><ul><li>  Quantos imageCat √∫nicos pareciam userId; </li><li>  Cerca de 15 recursos semelhantes, al√©m da codifica√ß√£o de destino, conforme descrito acima. </li></ul></li></ul><br><p>  <strong>Textos</strong> </p><br><p>  Os resultados do concurso de imagens combinaram comigo e eu decidi me experimentar nos textos.  Anteriormente, n√£o trabalhava muito com textos e, por estupidez, matei um dia no tf-idf e no svd.  Ent√£o vi uma linha de base com o doc2vec, que faz exatamente o que eu preciso.  Depois de ajustar ligeiramente os par√¢metros do doc2vec, recebi inser√ß√µes de texto. </p><br><p>  E, em seguida, ele simplesmente reutilizou o c√≥digo das imagens, no qual substituiu os incorporados de imagem por incorporados de texto.  Como resultado, cheguei ao 2¬∫ lugar no concurso de texto. </p><br><p>  <strong>Sistema colaborativo</strong> </p><br><p>  Havia apenas uma competi√ß√£o na qual eu ainda n√£o tinha "cutucado o bast√£o", mas, a julgar pela AUC na tabela de l√≠deres, os resultados dessa competi√ß√£o em particular deveriam ter tido o maior impacto no est√°gio off-line. <br>  Peguei todos os sinais que estavam nos dados de origem, selecionei os categ√≥ricos e calculei os mesmos agregados das imagens, exceto os recursos das pr√≥prias imagens.  Apenas colocando no catboost, cheguei ao 2¬∫ lugar. </p><br><h1 id="pervye-shagi-optimizacii-catboost">  Os primeiros passos para otimizar o catboost </h1><br><p>  Um primeiro e dois segundos lugares me agradaram, mas havia um entendimento de que eu n√£o fiz nada de especial, o que significa que podemos esperar uma perda de posi√ß√£o. </p><br><p>  A tarefa da competi√ß√£o √© classificar as postagens na estrutura do usu√°rio e, durante todo esse tempo, resolvi o problema de classifica√ß√£o, ou seja, otimizei a m√©trica errada. </p><br><p>  Vou dar um exemplo simples: </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th>  predi√ß√£o </th><th>  verdade fundamental </th></tr></thead><tbody><tr><td>  1 </td><td>  10 </td><td>  0,9 </td><td>  1 </td></tr><tr><td>  1 </td><td>  11 </td><td>  0,8 </td><td>  1 </td></tr><tr><td>  1 </td><td>  12 </td><td>  0,7 </td><td>  1 </td></tr><tr><td>  1 </td><td>  13 </td><td>  0,6 </td><td>  1 </td></tr><tr><td>  1 </td><td>  14 </td><td>  0,5 </td><td>  0 0 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0,4 </td><td>  0 0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0,3 </td><td>  1 </td></tr></tbody></table><br><p>  Fazemos uma pequena permuta√ß√£o </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th>  predi√ß√£o </th><th>  verdade fundamental </th></tr></thead><tbody><tr><td>  1 </td><td>  10 </td><td>  0,9 </td><td>  1 </td></tr><tr><td>  1 </td><td>  11 </td><td>  0,8 </td><td>  1 </td></tr><tr><td>  1 </td><td>  12 </td><td>  0,7 </td><td>  1 </td></tr><tr><td>  1 </td><td>  13 </td><td>  0,6 </td><td>  0 0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0,5 </td><td>  1 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0,4 </td><td>  0 0 </td></tr><tr><td>  1 </td><td>  14 </td><td>  0,3 </td><td>  1 </td></tr></tbody></table><br><p>  Obtemos os seguintes resultados: </p><br><table><thead><tr><th>  Modelo </th><th>  Auc </th><th>  AUC do usu√°rio1 </th><th>  AUC do usu√°rio2 </th><th>  AUC m√©dia </th></tr></thead><tbody><tr><td>  Op√ß√£o 1 </td><td>  0,8 </td><td>  1,0 </td><td>  0,0 </td><td>  0,5 </td></tr><tr><td>  Op√ß√£o 2 </td><td>  0,7 </td><td>  0,75 </td><td>  1,0 </td><td>  0.875 </td></tr></tbody></table><br><p>  Como voc√™ pode ver, melhorar a m√©trica geral da AUC n√£o significa melhorar a m√©trica m√©dia da AUC dentro do usu√°rio. </p><br><p>  O Catboost <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pode otimizar as m√©tricas de classifica√ß√£o</a> imediatamente.  Eu li sobre m√©tricas de classifica√ß√£o, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hist√≥rias de sucesso</a> ao usar o catboost e defino o YetiRankPairwise para estudar durante a noite.  O resultado n√£o foi impressionante.  Tendo decidido que n√£o havia aprendido bem, alterei a fun√ß√£o de erro para QueryRMSE, que, a julgar pela documenta√ß√£o do catboost, converge mais rapidamente.  Como resultado, obtive os mesmos resultados que durante o treinamento para classifica√ß√£o, mas os conjuntos desses dois modelos deram um bom aumento, o que me levou aos primeiros lugares nas tr√™s competi√ß√µes. </p><br><p>  5 minutos antes do encerramento da etapa on-line na competi√ß√£o Collaborative Systems, Sergey Shalnov me levou para o segundo lugar.  A maneira como fomos juntos. </p><br><h1 id="podgotovka-k-oflayn-etapu">  Preparando para a fase offline </h1><br><p>  A vit√≥ria no est√°gio on-line nos foi garantida na placa de v√≠deo RTX 2080 TI, mas o pr√™mio principal de 300.000 rublos e, antes, o primeiro lugar final nos for√ßaram a trabalhar nessas duas semanas. </p><br><p>  Como se viu, Sergey tamb√©m usou o catboost.  Trocamos id√©ias e recursos, e eu descobri o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio de Anna Veronika Dorogush,</a> no qual havia respostas para muitas de minhas perguntas e at√© para aquelas que ainda n√£o havia aparecido. </p><br><p>  A visualiza√ß√£o do relat√≥rio levou-me √† id√©ia de que √© necess√°rio retornar todos os par√¢metros ao valor padr√£o e ajustar as configura√ß√µes com muito cuidado e somente depois de corrigir um conjunto de sinais.  Agora, um treinamento levou cerca de 15 horas, mas um modelo conseguiu melhorar a velocidade do que no ensemble de classifica√ß√£o. </p><br><p>  <strong>Gera√ß√£o de recursos</strong> </p><br><p>  Na competi√ß√£o "Sistemas colaborativos", um grande n√∫mero de recursos √© avaliado como importante para o modelo.  Por exemplo, <em>auditweights_spark_svd</em> √© o atributo mais importante e n√£o h√° informa√ß√µes sobre o que isso significa.  Eu pensei que valia a pena contar as v√°rias unidades com base em sinais importantes.  Por exemplo, a m√©dia auditweights_spark_svd por usu√°rio, por grupo, por objeto.  O mesmo pode ser calculado a partir de dados nos quais o treinamento n√£o √© realizado e o destino = 1, ou seja, a m√©dia <em>auditweights_spark_svd</em> por usu√°rio para os objetos que ele gostou.  <em>Havia</em> v√°rios sinais importantes, al√©m de <em>auditweights_spark_svd</em> .  Aqui est√£o alguns deles: </p><br><ul><li>  <em>auditweightsCtrGender</em> </li><li>  <em>auditweightsCtrHigh</em> </li><li>  <em>userOwnerCounterCreateLikes</em> </li></ul><br><p>  Por exemplo, o valor m√©dio de <em>auditweightsCtrGender</em> por userId acabou por ser um recurso importante, bem como o valor m√©dio de <em>userOwnerCounterCreateLikes</em> por userId + ownerId.  Isso deveria ter nos levado a pensar em como entender o significado dos campos. </p><br><p>  Outros recursos importantes foram <em>auditweightsLikesCount</em> e <em>auditweightsShowsCount</em> .  Dividindo um no outro, foi obtida uma caracter√≠stica ainda mais importante. </p><br><p>  <strong>Vazamentos de dados</strong> </p><br><p>  Modelos de competi√ß√£o e produ√ß√£o s√£o tarefas muito diferentes.  Ao preparar os dados, √© muito dif√≠cil levar em considera√ß√£o todos os detalhes e n√£o transferir algumas informa√ß√µes n√£o triviais sobre a vari√°vel de destino no teste.  Se criarmos uma solu√ß√£o de produ√ß√£o, tentaremos evitar o uso de vazamentos de dados ao treinar o modelo.  Mas se queremos vencer o concurso, os vazamentos de dados s√£o os melhores recursos. </p><br><p>  Ap√≥s examinar os dados, voc√™ pode ver que, de acordo com objectId, os valores de <em>auditweightsLikesCount</em> e <em>auditweightsShowsCount</em> mudam, o que significa que a propor√ß√£o dos valores m√°ximos desses sinais refletir√° a p√≥s-convers√£o muito melhor que a propor√ß√£o no momento da entrega. </p><br><p>  O primeiro vazamento encontrado foi <em>auditweightsLikesCountMax / auditweightsShowsCountMax</em> . <br>  Mas e se voc√™ olhar os dados com mais aten√ß√£o?  Classifique por data de entrega e obtenha: </p><br><table><thead><tr><th>  objectId </th><th>  userId </th><th>  auditweightsShowsCount </th><th>  auditweightsLikesCount </th><th>  alvo (gostou) </th></tr></thead><tbody><tr><td>  1 </td><td>  1 </td><td>  12 </td><td>  3 </td><td>  provavelmente n√£o </td></tr><tr><td>  1 </td><td>  2 </td><td>  15 </td><td>  3 </td><td>  provavelmente sim </td></tr><tr><td>  1 </td><td>  3 </td><td>  16 </td><td>  4 </td><td></td></tr></tbody></table><br><p>  Foi surpreendente quando encontrei o primeiro exemplo desse tipo e verificamos que minha previs√£o n√£o se tornou realidade.  Mas, como os valores m√°ximos desses sinais na estrutura do objeto aumentaram, n√£o fomos pregui√ßosos e decidimos encontrar <em>auditweightsShowsCountNext</em> e <em>auditweightsLikesCountNext</em> , ou seja, valores no pr√≥ximo momento.  Adicionando recurso <br>  <em>(auditweightsShowsCountNext-auditweightsShowsCount) / (auditweightsLikesCount-auditweightsLikesCountNext)</em> fizemos um salto acentuado o tempo todo. <br>  Vazamentos semelhantes poderiam ser usados ‚Äã‚Äãse os seguintes valores fossem encontrados para <em>userOwnerCounterCreateLikes</em> dentro de userId + ownerId e, por exemplo, <em>auditweightsCtrGender</em> dentro de objectId + userGender.  Encontramos 6 campos semelhantes com vazamentos e extra√≠mos informa√ß√µes deles o m√°ximo poss√≠vel. </p><br><p>  Naquela √©poca, extra√≠mos o m√°ximo de informa√ß√µes de atributos colaborativos, mas n√£o retornamos a concursos de imagens e textos.  Houve uma √≥tima id√©ia para verificar: quanto os recursos d√£o diretamente nas imagens ou textos nas competi√ß√µes correspondentes? </p><br><p>  N√£o houve vazamentos nas competi√ß√µes de imagens e textos, mas naquela √©poca eu havia retornado os par√¢metros padr√£o do catboost, penteei o c√≥digo e adicionei alguns recursos.  Resultado total: </p><br><table><thead><tr><th>  Solu√ß√£o </th><th>  velocidade </th></tr></thead><tbody><tr><td>  M√°ximo com imagens </td><td>  0,6411 </td></tr><tr><td>  M√°ximo sem imagens </td><td>  0,6297 </td></tr><tr><td>  Resultado do segundo lugar </td><td>  0,6295 </td></tr></tbody></table><br><table><thead><tr><th>  Solu√ß√£o </th><th>  velocidade </th></tr></thead><tbody><tr><td>  M√°ximo com textos </td><td>  0,666 </td></tr><tr><td>  M√°ximo sem textos </td><td>  0,660 </td></tr><tr><td>  Resultado do segundo lugar </td><td>  0,656 </td></tr></tbody></table><br><table><thead><tr><th>  Solu√ß√£o </th><th>  velocidade </th></tr></thead><tbody><tr><td>  M√°ximo em colabora√ß√£o </td><td>  0,745 </td></tr><tr><td>  Resultado do segundo lugar </td><td>  0,723 </td></tr></tbody></table><br><p>  Tornou-se √≥bvio que era improv√°vel que muitos textos e imagens fossem extra√≠dos e, depois de tentar algumas das id√©ias mais interessantes, paramos de trabalhar com eles. </p><br><p>  A gera√ß√£o adicional de recursos em sistemas colaborativos n√£o deu crescimento e come√ßamos a classificar.  No est√°gio on-line, o conjunto de classifica√ß√£o e classifica√ß√£o me deu um pequeno aumento, como se viu porque eu tinha uma classifica√ß√£o insuficiente.  Nenhuma das fun√ß√µes de erro, incluindo o YetiRanlPairwise, forneceu resultados pr√≥ximos do LogLoss (0,745 contra 0,725).  Havia esperan√ßa de um QueryCrossEntropy que n√£o pudesse ser iniciado. </p><br><h1 id="oflayn-etap">  Est√°gio offline </h1><br><p>  No est√°gio offline, a estrutura de dados permaneceu a mesma, mas houve pequenas altera√ß√µes: </p><br><ul><li>  identificadores userId, objectId, ownerId foram re-randomizados; </li><li>  v√°rios sinais foram removidos e v√°rios foram renomeados; </li><li>  os dados se tornaram cerca de 1,5 vezes mais. </li></ul><br><p>  Al√©m das dificuldades listadas, havia uma grande vantagem: um servidor grande com RTX 2080TI foi alocado para a equipe.  Eu gostei do htop por um longo tempo. <br><img src="https://habrastorage.org/webt/0c/6n/zp/0c6nzpburmw8nxsxz9y8iwkxmwa.jpeg"></p><br><p>  A id√©ia era √∫nica - apenas reproduzir o que j√° est√° l√°.  Depois de passar algumas horas configurando o ambiente no servidor, gradualmente come√ßamos a verificar se os resultados estavam sendo reproduzidos.  O principal problema que estamos enfrentando √© o aumento no volume de dados.  Decidimos reduzir um pouco a carga e definir o par√¢metro catboost ctr_complexity = 1.  Isso diminui um pouco a velocidade, mas meu modelo come√ßou a funcionar, o resultado foi bom - 0,733.  Sergei, diferentemente de mim, n√£o dividiu os dados em duas partes e treinou em todos os dados, embora isso tenha proporcionado o melhor resultado no est√°gio on-line, houve muitas dificuldades no est√°gio off-line.  Se pegarmos todos os recursos que geramos e tentarmos coloc√°-lo no catboost "na testa", nada aconteceria no est√°gio online.  Sergey fez otimiza√ß√£o de tipo, por exemplo, convertendo tipos float64 em float32.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Neste artigo,</a> voc√™ pode encontrar informa√ß√µes sobre como otimizar a mem√≥ria nos pandas.  Como resultado, Sergey treinou na CPU todos os dados e resultou em cerca de 0,735. </p><br><p>  Esses resultados foram suficientes para vencer, mas escondemos nossa velocidade real e n√£o pod√≠amos ter certeza de que outras equipes n√£o estavam fazendo o mesmo. </p><br><h1 id="bitva-do-poslednego">  Batalha at√© o √∫ltimo </h1><br><p>  <strong>Catboost de ajuste</strong> </p><br><p>  Nossa solu√ß√£o foi totalmente reproduzida, adicionamos recursos de dados de texto e imagens, ent√£o tudo o que restava era ajustar os par√¢metros do catboost.  Sergey estudou na CPU com um pequeno n√∫mero de itera√ß√µes e eu estudei com ctr_complexity = 1.  Restava apenas um dia e, se voc√™ apenas adicionar itera√ß√µes ou aumentar o ctr_complexity, de manh√£, poder√° obter uma velocidade ainda melhor e caminhar o dia todo. </p><br><p>  No est√°gio offline, as pontua√ß√µes podem ser muito f√°ceis de ocultar, simplesmente escolhendo a melhor solu√ß√£o no site.  Esper√°vamos mudan√ßas bruscas na tabela de classifica√ß√£o nos √∫ltimos minutos antes do fechamento das inscri√ß√µes e decidimos n√£o parar. </p><br><p>  No v√≠deo de Anna, aprendi que, para melhorar a qualidade do modelo, √© melhor selecionar os seguintes par√¢metros: </p><br><ul><li>  <em>learning_rate</em> - O valor padr√£o √© calculado com base no tamanho do conjunto de dados.  Com uma diminui√ß√£o na taxa de aprendizado, para manter a qualidade, √© necess√°rio aumentar o n√∫mero de itera√ß√µes. </li><li>  <em>l2_leaf_reg</em> - Coeficiente de regulariza√ß√£o, valor padr√£o de 3, de prefer√™ncia de 2 a 30. Uma diminui√ß√£o no valor leva a um aumento no excesso de ajuste. </li><li>  <em>bagging_temperature</em> - Adiciona randomiza√ß√£o aos pesos dos objetos na sele√ß√£o.  O valor padr√£o √© 1, no qual os pesos s√£o selecionados na distribui√ß√£o exponencial.  Uma diminui√ß√£o no valor leva a um aumento no excesso de ajuste. </li><li>  <em>random_strength</em> - afeta a escolha de divis√µes para uma itera√ß√£o espec√≠fica.  Quanto maior a for√ßa aleat√≥ria, maior a chance de uma divis√£o de baixa import√¢ncia ser selecionada.  A cada itera√ß√£o subsequente, a aleatoriedade diminui.  Uma diminui√ß√£o no valor leva a um aumento no excesso de ajuste. </li></ul><br><p>  Outros par√¢metros afetam significativamente menos o resultado final, ent√£o n√£o tentei selecion√°-los.  Uma itera√ß√£o de treinamento no meu conjunto de dados da GPU com ctr_complexity = 1 levou 20 minutos e os par√¢metros selecionados no conjunto de dados reduzido foram ligeiramente diferentes dos ideais no conjunto de dados completo.  Como resultado, fiz cerca de 30 itera√ß√µes em 10% dos dados e depois mais 10 itera√ß√µes em todos os dados.  Aconteceu aproximadamente o seguinte: </p><br><ul><li>  Aumentei o <em>learning_rate</em> em 40% do padr√£o; </li><li>  <em>l2_leaf_reg</em> deixou o mesmo; </li><li>  <em>bagging_temperature</em> e <em>random_strength</em> reduzidos para 0.8. </li></ul><br><p>  Podemos concluir que, com par√¢metros padr√£o, o modelo √© sub-treinado. </p><br><p>    ,     : </p><br><table><thead><tr><th>  Modelo </th><th>  1 </th><th>  2 </th><th>  3 </th><th>  </th></tr></thead><tbody><tr><td>   </td><td> 0.7403 </td><td> 0.7404 </td><td> 0.7404 </td><td> 0.7407 </td></tr><tr><td>   </td><td> 0.7406 </td><td> 0.7405 </td><td> 0.7406 </td><td> 0.7408 </td></tr></tbody></table><br><p>     ,       ,           . </p><br><p>          GPU.    ‚Äî    ,      : </p><br><ul><li>      ( ),       ; </li><li>      ; </li><li>  userId,      ; </li><li>   userId,    . </li></ul><br><p>     ‚Äî     . </p><br><p> <strong> </strong> </p><br><p>          ,   0,742.        ctr_complexity=2   30    5 .   4   ,     ,      0,7433. </p><br><p>       ,     ,      .          predict(prediction_type='RawFormulaVal')   scale_pos_weight=neg_count/pos_count. </p><br><p><img src="https://habrastorage.org/webt/ki/yv/yj/kiyvyjpnsouo46k-ny9e9hmyjxa.png"></p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">    </a> . </p><br><p> <strong> </strong> </p><br><p>       . ,      ,    ,   2  . </p><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> . ,   Mail.ru,    ,         ,     . </li><li>  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   facebook</a> ,        . </li></ul><br><h1 id="zaklyuchenie">  Conclus√£o </h1><br><p>      : </p><br><ul><li>      ,       target encoding,     catboost. </li><li>     ,       ,  learning_rate  iterations.    ‚Äî    . </li><li>     GPU. Catboost      GPU,    . </li><li>          rsm~=0.2 (CPU only)  ctr_complexity=1. </li><li>     ,      .         .         , ,     . </li><li>       ,   . </li><li>         ,    . </li></ul><br><p><img src="https://habrastorage.org/webt/en/m_/to/enm_topolhyttqfezaldsddvjs0.jpeg"></p><br><p>     ,   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt447376/">https://habr.com/ru/post/pt447376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt447366/index.html">Qual √© a melhor maneira de iniciar um projeto ou como garantir que n√£o haja dores excruciantes</a></li>
<li><a href="../pt447368/index.html">N√£o apenas pegando pulgas. Por que a velocidade √© t√£o importante para qualquer loja</a></li>
<li><a href="../pt447370/index.html">Por que, devido a um sistema de patentes quebrado, a sombra de Theranos ainda paira sobre n√≥s</a></li>
<li><a href="../pt447372/index.html">A transforma√ß√£o da TI √© inevit√°vel: por onde come√ßar</a></li>
<li><a href="../pt447374/index.html">Criando elementos de interface programaticamente usando o PureLayout (parte 2)</a></li>
<li><a href="../pt447380/index.html">Exce√ß√µes de Kotlin e seus recursos</a></li>
<li><a href="../pt447382/index.html">O livro "Unidade e C #. Gamedev da ideia √† implementa√ß√£o. 2nd ed</a></li>
<li><a href="../pt447384/index.html">Semicondutores de pot√™ncia em guarda da ecologia</a></li>
<li><a href="../pt447388/index.html">TL; resumo DR da Universidade ITMO: admiss√£o n√£o cl√°ssica √† universidade, eventos futuros e os materiais mais interessantes</a></li>
<li><a href="../pt447390/index.html">Diretrizes de configura√ß√£o do AccelStor AFA para VMware vSphere</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>