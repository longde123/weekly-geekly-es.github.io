<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ â€¼ï¸ ğŸ¿ åœ¨Goä¸Šæµ‹è¯•ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ï¼šå†è§ï¼ŒJavaScript ğŸ›· ğŸ–ğŸ¼ ğŸŒ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘è¦æ„Ÿè°¢æˆ‘çš„åŒäº‹ï¼šSergey Nemeshï¼ŒMikhail Popsuyevï¼ŒEvgeny Babichå’ŒIgor Titarenkoçš„å’¨è¯¢ï¼Œåé¦ˆå’Œæµ‹è¯•ã€‚ æˆ‘è¿˜è¦æ„Ÿè°¢PolySwarmå›¢é˜Ÿå¼€å‘äº†Perigordçš„åŸå§‹ç‰ˆæœ¬ã€‚ 
 
 è¿™æ˜¯æˆ‘ç¬¬ä¸€ç¯‡ä¸­è‹±æ–‡æ–‡ç« çš„ç¿»è¯‘ 


 å°½ç®¡ä¸æ˜¯æœ€ä»¤äººæ„‰å¿«çš„æµ‹è¯•ï¼Œä½†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Goä¸Šæµ‹è¯•ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ï¼šå†è§ï¼ŒJavaScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445254/"><p><img src="https://cdn-images-1.medium.com/max/1600/1*WNQyyGK2TrOy2m784kJang.jpeg" alt="å›¾ç‰‡"><br>  <em>æˆ‘è¦æ„Ÿè°¢æˆ‘çš„åŒäº‹ï¼šSergey Nemeshï¼ŒMikhail Popsuyevï¼ŒEvgeny Babichå’ŒIgor Titarenkoçš„å’¨è¯¢ï¼Œåé¦ˆå’Œæµ‹è¯•ã€‚</em>  <em>æˆ‘è¿˜è¦æ„Ÿè°¢PolySwarmå›¢é˜Ÿå¼€å‘äº†Perigordçš„åŸå§‹ç‰ˆæœ¬ã€‚</em> <em><br></em> <br>  <em>è¿™æ˜¯æˆ‘ç¬¬ä¸€ç¯‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸­</a>è‹±æ–‡æ–‡ç« çš„ç¿»è¯‘</em> </p><br><p> å°½ç®¡ä¸æ˜¯æœ€ä»¤äººæ„‰å¿«çš„æµ‹è¯•ï¼Œä½†æ˜¯æµ‹è¯•ä¸€ç›´æ˜¯è½¯ä»¶å¼€å‘çš„ç»„æˆéƒ¨åˆ†ã€‚ å½“æ¶‰åŠæ™ºèƒ½åˆçº¦æ—¶ï¼Œéœ€è¦è¿›è¡Œä¸¥æ ¼çš„æµ‹è¯•ï¼Œå¹¶ç‰¹åˆ«æ³¨æ„ç»†èŠ‚ï¼Œå› ä¸º éƒ¨ç½²åˆ°åŒºå—é“¾ç½‘ç»œåï¼Œé”™è¯¯å°†æ— æ³•ä¿®å¤ã€‚ åœ¨è¿‡å»çš„å‡ å¹´ä¸­ï¼Œä»¥å¤ªåŠç¤¾åŒºåˆ›å»ºäº†è®¸å¤šç”¨äºå¼€å‘æ™ºèƒ½åˆçº¦çš„å·¥å…·ã€‚ å…¶ä¸­ä¸€äº›æ²¡æœ‰æµè¡Œï¼Œä¾‹å¦‚Vyper-ä¸€ç§ç”¨äºç¼–å†™æ™ºèƒ½åˆçº¦çš„Pythonæ–¹è¨€ã€‚ å…¶ä»–ï¼Œä¾‹å¦‚Solidityï¼Œå·²ç»æˆä¸ºå…¬è®¤çš„æ ‡å‡†ã€‚ è¿„ä»Šä¸ºæ­¢ï¼Œæœ‰å…³æµ‹è¯•æ™ºèƒ½åˆçº¦çš„æœ€å¹¿æ³›çš„æ–‡æ¡£æä¾›äº†è®¸å¤šTruffleï¼†Ganacheã€‚ è¿™ä¸¤ä¸ªå·¥å…·éƒ½æœ‰å¾ˆå¥½çš„æ–‡æ¡£ï¼Œå…³äºStack Overflowå’Œç±»ä¼¼èµ„æºçš„å¾ˆå¤šæƒ…å†µå·²ç»ç¡®å®šã€‚ ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªé‡è¦çš„ç¼ºç‚¹ï¼šè¦ç¼–å†™æµ‹è¯•ï¼Œæ‚¨éœ€è¦ä½¿ç”¨Node.jsã€‚ </p><a name="habracut"></a><br><h4 id="lovushki-javascript">  JavaScripté™·é˜± </h4><br><p> å³ä½¿æ‚¨ä¸å–œæ¬¢é™æ€ç±»å‹çš„ç¼–ç¨‹è¯­è¨€å¹¶ä¸”å–œæ¬¢JavaScriptï¼Œä¹Ÿå¯ä»¥è€ƒè™‘æ‰“é”™å­—å¹¶å¼€å§‹æ¯”è¾ƒä½¿ç”¨ä¸æ¨èä½¿ç”¨çš„equalæ–¹æ³•ï¼ˆè€Œä¸æ˜¯strictEqualï¼‰è¿”å›å…·æœ‰å¸ƒå°”å€¼çš„å­—ç¬¦ä¸²çš„å‡½æ•°çš„ç»“æœã€‚ </p><br><pre><code class="plaintext hljs">let proposalExists = await voting.checkProposal(); assert.equal(proposalExists, true, 'Proposal should exist');</code> </pre> <br><p> å¦‚æœcheckProposalè¿”å›å­—ç¬¦ä¸²â€œ yesâ€æˆ–â€œ noâ€ï¼Œåˆ™æ‚¨å°†å§‹ç»ˆå°†å…¶è½¬æ¢ä¸ºtrueã€‚ åŠ¨æ€ç±»å‹éšè—äº†è®¸å¤šé™·é˜±ï¼Œå³ä½¿æ˜¯ç»éªŒä¸°å¯Œçš„ç¨‹åºå‘˜ï¼Œåœ¨å¤„ç†å¤§å‹é¡¹ç›®æˆ–ä¸å…¶ä»–å¼€å‘äººå‘˜è¿›è¡Œå›¢é˜Ÿåˆä½œæ—¶ä¹Ÿå¯èƒ½çŠ¯è¿™æ ·çš„é”™è¯¯ï¼Œä»–ä»¬å¯ä»¥æ›´æ”¹ä»£ç è€Œä¸æŠ¥å‘Šä»£ç ã€‚ </p><br><p>  Goçš„é™æ€ç±»å‹æœ‰åŠ©äºé˜²æ­¢æ­¤ç±»é”™è¯¯ã€‚ æ­¤å¤–ï¼Œä½¿ç”¨Goè¯­è¨€ä»£æ›¿Node.jsè¿›è¡Œæµ‹è¯•æ˜¯ä»»ä½•å¼€å§‹ä½¿ç”¨æ™ºèƒ½åˆçº¦çš„Goå¼€å‘äººå‘˜çš„æ¢¦æƒ³ã€‚ </p><br><p> æˆ‘çš„å›¢é˜Ÿæ­£åœ¨å¼€å‘åŸºäºæ™ºèƒ½åˆçº¦çš„æŠ•èµ„ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿå…·æœ‰éå¸¸å¤æ‚çš„ä½“ç³»ç»“æ„ã€‚ æ™ºèƒ½åˆçº¦ç³»ç»ŸåŒ…å«è¶…è¿‡2,000è¡Œä»£ç ã€‚ ç”±äºå›¢é˜Ÿçš„å¤§éƒ¨åˆ†æ˜¯Goå¼€å‘äººå‘˜ï¼Œå› æ­¤åœ¨Goä¸Šè¿›è¡Œæµ‹è¯•æ¯”Node.jsæ›´å¯å–ã€‚ </p><br><h4 id="pervaya-sreda-dlya-testirovaniya-smart-kontraktov-na-go"> ç¬¬ä¸€ä¸ªåœ¨Goä¸Šæµ‹è¯•æ™ºèƒ½åˆçº¦çš„ç¯å¢ƒ </h4><br><p>  2017å¹´ï¼ŒPolySwarmä½¿ç”¨Goè€Œä¸æ˜¯JavaScriptå¼€å‘äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Perigord</a> ï¼ˆç±»ä¼¼äºTruffleçš„å·¥å…·ï¼‰ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œè¯¥é¡¹ç›®ä¸å†å—æ”¯æŒï¼Œå®ƒåªæœ‰ä¸€ä¸ªæ•™ç¨‹å’Œéå¸¸ç®€å•çš„ç¤ºä¾‹ã€‚ æ­¤å¤–ï¼Œå®ƒä¸æ”¯æŒä¸Ganacheé›†æˆï¼ˆç”¨äºå¼€å‘å…·æœ‰éå¸¸æ–¹ä¾¿çš„GUIçš„ä»¥å¤ªåŠçš„ç§æœ‰åŒºå—é“¾ï¼‰ã€‚ æˆ‘ä»¬é€šè¿‡æ¶ˆé™¤é”™è¯¯å¹¶å¼•å…¥äº†ä¸¤ä¸ªæ–°åŠŸèƒ½æ¥æ”¹è¿›Perigordï¼šä»åŠ©è®°ç ç”Ÿæˆé’±åŒ…ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬æµ‹è¯•å¹¶è¿æ¥åˆ°GanacheåŒºå—é“¾ã€‚ æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>é˜…è¯»æºä»£ç ã€‚ </p><br><p> åŸå§‹çš„Perigordæ•™ç¨‹ä»…åŒ…å«æœ€ç®€å•çš„è°ƒç”¨åˆåŒä»¥æ›´æ”¹å•ä¸ªå€¼çš„ç¤ºä¾‹ã€‚ ä½†æ˜¯ï¼Œåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæ‚¨è¿˜éœ€è¦ä»ä¸åŒçš„é’±åŒ…ä¸­æ‹¨æ‰“åˆåŒï¼Œå‘é€å’Œæ¥æ”¶ä»¥å¤ªå¸ç­‰ã€‚ ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨é«˜çº§Perigordå’Œè€å¼çš„Ganacheå®Œæˆæ‰€æœ‰è¿™äº›æ“ä½œã€‚ æ‚¨å°†åœ¨ä¸‹é¢æ‰¾åˆ°æœ‰å…³ä½¿ç”¨Perigordï¼†Ganacheå¼€å‘å’Œæµ‹è¯•æ™ºèƒ½åˆçº¦çš„è¯¦ç»†æŒ‡å—ã€‚ </p><br><h4 id="ispolzovanie-uluchshennogo-perigord-polnoe-rukovodstvo"> ä½¿ç”¨Advanced Perigordï¼šå®Œæ•´æŒ‡å— </h4><br><p> è¦ä½¿ç”¨Perigordï¼Œæ‚¨éœ€è¦å®‰è£…Go 1.7 +ï¼Œsolcï¼Œabigenå’ŒGanacheã€‚ è¯·å‚é˜…æ‚¨çš„æ“ä½œç³»ç»Ÿçš„æ–‡æ¡£ã€‚ </p><br><p> å¦‚ä¸‹å®‰è£…Perigordï¼š </p><br><pre> <code class="plaintext hljs">$ go get gitlab.com/go-truffle/enhanced-perigord $ go build</code> </pre> <br><p> ä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨perigordå‘½ä»¤ï¼š </p><br><pre> <code class="plaintext hljs">$ perigord A golang development environment for Ethereum Usage: perigord [command] Available Commands: add Add a new contract or test to the project build (alias for compile) compile Compile contract source files deploy (alias for migrate) generate (alias for compile) help Help about any command init Initialize new Ethereum project with example contracts and tests migrate Run migrations to deploy contracts test Run go and solidity tests Flags: -h, --help help for perigord Use "perigord [command] --help" for more information about a command.</code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„Marketæ™ºèƒ½åˆçº¦ï¼Œä»¥æ¼”ç¤ºå¯ç”¨çš„æµ‹è¯•é€‰é¡¹ã€‚ </p><br><p> è¦å¯åŠ¨é¡¹ç›®ï¼Œè¯·åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š </p><br><pre> <code class="plaintext hljs">$ perigord init market</code> </pre> <br><p> è¯¥é¡¹ç›®å°†å‡ºç°åœ¨GOPATHçš„src /æ–‡ä»¶å¤¹ä¸­ã€‚ å¦‚æœè¦æ›´æ”¹é¡¹ç›®ä½ç½®ï¼Œè¯·å°†é¡¹ç›®ç§»åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹å¹¶æ›´æ–°å¯¼å…¥è·¯å¾„ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹å¸‚åœº/æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ã€‚ </p><br><pre> <code class="plaintext hljs">$ tree . â”œâ”€â”€ contracts â”‚ â””â”€â”€ Foo.sol â”œâ”€â”€ generate.go â”œâ”€â”€ main.go â”œâ”€â”€ migrations â”‚ â””â”€â”€ 1_Migrations.go â”œâ”€â”€ perigord.yaml â”œâ”€â”€ stub â”‚ â”œâ”€â”€ README.md â”‚ â””â”€â”€ main.go â”œâ”€â”€ stub_test.go â””â”€â”€ tests â””â”€â”€ Foo.go</code> </pre> <br><p> ä¸Truffleä¸­åˆ›å»ºçš„é¡¹ç›®éå¸¸ç›¸ä¼¼ï¼Œä¸æ˜¯å—ï¼Ÿ ä½†è¿™ä¸€åˆ‡éƒ½åœ¨è¿›è¡Œä¸­ï¼ è®©æˆ‘ä»¬çœ‹çœ‹perigord.yamlé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚ </p><br><pre> <code class="plaintext hljs">networks: dev: url: /tmp/geth_private_testnet/geth.ipc keystore: /tmp/geth_private_testnet/keystore passphrase: blah mnemonic: candy maple cake sugar pudding cream honey rich smooth crumble sweet treat num_accounts: 10</code> </pre> <br><p> ä¸ºäº†è¿›è¡Œæµ‹è¯•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸“ç”¨çš„gethç½‘ç»œå’Œé’±åŒ…æ–‡ä»¶ï¼Œç„¶åè¿æ¥åˆ°Ganacheã€‚ è¿™äº›é€‰é¡¹æ˜¯äº’æ–¥çš„ã€‚ æˆ‘ä»¬é‡‡ç”¨é»˜è®¤çš„åŠ©è®°ç¬¦ï¼Œç”Ÿæˆ10ä¸ªå¸æˆ·å¹¶è¿æ¥åˆ°Ganacheã€‚ å°†perigord.yamlä¸­çš„ä»£ç æ›¿æ¢ä¸ºï¼š </p><br><pre> <code class="plaintext hljs">networks: dev: url: HTTP://127.0.0.1:7545 mnemonic: candy maple cake sugar pudding cream honey rich smooth crumble sweet treat num_accounts: 10</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">HTTP http://127.0.0.1:7545-Ganache</a> RPCæœåŠ¡å™¨çš„æ ‡å‡†åœ°å€ã€‚ è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä»»æ„æ•°é‡çš„å¸æˆ·è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯åªæœ‰åœ¨Ganacheï¼ˆGUIï¼‰ä¸­ç”Ÿæˆçš„å¸æˆ·æ‰ä¼šåŒ…å«èµ„é‡‘ã€‚ </p><br><p> æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸ºMarket.solçš„åˆåŒã€‚ ä»–å¯ä»¥ä¿å­˜ä¸€å¯¹åœ°å€çš„è®°å½•ï¼Œå…¶ä¸­ä¸€ä¸ªåœ°å€å°†èµ„é‡‘å‘é€åˆ°åˆåŒå¸æˆ·ï¼Œè€Œå¦ä¸€ä¸ªåœ°å€æœ‰æƒåœ¨åˆåŒæŒæœ‰äººå…è®¸è¿›è¡Œæ­¤ç±»äº¤æ˜“æ—¶æ”¶å–èµ„é‡‘ã€‚ ä¾‹å¦‚ï¼Œä¸¤ä¸ªå‚ä¸è€…äº’ä¸ä¿¡ä»»ï¼Œä½†æ˜¯ä¿¡ä»»åˆåŒçš„æ‰€æœ‰è€…ï¼ŒåˆåŒçš„æ‰€æœ‰è€…å†³å®šæ˜¯å¦æ»¡è¶³ç‰¹å®šæ¡ä»¶ã€‚ è¯¥ç¤ºä¾‹å®ç°äº†å‡ ä¸ªåŸºæœ¬åŠŸèƒ½ä»¥è¿›è¡Œæ¼”ç¤ºã€‚ </p><br><p> å°†è”ç³»äººæ·»åŠ åˆ°é¡¹ç›®ï¼š </p><br><pre> <code class="plaintext hljs">$ perigord add contract Market</code> </pre> <br><p> åç¼€.solå°†è‡ªåŠ¨æ·»åŠ ã€‚ æ‚¨è¿˜å¯ä»¥æ·»åŠ å…¶ä»–åˆåŒæˆ–åˆ é™¤æ ·æœ¬åˆåŒFoo.solã€‚ åœ¨GOPATHä¸­å·¥ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¯¼å…¥åˆåŒæ¥åˆ›å»ºå¤æ‚çš„ç»“æ„ã€‚ æˆ‘ä»¬å°†æ‹¥æœ‰ä¸‰ä¸ªSolidityæ–‡ä»¶ï¼šä¸»è¦çš„MarketåˆåŒï¼ŒOwnableå’ŒMigrationsè¾…åŠ©åˆåŒä»¥åŠSafeMathåº“ã€‚ æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>æ‰¾åˆ°æºä»£ç ã€‚ </p><br><p> ç°åœ¨ï¼Œè¯¥é¡¹ç›®å…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š </p><br><pre> <code class="plaintext hljs">. â”œâ”€â”€ contracts â”‚ â”œâ”€â”€ Market.sol â”‚ â”œâ”€â”€ Ownable.sol â”‚ â””â”€â”€ SafeMath.sol â”œâ”€â”€ generate.go â”œâ”€â”€ main.go â”œâ”€â”€ migrations â”‚ â””â”€â”€ 1_Migrations.go â”œâ”€â”€ perigord.yaml â”œâ”€â”€ stub â”‚ â”œâ”€â”€ README.md â”‚ â””â”€â”€ main.go â”œâ”€â”€ stub_test.go â””â”€â”€ tests â””â”€â”€ Foo.go</code> </pre> <br><p> ç”ŸæˆEVMå­—èŠ‚ç ï¼ŒABIå’ŒGoç»‘å®šï¼š </p><br><pre> <code class="plaintext hljs">$ perigord build</code> </pre> <br><p> æ·»åŠ å°†è¦éƒ¨ç½²çš„æ‰€æœ‰åˆåŒçš„è¿ç§»ã€‚ å› ä¸º æˆ‘ä»¬åªéƒ¨ç½²Market.solï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œä¸€æ¬¡æ–°è¿ç§»ï¼š </p><br><pre> <code class="plaintext hljs">$ perigord add migration Market</code> </pre> <br><p> æˆ‘ä»¬çš„åˆåŒä¸åŒ…å«æ¥å—å‚æ•°çš„æ„é€ å‡½æ•°ã€‚ å¦‚æœéœ€è¦å°†å‚æ•°ä¼ é€’ç»™æ„é€ å‡½æ•°ï¼Œè¯·å°†å…¶æ·»åŠ åˆ°è¿ç§»æ–‡ä»¶ä¸­çš„Deploy {NewContract}å‡½æ•°ä¸­ï¼š </p><br><pre> <code class="plaintext hljs">address, transaction, contract, err := bindings.Deploy{NewContract}(auth, network.Client(), â€œFOOâ€, â€œBARâ€)</code> </pre> <br><p> åˆ é™¤ç¤ºä¾‹æ–‡ä»¶Foo.goå¹¶ä¸ºæˆ‘ä»¬çš„åˆåŒæ·»åŠ æµ‹è¯•æ–‡ä»¶ï¼š </p><br><pre> <code class="plaintext hljs">$ perigord add test Market</code> </pre> <br><p> è¦ä½¿ç”¨ç¡®å®šæ€§é’±åŒ…ï¼Œæˆ‘ä»¬éœ€è¦ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–åŠ©è®°ç¬¦ï¼š </p><br><pre> <code class="plaintext hljs">func getMnemonic() string { viper.SetConfigFile("perigord.yaml") if err := viper.ReadInConfig(); err != nil { log.Fatal() } mnemonic := viper.GetStringMapString("networks.dev")["mnemonic"] return mnemonic }</code> </pre> <br><p> ä»¥ä¸‹å¸®åŠ©ç¨‹åºå‡½æ•°ç”¨äºè·å–ç½‘ç»œåœ°å€ï¼š </p><br><pre> <code class="plaintext hljs">func getNetworkAddress() string { viper.SetConfigFile("perigord.yaml") if err := viper.ReadInConfig(); err != nil { log.Fatal() } networkAddr := viper.GetStringMapString("networks.dev")["url"] return networkAddr }</code> </pre> <br><p> æˆ‘ä»¬å°†éœ€è¦çš„å¦ä¸€ä¸ªè¾…åŠ©åŠŸèƒ½æ˜¯sendETHï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒå°†ä»¥å¤ªå¸ä»ç”Ÿæˆçš„é’±åŒ…ä¹‹ä¸€ï¼ˆç”±ç´¢å¼•è¡¨ç¤ºï¼‰è½¬ç§»åˆ°ä»»ä½•ä»¥å¤ªåŠåœ°å€ï¼š </p><br><pre> <code class="plaintext hljs">func sendETH(s *MarketSuite, c *ethclient.Client, sender int, receiver common.Address, value *big.Int) { senderAcc := s.network.Accounts()[sender].Address nonce, err := c.PendingNonceAt(context.Background(), senderAcc) if err != nil { log.Fatal(err) } gasLimit := uint64(6721975) // in units gasPrice := big.NewInt(3700000000) wallet, err := hdwallet.NewFromMnemonic(getMnemonic()) toAddress := receiver var data []byte tx := types.NewTransaction(nonce, toAddress, value, gasLimit, gasPrice, data) chainID, err := c.NetworkID(context.Background()) if err != nil { log.Fatal(err) } privateKey, err := wallet.PrivateKey(s.network.Accounts()[sender]) signedTx, err := types.SignTx(tx, types.NewEIP155Signer(chainID), privateKey) if err != nil { log.Fatal(err) } ts := types.Transactions{signedTx} rawTx := hex.EncodeToString(ts.GetRlp(0)) var trx *types.Transaction rawTxBytes, err := hex.DecodeString(rawTx) err = rlp.DecodeBytes(rawTxBytes, &amp;trx) err = c.SendTransaction(context.Background(), trx) if err != nil { log.Fatal(err) } }</code> </pre> <br><p> ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°ç”¨äºä¿®æ”¹åˆåŒè°ƒç”¨ï¼š </p><br><pre> <code class="plaintext hljs">func ensureAuth(auth bind.TransactOpts) *bind.TransactOpts { return &amp;bind.TransactOpts{ auth.From, auth.Nonce, auth.Signer, auth.Value, auth.GasPrice, auth.GasLimit, auth.Context} } func changeAuth(s MarketSuite, account int) bind.TransactOpts { return *s.network.NewTransactor(s.network.Accounts()[account]) }</code> </pre> <br><h4 id="procedura-testirovaniya"> æµ‹è¯•ç¨‹åº </h4><br><p> å¯¹äºé€šè¯ï¼Œæˆ‘ä»¬ä¸ºç‰¹å®šåˆåŒåˆ›å»ºä¸€ä¸ªcontractSessionActualã€‚ å› ä¸º åˆåŒæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œæˆ‘ä»¬å¯ä»¥è·å–å…¶åœ°å€å¹¶æ£€æŸ¥å…¶æ˜¯å¦ä¸é»˜è®¤çš„é›¶Ganacheå¸æˆ·åŒ¹é…ã€‚ æˆ‘ä»¬å°†æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼ˆæˆ‘ä»¬å°†çœç•¥é”™è¯¯å¤„ç†ä»¥èŠ‚çœç©ºé—´ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs">contractSession := contract.Session("Market") c.Assert(contractSession, NotNil) contractSessionActual, ok := contractSession.(*bindings.MarketSession) c.Assert(ok, Equals, true) c.Assert(contractSessionActual, NotNil) owner, _ := contractSessionActual.Owner() account0 := s.network.Accounts()[0] c.Assert(owner.Hex(), Equals, account0.Address.Hex()) //Owner account is account 0</code> </pre> <br><p> ä¸‹ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½æ˜¯æ›´æ¢å¼•èµ·åˆåŒçš„é’±åŒ…ï¼š </p><br><pre> <code class="plaintext hljs">ownerInd := 0 sender := 5 receiver := 6 senderAcc := s.network.Accounts()[sender].Address receiverAcc := s.network.Accounts()[receiver].Address //Call contract on behalf of its owner auth := changeAuth(*s, ownerInd) _, err = contractSessionActual.Contract.SetSenderReceiverPair(ensureAuth(auth), senderAcc, receiverAcc)</code> </pre> <br><p> å› ä¸º æµ‹è¯•ä¸­ä½¿ç”¨çš„ä¸»è¦åŠŸèƒ½ä¹‹ä¸€æ˜¯æ›´æ”¹ä¸»å«åˆåŒï¼Œè®©æˆ‘ä»¬ä»£è¡¨å‘é€æ–¹ä»˜æ¬¾ï¼š </p><br><pre> <code class="plaintext hljs">auth = changeAuth(*s, sender) //Change auth fo senderAcc to make a deposit on behalf of the sender client, _ := ethclient.Dial(getNetworkAddress()) //Let's check the current balance balance, _ := client.BalanceAt(context.Background(), contract.AddressOf("Market"), nil) c.Assert(balance.Int64(), Equals, big.NewInt(0).Int64()) //Balance should be 0 //Let's transfer 3 ETH to the contract on behalf of the sender value := big.NewInt(3000000000000000000) // in wei (3 eth) contractReceiver := contract.AddressOf("Market") sendETH(s, client, sender, contractReceiver, value) balance2, _ := client.BalanceAt(context.Background(), contract.AddressOf("Market"), nil) c.Assert(balance2.Int64(), Equals, value.Int64()) //Balance should be 3 ETH</code> </pre> <br><p> å®Œæ•´çš„æµ‹è¯•ä»£ç åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a> ã€‚ </p><br><p> ç°åœ¨æ‰“å¼€stub_test.goå¹¶ç¡®ä¿æ‰€æœ‰å¯¼å…¥éƒ½æŒ‡å‘æ‚¨å½“å‰çš„é¡¹ç›®ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ï¼š </p><br><pre> <code class="plaintext hljs">import ( _ "market/migrations" _ "market/tests" "testing" . "gopkg.in/check.v1" )</code> </pre> <br><p> è¿è¡Œæµ‹è¯•ï¼š </p><br><pre> <code class="plaintext hljs">$ perigord test</code> </pre> <br><p> å¦‚æœä¸€åˆ‡éƒ½æ­£ç¡®å®Œæˆï¼Œé‚£ä¹ˆåœ¨æµ‹è¯•ç»“æŸåï¼Œå°†ä¼šå¾—åˆ°ç±»ä¼¼çš„ç»“æœï¼š </p><br><pre> <code class="plaintext hljs">Running migration 2 Running migration 3 OK: 1 passed PASS ok market 0.657s</code> </pre> <br><p> å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·ä¸‹è½½æº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ä»¶</a>å¹¶é‡å¤æœ¬æŒ‡å—ä¸­æè¿°çš„æ­¥éª¤ã€‚ </p><br><h4 id="v-zaklyuchenie"> æ€»ç»“ </h4><br><p>  Perigordæ˜¯ä½¿ç”¨æ‚¨å–œæ¬¢çš„è¯­è¨€ç¼–å†™çš„å¯é æµ‹è¯•å·¥å…·ã€‚ ä»–åˆ›å»ºäº†ä¸Truffleç›¸åŒçš„é¡¹ç›®ç»“æ„ï¼Œå¹¶ä¸”æ‹¥æœ‰ç›¸åŒçš„å›¢é˜Ÿï¼Œå› æ­¤æ‚¨æ— éœ€é‡æ–°å­¦ä¹ ã€‚ é™æ€ç±»å‹å’Œæ˜ç¡®çš„å‡½æ•°ç­¾åä½¿æ‚¨å¯ä»¥å¿«é€Ÿå¼€å‘å’Œæ‰§è¡Œè°ƒè¯•ï¼Œå¹¶æ˜¾ç€é˜²æ­¢å‚æ•°è¾“å…¥é”™è¯¯ã€‚ åœ¨Perigordä¸­ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°å°†ç°æœ‰é¡¹ç›®è¿ç§»åˆ°Truffleï¼ˆæ‚¨è¦åšçš„å°±æ˜¯å°†åˆåŒæ–‡ä»¶å¤åˆ¶å¹¶ç²˜è´´åˆ°ç›¸åº”çš„æ–‡ä»¶å¤¹ä¸­å¹¶æ·»åŠ æµ‹è¯•ï¼‰ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Goç¼–å†™çš„æµ‹è¯•æ¥å¯åŠ¨ä¸€ä¸ªå…¨æ–°çš„é¡¹ç›®ã€‚ </p><br><p> æˆ‘å¸Œæœ›ç”±PolySwarmå›¢é˜Ÿå¼€å§‹å¹¶ç”±Inn4Scienceç»§ç»­è¿›è¡Œçš„å·¥ä½œå¯¹Goç¤¾åŒºæœ‰ç”¨ï¼Œå¹¶ä½¿ç”¨ä¸å¤ªæ–¹ä¾¿çš„å·¥å…·è…¾å‡ºå¤§é‡çš„æµ‹è¯•å’Œè°ƒè¯•æ—¶é—´ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN445254/">https://habr.com/ru/post/zh-CN445254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN445242/index.html">åç¨‹å’Œæ”¹é€ 2çš„ç»éªŒ</a></li>
<li><a href="../zh-CN445244/index.html">â€œåŒºå—é“¾ä¹‹å¤–çš„é‡‘é’±æ¸¸æˆå¿…é¡»æ¶ˆäº¡â€</a></li>
<li><a href="../zh-CN445246/index.html">æ¶‰åŠé‡‘é’±çš„éåŒºå—é“¾æ¸¸æˆå¿…æ­»</a></li>
<li><a href="../zh-CN445248/index.html">æƒ³å˜å¾—æ›´å¿«ä¹å—ï¼Ÿ å°è¯•æˆä¸ºæ‚¨æ‰€åœ¨é¢†åŸŸçš„ä½¼ä½¼è€…</a></li>
<li><a href="../zh-CN445252/index.html">æ•°å­—ç‰ˆæƒè¿›å…¥ä¿„ç½—æ–¯</a></li>
<li><a href="../zh-CN445256/index.html">ç½‘ç»œçŠ¯ç½ªåˆ†å­æ§åˆ¶äº†ASUS Live Updateäº”ä¸ªæœˆ</a></li>
<li><a href="../zh-CN445258/index.html">å‡ºå”®å‰å¦‚ä½•ä»Androidæ™ºèƒ½æ‰‹æœºå®‰å…¨åˆ é™¤æ•°æ®</a></li>
<li><a href="../zh-CN445260/index.html">æœºå™¨äººä¼šçœŸæ­£åœ°è®¤å‡ºè‡ªå·±å—ï¼Ÿ ç§‘å­¦å®¶æ­£åœ¨æœè¿™ä¸ªæ–¹å‘å‘å±•ã€‚</a></li>
<li><a href="../zh-CN445262/index.html">GeekUniversityåœ¨å¤§æ•°æ®åˆ†æç³»æ‹›è˜</a></li>
<li><a href="../zh-CN445264/index.html">é¢„åŠ è½½ï¼Œé¢„å–å’Œå…¶ä»–æ ‡ç­¾</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>