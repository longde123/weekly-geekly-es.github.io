<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚝 👶🏿 ☯️ Chiffrement complet du disque des systèmes installés sous Windows Linux. Multiboot crypté 👨🏽‍💼 💪🏻 🍅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mise à jour de son propre guide de chiffrement complet du disque dans Runet V0.2 

 Stratégie Cowboy: 
 [A] bloquer le chiffrement du système installé...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Chiffrement complet du disque des systèmes installés sous Windows Linux. Multiboot crypté</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482696/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/y7/04/pd/y704pdw4xfrpf8nipub8isyyzra.jpeg"></div><br>  <b>Mise à jour de son propre guide de chiffrement complet du disque dans Runet V0.2</b> <br><br><h3>  Stratégie Cowboy: </h3><br>  [A] bloquer le chiffrement du système installé sur Windows 7; <br>  [B] GNU / Linux <i>(Debian)</i> bloque le chiffrement du système installé <i>(y compris / boot)</i> ; <br>  [C] Configuration GRUB2, protection du chargeur de démarrage par signature numérique / authentification / hachage; <br>  [D] effacement - destruction des données non chiffrées; <br>  [E] sauvegarde universelle du système d'exploitation chiffré; <br>  [F] attaque &lt;à la p. [C6]&gt; la cible est le chargeur de démarrage GRUB2; <br>  [G] documentation utile. <br><br>  <b>╭───Circuit # rooms 40 # &lt;BIOS / MBR / 1HDD without lvm&gt;:</b> <br>  ├──╼ Windows 7 installé - cryptage complet du système, non masqué; <br>  ├──╼ GNU / Linux installé <i>(Debian et distributions dérivées)</i> - le chiffrement complet du système n'est pas caché <i>(/, y compris / boot; swap)</i> ; <br>  ├──╼ bootloaders indépendants: VeraCrypt bootloader installé dans MBR, GRUB2 bootloader installé dans la partition étendue; <br>  ├──╼ L'installation / réinstallation du système d'exploitation n'est pas requise; <br>  └──╼ logiciel cryptographique utilisé: VeraCrypt;  Cryptsetup;  GnuPG;  Hippocampe  Hashdeep;  GRUB2 - gratuit / gratuit. <a name="habracut"></a><br><br>  Le schéma ci-dessus résout partiellement le problème du «démarrage à distance sur le lecteur flash», vous permet de profiter du système d'exploitation crypté Windows / Linux et d'échanger des données via le «canal crypté» d'un système d'exploitation à un autre. <br><br>  <b>Ordre de démarrage du PC (l'une des options):</b> <br><br><ul><li>  allumer la machine; </li><li>  chargement du chargeur de démarrage VeraCrypt <i>(la saisie du mot de passe correct continuera le chargement de Windows 7)</i> ; </li><li>  appuyer sur la touche Echap chargera le chargeur de démarrage GRUB2; </li><li>  bootloader GRUB2 <i>(choix de distribution / GNU / Linux / CLI)</i> , nécessitera l'authentification du superutilisateur GRUB2 &lt;login / mot de passe&gt;; </li><li>  après l'authentification réussie et la sélection du kit de distribution, vous devrez saisir une phrase secrète pour déverrouiller "/boot/initrd.img"; </li><li>  après avoir entré des mots de passe sans erreur dans GRUB2, «entrer» un mot de passe <i>(troisième, mot de passe BIOS ou mot de passe du compte utilisateur GNU / Linux - ne pas considérer) est</i> requis pour déverrouiller et charger GNU / Linux OS, ou substituer automatiquement une clé secrète <i>(deux mots de passe + une clé, ou mot de passe + clé)</i> ; </li><li>  une intrusion externe dans la configuration GRUB2 gèle le processus de démarrage GNU / Linux. </li></ul><br>  Gênant?  Ok, allons automatiser les processus. <br><br>  Lors du marquage du disque dur <i>(table MBR), un</i> PC ne peut pas avoir plus de 4 partitions principales, ou 3 principales et une étendue, ainsi qu'une zone non allouée.  Une partition étendue, contrairement à la partition principale, peut contenir des sous-sections <i>(lecteurs logiques = partition étendue)</i> .  En d'autres termes, la «partition étendue» sur le disque dur remplace LVM pour la tâche actuelle: le chiffrement complet du système.  Si votre disque est partitionné en 4 partitions principales, vous devez utiliser lvm, soit transformer <i>(avec formatage) la</i> partition de principale en étendue, soit utiliser les quatre partitions à bon escient et laisser le tout tel quel, pour obtenir le résultat souhaité.  Même si vous avez une partition sur le disque, Gparted vous aidera à diviser le disque dur <i>(en partitions supplémentaires)</i> sans perdre de données, mais toujours avec un petit prix pour de telles actions. <br><br>  La disposition de la disposition du disque dur, à propos de laquelle l'intégralité de l'article sera verbalisé, est présentée dans le tableau ci-dessous. <br><br><img src="https://habrastorage.org/webt/jd/3k/wf/jd3kwfqr9mas6ldlmil_5qwwbg8.png"><br>  <i>Tableau (n ° 1) des sections 1 To.</i> <br><br>  Quelque chose de similaire devrait être avec vous. <br>  sda1 - la partition principale №1 NTFS <i>(cryptée)</i> ; <br>  sda2 - section de marqueur étendue; <br>  sda6 - lecteur logique <i>(le chargeur de démarrage GRUB2 y est installé);</i> <br>  sda8 - swap (fichier d'échange crypté / pas toujours); <br>  sda9 - teste le lecteur logique; <br>  sda5 - lecteur logique pour les curieux; <br>  sda7 - OS GNU / Linux (OS porté sur un lecteur logique chiffré); <br>  sda3 - section principale n ° 2 avec Windows 7 <i>(crypté)</i> ; <br>  sda4 est la partition principale n ° 3 <i>(elle contenait GNU / Linux non crypté, elle est utilisée pour la sauvegarde / pas toujours)</i> . <br><br><h2>  [A] Cryptage du système de blocage de Windows 7 </h2><br><div class="spoiler">  <b class="spoiler_title">A1.</b>  <b class="spoiler_title">Veracrypt</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-q/in/7s/-qin7s3t7xacdjov7invu_8kb2y.png"><br><br>  Téléchargez depuis le <a href="https://www.veracrypt.fr/en/Downloads.html" rel="nofollow">site officiel</a> ou depuis le miroir <a href="https://sourceforge.net/projects/veracrypt/" rel="nofollow">sourceforge</a> la version d'installation du logiciel cryptographique VeraCrypt <i>(au moment de la publication de l'article v1.24-Update3, la version portable de VeraCrypt n'est pas adaptée au cryptage du système)</i> .  Vérifiez la somme de contrôle des logiciels téléchargés <br><br> <code>$ Certutil -hashfile "C:\VeraCrypt Setup 1.24.exe" SHA256</code> <br> <br>  et comparer le résultat avec le CS affiché sur le site Web du développeur VeraCrypt. <br><br>  Si le logiciel HashTab est installé, c'est encore plus simple: RMB <i>(VeraCrypt Setup 1.24.exe)</i> - <i>propriétés de</i> hachage <i>de la</i> somme des fichiers. <br><br>  Pour vérifier la signature du programme, le système doit avoir le logiciel et la clé publique pgp du développeur <a href="https://www.gnupg.org/download/index.html" rel="nofollow">gnuPG installés</a> ;  <a href="https://www.gpg4win.org/get-gpg4win.html" rel="nofollow">gpg4win</a> . <br></div></div><br><div class="spoiler">  <b class="spoiler_title">A2.</b>  <b class="spoiler_title">Installation / lancement du logiciel administrateur VeraCrypt</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/py/ih/fo/pyihfozxju5pulv79n_3mllt9km.jpeg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">A3.</b>  <b class="spoiler_title">Sélection des options de chiffrement du système pour la partition active</b> <div class="spoiler_text">  VeraCrypt - Système - Crypter la partition / disque système - Normal - Crypter la partition système Windows - Multiboot - <i>(avertissement: "Les utilisateurs inexpérimentés ne sont pas recommandés d'utiliser cette méthode" et cela est vrai, nous sommes d'accord "Oui")</i> - Disque de démarrage <i>("oui", même si pas du tout "oui")</i> - Nombre de disques système "2 ou plus" - Plusieurs systèmes sur un disque "Oui" - Pas le chargeur de démarrage Windows "Non" <i>(mais en fait "Oui"! Sinon, les chargeurs de démarrage VeraCrypt / GRUB2 ne partageront pas MBR entre eux, plus précisément, dans la piste MBR / boot, seule la plus petite partie du code du bootloader est stockée,</i>  <i>sa partie principale est située dans le système de fichiers)</i> - Multiboot - Paramètres de cryptage ... <br><br>  Si vous vous écartez des étapes ci-dessus ( <i>schéma de chiffrement du système de blocage)</i> , VeraCrypt lancera un avertissement et ne permettra pas de chiffrer la partition. <br><br>  À l'étape suivante, pour cibler la protection des données, effectuez un «test» et choisissez un algorithme de chiffrement.  Si vous avez un processeur non moderne, l'algorithme de cryptage Twofish le plus rapide sera peut-être, sélectionnez-le.  Si le CPU est moderne, notez la différence: AES - le cryptage selon les résultats du test sera plusieurs fois plus rapide que ses concurrents en cryptographie.  AES est l'algorithme de cryptage le plus populaire, le matériel des processeurs modernes est spécialement optimisé pour le «secret» <s>et le «piratage</s> ». <br><br>  VeraCrypt prend en charge la possibilité de crypter les disques avec AES <i>(Twofish)</i> / et d'autres combinaisons.  Sur le processeur Intel à cœur ancien d'il y a dix ans <i>(sans prise en charge matérielle pour AES-NI, chiffrement avec cascade A / T), la</i> baisse des performances est essentiellement imperceptible.  <i>(pour les processeurs AMD de la même époque de paramètres ~, les performances sont légèrement réduites)</i> .  Le système d'exploitation est dynamique et la consommation de ressources pour un chiffrement transparent est invisible.  En revanche, par exemple, une baisse notable des performances due à l'environnement de bureau instable de test installé Mate v1.20.1 <i>(ou v1.20.2 je ne me souviens pas exactement)</i> dans GNU / Linux, ou en raison du fonctionnement de la routine de désherbage par télémétrie dans Windows7.  En règle générale, les utilisateurs sophistiqués effectuent des tests sur les performances matérielles avant le chiffrement.  Par exemple, dans Aida64 / Sysbench / systemd-analyse blâme, ils sont comparés aux résultats des mêmes tests après cryptage du système, réfutant ainsi pour lui-même le mythe selon lequel «le cryptage du système est nuisible».  Le ralentissement et les inconvénients de la machine sont perceptibles lors de la sauvegarde / restauration des données cryptées, car l'opération de «sauvegarde des données système» elle-même n'est pas mesurée en ms, et les mêmes sont ajoutées «décryptage / cryptage à la volée».  En fin de compte, chaque utilisateur autorisé à jouer avec la cryptographie établit l'équilibre de l'algorithme de cryptage en ce qui concerne la réalisation des objectifs, le degré de paranoïa et la facilité d'utilisation. <br><br>  Il est préférable de laisser le paramètre PIM par défaut, de sorte que lors du chargement du système d'exploitation à chaque fois, vous n'entrez pas les valeurs exactes des itérations.  VeraCrypt utilise un grand nombre d'itérations pour créer un véritable «hachage lent».  Une attaque contre un tel "escargot crypto" en utilisant la méthode Brute force / rainbow tables n'a de sens qu'avec une <s>courte</s> phrase de passe "simple" et une liste de caractères de la victime personnelle.  Paiement pour la force du mot de passe - le retard à entrer correctement le mot de passe lors du démarrage du système d'exploitation <i>(le montage des volumes VeraCrypt dans GNU / Linux est beaucoup plus rapide).</i> <br>  Logiciel gratuit pour implémenter les attaques par force brute <i>(extraire les phrases</i> secrètes de l'en- <i>tête du disque VeraCrypt / LUKS)</i> Hashcat.  John the Ripper ne sait pas «casser Veracrypt» et lorsqu'il travaille avec LUKS, il ne comprend pas la cryptographie Twofish.  Soit dit en passant, parmi les logiciels non commerciaux à tous autres égards, JtR est meilleur que Hashcat. <br><br>  En raison de la puissance cryptographique des algorithmes de chiffrement, les banques de chiffrement imparables et leurs antipodes développent des logiciels avec un vecteur d'attaque différent.  Par exemple, extraire des métadonnées / clés de la RAM <i>(attaque de démarrage à froid / accès direct à la mémoire),</i> voler un en-tête LUKS tout en interceptant un mot de passe et envoyer des paquets réseau, peut-être autre chose que je ne connais pas.  Il existe des logiciels spécialisés gratuits et non libres à ces fins. <br><br>  Une fois la configuration / génération de «métadonnées uniques» de la partition active cryptée terminée, VeraCrypt proposera de redémarrer le PC et de tester les performances de son chargeur de démarrage.  Après le redémarrage / démarrage de Windows, VeraCrypt se charge en mode veille, il ne reste plus qu'à confirmer le processus de cryptage - Y. <br><br>  À la dernière étape du chiffrement du système, VeraCrypt proposera de créer une copie de sauvegarde de l'en-tête de la partition chiffrée active sous la forme de «veracrypt rescue disk.iso» - cela doit être fait - <u>dans ce logiciel, cette opération est une exigence</u> <i>(dans LUKS, comme exigence, cela est malheureusement omis, mais souligné) dans la documentation)</i> .  Le disque de secours est utile à tout le monde et à plusieurs personnes.  Sans en-tête de disque, déplacer l'OS, perdre <i>(écraser l'en-tête / MBR) la</i> sauvegarde de l'en-tête privera définitivement l'accès à la partition déchiffrée avec Windows OS. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">A4.</b>  <b class="spoiler_title">Création d'un sauvetage USB / lecteur VeraCrypt</b> <div class="spoiler_text">  Par défaut, VeraCrypt propose de graver "~ 2-3 Mo de métadonnées" sur un CD, mais tout le monde n'a pas de lecteur ou de lecteur DWD-ROM, et la création d'un "disque de secours VeraCrypt" pour quelqu'un se révélera être une surprise technique: Rufus / GUIdd-ROSA ImageWriter et autres logiciels similaires - ne seront pas en mesure de faire face à la tâche, car en plus de copier les métadonnées décalées sur le lecteur flash USB amorçable, vous devez faire un copier / coller à partir de l'image en dehors du système de fichiers du lecteur USB, bref, copiez correctement le MBR / piste vers porte-clés.  Sous GNU / Linux, vous pouvez créer un lecteur flash amorçable à l'aide de l'utilitaire «dd», en regardant cette plaque. <br><br><img src="https://habrastorage.org/webt/_z/zl/f-/_zzlf-zhvflotagy215jpqv9dkw.jpeg"><br><br>  La création d'un disque de secours dans un environnement Windows est différente.  Le développeur de VeraCrypt n'a pas inclus la solution à ce problème dans la <a href="https://www.veracrypt.fr/en/VeraCrypt%2520Rescue%2520Disk.html" rel="nofollow">documentation</a> officielle du "disque de secours", mais a proposé une solution d'une autre manière: il a posté un logiciel supplémentaire pour créer le "disque de secours usb" en libre accès sur son forum VeraCrypt.  Mise à jour: 2020, le développeur a eu pitié des "petites choses" et a inclus officiellement la solution de <a href="" rel="nofollow">disque de secours USB</a> dans sa documentation. <br>  Après avoir enregistré le disque de secours.iso, le processus de chiffrement du système de blocs de la partition active commencera.  Pendant le cryptage, le système d'exploitation ne s'arrête pas, un redémarrage du PC n'est pas nécessaire.  Une fois l'opération de chiffrement terminée, la partition active devient entièrement chiffrée, vous pouvez l'utiliser.  Si le chargeur de démarrage VeraCrypt n'apparaît pas au démarrage du PC et que l'opération de récupération d'en-tête n'aide pas, vérifiez le drapeau «boot», il doit être installé sur la partition où Windows est présent <i>(indépendamment du cryptage et des autres OS, voir tableau n ° 1).</i> <br>  Après avoir chiffré le lecteur système et les lecteurs logiques ntfs (même mot de passe), ajoutez tous les lecteurs chiffrés aux «favoris système».  Ensuite, «paramètres»&gt; «favoris système», cochez la case «monter les favoris système au démarrage de Windows», au démarrage du système d'exploitation, tous les disques ntfs seront montés automatiquement. <br>  <i><b>Ceci termine la description du chiffrement du système de blocs avec Windows.</b></i> <br></div></div><br><h2>  [B] LUKS.  Cryptage du système d'exploitation GNU / Linux <i>(~ Debian)</i> installé.  Algorithme et étapes </h2><br>  Afin de crypter la distribution Debian / dérivée installée, vous devez mapper la partition préparée à un périphérique de bloc virtuel, la transférer sur le lecteur GNU / Linux mappé et installer / configurer GRUB2.  Si vous n'avez pas de serveur nu et que vous appréciez votre temps, vous devez utiliser l'interface graphique et la plupart des commandes de terminal décrites ci-dessous sont censées être pilotées en «mode Chuck-Norris». <br><br>  <b>B1.</b>  <b>Télécharger le PC à partir de GNU / Linux usb en direct</b> <br><br>  "Effectuer un test cryptographique sur les performances du fer" <br><br><pre> <code class="bash hljs">lscpu &amp;&amp; ryptsetup benchmark</code> </pre> <br><img src="https://habrastorage.org/webt/xm/t5/ko/xmt5koolr78zxwr0rwicahnlr78.jpeg"><br><br>  Si vous êtes un heureux propriétaire d'une voiture puissante avec prise en charge matérielle pour AES-NI, les chiffres ressembleront au côté droit du terminal, si vous êtes satisfait, mais avec du fer antique - sur le côté gauche. <br><br>  <b>B2.</b>  <b>Partitionnement d'un disque.</b>  <b>montage / formatage du disque dur du lecteur logique fs dans Ext4 (Gparted)</b> <br><br><div class="spoiler">  <b class="spoiler_title">B2.1.</b>  <b class="spoiler_title">Créer un en-tête de partition sda7 chiffré</b> <div class="spoiler_text">  Je décrirai les noms des sections, ci-après, selon mon tableau de section ci-dessus.  Selon la disposition de votre disque, vous devez remplacer vos noms de partition. <br><br>  Mappage du chiffrement du disque logique <i>(/ dev / sda7&gt; / dev / mapper / sda7_crypt).</i> <br>  # Création facile d'une «partition LUKS-AES-XTS» <br><br><pre> <code class="bash hljs">cryptsetup -v -y luksFormat /dev/sda7</code> </pre> <br>  Options: <br><br>  * luksFormat - initialisation de l'en-tête LUKS; <br>  * -y est une phrase secrète (pas une clé / un fichier); <br>  * -v -verbalisation (sortie d'informations dans le terminal); <br>  * / dev / sda7 - votre lecteur logique de la partition étendue <i>(à l'endroit où vous prévoyez de transférer / chiffrer GNU / Linux)</i> . <br><br>  Par défaut, l'algorithme de chiffrement est &lt;L <i>UKS1: aes-xts-plain64, clé: 256 bits, hachage de l'en-tête LUKS: sha256, RNG: / dev / urandom</i> &gt; <i>(dépend de la version de cryptsetup).</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># default-  cryptsetup --help #     .</span></span></code> </pre> <br>  En l'absence de prise en charge matérielle d'AES sur le CPU, la création d'une «partition LUKS-Twofish-XTS» étendue est le meilleur choix. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.2.</b>  <b class="spoiler_title">Création avancée d'une «partition LUKS-Twofish-XTS»</b> <div class="spoiler_text"><pre> <code class="bash hljs">cryptsetup luksFormat /dev/sda7 -v -y -c twofish-xts-plain64 -s 512 -h sha512 -i 1500 --use-urandom</code> </pre> <br>  Options: <br>  * luksFormat - initialisation de l'en-tête LUKS; <br>  * / dev / sda7 votre futur lecteur logique chiffré; <br>  * -v verbalisation; <br>  * -y demande de confirmation d'une phrase secrète; <br>  * -c sélection de l'algorithme de chiffrement des données; <br>  * -s taille de clé de cryptage; <br>  * -h algorithme de hachage / fonction de chiffrement, utilisé par le RNG <i>(--use-urandom)</i> pour générer une clé de chiffrement / déchiffrement unique pour l'en-tête du lecteur logique, clé d'en-tête secondaire (XTS);  la clé principale unique stockée dans l'en-tête chiffré du disque, la clé XTS secondaire, toutes ces métadonnées et la routine de chiffrement qui, à l'aide de la clé principale et de la clé XTS secondaire, chiffrent / déchiffrent toutes les données de la partition <i>(sauf l'en-tête de partition)</i> sont stockées dans ~ 3 Mo sur la partition dure sélectionnée conduire. <br>  * -i Temps d'itération PBKDF pour LUKS (en ms) <i>(le délai lors du traitement d'une phrase secrète affecte le chargement du système d'exploitation et la force cryptographique des clés).</i>  Pour maintenir l'équilibre de la force cryptographique avec un mot de passe simple comme «russe», vous devez augmenter la valeur - (i), avec un mot de passe complexe comme «? 8dƱob / øfh», vous pouvez diminuer la valeur. <br>  * --use-urandom générateur de nombres aléatoires, génère des clés et du sel. <br><br>  Après avoir fait correspondre la section sda7&gt; sda7_crypt <i>(l'opération est rapide, puisqu'un en-tête chiffré avec des métadonnées de ~ 3 Mo est créé et c'est tout)</i> , vous devez formater et monter le système de fichiers sda7_crypt. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.3.</b>  <b class="spoiler_title">Cartographie</b> <div class="spoiler_text"><pre> <code class="bash hljs">cryptsetup open /dev/sda7 sda7_crypt <span class="hljs-comment"><span class="hljs-comment">#       .</span></span></code> </pre><br>  options: <br>  * open - mappez la section "avec un nom"; <br>  * / dev / sda7-lecteur logique; <br>  * sda7_crypt est un mappage de noms utilisé pour monter une partition chiffrée ou l'initialiser au démarrage du système d'exploitation. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.4.</b>  <b class="spoiler_title">Formatage du système de fichiers sda7_crypt dans ext4.</b>  <b class="spoiler_title">Montage OS</b> <div class="spoiler_text">  <i>(Remarque: Gparted ne fonctionnera plus avec une partition chiffrée)</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    mkfs.ext4 -v -L DebSHIFR /dev/mapper/sda7_crypt</span></span></code> </pre><br>  options: <br>  * -v - verbalisation; <br>  * -L -disk label (qui est affiché dans l'explorateur parmi d'autres disques). <br><br>  Ensuite, montez le périphérique de bloc crypté virtuel / dev / sda7_crypt dans le système <br><br><pre> <code class="bash hljs">mount /dev/mapper/sda7_crypt /mnt</code> </pre> <br>  Travailler avec des fichiers dans le dossier / mnt chiffrera / déchiffrera automatiquement les données à la volée dans sda7. <br><br>  Il est plus pratique de mapper et de monter la partition dans l'explorateur <i>(GUI nautilus / caja)</i> , la partition sera déjà dans la liste de sélection de disque, il ne reste plus qu'à saisir la phrase secrète pour ouvrir / décrypter le disque.  Le nom correspondant sera sélectionné automatiquement et non «sda7_crypt», mais quelque chose comme / dev / mapper / Luks-xx-xx ... <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.5.</b>  <b class="spoiler_title">En-tête de disque de sauvegarde (~ métadonnées de 3 Mo)</b> <div class="spoiler_text">  L'une des opérations les plus <b>importantes</b> qui doivent être effectuées sans délai est une copie de sauvegarde de l'en-tête sda7_crypt.  Si vous écrasez / corrompez l'en-tête <i>(par exemple, en installant GRUB2 dans la partition sda7, etc.)</i> , les données chiffrées seront définitivement perdues sans possibilité de les restaurer, car il ne sera pas possible de régénérer les mêmes clés, les clés sont créées uniques. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   cryptsetup luksHeaderBackup --header-backup-file ~/_DebSHIFR /dev/sda7</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   cryptsetup luksHeaderRestore --header-backup-file &lt;file&gt; &lt;device&gt;</span></span></code> </pre> <br>  options: <br>  * commande luksHeaderBackup --header-backup-file-backup; <br>  * commande luksHeaderRestore --header-backup-file-restore; <br>  * ~ / Backup_DebSHIFR - fichier de sauvegarde; <br>  * / dev / sda7 est la partition dont vous souhaitez conserver la copie de sauvegarde de l'en-tête de disque chiffré. <br>  <i><b>Remarque</b></i>  <i>N'essayez pas de restaurer l'en-tête de la section LUKS de [sdaX] à [sdaY], la plupart des noms d'utilisateurs échoueront.</i> <br>  <i><b>À cette étape, &lt;création et modification de la partition chiffrée&gt; est terminée.</b></i> <br></div></div><br>  <b>B3</b>  <b>Migration de GNU / Linux OS <i>(sda4)</i> vers une partition chiffrée <i>(sda7)</i></b> <br><br>  <i><b>Remarque</b></i>  <i>Avant de transférer le système d'exploitation sur une partition chiffrée, il est recommandé de supprimer les fichiers indésirables mis en cache en excès (des fichiers indésirables similaires peuvent être trouvés à l'aide du logiciel BleachBit), par exemple, dans mon cas, il s'agissait de plusieurs centaines de milliers de petits fichiers / var / cache / fontconfig / * et /home/user/.cache / fontconfig / *</i> <i><br></i>  <i>Si vous avez nettoyé les fichiers fontconfig, faites $ fc-cache -fvr</i> <br><br>  Créez le dossier / mnt2 <i>(Remarque - nous travaillons toujours avec live usb, sda7_crypt est monté sur le point / mnt)</i> et montez notre GNU / Linux dans / mnt2, qui doit être chiffré. <br><br><pre> <code class="bash hljs">mkdir /mnt2 mount /dev/sda4 /mnt2</code> </pre><br>  Nous effectuons la migration correcte du système d'exploitation à l'aide du logiciel Rsync <br><pre> <code class="bash hljs">rsync -avlxhHX --progress /mnt2/ /mnt</code> </pre> <br>  Les options Rsync sont décrites à la page E1. <br><br>  Ensuite, <b>vous devez</b> défragmenter la partition du lecteur logique <br><br><pre> <code class="bash hljs">e4defrag -c /mnt/ <span class="hljs-comment"><span class="hljs-comment"># , e4defrag ,     ≈ 0,  ,       ! e4defrag /mnt/ #   GNU/Linux</span></span></code> </pre> <br>  Faites-en une règle: faites e4defrag sur GNU / LInux crypté de temps en temps si vous avez un disque dur. <br>  <i><b>La migration et la synchronisation [GNU / Linux&gt; GNU / Linux-crypté] de cette étape sont terminées.</b></i> <br><br>  <b>B4.</b>  <b>Configuration de GNU / Linux sur une partition chiffrée sda7</b> <br><br>  Après avoir réussi le transfert du système d'exploitation / dev / sda4&gt; / dev / sda7, vous devez vous connecter à GNU / Linux sur la partition chiffrée et effectuer une configuration supplémentaire <i>(sans redémarrer le PC)</i> concernant le système chiffré.  Autrement dit, soyez en live usb, mais les commandes à exécuter sont «relatives à la racine du système d'exploitation chiffré».  Simuler une situation similaire sera "chroot".  Pour recevoir rapidement des informations sur le système d'exploitation sur lequel vous travaillez actuellement <i>(crypté ou non, car les données de sda4 et sda7 sont synchronisées)</i> , <i>désynchronisez le</i> système d'exploitation.  Créez des fichiers de <i>jetons</i> vides dans les répertoires racine <i>(sda4 / sda7_crypt)</i> , par exemple, / mnt / OS crypté et / mnt2 / OS décrypté.  Un contrôle rapide sur quel OS vous êtes <i>(y compris pour l'avenir):</i> <br><pre> <code class="bash hljs">ls /&lt;Tab-Tab&gt;</code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">B4.1.</b>  <b class="spoiler_title">"Simuler une entrée sur un OS chiffré"</b> <div class="spoiler_text"><pre> <code class="bash hljs">mount --<span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /dev /mnt/dev mount --<span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /proc /mnt/proc mount --<span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /sys /mnt/sys chroot /mnt</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">B4.2.</b>  <b class="spoiler_title">Vérifier que le travail est effectué sur un système crypté</b> <div class="spoiler_text"><pre> <code class="bash hljs">ls /mnt&lt;Tab-Tab&gt; <span class="hljs-comment"><span class="hljs-comment">#   "/"</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">history</span></span> <span class="hljs-comment"><span class="hljs-comment">#       su  .</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B4.3.</b>  <b class="spoiler_title">Création / configuration de l'échange crypté</b> <div class="spoiler_text">  Étant donné que le fichier d'échange est formaté à chaque démarrage du système d'exploitation, cela n'a aucun sens de créer et de mapper l'échange à l'unité logique maintenant, et de taper des commandes, comme dans la section B2.2.  Pour Swap, à chaque démarrage, ses clés de chiffrement temporaires seront générées automatiquement.  Cycle de vie des clés swap-a: démonter / déconnecter la partition swap <i>(+ nettoyage RAM)</i> ;  ou redémarrer le système d'exploitation.  En configurant le swap, ouvrez le fichier responsable de la configuration des périphériques chiffrés par bloc <i>(un analogue du fichier fstab, mais responsable de la cryptographie).</i> <br><br><pre> <code class="bash hljs">nano /etc/crypttab</code> </pre> <br>  règle <br><blockquote>  # "Nom cible" "périphérique source" "fichier clé" "options" <br>  swap / dev / sda8 / dev / urandom swap, cipher = twofish-xts-plain64, taille = 512, hachage = sha512 </blockquote><br>  Les options <br>  * swap est le nom de chiffrement mappé de / dev / mapper / swap. <br>  * / dev / sda8 - utilisez votre partition logique sous swap. <br>  * / dev / urandom - générateur de clés de chiffrement aléatoire pour l'échange (de <i>nouvelles clés sont créées à chaque nouveau démarrage du système d'exploitation).</i>  Le générateur / dev / urandom est moins aléatoire que / dev / random, après tout, / dev / random est utilisé lorsque vous travaillez dans des circonstances paranoïaques dangereuses.  Lors du démarrage de l'OS, / dev / random ralentit le chargement pendant plusieurs ± minutes <i>(voir systemd-analyse)</i> . <br>  * swap, cipher = twofish-xts-plain64, size = 512, hash = sha512: -la section sait qu'elle est swap et est formatée "en conséquence";  algorithme de chiffrement. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   fstab nano /etc/fstab</span></span></code> </pre><br>  règle <br><blockquote>  # swap était sur / dev / sda8 lors de l'installation <br>  / dev / mapper / swap aucun swap sw 0 0 <br></blockquote><br>  / dev / mapper / swap est le nom qui a été défini dans crypttab. <br><br>  <b>Échange crypté alternatif</b> <br>  Si, pour une raison quelconque, vous ne voulez pas donner toute la section au fichier d'échange, vous pouvez opter pour une solution alternative et meilleure: créer un fichier d'échange dans un fichier sur une partition chiffrée avec le système d'exploitation. <br><br><pre> <code class="bash hljs">fallocate -l 3G /swap <span class="hljs-comment"><span class="hljs-comment">#   3 (  ) chmod 600 /swap #  mkswap /swap #     swapon /swap #  swap free -m #,       printf "/swap none swap sw 0 0" &gt;&gt; /etc/fstab #    swap  </span></span></code> </pre> <br>  <i><b>La configuration de la partition de swap est terminée.</b></i> <br><br></div></div><br><div class="spoiler">  <b class="spoiler_title">B4.4.</b>  <b class="spoiler_title">Configuration de GNU / Linux crypté (modification des fichiers crypttab / fstab)</b> <div class="spoiler_text">  Le fichier / etc / crypttab, comme décrit ci-dessus, décrit les périphériques de bloc chiffrés qui sont configurés au démarrage. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/crypttab nano /etc/crypttab</span></span></code> </pre><br>  si vous avez mappé la section sda7&gt; sda7_crypt comme dans la section B2.1 <br><blockquote>  # "Nom cible" "périphérique source" "fichier clé" "options" <br>  sda7_crypt UUID = 81048598-5bb9-4a53-af92-f3f9e709e2f2 aucun luks <br></blockquote><br>  si vous avez mappé la section sda7&gt; sda7_crypt comme dans B2.2 <br><blockquote>  # "Nom cible" "périphérique source" "fichier clé" "options" <br>  sda7_crypt UUID = 81048598-5bb9-4a53-af92-f3f9e709e2f2 aucun chiffre = twofish-xts-plain64, taille = 512, hachage = sha512 </blockquote><br>  si vous avez comparé la section sda7&gt; sda7_crypt comme dans B2.1 ou B2.2, mais que vous ne voulez pas ressaisir le mot de passe pour déverrouiller et démarrer le système d'exploitation, vous pouvez remplacer la clé secrète / fichier aléatoire par le mot de passe <br><blockquote>  # "Nom cible" "périphérique source" "fichier clé" "options" <br>  sda7_crypt UUID = 81048598-5bb9-4a53-af92-f3f9e709e2f2 / etc / skey luks </blockquote><br>  La description <br>  * aucun - signale que lorsque le système d'exploitation démarre, une phrase secrète secrète est requise pour déverrouiller la racine. <br>  * UUID - identifiant de section.  Pour connaître votre identifiant, saisissez le terminal <i>(rappel que pendant tout ce temps et au-delà, vous travaillez dans le terminal dans l'environnement chroot, et non dans un autre terminal usb live).</i> <br><br><pre> <code class="bash hljs">fdisk -l <span class="hljs-comment"><span class="hljs-comment">#   blkid #  - </span></span></code> </pre><br><blockquote>  / dev / sda7: UUID = "81048598-5bb9-4a53-af92-f3f9e709e2f2" TYPE = "crypto_LUKS" PARTUUID = "0332d73c-07" <br>  / dev / mapper / sda7_crypt: LABEL = "DebSHIFR" UUID = "382111a2-f993-403c-aa2e-292b5eac4780" TYPE = "ext4" <br></blockquote><br>  cette ligne est visible lors de la demande de blkid à partir du terminal USB en direct avec sda7_crypt monté). <br> UUID     sdaX <i>( sdaX_crypt!, UUID sdaX_crypt –      grub.cfg).</i> <br> * cipher=twofish-xts-plain64,size=512,hash=sha512 -luks    . <br> * /etc/skey - -,        <i>(  3- ).</i>      8,     &lt;1. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ""   &lt; &gt;  691. head -c 691 /dev/urandom &gt; /etc/skey</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   (691)  7-   luks cryptsetup luksAddKey --key-slot 7 /dev/sda7 /etc/skey</span></span></code> </pre> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  "/ luks-" cryptsetup luksDump /dev/sda7</span></span></code> </pre><br>    : <br><blockquote> (    .    2020.,     LUKS2,  ,    LUKS1.   —  LUKS1      CLI). </blockquote><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Check " " file -s /dev/sda7 /dev/sda7: LUKS encrypted file, ver 1 [twofish, xts-plain64, sha512] UUID: -- #   LUKS /dev/sda7: data #   VeraCrypt</span></span></code> </pre> <br><pre> <code class="bash hljs">cryptsetup luksKillSlot /dev/sda7 7 <span class="hljs-comment"><span class="hljs-comment"># /  7 </span></span></code> </pre> <br><br> /etc/fstab       . <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/fstab nano /etc/fstab</span></span></code> </pre><br><blockquote> # «file system» «mount poin» «type» «options» «dump» «pass» <br> # / was on /dev/sda7 during installation <br> /dev/mapper/sda7_crypt / ext4 errors=remount-ro 0 1 <br></blockquote><br>  <br> * /dev/mapper/sda7_crypt -  sda7&gt;sda7_crypt,     /etc/crypttab. <br> <b> crypttab/fstab .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">B4.5.   .  </b> <div class="spoiler_text"> <b>B4.5.1.   /etc/initramfs-tools/conf.d/resume</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      swap ,  . nano /etc/initramfs-tools/conf.d/resume</span></span></code> </pre><br>   <i>( )</i> "#"  «resume».     . <br><br> <b>B4.5.2.   /etc/initramfs-tools/conf.d/cryptsetup</b> <br><br><pre> <code class="bash hljs">nano /etc/initramfs-tools/conf.d/cryptsetup</code> </pre> <br>   <br><blockquote> # /etc/initramfs-tools/conf.d/cryptsetup <br> CRYPTSETUP=yes <br> export CRYPTSETUP <br></blockquote><br><br> <b>B4.5.3.   /etc/default/grub <i>(       grub.cfg     /boot)</i></b> <br><br><pre> <code class="bash hljs">nano /etc/default/grub</code> </pre> <br>   «GRUB_ENABLE_CRYPTODISK=y» <br>  'y', grub-mkconfig  grub-install         ,        <i>(insmod- &lt;cryptomount/set root&gt;)</i> . <br>    <br><blockquote> GRUB_DEFAULT=0 <br> GRUB_TIMEOUT=1 <br> GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || echo Debian` <br> GRUB_CMDLINE_LINUX_DEFAULT=«acpi_backlight=vendor» <br> GRUB_CMDLINE_LINUX=«quiet splash noautomount» <br> GRUB_ENABLE_CRYPTODISK=y <br></blockquote><br><br> <b>B4.5.4.   /etc/cryptsetup-initramfs/conf-hook</b> <br><br><pre> <code class="bash hljs">nano /etc/cryptsetup-initramfs/conf-hook</code> </pre> <br> ,   &lt;CRYPTSETUP=y&gt;  &lt;#&gt;. <br>   <i>(   ,       ,       initrd.img).</i> <br><br>    : <br><blockquote> KEYFILE_PATTERN="/etc/skey" <br> UMASK=0077 <br></blockquote><br>     «skey»  initrd.img,         <i>(             «skey» ( + ) . .B4.4).</i> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">B4.6.  /boot/initrd.img [version]</b> <div class="spoiler_text">      initrd.img    cryptsetup,   <br><br><pre> <code class="bash hljs">update-initramfs -u -k all</code> </pre> <br>   initrd.img <i>(  «,    »)</i>  ,   cryptsetup, , ,     Nvidia —   .   , ,     .   <i>( chroot ./boot/initrd.img).</i>  <i><b>Attention!</b></i> <i> [update-initramfs -u -k all]  ,  cryptsetup open /dev/sda7 <b>sda7_crypt</b> —     ,    /etc/crypttab,   reboot-a  busybox) <br> <i><b>      .</b></i> <br></i> <br></div></div><br><h2> []    GRUB2/ </h2><br><div class="spoiler"> <b class="spoiler_title">C1.        (    20)</b> <div class="spoiler_text"><pre> <code class="bash hljs">mkfs.ext4 -v -L GRUB2 /dev/sda6</code> </pre> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C2.  /dev/sda6  /mnt</b> <div class="spoiler_text">     chroot,       /mnt2,   /mnt —  . <br>   GRUB2 <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt</code> </pre> <br>       GRUB2,   /mnt/boot/grub/i-386-pc <i>(  , ,  «i386-pc»)</i>   <i>(,     ,   .mod: cryptodisk; luks; gcry_twofish; gcry_sha512; signature_test.mod),</i>    GRUB2  . <br><br><pre> <code class="bash hljs">apt-get update apt-get install grub2</code> </pre><br>  Important!     GRUB2  ,   « »      –     <i>( —   GRUB2 —  «MBR»   live usb)</i> .      / VeraCrypt.    GRUB2,   ,       ,    «MBR».       GRUB2,  <a href="https://www.gnu.org/software/grub/manual/grub/grub.html" rel="nofollow"></a>     –   <i>(    GRUB 2.02 ~BetaX).</i> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C3.  GRUB2    [sda6]</b> <div class="spoiler_text">       [.C.2] <br><br><pre> <code class="bash hljs">grub-install --force --root-directory=/mnt /dev/sda6</code> </pre> <br>  les options <br> * --force - ,   ,        <i>( ).</i> <br> * --root-directory -  &lt;boot/grub&gt;   sda6. <br> * /dev/sda6 - sda  <i>(  &lt;&gt;  /mnt /dev/sda6).</i> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C4.    [grub.cfg]</b> <div class="spoiler_text">    «update-grub2»,        <br><br><pre> <code class="bash hljs">grub-mkconfig -o /mnt/boot/grub/grub.cfg</code> </pre> <br>   /  grub.cfg,      ()      <i>(«grub-mkconfig»       live usb,       Windows 10     —  ).</i>    «»,  «grub.cfg»  ,     ,    GRUB  <i>(       ),</i>  GRUB2   . <br> <b> « »   GRUB2 .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C5. Proof-test   GNU/Linux</b> <div class="spoiler_text">   .    GNU/Linux <i>(   chroot).</i> <br><br><pre> <code class="bash hljs">umount -a <span class="hljs-comment"><span class="hljs-comment">#     GNU/Linux Ctrl+d #   chroot umount /mnt/dev umount /mnt/proc umount /mnt/sys umount -a #     live usb reboot</span></span></code> </pre> <br>       VeraCrypt. <br><img src="https://habrastorage.org/webt/ih/jd/9c/ihjd9ciwkuzmd6mqdwmxhbcgx5q.jpeg"><br><br> *     —    Windows. <br> *  «Esc»   GRUB2,    GNU/Linux –   (sda7_crypt)   /boot/initrd.img ( grub2  uuid « » —    grub2,   , ,   /  ). <br><img src="https://habrastorage.org/webt/e4/j2/jo/e4j2jofau3dugyj7jrnztkzpbn4.jpeg"><br><br> *   ,     (. .B4.4/4.5)        /boot/initrd.img,     / ,      «skey»,      . <br><img src="https://habrastorage.org/webt/rj/76/al/rj76alpbc7ebscvxe2_0uraoaya.jpeg"><br> ( «   »). <br><br> *     GNU/Linux    . <br><img src="https://habrastorage.org/webt/j_/q0/fn/j_q0fnugeazypbbwrv_sym9qxvq.jpeg"><br><br> *      ,    /boot/initrd.img <i>( 4.6).</i> <br><br><pre> <code class="bash hljs">update-initramfs -u -k all</code> </pre> <br>        GRUB2 <i>(  -  live usb)</i>    <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt grub-mkconfig -o /mnt/boot/grub/grub.cfg</code> </pre><br> <b>     GNU/Linux:</b> <br><br><ul><li> GNU/Linuxinux  ,  /boot/kernel and initrd; </li><li>     initrd.img; </li><li>    <i>(    initrd; /   ;    Linux)</i> . </li></ul><br> <b>«  GRUB2»     .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">6.   GRUB2.     +  </b> <div class="spoiler_text"> GNU/Linux  ,     –    BIOS.       GRUB2 ,  /   ,     –   [. . F]. <br>  «» GRUB2      «/». <br><ul><li>    «  »   ,         –     . </li><li>        - ,      CLI,      -GRUB2. </li></ul><br><br><div class="spoiler"> <b class="spoiler_title">6.1.   </b> <div class="spoiler_text"> ,         <br><br><pre> <code class="bash hljs">ls /&lt;Tab-Tab&gt; <span class="hljs-comment"><span class="hljs-comment"># -</span></span></code> </pre> <br>       GRUB2 <br><br><pre> <code class="bash hljs">grub-mkpasswd-pbkdf2 <span class="hljs-comment"><span class="hljs-comment">#/  .</span></span></code> </pre> <br>   . -    <br><blockquote> grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br></blockquote><br>   GRUB <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt</code> </pre> <br>   <br><br><pre> <code class="bash hljs">nano -$ /mnt/boot/grub/grub.cfg</code> </pre> <br>    ,   «grub.cfg»  -  (" --unrestricted" "--user", <br>     <i>(  ### END /etc/grub.d/41_custom ###)</i> <br> <i>«set superusers=»root" <br> password_pbkdf2 root ".</i> <br><br>     <br><blockquote> # This file provides an easy way to add custom menu entries. Simply type the <br> # menu entries you want to add after this comment. Be careful not to change <br> # the 'exec tail' line above. <br> ### END /etc/grub.d/40_custom ### <br><br> ### BEGIN /etc/grub.d/41_custom ### <br> if [ -f ${config_directory}/custom.cfg ]; then <br> source ${config_directory}/custom.cfg <br> elif [ -z "${config_directory}" -a -f $prefix/custom.cfg ]; then <br> source $prefix/custom.cfg; <br> fi <br> set superusers=«root» <br> password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br> ### END /etc/grub.d/41_custom ### <br> # <br></blockquote><br>      «grub-mkconfig -o /mnt/boot/grub/grub.cfg»         grub.cfg,    <i>(/)</i>    GRUB-    <br><br><pre> <code class="bash hljs">nano /etc/grub.d/41_custom</code> </pre> <br><blockquote> cat &lt;&lt; EOF <br> set superusers=«root» <br> password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br> EOF <br></blockquote><br><br>    «grub-mkconfig -o /mnt/boot/grub/grub.cfg», ,   ,     grub.cfg. <br> <b>     GRUB2 .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">6.2.    </b> <div class="spoiler_text"> ,        pgp-  <i>(   ).</i>       : gnuPG; kleopatra/GPA; Seahorse. -        . Seahorse —    3.14.0 <i>( , , V3.20 –     ).</i> <br><br> PGP-  //    su! <br><br>     <br><br><pre> <code class="bash hljs">gpg - -gen-key</code> </pre> <br>    <br><br><pre> <code class="bash hljs">gpg --<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> -o ~/perskey</code> </pre> <br>           <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt <span class="hljs-comment"><span class="hljs-comment">#sda6 –  GRUB2</span></span></code> </pre> <br>   GRUB2 <br><br><pre> <code class="bash hljs">rm -rf /mnt/</code> </pre> <br>  GRUB2  sda6,        GRUB «core.img» <br><br><pre> <code class="bash hljs">grub-install --force --modules=<span class="hljs-string"><span class="hljs-string">"gcry_sha256 gcry_sha512 signature_test gcry_dsa gcry_rsa"</span></span> -k ~/perskey --root-directory=/mnt /dev/sda6</code> </pre> <br>  les options <br> * --force - ,   ,    <i>( ).</i> <br> * --modules=«gcry_sha256 gcry_sha512 signature_test gcry_dsa gcry_rsa» - GRUB2        . <br> * -k ~/perskey -  «PGP-» <i>(    ,   ).</i> <br> * --root-directory -  boot   sda6 <br> /dev/sda6 - sda . <br><br> / grub.cfg <br><br><pre> <code class="bash hljs">grub-mkconfig -o /mnt/boot/grub/grub.cfg</code> </pre> <br>     «grub.cfg»  «trust /boot/grub/perskey» <i>(  pgp-.)</i>     GRUB2   ,       «signature_test.mod»,          «set check_signatures=enforce». <br><br>     <i>(    grub.cfg)</i> <br><blockquote> ### BEGIN /etc/grub.d/41_custom ### <br> if [ -f ${config_directory}/custom.cfg ]; then <br> source ${config_directory}/custom.cfg <br> elif [ -z "${config_directory}" -a -f $prefix/custom.cfg ]; then <br> source $prefix/custom.cfg; <br> fi <br> trust /boot/grub/perskey <br> set superusers=«root» <br> password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br> ### END /etc/grub.d/41_custom ### <br> # </blockquote><br><br>   "/boot/grub/perskey"       ,  hd0,6,    «»    ,    GRUB2 <i>(. set rot=..).</i> <br><br>  GRUB2 <i>(     /GRUB)</i>   «perskey». <br>  ,   <i>(  nautilus/caja):</i>     «seahorse»  .         su. <br>    sudo "/mnt/boot" –  – .       <br><br><img src="https://habrastorage.org/webt/ja/bw/id/jabwidfus4xnsjb774pllt4z1hc.jpeg"><br><br>   "/mnt/boot/grub/perskey" <i>(   grub)</i>       . ,   /    [*.sig]. <br>    "/boot" <i>( kernel, initrd).</i>    - ,      bash-   « ». <br><br>      <i>( -   )</i> <br><br><pre> <code class="bash hljs">rm -f $(find /mnt/boot/grub -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.sig'</span></span>)</code> </pre> <br>        ,    ,    GRUB2. <br><br><pre> <code class="bash hljs">apt-mark hold grub-common grub-pc grub-pc-bin grub2 grub2-common</code> </pre> <br> <b>   &lt;   &gt;   GRUB2 .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C6.3. Proof-test  GRUB2,     </b> <div class="spoiler_text"> GRUB2.   -  GNU/Linux    CLI <i>( )</i>   .    /    initrd <br><br><img src="https://habrastorage.org/webt/wu/ip/nt/wuipntxpfzxczd8sz-_nihhtkrc.jpeg"><br> ,   GRUB2-. <br><br>   -   GRUB2/   grub.cfg,   /,   .mod,    .  GRUB2 . <br><br><img src="https://habrastorage.org/webt/1j/cn/ao/1jcnaogftdd3pme8jexwyrzhe_m.jpeg"><br> ,    GRUB2 « ». <br><br>  «»  « »,     «0».        <i>(  «      »         «0» —  ).</i> <br><br>     ? <br><br>   : /  GRUB2 , ,   luks.mod.sig   . <br><br>  :   CLI     <br><br><pre> <code class="bash hljs">trust_list</code> </pre> <br>      «perskey»,   «0»,     ,  .C6.2. <br> <b>     « GRUB2    » .</b> <br></div></div><br></div></div><br><div class="spoiler"> <b class="spoiler_title">7     GRUB2   </b> <div class="spoiler_text">    «  /» —  . -  GRUB2,       ,      .[F].  ,   /   . <br><br><h4>   GRUB2    </h4><br> <b>  :</b> <br><br><ul><li>    / <i>(/    <u>  </u> .      GRUB2   ,    ,        /   ,    ,   «- »          ).</i> </li><li>   <i>(      ).</i> </li><li>  <i>(/     GRUB2   ).</i> </li><li>    . </li></ul><br> <b>  .</b> <br><br><ul><li>   <i>(,      ).</i> </li><li> The Worst Evil Script <i>( /:       GRUB  ,   usb-/ , /       ,      pass/_LUKS   ).</i> </li><li>    <i>(           GNU/Linux).</i> </li></ul><br>    — <a href="http://bit.ly/2QrQk2O" rel="nofollow"> </a> ,       . <br><br> <b>     GRUB2/</b> <br><br> «»  GRUB2,               ().    ,       ,        <br><br><div class="spoiler"> <b class="spoiler_title">.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/o9/nz/e0/o9nze0_csyzmfb7wrozs4efqqto.gif"><br></div></div><br>    ,        GRUB, save log,         pas/_LUKS  . <br>    The Worst Evil Script    <s></s>         (  cryptsetup reencrypt),    LUKS  . <br>         GRUB,     . <br>    "-$ _GRUB"         ,      CLI. <br>    "-$ sudo _GRUB"     GRUB2/     <i>(   /boot),    .</i> <br><br> <b>      </b> <br><br> <b>0)</b>  / GRUB,     /media/username <br><pre> <code class="bash hljs">-$ hashdeep -c md5 -r /media/username/GRUB &gt; /podpis.txt</code> </pre> <br> <b>1)</b>         ~/podpis,      744     «». <br><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #      GRUB2  . #  " /  ",        . !    :   GRUB2     OS GNU/Linux. echo -e "******************************************************************\n" &gt;&gt; '/var/log/podpis.txt' &amp;&amp; date &gt;&gt; '/var/log/podpis.txt' &amp;&amp; hashdeep -vvv -a -k '/podpis.txt' -r '/media/username/GRUB' &gt;&gt; '/var/log/podpis.txt' a=`tail '/var/log/podpis.txt' | grep failed` #  "cat"!! b="hashdeep: Audit failed" #:    -      GRUB2         "  "      gif- "warning". if [[ "$a" = "$b" ]] then echo -e "****\n" &gt;&gt; '/var/log/vtorjenie.txt' &amp;&amp; echo "vtorjenie" &gt;&gt; '/var/log/vtorjenie.txt' &amp;&amp; date &gt;&gt; '/var/log/vtorjenie.txt' &amp; sudo -u username DISPLAY=:0 eom '/warning.gif' fi</span></span></code> </pre> <br></div></div><br>    <i>su</i> ,     GRUB   , save . <br><br>   , , « » [virus.mod]   GRUB2    /: <br><br><pre> <code class="bash hljs">-$ hashdeep -vvv -a -k <span class="hljs-string"><span class="hljs-string">'/podpis.txt'</span></span> -r <span class="hljs-string"><span class="hljs-string">'/media/username/GRUB</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title"> CLI      --</b> <div class="spoiler_text"> #   CLI <br><br><pre> <code class="bash hljs">  2 11::41 MSK 2020 /media/username/GRUB/boot/grub/virus.mod: Moved from /media/username/GRUB/1nononoshifr /media/username/GRUB/boot/grub/i386-pc/mda_text.mod: Ok /media/username/GRUB/boot/grub/grub.cfg: Ok hashdeep: Audit failed Input files examined: 0 Known files expecting: 0 Files matched: 325 Files partially matched: 0 Files moved: 1 New files found: 0 Known files not found: 0</code> </pre> <br> #   «Files moved: 1  Audit failed» ,    . <br> -     «New files found» &gt; «Files moved» <br></div></div><br> <b>2)</b>    &gt; ~/warning.gif,   744. <br><br> <b>3)</b>  fstab    GRUB   <br><br><pre> <code class="bash hljs">-$ sudo nano /etc/fstab</code> </pre> <br><blockquote> LABEL=GRUB /media/username/GRUB ext4 defaults 0 0 </blockquote><br> <b>4)</b>    <br><br><pre> <code class="bash hljs">-$ sudo nano /etc/logrotate.d/podpis</code> </pre> <br><blockquote> /var/log/podpis.txt { <br> daily <br> rotate 50 <br> size 5M <br> dateext <br> compress <br> delaycompress <br> olddir /var/log/old <br>  } <br><br> /var/log/vtorjenie.txt { <br> monthly <br> rotate 5 <br> size 5M <br> dateext <br> olddir /var/log/old <br>  } </blockquote><br> <b>5)</b>    cron <br><br><pre> <code class="bash hljs">-$ sudo crontab -e</code> </pre> <br><blockquote> <a href="https://habr.com/ru/users/reboot/" class="user_link">reboot</a> '/podpis' #     <br> 0 */6 * * * '/podpis #   0-00; 6; 12; 18. <br></blockquote><br> <b>6)</b>    <br><br><pre> <code class="bash hljs">-$ sudo su -$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"alias _GRUB='hashdeep -c md5 -r /media/username/GRUB &gt; /podpis.txt'"</span></span> &gt;&gt; /root/.bashrc &amp;&amp; bash -$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"alias _GRUB='hashdeep -vvv -a -k '/podpis.txt' -r /media/username/GRUB'"</span></span> &gt;&gt; .bashrc &amp;&amp; bash</code> </pre><br>    <code>-$ apt-get upgrade</code>    GRUB <br> <code>-$ _GRUB</code> <br> <b>      GRUB .</b> <br></div></div><br><h2> [D]  —    </h2><br><blockquote>      ,  «     »,       . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme d'habitude, il existe divers "mythes et </font></font><a href="https://docs.bleachbit.org/doc/shred-files-and-wipe-disks.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">légendes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " sur la récupération des données après leur suppression du disque dur. Si vous croyez en la cyber détention, ou êtes membre de la communauté Web Dr et n'avez jamais essayé de restaurer les données après les avoir supprimées / écrasées </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(par exemple, en utilisant la récupération R-studio)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors la méthode proposée ne vous convient probablement pas, utilisez ce qui est le plus proche de vous. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Après avoir réussi à transférer GNU / Linux sur une partition cryptée, l'ancienne copie doit être supprimée sans possibilité de récupération de données. Méthode de nettoyage universelle: logiciel pour Windows / Linux logiciel GUI gratuit </font></font><a href="https://www.bleachbit.org/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BleachBit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formatez rapidement </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la partition</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur laquelle vous souhaitez détruire les données </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(à l'aide de Gparted),</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous démarrons BleachBit, sélectionnez "Effacer l'espace libre" - sélectionnez la partition </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(votre sdaX avec la copie précédente de GNU / Linux)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le processus de nettoyage démarre. </font><font style="vertical-align: inherit;">BleachBit - essuie le disque en un seul passage - c'est ce dont "nous avons besoin", Mais! </font><font style="vertical-align: inherit;">cela ne fonctionne en théorie que si vous avez formaté le disque et le nettoyé dans le logiciel BB v2.0. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attention</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font><font style="vertical-align: inherit;">BB efface le disque, laissant les métadonnées: les noms des fichiers détruits sont enregistrés lors de l' </font><i><font style="vertical-align: inherit;">effacement des</font></i><font style="vertical-align: inherit;"> données </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Ccleaner - ne laisse pas de métadonnées).</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et le mythe de la récupération de données n'est pas tout à fait un mythe.</font></font></b> <div class="spoiler_text"> Bleachbit V2.0-2   unstable OS Debian <i>(    : sfill; wipe-Nautilus -       )</i>      :  «  » <b> </b>  HDD/ <i>(ntfs/ext4)</i> .           ,    .   <i>()</i>   /    /    «»   .   ,   ,   ,   <b>« »  </b>   3+   . <br>  GNU/Linux  Bleachbit <b>2.0-2</b>        ,     .  :  Windows   CCleaner  «  ntfs»  ,        . <br><br>  ,    <u>«»</u>   , <b>   Bleachbit   </b> , ,   « / ». <br>   «    »  Windows  CCleaner/BB   «».  GNU/Linux    <i>(  )</i>      <i>( +           (  ,  ))</i> ,                . <br><br> Bleachbit v3.0  , ,   . <br> Bleachbit v2.0     GNU/Linux   Windows7. <br></div></div><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À cette étape, le «nettoyage du disque» est terminé.</font></font></b> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [E] Sauvegarde universelle du système d'exploitation chiffré </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque utilisateur a sa propre méthode de sauvegarde des données, mais les données chiffrées du «système d'exploitation» nécessitent une approche légèrement différente de la tâche. </font><font style="vertical-align: inherit;">Les logiciels unifiés tels que Clonezilla et les logiciels similaires ne peuvent pas fonctionner directement avec des données chiffrées. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Définition de la tâche de sauvegarde des périphériques de bloc chiffrés:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> universalité - le même algorithme / logiciel de sauvegarde pour Windows / Linux; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la possibilité de travailler dans la console avec n'importe quel GNU / Linux usb en direct sans avoir besoin de téléchargements de logiciels supplémentaires </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(mais toujours recommander une interface graphique)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sécurité des sauvegardes - les «images» stockées doivent être cryptées / protégées par mot de passe; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la taille des données chiffrées doit correspondre à la taille des données réelles copiées; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extraction pratique des fichiers nécessaires à partir de la copie de sauvegarde </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(pas besoin de décrypter d'abord la partition entière).</font></font></i> </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Par exemple, sauvegarde / restauration via l'utilitaire «dd» </font></font><br><br><pre> <code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/sda7 of=//sda7.img bs=7M conv=sync,noerror dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=//sda7.img of=/dev/sda7 bs=7M conv=sync,noerror</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il correspond à presque tous les points de la tâche, mais selon la revendication 4, il ne résiste pas aux critiques, car il copie la partition de disque dans son ensemble, y compris l'espace libre - ce n'est pas intéressant. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, une sauvegarde de GNU / Linux via l'archiveur [tar | </font><font style="vertical-align: inherit;">gpg] "pratique", mais pour la sauvegarde Windows, vous devez chercher une autre solution - pas intéressante.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E1. </font><font style="vertical-align: inherit;">Sauvegarde universelle de Windows / Linux (ensemble rsync (Grsync) + volume VeraCrypt) et disques chiffrés à montage automatique</font></font></b> <div class="spoiler_text"> <b>   :</b> <br><br><ol><li>    <i>(/)</i> VeraCrypt  ; </li><li> /     Rsync   VeraCrypt; </li><li>     VeraCrypt  www. </li></ol><br><br> <i>   VeraCrypt   : <br></i> <ol><li>    <i>(  <u>    Windows</u> ,     GNU/Linux)</i> ; </li><li>   ,    « » <i>(  )</i> –  . </li></ol><br><br>        Windows,       GNU/Linux &gt; VeraCrypt ,        . <br><br>   Twofish  70   <i>( ,    )</i>  HDD ~   <i>(      ,   ).</i>  VeraCrypt Windows/Linux        ,       «   »,     . <br><br>  2017      VeraCrypt     «      GNU/Linux».   <i> en &gt; ru</i> : <br><br><blockquote>     ,      <br>    ,       .… <br><br>         Linux. <br>     ,       . <br>  ,    . </blockquote><br>  ,   VeraCrypt      HDD   . <br>     ,     ,    <i>( «»    ).</i> <br><br>     VeraCrypt 1.24-Update3        GNU/Linux,      (/dev/sdaX). <br><img src="https://habrastorage.org/webt/ix/pj/dk/ixpjdk9i1dlmojr7obxa49wobey.png"><br>  / —    VeraCrypt-. <br><br>    VeraCrypt <i>(/ntfs)</i> ,     . <br><br> //   VeraCrypt GUI &gt; GNU/Linux live usb <i>(    /media/veracrypt2,   Windows   /media/veracrypt1).</i>      Windows   GUI rsync <i>(grsync)</i> ,  . <br><br><img src="https://habrastorage.org/webt/py/0v/hw/py0vhwm-rlgyctkndhzgcyrzpu8.jpeg"><br><br>   .    ,      . <br><br>      GNU/Linux,    GUI rsync «  Windows». <br><br> <b></b> !  Veracrypt  « GNU/Linux»     <b>ext4</b> .      ntfs,        /    . <br><br>       .    rsync: <br> * -g - ; <br> * -P --progress —     ; <br> * -H - ,  ; <br> * - -  <i>(  rlptgoD)</i> ; <br> * -v -. <br><br>    « Windows VeraCrypt»     cryptsetup,   alias (su) <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"alias veramount='cryptsetup open --veracrypt --tcrypt-system --type tcrypt /dev/sdaX Windows_crypt &amp;&amp; mount /dev/mapper/ Windows_crypt /media/veracrypt1'"</span></span> &gt;&gt; .bashrc &amp;&amp; bash</code> </pre><br>    «veramount <s>pictures</s> »      ,   - ,    Windows. <br><br> / <b>  VeraCrypt</b>  cryptsetup  <br><br><pre> <code class="bash hljs">cryptsetup open --veracrypt --tcrypt-system --<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> tcrypt /dev/sdaX Windows_crypt mount /dev/mapper/Windows_crypt /mnt</code> </pre> <br> / <b>/ VeraCrypt</b>  cryptsetup  <br><br><pre> <code class="bash hljs">cryptsetup open --veracrypt --<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> tcrypt /dev/sdaY test_crypt mount /dev/mapper/test_crypt /mnt</code> </pre> <br><br> <b> alias-  (  )      Windows     ntfs   GNU/Linux   /</b> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /   ntfs- mkdir /media/Winda7 &amp;&amp; mkdir /media/</span></span></code> </pre> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      VeraCrypt,  " "    printf 'bob' | base64 Ym9i #  cli   "bob"</span></span></code> </pre> <br>       ~/VeraOpen.sh <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Ym9i'</span></span> | base64 -d | cryptsetup open --veracrypt --tcrypt-system --<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> tcrypt /dev/sda3 Windows_crypt &amp;&amp; mount /dev/mapper/Windows_crypt /media/Winda7 <span class="hljs-comment"><span class="hljs-comment">#   base64 (bob)             Windows. echo 'Ym9i' | base64 -d | cryptsetup open --veracrypt --type tcrypt /dev/sda1 ntfscrypt &amp;&amp; mount /dev/mapper/ntfscrypt /media/ #,     ntfs.</span></span></code> </pre><br>  «» : <pre> <code class="bash hljs">sudo chmod 100 /VeraOpen.sh</code> </pre> <br><br>     ( !)  /etc/rc.local  ~/etc/init.d/rc.local <br>   <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh -e # # rc.local # # This script is executed at the end of each multiuser runlevel. # Make sure that the script will «exit 0» on success or any other # value on error. # # In order to enable or disable this script just change the execution # bits. # # By default this script does nothing. sh -c "sleep 1 &amp;&amp; '/VeraOpen.sh'" #  ,  ~ 1     . exit 0</span></span></code> </pre> <br>  «» : <pre> <code class="bash hljs">sudo chmod 100 /etc/rc.local &amp;&amp; sudo chmod 100 /etc/init.d/rc.local</code> </pre> <br> ,    GNU/Linux         ntfs,   . <br>   ,      : <br><pre> <code class="bash hljs">systemd-analyze &amp;&amp; systemd-analyze blame</code> </pre> <br><br> <i><b>   ,     .E1   (    / OS GNU/Linux)</b></i> <br> 1)     ext4 &gt; 4gb ( ) Linux  Veracrypt []. <br> 2) Reboot  live usb. <br> 3) ~$ cryptsetup open /dev/sda7 Lunux #  . <br> 4) ~$ mount /dev/mapper/Linux /mnt #    /mnt. <br> 5) ~$ mkdir mnt2 #    . <br> 6) ~$ cryptsetup open --veracrypt --type tcrypt ~/  &amp;&amp; mount /dev/mapper/ /mnt2 #  Veracrypt   «»     /mnt2. <br> 7) ~$ rsync -avlxhHX --delete --progress /mnt/ /mnt2 #  /      Veracrypt  .  "--delete"      ( ), ..       . <br><br> (p/s/ <b></b> !     GNU/Linux   /  , , Intel &gt; AMD <i>(            Intel &gt; AMD)</i> , <b> </b>          , .   ~/etc/skey —       ,    «cryptsetup luksAddKey»     chroot —  ,   ~/etc/crypttab   "/etc/skey"  «none»,  rebot-          . <br><br> <u>  IT         Windows/Linux,      .</u> <br> <b>    /   .</b> <br></div></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [F] Attaque sur le chargeur de démarrage GRUB2 </font></font></h2><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Détails</font></font></b> <div class="spoiler_text">        /  <i>( .C6.)</i> ,        .    - ,    <i>(   )</i> GRUB2       ,    <i>(       ,      --  grub.cfg).</i> <br><br>  .  <br><br> *    live usb.   <i>()</i>           .    GRUB2   grub.cfg <i>(    )</i>      <i>(  ,   GRUB2,     .    &lt;0&gt;)</i> <br> *   ,    "/mnt/boot/grub/grub.cfg". <br> *   <i>( «perskey»   core.img)</i> <br><br><pre> <code class="bash hljs">grub-install --force --root-directory=/mnt /dev/sda6</code> </pre> <br> *  «grub.cfg» &gt; "/mnt/boot/grub/grub.cfg",    , ,    «keylogger.mod»     ,  «grub.cfg» &gt;  «insmod keylogger». , ,   ,    GRUB2 <i>(    )</i>     GRUB2,  «grub-mkimage   (-).»  «-»        «grub.cfg».        :    «modern.cfg», , ,  ~400  <i>(+)</i>   "/boot/grub/i386-pc".          ,   "/boot/grub/grub.cfg",     «hashsum»        . <br>  /  GRUB2   ,      <i>(  )</i> "/boot/grub/grub.cfg"   «modern.cfg» <br><blockquote> set superusers=«root» <br> password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br></blockquote><br>     -      GRUB2. <br><br>   <i>(   )</i> ,   ,    <i>(    )</i> . - BIOS     <i>(     GRUB2 &gt;  GRUB2, !)</i> .   -     ,    ,     <i>( )</i> «grub.cfg»   .      ,  , ,     «grub.cfg» <i>(  )   ,     GRUB2.</i> <br><br>     ,  /    sdaY,    GRUB2 <i>( grub-install    )</i>   «grub.cfg» <i>( )</i>     <br><blockquote> menuentry 'GRUBx2' --class parrot --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-382111a2-f993-403c-aa2e-292b5eac4780' { <br> load_video <br> insmod gzio <br> if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi <br> insmod part_msdos <br> insmod cryptodisk <br> insmod luks <br> insmod gcry_twofish <br> insmod gcry_twofish <br> insmod gcry_sha512 <br> insmod ext2 <br> cryptomount -u 15c47d1c4bd34e5289df77bcf60ee838 <br> set root='cryptouuid/15c47d1c4bd34e5289df77bcf60ee838' <br> normal /boot/grub/grub.cfg <br>  } <br></blockquote><br>  <br> * insmod -       ; <br> * GRUBx2 -      GRUB2; <br> * cryptomount -u 15c47d1c4bd34e5289df77bcf60ee838 -. fdisk -l (sda9); <br> * set root - ; <br> * normal /boot/grub/grub.cfg -     . <br><br>   ,     «grub.cfg» —      / «sdaY»    «GRUBx2»   GRUB. <br><br>    CLI,    <i>(      «set root»),</i>    , ,    "/shifr_grub",    "/noshifr_grub".   CLI <br><br><pre> <code class="bash hljs">cat /Tab-Tab</code> </pre> <br>    ,       ,       . , ,              "~/i386",          . <br><br>    ,       <i>( )</i> ,      ,  CLI   <br><br><pre> <code class="bash hljs">list_trusted</code> </pre> <br>      «perskey»,    ,    <i>(   «set check_signatures=enforce»)</i> . <br>    ,   .      «grub.cfg»     ,           ,      ,   GRUB2. <br>      :    <a href="https://www.gnu.org/software/grub/manual/grub/grub.html" rel="nofollow"></a> .18.2   <blockquote> «Note that even with GRUB password protection, GRUB itself cannot prevent someone with physical access to the machine from altering that machine's firmware (eg, Coreboot or BIOS) configuration to cause the machine to boot from a different (attacker-controlled) device. GRUB is at best only one link in a secure boot chain». </blockquote><br> GRUB2 —   ,      ,         MS-DOS,      . ,  GRUB2 — «»   ,   GNU/Linux    . <br><br>  ,  ,       GRUB2,        <i>(,   ,     –      /.mod)</i> . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qhmsLeAN2Ag" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conclusions: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Le chiffrement du système de blocs pour Windows est plus facile à mettre en œuvre, et la protection avec un seul mot de passe est plus pratique que la protection avec plusieurs mots de passe avec le chiffrement du système de blocs GNU / Linux, pour être honnête: ce dernier est automatisé. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) L'article a été écrit comme un </font><font style="vertical-align: inherit;">guide </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pertinent et détaillé </font><font style="vertical-align: inherit;">pour le cryptage complet du disque VeraCrypt / LUKS sur une maison de la machine, qui, de loin, est le meilleur en runet (IMHO). Le manuel&gt; 60k caractères n'a donc pas abordé certains chapitres intéressants: sur les cryptographies qui </font></font><a href="https://en.wikipedia.org/wiki/Talk:FreeOTFE" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disparaissent</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><a href="https://diskcryptor.net/forum/index.php%3Ftopic%3D5347.msg13975" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">restent</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans l' </font></font><a href="https://www.schneier.com/blog/archives/2014/05/truecrypt_wtf.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ombre</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; que dans divers livres GNU / Linux peu / n'écrivent pas sur la cryptographie; À propos de l'article 51 de la Constitution de la Fédération de Russie; sur l' </font></font><a href="http://www.consultant.ru/document/cons_doc_LAW_128739/1aad6fe079cd2555c9c329d872dfca33764f738f/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">octroi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><a href="http://www.consultant.ru/document/cons_doc_LAW_128739/1aad6fe079cd2555c9c329d872dfca33764f738f/" rel="nofollow"><font style="vertical-align: inherit;">licences</font></a><font style="vertical-align: inherit;"> / l'interdiction du </font></font><a href="http://www.consultant.ru/document/cons_doc_LAW_128739/5b53393f08d12d297d683284d87338c801ed859b/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chiffrement dans la Fédération de Russie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sur ce dont vous avez besoin pour crypter le "root / boot". </font><font style="vertical-align: inherit;">Le manuel s'est avéré déjà considérable, mais détaillé </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(décrivant même des étapes simples)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , à son tour, cela vous fera gagner beaucoup de temps lorsque vous effectuez un «vrai chiffrement». </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Chiffrement complet du disque effectué sur Windows 7 64; </font><font style="vertical-align: inherit;">GNU / Linux Parrot 4x; </font><font style="vertical-align: inherit;">GNU / Debian 9.0 / 9.5. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Implémentation d'une attaque réussie sur </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">votre</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chargeur de démarrage GRUB2. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5) Un didacticiel a été créé pour aider tous les </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pays paranoïaques de la CEI</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , où le chiffrement est autorisé au niveau législatif. </font><font style="vertical-align: inherit;">Et tout d'abord, pour ceux qui souhaitent effectuer un chiffrement intégral du disque sans démolir leurs systèmes configurés. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6) Révisé et mis à jour son manuel, qui est pertinent en 2020.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [G] Documentation utile </font></font></h2><br><ol><li> <a href="https://www.dropbox.com/s/tg2etzeptae73xa/TrueCrypt%2520%25D0%25B4%25D0%25BE%25D0%25BA%25D1%2583%25D0%25BC%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F%2520%25D0%25BF%25D0%25BE%25D0%25B4%2520%25D1%2581%25D0%25B2%25D0%25BE%25D0%25B1%25D0%25BE%25D0%25B4%25D0%25BD%25D0%25BE%25D0%25B9%2520%25D0%25BB%25D0%25B8%25D1%2586%25D0%25B5%25D0%25BD%25D0%25B7%25D0%25B8%25D0%25B5%25D0%25B9.pdf%3Fdl%3D0" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guide de l'utilisateur TrueCrypt </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(février 2012 RU)</font></font></i> </li><li> <a href="https://www.veracrypt.fr/en/Documentation.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentation de VeraCrypt</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / share / doc / cryptsetup (-run) [ressource locale] </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(documentation officielle détaillée sur la configuration du chiffrement GNU / Linux à l'aide de cryptsetup)</font></font></i> </li><li> <a href="https://gitlab.com/cryptsetup/cryptsetup/-/wikis/FrequentlyAskedQuestions" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FAQ officielle de cryptsetup </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(brève documentation sur la configuration du chiffrement GNU / Linux à l'aide de cryptsetup)</font></font></i> </li><li> <a href="https://wiki.archlinux.org/index.php/Dm-crypt/Device_encryption" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cryptage des périphériques LUKS </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(documentation archlinux)</font></font></i> </li><li> <a href="" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une description détaillée de la syntaxe cryptsetup </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(page de manuel arch)</font></font></i> </li><li> <a href="" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description détaillée de crypttab </font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(page de manuel arch)</font></font></i> </li><li> <a href="https://www.gnu.org/software/grub/manual/grub/grub.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La documentation officielle de GRUB2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tags: VeraCrypt, cryptage complet du disque, cryptage de partition, cryptage complet du disque Linux, cryptage complet du système LUKS1 / LUKS2. </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oeuf de Pâques</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8a/32/f-/8a32f-bolla8my7o-yt9hhlanbi.png"><br> © ,     . <br> <a href="https://habr.com/ru/users/ne555/" class="user_link">ne555</a> 2018-2020 <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482696/">https://habr.com/ru/post/fr482696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482684/index.html">J'ai créé mon propre dipfake en deux semaines et 552 $</a></li>
<li><a href="../fr482686/index.html">Les scientifiques automatisent la recherche sur le comportement animal pour décoder la fonction cérébrale</a></li>
<li><a href="../fr482690/index.html">Créez votre éditeur dans Combine</a></li>
<li><a href="../fr482692/index.html">Intel NUC Home pour le travail et la virtualisation</a></li>
<li><a href="../fr482694/index.html">Y a-t-il une vie après Windows ou où développer un administrateur / ingénieur système Windows en 2020?</a></li>
<li><a href="../fr482698/index.html">[Essai] Dédié à Office Plankton. Je ne suis pas inspiré par mon travail</a></li>
<li><a href="../fr482700/index.html">Comment "foutre" Google et Yandex: promotion SEO en noir et blanc des sites. Shestakov | People PRO # 74</a></li>
<li><a href="../fr482702/index.html">Avons-nous vraiment besoin de TypeScript en 2020?</a></li>
<li><a href="../fr482704/index.html">Synchronisation du cache Redis pour le service Go</a></li>
<li><a href="../fr482706/index.html">Recommandations pour la mise en œuvre de la comptabilité parallèle RAS + IFRS sur la plateforme 1C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>