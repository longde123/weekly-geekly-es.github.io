<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ≥Ô∏è üö¥üèº üë©üèΩ‚Äçüåæ Programmation asynchrone Python: un bref aper√ßu ‚õ±Ô∏è ü§≤üèª üë®‚Äç‚ù§Ô∏è‚Äçüë®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lorsqu'ils parlent de l'ex√©cution d'un programme, alors ¬´ex√©cution asynchrone¬ª signifie une situation o√π le programme n'attend pas l'ach√®vement d'un c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Programmation asynchrone Python: un bref aper√ßu</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/475246/">  Lorsqu'ils parlent de l'ex√©cution d'un programme, alors ¬´ex√©cution asynchrone¬ª signifie une situation o√π le programme n'attend pas l'ach√®vement d'un certain processus, mais continue de fonctionner ind√©pendamment de celui-ci.  Un exemple de programmation asynchrone est un utilitaire qui, fonctionnant de mani√®re asynchrone, √©crit dans un fichier journal.  Bien qu'un tel utilitaire puisse √©chouer (par exemple, en raison d'un manque d'espace disque libre), dans la plupart des cas, il fonctionnera correctement et peut √™tre utilis√© dans divers programmes.  Ils pourront l'appeler, lui transmettre les donn√©es pour l'enregistrement, et apr√®s cela, ils pourront continuer √† faire leur propre chose. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ep/bw/pt/epbwpti391hcs-adu7jr0hcpqrm.jpeg"></a> <br><br>  L'utilisation de m√©canismes asynchrones lors de l'√©criture d'un certain programme signifie que ce programme s'ex√©cutera plus rapidement que sans utiliser de tels m√©canismes.  En m√™me temps, ce qui devrait √™tre lanc√© de mani√®re asynchrone, comme un utilitaire de journalisation, devrait √™tre √©crit en tenant compte des urgences.  Par exemple, un utilitaire de journalisation, si l'espace disque est √©puis√©, peut simplement arr√™ter la journalisation et ne pas "planter" le programme principal avec une erreur. <br><br>  L'ex√©cution de code asynchrone implique g√©n√©ralement l'op√©ration d'un tel code dans un thread s√©par√©.  C'est - si nous parlons d'un syst√®me avec un processeur monoc≈ìur.  Sur les syst√®mes dot√©s de processeurs multic≈ìurs, ce code peut tr√®s bien √™tre ex√©cut√© par un processus utilisant un c≈ìur s√©par√©.  Un processeur monoc≈ìur √† un instant donn√© ne peut lire et ex√©cuter qu'une seule instruction.  C'est comme lire des livres.  Vous ne pouvez pas lire deux livres en m√™me temps. <br><br>  Si vous lisez un livre et que quelqu'un d'autre vous en donne un autre, vous pouvez prendre ce deuxi√®me livre et commencer √† le lire.  Mais le premier devra √™tre report√©.  L'ex√©cution de code multithread est organis√©e sur le m√™me principe.  Et si plusieurs de vos copies lisaient plusieurs livres √† la fois, cela ressemblerait au fonctionnement des syst√®mes multiprocesseurs. <br><a name="habracut"></a><br>  Si sur un processeur monoc≈ìur, il est tr√®s rapide de basculer entre des t√¢ches qui n√©cessitent une puissance de calcul diff√©rente (par exemple, entre certains calculs et la lecture de donn√©es √† partir d'un disque), alors vous pouvez avoir l'impression qu'un c≈ìur √† processeur unique fait plusieurs choses en m√™me temps.  Ou, disons, cela se produit si vous essayez d'ouvrir plusieurs sites dans un navigateur √† la fois.  Si le navigateur utilise un flux s√©par√© pour charger chacune des pages, tout se fera beaucoup plus rapidement que si ces pages se chargeaient une √† la fois.  Le chargement d'une page n'est pas une t√¢che si difficile, il n'utilise pas les ressources du syst√®me au maximum, par cons√©quent, le lancement simultan√© de plusieurs de ces t√¢ches est un mouvement tr√®s efficace. <br><br><h2>  <font color="#3AC1EF">Programmation asynchrone Python</font> </h2><br>  Au d√©part, Python utilisait des coroutines bas√©es sur un g√©n√©rateur pour r√©soudre des t√¢ches de programmation asynchrones.  Puis, en Python 3.4, le module <code>asyncio</code> est <code>asyncio</code> (parfois son nom est √©crit comme <code>async IO</code> ), qui impl√©mente des m√©canismes de programmation asynchrones.  Python 3.5 a introduit la construction async / wait. <br><br>  Afin de faire un d√©veloppement asynchrone en Python, vous devez g√©rer quelques concepts.  Ce sont la coroutine et la t√¢che. <br><br><h2>  <font color="#3AC1EF">Coroutines</font> </h2><br>  En r√®gle g√©n√©rale, la coroutine est une fonction asynchrone.  Coroutine peut √©galement √™tre un objet renvoy√© par une fonction coroutine. <br><br>  Si, lors de la d√©claration d'une fonction, il est indiqu√© qu'elle est asynchrone, alors vous pouvez l'appeler √† l'aide du mot-cl√© <code>await</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> say_after(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'hello'</span></span>)</code> </pre> <br>  Une telle construction signifie que le programme sera ex√©cut√© jusqu'√† ce qu'il rencontre une expression d'attente, apr√®s quoi il appellera la fonction et suspendra son ex√©cution jusqu'√† ce que le travail de la fonction appel√©e soit termin√©.  Apr√®s cela, d'autres coroutines pourront √©galement d√©marrer. <br><br>  La suspension d'un programme signifie que le contr√¥le retourne √† la boucle d'√©v√©nements.  Lorsque vous utilisez le module <code>asyncio</code> , la boucle d'√©v√©nements effectue toutes les t√¢ches asynchrones, effectue les E / S et effectue les sous-processus.  Dans la plupart des cas, les t√¢ches sont utilis√©es pour ex√©cuter la corutine. <br><br><h2>  <font color="#3AC1EF">Les t√¢ches</font> </h2><br>  Les t√¢ches vous permettent d'ex√©cuter des coroutines dans une boucle d'√©v√©nements.  Cela simplifie le contr√¥le d'ex√©cution de plusieurs coroutines.  Voici un exemple qui utilise des coroutines et des t√¢ches.  Notez que les entit√©s d√©clar√©es √† l'aide de la construction <code>async def</code> sont des coroutines.  Cet exemple est tir√© de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation officielle de</a> Python. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">say_after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(delay, what)</span></span></span><span class="hljs-function">:</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(delay)    print(what) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>    task1 = asyncio.create_task(        say_after(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'hello'</span></span>))    task2 = asyncio.create_task(        say_after(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'world'</span></span>))    print(<span class="hljs-string"><span class="hljs-string">f"started at </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{time.strftime(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'%X'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">"</span></span>)    <span class="hljs-comment"><span class="hljs-comment">#     (      #  2 .)    await task1    await task2    print(f"finished at {time.strftime('%X')}") asyncio.run(main())</span></span></code> </pre> <br>  La fonction <code>say_after()</code> a le pr√©fixe <code>async</code> ; par cons√©quent, nous avons coroutine.  Si nous nous √©loignons un peu de cet exemple, nous pouvons dire que cette fonction peut √™tre appel√©e comme ceci: <br><br><pre> <code class="python hljs">    <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> say_after(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'hello'</span></span>)    <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> say_after(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'world'</span></span>)</code> </pre> <br>  Avec cette approche, cependant, les coroutines sont invoqu√©es s√©quentiellement et prennent environ 3 secondes pour se terminer.  Dans notre exemple, ils sont lanc√©s de mani√®re comp√©titive.  Pour chacun d'eux, une t√¢che est utilis√©e.  En cons√©quence, le temps d'ex√©cution de l'ensemble du programme est d'environ 2 secondes.  Veuillez noter que pour qu'un tel programme fonctionne, il ne suffit pas de simplement d√©clarer la fonction <code>main()</code> avec le <code>async</code> .  Dans de telles situations, vous devez utiliser le module <code>asyncio</code> . <br><br>  Si vous ex√©cutez l'exemple de code, un texte similaire au suivant s'affiche √† l'√©cran: <br><br><pre> <code class="python hljs">started at <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> hello world finished at <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span></code> </pre> <br>  Notez que les horodatages des premi√®re et derni√®re lignes diff√®rent de 2 secondes.  Si vous ex√©cutez cet exemple avec un appel s√©quentiel de corutine, la diff√©rence entre les horodatages sera d√©j√† de 3 secondes. <br><br><h2>  <font color="#3AC1EF">Exemple</font> </h2><br>  Dans cet exemple, le nombre d'op√©rations n√©cessaires pour calculer la somme de dix √©l√©ments d'une s√©quence de nombres est d√©termin√©.  Les calculs sont effectu√©s √† partir de la fin de la s√©quence.  Une fonction r√©cursive commence par obtenir le nombre 10, puis s'appelle avec les nombres 9 et 8, additionnant ce qui sera retourn√©.  Cela continue jusqu'√† ce que les calculs soient termin√©s.  Par cons√©quent, il s'av√®re, par exemple, que la somme d'une s√©quence de nombres de 1 √† 10 est 55. En m√™me temps, notre fonction est tr√®s inefficace, la construction <code>time.sleep(0.1)</code> est utilis√©e ici. <br><br>  Voici le code de fonction: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> count    count=count+<span class="hljs-number"><span class="hljs-number">1</span></span>    time.sleep(<span class="hljs-number"><span class="hljs-number">0.1</span></span>)    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>:        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fib(n<span class="hljs-number"><span class="hljs-number">-1</span></span>) + fib(n<span class="hljs-number"><span class="hljs-number">-2</span></span>)    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n start=time.time() <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> count count = <span class="hljs-number"><span class="hljs-number">0</span></span> result = fib(<span class="hljs-number"><span class="hljs-number">10</span></span>) print(result,count) print(time.time()-start)</code> </pre> <br>  Que se passe-t-il si vous r√©√©crivez ce code √† l'aide de m√©canismes asynchrones et appliquez <code>asyncio.gather</code> construction <code>asyncio.gather</code> , qui est charg√©e d'ex√©cuter deux t√¢ches et d'attendre qu'elles se terminent? <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio,time <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> count    count=count+<span class="hljs-number"><span class="hljs-number">1</span></span>    time.sleep(<span class="hljs-number"><span class="hljs-number">0.1</span></span>)    event_loop = asyncio.get_event_loop()    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>:        task1 = asyncio.create_task(fib(n<span class="hljs-number"><span class="hljs-number">-1</span></span>))        task2 = asyncio.create_task(fib(n<span class="hljs-number"><span class="hljs-number">-2</span></span>))        <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.gather(task1,task2)        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task1.result()+task2.result()    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n</code> </pre> <br>  En fait, cet exemple fonctionne m√™me un peu plus lentement que le pr√©c√©dent, car tout est ex√©cut√© dans un seul thread, et les appels √† <code>create_task</code> , <code>gather</code> et d'autres comme √ßa cr√©ent une charge suppl√©mentaire sur le syst√®me.  Cependant, le but de cet exemple est de d√©montrer la capacit√© de participer √† plusieurs t√¢ches et d'attendre qu'elles se terminent. <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  Il existe des situations dans lesquelles l'utilisation des t√¢ches et de la corutine est tr√®s utile. Par exemple, si un programme contient un m√©lange d'entr√©es-sorties et de calculs, ou si diff√©rents calculs sont effectu√©s dans le m√™me programme, vous pouvez r√©soudre ces probl√®mes en ex√©cutant du code dans un environnement comp√©titif plut√¥t que en mode s√©quentiel.  Cela permet de r√©duire le temps n√©cessaire au programme pour effectuer certaines actions.  Cependant, cela ne permet pas, par exemple, d'effectuer des calculs simultan√©ment.  Le multitraitement est utilis√© pour organiser ces calculs.  Il s'agit d'un grand sujet distinct. <br><br>  <b>Chers lecteurs!</b>  Comment √©crivez-vous du code Python asynchrone? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr475246/">https://habr.com/ru/post/fr475246/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr475228/index.html">Fourchette de paie. Vous √™tes programmeur pour maman</a></li>
<li><a href="../fr475236/index.html">N'ignorez plus jamais l'entra√Ænement de renforcement.</a></li>
<li><a href="../fr475240/index.html">Utilisation de modules stricts dans des projets Python √† grande √©chelle: exp√©rience Instagram. Partie 1</a></li>
<li><a href="../fr475242/index.html">Utilisation de modules stricts dans des projets Python √† grande √©chelle: exp√©rience Instagram. 2e partie</a></li>
<li><a href="../fr475244/index.html">Nouvelles fonctionnalit√©s JavaScript attendues que vous devez conna√Ætre</a></li>
<li><a href="../fr475248/index.html">L'utilisation de polyfills lors de l'√©criture d'applications inter-navigateurs</a></li>
<li><a href="../fr475250/index.html">Comme Redash l'a remarqu√© et a corrig√© un probl√®me qui provoquait une d√©gradation des performances du code Python</a></li>
<li><a href="../fr475252/index.html">Comment critiquer Microsoft</a></li>
<li><a href="../fr475254/index.html">Architecture AERODISK vAIR ou caract√©ristiques de la construction d'un cluster national</a></li>
<li><a href="../fr475258/index.html">Une repr√©sentation visuelle des √©lections √† Saint-P√©tersbourg - la magie de l'habillage vocal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>