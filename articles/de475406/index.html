<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺 👩🏿‍🔬 👈🏻 Als ich den Bot für die Schule geschrieben habe d / z und die Datenbank geändert habe 👨🏾‍🤝‍👨🏽 🔗 🗃️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo, Khabrovsk Bürger! 
 Heute werde ich versuchen, Ihnen zu erklären, wie ein Student einen Bot zum Speichern von Hausaufgaben für VK schreiben kan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Als ich den Bot für die Schule geschrieben habe d / z und die Datenbank geändert habe</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475406/">  Hallo, Khabrovsk Bürger! <br>  Heute werde ich versuchen, Ihnen zu erklären, wie ein Student einen Bot zum Speichern von Hausaufgaben für VK schreiben kann. <br><div class="spoiler">  <b class="spoiler_title">Vorsicht!</b> <div class="spoiler_text">  Ich werde sofort darauf aufmerksam machen, dass es für ernsthafte Projekte <b>unmöglich ist, eine</b> solche Infrastruktur aufzubauen. Dieses gesamte Projekt wurde nur zu Unterhaltungs- und Zeitzwecken sowie für Präsentationen bei allen Arten von Schulprojektkonferenzen erstellt. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Bemerkung</b> <div class="spoiler_text">  17.11.2013 15:55 Uhr <br>  Sie schrieben mir in privaten Nachrichten, dass im gesamten Artikel nicht klar sei, über welche Art von Hausaufgaben sie sprechen. <br>  Ich werde sofort klarstellen, dass alle Aufgaben, über die ich im Artikel spreche, wie in einem normalen Tagebuch ausgefüllt sind und die alten Aufgaben "verschwinden". <br>  Auf diese Weise erhält der Benutzer die Aufgaben, die er ausführen muss. <br></div></div><br><a name="habracut"></a><br>  Der Bot wurde in PHP geschrieben und aus Versuchsgründen habe ich beschlossen, Updates nicht über die CallBack-API-Webhooks, sondern über LongPoll zu erhalten. <br><br>  Aufgrund der Tatsache, dass ich niemals Bots mit dieser Methode geschrieben habe, um Updates zu erhalten, wurde ich von vagen Zweifeln gequält, ob ich diesen Bot in PHP schreiben könnte, aber am Ende hat alles geklappt.  Jetzt gehe ich weiter dazu, wie meine Ideen entstanden sind und wie ich sie umgesetzt habe. <br><br>  Das erste war im Allgemeinen die Idee, einen Bot zu schreiben, um darin Hausaufgaben zu speichern.  Nun, wie man es aufbewahrt.  So etwas wie Notizen, aber in VK, da ich selten auf Notizen gehe und sie für mich nicht sehr praktisch sind. <br><br>  Um einen banalen Bot mit einer Hausaufgabe zu implementieren, habe ich eine Tabelle in der Datenbank erstellt, in der der Name des Gegenstands, die Hausaufgabe selbst und die Anzahl all dieses Glücks festgelegt wurden.  Dies ist nicht sehr interessant zu beschreiben, daher werde ich diesen Punkt weglassen, aber ich werde ein <b>aussagekräftiges</b> ER-Diagramm geben, wie die Datenbank am Anfang ausgesehen hat. <br><br><img src="https://habrastorage.org/webt/sk/3g/sy/sk3gsyi4l-6vtzd5kdjnlejkvdk.png" alt="Bild"><br><br>  Dann überlegte ich mir, warum ich anderen nicht die Möglichkeit geben sollte, den Bot zu benutzen.  Nun, er gab den Leuten diese Gelegenheit.  Ich habe die Datenbank ein wenig geändert, aber die Tabelle, um die sich alles dreht, ist fast unverändert geblieben. <br><br><img src="https://habrastorage.org/webt/hp/2g/1z/hp2g1ztbmrfih30qdnvlzifncfo.png" alt="Bild"><br><br>  Anhand der ER-Tabelle können Sie erkennen, dass jeder Benutzer einer Gruppe angehört.  Der Eintritt in eine bestehende Gruppe erfolgt per Token, und für jede neue Gruppe wird ein eindeutiger Token generiert.  Und die Aufgaben selbst gehören auch zu der einen oder anderen Gruppe, sodass Benutzer kein Chaos bei den Aufgaben ihrer und der anderer Personen sehen. <br><br>  Ich habe den Code hinzugefügt, hier gibt es auch nichts Interessantes, prinzipiell nein.  Ich habe es nur so gemacht, dass die alten Aufgaben nicht angezeigt werden, um das Ganze nicht manuell zu löschen, aber ich denke, das Schreiben einer SELECT-Abfrage in SQL ist recht einfach. <br><br>  Und jetzt ist es Zeit für Spaß: Ich habe angefangen, Funktionen hinzuzufügen, die die gesamte Nachrichtenwarteschlange verlangsamen. Deshalb habe ich beschlossen, sie in separaten Skripten abzulegen, da ich momentan kein Multithreading ausführen kann, mich aber für LongPoll entschieden habe.  (Und gibt es eine solche Verwendung von PHP?) <br><br>  Und diese Funktionen: Senden von Nachrichten an alle Mitglieder der Gruppe und Generieren von QR-Codes, in denen der Schlüssel zum Beitritt zur Gruppe verschlüsselt ist. <br><br>  Dazu habe ich gerade eine weitere Tabelle in der Datenbank angelegt, in die ich den Mailing-Text eingebe und für wen er bestimmt ist.  Die Basis nahm schließlich diese Form an. <br><br><img src="https://habrastorage.org/webt/6x/mq/jf/6xmqjfitgts3nq1lbig1s1trnvc.png" alt="Bild"><br><br>  Die Generierung von QR-Codes erfolgt in der Regel in einem separaten Prozess, der auch Aktualisierungen von VK über ausgehende Nachrichten erhält und prüft, welche Nachricht den Schlüssel zur Gruppe enthält. <br><br>  Bisher sieht alles mehr oder weniger angemessen aus, aber dann habe ich das relationale Modell gebrochen, indem ich JSON in die Datenbank aufgenommen habe. <br><br>  Welche Art von JSON kann ich in die Datenbank einfügen?  Ich gebe den Attachments-Parameter ein, den ich von VK erhalte, und verarbeite sie dann beim Senden von Nachrichten, um den Hauptprozess nicht zu laden. <br><br>  Infolgedessen sieht das Ganze so aus. <br><br><img src="https://habrastorage.org/webt/ml/a_/vp/mla_vppfg08h4cou--uneka3z4u.png" alt="Bild"><br><br>  Über die gleiche Methode habe ich dann Dateianhänge zu Aufgaben im Bot hinzugefügt.  Die Aufgabe wird sofort hinzugefügt, und die Dateien werden nach und nach angehängt, wenn sie dem Format und der Größe für Telegram Bot Api entsprechen.  Ich lade Dateien über eine Gruppe von Bots zu Telegram hoch und speichere die Datei-ID. <br><br>  Ich speichere die Dateien im Telegramm, weil der Server, auf dem ich das alles aufbewahre, nicht viel Platz hat und die Erweiterung für mich finanziell sehr schwierig ist. <br><br>  Die gesamte Datenbank sah nun so aus: <br><br><img src="https://habrastorage.org/webt/3o/xg/06/3oxg064z6msqhghzfghsxnsdcts.png" alt="Bild"><br><br>  Aber jetzt habe ich eine Aufgabe: Wie gebe ich Dateien an Benutzer zurück?  Dann habe ich fast die gleiche Logik wie beim Hinzufügen von Dateien gemacht. <br><br><img src="https://habrastorage.org/webt/xl/tn/tc/xltntc1ylqfgiekbjllxphe0-78.png" alt="Bild"><br><br>  Dann wurde ein weiterer Bot für den Cart hinzugefügt, den ich aber noch nicht beschreiben werde. <br><br>  Grundsätzlich denke ich, dass die Datenbankstruktur nicht schlecht ist, aber mir gefällt hier etwas nicht.  Vielleicht ist es für einige der Neuankömmlinge hilfreich zu sehen, wie Sie die Datenbankstruktur im Laufe der Entwicklung der Idee gestalten können, und es wird interessant für mich, die Kritik an der Organisation meiner Basis zu hören und etwas in Betrieb zu nehmen. <br><br>  Der Artikel ist klein, kann aber Kritik stürzen. <br><div class="spoiler">  <b class="spoiler_title">Klats 1</b> <div class="spoiler_text">  "Voll bis 17 Uhr auf meinem Schreibtisch!" <br>  Nachdem ich das Projekt verteidigt habe, werde ich alle Quellcodes des Bots auf Git veröffentlichen. Es ist keine Sünde, einen Artikel zu schreiben. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Klats 2</b> <div class="spoiler_text">  Einige Ideen, die sich auf das Arbeiten mit Dateien beziehen, wurden mir im Habr-Chat im Warenkorb vorgeschlagen, ich bin dort oft zu sehen. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Klats 3</b> <div class="spoiler_text">  Hier können Sie einen Live-Bot <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">stecken</a> .  Ich freue mich auf Feedback. <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de475406/">https://habr.com/ru/post/de475406/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de475392/index.html">Warum sollte man python -m pip verwenden?</a></li>
<li><a href="../de475396/index.html">Was ist mit der Deaktivierung "unnötiger" Prüfungen in CAD von Leiterplatten behaftet</a></li>
<li><a href="../de475398/index.html">Digitale Veranstaltungen in Moskau vom 11. bis 17. November</a></li>
<li><a href="../de475400/index.html">Digitale Veranstaltungen in St. Petersburg vom 11. bis 17. November</a></li>
<li><a href="../de475404/index.html">BLoC-Muster mit einem einfachen Beispiel</a></li>
<li><a href="../de475408/index.html">Merkmale der Steuerzahlung durch freiberufliche IT-Freiberufler</a></li>
<li><a href="../de475416/index.html">KI im eigenen SOC: Träumen die Leiter von Überwachungszentren für Cyberangriffe von elektrischer Analytik?</a></li>
<li><a href="../de475418/index.html">Diskussion: Warum populäres Video-Hosting zunehmend Inhalte mit Hacker-Anleitungen löscht</a></li>
<li><a href="../de475420/index.html">Wie funktionieren Kugeln in Videospielen?</a></li>
<li><a href="../de475424/index.html">Fliegen Sie mit einem Dosimeter in der Tasche</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>