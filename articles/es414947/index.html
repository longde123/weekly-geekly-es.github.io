<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏅 🎏 💃🏿 Obteniendo Git para Windows bajo ReactOS 🆎 🌛 🚲</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Buen dia a todos! 


 Mi nombre es Stanislav y me gusta escribir código. Este es mi primer artículo sobre Habré, por el cual varios factores me llevar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Obteniendo Git para Windows bajo ReactOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/reactos/blog/414947/"><p>  Buen dia a todos! <img src="https://habrastorage.org/getpro/habr/post_images/557/a3f/dcf/557a3fdcfb649e6bb0e97231ccf30af2.png" alt="imagen" align="right"></p><br><p>  Mi nombre es Stanislav y me gusta escribir código.  Este es mi primer artículo sobre Habré, por el cual varios factores me llevaron a escribir: </p><br><ul><li>  Falta de artículos técnicos en el centro ReactOS </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Retorno</a> reciente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">a geektimes</a> </li><li>  La capacidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de construir ReactOS en ReactOS</a> </li><li>  Un caso bastante interesante de solucionar un problema en ReactOS, en el que participé directamente </li></ul><br><p> Permítanme presentarles a los héroes de esta celebración (un error corregido que impidió el lanzamiento de Git en ReactOS): el desarrollador francés Hermès Bélusca-Maïto (en adelante, simplemente Hermes, con el apodo <code>hbelusca</code> ), y en realidad yo (con el apodo <code>x86corez</code> ). </p><br><p>  La historia comienza con los siguientes mensajes del canal IRC de desarrolladores de ReactOS: </p><br><pre> <code class="html hljs xml">Jun 03 18:52:56 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> Anybody want to work on some small problem? If so, can someone figure out why this problem https://jira.reactos.org/browse/CORE-12931 happens on ReactOS? :D Jun 03 18:53:13 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> That would help having a good ROS self-hosting system with git support. Jun 03 18:53:34 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> (the git assertion part only).</code> </pre> <a name="habracut"></a><br><h2 id="razbor-polyotov">  Debriefing </h2><br><p>  Dado que actualmente ReactOS apunta a la compatibilidad con Windows Server 2003, se eligió Git versión 2.10.0 como el conejo experimental, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">último</a> que afirma ser compatible con Windows XP y 2003. </p><br><p>  Las pruebas se realizaron en la línea de comandos de ReactOS, los síntomas externos del problema fueron bastante mixtos.  Por ejemplo, al iniciar git sin especificar argumentos adicionales, sin ningún problema muestra información de ayuda en la consola.  Pero valió la pena probar <code>git clone</code> o al menos <code>git --version</code> , en la mayoría de los casos la consola no mostró nada en absoluto, u ocasionalmente mostró un mensaje roto con afirmación: </p><br><pre> <code class="html hljs xml">git.exe clone -v "https://github.com/minoca/os.git" "C:\Documents and Settings\Administrator\Bureau\minocaos" A ssertionfailed ! P rogram : C : \ P rogram F iles \ G it \ mingw 3 2 \ bin \ git . exe F ile : exec _ cmd . c , L ine 2 3 E xpression : argv 0 _ path This application has requested the Runtime to terminate in an unusual way. Please contact the application's support team for more information.</code> </pre> <br><p>  Fue muy útil investigar el problema de que el cliente git era de código abierto, y encontrar la línea en la que ocurrió la excepción no fue difícil: <a href="">https://github.com/git-for-windows/git/blob/4cde6287b84b8f4c5ccb4062617851a2f3d7fc78/exec_cm. c # L23</a> </p><br><pre> <code class="plaintext hljs">char *system_path(const char *path) { /*  */ #ifdef RUNTIME_PREFIX assert(argv0_path); //    assert(is_absolute_path(argv0_path)); /*  */ #endif strbuf_addf(&amp;d, "%s/%s", prefix, path); return strbuf_detach(&amp;d, NULL); }</code> </pre> <br><p>  Y el valor de la variable <code>argv0_path</code> establecido por esta sección de código: </p><br><pre> <code class="plaintext hljs">const char *git_extract_argv0_path(const char *argv0) { const char *slash; if (!argv0 || !*argv0) return NULL; slash = find_last_dir_sep(argv0); if (slash) { argv0_path = xstrndup(argv0, slash - argv0); return slash + 1; } return argv0; }</code> </pre> <br><p>  Después de aclarar estos detalles, me di de baja en el canal IRC: </p><br><pre> <code class="html hljs xml">Jun 03 19:04:36 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> hbelusca: https://github.com/git-for-windows/git/blob/4cde6287b84b8f4c5ccb4062617851a2f3d7fc78/exec_cmd.c#L23 Jun 03 19:04:41 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> assertion is here Jun 03 19:04:57 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> yes I know, I've seen the code yesterday. The question is why it's FALSE on ROS but TRUE on Windows. Jun 03 19:06:02 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> argv0_path = xstrndup(argv0, slash - argv0); Jun 03 19:06:22 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> xstrndup returns NULL %-) Jun 03 19:06:44 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> ok, so what's the values of argv0 and slash on windows vs. on ROS? :P Jun 03 19:08:48 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> good question!</code> </pre> <br><p>  El nombre de la variable, por así decirlo, sugiere que el valor se obtuvo de <code>argv[0]</code> , generalmente en el índice cero de esta matriz contiene una cadena con el nombre del comando con el que se llamó al programa actual.  Pero en el futuro, todo no era tan obvio ... </p><br><pre> <code class="html hljs xml">Jun 03 20:15:21 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> hbelusca: surprise... git uses its own xstrndup implementation Jun 03 20:15:35 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> so I can't simply hook it xD Jun 03 20:15:56 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> well, with such a name "xstrndup" it's not surprising it's its own implementation Jun 03 20:16:04 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> probably I would need an user-mode debugger... like OllyDbg Jun 03 20:16:09 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> that's everything but standardized function. Jun 03 20:16:24 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> x86corez: ollydbg should work on ROS. Jun 03 20:16:30 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mjansen</span></span></span><span class="hljs-tag">&gt;</span></span> what are you breaking today? Jun 03 20:16:44 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> mjansen: https://jira.reactos.org/browse/CORE-12931 Jun 03 20:16:51 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> (of course if you also are able to compile that git with symbols and all the stuff, it would be very nice)</code> </pre> <br><h2 id="perehod-k-aktivnym-deystviyam">  Ir a la acción </h2><br><p>  Después de eso, decidí compilar git desde la fuente para que fuera más fácil "sobre la marcha" mostrar los valores de las variables de interés directamente en la consola.  Seleccioné este <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">manual paso a paso</a> , y para construir una versión compatible elegí esta rama: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/git-for-windows/git/tree/v2.10.0-rc2</a> </p><br><p>  La configuración de la cadena de herramientas mingw32 fue sencilla y comencé la compilación.  Pero tales manuales paso a paso a menudo tienen dificultades indocumentadas, e inmediatamente me encontré con uno de ellos: </p><br><p><img src="https://habrastorage.org/webt/st/xy/yz/stxyyzihtz6c7qlzohax-u7nofc.png" alt="imagen"></p><br><p>  A través de prueba y error, además de utilizar indicaciones de la audiencia (canal IRC), se resolvieron todos los problemas de compilación.  Si alguien quiere repetir mi camino, comparto el diff listo para una compilación exitosa: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://pastebin.com/ZiA9MaKt</a> </p><br><p>  Para eliminar la influencia de muchas funciones durante la inicialización, decidí mostrar varios mensajes de depuración justo al comienzo de la función <code>main()</code> , que en el caso de git se encuentra en el archivo <code>common-main.c</code> : </p><br><pre> <code class="plaintext hljs">int main(int argc, const char **argv) { /* * Always open file descriptors 0/1/2 to avoid clobbering files * in die(). It also avoids messing up when the pipes are dup'ed * onto stdin/stdout/stderr in the child processes we spawn. */ //DebugBreak(); printf("sanitize_stdfds(); 1\n"); sanitize_stdfds(); printf("git_setup_gettext(); 1\n"); git_setup_gettext(); /* * Always open file descriptors 0/1/2 to avoid clobbering files * in die(). It also avoids messing up when the pipes are dup'ed * onto stdin/stdout/stderr in the child processes we spawn. */ printf("sanitize_stdfds(); 2\n"); sanitize_stdfds(); printf("git_setup_gettext(); 2\n"); git_setup_gettext(); printf("before argv[0] = %s\n", argv[0]); argv[0] = git_extract_argv0_path(argv[0]); printf("after argv[0] = %s\n", argv[0]); restore_sigpipe_to_default(); printf("restore_sigpipe_to_default(); done\n"); return cmd_main(argc, argv); }</code> </pre> <br><p>  La conclusión fue la siguiente: </p><br><pre> <code class="html hljs xml">C:\&gt;git --version sanitize_stdfds(); 1 git_setup_gettext(); 1 sanitize_stdfds(); 2 git_setup_gettext(); 2 before argv[0] = git after argv[0] = git restore_sigpipe_to_default(); done A ssertionfailed ! ( ,    )</code> </pre> <br><p>  Parece que todo está bien, <code>argv[0]</code> debería ser así.  La idea surgió para ejecutar git dentro del depurador, por ejemplo en OllyDbg, pero algo salió mal ... </p><br><pre> <code class="html hljs xml">Jun 04 01:54:46 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sanchaez</span></span></span><span class="hljs-tag">&gt;</span></span> now please try gdb/ollydbg in ROS Jun 04 01:58:11 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sanchaez</span></span></span><span class="hljs-tag">&gt;</span></span> you have gdb in RosBE Jun 04 01:58:20 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sanchaez</span></span></span><span class="hljs-tag">&gt;</span></span> just in case :p Jun 04 01:59:45 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> ollydbg says "nope" with MEMORY_MANAGEMENT bsod Jun 04 02:00:07 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> !bc 0x0000001A Jun 04 02:00:08 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hTechBot</span></span></span><span class="hljs-tag">&gt;</span></span> KeBugCheck( MEMORY_MANAGEMENT ); Jun 04 02:00:13 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> :/ Jun 04 02:00:49 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sanchaez</span></span></span><span class="hljs-tag">&gt;</span></span> welp Jun 04 02:00:56 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sanchaez</span></span></span><span class="hljs-tag">&gt;</span></span> you only have one option now :D</code> </pre> <br><p>  ¡Y aquí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Sanchez</a> sugirió una gran idea que arroja luz sobre muchas cosas! </p><br><p><img src="https://habrastorage.org/webt/ox/hf/wq/oxhfwqsbyw35bsylutipsffvaao.png" alt="imagen"></p><br><p>  No hubo más excepciones, y git imprimió con éxito su número de versión. </p><br><pre> <code class="html hljs xml">Jun 04 02:23:40 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> it prints! Jun 04 02:23:44 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> but only in gdb Jun 04 02:23:53 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> oh Jun 04 02:24:00 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> C:\git/git.exe Jun 04 02:24:13 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> I wonder whether it's the same in windows, or not.</code> </pre> <br><p>  Las cosas se despegaron, y decidí intentar diferente ejecutar git en la línea de comando, ¡y no perdí! </p><br><p><img src="https://habrastorage.org/webt/es/bq/a4/esbqa41d5zj__3yoapc4yfbshhc.png" alt="imagen"></p><br><p>  El problema era claramente que git esperaba la ruta completa en la línea de comando.  Luego decidí verificar qué datos se mostrarán en Windows.  Los resultados me sorprendieron un poco. </p><br><p><img src="https://habrastorage.org/webt/ke/iv/9s/keiv9szbiznf4nsahh8fwkg3m2e.png" alt="imagen"></p><br><p>  Por alguna razón, la variable <code>argv[0]</code> tenía la ruta completa a la aplicación. </p><br><pre> <code class="html hljs xml">Jun 05 23:01:44 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> x86corez: can you try to run git also by not using cmd.exe? Jun 05 23:02:05 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> (to exclude the possibility it's cmd that doesn't call Createprocess with a complete path) Jun 05 23:02:09 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> while I think it should... Jun 05 23:02:30 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> not using cmd... moment Jun 05 23:02:55 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> x86corez: alternatively, on windows, try starting git using our own cmd.exe :)</code> </pre> <br><p>  Hermes sugirió verificar si podría haber un problema en algún lugar de la línea de comandos de ReactOS ... </p><br><p><img src="https://habrastorage.org/webt/_l/nd/od/_lndodcrwgvabcw9ho1r-g0ns5m.png" alt="imagen"></p><br><p>  Pero ese no fue el caso.  La opción de shell cmd desaparece. </p><br><pre> <code class="html hljs xml">Jun 05 23:04:38 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> ROS cmd is not guilty Jun 05 23:07:57 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> If there was a possibility to consult the received path, before looking at the contents of argvs... ? Jun 05 23:08:30 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> dump contents of actual command line? Jun 05 23:08:39 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> yeah Jun 05 23:09:39 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> The thing you retrieve using GetCommandLineW Jun 05 23:10:03 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> (which is, after simplifications, basically : NtCurrentPeb()-&gt;ProcessParameters-&gt;CommandLine ) Jun 05 23:10:59 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> Also I was thinking it could be a side-effect of having (or not having) git path into the env-vars.... Jun 05 23:12:17 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> hbelusca, command line is "git --version" Jun 05 23:12:34 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> Always? Jun 05 23:12:39 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> Yes, even on Windows Jun 05 23:15:13 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> ok but then it would be nice if these different results are at least the same on Windows and on ROS, so that we can 100% exclude problems outside of msvcrt.</code> </pre> <br><p>  Ahora todo lo que quedaba era probar la biblioteca msvcrt.dll de ReactOS para Windows.  Traté de poner el archivo en el mismo directorio donde estaba git.exe, pero esto no ayudó.  Mark sugirió una manera con un archivo .local: </p><br><pre> <code class="html hljs xml">Jun 05 22:59:01 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mjansen</span></span></span><span class="hljs-tag">&gt;</span></span> x86corez: add .local file next to msvcrt.dll ;) Jun 05 22:59:47 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mjansen</span></span></span><span class="hljs-tag">&gt;</span></span> exename.exe.local Jun 05 23:00:17 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> just an empty file? Jun 05 23:00:21 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mjansen</span></span></span><span class="hljs-tag">&gt;</span></span> yea Jun 05 23:00:49 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> mjansen: do we support these .local files? Jun 05 23:00:52 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mjansen</span></span></span><span class="hljs-tag">&gt;</span></span> we dont Jun 05 23:00:54 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mjansen</span></span></span><span class="hljs-tag">&gt;</span></span> windows does Jun 05 23:15:48 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> moment... I'll try with .local Jun 05 23:18:43 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> mjansen: I've created git.exe.local but it still doesn't load msvcrt.dll in this directory</code> </pre> <br><p>  Pero por alguna razón, esta opción tampoco funcionó.  Quizás el hecho de que realicé todos los experimentos en la versión del servidor de Windows Server 2008 R2 afectó. </p><br><p>  Hermes sugirió la última idea: </p><br><pre> <code class="html hljs xml">Jun 05 23:19:28 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> last solution: patch "msvcrt" name within git and perhaps other mingwe dlls ^^ Jun 05 23:20:12 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> good idea about patching!</code> </pre> <br><p>  Usando WinHex, reemplacé todas las apariciones de la subcadena <code>msvcrt</code> en el archivo <code>msvcrd</code> con <code>msvcrd</code> , y renombré msvcrt.dll de ReactOS en consecuencia, y esto es lo que sucedió: </p><br><p><img src="https://habrastorage.org/webt/9l/8z/si/9l8zsinphrucuzluxoqbuz67ar8.png" alt="imagen"></p><br><pre> <code class="html hljs xml">Jun 05 23:23:29 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> Yes! guilty is msvcrt :) Jun 05 23:25:37 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> ah, so as soon as git uses our msvcrt we get the problem on windows. Jun 05 23:25:38 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> hbelusca, mjansen, https://image.prntscr.com/image/FoOWnrQ4SOGMD-66DLW16Q.png Jun 05 23:25:58 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> aha and it asserts <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">3</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Jun</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">05</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">23:26:03</span></span></span><span class="hljs-tag"> &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> (it shows the assertion now)</code> </pre> <br><p>  ¡Ahora en Windows, recibimos el mismo mensaje de error!  Esto significa que la fuente del problema es la implementación de una de las funciones msvcrt de ReactOS. </p><br><p>  También se puede observar que en Windows el texto de excepción se muestra correctamente. </p><br><pre> <code class="html hljs xml">Jun 05 23:26:13 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> but it prints text and correctly. Jun 05 23:26:20 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> oh Jun 05 23:26:33 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> and on ROS it doesn't print in most cases xD Jun 05 23:26:38 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> so also it excludes another hypothesis, namely that it could have been a bug in our msvcrt/crt Jun 05 23:26:56 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> So possibly a strange bug in our console</code> </pre> <br><p>  Solo quedaba averiguar qué función en msvcrt proporciona la ruta completa al archivo ejecutable de la aplicación en ejecución.  Buscando en Google un poco, sugerí que el punto está en la función <code>_pgmptr</code> . </p><br><pre> <code class="html hljs xml">Jun 06 00:07:43 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> https://msdn.microsoft.com/en-us/library/tza1y5f7.aspx Jun 06 00:07:57 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> When a program is run from the command interpreter (Cmd.exe), _pgmptr is automatically initialized to the full path of the executable file. Jun 06 00:08:01 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> this ^^) Jun 06 00:08:50 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> That's what GetModuleFileName does. Jun 06 00:09:04 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> yeah Jun 06 00:10:30 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> Of course in ROS msvcrt we don't do this, but instead we initialize pgmptr to what argv[0] could be. Jun 06 00:11:08 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> That's one thing. Jun 06 00:11:34 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> The other thing is that nowhere it appears (in MS CRT from VS, or in wine) that argv is initialized using pgmptr. Jun 06 00:13:33 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> hbelusca, I've checked argv[0] in some ROS command line tools, running them in Windows Jun 06 00:13:56 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> they all interpret argv[0] as command line, not full path Jun 06 00:14:04 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> so... I think it's git specific behaviour Jun 06 00:14:16 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> or specific mingw compiler settings Jun 06 00:28:12 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> x86corez: I'm making a patch for our msvcrt, would be nice if you could test it :) Jun 06 00:28:21 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> I'll test it</code> </pre> <br><p>  Hermes envió un enlace al parche, lo apliqué manualmente y reconstruí el sistema, ¡después de lo cual todo funcionó mágicamente como debería! </p><br><p><img src="https://habrastorage.org/webt/jp/yy/5p/jpyy5pmeuypncrl9ahuf4szvnxe.png" alt="imagen"></p><br><pre> <code class="html hljs xml">Jun 06 00:34:26 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> hbelusca, IT WORKS! Jun 06 00:35:10 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> LOL Jun 06 00:35:18 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> So it seems that something uses pgmptr to rebuild an argv. Jun 06 00:35:52 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> I've even able to clone :) Jun 06 00:36:19 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> \o/ Jun 06 00:36:21 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gigaherz</span></span></span><span class="hljs-tag">&gt;</span></span> 2.10.0-rc2? not the release? Jun 06 00:36:24 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> ok I'm gonna commit that stuff. Jun 06 00:36:43 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbelusca</span></span></span><span class="hljs-tag">&gt;</span></span> x86corez: gonna have ROS self-hosting <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">33</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Jun</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">06</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">00:36:48</span></span></span><span class="hljs-tag"> &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> yeah! Jun 06 00:37:01 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> gigaherz: I've built that from sources Jun 06 00:37:37 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gigaherz</span></span></span><span class="hljs-tag">&gt;</span></span> oh, for testing this bug? o_O Jun 06 00:37:50 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sanchaez</span></span></span><span class="hljs-tag">&gt;</span></span> yes, you missed the fun :p Jun 06 00:39:46 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x86corez</span></span></span><span class="hljs-tag">&gt;</span></span> git 2.10.0-windows.1 (release) works too! Jun 06 00:39:54 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">encoded</span></span></span><span class="hljs-tag">&gt;</span></span> commit!!!</code> </pre> <br><h2 id="posleslovie">  Epílogo </h2><br><p>  Por lo tanto, otro error que obstaculizó indirectamente el autoensamblaje de ReactOS dentro de ReactOS se solucionó mediante esfuerzos colectivos.  Una coincidencia graciosa es el hecho de que poco antes se solucionó otro error en el mismo msvcrt (es decir, en la función <code>qsort</code> ), que no permitía ensamblar controladores USB en ReactOS. </p><br><p>  Participo en el desarrollo de muchos proyectos escritos en diferentes lenguajes de programación, tanto de código cerrado como de código abierto.  He estado trabajando con el proyecto ReactOS desde 2014, pero comencé a ayudar activamente y escribir código solo en 2017. ¡Es especialmente interesante trabajar en esta área, porque es un sistema operativo completo!  ¡Uno siente la enorme escala del resultado, en la que se invirtieron los esfuerzos, así como la agradable sensación de que un error se volvió menos!  :) </p><br><p>  Alguien probablemente se preguntará por qué ayudo a ReactOS, y no a Linux, por ejemplo.  Sucedió históricamente que en la mayoría de los casos escribo programas para Windows, y mi lenguaje de programación favorito es Delphi.  Quizás es por eso que la arquitectura de Windows NT, junto con la API Win32, es muy interesante para mí, y el proyecto del sistema operativo gratuito ReactOS hace realidad un viejo sueño: en la práctica, le permite descubrir cómo funciona todo desde adentro. </p><br><p>  Espero que les haya resultado interesante leer mi primer artículo aquí.  Espero sus comentarios! </p><br><h3 id="ssylki">  Referencias </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://jira.reactos.org/browse/CORE-12931</a> : el boleto original en el rastreador JIRA para este error </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://msdn.microsoft.com/en-us/library/tza1y5f7.aspx</a> - descripción de <code>_pgmptr</code> en MSDN </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/reactos/reactos/commit/f215f394d803c98e1c1c5f0768159f3336b7e552</a> - confirmar con corrección de errores </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414947/">https://habr.com/ru/post/es414947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414935/index.html">Agencia Especial de la ONU publica plan de transición de IPv6 - comunidad de TI disgustada</a></li>
<li><a href="../es414937/index.html">"Frecuencias inaudibles": ha aparecido un cortafuegos que bloquea las cookies ultrasónicas</a></li>
<li><a href="../es414939/index.html">Autorización transparente para una aplicación en Oracle Weblogic Server</a></li>
<li><a href="../es414943/index.html">Implementación de software del filtro IIR en el canal de medición de información</a></li>
<li><a href="../es414945/index.html">La Universidad Johns Hopkins creó una piel artificial que siente dolor</a></li>
<li><a href="../es414951/index.html">Gestión de acceso en Expressjs con CASL</a></li>
<li><a href="../es414953/index.html">Nvidia enseñó a la red neuronal a ralentizar el video</a></li>
<li><a href="../es414955/index.html">Las empresas usaron la palabra blockchain para aumentar la capitalización. Ayudado por un tiempo</a></li>
<li><a href="../es414959/index.html">Cómo encontrar vulnerabilidades en los contratos inteligentes: revisión de EtherHack en los días de pirateo positivo 8</a></li>
<li><a href="../es414961/index.html">Descripción general de SERM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>