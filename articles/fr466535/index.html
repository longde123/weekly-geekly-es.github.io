<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßÄ üîô üë©üèæ‚Äçüåæ Repenser deepClone üôåüèæ üîõ üë©üèø‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comme vous le savez en JavaScript, les objets sont copi√©s par r√©f√©rence. Mais parfois, vous devez effectuer un clonage en profondeur d'un objet. De no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Repenser deepClone</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466535/"> Comme vous le savez en JavaScript, les objets sont copi√©s par r√©f√©rence.  Mais parfois, vous devez effectuer un clonage en profondeur d'un objet.  De nombreuses biblioth√®ques js proposent leur impl√©mentation de la fonction deepClone pour ce cas.  Mais, malheureusement, la plupart des biblioth√®ques ne prennent pas en compte plusieurs √©l√©ments importants: <br><br><ul><li>  Les tableaux peuvent se trouver dans l'objet et il est pr√©f√©rable de les copier en tant que tableaux </li><li>  L'objet peut avoir des champs avec un symbole comme cl√© </li><li>  Les champs d'objet ont des descripteurs autres que ceux par d√©faut </li><li>  Les fonctions peuvent se trouver dans les champs de l'objet et doivent √©galement √™tre clon√©es. </li><li>  Un objet a enfin un prototype diff√©rent de Object.prototype </li></ul><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Qui l'a cass√©, j'ai plac√© le code complet sous le spoiler</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deepClone</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'object'</span></span></span></span><span class="hljs-function"><span class="hljs-params">: cloneObject, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'function'</span></span></span></span><span class="hljs-function"><span class="hljs-params">: cloneFunction }[</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">typeof</span></span></span></span><span class="hljs-function"><span class="hljs-params"> source] || clonePrimitive</span></span></span><span class="hljs-function">)(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">)</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cloneObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">.isArray(source</span></span></span><span class="hljs-function">) ? </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> source.map(deepClone) : clonePrototype(source, cloneFields(source, simpleFunctor({}))) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloneFunction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cloneFields(source, simpleFunctor(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source.apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); })); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clonePrimitive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> source; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">simpleFunctor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">mapper</span></span></span><span class="hljs-function"> =&gt;</span></span> mapper ? simpleFunctor(mapper(value)) : value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeCloneFieldReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">destinationFunctor, field</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> descriptor = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyDescriptor(source, field); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> destinationFunctor(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">destination</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(destination, field, <span class="hljs-string"><span class="hljs-string">'value'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> descriptor ? { ...descriptor, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: deepClone(descriptor.value) } : descriptor)); }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloneFields</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source, destinationFunctor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyNames(source) .concat(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertySymbols(source)) .reduce(makeCloneFieldReducer(source), destinationFunctor) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clonePrototype</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source, destinationFunctor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> destinationFunctor(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">destination</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.setPrototypeOf(destination, <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getPrototypeOf(source))); }</code> </pre> </div></div><br>  Mon impl√©mentation est √©crite dans un style fonctionnel qui me procure fiabilit√©, stabilit√© et simplicit√©.  Mais comme, malheureusement, beaucoup ne peuvent toujours pas reconstruire leur pens√©e avec le proc√©duralisme et la pseudo-POO, je vais expliquer chaque brique de construction de mon impl√©mentation: <br><br>  La fonction deepClone elle-m√™me prendra 1 argument source - la source √† partir de laquelle nous clonerons, et son clone profond avec toutes les fonctionnalit√©s ci-dessus sera retourn√©: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deepClone</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ({ <span class="hljs-string"><span class="hljs-string">'object'</span></span>: cloneObject, <span class="hljs-string"><span class="hljs-string">'function'</span></span>: cloneFunction }[<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> source] || clonePrimitive)(source)(); }</code> </pre><br>  Tout est simple ici, selon le type de donn√©es dans la source, une fonction est s√©lectionn√©e qui peut la cloner, et la source elle-m√™me lui est transf√©r√©e. <br><br>  Vous pouvez √©galement remarquer que le r√©sultat renvoy√© est appel√© en tant que fonction sans param√®tres avant d'√™tre renvoy√© √† l'utilisateur.  Ceci est n√©cessaire, car j'encapsule la valeur dans laquelle je clone, dans le foncteur le plus simple, afin de pouvoir le muter sans violer la puret√© des fonctions auxiliaires.  Voici l'impl√©mentation de ce foncteur: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">simpleFunctor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">mapper</span></span></span><span class="hljs-function"> =&gt;</span></span> mapper ? simpleFunctor(mapper(value)) : value; }</code> </pre><br>  Il peut faire 2 choses - mapper (si la fonction mapper lui est transmise) et extraire (si rien n'est pass√©). <br><br>  Nous allons maintenant analyser les fonctions auxiliaires cloneObject, cloneFunction et clonePrimitive.  Chacun d'eux prend 1 argument de source d'un type sp√©cifique et retourne son clone. <br><br>  La mise en ≈ìuvre de <b>cloneObject</b> doit tenir compte du fait que les tableaux sont √©galement de type objet, eh bien, dans d'autres cas, ils doivent cloner les champs et le prototype.  Voici sa mise en ≈ìuvre: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloneObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">.isArray(source</span></span></span><span class="hljs-function">) ? </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> source.map(deepClone) : clonePrototype(source, cloneFields(source, simpleFunctor({}))) ); }</code> </pre><br>  Le tableau peut √™tre copi√© √† l'aide de la m√©thode slice, mais comme nous avons un clonage profond et que le tableau peut contenir non seulement des valeurs primitives, la m√©thode map est utilis√©e avec le deepClone d√©crit ci-dessus comme argument. <br><br>  Pour les autres objets, nous cr√©ons un nouvel objet et l'enveloppons dans notre foncteur d√©crit ci-dessus, clonons les champs (ainsi que les descripteurs) √† l'aide de la fonction d'assistance cloneFields, puis clonons le prototype √† l'aide de clonePrototype. <br><br>  Fonctions d'assistance que je d√©crirai ci-dessous.  En attendant, envisagez la mise en ≈ìuvre de <b>cloneFunction</b> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloneFunction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cloneFields(source, simpleFunctor(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source.apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); })); }</code> </pre><br>  Vous ne pouvez tout simplement pas cloner une fonction avec toute la logique.  Mais vous pouvez l'encapsuler dans une autre fonction qui appelle l'original avec tous les arguments et le contexte et renvoie son r√©sultat.  Un tel ¬´clone¬ª gardera certainement la fonction d'origine en m√©moire, mais il ¬´p√®sera¬ª un peu et reproduira pleinement la logique d'origine.  Nous enveloppons la fonction clon√©e dans un foncteur et en utilisant cloneFields nous copions tous les champs de la fonction d'origine dedans, car la fonction dans JS est aussi un objet, juste appel√©, et peut donc y stocker des champs. <br><br>  Potentiellement, une fonction peut avoir un prototype diff√©rent de Function.prototype, mais je n'ai pas consid√©r√© ce cas extr√™me.  L'un des charmes de FP est que nous pouvons facilement ajouter un nouveau wrapper sur une fonction existante afin d'impl√©menter les fonctionnalit√©s n√©cessaires. <br><br>  La derni√®re brique de construction clonePrimitive sert √† cloner des valeurs primitives.  Mais comme les valeurs primitives sont copi√©es par valeur (ou par r√©f√©rence, mais sont immuables dans certaines impl√©mentations des moteurs JS), nous pouvons simplement les copier.  Mais puisque nous ne sommes pas cens√©s obtenir une valeur pure, mais une valeur envelopp√©e dans un foncteur que l'extraction peut appeler sans arguments, nous encapsulerons notre valeur dans une fonction: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clonePrimitive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> source; }</code> </pre><br>  Maintenant, nous impl√©mentons les fonctions auxiliaires qui ont √©t√© utilis√©es ci-dessus - clonePrototype et cloneFields <br><br>  Pour cloner un prototype, <b>clonePrototype</b> extrait simplement le prototype de l'objet source et, en effectuant une op√©ration de mappage sur le foncteur r√©sultant, le d√©finit sur l'objet cible: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clonePrototype</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source, destinationFunctor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> destinationFunctor(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">destination</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.setPrototypeOf(destination, <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getPrototypeOf(source))); }</code> </pre><br>  Le clonage de champs est un peu plus compliqu√©, j'ai donc divis√© la fonction <b>cloneFields</b> en deux.  La fonction externe prend la concat√©nation de tous les champs nomm√©s et de tous les champs de symboles, en recevant absolument tous les champs, et les ex√©cute via le r√©ducteur cr√©√© par la fonction auxiliaire: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cloneFields</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source, destinationFunctor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyNames(source) .concat(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertySymbols(source)) .reduce(makeCloneFieldReducer(source), destinationFunctor) ); }</code> </pre><br>  makeCloneFieldReducer devrait cr√©er pour nous une fonction de r√©duction qui pourrait √™tre pass√©e √† la m√©thode de r√©duction sur un tableau de tous les champs de l'objet source.  En tant que batterie, notre foncteur qui stocke la cible sera utilis√©.  Le r√©ducteur doit extraire la poign√©e du champ de l'objet source et l'affecter au champ de l'objet cible.  Mais ici, il est important de consid√©rer qu'il existe deux types de descripteurs - avec valeur et avec get / set.  √âvidemment, la valeur doit √™tre clon√©e, mais avec get / set il n'y a pas un tel besoin, un tel descripteur peut √™tre retourn√© tel quel: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeCloneFieldReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">destinationFunctor, field</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> descriptor = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyDescriptor(source, field); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> destinationFunctor(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">destination</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(destination, field, <span class="hljs-string"><span class="hljs-string">'value'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> descriptor ? { ...descriptor, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: deepClone(descriptor.value) } : descriptor)); }; }</code> </pre><br>  C‚Äôest tout.  Une telle impl√©mentation de deepClone r√©sout tous les probl√®mes pos√©s au d√©but de l'article.  De plus, il est construit sur des fonctions pures et un foncteur, ce qui donne toutes les garanties inh√©rentes au calcul lambda. <br><br>  Je note √©galement que je n'ai pas mis en ≈ìuvre un excellent comportement pour les collections autres qu'un tableau qui m√©riterait d'√™tre clon√© individuellement, comme Map ou Set.  Bien que dans certains cas, cela puisse √™tre n√©cessaire. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466535/">https://habr.com/ru/post/fr466535/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466519/index.html">Analyse d√©taill√©e d'AWS Lambda</a></li>
<li><a href="../fr466521/index.html">C for Metal - m√©tal pr√©cieux pour l'informatique sur les cartes graphiques Intel</a></li>
<li><a href="../fr466525/index.html">Qu'est-ce qu'une disposition iPhone PSD et comment l'utiliser?</a></li>
<li><a href="../fr466527/index.html">Test de la fonctionnalit√© utilisateur du site Web avec les objets de page Capybara</a></li>
<li><a href="../fr466529/index.html">Types de compilation dans la JVM: exposer la session Black Magic</a></li>
<li><a href="../fr466537/index.html">Utilisation de modules JavaScript en production: situation actuelle. Partie 1</a></li>
<li><a href="../fr466539/index.html">Utilisation de modules JavaScript en production: situation actuelle. 2e partie</a></li>
<li><a href="../fr466541/index.html">Utilisation de DbTool pour amorcer des bases de donn√©es dans des applications .NET (Core)</a></li>
<li><a href="../fr466543/index.html">Les pr√™ts Habr Weekly # 17 / Sberbank seront approuv√©s par AI - effrayant, publicit√© dans les produits open source - douteux</a></li>
<li><a href="../fr466547/index.html">Bonne f√™te du programmeur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>