<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçü§ù‚Äçüë©üèº üë©üèø‚Äçüé® üõÑ Arbeiten mit Python Popular Monitoring mit Raspberry Pi üìí üè† üå∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beim Versuch, meinen DS18B20-Temperatursensor an mein intelligentes Gew√§chshaus anzuschlie√üen, stellte ich fest, dass das Internet keine vollst√§ndigen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arbeiten mit Python Popular Monitoring mit Raspberry Pi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401313/"><img align="right" src="https://habrastorage.org/files/070/703/162/0707031628c543d68a6fa8928769d2ab.jpg">  Beim Versuch, meinen DS18B20-Temperatursensor an mein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">intelligentes Gew√§chshaus</a> anzuschlie√üen, stellte ich fest, dass das Internet keine vollst√§ndigen Anweisungen zum Anschlie√üen dieses Sensors √ºber die Programmiersprache Python enth√§lt.  Ich benutze es, da ich mit der Raspberry Pi-Plattform arbeite.  Ich habe beschlossen, dieses Problem zu beheben.  Es stellt sich heraus, dass die Arbeit mit TCP nicht so schwierig ist, aber Sie m√ºssen verstehen, was wir tun und warum.  Ein zweist√ºndiger Tanz mit einem Tamburin machte mich sichtlich w√ºtend.  Daher m√∂chte ich hier zus√§tzlich zum Softwareteil selbst den gesamten Algorithmus von Anfang bis Ende beschreiben.  Ich denke, dass andere Sensoren √§hnlich funktionieren, so dass ein gro√üer Artikel f√ºr alle gleich ist.  Ich hoffe, wenn Sie Ihren Sensor anschlie√üen m√∂chten, brauchen Sie kein Tamburin :) Also, fangen wir an, ich frage Sie nach Habrokat. <a name="habracut"></a><br><br><h3>  Schamanismus mit einem Sensor </h3><br><img align="right" src="https://habrastorage.org/files/5e9/a73/80f/5e9a7380fff54065a011b64222fdcf5f.png">  F√ºr uns m√ºssen wir den Sensor selbst anschlie√üen.  Ich werde mit dem Temperatursensor DS18B20 arbeiten.  Vollst√§ndige Artikel zu diesem Thema werden nicht dupliziert.  √úber die Verbindung k√∂nnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> lesen.  Dann m√ºssen wir Daten vom Sensor erhalten.  Wir werden das Gleiche tun, wie im obigen Artikel angegeben.  Es gibt ein gro√üartiges Python-Beispiel, von dem ich ein Fan bin. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os tfile=open(<span class="hljs-string"><span class="hljs-string">"/sys/bus/w1/devices/28-000000d7970b/w1_slave"</span></span>) ttext=tfile.read() tfile.close() temp=ttext.split(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)[<span class="hljs-number"><span class="hljs-number">9</span></span>] temperature=float(temp[<span class="hljs-number"><span class="hljs-number">2</span></span>:])/<span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> temperature</code> </pre> <br>  <i>Vergessen Sie nicht, die Daten durch Ihren Sensor zu ersetzen.</i> <br><br>  Wie wir sehen k√∂nnen, nimmt die Temperatur die Temperaturvariable an (wer h√§tte das gedacht), die wir weiter ben√∂tigen werden. <br><br><h3>  Mit √úberwachung beschw√∂ren </h3><br>  Nun, zuerst m√ºssen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">narodmon.ru</a> registrieren, diejenigen, die es noch nicht getan haben.  Die Service-API bietet uns die M√∂glichkeit, Daten √ºber TCP zu √ºbertragen.  Also lass es uns tun.  Wir werden gebeten, den Text in folgendem Format zu √ºbermitteln: <br><br><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#MAC</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[#NAME]</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[#LAT]</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[#LNG]</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[#ELE]</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#mac1</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#value1</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[#time1]</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[#name1]</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> ... <span class="hljs-selector-id"><span class="hljs-selector-id">#macN</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#valueN</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[#timeN]</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[#nameN]</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> ##</code> </pre> <br>  Tats√§chlich m√ºssen wir jedoch nur drei Parameter √ºbergeben: den MAC des Ger√§ts, den Namen des Sensors und seinen Wert.  Der Rest ist nicht notwendig und wir brauchen ihn nicht wirklich. <br><br>  In der ersten Zeile m√ºssen wir das Gitter-, MAC- und Zeilenvorschubzeichen \ n √ºbergeben. <br>  In der zweiten und den folgenden Zeilen √ºbertragen wir erneut das Raster, den Sensornamen, erneut das Raster und die Sensorwerte.  Wir beenden dies mit dem Zeilenvorschubzeichen \ n. <br>  In der letzten Zeile m√ºssen Sie zwei Gitter √ºbergeben, um das Paket zu vervollst√§ndigen. <br><br>  Infolgedessen bleibt das Format wie folgt: <br><br><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#MAC</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#mac1</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#value1</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#macN</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#valueN</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> ##</code> </pre> <br><h3>  Ein Python-Programm schreiben </h3><br>  Wir werden das Programm in Python 2 schreiben. Der Algorithmus wird so sein.  Wir empfangen Daten vom Sensor und schreiben sie in die Temperaturvariable.  Dann bilden wir das Paket und senden es an den People Monitoring Server.  Wir werden das Skript alle 10 Minuten (das minimal zul√§ssige Intervall f√ºr das Senden von Messwerten betr√§gt 5 Minuten) √ºber cron ausf√ºhren. <br><br>  Das Senden erfolgt wie folgt (Beispiel auf der √úberwachungsseite): <br><br><div class="spoiler">  <b class="spoiler_title">Senden Sie den Skriptcode</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python2 # -*- coding: utf-8 -*- # by Roman Vishnevsky aka.x0x01 @ gmail.com import socket # MAC  .   ! DEVICE_MAC = '0123456789012' #  ,    01 (02)  mac  SENSOR_ID_1 = DEVICE_MAC + '01' SENSOR_ID_2 = DEVICE_MAC + '02' #  ,  float/integer sensor_value_1 = 20 sensor_value_2 = -20.25 #   sock = socket.socket() #   try: #    sock.connect(('narodmon.ru', 8283)) #       sock.send("#{}\n#{}#{}\n##".format(DEVICE_MAC, SENSOR_ID_1, sensor_value_1)) #       # sock.send("#{}\n#{}#{}\n#{}#{}\n##".format(DEVICE_MAC, SENSOR_ID_1, sensor_value_1, SENSOR_ID_2, sensor_value_2)) #   data = sock.recv(1024) sock.close() print data except socket.error, e: print('ERROR! Exception {}'.format(e))</span></span></code> </pre><br></div></div><br>  Wir sind mit dem Server narodmon.ru:8283 verbunden <br><br>  Als Ergebnis erhalten wir das folgende Skript: <br><br><div class="spoiler">  <b class="spoiler_title">Code des fertigen Skripts</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python2 # -*- coding: utf-8 -*- import socket import os import fnmatch # MAC  .   ! DEVICE_MAC = 'FF:FF:FF:FF:FF:FF' #  SENSOR_ID_1 = 'T1' SENSOR_ID_2 = 'T2' #   temperature = [] IDs = [] for filename in os.listdir("/sys/bus/w1/devices"): if fnmatch.fnmatch(filename, '28-031652ddbdff'): with open("/sys/bus/w1/devices/" + filename + "/w1_slave") as fileobj: lines = fileobj.readlines() if lines[0].find("YES"): pok = lines[1].find('=') temperature.append(float(lines[1][pok+1:pok+7])/1000) IDs.append(filename) else: logger.error("Error reading sensor with ID: %s" % (filename)) temperature2 = [] for filename in os.listdir("/sys/bus/w1/devices"): if fnmatch.fnmatch(filename, '28-011563e8d2ff'): with open("/sys/bus/w1/devices/" + filename + "/w1_slave") as fileobj: lines = fileobj.readlines() if lines[0].find("YES"): pok = lines[1].find('=') temperature2.append(float(lines[1][pok+1:pok+7])/1000) IDs.append(filename) else: logger.error("Error reading sensor with ID: %s" % (filename)) sock = socket.socket() # try: sock.connect(('narodmon.ru', 8283)) # ,        sock.send("#{}\n#{}#{}\n#{}#{}\n##".format(DEVICE_MAC, SENSOR_ID_1, str(temperature)[1:-1], SENSOR_ID_2, str(temperature2)[1:-1])) #  data=sock.recv(1024) sock.close() print data except socket.error, e: print('ERROR! Exception {}'.format(e)) print str(temperature)[1:-1] print str(temperature2)[1:-1]</span></span></code> </pre> <br></div></div><br>  So sieht das Senden von Daten von zwei Sensoren aus.  Wenn Sie dem Sensor einen Namen geben, der mit T beginnt, stellt der Server selbst fest, dass es sich um einen Temperatursensor handelt. <br><br>  Jetzt m√ºssen wir den Sensor zu cron hinzuf√ºgen.  Wir geben Folgendes ein: <code>crontab -e</code> und f√ºgen dort die folgende Zeile hinzu: <br><br><pre> <code class="bash hljs">*/10 * * * * sudo python /home/pi/narod.py</code> </pre> <br>  Wir warten darauf, dass das Skript ausgef√ºhrt wird. <br><br>  Jetzt gehen wir hier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">narodmon.ru/ip</a> und sehen, ob die Daten √ºbertragen wurden.  Wenn alles in Ordnung ist, klicken Sie auf der Hauptseite im Men√º auf die Schaltfl√§che "Ger√§t hinzuf√ºgen" und geben Sie den MAC an.  Jetzt k√∂nnen wir alles nach Geschmack anpassen (Name, Typ, Ort usw.).  Sie k√∂nnen den Sensor einen Tag nach Beginn der Zeugnis√ºbertragung ver√∂ffentlichen. <br><br>  Das ist alles  Ich w√ºnsche Ihnen viel Gl√ºck beim Anschlie√üen der Sensoren.  Tun Sie es √∂fter, weil es von zu Hause aus so bequem ist, die Temperatur an dem Ort, an dem Sie unterwegs sind, im Voraus zu sehen. <br><br>  Wir sehen uns wieder :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de401313/">https://habr.com/ru/post/de401313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de401303/index.html">G√∂tter des Krieges. Etwas √ºber Artillerie-Spiele. Teil iv</a></li>
<li><a href="../de401305/index.html">FREITAG COWORKOUT</a></li>
<li><a href="../de401307/index.html">Fragen Sie Ethan: Mit welcher Geschwindigkeit bewegen sich Gravitationswellen?</a></li>
<li><a href="../de401309/index.html">Boston Dynamics entwickelt einen erschreckend schnellen Roboter</a></li>
<li><a href="../de401311/index.html">Neu auf lamptest.ru</a></li>
<li><a href="../de401315/index.html">Nicht so einfach mit einem Quantencomputer</a></li>
<li><a href="../de401321/index.html">Beste kurze animierte Technologiefilme in den Oscars</a></li>
<li><a href="../de401325/index.html">–°–∏–ª–∞ –≤–æ–ª–∏ ‚Äì –≤—Ä–µ–¥–Ω—ã–π –∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ç–µ—Ä–º–∏–Ω, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑–±–∞–≤–∏—Ç—å—Å—è</a></li>
<li><a href="../de401327/index.html">Copenhagen Suborbitals testet heute Raketentriebwerk</a></li>
<li><a href="../de401329/index.html">Freiberufliche Plattform f√ºr die Zusammenarbeit von Ingenieuren mit einer grundlegend anderen Arbeitsphilosophie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>