<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçÜ üñïüèø üë®üèº‚Äçüîß Pruebas de codecepci√≥n para backends PHP üôÇ üî∑ üë´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! Mi nombre es Pasha y soy ingeniero de control de calidad para el equipo de procesamiento de pedidos en Lamoda. Recientemente habl√© en PH...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pruebas de codecepci√≥n para backends PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/452136/">  Hola a todos!  Mi nombre es Pasha y soy ingeniero de control de calidad para el equipo de procesamiento de pedidos en Lamoda.  Recientemente habl√© en PHP Badoo Meetup.  Hoy quiero proporcionar una transcripci√≥n de mi informe. <br><br>  Hablaremos sobre Codeception, sobre c√≥mo lo usamos en Lamoda y c√≥mo escribir pruebas en √©l. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/rg1h7mJrU7Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br>  Lamoda tiene muchos servicios.  Hay servicios al cliente que interact√∫an directamente con nuestros usuarios, con los usuarios del sitio, la aplicaci√≥n m√≥vil.  No hablaremos de ellos.  Y existe lo que nuestra compa√±√≠a llama backends profundos: estos son nuestros sistemas de back-office que automatizan nuestros procesos comerciales.  Estos incluyen entrega, almacenamiento, automatizaci√≥n de estudios fotogr√°ficos y un centro de llamadas.  La mayor√≠a de estos servicios se desarrollan en PHP. <br><br>  Hablando brevemente sobre nuestra pila, esto es PHP + Symfony.  Aqu√≠ y all√° hay proyectos antiguos en Zend'e.  PostgreSQL y MySQL se usan como bases de datos, y Rabbit o Kafka se usan como sistemas de mensajer√≠a. <br><br>  <b>¬øPor qu√© backends PHP?</b> <br><br>  Debido a que generalmente tienen una API ramificada, es REST, en algunos lugares hay un poco de SOAP.  Si tienen una interfaz de usuario, entonces esta interfaz de usuario es m√°s auxiliar, que utilizan nuestros usuarios internos. <br><br>  <b>¬øPor qu√© necesitamos autotests en Lamoda?</b> <br><br>  En general, cuando llegu√© a trabajar en Lamoda, hab√≠a un eslogan de este tipo: "Eliminemos la regresi√≥n manual".  No probaremos manualmente ninguna regresi√≥n.  Y trabajamos en esta tarea.  En realidad, esta es una de las razones principales por las que necesitamos pruebas autom√°ticas, para no generar regresi√≥n a mano.  ¬øPor qu√© necesitamos esto?  Derecho a liberar r√°pidamente.  Para que podamos desplegar sin problemas, muy r√°pidamente nuestros lanzamientos y al mismo tiempo tener alg√∫n tipo de cuadr√≠cula de las pruebas autom√°ticas que nos dir√°n, buenas o malas.  Estos son probablemente los objetivos m√°s importantes.  Pero hay un par de auxiliares, sobre los cuales tambi√©n quiero decir. <br><br>  ¬øPor qu√© necesitamos autotests? <br><br><ol><li>  No pruebes la regresi√≥n con tus manos </li><li>  Liberaci√≥n r√°pida </li><li>  Usar como documentaci√≥n </li><li>  Acelerar la incorporaci√≥n de nuevos empleados </li><li>  Las pruebas autom√°ticas se utilizan convenientemente (en algunos casos) como documentaci√≥n.  A veces es m√°s f√°cil entrar a las pruebas, ver qu√© casos est√°n cubiertos, c√≥mo funcionan y comprender c√≥mo funciona esta o aquella funcionalidad, y acelerar la entrada de nuevos empleados, tanto desarrolladores como probadores, en un nuevo proyecto.  Cuando te sientas a escribir pruebas autom√°ticas, inmediatamente queda claro c√≥mo funciona el sistema. </li></ol><br>  Ok, hablamos de por qu√© necesitamos autotest.  Ahora hablemos de las pruebas que escribimos en Lamoda. <br><br><img src="https://habrastorage.org/webt/qx/ci/0f/qxci0fma8tivrntsz95gv-d802e.jpeg" alt="imagen"><br><br>  Esta es una pir√°mide de prueba bastante est√°ndar, desde pruebas unitarias hasta pruebas E2E, donde algunas cadenas comerciales ya est√°n probadas.  No voy a hablar de los dos niveles inferiores; no es por nada que est√°n pintados en ese color blanco.  Estas son pruebas en el c√≥digo en s√≠, est√°n escritas por nuestros desarrolladores.  En casos extremos, el probador puede entrar en la Solicitud de extracci√≥n, mirar el c√≥digo y decir: "Bueno, aqu√≠ no hay suficientes casos, cubramos otra cosa".  Esto completa el trabajo del probador para estas pruebas. <br><br>  Hablaremos sobre los niveles anteriores, que est√°n escritos por desarrolladores y probadores.  Comencemos con las pruebas del sistema.  Estas son pruebas que prueban la API (REST o SOAP), prueban alguna l√≥gica interna del sistema, varios comandos, analizan colas en Rabbit o intercambian con sistemas externos.  Como regla, estas pruebas son bastante at√≥micas.  No verifican ninguna cadena, pero marcan una acci√≥n.  Por ejemplo, un m√©todo API o un comando.  Y verifican tantos casos como sea posible, tanto positivos como negativos. <br><br>  Adelante, pruebas E2E.  Los divid√≠ en 2 partes.  Tenemos pruebas que prueban un mont√≥n de UI y backend.  Y hay pruebas que llamamos pruebas de flujo.  Prueban la cadena: la vida de un objeto de principio a fin. <br><br>  Por ejemplo, tenemos un sistema para gestionar el procesamiento de nuestros pedidos.  Dentro de dicho sistema puede haber una prueba: un pedido desde la creaci√≥n hasta la entrega, es decir, pasarlo por todos los estados.  Es en tales pruebas que es muy f√°cil y sencillo observar c√≥mo funciona el sistema.  Inmediatamente ve todo el flujo de ciertos objetos, con qu√© sistemas externos interact√∫a todo esto, qu√© comandos se utilizan para esto. <br><br>  Como tenemos esta IU utilizada por usuarios internos, el acceso a trav√©s del navegador no es importante para nosotros.  No realizamos estas pruebas en ninguna granja, es suficiente para nosotros registrarnos en un navegador y, a veces, ni siquiera necesitamos usar un navegador. <br><br>  "¬øPor qu√© elegimos Codeception para la automatizaci√≥n de pruebas?"  - Probablemente preguntes. <br><br>  Para ser honesto, no tengo respuesta a esta pregunta.  Cuando llegu√© a Lamoda, Codeception ya estaba seleccionado como el est√°ndar para escribir autotests, y de hecho lo encontr√©.  Pero despu√©s de trabajar con este marco durante alg√∫n tiempo, todav√≠a entend√≠ por qu√© Codeception.  Esto es lo que quiero compartir contigo. <br><br>  <b>¬øPor qu√© la codecepci√≥n?</b> <br><br><ol><li>  Puede escribir y ejecutar las mismas pruebas de cualquier tipo (unidad, funcional, aceptaci√≥n). </li><li>  Muchos rastrillos ya se han resuelto, muchos m√≥dulos ya se han escrito. </li><li>  En todos los proyectos, a pesar de las necesidades ligeramente diferentes, las pruebas tendr√°n el mismo aspecto. </li><li>  El concepto de Codeception sugiere que escriba cualquier prueba en este marco: unidad, integraci√≥n, funcional, aceptaci√≥n.  Y usted, al menos, se lanzar√°n por igual. </li><li>  Codeception es un procesador suficientemente potente en el que ya se han resuelto muchos problemas, muchas preguntas, muchas tareas para las pruebas.  Si algo no se decide, lo m√°s probable es que encuentre algo desde el exterior: alg√∫n complemento para alg√∫n trabajo espec√≠fico.  No necesita escribir ning√∫n contenedor de prueba para bases de datos, para otra cosa.  Simplemente tome y conecte m√≥dulos a Codeception y trabaje con ellos. </li><li>  Bueno, tal ventaja (probablemente sea m√°s adecuada para grandes empresas cuando tienes muchos proyectos y servicios): en todos los proyectos las pruebas se ver√°n m√°s o menos iguales.  Esto es genial </li></ol><br>  Dir√© brevemente c√≥mo es Codeception, ya que muchos trabajaron con √©l. <br><br><img src="https://habrastorage.org/webt/bp/ac/nt/bpacntwtc_xvl52su3nh7-vvidi.jpeg" alt="imagen"><br><br>  La codecepci√≥n funciona en un modelo de actor.  Despu√©s de arrastrarlo al proyecto e inicializar, se genera dicha estructura. <br><br>  Tenemos archivos yml, a continuaci√≥n: <i>funcional.suite.yml</i> , <i>Integration.suit.yml</i> , <i>unit.suite.yml</i> .  Crean la configuraci√≥n de sus pruebas.  Hay papis para cada tipo de prueba, donde est√°n estas pruebas, hay 3 pap√°s auxiliares: <br><br>  _ <i>datos</i> : para datos de prueba; <br>  _ <i>salida</i> : donde se colocan los informes (xml, html); <br>  _ <i>soporte</i> - donde algunos ayudantes auxiliares, funciones y todo lo que escribes se usan en tus pruebas. <br><br>  Para empezar, le dir√© lo que tomamos de Codeception y lo usar√© de inmediato, sin modificar nada, sin resolver tareas o problemas adicionales. <br><br>  <b>M√≥dulos est√°ndar</b> <br><br><ol><li>  Phpbrowser </li><li>  DESCANSO </li><li>  Db </li><li>  Cli </li><li>  AMQP </li></ol><br>  El primer m√≥dulo de este tipo es PhpBrowser.  Este m√≥dulo es un contenedor sobre Guzzle que le permite interactuar con su aplicaci√≥n: abrir p√°ginas, completar formularios, enviar formularios.  Y si no le interesan las pruebas entre navegadores y navegadores, si de repente prueba la interfaz de usuario, puede usar PhpBrowser.  Como regla general, lo usamos en nuestras pruebas de IU, porque no necesitamos ninguna l√≥gica de interacci√≥n complicada, solo necesitamos abrir la p√°gina y hacer algo peque√±o all√≠. <br><br>  El segundo m√≥dulo que utilizamos es REST.  Creo que el nombre deja en claro lo que est√° haciendo.  Para cualquier interacci√≥n http, puede usar este m√≥dulo.  Me parece que casi todas las interacciones se resuelven en √©l: encabezados, cookies, autorizaci√≥n.  Todo lo que necesitas est√° en √©l. <br><br>  El tercer m√≥dulo que usamos fuera de la caja es el m√≥dulo Db.  En versiones recientes de Codeception, no se ha agregado soporte para una, sino varias bases de datos.  Por lo tanto, si de repente tiene varias bases de datos en su proyecto, ahora funciona de inmediato. <br><br>  El m√≥dulo Cli, que le permite ejecutar <b>comandos de shell</b> y <b>bash</b> desde pruebas, y tambi√©n lo usamos. <br><br>  Hay un m√≥dulo AMQP que funciona con cualquier agente de mensajes basado en este protocolo.  Quiero se√±alar que se ha probado oficialmente en RabbitMQ.  Como usamos RabbitMQ, todo est√° bien con √©l. <br><br>  De hecho, Codeception, al menos en nuestro caso, cubre el 80-85% de todas las tareas que necesitamos.  Pero a√∫n ten√≠a que trabajar en algo. <br><br>  Comencemos con SOAP. <br><img src="https://habrastorage.org/webt/c9/zy/bk/c9zybkm3eu-kvkxc_uvpcte_h0u.jpeg" alt="imagen"><br><br>  En nuestros servicios, en algunos lugares hay puntos finales SOAP.  Necesitan ser probados, tirados, algo que ver con ellos.  Pero dir√° que en Codeception existe un m√≥dulo que le permite enviar solicitudes y luego hacer algo con las respuestas.  De alguna manera analizar, agregar cheques y todo est√° bien.  Pero el m√≥dulo SOAP no funciona de f√°brica con m√∫ltiples puntos finales SOAP. <br><img src="https://habrastorage.org/webt/uj/s_/zv/ujs_zvshqpzmecycdggm3mys4nq.jpeg" alt="imagen"><br><br>  Por ejemplo, tenemos monolitos que tienen varios WSDL, varios puntos finales SOAP.  Esto significa que es imposible en el m√≥dulo Codeception configurar esto en un archivo yml para que pueda funcionar con varios. <br><img src="https://habrastorage.org/webt/uc/z-/ab/ucz-abgapgah_r9qo6uoitkstg8.jpeg" alt="imagen"><br><br>  Codeception tiene una reconfiguraci√≥n de m√≥dulo din√°mico, y puede escribir alg√∫n tipo de adaptador para recibir, por ejemplo, un m√≥dulo SOAP y reconfigurarlo din√°micamente.  En este caso, es necesario reemplazar el punto final y el esquema utilizado.  Luego, en la prueba, si necesita cambiar el punto final al que desea enviar una solicitud, obtenemos nuestro adaptador y lo cambiamos a un nuevo punto final, a un nuevo circuito y le enviamos una solicitud. <br><img src="https://habrastorage.org/webt/68/iu/kl/68iuklk2oherxt4ov7odgrszyli.jpeg" alt="imagen"><br><br>  En Codeception, no hay trabajo con Kafka y no hay complementos de terceros m√°s o menos oficiales para trabajar con Kafka.  No hay nada de qu√© preocuparse, escribimos nuestro m√≥dulo. <br><img src="https://habrastorage.org/webt/es/gp/eg/esgpegswio_kwmtqer7gkqvjfgi.jpeg" alt="imagen"><br><br>  Por lo tanto, est√° configurado en un archivo yml.  Algunas configuraciones est√°n establecidas para corredores, consumidores y temas.  Estas configuraciones, cuando escribe su m√≥dulo, puede incorporarlo a los m√≥dulos con la funci√≥n de inicializaci√≥n e inicializar este m√≥dulo con la misma configuraci√≥n.  Y, de hecho, el m√≥dulo tiene todos los otros m√©todos para implementar: poner el mensaje en el tema y leerlo.  Eso es todo lo que necesitas de este m√≥dulo. <br><img src="https://habrastorage.org/webt/zo/5p/bo/zo5pbox8a8xxic2n8972phohhd0.jpeg" alt="imagen"><br><br>  <b>Conclusi√≥n</b> : los m√≥dulos para Codeception son f√°ciles de escribir. <br><br>  Adelante  Como dije, Codeception tiene un m√≥dulo Cli, un contenedor para comandos de <i>shell</i> y que trabaja con su salida. <br><img src="https://habrastorage.org/webt/8c/gg/yr/8cggyrxinincflxsx2ti3o4klwq.jpeg" alt="imagen"><br><br>  Pero a veces el comando de <i>shell</i> debe ejecutarse no en pruebas, sino en la aplicaci√≥n.  En general, las pruebas y las aplicaciones son entidades ligeramente diferentes, pueden estar en diferentes lugares.  Las pruebas se pueden ejecutar en un lugar y la aplicaci√≥n puede estar en otro. <br><br>  Entonces, ¬øpor qu√© necesitamos ejecutar <i>shell</i> en las pruebas? <br><br>  Tenemos comandos en aplicaciones que, por ejemplo, analizan colas en RabbitMQ y mueven objetos por estado.  Estos comandos en modo profesional se inician desde debajo del supervisor.  El supervisor supervisa su implementaci√≥n.  Si se caen, entonces √©l comienza de nuevo y as√≠ sucesivamente. <br><br>  Cuando probamos, el supervisor no se est√° ejecutando.  De lo contrario, las pruebas se vuelven inestables, impredecibles.  Nosotros mismos queremos controlar el lanzamiento de estos comandos dentro de la aplicaci√≥n.  Por lo tanto, necesitamos ejecutar estos comandos desde las pruebas en la aplicaci√≥n.  Usamos dos opciones.  Esa, que la otra, en principio, todo es igual y todo funciona. <br><br>  ¬øC√≥mo ejecutar un <i>shell</i> en una aplicaci√≥n? <br><br>  Primero: ejecute las pruebas en el mismo lugar donde se encuentra la aplicaci√≥n.  Como todas las aplicaciones que tenemos en Docker, las pruebas se pueden ejecutar en el mismo contenedor donde se encuentra el servicio. <br><br>  La segunda opci√≥n: hacer un contenedor separado para las pruebas, alg√∫n <i>corredor de prueba</i> , pero hacerlo igual que la aplicaci√≥n.  Es decir, de la misma imagen de Docker, y luego todo funcionar√° de manera similar. <br><img src="https://habrastorage.org/webt/wm/hw/g0/wmhwg0-0xviw0be73xgrwfppsfi.jpeg" alt="imagen"><br><br>  Otro problema que encontramos en las pruebas es trabajar con varios sistemas de archivos.  A continuaci√≥n se muestra un ejemplo de lo que puede y debe trabajar.  Los tres primeros son relevantes para nosotros.  Estos son Webdav, SFTP y el sistema de archivos de Amazon. <br><br>  ¬øCon qu√© necesitas trabajar? <br><br><ol><li>  Webdav </li><li>  FTP / SFTP </li><li>  AWS S3 </li><li>  Local </li><li>  Azure, Dropbox, Google Drive </li></ol><br>  Si hurga en Codeception, puede encontrar algunos m√≥dulos para casi cualquier sistema de archivos m√°s o menos popular. <br><br><img src="https://habrastorage.org/webt/84/kr/ol/84krold4wqwi4ckxe4trmr8u9oq.jpeg" alt="imagen"><br><br>  Lo √∫nico que no encontr√© es para Webdav.  Pero estos sistemas de archivos, m√°s o menos, son los mismos en t√©rminos de trabajo externo con ellos, y queremos trabajar con ellos de la misma manera. <br><br>  Escribimos nuestro m√≥dulo llamado Flysystem.  Se encuentra en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Github</a> en el dominio p√∫blico y admite 2 sistemas de archivos, SFTP y Webdav, y le permite trabajar con ambos utilizando la misma API. <br><img src="https://habrastorage.org/webt/5a/w5/sm/5aw5smemb1fabsbsyvt5eit70r8.jpeg" alt="imagen"><br><br>  Obtenga una lista de archivos, limpie el directorio, escriba un archivo, etc.  Si tambi√©n agrega el sistema de archivos de Amazon all√≠, nuestras necesidades definitivamente ser√°n cubiertas. <br><br>  El siguiente punto, creo, es muy importante para las pruebas autom√°ticas, especialmente el nivel del sistema, es trabajar con bases de datos.  En general, quiero que sea, como en la imagen, - VZHUH y todo se inicia, funciona, y estas bases de datos deber√≠an ser menos compatibles en las pruebas. <br><img src="https://habrastorage.org/webt/hb/-y/ul/hb-yulyfmetwazoatr4oukazpli.jpeg" alt="imagen"><br><br>  ¬øCu√°les son las tareas principales que veo aqu√≠? <br><br><ol><li>  C√≥mo desplegar la base de datos de la estructura deseada - Db </li><li>  C√≥mo llenar la base de datos con datos de prueba: Db, accesorios </li><li>  C√≥mo hacer selecciones y comprobaciones - Db </li></ol><br>  Para las 3 tareas en Codeception, hay 2 m√≥dulos: Db, del que ya habl√©, otro se llama Fixtures. <br><br>  De estos 2 m√≥dulos y 3 tareas, usamos solo DB para la tercera tarea. <br><br>  Para la primera tarea, puede usar DB.  All√≠ puede configurar el volcado de SQL desde el que se implementar√° la base de datos, bueno, el m√≥dulo con accesorios, creo que est√° claro por qu√© es necesario. <br><br>  Habr√° accesorios en forma de matrices que pueden persistir en la base de datos. <br><br>  Como dije, las primeras 2 tareas las resolvemos de manera un poco diferente, ahora te dir√© c√≥mo lo hacemos. <br><br>  <b>Despliegue de base de datos</b> <br><br><ol><li>  Levantar un contenedor con PostgreSQL o MySQL </li><li>  Rodamos todas las migraciones con doctrina migraciones </li></ol><br>  El primero se trata de implementar una base de datos.  ¬øC√≥mo sucede esto en las pruebas?  Levantamos el contenedor con la base de datos deseada, ya sea PostgreSQL o MySQL, y luego hacemos todas las migraciones necesarias usando <i>migraciones de doctrina</i> .  Todo, la base de datos de la estructura deseada est√° lista, se puede usar en pruebas. <br><br>  Por qu√© no utilizamos la humedad, porque no es necesario que sea compatible.  Este es un tipo de volcado que se encuentra en las pruebas, que debe actualizarse constantemente si algo cambia en la base de datos.  Hay migraciones, no es necesario mantener un volcado. <br><br>  El segundo punto es la creaci√≥n de datos de prueba.  No utilizamos el m√≥dulo Fixtures de Codeception, utilizamos el paquete <i>Symfony</i> para los fixtures. <br><img src="https://habrastorage.org/webt/kx/lf/m9/kxlfm9zppbdqmgj_i_ekaripjw4.jpeg" alt="imagen"><br><br>  Hay un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace</a> y un ejemplo de c√≥mo puede crear accesorios en la base de datos. <br><br>  Su dispositivo se crear√° como un objeto del dominio, se puede almacenar en la base de datos y los datos de prueba estar√°n listos. <br><br>  ¬øPor qu√© DoctrineFixtureBundle? <br><br><ol><li>  M√°s f√°cil de crear cadenas de objetos relacionados. </li><li>  Menos duplicaci√≥n de datos si los accesorios para diferentes pruebas son similares. </li><li>  Menos ediciones al cambiar la estructura de la base de datos. </li><li>  Las clases de fijaci√≥n son mucho m√°s visuales que las matrices. </li></ol><br>  ¬øPor qu√© lo usamos?  S√≠, por la misma raz√≥n: estos accesorios son mucho m√°s f√°ciles de mantener que los accesorios de Codeception.  Es m√°s f√°cil crear cadenas de objetos relacionados, porque todo est√° en el paquete de Symfony.  Es necesario duplicar menos datos, ya que los accesorios se pueden heredar, estas son clases.  Si la estructura de la base de datos cambia, estas matrices siempre deben editarse, y las clases no siempre.  Los accesorios en forma de objetos de dominio siempre son m√°s visibles que las matrices. <br><br>  Hablamos de bases de datos, hablemos un poco sobre moki. <br><br>  Dado que estas son pruebas de un nivel suficientemente alto que prueban todo el sistema y que nuestros sistemas est√°n altamente interconectados, est√° claro que hay algunos intercambios e interacciones.  Ahora hablaremos de mokeys sobre la interacci√≥n entre sistemas. <br><br>  <b>Reglas para mok</b> <br><br><ol><li>  Llora todas las interacciones externas del servicio http </li><li>  Verificaci√≥n no solo de escenarios positivos, sino tambi√©n negativos </li></ol><br>  Las interacciones son algunas interacciones http REST o SOAP.  Todas estas interacciones en el marco de las pruebas que estamos mojando.  Es decir, en nuestras pruebas no existe un atractivo real para los sistemas externos en ninguna parte.  Esto hace que las pruebas sean estables.  Debido a que un servicio externo puede funcionar, puede no funcionar, puede responder lentamente, puede que r√°pidamente, en general, no sepa cu√°l es su comportamiento.  Por lo tanto, lo cubrimos todo con moks. <br><br>  Tambi√©n tenemos esa regla.  Estamos mojando no solo las interacciones positivas, sino tambi√©n tratando de verificar algunos casos negativos.  Por ejemplo, cuando un servicio de terceros responde con un error n√∫mero 500 o produce un error m√°s significativo, intentamos verificarlo todo. <br><br>  Usamos Wiremock para simulacros, Codeception es compatible ..., tiene un complemento oficial Httpmock, pero nos gust√≥ m√°s Wiremock.  Como funciona <br><br><br><br>  Wiremock se eleva como un contenedor Docker separado durante las pruebas, y todas las solicitudes que deben ir al sistema externo van a Wiremock. <br><br><img src="https://habrastorage.org/webt/n9/cb/y8/n9cby8a1hoiicw5fqprvzsfxsae.jpeg" alt="imagen"><br><br>  Wiremock, si nos fijamos en la diapositiva, hay un cuadro de este tipo, Solicitud de asignaci√≥n, tiene un conjunto de asignaciones que dicen que si llega tal solicitud, debe dar esa respuesta.  Todo es muy simple: lleg√≥ una solicitud, recibi√≥ un simulacro. <br><br>  Los simulacros se pueden crear est√°ticamente, luego el contenedor, cuando ya con Wiremock se eleva, estos simulacros estar√°n disponibles, se pueden usar en pruebas manuales.  Puede crear din√°micamente, directamente en el c√≥digo, en alg√∫n tipo de prueba. <br><br>  Aqu√≠ hay un ejemplo de c√≥mo crear un simulacro din√°micamente, como puede ver, la descripci√≥n es bastante declarativa, del c√≥digo queda claro de inmediato qu√© tipo de simulacro estamos creando: un simulacro para el m√©todo GET que viene a tal URL y, de hecho, qu√© devolver. <br><br><img src="https://habrastorage.org/webt/d7/xu/2g/d7xu2gg75_-vjff1ejruhj2dvba.jpeg" alt="imagen"><br><br>  Adem√°s del hecho de que este simulacro se puede crear, Wiremock tiene la oportunidad de verificar qu√© solicitud se envi√≥ a este simulacro.  Esto tambi√©n es muy √∫til en las pruebas. <br><br>  Sobre Codeception en s√≠, probablemente, todo, y algunas palabras sobre c√≥mo se ejecutan nuestras pruebas y un poco de infraestructura. <br><br>  Que estamos usando <br><br><img src="https://habrastorage.org/webt/qy/my/hj/qymyhjaocwm0apzi7orjlot7hnw.jpeg" alt="imagen"><br><br>  Bueno, en primer lugar, todos los servicios que tenemos en Docker, por lo que lanzar un entorno de prueba est√° generando los contenedores correctos. <br><br>  Make se usa para comandos internos, Bamboo se usa como CI. <br><br>  ¬øC√≥mo se ve la prueba de CI? <br><br><img src="https://habrastorage.org/webt/hb/iq/jf/hbiqjftacif8wg-67x666c7l5yc.jpeg" alt="imagen"><br><br>  Primero, creamos la versi√≥n deseada de la aplicaci√≥n, luego elevamos el entorno: esta es la aplicaci√≥n, todos los servicios que necesita, como Kafka, Rabbit, la base de datos, y trasladamos la migraci√≥n a la base de datos. <br><br>  Todo este entorno se plantea con la ayuda de Docker Compose.  Es en CI, en prod que todos los contenedores giran bajo Kubernetes.  Luego ejecuta las pruebas y corre. <br><br>  ¬øCu√°nto tiempo lleva todo? <br><br>  Todo depende del servicio espec√≠fico, pero, por regla general, aumentar el entorno antes de ejecutar las pruebas es de 5 a 10 minutos, pruebas, de 6 a 30 minutos. <br><br><img src="https://habrastorage.org/webt/nm/kh/n0/nmkhn0sdps-qtoowra4mrtgtu8m.jpeg" alt="imagen"><br><br>  Advertir√© inmediatamente esta pregunta mientras todas las pruebas persiguen en un hilo. <br><br>  Bueno, tal pregunta.  ¬øCon qu√© frecuencia se deben ejecutar las pruebas?  Por supuesto, cuanto m√°s a menudo, mejor.  Cuanto antes pueda detectar un problema, m√°s r√°pido podr√° resolverlo. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenemos 2 reglas principales. </font><font style="vertical-align: inherit;">Cuando una tarea entra en pruebas, todas las pruebas, tanto las pruebas unitarias como las no unitarias, deben pasarla. </font><font style="vertical-align: inherit;">Si algunas pruebas fallan, esta es una ocasi√≥n para transferir la tarea a la reparaci√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Naturalmente, cuando lancemos el lanzamiento. </font><font style="vertical-align: inherit;">En el lanzamiento, todas las pruebas deben pasar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al final, me gustar√≠a decir algo inspirador: escribir pruebas, dejar que sean verdes, usar Codeception, hacer moki. </font><font style="vertical-align: inherit;">Creo que todos entienden perfectamente esto.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/452136/">https://habr.com/ru/post/452136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452124/index.html">‚ÄúNecesitamos hambre de conocimiento y logros‚Äù: ¬øc√≥mo es ser un probador en Alfa-Bank?</a></li>
<li><a href="../452128/index.html">Conceptos err√≥neos populares sobre la resistencia a la radiaci√≥n de los microcircuitos</a></li>
<li><a href="../452130/index.html">La luna se est√° encogiendo, causa terremotos</a></li>
<li><a href="../452132/index.html">Camino independiente</a></li>
<li><a href="../452134/index.html">C√≥mo comenz√≥ todo: la historia del soldador y el advenimiento de las herramientas modernas</a></li>
<li><a href="../452138/index.html">13. Check Point Getting Started R80.20. Licencia</a></li>
<li><a href="../452140/index.html">¬øPor qu√© los directores financieros cambian a un modelo de costos operativos en TI?</a></li>
<li><a href="../452142/index.html">¬øC√≥mo nos ocupamos de copiar contenido, o el primer ataque de confrontaci√≥n en prod</a></li>
<li><a href="../452146/index.html">Entonces, ¬øqu√© pasar√° con la autenticaci√≥n y las contrase√±as? Parte 2 del Informe de estado de autenticaci√≥n fuerte de jabalina</a></li>
<li><a href="../452152/index.html">¬øQu√© soluciones tiene Rostelecom para IIoT?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>