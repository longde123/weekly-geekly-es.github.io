<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∑üèæ üëÅ‚Äçüó® üçì Criar as bordas de um mapa gerado processualmente üò± üîó üëáüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Scott Turner continua trabalhando em seu jogo processualmente gerado e agora decidiu resolver o problema de projetar as bordas dos mapas. Para fazer i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criar as bordas de um mapa gerado processualmente</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444190/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ce/ea0/3df/0ceea03df1f07131e0ad27e6bbd45731.png" alt="imagem"></div><br>  <i>Scott Turner continua trabalhando em seu jogo processualmente gerado e agora decidiu resolver o problema de projetar as bordas dos mapas.</i>  <i>Para fazer isso, ele precisa resolver v√°rios problemas dif√≠ceis e at√© criar sua pr√≥pria linguagem para descrever limites.</i> <br><br>  As fronteiras continuavam sendo um elemento importante dos cart√µes de fantasia, que estavam na minha lista h√° algum tempo.  Os mapas funcionais geralmente t√™m uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">linha de fronteira</a> simples, mas os mapas de fantasia e os mapas medievais, dos quais os primeiros costumam emprestar id√©ias, t√™m limites art√≠sticos e bem pensados.  Esses limites deixam claro que o mapa √© intencionalmente tornado fant√°stico e d√£o ao espectador uma sensa√ß√£o de admira√ß√£o. <br><br>  Atualmente, existem algumas maneiras simples de desenhar bordas no meu jogo <b>Dragons Abound</b> .  Ela pode desenhar uma linha simples ou dupla ao redor do per√≠metro do mapa e adicionar elementos simples nos cantos, como nas figuras: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aed/9f8/477/aed9f8477ef53b5550b742ea1fde36b2.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cac/37e/bac/cac37ebac81815955dfc940bacdc2eff.png"></div><br>  O jogo tamb√©m pode adicionar um campo na parte inferior da borda para o nome do mapa.  Existem v√°rias varia√ß√µes desse campo em <b>Dragons Abound</b> , incluindo elementos complexos como cabe√ßas de parafusos falsos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/42f/f6f/c3a/42ff6fc3adae5b40293bb82d5a1be325.png"></div><br>  H√° variabilidade nesses campos de nome, mas todos s√£o criados manualmente. <br><br>  Um aspecto interessante dos limites dos cart√µes de fantasia √© que eles s√£o criativos e modelo.  Geralmente, eles consistem em um pequeno n√∫mero de elementos simples que se combinam de maneiras diferentes para criar um resultado √∫nico.  Como sempre, o primeiro passo para trabalhar com um novo t√≥pico √© estudar uma cole√ß√£o de exemplos de mapas, criar um cat√°logo de tipos de elementos de borda e estudar sua apar√™ncia. <br><a name="habracut"></a><br>  A borda mais simples √© uma linha que percorre as bordas do mapa e indica seus limites.  Como eu disse acima, tamb√©m √© chamada de "linha de quadro": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99f/c81/c98/99fc81c98e1092077272081464d28752.png"></div><br>  H√° tamb√©m uma varia√ß√£o com a localiza√ß√£o das bordas no mapa.  Nesta vers√£o, o mapa atinge as bordas da imagem, mas a borda cria uma borda virtual dentro da imagem: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43f/aef/1db/43faef1db7bf3af195c857d7ed673710.png"></div><br>  Isso pode ser feito com qualquer tipo de borda, mas geralmente √© usado apenas com bordas simples, como a borda de um quadro. <br><br>  Um conceito de design de cart√£o de fantasia popular √© simular como se fossem desenhados em pergaminho antigo e rasgado.  √Äs vezes, isso √© realizado desenhando a borda como a borda √°spera do papel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/907/cb2/ff1/907cb2ff125bbd178f9a16717e5e724f.png"></div><br>  Aqui est√° um exemplo mais sofisticado: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/751/860/d6e/751860d6e43ed2e857cf6f3ba7f766e0.png"></div><br>  Na minha experi√™ncia, esse m√©todo se tornou menos popular porque as ferramentas digitais foram usadas.  Se voc√™ deseja que o cart√£o pare√ßa um pergaminho antigo e rasgado, √© mais f√°cil aplicar a textura do pergaminho a ele do que desenh√°-lo √† m√£o. <br><br>  A ferramenta mais poderosa na cria√ß√£o de bordas do mapa √© a repetibilidade.  No caso mais simples, basta repetir uma √∫nica linha para criar duas linhas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31d/139/e12/31d139e129fe513e07937c5a2bd88979.png"></div><br>  Voc√™ pode adicionar interesse ao mapa variando o estilo do elemento repetido, nesse caso combinando uma linha √∫nica grossa com uma √∫nica linha fina: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/530/ccd/118/530ccd11872f4aa6a32d4b3271cf94f3.png"></div><br>  Dependendo do elemento, s√£o poss√≠veis v√°rias varia√ß√µes de estilo.  Neste exemplo, a linha se repete, mas a cor muda: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc7/89e/96c/fc789e96ccfba58ac4cb595e5ec33fb7.png"></div><br>  Para criar padr√µes mais complexos, voc√™ pode usar a "repetibilidade repet√≠vel".  Essa borda consiste em aproximadamente cinco linhas √∫nicas com diferentes larguras e dist√¢ncias: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/488/ef4/796488ef402e59ed7e092e0e14ff2469.png"></div><br>  Essa borda repete as linhas, mas as separa para que pare√ßam duas bordas finas separadas.  Nesta parte do post, n√£o falarei sobre o processamento de √¢ngulos, mas √¢ngulos diferentes para as duas linhas tamb√©m ajudam a criar essa diferen√ßa. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97b/fd8/336/97bfd833697b9278660772c1bd04ee46.png"></div><br>  Essas duas linhas s√£o quatro ou seis?  Eu acho que tudo depende de como voc√™ os desenha! <br><br>  Outro elemento de estiliza√ß√£o √© preencher o espa√ßo entre os elementos com cor, padr√£o ou textura.  Neste exemplo, a borda ficou mais interessante devido ao preenchimento da cor de destaque entre as duas linhas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d8/ccf/158/1d8ccf158b9ae0378ddaef1031ba15c9.png"></div><br>  Aqui est√° um exemplo de como a borda √© preenchida com um padr√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f87/37d/bb2/f8737dbb215166947e42f0da1b45cfc7.png"></div><br>  Al√©m disso, os elementos podem ser estilizados para parecerem tridimensionais.  Aqui est√° um mapa no qual a borda √© sombreada para parecer volumosa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a80/25b/695/a8025b69549773f8935d2b37680401a3.png"></div><br>  Nesse mapa, a borda √© sombreada para ter uma apar√™ncia tridimensional e isso √© combinado com a localiza√ß√£o das bordas dentro das bordas do mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36c/899/9e7/36c8999e74172c962aef40a4a9e3addc.png"></div><br>  Outro elemento de borda comum √© a escala na forma de listras coloridas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ee/f62/0b8/4eef620b830eb0249d019229140e34e6.png"></div><br>  Essas faixas formam uma grade ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">grade cartogr√°fica</a> ).  Em mapas reais, a escala ajuda a determinar dist√¢ncias, mas em mapas de fantasia √© principalmente um elemento decorativo. <br><br>  Essas listras s√£o geralmente desenhadas em preto e branco, mas √†s vezes s√£o adicionadas vermelhas ou outras cores: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/450/f0f/f67/450f0ff67ac1fdf5c5e2ffaf8fbe80c0.png"></div><br>  Este elemento tamb√©m pode ser combinado com outros, como neste exemplo, com linhas e escala: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/313/d56/29d/313d5629d6ec8b8d7c7c4c1ead322a09.png"></div><br>  Este exemplo √© um pouco incomum.  Normalmente, a escala (se houver) √© o elemento mais interno da borda. <br><br>  Neste mapa, existem escalas diferentes com resolu√ß√µes diferentes (al√©m de notas r√∫nicas estranhas!): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74b/cd6/217/74bcd62173160e440a4ee6cfad2128c1.png"></div><br>  (No Reddit, o usu√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AbouBenAdhem</a> me informou que as marcas r√∫nicas s√£o os n√∫meros 48 e 47 escritos em cuneiforme babil√¥nico. Al√©m disso, ‚Äúescalas com resolu√ß√µes diferentes‚Äù t√™m seis divis√µes divididas em dez divis√µes menores, o que corresponde ao sistema num√©rico hexadecimal da Babil√¥nia. Indico as fontes dos mapas, mas h√° muitas pe√ßas pequenas neste post, ent√£o n√£o me incomodei. No entanto, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este mapa foi</a> criado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Thomas Ray</a> para o autor S.E. Boleyn, ent√£o, talvez, a a√ß√£o em seus livros ocorra na comitiva da Babil√¥nia.) <br><br>  Al√©m de linhas e escala, o elemento mais comum √© um padr√£o geom√©trico repetitivo.  Muitas vezes, consiste em partes como c√≠rculos, losangos e ret√¢ngulos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31c/6ba/f61/31c6baf612bf2fa11a13905e4482d82e.png"></div><br>  Elementos geom√©tricos, como linhas, podem ser sombreados para torn√°-los tridimensionais: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43e/cc8/c33/43ecc8c33bbf3143ba32c18b878d16e2.png"></div><br>  Limites complexos podem ser criados combinando esses elementos de maneiras diferentes.  Aqui est√° a borda que combina linhas, padr√µes geom√©tricos e escala: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  Os exemplos mostrados acima foram cart√µes digitais, mas, √© claro, o mesmo pode ser feito com cart√µes manuscritos.  Aqui est√° um exemplo de um padr√£o geom√©trico simples criado √† m√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6f7/c2d/e3d/6f7c2de3d5db82a9c7e9884d726be98e.png"></div><br>  Esses elementos tamb√©m podem ser combinados de forma flex√≠vel de v√°rias maneiras.  Aqui est√° um padr√£o geom√©trico combinado com uma ‚Äúaresta irregular‚Äù: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fa/f1a/150/0faf1a15052e90a479428c4c495ad44c.png"></div><br>  Nos exemplos mostrados acima, o padr√£o geom√©trico √© bastante simples.  Mas voc√™ pode criar padr√µes muito complexos combinando de maneira diferente os elementos geom√©tricos b√°sicos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/38e/13f/fc2/38e13ffc2a2aac266aabb291a7d7f0e6.png"></div><br>  Outro elemento popular do padr√£o √© a tecelagem ou o n√≥ celta: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07e/00e/8d8/07e00e8d868b6ca48be746fbe07e61ca.png"></div><br>  Aqui est√° uma borda de vime mais complexa contendo cor, escala e outros elementos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e1/580/140/5e158014012fffcbc51e2e3fe71772d6.png"></div><br>  Neste mapa, a tecelagem √© combinada com um elemento de borda irregular: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e95/4df/588/e954df58825bc42d408b61804a1287a9.png"></div><br>  Al√©m dos padr√µes geom√©tricos e da tecelagem, qualquer padr√£o repetitivo pode fazer parte da borda do cart√£o.  Aqui est√° um exemplo usando formas semelhantes a pontas de seta: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7be/5ce/64e/7be5ce64eb09de2eeefdb18992978d03.png"></div><br>  E aqui est√° um exemplo com um padr√£o de onda repetido: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/c13/3c2/841c133c2f1c0f724b5d076e5ea415fb.png"></div><br>  E, finalmente, runas ou outros elementos do alfabeto de fantasia s√£o adicionados √†s bordas das cartas de fantasia: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/6dd/3a3/15f6dd3a3e6191da02dc884193b72c82.png"></div><br>  Os exemplos acima s√£o retirados de mapas de fantasia modernos, mas aqui est√° um exemplo de um mapa hist√≥rico (s√©culo 18) com linhas e um padr√£o desenhado √† m√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d7/b9f/3b8/1d7b9f3b8f0c7eb296079c5f6f6b23aa.png"></div><br>  Obviamente, voc√™ pode encontrar exemplos de mapas com muitos outros elementos nas bordas.  Algumas das mais belas s√£o totalmente desenhadas √† m√£o e t√™m decora√ß√µes t√£o cuidadosamente elaboradas que podem superar o pr√≥prio cart√£o ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">World of Alma</a> , Francesca Baerald): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c7/004/e18/1c7004e186e0d2be63b98539375316ff.png"></div><br>  Tamb√©m vale a pena conversar um pouco sobre <i>simetria</i> .  Como a repetibilidade, a simetria √© uma ferramenta poderosa e as bordas do mapa geralmente s√£o sim√©tricas ou possuem elementos sim√©tricos. <br><br>  Muitas bordas do mapa s√£o sim√©tricas de dentro para fora, como neste exemplo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/488/ef4/796488ef402e59ed7e092e0e14ff2469.png"></div><br>  Aqui, a borda √© composta de v√°rias linhas com e sem preenchimento, mas de fora para dentro repete idealmente em rela√ß√£o ao centro da borda. <br><br>  Neste exemplo mais complexo, a borda √© sim√©trica, com exce√ß√£o das faixas de escala em preto e branco alternadas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e1/580/140/5e158014012fffcbc51e2e3fe71772d6.png"></div><br>  Como duplicar a escala n√£o faz sentido, geralmente √© considerado um elemento separado, mesmo que o restante da borda seja sim√©trico. <br><br>  Al√©m da simetria interna-externa, as bordas s√£o frequentemente re-sim√©tricas ao longo de seu comprimento.  Algumas bordas ilustradas podem ter um design simples que abrange todo o comprimento da borda do mapa, mas na maioria dos casos o padr√£o √© bastante curto e se repete, preenchendo a borda de um canto para outro: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  Observe que neste exemplo o padr√£o cont√©m um elemento que n√£o √© sim√©trico (da esquerda para a direita), mas o padr√£o geral √© sim√©trico e se repete: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7be/5ce/64e/7be5ce64eb09de2eeefdb18992978d03.png"></div><br>  Uma exce√ß√£o not√°vel a essa regra s√£o as bordas preenchidas com runas ou caracteres alfab√©ticos.  Muitas vezes, eles se tornam √∫nicos, como se alguma mensagem longa fosse escrita ao longo da fronteira: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/6dd/3a3/15f6dd3a3e6191da02dc884193b72c82.png"></div><br>  Obviamente, existem muitos outros exemplos de elementos de borda do mapa que eu n√£o considerei aqui, mas j√° temos um bom ponto de refer√™ncia.  Nas pr√≥ximas partes, desenvolverei v√°rias fun√ß√µes em <b>Dragons Abound</b> para descrever, exibir e gerar bordas de mapa proceduralmente semelhantes a esses exemplos.  Na segunda parte, come√ßaremos definindo o idioma para descrever as bordas dos mapas. <br><br><h2>  Parte 2 </h2><br>  Nesta parte, vou criar a vers√£o inicial do MBDL (Map Border Description Language). <br><br>  Por que gastar tempo criando uma linguagem de descri√ß√£o de limite de mapa?  Primeiro, esse ser√° o objetivo da minha gera√ß√£o processual.  Mais tarde, escreverei um algoritmo para criar novas bordas do mapa, e a sa√≠da desse algoritmo ser√° uma descri√ß√£o da nova borda no MBDL.  Em segundo lugar, o MBDL servir√° como uma representa√ß√£o textual dos limites do mapa.  Em particular, preciso ser capaz de salvar e reutilizar meus limites.  Para fazer isso, preciso de uma nota√ß√£o de texto que possa ser escrita e usada para recriar a borda do mapa. <br><br>  Vou come√ßar a criar o MBDL definindo o elemento mais simples: a linha.  A linha tem cor e largura.  Portanto, no MBDL, apresentarei a linha desta forma: <br><br><blockquote><code>L(width, color)</code> </blockquote> <br>  Aqui est√£o alguns exemplos (desculpe pelas minhas habilidades no Photoshop): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db2/db8/68e/db2db868ede7282a34c695f8062a691b.png"></div><br>  A sequ√™ncia de elementos √© renderizada de fora para dentro (*), portanto, assumimos que esta √© a borda no topo do mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b7c/75e/b3a/b7c75eb3aefb8f77d1915166c0bdd979.png"></div><br>  Veja o segundo exemplo - uma linha com bordas √© representada como tr√™s elementos de linha separados. <br><br>  <i>(* Desenhar de fora para dentro era uma escolha arbitr√°ria - pareceu-me que era mais natural do que renderizar de dentro para fora. Infelizmente, como aconteceu muito mais tarde, havia uma boa raz√£o para trabalhar na dire√ß√£o oposta. - antiga, porque levaria muito tempo para refazer todas as ilustra√ß√µes)</i> <br><br>  Convenientemente, os espa√ßos podem ser representados como linhas sem cor: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ba/1a4/171/0ba1a41719610641d7b5a5e26da0692e.png"></div><br>  Mas seria mais visual ter um elemento espacial vertical espec√≠fico: <br><br><blockquote>  VS (largura) </blockquote><br>  Os seguintes elementos simples s√£o formas geom√©tricas: listras, losangos e elipses.  Sup√µe-se que as linhas sejam esticadas por todo o comprimento da borda, para que n√£o tenham um comprimento especificado explicitamente.  Por√©m, figuras geom√©tricas n√£o podem preencher a linha inteira; portanto, al√©m da largura (*), cada uma deve ter comprimento, cor de contorno, largura de contorno e cor de preenchimento: <br><br><blockquote> <code>B(width, length, outline, outline width, fill) <br> D(width, length, outline, outline width, fill) <br> E(width, length, outline, outline width, fill)</code> </blockquote> <br>  (* Aceitei que considerarei a largura na dire√ß√£o de fora para dentro e o comprimento √© medido ao longo da borda.) <br><br>  Aqui est√£o exemplos de formas geom√©tricas simples: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a3d/fad/cf6/a3dfadcf6a5a98a9785b0b487a6e17fc.png"></div><br>  Para esses elementos preencherem todo o comprimento da borda, eles devem ser repetidos.  Para indicar o grupo de elementos que ser√£o repetidos para preencher o comprimento da borda, use colchetes: <br><br><blockquote> <code>[ element element element ... ]</code> </blockquote> <br>  Aqui est√° um exemplo de um padr√£o repetido de ret√¢ngulos e losangos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/420/d88/64e/420d8864e72e178252766172dc0320ab.png"></div><br>  √Äs vezes, precisarei de um espa√ßo (horizontal) entre os elementos de um padr√£o repetitivo.  Embora voc√™ possa usar um elemento sem cores para criar um espa√ßo, ser√° mais inteligente e conveniente ter um elemento de espa√ßo horizontal: <br><br><blockquote> <code>HS(length)</code> </blockquote> <br>  A √∫ltima fun√ß√£o necess√°ria para essa primeira itera√ß√£o do MBDL √© a capacidade de empilhar elementos uns sobre os outros.  Aqui est√° um exemplo de borda: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ea/7e9/3f3/8ea7e93f3040563ef7ec2715ca39a14d.png"></div><br>  A maneira mais f√°cil de descrev√™-lo √© uma ampla linha amarela sob o padr√£o superior.  Voc√™ pode implementar isso de maneiras diferentes (por exemplo, um espa√ßo vertical negativo), mas eu decidi usar chaves para indicar a ordem dos elementos para dentro: <br><br><blockquote> <code>{element element element ...}</code> </blockquote> <br>  De fato, esta entrada diz para voc√™ lembrar onde o padr√£o estava de fora para dentro ao inserir os colchetes e, em seguida, retornar a esse ponto ao deixar os colchetes.  Os colchetes tamb√©m podem ser considerados como uma descri√ß√£o dos elementos que ocupam um espa√ßo vertical.  Portanto, a borda mostrada acima pode ser descrita da seguinte maneira: <br><br><blockquote> <code><b>L(1, black) <br> {L(20, yellow)} <br> VS(3) <br> [B(5, 10, black, 3, none) <br> D(5, 10, black,3,red)] <br> VS(3) <br> L(1, black)</b></code> </blockquote> <br>  Desenhamos uma linha preta, fixamos onde estamos, desenhamos uma linha amarela e, em seguida, retornamos √† posi√ß√£o anteriormente fixa, ca√≠mos um pouco, desenhamos um padr√£o de ret√¢ngulos e losangos, ca√≠mos um pouco e depois desenhamos outra linha preta. <br><br>  H√° muito mais a ser feito no MBDL, mas isso √© suficiente para descrever os muitos limites dos mapas.  A pr√≥xima etapa √© converter a descri√ß√£o do limite no MBDL na pr√≥pria borda.  Isso √© semelhante √† convers√£o de uma representa√ß√£o escrita de um programa de computador (como Javascript) na execu√ß√£o deste programa.  O primeiro est√°gio √© a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">an√°lise lexical (an√°lise) da</a> linguagem - a transforma√ß√£o do texto de origem em uma borda real do mapa ou em algum tipo de forma intermedi√°ria, que √© mais f√°cil de converter em uma borda. <br><br>  A an√°lise √© uma √°rea bastante estudada da ci√™ncia da computa√ß√£o.  A an√°lise de um idioma n√£o √© muito simples, mas, no nosso caso, √© bom (*) que o MBDL seja uma gram√°tica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">livre de contexto</a> .  As gram√°ticas sem contexto s√£o analisadas com bastante facilidade e existem muitas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ferramentas de an√°lise de Javascript</a> para elas.  Eu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">decidi</a> pelo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nearley.js</a> , que parece bastante maduro e (mais importante) uma ferramenta bem documentada. <br><br>  <i>(* Isso n√£o √© apenas sorte, eu me certifiquei de que a linguagem fosse livre de contexto.)</i> <br><br>  N√£o apresentarei gram√°ticas sem contexto, mas a sintaxe de Nearley √© bastante simples e voc√™ deve entender o significado sem problemas.  A gram√°tica Nearley consiste em um conjunto de regras.  Cada regra possui um caractere √† esquerda, uma seta e a parte direita da regra, que pode ser uma sequ√™ncia de caracteres e n√£o caracteres, al√©m de v√°rias op√ß√µes separadas pelo "|"  (ou): <br><br><blockquote> <code><b>border -&gt; element | element border <br> element -&gt;</b> ‚Äú <b>L"</b></code> </blockquote> <br>  Cada uma das regras diz que o lado esquerdo pode ser substitu√≠do por qualquer uma das op√ß√µes no lado direito.  Ou seja, a primeira regra diz que uma borda √© um elemento, ou um elemento, seguido por outra borda.  Que por si s√≥ pode ser um elemento ou um elemento seguido por uma borda e assim por diante.  A segunda regra diz que um elemento pode ser apenas uma string "L".  Ou seja, juntas essas regras correspondem a esses limites: <br><br><blockquote> <code><b>L <br> LLL</b></code> </blockquote> <br>  e n√£o correspondem a esses limites: <br><br><blockquote> <code><b>X <br> L3L</b></code> </blockquote> <br>  A prop√≥sito, se voc√™ deseja experimentar esta (ou qualquer outra) gram√°tica em Nearley, existe aqui uma caixa de prote√ß√£o on-line.  Voc√™ pode inserir gram√°tica e casos de teste para ver o que corresponde e o que n√£o corresponde. <br><br>  Aqui est√° uma defini√ß√£o mais completa de uma primitiva de linha: <br><br><blockquote> <code><b>@builtin ‚Äúnumber.ne" <br> @builtin ‚Äústring.ne" <br> border -&gt; element | element border <br> element -&gt; ‚ÄúL(" decimal ‚Äú," dqstring ‚Äú)"</b></code> </blockquote> <br>  Nearley possui v√°rios elementos internos comuns e o n√∫mero √© um deles.  Portanto, eu posso us√°-lo para reconhecer a largura num√©rica de uma linha primitiva.  Para reconhecimento de cores, eu uso outro elemento interno e permito o uso de qualquer string entre aspas duplas. <br><br>  Seria bom adicionar espa√ßos entre caracteres diferentes, ent√£o vamos faz√™-lo.  Nearley suporta classes de caracteres e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RBNF</a> para "zero ou mais" algo com ": *", para que eu possa usar isso para especificar "zero ou mais espa√ßos" e col√°-lo em qualquer lugar para permitir espa√ßos nas descri√ß√µes: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element border <br> WS -&gt; [\s]:* <br> number -&gt; WS decimal WS <br> color -&gt; WS dqstring WS <br> element -&gt; "L(" number "," color ")"</b></code> </blockquote> <br>  No entanto, o uso de WS por todo o lado dificulta a leitura da gram√°tica, ent√£o eu os abandonarei, mas imagine que eles s√£o. <br><br>  Um elemento tamb√©m pode ser um espa√ßo vertical: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")"</b></code> </blockquote> <br>  Isso corresponde a esses limites <br><br><blockquote> <code><b>L(3.5,"black") VS(3.5)</b></code> </blockquote> <br>  Em seguida, v√™m os primitivos de tira, losango e elipse. <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")"</b></code> </blockquote> <br>  Combina esses elementos <br><br><blockquote> <code><b>B(34, 17, "white", 3, "black")</b></code> </blockquote> <br>  (Observe que as primitivas geom√©tricas n√£o s√£o "elementos" porque n√£o podem estar sozinhas no n√≠vel superior. Elas devem estar entre um padr√£o.) <br><br>  Tamb√©m preciso de uma primitiva de espa√ßo horizontal: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")"</b></code> </blockquote> <br>  Agora vou adicionar uma opera√ß√£o padr√£o (repetir).  Esta √© uma sequ√™ncia de um ou mais elementos entre colchetes.  Vou usar o operador RBNF ": +", que aqui significa "um ou mais". <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")" <br> element -&gt; "[" (geometric):+ "]"</b></code> </blockquote> <br>  Observe que o padr√£o s√≥ pode ser preenchido com primitivas geom√©tricas.  N√£o podemos, por exemplo, colocar uma linha dentro de um padr√£o.  O elemento padr√£o agora corresponder√° a algo assim. <br><br><blockquote> <code><b>[B(34,17,"white",3,"black")E(13,21,"white",3,"rgb(27,0,0)")]</b></code> </blockquote> <br>  A √∫ltima parte do idioma √© o operador de sobreposi√ß√£o.  Este √© qualquer n√∫mero de elementos dentro de chaves. <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")" <br> element -&gt; "[" (geometric ):+ "]" <br> element -&gt; "{" (element ):+ "}"</b></code> </blockquote> <br>  o que nos permite fazer o seguinte: <br><br><blockquote> <code><b>{L(3.5,"rgb(98,76,15)")VS(3.5)}</b></code> </blockquote> <br>  (Observe que, diferentemente do operador de repeti√ß√£o, o operador de sobreposi√ß√£o pode ser usado internamente.) <br><br>  Depois de limpar a descri√ß√£o e adicionar espa√ßos aos locais necess√°rios, obtemos a seguinte gram√°tica MBDL: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; (element WS):+ <br> WS -&gt; [\s]:* <br> number -&gt; WS decimal WS <br> color -&gt; WS dqstring WS <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> element -&gt; "(" WS (element WS):+ ")" <br> element -&gt; "[" WS (geometric WS):+ "]" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")"</b></code> </blockquote> <br>  Portanto, o MBDL agora est√° definido e criamos uma gram√°tica da linguagem.  Pode ser usado com o Nearley para reconhecer cadeias de idiomas.  Antes de me aprofundar no MBDL / Nearley, gostaria de implementar as primitivas usadas no MBDL para que o limite descrito no MBDL possa ser exibido.  Isso faremos na pr√≥xima parte. <br><br><h2>  Parte 3 </h2><br>  Agora come√ßaremos a implementar as pr√≥prias primitivas de renderiza√ß√£o.  (Neste momento, ainda n√£o preciso vincular o analisador √†s primitivas de renderiza√ß√£o. Para testar, vou cham√°-las apenas manualmente.) <br><br>  Vamos come√ßar com a linha primitiva.  Lembre-se da apar√™ncia: <br><br><blockquote> <code><b>L(width, color)</b></code> </blockquote> <br>  Al√©m da largura e cor, h√° um par√¢metro impl√≠cito aqui - a dist√¢ncia da borda externa do mapa.  (Eu desenho as bordas da borda do mapa para fora. Observe que come√ßamos de uma diferente!). N√£o deve apontar para o MBDL, porque isso pode ser rastreado pelo int√©rprete que executa o MBDL para desenhar a borda.  No entanto, isso deve ser uma entrada para todas as primitivas de renderiza√ß√£o, para que elas saibam onde desenh√°-las.  Vou chamar esse par√¢metro de deslocamento. <br><br>  Se eu apenas precisasse desenhar uma borda na parte superior do mapa, a primitiva de linha seria muito simples de implementar.  No entanto, de fato, precisarei desenhar de cima.  inferior, esquerda e direita.  (Talvez um dia eu perceba bordas obl√≠quas ou curvas, mas por enquanto vamos aderir √†s bordas retangulares padr√£o.) Al√©m disso, o comprimento e a localiza√ß√£o do elemento de linha dependem do tamanho do mapa (assim como do deslocamento).  Portanto, como par√¢metros, preciso de todos esses dados. <br><br>  Depois de definir todos esses par√¢metros, basta criar uma primitiva de linha e us√°-la para desenhar uma linha ao redor do mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a56/74f/785/a5674f78512bef22e569656701203401.png"></div><br>  (Observe que eu uso v√°rias fun√ß√µes de <b>Dragons Abound</b> para desenhar a linha "manuscrita".) Vamos tentar criar uma borda mais complexa: <br><br><blockquote> <code><b>L(3, black) L(10, gold) L(3, black)</b></code> </blockquote> <br>  √â assim: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/86a/ad8/849/86aad88494c1c17f993524ef09ef9b2f.png"></div><br>  Muito bom.  Observe que h√° lugares em que as linhas pretas e a linha dourada n√£o est√£o bem alinhadas devido a flutua√ß√µes.  Se eu quiser me livrar desses pontos, voc√™ pode simplesmente reduzir a quantidade de oscila√ß√£o. <br><br>  A implementa√ß√£o de uma primitiva de espa√ßo vertical √© bastante simples;  apenas realiza um incremento de deslocamento.  Vamos adicionar um pouco de espa√ßo: <br><br><blockquote> <code><b>L(3, black) L(10, gold) L(3, black) <br> VS(5) <br> L(3, black) L(10, red) L(3, black)</b></code> </blockquote> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eab/471/b90/eab471b902eb44e703f460d700936937.png"></div><br>  Ao desenhar linhas, os √¢ngulos podem ser realizados tra√ßando entre o deslocamento e o desenho ao longo do mapa no sentido hor√°rio.  Mas, em geral, preciso implementar o truncamento em cada lado da borda do mapa para criar uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conex√£o angular com um chanfro</a> .  Isso ser√° necess√°rio para criar bordas com padr√µes unidos corretamente nos cantos e, no caso geral, eliminar√° a necessidade de desenhar elementos com bordas em um √¢ngulo que seria necess√°rio.  (*) <br><br>  <i>(Observa√ß√£o: como ser√° dito nas partes a seguir, com o tempo, me recusei a usar regi√µes de truncamento ao implementar √¢ngulos. O principal motivo √© que, para criar √¢ngulos complexos, por exemplo, deslocamentos quadrados:</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97b/fd8/336/97bfd833697b9278660772c1bd04ee46.png"></div><br>  <i>s√£o necess√°rias √°reas de truncamento cada vez mais complexas.</i>  <i>Al√©m disso, com o tempo, descobri uma maneira melhor de trabalhar com padr√µes nos cantos.</i>  <i>Em vez de retornar e reescrever esta parte do artigo, decidi deix√°-lo para ilustrar o processo de "criatividade".)</i> <br><br>  A id√©ia principal √© truncar cada borda na diagonal e criar quatro √°reas truncadas nas quais cada lado da borda ser√° desenhado: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9fb/31a/cf9/9fb31acf993cde46b6a7fdc408be6afd.png"></div><br>  Ao truncar, tudo o que for desenhado na √°rea correspondente ser√° cortado no √¢ngulo desejado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52b/f00/f02/52bf00f026f6979f6425345389fa646a.png"></div><br>  Infelizmente, isso cria pequenas lacunas ao longo das linhas diagonais, provavelmente porque o navegador executa suavemente a suaviza√ß√£o ao longo da borda truncada.  O teste mostrou que um fundo brilha atrav√©s do espa√ßo entre as duas arestas.  Foi poss√≠vel corrigir isso expandindo um pouco as m√°scaras (metade do pixel parece ser suficiente), mas isso √†s vezes n√£o resolve o problema. <br><br>  Em seguida, voc√™ precisa implementar formas geom√©tricas.  Diferentemente das linhas, elas s√£o repetidas no padr√£o, preenchendo a lateral da borda do mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/420/d88/64e/420d8864e72e178252766172dc0320ab.png"></div><br>  Uma pessoa desenharia esse padr√£o da esquerda para a direita, desenhando um ret√¢ngulo, um losango e repetindo o mesmo at√© que toda a borda fosse preenchida.  Portanto, isso tamb√©m pode ser implementado no programa, desenhando um padr√£o ao longo da borda.  No entanto, ser√° mais f√°cil desenhar primeiro todos os ret√¢ngulos e depois todos os losangos.  Basta desenhar ao longo da borda a mesma figura geom√©trica em intervalos.  E √© muito conveniente que cada elemento tenha o mesmo intervalo.  Obviamente, uma pessoa n√£o faria isso, porque √© muito dif√≠cil organizar os elementos nos lugares certos, mas isso n√£o √© um problema para o programa. <br><br>  Ou seja, o procedimento para desenhar formas geom√©tricas simples precisa de par√¢metros nos quais todas as dimens√µes e cores da figura s√£o transmitidas (ou seja, largura, comprimento, espessura da linha, cor e preenchimento da linha), bem como a posi√ß√£o inicial (que por raz√µes que ficar√£o claras em breve, Vou considerar o centro da figura), o intervalo de espa√ßo horizontal para a transi√ß√£o entre repeti√ß√µes e o n√∫mero de repeti√ß√µes.  Tamb√©m ser√° conveniente indicar a dire√ß√£o da repeti√ß√£o na forma do vetor [dx, dy], para que possamos executar repeti√ß√µes da esquerda para a direita, da direita para a esquerda, para cima ou para baixo, simplesmente alterando o vetor e o ponto de partida.  Junte tudo e obtenha uma faixa de formas repetidas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/409/bcd/c33/409bcdc33756610ac6ace2d0fde0a3a4.png"></div><br>  Usando esse c√≥digo v√°rias vezes e renderizando com o mesmo deslocamento, posso combinar as listras em preto e branco para criar a escala do mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b88/8f5/0d9/b888f50d9f164b9319cc8b3cf8d38588.png"></div><br>  Antes de come√ßar a descobrir como aplicar tudo isso √† borda real do mapa, vamos primeiro implementar a mesma funcionalidade para elipses e losangos. <br><br>  Losangos s√£o apenas ret√¢ngulos com v√©rtices rotacionados, portanto, voc√™ s√≥ precisa fazer uma pequena altera√ß√£o no c√≥digo.  Acontece que eu ainda n√£o tenho c√≥digo pronto para renderizar a elipse, mas √© muito f√°cil obter a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vis√£o param√©trica da elipse</a> e criar uma fun√ß√£o que me d√™ os pontos da elipse: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3fa/74e/079/3fa74e079dd2c29afa5acb0135d4092f.png"></div><br>  Aqui est√° um exemplo (criado manualmente) que usa os recursos implementados acima: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf8/bf2/d39/bf8bf2d3992b34bc173622dc86c0d8b5.png"></div><br>  Para uma quantidade t√£o pequena de c√≥digo, parece muito bom! <br><br>  Vamos agora resolver o caso complexo de bordas com elementos repetidos: cantos. <br><br>  Se houver uma borda com elementos repetidos, existem v√°rias maneiras de resolver o problema com cantos.  O primeiro √© ajustar as repeti√ß√µes para que sejam executadas nos cantos sem casamento percept√≠vel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  Outra op√ß√£o √© parar a repeti√ß√£o em algum lugar pr√≥ximo √† esquina dos dois lados.  Isso geralmente √© feito se o padr√£o n√£o puder ser facilmente ‚Äúrotacionado‚Äù no canto: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/6dd/3a3/15f6dd3a3e6191da02dc884193b72c82.png"></div><br>  A √∫ltima op√ß√£o √© fechar o padr√£o com alguma decora√ß√£o de canto: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7be/5ce/64e/7be5ce64eb09de2eeefdb18992978d03.png"></div><br>  Algum dia chegarei √†s decora√ß√µes dos cantos, mas por enquanto usaremos a primeira op√ß√£o.  Como fazer com que um padr√£o de listras ou c√≠rculos gire nos cantos do mapa sem espa√ßos? <br><br>  A id√©ia principal √© colocar o elemento do padr√£o exatamente no canto, para que metade dele esteja em uma borda do mapa e a outra no lado adjacente.  Neste exemplo, o c√≠rculo est√° exatamente no canto e pode ser desenhado de qualquer dire√ß√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  Em outros casos, o elemento √© meio desenhado em uma dire√ß√£o e metade na outra, mas as arestas coincidem: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ee/f62/0b8/4eef620b830eb0249d019229140e34e6.png"></div><br>  Nesse caso, uma faixa branca √© desenhada nos dois lados, mas √© conectada no canto sem espa√ßos. <br><br>  H√° dois aspectos a serem considerados ao colocar um elemento em um canto. <br><br>  Primeiro, o elemento de canto ser√° dividido e espelhado em rela√ß√£o √† diagonal que passa pelo centro do elemento.  Elementos com simetria radial, por exemplo, quadrados, c√≠rculos e estrelas, n√£o mudam de forma.  Elementos sem simetria radial, por exemplo, ret√¢ngulos e losangos, mudar√£o de forma ao espelhar em rela√ß√£o √† diagonal. <br><br>  Em segundo lugar, para que os elementos de canto dos dois lados se conectem corretamente, deve haver um n√∫mero inteiro de elementos (*) nos dois lados do mapa.  Eles n√£o precisam ter o mesmo n√∫mero, mas deve haver um n√∫mero inteiro de elementos nos dois lados.  Se um n√∫mero fracion√°rio de padr√µes estiver contido em um lado, a partir de uma borda, o padr√£o n√£o coincidir√° com o lado adjacente. <br><br>  <i>(* Em alguns casos, por exemplo, com listras longas, a repeti√ß√£o parcial pode ocorrer com repeti√ß√£o total e os elementos ainda estar√£o alinhados. No entanto, o elemento de canto resultante ser√° assim√©trico e diferir√° em comprimento do mesmo elemento nas laterais do mapa. Um exemplo disso pode ser visto aqui:</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/263/418/110/263418110aafe94ef8c62d57e8540371.png"></div><br>  <i>Uma barra branca de escala ocorre com diferentes repeti√ß√µes parciais e, como resultado, √© obtido um elemento deslocado em rela√ß√£o ao centro.</i>  <i>Para a escala do mapa, esse nem sempre √© o caso, porque mostra a dist√¢ncia absoluta e n√£o precisa ser sim√©trico.</i>  <i>Mas para um padr√£o decorativo, isso geralmente parece ruim.)</i> <br><br>  Aqui est√° um exemplo mostrando como um n√∫mero inteiro de repeti√ß√µes √© aparado exatamente no canto: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ab/8de/0a3/8ab8de0a3452332e2813b3771091b165.png"></div><br>  Se voc√™ fizer o mesmo dos quatro lados, os cantos coincidir√£o e o padr√£o ficar√° perfeitamente localizado ao longo de toda a extens√£o da borda: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dfc/c9a/e46/dfcc9ae46a68807e983705e553aa2ba3.png"></div><br>  Ap√≥s um exame cuidadoso, voc√™ notar√° que o padr√£o n√£o ocorre exatamente nos cantos.  Metade do c√≠rculo em cada canto √© tirada de cada lado, e essas duas metades s√£o desenhadas √† m√£o independentemente, portanto, n√£o s√£o perfeitas.  Mas agora eles est√£o perto o suficiente disso. <br><br>  Assim, podemos realizar uma conex√£o perfeita do padr√£o nos cantos, escolhendo um n√∫mero inteiro de repeti√ß√µes para cada aresta.  No entanto, a solu√ß√£o para esse problema n√£o √© trivial. <br><br>  Primeiro, suponha que sabemos que o lado tem 866 pixels e queremos repetir o elemento 43 vezes.  Em seguida, o elemento deve ser repetido a cada 20,14 pixels.  Como definimos o comprimento espec√≠fico de um elemento (e, no caso geral, um padr√£o de elementos)?  No exemplo acima, adicionei espa√ßo extra entre os c√≠rculos.  Mas se os c√≠rculos se tocaram inicialmente, isso mudar√° o padr√£o.  Talvez valha a pena esticar os c√≠rculos para que eles continuem se tocando? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e36/2b0/ebd/e362b0ebd3fd04e5d8b00de5d3aba151.png"></div><br>  Agora os elementos est√£o se tocando, mas os c√≠rculos se transformaram em elipses e os cantos t√™m uma forma estranha.  (Lembre-se de que eu disse que elementos sem simetria radial mudam de forma quando refletidos em rela√ß√£o a um √¢ngulo? Para listras, isso n√£o ser√° um grande problema.) Ou talvez valha a pena apertar todos os elementos para que eles se toquem e se ajustem em um comprimento adequado: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7c/ba8/0af/d7cba80afb431dc6c9afc52d7ad94b5c.png"></div><br>  Mas, para perceber isso, precisamos tornar os elementos muito menores do que eram originalmente.  Nenhuma dessas op√ß√µes parece perfeita. <br><br>  O segundo problema ocorre quando os lados do cart√£o s√£o de tamanhos diferentes.  Agora precisamos resolver o problema de encontrar um n√∫mero inteiro de repeti√ß√µes adequado para ambos os lados.  Seria ideal encontrar uma solu√ß√£o adequada para ambos os lados.  Mas n√£o quero fazer isso √† custa de muitas mudan√ßas de padr√£o.  Talvez seja melhor criar padr√µes ligeiramente diferentes em ambos os lados se ambos estiverem pr√≥ximos o suficiente do padr√£o original. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E finalmente, o terceiro problema surge quando eu uso a fun√ß√£o de sobrepor v√°rios elementos um ao outro: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d9/4ed/6ac/4d94ed6acf107193f2109bd2b2f07a67.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o quero fazer altera√ß√µes no padr√£o que destruir√£o o relacionamento entre os elementos. </font><font style="vertical-align: inherit;">Penso que, com o dimensionamento adequado, as propor√ß√µes como um todo permanecer√£o, mas preciso testar isso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarefa interessante, certo? </font><font style="vertical-align: inherit;">At√© agora, n√£o tenho solu√ß√µes particularmente de alta qualidade para ela. </font><font style="vertical-align: inherit;">Talvez eles apare√ßam mais tarde!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte 4 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, implementamos primitivas para desenhar linhas e formas geom√©tricas. Comecei a trabalhar no uso de formas repetidas para preencher as bordas e falei sobre as dificuldades de colocar padr√µes arbitr√°rios na borda do mapa para que eles se encaixassem perfeitamente nos cantos. O principal problema √© que, no caso geral, √© necess√°rio tornar o padr√£o mais longo (ou mais curto) para que ele se ajuste lateralmente. As op√ß√µes para alterar o comprimento do padr√£o - adicionar ou remover espa√ßos, alterar o comprimento dos elementos dos padr√µes - levam a v√°rias altera√ß√µes no pr√≥prio padr√£o. Parece que a tarefa de selecionar um padr√£o de v√°rios elementos √© muito dif√≠cil!</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando me deparei com essas tarefas aparentemente intransigentes, gosto de come√ßar implementando uma vers√£o simples. Muitas vezes, as tarefas malsucedidas podem ser resolvidas resolvendo repetidamente problemas "simples" at√© que o resultado seja bom o suficiente. E, √†s vezes, a implementa√ß√£o de uma vers√£o simples fornece um entendimento que simplifica a solu√ß√£o de um problema mais complexo. Se n√£o melhorar e o problema permanecer desconfort√°vel, pelo menos teremos uma vers√£o simplificada que ainda pode ser √∫til, embora n√£o exatamente como deveria.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maneira mais f√°cil √© alterar o comprimento do padr√£o adicionando comprimentos sem alterar nada no padr√£o. </font><font style="vertical-align: inherit;">Essencialmente, isso adiciona espa√ßo em branco ao final do padr√£o. </font><font style="vertical-align: inherit;">(Nota: √© melhor distribuir o espa√ßo vazio entre todos os elementos no padr√£o.) Vale a pena considerar que essa solu√ß√£o pode apenas prolongar o padr√£o. </font><font style="vertical-align: inherit;">Sempre podemos adicionar espa√ßo vazio ao padr√£o, mas n√£o podemos aceit√°-lo se necess√°rio - talvez n√£o haja mais espa√ßo vazio no padr√£o! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com essa abordagem, o algoritmo de localiza√ß√£o do padr√£o na lateral da placa ser√° muito simples:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Divida o comprimento do lado do cart√£o pelo comprimento do padr√£o e arredonde-o para baixo para determinar o n√∫mero de repeti√ß√µes do padr√£o que se encaixam nesse lado. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A dist√¢ncia entre os elementos neste caso ser√° igual ao comprimento do lado dividido pelo n√∫mero de repeti√ß√µes. </font><font style="vertical-align: inherit;">(Este √© o local mais pr√≥ximo do local original, pois s√≥ podemos adicionar espa√ßo.)</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Desenhe um padr√£o ao longo do lado, levando em considera√ß√£o a dist√¢ncia calculada. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foi dif√≠cil implementar esse sistema. </font><font style="vertical-align: inherit;">Os cantos teimosamente n√£o quiseram coincidir. </font><font style="vertical-align: inherit;">Levei muito tempo para perceber que, quando o mapa n√£o √© quadrado, n√£o consigo desenhar √°reas de truncamento para quatro lados do centro do mapa, porque isso cria √¢ngulos de truncamento que n√£o s√£o iguais a 45 graus. </font><font style="vertical-align: inherit;">De fato, as √°reas de truncamento devem se parecer com a parte traseira de um envelope:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b20/29a/beb/b2029abeb54302b5f7d3335a15c95f86.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando eu descobri isso, o algoritmo come√ßou a funcionar sem problemas. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Mas n√£o se esque√ßa da observa√ß√£o anterior de que, com o tempo, abandonei as √°reas de truncamento!)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqui est√° um exemplo com uma propor√ß√£o de aproximadamente 2: 1:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bff/739/d19/bff739d19d76fdb4db63033b970eb241.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nessa escala, √© muito dif√≠cil perceber, mas os cantos se conectam corretamente e h√° apenas uma pequena diferen√ßa visual entre os lados. </font><font style="vertical-align: inherit;">Nesse caso, o algoritmo para alinhar os padr√µes s√≥ precisa inserir pixels fracion√°rios, de modo que fica invis√≠vel aos olhos, principalmente porque os contornos dos c√≠rculos s√£o sobrepostos por um pixel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√° outro exemplo com listras:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa8/852/625/aa8852625e15121ce822cc6ca5fe8742.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este √© o topo da borda quadrada. </font><font style="vertical-align: inherit;">Aqui est√° a mesma borda em um mapa mais retangular:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90d/207/9b1/90d2079b1e869c59ee204f1a75f5dbc7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui voc√™ pode ver que no lado do cart√£o h√° uma diferen√ßa visualmente maior entre as bandas. </font><font style="vertical-align: inherit;">O algoritmo n√£o deve inserir mais espa√ßo do que o comprimento de um elemento completo; </font><font style="vertical-align: inherit;">portanto, o pior caso ocorre quando temos elementos longos e um lado curto ligeiramente diferente de um tamanho adequado. </font><font style="vertical-align: inherit;">Mas na maioria dos casos pr√°ticos, o alinhamento n√£o √© muito prejudicial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√° um exemplo com um padr√£o de v√°rios elementos:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d18/602/4f8/d186024f8ee1e4fbcd5918c63537a024.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqui as listras se sobrep√µem √†s listras: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c60/af7/ad6/c60af7ad6c71ee4ef1850f0bf194af62.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode ver que, como o mesmo alinhamento √© realizado para cada elemento, as faixas permanecem centradas uma em rela√ß√£o √† outra. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sugeri que uma boa solu√ß√£o para colocar o padr√£o ao lado do mapa seria dif√≠cil, mas uma abordagem muito simples com a distribui√ß√£o uniforme do elemento do padr√£o para preencher o espa√ßo desejado funciona muito bem para muitos padr√µes. Isso √© um lembrete para todos n√≥s: n√£o h√° necessidade de supor que a decis√£o deve ser complicada; pode ser mais f√°cil do que voc√™ pensa! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, esta solu√ß√£o n√£o funciona para padr√µes com elementos tocantes, por exemplo, para escala de mapa. Nesse caso, adicionar espa√ßo muda os elementos:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cd/d7e/27f/3cdd7e27f8c2d92be26d36e7b4807f5a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outra op√ß√£o para alongar um padr√£o, que mencionei acima, √© esticar os elementos individuais do padr√£o. </font><font style="vertical-align: inherit;">√â adequado para algo como um padr√£o de escala, mas ficar√° ruim em um padr√£o com elementos sim√©tricos, porque o alongamento os tornar√° assim√©tricos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A implementa√ß√£o da op√ß√£o com alongamento acabou sendo mais dif√≠cil do que eu esperava, principalmente porque tive que esticar os elementos em diferentes arestas do mapa por tamanhos diferentes (porque o mapa pode n√£o ser quadrado, mas retangular) e tamb√©m alterar dinamicamente a disposi√ß√£o dos elementos com base nos novos esticados. tamanhos. </font><font style="vertical-align: inherit;">Mas depois de algumas horas, consegui isso:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d1c/552/3c4/d1c5523c43a9828cd9c1c1bee6f4bbde.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora eu tenho todos os recursos necess√°rios para desenhar a borda do mapa (embora os pr√≥prios elementos da borda sejam criados manualmente): </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d2b/ccc/326/d2bccc326a0500f92267378e137e2f6e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Converti a imagem em escala de cinza, porque n√£o queria me preocupar com a sele√ß√£o de cores, e o cart√£o em si √© bastante entediante, mas como prova de conceito, as bordas parecem muito bonitas. </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte 5 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na parte 2, desenvolvi a gram√°tica MBDL (Map Border Description Language) e, nas partes 3 e 4, implementei procedimentos para executar todas as primitivas da linguagem. </font><font style="vertical-align: inherit;">Agora, trabalharei na conex√£o dessas partes para poder descrever a borda no MBDL e desenh√°-la no mapa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na parte 3, escrevi a gram√°tica MBDL para que funcione com a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ferramenta de an√°lise de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> JavaScript </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Nearley</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A gram√°tica final √© assim:</font></font><br><br><blockquote> <code><b>@builtin</b> <b>"</b> <b>number.ne"</b> <br> <b>@builtin</b> <b>"</b> <b>string.ne"</b> <br> <b>border -&gt; (element WS):+ <br> WS -&gt; [\s]:* <br> number -&gt; WS decimal WS <br> color -&gt; WS dqstring WS <br> element -&gt;</b> <b>"</b> <b>L(" number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>element -&gt;</b> <b>"</b> <b>VS(" number</b> <b>"</b> <b>)"</b> <br> <b>element -&gt;</b> <b>"</b> <b>(" WS (element WS):+</b> <b>"</b> <b>)"</b> <br> <b>element -&gt;</b> <b>"</b> <b>[" WS (geometric WS):+</b> <b>"</b> <b>]"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>B(" number</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>E(" number</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>D(" number</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>HS(" number</b> <b>"</b> <b>)"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por padr√£o, ao analisar com √™xito uma regra usando Nearley, a regra retorna uma matriz contendo todos os elementos que correspondem ao lado direito da regra. </font><font style="vertical-align: inherit;">Por exemplo, se a regra</font></font><br><br><blockquote> <code><b>test -&gt;</b> <b>"</b> <b>A" |</b> <b>"</b> <b>B" |</b> <b>"</b> <b>C"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> combinado com string </font></font><br><br><blockquote> <code><b>A</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nearley retornar√° </font></font><br><br><blockquote> <code><b>[</b> <b>"</b> <b>A" ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma matriz com um √∫nico valor √© a sequ√™ncia "A" correspondente ao lado direito da regra. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que Nearley retorna quando um elemento √© analisado usando esta regra?</font></font><br><br><blockquote> <code><b>number -&gt; WS decimal WS</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como existem tr√™s partes no lado direito da regra, ele retornar√° uma matriz com tr√™s valores. </font><font style="vertical-align: inherit;">O primeiro valor ser√° o que retornar√° a regra para o WS, o segundo valor ser√° o que retornar√° a regra para decimal e o terceiro valor ser√° o que retornar√° a regra para o WS. </font><font style="vertical-align: inherit;">Se, usando a regra acima, pars "57", o resultado ser√° o seguinte:</font></font><br><br><blockquote> <code><b>[ <br> [ " " ], <br> [ "5", "7" ], <br> [ ] <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O resultado final da an√°lise de Nearley ser√° uma matriz aninhada de matrizes, que √© uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√°rvore de sintaxe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Em alguns casos, a √°rvore de sintaxe √© uma representa√ß√£o muito √∫til; em outros casos, n√£o √© bem assim. Em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , por exemplo, essa √°rvore n√£o √© particularmente √∫til. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Felizmente, as regras de Nearley podem substituir o comportamento padr√£o e retornar o que quiserem. De fato, a regra (interna) para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">decimal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o retorna uma lista de n√∫meros, retorna o n√∫mero Javascript equivalente, que na maioria dos casos √© muito mais √∫til, ou seja, o valor de retorno da regra </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">num√©rica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tem a forma:</font></font><br><br><blockquote> <code><b>[ <br> [ " " ], <br> 57, <br> [ ] <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As regras de Nearley redefinem o comportamento padr√£o adicionando um p√≥s-processador √† regra, pegando uma matriz padr√£o e substituindo-a pelo que voc√™ precisa. Um p√≥s-processador √© apenas c√≥digo Javascript entre colchetes especiais no final de uma regra. Por exemplo, na regra do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">nunca estou interessado em espa√ßos poss√≠veis em ambos os lados do n√∫mero. Portanto, seria conveniente se a regra simplesmente retornasse um n√∫mero, e n√£o uma matriz de tr√™s elementos. Aqui est√° um p√≥s-processador que executa esta tarefa:</font></font><br><br><blockquote> <code><b>number -&gt; WS decimal WS {% default =&gt; default[1] %}</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esse p√≥s-processador pega o resultado padr√£o (a matriz de tr√™s elementos mostrada acima) e a substitui pelo segundo elemento da matriz, que √© o n√∫mero Javascript da regra </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">decimal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ent√£o agora a regra </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">num√©rica</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retorna o n√∫mero real. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa funcionalidade pode ser usada para processar um idioma recebido em um idioma intermedi√°rio, mais f√°cil de trabalhar. </font><font style="vertical-align: inherit;">Por exemplo, eu posso usar a gram√°tica Nearley para transformar uma string MBDL em uma matriz de estruturas Javascript, cada uma das quais representa uma primitiva identificada por um campo "op". </font><font style="vertical-align: inherit;">A regra para a linha primitiva ser√° mais ou menos assim:</font></font><br><br><blockquote> <code><b>element -&gt;</b> <b>"</b> <b>L(" number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)" {% data=&gt; {op:</b> <b>"</b> <b>L", width: data[1], color: data[3]} %}</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ou seja, o resultado da an√°lise de "L (13, preto)" ser√° a estrutura Javascript: </font></font><br><br><blockquote> <code><b>{op:</b> <b>"</b> <b>L", width: 13, color:</b> <b>"</b> <b>black"}</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s adicionar o p√≥s-processamento apropriado, o resultado retornado da gram√°tica pode ser uma sequ√™ncia (matriz) de estruturas de opera√ß√£o para a linha de entrada. </font><font style="vertical-align: inherit;">Ou seja, o resultado da an√°lise da string</font></font><br><br><blockquote> <code><b>L( 415, ‚Äúblack") <br> VS(5) <br> [B(1, 2, ‚Äúblack", 3, ‚Äúwhite") HS(5) E(1, 2, ‚Äúblack", 3, ‚Äúwhite")]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° </font></font><br><br><blockquote> <code><b>[ <br> {op: "L", width: 415, color: "black"}, <br> {op: "VS", width: 5}, <br> {op: "P", <br> elements: [{op: "B", width: 1, length: 2, <br> olColor: "black", olWidth: 3, <br> fill: "white"}, <br> {op: "HS", width: 5}, <br> {op: "E", width: 1, length: 2, <br> olColor: "black", olWidth: 3, <br> fill: "white"}]} <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o que √© muito mais f√°cil de processar para criar uma borda do mapa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse ponto, voc√™ pode ter uma pergunta - se o est√°gio de p√≥s-processamento da regra Nearley pode conter qualquer Javascript, por que n√£o pular a visualiza√ß√£o intermedi√°ria e simplesmente desenhar a borda do mapa durante o p√≥s-processamento? </font><font style="vertical-align: inherit;">Para muitas tarefas, essa abordagem seria ideal. </font><font style="vertical-align: inherit;">Decidi n√£o us√°-lo por v√°rios motivos.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiramente, no MBDL h√° alguns (*) componentes que n√£o podem ser executados durante o processo de an√°lise. Por exemplo, n√£o podemos desenhar elementos geom√©tricos repetidos (faixa ou losango) durante o processo de an√°lise, porque precisamos conhecer informa√ß√µes de outros elementos no mesmo padr√£o. Em particular, precisamos saber o comprimento total do padr√£o para entender at√© que ponto precisamos organizar as repeti√ß√µes de cada elemento individual. Ou seja, o elemento do padr√£o ainda deve criar uma representa√ß√£o intermedi√°ria de todos os elementos geom√©tricos. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(* Existem outros componentes com limita√ß√µes semelhantes das quais ainda n√£o falei.)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em segundo lugar, o Javascript em Nearley est√° incorporado nas regras, portanto, n√£o poderemos passar informa√ß√µes adicionais ao Javascript, exceto para vari√°veis ‚Äã‚Äãglobais. Por exemplo, para desenhar a borda, preciso saber o tamanho do mapa, as quatro √°reas de truncamento usadas etc. Embora eu possa adicionar um c√≥digo que disponibilize essas informa√ß√µes para os p√≥s-processadores de Nearley, ele ficar√° um pouco confuso e poder√° ser dif√≠cil manter esse c√≥digo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por esses motivos, estou analisando uma representa√ß√£o intermedi√°ria, que √© executada para criar a borda do pr√≥prio mapa.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A pr√≥xima etapa √© desenvolver um int√©rprete que receba uma representa√ß√£o intermedi√°ria do MBDL e o execute para gerar limites do mapa. Isso n√£o √© muito dif√≠cil de fazer. Basicamente, a tarefa √© definir as condi√ß√µes iniciais (por exemplo, gerar regi√µes de truncamento para os quatro lados do mapa) e iterar sobre a sequ√™ncia de estruturas da representa√ß√£o intermedi√°ria com cada uma executando. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° alguns momentos escorregadios.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, preciso passar da renderiza√ß√£o de dentro para o desenho de dentro para fora. O motivo √© que eu quero que a maioria das bordas n√£o se sobreponha ao mapa, ent√£o preciso desenhar as bordas para que as linhas da borda interna coincidam com as bordas do mapa. Se eu desenhar de fora para dentro, preciso saber a largura da borda antes de come√ßar a desenhar para que a borda n√£o se sobreponha ao mapa. Se eu desenhar de dentro para fora, eu apenas come√ßo da borda do mapa e desenho. Tamb√©m permite que voc√™ imponha opcionalmente uma borda no mapa; basta iniciar a borda com um espa√ßo vertical negativo (VS).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outro ponto dif√≠cil s√£o os padr√µes repetidos. </font><font style="vertical-align: inherit;">Para desenhar padr√µes repetidos, preciso examinar todos os elementos do padr√£o e determinar o mais amplo, porque ele definir√° a largura de todo o padr√£o. </font><font style="vertical-align: inherit;">Tamb√©m preciso observar e acompanhar o comprimento do padr√£o para saber quanto tempo falta antes de cada repeti√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√° um exemplo de uma borda bastante complexa que eu usei para testar o int√©rprete:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c8/88a/2a9/3c888a2a96352845f6165f5eca7f6ab3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eu acho que era poss√≠vel (necess√°rio?) Anex√°-lo para teste no analisador, mas para essa borda eu apenas criei uma exibi√ß√£o intermedi√°ria manualmente: </font></font><br><br><blockquote> <code><b>[ <br> {op:'P', elements: [ <br> {op:'B', width: 10, length: 37, lineWidth: 2, color: 'black', fill: 'white'}, <br> {op:'B', width: 10, length: 37, lineWidth: 2, color: 'black', fill: 'black'}, <br> ]}, <br> {op:'VS', width: 2}, <br> {op:'L', width:3, color: 'black'}, <br> {op:'PUSH'}, <br> {op:'L', width:10, color: 'rgb(222,183,64)'}, <br> {op:'POP'}, <br> {op:'PUSH'}, <br> {op:'P', elements: [ <br> {op:'E', width: 5, length: 5, lineWidth: 1, color: 'black', fill: 'red'}, <br> {op:'HS', length: 10}, <br> ]}, <br> {op:'L', width:3, color: 'black'}, <br> {op:'POP'}, <br> {op:'VS', width: 2}, <br> {op:'P', elements: [ <br> {op:'E', width: 2, length: 2, lineWidth: 0, color: 'black', fill: 'white'}, <br> {op:'HS', length: 13}, <br> ]}, <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu criei essa vis√£o por tentativa e erro. Seja como for, o int√©rprete funciona! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como √∫ltimo passo, deixe-me usar o analisador para criar uma exibi√ß√£o intermedi√°ria a partir da vers√£o do MBDL. N√£o h√° muito para me mostrar aqui: tive que corrigir alguns nomes de campos, mas, caso contr√°rio, o c√≥digo funcionou bem. Para a borda, usei uma vers√£o ligeiramente diferente do MBDL:</font></font><br><br><blockquote> <code><b>[B(5,37,"black",2,"white") B(5,37,"black",2,"black")] <br> VS(3) <br> L(3,"black") <br> {L(10,"rgb(222,183,64)")} <br> [E(5,5,"black",1,"red") HS(-5) E(2,2,"none",0,"white") HS(10)] <br> L(3,"black")</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ela desenha a mesma borda, mas de uma maneira um pouco diferente. </font><font style="vertical-align: inherit;">Tamb√©m alterei a sintaxe da sobreposi√ß√£o, substituindo os par√™nteses por chaves, para que fique mais diferente da outra sintaxe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para mostrar por que eu queria desenhar de dentro para fora e n√£o apenas colocar automaticamente a borda do lado de fora do mapa, posso adicionar um espa√ßo vertical negativo ao in√≠cio dessa borda para mover a escala do mapa para dentro da borda do mapa:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ce/ea0/3df/0ceea03df1f07131e0ad27e6bbd45731.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, tenho a maior parte da infraestrutura necess√°ria para a gera√ß√£o procedural de bordas do mapa: uma linguagem de descri√ß√£o de limites, um analisador de idiomas e procedimentos para executar uma representa√ß√£o intermedi√°ria. </font><font style="vertical-align: inherit;">Resta apenas lidar com a parte dif√≠cil - a gera√ß√£o processual!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parte 6 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora que todo o MBDL foi implementado, pretendi prosseguir para a gera√ß√£o processual das bordas do mapa, mas ainda n√£o tenho certeza de como quero fazer isso, porque vou demorar um pouco e implementar mais alguns recursos do MBDL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na primeira discuss√£o sobre o processamento de cantos com padr√µes, falei sobre algumas abordagens diferentes. No final, percebi os cantos chanfrados, mas havia uma segunda op√ß√£o: interromper o padr√£o pr√≥ximo ao canto, como nos exemplos a seguir:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b7/94d/01b/3b794d01b552c42ed9b8362f5405ff9d.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee2/3a8/159/ee23a8159d81afd1f7c95c16a90bcdf7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa solu√ß√£o √© frequentemente usada quando o padr√£o da borda √© algum tipo de figura assim√©trica, runas ou qualquer outra coisa que n√£o possa ser girada 90 graus, mantendo o alinhamento. Mas √© √≥bvio que isso funcionar√° com formas geom√©tricas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa pode ser a op√ß√£o que voc√™ escolhe antes de gerar a borda, mas voc√™ pode adicionar um pouco de flexibilidade se a ativar em uma parte da borda e usar o canto chanfrado na outra. Para fazer isso, tenho que adicionar um novo comando ao MBDL. Eu suspeito que outras op√ß√µes possam surgir para diferentes partes da borda, ent√£o adicionarei um comando de op√ß√µes gerais:</font></font><br><br><blockquote> <code><b>element -&gt; "O(MITER)"</b> <br> <b>element -&gt; "O(STOPPED)"</b> <br> <b>element -&gt; "O(STOPPED," number ")"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Aqui, novamente, para maior clareza, omitimos espa√ßos e outros detalhes.) At√© agora, as √∫nicas op√ß√µes s√£o "MITRE" para cantos chanfrados e "PARADO" para parar nos cantos pr√≥ximos. </font><font style="vertical-align: inherit;">Se nenhum valor for transmitido PARADO, o programa interrompe o padr√£o a uma dist√¢ncia razo√°vel da esquina. </font><font style="vertical-align: inherit;">Se o valor for transmitido, o padr√£o ser√° interrompido a essa dist√¢ncia do canto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se cantos STOPPED forem usados, paro de desenhar o padr√£o dos cantos.</font></font> Aqui est√° o que parece: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8e/5df/49e/a8e5df49eecf2ebc5e94e571cb7d0ff8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui, usei a op√ß√£o MITRE para o padr√£o de escala em preto e branco, para que ele espelhe em rela√ß√£o ao √¢ngulo. </font><font style="vertical-align: inherit;">Para um padr√£o de c√≠rculos vermelhos e quadrados pretos dentro de uma linha dourada (e para um padr√£o de c√≠rculos fora da borda), usei STOPPED. </font><font style="vertical-align: inherit;">Voc√™ pode ver que esses dois padr√µes terminam perto da esquina.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, existem alguns problemas. Primeiramente, vemos que, √† esquerda, o elemento mais pr√≥ximo ao canto √© um quadrado preto e, no topo, um c√≠rculo vermelho. Isso aconteceu porque o canto est√° pr√≥ximo ao in√≠cio da repeti√ß√£o, de um lado, e ao final da repeti√ß√£o, de outro. Mas parece estranho. Seria melhor se os cantos fossem sim√©tricos, mesmo que para isso tiv√©ssemos que adicionar outro elemento ao final do padr√£o. Em segundo lugar, voc√™ pode ver que o padr√£o fora da borda (semic√≠rculos e pontos pretos) tamb√©m termina em uma repeti√ß√£o no canto. Mas como a dura√ß√£o dessa repeti√ß√£o √© muito menor que a dura√ß√£o dos c√≠rculos vermelhos / quadrados pretos, eles terminam em lugares diferentes. Provavelmente seria melhor se todos os padr√µes parassem √† mesma dist√¢ncia da esquina.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para corrigir o primeiro problema, voc√™ precisa adicionar outra repeti√ß√£o do primeiro elemento do padr√£o no final de cada lado da borda. </font><font style="vertical-align: inherit;">Mas, na verdade, √© um pouco mais complicado, porque eu poderia usar um deslocamento horizontal negativo dentro do padr√£o para sobrepor v√°rios elementos (como feito aqui). </font><font style="vertical-align: inherit;">Voc√™ tamb√©m precisa adicionar outra repeti√ß√£o a qualquer elemento do padr√£o que tenha o mesmo ponto inicial do primeiro elemento.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c4/331/6fc/9c43316fcd44d79a0b2374401a46240a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, o padr√£o √© sim√©trico em rela√ß√£o ao √¢ngulo e parece muito melhor. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, preciso rastrear o padr√£o STOPPED mais longo e parar cada padr√£o STOPPED a essa dist√¢ncia:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a33/920/c6c/a33920c6cda9072bbda915544f1f4926.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora, o padr√£o dos c√≠rculos brancos √© mais reservado, mas ainda n√£o est√° alinhado com o padr√£o dos c√≠rculos vermelhos. </font></font> Porque<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso aconteceu porque o padr√£o de c√≠rculo branco est√° mais distante da borda do mapa e o comprimento da borda √© maior do que o local onde o padr√£o de c√≠rculo vermelho √© desenhado. </font><font style="vertical-align: inherit;">Para corrigir esse problema, voc√™ precisa mover os padr√µes tamb√©m, considerando o deslocamento em rela√ß√£o √† borda do mapa.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70b/574/2c1/70b5742c1d4f404335b97128f09d6baf.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora tudo est√° maravilhosamente alinhado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A segunda op√ß√£o para √¢ngulos s√£o os deslocamentos quadrados nos cantos, por exemplo:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cac/37e/bac/cac37ebac81815955dfc940bacdc2eff.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ser√° muito mais dif√≠cil implementar isso! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, a gram√°tica desta op√ß√£o √© simples e usa o opcode da op√ß√£o:</font></font><br><br><blockquote> <code><b>element -&gt; "O(SQOFFSET)"</b> <br> <b>element -&gt; "O(SQOFFSET," number ")"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O n√∫mero indica o tamanho do deslocamento quadrado do elemento na borda do mapa; </font><font style="vertical-align: inherit;">Elementos com deslocamentos diferentes devem ser alinhados de acordo. </font><font style="vertical-align: inherit;">Se n√£o houver n√∫mero, o programa seleciona o tamanho de deslocamento apropriado. </font><font style="vertical-align: inherit;">Zerar o n√∫mero desativa o deslocamento quadrado. </font><font style="vertical-align: inherit;">Isso permite criar bordas nas quais alguns elementos usam deslocamentos quadrados, enquanto outros n√£o, como nesta borda:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97b/fd8/336/97bfd833697b9278660772c1bd04ee46.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A primeira coisa que percebi foi que precisaria de √°reas de truncamento adicionais porque uso o truncamento para processar locais onde a borda muda de dire√ß√£o. </font><font style="vertical-align: inherit;">SQOFFSET exigir√° √°reas de truncamento mais complexas; </font><font style="vertical-align: inherit;">Voc√™ tamb√©m precisar√° de √°reas separadas para itens diferentes ao ativar e desativar o SQOFFSET. </font><font style="vertical-align: inherit;">Dado que as √°reas de truncamento adicionam artefatos indesejados de qualquer maneira, isso parece muito trabalho.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando trabalhei nos padr√µes pass√≠veis de parada acima, implementei o preenchimento de um padr√£o assim√©trico para adicionar outra repeti√ß√£o a partir de uma extremidade do padr√£o. Tamb√©m percebi que isso eliminaria a necessidade de cantos chanfrados. Simplesmente desenharei todos os padr√µes ao longo da borda no sentido hor√°rio, iniciando o padr√£o em um canto e terminando pr√≥ximo ao pr√≥ximo. Isso permitir√° que eu me livre das √°reas de truncamento. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O mais importante nessa nova maneira de trabalhar com cantos √© que o primeiro elemento do padr√£o n√£o √© mais "dividido" em dois lados. Se voc√™ observar os padr√µes de escala em preto e branco nos mapas acima, poder√° ver que h√° um ret√¢ngulo branco passando pelo canto. Agora o ret√¢ngulo branco fica ao lado do canto:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ead/909/c83/ead909c83fa91ff80af290ab92ca9fae.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os mapas s√£o desenhados nos dois sentidos, mas esse n√£o √© um problema muito grande. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para iniciantes, implementei compensa√ß√µes para linhas. </font><font style="vertical-align: inherit;">Para isso, basta girar a linha em rela√ß√£o aos √¢ngulos correspondentes:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c2/bf6/2fd/9c2bf62fdfec732f56361f4aa17fc19e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como voc√™ pode entender, eu posso combinar √¢ngulos com deslocamentos e √¢ngulos regulares, como no mapa acima: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0b/f5b/e02/e0bf5be02606044dd5fba4f82d3dad67.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviamente, virar os padr√µes ao virar da esquina √© mais dif√≠cil. </font><font style="vertical-align: inherit;">A id√©ia geral √© desenhar de um canto para quase o outro, e assim por diante, ao longo da fronteira, at√© voltarmos ao in√≠cio. </font><font style="vertical-align: inherit;">Teoricamente, basta desenhar apenas padr√µes horizontais e verticais, e tudo deve estar perfeitamente alinhado; </font><font style="vertical-align: inherit;">rastrear tudo isso √© bastante triste. </font><font style="vertical-align: inherit;">Na verdade, tive que reescrever completamente o c√≥digo duas vezes e escrever um monte de papel, mas n√£o falarei sobre isso em detalhes. </font><font style="vertical-align: inherit;">Apenas mostre o resultado:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/912/35b/889/91235b889603c973fcfe094a1614a993.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma ilus√£o de √≥tica irritante surge nos cantos - o elemento do canto parece n√£o centrado perto do lado de fora do canto. </font><font style="vertical-align: inherit;">De fato, isso n√£o √© verdade, mas parece que sim, porque mais perto do lado de dentro da esquina h√° um espa√ßo visualmente mais vazio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como os segmentos dos √¢ngulos de deslocamento s√£o bastante curtos, √© muito f√°cil criar um padr√£o de n√£o equil√≠brio no canto:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b1b/601/dff/b1b601dffc11782fb8cbe738a906b0e5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Äs vezes parece muito feio. </font><font style="vertical-align: inherit;">Isso me lembrou uma velha piada:</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paciente: "Doutor, quando fa√ßo isso, me d√≥i." </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©dico: "Ent√£o n√£o fa√ßa isso!"</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, tentarei n√£o fazer isso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Normalmente, n√£o desenharei a escala do mapa ao longo do √¢ngulo de deslocamento, mas, se necess√°rio, precisarei usar a op√ß√£o que estica o padr√£o para que a escala do mapa caiba no canto sem espa√ßos entre os ret√¢ngulos:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26f/a88/0da/26fa880da6d00d380afdae60c489dd9c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode ver que, como resultado, o tamanho dos ret√¢ngulos da escala varia acentuadamente. </font><font style="vertical-align: inherit;">Ou seja, essa n√£o √© uma op√ß√£o muito boa. </font><font style="vertical-align: inherit;">(A prop√≥sito, os √¢ngulos de deslocamento tamb√©m apresentam um erro no padr√£o dos c√≠rculos. Mais tarde, eu o corrigi, mas como disse, √© muito dif√≠cil faz√™-lo.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o padr√£o √© muito grande para caber no segmento do √¢ngulo de deslocamento, o algoritmo simplesmente desiste:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/044/b2d/b4d044b2dc2bf23cd670113476b9803d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que est√° longe de ser o ideal, mas, como eu disse acima, "ent√£o n√£o fa√ßa". </font><font style="vertical-align: inherit;">(Na verdade, n√£o √© muito dif√≠cil adicionar uma fun√ß√£o de compress√£o ou alongamento, se eu precisar.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que acontece se eu usar os cantos deslocados e a op√ß√£o que interrompe os padr√µes na frente dos cantos? </font><font style="vertical-align: inherit;">Nesse caso, apenas paro n√£o muito longe dos cantos do deslocamento:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/170/d60/9c1/170d609c1b789359490e35741215ba04.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parece-me que esta √© uma decis√£o l√≥gica. </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt444190/">https://habr.com/ru/post/pt444190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt444178/index.html">9 dicas para criar jogos independentes a partir de um √∫nico desenvolvedor</a></li>
<li><a href="../pt444182/index.html">Ir condi√ß√µes e suas esquisitices</a></li>
<li><a href="../pt444184/index.html">Sobre as perspectivas de data centers pr√©-montados</a></li>
<li><a href="../pt444186/index.html">Flutter 1.2. Novidades</a></li>
<li><a href="../pt444188/index.html">CG Pods - fones de ouvido TWS que poderiam</a></li>
<li><a href="../pt444192/index.html">Mitap de gerenciamento de API - IBM, Google, Yandex e Leroy Merlin Experience - Registro dispon√≠vel</a></li>
<li><a href="../pt444198/index.html">O Dropbox limita a sincroniza√ß√£o: agora apenas 3 dispositivos</a></li>
<li><a href="../pt444200/index.html">Sess√£o de resolu√ß√£o de problemas</a></li>
<li><a href="../pt444204/index.html">Apresentando o teste em Python. Parte 3</a></li>
<li><a href="../pt444206/index.html">27 de mar√ßo de Moscou - JavaScript MeetUP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>