<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçü§ù‚Äçüë®üèæ ‚ùå üå¥ Syst√®me de coordonn√©es ultrasonique 2.0 üåæ üòÖ üë®üèæ‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Syst√®me de coordonn√©es ultrasonique 2.0 
 Objet de cet article: Cet article d√©crit les principes de fonctionnement de mon syst√®me de d√©termination de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Syst√®me de coordonn√©es ultrasonique 2.0</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479530/"><h2>  Syst√®me de coordonn√©es ultrasonique 2.0 </h2><br>  <b>Objet de cet article:</b> Cet article d√©crit les principes de fonctionnement de mon syst√®me de d√©termination de coordonn√©es et mon exp√©rience dans sa fabrication.  Cet article n'est pas une instruction pour la fabrication d'un syst√®me de navigation, car il n'est pas si simple √† d√©crire dans un seul article. <br><br><img src="https://habrastorage.org/webt/-r/zu/xp/-rzuxphjgpq9izjwplxls7rrwue.png"><br><br>  Cet article est un d√©veloppement des id√©es de mon article pr√©c√©dent: <br>  <a href="https://habr.com/ru/post/451408/">habr.com/en/post/451408</a> <br><a name="habracut"></a><br><h3>  Structure du syst√®me </h3><br>  Le syst√®me de d√©termination des coordonn√©es a le diagramme structurel suivant: <br><br><img src="https://habrastorage.org/webt/l1/-w/4j/l1-w4j5qkp9xuwk_2k8x7kvnqfg.png"><br>  Fig.  1 - Sch√©ma de principe de l'√©chographe pour la d√©termination des coordonn√©es. <br><br>  Examinons chaque √©l√©ment de plus pr√®s. <br><br><h3>  R√©cepteur √† ultrasons </h3><br><img src="https://habrastorage.org/webt/ix/cv/og/ixcvogrpoy4ntuu0qw9ytjbtyje.png"><br><br><img src="https://habrastorage.org/webt/nc/sr/tf/ncsrtfhxi-rsa8jstcwuuax0nfu.jpeg"><br><br><img src="https://habrastorage.org/webt/f4/83/bj/f483bjd1b0vfkn0a5yywlcv_a-g.jpeg"><br>  Fig.  2 - D√©veloppement d'un r√©cepteur √† ultrasons (de haut en bas). <br><br>  Initialement, les r√©cepteurs se composaient d'un module et avaient une tr√®s petite zone de couverture de la pi√®ce, √† cette √©poque, je ne num√©risais pas le signal, mais recevais simplement du capteur la longueur que le contr√¥leur r√©gulier avait donn√©e. <br><br>  Puis, pour augmenter la couverture, j'ai d√©cid√© de r√©aliser un module de trois capteurs, dont les donn√©es ont √©t√© simultan√©ment num√©ris√©es et transmises √† un PC, o√π la distance et les coordonn√©es ont √©t√© calcul√©es.  Apr√®s avoir test√© un r√©cepteur √† trois composants, j'ai vu qu'un r√©cepteur suffit si vous traitez le signal vous-m√™me. <br><br>  En cons√©quence, le r√©cepteur est redevenu monocomposant, mais en raison du fait que je traite actuellement le signal, la zone de couverture est devenue assez grande.  Le signal est maintenant trait√© dans STM32 apr√®s la num√©risation, il ne d√©livre que la distance √† la sortie. <br><br>  Composition: <br><ul><li>  STM32 - utilis√© pour num√©riser le signal ultrasonore et calculer la distance jusqu'√† l'√©metteur; </li><li>  HC-SR04 - Je l'ai l√©g√®rement modifi√© et maintenant je peux recevoir le signal de son entr√©e, comme illustr√© √† la figure 3; </li><li>  RS485 - pour transmettre la distance de l'√©metteur √† un PC. </li></ul><br><img src="https://habrastorage.org/webt/sd/xb/qp/sdxbqplmpwkrchgdlty-ptpigms.png"><br>  Fig.  3 - Signal ultrasonique num√©ris√©. <br><br><img src="https://habrastorage.org/webt/ty/8c/lf/ty8clfyeg2s3jxde_dbgtolirmo.png"><br>  Fig.  4 - signal ultrasonore dans la zone 4700 - 5200 de la figure ci-dessus. <br><br><h3>  Emetteur ultrasonique </h3><br><img src="https://habrastorage.org/webt/fv/ta/el/fvtael07m2b6_r2ybluysab17gk.jpeg"><br><br><img src="https://habrastorage.org/webt/gs/i2/7f/gsi27fd6sg6vyiw39z6rfwebmky.jpeg"><br><br><img src="https://habrastorage.org/webt/t5/s6/ai/t5s6aihoqrlyvq7o1uqyxkv90jy.jpeg"><br>  Fig.  5 - D√©veloppement de l'√©metteur (de haut en bas). <br><br>  Comme vous pouvez le voir sur la figure 5, au d√©but, je viens de tirer le pied Trig sur le capteur HC-SR04, ce n'√©tait pas le meilleur syst√®me, ne serait-ce que parce que je ne pouvais pas d√©terminer combien d'ondes ultrasonores je pouvais cr√©er, je ne pouvais pas changer leur puissance, et cet √©metteur √©tait assez encombrant. <br><br>  J'ai ensuite cr√©√© une deuxi√®me version, qui √©tait beaucoup plus encombrante, mais je pouvais d√©j√† tout r√©gler avec STM32 et L293D, qui √©taient directement connect√©s au haut-parleur √† ultrasons.  Maintenant, au lieu des 5 volts standard, j'en ai appliqu√© 17, ce qui a consid√©rablement augment√© la zone de travail.  J'ai √©galement ajout√© un module radio et une interface RS485, ce qui a rendu ce module autonome. <br><br>  Apr√®s une s√©rie de tests, j'ai d√©cid√© de r√©duire l'√©metteur √† une taille d√©cente et de l'assembler plus √©troitement, √† la suite de ce que vous voyez sur la derni√®re photo. <br><br>  <b>Composition:</b> <br><ul><li>  STM32 - re√ßoit la commande Trig (commencer √† mesurer les distances) via le canal radio et √©met un signal ultrasonique, transmet √©galement les commandes re√ßues du module radio √† RS485 (je l'utilise pour le contr√¥le √† distance de la plate-forme mobile); </li><li>  RS485 - interface d'informations sur l'appareil pour l'utilisateur; </li><li>  Boost DC-DC - convertit l'alimentation 5V en 17V pour l'√©metteur; </li><li>  L293D - J'utilise pour g√©n√©rer un signal ultrasonique puissant avec une tension de 17V; </li><li>  nRF24 - canal radio; </li><li>  Emetteurs - 6 √©metteurs sortis du module HC-SR04. </li></ul><br><h3>  Module de base </h3><br><img src="https://habrastorage.org/webt/sh/ry/r5/shryr5oczq8ct0zjj-nw7ixvpx0.jpeg"><br>  Fig.  6 - Le module de base. <br><br>  <b>Composition:</b> <br><ul><li>  STM32 - envoie Trig √† l'√©metteur et aux r√©cepteurs, re√ßoit les commandes USB du PC pour la transmission via le canal radio √† l'√©metteur (alias un module mobile); </li><li>  nRF24 - transmission de Trig √† l'√©metteur et transmission des commandes √† l'√©metteur. </li></ul><br><h3>  Module PC </h3><br>  L'adaptateur PC via RS485 est connect√© √† tous les r√©cepteurs √† ultrasons, sur cette interface en re√ßoit toutes les longueurs et calcule les coordonn√©es du module mobile.  Via USB, il est connect√© au module de base et, √† travers lui, transf√®re les commandes de contr√¥le au module mobile. <br><br><h3>  Emplacement des modules dans la zone de travail </h3><br>  Une carte d'une pi√®ce avec des r√©cepteurs √† ultrasons plac√©s aux coins ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/zf/my/cl/zfmyclsx5ihwv9bg1yay6x033ro.png"><br>  Fig.  7 - L'id√©e g√©n√©rale de l'emplacement des capteurs. <br><br><img src="https://habrastorage.org/webt/r_/5p/bz/r_5pbz5hmgbxo4l0wmnfiiew3gi.png"><br>  Fig.  8 - Vue de dessus sur une √©chelle (cercles, avec des nombres √† l'int√©rieur, les capteurs sont indiqu√©s). <br><br><h3>  L'algorithme de travail du syst√®me de d√©termination des coordonn√©es ultrasonores </h3><br><ol><li>  Le module de base envoie une commande de d√©clenchement √† l'√©metteur (par liaison radio) et aux r√©cepteurs (par c√¢ble). </li><li>  L'√©metteur commence √† √©mettre et les r√©cepteurs commencent √† √©couter la diffusion. </li><li>  Chaque r√©cepteur, apr√®s avoir entendu le signal ultrasonore, enregistre le temps entre la commande Trig et l'heure de r√©ception de ce signal et le traduit en distance. </li><li>  Les r√©cepteurs RS485 envoient des distances de l'√©metteur √† eux-m√™mes sur un PC. </li><li>  Le PC calcule les coordonn√©es de l'√©metteur. </li></ol><br><h3>  Fonctionnement du syst√®me </h3><br>  En ex√©cutant tout cela, nous obtenons les coordonn√©es de l'objet, la pr√©cision d√©pend de la place dans la pi√®ce.  Dans les meilleurs endroits, l'erreur ne d√©passe pas quelques centim√®tres, et dans le pire ... eh bien, vous pouvez tout voir vous-m√™me sur la figure 9. <br><br><img src="https://habrastorage.org/webt/f-/_p/dc/f-_pdck7ruxzuay-7y9gsfrh6tk.png"><br>  Fig.  9 - D√©placement de l'√©metteur dans la pi√®ce. <br><br>  Il y a quatre ensembles de coordonn√©es dans cette figure, puisque nous avons quatre r√©cepteurs, et pour d√©terminer les coordonn√©es dans l'espace tridimensionnel, nous n'avons besoin que de trois, alors nous avons quatre combinaisons de r√©cepteurs. <br><br>  Comme on peut le voir sur la figure, en g√©n√©ral, le syst√®me d√©termine correctement les coordonn√©es, mais √† diff√©rents endroits, l'erreur est diff√©rente.  J'ai d√©plac√© l'√©metteur parall√®lement aux axes X et Y, quelque part avec un intervalle entre les lignes dans un m√®tre, quelque part dans un demi-m√®tre, cela peut √™tre vu sur la figure.  La meilleure pr√©cision est au centre, et sur les bords, tout est mauvais, car √† partir de l√†, le signal ultrasonique tombe sur le r√©cepteur sous un grand angle, ce qui cr√©e des distorsions dans le signal num√©ris√©. <br><br>  Apr√®s filtrage et moyenne de quatre paires de coordonn√©es, nous obtenons l'image suivante: <br><br><img src="https://habrastorage.org/webt/ac/ny/6c/acny6c59da471karux9ty6u0h6m.png"><br>  Fig.  10 - Trajectoire moyenne. <br><br>  Pas de glace, mais qu'y a-t-il. <br><br>  Pour le plaisir, je vais vous montrer √† quoi tout cela ressemble en 3D, car nous avons √©galement une troisi√®me coordonn√©e, bien qu'elle ne soit pas n√©cessaire dans mon projet, car un robot mobile ne se d√©place que dans un avion. <br><br><img src="https://habrastorage.org/webt/-y/gr/uk/-ygrukcimy5ldmzsmpf3zbcqsqe.png"><br>  Fig.  11 - Trajectoire 3D. <br><br>  Comme nous pouvons le voir, tous les points se trouvent approximativement dans le m√™me plan, et c'est correct, car j'ai conduit l'√©metteur √† travers le sol sans le retirer. <br><br>  Et voici un exemple de passage infructueux d'une plateforme mobile avec un √©metteur, sa trajectoire est clairement visible.  Selon le plan, la plate-forme √©tait cens√©e revenir au point de d√©part, apr√®s avoir suivi un chemin rectangulaire, mais cela n'a pas fonctionn√©, dans les articles suivants, je vais vous expliquer pourquoi. <br><br><img src="https://habrastorage.org/webt/qj/nu/ez/qjnuezuiq9q3idwssbngqbdeqoc.png"><br>  Fig.  12 - La trajectoire de mouvement de la plateforme mobile. <br><br><h3>  Probl√®mes r√©els </h3><br>  J'ai actuellement un certain nombre de probl√®mes urgents, et si quelqu'un peut sugg√©rer quelque chose, veuillez l'√©crire dans les commentaires ou sur VK: <br>  <a href="https://vk.com/b__s__v" rel="nofollow">vk.com/b__s__v</a> <br><br>  1. <b>Quelle est la meilleure fa√ßon de recevoir un signal ultrasonore?</b>  Les capteurs HC-SR04 que j'utilise maintenant pour recevoir et amplifier un signal ultrasonore ne sont pas la meilleure option.  Premi√®rement, parce qu'ils re√ßoivent toujours un signal avec une seule fr√©quence et que vous ne pouvez pas faire une s√©paration de fr√©quence des sources de signal (ce qui est int√©ressant pour moi d'essayer), en plus, ils sont trop volumineux et je suis tr√®s d√©pendant d'eux. <br>  2. <b>Comment supprimer les distorsions de coordonn√©es dans les diff√©rents coins de la pi√®ce?</b>  Sur la grille que j'ai peinte au sol, on peut voir que parfois les lignes droites commencent √† d√©vier, m√™me si j'ai toujours d√©plac√© le module mobile en douceur, et d'une mani√®re ou d'une autre je dois m'en d√©barrasser. <br>  3. <b>Pour nRF24, le signal dispara√Æt.</b>  Lorsque les modules sont proches, alors il n'y a pas de probl√®me, mais il vaut la peine de les √©taler de quelques m√®tres et de se tenir entre eux, car les messages passent √† travers l'un.  Je n'ai pas √† renvoyer de messages l√†-bas, car je transmets des signaux d'horloge sur ce canal, et ils devraient toujours arriver dans la m√™me seconde.  J'ai des modules avec une antenne externe, et celui du module de base fonctionne mieux sans antenne qu'avec.  Je ne comprends rien, la puissance est au maximum. <br>  4. <b>Lieux de promotion du projet.</b>  Si quelqu'un conna√Æt des sites internationaux comme Habr en anglais, veuillez jeter les liens, sinon je n'ai rien trouv√© de correct, mais stackoverflow, ce ne sont que des questions et r√©ponses, pas tout √† fait pour publier de tels articles. <br>  5. <b>Commentaires et suggestions.</b>  Si quelqu'un veut s'exprimer, je serai heureux de recevoir des critiques et des suggestions. <br><br>  C'est loin de la fin de mon projet, m√™me si le temps tire √† sa fin, mais s'il y a un int√©r√™t, j'√©crirai un article sur la fa√ßon dont un robot mobile se d√©place bas√© sur ce syst√®me aux coordonn√©es donn√©es dans ma chambre. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479530/">https://habr.com/ru/post/fr479530/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479514/index.html">Confidentialit√© par conception et confidentialit√© par d√©faut (protection des donn√©es con√ßue et confidentialit√© par d√©faut par GDPR)</a></li>
<li><a href="../fr479516/index.html">Qu'est-ce que l'entropie dans un logiciel et comment le g√©rer?</a></li>
<li><a href="../fr479518/index.html">La communication au sein d'une √©quipe √† distance est notre exp√©rience</a></li>
<li><a href="../fr479522/index.html">Editeur Peter. Soldes d'hiver</a></li>
<li><a href="../fr479524/index.html">Service pour Active Restore ou l'histoire d'un projet industriel √† Innopolis</a></li>
<li><a href="../fr479534/index.html">Kubernetes 1.17 - Comment mettre √† niveau et ne pas d√©penser tout le budget d'erreur</a></li>
<li><a href="../fr479536/index.html">√âquilibrage de charge dans Zimbra Open-Source Edition avec HAProxy</a></li>
<li><a href="../fr479538/index.html">La technologie entra√Æne le d√©clin de l'humanit√©. Il est temps de changer quelque chose</a></li>
<li><a href="../fr479540/index.html">Utilisation de passwordstore.org - Gestionnaire de mots de passe de style KISS</a></li>
<li><a href="../fr479542/index.html">Comment √©crire votre propre translitt√©rateur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>