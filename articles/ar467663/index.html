<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฅค ๐ด ๐ง๐ผ ุฏุนู ุงูุฅุฑุดุงุฏุงุช ุงูุฎุงุตุฉ ุจุงูุฃุฌูุฒุฉ ูู .NET Core (ุงูุขู ููุณ ููุท SIMD) ๐ด ๐ด ๐ด</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุฏูุฉ 


 ูุจู ุจุถุน ุณููุงุช ุ ูุฑุฑูุง ุฃู ุงูููุช ูุฏ ุญุงู ูุฏุนู ุฑูุฒ SIMD ูู .NET . ูุฏููุง โโูุณุงุญุฉ ุงูุงุณู System.Numerics ุจุฃููุงุน Vector2 ู Vector3 ู Vector4 ู Vecto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฏุนู ุงูุฅุฑุดุงุฏุงุช ุงูุฎุงุตุฉ ุจุงูุฃุฌูุฒุฉ ูู .NET Core (ุงูุขู ููุณ ููุท SIMD)</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/clrium/blog/467663/" style=";text-align:right;direction:rtl"><h2 id="vvedenie" style=";text-align:right;direction:rtl">  ููุฏูุฉ </h2><br><p style=";text-align:right;direction:rtl"> ูุจู ุจุถุน ุณููุงุช ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฑุฑูุง ุฃู ุงูููุช ูุฏ ุญุงู ูุฏุนู ุฑูุฒ SIMD ูู .NET</a> .  ูุฏููุง โโูุณุงุญุฉ ุงูุงุณู <code>System.Numerics</code> ุจุฃููุงุน <code>Vector2</code> ู <code>Vector3</code> ู <code>Vector4</code> ู <code>Vector&lt;T&gt;</code> .  ุชูุซู ูุฐู ุงูุฃููุงุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ููุฃุบุฑุงุถ ุงูุนุงูุฉ ูุฅูุดุงุก ุชุนูููุงุช ุงููุชุฌูุงุช ูุงููุตูู ุฅูููุง ููุนุงูุฌุชูุง ูููุง ุฃููู ุฐูู.  ููุง ุฃููุง ุชููุฑ ุชูุงูู ุงูุจุฑุงูุฌ ูุชูู ุงูุญุงูุงุช ุงูุชู ูุง ูุฏุนู ุงูุฌูุงุฒ ูููุง ุงูุฅุฑุดุงุฏุงุช ุงูููุงุณุจุฉ.  ุณูุญ ูุฐุง ุ ูุน ุงูุญุฏ ุงูุฃุฏูู ูู ุฅุนุงุฏุฉ ุงูุจูุงุก ุ ุจุชูุฌูู ุนุฏุฏ ูู ุงูุฎูุงุฑุฒููุงุช.  ุจุตุฑู ุงููุธุฑ ุนู ุฐูู ุ ูุฅู ุนููููุฉ ูุฐุง ุงูููุฌ ุชุฌุนู ูู ุงูุตุนุจ ุชุทุจููู ูู ุฃุฌู ุงูุงุณุชูุงุฏุฉ ุงููุงููุฉ ูู ูู ูุง ูู ูุชุงุญ ุ ุนูู ุงูุฃุฌูุฒุฉ ุงูุญุฏูุซุฉ ุ ุชุนูููุงุช ุงููุชุฌูุงุช.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุชููุฑ ุงูุฃุฌูุฒุฉ ุงูุญุฏูุซุฉ ุนุฏุฏูุง ูู ุงูุฅุฑุดุงุฏุงุช ุงููุชุฎุตุตุฉ ุบูุฑ ุงูููุฌูุฉ ุงูุชู ูููููุง ุชุญุณูู ุงูุฃุฏุงุก ุจุดูู ูุจูุฑ.  ูู ูุฐู ุงูููุงูุฉ ุ ุณุฃุชุญุฏุซ ุนู ููููุฉ ุงูุชุญุงูู ุนูู ูุฐู ุงููููุฏ ูู .NET Core 3.0. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/4d/mx/lt/4dmxlt8xgnpgncvellsujvoe_rk.jpeg"><br>  <strong>ููุงุญุธุฉ: ูุง</strong> <em>ููุฌุฏ ูุตุทูุญ <strong>ูุญุฏุฏ</strong> ูุชุฑุฌูุฉ <strong>Intrisics ุญุชู ุงูุขู</strong> .</em>  <em>ูู ููุงูุฉ ุงูููุงู ุ ููุงู ุชุตููุช ูุฎูุงุฑ ุงูุชุฑุฌูุฉ.</em>  <em>ุฅุฐุง ุงุฎุชุฑูุง ุฎูุงุฑูุง ุฌูุฏูุง ุ ูุณูุบูุฑ ุงูููุงูุฉ</em> </p><a name="habracut"></a><br><h2 id="chto-takoe-vstroennye-funkcii" style=";text-align:right;direction:rtl">  ูุง ูู ูุธุงุฆู ุงููุฏูุฌ ูู </h2><br><p style=";text-align:right;direction:rtl">  ูู .NET Core 3.0 ุ ุฃุถููุง ูุธุงุฆู ุฌุฏูุฏุฉ ุชุณูู ูุธุงุฆู <em>ูุถูููุฉ ุฎุงุตุฉ ุจุงูุฃุฌูุฒุฉ</em> (ุฃูุตู WF).  ุชููุฑ ูุฐู <em>ุงููุธููุฉ</em> ุงููุตูู ุฅูู ุงูุนุฏูุฏ ูู ุฅุฑุดุงุฏุงุช ุงูุฃุฌูุฒุฉ ุงููุญุฏุฏุฉ ุงูุชู ูุง ูููู ุชูุซูููุง ุจุจุณุงุทุฉ ุนู ุทุฑูู ุขููุงุช ูุชุนุฏุฏุฉ ุงูุฃุบุฑุงุถ ุงูุนุงูุฉ.  ููู ุชุฎุชูู ุนู ุฅุฑุดุงุฏุงุช SIMD ุงูุญุงููุฉ ูู ุญูุซ ุฃููุง ูุง ุชููู ุบุฑุถูุง ุนุงููุง ( <em>WFs</em> ุงูุฌุฏูุฏุฉ ููุณุช ูุดุชุฑูุฉ ุจูู ุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ ูููุฏุณุชูุง ุงููุนูุงุฑูุฉ ูุง ุชููุฑ ุชูุงูู ุงูุจุฑุงูุฌ).  ุจุฏูุงู ูู ุฐูู ุ ูุฅููุง ุชููุฑ ูุจุงุดุฑุฉ ูุธุงุฆู ุงููุธุงู ุงูุฃุณุงุณู ูุงูุฃุฌูุฒุฉ ุงูุฎุงุตุฉ ููุทูุฑู .NET.  ุชููุฑ ูุธุงุฆู SIMD ุงูุญุงููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนุจุฑ ุงููุธุงู ุงูุฃุณุงุณู ุ ุชูุงูู ุงูุจุฑุงูุฌ ุ ููู ูุณุชุฎุฑุฌุฉ ููููุงู ูู ุงูุฃุฌูุฒุฉ ุงูุฃุณุงุณูุฉ.  ูุฏ ูููู ูุฐุง ุงูุชุฌุฑูุฏ ุจุงูุธูุง ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฃูู ูููู ุฃู ูููุน ุงููุดู ุนู ุจุนุถ ุงููุธุงุฆู (ุนูู ุณุจูู ุงููุซุงู ุ ูู ุญุงูุฉ ุนุฏู ูุฌูุฏ ูุธููุฉ ุฃู ูุตุนุจ ูุญุงูุงุชูุง ุนูู ุฌููุน ุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ ุงููุณุชูุฏูุฉ). </p><br><p style=";text-align:right;direction:rtl">  ุชูุฌุฏ <em>ูุธุงุฆู ูุฏูุฌุฉ</em> ุฌุฏูุฏุฉ ูุฃููุงุน ูุฏุนููุฉ ุถูู <code>System.Runtime.Intrinsics</code> .  ุจุงููุณุจุฉ ุฅูู .NET Core 3.0 ุ ููุฌุฏ ุญุงูููุง <code>System.Runtime.Intrinsics.X86</code> .  ูุญู ูุนูู ุนูู ุฏุนู <em>ุงููุธุงุฆู ุงููุฏูุฌุฉ</em> <code>System.Runtime.Intrinsics.Arm</code> ุงูุฃุณุงุณูุฉ ุงูุฃุฎุฑู ูุซู <code>System.Runtime.Intrinsics.Arm</code> . </p><br><p style=";text-align:right;direction:rtl">  ุชุญุช ูุณุงุญุงุช ุงูุฃุณูุงุก ุงูุฎุงุตุฉ <em>ุจุงููุธุงู ุงูุฃุณุงุณู</em> ุ ูุชู ุชุฌููุน <em>WFs</em> ูู ูุฆุงุช ุชูุซู ูุฌููุนุงุช ูู ุฅุฑุดุงุฏุงุช ุงูุฃุฌูุฒุฉ ุงููุชูุงููุฉ ููุทููุงู (ุชูุณูู ุบุงูุจูุง ููุฏุณุฉ ูุฌููุนุฉ ุงูุชุนูููุงุช (ISA)).  ูููุฑ ูู ูุฆุฉ ุฎุงุตูุฉ <code>IsSupported</code> ุชุดูุฑ ุฅูู ูุง ุฅุฐุง ูุงูุช ุงูุฃุฌูุฒุฉ ุงูุชู ูุนูู ุนูููุง ุงูุฑูุฒ ุชุฏุนู ูุฌููุนุฉ ุงูุชุนูููุงุช ูุฐู.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุญุชูู ูู ูุฆุฉ ูู ูุฐู ุงููุฆุงุช ุนูู ูุฌููุนุฉ ูู ุงูุทุฑู ุงููุนููุฉ ููุฌููุนุฉ ูู ุงูุชุนูููุงุช ุงูููุงุจูุฉ.  ูู ุจุนุถ ุงูุฃุญูุงู ุ ุชูุฌุฏ ูุฆุฉ ูุฑุนูุฉ ุฅุถุงููุฉ ุชุชูุงูู ูุน ุฌุฒุก ูู ูุฌููุนุฉ ุงูุชุนูููุงุช ููุณูุง ุ ูุงูุชู ูุฏ ุชููู ูุญุฏูุฏุฉ (ูุฏุนููุฉ) ุจูุงุณุทุฉ ุฃุฌูุฒุฉ ูุนููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ุชููุฑ ูุฆุฉ <code>Lzcnt</code> ุงููุตูู ุฅูู <em>ุชุนูููุงุช ูุญุณุงุจ ุงูุฃุตูุงุฑ ุงูุจุงุฏุฆุฉ</em> .  ูุฏูู ูุฆุฉ ูุฑุนูุฉ ุชุณูู <code>X64</code> ุ ูุงูุชู ุชุญุชูู ุนูู ุดูู ูุฐู ุงูุชุนูููุงุช ุงููุณุชุฎุฏูุฉ ููุท ุนูู ุงูุฃุฌูุฒุฉ ุฐุงุช ุงูุนูุงุฑุฉ 64 ุจุช. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุถ ูุฐู ุงููุฆุงุช ุฐุงุช ุทุจูุนุฉ ูุฑููุฉ ุจุดูู ุทุจูุนู.  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูุงูุช <code>Lzcnt.X64.IsSupported</code> ุชุฑุฌุน ุฅูู true ุ ูุนูุฏุฆุฐู ูุฌุจ ุฃู ุชุฑุฌุน <code>Lzcnt.IsSupported</code> true ุ ูุฃู ูุฐู ูุฆุฉ ูุฑุนูุฉ ุตุฑูุญุฉ.  ุฃู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูุงูุช <code>Sse2.IsSupported</code> ุชูุฑุฌุน ุฅูู true ุ ูุนูุฏุฆุฐ ูุฌุจ ุฃู ุชุฑุฌุน <code>Sse.IsSupported</code> true ุ ูุฃู <code>Sse2</code> ูุฑุซ ุจุดูู ุตุฑูุญ ูู <code>Sse</code> .  ููุน ุฐูู ุ ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุชุดุงุจู ุฃุณูุงุก ุงููุฆุงุช ููุณ ูุคุดุฑุงู ุนูู ุงูุชูุงุฆูู ุฅูู ููุณ ุงูุชุณูุณู ุงููุฑูู ููููุฑุงุซ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุง <code>Bmi2</code> ุชูุฑูุซ <code>Bmi2</code> ุ ูุฐูู ุณุชููู ุงูููู ุงูุชู ูุชู ุฅุฑุฌุงุนูุง ุจูุงุณุทุฉ <code>IsSupported</code> ููุงุชูู ุงููุฌููุนุชูู ูู ุงูุชุนูููุงุช ูุฎุชููุฉ.  ูุงู ุงููุจุฏุฃ ุงูุฃุณุงุณู ูู ุชุทููุฑ ูุฐู ุงููุฆุงุช ูู ุงูุนุฑุถ ุงููุงุถุญ ูููุงุตูุงุช ISA.  ูุชุทูุจ SSE2 ุฏุนู SSE1 ุ ูุฐูู ุชุฑุชุจุท ุงููุฆุงุช ุงูุชู ุชูุซููุง ุจุงูููุฑุงุซ.  ูู ุงูููุช ููุณู ุ ูุง ูุญุชุงุฌ BMI2 ุฅูู ุฏุนู BMI1 ุ ูุฐูู ูู ูุณุชุฎุฏู ุงููุฑุงุซุฉ.  ูููุง ููู ูุซุงู ููุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุฃุนูุงู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">namespace System.Runtime.Intrinsics.X86 { public abstract class Sse { public static bool IsSupported { get; } public static Vector128&lt;float&gt; Add(Vector128&lt;float&gt; left, Vector128&lt;float&gt; right); // Additional APIs public abstract class X64 { public static bool IsSupported { get; } public static long ConvertToInt64(Vector128&lt;float&gt; value); // Additional APIs } } public abstract class Sse2 : Sse { public static new bool IsSupported { get; } public static Vector128&lt;byte&gt; Add(Vector128&lt;byte&gt; left, Vector128&lt;byte&gt; right); // Additional APIs public new abstract class X64 : Sse.X64 { public static bool IsSupported { get; } public static long ConvertToInt64(Vector128&lt;double&gt; value); // Additional APIs } } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุฑุคูุฉ ุงููุฒูุฏ ูู ุงูููุฏ ุงููุตุฏุฑู ุนูู ุงูุฑูุงุจุท ุงูุชุงููุฉ <a href="">source.dot.net ุฃู dotnet / coreclr ุนูู ุฌูุซุจ</a> </p><br><p style=";text-align:right;direction:rtl">  <code>IsSupported</code> ูุนุงูุฌุฉ ุงูุดููุงุช <code>IsSupported</code> ุจูุงุณุทุฉ ุจุฑูุงูุฌ ุงูุชุญููู ุงูุจุฑูุฌู JIT ุนูู ุฃููุง ุซูุงุจุช ููุช ุงูุชุดุบูู (ุนูุฏ ุชูููู ุงูุชุญุณูู) ุ ูุฐูู ูุง ุชุญุชุงุฌ ุฅูู ุชุฑุฌูุฉ ูุดุชุฑูุฉ ูุฏุนู ุนุฏุฉ ISA ุ ุฃู ุฃูุธูุฉ ุฃุณุงุณูุฉ ุ ุฃู ุจูู.  ุจุฏูุงู ูู ุฐูู ุ ุชุญุชุงุฌ ููุท ุฅูู ูุชุงุจุฉ ุงูููุฏ ุจุงุณุชุฎุฏุงู ุชุนุจูุฑุงุช <code>if</code> ุ ูุชูุฌุฉ ูุฐูู ุณูุชู ุชุฌุงูู ูุฑูุน ุงูุดูุฑุฉ ุบูุฑ ุงููุณุชุฎุฏูุฉ (ุฃู ุชูู ุงููุฑูุน ุงูุชู ูุง ูููู ุงููุตูู ุฅูููุง ุจุณุจุจ ูููุฉ ุงููุชุบูุฑ ูู ุงูุนุจุงุฑุฉ ุงูุดุฑุทูุฉ) ุนูุฏ ุฅูุดุงุก ุงูููุฏ ุงูุฃุตูู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูููู ุฃู ูุณุจู ุงูุชุญูู ูู <code>IsSupported</code> ุงููุทุงุจู ุงุณุชุฎุฏุงู ุฃูุงูุฑ ุงูุฃุฌูุฒุฉ ุงููุฏูุฌุฉ.  ุฅุฐุง ูู ููู ููุงู ุชุญูู ูู ูุฐุง ุงููุจูู ุ ูุฅู ุงูููุฏ ุงูุฐู ูุณุชุฎุฏู ุงูุฃูุงูุฑ ุงูุฎุงุตุฉ ุจุงููุธุงู ุงูุฃุณุงุณู ูุงูุชู ุชุนูู ุนูู ุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ / ุงูุจูู ุญูุซ ูุง ุชููู ูุฐู ุงูุฃูุงูุฑ ูุฏุนููุฉ ุณูุคุฏู ุฅูู ุงุณุชุซูุงุก ููุช ุชุดุบูู <code>PlatformNotSupportedException</code> . </p><br><h2 id="kakie-preimuschestva-oni-dayut" style=";text-align:right;direction:rtl">  ูุง ูู ุงูููุงุฆุฏ ุงูุชู ููุฏููููุงุ </h2><br><p style=";text-align:right;direction:rtl">  ุจุทุจูุนุฉ ุงูุญุงู ุ ูุฅู <em>ุงููุธุงุฆู ุงููุฏูุฌุฉ ุงูุฎุงุตุฉ ุจุงูุฃุฌูุฒุฉ</em> ููุณุช ูุฎุตุตุฉ ููุฌููุน ุ ูููู ูููู ุงุณุชุฎุฏุงููุง ูุชุญุณูู ุงูุฃุฏุงุก ูู ุงูุนูููุงุช ุงููุญููุฉ ุจุงูุญุณุงุจุงุช.  ุชุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>ML.NET</code></a> <code>CoreFX</code> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>ML.NET</code></a> ูุฐู ุงูุทุฑู ูุชุณุฑูุน ุงูุนูููุงุช ูุซู ุงููุณุฎ ูู ุงูุฐุงูุฑุฉ ุ ุฃู ุงูุจุญุซ ุนู ููุฑุณ ุนูุตุฑ ูู ุตููู ุฃู ุณูุณูุฉ ุ ุฃู ุชุบููุฑ ุญุฌู ุตูุฑุฉ ุ ุฃู ุงูุนูู ูุน ุงููุชุฌูุงุช / ุงููุตูููุงุช / ุงูุชูุณูุฑุงุช.  ูููู ุฃู ูููู ุงูุงุชุฌุงู ุงููุฏูู ูุจุนุถ ุงูุฃููุงุฏ ุงูุชู ุชุญููุช ุฅูู ุนูู ุงูุฒุฌุงุฌุฉ ุฃุจุณุท ููุง ูุจุฏู.  ูู ุงููุงูุน ุ ูุฅู ุชุญููู ุงูุดูุฑุฉ ูู ุชูููุฐ ุงูุนุฏูุฏ ูู ุงูุนูููุงุช ูู ููุช ูุงุญุฏ ุ ุจุดูู ุนุงู ุ ุจุงุณุชุฎุฏุงู ุชุนูููุงุช SIMD (ุฏูู ุชุนูููู ูุงุญุฏ ุ ุฏูู ุจูุงูุงุช ูุชุนุฏุฏุฉ). </p><br><p style=";text-align:right;direction:rtl">  ูุจู ุฃู ุชูุฑุฑ ุชูุฌูู ุจุนุถ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ุชุญุชุงุฌ ุฅูู ุชูููุฐ ุชุดููู ุฌุงูุจู ููุชุฃูุฏ ูู ุฃู ูุฐุง ุงูุฑูุฒ ุฌุฒุก ูู "ุงูููุทุฉ ุงููุนุงูุฉ" (ูุจุงูุชุงูู ุ ูุฅู ุงูุชุญุณูู ุงูุฎุงุต ุจู ุณูุนุทู ุฏูุนุฉ ูููุฉ ููุฃุฏุงุก).  ูู ุงูููู ุฃูุถูุง ุฅุฌุฑุงุก ุงูุชูุตูู ูู ูู ูุฑุญูุฉ ูู ูุฑุงุญู ุงูุชูุงุฒู ุ ุญูุซ ุฃู ุชุบููุฑ ุงูููุฏ ููุณ ููู ูุคุฏู ุฅูู ุฒูุงุฏุฉ ุงูุฅูุชุงุฌูุฉ. </p><br><h2 id="vektorizaciya-prostogo-algoritma" style=";text-align:right;direction:rtl">  ุชุญููู ุฎูุงุฑุฒููุฉ ุจุณูุทุฉ </h2><br><p style=";text-align:right;direction:rtl">  ูุชูุถูุญ ุงุณุชุฎุฏุงู <em>ุงูุฏูุงู ุงููุถูููุฉ ุ</em> ูุฃุฎุฐ ุงูุฎูุงุฑุฒููุฉ ูุชุฌููุน ุฌููุน ุนูุงุตุฑ ุงูุตููู ุฃู ุงููุทุงู.  ูุฐุง ุงูููุน ูู ุงูููุฏ ูู ุงููุฑุดุญ ุงููุซุงูู ููุชูุฌู ุ ูุฃู  ูู ูู ุชูุฑุงุฑ ุ ูุชู ุชูููุฐ ููุณ ุงูุนูููุฉ ุงูุชุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุซุงู ุชูููุฐ ูุซู ูุฐู ุงูุฎูุงุฑุฒููุฉ ูุฏ ุชุจุฏู ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public int Sum(ReadOnlySpan&lt;int&gt; source) { int result = 0; for (int i = 0; i &lt; source.Length; i++) { result += source[i]; } return result; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ุงูููุฏ ุจุณูุท ููุบุงูุฉ ููุจุงุดุฑ ุ ููููู ุจุทูุก ูู ุงูููุช ููุณู ุจุฏุฑุฌุฉ ูุงููุฉ ููุญุตูู ุนูู ุจูุงูุงุช ุงูุฅุฏุฎุงู ุงููุจูุฑุฉ ุ ูุซู  ูููู ุจุนูููุฉ ุชุงููุฉ ูุงุญุฏุฉ ููุท ููู ุชูุฑุงุฑ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">BenchmarkDotNet=v0.11.5, OS=Windows 10.0.18362 AMD Ryzen 7 1800X, 1 CPU, 16 logical and 8 physical cores .NET Core SDK=3.0.100-preview9-013775 [Host] : .NET Core 3.0.0-preview9-19410-10 (CoreCLR 4.700.19.40902, CoreFX 4.700.19.40917), 64bit RyuJIT [AttachedDebugger] DefaultJob : .NET Core 3.0.0-preview9-19410-10 (CoreCLR 4.700.19.40902, CoreFX 4.700.19.40917), 64bit RyuJIT</code> </pre> <br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  ุทุฑููุฉ </th><th>  ุนุฏ </th><th>  ูุชูุณุท </th><th>  ุฎุทุฃ </th><th>  StdDev </th></tr></thead><tbody><tr><td>  ูุฌููุน </td><td>  1 </td><td>  2.477 ู </td><td>  0.0192 ู </td><td>  0.0179 ู </td></tr><tr><td>  ูุฌููุน </td><td>  2 </td><td>  2.164 ู </td><td>  0.0265 ู </td><td>  0.0235 ู </td></tr><tr><td>  ูุฌููุน </td><td>  4 </td><td>  3.224 ู </td><td>  0.0302 ู </td><td>  0.0267 ู </td></tr><tr><td>  ูุฌููุน </td><td>  8 </td><td>  4.347 ู </td><td>  0.0665 ู </td><td>  0.0622 ู </td></tr><tr><td>  ูุฌููุน </td><td>  16 </td><td>  8.444 ู </td><td>  0.2042 ู </td><td>  0.3734 ู </td></tr><tr><td>  ูุฌููุน </td><td>  32 </td><td>  13.963 ู </td><td>  0.2182 ู </td><td>  0.2041 ู </td></tr><tr><td>  ูุฌููุน </td><td>  64 </td><td>  50.374 ู </td><td>  0.2955 ู </td><td>  0.2620 ู </td></tr><tr><td>  ูุฌููุน </td><td>  128 </td><td>  60.139 ู </td><td>  0.3890 ู </td><td>  0.3639 ู </td></tr><tr><td>  ูุฌููุน </td><td>  256 </td><td>  106.416 ns </td><td>  0.6404 ู </td><td>  0.5990 ู </td></tr><tr><td>  ูุฌููุน </td><td>  512 </td><td>  291.450 ู </td><td>  3.5148 ู </td><td>  3.2878 ู </td></tr><tr><td>  ูุฌููุน </td><td>  1024 </td><td>  574.243 ู </td><td>  9.5851 ู </td><td>  8.4970 ู </td></tr><tr><td>  ูุฌููุน </td><td>  2048 </td><td>  1 137.819 ู </td><td>  5.9363 ู </td><td>  5.5529 ู </td></tr><tr><td>  ูุฌููุน </td><td>  4096 </td><td>  2 228.341 ู </td><td>  22.8882 ู </td><td>  21.4097 ู </td></tr><tr><td>  ูุฌููุน </td><td>  8192 </td><td>  2 973.040 ูุงููุซุงููุฉ </td><td>  14.2863 ู </td><td>  12.6644 ู </td></tr><tr><td>  ูุฌููุน </td><td>  16384 </td><td>  5 883.504 ู </td><td>  15.9619 ู </td><td>  14.9308 ู </td></tr><tr><td>  ูุฌููุน </td><td>  32768 </td><td>  11 699.237 ู </td><td>  104.0970 ู </td><td>  97.3724 ู </td></tr></tbody></table></div><br><h2 id="povyshenie-proizvoditelnosti-za-schet-razvertyvaniya-ciklov" style=";text-align:right;direction:rtl">  ุฒูุงุฏุฉ ุงูุฅูุชุงุฌูุฉ ูู ุฎูุงู ุฏูุฑุงุช ุงููุดุฑ </h2><br><p style=";text-align:right;direction:rtl">  ุงููุนุงูุฌุงุช ุงูุญุฏูุซุฉ ูุฏููุง ุฎูุงุฑุงุช ูุฎุชููุฉ ูุชุญุณูู ุฃุฏุงุก ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ.  ุจุงููุณุจุฉ ููุชุทุจููุงุช ุฐุงุช ุงูุฎููุท ุงูููุฑุฏุฉ ุ ูุชูุซู ุฃุญุฏ ูุฐู ุงูุฎูุงุฑุงุช ูู ุชูููุฐ ุงูุนุฏูุฏ ูู ุงูุนูููุงุช ุงูุจุฏุงุฆูุฉ ูู ุฏูุฑุฉ ูุนุงูุฌ ูุงุญุฏ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ููุนุธู ุงููุนุงูุฌุงุช ุงูุญุฏูุซุฉ ุฅุฌุฑุงุก ุฃุฑุจุน ุนูููุงุช ุฅุถุงููุฉ ูู ุฏูุฑุฉ ูุงุญุฏุฉ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ (ูู ุธู ุงูุธุฑูู ุงููุซูู) ุ ููุชูุฌุฉ ูุฐูู ุ ูุน "ุงูุชุตููู" ุงูุตุญูุญ ููููุฏ ุ ููููู ูู ุจุนุถ ุงูุฃุญูุงู ุชุญุณูู ุงูุฃุฏุงุก ุ ุญุชู ูู ุงูุชูููุฐ ุงูููุฑุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุฃู JIT ูููููุง ุชูููุฐ ุญููุฉ ุฅูุบุงุก ุงูุชูุฑูุฑ ูู ุชููุงุก ููุณูุง ุ ุฅูุง ุฃู JIT ูุญุงูุธุฉ ูู ุงุชุฎุงุฐ ูุฐุง ุงูููุน ูู ุงููุฑุงุฑุงุช ุ ุจุณุจุจ ุญุฌู ุงูุดูุฑุฉ ุงูุชู ุชู ุฅูุดุงุคูุง.  ูุฐูู ุ ูุฏ ูููู ูู ุงููููุฏ ูุดุฑ ุญููุฉ ุ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูุฏูููุง. </p><br><p style=";text-align:right;direction:rtl">  ููููู ุชูุณูุน ุงูุญููุฉ ูู ุงูููุฏ ุฃุนูุงู ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public unsafe int SumUnrolled(ReadOnlySpan&lt;int&gt; source) { int result = 0; int i = 0; int lastBlockIndex = source.Length - (source.Length % 4); // Pin source so we can elide the bounds checks fixed (int* pSource = source) { while (i &lt; lastBlockIndex) { result += pSource[i + 0]; result += pSource[i + 1]; result += pSource[i + 2]; result += pSource[i + 3]; i += 4; } while (i &lt; source.Length) { result += pSource[i]; i += 1; } } return result; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ุงูุฑูุฒ ุฃูุซุฑ ุชุนููุฏูุง ุจุนุถ ุงูุดูุก ุ ูููู ูุณุชุฎุฏู ููุฒุงุช ุงูุฃุฌูุฒุฉ ุจุดูู ุฃูุถู. </p><br><p style=";text-align:right;direction:rtl">  ูุญููุงุช ุตุบูุฑุฉ ุญูุง ุ ููุฐุง ุงูุฑูุฒ ูุนูู ุฃุจุทุฃ ููููุง.  ููู ูุฐุง ุงูุงุชุฌุงู ูุชุบูุฑ ุจุงููุนู ูุจูุงูุงุช ุงูุฅุฏุฎุงู ุงูููููุฉ ูู ุซูุงููุฉ ุนูุงุตุฑ ุ ูุจุนุฏูุง ุชุจุฏุฃ ุณุฑุนุฉ ุงูุชูููุฐ ูู ุงูุฒูุงุฏุฉ (ููุช ุชูููุฐ ุงูููุฏ ุงููุญุณูู ุ ูู 32 ุฃูู ุนูุตุฑ ุ ุฃูู ุจูุณุจุฉ 26ูช ูู ููุช ุงูุฅุตุฏุงุฑ ุงูุฃุตูู).  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ูุฐุง ุงูุชุญุณูู ูุง ูุคุฏู ุฏุงุฆููุง ุฅูู ุฒูุงุฏุฉ ุงูุฅูุชุงุฌูุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏ ุงูุนูู ูุน ุงููุฌููุนุงุช ุงูุชู ุชุญุชูู ุนูู ุนูุงุตุฑ ูู ุงูููุน <code>float</code> ููุฅุตุฏุงุฑ "ุงูููุดูุฑ" ูู ุงูุฎูุงุฑุฒููุฉ ููุณ ุณุฑุนุฉ ุงูุฅุตุฏุงุฑ ุงูุฃุตูู ุชูุฑูุจูุง.  ูุฐูู ุ ูู ุงูููู ููุบุงูุฉ ุชูููุฐ ุงูุชูููุท. </p><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  ุทุฑููุฉ </th><th>  ุนุฏ </th><th>  ูุชูุณุท </th><th>  ุฎุทุฃ </th><th>  StdDev </th></tr></thead><tbody><tr><td>  SumUnrolled </td><td>  1 </td><td>  2.922 ู </td><td>  0.0651 ู </td><td>  0.0609 ู </td></tr><tr><td>  SumUnrolled </td><td>  2 </td><td>  3.576 ู </td><td>  0.0116 ู </td><td>  0.0109 ู </td></tr><tr><td>  SumUnrolled </td><td>  4 </td><td>  3.708 ู </td><td>  0.0157 ู </td><td>  0.0139 ู </td></tr><tr><td>  SumUnrolled </td><td>  8 </td><td>  4.832 ู </td><td>  0.0486 ู </td><td>  0.0454 ู </td></tr><tr><td>  SumUnrolled </td><td>  16 </td><td>  7.490 ูุงููุซุงููุฉ </td><td>  0.1131 ู </td><td>  0.1058 ู </td></tr><tr><td>  SumUnrolled </td><td>  32 </td><td>  11.277 ู </td><td>  0.0910 ู </td><td>  0.0851 ู </td></tr><tr><td>  SumUnrolled </td><td>  64 </td><td>  19.761 ู </td><td>  0.2016 ู </td><td>  0.1885 ู </td></tr><tr><td>  SumUnrolled </td><td>  128 </td><td>  36.639 ู </td><td>  0.3043 ู </td><td>  0.2847 ู </td></tr><tr><td>  SumUnrolled </td><td>  256 </td><td>  77.969 ู </td><td>  0.8409 ู </td><td>  0.7866 ู </td></tr><tr><td>  SumUnrolled </td><td>  512 </td><td>  146.357 ู </td><td>  1.3209 ู </td><td>  1.2356 ู </td></tr><tr><td>  SumUnrolled </td><td>  1024 </td><td>  287.354 ู </td><td>  0.9223 ู </td><td>  0.8627 ู </td></tr><tr><td>  SumUnrolled </td><td>  2048 </td><td>  566.405 ู </td><td>  4.0155 ู </td><td>  3.5596 ู </td></tr><tr><td>  SumUnrolled </td><td>  4096 </td><td>  1 131.016 ู </td><td>  7.3601 ู </td><td>  6.5246 ู </td></tr><tr><td>  SumUnrolled </td><td>  8192 </td><td>  2 259.836 ู </td><td>  8.6539 ู </td><td>  8.0949 ู </td></tr><tr><td>  SumUnrolled </td><td>  16384 </td><td>  4 501.295 ns </td><td>  6.4186 ู </td><td>  6.0040 ู </td></tr><tr><td>  SumUnrolled </td><td>  32768 </td><td>  8 979.690 ู </td><td>  19.5265 ู </td><td>  18.2651 ู </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/4b7/180/775/4b71807758bdae4be2fba1eb6af8360b.png"></p><br><h2 id="povyshenie-proizvoditelnosti-za-schet-vektorizacii-ciklov" style=";text-align:right;direction:rtl">  ุฒูุงุฏุฉ ุงูุฅูุชุงุฌูุฉ ูู ุฎูุงู vectorization ุญููุฉ </h2><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูุง ูุฏ ูููู ุ ูููู ูุง ูุฒุงู ุจุฅููุงููุง ุชุญุณูู ูุฐุง ุงูุฑูุฒ ููููุงู.  ุชุนุฏ ุฅุฑุดุงุฏุงุช SIMD ุฎูุงุฑูุง ุขุฎุฑ ูููุฑู ุงููุนุงูุฌุงุช ุงูุญุฏูุซุฉ ูุชุญุณูู ุงูุฃุฏุงุก.  ุจุงุณุชุฎุฏุงู ุชุนูููุฉ ูุงุญุฏุฉ ุ ุชุณูุญ ูู ุจุฅุฌุฑุงุก ุนุฏุฉ ุนูููุงุช ูู ุฏูุฑุฉ ุณุงุนุฉ ูุงุญุฏุฉ.  ูุฏ ูููู ูุฐุง ุฃูุถู ูู ุญููุฉ ูุจุงุดุฑุฉ ุชุชูุดู ุ ูุฃูู ูู ุงููุงูุน ุ ูุชู ุชูููุฐ ููุณ ุงูุดูุก ุ ูููู ูุน ูููุฉ ุฃูู ูู ุงูุดูุฑุฉ ุงูุชู ุชู ุฅูุดุงุคูุง. </p><br><p style=";text-align:right;direction:rtl">  ููุชูุถูุญ ุ ุชุฃุฎุฐ ูู ุนูููุฉ ุฅุถุงูุฉ ุ ูู ุฏูุฑุฉ ููุดูุฑุฉ ุ 4 ุจุงูุช.  ูุจุงูุชุงูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู 16 ุจุงูุช ูุฃุฑุจุน ุนูููุงุช ุฅุถุงูุฉ ูู ุงููููุฐุฌ ุงูููุณุน.  ูู ุงูููุช ููุณู ุ ูููู ุชุนูููุฉ ุฅุถุงูุฉ SIMD ุฃูุถูุง ุจุฅุฌุฑุงุก 4 ุนูููุงุช ุฅุถุงูุฉ ุ ูููููุง ูุง ุชุณุชุบุฑู ุณูู 4 ุจุงูุช.  ูุฐุง ูุนูู ุฃู ูุฏููุง ุชุนูููุงุช ุฃูู ููุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูู ุญุงูุฉ ูุฌูุฏ ุชุนูููุงุช SIMD ุ ูููู ููุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ <em>ุงูุชุฑุงุถุงุช</em> ูุชูููุฐ ุนูููุงุช ุชุญุณูู ุ ูููู ูุฐุง ุฎุงุฑุฌ ุนู ูุทุงู ูุฐู ุงูููุงูุฉ.  ูุงูุฃูุถู ูู ุฐูู ูู ุฃู ุงููุนุงูุฌุงุช ุงูุญุฏูุซุฉ ูููููุง ุชูููุฐ ุฃูุซุฑ ูู ุชุนูููุฉ SIMD ูู ููุช ูุงุญุฏ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ุจุนุถ ุงูุญุงูุงุช ุ ููููู ุชุทุจูู ุฅุณุชุฑุงุชูุฌูุฉ ูุฎุชูุทุฉ ุ ููู ููุณ ุงูููุช ุชููู ุจุฅุฌุฑุงุก ูุณุญ ุฌุฒุฆู ููุฏูุฑุฉ ูุชูุฌูููุง. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูุฌุจ ุฃู ุชุจุฏุฃ ูู ุฎูุงู ุงููุธุฑ ูู ูุฆุฉ <code>Vector&lt;T&gt;</code> ููุฃุบุฑุงุถ ุงูุนุงูุฉ ูููุงูู.  ุณูููู ุ ูุซู <em>WFs</em> ุงูุฌุฏูุฏ ุ ุจุชุถููู ุชุนูููุงุช SIMD ุ ูููู ูู ููุณ ุงูููุช ุ ูุธุฑูุง <em>ูุชุนุฏุฏ ุงุณุชุฎุฏุงูุงุช</em> ูุฐู ุงููุฆุฉ ุ ููููู ุชูููู ุนุฏุฏ ุงูุชุฑููุฒ "ุงููุฏูู". </p><br><p style=";text-align:right;direction:rtl">  ูุฏ ูุจุฏู ุงูุฑูุฒ ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public int SumVectorT(ReadOnlySpan&lt;int&gt; source) { int result = 0; Vector&lt;int&gt; vresult = Vector&lt;int&gt;.Zero; int i = 0; int lastBlockIndex = source.Length - (source.Length % Vector&lt;int&gt;.Count); while (i &lt; lastBlockIndex) { vresult += new Vector&lt;int&gt;(source.Slice(i)); i += Vector&lt;int&gt;.Count; } for (int n = 0; n &lt; Vector&lt;int&gt;.Count; n++) { result += vresult[n]; } while (i &lt; source.Length) { result += source[i]; i += 1; } return result; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุนูู ูุฐุง ุงูุฑูุฒ ุจุดูู ุฃุณุฑุน ุ ููููุง ูุถุทุฑูู ุฅูู ุงูุฑุฌูุน ุฅูู ูู ุนูุตุฑ ุนูู ุญุฏุฉ ุนูุฏ ุญุณุงุจ ุงููุจูุบ ุงูููุงุฆู.  ุฃูุถูุง ุ ูุง ูุญุชูู <code>Vector&lt;T&gt;</code> ุนูู ุญุฌู ูุญุฏุฏ ุจุฏูุฉ ุ ููุฏ ูุฎุชูู ุญุณุจ ุงูุฌูุงุฒ ุงูุฐู ูุนูู ุนููู ุงูุฑูุฒ.  ุชููุฑ <em>ุงููุธุงุฆู ุงููุฏูุฌุฉ ุงูุฎุงุตุฉ ุจุงูุฃุฌูุฒุฉ ูุธุงุฆู</em> ุฅุถุงููุฉ ูููููุง ุชุญุณูู ูุฐุง ุงูุฑูุฒ ููููุงู ูุฌุนูู ุฃุณุฑุน ููููุงู (ุนูู ุญุณุงุจ ูุชุทูุจุงุช ุงูุชุนููุฏ ูุงูุตูุงูุฉ ุงูุฅุถุงููุฉ ููุดูุฑุฉ). </p><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  ุทุฑููุฉ </th><th>  ุนุฏ </th><th>  ูุชูุณุท </th><th>  ุฎุทุฃ </th><th>  StdDev </th></tr></thead><tbody><tr><td>  SumVectorT </td><td>  1 </td><td>  4.517 ู </td><td>  0.0752 ู </td><td>  0.0703 ู </td></tr><tr><td>  SumVectorT </td><td>  2 </td><td>  4.853 ู </td><td>  0.0609 ู </td><td>  0.0570 ู </td></tr><tr><td>  SumVectorT </td><td>  4 </td><td>  5.047 ู </td><td>  0.0909 ู </td><td>  0.0850 ู </td></tr><tr><td>  SumVectorT </td><td>  8 </td><td>  5.671 ู </td><td>  0.0251 ู </td><td>  0.0223 ู </td></tr><tr><td>  SumVectorT </td><td>  16 </td><td>  6.579 ู </td><td>  0.0330 ู </td><td>  0.0276 ู </td></tr><tr><td>  SumVectorT </td><td>  32 </td><td>  10.460 ู </td><td>  0.0241 ู </td><td>  0.0226 ู </td></tr><tr><td>  SumVectorT </td><td>  64 </td><td>  17.148 ู </td><td>  0.0407 ู </td><td>  0.0381 ู </td></tr><tr><td>  SumVectorT </td><td>  128 </td><td>  23.239 ู </td><td>  0.0853 ู </td><td>  0.0756 ู </td></tr><tr><td>  SumVectorT </td><td>  256 </td><td>  62.146 ู </td><td>  0.8319 ู </td><td>  0.7782 ู </td></tr><tr><td>  SumVectorT </td><td>  512 </td><td>  114.863 ู </td><td>  0.4175 ู </td><td>  0.3906 ู </td></tr><tr><td>  SumVectorT </td><td>  1024 </td><td>  172.129 ู </td><td>  1.8673 ู </td><td>  1.7467 ู </td></tr><tr><td>  SumVectorT </td><td>  2048 </td><td>  429.722 ู </td><td>  1.0461 ู </td><td>  0.9786 ู </td></tr><tr><td>  SumVectorT </td><td>  4096 </td><td>  654.209 ู </td><td>  3.6215 ู </td><td>  3.0241 ู </td></tr><tr><td>  SumVectorT </td><td>  8192 </td><td>  1 675.046 ู </td><td>  14.5231 ู </td><td>  13.5849 ู </td></tr><tr><td>  SumVectorT </td><td>  16384 </td><td>  2 514.778 ู </td><td>  5.3369 ู </td><td>  4.9921 ู </td></tr><tr><td>  SumVectorT </td><td>  32768 </td><td>  6ุ689.829 ู </td><td>  13.9947 ู </td><td>  13.0906 ู </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/00e/0be/5d4/00e0be5d469067af095f34beccf8c45c.png"></p><br><p style=";text-align:right;direction:rtl">  <em>ููุงุญุธุฉ</em> ุจุงููุณุจุฉ ููุฐู ุงูููุงูุฉ ุ ููุช ุจููุฉ <code>COMPlus_SIMD16ByteOnly=1</code> ุญุฌู <code>Vector&lt;T&gt;</code> ุฅูู 16 ุจุงูุช ุจุงุณุชุฎุฏุงู ูุนููุฉ ุงูุชูููู ุงูุฏุงุฎูู ( <code>COMPlus_SIMD16ByteOnly=1</code> ).  <code>SumVectorT</code> ูุฐุง ุงููุฑุต ุงููุชุงุฆุฌ ุนูุฏ ููุงุฑูุฉ <code>SumVectorT</code> ูุน <code>SumVectorizedSse</code> ุ ูุณูุญ ููุง ุจุงูุญูุงุธ ุนูู ุงูููุฏ ุงูุจุณูุท.  ุนูู ูุฌู ุงูุฎุตูุต ุ ุชุฌูุจ ูุชุงุจุฉ ููุฒุฉ ูุดุฑูุทุฉ <code>if (Avx2.IsSupported) { }</code> .  ูุดุจู ูุฐุง ุงูุฑูุฒ ุชูุฑูุจูุง ุฑูุฒ <code>Sse2</code> ุ ูููู ูุชุนุงูู ูุน <code>Vector256&lt;T&gt;</code> (32 ุจุงูุช) ููุนุงูุฌ ุนูุงุตุฑ ุฃูุซุฑ ูู ุชูุฑุงุฑ ูุงุญุฏ ููุญููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ุจุงุณุชุฎุฏุงู <em>ุงููุธุงุฆู ุงููุฏูุฌุฉ</em> ุงูุฌุฏูุฏุฉ ุ ูููู ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูููุฏ ุนูู ุงููุญู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public int SumVectorized(ReadOnlySpan&lt;int&gt; source) { if (Sse2.IsSupported) { return SumVectorizedSse2(source); } else { return SumVectorT(source); } } public unsafe int SumVectorizedSse2(ReadOnlySpan&lt;int&gt; source) { int result; fixed (int* pSource = source) { Vector128&lt;int&gt; vresult = Vector128&lt;int&gt;.Zero; int i = 0; int lastBlockIndex = source.Length - (source.Length % 4); while (i &lt; lastBlockIndex) { vresult = Sse2.Add(vresult, Sse2.LoadVector128(pSource + i)); i += 4; } if (Ssse3.IsSupported) { vresult = Ssse3.HorizontalAdd(vresult, vresult); vresult = Ssse3.HorizontalAdd(vresult, vresult); } else { vresult = Sse2.Add(vresult, Sse2.Shuffle(vresult, 0x4E)); vresult = Sse2.Add(vresult, Sse2.Shuffle(vresult, 0xB1)); } result = vresult.ToScalar(); while (i &lt; source.Length) { result += pSource[i]; i += 1; } } return result; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ุงูุฑูุฒ ุ ูุฑุฉ ุฃุฎุฑู ุ ุฃูุซุฑ ุชุนููุฏูุง ุจุนุถ ุงูุดูุก ุ ูููู ุฃุณุฑุน ุจุดูู ูุจูุฑ ููุฌููุน ุจุงุณุชุซูุงุก ุฃุตุบุฑ ูุฌููุนุงุช ุงูุฅุฏุฎุงู.  ุจุงููุณุจุฉ ุฅูู 32 ุฃูู ุนูุตุฑ ุ ูุชู ุชูููุฐ ูุฐุง ุงูุฑูุฒ ุจูุณุจุฉ 75ูช ุฃุณุฑุน ูู ุงูุฏูุฑุฉ ุงูููุณุนุฉ ุ ู 81ูช ุฃุณุฑุน ูู ุดูุฑุฉ ุงููุตุฏุฑ ูููุซุงู. </p><br><p style=";text-align:right;direction:rtl">  ูุงุญุธุช ุฃููุง ูุชุจูุง ุจุนุถ ุงูุดููุงุช <code>IsSupported</code> .  ุฃูู ูุงุญุฏ ูุชุญูู ูุง ุฅุฐุง ูุงู ุงูุฌูุงุฒ ุงูุญุงูู ูุฏุนู ูุฌููุนุฉ <em>ุงููุธุงุฆู ุงููุฏูุฌุฉ</em> ุงููุทููุจุฉ ุ ุฅู ูู ููู ุ ุซู ูุชู ุชูููุฐ ุงูุชุญุณูู ูู ุฎูุงู ูุฌููุนุฉ ูู ุงูุงุฌุชูุงุญ ู <code>Vector&lt;T&gt;</code> .  ุณูุชู ุชุญุฏูุฏ ุงูุฎูุงุฑ ุงูุฃุฎูุฑ ููุฃูุธูุฉ ุงูุฃุณุงุณูุฉ ูุซู ARM / ARM64 ุงูุชู ูุง ุชุฏุนู ูุฌููุนุฉ ุงูุชุนูููุงุช ุงููุทููุจุฉ ุ ุฃู ุฅุฐุง ุชู ุชุนุทูู ุงููุฌููุนุฉ ูููุธุงู ุงูุฃุณุงุณู.  ูุชู <code>IsSupported</code> ุงุฎุชุจุงุฑ <code>IsSupported</code> ุงูุซุงูู ุ ูู ุทุฑููุฉ <code>SumVectorizedSse2</code> ุ ูุชุญุณูู ุฅุถุงูู ุฅุฐุง ูุงู ุงูุฌูุงุฒ ูุฏุนู <code>Ssse3</code> ุชุนูููุงุช <code>Ssse3</code> . </p><br><p style=";text-align:right;direction:rtl">  ุฎูุงู ุฐูู ุ ูุฅู ูุนุธู ุงูููุทู ูู ูู ุงูุฃุณุงุณ ููุณู ุจุงููุณุจุฉ ููุญููุฉ ุงูููุณุนุฉ.  <code>Vector128&lt;T&gt;</code> ูู ููุน 128 ุจุช ูุญุชูู ุนูู <code>Vector128&lt;T&gt;.Count</code> .  ูู ูุฐู ุงูุญุงูุฉ ุ ูููู ุฃู ูุญุชูู <code>uint</code> ุ ุงูุฐู ูุจูุบ 32 ุจุช ุ ุนูู 4 (128/32) ุ ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ุฃุทูููุง ุจูุง ุงูุญููุฉ. </p><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  ุทุฑููุฉ </th><th>  ุนุฏ </th><th>  ูุชูุณุท </th><th>  ุฎุทุฃ </th><th>  StdDev </th></tr></thead><tbody><tr><td>  SumVectorized </td><td>  1 </td><td>  4.555 ู </td><td>  0.0192 ู </td><td>  0.0179 ู </td></tr><tr><td>  SumVectorized </td><td>  2 </td><td>  4.848 ู </td><td>  0.0147 ู </td><td>  0.0137 ู </td></tr><tr><td>  SumVectorized </td><td>  4 </td><td>  5.381 ู </td><td>  0.0210 ู </td><td>  0.0186 ู </td></tr><tr><td>  SumVectorized </td><td>  8 </td><td>  4.838 ู </td><td>  0.0209 ู </td><td>  0.0186 ู </td></tr><tr><td>  SumVectorized </td><td>  16 </td><td>  5.107 ู </td><td>  0.0175 ู </td><td>  0.0146 ู </td></tr><tr><td>  SumVectorized </td><td>  32 </td><td>  5.646 ู </td><td>  0.0230 ู </td><td>  0.0204 ู </td></tr><tr><td>  SumVectorized </td><td>  64 </td><td>  6.763 ู </td><td>  0.0338 ู </td><td>  0.0316 ู </td></tr><tr><td>  SumVectorized </td><td>  128 </td><td>  9.308 ู </td><td>  0.1041 ู </td><td>  0.0870 ู </td></tr><tr><td>  SumVectorized </td><td>  256 </td><td>  15.634 ู </td><td>  0.0927 ู </td><td>  0.0821 ู </td></tr><tr><td>  SumVectorized </td><td>  512 </td><td>  34.706 ู </td><td>  0.2851 ู </td><td>  0.2381 ู </td></tr><tr><td>  SumVectorized </td><td>  1024 </td><td>  68.110 ู </td><td>  0.4016 ู </td><td>  0.3756 ู </td></tr><tr><td>  SumVectorized </td><td>  2048 </td><td>  136.533 ู </td><td>  1.3104 ู </td><td>  1.2257 ู </td></tr><tr><td>  SumVectorized </td><td>  4096 </td><td>  277.930 ู </td><td>  0.5913 ู </td><td>  0.5531 ู </td></tr><tr><td>  SumVectorized </td><td>  8192 </td><td>  554.720 ู </td><td>  3.5133 ู </td><td>  3.2864 ู </td></tr><tr><td>  SumVectorized </td><td>  16384 </td><td>  1 110.730 ู </td><td>  3.3043 ู </td><td>  3.0909 ู </td></tr><tr><td>  SumVectorized </td><td>  32768 </td><td>  2 200.996 ู </td><td>  21.0538 ู </td><td>  19.6938 ู </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/311/e70/320/311e7032050337fe946103244e749076.png"></p><br><h2 id="zaklyuchenie" style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h2><br><p style=";text-align:right;direction:rtl">  ุชููุญู <em>ุงููุธุงุฆู ุงููุฏูุฌุฉ</em> ุงูุฌุฏูุฏุฉ ูุฑุตุฉ ููุงุณุชูุงุฏุฉ ูู ูุธุงุฆู ุงูุฃุฌูุฒุฉ ุงูุฎุงุตุฉ ุจุงูุฌูุงุฒ ุงูุฐู ุชููู ุจุชุดุบูู ุงูุดูุฑุฉ ุนููู.  ููุงู ูุง ููุฑุจ ูู 1500 ูู ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูู X86 ู X64 ููุฒุนุฉ ุนูู 15 ูุฌููุนุฉ ุ ูููุงู ุงููุซูุฑ ููุง ูุฌุจ ูุตูู ูู ููุงู ูุงุญุฏ.  ูู ุฎูุงู ูุถุน ุฑูุฒ ููุชูุตูู ูุชุญุฏูุฏ ุงูุงุฎุชูุงูุงุช ุ ููููู ุชุญุฏูุฏ ุฌุฒุก ุงูููุฏ ุงูุฐู ูุณุชููุฏ ูู ุงููุชุฌูุงุช ููุฑุงูุจุฉ ุฃุฏุงุก ุฌูุฏ ุฌุฏูุง.  ููุงู ุงูุนุฏูุฏ ูู ุงูุณููุงุฑูููุงุช ุงูุชู ูููู ูููุง ุชุทุจูู vectorization ูุญููุฉ ุชุชูุดู ูุฌุฑุฏ ุงูุจุฏุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูุฃู ุดุฎุต ูุฑุบุจ ูู ุฑุคูุฉ ุงููุฒูุฏ ูู ุงูุฃูุซูุฉ ุงูุจุญุซ ุนู ุงุณุชุฎุฏุงู <em>ุงููุธุงุฆู ุงููุฏูุฌุฉ</em> ูู ุงูุฅุทุงุฑ (ุงูุธุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">dotnet</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">aspnet</a> ) ุ ุฃู ูู ููุงูุงุช ุงููุฌุชูุน ุงูุฃุฎุฑู.  ูุนูู ุงูุฑุบู ูู ุฃู <em>WFs</em> ุงูุญุงููุฉ ูุงุณุนุฉ ุ ููุง ูุฒุงู ููุงู ุงููุซูุฑ ูู ุงููุธุงุฆู ุงูุชู ูุฌุจ ุชูุฏูููุง.  ุฅุฐุง ูุงูุช ูุฏูู ุงููุธููุฉ ุงูุชู ุชุฑูุฏ ุชูุฏูููุง ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> ุชุชุฑุฏุฏ ูู ุชุณุฌูู ุทูุจ API ุงูุฎุงุต ุจู ุนุจุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">dotnet / corefx ุนูู GitHub</a> .  ูุชู ูุตู ุนูููุฉ ูุฑุงุฌุนุฉ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช (API) <a href="">ููุง</a> ูููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงู ุฌูุฏ</a> ุนูู ูุงูุจ ุทูุจ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงููุญุฏุฏ ูู ุงูุฎุทูุฉ 1. </p><br><h2 id="osobye-blagodarnosti" style=";text-align:right;direction:rtl">  ุดูุฑ ุฎุงุต </h2><br><p style=";text-align:right;direction:rtl">  ุฃูุฏ ุฃู ุฃุนุฑุจ ุนู ุงูุชูุงูู ุงูุฎุงุต ูุฃุนุถุงุก ูุฌุชูุนูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Fei Peng (fiigii)</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Jacek Blaszczynski (@ 4creators)</a> ููุณุงุนุฏุชูู ูู ุชูููุฐ <em>WF</em> ุ ููุฐูู ูุฌููุน ุฃุนุถุงุก ุงููุฌุชูุน ุนูู ุชุนูููุงุชูู ุงููููุฉ ูููุง ูุชุนูู ุจุชุทููุฑ ูุฐู ุงููุธููุฉ ูุชูููุฐูุง ูุณูููุฉ ุงุณุชุฎุฏุงููุง. </p><br><hr><br><h3 id="posleslovie-k-perevodu" style=";text-align:right;direction:rtl">  ุงููููุฉ ุงูุฃุฎูุฑุฉ ููุชุฑุฌูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุฃุฑุบุจ ูู ููุงุญุธุฉ ุชุทูุฑ ูุธุงู .NET ุ ูุจุดูู ุฎุงุต ูุบุฉ C #.  ููุช ูุงุฏููุง ูู ุนุงูู C ++ ุ ููุฏู ุฎุจุฑุฉ ููููุฉ ูู ุงูุชุทููุฑ ูู Delphi ู Java ุ ูููุช ูุฑุชุงุญูุง ุฌุฏูุง ูุจุฏุก ุจุฑุงูุฌ ุงููุชุงุจุฉ ูู C #.  ูู ุนุงู 2006 ุ ุจุฏุง ูู ุฃู ูุบุฉ ุงูุจุฑูุฌุฉ ูุฐู (ููู ุงููุบุฉ) ุฃูุซุฑ ุฅูุฌุงุฒูุง ูุนููููุง ูู Java ูู ุนุงูู ุฌูุน ุงูููุงูุฉ ุงูููุฏุงุฑ ูููุตุฉ ูุดุชุฑูุฉ.  ูุฐูู ุ ุณูุทุช ุฎูุงุฑู ุนูู C # ุ ูุฃูุง ูุณุช ูุงุฏูุง ุนูู ุฐูู.  ุงููุฑุญูุฉ ุงูุฃููู ูู ุชุทูุฑ ุงููุบุฉ ูุงูุช ุจุจุณุงุทุฉ ุธููุฑูุง.  ุจุญููู ุนุงู 2006 ุ ุงุณุชูุนุจุช C # ุฃูุถู ูุง ูุงู ูู ุฐูู ุงูููุช ุจุฃูุถู ุงููุบุงุช ูุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ: C ++ / Java / Delphi.  ูู ุนุงู 2010 ุ ุฃุตุจุญุช F # ุนุงูุฉ.  ููุฏ ูุงูุช ููุตุฉ ุชุฌุฑูุจูุฉ ูุฏุฑุงุณุฉ ุงููููุฐุฌ ุงููุธููู ุจูุฏู ุฅุฏุฎุงูู ูู ุนุงูู .NET.  ูุงูุช ูุชูุฌุฉ ุงูุชุฌุงุฑุจ ูู ุงููุฑุญูุฉ ุงูุชุงููุฉ ูู ุชุทูุฑ C # - ุชูุณูุน ูุฏุฑุงุชูุง ูุญู FP ุ ูู ุฎูุงู ุฅุฏุฎุงู ูุธุงุฆู ูุฌูููุฉ ุงููููุฉ ุ ูุชุนุจูุฑุงุช lambda ุ ููู ููุงูุฉ ุงููุทุงู ุ LINQ.  ุฌุนู ุงูุชุฏุงุฏ ุงููุบุฉ ูุฐุง ูุบุฉ C # ุงูุฃูุซุฑ ุชูุฏููุง ุ ูู ูุฌูุฉ ูุธุฑู ุ ูุบุฉ ุงูุฃุบุฑุงุถ ุงูุนุงูุฉ.  ูุงูุช ุงูุฎุทูุฉ ุงูุชุทูุฑูุฉ ุงูุชุงููุฉ ูุฑุชุจุทุฉ ุจุฏุนู ุงูุชุฒุงูู ูุงูุชุฒุงูู.  ุงููููุฉ / ุงููููุฉ &lt;T&gt; ุ ููููู TPL ุจุงููุงูู ุ ุชุทููุฑ LINQ - PLINQ ุ ูุฃุฎูุฑุงู ุ ุงูุชุฒุงูู / ุงูุงูุชุธุงุฑ.  ,   - ,       .NET   C# โ      .    Span&lt;T&gt;  Memory&lt;T&gt;, ValueTask/ValueTask&lt;T&gt;, IAsyncDispose, ref readonly struct   in,  foreach, IO.Streams.         GC    .   ,       โ       .  ,     .NET   C#,  ,          .   (       )         . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar467663/">https://habr.com/ru/post/ar467663/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar467653/index.html">Habrastatistics: ุชุญููู ุชุนูููุงุช ุงููุงุฑุฆ</a></li>
<li><a href="../ar467655/index.html">ููู ูุถูุช ุงูุตูู ูุน ุฌูู # 8</a></li>
<li><a href="../ar467657/index.html">ุฌุฑุฏ ูู I ุฅูู Z. ูุนูู ุชุฑุงุฎูุต ุงูุจุฑูุงูุฌ</a></li>
<li><a href="../ar467659/index.html">ุชุณุฑูุน ุชูููุฐ ุงูููุงู ุจุดูู ูุจูุฑ ูู ุฎูุงู ูุซุงู ุงูุชูููู ุงูุฅุถุงูู ูุฐุงูุฑุฉ HyperX FURY DDR4 ุงููุญุฏุซุฉ</a></li>
<li><a href="../ar467661/index.html">ุงูุฌุฑุนุงุช ู Seryozha. ุงูุฌุฒุก ุงูุฃูู. Polimaster - ุงูุตูุงุฏูู ุงููููู</a></li>
<li><a href="../ar467665/index.html">ุนุฑุจุฉ ุดุงุญูุฉ ROS. ุงูุฌุฒุก 5. ุงูุนูู ูู rviz ูุดุฑูุฉ: xacro ุ ูุฃุฌูุฒุฉ ุงุณุชุดุนุงุฑ ุฌุฏูุฏุฉ</a></li>
<li><a href="../ar467667/index.html">ุชุฎุทูุท ุงููุดุฑูุน ุงูุชูุธููู (ุงูุฌุฒุก 4)</a></li>
<li><a href="../ar467669/index.html">ุดุงูุฏูู ุจุงููุงูู: ุงุถุบุท ุนูู ุงูููุฏูููุงุช ุนูู ููุตุงุช ุงูุฌููุงู ุนูู ุฃููู ูุฌู</a></li>
<li><a href="../ar467671/index.html">NLX ุงูููุจููุชุฑ ุงูุฑุฌุนูุฉ</a></li>
<li><a href="../ar467673/index.html">ุงููุฏูุฌ ูู ููุฒุงุช ุงูุฐูุงุจ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>