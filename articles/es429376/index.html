<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëêüèº üóÑÔ∏è üåßÔ∏è Ahorro como API REST üàØÔ∏è üçÆ üë≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un breve art√≠culo sobre c√≥mo nos encontramos con problemas de sincronizaci√≥n de trabajo entre los equipos de desarrollo de clientes y servidores. C√≥mo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ahorro como API REST</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429376/"> Un breve art√≠culo sobre c√≥mo nos encontramos con problemas de sincronizaci√≥n de trabajo entre los equipos de desarrollo de clientes y servidores.  C√≥mo conectamos Thrift para simplificar la interacci√≥n entre nuestros equipos. <br><br>  A qui√©n le importa c√≥mo lo hicimos, y qu√© efectos "secundarios" detectamos, mira debajo del gato. <br><a name="habracut"></a><br><h4>  Antecedentes </h4><br>  A principios de 2017, cuando comenzamos un nuevo proyecto, elegimos EmberJS como la interfaz.  Lo cual, casi autom√°ticamente nos llev√≥ a trabajar en el esquema REST al organizar la interacci√≥n de las partes cliente y servidor de la aplicaci√≥n.  Porque  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">EmberData</a> proporciona una herramienta conveniente para separar el trabajo de los comandos backend y frontend, y el uso del Adaptador le permite seleccionar el "protocolo" de interacci√≥n. <br><br>  Al principio, todo est√° bien: Ember nos brind√≥ la capacidad de implementar la emulaci√≥n de las solicitudes del servidor.  Los datos para emular modelos de servidor se colocaron en archivos de archivos separados.  Si, en alg√∫n lugar, comenzamos a trabajar sin usar Ember Data, Ember le permite escribir un emulador de controlador de punto final cercano y devolver estos datos.  Acordamos que los desarrolladores de backend deber√≠an realizar cambios en estos archivos para mantener los datos actualizados para que los desarrolladores frontend funcionen correctamente.  Pero, como siempre, cuando todo se basa en "acuerdos" (y no hay una herramienta para verificarlos), llega un momento en que "algo va mal". <br>  Los nuevos requisitos condujeron no solo a la aparici√≥n de nuevos datos en el cliente, sino tambi√©n a la actualizaci√≥n del antiguo modelo de datos.  Lo que al final condujo al hecho de que mantener la sincronizaci√≥n de modelos en el servidor y su emulaci√≥n en los archivos fuente del cliente se volvi√≥ simplemente costoso.  Ahora, el desarrollo de la parte del cliente, como regla, comienza despu√©s de que el c√≥digo auxiliar del servidor est√© listo.  Y el desarrollo se lleva a cabo sobre el servidor de producci√≥n, y esto complica el trabajo en equipo y aumenta el tiempo de lanzamiento de la nueva funcionalidad. <br><br><h4>  Desarrollo del proyecto </h4><br>  Ahora estamos abandonando EmberJS a favor de VueJS.  y como parte de la decisi√≥n sobre migraci√≥n, comenzamos a buscar soluciones a este problema.  Se desarrollaron los siguientes criterios: <br><br><ul><li>  Compatibilidad con versiones anteriores y nuevas del protocolo. </li><li>  M√°xima comodidad para los desarrolladores frontend cuando trabajan "sin un servidor" </li><li>  Separaci√≥n de la descripci√≥n de la API de los datos de prueba </li><li>  F√°cil sincronizaci√≥n de firma de llamada <ul><li>  descripci√≥n clara de la firma </li><li>  facilidad de modificaci√≥n por parte de los desarrolladores frontend y backend </li><li>  m√°xima autonom√≠a </li></ul></li><li>  Las API fuertemente tipadas son deseables.  Es decir  La detecci√≥n m√°s r√°pida de un hecho de un cambio de protocolo </li><li>  Facilidad para probar la l√≥gica del servidor </li><li>  Integraci√≥n con Spring en el lado del servidor sin bailar con panderetas. </li></ul><br><h4>  Implementaci√≥n </h4><br>  Despu√©s de pensar, se decidi√≥ parar en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Thrift</a> .  Esto nos dio un lenguaje de descripci√≥n API simple y claro. <br><br><pre><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> java ru.company.api <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> php ru.company.api <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> javascrip ru.company.api <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> DIRECTORY_SERVICE= <span class="hljs-string"><span class="hljs-string">"directoryService"</span></span> exception ObjectNotFoundException{ } struct AdvBreed { <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> id, <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name, <span class="hljs-number"><span class="hljs-number">3</span></span>: optional <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> title } service DirectoryService { <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;AdvBreed&gt; loadBreeds() AdsBreed getAdvBreedById(<span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> id) }</code> </pre> <br>  Para la interacci√≥n, utilizamos TMultiplexedProcessor, accesible a trav√©s de TServlet, utilizando TJSONProtocol.  Tuve que bailar un poco para que este Thrift se integrara perfectamente con Spring.  Para hacer esto, tuve que crear y registrar un Servlet en ServletContainer mediante programaci√≥n. <br><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThriftRegister</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ApplicationContextAware</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ServletContextAware { companion object { private const val unsecureAreaUrlPattern = "/api/v2/thrift-ns" private const val secureAreaUrlPattern = "/api/v2/thrift" } private var inited = false private lateinit var appContext:ApplicationContext private lateinit var servletContext:ServletContext override fun onApplicationEvent</span></span></span></span>(event: ContextRefreshedEvent) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!inited) { initServletsAndFilters() inited = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initServletsAndFilters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { registerOpenAreaServletAndFilter() registerSecureAreaServletAndFilter() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerSecureAreaServletAndFilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { registerServletAndFilter(SecureAreaServlet::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SecureAreaThriftFilter::class.java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">secureAreaUrlPattern) } private fun registerOpenAreaServletAndFilter</span></span></span></span>() { registerServletAndFilter(UnsecureAreaServlet::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UnsecureAreaThriftFilter::class.java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">unsecureAreaUrlPattern) } private fun registerServletAndFilter</span></span></span></span>(servletClass:Class&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Servlet&gt;, filterClass:Class&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Filter&gt;, pattern:String) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> servletBean = appContext.getBean(servletClass) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> addServlet = servletContext.addServlet(servletClass.simpleName, servletBean) addServlet.setLoadOnStartup(<span class="hljs-number"><span class="hljs-number">1</span></span>) addServlet.addMapping(pattern) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> filterBean = appContext.getBean(filterClass) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> addFilter = servletContext.addFilter(filterClass.simpleName, filterBean) addFilter.addMappingForUrlPatterns(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, pattern) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setApplicationContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(applicationContext: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ApplicationContext</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { appContext = applicationContext } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setServletContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ServletContext</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.servletContext = context } }</code> </pre> <br>  Lo que debe notarse aqu√≠.  En este c√≥digo, se forman dos √°reas de servicio.  Protegido, que est√° disponible en la direcci√≥n "/ api / v2 / thrift".  Y abierto, disponible en "/ api / v2 / thrift-ns".  Para estas √°reas, se utilizan diferentes filtros.  En el primer caso, al acceder al servicio mediante cookies, se forma un objeto que define al usuario que realiza la llamada.  Si es imposible formar dicho objeto, se produce un error 401, que se procesa correctamente en el lado del cliente.  En el segundo caso, el filtro omite todas las solicitudes del servicio, y si determina que se ha producido la autorizaci√≥n, luego de que se completa la operaci√≥n, llena las cookies con la informaci√≥n necesaria para que pueda realizar solicitudes al √°rea protegida. <br><br>  Para conectar un nuevo servicio, debe escribir un peque√±o c√≥digo adicional. <br><br><pre> <code class="hljs delphi">@Component <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> DirectoryServiceProcessor @Autowired <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler: DirectoryService.Iface)</span></span></span><span class="hljs-function">:</span></span> DirectoryService.Processor&lt;DirectoryService.Iface&gt;(handler)</code> </pre> <br>  Y registre el procesador <br><br><pre> <code class="hljs delphi">@Component <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> SecureMultiplexingProcessor @Autowired <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dsProcessor: DirectoryServiceProcessor)</span></span></span><span class="hljs-function"> :</span></span> TMultiplexedProcessor() <span class="hljs-comment"><span class="hljs-comment">{ init { this.registerProcessor(DIRECTORY_SERVICE, dsProcessor) ... }</span></span> }</code> </pre> <br>  La √∫ltima parte del c√≥digo puede simplificarse colgando una interfaz adicional en todos los procesadores, lo que le permitir√° obtener de inmediato una lista de procesadores con un par√°metro de dise√±o, y haberle dado la responsabilidad del valor de la clave de acceso al procesador al procesador mismo. <br><br>  El trabajo en el modo "sin servidor" ha sufrido un peque√±o cambio.  Los desarrolladores de la parte frontend hicieron una propuesta de que trabajar√≠an en un servidor stub de PHP.  Ellos mismos generan clases para su servidor que implementan la firma para la versi√≥n de protocolo deseada.  E implementan un servidor con el conjunto de datos necesario.  Todo esto les permite trabajar antes de que los desarrolladores del lado del servidor terminen su trabajo. <br><br>  El principal punto de procesamiento en el lado del cliente es el plugin de ahorro escrito por nosotros. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> store <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../store'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { UNAUTHORIZED } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../store/actions/auth'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> thrift = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'thrift'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { install (Vue, options) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DirectoryService = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./gen-nodejs/DirectoryService'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> _options = { <span class="hljs-attr"><span class="hljs-attr">transport</span></span>: thrift.TBufferedTransport, <span class="hljs-attr"><span class="hljs-attr">protocol</span></span>: thrift.TJSONProtocol, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/api/v2/thrift'</span></span>, <span class="hljs-attr"><span class="hljs-attr">https</span></span>: location.protocol === <span class="hljs-string"><span class="hljs-string">'https:'</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> _optionsOpen = { ... } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> XHRConnectionError = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_status</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_status === <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_status &gt;= <span class="hljs-number"><span class="hljs-number">400</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_status === <span class="hljs-number"><span class="hljs-number">401</span></span>) { store.dispatch(UNAUTHORIZED) } ... } } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bufers = {} thrift.XHRConnection.prototype.flush = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url === <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xreq = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getXmlHttpRequestObject() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xreq.overrideMimeType) { xreq.overrideMimeType(<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>) } xreq.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.readyState === <span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status === <span class="hljs-number"><span class="hljs-number">200</span></span>) { self.setRecvBuffer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status === <span class="hljs-number"><span class="hljs-number">404</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status &gt;= <span class="hljs-number"><span class="hljs-number">500</span></span>) {... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {... } } } } xreq.open(<span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.headers).forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">headerKey</span></span></span><span class="hljs-function">) </span></span>{ xreq.setRequestHeader(headerKey, self.headers[headerKey]) }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sendBuf = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf) bufers[sendBuf[<span class="hljs-number"><span class="hljs-number">3</span></span>]] = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf xreq.seqid = sendBuf[<span class="hljs-number"><span class="hljs-number">3</span></span>] } xreq.send(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf) } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> thrift.Multiplexer() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connectionHostName = process.env.THRIFT_HOST ? process.env.THRIFT_HOST : location.hostname <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connectionPort = process.env.THRIFT_PORT ? process.env.THRIFT_PORT : location.port <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connection = thrift.createXHRConnection(connectionHostName, connectionPort, _options) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connectionOpen = thrift.createXHRConnection(connectionHostName, connectionPort, _optionsOpen) Vue.prototype.$ThriftPlugin = { <span class="hljs-attr"><span class="hljs-attr">DirectoryService</span></span>: mp.createClient(<span class="hljs-string"><span class="hljs-string">'directoryService'</span></span>, DirectoryService, connectionOpen), } } }</code> </pre> <br>  Para que este complemento funcione correctamente, debe conectar las clases generadas. <br><br>  Los m√©todos de llamada al servidor en el cliente son los siguientes: <br><br><pre> <code class="javascript hljs">thriftPlugin.DirectoryService.loadBreeds() .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_response</span></span></span><span class="hljs-function"> =&gt;</span></span> { ... }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { ... }) })</code> </pre><br>  Aqu√≠ no profundizo en las caracter√≠sticas de VueJS, donde es correcto mantener el c√≥digo que llama al servidor.  Este c√≥digo se puede usar tanto dentro del componente como dentro de la ruta y dentro de Vuex-action. <br>  Al trabajar con el lado del cliente, hay un par de limitaciones que deben tenerse en cuenta despu√©s de la migraci√≥n mental desde la integraci√≥n interna de ahorro. <br><br><ul><li>  El cliente Javascript no reconoce valores nulos.  Por lo tanto, para los campos que pueden ser nulos, debe especificar el indicador opcional.  En este caso, el cliente aceptar√° correctamente este valor. </li><li>  Javascript no sabe c√≥mo trabajar con valores largos, por lo que todos los identificadores enteros deben convertirse en una cadena en el lado del servidor </li></ul><br><h4>  Conclusiones </h4><br>  La transici√≥n a Thrift nos permiti√≥ resolver los problemas que est√°n presentes en la interacci√≥n entre el desarrollo del servidor y el cliente cuando se trabaja en una versi√≥n anterior de la interfaz.  Se permite hacer posible el procesamiento de errores globales en un solo lugar. <br><br>  Al mismo tiempo, con una bonificaci√≥n adicional, debido a la estricta tipificaci√≥n de la API y, por lo tanto, a las estrictas reglas de serializaci√≥n / deserializaci√≥n de datos, recibimos un aumento de ~ 30% en el tiempo de interacci√≥n en el cliente y el servidor para la mayor√≠a de las solicitudes (al comparar las mismas solicitudes a trav√©s de la interacci√≥n REST y THRIFT, desde el momento en que se envi√≥ la solicitud al servidor hasta que se recibe la respuesta) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429376/">https://habr.com/ru/post/es429376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429362/index.html">Aprendizaje autom√°tico malicioso como m√©todo de diagn√≥stico</a></li>
<li><a href="../es429364/index.html">Silicon Valley comienza a formar un consenso sombr√≠o sobre ni√±os y pantallas</a></li>
<li><a href="../es429366/index.html">C√≥mo hacer una m√°quina del tiempo para la radio</a></li>
<li><a href="../es429368/index.html">Esperas demasiado de los robots de Boston Dynamics</a></li>
<li><a href="../es429370/index.html">C√≥mo funciona Night Sight de Google en los tel√©fonos y por qu√© funciona tan bien</a></li>
<li><a href="../es429380/index.html">Para reemplazar TCP: QUIC est√° listo para la implementaci√≥n [pero no est√° listo para convertirse en RFC]</a></li>
<li><a href="../es429382/index.html">De Alibaba a Pyaterochka: qui√©n y c√≥mo usa el sistema de reconocimiento facial en los negocios</a></li>
<li><a href="../es429384/index.html">Componentes de bicicletas el√©ctricas: motor</a></li>
<li><a href="../es429386/index.html">El proveedor de AT&T se convierte en el mayor titular de derechos de autor y comenzar√° a desconectar a los usuarios acusados ‚Äã‚Äãde pirater√≠a</a></li>
<li><a href="../es429388/index.html">C√≥mo hacer un redise√±o de un sitio web y no crear problemas: 4 pasos importantes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>