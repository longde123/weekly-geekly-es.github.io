<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé¨ üßîüèª üéì Wachsame Lida: Automatisierung von Sicherheitstests üë®‚Äçüëß‚Äçüë¶ ü¶à üö¥üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guten Tag, liebe Leser. Mein Name ist Victor Burov, ich bin Entwickler bei ISPsystem. Im letzten Beitrag habe ich √ºber das Tool zum Erstellen von Auto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wachsame Lida: Automatisierung von Sicherheitstests</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ispsystem/blog/426969/">  Guten Tag, liebe Leser.  Mein Name ist Victor Burov, ich bin Entwickler bei ISPsystem.  Im letzten Beitrag habe ich √ºber das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tool zum Erstellen von Autotests gesprochen</a> . Heute werde ich meine Erfahrungen bei der Automatisierung von Sicherheitstests teilen. <br><br><img src="https://habrastorage.org/webt/9t/xm/uy/9txmuy_rzmrhxjp0mbe4hfobvq8.jpeg"><br><br>  Zun√§chst wurden Schwachstellen in Produkten von einem separaten Mitarbeiter durchsucht.  Manuelle Tests nahmen viel Zeit in Anspruch und garantierten nicht, dass alle Schwachstellen gefunden wurden.  Nachdem wir die Grundgesetze des Testens ermittelt hatten, kamen wir zu dem Schluss, dass es automatisiert werden kann.  Dann haben wir uns entschlossen, ein Dienstprogramm zu schreiben, das dem Tester das Leben erleichtert, ihm Zeit spart und es Ihnen erm√∂glicht, die Produkte nach jeder √Ñnderung zu √ºberpr√ºfen.  Da der Tester Lida hie√ü, haben wir die neue Anwendung zu ihren Ehren benannt.  Im Allgemeinen ist es in unserem Unternehmen zur Tradition geworden, Testwerkzeuge mit den Namen von Testern zu bezeichnen. <br><a name="habracut"></a><br>  Nach der Analyse der Dienstprogramme zur Suche nach Sicherheitsl√ºcken kam ich zu dem Schluss, dass alle die aufzurufenden Funktionen und die verwendeten Parameter angeben m√ºssen.  Wir haben uns erneut entschlossen, die einheitliche Schnittstelle zu nutzen und die Anforderungen f√ºr Lida zu formulieren. <br><br><h4>  Startvoraussetzungen: </h4><br><ol><li>  Funktionslisten automatisch erstellen. </li><li>  Optionen f√ºr die automatische Vervollst√§ndigung. </li><li>  API-Anfragen stellen. </li><li>  Analyse der Datenausgabe nach Ausf√ºhrung von Funktionen. </li><li>  Suchen Sie nach Schwachstellen in Daten. </li><li>  Erstellung von Berichten. </li><li>  Flexible Einstellungen. </li></ol><br>  All dies zu realisieren war nicht einfach. <br><br><h2>  Implementierung </h2><br><h3>  Formulare und Listen umgehen </h3><br>  Um Schwachstellen in einer Funktion zu finden, muss diese ausgef√ºhrt werden, indem die erforderlichen Parameter √ºbergeben werden.  Unsere Schnittstelle basiert auf Listen und Formularen, sodass Sie die Datenerfassung automatisieren k√∂nnen, indem Sie XML-Dokumente verarbeiten, die die Struktur der Schnittstellenelemente beschreiben. <br><br>  Ich beschloss, den Crawl √ºber das Hauptmen√º zu starten und rekursiv in alle verschachtelten Listen zu gehen.  "Lida" √∂ffnet die Liste der ersten Ebene.  In der Regel verf√ºgt es √ºber mehrere Schaltfl√§chen, die einige Funktionen aufrufen. <br><br>  Wenn die Schaltfl√§che das Formular √∂ffnet, ist das Ergebnis des Aufrufs ein XML-Dokument mit Knoten, die Informationen zu den Feldern enthalten: Name, Validator, Bereich g√ºltiger Werte.  Basierend auf diesen Informationen werden Feldwerte generiert.  Beispielsweise wird eine Nummer f√ºr int generiert.  Wenn kein Validator vorhanden ist, wird eine zuf√§llige Zeichenfolge generiert.  Nach dem Ausf√ºllen aller Felder des Formulars wird eine Anfrage gesendet. <br><br>  Wenn es sich bei der Funktion um eine Liste handelt, wird sie ge√∂ffnet und die mit den Schaltfl√§chen verkn√ºpften Funktionen werden f√ºr ihre Elemente aufgerufen. <br><br>  Beim √úberpr√ºfen von Listen tritt ein Problem auf: Alle Listen m√ºssen √ºber eine Reihe von Datens√§tzen verf√ºgen, die sicherstellen, dass alle Schaltfl√§chen in der Liste anklickbar sind. <br><br><h3>  SQL-Injection-Suche </h3><br>  Die SQL-Injection ist wahrscheinlich eines der h√§ufigsten Probleme f√ºr Anwendungen, einschlie√ülich unserer.  Viele Funktionsaufrufe generieren verschiedene DBMS-Abfragen.  Ein Fehler tritt auf, wenn Parameter, die von au√üen kommen, "wie sie sind" in den Anforderungshauptteil eingesetzt werden.  Die Folgen solcher Fehler k√∂nnen traurig sein: vom unbefugten Empfang von Daten bis zum L√∂schen von Tabellen. <br><br>  Um die Suche nach SQL-Injektionen zu starten, habe ich die Ausgabe aller SQL-Abfragen in einer Datei organisiert.  Nachdem die Funktion ausgef√ºhrt wurde, sucht die Anwendung in den resultierenden SQL-Abfragen nach den Werten der √ºbergebenen Parameter. <br><br>  <i>Sie k√∂nnen das Protokoll des SQL Servers selbst verwenden.</i>  <i>In unserem Fall gibt es jedoch nur eine Methode zum Ausf√ºhren von Abfragen, und das Hinzuf√ºgen von Protokollierung war nicht schwierig.</i>  <i>Dank dessen wissen wir genau, welche Herausforderung diese oder jene Anfrage ausgel√∂st hat.</i> <br><br>  Wenn der Wert des √ºbergebenen Parameters gefunden wird, √ºbergibt das Dienstprogramm einen Wert mit einem einfachen Anf√ºhrungszeichen an diesen Parameter.  Wenn das Anf√ºhrungszeichen in derselben Reihenfolge gefunden wird, wird der Parameter nicht maskiert - wir haben einen Platz f√ºr die SQL-Injection gefunden. <br><br><h3>  Systemaufrufanalyse </h3><br>  Ein √§hnliches Problem tritt auf, wenn wir Systemaufrufe t√§tigen.  Ich entschied mich, sie mit Strace zu suchen und w√§hlte die optimalen Startparameter daf√ºr aus.  Beispiel f√ºr den Start von ISPmanager: <br><br><pre><code class="xml hljs">strace -f -s 1024 -e trace=file,process bin/core ispmgr</code> </pre> <br>  Neben SQL-Injections f√ºhrt Lida eine Funktion aus und analysiert die Strace-Ausgabe, um festzustellen, ob die Werte der Parameter <i>open, unlink, rmdir, chmod chown, chflags, mknod, mkfifo, fcntl, symlink, link, execve, mkdir enthalten sind</i> . <br><br>  Wenn der Parameter gefunden wird, √ºbergibt das Dienstprogramm einen Wert an ihn, der beispielsweise einen Pfad mit einem √úbergang zum obigen Verzeichnis enth√§lt.  Wenn es so wird, wie es ist, wird eine potenzielle Sicherheitsl√ºcke gefunden. <br><br>  Die Analyse der Execve-Funktion hat sich als sehr n√ºtzlich erwiesen.  Hier k√∂nnen Sie bestimmen, in welchen Funktionsargumenten ausf√ºhrbare Dateien nicht maskiert werden sollen.  Dieser Fehler ist sehr teuer, da Sie dadurch durch einfaches √Ñndern des Kennworts Root-Zugriff auf den Server erhalten k√∂nnen. <br><br><blockquote>  Wenn Benutzer eine Sicherheitsl√ºcke in unseren Produkten finden, zahlt das Unternehmen eine Geldpr√§mie, deren H√∂he von der Kategorie der Sicherheitsl√ºcke abh√§ngt.  Dieser Ansatz kann billiger sein als die eigene Suche nach Fehlern (der Tester findet den Fehler m√∂glicherweise nicht und erh√§lt ein Gehalt). </blockquote><br>  <i>Ein weiterer interessanter Test: √úberpr√ºfen der Reihenfolge des Aufrufs der stat-Funktionen und anderer.</i>  <i>Oft wird der Zugriff zuerst durch stat und dann durch einige unsichere Aktionen √ºberpr√ºft, wodurch die M√∂glichkeit einer Substitution besteht.</i>  <i>Dies haben wir jedoch nicht automatisiert.</i> <br><br><h3>  √úberpr√ºfen des Zugriffs auf Fremdk√∂rper </h3><br>  Wir √ºberpr√ºfen den Zugriff auf Fremdk√∂rper unter dem Benutzer auf die Entit√§ten eines anderen Benutzers und Administrators.  In diesem Modus √ºberpr√ºfen wir die F√§higkeit, die Listen der Elemente eines fremden Benutzers zu lesen, zu √§ndern und anzuzeigen. <br><br>  Lida umgeht alle Funktionen, die im Namen des Eigent√ºmers oder Administrators verf√ºgbar sind, und merkt sich deren Elemente.  Dann ruft es die gleichen Funktionen mit Elementen unter einem anderen Benutzer auf.  Im Idealfall sollte die Antwort ein Fehler wie "Zugriff" oder "Verpasst" sein.  Wenn ein solcher Fehler nicht empfangen wird, ist es sehr wahrscheinlich, dass Sie die Daten eines anderen Benutzers lesen k√∂nnen. <br><br>  In einigen F√§llen bedeutet das Fehlen eines Fehlers nicht, dass Sie direkt auf die Objekte anderer Benutzer zugreifen k√∂nnen.  Zu Beginn solcher Funktionen f√ºgen wir eine Elementberechtigungspr√ºfung hinzu.  Dies √ºberpr√ºft nicht nur die Sicherheit, sondern auch die Richtigkeit der Serverantworten. <br><br><h3>  API-Validierung </h3><br>  Die Validierung unserer API ist ein zus√§tzlicher Bonus f√ºr die √úberpr√ºfung von Funktionen auf Schwachstellen.  Bei der Analyse von Berichten √ºber die Arbeit von Lida haben wir gelernt, die richtigen Fehlertypen zur√ºckzugeben, und unsere API komfortabler und logischer gestaltet.  Infolgedessen haben wir wie beim Kassettenrekorder nicht nur eine Sicherheits√ºberpr√ºfung erhalten, sondern auch unsere API erneut auf ‚ÄûKonsistenz‚Äú √ºberpr√ºft. <br><br><h2>  Schwierigkeiten </h2><br><h4>  False Positives </h4><br>  Das Dienstprogramm kann mit allen unseren Produkten arbeiten und √ºberpr√ºft daher viele verschiedene Funktionen.  Grunds√§tzlich wurden bei der √úberpr√ºfung des Zugriffs auf Fremdk√∂rper falsch positive Ergebnisse angezeigt.  Dies liegt an den Merkmalen der Tasten und Funktionen. <br><br>  False Positives waren Lidas gr√∂√ütes Problem.  Es schien, dass es vollst√§ndig debuggt war, aber bei der √úberpr√ºfung auf verschiedenen Panels traten neue Fehlalarme auf.  Infolgedessen gab es mehrere Stufen ihrer Korrektur. <br><br><h4>  Entit√§tserstellung </h4><br>  Die meisten Aktionen im Bedienfeld werden f√ºr eine beliebige Entit√§t (Dom√§nenname, Datenbank usw.) ausgef√ºhrt.  Um eine maximale Automatisierung zu erreichen, musste Lida diese Entit√§ten automatisch erstellen.  In der Praxis erwies sich dies jedoch als schwierig umzusetzen.  Manchmal wird die Validierung im Code durchgef√ºhrt, sodass es nicht immer m√∂glich ist, einen Parameterwert automatisch zu ersetzen.  Der zweite Grund sind abh√§ngige Einheiten.  Um beispielsweise ein Postfach zu erstellen, m√ºssen Sie eine E-Mail-Dom√§ne erstellen. <br><br>  Deshalb haben wir uns entschieden, nicht f√ºr die vollst√§ndige Automatisierung zu k√§mpfen.  Vor dem Start erstellt der Tester Entit√§ten manuell und erstellt eine Momentaufnahme des Computers, da Entit√§ten nach der √úberpr√ºfung ge√§ndert werden.  Auf diese Weise k√∂nnen Sie die √úberpr√ºfung einer Gruppe von Funktionen nicht √ºberspringen, wenn eine Entit√§t nicht erfolgreich erstellt wurde. <br><br><h4>  Destruktive Funktionen aufrufen </h4><br>  Fast jede Liste verf√ºgt √ºber Funktionen zum L√∂schen oder Deaktivieren einer Entit√§t.  Wenn Sie sie nacheinander ausf√ºhren, wird die Entit√§t gel√∂scht, bevor andere Funktionen ausgef√ºhrt werden.  Ich definiere solche Funktionen und f√ºhre nach anderen aus.  Zus√§tzlich wurde ein Schl√ºssel hinzugef√ºgt, der die Ausf√ºhrung solcher Funktionen verhindert. <br><br>  Einige Funktionen starten den Server neu.  Sie m√ºssen verfolgt und zur Liste der Ignorierten hinzugef√ºgt werden. <br><br>  Aufgrund der Art der Betriebslogik starten einige Funktionen das Panel neu.  W√§hrend der Sicherheitstests wird das Panel gestartet, ohne SQL-Abfragen oder Strace zu verfolgen. Eine weitere √úberpr√ºfung ist bedeutungslos.  Sie m√ºssen dies verfolgen und das Panel im Trace-Modus neu starten. <br><br><h4>  Abh√§ngige Parameter pr√ºfen </h4><br>  In Formularen gibt es Felder zur Texteingabe, Kontrollk√§stchen und Dropdown-Listen, von deren Werten die Verf√ºgbarkeit von Werten anderer Felder abh√§ngt.  Jeder Wert des abh√§ngigen Feldes kann einen separaten Codeabschnitt haben, daher die Teile, wenn sie m√∂glicherweise nicht √ºberpr√ºft werden. <br><br>  Um dieses Problem zu l√∂sen, habe ich Algorithmen zum Analysieren abh√§ngiger Felder und zum √úberpr√ºfen aller Kombinationen abh√§ngiger Steuerelemente hinzugef√ºgt. <br><br><h4>  √úberpr√ºfen von Funktionen, die in der Benutzeroberfl√§che nicht verf√ºgbar sind </h4><br>  Servicefunktionen stehen f√ºr den √úbergang nicht zur Verf√ºgung, k√∂nnen jedoch Schwachstellen enthalten.  Um sie zu identifizieren und zu √ºberpr√ºfen, haben wir eine spezielle Funktion, die eine Liste aller registrierten Funktionen zur√ºckgibt.  Wir vergleichen diese Liste mit der Liste der getesteten Funktionen.  Es gibt keine Metadaten f√ºr Dienstprogrammfunktionen, daher ist es unm√∂glich, die darin verarbeiteten Parameter zu √ºberpr√ºfen. Um solche Funktionen irgendwie zu √ºberpr√ºfen, √ºbergebe ich ihnen unsere Standardparameter <i>elid, plid</i> und andere. <br><br><h2>  Fazit </h2><br>  Wir haben Lida in jeden Nachtaufbau in Jenkins aufgenommen.  Basierend auf den Ergebnissen seiner Arbeit wird ein Verifizierungsbericht erstellt, in dem Informationen √ºber die darin enthaltene verd√§chtige Funktion mit allen Parametern angezeigt werden. <br><br>  Die vom Entwickler geschlossene Aufgabe wird nun nicht nur vom Tester, sondern auch von Lida gepr√ºft.  Der Tester verarbeitet den empfangenen Bericht: Kopiert die Parameter der verd√§chtigen Funktion in den Browser und analysiert das Verhalten und das Protokollfenster.  Wenn die Sicherheitsanf√§lligkeit best√§tigt wird, wird der Fehler beim Entwickler protokolliert. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de426969/">https://habr.com/ru/post/de426969/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de426959/index.html">Installieren Sie Kubernetes √ºber Kubespray (lokaler Speicher, installieren Sie Elasticsearch + Fluentd + Kibana, prometheus)</a></li>
<li><a href="../de426961/index.html">Wie Microsoft den C # -Compiler in C # umschrieb und √∂ffnete</a></li>
<li><a href="../de426963/index.html">Tr√§umen Flutter-Apps von plattformbasierten Widgets?</a></li>
<li><a href="../de426965/index.html">Was passiert mit der Fehlerbehandlung in C ++ 2a?</a></li>
<li><a href="../de426967/index.html">Online ABAP Code Generator</a></li>
<li><a href="../de426971/index.html">Fatalismus bei der Fehlerbehandlung</a></li>
<li><a href="../de426973/index.html">Firmensandwiches</a></li>
<li><a href="../de426975/index.html">Joker 2018: Das Unm√∂gliche ist m√∂glich</a></li>
<li><a href="../de426977/index.html">LibreOffice: der Albtraum eines Buchhalters</a></li>
<li><a href="../de426979/index.html">So lernen Sie kostenlos Englisch: 3 g√§ngige Tools und detaillierte Anweisungen f√ºr jedes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>