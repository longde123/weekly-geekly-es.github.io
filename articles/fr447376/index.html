<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì≠ üò∏ üë• Hackathon SNA 2019 ü•í üèè üßíüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En f√©vrier-mars 2019, il y a eu un concours pour classer le flux du r√©seau social SNA Hackathon 2019 , dans lequel notre √©quipe a pris la premi√®re pla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hackathon SNA 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447376/"><p>  En f√©vrier-mars 2019, il y a eu un concours pour classer le flux du r√©seau social <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SNA Hackathon 2019</a> , dans lequel notre √©quipe a pris la premi√®re place.  Dans cet article, je parlerai de l'organisation du concours, des m√©thodes que nous avons essay√©es et des param√®tres catboost pour la formation sur le big data. </p><br><p><img src="https://habrastorage.org/webt/8b/bd/vv/8bbdvvg9ih5_0h5tdqmx4fho3io.jpeg"></p><a name="habracut"></a><br><p>  <strong>Hackathon SNA</strong> </p><br><p>  Le hackathon sous ce nom a lieu pour la troisi√®me fois.  Il est organis√© par le r√©seau social ok.ru, respectivement, la t√¢che et les donn√©es sont directement li√©es √† ce r√©seau social. <br>  Dans ce cas, la SNA (analyse des r√©seaux sociaux) est mieux comprise non pas comme une analyse d'un graphe social, mais plut√¥t comme une analyse d'un r√©seau social. </p><br><ul><li>  En 2014, la t√¢che consistait √† pr√©dire le nombre de likes que le poste gagnerait. </li><li>  En 2016, l'objectif de la VVZ (peut-√™tre vous √™tes familier), plus proche de l'analyse du graphe social. </li><li>  En 2019 - classement du flux d'un utilisateur selon la probabilit√© que l'utilisateur aime le message. </li></ul><br><p>  Je ne peux pas dire pour 2014, mais en 2016 et 2019, en plus de la capacit√© d'analyser les donn√©es, des comp√©tences pour travailler avec le big data √©taient √©galement n√©cessaires.  Je pense que c'est la combinaison de l'apprentissage automatique et des t√¢ches de traitement des m√©gadonn√©es qui m'a attir√© dans ces concours, et l'exp√©rience dans ces domaines a contribu√© √† gagner. </p><br><p>  <strong>mlbootcamp</strong> </p><br><p>  En 2019, le concours √©tait organis√© sur la plateforme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://mlbootcamp.ru</a> . </p><br><p>  Le concours a commenc√© en ligne le 7 f√©vrier et comprenait 3 t√¢ches.  Tout le monde pouvait s'inscrire sur le site, t√©l√©charger la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">base de r√©f√©rence</a> et t√©l√©charger sa voiture pendant plusieurs heures.  √Ä la fin de la sc√®ne en ligne le 15 mars, les 15 meilleurs de chaque √©mission ont √©t√© invit√©s au bureau Mail.ru pour la sc√®ne hors ligne, qui s'est d√©roul√©e du 30 mars au 1er avril. </p><br><h1 id="zadacha">  D√©fi </h1><br><p>  Les donn√©es source fournissent des identifiants utilisateur (userId) et des post-identifiants (objectId).  Si l'utilisateur a vu un message, les donn√©es contiennent une ligne contenant userId, objectId, les r√©actions de l'utilisateur √† ce message (r√©troaction) et un ensemble de divers signes ou liens vers des images et des textes. </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th>  ownerId </th><th>  r√©troaction </th><th>  des images </th></tr></thead><tbody><tr><td>  3555 </td><td>  22 </td><td>  5677 </td><td>  [aim√©, cliqu√©] </td><td>  [hash1] </td></tr><tr><td>  12842 </td><td>  55 </td><td>  32144 </td><td>  [d√©test√©] </td><td>  [hash2, hash3] </td></tr><tr><td>  13145 </td><td>  35 </td><td>  5677 </td><td>  [cliqu√©, partag√©] </td><td>  [hash2] </td></tr></tbody></table><br><p>  L'ensemble de donn√©es de test contient une structure similaire, mais le champ de r√©troaction est manquant.  L'objectif est de pr√©dire la pr√©sence d'une r√©action ¬´aim√©e¬ª dans le champ de r√©troaction. <br>  Le fichier de soumission a la structure suivante: </p><br><table><thead><tr><th>  userId </th><th>  SortedList [objectId] </th></tr></thead><tbody><tr><td>  123 </td><td>  78.13.54.22 </td></tr><tr><td>  128 </td><td>  35.61.55 </td></tr><tr><td>  131 </td><td>  35,68,129,11 </td></tr></tbody></table><br><p>  M√©trique - ROC AUC moyen par les utilisateurs. </p><br><p>  Une description plus d√©taill√©e des donn√©es peut √™tre trouv√©e sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le site de perfection</a> .  Vous pouvez √©galement y t√©l√©charger des donn√©es, y compris des tests et des photos. </p><br><p>  <strong>√âtape en ligne</strong> </p><br><p>  Au stade en ligne, la t√¢che √©tait divis√©e en 3 parties </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Syst√®me collaboratif</a> - comprend tous les signes, √† l'exception des images et des textes; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Images</a> - comprend uniquement des informations sur les images; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Textes</a> - comprend des informations uniquement sur les textes. </li></ul><br><p>  <strong>√âtape hors ligne</strong> </p><br><p>  √Ä l'√©tape hors ligne, les donn√©es comprenaient tous les attributs, tandis que les textes et les images √©taient rares.  Il y avait 1,5 fois plus de lignes dans l'ensemble de donn√©es, dont il y en avait d√©j√† beaucoup. </p><br><h1 id="reshenie-zadachi">  R√©solution de probl√®mes </h1><br><p>  Depuis que je fais du cv au travail, j‚Äôai commenc√© mon parcours dans ce concours avec la t√¢che ¬´Images¬ª.  Les donn√©es fournies sont userId, objectId, ownerId (le groupe dans lequel la publication est publi√©e), les horodatages de cr√©ation et d'affichage de la publication, et, bien s√ªr, l'image de cette publication. <br>  Apr√®s avoir g√©n√©r√© plusieurs fonctionnalit√©s bas√©es sur l'horodatage, l'id√©e suivante √©tait de prendre l'avant-derni√®re couche d'un neurone pr√©-form√© par imagenet et d'envoyer ces int√©grations pour booster. </p><br><p><img src="https://habrastorage.org/webt/g6/pq/id/g6pqidmcs0hqgilcqvmii7qdzz0.png"></p><br><p>  Les r√©sultats n'√©taient pas impressionnants.  Les int√©grations √† partir du neurone imagenet ne sont pas pertinentes, je pensais, je dois d√©poser mon encodeur automatique. </p><br><p><img src="https://habrastorage.org/webt/8b/n_/pu/8bn_pui29109tsvwsf_s5sktlgq.png"></p><br><p>  Cela a pris beaucoup de temps et le r√©sultat ne s'est pas am√©lior√©. </p><br><p>  <strong>G√©n√©ration de fonctionnalit√©s</strong> </p><br><p>  Travailler avec des images prend beaucoup de temps et j'ai d√©cid√© de faire quelque chose de plus simple. <br>  Comme vous pouvez le voir tout de suite, il y a plusieurs signes cat√©goriques dans l'ensemble de donn√©es, et pour ne pas d√©ranger beaucoup, je viens de prendre catboost.  La solution √©tait excellente, sans aucun r√©glage, j'ai imm√©diatement atteint la premi√®re ligne du classement. </p><br><p>  Il y a beaucoup de donn√©es et elles sont dispos√©es au format parquet, donc sans y r√©fl√©chir √† deux fois, j'ai pris scala et j'ai commenc√© √† tout √©crire avec √©tincelle. </p><br><p>  Les fonctionnalit√©s les plus simples, qui ont donn√© plus de croissance que les incorporations d'images: </p><br><ul><li>  combien de fois objectId, userId et ownerId se sont rencontr√©s dans les donn√©es (devraient correspondre √† la popularit√©); </li><li>  combien de userId publie le ownerId vu (devrait √™tre en corr√©lation avec l'int√©r√™t de l'utilisateur pour le groupe); </li><li>  le nombre de messages uniques regard√©s par userId par ownerId (refl√®te la taille de l'audience du groupe). </li></ul><br><p>  √Ä partir des horodatages, il √©tait possible d'obtenir l'heure √† laquelle l'utilisateur regardait la bande (matin / jour / soir / nuit).  En combinant ces cat√©gories, vous pouvez continuer √† g√©n√©rer des fonctionnalit√©s: </p><br><ul><li>  combien de fois userId s'est connect√© en soir√©e; </li><li>  √† quelle heure ce message est-il souvent affich√© (objectId) et ainsi de suite. </li></ul><br><p>  Tout cela a progressivement am√©lior√© la m√©trique.  Mais la taille de l'ensemble de donn√©es de formation est d'environ 20 millions d'enregistrements, donc l'ajout de fonctionnalit√©s a consid√©rablement ralenti l'apprentissage. </p><br><p>  J'ai red√©fini l'approche d'utilisation des donn√©es.  Bien que les donn√©es d√©pendent du temps, je n'ai pas vu de fuites d'informations explicites √† l'avenir, n√©anmoins, juste au cas o√π, je les ai cass√©es comme ceci: </p><br><p><img src="https://habrastorage.org/webt/jf/zr/gq/jfzrgq7s0l3q465pa-cc0x-rkxq.png"></p><br><p>  L'ensemble de formation qui nous a √©t√© fourni (f√©vrier et 2 semaines de mars) √©tait divis√© en 2 parties. <br>  Sur les donn√©es des N derniers jours, il a form√© le mod√®le.  Les agr√©gations d√©crites ci-dessus ont √©t√© construites sur toutes les donn√©es, y compris le test.  Dans le m√™me temps, des donn√©es sont apparues sur lesquelles diff√©rents encodeurs de la variable cible peuvent √™tre construits.  L'approche la plus simple consiste √† r√©utiliser le code qui cr√©e d√©j√† de nouvelles fonctionnalit√©s et √† lui fournir simplement des donn√©es qui ne seront pas entra√Æn√©es et cibleront = 1. </p><br><p>  Ainsi, nous avons obtenu des fonctionnalit√©s similaires: </p><br><ul><li>  Combien de fois userId a vu un message dans le groupe ownerId; </li><li>  Le nombre de fois o√π userId a aim√© le message sur ownerId; </li><li>  Pourcentage de publications que userId aimait ownerId. </li></ul><br><p>  Autrement dit, il s'est av√©r√© <em>un encodage cible moyen</em> de la part de l'ensemble de donn√©es selon diverses combinaisons de caract√©ristiques cat√©gorielles.  En principe, catboost construit √©galement l'encodage cible, et de ce point de vue, il n'y a aucun avantage, mais, par exemple, il est devenu possible de compter le nombre d'utilisateurs uniques qui aiment les publications dans ce groupe.  Dans le m√™me temps, l'objectif principal a √©t√© atteint - mon ensemble de donn√©es a diminu√© plusieurs fois et il a √©t√© possible de continuer √† g√©n√©rer des entit√©s. </p><br><p>  Alors que catboost ne peut construire des encodeurs qu'en fonction de la r√©action souhait√©e, le feedback a d'autres r√©actions: partag√©, d√©test√©, non aim√©, cliqu√©, ignor√©, ce qui peut √™tre fait manuellement.  J'ai racont√© toutes sortes d'agr√©gats et filtr√© les entit√©s de faible importance, afin de ne pas gonfler l'ensemble de donn√©es. </p><br><p>  √Ä ce moment-l√†, j'√©tais √† la premi√®re place par une large marge.  Le seul embarras √©tait que l'int√©gration des images ne donnait presque pas de gain.  L'id√©e est venue de tout donner √† catboost.  Cluster Kmeans images et obtenir une nouvelle fonctionnalit√© cat√©gorielle imageCat. </p><br><p>  Voici quelques classes apr√®s avoir filtr√© et fusionn√© manuellement les clusters obtenus √† partir de KMeans. </p><br><p><img src="https://habrastorage.org/webt/i3/s5/m2/i3s5m2ftpdmvr0m_0dvpau4eggs.png"></p><br><p>  Sur la base d‚ÄôimageCat, nous g√©n√©rons: </p><br><ul><li>  Nouvelles fonctionnalit√©s cat√©goriques: <br><ul><li>  Quelle imageCat ressemblait le plus souvent √† userId; </li><li>  Quelle imageCat est le plus souvent affich√©e par ownerId; </li><li>  Quelle imageCat a le plus aim√© userId; </li></ul></li><li>  Divers compteurs: <br><ul><li>  Combien d'imagesCat uniques paraissaient userId; </li><li>  Environ 15 fonctionnalit√©s similaires plus un encodage cible comme d√©crit ci-dessus. </li></ul></li></ul><br><p>  <strong>Textes</strong> </p><br><p>  Les r√©sultats du concours d'image me convenaient et j'ai d√©cid√© de m'essayer dans les textes.  Auparavant, je ne travaillais pas beaucoup avec les textes et, par stupidit√©, j'ai tu√© un jour sur tf-idf et svd.  Ensuite, j'ai vu une base de r√©f√©rence avec doc2vec, qui fait exactement ce dont j'ai besoin.  Apr√®s avoir l√©g√®rement ajust√© les param√®tres de doc2vec, j'ai re√ßu des int√©grations de texte. </p><br><p>  Et puis il a simplement r√©utilis√© le code pour les images, dans lequel il a remplac√© les incorporations d'images par des incorporations de texte.  En cons√©quence, je suis arriv√© √† la 2e place dans le concours de texte. </p><br><p>  <strong>Syst√®me collaboratif</strong> </p><br><p>  Il n'y avait qu'une seule comp√©tition dans laquelle je n'avais pas encore ¬´enfonc√© un b√¢ton¬ª, mais √† en juger par l'AUC dans le classement, les r√©sultats de cette comp√©tition particuli√®re auraient d√ª avoir le plus grand impact sur la sc√®ne hors ligne. <br>  J'ai pris tous les signes qui se trouvaient dans les donn√©es source, j'ai s√©lectionn√© les signes cat√©goriques et calcul√© les m√™mes agr√©gats que pour les images, √† l'exception des caract√©ristiques des images elles-m√™mes.  Juste en le mettant dans catboost, je suis arriv√© √† la 2e place. </p><br><h1 id="pervye-shagi-optimizacii-catboost">  Les premi√®res √©tapes pour optimiser catboost </h1><br><p>  Une premi√®re et deux deuxi√®mes places m'ont plu, mais il √©tait entendu que je n'avais rien fait de sp√©cial, ce qui signifie que nous pouvons nous attendre √† une perte de position. </p><br><p>  La t√¢che du concours est de classer les postes dans le cadre de l'utilisateur, et pendant tout ce temps, j'ai r√©solu le probl√®me de classification, c'est-√†-dire que j'ai optimis√© la mauvaise m√©trique. </p><br><p>  Je vais donner un exemple simple: </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th>  pr√©diction </th><th>  v√©rit√© fondamentale </th></tr></thead><tbody><tr><td>  1 </td><td>  10 </td><td>  0,9 </td><td>  1 </td></tr><tr><td>  1 </td><td>  11 </td><td>  0,8 </td><td>  1 </td></tr><tr><td>  1 </td><td>  12 </td><td>  0,7 </td><td>  1 </td></tr><tr><td>  1 </td><td>  13 </td><td>  0,6 </td><td>  1 </td></tr><tr><td>  1 </td><td>  14 </td><td>  0,5 </td><td>  0 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0,4 </td><td>  0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0,3 </td><td>  1 </td></tr></tbody></table><br><p>  On fait une petite permutation </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th>  pr√©diction </th><th>  v√©rit√© fondamentale </th></tr></thead><tbody><tr><td>  1 </td><td>  10 </td><td>  0,9 </td><td>  1 </td></tr><tr><td>  1 </td><td>  11 </td><td>  0,8 </td><td>  1 </td></tr><tr><td>  1 </td><td>  12 </td><td>  0,7 </td><td>  1 </td></tr><tr><td>  1 </td><td>  13 </td><td>  0,6 </td><td>  0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0,5 </td><td>  1 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0,4 </td><td>  0 </td></tr><tr><td>  1 </td><td>  14 </td><td>  0,3 </td><td>  1 </td></tr></tbody></table><br><p>  Nous obtenons les r√©sultats suivants: </p><br><table><thead><tr><th>  Mod√®le </th><th>  Auc </th><th>  Utilisateur1 AUC </th><th>  User2 AUC </th><th>  ASC moyenne </th></tr></thead><tbody><tr><td>  Option 1 </td><td>  0,8 </td><td>  1,0 </td><td>  0,0 </td><td>  0,5 </td></tr><tr><td>  Option 2 </td><td>  0,7 </td><td>  0,75 </td><td>  1,0 </td><td>  0,875 </td></tr></tbody></table><br><p>  Comme vous pouvez le voir, l'am√©lioration de la m√©trique AUC globale ne signifie pas l'am√©lioration de la m√©trique AUC moyenne au sein de l'utilisateur. </p><br><p>  Catboost <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">peut optimiser les mesures de classement</a> hors de la bo√Æte.  J'ai lu sur le classement des m√©triques, des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">histoires de r√©ussite</a> lors de l'utilisation de catboost et r√©gl√© YetiRankPairwise pour √©tudier la nuit.  Le r√©sultat n'√©tait pas impressionnant.  Ayant d√©cid√© que je n'avais pas bien appris, j'ai chang√© la fonction d'erreur en QueryRMSE, qui, √† en juger par la documentation de catboost, converge plus rapidement.  En cons√©quence, j'ai obtenu les m√™mes r√©sultats que lors de la formation au classement, mais les ensembles de ces deux mod√®les ont donn√© une bonne augmentation, ce qui m'a amen√© √† la premi√®re place dans les trois comp√©titions. </p><br><p>  5 minutes avant la fermeture de la sc√®ne en ligne du concours Collaborative Systems, Sergey Shalnov m'a propuls√© √† la deuxi√®me place.  La fa√ßon dont nous sommes all√©s ensemble. </p><br><h1 id="podgotovka-k-oflayn-etapu">  Pr√©paration pour la phase hors ligne </h1><br><p>  La victoire sur la sc√®ne en ligne nous a √©t√© garantie sur la carte vid√©o RTX 2080 TI, mais le prix principal de 300 000 roubles et, m√™me, m√™me la premi√®re place finale nous ont oblig√©s √† travailler ces 2 semaines. </p><br><p>  Il s'est av√©r√© que Sergey a √©galement utilis√© catboost.  Nous avons √©chang√© des id√©es et des fonctionnalit√©s, et j'ai d√©couvert le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport d'Anna Veronika Dorogush</a> dans lequel il y avait des r√©ponses √† bon nombre de mes questions, et m√™me √† celles auxquelles je n'avais pas encore comparu. </p><br><p>  La visualisation du rapport m'a conduit √† l'id√©e qu'il est n√©cessaire de ramener tous les param√®tres √† la valeur par d√©faut, et de r√©gler les param√®tres tr√®s soigneusement et seulement apr√®s avoir fix√© un ensemble de signes.  Maintenant, une formation a pris environ 15 heures, mais un mod√®le a r√©ussi √† obtenir une meilleure vitesse que dans l'ensemble avec classement. </p><br><p>  <strong>G√©n√©ration de fonctionnalit√©s</strong> </p><br><p>  Dans le cadre du concours "Syst√®mes collaboratifs", un grand nombre de fonctionnalit√©s sont jug√©es importantes pour le mod√®le.  Par exemple, <em>auditweights_spark_svd</em> est l'attribut le plus important, et il n'y a aucune information sur ce que cela signifie.  J'ai pens√© qu'il valait la peine de compter les diff√©rentes unit√©s en fonction de signes importants.  Par exemple, la moyenne d'auditweights_spark_svd par utilisateur, par groupe, par objet.  La m√™me chose peut √™tre calcul√©e √† partir des donn√©es sur lesquelles la formation n'est pas effectu√©e et de la cible = 1, c'est-√†-dire, la moyenne des <em>auditweights_spark_svd</em> par utilisateur pour les objets qu'il a aim√©s.  <em>Il y</em> avait plusieurs signes importants, outre <em>auditweights_spark_svd</em> .  En voici quelques uns: </p><br><ul><li>  <em>auditweightsCtrGender</em> </li><li>  <em>auditweightsCtrHigh</em> </li><li>  <em>userOwnerCounterCreateLikes</em> </li></ul><br><p>  Par exemple, la valeur moyenne de <em>auditweightsCtrGender</em> par userId s'est av√©r√©e √™tre une fonctionnalit√© importante, ainsi que la valeur moyenne de <em>userOwnerCounterCreateLikes</em> par userId + ownerId.  Cela aurait d√ª nous faire r√©fl√©chir sur la fa√ßon de comprendre la signification des champs. </p><br><p>  Les autres fonctionnalit√©s importantes √©taient <em>auditweightsLikesCount</em> et <em>auditweightsShowsCount</em> .  En les divisant les uns les autres, une caract√©ristique encore plus importante a √©t√© obtenue. </p><br><p>  <strong>Fuites de donn√©es</strong> </p><br><p>  Les mod√®les de concurrence et de production sont des t√¢ches tr√®s diff√©rentes.  Lors de la pr√©paration des donn√©es, il est tr√®s difficile de prendre en compte tous les d√©tails et de ne pas transf√©rer certaines informations non triviales sur la variable cible sur le test.  Si nous cr√©ons une solution de production, nous essaierons d'√©viter l'utilisation de fuites de donn√©es lors de la formation du mod√®le.  Mais si nous voulons gagner le concours, les fuites de donn√©es sont les meilleures fonctionnalit√©s. </p><br><p>  Apr√®s avoir examin√© les donn√©es, vous pouvez voir que, selon objectId, les valeurs de <em>auditweightsLikesCount</em> et <em>auditweightsShowsCount</em> changent, ce qui signifie que le ratio des valeurs maximales de ces signes refl√®tera la conversion post√©rieure bien mieux que le ratio au moment de la livraison. </p><br><p>  La premi√®re fuite que nous avons d√©couverte a √©t√© <em>auditweightsLikesCountMax / auditweightsShowsCountMax</em> . <br>  Mais que se passe-t-il si vous examinez les donn√©es de plus pr√®s?  Triez par date de livraison et obtenez: </p><br><table><thead><tr><th>  objectId </th><th>  userId </th><th>  auditweightsShowsCount </th><th>  auditweightsLikesCount </th><th>  cible (est aim√©) </th></tr></thead><tbody><tr><td>  1 </td><td>  1 </td><td>  12 </td><td>  3 </td><td>  probablement pas </td></tr><tr><td>  1 </td><td>  2 </td><td>  15 </td><td>  3 </td><td>  probablement oui </td></tr><tr><td>  1 </td><td>  3 </td><td>  16 </td><td>  4 </td><td></td></tr></tbody></table><br><p>  C'√©tait surprenant quand j'ai trouv√© le premier exemple et il s'est av√©r√© que ma pr√©diction ne s'est pas r√©alis√©e.  Mais, √©tant donn√© que les valeurs maximales de ces signes dans le cadre de l'objet ont augment√©, nous n'avons pas √©t√© trop paresseux et avons d√©cid√© de trouver <em>auditweightsShowsCountNext</em> et <em>auditweightsLikesCountNext</em> , c'est-√†-dire des valeurs au prochain instant.  Ajout d'une fonctionnalit√© <br>  <em>(auditweightsShowsCountNext-auditweightsShowsCount) / (auditweightsLikesCount-auditweightsLikesCountNext)</em> nous avons fait un bond en <em>avant 24h /</em> 24. <br>  Des fuites similaires pourraient √™tre utilis√©es si les valeurs suivantes √©taient trouv√©es pour <em>userOwnerCounterCreateLikes</em> dans userId + ownerId et, par exemple, <em>auditweightsCtrGender</em> dans objectId + userGender.  Nous avons trouv√© 6 champs similaires avec des fuites et tir√© des informations d'eux autant que possible. </p><br><p>  √Ä ce moment-l√†, nous avions extrait un maximum d'informations des attributs collaboratifs, mais nous ne sommes pas revenus aux concours d'images et de textes.  Il y avait une bonne id√©e √† v√©rifier: combien les fonctionnalit√©s donnent-elles directement sur les images ou les textes dans les comp√©titions correspondantes? </p><br><p>  Il n'y avait aucune fuite dans les concours d'images et de textes, mais √† ce moment-l√†, j'avais retourn√© les param√®tres par d√©faut de catboost, peign√© le code et ajout√© quelques fonctionnalit√©s.  R√©sultat total: </p><br><table><thead><tr><th>  Solution </th><th>  vitesse </th></tr></thead><tbody><tr><td>  Maximum avec images </td><td>  0,6411 </td></tr><tr><td>  Maximum aucune image </td><td>  0,6297 </td></tr><tr><td>  R√©sultat de la deuxi√®me place </td><td>  0,6295 </td></tr></tbody></table><br><table><thead><tr><th>  Solution </th><th>  vitesse </th></tr></thead><tbody><tr><td>  Maximum avec textes </td><td>  0,666 </td></tr><tr><td>  Maximum sans texte </td><td>  0,660 </td></tr><tr><td>  R√©sultat de la deuxi√®me place </td><td>  0,656 </td></tr></tbody></table><br><table><thead><tr><th>  Solution </th><th>  vitesse </th></tr></thead><tbody><tr><td>  Maximum en collaboration </td><td>  0,745 </td></tr><tr><td>  R√©sultat de la deuxi√®me place </td><td>  0,723 </td></tr></tbody></table><br><p>  Il est devenu √©vident que beaucoup de textes et d'images √©taient peu susceptibles d'√™tre √©vinc√©s, et apr√®s avoir essay√© quelques-unes des id√©es les plus int√©ressantes, nous avons cess√© de travailler avec eux. </p><br><p>  La nouvelle g√©n√©ration de fonctionnalit√©s dans les syst√®mes collaboratifs n'a pas donn√© de croissance, et nous avons commenc√© le classement.  √Ä l'√©tape en ligne, l'ensemble de la classification et du classement m'a donn√© une petite augmentation, car il s'est av√©r√© que j'avais une classification insuffisamment form√©e.  Aucune des fonctions d'erreur, y compris YetiRanlPairwise, n'a m√™me donn√© de r√©sultats proches que LogLoss a donn√© (0,745 contre 0,725).  Il y avait de l'espoir pour un QueryCrossEntropy qui ne pourrait pas √™tre lanc√©. </p><br><h1 id="oflayn-etap">  √âtape hors ligne </h1><br><p>  √Ä l'√©tape hors ligne, la structure des donn√©es est rest√©e la m√™me, mais il y a eu de petits changements: </p><br><ul><li>  les identifiants userId, objectId, ownerId ont √©t√© re-randomis√©s; </li><li>  plusieurs panneaux ont √©t√© supprim√©s et plusieurs ont √©t√© renomm√©s; </li><li>  les donn√©es sont devenues environ 1,5 fois plus. </li></ul><br><p>  En plus des difficult√©s list√©es, il y avait un gros plus: un gros serveur avec RTX 2080TI a √©t√© allou√© √† l'√©quipe.  J'ai appr√©ci√© le htop pendant longtemps. <br><img src="https://habrastorage.org/webt/0c/6n/zp/0c6nzpburmw8nxsxz9y8iwkxmwa.jpeg"></p><br><p>  L'id√©e en √©tait une - juste pour reproduire ce qui existe d√©j√†.  Apr√®s avoir pass√© quelques heures √† configurer l'environnement sur le serveur, nous avons progressivement commenc√© √† v√©rifier que les r√©sultats √©taient reproduits.  Le principal probl√®me auquel nous sommes confront√©s est l'augmentation du volume de donn√©es.  Nous avons d√©cid√© de r√©duire l√©g√®rement la charge et de d√©finir le param√®tre catboost ctr_complexity = 1.  Cela r√©duit un peu la vitesse, mais mon mod√®le a commenc√© √† fonctionner, le r√©sultat √©tait bon - 0,733.  Sergei, contrairement √† moi, n'a pas divis√© les donn√©es en 2 parties et s'est entra√Æn√© sur toutes les donn√©es, bien que cela ait donn√© le meilleur r√©sultat au stade en ligne, il y avait beaucoup de difficult√©s au stade hors ligne.  Si nous prenons toutes les fonctionnalit√©s que nous avons g√©n√©r√©es et essayons de les mettre en catboost ¬´sur le front¬ª, alors rien ne se serait produit au stade en ligne.  Sergey a fait l'optimisation de type, par exemple, en convertissant les types float64 en float32.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dans cet article,</a> vous pouvez trouver des informations sur l'optimisation de la m√©moire chez les pandas.  En cons√©quence, Sergey s'est entra√Æn√© sur le CPU sur toutes les donn√©es et il s'est av√©r√© environ 0,735. </p><br><p>  Ces r√©sultats ont √©t√© suffisants pour gagner, mais nous avons cach√© notre vitesse r√©elle et nous ne pouvions pas √™tre s√ªrs que les autres √©quipes ne faisaient pas de m√™me. </p><br><h1 id="bitva-do-poslednego">  Bataille jusqu'au dernier </h1><br><p>  <strong>Tuning catboost</strong> </p><br><p>  Notre solution a √©t√© enti√®rement reproduite, nous avons ajout√© des fonctionnalit√©s de donn√©es de texte et d'images, il ne restait plus qu'√† r√©gler les param√®tres de catboost.  Sergey a √©tudi√© sur le CPU avec un petit nombre d'it√©rations, et j'ai √©tudi√© avec ctr_complexity = 1.  Il ne restait qu'un jour, et si vous ajoutez simplement des it√©rations ou augmentez la ctr_complexity, alors le matin, vous pourriez obtenir une vitesse encore meilleure et marcher toute la journ√©e. </p><br><p>  Au stade hors ligne, les scores peuvent √™tre tr√®s faciles √† masquer, simplement en ne choisissant pas la meilleure solution sur le site.  Nous nous attendions √† de brusques changements dans le classement dans les derni√®res minutes avant la cl√¥ture des soumissions et avons d√©cid√© de ne pas arr√™ter. </p><br><p>  De la vid√©o d'Anna, j'ai appris que pour am√©liorer la qualit√© du mod√®le, il est pr√©f√©rable de s√©lectionner les param√®tres suivants: </p><br><ul><li>  <em>learning_rate</em> - La valeur par d√©faut est calcul√©e en fonction de la taille de l'ensemble de donn√©es.  Avec une diminution de learning_rate, pour maintenir la qualit√©, il est n√©cessaire d'augmenter le nombre d'it√©rations. </li><li>  <em>l2_leaf_reg</em> - Coefficient de r√©gularisation, valeur par d√©faut de 3, de pr√©f√©rence de 2 √† 30. Une diminution de la valeur entra√Æne une augmentation de l'overfit. </li><li>  <em>bagging_temperature</em> - Ajoute la randomisation aux poids des objets dans la s√©lection.  La valeur par d√©faut est 1, √† laquelle les poids sont s√©lectionn√©s dans la distribution exponentielle.  Une baisse de valeur entra√Æne une augmentation de la sur-tenue. </li><li>  <em>random_strength</em> - Affecte le choix des divisions pour une it√©ration particuli√®re.  Plus la valeur random_strength est √©lev√©e, plus les chances qu'une division de faible importance soit s√©lectionn√©e sont √©lev√©es.  √Ä chaque it√©ration suivante, le caract√®re al√©atoire diminue.  Une baisse de valeur entra√Æne une augmentation de la sur-tenue. </li></ul><br><p>  D'autres param√®tres affectent beaucoup moins le r√©sultat final, donc je n'ai pas essay√© de les s√©lectionner.  Une it√©ration de la formation sur mon jeu de donn√©es GPU avec ctr_complexity = 1 a pris 20 minutes, et les param√®tres s√©lectionn√©s sur le jeu de donn√©es r√©duit √©taient l√©g√®rement diff√©rents de ceux optimaux sur le jeu de donn√©es complet.  Par cons√©quent, j'ai effectu√© environ 30 it√©rations sur 10% des donn√©es, puis environ 10 it√©rations suppl√©mentaires sur toutes les donn√©es.  Il s'est av√©r√© approximativement ce qui suit: </p><br><ul><li>  J'ai augment√© <em>learning_rate</em> de 40% par rapport √† la valeur par d√©faut; </li><li>  <em>l2_leaf_reg a</em> laiss√© la m√™me chose; </li><li>  <em>bagging_temperature</em> et <em>random_strength</em> r√©duits √† 0,8. </li></ul><br><p>  Nous pouvons conclure qu'avec des param√®tres par d√©faut, le mod√®le est sous-form√©. </p><br><p>  J'ai √©t√© tr√®s surpris en voyant le r√©sultat au classement: </p><br><table><thead><tr><th>  Mod√®le </th><th>  mod√®le 1 </th><th>  mod√®le 2 </th><th>  mod√®le 3 </th><th>  ensemble </th></tr></thead><tbody><tr><td>  Pas de r√©glage </td><td>  0,7403 </td><td>  0,7404 </td><td>  0,7404 </td><td>  0,7407 </td></tr><tr><td>  Avec r√©glage </td><td>  0,7406 </td><td>  0,7405 </td><td>  0,7406 </td><td>  0,7408 </td></tr></tbody></table><br><p>  J'ai conclu pour moi-m√™me que si vous n'avez pas besoin d'une application rapide du mod√®le, alors il vaut mieux remplacer la s√©lection des param√®tres par un ensemble de plusieurs mod√®les sur des param√®tres non optimis√©s. </p><br><p>  Sergey √©tait engag√© dans l'optimisation de la taille de l'ensemble de donn√©es pour l'ex√©cuter sur le GPU.    ‚Äî    ,      : </p><br><ul><li>      ( ),       ; </li><li>      ; </li><li>  userId,      ; </li><li>   userId,    . </li></ul><br><p>     ‚Äî     . </p><br><p> <strong> </strong> </p><br><p>          ,   0,742.        ctr_complexity=2   30    5 .   4   ,     ,      0,7433. </p><br><p>       ,     ,      .          predict(prediction_type='RawFormulaVal')   scale_pos_weight=neg_count/pos_count. </p><br><p><img src="https://habrastorage.org/webt/ki/yv/yj/kiyvyjpnsouo46k-ny9e9hmyjxa.png"></p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    </a> . </p><br><p> <strong> </strong> </p><br><p>       . ,      ,    ,   2  . </p><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> . ,   Mail.ru,    ,         ,     . </li><li>  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   facebook</a> ,        . </li></ul><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>      : </p><br><ul><li>      ,       target encoding,     catboost. </li><li>     ,       ,  learning_rate  iterations.    ‚Äî    . </li><li>     GPU. Catboost      GPU,    . </li><li>          rsm~=0.2 (CPU only)  ctr_complexity=1. </li><li>     ,      .         .         , ,     . </li><li>       ,   . </li><li>         ,    . </li></ul><br><p><img src="https://habrastorage.org/webt/en/m_/to/enm_topolhyttqfezaldsddvjs0.jpeg"></p><br><p>     ,   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr447376/">https://habr.com/ru/post/fr447376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr447366/index.html">Quelle est la meilleure fa√ßon de d√©marrer un projet ou comment s'assurer qu'il n'y a pas de douleur atroce</a></li>
<li><a href="../fr447368/index.html">Pas seulement pour attraper les puces. Pourquoi la vitesse est si importante pour n'importe quel magasin</a></li>
<li><a href="../fr447370/index.html">Pourquoi, en raison d'un syst√®me de brevets cass√©, l'ombre de Theranos plane toujours sur nous</a></li>
<li><a href="../fr447372/index.html">La transformation informatique est in√©vitable: par o√π commencer</a></li>
<li><a href="../fr447374/index.html">Cr√©ation d'√©l√©ments d'interface par programme √† l'aide de PureLayout (Partie 2)</a></li>
<li><a href="../fr447380/index.html">Exceptions Kotlin et leurs fonctionnalit√©s</a></li>
<li><a href="../fr447382/index.html">Le livre "Unity and C #. Gamedev de l'id√©e √† la mise en ≈ìuvre. 2e √©d.</a></li>
<li><a href="../fr447384/index.html">Les semi-conducteurs de puissance au service de l'√©cologie</a></li>
<li><a href="../fr447388/index.html">TL; DR-digest de l'Universit√© ITMO: admission non classique √† l'universit√©, √©v√©nements √† venir et mat√©riaux les plus int√©ressants</a></li>
<li><a href="../fr447390/index.html">Consignes de configuration d'AccelStor AFA pour VMware vSphere</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>