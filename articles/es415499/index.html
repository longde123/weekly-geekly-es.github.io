<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚ÄçüöÄ ü§¶üèæ üö∑ C√≥mo dejar de tener miedo de Proguard y comenzar a vivir üë©üèº üëÇüèª üñêüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola, soy desarrollador de Android y ya no tengo miedo de ProGuard ... 


 Por lo general, esta utilidad se recuerda cuando se enfrenta con un problem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo dejar de tener miedo de Proguard y comenzar a vivir</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415499/"><p><img src="https://habrastorage.org/webt/ws/uk/rs/wsukrsowhkx1zzbqyocrumhhsmi.png"></p><br><p>  Hola, soy desarrollador de Android y ya no tengo miedo de ProGuard ... </p><br><p> Por lo general, esta utilidad se recuerda cuando se enfrenta con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">problema de l√≠mite de dex dalvik</a> o con un requisito para mejorar la seguridad de la aplicaci√≥n.  Desafortunadamente, est√° lejos de ser la primera vez que configura correctamente Proguard.  A menudo ve√≠a cu√°ntos, despu√©s de romper un proyecto, apagaban Proguard y activaban el soporte Mulditex, y cada vez estaba un poco triste por eso, porque Proguard ayuda a reducir el tama√±o de la aplicaci√≥n y a aumentar su rendimiento. </p><br><p>  Al final, decid√≠ escribir un art√≠culo en el que puedo poner toda la informaci√≥n √∫til que aprend√≠ durante varios a√±os de trabajo con Proguard y que podr√≠a ayudar tanto a los principiantes como a los que ya saben algo. </p><a name="habracut"></a><br><h2 id="o-chem-eto">  De que se trata </h2><br><p>  Proguard es una utilidad de c√≥digo abierto para optimizar y ofuscar el c√≥digo Java.  Esta herramienta procesa c√≥digo Java ya compilado, por lo que deber√≠a funcionar con cualquier lenguaje JVM.  M√°s precisamente, el lenguaje en s√≠ para Proguard es indiferente, solo el bytecode es importante.  Todas las manipulaciones de bytecode proguard se pueden dividir en 3 categor√≠as principales: <strong>reducci√≥n de c√≥digo</strong> , <strong>optimizaci√≥n</strong> y <strong>ofuscaci√≥n</strong> . </p><br><h3 id="code-shrinking">  Reducci√≥n de c√≥digo </h3><br><p>  S√≠, es una tarea bastante extra√±a escribir c√≥digo y luego eliminarlo, pero esta es la realidad del desarrollo de Android.  Esto, por supuesto, no se trata del c√≥digo escrito a mano (aunque esto sucede), sino de toneladas de carga muerta tra√≠das por bibliotecas de todo tipo.  <strong>Guava</strong> , <strong>Apache Commons</strong> , <strong>Google Play Services</strong> y otros tipos pueden inflar el tama√±o del archivo apk de 500 kb a un par de decenas de megabytes.  A veces llega tan lejos que un programa no puede compilarse debido a que excede el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l√≠mite de m√©todos de Dalvik</a> .  Proguard ayudar√° a eliminar todo el c√≥digo no utilizado y reducir√° el tama√±o de la aplicaci√≥n a unos pocos megabytes. </p><br><h3 id="optimisation">  Optimizaci√≥n </h3><br><p>  Adem√°s de eliminar el c√≥digo innecesario, Proguard puede optimizar el c√≥digo restante.  Su arsenal incluye an√°lisis de flujo de control, an√°lisis de flujo de datos, evaluaci√≥n parcial, asignaci√≥n √∫nica est√°tica, numeraci√≥n de valor global, an√°lisis de vida.  Proguard puede realizar optimizaciones de mirilla, reducir el n√∫mero de asignaciones de variables, simplificar las recursiones de cola y mucho m√°s ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki</a> ).  Adem√°s de tales operaciones generales, Proguard tiene optimizaciones √∫tiles espec√≠ficamente para la plataforma Android, por ejemplo, reemplazando las clases enum con ints, eliminando las instrucciones de registro. </p><br><h3 id="obfuscation">  Ofuscaci√≥n </h3><br><p>  Finalmente, Proguard puede convertir todo su c√≥digo en un desastre ilegible renombrando todas las clases, m√©todos y campos en conjuntos de letras aleatorias (en realidad no del todo aleatorias).  Esta es una opci√≥n muy √∫til, ya que cualquiera puede descompilar su archivo apk, y no todos tienen la paciencia para comprender el c√≥digo ofuscado. </p><br><h2 id="princip-raboty">  Principio de funcionamiento </h2><br><p>  Proguard funciona en 3 pasos en la secuencia descrita anteriormente: <strong>reducci√≥n de c√≥digo</strong> ‚Üí <strong>optimizaci√≥n</strong> ‚Üí <strong>ofuscaci√≥n</strong> .  Cada uno de los pasos es opcional. </p><br><p>  <em>El paso de optimizaci√≥n en el caso del SDK de Android est√° desactivado de forma predeterminada.</em> </p><br><p>  Para que Proguard funcione, debe proporcionar 3 componentes: </p><br><ul><li> Su c√≥digo compilado es un archivo con los archivos de <code>class</code> de su programa y todas las bibliotecas que utiliza (jar, aar, apk, war, zip, etc.).  Proguard solo modifica el c√≥digo ya compilado y no tiene nada que ver con la fuente. </li><li>  Archivo (s) de configuraci√≥n: archivo (s) que contiene todas las reglas, opciones y configuraciones con las que desea comenzar a procesar. </li><li>  Library jars (aar, apks, ...): clases de la plataforma en la que se ejecuta su programa.  En el caso de Android, este es <code>android.jar</code> .  Estos archivos son necesarios solo para el an√°lisis correcto de su c√≥digo, no se modificar√°n (esto no tiene sentido, ya que <code>android.jar</code> est√° "en el tel√©fono", no tenemos acceso a √©l). </li></ul><br><p><img src="https://habrastorage.org/webt/sf/vb/b8/sfvbb8uuvqdacgnjvzmeka3zpa4.png" alt="Imagen de la presentaci√≥n de Jeb Ware, enlace al final del art√≠culo"><br>  (Imagen de la presentaci√≥n de Jeb Ware, enlace al final del art√≠culo) </p><br><p>  Usando clases de biblioteca y sus archivos de configuraci√≥n, Proguard define todos los puntos de entrada a su programa ( <strong>semillas</strong> ).  En otras palabras, define aquellas clases y m√©todos que se pueden llamar desde el exterior y que no se pueden tocar.  Luego, comenzando con las <strong>semillas</strong> descubiertas, Proguard atraviesa recursivamente todo su c√≥digo, marcando "usado" todo lo que pudo alcanzar.  Todos los dem√°s c√≥digos ser√°n eliminados.  Debe especificar al menos un punto de entrada en la configuraci√≥n.  Para un programa est√°ndar de Java, esta es la funci√≥n <code>main</code> .  En Android, no hay un √∫nico punto de entrada al programa; en cambio, tenemos componentes est√°ndar (Actividad, Servicio, etc.) creados y llamados por el sistema.  Afortunadamente, no necesitamos especificar nada aqu√≠ por nuestra cuenta, el SDK de Android crear√° la configuraci√≥n necesaria para nosotros. </p><br><h3 id="soputstvuyuschie-fayly">  Archivos complementarios </h3><br><p>  Despu√©s de detectar todos los puntos de entrada, Proguard los escribir√° en el archivo <code>seeds.txt</code> . </p><br><p>  Todo el c√≥digo que Proguard consider√≥ innecesario se escribe en el archivo <code>usage.txt</code> .  Este es un nombre bastante extra√±o para un archivo que contiene c√≥digo remoto, ser√≠a m√°s correcto llamarlo unusage.txt, pero tenemos lo que tenemos, solo recuerda eso. </p><br><p>  En el paso de ofuscaci√≥n, se crear√° un archivo <code>mapping.txt</code> que contiene los pares &lt;nombre de clase original | m√©todo | campo&gt; -&gt; &lt;nombre de clase ofuscado | m√©todo | campo&gt;.  Este archivo es √∫til cuando necesita desofuscar un programa, por ejemplo, leer stacktrace.  No es necesario mapear manualmente los archivos; el SDK de Android tiene utilidades de <code>proguardui</code> y <code>proguardui</code> para ayudar.  Adem√°s, si usa Fabric Crashlytics, entonces su complemento gradle puede encontrar y cargar este archivo en la consola de forma independiente, por lo que no necesita preocuparse por ello. </p><br><p>  En el caso de Android, estos archivos generalmente se encuentran en <code>app/build/output/mapping/&lt;product-flavor-name&gt;/</code> . </p><br><p>  Proguard tambi√©n crea un archivo <code>dump.txt</code> que contiene todo lo que Proguard puso en el archivo final.  Nunca fue √∫til para m√≠, pero tal vez sea √∫til para alguien. </p><br><h3 id="kak-dela-obstoyat-v-android">  ¬øC√≥mo van las cosas en Android? </h3><br><p>  Android Gradle Plugin puede ejecutar Proguard por s√≠ solo.  Todo lo que tiene que hacer es habilitar esta opci√≥n y especificar los archivos de configuraci√≥n. </p><br><pre> <code class="hljs cs">buildTypes { &lt;...&gt; release { minifyEnabled <span class="hljs-literal"><span class="hljs-literal">true</span></span> proguardFiles <span class="hljs-string"><span class="hljs-string">'proguard-rules.pro'</span></span>, getDefaultProguardFile(<span class="hljs-string"><span class="hljs-string">'proguard-android.txt'</span></span>) } }</code> </pre> <br><p>  <code>minifyEnabled true</code> : habilita Proguard en el momento de la compilaci√≥n </p><br><p>  <code>proguardFiles</code> : una lista de archivos de configuraci√≥n.  Las reglas de todos los archivos de configuraci√≥n se agregar√°n a la lista general en el orden en que aparecen. </p><br><p>  <code>proguard-rules.pro</code> es nuestro archivo de configuraci√≥n con reglas espec√≠ficas del proyecto </p><br><p>  <code>getDefaultProguardFile('proguard-android.txt')</code> : una funci√≥n que devuelve el archivo de configuraci√≥n est√°ndar para aplicaciones de Android.  Se encuentra en <code>AndroidSDK/tools/proguard</code> </p><br><p>  De hecho, el SDK de Android tiene dos <code>proguard-android.txt</code> : <code>proguard-android.txt</code> y <code>proguard-android-optimize.txt</code> .  El primero tiene la opci√≥n <code>-dontoptimize</code> , que desactiva todas las optimizaciones.  Si desea habilitar la optimizaci√≥n, use la segunda configuraci√≥n. </p><br><p>  Adem√°s de estas configuraciones est√°ndar, el SDK de Android (aapt) genera autom√°ticamente un conjunto de reglas para los recursos: aapt comprueba todos los archivos xml (incluido el manifiesto) para encontrar todas las actividades, servicios, vistas, etc.  y generar las reglas necesarias para ellos.  Las reglas generadas se pueden encontrar en <code>app/build/intermediates/proguard-rules/&lt;flavor&gt;/aapt_rules.txt</code> .  No necesita especificarlo usted mismo, Android Gradle Plugin agregar√° estas reglas autom√°ticamente. </p><br><p><img src="https://habrastorage.org/webt/1r/w4/t6/1rw4t6egtvymigl79hnxc3n8t9a.png" alt="Imagen de la presentaci√≥n de Jeb Ware, enlace al final del art√≠culo"><br>  (Imagen de la presentaci√≥n de Jeb Ware, enlace al final del art√≠culo) </p><br><h2 id="konfigi">  Configuraciones </h2><br><p>  Configurar Proguard es la parte m√°s b√°sica de trabajar con √©l y, al mismo tiempo, la m√°s dif√≠cil.  Una configuraci√≥n incorrecta puede romper f√°cilmente la compilaci√≥n de la aplicaci√≥n y la propia aplicaci√≥n en tiempo de ejecuci√≥n.  Todas las opciones de configuraci√≥n disponibles se documentan detalladamente en apagado.  sitio. </p><br><p>  Entre todas las opciones, destacar√≠a los 3 grupos m√°s importantes: </p><br><ul><li>  mantener reglas: todos los puntos de entrada posibles al programa.  Reglas que le indican a Proguard qu√© clases o partes de clases deben mantenerse sin cambios o cu√°les de las modificaciones son v√°lidas para clases espec√≠ficas. </li><li>  ajuste de optimizaci√≥n: indique qu√© optimizaciones son aceptables, cu√°ntos ciclos de optimizaci√≥n deben realizarse. </li><li>  trabajar con advertencias, errores y depuraci√≥n </li></ul><br><h3 id="keep-rules">  Mantener las reglas </h3><br><p>  Este es un conjunto de opciones dise√±adas para proteger su c√≥digo del implacable Proguard.  En su forma m√°s general, esta regla se ve as√≠: </p><br><pre> <code class="hljs powershell"><span class="hljs-literal"><span class="hljs-literal">-keep</span></span> [,<span class="hljs-type"><span class="hljs-type">modifier</span></span>,<span class="hljs-type"><span class="hljs-type">...</span></span>] class_specification</code> </pre> <br><p>  <code>keep</code> es la m√°s com√∫n de estas opciones (hay otras), y le dice a Proguard que guarde la clase y todos sus miembros: campos y m√©todos. </p><br><p>  <code>class_specification</code> : una plantilla que apunta a la (s) clase (s) o sus partes (miembros de la clase).  La vista general de la plantilla es muy grande, se puede ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fuera.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a>  Puede contactarlo, pero en general, puede recordar que tenemos la oportunidad de componer una plantilla de estos componentes: </p><br><ul><li>  seleccione todas las clases con un nombre espec√≠fico, paquete </li><li>  seleccionar todas las clases que heredan / implementan ciertas clases / interfaces </li><li>  seleccionar todas las clases con modificadores espec√≠ficos y / o anotaciones espec√≠ficas </li><li>  seleccione todos los m√©todos con un nombre espec√≠fico, modificadores, argumentos y valor de retorno </li><li>  seleccione todos los campos con un nombre espec√≠fico, modificadores, de un tipo espec√≠fico. </li><li><p>  es posible usar comodines </p><br><p>  Una vez m√°s, esta no es una descripci√≥n estricta de la plantilla; es m√°s bien una lista de las caracter√≠sticas que tenemos.  Aqu√≠ hay algunos ejemplos: </p><br></li></ul><br><p> <code>-keep public class com.example.MyActivity</code> <br>  guardar clase <code>com.example.MyActivity</code> </p><br><p> <code>-keep public class * extends android.app.Activity</code> <br>  guardar todas las clases p√∫blicas heredando <code>android.app.Activity</code> </p><br><pre> <code class="hljs scala">-keep public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">android</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>); public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>, android.util.<span class="hljs-type"><span class="hljs-type">AttributeSet</span></span>); public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>, android.util.<span class="hljs-type"><span class="hljs-type">AttributeSet</span></span>, int); public void set*(...); }</code> </pre> <br><p>  encuentre todas las clases p√∫blicas que heredan <code>android.view.View</code> y guarde 3 constructores con ciertos par√°metros en ellos + todos los m√©todos p√∫blicos, con el modificador <code>void</code> , cualquier argumento y un nombre que comience con <code>set</code> .  Todas las otras partes de la clase se pueden modificar. </p><br><p> <code>-keep class com.habr.** { *; }</code> <br>  guardar todas las clases y todos sus contenidos en el paquete <code>com.habr</code> </p><br><p>  <code>modifiers</code> - adem√°s de la regla de mantenimiento: </p><br><ul><li>  <code>includedescriptorclasses</code> : adem√°s de la clase / m√©todo / campo especificado, debe guardar todas las clases que aparecen en sus descriptores. </li><li>  <code>includecode</code> : tampoco se puede tocar el contenido del m√©todo se√±alado por esta regla en particular. </li><li>  <code>allowshrinking</code> : las clases a las que apunta esta regla no son semillas y se pueden eliminar, pero solo si no se usan en el programa en s√≠.  Sin embargo, si despu√©s de la reducci√≥n de c√≥digos este c√≥digo permanece (debido al hecho de que alguien lo usa), es imposible optimizar / ofuscar este c√≥digo. </li><li>  <code>allowoptimization</code> : las clases a las que hace referencia esta regla solo se pueden optimizar, pero no se pueden eliminar ni ofuscar. </li><li>  <code>allowobfuscation</code> : las clases a las que apunta esta regla solo se pueden ofuscar, pero no se pueden eliminar ni optimizar. </li></ul><br><p>  Adem√°s de <code>keep</code> , hay algunas opciones m√°s: </p><br><p>  <code>-keepclassmembers</code> : indica que los miembros de la clase deben guardarse si la clase en s√≠ se conserva despu√©s de la reducci√≥n del c√≥digo. </p><br><p>  <code>-keepclasseswithmembers</code> : indica que desea guardar clases cuyo contenido se encuentre dentro de la plantilla especificada.  Por ejemplo, <code>-keepclasseswithmembers class * { public &lt;init&gt;(android.content.Context); }</code>  <code>-keepclasseswithmembers class * { public &lt;init&gt;(android.content.Context); }</code> : guarda todas las clases que tienen un constructor p√∫blico con un argumento de tipo <code>Context</code> . </p><br><p>  <code>-keepnames</code> : abreviatura de <code>-keep,allowshrinking</code> . </p><br><p>  <code>-keepclassmembernames</code> : abreviatura de <code>-keepclassmembers,allowshrinking</code> . </p><br><p>  <code>keepclasseswithmembernames</code> - abreviatura de <code>-keepclasseswithmembers,allowshrinking</code> . </p><br><h3 id="optimisation-tuning">  Optimizaci√≥n de optimizaci√≥n </h3><br><p>  La opci√≥n m√°s importante aqu√≠ es la bandera <code>-dontoptimize</code> .  Si est√° presente, no se realizar√° ninguna optimizaci√≥n y se ignorar√°n todas las dem√°s opciones de optimizaci√≥n. </p><br><p>  Hay muchas opciones de optimizaci√≥n, pero las siguientes son las m√°s √∫tiles para m√≠: </p><br><p>  <code>-optimizations optimization_filter</code> : enumera todas las formas que desea utilizar.  Es mejor usar el conjunto especificado en <code>proguard-android-optimize.txt</code> o un subconjunto del mismo.  Puede encontrar una lista de todas las optimizaciones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p><br><p>  <code>-optimizationpasses n</code> - n√∫mero de ciclos de optimizaci√≥n.  Varios ciclos pueden mejorar el resultado.  Al mismo tiempo, Proguard es lo suficientemente inteligente como para detener los ciclos si ve que el resultado no ha mejorado desde la √∫ltima vez. </p><br><p>  <code>-assumenosideeffects class_specification</code> : indica que este m√©todo no tiene efectos secundarios y solo devuelve alg√∫n valor.  Proguard eliminar√° las llamadas a este m√©todo si detecta que el resultado que devuelve no se utiliza.  Quiz√°s el uso m√°s com√∫n de esta opci√≥n es eliminar todos los registros de depuraci√≥n: <code>-assumenosideeffects class android.util.Log { public static int d(...); }</code> <code>-assumenosideeffects class android.util.Log { public static int d(...); }</code> </p><br><p>  <code>-allowaccessmodification</code> : muestra todo lo que est√° oculto :) Una excelente opci√≥n que te permite deshacerte de un mont√≥n de m√©todos de acceso artificiales para clases anidadas.  Solo funciona en conjunto con <code>-repackageclasses</code> </p><br><p>  <code>-repackageclasses</code> : le <code>-repackageclasses</code> mover todas las clases a un paquete espec√≠fico.  Esto se aplica m√°s a la ofuscaci√≥n, pero al mismo tiempo, da buenos resultados en la optimizaci√≥n. </p><br><h3 id="prochie-poleznye-opcii">  Otras opciones utiles </h3><br><p>  <code>-dontwarn</code> y <code>-dontnote</code> </p><br><p>  Proguard es muy inteligente y siempre informa lugares sospechosos durante el an√°lisis del c√≥digo, a veces son notas, a veces advertencias.  Si su compilaci√≥n no funciona con Proguard activado, aseg√∫rese de leer todos los registros que produce, escribir√° lo que sali√≥ mal y, muy probablemente, incluso le dir√° c√≥mo solucionarlo.  Despu√©s de leer todos los mensajes, puede solucionar el problema o ignorar el mensaje de una de estas opciones si est√° seguro de que no hay ning√∫n problema. </p><br><p>  Por ejemplo, sucede que alguna biblioteca de Java usa clases de plataforma que no est√°n en android.jar y Proguard le advertir√° sobre esto.  Si est√° seguro de que esta biblioteca funciona bien en un entorno Android, puede desactivar esta advertencia <code>-dontwarn java.lang.management.**</code> </p><br><p>  <code>-whyareyoukeeping class_specification</code> es una opci√≥n √∫til que imprimir√° la raz√≥n por la cual Proguard decidi√≥ no tocar esta clase / m√©todo. </p><br><p>  <code>-verbose</code> : imprime registros m√°s detallados y excepciones </p><br><p>  <code>-printconfiguration</code> : imprime una lista completa de opciones de todos los archivos de configuraci√≥n que se utilizaron, incluidas las reglas de las bibliotecas y generadas a trav√©s de aapt. </p><br><p>  <code>-keepattributes SourceFile, LineNumberTable</code> : guarda la metainformaci√≥n (nombres de archivo, numeraci√≥n de l√≠neas) para poder depurar c√≥digo en el IDE y obtener un seguimiento de pila significativo.  Aseg√∫rese de agregar esta opci√≥n. </p><br><h3 id="praktika">  Practica </h3><br><p>  Esto suele suceder: enciende Proguard y te interrumpe todo el proyecto dando muchos errores.  Muchos en este paso apagan Proguard e intentan no volver a √©l.  Intentar√© dar algunos consejos para facilitar este proceso de transici√≥n. </p><br><h4 id="opredelitsya-s-nachalnymi-vhodnymi-tochkami">  Decidir sobre los puntos de entrada de partida. </h4><br><p>  Si usted es un desarrollador de Android, todo es extremadamente elemental: solo seleccione una de las dos configuraciones est√°ndar del SDK de Android: <code>proguard-android.txt</code> o <code>proguard-android-optimize.txt</code> , se encargar√°n de todo lo que debe permanecer intacto. </p><br><h4 id="proverit-vse-biblioteki">  Verifica todas las bibliotecas </h4><br><p>  Recientemente, se distribuyen m√°s y m√°s bibliotecas con configuraciones de protecci√≥n preparadas.  Proguard puede mirar dentro del archivo, encontrar la configuraci√≥n de la biblioteca y agregarla a otras opciones.  Verifique cada biblioteca que use para dicha configuraci√≥n. </p><br><p><img src="https://habrastorage.org/webt/rf/dq/vn/rfdqvnztj-zagmqtzwctc73x3-k.png" alt="(contenido del archivo aar de una de las bibliotecas)"><br>  (contenido del archivo aar de una de las bibliotecas) </p><br><p>  Si utiliza los servicios de Google Play, entonces el complemento <code>com.google.gms.google-services</code> seleccionar√° la configuraci√≥n que necesita por su cuenta. </p><br><p>  Si los autores de la biblioteca no empaquetan la configuraci√≥n en el archivo, tal vez se cuidaron y escribieron las reglas en su sitio web, en la p√°gina del repositorio o en el archivo README.  Intente encontrar la configuraci√≥n usted mismo para la versi√≥n de la biblioteca que est√° utilizando. </p><br><p>  Si no puede encontrar ninguna regla preparada en ning√∫n lado, deber√° leer los registros y resolver el problema individualmente.  Lo m√°s probable es que deba agregar reglas de mantenimiento para el c√≥digo de la biblioteca que no funciona.  O ignore los errores si no interfieren con el programa. </p><br><h4 id="provesti-inspekciyu-svoego-koda">  Inspecciona tu c√≥digo </h4><br><p>  Sabes mejor qu√© c√≥digo puedes enviar debajo del cuchillo, pero debes mirar cuidadosamente todos los lugares donde se usa la reflexi√≥n de todos modos: </p><br><ul><li>  Class.forName (...) (la documentaci√≥n promete que Proguard puede definir dicho c√≥digo, sin embargo, ha habido casos, vale la pena verificarlo) </li><li>  Modelos / clases de entidad que se utilizan en serializaci√≥n, mapeo.  Todas las clases cuyos nombres de campo (a veces las clases mismas) son importantes para mantener (Gson, RealmIO, etc.) </li><li>  llamadas a bibliotecas nativas a trav√©s de JNI </li></ul><br><h4 id="testy">  Pruebas </h4><br><p>  Si una clase / m√©todo se usa solo en pruebas y en ning√∫n otro lugar, Proguard eliminar√° este c√≥digo.  Esta es una situaci√≥n com√∫n si tiene TDD :) Para este caso, tengo una configuraci√≥n separada, donde agrego clases que a√∫n no est√°n integradas en el proyecto, no se usan en ninguna parte, pero que necesitan ser probadas. </p><br><p>  En el complemento Gradle de Android, adem√°s de las instrucciones de <code>proguardFiles</code> , todav√≠a hay <code>testProguardFiles</code> .  Esta instrucci√≥n es necesaria para especificar las configuraciones que se aplicar√°n a la aplicaci√≥n de prueba que se genera para probar su aplicaci√≥n cuando ejecuta pruebas de instrumentaci√≥n.  Por lo general, esto se usa para lograr la misma optimizaci√≥n / ofuscaci√≥n en ambos archivos apk para que no haya desincronizaci√≥n entre ellos.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace</a> </p><br><h4 id="apk-analyzer">  Analizador de APK </h4><br><p>  Android Studio tiene una gran herramienta.  Puede abrirlo a trav√©s de Buscar acci√≥n -&gt; Analizar APK, o abriendo el archivo apk en Android Studio.  El analizador muestra mucha informaci√≥n √∫til, pero ahora estamos interesados ‚Äã‚Äãen el c√≥digo.  Para ver lo que finalmente se empaquet√≥ en un archivo APK, debe seleccionar el archivo <code>classes.dex</code> </p><br><p><img src="https://habrastorage.org/webt/go/zz/o_/gozzo_o83s3e1mknkxhqldrzr3g.png"></p><br><p>  Por defecto, se le mostrar√° exactamente el c√≥digo resultante que ha pasado los pasos de reducci√≥n y optimizaci√≥n.  Sin embargo, puede hacer clic en el <strong>bot√≥n Cargar asignaciones de Proguard ...</strong> , agregar <code>seeds.txt</code> y <code>usage.txt</code> para ver el c√≥digo que se ha eliminado. </p><br><p><img src="https://habrastorage.org/webt/gy/4a/gk/gy4agkxifirpyy95-exhk1xmguc.png"></p><br><p>  Si Proguard por alguna raz√≥n modific√≥ el c√≥digo que necesita, <strong>b√∫squelo</strong> en el Analizador y seleccione <strong>Generar Proguard Keep Rule a</strong> trav√©s de RMB.  Analyzer generar√° una selecci√≥n de varias opciones para las reglas, desde la m√°s general hasta la m√°s espec√≠fica, seleccione <strong>UNA</strong> de ellas. </p><br><p><img src="https://habrastorage.org/webt/ny/zc/ob/nyzcobecp45cnrrjgq3unu3_zba.png"></p><br><p><img src="https://habrastorage.org/webt/yq/wg/0m/yqwg0mwllbw9wauhemkvffgk_h8.png"></p><br><h4 id="dlya-avtorov-bibliotek">  Para autores de bibliotecas. </h4><br><p>  Si est√° creando una biblioteca de Android, puede agregar una configuraci√≥n de protecci√≥n para sus clientes de la siguiente manera: </p><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">buildTypes</span></span> { <span class="hljs-section"><span class="hljs-section">release</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">consumerProguardFiles</span></span> <span class="hljs-string"><span class="hljs-string">'proguard-rules.pro'</span></span> } }</code> </pre> <br><p>  En mi opini√≥n, es mejor no optimizar celosamente y ofuscar su biblioteca, sino brindar esta oportunidad a sus clientes.  Un buen tono es agregar a la configuraci√≥n lo que los clientes a√∫n tendr√°n que agregar si incluyen Proguard.  Sin embargo, si a√∫n desea agregar seguridad, es obvio que necesita proteger la API completa de su biblioteca de Proguard, incluidos los descriptores y las firmas. </p><br><h3 id="r8-dexguard-i-redex">  R8, DexGuard y Redex </h3><br><p>  R8 es la nueva herramienta de Google para reemplazar el Proguard actual.  Espera, no intentes olvidar todo lo que acabas de leer en el art√≠culo, solo tr√°talo como el nuevo Proguard.  Google promete mantener la API p√∫blica completa, para que todas las configuraciones funcionen como antes.  El proyecto todav√≠a est√° en beta, pero puedes probarlo t√∫ mismo. </p><br><p>  DexGuard es una utilidad paga de los desarrolladores de Proguard.  Se puede usar juntos o en lugar de Proguard.  Se argumenta que DexGuard puede hacer todo lo que Proguard puede hacer, pero mejor.  Desafortunadamente, no tuve la oportunidad de probarlo, si alguien tiene experiencia, comp√°rtelo. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Redex</a> es otro optimizador de dex de Facebook.  Se informa que con √©l puede lograr hasta un 25% de aumento en la productividad y reducir el tama√±o de la aplicaci√≥n aplicando la herramienta al c√≥digo ya procesado por Proguard. </p><br><h2 id="vmesto-zaklyucheniya">  En lugar de una conclusi√≥n </h2><br><p>  No tengas miedo de usar Proguard, no seas perezoso y pasa alg√∫n tiempo prepar√°ndote.  Esto reducir√° su tama√±o, aumentar√° la velocidad del trabajo, que agregar√° la lealtad de sus usuarios.  Al mismo tiempo, intente crear configuraciones efectivas de Proguard, no escriba reglas de "alfombra", de lo contrario, un enojado Jake Wharton vendr√° a usted y lo rega√±ar√°. </p><br><p><img src="https://habrastorage.org/webt/ma/tf/kz/matfkzxceoougdvn7pfyx4klnho.png"></p><br><h2 id="resursy">  Recursos </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sitio web de Proguard</a> .  Tambi√©n hay informaci√≥n sobre DexGuard. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Varias reglas de ejemplo</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">R8</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Grabar una presentaci√≥n de c√≥mo funciona Proguard con DroidCon</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ProGuard efectivo mantiene reglas para la grabaci√≥n de presentaciones de aplicaciones m√°s peque√±as (Google I / O '18)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instrucciones para habilitar y configurar Proguard para Android</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P√°gina Wiki</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Redex</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es415499/">https://habr.com/ru/post/es415499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es415483/index.html">7 errores comunes al comparar sus servidores con la nube</a></li>
<li><a href="../es415485/index.html">Conduzca Kingston A1000: ¬øuna ambulancia para la computadora port√°til?</a></li>
<li><a href="../es415487/index.html">P√°ginas de la historia de Intel. Primer chip, Intel 3101</a></li>
<li><a href="../es415489/index.html">Facebook cierra proyecto de distribuci√≥n de Internet mediante drones sobre energ√≠a solar</a></li>
<li><a href="../es415493/index.html">Un nuevo c√°lculo por la f√≥rmula de Drake mostr√≥: la humanidad est√° sola en su galaxia con una probabilidad de 53-99.6%</a></li>
<li><a href="../es415503/index.html">Interfaz de usuario NetScaler SD-WAN</a></li>
<li><a href="../es415505/index.html">C√≥mo funciona JS: almacenamiento</a></li>
<li><a href="../es415523/index.html">PWM Sync en STM32</a></li>
<li><a href="../es415527/index.html">Conferencia DUMP 2018: video de todos los informes y presentaciones</a></li>
<li><a href="../es415529/index.html">Resumen de eventos de TI de julio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>