<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî≠ ‚ÜîÔ∏è ü§õüèæ Medici√≥n de electricidad. Parte 1. Medida de voltaje y corriente ü§úüèø üë® üà∑Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introducci√≥n
 ¬°Hola a todos! Despu√©s del final del ciclo en los sensores, hubo preguntas sobre un plan diferente para medir los par√°metros de consumo ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Medici√≥n de electricidad. Parte 1. Medida de voltaje y corriente</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384597/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/4df/1f8/1cd/4df1f81cd86c4e2a8f5afa1441fb88e5.jpg" alt="imagen" align="left"></a><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n</font></font></b></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Hola a todos! </font><font style="vertical-align: inherit;">Despu√©s del final del ciclo en los sensores, hubo preguntas sobre un plan diferente para medir los par√°metros de consumo de los aparatos dom√©sticos y no muy el√©ctricos. </font><font style="vertical-align: inherit;">Qui√©n consume cu√°nto, c√≥mo conectar qu√© medir, qu√© sutilezas suceden, etc. </font><font style="vertical-align: inherit;">Es hora de revelar todas las cartas en esta √°rea. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta serie de art√≠culos consideraremos el tema de la medici√≥n de los par√°metros de la electricidad. </font><font style="vertical-align: inherit;">Estos par√°metros son en realidad un n√∫mero muy grande, que tratar√© de contar gradualmente en series peque√±as. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasta ahora, los planes son tres series:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medici√≥n de electricidad. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La calidad de la electricidad.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dispositivos para medir los par√°metros de la electricidad.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el proceso de an√°lisis, resolveremos ciertos problemas pr√°cticos en microcontroladores hasta que se logre un resultado. </font><font style="vertical-align: inherit;">Por supuesto, la mayor parte de este ciclo se dedicar√° a medir el voltaje de CA y puede ser √∫til para que todos los ventiladores controlen los electrodom√©sticos de su hogar inteligente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n los resultados de todo el ciclo, fabricaremos un cierto medidor el√©ctrico inteligente con acceso a Internet. </font><font style="vertical-align: inherit;">Los fan√°ticos muy notorios para controlar los electrodom√©sticos de su hogar inteligente pueden proporcionar toda la asistencia posible en la implementaci√≥n de la parte de comunicaci√≥n sobre la base de, por ejemplo, MajorDomo. </font><font style="vertical-align: inherit;">Hagamos de OpenSource una casa inteligente mejor, por as√≠ decirlo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta serie en dos partes, discutiremos las siguientes preguntas:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexi√≥n de sensores de corriente y voltaje en dispositivos de CC, as√≠ como circuitos de CA monof√°sicos y trif√°sicos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medici√≥n de valores actuales de corriente y voltaje;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medici√≥n del factor de potencia;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Potencia plena, activa y reactiva;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El consumo de energ√≠a;</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al abordar encontrar√° respuestas a las dos primeras preguntas de esta lista. </font><font style="vertical-align: inherit;">Deliberadamente no toco los problemas de precisi√≥n de los indicadores de medici√≥n y de esta serie solo estoy contento con los resultados obtenidos con una precisi√≥n de m√°s o menos zapatos de bastidor. </font><font style="vertical-align: inherit;">Ciertamente dedicar√© un art√≠culo separado a este tema en la tercera serie.</font></font><br>
<a name="habracut"></a><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Conexi√≥n de sensores</font></font></b></h4><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.youtube.com/embed/ueE-XPjVkRY%3Ffeature%3Doembed&amp;usg=ALkJrhgks8zrIdjyJSaRsCkE246Z3ChojA" frameborder="0" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la √∫ltima serie sobre sensores de voltaje y corriente, habl√© sobre los tipos de sensores, pero no habl√© sobre c√≥mo usarlos y d√≥nde colocarlos. </font><font style="vertical-align: inherit;">Es hora de arreglarlo</font></font><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexi√≥n de sensores de CC</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est√° claro que todo el ciclo se dedicar√° a los sistemas de corriente alterna, pero tambi√©n repasaremos r√°pidamente los circuitos de corriente continua, ya que esto puede sernos √∫til al desarrollar fuentes de alimentaci√≥n de corriente continua. Tomemos, por ejemplo, un </font><i><font style="vertical-align: inherit;">convertidor de inversi√≥n </font></i></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cl√°sico </font><font style="vertical-align: inherit;">: </font></font><br>
<img src="https://habrastorage.org/files/d35/255/0f2/d352550f2c04401ea57bcda120ee3790.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 1. Un convertidor de inversi√≥n PWM</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nuestro objetivo es proporcionar un voltaje de salida estable. Adem√°s, seg√∫n la informaci√≥n del sensor de corriente, es posible controlar el modo de funcionamiento del inductor L1, evitar su saturaci√≥n, y tambi√©n implementar la protecci√≥n de corriente del convertidor. Y, francamente, no hay opciones particulares para instalar sensores.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un sensor de voltaje en forma de un divisor resistivo R1-R2, que es el √∫nico capaz de trabajar con corriente continua, est√° instalado en la salida del convertidor. Como regla general, un microcircuito convertidor especializado tiene una entrada de retroalimentaci√≥n y hace todo lo posible para garantizar que en esta entrada (3) haya un cierto nivel de voltaje prescrito en la documentaci√≥n del microcircuito. Por ejemplo, 1.25V. Si nuestro voltaje de salida coincide con este nivel, todo est√° bien, aplicamos directamente el voltaje de salida a esta entrada. Si no, configure el divisor. Si necesitamos proporcionar un voltaje de salida de 5V, entonces el divisor debe proporcionar un factor de divisi√≥n de 4, es decir, por ejemplo, R1 = 30k, R2 = 10k.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Generalmente se instala un sensor de corriente entre la fuente de alimentaci√≥n y el convertidor y en el chip. A partir de la diferencia de potencial entre los puntos 1 y 2, y con una resistencia conocida, las resistencias Rs pueden determinar el valor actual de la corriente de nuestro inductor. Instalar un sensor de corriente entre las fuentes y la carga no es una buena idea, ya que el condensador del filtro ser√° cortado por la resistencia de los consumidores de corrientes pulsadas. Instalar una resistencia en el espacio del cable com√∫n tampoco promete nada bueno: habr√° dos niveles de tierra con los que a√∫n es divertido jugar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los problemas de ca√≠da de voltaje se pueden evitar utilizando sensores de corriente sin contacto, por ejemplo, sensores de pasillo: </font></font><br>
<img src="https://habrastorage.org/files/90c/b6b/1e2/90cb6b1e298b4d408bd27d971218781e.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 2. Sensor de corriente sin contacto</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, hay una forma m√°s complicada de medir la corriente. Despu√©s de todo, el voltaje tambi√©n cae en el transistor y fluye la misma corriente que la inductancia a trav√©s de √©l. Por lo tanto, por la ca√≠da de voltaje a trav√©s de √©l, tambi√©n puede determinar el valor actual de la corriente. Honestamente, si observa la estructura interna de los circuitos convertidores, por ejemplo, de Texas Instruments, este m√©todo se encuentra con tanta frecuencia como los anteriores. La precisi√≥n de este m√©todo ciertamente no es la m√°s alta, pero es suficiente para que funcione el l√≠mite actual. </font></font><br>
<img src="https://habrastorage.org/files/2fd/ecb/bab/2fdecbbab26c483ea476483e32e2a0c9.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 3. Transistor como sensor de corriente. Hacemos lo</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
mismo en otros circuitos de convertidores similares, tanto de refuerzo como de inversi√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, es necesario mencionar por separado los transformadores lineales y de retorno del transformador.</font></font><br>
<img src="https://habrastorage.org/files/1d7/ebd/4b1/1d7ebd4b13214a919014f35a8a672b24.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 4. Conexi√≥n de sensores de corriente en convertidores flyback</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
. Tambi√©n pueden usar resistencia externa o un transistor en su funci√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con esto conectamos los sensores a los convertidores DC / DC. </font><font style="vertical-align: inherit;">Si tiene sugerencias para otras opciones, con gusto les agregar√© un art√≠culo.</font></font><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 Conexi√≥n de sensores a circuitos de CA monof√°sicos</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En los circuitos de CA, tenemos una selecci√≥n mucho mayor de posibles sensores. </font><font style="vertical-align: inherit;">Consideremos varias opciones. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√°s simple es el uso de un divisor de voltaje resistivo y una derivaci√≥n de corriente. </font></font><br>
<img src="https://habrastorage.org/files/458/c52/e43/458c52e436ac451d96927f6d3a14d772.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 5. Conexi√≥n de sensores de resistencia</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sin embargo, ella tiene un par de desventajas significativas:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, proporcionaremos una amplitud significativa de la se√±al de la derivaci√≥n actual, asignando una gran cantidad de potencia, o estaremos satisfechos con la peque√±a amplitud de la se√±al y posteriormente la amplificaremos. Y en segundo lugar, la resistencia crea una diferencia potencial entre el neutro de la red y el neutro del dispositivo. Si el dispositivo est√° aislado, no importa, si el dispositivo tiene un terminal de conexi√≥n a tierra, entonces corremos el riesgo de permanecer sin una se√±al del sensor de corriente, ya que lo cortocircuitar√°. Quiz√°s deber√≠as probar sensores que funcionan con otros principios.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, usamos transformadores de corriente y voltaje, o un sensor de corriente de efecto hall y un transformador de voltaje. </font><font style="vertical-align: inherit;">Aqu√≠, hay muchas m√°s oportunidades para trabajar con equipos, ya que el cable neutro no tiene p√©rdidas, y lo m√°s importante: en ambos casos hay un aislamiento galv√°nico del equipo de medici√≥n, que a menudo puede ser √∫til. </font><font style="vertical-align: inherit;">Sin embargo, debe tenerse en cuenta que los sensores de corriente y voltaje del transformador tienen una respuesta de frecuencia limitada y si queremos medir la composici√≥n arm√≥nica de las distorsiones, entonces esto no es un hecho que funcione. </font></font><br>
<img src="https://habrastorage.org/files/b59/304/c28/b59304c2821d45ef87501f76acfa232a.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 6. Conexi√≥n del transformador y sensores de corriente y voltaje sin contacto</font></font></i><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 Conexi√≥n de sensores a circuitos de CA multif√°sicos</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En redes multifase, nuestra capacidad para conectar sensores de corriente es ligeramente menor. Esto se debe al hecho de que la derivaci√≥n de corriente no se puede utilizar en absoluto, ya que la diferencia de potencial entre las derivaciones de fase fluctuar√° dentro de cientos de voltios y no conozco ning√∫n controlador general cuyas entradas anal√≥gicas puedan soportar tal burla. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, hay una forma de usar derivaciones de corriente: para cada canal es necesario hacer una entrada anal√≥gica aislada galv√°nicamente. Pero es mucho m√°s f√°cil y confiable usar otros sensores. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mi analizador de calidad, utilizo divisores de voltaje resistivos y sensores de corriente de efecto hall remotos. </font></font><br>
<img src="https://habrastorage.org/files/3e5/d90/547/3e5d90547af64b41a48bcfe42ee82429.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 7 Sensores de corriente en una red trif√°sica.</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se puede ver en la figura, utilizamos una conexi√≥n de cuatro hilos. </font><font style="vertical-align: inherit;">Por supuesto, en lugar de sensores de corriente en el efecto hall, puede tomar transformadores de corriente o bucles Rogowski. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En lugar de divisores resistivos, se pueden usar transformadores de voltaje, tanto para un sistema de cuatro cables como para un sistema de tres cables. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el √∫ltimo caso, los devanados primarios de los transformadores de voltaje est√°n conectados por un tri√°ngulo, y el secundario por una estrella, cuyo punto com√∫n es el punto com√∫n del circuito de medici√≥n </font></font><br>
<img src="https://habrastorage.org/files/e4d/100/cf4/e4d100cf4d3048338dd15cacdb92a373.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 8. Uso de transformadores de voltaje en una red trif√°sica</font></font></i><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 Valor actual de voltaje y corriente</font></font></b></h4><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.youtube.com/embed/TOaW9xvr8NE%3Ffeature%3Doembed&amp;usg=ALkJrhi9YKmeyJ_9jI1le-AEjl6Xq3fE2A" frameborder="0" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ha llegado el momento de resolver el problema de medir nuestras se√±ales. El significado pr√°ctico para nosotros es principalmente el valor actual de corriente y voltaje. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©jame recordarte el material del ciclo del sensor. Usando el ADC de nuestro microcontrolador a intervalos regulares, fijaremos el valor de voltaje instant√°neo. Por lo tanto, durante el per√≠odo de medici√≥n, tendremos una matriz de datos del nivel del valor de voltaje instant√°neo (para la corriente, todo es similar). </font></font><br>
<img src="https://habrastorage.org/files/f70/ca7/063/f70ca706313a41a784c27c270cbd6eb2.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 9. Una serie de valores de voltaje instant√°neos</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nuestra tarea es calcular el valor efectivo. Para comenzar, usamos la f√≥rmula integral: </font></font><br>
<img src="https://habrastorage.org/files/417/546/27d/41754627def647e89dce0c4037146eba.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En un sistema digital, tenemos que limitarnos a un cierto tiempo cu√°ntico, entonces vamos a la suma: </font></font><br>
<img src="https://habrastorage.org/files/17c/f0a/b23/17cf0ab2355a4a86a67504036f331c6b.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øD√≥nde </font></font><img src="https://habrastorage.org/files/c7c/ac5/dec/c7cac5dece7f4d03b262ad4c8ad30317.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√° el per√≠odo de muestreo de nuestra se√±al?</font></font><img src="https://habrastorage.org/files/289/63f/958/28963f958bf74b1888aeef21b047c567.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- el n√∫mero de muestras para el per√≠odo de medici√≥n. En alg√∫n lugar aqu√≠, en un video, empiezo a hablar sobre la igualdad de √°reas. Tuve que dormir ese d√≠a. =) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En los microcontroladores MSP430FE4252, que se utilizan en medidores el√©ctricos Mercury monof√°sicos, se realizan 4096 lecturas para un per√≠odo de medici√≥n de 1, 2 o 4 segundos. En T = 1s y N = 4096 seguiremos confiando. Adem√°s, 4096 puntos por segundo nos permitir√°n utilizar algoritmos r√°pidos de transformaci√≥n de Fourier para determinar el espectro arm√≥nico hasta 40 arm√≥nicos, seg√∫n lo requerido por GOST. Pero m√°s sobre eso en la pr√≥xima serie.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esbozamos el algoritmo para nuestro programa. Necesitamos asegurar un inicio estable del ADC cada 1/8192 segundos, ya que tenemos dos canales y mediremos estos datos alternativamente. Para hacer esto, configure el temporizador y la se√±al de interrupci√≥n reiniciar√° autom√°ticamente el ADC. Todos los ADC hacen eso. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escribiremos el programa futuro en arduino, ya que muchos lo tienen a mano. Hasta ahora tenemos un inter√©s puramente acad√©mico. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con una frecuencia de cuarzo del sistema de 16 MHz y un temporizador de 8 bits (para que la vida no parezca cari√±o), debemos asegurarnos de que la frecuencia de operaci√≥n de cualquier interrupci√≥n del temporizador sea de 8192 Hz. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos tristes por el hecho de que 16 MHz no est√° completamente dividido como lo necesitamos y la frecuencia final del temporizador es 8198 Hz. Cerramos los ojos a un error de 0.04% y a√∫n leemos 4096 muestras por canal.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos tristes de que la interrupci√≥n por desbordamiento en arduino est√© ocupada calculando el tiempo (es responsable de los milis y la demora, por lo que esto dejar√° de funcionar normalmente), por lo que utilizamos la interrupci√≥n en comparaci√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y de repente nos damos cuenta de que la se√±al nos llega bipolar, y que msp430fe4252 la maneja perfectamente. Estamos contentos con un ADC unipolar, por lo tanto, ensamblamos un convertidor simple de una se√±al bipolar en uno unipolar en un amplificador operacional: </font></font><br>
<img src="https://habrastorage.org/files/18f/0dd/c20/18f0ddc202544b24be6d684ce9d98c23.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 10. Un convertidor de una se√±al bipolar en un unipolar</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Adem√°s, nuestra tarea es asegurar que nuestra sinusoide oscile en relaci√≥n con la mitad del voltaje de referencia, luego restaremos la mitad del rango o activaremos la opci√≥n en la configuraci√≥n del ADC y obtener los valores de los signos.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El Arduino tiene un ADC de 10 bits, por lo que restamos la mitad del resultado sin firmar dentro de 0-1023 y obtenemos -512-511. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verificamos el modelo ensamblado en LTSpiceIV y nos aseguramos de que todo funcione como deber√≠a. </font><font style="vertical-align: inherit;">En el material de video, tambi√©n verificamos experimentalmente. </font></font><br>
<img src="https://habrastorage.org/files/3de/320/1f6/3de3201f66f94937b29504236ded1044.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 11. Resultado de la simulaci√≥n. </font><font style="vertical-align: inherit;">El verde es la se√±al original, el azul es la salida.</font></font></i><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boceto para Arduino para un canal</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{<font></font>
  autoadcsetup();<font></font>
  DDRD |=(<span class="hljs-number">1</span>&lt;&lt;PD2)|(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
  Serial.begin(<span class="hljs-number">38400</span>);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">double</span> urms = <span class="hljs-number">0</span>;
<span class="hljs-keyword">double</span> utemp = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> umoment = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> N = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> flag = <span class="hljs-number">0</span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">if</span> (flag){<font></font>
    flag = <span class="hljs-number">0</span>;<font></font>
    Serial.println(urms);<font></font>
  }<font></font>
}<font></font>
<span class="hljs-keyword">int</span> i = <span class="hljs-number">255</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">autoadcsetup</span><span class="hljs-params">()</span></span>{
  <span class="hljs-comment">//set up TIMER0 to  4096Hz</span>
  <span class="hljs-comment">//TIMER0_OVF will be the trigger for ADC</span>
  <span class="hljs-comment">/*normal mode, prescaler 16
   16MHz / 64 / 61 = 4098 Hz 0.04% to 4096Hz*/</span>
  TCCR0B = (<span class="hljs-number">1</span> &lt;&lt; CS01)|(<span class="hljs-number">1</span> &lt;&lt; CS00);<span class="hljs-comment">//timer frequency = clk/64</span>
  OCR0A = <span class="hljs-number">60</span>;<span class="hljs-comment">//61-1</span>
  TIMSK0 = (<span class="hljs-number">1</span>&lt;&lt;OCIE0A);
  <span class="hljs-comment">//set ADC.</span>
  ADMUX =  (<span class="hljs-number">1</span> &lt;&lt; REFS0);<span class="hljs-comment">//8-bit mode, ADC0 channel, AVVCC as ref</span>
  ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADEN) | (<span class="hljs-number">1</span> &lt;&lt; ADATE) | (<span class="hljs-number">1</span> &lt;&lt; ADIE) | (<span class="hljs-number">1</span> &lt;&lt; ADPS2);<span class="hljs-comment">//TUrn ADC On, trigger enable, Interrupt enable, sysclk/16=1MHz_ADC_clk=76kHz conv freq(13ticks per conversion)</span>
  ADCSRB = (<span class="hljs-number">1</span>&lt;&lt; ADTS1) | (<span class="hljs-number">1</span>&lt;&lt;ADTS0) | (<span class="hljs-number">1</span>&lt;&lt;MUX5);<span class="hljs-comment">//Auto trigger source</span><font></font>
}<font></font>
<font></font>
ISR(TIMER0_COMPA_vect){<font></font>
  <span class="hljs-keyword">if</span> (PIND &amp; (<span class="hljs-number">1</span>&lt;&lt;PD2)){<font></font>
    PORTD &amp;= ~(<span class="hljs-number">1</span>&lt;&lt;PD2);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span>{<font></font>
    PORTD |=(<span class="hljs-number">1</span>&lt;&lt;PD2);<font></font>
  }<font></font>
  TCNT0 = <span class="hljs-number">0</span>;<font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
ISR(ADC_vect){<font></font>
<font></font>
  <span class="hljs-keyword">if</span>( ( UCSR0A &amp; (<span class="hljs-number">1</span>&lt;&lt;UDRE0)) ){<font></font>
    umoment = ADCL;<span class="hljs-comment">//copy result.</span>
    umoment += (ADCH&lt;&lt;<span class="hljs-number">8</span>);<font></font>
    umoment = umoment - <span class="hljs-number">512</span>;<font></font>
    utemp = utemp + <span class="hljs-built_in">pow</span>((<span class="hljs-keyword">double</span>)(umoment),<span class="hljs-number">2</span>)/<span class="hljs-number">4096</span>;<font></font>
    N++;<font></font>
    <span class="hljs-keyword">if</span> (N == <span class="hljs-number">4095</span>){<font></font>
      urms = <span class="hljs-built_in">sqrt</span>(utemp)/<span class="hljs-number">102</span>;<font></font>
      N = <span class="hljs-number">0</span>;<font></font>
      utemp = <span class="hljs-number">0</span>;<font></font>
      flag = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">if</span> (PIND &amp; (<span class="hljs-number">1</span>&lt;&lt;PD3)){<font></font>
        PORTD &amp;= ~(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span>{<font></font>
        PORTD |=(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El programa est√° escrito en el IDE de Arduino para el microcontrolador ATmega1280. </font><font style="vertical-align: inherit;">En mi placa de depuraci√≥n, los primeros 8 canales se enrutan para las necesidades internas de la placa, por lo que se utiliza el canal ADC8. </font><font style="vertical-align: inherit;">Es posible utilizar este boceto para una placa con ATmega168, sin embargo, debe seleccionar el canal correcto. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dentro de las interrupciones, contraemos un par de pines de servicio para ver visualmente la frecuencia de digitalizaci√≥n en funcionamiento. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un par de palabras sobre el origen del coeficiente 102. En el primer arranque, se suministr√≥ una se√±al de varias amplitudes desde el generador, se ley√≥ una indicaci√≥n del valor de voltaje efectivo desde el osciloscopio, y el valor calculado en unidades absolutas del ADC se tom√≥ de la consola.</font></font><br>
<table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Umax, V</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Urms, en</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contado</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,08</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">212</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,73</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">176</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,38</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">141</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,03</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">106</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,684</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">71</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,358</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.25</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,179</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diecinueve</font></font></td>
</tr>
</tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dividiendo los valores de la tercera columna por los valores de la segunda, obtenemos un promedio de 102. Este ser√° nuestro coeficiente de "calibraci√≥n". Sin embargo, se puede notar que cuando el voltaje disminuye, la precisi√≥n cae bruscamente. Esto se debe a la baja sensibilidad de nuestro ADC. De hecho, 10 descargas para c√°lculos precisos son desastrosamente peque√±as y si es posible medir el voltaje en el enchufe de esta manera, colocar un ADC de 10 bits para medir la corriente consumida por la carga ser√° un delito contra la metrolog√≠a. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este punto, nos detendremos. En la siguiente parte, consideraremos las otras tres preguntas de esta serie y procederemos sin problemas a la creaci√≥n del dispositivo en s√≠.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El firmware presentado, as√≠ como otro firmware para esta serie (ya que grabo materiales de video m√°s r√°pido que la preparaci√≥n de art√≠culos), lo encontrar√° en el repositorio en GitHub: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/radiolok/arduino_rms_count</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En cuanto al desarrollo del medidor el√©ctrico, la referencia de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TI SimpleLink WiFi CC3200</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se tomar√° como base </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">SmartPlug</font></a><font style="vertical-align: inherit;"> , </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">cuya</font></a><font style="vertical-align: inherit;"> noticia el otro d√≠a vol√≥ a mi correo. </font><font style="vertical-align: inherit;">Realmente me gusta el microcontrolador CC3200, por lo que desarrollaremos un paquete de refuerzo para el lunchpad existente y nos daremos cuenta de todas las caracter√≠sticas que nos interesan. </font><font style="vertical-align: inherit;">No olvide hacer que funcione tan bien en otros microcontroladores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los comentarios est√°n invitados.  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">progchip666</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, para comentarios y adiciones al material, as√≠ como  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smart_alex</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como anteriormente estaba interesado en medir corriente y voltaje usando Arduino.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es384597/">https://habr.com/ru/post/es384597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es384583/index.html">Los fan√°ticos de "My Little Pony" recaudan dinero para un juego de lucha basado en la serie animada (pero con nuevos personajes)</a></li>
<li><a href="../es384585/index.html">Una historia detallada del fracaso de la preocupaci√≥n de Volkswagen con una falsificaci√≥n de pruebas de respeto al medio ambiente</a></li>
<li><a href="../es384589/index.html">Hablando con una bombilla - Revisi√≥n de cartucho inteligente VOCCA</a></li>
<li><a href="../es384593/index.html">[ACTUALIZACI√ìN ISS] Eclipse total de Super Moon 28 de septiembre</a></li>
<li><a href="../es384595/index.html">Peligro de radiaci√≥n: reactores de fisi√≥n versus reactores de fusi√≥n</a></li>
<li><a href="../es384599/index.html">¬øPor qu√© cambiar las bombillas a LED?</a></li>
<li><a href="../es384603/index.html">Revisi√≥n de Lima: servicio ilimitado de nube personal</a></li>
<li><a href="../es384605/index.html">Hacer un microondas convencional m√°s inteligente con IFTTT y OpenHAB</a></li>
<li><a href="../es384607/index.html">¬øCu√°l es la forma de internet?</a></li>
<li><a href="../es384611/index.html">Fotos espaciales para la semana (21/09-27.09)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>