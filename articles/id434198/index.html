<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥¥ ğŸ¤ŸğŸ» ğŸ˜± Memilih mode operasi server web berdasarkan pengalaman pribadi ğŸ‘©ğŸ½â€ğŸ’¼ ğŸ‘” ğŸ‘©â€ğŸ‘§â€ğŸ‘§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini akan bermanfaat bagi orang-orang yang sudah memiliki situs mereka sendiri, atau yang berencana untuk membukanya. Artikel yang sangat menar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Memilih mode operasi server web berdasarkan pengalaman pribadi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434198/">  Artikel ini akan bermanfaat bagi orang-orang yang sudah memiliki situs mereka sendiri, atau yang berencana untuk membukanya.  Artikel yang sangat menarik adalah para webmaster yang ambisius yang merasa bahwa jam terbaik dari proyek mereka akan segera tiba dan ingin bersiap untuk masuknya pengunjung halaman. <br><br>  Bahkan mereka yang masih memimpikan ribuan pengguna di situs mereka, mungkin bertanya-tanya: "Berapa banyak pengguna yang akan berdiri di situs saya jika mereka masuk pada saat yang sama?"  Saya segera ingat ungkapan terkenal "Habraeffect" - fenomena kegagalan situs, yang ternyata tidak siap untuk banyak klik di atasnya setelah munculnya tautan di Internet. <br><a name="habracut"></a><br>  Misalkan situs tersebut sudah ada (atau akan segera): di mana ia bisa ditemukan?  Haruskah hosting klasik atau server vps?  Jika vps, yang mana dan bagaimana cara mengkonfigurasinya lebih baik?  Atau mungkin tidak ada perbedaan sama sekali dan lebih mudah untuk memilih mana yang lebih murah?  Dalam artikel ini, kami akan mempertimbangkan beberapa opsi dan dalam praktiknya memastikan mana yang terbaik untuk situs kami. <br><br>  Kami akan bereksperimen: mengatur mode operasi server yang berbeda dan mengukur kinerja.  Kami akan mensimulasikan beban di situs menggunakan layanan Loaddy.com.  Di sana Anda dapat mengatur jumlah pengguna, jenis beban yang bertambah, dan grafik akan menunjukkan bagaimana server merespons mereka.  Diyakini bahwa satu pengguna menghasilkan sekitar satu permintaan ke situs dalam waktu 10 detik.  Sebagai situs pengujian, ambil demo toko online di cms moguta.  Itu akan diisi dengan "barang" uji yang ditampilkan pada halaman utama sesuai dengan beberapa kriteria (yaitu, ketika halaman sedang dibentuk, pekerjaan sedang dilakukan dengan database, dll).  Dengan satu atau lain cara, ini akan memungkinkan Anda untuk membandingkan mode di antara mereka sendiri. <br><br>  Sebagai situs uji, kami akan membuat server VPS di Ubuntu.  Konfigurasi ini akan menjadi [1 core, 1Gb RAM].  Kami berasumsi bahwa justru server entry-level inilah yang sebagian besar dibuat untuk proyek-proyek baru.  Versi uji toko online akan tersedia di alamat ip <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://130.193.44.219/</a> <br><br>  Hosting klasik juga berguna, untuk itu kami juga akan mengisi toko online yang sama untuk melakukan pengujian.  Anda dapat menempuh cara kami sendiri dan melakukan tes yang sama pada proyek Anda! <br><br>  Karena dalam kebanyakan kasus, bersama dengan vps, panel kontrol ditawarkan, kami akan membuat perubahan utama pada pengaturan di dalamnya.  Di server vps, kami memiliki 3 mode operasinya: <br><br><ul><li>  Apache </li><li>  Apache dalam mode CGI; </li><li>  Nginx + php-fpm (tanpa Apache). </li></ul><br>  Tapi pertama-tama, mari kita uji hosting: <br><br><h2>  Hosting murah klasik </h2><br><img src="https://habrastorage.org/webt/9i/9u/rj/9i9urjtvocmzug1u0s7aug1e-qk.gif" alt="gambar"><br>  Hasilnya tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Kesalahan muncul ketika jumlah pengunjung melebihi 50 orang.  Hosting berhenti memberikan konten, namun, jika Anda pergi ke panel kontrol hosting, kita dapat melihat sesuatu seperti berikut: <br><blockquote>  Situs Anda telah dibatasi selama 24 jam terakhir.  Sumber daya prosesor terbatas untuk situs Anda.  Anda telah mencapai batas proses input (jumlah skrip PHP dan CGI yang dijalankan secara bersamaan, tugas terjadwal, dan sesi konsol) 126 kali. </blockquote>  Yah, tentu saja, hosting adalah hosting, semakin murah.  Anda tentu saja dapat menemukan tarif yang akan memberikan lebih banyak opsi, tetapi Anda harus mempertimbangkan semua ini, entah bagaimana mengetahui data pasti dari pembatasan tersebut, dan masing-masing penyedia hosting. <br><br><h2>  VPS: Apache </h2><br>  Baris berikutnya adalah Angkatan Udara pengujian kami dengan mode Apache, yang ditawarkan secara default saat memasang panel kontrol ISP. <br><br><img src="https://habrastorage.org/webt/cq/ps/3k/cqps3kza1pw3ew7wdszpqcovgva.gif" alt="gambar"><br><br>  Hasilnya tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Masalah dimulai ketika jumlah pengguna melebihi 90. Jika kita pergi ke server kami melalui ssh dan melihat pada saat itu pada daftar proses menggunakan perintah atas, diurutkan menggunakan Shift + M (dengan jumlah memori yang dikonsumsi), kita akan melihat sesuatu seperti ini: <br><br><img src="https://habrastorage.org/webt/8y/ml/uk/8ymlukh_jyjx0jlsnttsw_de6mw.gif" alt="gambar"><br><br>  Kami melihat bahwa proses apache2 telah berkembang menjadi banyak anak perusahaan dan mereka memakan seluruh RAM server vps kami. <br><br>  Di sini Anda perlu membuat komentar kecil.  Faktanya adalah bahwa secara teoritis ada mode untuk server Apache yang memungkinkan alih-alih sejumlah besar proses anak untuk setiap koneksi untuk membuat beberapa yang disebut multi-thread, masing-masing akan melayani beberapa koneksi.  Mode ini disebut <i>pekerja</i> , tidak seperti <i>prefork</i> default.  Tapi itu tidak mudah untuk menginstalnya, tidak mungkin untuk melakukan ini di panel seperti ISP, dan jika Anda bingung dan mencoba melakukannya melalui ssh, ternyata mematikan prefork dan menghidupkan pekerja tidak cukup, Anda masih memerlukan versi php thread yang aman.  Dan jika modul seperti Zend atau IonCube digunakan, maka mereka juga harus aman.  Bagaimanapun, situs PHP resmi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tidak merekomendasikan</a> pengaturan mode ini. <br><br><h2>  VPS: CGI </h2><br>  Mari kita lihat apa yang terjadi ketika menggunakan mode CGI.  Untuk melakukan ini, Anda harus mengizinkan penggunaan PHP dalam mode CGI di panel kontrol ISP, ini dilakukan di bagian "Akun - Pengguna - Pengaturan untuk Pengguna". <br><br><img src="https://habrastorage.org/webt/jc/md/zx/jcmdzxrcghqhwf4xmy2edbixov0.gif" alt="gambar"><br><br>  Hasilnya tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Sebuah gambar suram ternyata.  Server menolak untuk membagikan konten dengan 55+ pengunjung, RAM sudah habis oleh proses â€œphpâ€.  Berikutnya adalah upaya untuk mengembalikan fungsionalitas, tetapi masih berakhir dengan kegagalan hampir 100%. <br><br><h2>  VPS: Nginx + PHP-FPM </h2><br>  Waktunya telah tiba untuk mode di mana server Apache tidak digunakan sama sekali, Nginx bekerja sebagai gantinya, dan php diproses oleh modul php-fpm.  Jika Anda menggunakan panel kontrol ISP, Anda harus mengaktifkan mode ini untuk pengguna.  Ini juga dilakukan di bagian "Akun - Pengguna - Pengaturan Pengguna".  Selain itu, mode ini harus tersedia di bagian "Pengaturan - Fitur - Server Web (www)". <br><br><img src="https://habrastorage.org/webt/g1/9h/tu/g19htuq2ms1wdgc7chekxfrdzzk.gif" alt="gambar"><br><br>  Hasilnya tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Apa yang kamu butuhkan!  Ketersediaan 100%, sementara kecepatan unduhan dan waktu respons server berada pada tingkat yang dapat diterima, meskipun meningkat seiring dengan meningkatnya beban.  Namun demikian, server sedang mengatasinya! <br><br>  Mari kita lihat tabel proses pada saat beban maksimum di server: <br><br><img src="https://habrastorage.org/webt/lf/al/bx/lfalbxszotenrmulrkdhifuejky.gif" alt="gambar"><br><br>  Kami melihat bahwa kami masih memiliki persediaan RAM yang tersedia.  Dan proses anak php-fpm7.0 tidak tumbuh dalam jumlah besar, tetapi dibatasi hingga 5 kali, yang masing-masingnya melayani beberapa utas. <br><br>  Yah, sepertinya "mode kemenangan" didefinisikan.  Mari cari tahu berapa banyak pengunjung simultan yang dapat dilayani server kami dalam mode ini.  Tapi sebelum itu kita melakukan sedikit "penyetelan".  Pertama, karena apache tidak digunakan untuk operasi server seperti itu, apache dapat sepenuhnya dinonaktifkan.  Kami akan melakukan ini di panel kontrol ISP di bagian "Sistem - Layanan".  Kedua, kami mengubah sedikit prinsip memulai proses php-fpm.  Secara default, ini dinamis.  Ini berarti bahwa proses anak akan menggantung di memori bahkan ketika mereka tidak diperlukan.  Pada saat yang sama, memori tidak dibebaskan, dan seiring waktu, proses ini dapat tumbuh lebih dari yang kita inginkan.  Oleh karena itu, diusulkan untuk mengatur mode "ondemand" - sesuai permintaan.  Dan mengatur jumlah proses anak dan batas waktu untuk mereka. <br><br>  Untuk melakukan ini, Anda harus pergi ke server melalui ssh dan mendaftarkan pengaturan ini di file konfigurasi php.  Ini mudah dilakukan dalam file untuk pengguna yang domainnya dibuat di ISP. <br><br>  Biasanya terletak di /etc/php/7.0/fpm/pool.d <br><br>  Jadi: <pre><code class="bash hljs">sudo nano /etc/php/7.0/fpm/pool.d/www-root.conf</code> </pre> <br><br>  Kami melihat di sana secara default pengaturan berikut: <br><br><pre> <code class="plaintext hljs">[www-root] pm = dynamic pm.start_servers = 1 pm.min_spare_servers = 1 pm.max_children = 5 pm.max_spare_servers = 5</code> </pre> <br>  Untuk mengaktifkan mode ondemand, Anda perlu mengganti ini dengan: <br><pre> <code class="plaintext hljs">pm = ondemand pm.max_children = 5 pm.process_idle_timeout = 10s</code> </pre> <br>  Dan restart php-fpm dengan perintah <br><br><pre> <code class="bash hljs">sudo service php7.0-fpm restart</code> </pre> <br>  Setelah itu, proses php-fpm7.0 akan dibuat sesuai permintaan (jika ada beban), jumlah maksimumnya akan = 5, dan setelah 10 detik downtime proses akan mati, membebaskan RAM. <br><br>  Untuk berjaga-jaga, kami akan menjalankan pengujian kami lagi untuk memastikan bahwa semua aktivitas amatir ini tidak mempengaruhi kinerja situs web menjadi lebih buruk: <br><br><img src="https://habrastorage.org/webt/j_/ii/3q/j_ii3q4de-cmblsvtxi7grdwumq.gif" alt="gambar"><br><br>  Hasilnya tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Sekarang mari kita jalankan Loaddy dengan banyak pengunjung untuk memahami berapa banyak koneksi yang dapat ditangani oleh server kami: <br><br><img src="https://habrastorage.org/webt/wb/vs/72/wbvs72nk8yujn1n8w-ngook9mm0.gif" alt="gambar"><br><br>  Hasilnya tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Berita baiknya adalah semua permintaan diproses, meskipun dengan penundaan besar, dengan jumlah besar per detik.  Waktu respons server hampir 10 detik dengan hit 190+. Tapi mari kita ingat grafik mode apache, di mana kita sudah mendapatkan respons server 4 detik dengan 80+ pengguna, sedangkan dalam mode php-fpm, kelambatan serupa diamati dengan 130 permintaan yang kami alokasikan khusus kursor pada grafik di atas. <br>  Tapi ini VPS yang sama. <br><br>  Tabel proses teratas di akhir tes (dengan 200 pengguna): <br><br><img src="https://habrastorage.org/webt/rj/uj/ra/rjujrafp7z1vbu_iqryibz88cew.gif" alt="gambar"><br><br>  Perhatikan bahwa setelah pengujian, memori yang digunakan oleh pfp-fpm dibebaskan: <br><br><img src="https://habrastorage.org/webt/yc/32/vt/yc32vtmtnrupcw6spibvemvkzpk.gif" alt="gambar"><br><br>  Jadi server kami siap untuk memuat baru. <br><br>  Harus diingat bahwa situs beroperasi dalam mode nginx + php-fpm, yang berarti apache2 tidak digunakan dalam pekerjaan dan, sebagai hasilnya, .htaccess tidak digunakan.  Ini mungkin tampak tidak nyaman, tetapi ini adalah pilihan tercepat yang memungkinkan, dan mesin pencari memberi peringkat situs yang bekerja lebih cepat. <br><br><h2>  Kesimpulan </h2><br>  Sebagai kesimpulan, satu lagi poin kecil: Jika Anda mengkonfigurasi semua yang ada di server yang Anda inginkan dan memutuskan untuk melepaskan panel kontrol ISP, atau Anda telah kehabisan lisensi untuk itu, harap dicatat bahwa proses "inti" darinya masih akan menggantung di server Anda.  Setelah berbulan-bulan, itu dapat tumbuh, jadi lebih baik untuk "membunuh" dan menghapusnya dari startup dan crona. <br><br>  Jika Anda ingin menguji situs secara independen menggunakan Loaddy atau metode lain, tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://130.193.44.219/</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id434198/">https://habr.com/ru/post/id434198/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id434188/index.html">Security Week 52: The Greatest Hits</a></li>
<li><a href="../id434190/index.html">Cara membuat keajaiban Natal digital: wawancara dengan CIO Santa Claus</a></li>
<li><a href="../id434192/index.html">Bagaimana Gerbang Baldur menyelamatkan RPG komputer</a></li>
<li><a href="../id434194/index.html">Pengembangan keterampilan untuk Alice. Pengalaman dengan antarmuka suara, kiat untuk pemula</a></li>
<li><a href="../id434196/index.html">3CX v16 Alpha 2 dan rencana untuk tahun baru</a></li>
<li><a href="../id434200/index.html">Apakah Rust begitu mengerikan seperti yang dilukis</a></li>
<li><a href="../id434202/index.html">4 rahasia tentang bagaimana tidak kehilangan pekerjaan Anda dalam ilmu data</a></li>
<li><a href="../id434206/index.html">Distributor jet ok.ru/music</a></li>
<li><a href="../id434208/index.html">Bagaimana Cara Menyelamatkan Black Friday Kami</a></li>
<li><a href="../id434210/index.html">Analisis kontes kuis Android dari stand HeadHunter di Mobius 2018 Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>