<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐆 ❇️ 🤴🏼 Documentos como código. Parte 1: automatizar la actualización 🔮 🍿 ⛽️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En proyectos grandes, que consisten en decenas y cientos de servicios interactivos, un enfoque de la documentación como código, documentos como código...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Documentos como código. Parte 1: automatizar la actualización</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/youla/blog/459640/"><p><img src="https://habrastorage.org/webt/cw/mu/zp/cwmuzpbeunmmybhxtwlffemf01k.gif"></p><br><p>  En proyectos grandes, que consisten en decenas y cientos de servicios interactivos, un enfoque de la documentación como código, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentos como código</a> , se está volviendo cada vez más obligatorio. </p><br><p>  Le mostraré cómo puede aplicar esta filosofía en las realidades del servicio clasificado, o más bien, comenzaré desde la primera etapa de su implementación: la automatización de la actualización de datos en la documentación. </p><a name="habracut"></a><br><h2 id="nabor-instrumentov">  Kit de herramientas </h2><br><p>  El principio de "documentación como código" implica el uso de las mismas herramientas al escribir documentación que al crear código: lenguajes de marcado de texto, sistemas de control de versiones, revisión de código y pruebas automáticas.  El objetivo principal: crear condiciones para que todo el equipo trabaje en conjunto en el resultado final: una base de conocimiento completa e instrucciones para usar servicios de productos individuales.  A continuación, hablaré sobre las herramientas específicas que hemos elegido para resolver este problema. </p><br><p>  Como lenguaje de marcado de texto, decidimos utilizar el texto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reStructuredText</a> más universal.  Además de una gran cantidad de directivas que proporcionan todas las funciones básicas para estructurar el texto, este lenguaje admite formatos finales clave, incluido el HTML necesario para nuestro proyecto. </p><br><p>  Los archivos se convierten de .rst a .html a través del generador de documentación de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sphinx</a> .  Le permite crear sitios estáticos para los cuales puede hacer los suyos o usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">temas ya</a> preparados.  Nuestro proyecto utiliza dos temas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">prefabricados</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">stanford-theme</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bootstrap-theme</a> .  El segundo contiene subtemas que le permiten establecer diferentes esquemas de color para los elementos clave de la interfaz. </p><br><p>  Para un acceso conveniente y rápido a la versión actual de la documentación, utilizamos un sitio estático alojado por una máquina virtual accesible desde la red de área local del equipo de desarrollo. </p><br><p>  Los archivos fuente del proyecto se almacenan en el repositorio de Bitbucket, y el sitio se genera solo a partir de los archivos contenidos en la rama maestra.  La actualización de los datos es posible solo a través de la solicitud de extracción, que le permite verificar todas las secciones nuevas de la documentación antes de que se publiquen en el dominio público. </p><br><p>  Dado que entre la finalización de una nueva sección de la documentación y su envío al sitio es necesario verificar su contenido, el proceso clave en toda la cadena es el proceso de construir el sitio y actualizar los datos en el host.  Este procedimiento debe repetirse cada vez que la solicitud de extracción con la actualización se fusione con la rama principal del proyecto. </p><br><p><img src="https://habrastorage.org/webt/z3/ua/e9/z3uae9eyv-lj3sipqmirpbpoony.png"></p><br><p>  Implementar esta lógica le permite a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> , un sistema de integración continua de desarrollo, en nuestro caso, la documentación.  Te contaré más sobre la configuración en las secciones: </p><br><ol><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Agregar un nuevo nodo a Jenkins</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Descripción de Jenkinsfile</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Integración de Jenkins y Bitbucket</a></em> </li></ol><br><h2 id="dobavlenie-novogo-uzla-v-jenkins">  Agregar un nuevo nodo a Jenkins </h2><br><p>  Para crear y actualizar la documentación en el sitio, debe registrar una máquina preparada de antemano como agente de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> para esto. </p><br><h4 id="podgotovka-mashiny">  Preparación de la máquina </h4><br><p> De acuerdo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">con los requisitos de Jenkins</a> , todos los componentes incluidos en el sistema, incluida la máquina maestra y todos los nodos de agente registrados, deben tener JDK o JRE instalados.  En nuestro caso, se utilizará <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JDK 8</a> , para cuya instalación es suficiente ejecutar el comando: </p><br><pre><code class="plaintext hljs">sudo apt-get -y install java-1.8.0-openjdk git</code> </pre> <br><p>  La máquina maestra se conectará al agente para realizar tareas asignadas en él.  Para hacer esto, debe crear un usuario en el agente bajo el cual se realizarán todas las operaciones y en el que todos los archivos generados por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> se almacenarán en la carpeta de inicio.  En sistemas Linux, simplemente ejecute el comando: </p><br><pre> <code class="plaintext hljs">sudo adduser jenkins \--shell /bin/bash su jenkins</code> </pre> <br><p>  Para establecer una conexión entre la máquina maestra y el agente, debe configurar SSH y agregar las claves de autorización necesarias.  Generaremos las claves en el agente, después de lo cual agregaremos la clave pública al archivo <code>authorized_keys</code> para el usuario <em>jenkins</em> . </p><br><p>  Construiremos el sitio con la documentación en un contenedor Docker usando una imagen de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Python ya</a> preparada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">: 3.7</a> .  Siga las instrucciones en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentación oficial</a> para instalar Docker en el agente.  Para completar el proceso de instalación, debe volver a conectarse al agente.  Verifique la instalación ejecutando el comando que carga la imagen de prueba: </p><br><pre> <code class="plaintext hljs">docker run hello-world</code> </pre> <br><p>  Para no tener que ejecutar comandos Docker en nombre del superusuario (sudo), es suficiente agregar el grupo de acopladores de usuario creado en la etapa de instalación, en cuyo nombre se ejecutarán los comandos. </p><br><pre> <code class="plaintext hljs">sudo usermod -aG docker $USER</code> </pre> <br><h4 id="konfiguraciya-novogo-uzla-v-jenkins">  Configuración de nuevo nodo de Jenkins </h4><br><p>  Dado que conectarse al agente requiere autorización, debe agregar las credenciales apropiadas en la configuración de Jenkins.  En la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentación oficial de Jenkins</a> se proporcionan instrucciones detalladas sobre cómo hacer esto en máquinas con Windows. </p><br><blockquote>  IMPORTANTE: El identificador especificado en la sección <em>Configurar Jenkins</em> -&gt; <em>Administrar entornos de compilación</em> -&gt; <strong>Nombre de nodo</strong> -&gt; <em>Configurar</em> en el parámetro <strong>Etiquetas</strong> se usa en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archivo Jenkins</a> para indicar el agente en el que se realizarán todas las operaciones. </blockquote><br><h2 id="opisanie-jenkinsfile">  Descripción de Jenkinsfile </h2><br><p>  La raíz del repositorio del proyecto contiene el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archivo Jenkins</a> , que contiene instrucciones para: </p><br><ul><li>  Preparación del entorno de construcción e instalación de dependencias. </li><li>  Construye un sitio usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sphinx</a> </li><li>  Actualización de la información del host. </li></ul><br><p>  Las instrucciones se establecen utilizando directivas especiales, cuya aplicación consideraremos más a fondo en el ejemplo del archivo utilizado en el proyecto. </p><br><h4 id="ukazanie-agenta">  Indicación del agente </h4><br><p>  Al comienzo del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archivo Jenkins,</a> especifique la etiqueta del agente en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> , en la que se realizarán todas las operaciones.  Para hacer esto, use la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">directiva del agente</a> : </p><br><pre> <code class="plaintext hljs">agent { label '-' }</code> </pre> <br><h4 id="podgotovka-sredy">  Preparación del medio ambiente </h4><br><p>  Para ejecutar el comando de construcción del sitio sphinx-build, debe establecer variables de entorno en las que se almacenarán las rutas de datos reales.  Además, para actualizar la información en el host, debe especificar de antemano las rutas donde se almacenan los datos del sitio con la documentación.  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">directiva de entorno le</a> permite asignar estos valores a las variables: </p><br><pre> <code class="plaintext hljs">environment { SPHINX_DIR = '.' //,    Sphinx BUILD_DIR = 'project_home_built' //    SOURCE_DIR = 'project_home_source' //   .rst  .md  DEPLOY_HOST = 'username@127.1.1.0:/var/www/html/' //@IP__:__ }</code> </pre> <br><h4 id="osnovnye-deystviya">  Acciones principales </h4><br><p>  Las instrucciones principales que se ejecutarán en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkinsfile</a> están contenidas en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">directiva de etapas</a> , que consta de los diferentes pasos descritos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">por las directivas de etapa</a> .  Un ejemplo simple de una tubería CI de tres etapas: </p><br><pre> <code class="plaintext hljs">pipeline { agent any stages { stage('Build') { steps { echo 'Building..' } } stage('Test') { steps { echo 'Testing..' } } stage('Deploy') { steps { echo 'Deploying....' } } } }</code> </pre> <br><h4 id="zapusk-konteynera-docker-i-ustanovka-zavisimostey">  Inicie el contenedor Docker e instale dependencias </h4><br><p>  Primero, ejecute el contenedor Docker con la imagen de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Python</a> terminada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">: 3.7</a> .  Para hacer esto, use el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">comando docker run</a> con los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">indicadores --rm</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">-i</a> .  Luego, secuencialmente haga lo siguiente: </p><br><ul><li>  instalar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">python virtualenv</a> ; </li><li>  crear y activar un nuevo entorno virtual; </li><li>  instalar en él todas las dependencias necesarias enumeradas en el archivo <br>  require.txt, que se almacena en la raíz del repositorio del proyecto. </li></ul><br><pre> <code class="plaintext hljs">stage('Install Dependencies') { steps { sh ''' docker run --rm -i python:3.7 python3 -m pip install --user --upgrade pip python3 -m pip install --user virtualenv python3 -m virtualenv pyenv . pyenv/bin/activate pip install -r \${SPHINX\_DIR}/requirements.txt ''' } }</code> </pre> <br><h4 id="sborka-sayta-s-dokumentaciey">  Construye un sitio con documentación </h4><br><p>  Ahora construyamos un sitio.  Para hacer esto, ejecute el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">comando sphinx-build</a> con los siguientes indicadores: </p><br><p>  <code>-q</code> : solo advertencias y errores de registro; <br>  <code>-w</code> : escribe un registro en el archivo especificado después del indicador; <br>  <code>-b</code> : nombre del <code>-b</code> del sitio; <br>  <code>-d</code> : especifica el directorio para almacenar archivos en caché - encurtidos doctree. </p><br><p>  Antes de comenzar el ensamblaje, con el <code>rm -rf</code> elimine el ensamblaje y los registros del sitio anterior.  En caso de un error en una de las etapas, el registro de ejecución de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">compilación sphinx</a> aparecerá en la consola de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> . </p><br><pre> <code class="plaintext hljs">stage('Build') { steps { // clear out old files sh 'rm -rf ${BUILD_DIR}' sh 'rm -f ${SPHINX_DIR}/sphinx-build.log' sh ''' ${WORKSPACE}/pyenv/bin/sphinx-build -q -w ${SPHINX_DIR}/sphinx-build.log \ -b html \ -d ${BUILD_DIR}/doctrees ${SOURCE\_DIR} ${BUILD\_DIR} ''' } post { failure { sh 'cat ${SPHINX_DIR}sphinx-build.log' } } }</code> </pre> <br><h4 id="obnovlenie-sayta-na-hoste">  Actualización del sitio de host </h4><br><p>  Y, por último, actualizaremos la información sobre el host que da servicio al sitio con la documentación del producto disponible en el entorno local.  En la implementación actual, el host es la misma máquina virtual que está registrada como agente Jenkins para la tarea de ensamblar y actualizar la documentación. </p><br><p>  Como herramienta de sincronización, utilizamos la utilidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rsync</a> .  Para que funcione correctamente, es necesario configurar una conexión SSH entre el contenedor Docker, en el que se encontraba el sitio con la documentación, y el host. </p><br><p>  Para configurar la conexión SSH con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkinsfile</a> , se deben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instalar</a> los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">siguientes complementos</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> : </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Complemento de agente SSH</a> : le permite utilizar el paso <code>sshagent</code> en los scripts para proporcionar credenciales del <em>nombre de usuario / clave</em> del formulario. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Complemento de credenciales SSH</a> : le permite guardar credenciales del formulario <em>nombre de usuario / clave</em> en la configuración de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> . </li></ol><br><p>  Después de instalar los complementos, debe especificar las credenciales actuales para conectarse al host completando el formulario en la sección <strong>Credenciales</strong> : </p><br><ul><li>  <strong>ID</strong> : identificador que se usará en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkinsfile</a> en el paso <code>sshagent</code> para indicar credenciales específicas ( <code>docs-deployer</code> ); </li><li>  <strong>Nombre de usuario</strong> : el nombre de usuario bajo el cual se realizarán las operaciones de actualización de datos del sitio (el usuario debe tener <strong><em>acceso de escritura a la</em></strong> carpeta <code>/var/html</code> del host); </li><li>  <strong>Clave privada</strong> : una clave privada para acceder al host; </li><li>  <strong>Frase de</strong> contraseña: contraseña para la clave, si se configuró en la etapa de generación. </li></ul><br><p>  A continuación se muestra el código de script que se conecta a través de SSH y actualiza la información en el host utilizando las variables del sistema especificadas en la etapa de preparación del entorno con las rutas a los datos necesarios.  El resultado del comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rsync</a> se escribe en el registro, que se mostrará en la consola de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> en caso de errores de sincronización. </p><br><pre> <code class="plaintext hljs">stage('Deploy') { steps { sshagent(credentials: ['docs-deployer']) { sh ''' #!/bin/bash rm -f ${SPHINX_DIR}/rsync.log RSYNCOPT=(-aze 'ssh -o StrictHostKeyChecking=no') rsync "${RSYNCOPT[@]}" \ --delete \ ${BUILD_DIR_CI} ${DEPLOY_HOST}/ ''' } } post { failure { sh 'cat ${SPHINX_DIR}/rsync.log' } } }</code> </pre> <br><h2 id="integraciya-jenkins-i-bitbucket">  Integración de Jenkins y Bitbucket </h2><br><p>  Hay muchas formas de organizar la interacción de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bitbucket</a> , pero en nuestro proyecto decidimos usar el complemento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Construcciones parametrizadas para Jenkins</a> .  La documentación oficial contiene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones</a> detalladas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">para instalar el</a> complemento, así como la configuración que debe especificarse para ambos sistemas.  Para trabajar con este complemento, debe crear un usuario de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> y generar un token especial para él que le permita iniciar sesión en el sistema. </p><br><h4 id="sozdanie-polzovatelya-i-api-tokena">  Crear un token de usuario y API </h4><br><p>  Para crear un nuevo usuario en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> , vaya a <em>Configuración de Jenkins</em> -&gt; <em>Administración de usuarios</em> -&gt; <em>Crear usuario</em> , y complete todas las credenciales necesarias en el formulario. </p><br><p>  El mecanismo de autenticación que permite que los scripts o aplicaciones de terceros utilicen la API de Jenkins sin transmitir realmente la contraseña del usuario es un token de API especial que se puede generar para cada usuario de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> .  Para hacer esto: </p><br><ul><li>  inicie sesión en la consola de administración utilizando los detalles del usuario creado anteriormente; </li><li>  vaya a <em>Configurar Jenkins</em> -&gt; <em>Gestión de usuarios</em> ; </li><li>  haga clic en el ícono de ajustes a la derecha del nombre de usuario con el que están autorizados en el sistema; </li><li>  busque <em>la API de token</em> en la lista de parámetros y haga clic en el botón <em>Agregar nuevo token</em> ; </li><li>  en el campo que aparece, especifique el identificador del token API y haga clic en el botón <em>Generar</em> ; </li><li>  siguiendo el mensaje en la pantalla, copie y guarde el token API generado. </li></ul><br><p>  Ahora en la configuración del servidor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bitbucket</a> , puede especificar el usuario predeterminado para conectarse a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> . </p><br><h2 id="zaklyuchenie">  Conclusión </h2><br><p>  Si antes, el proceso consistió en varios pasos: </p><br><ul><li>  Descargue la actualización al repositorio </li><li>  esperar la confirmación de la corrección; </li><li>  armar un sitio web con documentación; </li><li>  actualizar información sobre el host; </li></ul><br><p>  ahora solo haga clic en un botón Fusionar en Bitbucket.  Si después de verificar no es necesario realizar cambios en los archivos de origen, la versión actual de la documentación se actualiza inmediatamente después de confirmar la exactitud de los datos. </p><br><p>  Esto simplifica enormemente la tarea del escritor técnico, lo que lo salva de una gran cantidad de acciones manuales, y los gerentes de proyecto obtienen una herramienta conveniente para rastrear adiciones de documentación y comentarios. </p><br><p>  Automatizar este proceso es el primer paso para construir una infraestructura de gestión de documentación.  En el futuro, planeamos agregar pruebas automáticas que verifiquen la corrección de los enlaces externos utilizados en la documentación, y también queremos crear objetos de interfaz interactivos que estén integrados en temas ya preparados para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sphinx</a> . </p><br><p>  ¡Gracias a quienes leyeron esto para llamar la atención, pronto continuaremos compartiendo los detalles de la creación de documentación en nuestro proyecto! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459640/">https://habr.com/ru/post/459640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459624/index.html">Drones militares</a></li>
<li><a href="../459626/index.html">Windows Notification Facility: la superficie de ataque más indocumentada</a></li>
<li><a href="../459628/index.html">La Red de Invención Abierta tiene más de tres mil licenciatarios, ¿qué significa para el software de código abierto?</a></li>
<li><a href="../459630/index.html">Tic Tac Toe Parte 2: Deshacer / Rehacer sin estado</a></li>
<li><a href="../459638/index.html">Crear una base de conocimiento global sobre baterías</a></li>
<li><a href="../459642/index.html">Acceso seguro para registrar campos en C ++ sin sacrificar la eficiencia (utilizando CortexM como ejemplo)</a></li>
<li><a href="../459644/index.html">Atenuadores LED</a></li>
<li><a href="../459648/index.html">Todo debería estar bien en el analizador: tanto la funcionalidad como la interfaz ... Estamos explorando la nueva interfaz Solar appScreener 3.1</a></li>
<li><a href="../459650/index.html">Cómo no perder dinero en la caja negra: métodos de prueba de facturación</a></li>
<li><a href="../459652/index.html">Enfoque de prueba de regresión automatizada</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>