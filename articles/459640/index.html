<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title> 锔 ご Documentos como c贸digo. Parte 1: automatizar la actualizaci贸n   斤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En proyectos grandes, que consisten en decenas y cientos de servicios interactivos, un enfoque de la documentaci贸n como c贸digo, documentos como c贸digo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Documentos como c贸digo. Parte 1: automatizar la actualizaci贸n</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/youla/blog/459640/"><p><img src="https://habrastorage.org/webt/cw/mu/zp/cwmuzpbeunmmybhxtwlffemf01k.gif"></p><br><p>  En proyectos grandes, que consisten en decenas y cientos de servicios interactivos, un enfoque de la documentaci贸n como c贸digo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentos como c贸digo</a> , se est谩 volviendo cada vez m谩s obligatorio. </p><br><p>  Le mostrar茅 c贸mo puede aplicar esta filosof铆a en las realidades del servicio clasificado, o m谩s bien, comenzar茅 desde la primera etapa de su implementaci贸n: la automatizaci贸n de la actualizaci贸n de datos en la documentaci贸n. </p><a name="habracut"></a><br><h2 id="nabor-instrumentov">  Kit de herramientas </h2><br><p>  El principio de "documentaci贸n como c贸digo" implica el uso de las mismas herramientas al escribir documentaci贸n que al crear c贸digo: lenguajes de marcado de texto, sistemas de control de versiones, revisi贸n de c贸digo y pruebas autom谩ticas.  El objetivo principal: crear condiciones para que todo el equipo trabaje en conjunto en el resultado final: una base de conocimiento completa e instrucciones para usar servicios de productos individuales.  A continuaci贸n, hablar茅 sobre las herramientas espec铆ficas que hemos elegido para resolver este problema. </p><br><p>  Como lenguaje de marcado de texto, decidimos utilizar el texto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reStructuredText</a> m谩s universal.  Adem谩s de una gran cantidad de directivas que proporcionan todas las funciones b谩sicas para estructurar el texto, este lenguaje admite formatos finales clave, incluido el HTML necesario para nuestro proyecto. </p><br><p>  Los archivos se convierten de .rst a .html a trav茅s del generador de documentaci贸n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sphinx</a> .  Le permite crear sitios est谩ticos para los cuales puede hacer los suyos o usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">temas ya</a> preparados.  Nuestro proyecto utiliza dos temas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">prefabricados</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">stanford-theme</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bootstrap-theme</a> .  El segundo contiene subtemas que le permiten establecer diferentes esquemas de color para los elementos clave de la interfaz. </p><br><p>  Para un acceso conveniente y r谩pido a la versi贸n actual de la documentaci贸n, utilizamos un sitio est谩tico alojado por una m谩quina virtual accesible desde la red de 谩rea local del equipo de desarrollo. </p><br><p>  Los archivos fuente del proyecto se almacenan en el repositorio de Bitbucket, y el sitio se genera solo a partir de los archivos contenidos en la rama maestra.  La actualizaci贸n de los datos es posible solo a trav茅s de la solicitud de extracci贸n, que le permite verificar todas las secciones nuevas de la documentaci贸n antes de que se publiquen en el dominio p煤blico. </p><br><p>  Dado que entre la finalizaci贸n de una nueva secci贸n de la documentaci贸n y su env铆o al sitio es necesario verificar su contenido, el proceso clave en toda la cadena es el proceso de construir el sitio y actualizar los datos en el host.  Este procedimiento debe repetirse cada vez que la solicitud de extracci贸n con la actualizaci贸n se fusione con la rama principal del proyecto. </p><br><p><img src="https://habrastorage.org/webt/z3/ua/e9/z3uae9eyv-lj3sipqmirpbpoony.png"></p><br><p>  Implementar esta l贸gica le permite a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> , un sistema de integraci贸n continua de desarrollo, en nuestro caso, la documentaci贸n.  Te contar茅 m谩s sobre la configuraci贸n en las secciones: </p><br><ol><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Agregar un nuevo nodo a Jenkins</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Descripci贸n de Jenkinsfile</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Integraci贸n de Jenkins y Bitbucket</a></em> </li></ol><br><h2 id="dobavlenie-novogo-uzla-v-jenkins">  Agregar un nuevo nodo a Jenkins </h2><br><p>  Para crear y actualizar la documentaci贸n en el sitio, debe registrar una m谩quina preparada de antemano como agente de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> para esto. </p><br><h4 id="podgotovka-mashiny">  Preparaci贸n de la m谩quina </h4><br><p> De acuerdo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">con los requisitos de Jenkins</a> , todos los componentes incluidos en el sistema, incluida la m谩quina maestra y todos los nodos de agente registrados, deben tener JDK o JRE instalados.  En nuestro caso, se utilizar谩 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JDK 8</a> , para cuya instalaci贸n es suficiente ejecutar el comando: </p><br><pre><code class="plaintext hljs">sudo apt-get -y install java-1.8.0-openjdk git</code> </pre> <br><p>  La m谩quina maestra se conectar谩 al agente para realizar tareas asignadas en 茅l.  Para hacer esto, debe crear un usuario en el agente bajo el cual se realizar谩n todas las operaciones y en el que todos los archivos generados por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> se almacenar谩n en la carpeta de inicio.  En sistemas Linux, simplemente ejecute el comando: </p><br><pre> <code class="plaintext hljs">sudo adduser jenkins \--shell /bin/bash su jenkins</code> </pre> <br><p>  Para establecer una conexi贸n entre la m谩quina maestra y el agente, debe configurar SSH y agregar las claves de autorizaci贸n necesarias.  Generaremos las claves en el agente, despu茅s de lo cual agregaremos la clave p煤blica al archivo <code>authorized_keys</code> para el usuario <em>jenkins</em> . </p><br><p>  Construiremos el sitio con la documentaci贸n en un contenedor Docker usando una imagen de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Python ya</a> preparada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">: 3.7</a> .  Siga las instrucciones en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci贸n oficial</a> para instalar Docker en el agente.  Para completar el proceso de instalaci贸n, debe volver a conectarse al agente.  Verifique la instalaci贸n ejecutando el comando que carga la imagen de prueba: </p><br><pre> <code class="plaintext hljs">docker run hello-world</code> </pre> <br><p>  Para no tener que ejecutar comandos Docker en nombre del superusuario (sudo), es suficiente agregar el grupo de acopladores de usuario creado en la etapa de instalaci贸n, en cuyo nombre se ejecutar谩n los comandos. </p><br><pre> <code class="plaintext hljs">sudo usermod -aG docker $USER</code> </pre> <br><h4 id="konfiguraciya-novogo-uzla-v-jenkins">  Configuraci贸n de nuevo nodo de Jenkins </h4><br><p>  Dado que conectarse al agente requiere autorizaci贸n, debe agregar las credenciales apropiadas en la configuraci贸n de Jenkins.  En la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci贸n oficial de Jenkins</a> se proporcionan instrucciones detalladas sobre c贸mo hacer esto en m谩quinas con Windows. </p><br><blockquote>  IMPORTANTE: El identificador especificado en la secci贸n <em>Configurar Jenkins</em> -&gt; <em>Administrar entornos de compilaci贸n</em> -&gt; <strong>Nombre de nodo</strong> -&gt; <em>Configurar</em> en el par谩metro <strong>Etiquetas</strong> se usa en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archivo Jenkins</a> para indicar el agente en el que se realizar谩n todas las operaciones. </blockquote><br><h2 id="opisanie-jenkinsfile">  Descripci贸n de Jenkinsfile </h2><br><p>  La ra铆z del repositorio del proyecto contiene el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archivo Jenkins</a> , que contiene instrucciones para: </p><br><ul><li>  Preparaci贸n del entorno de construcci贸n e instalaci贸n de dependencias. </li><li>  Construye un sitio usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sphinx</a> </li><li>  Actualizaci贸n de la informaci贸n del host. </li></ul><br><p>  Las instrucciones se establecen utilizando directivas especiales, cuya aplicaci贸n consideraremos m谩s a fondo en el ejemplo del archivo utilizado en el proyecto. </p><br><h4 id="ukazanie-agenta">  Indicaci贸n del agente </h4><br><p>  Al comienzo del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archivo Jenkins,</a> especifique la etiqueta del agente en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> , en la que se realizar谩n todas las operaciones.  Para hacer esto, use la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">directiva del agente</a> : </p><br><pre> <code class="plaintext hljs">agent { label '-' }</code> </pre> <br><h4 id="podgotovka-sredy">  Preparaci贸n del medio ambiente </h4><br><p>  Para ejecutar el comando de construcci贸n del sitio sphinx-build, debe establecer variables de entorno en las que se almacenar谩n las rutas de datos reales.  Adem谩s, para actualizar la informaci贸n en el host, debe especificar de antemano las rutas donde se almacenan los datos del sitio con la documentaci贸n.  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">directiva de entorno le</a> permite asignar estos valores a las variables: </p><br><pre> <code class="plaintext hljs">environment { SPHINX_DIR = '.' //,    Sphinx BUILD_DIR = 'project_home_built' //    SOURCE_DIR = 'project_home_source' //   .rst  .md  DEPLOY_HOST = 'username@127.1.1.0:/var/www/html/' //@IP__:__ }</code> </pre> <br><h4 id="osnovnye-deystviya">  Acciones principales </h4><br><p>  Las instrucciones principales que se ejecutar谩n en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkinsfile</a> est谩n contenidas en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">directiva de etapas</a> , que consta de los diferentes pasos descritos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">por las directivas de etapa</a> .  Un ejemplo simple de una tuber铆a CI de tres etapas: </p><br><pre> <code class="plaintext hljs">pipeline { agent any stages { stage('Build') { steps { echo 'Building..' } } stage('Test') { steps { echo 'Testing..' } } stage('Deploy') { steps { echo 'Deploying....' } } } }</code> </pre> <br><h4 id="zapusk-konteynera-docker-i-ustanovka-zavisimostey">  Inicie el contenedor Docker e instale dependencias </h4><br><p>  Primero, ejecute el contenedor Docker con la imagen de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Python</a> terminada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">: 3.7</a> .  Para hacer esto, use el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">comando docker run</a> con los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">indicadores --rm</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">-i</a> .  Luego, secuencialmente haga lo siguiente: </p><br><ul><li>  instalar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">python virtualenv</a> ; </li><li>  crear y activar un nuevo entorno virtual; </li><li>  instalar en 茅l todas las dependencias necesarias enumeradas en el archivo <br>  require.txt, que se almacena en la ra铆z del repositorio del proyecto. </li></ul><br><pre> <code class="plaintext hljs">stage('Install Dependencies') { steps { sh ''' docker run --rm -i python:3.7 python3 -m pip install --user --upgrade pip python3 -m pip install --user virtualenv python3 -m virtualenv pyenv . pyenv/bin/activate pip install -r \${SPHINX\_DIR}/requirements.txt ''' } }</code> </pre> <br><h4 id="sborka-sayta-s-dokumentaciey">  Construye un sitio con documentaci贸n </h4><br><p>  Ahora construyamos un sitio.  Para hacer esto, ejecute el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">comando sphinx-build</a> con los siguientes indicadores: </p><br><p>  <code>-q</code> : solo advertencias y errores de registro; <br>  <code>-w</code> : escribe un registro en el archivo especificado despu茅s del indicador; <br>  <code>-b</code> : nombre del <code>-b</code> del sitio; <br>  <code>-d</code> : especifica el directorio para almacenar archivos en cach茅 - encurtidos doctree. </p><br><p>  Antes de comenzar el ensamblaje, con el <code>rm -rf</code> elimine el ensamblaje y los registros del sitio anterior.  En caso de un error en una de las etapas, el registro de ejecuci贸n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">compilaci贸n sphinx</a> aparecer谩 en la consola de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> . </p><br><pre> <code class="plaintext hljs">stage('Build') { steps { // clear out old files sh 'rm -rf ${BUILD_DIR}' sh 'rm -f ${SPHINX_DIR}/sphinx-build.log' sh ''' ${WORKSPACE}/pyenv/bin/sphinx-build -q -w ${SPHINX_DIR}/sphinx-build.log \ -b html \ -d ${BUILD_DIR}/doctrees ${SOURCE\_DIR} ${BUILD\_DIR} ''' } post { failure { sh 'cat ${SPHINX_DIR}sphinx-build.log' } } }</code> </pre> <br><h4 id="obnovlenie-sayta-na-hoste">  Actualizaci贸n del sitio de host </h4><br><p>  Y, por 煤ltimo, actualizaremos la informaci贸n sobre el host que da servicio al sitio con la documentaci贸n del producto disponible en el entorno local.  En la implementaci贸n actual, el host es la misma m谩quina virtual que est谩 registrada como agente Jenkins para la tarea de ensamblar y actualizar la documentaci贸n. </p><br><p>  Como herramienta de sincronizaci贸n, utilizamos la utilidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rsync</a> .  Para que funcione correctamente, es necesario configurar una conexi贸n SSH entre el contenedor Docker, en el que se encontraba el sitio con la documentaci贸n, y el host. </p><br><p>  Para configurar la conexi贸n SSH con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkinsfile</a> , se deben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instalar</a> los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">siguientes complementos</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> : </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Complemento de agente SSH</a> : le permite utilizar el paso <code>sshagent</code> en los scripts para proporcionar credenciales del <em>nombre de usuario / clave</em> del formulario. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Complemento de credenciales SSH</a> : le permite guardar credenciales del formulario <em>nombre de usuario / clave</em> en la configuraci贸n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> . </li></ol><br><p>  Despu茅s de instalar los complementos, debe especificar las credenciales actuales para conectarse al host completando el formulario en la secci贸n <strong>Credenciales</strong> : </p><br><ul><li>  <strong>ID</strong> : identificador que se usar谩 en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkinsfile</a> en el paso <code>sshagent</code> para indicar credenciales espec铆ficas ( <code>docs-deployer</code> ); </li><li>  <strong>Nombre de usuario</strong> : el nombre de usuario bajo el cual se realizar谩n las operaciones de actualizaci贸n de datos del sitio (el usuario debe tener <strong><em>acceso de escritura a la</em></strong> carpeta <code>/var/html</code> del host); </li><li>  <strong>Clave privada</strong> : una clave privada para acceder al host; </li><li>  <strong>Frase de</strong> contrase帽a: contrase帽a para la clave, si se configur贸 en la etapa de generaci贸n. </li></ul><br><p>  A continuaci贸n se muestra el c贸digo de script que se conecta a trav茅s de SSH y actualiza la informaci贸n en el host utilizando las variables del sistema especificadas en la etapa de preparaci贸n del entorno con las rutas a los datos necesarios.  El resultado del comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rsync</a> se escribe en el registro, que se mostrar谩 en la consola de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> en caso de errores de sincronizaci贸n. </p><br><pre> <code class="plaintext hljs">stage('Deploy') { steps { sshagent(credentials: ['docs-deployer']) { sh ''' #!/bin/bash rm -f ${SPHINX_DIR}/rsync.log RSYNCOPT=(-aze 'ssh -o StrictHostKeyChecking=no') rsync "${RSYNCOPT[@]}" \ --delete \ ${BUILD_DIR_CI} ${DEPLOY_HOST}/ ''' } } post { failure { sh 'cat ${SPHINX_DIR}/rsync.log' } } }</code> </pre> <br><h2 id="integraciya-jenkins-i-bitbucket">  Integraci贸n de Jenkins y Bitbucket </h2><br><p>  Hay muchas formas de organizar la interacci贸n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bitbucket</a> , pero en nuestro proyecto decidimos usar el complemento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Construcciones parametrizadas para Jenkins</a> .  La documentaci贸n oficial contiene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones</a> detalladas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">para instalar el</a> complemento, as铆 como la configuraci贸n que debe especificarse para ambos sistemas.  Para trabajar con este complemento, debe crear un usuario de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> y generar un token especial para 茅l que le permita iniciar sesi贸n en el sistema. </p><br><h4 id="sozdanie-polzovatelya-i-api-tokena">  Crear un token de usuario y API </h4><br><p>  Para crear un nuevo usuario en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> , vaya a <em>Configuraci贸n de Jenkins</em> -&gt; <em>Administraci贸n de usuarios</em> -&gt; <em>Crear usuario</em> , y complete todas las credenciales necesarias en el formulario. </p><br><p>  El mecanismo de autenticaci贸n que permite que los scripts o aplicaciones de terceros utilicen la API de Jenkins sin transmitir realmente la contrase帽a del usuario es un token de API especial que se puede generar para cada usuario de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> .  Para hacer esto: </p><br><ul><li>  inicie sesi贸n en la consola de administraci贸n utilizando los detalles del usuario creado anteriormente; </li><li>  vaya a <em>Configurar Jenkins</em> -&gt; <em>Gesti贸n de usuarios</em> ; </li><li>  haga clic en el 铆cono de ajustes a la derecha del nombre de usuario con el que est谩n autorizados en el sistema; </li><li>  busque <em>la API de token</em> en la lista de par谩metros y haga clic en el bot贸n <em>Agregar nuevo token</em> ; </li><li>  en el campo que aparece, especifique el identificador del token API y haga clic en el bot贸n <em>Generar</em> ; </li><li>  siguiendo el mensaje en la pantalla, copie y guarde el token API generado. </li></ul><br><p>  Ahora en la configuraci贸n del servidor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bitbucket</a> , puede especificar el usuario predeterminado para conectarse a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jenkins</a> . </p><br><h2 id="zaklyuchenie">  Conclusi贸n </h2><br><p>  Si antes, el proceso consisti贸 en varios pasos: </p><br><ul><li>  Descargue la actualizaci贸n al repositorio </li><li>  esperar la confirmaci贸n de la correcci贸n; </li><li>  armar un sitio web con documentaci贸n; </li><li>  actualizar informaci贸n sobre el host; </li></ul><br><p>  ahora solo haga clic en un bot贸n Fusionar en Bitbucket.  Si despu茅s de verificar no es necesario realizar cambios en los archivos de origen, la versi贸n actual de la documentaci贸n se actualiza inmediatamente despu茅s de confirmar la exactitud de los datos. </p><br><p>  Esto simplifica enormemente la tarea del escritor t茅cnico, lo que lo salva de una gran cantidad de acciones manuales, y los gerentes de proyecto obtienen una herramienta conveniente para rastrear adiciones de documentaci贸n y comentarios. </p><br><p>  Automatizar este proceso es el primer paso para construir una infraestructura de gesti贸n de documentaci贸n.  En el futuro, planeamos agregar pruebas autom谩ticas que verifiquen la correcci贸n de los enlaces externos utilizados en la documentaci贸n, y tambi茅n queremos crear objetos de interfaz interactivos que est茅n integrados en temas ya preparados para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sphinx</a> . </p><br><p>  隆Gracias a quienes leyeron esto para llamar la atenci贸n, pronto continuaremos compartiendo los detalles de la creaci贸n de documentaci贸n en nuestro proyecto! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459640/">https://habr.com/ru/post/459640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459624/index.html">Drones militares</a></li>
<li><a href="../459626/index.html">Windows Notification Facility: la superficie de ataque m谩s indocumentada</a></li>
<li><a href="../459628/index.html">La Red de Invenci贸n Abierta tiene m谩s de tres mil licenciatarios, 驴qu茅 significa para el software de c贸digo abierto?</a></li>
<li><a href="../459630/index.html">Tic Tac Toe Parte 2: Deshacer / Rehacer sin estado</a></li>
<li><a href="../459638/index.html">Crear una base de conocimiento global sobre bater铆as</a></li>
<li><a href="../459642/index.html">Acceso seguro para registrar campos en C ++ sin sacrificar la eficiencia (utilizando CortexM como ejemplo)</a></li>
<li><a href="../459644/index.html">Atenuadores LED</a></li>
<li><a href="../459648/index.html">Todo deber铆a estar bien en el analizador: tanto la funcionalidad como la interfaz ... Estamos explorando la nueva interfaz Solar appScreener 3.1</a></li>
<li><a href="../459650/index.html">C贸mo no perder dinero en la caja negra: m茅todos de prueba de facturaci贸n</a></li>
<li><a href="../459652/index.html">Enfoque de prueba de regresi贸n automatizada</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>