<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👨‍👧 🥒 🧙🏿 Wenn .NET überall funktioniert, dann auch unter Windows 3.11 und DOS 👨‍✈️ 📕 👇🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich wiederhole oft, dass .NET Core Open Source ist und "überall" funktioniert. MonoGame, Unity, Apple Watch, Raspberry Pi und Mikrocontroller, ein Dut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wenn .NET überall funktioniert, dann auch unter Windows 3.11 und DOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485268/">  Ich wiederhole oft, dass .NET Core Open Source ist und "überall" funktioniert.  MonoGame, Unity, Apple Watch, Raspberry Pi und Mikrocontroller, ein Dutzend Linux, Windows und so weiter.  Schon viel. <br><br>  Aber jemand ist immer noch nicht genug.  <a href="https://medium.com/%40MStrehovsky%3Fsource%3Dpost_page-----74c3cf60ea04----------------------" rel="nofollow">Michal Strehowski</a> will C # wirklich <i>überall</i> starten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a16/bfc/532/a16bfc53266ec828bd93f6d8ec96ef3f.png"><br>  <i><font color="gray">C # unter Windows 3.11</font></i> <br><br>  Er hat den C # -Code auf zwei "unmöglichen" Systemen ausgeführt, die jetzt unsere Definition von "überall funktionieren" ergänzen.  Obwohl es sich um unterhaltsame Experimente handelt (wiederholen Sie sie in der Produktion nicht), betonen sie sowohl Michals technische Fähigkeiten als auch die Flexibilität der Basisplattform. <br><a name="habracut"></a><br>
<h1>  Ausführen von C # unter Windows 3.11 </h1><br>  In <a href="https://twitter.com/MStrehovsky/status/1215331352352034818" rel="nofollow">sieben Tweets</a> spricht Michal darüber, wie er es geschafft hat, C # -Code unter Windows 3.11 auszuführen.  Die Anwendung ist einfach, es wird nur die <a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-messageboxa%3FWT.mc_id%3D-blog-scottha" rel="nofollow">MessageBoxA-</a> Funktion mit der Anzeige des entsprechenden Dialogfelds aufgerufen, das sich ab den ersten Tagen unter Windows befindet.  Um die Funktion aufzurufen und das <a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.messageboxresult%3Fview%3Dnetframework-4.8%26WT.mc_id%3D-blog-scottha" rel="nofollow">Ergebnis zu erhalten</a> , wird DllImport / PInvoke verwendet. <br><br>  Ich habe diese Anwendung zum ersten Mal für Windows 3.11 gezeigt, weil sie cool ist.  In Wirklichkeit begann der Autor an dem Ort, an dem sein Experiment mit DOS endete.  Es kompiliert nativen C # -Code und danach existieren die Regeln nicht mehr. <br><br>  In diesem Beispiel wird es auf der Win16-Plattform und nicht auf Win32 ausgeführt.  1992 (ja, ich habe damals gelebt und programmiert und es in meinen Projekten verwendet!) Gab es jedoch eine bestimmte technologische Brücke namens <a href="https://en.wikipedia.org/wiki/Win32s" rel="nofollow">Win32s</a> : eine Teilmenge der Windows NT-APIs, die auf Windows 3.11 zurückportiert wurden.  Unter Berücksichtigung einiger Einschränkungen können Sie daher 32-Bit-Code schreiben und von Win16 aus auf Win32 zugreifen. <br><br>  Michal erkannte, dass die vom CoreRT AOT-Compiler im Jahr 2020 erstellten Objektdateien vom Linker aus dem Visual C ++ 2.0-Beispiel von 1994 zusammengesetzt werden konnten.  Das Ergebnis ist Maschinencode, der mit Win32s-Schnittstellen verknüpft ist, die unter 16-Bit-Windows 3.11 ausgeführt werden.  Die Magie.  Respektieren Sie Michalu. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/342/543/565/3425435658b7a8ff087b7de75760560d.png"><br>  <i><font color="gray">Einfache Hello World C # -Anwendung</font></i> <br><br><h1>  Ausführen von C # bei 8 KB unter DOS </h1><br>  Ich habe bereits über <a href="https://www.hanselman.com/blog/MakingATinyNETCore30EntirelySelfcontainedSingleExecutable.aspx" rel="nofollow">eigenständige ausführbare .NET Core 3.x-Dateien geschrieben</a> . Ich bin ein großer Fan davon.  Meine Anwendung wurde bereits auf 28 Megabyte reduziert.  Dies ist ziemlich viel, da es die .NET-Laufzeit und viele andere Ressourcen enthält.  Natürlich sollten Sie eine VM / Laufzeit nicht nach der Größe des minimal möglichen Programms beurteilen, aber Michal <a href="https://medium.com/%40MStrehovsky/building-a-self-contained-game-in-c-under-8-kilobytes-74c3cf60ea04" rel="nofollow">wollte sehen, bis zu</a> welchem ​​Limit Sie gehen können - und ein Ziel von 8000 Bytes festlegen! <br><br>  Das Programm arbeitet im <a href="https://www.hanselman.com/blog/OpportunityWindowsIsCompletelyMissingTheTextModeBoat.aspx" rel="nofollow">Textmodus, was meiner Meinung nach großartig ist</a> .  Außerdem ist kein Garbage Collector mehr erforderlich, da keine Ressourcenzuweisung erfolgt.  Dies bedeutet, dass Sie <i>new</i> nirgendwo verwenden können.  Keine Referenztypen. <br><br>  Um statische Arrays zu deklarieren, werden <code>fixed char []</code> -Felder verwendet: Sie müssen sich auf dem Stapel befinden, und wir haben einen <i>kleinen</i> Stapel. <br><br>  Wenn Sie versuchen, eine eigenständige .NET-Datei ausführbar zu machen, erhalten Sie zunächst eine 65-Megabyte-Datei, die die Anwendung, die Laufzeit und die Standardbibliotheken enthält. <br><br> <code>dotnet publish -r win-x64 -c Release</code> <br> <br>  Sie können <a href="https://www.hanselman.com/blog/BrainstormingCreatingASmallSingleSelfcontainedExecutableOutOfANETCoreApplication.aspx" rel="nofollow">ILLinker</a> und PublishedTrimmed verwenden, um das Tree Trimming von .NET Core 3.x aus zu optimieren. Auf diese Weise reduzieren Sie die Datei jedoch auf nur 25 Megabyte. <br><br>  Er hat versucht, Mono und mkbundle zu verwenden und die Größe auf 18,2 Megabyte zu bringen, hat dann aber einen Fehler festgestellt.  Und die Laufzeit ist noch da. <br><br>  Die einzig geeignete Laufzeit war daher CoreRT, das keine virtuelle Maschine, sondern nur Hilfsfunktionen enthält. <br><br> <code>dotnet publish -r win-x64 -c Release /p:Mode=CoreRT</code> <br> <br>  Er hat also 4,7 Megabyte, aber es ist immer noch zu viel.  Bei einigen Einstellungen können Sie bis zu 3 Megabyte gehen.  Sie können die Reflektion vollständig erweitern und 1,2 Megabyte erreichen.  Jetzt passt es auf eine Diskette! <br><br> <code>dotnet publish -r win-x64 -c Release /p:Mode=CoreRT-ReflectionFree</code> <br> <br>  Diese Größe von einem Megabyte scheint nur für das .NET SDK eine harte Grenze zu sein. <br><br>  Hier entfernt sich Michal <a href="https://medium.com/%40MStrehovsky/building-a-self-contained-game-in-c-under-8-kilobytes-74c3cf60ea04" rel="nofollow">von Standardwerkzeugen</a> .  Es führt einen <a href="" rel="nofollow">Neuimplementierungs-Stub für die grundlegenden Systemtypen aus</a> !  Anschließend wird es mit einigen magischen Schaltern neu kompiliert, sodass nur die IL-Version der ausführbaren Datei freigegeben wird. <br><br> <code>csc.exe /debug /O /noconfig /nostdlib /runtimemetadataversion:v4.0.30319 MiniBCL.cs Game\FrameBuffer.cs Game\Random.cs Game\Game.cs Game\Snake.cs Pal\Thread.Windows.cs Pal\Environment.Windows.cs Pal\Console.Windows.cs /out:zerosnake.ilexe /langversion:latest /unsafe</code> <br> <br>  Dann übergibt es dies an CoreRT, um den nativen Code zu erhalten. <br><br> <code>ilc.exe zerosnake.ilexe -o zerosnake.obj --systemmodule zerosnake --Os -g</code> <br> <br>  Und hier sind wir. <br><br><blockquote>  „Jetzt haben wir zerosnake.obj - eine Standardobjektdatei, die sich nicht von den Objektdateien unterscheidet, die von anderen nativen Compilern wie C oder C ++ erstellt wurden.  Der letzte Schritt ist, es zusammenzustellen. “ </blockquote><br>  Noch ein paar Tricks - und die Ausgabe ist 27 KB!  Anschließend entfernt er mehrere Schalter aus dem Linker, um verschiedene Elemente mit denselben Methoden zu deaktivieren und zu entfernen, die die Assembler-Entwickler verwenden. Es bleiben 8176 Byte übrig.  Epischer Thriller. <br><br> <code>link.exe /debug:full /subsystem:console zerosnake.obj /entry:__managed__Main kernel32.lib ucrt.lib /merge:.modules=.rdata /merge:.pdata=.rdata /incremental:no /DYNAMICBASE:NO /filealign:16 /align:16</code> <br> <br>  Folge <a href="https://twitter.com/MStrehovsky" rel="nofollow">Michal</a> auf <a href="https://twitter.com/MStrehovsky" rel="nofollow">Twitter</a> und applaudiere ihm. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485268/">https://habr.com/ru/post/de485268/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485240/index.html">Layout go pet Projekt auf VPS</a></li>
<li><a href="../de485256/index.html">Ivan Lilekvist und Kim Dotkom, ein großes Interview: Die Geschichte von Megaupload, Auslieferung an die Vereinigten Staaten, Freiheit, Bitcoin. Teil 1</a></li>
<li><a href="../de485260/index.html">13 Häufige Fehler für beginnende Business Analysten</a></li>
<li><a href="../de485264/index.html">Wie das Zip-Archiv aussieht und was wir damit machen können. Teil 4 - Das Archiv lesen</a></li>
<li><a href="../de485266/index.html">Habr-Wettbewerb: Gewinner des Ideenwettbewerbs</a></li>
<li><a href="../de485270/index.html">Hack admin</a></li>
<li><a href="../de485272/index.html">Taimyr Computer - Evolution ist umgekehrt</a></li>
<li><a href="../de485274/index.html">Moscow JS Meetup bei der Raiffeisenbank: senden Sie weiter</a></li>
<li><a href="../de485278/index.html">Die Hand Gottes. Gutschein-Hilfe</a></li>
<li><a href="../de485280/index.html">Geh Fakedb Datenbankemulation in Tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>