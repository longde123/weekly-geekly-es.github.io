<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游뱢游낕 游닎 游꼷 쮺칩mo depuramos un ECS auto-escrito en un navegador en un servidor de juegos? 游눊游 游 游돜游</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quiero compartir los mecanismos que utilizamos en el servidor para la depuraci칩n visual de la l칩gica del juego y las formas de cambiar los estados de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>쮺칩mo depuramos un ECS auto-escrito en un navegador en un servidor de juegos?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/424267/"><img src="https://habrastorage.org/webt/aj/cb/wp/ajcbwp0paiiumhk6qcv79bzrk9s.jpeg"><br><br>  Quiero compartir los mecanismos que utilizamos en el servidor para la depuraci칩n visual de la l칩gica del juego y las formas de cambiar los estados de los partidos en tiempo real. <br><br>  En art칤culos anteriores informaron en detalle (la lista inmediatamente debajo del corte) sobre c칩mo se organiza ECS en nuestro nuevo proyecto en desarrollo y c칩mo elegir soluciones listas para usar.  Una de esas soluciones fue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Entitas</a> .  En primer lugar, no nos conven칤a debido a la falta de almacenamiento del historial del estado, pero me gust칩 mucho porque en Unity puedes ver visual y gr치ficamente todas las estad칤sticas sobre el uso de entidades, componentes, el sistema de agrupaci칩n, el rendimiento de cada sistema, etc. <br><br>  Esto nos inspir칩 a crear nuestras propias herramientas en el servidor del juego para ver lo que sucede en el partido con los jugadores, c칩mo juegan, c칩mo funcionar치 el sistema en su conjunto.  En el cliente, tambi칠n tenemos desarrollos similares para la depuraci칩n visual del juego, pero las herramientas en el cliente son un poco m치s simples en comparaci칩n con lo que hicimos en el servidor. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/zv/pe/ov/zvpeov6a_phs92o23ds1ag3h23c.png"><br><br>  La lista prometida de todos los art칤culos publicados sobre el proyecto: <br><br><ol><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C칩mo nos lanzamos en un tirador m칩vil de ritmo r치pido: tecnolog칤a y enfoques</a> ". </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C칩mo y por qu칠 escribimos nuestro ECS</a> ". </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Como escribimos el c칩digo de red del tirador PvP m칩vil: sincronizaci칩n del jugador en el cliente</a> ". </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Interacci칩n cliente-servidor en un nuevo dispositivo m칩vil PvP shooter y servidor de juegos: problemas y soluciones</a> ". </li></ol><br>  Ahora al final de este art칤culo.  Para comenzar, escribimos un peque침o servidor web que expuso algunas API.  El servidor mismo simplemente abre el puerto del socket y escucha las solicitudes http en ese puerto. <br><br><div class="spoiler">  <b class="spoiler_title">El procesamiento es una forma bastante est치ndar</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleHttp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Socket socket</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> buf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">8192</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bufLen = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> recvBuf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">8192</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bodyStart = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(bodyStart == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> recvLen = socket.Receive(recvBuf); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(recvLen == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } Buffer.BlockCopy(recvBuf, <span class="hljs-number"><span class="hljs-number">0</span></span>, buf, bufLen, recvLen); bufLen += recvLen; bodyStart = FindBodyStart(buf, bufLen); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> headers = Encoding.UTF8.GetString(buf, <span class="hljs-number"><span class="hljs-number">0</span></span>, bodyStart - <span class="hljs-number"><span class="hljs-number">2</span></span>).Replace(<span class="hljs-string"><span class="hljs-string">"\r"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).Split(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> main = headers[<span class="hljs-number"><span class="hljs-number">0</span></span>].Split(<span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> reqMethod = ParseRequestMethod(main[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reqMethod == RequestMethod.Invalid) { SendResponse(<span class="hljs-number"><span class="hljs-number">400</span></span>, socket); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// receive POST body var body = string.Empty; if(reqMethod == RequestMethod.Post) { body = ReceiveBody(buf, bufLen, headers, bodyStart, socket); if(body == null) { return true; } } var path = main[1]; if(path == "/") { path = "/index.html"; } // try to serve by a file if(File.Exists(_docRoot + path)) { var content = File.ReadAllBytes(_docRoot + path); if (reqMethod == RequestMethod.Head) { content = null; } SendResponse(200, socket, content, GuessMime(path)); return true; } // try to serve by a handle foreach(var handler in _handlers) { if(handler.Match(reqMethod, path)) { if (handler.Async) { _jobs.Enqueue(() =&gt; { RunHandler(socket, path, body, handler); socket.Shutdown(SocketShutdown.Both); socket.Close(); }); return false; } else { RunHandler(socket, path, body, handler); return true; } } } // nothing found :-( var msg = "File not found " + path + "\ndoc root " + _docRoot + "\ncurrent dir " + Directory.GetCurrentDirectory(); SendResponse(404, socket, Encoding.UTF8.GetBytes(msg)); return true; }</span></span></code> </pre> <br></div></div><br>  Luego registramos varios manejadores especiales para cada solicitud. <br>  Uno de ellos es el manejador de ver todos los partidos en el juego.  Tenemos una clase especial que controla el tiempo de vida de todos los partidos. <br><br><div class="spoiler">  <b class="spoiler_title">Para un desarrollo r치pido, simplemente le agregaron un m칠todo, emitiendo una lista de coincidencias en sus puertos en formato json</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ListMatches</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> method, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb.Append(<span class="hljs-string"><span class="hljs-string">"[\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> match <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _matches.Values) { sb.Append(<span class="hljs-string"><span class="hljs-string">"{id:\""</span></span> + match.GameId + <span class="hljs-string"><span class="hljs-string">"\""</span></span> + <span class="hljs-string"><span class="hljs-string">", www:"</span></span> + match.Tool.Port + <span class="hljs-string"><span class="hljs-string">"},\n"</span></span> ); } sb.Append(<span class="hljs-string"><span class="hljs-string">"]"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> </pre> <br></div></div><br><img src="https://habrastorage.org/webt/bd/ji/ya/bdjiyau4_ltyitc6qzvz4ndt18g.png"><br><br>  Al hacer clic en el enlace con el partido, vaya al men칰 de control.  Aqu칤 se vuelve mucho m치s interesante. <br><br>  Cada coincidencia en el ensamblaje de depuraci칩n del servidor proporciona datos completos sobre s칤 mismo.  Incluyendo el GameState sobre el que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">escribimos</a> .  Perm칤tame recordarle que este es esencialmente el estado de toda la coincidencia, incluidos los datos est치ticos y din치micos.  Con estos datos, podemos mostrar diversa informaci칩n sobre la coincidencia en html.  Tambi칠n podemos cambiar directamente estos datos, pero m치s sobre eso m치s adelante. <br><br>  El primer enlace conduce al registro de coincidencias est치ndar: <br><br><img src="https://habrastorage.org/webt/3t/_y/os/3t_yosvjeysn_9nsrxa_x4vf6xi.png"><br><br>  En 칠l, mostramos los principales datos 칰tiles sobre las conexiones, la cantidad de datos transferidos, los principales ciclos de vida de los caracteres y otros registros. <br><br>  El segundo enlace de GameViewer conduce a una representaci칩n visual real del partido: <br><br><img src="https://habrastorage.org/webt/l8/1j/ix/l81jixqzc7yrt17hplf-u2skmxc.png"><br><br>  El generador que crea el c칩digo ECS para que empaquemos los datos tambi칠n crea un c칩digo adicional para representar los datos en json.  Esto le permite leer con bastante facilidad la estructura de coincidencia de json y representarla utilizando la biblioteca three.js en WebGL para la representaci칩n. <br><br><div class="spoiler">  <b class="spoiler_title">La estructura de datos se parece a esto</b> <div class="spoiler_text"><pre> <code class="cs hljs">{ enums: { <span class="hljs-string"><span class="hljs-string">"HostilityLayer"</span></span>: { <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-string"><span class="hljs-string">"PlayerTeam1"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-string"><span class="hljs-string">"PlayerTeam2"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-string"><span class="hljs-string">"NeutralShootable"</span></span>, } }, components: { Transform: { name: <span class="hljs-string"><span class="hljs-string">'Transform'</span></span>, fields: { Angle: {type: <span class="hljs-string"><span class="hljs-string">"float"</span></span>}, Position: {type: <span class="hljs-string"><span class="hljs-string">"Vector2"</span></span>}, }, }, TransformExact: { name: <span class="hljs-string"><span class="hljs-string">'TransformExact'</span></span>, fields: { Angle: {type: <span class="hljs-string"><span class="hljs-string">"float"</span></span>}, Position: {type: <span class="hljs-string"><span class="hljs-string">"Vector2"</span></span>}, } } }, tables: { Transform: { name: <span class="hljs-string"><span class="hljs-string">'Transform'</span></span>, component: <span class="hljs-string"><span class="hljs-string">'Transform'</span></span>, }, TransformExact: { name: <span class="hljs-string"><span class="hljs-string">'TransformExact'</span></span>, component: <span class="hljs-string"><span class="hljs-string">'TransformExact'</span></span>, hint: <span class="hljs-string"><span class="hljs-string">"Copy of Transform for these entities that need full precision when sent over network"</span></span>, } } }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Y el ciclo de renderizado de cuerpos din치micos (en nuestro caso, jugadores) es as칤</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rulebook = {}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> worldstate = {}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> physics = {}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> update_dynamic_physics; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> camera, scene, renderer; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> controls; <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init3D</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { camera = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.PerspectiveCamera(<span class="hljs-number"><span class="hljs-number">60</span></span>, window.innerWidth / window.innerHeight, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>); camera.up.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); scene = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Scene(); scene.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.AmbientLight( <span class="hljs-number"><span class="hljs-number">0x404040</span></span> ) ); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> light = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.DirectionalLight( <span class="hljs-number"><span class="hljs-number">0xFFFFFF</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> ); light.position.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-number"><span class="hljs-number">-11</span></span>, <span class="hljs-number"><span class="hljs-number">-23</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>); scene.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>( light ); renderer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.WebGLRenderer(); renderer.setPixelRatio( window.devicePixelRatio ); renderer.setSize( window.innerWidth, window.innerHeight ); document.body.appendChild( renderer.domElement ); controls = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.OrbitControls( camera, renderer.domElement ); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cam = localStorage.getObject(<span class="hljs-string"><span class="hljs-string">'gv_camera'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cam) { camera.matrix.fromArray(cam.matrix); camera.matrix.decompose(camera.position, camera.quaternion, camera.scale); controls.target.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(cam.target.x, cam.target.y, cam.target.z); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { camera.position.x = <span class="hljs-number"><span class="hljs-number">40</span></span>; camera.position.y = <span class="hljs-number"><span class="hljs-number">40</span></span>; camera.position.z = <span class="hljs-number"><span class="hljs-number">50</span></span>; controls.target.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } window.addEventListener( <span class="hljs-string"><span class="hljs-string">'resize'</span></span>, onWindowResize, <span class="hljs-literal"><span class="hljs-literal">false</span></span> ); } init3D(); <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_recv_dynamic</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span> { eval(<span class="hljs-string"><span class="hljs-string">'physics = '</span></span> + r + <span class="hljs-string"><span class="hljs-string">';'</span></span>); update_dynamic_physics(); sleep(<span class="hljs-number"><span class="hljs-number">10</span></span>) .then(() =&gt; ajax(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-string"><span class="hljs-string">"/physics/dynamic/"</span></span>)) .then(handle_recv_dynamic); } (<span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init_dynamic_physics</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> colour = <span class="hljs-number"><span class="hljs-number">0x4B5440</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> material = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.MeshLambertMaterial({color: colour, flatShading: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> meshes = {}; update_dynamic_physics = function () { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i, p, mesh; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> to_del = {}; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> meshes) to_del[i] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> physics) { p = physics[i]; mesh = meshes[p.id]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mesh) { mesh = create_shapes(worldstate, <span class="hljs-string"><span class="hljs-string">'Dynamic'</span></span>, p, material, layers.dynamic_collider); meshes[p.id] = mesh; } mesh.position.x = p.pos[<span class="hljs-number"><span class="hljs-number">0</span></span>]; mesh.position.y = p.pos[<span class="hljs-number"><span class="hljs-number">1</span></span>]; delete to_del[p.id]; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> to_del) { mesh = meshes[i]; scene.<span class="hljs-keyword"><span class="hljs-keyword">remove</span></span>(mesh); delete meshes[i]; } } })();</code> </pre> <br></div></div><br>  Casi todas las entidades que tienen la l칩gica del movimiento en nuestro mundo f칤sico tienen un componente Transformar.  Para ver una lista de todos los componentes, haga clic en el enlace WorldState Table Editor. <br><br><img src="https://habrastorage.org/webt/lr/da/mw/lrdamwju2zyx5-o-beth_7azahe.png"><br><br>  En el men칰 desplegable anterior, puede seleccionar varios tipos de componentes y ver su estado actual.  Entonces, la figura de arriba muestra todas las transformaciones en el juego.  Lo m치s interesante: si cambia los valores de la transformaci칩n en este editor, el jugador u otra entidad del juego se teletransportar치 bruscamente al punto deseado (a veces nos divertimos en las pruebas de juego). <br><br>  El cambio de datos en una coincidencia real al editar una tabla html se produce porque extraemos un enlace especial a esta tabla, que contiene el nombre de la tabla, el campo y los datos nuevos: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_edit</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id, table_name, field_name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = table_name + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + field_name + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + id + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; ajax(<span class="hljs-string"><span class="hljs-string">"POST"</span></span>, tableset_name + <span class="hljs-string"><span class="hljs-string">"/edit/"</span></span>, data); }</code> </pre> <br>  El servidor del juego se suscribe a la URL deseada, exclusiva de la tabla, gracias al c칩digo generado: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterEditorHandlers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Func&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;&gt; addHandler, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path, Func&lt;TableSet&gt; ts</span></span></span><span class="hljs-function">)</span></span> { addHandler(path + <span class="hljs-string"><span class="hljs-string">"/data/"</span></span>, (p, b) =&gt; EditorPackJson(ts())); addHandler(path + <span class="hljs-string"><span class="hljs-string">"/edit/"</span></span>, (p, b) =&gt; EditorUpdate(ts(), b)); addHandler(path + <span class="hljs-string"><span class="hljs-string">"/ins/"</span></span>, (p, b) =&gt; EditorInsert(ts(), b)); addHandler(path + <span class="hljs-string"><span class="hljs-string">"/del/"</span></span>, (p, b) =&gt; EditorDelete(ts(), b)); addHandler(path + <span class="hljs-string"><span class="hljs-string">"/create/"</span></span>, (p, b) =&gt; EditorCreateEntity(ts(), b)); }</code> </pre> <br>  Otra caracter칤stica 칰til del editor visual nos permite monitorear la plenitud del b칰fer de entrada de los jugadores.  Como se desprende de los art칤culos anteriores del ciclo, esto es necesario para mantener un juego c칩modo para los clientes, para que el juego no se contraiga y el mundo no se quede atr치s. <br><br><img src="https://habrastorage.org/webt/z4/wa/hd/z4wahdgsfjz0gmxdcsa4uzdyzcu.png"><br><br>  El eje vertical del gr치fico es el n칰mero de entradas de jugadores actualmente disponibles en el b칰fer de entrada en el servidor.  Idealmente, este n칰mero no deber칤a ser mayor o menor que 1. Pero debido a la inestabilidad de la red y al ajuste constante de los clientes a estos criterios, el gr치fico generalmente oscila en la vecindad inmediata de esta marca.  Si el horario de entrada para un jugador se reduce dr치sticamente, entendemos que el cliente probablemente perdi칩 la conexi칩n.  Si cae a un valor bastante grande y luego se recupera abruptamente, esto significa que el cliente est치 experimentando serios problemas con la estabilidad de la conexi칩n. <br><br>  ***** <br><br>  Las caracter칤sticas descritas de nuestro editor de partidos en el servidor del juego te permiten depurar de manera efectiva los momentos de la red y del juego y monitorear los partidos en tiempo real.  Pero en prod, estas funciones est치n deshabilitadas, ya que crean una carga significativa en el servidor y el recolector de basura.  Vale la pena se침alar que el sistema fue escrito en muy poco tiempo, gracias al generador de c칩digo ECS ya existente.  S칤, el servidor no est치 escrito de acuerdo con todas las reglas de los est치ndares web modernos, pero nos ayuda mucho en el trabajo diario y la depuraci칩n del sistema.  Tambi칠n evoluciona gradualmente, adquiriendo nuevas oportunidades.  Cuando haya suficientes, volveremos a este tema. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es424267/">https://habr.com/ru/post/es424267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es424257/index.html">Mapas de hex치gono en Unity: partes 1-3</a></li>
<li><a href="../es424259/index.html">Semana de la seguridad 36: Telnet deber칤a estar cerrado</a></li>
<li><a href="../es424261/index.html">C칩mo resolver cualquier problema de programaci칩n</a></li>
<li><a href="../es424263/index.html">Actualizaci칩n de IDA Pro. Arreglamos jambas de m칩dulos de procesador</a></li>
<li><a href="../es424265/index.html">Revisi칩n de la bicicleta el칠ctrica Twitter Mantis E-1</a></li>
<li><a href="../es424271/index.html">Miner칤a de datos Pubmed y Pubchem - bases de datos de informaci칩n m칠dica y bioqu칤mica</a></li>
<li><a href="../es424273/index.html">Caja de cambios de una etapa accionada por un motor paso a paso</a></li>
<li><a href="../es424275/index.html">La energ칤a en la c칠lula. Uso y almacenaje</a></li>
<li><a href="../es424277/index.html">Emigraci칩n y todo sobre eso en los blogs de Telegram</a></li>
<li><a href="../es424279/index.html">C칩mo abrir una IP en Alemania, si eres un programador, y no llenar conos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>