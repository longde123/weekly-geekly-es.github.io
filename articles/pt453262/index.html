<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüç≥ üë≤üèº üë¶ Onde est√£o suas constantes armazenadas no microcontrolador CortexM (usando o compilador C ++ IAR como exemplo) üåï üë®üèΩ‚Äç‚öïÔ∏è üë©‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ensino meus alunos como usar o microcontrolador STM32F411RE, no qual existem 512 kB de ROM e 128 kB de RAM 
 Geralmente neste microcontrolador, um pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Onde est√£o suas constantes armazenadas no microcontrolador CortexM (usando o compilador C ++ IAR como exemplo)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453262/">  Ensino meus alunos como usar o microcontrolador STM32F411RE, no qual existem 512 kB de ROM e 128 kB de RAM <br>  Geralmente neste microcontrolador, um programa √© gravado na mem√≥ria <u>ROM</u> e, na <u>RAM, os</u> dados a serem alterados geralmente s√£o necess√°rios para criar constantes na <u>ROM</u> . <br>  No microcontrolador STM32F411RE, <u>ROM</u> , a mem√≥ria est√° localizada em endere√ßos com <i>0x08000000 ... 0x0807FFFF</i> e <u>RAM</u> com <i>0x20000000 ... 0x2001FFFF.</i> <br><br>  E se todas as configura√ß√µes do vinculador estiverem corretas, o aluno calcula que, em um c√≥digo t√£o simples, sua constante est√° na <u>ROM</u> : <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WantToBeInROM</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: WantToBeInROM(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): i(value) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> WantToBeInROM </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myConstInROM</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; &amp;myConstInROM &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> ; }</code> </pre> <br>  Voc√™ tamb√©m pode tentar responder √† pergunta: onde est√° o myConstInROM constante na <u>ROM</u> ou na <u>RAM</u> ? <br><br>  Se voc√™ respondeu a essa pergunta que na <u>ROM</u> , eu o parabenizo, na verdade provavelmente voc√™ est√° errado, a constante geralmente est√° na <u>RAM</u> e para descobrir como colocar correta e corretamente suas constantes na <u>ROM</u> - bem-vindo ao gato. <br><a name="habracut"></a><br><h3>  1. Introdu√ß√£o </h3><br>  Primeiro, uma pequena digress√£o, por que se preocupar com isso? <br>  Ao desenvolver software cr√≠tico de seguran√ßa para dispositivos de medi√ß√£o que estejam em conformidade com a IEC 61508-3: 2010 ou um equivalente dom√©stico da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GOST IEC 61508-3-2018</a> , v√°rios pontos devem ser levados em considera√ß√£o que n√£o s√£o cr√≠ticos para o software convencional. <br><br>  <i>A principal mensagem deste padr√£o √© que o software deve detectar qualquer falha que afete a confiabilidade do sistema e coloc√°-lo no modo "travar"</i> <br><br>  Al√©m de falhas mec√¢nicas √≥bvias, por exemplo, falha no sensor ou degrada√ß√£o e falha de componentes eletr√¥nicos, erros causados ‚Äã‚Äãpela falha do ambiente de software, por exemplo, microcontrolador de <u>RAM</u> ou <u>ROM</u> , devem ser detectados. <br><br>  E se nos dois primeiros casos, √© poss√≠vel detectar um erro apenas de maneiras indiretas um pouco confusas (existem algoritmos que determinam a falha do sensor, por exemplo, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M√©todo de avalia√ß√£o do estado de um conversor t√©rmico de resist√™ncia</a> ), ent√£o, no caso de uma falha no ambiente de software, isso pode ser feito com muito mais facilidade, por exemplo, uma falha de mem√≥ria pode verifique com uma simples verifica√ß√£o de integridade dos dados.  Se a integridade dos dados for violada, interprete isso como uma falha de mem√≥ria. <br><br>  Se os dados estiverem na RAM por um longo per√≠odo sem verifica√ß√£o e atualiza√ß√£o, a probabilidade de que algo lhes aconte√ßa devido √† falha da <u>RAM</u> se tornar√° mais alta com o tempo.  Um exemplo s√£o alguns coeficientes de calibra√ß√£o para calcular a temperatura definida na f√°brica e gravada em uma EEPROM externa. Na inicializa√ß√£o, elas s√£o lidas e gravadas na <u>RAM</u> e ficam l√° at√© que a energia seja desligada.  E na vida, o sensor de temperatura pode trabalhar durante todo o per√≠odo do intervalo de calibra√ß√£o, at√© 3-5 anos.  Obviamente, esses dados de <u>RAM</u> devem ser protegidos e verificados periodicamente quanto √† sua integridade. <br><br>  Mas tamb√©m existem dados, como uma constante declarada simplesmente para facilitar a leitura, um objeto de um driver de LCD, SPI ou I2C, que n√£o deve ser alterado, √© criado uma vez e n√£o √© exclu√≠do at√© que a energia seja desligada. <br><br>  Esses dados s√£o mais bem guardados na <u>ROM</u> .  √â mais confi√°vel do ponto de vista da tecnologia e √© muito mais f√°cil verific√°-la, basta ler periodicamente a soma de verifica√ß√£o de toda a mem√≥ria somente leitura em alguma tarefa de baixa prioridade.  Se a soma de verifica√ß√£o n√£o corresponder, voc√™ pode simplesmente relatar a falha da <u>ROM</u> e o sistema de diagn√≥stico exibir√° um acidente. <br><br>  Se esses dados estiverem na <u>RAM</u> , seria problem√°tico ou at√© imposs√≠vel determinar sua integridade devido ao fato de n√£o estar claro onde os dados imut√°veis ‚Äã‚Äãest√£o na RAM e onde s√£o mut√°veis, o vinculador o coloca como deseja e para proteger cada objeto de RAM com uma soma de verifica√ß√£o paran√≥ia. <br><br>  Portanto, a maneira mais f√°cil √© ter 100% de certeza de que os dados constantes est√£o na <u>ROM</u> .  Como fazer isso, eu quero tentar explicar.  Mas primeiro voc√™ precisa falar sobre a organiza√ß√£o da mem√≥ria no ARM. <br><br><h3>  Organiza√ß√£o da mem√≥ria </h3><br>  Como voc√™ sabe, o n√∫cleo do ARM possui uma arquitetura de Harvard - os barramentos de dados e c√≥digo s√£o separados.  Normalmente, isso significa que se sup√µe que haja uma mem√≥ria separada para programas e uma mem√≥ria separada para dados.  Mas o fato √© que o ARM √© uma arquitetura de Harvard modificada, ou seja,  o acesso √† mem√≥ria √© realizado em um barramento e o dispositivo de gerenciamento de mem√≥ria j√° fornece a separa√ß√£o de barramentos usando sinais de controle: leia, escreva ou selecione uma √°rea de mem√≥ria. <br><br>  Assim, dados e c√≥digo podem estar na mesma √°rea de mem√≥ria.  Neste espa√ßo de endere√ßo √∫nico pode ser localizado e mem√≥ria <u>ROM</u> e <u>RAM</u> e perif√©ricos.  E isso significa que, de fato, tanto o c√≥digo quanto os dados podem chegar at√© onde depende do compilador e vinculador. <br><br>  Portanto, para distinguir entre as √°reas de mem√≥ria da <u>ROM (Flash)</u> e <u>RAM,</u> elas geralmente s√£o indicadas nas configura√ß√µes do vinculador, por exemplo, na IAR 8.40.1, √© assim: <br><br><pre> <code class="cpp hljs">define symbol __ICFEDIT_region_ROM_start__ = <span class="hljs-number"><span class="hljs-number">0x08000000</span></span>; define symbol __ICFEDIT_region_ROM_end__ = <span class="hljs-number"><span class="hljs-number">0x0807FFFF</span></span>; define symbol __ICFEDIT_region_RAM_start__ = <span class="hljs-number"><span class="hljs-number">0x20000000</span></span>; define symbol __ICFEDIT_region_RAM_end__ = <span class="hljs-number"><span class="hljs-number">0x2001FFFF</span></span>; define region ROM_region = mem:[from __ICFEDIT_region_ROM_start__ to __ICFEDIT_region_ROM_end__]; define region RAM_region = mem:[from __ICFEDIT_region_RAM_start__ to __ICFEDIT_region_RAM_end__];</code> </pre><br>  <u>A RAM</u> neste microcontrolador est√° localizada em <i>0x20000000 ... 0x2001FFF</i> e a <u>ROM</u> em <i>0x008000000 ... 0x0807FFFF</i> . <br>  Voc√™ pode alterar facilmente o endere√ßo inicial ROM_start para o endere√ßo RAM, digamos RAM_start e o endere√ßo final ROM_end__ para RAM_end__, e seu programa estar√° completamente localizado na RAM. <br>  Voc√™ pode at√© fazer o oposto e especificar a <u>RAM</u> na √°rea de mem√≥ria da <u>ROM</u> , e seu programa ser√° montado e piscar√° com sucesso, embora n√£o funcione :) <br>  Alguns microcontroladores, como o AVR, inicialmente possuem um espa√ßo de endere√ßo separado para a mem√≥ria do programa, a mem√≥ria de dados e os perif√©ricos e, portanto, esses truques n√£o funcionam l√°, e o programa √© gravado na <u>ROM</u> por padr√£o. <br><br><blockquote>  Todo o espa√ßo de endere√ßo no CortexM √© √∫nico e o c√≥digo e os dados podem ser localizados em qualquer lugar.  Usando as configura√ß√µes do vinculador, voc√™ pode definir a regi√£o para os endere√ßos <u>ROM</u> e <u>RAM</u> .  O IAR <i>localiza o</i> segmento de c√≥digo <i>.text</i> na regi√£o da <u>ROM</u> </blockquote><br><h3>  Arquivo e segmentos de objetos </h3><br>  Acima, mencionei o segmento de c√≥digo, vamos ver o que √©. <br><br>  Um arquivo de objeto separado √© criado para cada m√≥dulo compilado, que cont√©m as seguintes informa√ß√µes: <br><br><ul><li>  Segmentos de c√≥digo e dados </li><li>  Informa√ß√µes sobre depura√ß√£o do DWARF </li><li>  Tabela de caracteres </li></ul><br>  Estamos interessados ‚Äã‚Äãem <i>segmentos de</i> c√≥digo e dados.  <i>Um segmento</i> √© um elemento que cont√©m um peda√ßo de c√≥digo ou dados que deve ser colocado em um endere√ßo f√≠sico na mem√≥ria.  Um segmento pode conter v√°rios fragmentos, geralmente um fragmento para cada vari√°vel ou fun√ß√£o.  Um segmento pode ser colocado na <u>ROM</u> e na <u>RAM</u> . <br>  Cada segmento tem um nome e um atributo que define seu conte√∫do.  O atributo √© usado para definir um segmento na configura√ß√£o do vinculador.  Por exemplo, os atributos podem ser: <br><br><ul><li>  c√≥digo - c√≥digo execut√°vel </li><li>  readonly - vari√°veis ‚Äã‚Äãconstantes </li><li>  readwrite - vari√°veis ‚Äã‚Äãinicializadas </li><li>  zeroinit - vari√°veis ‚Äã‚Äãinicializadas com zero </li></ul><br>  Obviamente, existem outros tipos de segmentos, por exemplo, segmentos contendo informa√ß√µes de depura√ß√£o, mas estaremos interessados ‚Äã‚Äãapenas naqueles que cont√™m c√≥digo ou dados de nosso aplicativo. <br><br>  Em geral, um segmento √© o menor bloco vincul√°vel.  No entanto, se necess√°rio, o vinculador tamb√©m pode indicar blocos ainda menores (fragmentos).  N√£o consideraremos essa op√ß√£o, faremos com segmentos. <br><br>  Durante a compila√ß√£o, dados e fun√ß√µes s√£o colocados em diferentes segmentos.  E durante a vincula√ß√£o, o vinculador atribui endere√ßos f√≠sicos reais a diferentes segmentos.  O compilador IAR possui nomes de segmentos predefinidos, alguns dos quais fornecerei abaixo: <br><br><ul><li>  <i>.bss</i> - Cont√©m vari√°veis ‚Äã‚Äãest√°ticas e globais inicializadas em 0 </li><li>  <i>.CSTACK</i> - Cont√©m a pilha usada pelo programa </li><li>  <i>.data</i> - Cont√©m vari√°veis ‚Äã‚Äãinicializadas est√°ticas e globais </li><li>  <i>.data_init</i> - cont√©m os valores iniciais dos dados na se√ß√£o .data se a diretiva de inicializa√ß√£o do vinculador for usada </li><li>  <i>HEAP</i> - cont√©m a pilha usada para hospedar dados din√¢micos </li><li>  <i>.intvec</i> - cont√©m uma tabela de vetores de interrup√ß√£o </li><li>  <i>.rodata</i> - Cont√©m dados constantes </li><li>  <i>.text</i> - Cont√©m c√≥digo do programa </li></ul><br>  Para entender onde as constantes est√£o localizadas, estaremos interessados ‚Äã‚Äãapenas em segmentos <br>  <i>.rodata</i> - um segmento no qual constantes s√£o armazenadas, <br>  <i>.data</i> - um segmento no qual todas as vari√°veis ‚Äã‚Äãest√°ticas e globais inicializadas s√£o armazenadas, <br>  <i>.bss</i> - um segmento no qual todas as vari√°veis ‚Äã‚Äãest√°ticas e globais de <i>dados</i> inicializadas com zero (0) s√£o armazenadas, <br>  <i>.text</i> - um segmento para armazenar c√≥digo. <br><br>  Na pr√°tica, isso significa que se voc√™ definir a vari√°vel <code>int val = 3</code> , a vari√°vel em si ser√° localizada pelo compilador no segmento <i>.data</i> e marcada com o atributo <i>readwrite</i> , e o n√∫mero 3 poder√° ser colocado no segmento <i>.text</i> ou no segmento <i>.rodata</i> ou, se uma diretiva especial para o vinculador em <i>.data_init √© aplicada</i> e tamb√©m √© marcada como <i>somente leitura por ele</i> . <br><br>  O segmento <i>.rodata</i> cont√©m dados constantes e inclui vari√°veis ‚Äã‚Äãconstantes, seq√º√™ncias de caracteres, literais agregados e assim por diante.  E <u><b>esse segmento pode ser colocado em qualquer lugar da mem√≥ria.</b></u> <br><br>  Agora fica mais claro o que √© prescrito nas configura√ß√µes do vinculador e por que: <br><br><pre> <code class="cpp hljs">place in ROM_region { readonly }; <span class="hljs-comment"><span class="hljs-comment">//   .rodata  .data_init (  )  ROM: place in RAM_region { readwrite, //   .data, .bss,  .noinit block STACK }; //  STACK  HEAP  RAM</span></span></code> </pre><br>  Ou seja, todos os dados marcados com o atributo <i>somente leitura</i> devem ser colocados em ROM_region.  Assim, dados de diferentes segmentos, mas marcados com o atributo readonly, podem entrar na ROM. <br><br><div class="spoiler">  <b class="spoiler_title">Bem, isso significa que todas as constantes devem estar na ROM, mas por que, no nosso c√≥digo, no come√ßo do artigo, o objeto constante ainda est√° na RAM?</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WantToBeInROM</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: WantToBeInROM(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): i(value) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> WantToBeInROM </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myConstInROM</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; &amp;myConstInROM &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> ; }</code> </pre><br></div></div><br><br><h3>  Dados constantes </h3><br>  Antes de esclarecer a situa√ß√£o, lembremos primeiro que vari√°veis ‚Äã‚Äãglobais s√£o criadas na mem√≥ria compartilhada, vari√°veis ‚Äã‚Äãlocais, ou seja,  vari√°veis ‚Äã‚Äãdeclaradas dentro de fun√ß√µes "normais" s√£o criadas na pilha ou nos registradores e vari√°veis ‚Äã‚Äãlocais est√°ticas tamb√©m s√£o criadas na mem√≥ria compartilhada. <br><br>  O que isso significa em C ++.  Vejamos um exemplo: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C3, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C5, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C6)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; C1 &lt;&lt; C2 &lt;&lt; C3 &lt;&lt; C4 &lt;&lt; C5 &lt;&lt; C6 &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//     constexpr int Case1 = 1 ; //  (      ) const int Case2 = 2; int main() { //  . const int Case3 = 3 ; // . static const int Case4 = 4 ; //      ,     . constexpr int Case5 = Case1 + 5 ; //     . static constexpr int Case6 = 6 ; foo(Case1,Case2,Case3,Case4,Case5,Case6); return 1; }</span></span></code> </pre><br>  Isso tudo s√£o dados constantes.  Mas para qualquer um deles a regra de cria√ß√£o descrita acima se aplica, vari√°veis ‚Äã‚Äãlocais s√£o criadas na pilha.  Portanto, com nossas configura√ß√µes de vinculador, deve ser assim: <br><br><ul><li>  A constante global Case1 deve estar na <u>ROM</u> .  No segmento .rodata </li><li>  A constante global Case2 deve estar em <u>ROM</u> .  No segmento .rodata </li><li>  A constante local Case3 deve estar na <u>RAM</u> (a constante foi criada na pilha no segmento STACK) </li><li>  A constante est√°tica Case4 deve estar na <u>ROM</u> .  No segmento .rodata </li><li>  A constante local Case5 deve estar na <u>RAM</u> (um caso interessante, mas √© exatamente id√™ntico ao Caso 3.) </li><li>  A constante est√°tica Case6 deve estar na <u>ROM</u> .  No segmento .rodata </li></ul><br>  Agora vamos examinar as informa√ß√µes de depura√ß√£o e o arquivo de mapa gerado.  O depurador mostra em quais endere√ßos essas constantes est√£o. <br><br><img src="https://habrastorage.org/webt/n_/x9/at/n_x9atq0wduhrlaqbrhiudu5qc8.png" alt="imagem"><br><br>  Como eu disse antes, os endere√ßos 0x0800 ... s√£o endere√ßos <u>ROM</u> e 0x200 ... s√£o <u>RAM</u> .  Vamos ver em quais segmentos o compilador distribuiu essas constantes: <br><br><pre> <code class="cmake hljs"> .rodata const <span class="hljs-number"><span class="hljs-number">0</span></span>x800'<span class="hljs-number"><span class="hljs-number">4</span></span>e2c <span class="hljs-number"><span class="hljs-number">0</span></span>x4 main.o //Case1 .rodata const <span class="hljs-number"><span class="hljs-number">0</span></span>x800'<span class="hljs-number"><span class="hljs-number">4</span></span>e30 <span class="hljs-number"><span class="hljs-number">0</span></span>x4 main.o //Case2 .rodata const <span class="hljs-number"><span class="hljs-number">0</span></span>x800'<span class="hljs-number"><span class="hljs-number">4</span></span>e34 <span class="hljs-number"><span class="hljs-number">0</span></span>x4 main.o //Case4 .rodata const <span class="hljs-number"><span class="hljs-number">0</span></span>x800'<span class="hljs-number"><span class="hljs-number">4</span></span>e38 <span class="hljs-number"><span class="hljs-number">0</span></span>x4 main.o //Case6</code> </pre> <br>  Quatro constantes globais e est√°ticas ca√≠ram no segmento <i>.rodata</i> e duas vari√°veis ‚Äã‚Äãlocais n√£o ca√≠ram no arquivo de mapa porque s√£o criadas na pilha e seu endere√ßo corresponde aos endere√ßos da pilha.  O segmento CSTACK come√ßa em 0x2000'2488 e termina em 0x2000'0488.  Como voc√™ pode ver na figura, as constantes s√£o criadas apenas no in√≠cio da pilha. <br><br><blockquote>  O compilador coloca constantes globais e est√°ticas no segmento <i>.rodata</i> , cuja localiza√ß√£o √© especificada nas configura√ß√µes do vinculador. <br></blockquote><br>  Vale a pena notar outro ponto importante, a <b>inicializa√ß√£o</b> .  Vari√°veis ‚Äã‚Äãglobais e est√°ticas, incluindo constantes, devem ser inicializadas.  E isso pode ser feito de v√°rias maneiras.  Se houver uma constante no segmento <i>.rodata</i> , a inicializa√ß√£o ocorre no est√°gio de compila√ß√£o, ou seja,  o valor √© gravado imediatamente no endere√ßo em que a constante est√° localizada.  Se essa for uma vari√°vel regular, a inicializa√ß√£o poder√° ocorrer copiando o valor da mem√≥ria ROM para o endere√ßo da vari√°vel global: <br><br>  Por exemplo, se a vari√°vel global <code>int i = 3</code> definida, o compilador a <i>definir√° no</i> segmento de dados <i>.data</i> , o vinculador o colocar√° em 0x20000000: <br>  <code>.data inited 0x2000'0000</code> , <br>  e seu valor de inicializa√ß√£o (3) estar√° no segmento <i>.rodata</i> no endere√ßo 0x8000190: <br> <code>Initializer bytes const 0x800'0190</code> <br>  Se voc√™ escrever este c√≥digo: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c = i;</code> </pre> <br>  √â √≥bvio que a constante global <code></code> , √© inicializada somente ap√≥s a vari√°vel global <code>i</code> inicializada, ou seja, em tempo de execu√ß√£o.  Nesse caso, a constante estar√° localizada na <u>RAM</u> <br><br>  Agora, se voltarmos ao nosso <div class="spoiler">  <b class="spoiler_title">exemplo inicial</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WantToBeInROM</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: WantToBeInROM(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): i(value) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> WantToBeInROM </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myConstInROM</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; &amp;myConstInROM &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> ; }</code> </pre><br></div></div>  E nos perguntamos: em qual segmento o compilador definiu o objeto constante <code>myConstInROM</code> ?  E obtemos a resposta: a constante estar√° no segmento <i>.bss,</i> contendo vari√°veis ‚Äã‚Äãest√°ticas e globais inicializadas em zero (0). <br> <code>.bss inited 0x2000'0004 0x4 <br> myConstInROM 0x2000'0004 0x4</code> <br> <br>  Porque  Como no C ++, um objeto de dados declarado como constante e que precisa de inicializa√ß√£o din√¢mica est√° localizado na mem√≥ria de leitura e grava√ß√£o e ser√° inicializado no momento da cria√ß√£o. <br><br>  Nesse caso, a inicializa√ß√£o din√¢mica ocorre, <code>const WantToBeInROM myConstInROM(10)</code> , e o compilador coloca esse objeto no segmento <i>.bss</i> , inicializando todos os campos 0 primeiro e, em seguida, ao criar um objeto constante, chamado construtor para inicializar o campo <code>i</code> valor 10. <br><br>  Como podemos fazer o compilador colocar nosso objeto no segmento <i>.rodata</i> ?  A resposta a esta pergunta √© simples, voc√™ sempre deve executar a inicializa√ß√£o est√°tica.  Voc√™ pode fazer assim: <br><br>  1. Em nosso exemplo, pode-se ver que, em princ√≠pio, o compilador pode otimizar a inicializa√ß√£o din√¢mica para est√°tica, uma vez que o construtor √© bastante simples.  Para o IAR do compilador, voc√™ pode marcar a constante com o atributo <i>__ro_placement</i> <br> <code>__ro_placement const WantToBeInROM myConstInROM</code> <br>  Com esta op√ß√£o, o compilador colocar√° a vari√°vel no endere√ßo na ROM: <br> <code>myConstInROM 0x800'0144 0x4 Data</code> <br>  Obviamente, essa abordagem n√£o √© universal e geralmente muito espec√≠fica.  Portanto, passamos ao m√©todo correto :) <br><br>  2. √â fazer um construtor <code>constexpr</code> .  Dizemos imediatamente ao compilador para usar a inicializa√ß√£o est√°tica, ou seja,  no est√°gio de compila√ß√£o, quando todo o objeto ser√° "calculado" completamente com anteced√™ncia e todos os seus campos ser√£o conhecidos.  Tudo o que precisamos fazer √© adicionar constexpr ao construtor. <br><br><div class="spoiler">  <b class="spoiler_title">O objeto voa para a ROM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WantToBeInROM</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WantToBeInROM</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> WantToBeInROM </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myConstInROM</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; &amp;myConstInROM &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> ; }</code> </pre><br></div></div><br>  Portanto, para ter certeza de que seu objeto constante est√° na ROM, voc√™ precisa seguir regras simples: <br><blockquote><ol><li>  O segmento <i>.text</i> no qual o c√≥digo √© inserido deve estar na ROM.  Est√° configurado nas configura√ß√µes do vinculador. </li><li>  O segmento <i>.rodata</i> no qual as constantes globais e est√°ticas s√£o colocadas deve estar na ROM.  Est√° configurado nas configura√ß√µes do vinculador. </li><li>  A constante deve ser global ou est√°tica. </li><li>  Os atributos de uma classe de vari√°vel constante n√£o devem ser mut√°veis </li><li>  A inicializa√ß√£o do objeto deve ser est√°tica, ou seja, o construtor da classe cujo objeto ser√° uma constante deve ser consexpr ou n√£o definido de forma alguma (n√£o h√° inicializa√ß√£o din√¢mica) </li><li>  Se poss√≠vel, se voc√™ tiver certeza de que o objeto deve ser armazenado na ROM em vez de const, use constexpr </li></ol></blockquote><br>  Algumas palavras sobre o constexpr e o construtor constexpr.  A principal diferen√ßa entre const e constexpr √© que a inicializa√ß√£o da vari√°vel const pode ser atrasada at√© o tempo de execu√ß√£o.  A vari√°vel constexpr deve ser inicializada em tempo de compila√ß√£o. <br>  <b><u>Todas as vari√°veis ‚Äã‚Äãconstexpr s√£o do tipo const.</u></b> <br><br>  A defini√ß√£o do construtor constexpr deve atender aos seguintes requisitos: <br><ul><li>  Uma classe n√£o deve ter classes base virtuais. <pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D2</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> BASE { <span class="hljs-comment"><span class="hljs-comment">//error, D2 must not have virtual base class. constexpr D2() : BASE(), mem(55) { } private: int mem; };</span></span></code> </pre> </li><li>  Cada um dos tipos de par√¢metros da classe deve ser um tipo literal. </li><li>  O corpo do construtor deve ser <code>= delete</code> ou <code>= default</code> .  Ou satisfa√ßa os requisitos abaixo: </li><li>  N√£o h√° <code>try catch</code> blocos no corpo do construtor. </li><li>  O corpo do construtor pode usar <code>nullptr</code> </li><li>  O corpo do construtor pode usar <code>static_assert</code> </li><li>  No corpo do construtor, <code>typedef</code> pode ser usado que n√£o define classes ou enumera√ß√µes </li><li>  O corpo do construtor pode usar diretiva e declara√ß√µes <code>using</code> </li><li>  Cada membro n√£o est√°tico de uma classe ou classe base deve ser inicializado. </li><li>  Os construtores de uma classe ou classe base, usados ‚Äã‚Äãpara inicializar elementos n√£o est√°ticos de membros e subobjetos da classe base, devem ser <code>constexpr</code> . </li><li>  Inicializadores para todos os elementos de dados n√£o est√°ticos devem ser <code>constexpr</code> </li><li>  Ao inicializar os alunos, todas as convers√µes de tipo devem ser v√°lidas em uma express√£o constante.  Por exemplo, n√£o √© permitido usar <code>reinterpret_cast</code> e converter de <code>void*</code> para outro tipo de ponteiro </li></ul><br>  O construtor padr√£o impl√≠cito √© o construtor constexpr.  Agora vamos ver alguns exemplos: <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo 1. Objeto na ROM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Test() {} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Test test; <span class="hljs-comment"><span class="hljs-comment">//  ROM.    . i  0  . int main() { std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br>  √â melhor n√£o escrever dessa maneira, porque assim que voc√™ decidir inicializar o atributo i, o objeto voar√° para a RAM <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo 2. Um objeto na RAM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">// i.       constexpr . public: Test() {} ; //       ,       ,  constexpr int Get() const { return i + 1; } } ; const Test test; //  RAM. i     int main() { std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Exemplo 3. Um objeto na RAM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Test(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): i(value) {} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Test </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  RAM. i     int main() { std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Exemplo 4. Objeto na ROM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Test </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ROM. i     constexpr  int main() { std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Exemplo 5. Um objeto na RAM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Test </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  RAM.    std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Exemplo 6. Objeto na ROM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Test </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ROM.    std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 7. Erro de compila√ß√£o</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// Get  ,  ,       (i),     .   ,       . { return i + 1; } } ; const Test test(10); int main() { std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 8. Um objeto na ROM, herdado de uma classe abstrata</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value+</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Test </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ROM. i     constexpr , j   constexpr  ITest int main() { std::cout &lt;&lt; test.Give() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 9. Um objeto na ROM agrega um objeto localizado na RAM</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: TestImpl(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): k(value), ITest(value) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j + <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ k = value; j = value + <span class="hljs-number"><span class="hljs-number">10</span></span>; } } ; <span class="hljs-function"><span class="hljs-function">TestImpl </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//    RAM. class Test: public ITest { private: int i; TestImpl &amp; obj; //    public: constexpr Test(int value, TestImpl &amp; ref): i(value), obj(ref), ITest(value+1) { } ; int Get() const override { return i + 1; } bool Set() const { obj.Set(100) ; //     return true; } } ; constexpr Test test(10, testImpl); //  ROM.     constexpr  int main() { std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 10. O mesmo objeto est√°tico na ROM</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: TestImpl(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): k(value), ITest(value) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j + <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ k = value; j = value + <span class="hljs-number"><span class="hljs-number">10</span></span>; } } ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; TestImpl &amp; obj; <span class="hljs-comment"><span class="hljs-comment">//    public: constexpr Test(int value, TestImpl &amp; ref): i(value), obj(ref),ITest(value+1) { } ; int Get() const override { return i + 1; } bool Set() const { obj.Set(100) ; //     return true; } } ; int main() { static TestImpl testImpl(1); //  static constexpr Test test(10, testImpl); //    ROM.     constexpr  std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 11. E agora o objeto constante √© n√£o est√°tico e, portanto, na RAM</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: TestImpl(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): k(value), ITest(value) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j + <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ k = value; j = value + <span class="hljs-number"><span class="hljs-number">10</span></span>; } } ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; TestImpl &amp; obj; <span class="hljs-comment"><span class="hljs-comment">//    public: constexpr Test(int value, TestImpl &amp; ref): i(value), obj(ref),ITest(value+1) { } ; int Get() const override { return i + 1; } bool Set() const { obj.Set(100) ; //     return true; } } ; int main() { static TestImpl testImpl(1); //  const Test test(10, testImpl); //    RAM. std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 12. Erro de compila√ß√£o.</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: TestImpl(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): k(value), ITest(value) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j + <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ k = value; j = value + <span class="hljs-number"><span class="hljs-number">10</span></span>; } } ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; TestImpl obj; <span class="hljs-comment"><span class="hljs-comment">//   TestImpl public: constexpr Test(int value): i(value), obj(TestImpl(value)), //   constexpr   TestImpl ITest(value+1) { } ; int Get() const { return i + 1; } bool Set() const { obj.Set(100) ; //     return true; } } ; int main() { static TestImpl testImpl(1); //  static const Test test(10); //   std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 13. Erro de compila√ß√£o</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//   constexpr { } int Get() const override { return j + 10; } void Set(int value) //   ,  k  j.       ROM,        RAM { k = value; j = value + 10; } } ; class Test: public ITest { private: int i; TestImpl obj; public: constexpr Test(int value): i(value), obj(TestImpl(value)), // constexpr     obj,    obj  .rodata . ITest(value+1) { } ; int Get() const { return i + 1; } bool Set() const { obj.Set(100) ; //        constexpr     return true; } } ; int main() { static TestImpl testImpl(1); //  static const Test test(10); //   std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></span></span></code> </pre><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo 14. Um objeto na ROM</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j + <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//   const { //do something } } ; class Test: public ITest { private: int i; const TestImpl obj; // ,    constexpr  public: constexpr Test(int value): i(value), obj(TestImpl(value)), ITest(value+1) { } ; int Get() const { return i + 1; } bool Set() const { obj.Set(100) ; //   return true; } } ; int main() { //static TestImpl testImpl(1); //  static const Test test(10); //    ROM.     constexpr  std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></span></span></code> </pre><br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E, finalmente, um objeto constante contendo uma matriz, com a inicializa√ß√£o da matriz por meio de uma fun√ß√£o constexpr. </font></font><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k[<span class="hljs-number"><span class="hljs-number">100</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; it: k) { it = i++ ; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ InitArray(); <span class="hljs-comment"><span class="hljs-comment">// constexpr     } int Get(int index) const { return k[index]; } } ; int main() { static const Test test; //    ROM.     ,  constexpr . std::cout &lt;&lt; test.Get(10) &lt;&lt; std::endl ; return 0; }</span></span></code> </pre><br><br>  Refer√™ncias: <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guia de desenvolvimento do IAR C / C ++ </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">construtores Constexpr (C ++ 11) </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constexpr (C ++)</font></font></a> <br><br>  PS. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s uma discuss√£o muito √∫til com </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valdaros,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> voc√™ precisa adicionar as seguintes constantes tangentes de ponto. </font><font style="vertical-align: inherit;">De acordo com o padr√£o C ++ e este documento </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N1076.pdf</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1. Qualquer altera√ß√£o em um objeto constante (com exce√ß√£o de membros mut√°veis ‚Äã‚Äãde uma classe) durante sua vida √∫til leva ao comportamento indefinido.</font></font> I.e. <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ci = <span class="hljs-number"><span class="hljs-number">1</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* iptr = <span class="hljs-keyword"><span class="hljs-keyword">const_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*&gt;(&amp;ci); <span class="hljs-comment"><span class="hljs-comment">//UB,       *iptr = 2 ;</span></span></code> </pre><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* ci = &amp;i ; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* iptr = <span class="hljs-keyword"><span class="hljs-keyword">const_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *&gt; (ci); <span class="hljs-comment"><span class="hljs-comment">//   *iptr = 2 ; // UB,   i</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. O problema √© que isso s√≥ funciona durante toda a vida de um objeto constante, mas no construtor e destruidor n√£o funciona. </font><font style="vertical-align: inherit;">Portanto, √© bastante leg√≠timo faz√™-lo:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ foo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ; } } ; Test *test1; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Test* value)</span></span></span><span class="hljs-function"> </span></span>{ value-&gt;i = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       0  1 test1 = value ; //           } const Test test; int main() { test1-&gt;i = 2; //          2. std::cout &lt;&lt; &amp;test &lt;&lt; std::endl; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E √© considerado legal. </font><font style="vertical-align: inherit;">Apesar de termos usado o construtor constexpr, e a fun√ß√£o constexpr nele. </font><font style="vertical-align: inherit;">O objeto vai direto para a RAM. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para evitar isso, use const-constexpr em vez de const; haver√° um erro de compila√ß√£o que informar√° que algo est√° errado e que o objeto n√£o pode ser constante.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ foo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ; } } ; Test *test1; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Test* value)</span></span></span><span class="hljs-function"> </span></span>{ value-&gt;i = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       0  1 test1 = value ; //           } constexpr Test test; // / Error[Pe2400]: calling the default constructor for "Test" does not produce a constant value main.cpp 151 int main() { test1-&gt;i = 2; //          2. std::cout &lt;&lt; &amp;test &lt;&lt; std::endl; }</span></span></code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt453262/">https://habr.com/ru/post/pt453262/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt453252/index.html">Como fizemos o programa do clube Sportmaster</a></li>
<li><a href="../pt453254/index.html">Sobre o c√≥digo do GOST, Grasshopper, seu SBox e sementes perdidas</a></li>
<li><a href="../pt453256/index.html">SObjectizer-5.6.0: corte ao vivo para crescer ainda mais</a></li>
<li><a href="../pt453258/index.html">Fazendo um pedal de reverbera√ß√£o usando chips PT2399 (parte 1)</a></li>
<li><a href="../pt453260/index.html">Recursos de configura√ß√£o de DPI</a></li>
<li><a href="../pt453264/index.html">Virtuali-tee: uma "camiseta m√©dica" que n√£o cobre, mas exp√µe</a></li>
<li><a href="../pt453272/index.html">Patrocinadores do GitHub: uma nova maneira de contribuir com o c√≥digo aberto</a></li>
<li><a href="../pt453274/index.html">Comiss√£o oculta Yandex.Money no Samsung Pay</a></li>
<li><a href="../pt453276/index.html">Arduino e interrup√ß√µes do timer</a></li>
<li><a href="../pt453278/index.html">Por que os engenheiros n√£o se preocupam com o monitoramento de aplicativos?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>