<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌡️ 👩🏼 👦🏿 Erstellen eines animierten Liniendiagramms für den gleitenden Durchschnitt in R. Abrufen von Daten über die NBA-API 👨‍🎓 👨‍🎨 👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir analysieren weiterhin Basketballdaten mit R. 


 Im Gegensatz zum vorherigen Artikel , der rein unterhaltsam war, können die in diesem Artikel ers...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen eines animierten Liniendiagramms für den gleitenden Durchschnitt in R. Abrufen von Daten über die NBA-API</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459142/"><p>  Wir analysieren weiterhin Basketballdaten mit R. </p><br><p>  Im Gegensatz zum vorherigen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> , der rein unterhaltsam war, können die in diesem Artikel erstellten Grafiken unter dem Gesichtspunkt der Analyse des Teamspiels der Saisonkampagne interessant sein. </p><br><p>  Und wir werden gleitende Durchschnittsgraphen für drei Arten von NBA-Teambewertungen erstellen: Angriffs-, Defensiv- und Nettobewertung (d. H. Die Differenz zwischen den ersten beiden).  Kurz gesagt.  Angriffs- und Verteidigungsbewertungen sind die Anzahl der Punkte, die ein Team für 100 Besitztümer erzielt / verpasst hat.  NET-Bewertung - das ist ihr Unterschied für einhundert Besitztümer.  Jeder, der mehr über sie erfahren möchte, kann das Glossar zur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Basketball-Referenz</a> lesen.  Es gibt eine Berechnungsformel, die ich auch mit R implementiert habe, aber ich habe noch keinen Artikel darüber veröffentlicht. </p><a name="habracut"></a><br><p>  Ich werde auch erklären, warum ich das Diagramm des gleitenden Durchschnitts erstellen werde.  In jedem einzelnen Spiel ist der Anteil der Zufälligkeit zu hoch, die Indikatoren springen von 70 auf 150, was die Datenanalyse unbrauchbar macht, und die Grafik selbst ähnelt eher einem Kardiogramm.  Wenn wir den kumulierten Durchschnitt nehmen, erhalten wir ein weiteres Extrem: Der Zeitplan ähnelt gedämpften Schwankungen, und Spiele am Ende der Saison, wenn sie zu bereits ausgetragenen 70-75 Spielen hinzugefügt werden, haben praktisch keinen Einfluss auf den Gesamtindikator.  Grob gesagt sind sie "nicht sichtbar".  Der gleitende Durchschnitt ist in diesem Fall der Ausweg aus der Pattsituation.  Einerseits nimmt der Einfluss des Zufalls ab, andererseits gibt es keine übermäßige Anhäufung von Ergebnissen.  In der Basketballstatistik machen sie normalerweise einen gleitenden Durchschnitt von 10 Spielen. </p><br><h2 id="ispolzuemye-biblioteki">  Verwendete Bibliotheken </h2><br><pre><code class="plaintext hljs">library(httr) library(jsonlite) library(tidyverse) library(lubridate) library(zoo) library(ggthemes) library(gganimate)</code> </pre> <br><h2 id="poluchenie-dannyh-s-pomoschyu-nba-api">  Abrufen von Daten mithilfe der NBA-API </h2><br><p>  Beim letzten Mal habe ich Daten mit der Erweiterung <strong>NBA Data Retriever abgerufen</strong> .  Dieses Mal werde ich die NBA-API verwenden, um die erforderlichen Daten direkt in R zu laden. </p><br><p>  Zuerst finden wir heraus, woher diese Daten stammen.  Öffnen Sie dazu die benötigte Seite auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">stats.nba.com</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">rufen</a> Sie die Entwicklertools auf.  Öffnen Sie dann Netzwerk -&gt; XHR und drücken Sie F5.  In der angezeigten Liste finden wir eine Datei mit einem Namen, der dem Namen der Seite ähnlich ist.  Wir brauchen ihn.  Nachdem Sie sichergestellt haben, dass Sie die richtige Datei ausgewählt haben, kopieren Sie die Adresse in R. Auf den Bildern sieht es so aus. </p><br><p>  <em>Öffnen Sie die gewünschte Datei</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3ce/6cf/41f/3ce6cf41f2cb07bcd73b757b311c9c80.png"></p><br><p>  <em>Die Datei sollte so aussehen</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7c8/9c4/aca/7c89c4aca8872754cdb2212bdeba85df.png"></p><br><p>  <em>Kopie an R-Adresse</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a43/06c/c65/a4306cc65e873df80d9501bb329cc3ca.png"></p><br><p>  Jetzt können wir in <strong>R Studio arbeiten</strong> .  Um die benötigten Informationen zu erhalten, verwenden wir die <code>GET</code> Funktion des <code>http</code> Pakets.  Damit die Anforderung jedoch korrekt ausgeführt werden kann (dies kann durch die Funktion <code>status_code</code> überprüft werden, sie muss 200 sein), müssen Sie Header hinzufügen, um die Arbeitsparameter der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HTTP-Transaktion</a> zu bestimmen </p><br><pre> <code class="plaintext hljs">##Adding headers request_headers &lt;- c( "accept-encoding" = "gzip, deflate, sdch", "accept-language" = "en-US,en;q=0.8", "cache-control" = "no-cache", "connection" = "keep-alive", "host" = "stats.nba.com", "pragma" = "no-cache", "upgrade-insecure-requests" = "1", "user-agent" = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/601.3.9 (KHTML, like Gecko) Version/9.0.2 Safari/601.3.9" ) #Getting a response request &lt;- GET(adv_box_team, add_headers(request_headers))</code> </pre> <br><p>  Wir bekommen eine Antwort wie diese: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d08/a37/841/d08a378417726a4e7ae4c535dec57836.png"></p><br><p>  Aber während die Daten, die wir brauchen, nicht sichtbar sind.  Um sie zu erhalten, extrahieren wir zuerst den <code>content</code> der Anforderung durch den Funktionsinhalt in eine JSON-Datei und konvertieren ihn dann in eine Liste mit einer Funktion aus dem <code>jsonlite</code> Paket mit dem sprechenden Namen von <code>fromJSON</code> </p><br><pre> <code class="plaintext hljs">boxscore_data &lt;- fromJSON(content(request, as = "text"))</code> </pre> <br><p>  Als Ergebnis erhalten wir eine Liste, die bereits alle benötigten Informationen enthält, und bringen sie dann einfach in die Form, die für die Arbeit benötigt wird. </p><br><h2 id="podgotovka-dannyh">  Datenaufbereitung </h2><br><p>  Erstellen Sie dazu eine Datentabelle anstelle einer Liste und fügen Sie dann Spaltenüberschriften hinzu. </p><br><pre> <code class="plaintext hljs">#Convert to tibble data and assigning column names table &lt;- tbl_df(data.frame(boxscore_data$resultSets$rowSet[[1]], stringsAsFactors = FALSE)) names(table) &lt;- toupper(boxscore_data$resultSets$headers[[1]])</code> </pre> <br><p>  <code>toupper</code> ist eine Funktion, die alle Zeichen durch Großbuchstaben ersetzt.  Danach sollten wir eine Tabelle mit 2460 Zeilen und 46 Spalten erhalten.  Grundsätzlich können Sie mit der Tabelle in dieser Form arbeiten. Es ist jedoch besser, unnötige Informationen auszuschließen, um bequemer und schneller arbeiten zu können. </p><br><pre> <code class="plaintext hljs">##Select the columns you want to analyze rating &lt;- table %&gt;% select(TEAM_ID, TEAM_ABBREVIATION, TEAM_NAME, GAME_ID, GAME_DATE, MATCHUP, WL, E_OFF_RATING, E_DEF_RATING, E_NET_RATING)</code> </pre> <br><p>  Wenn Sie sich die Quellentabelle ansehen, sehen Sie zwei Arten derselben Bewertung: „normal“ und mit dem Präfix E. Ohne auf Details einzugehen, berücksichtigt die E-Bewertung das Tempo des Spiels und ist daher genauer.  Wir nehmen es. </p><br><p>  Als nächstes möchte ich die Namen der Bewertungen vereinfachen.  Sie müssen in die Funktionsargumente eingeführt werden, und es ist besser, die Notation zu verwenden, die einer Vielzahl von Benutzern besser bekannt ist: ORTG, DRTG, NRTG.  Hier kann man "verwirrt" werden, wenn man einen regulären Ausdruck schreibt und durch <code>str_replace</code> , aber das Schreiben ist immer noch ein Vergnügen, und hier können wir perfekt auf sie verzichten.  Wir müssen nur die 3, 7, 9 und 12 Zeichen der aktuellen Namen extrahieren, sie kombinieren und die Spaltennamen durch den resultierenden Zeichenvektor ersetzen.  All dies geschieht mit den Funktionen des <code>stringr</code> Pakets: <code>str_sub</code> und <code>str_c</code> (ein Analogon der <code>paste0</code> ). </p><br><pre> <code class="plaintext hljs">## Renaming columns with E_OFF_RATING on ORTG rating1 &lt;- rating %&gt;% rename_at(vars(starts_with("E_")), list(~str_c(str_sub(., start = 3, end = 3), str_sub(., start = 7, end = 7), str_sub(., start = 9, end = 9), str_sub(., start = 12, end = 12))))</code> </pre> <br><p>  <strong>at</strong> in den <code>dplyr</code> hat dieselbe Eigenschaft wie das <code>dt[, lapply(.SD, func), .SDols = col1]</code> im Paket <code>data.table</code> : Die Aktion wird gleichzeitig auf mehrere Spalten angewendet.  Hier wählen wir alle Spalten aus, deren Name mit "E_" beginnt. </p><br><p>  Als Ergebnis erhalten wir eine solche Tabelle, mit der wir weiter arbeiten werden: </p><br><div class="scrollable-table"><table><thead><tr><th>  TEAM_ID </th><th>  TEAM_ABBREVIATION </th><th>  TEAM_NAME </th><th>  GAME_ID </th><th>  GAME_DATE </th><th>  MATCHUP </th><th>  Wl </th><th>  ORTG </th><th>  DRTG </th><th>  NRTG </th></tr></thead><tbody><tr><td>  1610612749 </td><td>  Mil </td><td>  Milwaukee Dollar </td><td>  0021801226 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIL vs.  Okc </td><td>  L. </td><td>  102.4 </td><td>  116.8 </td><td>  -14,4 </td></tr><tr><td>  1610612766 </td><td>  Cha </td><td>  Charlotte Hornissen </td><td>  0021801222 </td><td>  2019-04-10T00: 00: 00 </td><td>  CHA vs.  ORL </td><td>  L. </td><td>  121.4 </td><td>  130.1 </td><td>  -8.6 </td></tr><tr><td>  1610612758 </td><td>  SAC </td><td>  Sacramento Könige </td><td>  0021801230 </td><td>  2019-04-10T00: 00: 00 </td><td>  SAC @ POR </td><td>  L. </td><td>  129.7 </td><td>  136.4 </td><td>  -6.8 </td></tr><tr><td>  1610612748 </td><td>  MIA </td><td>  Miami Hitze </td><td>  0021801221 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIA @ BKN </td><td>  L. </td><td>  84.2 </td><td>  103.6 </td><td>  -19,4 </td></tr><tr><td>  1610612750 </td><td>  MIN </td><td>  Minnesota Timberwolves </td><td>  0021801228 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIN @ DEN </td><td>  L. </td><td>  98.3 </td><td>  103.7 </td><td>  -5.4 </td></tr></tbody></table></div><br><h2 id="funkciya-rolling_offnet_rating_nba-dlya-postroeniya-grafika-i-animacii-skolzyaschego-srednego">  Die Funktion <strong><em>running_offnet_rating_nba</em></strong> zum <strong><em>Zeichnen</em></strong> und Animieren eines gleitenden Durchschnitts. </h2><br><p>  Lassen Sie uns wie beim letzten Mal eine Funktion erstellen, um minimale Änderungen an den Berechnungen vorzunehmen. </p><br><p>  Die Funktion <code>rolling_offnet_rating_nba</code> : </p><br><pre> <code class="plaintext hljs">rolling_offnet_rating_nba &lt;- function(table, name, variable, col1 = col1, col2 = col2)</code> </pre> <br><p>  <strong>Tabelle</strong> ist der Name der Datentabelle, <br>  <strong>name</strong> - die Abkürzung des Teams, für das die Grafiken erstellt werden ("BOS", "LAL" usw.). <br>  <strong>Variable</strong> - die Bewertung, die berechnet wird (hier sind zwei Optionen, ORTG oder NRTG, für die Schutzbewertung habe ich eine separate Funktion erstellt) <br>  <strong>col1</strong> und <strong>col2</strong> - Linienfarbe bei einem Wert über / unter dem Durchschnitt. </p><br><p>  Die meisten <code>dplyr</code> Funktionen verwenden eine <em>nicht standardmäßige Auswertung (NSE</em> ).  Dies ist ein allgemeiner Begriff, der bedeutet, dass sich ihre Bewertung von der in R üblichen Bewertung unterscheidet. Dies ermöglicht es uns, das Schreiben von Code zu vereinfachen und mit SQL-Datenbanken zu arbeiten. Das Minus ist jedoch, dass wir den Wert nicht durch ein an anderer Stelle definiertes äquivalentes Objekt ersetzen können. </p><br><p>  <em>Dplyr</em> verwendet die <strong>Tidy-Bewertung</strong> .  Daher müssen spezielle Werkzeuge (Zitierfunktionen, Operator !!) verwendet werden, um Probleme zu lösen, die während der Programmierung auftreten.  Sie können hier mehr darüber lesen und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier sehen</a> . </p><br><p>  Der folgende Code nimmt den Namen des Funktionsarguments und schreibt den Ausdruck, der ihm präsentiert wurde.  (Um zu verstehen, wie <code>enquo</code> und ähnliche Funktionen funktionieren, ist es hilfreich, die Ausgabe dieser Funktion zu drucken.) </p><br><pre> <code class="plaintext hljs">##Return the entered value in the function argument in the type quosure quo_rating &lt;- enquo(variable) quo_col1 &lt;- enquo(col1) quo_col2 &lt;- enquo(col2)</code> </pre> <br><p>  Als nächstes ändern wir das Datenformat einiger Spalten: Wir machen <strong>GAME_DATE</strong> des Zeichens zu einer Spalte im Datumsformat und machen die Bewertungsspalten numerisch.  Weil  Wir wenden die <code>as.numeric</code> Funktion auf drei Spalten an, dann wird <code>mutate_at</code> anstelle von <code>mutate_at</code> verwendet.  Und wir sortieren alles in aufsteigender Reihenfolge des Datums. </p><br><pre> <code class="plaintext hljs">##Changing the data type of multiple columns test1 &lt;- table %&gt;% mutate(GAME_DATE = as.Date(ymd_hms(GAME_DATE))) %&gt;% mutate_at(vars(ORTG:NRTG), list(~as.numeric)) %&gt;% arrange(GAME_DATE)</code> </pre> <br><p>  Und dann berechnen wir den gleitenden Durchschnitt von 10 Spielen der Mannschaft, die wir brauchen.  Verwenden Sie dazu die Funktion <code>rollmeanr</code> aus dem <code>zoo</code> Paket.  r am Ende des Namens bedeutet, dass das Ergebnis rechtsbündig sein sollte.  In den ersten neun Spielen der Saison ist ein gleitender Durchschnitt von 10 Spielen einfach nicht zu berechnen. Daher lassen wir diese Felder unverändert, indem wir sie mit dem Füllargument in NA ausfüllen.  <code>na.omit</code> entfernt aus der Tabelle die Zeilen, in denen diese NA vorkommen. </p><br><pre> <code class="plaintext hljs">##The calculation of the moving average team &lt;- test1 %&gt;% filter(TEAM_ABBREVIATION == "DAL") %&gt;% mutate(RATING = rollmeanr(ORTG, k = 10, fill= NA)) %&gt;% na.omit(test1)</code> </pre> <br><p>  Der Teamtisch sieht folgendermaßen aus: </p><br><div class="scrollable-table"><table><thead><tr><th>  TEAM_ID </th><th>  TEAM_ABBREVIATION </th><th>  TEAM_NAME </th><th>  GAME_ID </th><th>  GAME_DATE </th><th>  MATCHUP </th><th>  Wl </th><th>  ORTG </th><th>  DRTG </th><th>  NRTG </th><th>  Bewertung </th></tr></thead><tbody><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas Außenseiter </td><td>  0021800150 </td><td>  2018-11-06 </td><td>  DAL vs.  War </td><td>  W. </td><td>  116.8 </td><td>  99,2 </td><td>  17.6 </td><td>  105,51 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas Außenseiter </td><td>  0021800160 </td><td>  2018-11-07 </td><td>  DAL @ UTA </td><td>  L. </td><td>  98.5 </td><td>  112.0 </td><td>  -13,6 </td><td>  104,92 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas Außenseiter </td><td>  0021800181 </td><td>  2018-11-10 </td><td>  DAL vs.  Okc </td><td>  W. </td><td>  115,0 </td><td>  101.1 </td><td>  13.9 </td><td>  104.13 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas Außenseiter </td><td>  0021800193 </td><td>  2018-11-12 </td><td>  DAL @ CHI </td><td>  W. </td><td>  98.3 </td><td>  91.0 </td><td>  7.3 </td><td>  103.03 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas Außenseiter </td><td>  0021800210 </td><td>  2018-11-14 </td><td>  DAL vs.  UTA </td><td>  W. </td><td>  117,3 </td><td>  65,8 </td><td>  51.6 </td><td>  105,34 </td></tr></tbody></table></div><br><p>  Grundsätzlich haben wir bereits die Informationen erhalten, die wir benötigen.  Mit zwei Codezeilen können Sie ein Liniendiagramm erstellen.  Die schwarze Linie auf weißem Hintergrund ist jedoch sowohl aus ästhetischer als auch aus informativer Sicht von geringem Interesse.  Ein weiterer Teil des "Funktionskörpers" korrigiert dies. </p><br><p>  Zunächst addieren wir die Daten zum durchschnittlichen 10. und 21. (zehnten von unten) Bewertungswert sowie zum Datum 10 des Teamspiels (d. H. Dem ersten, für das der gleitende Durchschnitt berechnet wird und der nach dem Löschen der Zeilen aus NA in der Teamtabelle verbleibt). . </p><br><pre> <code class="plaintext hljs">##The average, 10 and 21 ratings in the entire League. average &lt;- league %&gt;% mutate(average = mean(!! quo_rating)) %&gt;% select(average) %&gt;% unique() %&gt;% .$average top10 &lt;- league %&gt;% arrange(desc(!! quo_rating)) %&gt;% select(!! quo_rating) %&gt;% slice(10) top10 &lt;- top10[[1]] bottom10 &lt;- league %&gt;% arrange(desc(!! quo_rating)) %&gt;% select(!! quo_rating) %&gt;% slice(21) bottom10 &lt;- bottom10[[1]] ##Getting the date of the first rollaverage data &lt;- team %&gt;% select(GAME_DATE) %&gt;% arrange(GAME_DATE) data &lt;- data[[1,1]]</code> </pre> <br><p>  Von zuvor nicht verwendeten Funktionen wird hier die <code>slice</code> Funktion angezeigt, die die Zeilen anhand ihrer Seriennummer auswählt. </p><br><p>  Als nächstes wählen wir 2 Farben und deren Namen aus.  Die Daten werden wie beim letzten Mal aus der Tabelle <code>table_color</code> .  Der Name wird in der Überschrift des Diagramms verwendet, um zu erklären, welche der Farben Werten unter dem Durchschnitt entspricht und welche höher sind. </p><br><pre> <code class="plaintext hljs">##Getting color and color_name selected color color1 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(!! quo_col1) color1 &lt;- color1[[1]] color2 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(!! quo_col2) color2 &lt;- color2[[1]] name1 &lt;- paste0("name_", quo_name(quo_col1)) name2 &lt;- paste0("name_", quo_name(quo_col2)) name_color1 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(name1) name_color1 &lt;- name_color1[[1]] name_color2 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(name2) name_color2 &lt;- name_color2[[1]]</code> </pre> <br><p>  Die Funktionsargumente sind standardmäßig col1 und col2. Dies sind die erste und die zweite Farbe der Befehle.  In den meisten Fällen (genauer in 26) müssen diese Werte nicht geändert werden. Für vier Teams sollte jedoch die folgende Farbe in ihrer Farbpalette verwendet werden.  In Dallas und Minnesota sind die erste und die zweite Farbe zu ähnlich, während sie in Milwaukee und Brooklyn auf weißem Hintergrund nicht sichtbar sind.  Sowohl das als auch ein anderes erschweren das Lesen des Zeitplans, daher lohnt es sich, das Argument col2 = col3 für sie zu verwenden. </p><br><p>  Als nächstes erhalten wir die maximale Bewertung für das Team.  Wir benötigen diesen Wert, um den Text mit dem Bewertungswert in der Tabelle anzuordnen.  Ich möchte auf die letzte Codezeile achten.  Es kam vor, dass die Funktionen in 89 von 90 Fällen Diagramme perfekt darstellten, aber beim Erstellen einer Schutzbewertung gab Milwaukee einen Fehler aus.  Es stellte sich heraus, dass der maximale Bewertungswert in Milwaukee zweimal erreicht wird und <code>ggplot2</code> natürlich zu schwören beginnt, dass die Ästhetik in unserem Fall entweder 1 oder 73 sein sollte. Daher benötigen wir einen einzigen maximalen Bewertungswert. </p><br><pre> <code class="plaintext hljs">##The maximum value of the rating max &lt;- team %&gt;% filter(RATING == max(RATING)) %&gt;% select(RATING) max &lt;- max[[1]]</code> </pre> <br><h2 id="postroenie-statichnogo-grafika-v-ggplot2">  <code>ggplot2</code> eines statischen Diagramms in <code>ggplot2</code> </h2><br><pre> <code class="plaintext hljs">##Building and save a static chart Sys.setlocale("LC_ALL", "C") gg &lt;- ggplot(team, aes(GAME_DATE, RATING)) + geom_hline(yintercept = c(top10, bottom10), col = c("red", "blue")) + annotate(geom = "text", x = as.Date(data) + 2, y = top10 - 0.2, label = "TOP 10", col = "red") + annotate(geom = "text", x = as.Date(data) + 2, y = bottom10 + 0.2, label = "BOTTOM 10", col = "blue") + geom_line(size = 2, col = if_else(team$RATING &gt; average, color1, color2)) + theme_tufte() + labs(title = paste0(team$TEAM_NAME, " 10-Game Rolling ", quo_name(quo_rating)), subtitle = paste0(paste0(name_color1, " - above average ", quo_name(quo_rating)), "\n", paste0(name_color2, " - below average ", quo_name(quo_rating))), caption = "Source: BBall Index Data &amp; Tools\nTelegram: @NBAatlantic, twitter: @vshufinskiy") theme(plot.title = element_text(size = 12, hjust = 0.5), plot.caption = element_text(size = 10), plot.subtitle = element_text(size = 9)) ggsave(paste0(unique(team$TEAM_NAME), quo_name(quo_rating), ".jpeg"), gg, width = 8, units = "in")</code> </pre> <br><p>  Von den neuen hier die Verwendung der <code>if_else</code> Funktion zum Ändern der Farbe der Linie in Abhängigkeit davon, ob die Liga-Durchschnittsbewertung höher oder niedriger ist, sowie die erste Zeile, die das Gebietsschema ändert.  Dies geschieht so, dass die Abkürzungen für die Namen der Monate entlang der X-Achse in Englisch geschrieben sind. <br><img src="https://habrastorage.org/webt/3b/yv/la/3byvlasu52uwfin6f8prdwipms0.jpeg"></p><br><h2 id="postroenie-animacii-10-matchevogo-skolzyaschego-srednego">  Animation eines gleitenden Durchschnitts von 10 Spielen. </h2><br><p>  Bei der Erstellung der Animation habe ich mehrere Lotionen hinzugefügt, die in der statischen Version nicht möglich sind.  Erstens das Änderungsdatum (ähnlich wie sich das Jahr im letzten Artikel geändert hat) sowie den Bewertungswert zu einem bestimmten Zeitpunkt.  Es ändert auch die Farbe, je nachdem, ob es über oder unter dem Durchschnitt liegt. </p><br><pre> <code class="plaintext hljs">##Building animations anim &lt;- gg + theme(plot.title = element_text(hjust = 0.5, size = 25), plot.subtitle = element_text(size = 15), plot.caption = element_text(size = 15), axis.text = element_text(size = 15), axis.title = element_text(size = 18)) + geom_text(aes(x = as.Date(data), y = max + 0.5), label = paste0(quo_name(quo_rating)," ", round(team$RATING, digits = 1)), size = 6, col = if_else(team$RATING &gt; average, color1, color2)) + transition_reveal(GAME_DATE) + labs(title = paste0(team$TEAM_NAME, " 10-Game Rolling ", quo_name(quo_rating)), subtitle = paste0(paste0(name_color1, " - above average ",quo_name(quo_rating)), "\n", paste0(name_color2, " - below average ",quo_name(quo_rating)), "\n", "Date: {frame_along}"), caption = paste0("Source: stats.nba.com\nTelegram: @NBAatlantic, twitter: @vshufinskiy"))</code> </pre> <br><h2 id="rezultat">  Ergebnis </h2><br><p><img src="https://habrastorage.org/webt/do/b-/hy/dob-hyqopjihkywk9kaq4jsrihg.gif"></p><br><p>  Auf dem Chart ist es ziemlich offensichtlich, dass Dallas in der zweiten Hälfte von Februar bis März gesunken ist.  Die Erklärung dafür ist sehr einfach: Zu diesem Zeitpunkt in der Saison tauschten die Mavericks 4 von 5 Spielern ihrer ersten fünf aus, und der Hauptzugang, der Lette Kristaps Porzingis, spielte wegen des Kreuzbandrisses eine Minute lang nicht. </p><br><p>  Hier werde ich nicht auf die Sportkomponente eingehen. Wenn also jemand daran interessiert ist, die verbleibenden 89 Charts der Saison 2018-19 zu sehen, sind Sie in meinem Blog auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sports.ru</a> willkommen, wo ich einen Artikel mit einer Übersicht der interessantesten von ihnen oder in meinem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Telegramm</a> schreiben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">möchte</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kanal</a> über die NBA, wo ich sie alle posten werde. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub-Repository</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de459142/">https://habr.com/ru/post/de459142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de459130/index.html">Schonende Fehlerbehandlung in Microservices</a></li>
<li><a href="../de459134/index.html">Erfahrung mit BDD</a></li>
<li><a href="../de459136/index.html">Gefälschte blaue Pille</a></li>
<li><a href="../de459138/index.html">Wie der geheime Schlüssel von Huawei in die Firmware von Cisco-Routern gelangt ist</a></li>
<li><a href="../de459140/index.html">Implantatinsertion: Wie wird das gemacht?</a></li>
<li><a href="../de459144/index.html">Frontend Weekly Digest (1. - 7. Juli 2019)</a></li>
<li><a href="../de459146/index.html">Food Design Digest Juni 2019</a></li>
<li><a href="../de459150/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends für die letzte Woche Nr. 372 (1. - 7. Juli 2019)</a></li>
<li><a href="../de459152/index.html">Füllen Sie Dokumente in Microsoft Word mit Python aus. Teil 2</a></li>
<li><a href="../de459154/index.html">Netzwerk für kleine Unternehmen mit Cisco-Geräten. Teil 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>