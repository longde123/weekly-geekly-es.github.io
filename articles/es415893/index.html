<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôáüèº ‚úçüèæ üë´ C√≥mo hacer que los procesos Java que se ejecutan en Linux / Docker sean simples y directos ü§∏üèº üòª üîå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como ingeniero de DevOps, a menudo trabajo en la automatizaci√≥n de la instalaci√≥n y configuraci√≥n de una variedad de sistemas de TI en diversos entorn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo hacer que los procesos Java que se ejecutan en Linux / Docker sean simples y directos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415893/"><p>  Como ingeniero de DevOps, a menudo trabajo en la automatizaci√≥n de la instalaci√≥n y configuraci√≥n de una variedad de sistemas de TI en diversos entornos: desde contenedores hasta la nube.  Tuve que trabajar con muchos sistemas basados ‚Äã‚Äãen la pila de Java: desde peque√±os (como Tomcat) hasta a gran escala (Hadoop, Cassandra, etc.). </p><br><p> Adem√°s, casi todos esos sistemas, incluso el m√°s simple, por alguna raz√≥n ten√≠an un complejo sistema de lanzamiento √∫nico.  Como m√≠nimo, se trataba de scripts de shell de varias l√≠neas, como en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tomcat</a> , e incluso marcos completos, como en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Hadoop</a> .  Mi "paciente" actual en esta serie, que me inspir√≥ a escribir este art√≠culo, es el repositorio de artefactos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nexus OSS 3</a> , cuyo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">script de lanzamiento</a> toma ~ 400 l√≠neas de c√≥digo. </p><br><p>  La opacidad, la redundancia y la complejidad de los scripts de inicio crean problemas incluso cuando se instala manualmente un componente en el sistema local.  Ahora imagine que necesita empaquetar un conjunto de dichos componentes y servicios en un contenedor Docker, escribir otra capa de abstracci√≥n siguiendo las l√≠neas de una orquestaci√≥n adecuada, implementarla en un cl√∫ster de Kubernetes e implementar este proceso como una tuber√≠a de CI / CD ... </p><br><p> En resumen, veamos el ejemplo del mencionado Nexus 3, c√≥mo regresar del laberinto de scripts de shell a algo m√°s similar a <code>java -jar &lt;program.jar&gt;</code> , dada la disponibilidad de herramientas DevOps modernas y convenientes. </p><a name="habracut"></a><br><h1 id="otkuda-takaya-slozhnost">  ¬øDe d√≥nde viene esta complejidad? </h1><br><p>  En pocas palabras, en la antig√ºedad, cuando a UNIX no se le volv√≠a a preguntar: "¬øen el sentido de Linux?", No hab√≠a Systemd y Docker y otros, se utilizaron scripts de shell port√°tiles (scripts de inicio) y PID para controlar los procesos. archivos.  Las secuencias de comandos de inicio establecen las configuraciones de entorno necesarias, que eran diferentes en diferentes UNIX, y, dependiendo de los argumentos, iniciaron el proceso o lo reiniciaron / detuvieron usando la ID del archivo PID.  El enfoque es simple y claro, pero estos scripts dejaron de funcionar en cualquier situaci√≥n inusual, requiriendo intervenci√≥n manual, no le permitieron ejecutar varias copias del proceso ... pero no era el punto. </p><br><p>  Por lo tanto, si observa detenidamente los scripts de inicio mencionados anteriormente en los proyectos Java, puede ver los signos obvios de este enfoque prehist√≥rico, incluida incluso la menci√≥n de SunOS, HP-UX y otros UNIX.  Por lo general, estos scripts hacen algo como esto: </p><br><ul><li>  use la sintaxis de shell POSIX con todas sus muletas para la portabilidad UNIX / Linux </li><li>  determinar la versi√≥n del sistema operativo y liberarlo a trav√©s de <code>uname</code> , <code>/etc/*release</code> , etc. </li><li>  buscan JRE / JDK en los rincones del sistema de archivos y seleccionan la versi√≥n m√°s "adecuada" de acuerdo con reglas inteligentes, a veces tambi√©n espec√≠ficas para cada sistema operativo </li><li>  Los par√°metros num√©ricos de JVM se calculan, por ejemplo, el tama√±o de la memoria ( <code>-Xms</code> , <code>-Xmx</code> ), el n√∫mero de subprocesos de GC, etc. </li><li>  optimice JVM a trav√©s de par√°metros <code>-XX</code> teniendo en cuenta los detalles de la versi√≥n seleccionada de JRE / JDK </li><li>  busque sus componentes, bibliotecas, rutas a ellos en los directorios circundantes, archivos de configuraci√≥n, etc. </li><li>  personalizar el entorno: ulimits, variables de entorno, etc. </li><li>  generar CLASSPATH con un bucle como: <code>for f in $path/*.jar; do CLASSPATH="${CLASSPATH}:$f"; done</code> <code>for f in $path/*.jar; do CLASSPATH="${CLASSPATH}:$f"; done</code> </li><li>  argumentos de l√≠nea de comandos analizados: <code>start|stop|restart|reload|status|...</code> </li><li>  compile el comando Java que finalmente necesita ejecutar desde lo anterior </li><li>  y finalmente <strong>ejecuta este comando java</strong> .  A menudo, los mismos archivos PID notorios, <code>&amp;</code> , no, puertos TCP especiales y otros trucos del siglo pasado se usan expl√≠cita o impl√≠citamente (vea el <a href="">ejemplo de Karaf</a> ) </li></ul><br><p>  El <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">script de lanzamiento de Nexus 3</a> mencionado es un ejemplo adecuado de dicho script. </p><br><p>  De hecho, toda la l√≥gica de script enumerada anteriormente, por as√≠ decirlo, est√° tratando de reemplazar al administrador del sistema, que instalar√≠a y configurar√≠a todo manualmente para un sistema espec√≠fico de principio a fin.  Pero, en general, es imposible tener en cuenta los requisitos de los sistemas m√°s diversos.  Por lo tanto, resulta, por el contrario, un dolor de cabeza, tanto para los desarrolladores que necesitan admitir estos scripts como para los ingenieros de sistemas que necesitan comprender estos scripts m√°s adelante.  Desde mi punto de vista, es mucho m√°s f√°cil para un ingeniero de sistemas comprender los par√°metros de JVM una vez y configurarlos como deber√≠a, que comprender las complejidades de sus scripts de inicio cada vez que instala un nuevo sistema. </p><br><h1 id="chto-zhe-delat">  Que hacer </h1><br><p>  Perdona!  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">KISS</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">YAGNI</a> est√°n en nuestras manos.  Adem√°s, el a√±o 2018 est√° en el patio, lo que significa que: </p><br><ul><li>  con muy pocas excepciones, UNIX == Linux </li><li>  El problema de control del proceso se resuelve tanto para un servidor separado ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Systemd</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Docker</a> ) como para cl√∫steres ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kubernetes</a> , etc.) </li><li>  Hay un mont√≥n de herramientas de administraci√≥n de configuraci√≥n convenientes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ansible</a> , etc.) </li><li>  la automatizaci√≥n total ha llegado a la administraci√≥n y ya se ha solidificado por completo: en lugar de configurar manualmente "fr√°giles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">copos de nieve"</a> √∫nicos y fr√°giles, ahora es posible ensamblar autom√°ticamente m√°quinas y contenedores virtuales reproducibles unificados utilizando una serie de herramientas convenientes, incluidas las mencionadas Ansible y Docker </li><li>  Las herramientas para recopilar estad√≠sticas de tiempo de ejecuci√≥n son ampliamente utilizadas, tanto para la propia JVM ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ejemplo</a> ) como para una aplicaci√≥n Java ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ejemplo</a> ) </li><li>  y, lo que es m√°s importante, aparecieron expertos: ingenieros de sistemas y DevOps que pueden usar las tecnolog√≠as enumeradas anteriormente y comprender c√≥mo instalar correctamente la JVM en un sistema espec√≠fico y, posteriormente, ajustarlo seg√∫n las estad√≠sticas de tiempo de ejecuci√≥n recopiladas </li></ul><br><p>  As√≠ que veamos nuevamente la funcionalidad de los scripts de inicio, teniendo en cuenta los puntos enumerados anteriormente, sin intentar hacer el trabajo para el ingeniero del sistema, y ‚Äã‚Äãeliminemos todos los "innecesarios" de all√≠. </p><br><ul><li><del>  Sintaxis de shell POSIX </del>  ‚áí <code>/bin/bash</code> </li><li><del>  Detecci√≥n de versi√≥n del sistema operativo </del>  ‚áí UNIX == Linux, si hay par√°metros espec√≠ficos del sistema operativo, puede describirlos en la documentaci√≥n </li><li><del>  B√∫squeda JRE / JDK </del>  ‚áí tenemos la √∫nica versi√≥n, y esta es OpenJDK (bueno, o Oracle JDK, si realmente lo necesita), <code>java</code> y la compa√±√≠a est√°n en la ruta est√°ndar del sistema </li><li><del>  c√°lculo de par√°metros num√©ricos JVM, sintonizaci√≥n JVM </del>  ‚áí esto se puede describir en la documentaci√≥n de escalado de la aplicaci√≥n </li><li><del>  busca tus componentes y bibliotecas </del>  ‚áí describa la estructura de la aplicaci√≥n y c√≥mo configurarla en la documentaci√≥n </li><li><del>  configuraci√≥n del entorno </del>  ‚áí describa los requisitos y caracter√≠sticas en la documentaci√≥n </li><li><del>  Generaci√≥n CLASSPATH </del>  ‚áí <code>-cp path/to/my/jars/*</code> o incluso, en general, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Uber-JAR</a> </li><li><del>  an√°lisis de argumentos de l√≠nea de comando </del>  ‚áí no habr√° argumentos, porque  el administrador de procesos se encargar√° de todo excepto el lanzamiento </li><li>  Conjunto de comandos de Java </li><li>  ejecuci√≥n del comando java </li></ul><br><p>  Como resultado, solo necesitamos ensamblar y ejecutar un comando Java de la forma <code>java &lt;opts&gt; -jar &lt;program.jar&gt;</code> usando el administrador de procesos seleccionado (Systemd, Docker, etc.).  Todos los par√°metros y opciones ( <code>&lt;opts&gt;</code> ) quedan a discreci√≥n del ingeniero del sistema, que los ajustar√° a un entorno espec√≠fico.  Si la lista de opciones <code>&lt;opts&gt;</code> bastante larga, puede volver a la idea de un script de inicio, pero, en este caso, lo <strong>m√°s compacto y declarativo posible</strong> , es decir.  No contiene ninguna l√≥gica de software. </p><br><h1 id="primer">  Ejemplo </h1><br><p>  Como ejemplo, veamos c√≥mo puede simplificar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el script de inicio de Nexus 3</a> . </p><br><p>  La opci√≥n m√°s f√°cil, para no entrar en la jungla de este script, simplemente ejec√∫telo en condiciones reales ( <code>./nexus start</code> ) y mire el resultado.  Por ejemplo, puede encontrar la lista completa de argumentos de la aplicaci√≥n en ejecuci√≥n en la tabla de procesos (a trav√©s de <code>ps -ef</code> ), o ejecutar el script en modo de depuraci√≥n ( <code>bash -x ./nexus start</code> ) para observar todo el proceso de su ejecuci√≥n y, al final, el comando de lanzamiento. </p><br><div class="spoiler">  <b class="spoiler_title">Termin√© con el siguiente comando de Java</b> <div class="spoiler_text"><pre> <code class="bash hljs">/usr/java/jdk1.8.0_171-amd64/bin/java -server -Dinstall4j.jvmDir=/usr/java/jdk1.8.0_171-amd64 -Dexe4j.moduleName=/home/nexus/nexus-3.12.1-01/bin/nexus -XX:+UnlockDiagnosticVMOptions -Dinstall4j.launcherId=245 -Dinstall4j.swt=<span class="hljs-literal"><span class="hljs-literal">false</span></span> -Di4jv=0 -Di4jv=0 -Di4jv=0 -Di4jv=0 -Di4jv=0 -Xms1200M -Xmx1200M -XX:MaxDirectMemorySize=2G -XX:+UnlockDiagnosticVMOptions -XX:+UnsyncloadClass -XX:+LogVMOutput -XX:LogFile=../sonatype-work/nexus3/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/jvm.log -XX:-OmitStackTraceInFastThrow -Djava.net.preferIPv4Stack=<span class="hljs-literal"><span class="hljs-literal">true</span></span> -Dkaraf.home=. -Dkaraf.base=. -Dkaraf.etc=etc/karaf -Djava.util.logging.config.file=etc/karaf/java.util.logging.properties -Dkaraf.data=../sonatype-work/nexus3 -Djava.io.tmpdir=../sonatype-work/nexus3/tmp -Dkaraf.startLocalConsole=<span class="hljs-literal"><span class="hljs-literal">false</span></span> -Di4j.vpt=<span class="hljs-literal"><span class="hljs-literal">true</span></span> -classpath /home/nexus/nexus-3.12.1-01/.install4j/i4jruntime.jar:/home/nexus/nexus-3.12.1-01/lib/boot/nexus-main.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.apache.karaf.main-4.0.9.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.osgi.core-6.0.0.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.apache.karaf.diagnostic.boot-4.0.9.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.apache.karaf.jaas.boot-4.0.9.jar com.install4j.runtime.launcher.UnixLauncher start 9d17dc87 <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> org.sonatype.nexus.karaf.NexusMain</code> </pre> </div></div><br><p>  Primero, aplique un par de trucos simples: </p><br><ul><li>  cambie <code>/the/long/and/winding/road/to/my/java</code> a <code>java</code> , porque est√° en la ruta del sistema </li><li>  coloque la lista de par√°metros de Java en una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">matriz</a> separada, ord√©nela y elimine los duplicados </li></ul><br><div class="spoiler">  <b class="spoiler_title">Ya tenemos algo m√°s digerible</b> <div class="spoiler_text"><pre> <code class="bash hljs">JAVA_OPTS = ( <span class="hljs-string"><span class="hljs-string">'-server'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dexe4j.moduleName=/home/nexus/nexus-3.12.1-01/bin/nexus'</span></span> <span class="hljs-string"><span class="hljs-string">'-Di4j.vpt=true'</span></span> <span class="hljs-string"><span class="hljs-string">'-Di4jv=0'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dinstall4j.jvmDir=/usr/java/jdk1.8.0_171-amd64'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dinstall4j.launcherId=245'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dinstall4j.swt=false'</span></span> <span class="hljs-string"><span class="hljs-string">'-Djava.io.tmpdir=../sonatype-work/nexus3/tmp'</span></span> <span class="hljs-string"><span class="hljs-string">'-Djava.net.preferIPv4Stack=true'</span></span> <span class="hljs-string"><span class="hljs-string">'-Djava.util.logging.config.file=etc/karaf/java.util.logging.properties'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dkaraf.base=.'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dkaraf.data=../sonatype-work/nexus3'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dkaraf.etc=etc/karaf'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dkaraf.home=.'</span></span> <span class="hljs-string"><span class="hljs-string">'-Dkaraf.startLocalConsole=false'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:+LogVMOutput'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:+UnlockDiagnosticVMOptions'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:+UnlockDiagnosticVMOptions'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:+UnsyncloadClass'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:-OmitStackTraceInFastThrow'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:LogFile=../sonatype-work/nexus3/log/jvm.log'</span></span> <span class="hljs-string"><span class="hljs-string">'-XX:MaxDirectMemorySize=2G'</span></span> <span class="hljs-string"><span class="hljs-string">'-Xms1200M'</span></span> <span class="hljs-string"><span class="hljs-string">'-Xmx1200M'</span></span> <span class="hljs-string"><span class="hljs-string">'-classpath /home/nexus/nexus-3.12.1-01/.install4j/i4jruntime.jar:/home/nexus/nexus-3.12.1-01/lib/boot/nexus-main.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.apache.karaf.main-4.0.9.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.osgi.core-6.0.0.jar:/home/nexus/nexus-3.12.1-01/lib/boot/org.apache.karaf.diagnostic.boot-4.0.9.jar:/home/nexus/nexus-3.12.1-01/lib/boot/'</span></span> ) java <span class="hljs-variable"><span class="hljs-variable">${JAVA_OPTS[*]}</span></span> com.install4j.runtime.launcher.UnixLauncher start 9d17dc87 <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> org.sonatype.nexus.karaf.NexusMain</code> </pre> </div></div><br><p>  Ahora puedes profundizar. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Install4j</a> es un instalador gr√°fico de Java.  Parece ser utilizado para la instalaci√≥n inicial del sistema.  No lo necesitamos en el servidor, lo eliminamos. </p><br><p>  Acordamos la ubicaci√≥n de los componentes y datos de Nexus en el sistema de archivos: </p><br><ul><li>  coloque la aplicaci√≥n en <code>/opt/nexus-&lt;version&gt;</code> </li><li>  para mayor comodidad, cree un enlace simb√≥lico <code>/opt/nexus -&gt; /opt/nexus-&lt;version&gt;</code> </li><li>  coloque el script en lugar del original como <code>/opt/nexus/bin/nexus</code> </li><li>  Todos los datos de nuestro Nexus se encontrar√°n en un sistema de archivos separado montado como <code>/data/nexus</code> </li></ul><br><p>  La creaci√≥n de directorios y enlaces es el destino de los sistemas de administraci√≥n de configuraci√≥n (para todo lo relacionado con las 5-10 l√≠neas en Ansible), as√≠ que dejemos esta tarea a los ingenieros de sistemas. </p><br><p>  Deje que nuestro script al inicio cambie el directorio de trabajo a <code>/opt/nexus</code> ; luego, podemos cambiar las rutas a los componentes de Nexus a los relativos. </p><br><p>  Opciones del formulario <code>-Dkaraf.*</code> las configuraciones para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apache Karaf</a> , el contenedor OSGi en el que nuestro Nexus obviamente est√° "empaquetado".  Cambie <code>karaf.home</code> , <code>karaf.base</code> , <code>karaf.etc</code> y <code>karaf.data</code> acuerdo con la ubicaci√≥n de los componentes, utilizando rutas relativas si es posible. </p><br><p>  Al ver que CLASSPATH consiste en una lista de archivos jar que se encuentran en el mismo directorio <code>lib/</code> , reemplace toda esta lista con <code>lib/*</code> (tambi√©n deber√° desactivar la expansi√≥n de comodines con <code>set -o noglob</code> ). </p><br><p>  Cambie <code>java</code> a <code>exec java</code> para que nuestro script no inicie <code>java</code> como un proceso secundario (el administrador de procesos no ver√° este proceso secundario), sino que "se reemplazar√°" por <code>java</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descripci√≥n de exec</a> ). </p><br><p>  Veamos que pas√≥: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash JAVA_OPTS=( '-Xms1200M' '-Xmx1200M' '-XX:+UnlockDiagnosticVMOptions' '-XX:+LogVMOutput' '-XX:+UnsyncloadClass' '-XX:LogFile=/data/nexus/log/jvm.log' '-XX:MaxDirectMemorySize=2G' '-XX:-OmitStackTraceInFastThrow' '-Djava.io.tmpdir=/data/nexus/tmp' '-Djava.net.preferIPv4Stack=true' '-Djava.util.logging.config.file=etc/karaf/java.util.logging.properties' '-Dkaraf.home=.' '-Dkaraf.base=.' '-Dkaraf.etc=etc/karaf' '-Dkaraf.data=/data/nexus/data' '-Dkaraf.startLocalConsole=false' '-server' '-cp lib/boot/*' ) set -o noglob cd /opt/nexus \ &amp;&amp; exec java ${JAVA_OPTS[*]} org.sonatype.nexus.karaf.NexusMain</span></span></code> </pre> <br><p>  Un total de 27 l√≠neas en lugar de&gt; 400, transparente, claro, declarativo, sin l√≥gica innecesaria.  Si es necesario, este script se puede convertir f√°cilmente en una plantilla para Ansible / Puppet / Chef y agregar solo la l√≥gica necesaria para una situaci√≥n espec√≠fica. </p><br><p>  Este script se puede usar como ENTRYPOINT en un Dockerfile o en el archivo de unidad de Systemd, al mismo tiempo que ajusta ulimits y otros par√°metros del sistema, por ejemplo: </p><br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">Unit</span></span>] Description=Nexus After=network.target [<span class="hljs-type"><span class="hljs-type">Service</span></span>] Type=simple LimitNOFILE=<span class="hljs-number"><span class="hljs-number">1048576</span></span> ExecStart=/opt/nexus/bin/nexus User=nexus Restart=on<span class="hljs-literal"><span class="hljs-literal">-abort</span></span> [<span class="hljs-type"><span class="hljs-type">Install</span></span>] WantedBy=multi<span class="hljs-literal"><span class="hljs-literal">-user</span></span>.target</code> </pre> <br><h1 id="zaklyuchenie">  Conclusi√≥n </h1><br><p>  ¬øQu√© conclusiones se pueden sacar de este art√≠culo?  En principio, se reduce a un par de puntos: </p><br><ol><li>  Cada sistema tiene su propio prop√≥sito, es decir, no es necesario clavar clavos con un microscopio. </li><li>  Reglas de simplicidad (KISS, YAGNI): para implementar solo lo que se necesita para una situaci√≥n espec√≠fica dada. </li><li>  Y lo m√°s importante: es genial que haya especialistas en TI de diferentes perfiles.  ¬°Interactuemos y hagamos que nuestros sistemas de TI sean m√°s simples, claros y mejores!  :) </li></ol><br><p>  Gracias por su atencion!  Estar√© encantado de recibir comentarios y discusiones constructivas en los comentarios. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es415893/">https://habr.com/ru/post/es415893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es415875/index.html">Una palabra para el ling√ºista: ¬øy si las computadoras hablan mejor?</a></li>
<li><a href="../es415879/index.html">Eventos digitales en Mosc√∫ del 2 al 8 de julio</a></li>
<li><a href="../es415881/index.html">C√≥mo funciona JS: tecnolog√≠a Shadow DOM y componentes web</a></li>
<li><a href="../es415887/index.html">¬øQu√© tipo de robots ara√±a vuelan sobre estadios y disparan al f√∫tbol? Entrevista con el creador de Robycam</a></li>
<li><a href="../es415891/index.html">¬øCu√°les son los juegos secuelas geniales?</a></li>
<li><a href="../es415895/index.html">El patr√≥n m√°s importante en la programaci√≥n.</a></li>
<li><a href="../es415897/index.html">Funciones para documentar bases de datos PostgreSQL. Parte dos</a></li>
<li><a href="../es415899/index.html">Office 365 Outlook encontr√≥ API no documentadas con registros detallados de actividad del usuario</a></li>
<li><a href="../es415901/index.html">La Comisi√≥n del Consejo de la Federaci√≥n apoy√≥ la idea de crear una base IMEI para todos los tel√©fonos blancos</a></li>
<li><a href="../es415903/index.html">Bienvenido al verano DIYorDIE Meetup el 7 de julio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>