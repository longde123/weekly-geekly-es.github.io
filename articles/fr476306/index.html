<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👵🏽 🎹 🧑🏿‍🤝‍🧑🏻 Instructions TelegramBot pour créer des fonctionnalités de base pour le bot. (Partie 1) 🈶 👶🏿 🧜🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il n'y a pas si longtemps, je vous ai suggéré d'utiliser mon robot de télégramme. 

 Telegram Bot - Assistant de planification d'événements 

 Ayant r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Instructions TelegramBot pour créer des fonctionnalités de base pour le bot. (Partie 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476306/">  Il n'y a pas si longtemps, je vous ai suggéré d'utiliser mon robot de télégramme. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Telegram Bot - Assistant de planification d'événements</a> <br><br>  Ayant reçu de nombreuses questions dans PM, j'ai réalisé que la question de la création de bots pour Telegram est assez populaire. <br><br>  Ils m'ont demandé le code source du bot, m'ont demandé de partager des exemples spécifiques de la mise en œuvre de diverses fonctionnalités du bot, m'ont demandé de suggérer une sorte de fonctionnalité pour travailler avec le bot et les messages. <br><br>  J'ai décidé d'écrire une série d'articles dans lesquels je veux montrer les choses de base dont vous aurez besoin pour écrire votre bot. <br>  Java, Maven, TelegramAPI, Lombok et Log4j vous attendent. <br>  Peu importe - s'il vous plaît, sous le chat ... <br><a name="habracut"></a><br>  Et immédiatement, j'irai avec les atouts <br><br>  Ce qui était demandé dans l'article précédent. <br><br>  Vous pouvez trouver les codes sources du projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">ici</a> . <br><br>  Dans la branche " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">master</a> ", il y aura la version finale du bot, que nous écrirons avec vous, en cours d'apparition de nouveaux articles. <br><br>  La source complète de cet article se trouve dans la branche " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Part1-Base</a> ". <br><br>  Dans cette partie, nous allons créer avec vous un modèle de base qui pourra: <br><br><ol><li>  enregistrer un bot sur des serveurs Telegram </li><li>  recevoir des messages écrits sur le bot </li><li>  répondre à la commande / start </li></ol><br><h3>  Créer un projet Maven standard </h3><br>  ( <i>Je vais manquer les manuels sur l'utilisation de l'environnement de développement et les choses de base de la programmation Java. Toutes ces choses sont assez faciles à google. Et si cela ne fonctionne pas, écrivez des questions</i> ). <br><br>  <b>Voyons quelles dépendances nous aurons besoin dans ce projet.</b> <br><br>  Tout d'abord, c'est <b>Lombok</b> .  Qu'est-ce que c'est et pourquoi - vous pouvez lire, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Et assurez-vous d'ajouter un enregistreur.  J'utilise <b>log4j</b> et un peu plus loin, je vais vous montrer à quel point il peut être utile lors du débogage de cette application et une compréhension plus approfondie du fonctionnement de TelegramAPI. <br><br><pre><code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.projectlombok<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>lombok<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.18.10<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>provided<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>log4j<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>log4j<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.2.17<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Et, parce que  nous écrivons un bot pour Telegram, puis la bibliothèque elle-même de Telegram: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.telegram<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>telegrambots<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  La structure du fichier pom se trouve <a href="" rel="nofollow">ici.</a> <br>  La structure du fichier pom.xml peut être vue <a href="" rel="nofollow">ici</a> . <br><br>  Ensuite, nous ajoutons la classe de base <a href="" rel="nofollow">Bot.java</a> , qui implémentera toutes nos interactions avec les services Telegram.  Nous travaillerons avec LongPolling, comme  Cette méthode ne nécessite pas de certificats de chiffrement et peut être lancée à partir de n'importe quelle machine disposant de Java. <br><br>  Pour ce faire, nous héritons de la classe <b>TelegramLongPollingBot</b> et implémentons les méthodes de base: <br><br>  <b>public void onUpdateReceived (mise à jour de mise à jour)</b> <b><br></b>  <b>public String getBotUsername ()</b> <b><br></b>  <b>public String getBotToken ()</b> <br><br>  Et de nous-mêmes, nous devrons ajouter une procédure qui connectera notre bot à TelegramAPI: <br><br>  <b>public void botConnect ()</b> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.AllArgsConstructor; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.Getter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.NoArgsConstructor; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.Setter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.log4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.telegram.telegrambots.TelegramBotsApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.telegram.telegrambots.api.objects.Update; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.telegram.telegrambots.bots.TelegramLongPollingBot; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.telegram.telegrambots.exceptions.TelegramApiRequestException; <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bot</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TelegramLongPollingBot</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = Logger.getLogger(Bot.class); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RECONNECT_PAUSE =<span class="hljs-number"><span class="hljs-number">10000</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Setter</span></span> <span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> String userName; <span class="hljs-meta"><span class="hljs-meta">@Setter</span></span> <span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> String token; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUpdateReceived</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Update update)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> 11/18/2019     log.debug("new Update recieve"); } @Override public String getBotUsername() { return userName; } @Override public String getBotToken() { return token; } public void botConnect() { TelegramBotsApi telegramBotsApi = new TelegramBotsApi(); try { telegramBotsApi.registerBot(this); log.info("TelegramAPI started. Look for messages"); } catch (TelegramApiRequestException e) { log.error("Cant Connect. Pause " + RECONNECT_PAUSE / 1000 + "sec and try again. Error: " + e.getMessage()); try { Thread.sleep(RECONNECT_PAUSE); } catch (InterruptedException e1) { e1.printStackTrace(); return; } botConnect(); } } }</span></span></code> </pre><br>  En principe, tout.  Ce code peut se connecter aux serveurs Telegram et dès réception des messages qui lui sont adressés il enregistrera les informations dans le fichier journal qu'il a reçu Update. <br><br>  Créons une classe qui exécutera notre application. <br><br>  Cela sera fait par la classe App.java.  Lien vers le fichier: <a href="" rel="nofollow">ici</a> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.telegrambot; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.example.telegrambot.bot.Bot; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.log4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.telegram.telegrambots.ApiContextInitializer; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = Logger.getLogger(App.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ ApiContextInitializer.init(); Bot test_habr_bot = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bot(<span class="hljs-string"><span class="hljs-string">"test_habr_bot"</span></span>, <span class="hljs-string"><span class="hljs-string">"1012522162:AAHLvPVqKF48LdqnsvS3l5YrJfvFey6dBa0"</span></span>); test_habr_bot.botConnect(); } }</code> </pre> <br>  Comme vous pouvez le voir, pour que le bot fonctionne, nous n'avons besoin que du «nom du bot» et du «token», que nous transmettrons au constructeur de notre classe Bot. <br><br>  Vous pouvez obtenir le nom et le jeton du bot du père de tous les bots :) en lui écrivant dans un télégramme. <br>  Son surnom: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">@BotFather</a> <br>  La communication avec lui est très simple et concise. <br><br>  Sur commande <br><blockquote>  / newbot </blockquote><br>  Par conséquent, vous devriez obtenir cette boîte de dialogue: <br><br><img src="https://habrastorage.org/webt/93/bo/fc/93bofc9fylsdmyu0polllzad-x4.png"><br><br>  Ils écrivent également ici que c'est plus précis, ne montrez ces informations à personne, sinon quelqu'un d'autre pourra contrôler votre bot :) <br><br>  Vous direz que je ne suis pas très précis ... Peut-être, mais le père des bots nous permet de changer les jetons et de révoquer ceux qui sont en accès public.  Par conséquent, lorsque vous essayez de vous connecter avec mes données, vous recevrez le message suivant: <br><br><pre> <code class="plaintext hljs">2019-12-04 13:44:25,252[DEBUG][main ][ com.example.telegrambot.bot.Bot] - Bot token: 1012522162:AAF5D49N4NreEJfCk0aOsC-UnmIu_GLkoyc 2019-12-04 13:44:26,613[ERROR][main ][ com.example.telegrambot.bot.Bot] - Cant Connect. Pause 10sec and try again. Error: Error removing old webhook</code> </pre><br>  Donc, avec mes données, vous ne pouvez pas vous connecter.  Enregistrez le vôtre.  Spécifiez de nouvelles données dans la classe <a href="" rel="nofollow">App.java</a> <br><br>  Maintenant, en exécutant la méthode principale dans la classe App, nous laissons notre bot se connecter et attendre de nouveaux messages.  Il nous écrira sur ses actions et tentatives dans la console. <br><br><h3>  Log4j </h3><br>  Rappelez-vous, ci-dessus, j'ai parlé de l'utilité de la bibliothèque log4j.  Et ici pour les curieux, un klondike de données utiles s'ouvre. <br><br>  Le fichier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">log4j.properties</a> contient déjà des paramètres de base pour la journalisation et des niveaux de journalisation spécifiques pour les classes tierces et pour celles qui fonctionnent dans notre bot. <br><br><pre> <code class="plaintext hljs">log4j.rootLogger= error, file log4j.logger.com.example.telegrambot.App = debug, stdout log4j.logger.com.example.telegrambot.bot.Bot = debug, stdout</code> </pre> <br>  Le niveau de base de la journalisation est indiqué comme Erreur. <br><br>  Pour les classes Bot et App, la sortie du journal au niveau du débogage est indiquée. <br><br>  <i>Quels sont ces niveaux et en quoi ils diffèrent - vous pouvez facilement les trouver dans Google.</i> <br><br>  Si vous souhaitez voir comment et dans quel ordre la bibliothèque Telegram exécute toutes vos actions, passez le mode de journalisation général à un niveau inférieur: info ou débogage. <br><br>  Et lorsque vous démarrez l'application, vous verrez dans la console combien de choses intéressantes se produisent pendant le processus de connexion, de travail.  Combien de fois vos fonctions sont-elles interrogées avec le nom et le jeton du bot. <br><br>  Les niveaux de journalisation changent avec cette ligne: <br>  Pour obtenir les journaux en fonction du niveau d'informations, mettez-le comme ceci: <br><br><pre> <code class="plaintext hljs">log4j.rootLogger= info, file</code> </pre> <br>  Pour le niveau de débogage, comme ceci: <br><br><pre> <code class="plaintext hljs">log4j.rootLogger= debug, file</code> </pre> <br><h3>  Et en conclusion </h3><br>  Maintenant, nous avons un bot: il se connecte, nous montre de beaux journaux et signale que des messages lui parviennent. <br><br>  Mais ci-dessus, je vous ai promis que le bot répondrait à la commande de démarrage.  Modifions un peu la procédure de traitement des messages reçus. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUpdateReceived</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Update update)</span></span></span><span class="hljs-function"> </span></span>{ log.debug(<span class="hljs-string"><span class="hljs-string">"Receive new Update. updateID: "</span></span> + update.getUpdateId()); Long chatId = update.getMessage().getChatId(); String inputText = update.getMessage().getText(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputText.startsWith(<span class="hljs-string"><span class="hljs-string">"/start"</span></span>)) { SendMessage message = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessage(); message.setChatId(chatId); message.setText(<span class="hljs-string"><span class="hljs-string">"Hello. This is start message"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { execute(message); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (TelegramApiException e) { e.printStackTrace(); } } }</code> </pre> <br>  Comme vous pouvez le voir dans le code, le bot fait ce qui suit: <br><br><ul><li>  Il reçoit une mise à jour et capture son numéro d'identification dans le journal. </li><li>  Récupère l'ID de discussion et le texte du message à partir du message transmis </li><li>  Vérifie si ce texte est une commande "/ start" </li><li>  Et en cas de comparaison réussie, il crée un message en réponse et l'envoie au chat, avec l'ID reçu plus tôt </li></ul><br>  J'espère que vous le trouverez utile et intéressant. <br><br>  À l'avenir, je vais vous montrer comment il est mis en œuvre dans mes bots: <br><br><ul><li>  recours à diverses équipes </li><li>  lier ces commandes aux gestionnaires </li><li>  multithreading: recevoir et envoyer des messages indépendamment </li><li>  formatage des messages </li><li>  travailler avec des boutons et des rappels </li><li>  modification d'anciens messages </li></ul><br>  Sur cette base, en accès public, 2 de mes robots fonctionnent désormais pour moi. <br><br>  Une chose que vous savez, c'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">un assistant de planification d'événements</a> . <br><br>  Et le deuxième - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Cheeky movie fan</a> .  Il aime les films et en sait beaucoup sur eux.  Et plus encore, il aime partager ses connaissances avec vous.  Il dirige sa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">chaîne dans un télégramme</a> , dans lequel il décide quels films il aime et vous les propose.  Il sait créer des sélections individuelles par genre et créer un abonnement à des recommandations personnalisées.  Il sait comment trouver de tels chefs-d'œuvre dont vous n'avez jamais entendu parler et ne savait même pas comment trouver de tels films. <br><br>  Par exemple, pensez-vous qu'il existe des films avec une combinaison aussi «sauvage» de genres tels que: documentaire, horreur, comédie. <br><br>  Mais le bot sur commande <br><br><pre> <code class="plaintext hljs">     2010-</code> </pre> <br>  Il dira que de 2010 à nos jours, de tels films ont été tournés jusqu'à 6 pièces :) <br><br>  Comment travailler avec des commandes similaires, comment analyser des chaînes et des séquences de commandes, nous discuterons avec vous dans les publications suivantes. <br><br>  Merci de votre attention.  La programmation est amusante :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476306/">https://habr.com/ru/post/fr476306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476294/index.html">Réseau de jeu distribué comme alternative à GFN: comment et pourquoi il peut décoller, là où il fonctionne déjà en Fédération de Russie</a></li>
<li><a href="../fr476296/index.html">21 novembre, Meetup d'ingénierie produit: qui est ingénieur produit?</a></li>
<li><a href="../fr476298/index.html">Parcourez les épines des vélos, première partie: découvrez les bases de la personnalisation du débogueur Visual Studio à l'aide de plugins</a></li>
<li><a href="../fr476300/index.html">Le magazine Tram est une star brillamment éclairée et rapidement fanée de l'avant-garde russe pour enfants</a></li>
<li><a href="../fr476304/index.html">Authentification du dongle matériel du périphérique Linux sur les systèmes de niveau supérieur</a></li>
<li><a href="../fr476308/index.html">Les 5 meilleures pratiques de développement logiciel à suivre en 2020</a></li>
<li><a href="../fr476310/index.html">CRM visage humain</a></li>
<li><a href="../fr476312/index.html">React ou Angular ou Vue.js - que choisir?</a></li>
<li><a href="../fr476316/index.html">Vue Storefront: Remplissez les données dans ES</a></li>
<li><a href="../fr476318/index.html">Nous attaquons complètement Joker 2019: comment s'est passée la plus grande conférence Java en Russie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>