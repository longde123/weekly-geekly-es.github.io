<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙂 🥘 ♠️ Conception par types: comment rendre les états invalides inexprimables en C # 🍆 ✋🏾 👩🏽‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En règle générale, les articles sur la conception de types contiennent des exemples dans les langages fonctionnels - Haskell, F # et autres. Ce concep...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conception par types: comment rendre les états invalides inexprimables en C #</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431186/"><p>  En règle générale, les articles sur la conception de types contiennent des exemples dans les langages fonctionnels - Haskell, F # et autres.  Ce concept peut ne pas sembler s'appliquer aux langages orientés objet, mais il ne l'est pas. </p><br><p>  Dans cet article, je vais traduire des exemples d'un article de <abbr title="Scott Wlaschin">Scott Vlaschin Type</abbr> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Design: comment rendre des états invalides inexprimables</a> en C # <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">idiomatique</a> .  J'essaierai également de montrer que cette approche est applicable non seulement en tant qu'expérience, mais aussi en code de travail. </p><a name="habracut"></a><br><h1 id="sozdayom-domennye-tipy">  Créer des types de domaine </h1><br><p>  Vous devez d'abord porter les types de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article précédent de la série</a> , qui sont utilisés dans les exemples en F #. </p><br><h2 id="oborachivaem-primitivnye-tipy-v-domennye">  Envelopper les types primitifs dans le domaine </h2><br><p>  Les exemples F # utilisent des types de domaine au lieu de primitives pour l'adresse e-mail, le code postal américain et le code d'état.  Essayons d'encapsuler un type primitif en C #: </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailAddress</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailAddress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Regex.IsMatch(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-string"><span class="hljs-string">@"^\S+@\S+\.\S+$"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"Email address must contain an @ sign"</span></span>); } Value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; Value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span> =&gt; obj <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> EmailAddress otherEmailAddress &amp;&amp; Value.Equals(otherEmailAddress.Value); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHashCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; Value.GetHashCode(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">implicit</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">operator</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EmailAddress address</span></span></span><span class="hljs-function">)</span></span> =&gt; address?.Value; }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailAddress(<span class="hljs-string"><span class="hljs-string">"a@example.com"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailAddress(<span class="hljs-string"><span class="hljs-string">"b@example.com"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> receiverList = String.Join(<span class="hljs-string"><span class="hljs-string">";"</span></span>, a, b);</code> </pre> <br><p>  J'ai déplacé la validation d'adresse de la fonction d'usine vers le constructeur, car une telle implémentation est plus typique pour C #.  Nous avons également dû implémenter une comparaison et une conversion en chaîne, ce qui sur F # serait fait par le compilateur. </p><br><p>  D'une part, la mise en œuvre semble assez volumineuse.  En revanche, la spécificité de l'adresse e-mail ne s'exprime ici que par des vérifications dans le constructeur et, éventuellement, par la logique de comparaison.  Il s'agit en grande partie de code d'infrastructure, qui, en outre, est peu susceptible de changer.  Ainsi, vous pouvez soit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">créer un</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modèle</a> , soit, au pire, copier le code général de classe en classe. </p><br><p>  Il convient de noter que la création de types de domaine à partir de valeurs primitives n'est pas la spécificité de la programmation fonctionnelle.  Au contraire, l'utilisation de types primitifs est considérée comme un signe de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mauvais code en POO</a> .  Vous pouvez voir des exemples de tels wrappers, par exemple, <a href="">dans NLog</a> et <a href="">NBitcoin</a> , et le type standard de TimeSpan est, en fait, un wrapper sur le nombre de ticks. </p><br><h2 id="sozdayom-obekty-znacheniya">  Création d'objets de valeur </h2><br><p>  Maintenant, nous devons créer un analogue de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">entrée</a> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailContactInfo</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> EmailAddress EmailAddress { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsEmailVerified { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailContactInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EmailAddress emailAddress, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isEmailVerified</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (emailAddress == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(emailAddress)); } EmailAddress = emailAddress; IsEmailVerified = isEmailVerified; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{EmailAddress}</span></span></span><span class="hljs-string">, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{(IsEmailVerified ? </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"verified"</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> : </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"not verified"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">"</span></span>; }</code> </pre> <br><p>  Encore une fois, il a fallu plus de code que F #, mais la plupart du travail peut être effectué par une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">refactorisation dans l'EDI</a> . </p><br><p>  Comme <code>EmailAddress</code> , <code>EmailContactInfo</code> est un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">objet de valeur</a> (au sens de <abbr title="Conception orientée sujet">DDD</abbr> , pas des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">types de valeur dans .NET</a> ), connu depuis longtemps et utilisé dans la modélisation d'objet. </p><br><p>  D'autres types - <code>StateCode</code> , <code>StateCode</code> , <code>PostalAddress</code> et <code>PersonalName</code> portés en C # de la même manière. </p><br><h1 id="sozdayom-kontakt">  Créer un contact </h1><br><p>  Ainsi, le code doit exprimer la règle "Le contact doit contenir une adresse e-mail ou une adresse postale (ou les deux adresses)."  Il est nécessaire d'exprimer cette règle afin que l'exactitude de l'état soit visible à partir de la définition de type et vérifiée par le compilateur. </p><br><h2 id="vyrazhaem-razlichnye-sostoyaniya-kontakta">  Exprimer divers états de contact </h2><br><p>  Cela signifie qu'un contact est un objet contenant le nom de la personne et soit une adresse e-mail, soit une adresse postale, ou les deux.  De toute évidence, une classe ne peut pas contenir trois ensembles de propriétés différents; par conséquent, trois classes différentes doivent être définies.  Les trois classes doivent contenir le nom du contact et en même temps, il devrait être possible de traiter les contacts de différents types de la même manière, sans savoir quelles adresses contient le contact.  Par conséquent, le contact sera représenté par une classe de base abstraite contenant le nom du contact et trois implémentations avec un ensemble de champs différent. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PersonalName Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Contact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(name)); } Name = name; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PostOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> PostalContactInfo post_; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostOnlyContact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, PostalContactInfo post</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (post == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(post)); } post_ = post; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> EmailContactInfo email_; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailOnlyContact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (email == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(email)); } email_ = email; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailAndPostContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> EmailContactInfo email_; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> PostalContactInfo post_; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailAndPostContact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email, PostalContactInfo post</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (email == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(email)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (post == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(post)); } email_ = email; post_ = post; } }</code> </pre> <br><p>  Vous pouvez affirmer que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous devez utiliser la composition</a> , pas l'héritage, et généralement vous devez hériter du comportement, pas des données.  Les remarques sont justes, mais, à mon avis, l'utilisation de la hiérarchie des classes est justifiée ici.  Premièrement, les sous-classes ne représentent pas seulement des cas particuliers de la classe de base, la hiérarchie entière est un concept - le contact.  Trois implémentations de contact reflètent très précisément les trois cas stipulés par la règle métier.  Deuxièmement, la relation entre la classe de base et ses héritiers, la répartition des responsabilités entre eux est facilement identifiable.  Troisièmement, si la hiérarchie devient vraiment un problème, vous pouvez séparer l'état du contact en une hiérarchie distincte, comme cela a été fait dans l'exemple d'origine.  En F #, l'héritage des enregistrements est impossible, mais les nouveaux types sont déclarés tout simplement, donc le fractionnement a été effectué immédiatement.  En C #, une solution plus naturelle serait de placer les champs Nom dans la classe de base. </p><br><h2 id="sozdanie-kontakta">  Créer un contact </h2><br><p>  Créer un contact est assez simple. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FromEmail</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> emailStr</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> email = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailAddress(emailStr); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> emailContactInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailContactInfo(email, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailOnlyContact(name, emailContactInfo); } }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonalName(<span class="hljs-string"><span class="hljs-string">"A"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"Smith"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contact = Contact.FromEmail(name, <span class="hljs-string"><span class="hljs-string">"abc@example.com"</span></span>);</code> </pre> <br><p>  Si l'adresse e-mail est incorrecte, ce code lèvera une exception, qui peut être considérée comme un analogue du retour <code>None</code> dans l'exemple d'origine. </p><br><h2 id="obnovlenie-kontakta">  Mise à jour des contacts </h2><br><p>  La mise à jour d'un contact est également simple - il vous suffit d'ajouter une méthode abstraite au type de <code>Contact</code> . </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdatePostalAddress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PostalContactInfo newPostalAddress</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdatePostalAddress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PostalContactInfo newPostalAddress</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailAndPostContact(Name, email_, newPostalAddress); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PostOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdatePostalAddress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PostalContactInfo newPostalAddress</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostOnlyContact(Name, newPostalAddress); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailAndPostContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdatePostalAddress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PostalContactInfo newPostalAddress</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailAndPostContact(Name, email_, newPostalAddress); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StateCode(<span class="hljs-string"><span class="hljs-string">"CA"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> zip = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ZipCode(<span class="hljs-string"><span class="hljs-string">"97210"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newPostalAddress = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostalAddress(<span class="hljs-string"><span class="hljs-string">"123 Main"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"Beverly Hills"</span></span>, state, zip); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newPostalContactInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostalContactInfo(newPostalAddress, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newContact = contact.UpdatePostalAddress(newPostalContactInfo);</code> </pre> <br><p>  Comme avec option.Value en F #, lever une exception des constructeurs est possible si l'adresse e-mail, le code postal ou l'état est incorrect, mais pour C # c'est une pratique courante.  Bien sûr, le code d'exception doit être fourni dans le code de travail ici ou quelque part dans le code appelant. </p><br><h2 id="obrabotka-kontaktov-vne-ierarhii">  Gérer les contacts en dehors de la hiérarchie </h2><br><p>  Il est logique de placer la logique de mise à jour d'un contact dans la hiérarchie des <code>Contact</code> elle-même.  Mais que faire si vous voulez accomplir quelque chose qui ne rentre pas dans son domaine de responsabilité?  Supposons que vous souhaitiez afficher les contacts sur l'interface utilisateur. </p><br><p>  Vous pouvez bien sûr ajouter à nouveau la méthode abstraite à la classe de base et continuer à ajouter une nouvelle méthode chaque fois que vous avez besoin de traiter des contacts d'une manière ou d'une autre.  Mais alors le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">principe de la responsabilité exclusive</a> sera violé, la hiérarchie des <code>Contact</code> sera encombrée et la logique de traitement sera floue entre les implémentations des <code>Contact</code> et les lieux responsables, en fait, du traitement des contacts.  Il n'y avait pas un tel problème en F #, j'aimerais que le code C # ne soit pas pire! </p><br><p>  L'équivalent le plus proche de la correspondance de motifs en C # est la construction switch.  Nous pourrions ajouter une propriété de type énuméré à <code>Contact</code> qui nous permettrait de déterminer le type réel de contact et d'effectuer la conversion.  Il serait également possible d'utiliser les nouvelles fonctionnalités de C # et d'effectuer un basculement en tant qu'instance de <code>Contact</code> .  Mais nous voulions que le compilateur se demande quand de nouveaux états de <code>Contact</code> corrects ont été ajoutés, où le traitement des nouveaux cas n'est pas suffisant et le commutateur ne garantit pas le traitement de tous les cas possibles. </p><br><p>  Mais la POO dispose également d'un mécanisme plus pratique pour choisir la logique en fonction du type, et nous l'avons simplement utilisé lors de la mise à jour d'un contact.  Et puisque maintenant le choix dépend du type d'appel, il doit également être polymorphe.  La solution est le modèle Visitor.  Il vous permet de sélectionner un gestionnaire en fonction de l'implémentation de <code>Contact</code> , dissocie les méthodes de traitement des contacts de leur hiérarchie, et si un nouveau type de contact est ajouté, et, en conséquence, une nouvelle méthode dans l'interface Visiteur, vous devrez l'écrire dans toutes les implémentations de l'interface.  Toutes les exigences sont remplies! </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptVisitor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IContactVisitor visitor</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IContactVisitor</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Visit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Visit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, PostalContactInfo post</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Visit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email, PostalContactInfo post</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptVisitor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IContactVisitor visitor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visitor == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(visitor)); } visitor.Visit(Name, email_); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PostOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptVisitor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IContactVisitor visitor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visitor == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(visitor)); } visitor.Visit(Name, post_); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailAndPostContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptVisitor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IContactVisitor visitor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visitor == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(visitor)); } visitor.Visit(Name, email_, post_); } }</code> </pre> <br><p>  Vous pouvez maintenant écrire du code pour afficher les contacts.  Pour plus de simplicité, je vais utiliser l'interface de la console. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ContactUi</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Visitor</span></span> : <span class="hljs-title"><span class="hljs-title">IContactVisitor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IContactVisitor.Visit(PersonalName name, EmailContactInfo email) { Console.WriteLine(name); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"* Email: {0}"</span></span>, email); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IContactVisitor.Visit(PersonalName name, PostalContactInfo post) { Console.WriteLine(name); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"* Postal address: {0}"</span></span>, post); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IContactVisitor.Visit(PersonalName name, EmailContactInfo email, PostalContactInfo post) { Console.WriteLine(name); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"* Email: {0}"</span></span>, email); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"* Postal address: {0}"</span></span>, post); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Display</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Contact contact</span></span></span><span class="hljs-function">)</span></span> =&gt; contact.AcceptVisitor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Visitor()); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ui = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContactUi(); ui.Display(newContact);</code> </pre> <br><h2 id="dalneyshie-uluchsheniya">  Améliorations supplémentaires </h2><br><p>  Si <code>Contact</code> déclaré dans la bibliothèque et que l'apparition de nouveaux héritiers dans les clients de la bibliothèque n'est pas souhaitable, vous pouvez modifier la portée du constructeur <code>Contact</code> en <code>internal</code> , ou même rendre ses classes imbriquées héritières, déclarer la visibilité des implémentations et du constructeur <code>private</code> , et créer des instances à l'aide de méthodes d'usine statiques uniquement. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmailOnlyContact</span></span> : <span class="hljs-title"><span class="hljs-title">Contact</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailOnlyContact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span> { } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Contact</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Contact </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmailOnly</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName name, EmailContactInfo email</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmailOnlyContact(name, email); }</code> </pre> <br><p>  Ainsi, il est possible de reproduire la non-extensibilité de la somme de types, bien que, en règle générale, cela ne soit pas requis. </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  J'espère que j'ai pu montrer comment limiter l'état correct de la logique métier à l'aide de types avec des outils OOP.  Le code s'est avéré plus volumineux que sur F #.  Quelque part, cela est dû à la lourdeur relative des décisions de la POO, quelque part à cause de la verbosité de la langue, mais les solutions ne peuvent pas être qualifiées d'impraticables. </p><br><p>  Fait intéressant, à partir d'une solution purement fonctionnelle, nous sommes arrivés à la recommandation d'une programmation orientée sujet et de modèles de POO.  En fait, cela n'est pas surprenant, car la similitude des sommes de type et du profil des visiteurs est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">connue depuis</a> un certain <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">temps</a> .  Le but de cet article était de montrer non pas tant une astuce concrète que de démontrer l'applicabilité des idées de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«tour d'ivoire»</a> dans la programmation impérative.  Bien sûr, tout ne peut pas être transféré aussi facilement, mais avec l'avènement de plus en plus de fonctionnalités dans les langages de programmation traditionnels, les limites de l'applicable s'élargiront. </p><br><hr><br><p>  → Un exemple de code est disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431186/">https://habr.com/ru/post/fr431186/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431174/index.html">Théorie de la simulation: la relation entre les calculs chimiques quantiques et la réalité</a></li>
<li><a href="../fr431176/index.html">Microservices, API et innovations: la puissance des API</a></li>
<li><a href="../fr431178/index.html">Mots parasites en anglais</a></li>
<li><a href="../fr431180/index.html">Ext JS sur le serveur</a></li>
<li><a href="../fr431184/index.html">Réseaux maillés multi-sauts WIFI utilisant la technologie Mesh Connex</a></li>
<li><a href="../fr431188/index.html">Aspects techniques du blocage d'Internet en Russie. Défis et perspectives</a></li>
<li><a href="../fr431190/index.html">Comment évaluer le niveau d'une entreprise de référencement sans conclure un accord avec elle</a></li>
<li><a href="../fr431192/index.html">AWC présente Firecracker - micro-virtualisation pour Linux</a></li>
<li><a href="../fr431194/index.html">Tube chaud hardcore. Comment était DotNext 2018 Moscou</a></li>
<li><a href="../fr431196/index.html">Comment Yandex.Taxi prédit le temps de livraison des voitures à l'aide de l'apprentissage automatique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>