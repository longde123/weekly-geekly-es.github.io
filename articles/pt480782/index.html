<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèø‚Äçü§ù‚Äçüßëüèø üö¥üèΩ üîÇ 5 coisas que eu gostaria de saber quando comecei a usar o Angular üë¢ üßúüèº üëãüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Angular moderno √© uma estrutura poderosa com muitos recursos, junto com a qual, √† primeira vista, surgem conceitos e mecanismos complexos. Isso √© es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>5 coisas que eu gostaria de saber quando comecei a usar o Angular</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/480782/"><p>  O Angular moderno √© uma estrutura poderosa com muitos recursos, junto com a qual, √† primeira vista, surgem conceitos e mecanismos complexos.  Isso √© especialmente percept√≠vel para aqueles que acabaram de come√ßar a trabalhar tanto no front-end em princ√≠pio quanto no Angular em particular. </p><br><p>  Tamb√©m enfrentei o mesmo problema quando cheguei a Tinkoff na posi√ß√£o de Junior Frontend Developer h√° cerca de dois anos e mergulhei no mundo da Angular.  Portanto, ofere√ßo-lhe uma pequena hist√≥ria sobre cinco coisas, cuja compreens√£o facilitaria muito meu trabalho a princ√≠pio. </p><br><p><img src="https://habrastorage.org/webt/er/qq/op/erqqope6skve-m43vun9ivrjyda.png"></p><a name="habracut"></a><br><h2 id="dependency-injection-di">  Inje√ß√£o de Depend√™ncia (DI) </h2><br><p>  No come√ßo, entrei no componente e vi que havia alguns argumentos no construtor de classes.  Fiz uma pequena an√°lise do trabalho dos m√©todos de classe e ficou claro que essas s√£o algumas depend√™ncias externas.  Mas como eles entraram na aula?  Onde o construtor foi chamado? </p><br><p>  Sugiro imediatamente entender um exemplo, mas para isso precisamos de uma aula.  Se no JavaScript "normal" o OOP estiver presente com certos "hacks", juntamente com o ES6, haver√° uma sintaxe "real".  Angular usa o TypeScript imediatamente, na qual a sintaxe √© praticamente a mesma.  Portanto, proponho us√°-lo ainda mais. </p><br><p> Imagine que existe uma classe <code>JokerService</code> em nosso aplicativo que gerencia piadas.  O m√©todo <code>getJokes()</code> retorna uma lista de piadas.  Suponha que a usemos em tr√™s lugares.  Como obter piadas em tr√™s lugares diferentes no c√≥digo?  Existem v√°rias maneiras: </p><br><ol><li>  Crie uma inst√¢ncia da classe em todos os lugares.  Mas por que precisamos entupir a mem√≥ria e criar tantos servi√ßos id√™nticos?  E se houver 100 lugares? </li><li>  Torne o m√©todo est√°tico e recupere dados usando JokerService.getJokes (). </li><li>  Implemente um dos padr√µes de design.  Se precisarmos que o servi√ßo seja um para todo o aplicativo, esse ser√° o Singleton.  Mas, para isso, voc√™ precisa escrever uma nova l√≥gica na classe. </li></ol><br><p>  Ent√£o, temos tr√™s op√ß√µes bastante funcionais.  O primeiro n√£o nos conv√©m - neste caso, √© ineficaz.  N√£o queremos criar c√≥pias extras, pois elas ser√£o completamente id√™nticas.  Restam duas op√ß√µes. </p><br><p>  Vamos complicar a tarefa de entender qual m√©todo nos conv√©m melhor.  Suponha que, em terceiro lugar, precisamos, por algum motivo, criar nosso pr√≥prio servi√ßo com determinados par√¢metros.  Esse pode ser um autor espec√≠fico, a dura√ß√£o da piada, o idioma e muito mais.  O que faremos ent√£o? </p><br><p>  No caso do m√©todo est√°tico, voc√™ ter√° que passar as configura√ß√µes a cada chamada, pois a classe √© comum a todos os lugares.  Ou seja, em cada chamada para <code>getJokes()</code> passaremos todos os par√¢metros exclusivos para esse local.  Obviamente, √© melhor pass√°-las ao criar a inst√¢ncia e depois chamar o m√©todo <code>getJokes()</code> . </p><br><p>  Acontece que a segunda op√ß√£o tamb√©m n√£o nos serve: far√° sempre duplicar muito c√≥digo em todos os lugares.  Resta apenas o Singleton, que novamente precisar√° atualizar a l√≥gica, mas com varia√ß√µes.  Mas como entender qual op√ß√£o precisamos? </p><br><p>  Se voc√™ pensou que pode simplesmente criar um objeto e usar a chave para executar o servi√ßo desejado, posso parabeniz√°-lo: voc√™ acabou de perceber como a <em>Inje√ß√£o de Depend√™ncia</em> funciona em geral.  Mas vamos um pouco mais fundo. </p><br><p>  Para garantir que um mecanismo seja necess√°rio para nos ajudar a obter as inst√¢ncias corretas, imagine que o JokerService precise de mais dois servi√ßos, um dos quais √© opcional e o segundo deve fornecer um resultado especial em um determinado local.  N√£o √© dif√≠cil. </p><br><h3 id="dependency-injection-v-angular">  Inje√ß√£o de Depend√™ncia em Angular </h3><br><p>  Como diz a <a href="https://angular.io/guide/dependency-injection">documenta√ß√£o</a> , o DI √© um padr√£o de design importante para um aplicativo.  O Angular possui sua pr√≥pria estrutura de depend√™ncia, usada no pr√≥prio Angular para aumentar a efici√™ncia e a modularidade. </p><br><p>  De um modo geral, a <em>Inje√ß√£o de Depend√™ncias</em> √© um mecanismo poderoso no qual uma classe recebe as depend√™ncias necess√°rias de algum lugar externo, em vez de criar inst√¢ncias por conta pr√≥pria. </p><br><p>  Deixe a sintaxe e os arquivos com a extens√£o <code>html</code> n√£o confundirem voc√™.  Cada componente no Angular √© um objeto JavaScript comum, uma inst√¢ncia de uma classe.  Em termos gerais: quando voc√™ insere um componente em um modelo, uma inst√¢ncia da classe de componente √© criada.  Portanto, neste momento, voc√™ pode passar as depend√™ncias necess√°rias para o construtor.  Agora considere um exemplo: </p><br><pre> <code class="plaintext hljs">@Component({ selector: 'jokes', template: './jokes.template.html', }) export class JokesComponent { private jokes: Observable&lt;IJoke[]&gt;; constructor(private jokerService: JokerService) { this.jokes = this.jokerService.getJokes(); } }</code> </pre> <br><p>  No construtor de componentes, simplesmente indicamos que precisamos de um <code>JokerService</code> .  N√≥s n√£o criamos n√≥s mesmos.  Se houver mais cinco componentes que o usem, todos eles se referir√£o √† mesma inst√¢ncia.  Tudo isso nos permite economizar tempo, eliminar clich√™s e escrever aplicativos muito produtivos. </p><br><h3 id="providers">  Fornecedores </h3><br><p>  E agora proponho lidar com o caso quando voc√™ precisar obter inst√¢ncias diferentes do servi√ßo.  Primeiro, d√™ uma olhada no pr√≥prio servi√ßo: </p><br><pre> <code class="plaintext hljs">@Injectable({ providedIn: 'root', //   ,   ¬´¬ª  }) export class JokerService { getJokes(): Observable&lt;IJoke[]&gt; { //     } }</code> </pre> <br><p>  Quando o servi√ßo for um para todo o aplicativo, essa op√ß√£o ser√° suficiente.  Mas e se tivermos, digamos, duas implementa√ß√µes do <code>JokerService</code> ?  Ou √© apenas por algum motivo que um componente espec√≠fico precisa de sua pr√≥pria inst√¢ncia de servi√ßo?  A resposta √© simples: <a href="https://angular.io/guide/providers"><code>provider</code></a> . </p><br><p>  Por conveni√™ncia, chamarei <code>provider</code> <em>provedor de provedor</em> , e o processo de substitui√ß√£o de um valor em uma classe ser√° <em>verificado</em> .  Assim, podemos fornecer servi√ßos de diferentes maneiras e em diferentes lugares.  Vamos come√ßar com o √∫ltimo.  Existem tr√™s op√ß√µes dispon√≠veis: </p><br><ul><li>  Em todo o aplicativo - especifique <code>provideIn: 'root'</code> no pr√≥prio decorador de servi√ßos. </li><li>  No m√≥dulo - especifique o provedor no decorador de servi√ßos como <code>provideIn: JokesModule</code> ou no decorador do m√≥dulo <code>@NgModule  providers: [JokerService]</code> . </li><li>  No componente - especifique o provedor no decorador do componente, como no m√≥dulo. </li></ul><br><p>  O local √© escolhido dependendo de suas necessidades.  N√≥s descobrimos o lugar, vamos para o mecanismo em si.  Se simplesmente especific√°ssemos o <code>provideIn: root</code> no servi√ßo, isso seria equivalente √† seguinte entrada no m√≥dulo: </p><br><pre> <code class="plaintext hljs">@NgModule({ // ...     providers: [{provide: JokerService, useClass: JokerService}], }) //  </code> </pre> <br><p>  Isso pode ser lido da seguinte maneira: "Se um <code>JokerService</code> solicitado, forne√ßa uma inst√¢ncia da classe <code>JokerService¬ª</code>  A partir daqui, voc√™ pode obter uma inst√¢ncia espec√≠fica de v√°rias maneiras: </p><br><ul><li><p>  Por token - voc√™ precisa especificar um <code>InjectionToken</code> e obter um servi√ßo nele.  Observe que nos exemplos abaixo em <code>provide</code> voc√™ pode transmitir o mesmo token: </p><br><pre> <code class="plaintext hljs">const JOKER_SERVICE_TOKEN = new InjectionToken&lt;string&gt;('JokerService'); // ...     [{provide: JOKER_SERVICE_TOKEN, useClass: JokerService}];</code> </pre> <br></li><li><p>  Por classe - voc√™ pode substituir a classe.  Por exemplo, solicitaremos o <code>JokerService</code> e forneceremos - <code>JokerHappyService</code> : </p><br><pre> <code class="plaintext hljs">[{provide: JokerService, useClass: JokerHappyService}];</code> </pre> <br></li><li><p>  Por valor - voc√™ pode retornar imediatamente a inst√¢ncia desejada: </p><br><pre> <code class="plaintext hljs">[{provide: JokerService, useValue: jokerService}];</code> </pre> <br></li><li><p>  Por f√°brica - voc√™ pode substituir a classe por uma f√°brica que criar√° a inst√¢ncia desejada quando for acessada: </p><br><pre> <code class="plaintext hljs">[{provide: JokerService, useFactory: jokerServiceFactory}];</code> </pre> <br></li></ul><br><p>  Isso √© tudo.  Ou seja, para resolver o exemplo com uma inst√¢ncia especial, voc√™ pode usar qualquer um dos m√©todos acima.  Escolha o mais adequado √†s suas necessidades. </p><br><p>  A prop√≥sito, o DI trabalha n√£o apenas para servi√ßos, mas em geral para qualquer entidade que voc√™ obt√©m no construtor de componentes.  Este √© um mecanismo muito poderoso que deve ser usado em todo o seu potencial. </p><br><h3 id="nebolshoy-itog">  Um pequeno resumo </h3><br><p>  Para um entendimento completo, proponho considerar o mecanismo simplificado de inje√ß√£o de depend√™ncia no Angular em etapas usando o exemplo de servi√ßo: </p><br><ol><li>  Ao inicializar o aplicativo, o servi√ßo possui um token.  Se n√£o o especificamos especificamente no provedor, esse √© o JokerService. </li><li>  Quando um servi√ßo √© solicitado em um componente, o mecanismo DI verifica se o token transferido existe. </li><li>  Se o token n√£o existir, o DI emitir√° um erro.  No nosso caso, o token existe e o JokerService est√° localizado nele. </li><li>  Quando o componente √© criado, uma inst√¢ncia do JokerService √© passada ao construtor como argumento. </li></ol><br><h2 id="change-detection">  Detec√ß√£o de altera√ß√µes </h2><br><p>  Frequentemente ouvimos, como argumento para o uso de estruturas, algo como ‚ÄúA estrutura far√° tudo por voc√™ - de maneira mais r√°pida e eficiente.  Voc√™ n√£o precisa pensar em nada.  Apenas gerencie os dados. ‚Äù  Talvez isso seja verdade com uma aplica√ß√£o muito simples.  Mas se voc√™ precisar trabalhar com as informa√ß√µes do usu√°rio e operar constantemente com os dados, precisar√° saber como funciona o processo de detec√ß√£o de altera√ß√µes e renderiza√ß√£o. </p><br><p>  Em Angular, a <em>Detec√ß√£o de altera√ß√µes</em> √© respons√°vel por verificar as altera√ß√µes.  Como resultado de v√°rias opera√ß√µes - alterando o valor de uma propriedade de classe, concluindo uma opera√ß√£o ass√≠ncrona, respondendo a uma solicita√ß√£o HTTP e assim por diante - o processo de verifica√ß√£o √© iniciado na √°rvore de componentes. </p><br><p>  Como o principal objetivo do processo √© entender como renderizar novamente um componente, a ess√™ncia √© verificar os dados usados ‚Äã‚Äãnos modelos.  Se forem diferentes, o modelo ser√° marcado como "alterado" e ser√° redesenhado. </p><br><h3 id="zonejs">  Zone.js </h3><br><p>  Compreender como o Angular controla as propriedades da classe e as opera√ß√µes s√≠ncronas √© bastante simples.  Mas como ele rastreia ass√≠ncrono?  A biblioteca Zone.js, criada por um dos desenvolvedores Angular, √© respons√°vel por isso. </p><br><p>  Aqui est√° o que √©.  Uma zona em si √© um "contexto de execu√ß√£o", para ser franco, o local e o estado em que o c√≥digo √© executado.  Ap√≥s a conclus√£o da opera√ß√£o ass√≠ncrona, a fun√ß√£o de retorno de chamada √© executada na mesma zona em que foi registrada.  Ent√£o a Angular descobre onde a altera√ß√£o ocorreu e o que verificar. </p><br><p>  O Zone.js substitui por suas implementa√ß√µes quase todas as fun√ß√µes e m√©todos ass√≠ncronos nativos.  Portanto, ele pode rastrear quando o <code>callback</code> uma fun√ß√£o ass√≠ncrona ser√° chamado.  Ou seja, o Zone informa ao Angular quando e onde iniciar o processo de valida√ß√£o de altera√ß√µes. </p><br><h3 id="strategii-obnaruzheniya-izmeneniy">  Estrat√©gias de detec√ß√£o de altera√ß√µes </h3><br><p>  N√≥s descobrimos como o Angular monitora um componente e executa a verifica√ß√£o de altera√ß√µes.  Agora imagine que voc√™ tenha um aplicativo enorme com dezenas de componentes.  E para cada clique, toda opera√ß√£o ass√≠ncrona, toda solicita√ß√£o executada com sucesso, uma verifica√ß√£o √© iniciada em toda a √°rvore de componentes.  Provavelmente, esse aplicativo ter√° s√©rios problemas de desempenho. </p><br><p>  Os desenvolvedores angulares pensaram sobre isso e nos deram a oportunidade de estabelecer uma estrat√©gia de detec√ß√£o de altera√ß√µes, cuja escolha correta pode aumentar significativamente a produtividade. </p><br><p>  H√° duas op√ß√µes para escolher: </p><br><ul><li>  Padr√£o - como o nome sugere, esta √© a estrat√©gia padr√£o quando um CD √© lan√ßado para cada a√ß√£o. </li><li>  OnPush √© uma estrat√©gia na qual um CD √© lan√ßado em apenas alguns casos: <br><ul><li>  se o valor de <code>@Input()</code> mudou; </li><li>  se um evento ocorreu dentro do componente ou de seus descendentes; </li><li>  se a verifica√ß√£o foi iniciada manualmente; </li><li>  se um novo evento chegar no Tubo ass√≠ncrono. </li></ul></li></ul><br><p>  Com base na minha pr√≥pria experi√™ncia em desenvolvimento no Angular, bem como na experi√™ncia de meus colegas, posso afirmar com certeza que √© melhor sempre indicar a estrat√©gia <code>OnPush</code> , a menos que o <code>default</code> realmente necess√°rio.  Isso lhe dar√° v√°rias vantagens: </p><br><ul><li>  Uma compreens√£o clara de como o processo do CD funciona. </li><li>  Trabalho puro com propriedades <code>@Input()</code> . </li><li>  Ganho de desempenho. </li></ul><br><h2 id="rabota-s-input">  Trabalhar com <code>@Input()</code> </h2><br><p>  Como outras estruturas populares, o Angular usa um fluxo de dados downstream.  O componente aceita par√¢metros de entrada marcados com o decorador <code>@Input()</code> .  Considere um exemplo: </p><br><pre> <code class="plaintext hljs">interface IJoke { author: string; text: string; } @Component({ selector: 'joke', template: './joke.template.html', }) export class JokeComponent { @Input() joke: IJoke; }</code> </pre> <br><p>  Suponha que exista um componente descrito acima que exiba o texto da piada e o autor.  O problema com esta reda√ß√£o √© que voc√™ pode alterar acidental ou especificamente o objeto transferido.  Por exemplo, substitua o texto ou autor. </p><br><pre> <code class="plaintext hljs">setAuthorNameOnly() { const name = this.joke.author.split(' ')[0]; this.joke.author = name; }</code> </pre> <br><p>  Percebo imediatamente que este √© um mau exemplo, mas mostra claramente o que pode acontecer.  Para se proteger contra esses erros, √© necess√°rio tornar os par√¢metros de entrada somente leitura.  Gra√ßas a isso, voc√™ entender√° como trabalhar com os dados corretamente e criar um CD.  Com base nisso, a melhor maneira de escrever uma classe ser√° algo como isto: </p><br><pre> <code class="plaintext hljs">@Component({ selector: 'joke', template: './joke.template.html', changeDetection: ChangeDetectionStrategy.OnPush, }) export class JokeComponent { @Input() readonly joke: IJoke; @Output() updateName = new EventEmitter&lt;string&gt;(); setAuthorNameOnly() { const name = this.joke.author.split(' ')[0]; this.updateName.emit(name); } }</code> </pre> <br><p>  A abordagem descrita n√£o √© uma regra, mas apenas uma recomenda√ß√£o.  Existem muitas situa√ß√µes em que essa abordagem ser√° inconveniente e ineficaz.  Com o tempo, voc√™ aprender√° a entender em que caso poder√° recusar o m√©todo proposto de trabalhar com entradas. </p><br><h2 id="rxjs">  Rxjs </h2><br><p>  √â claro que posso estar errado, mas parece que o ReactiveX e a programa√ß√£o reativa em geral s√£o uma nova tend√™ncia.  Angular sucumbiu a essa tend√™ncia (ou talvez a tenha criado) e usa o RxJS por padr√£o.  A l√≥gica b√°sica de toda a estrutura √© executada nesta biblioteca, portanto, √© muito importante entender os princ√≠pios da programa√ß√£o reativa. </p><br><p>  Mas o que √© RxJS?  Ele combina tr√™s id√©ias que vou revelar em uma linguagem bastante simples, com algumas omiss√µes: </p><br><ul><li>  <em>O padr√£o "Observador"</em> √© uma entidade que produz eventos, e h√° um ouvinte que recebe informa√ß√µes sobre esses eventos. </li><li>  <em>O Padr√£o Iterador</em> - permite obter acesso seq√ºencial aos elementos de um objeto sem revelar sua estrutura interna. </li><li>  <em>A programa√ß√£o funcional com cole√ß√µes</em> √© um padr√£o no qual a l√≥gica bate em componentes pequenos e muito simples, cada um dos quais resolve apenas um problema. </li></ul><br><p>  A combina√ß√£o desses padr√µes nos permite descrever de maneira simples algoritmos complexos √† primeira vista, por exemplo: </p><br><pre> <code class="plaintext hljs">private loadUnreadJokes() { this.showLoader(); //   fromEvent(document, 'load') .pipe( switchMap( () =&gt; this.http .get('/api/v1/jokes') //   .pipe(map((jokes: any[]) =&gt; jokes.filter(joke =&gt; joke.unread))), //   ), ) .subscribe( (jokes: any[]) =&gt; (this.jokes = jokes), //   error =&gt; { /*   */ }, () =&gt; this.hideLoader(), //       ); }</code> </pre> <br><p>  Apenas 18 linhas com todo o belo recuo.  Agora tente reescrever este exemplo no Vanilla ou pelo menos no jQuery.  Quase 100% disso ocupar√° pelo menos o dobro de espa√ßo e n√£o ser√° t√£o expressivo.  Aqui voc√™ pode simplesmente seguir a linha com os olhos e ler o c√≥digo como um livro. </p><br><h3 id="observable">  Observ√°vel </h3><br><p>  O entendimento de que qualquer dado pode ser representado como um fluxo n√£o vem imediatamente.  Portanto, proponho passar para uma analogia simples.  Imagine um fluxo √© uma matriz de dados classificados por tempo.  Por exemplo, nesta modalidade: </p><br><pre> <code class="plaintext hljs">const observable = []; let counter = 0; const intervalId = setInterval(() =&gt; { observable.push(counter++); }, 1000); setTimeout(() =&gt; { clearInterval(intervalId); }, 6000);</code> </pre> <br><p>  Vamos considerar o √∫ltimo valor na matriz como relevante.  A cada segundo, um n√∫mero ser√° adicionado √† matriz.  Como podemos descobrir em outro lugar no aplicativo que um elemento foi adicionado √† matriz?  Em uma situa√ß√£o normal, chamar√≠amos algum tipo de <code>callback</code> de <code>callback</code> e atualizar√≠amos o valor da matriz e, ent√£o, pegar√≠amos o √∫ltimo elemento. </p><br><p>  Gra√ßas √† programa√ß√£o reativa, n√£o √© necess√°rio escrever apenas muita l√≥gica nova, mas tamb√©m pensar em atualizar as informa√ß√µes.  Isso pode ser comparado a um ouvinte simples: </p><br><pre> <code class="plaintext hljs">document.addEventListener('click', event =&gt; {});</code> </pre> <br><p>  Voc√™ pode colocar muitos <code>EventListener</code> em todo o aplicativo, e eles funcionar√£o, a menos que, √© claro, voc√™ cuide do oposto de prop√≥sito. </p><br><p>  A programa√ß√£o reativa tamb√©m funciona.  Em um lugar, simplesmente criamos um fluxo de dados e periodicamente lan√ßamos novos valores l√°; em outro, assinamos esse fluxo e simplesmente ouvimos esses valores.  Ou seja, sempre aprendemos sobre a atualiza√ß√£o e podemos lidar com isso. </p><br><p>  Agora vamos ver um exemplo real: </p><br><pre> <code class="plaintext hljs">export class JokesListComponent implements OnInit { jokes$: Observable&lt;IJoke&gt;; authors$ = new Subject&lt;string[]&gt;(); unread$ = new Subject&lt;number&gt;(); constructor(private jokerService: JokerService) {} ngOnInit() { //  ,    subscribe()    this.jokes$ = this.jokerService.getJokes(); this.jokes$.subscribe(jokes =&gt; { this.authors$.next(jokes.map(joke =&gt; joke.author)); this.unread$.next(jokes.filter(joke =&gt; joke.unread).length); }); } }</code> </pre> <br><p>  Gra√ßas a essa l√≥gica, ao alterar dados em <code>jokes</code> , atualizamos automaticamente os dados sobre o n√∫mero de piadas n√£o lidas e a lista de autores.  Se voc√™ tiver mais alguns componentes, um dos quais coleta estat√≠sticas sobre o n√∫mero de piadas lidas por um autor e o segundo calcula a dura√ß√£o m√©dia das piadas, as vantagens se tornam √≥bvias. </p><br><h2 id="testbed">  Testbed </h2><br><p>  Mais cedo ou mais tarde, o desenvolvedor entende que, se o projeto n√£o for MVP, ser√° necess√°rio escrever testes.  E quanto mais testes forem escritos, mais clara e detalhada ser√° a descri√ß√£o, mais f√°cil, mais r√°pido e mais confi√°vel ser√° fazer altera√ß√µes e implementar novas funcionalidades. </p><br><p>  Angular provavelmente previu isso e nos deu uma poderosa ferramenta de teste.  Muitos desenvolvedores, no in√≠cio, tentam dominar algum tipo de tecnologia "desde o in√≠cio", sem entrar na documenta√ß√£o.  Fiz o mesmo, e foi por isso que percebi bastante tarde todos os recursos de teste dispon√≠veis "prontos para uso". </p><br><p>  Voc√™ pode testar qualquer coisa no Angular, mas se precisar instanciar e come√ßar a chamar m√©todos para testar uma classe ou servi√ßo regular, a situa√ß√£o com o componente √© completamente diferente. </p><br><p>  Como j√° descobrimos, gra√ßas √†s depend√™ncias de DI s√£o retiradas do componente.  Por um lado, isso complica um pouco todo o sistema, por outro, oferece grandes oportunidades para configurar testes e verificar muitos casos.  Proponho entender o exemplo de um componente: </p><br><pre> <code class="plaintext hljs">@Component({ selector: 'app-joker', template: '&lt;some-dependency&gt;&lt;/some-dependency&gt;', styleUrls: ['./joker.component.less'], }) export class JokerComponent { constructor( private jokesService: JokesService, @Inject(PARTY_TOKEN) private partyService: PartyService, @Optional() private sleepService: SleepService, ) {} makeNewFriend(): IFriend { if (this.sleepService &amp;&amp; this.sleepService.isSleeping) { this.sleepService.wakeUp(); } const joke = this.jokesService.generateNewJoke(); this.partyService.goToParty('Pacha'); this.partyService.toSay(joke.text); const laughingPeople = this.partyService.getPeopleByReaction('laughing'); const girl = laughingPeople.find(human =&gt; human.sex === 'female'); const friend = this.partyService.makeFriend(girl); return friend; } }</code> </pre> <br><p>  Portanto, no exemplo atual, existem tr√™s servi√ßos.  Um √© importado da maneira usual, um por token e outro servi√ßo √© opcional.  Como configuramos o m√≥dulo de teste?  Mostrarei imediatamente a exibi√ß√£o conclu√≠da: </p><br><pre> <code class="plaintext hljs">beforeEach(async(() =&gt; { TestBed.configureTestingModule({ imports: [SomeDependencyModule], declarations: [JokerComponent], //  ,    providers: [{provide: PARTY_TOKEN, useClass: PartyService}], }).compileComponents(); fixture = TestBed.createComponent(JokerComponent); component = fixture.componentInstance; fixture.detectChanges(); //    ,     }));</code> </pre> <br><p>  <code>TestBed</code> nos permite fazer uma simula√ß√£o completa do m√≥dulo necess√°rio.  Voc√™ pode conectar a ele quaisquer servi√ßos, substituir m√≥dulos, obter inst√¢ncias de classes de um componente e muito mais.  Agora que j√° temos o m√≥dulo configurado, vamos para as possibilidades. </p><br><h3 id="mozhno-izbegat-lishnih-zavisimostey">  Depend√™ncias desnecess√°rias podem ser evitadas </h3><br><p>  Um aplicativo Angular consiste em m√≥dulos, que podem incluir outros m√≥dulos, servi√ßos, diretrizes e muito mais.  No teste, precisamos, de fato, recriar a opera√ß√£o do m√≥dulo.  Se, em nosso exemplo, usarmos <code>&lt;some-dependency&gt;&lt;/some-dependency&gt;</code> no modelo, isso significa que devemos importar o <code>SomeDependencyModule</code> para o teste tamb√©m.  E se houver v√≠cios l√°?  Portanto, eles tamb√©m precisam ser importados. <br>  Se o aplicativo for complexo, haver√° muitas dessas depend√™ncias.  A importa√ß√£o de todas as depend√™ncias levar√° ao fato de que em cada teste o aplicativo inteiro estar√° localizado e todos os m√©todos ser√£o chamados.  Talvez isso n√£o nos convenha. </p><br><p>  H√° pelo menos uma maneira de se livrar das depend√™ncias necess√°rias - basta reescrever o modelo.  Suponha que voc√™ tenha testes de captura de tela ou testes de integra√ß√£o e n√£o h√° necessidade de testar a apar√™ncia do componente.  Ent√£o basta verificar os m√©todos.  Nesse caso, voc√™ pode escrever a configura√ß√£o da seguinte maneira: </p><br><pre> <code class="plaintext hljs">TestBed.configureTestingModule({ declarations: [JokerComponent], providers: [{provide: PARTY_TOKEN, useClass: PartyService}], }) .overrideTemplate(JokerComponent, '') //   ,   .compileComponents();</code> </pre> <br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim, isso n√£o √© para todos. </font><font style="vertical-align: inherit;">Dentro do Tinkoff, concordamos em usar essa abordagem apenas nos casos em que n√£o h√° necessidade de verificar a exibi√ß√£o do componente. </font><font style="vertical-align: inherit;">Por exemplo, ao trabalhar apenas com dados ou se comunicar com a parte. </font><font style="vertical-align: inherit;">Se houver necessidade de verificar como os dados s√£o transferidos para componentes filho ou, por exemplo, como a entrada do usu√°rio √© processada, essa op√ß√£o n√£o funcionar√°. </font><font style="vertical-align: inherit;">Se voc√™ tiver esse caso, v√° para o pr√≥ximo par√°grafo.</font></font></p><br><h3 id="mozhno-mokirovat-vse-zavisimosti-iz-konstruktora"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voc√™ pode molhar todas as depend√™ncias do construtor </font></font></h3><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J√° nos familiarizamos com o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Token de inje√ß√£o</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , por isso proponho a come√ßar imediatamente os neg√≥cios. </font><font style="vertical-align: inherit;">No exemplo acima, eu j√° verifiquei o servi√ßo de token no teste. </font><font style="vertical-align: inherit;">Se voc√™ n√£o est√° escrevendo um teste de integra√ß√£o, n√£o faz sentido chamar m√©todos de um servi√ßo real, apenas fa√ßa uma simula√ß√£o.</font></font></p><br><p>        <code>ts-mockito</code> ,     ,    . Angular    ¬´ ¬ª. </p><br><pre> <code class="plaintext hljs">//    export class MockPartyService extends PartyService { meetFriend(): IFriend { return {} as IFriend; } goToParty() {} toSay(some: string) { console.log(some); } } // ... TestBed.configureTestingModule({ declarations: [JokerComponent, MockComponent], providers: [{provide: PARTY_TOKEN, useClass: MockPartyService}], //    }).compileComponents();</code> </pre> <br><p>  Isso √© tudo.         . </p><br><h3 id="mnozhestvo-keysov">   </h3><br><p>       .    ,  ‚Äî  ,   ‚Äî . ,              : </p><br><ul><li>          . </li><li>      ‚Äî ,      .    ‚Äî    . </li></ul><br><p>  ‚Äî       .          ,          .   ‚Äî     . </p><br><h2 id="itog">  Sum√°rio </h2><br><p>       Angular,           .     ,   ,        ¬´¬ª. </p><br><p>      , Angular       - .    HTTP-, , lazy-loading  .            <a href="https://angular.io/docs"> Angular</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt480782/">https://habr.com/ru/post/pt480782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt480772/index.html">Raz√µes simples para a inevitabilidade da d√≠vida t√©cnica</a></li>
<li><a href="../pt480774/index.html">N√£o nginx unificado: hospedagem Ayhor - dash-scratch live</a></li>
<li><a href="../pt480776/index.html">Implantamos o Active Directory por todos os m√©todos poss√≠veis.</a></li>
<li><a href="../pt480778/index.html">Gerenciamento de gestos: manipula√ß√£o de sobreposi√ß√µes visuais. Parte 2</a></li>
<li><a href="../pt480780/index.html">Como montar uma ilustra√ß√£o a partir de cubos e pictogramas</a></li>
<li><a href="../pt480786/index.html">Clonagem profunda independente de objetos em JavaScript</a></li>
<li><a href="../pt480788/index.html">√Årvore de Natal na linha de comando</a></li>
<li><a href="../pt480790/index.html">"Efici√™ncia de f√°brica". Localizando um gargalo e implementando um sistema pull para aumentar a produtividade</a></li>
<li><a href="../pt480792/index.html">Engenharia de Presentes</a></li>
<li><a href="../pt480794/index.html">Um pouco sobre o caso especial da implementa√ß√£o de algoritmos de pesquisa de portas abertas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>