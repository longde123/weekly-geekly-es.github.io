<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦔 ☝🏼 👨🏻‍🍳 Menggunakan mata Ikan pada Raspberry Pi 3 dengan ROS - Bagian 1 🤨 🗓️ 🥤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selamat siang, para pembaca Habr. Beberapa tahun yang lalu saya menulis tentang menggunakan Papan Kamera Raspberry Pi pada Raspberry Pi bersama dengan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menggunakan mata Ikan pada Raspberry Pi 3 dengan ROS - Bagian 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417251/"> Selamat siang, para pembaca Habr.  Beberapa tahun yang lalu saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menulis</a> tentang menggunakan Papan Kamera Raspberry Pi pada Raspberry Pi bersama dengan ROS.  Dalam artikel ini dan selanjutnya, saya ingin berbicara tentang menggunakan kamera sudut lebar seperti fish eye pada Raspberry Pi 3 dengan Ubuntu 16.04 diinstal.  Kepada siapa itu menarik saya bertanya di bawah kat. <br><a name="habracut"></a><br>  Sebagai permulaan, mengapa kamera mata ikan?  Saya telah melihat banyak artikel tentang penggunaan kamera sudut lebar untuk odometri visual dan SLAM.  Berkat sudut pandang mata ikan yang lebih besar, kamera ini meningkatkan akurasi odometri visual.  Jadi saya ingin mencoba satu kamera dengan Raspberry Pi dengan dukungan ROS.  Saya membeli kamera dengan sudut 160 derajat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dx.com dengan</a> harga $ 28.  Kit kamera juga mencakup dua lampu IR untuk penglihatan malam: <br><br><img src="https://habrastorage.org/webt/gl/wv/z4/glwvz4wepa70om2eyr5vviaerso.jpeg" alt="gambar"><br><br>  Pada artikel pertama saya akan berbicara tentang menginstal driver yang diperlukan, OpenCV 3 dan paket untuk mendukung Dewan Kamera Raspberry Pi di ROS. <br><br><h2>  Menginstal driver kamera mata ikan pada Raspberry Pi 3 </h2><br>  Jadi mari kita mulai.  Terhubung ke RPi 3 melalui SSH: <br><br><pre><code class="bash hljs">ssh -Y &lt;user&gt;@&lt;ip&gt;</code> </pre> <br>  Parameter -Y memecahkan masalah mendapatkan kesalahan "Tidak dapat terhubung untuk menampilkan" ketika memulai beberapa aplikasi GUI (Qt, jendela dengan gambar dari program OpenCV).  Pelajari lebih lanjut di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Pertama, kita perlu mengaktifkan dukungan driver kamera di pengaturan Raspberry Pi raspi-config.  Di Raspbian, layanan ini sudah diaktifkan, di Ubuntu Anda harus menginstalnya: <br><br><pre> <code class="bash hljs">sudo apt-get install raspi-config</code> </pre><br>  Jalankan raspi-config: <br><br><pre> <code class="bash hljs">sudo raspi-config</code> </pre><br>  Pilih opsi Antarmuka, lalu Kamera Pi dan klik Ya.  Dan akhirnya Selesai. <br>  Periksa apakah dukungan kamera diaktifkan menggunakan utilitas raspistill: <br><br><pre> <code class="bash hljs">raspistill -o mypicture.jpg</code> </pre><br>  Jika Anda mendapatkan kesalahan "Kamera tidak terdeteksi.  Silakan periksa dengan seksama modul kamera dipasang dengan benar ”periksa apakah Anda menghubungkan kamera ke Raspberry Pi dengan benar.  Anda juga dapat reboot sistem (itu membantu saya). <br><br>  Mari kita coba merekam video: <br><br><pre> <code class="bash hljs">raspivid -o myvideo.h264</code> </pre><br>  Saya mendapat gambar di monitor yang terhubung ke Raspberry Pi.  Saya tidak bisa mendapatkan popup di komputer saya ketika terhubung melalui ssh. <br><br><img src="https://habrastorage.org/webt/in/tj/8q/intj8q2llng2w0ves6izieqtrtc.jpeg" alt="gambar"><br><br><h2>  Menggunakan OpenCV 3 dengan kamera mata ikan pada Raspberry Pi </h2><br>  Instal pustaka picamera [array]: <br><br><pre> <code class="bash hljs">pip install <span class="hljs-string"><span class="hljs-string">"picamera[array]"</span></span></code> </pre><br>  Instal dependensi yang diperlukan untuk OpenCV.  Pertama, perbarui manajer paket yang tepat dan perbarui paket yang sudah diinstal: <br><br><pre> <code class="bash hljs">sudo apt-get update sudo apt-get upgrade</code> </pre><br>  Instal beberapa perpustakaan: <br><br><pre> <code class="bash hljs">sudo apt-get install build-essential cmake pkg-config sudo apt-get install libjpeg8-dev libtiff5-dev libjasper-dev libpng12-dev sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev sudo apt-get install libxvidcore-dev libx264-dev sudo apt-get install libgtk-3-dev sudo apt-get install libatlas-base-dev gfortran sudo apt-get install python2.7-dev python3.5-dev</code> </pre><br>  Kami akan menginstal OpenCV 3 dari sumber. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ wget -O opencv.zip https://github.com/Itseez/opencv/archive/3.1.0.zip unzip opencv.zip</code> </pre><br>  Kita juga perlu mengunduh repositori opencv_contrib: <br><br><pre> <code class="bash hljs">wget -O opencv_contrib.zip https://github.com/Itseez/opencv_contrib/archive/3.1.0.zip unzip opencv_contrib.zip</code> </pre><br>  Faktanya adalah bahwa dalam paket-paket OpenCV 3 dengan deskriptor fitur (seperti SIFT dan SURF) dipindahkan ke repositori contrib yang terpisah.  Sekarang, untuk menggunakan deskriptor tag, kita perlu mengunduh repositori contrib secara terpisah. <br><br>  Sekarang kita akhirnya siap untuk menginstal OpenCV.  Kita dapat menjalankan cmake untuk mengkompilasi OpenCV dengan parameter yang diperlukan: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/opencv-3.1.0/ mkdir build <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> build cmake -D CMAKE_BUILD_TYPE=RELEASE \ -D CMAKE_INSTALL_PREFIX=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> \ -D INSTALL_PYTHON_EXAMPLES=ON \ -D INSTALL_C_EXAMPLES=OFF \ -D OPENCV_EXTRA_MODULES_PATH=~/opencv_contrib-3.1.0/modules \ -D PYTHON_EXECUTABLE=~/.virtualenvs/cv/bin/python \ -D BUILD_EXAMPLES=ON ..</code> </pre><br>  Jika cmake berhasil tanpa kesalahan, jalankan make: <br><br><pre> <code class="bash hljs">make -j4</code> </pre><br>  Saat mengkompilasi, saya mendapat kesalahan "Segmentasi kesalahan".  Jika Anda mendapatkan kesalahan yang sama, lakukan clean untuk menghapus hasil kompilasi dan lakukan dengan satu kernel: <br><br><pre> <code class="bash hljs">make clean make</code> </pre><br>  Butuh waktu 3 jam untuk mengkompilasi.  Akhirnya, instal OpenCV 3: <br><br><pre> <code class="bash hljs">sudo make install sudo ldconfig</code> </pre><br>  Ada nuansa menarik terkait dengan ROS Kinetic.  Jika Anda menginstal Rin Kinetic, maka ROS menambahkan path ke pustaka Python (/opt/ros/kinetic/lib/python2.7/dist-packages) ke jalur sistem ketika menjalankan sumber perintah /opt/ros/kinetic/setup.bash.  Hal ini menyebabkan beberapa masalah selama instalasi OpenCV berikutnya dari sumber (lebih lanjut tentang ini ditulis di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> ).  Untuk mengatasi masalah tersebut, hapus baris 'source /opt/ros/kinetic/setup.bash' dari file .bashrc.  Jangan lupa untuk menjalankan: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">source</span></span> ~/.bashrc</code> </pre><br>  Mari kita verifikasi bahwa OpenCV sekarang dengan benar menghubungkan dari Python. <br>  Buat folder untuk proyek dan skrip pengujian sederhana: <br><br><pre> <code class="bash hljs">mkdir PiCamera &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> PiCamera vim test_cam.py</code> </pre><br>  Tambahkan kode berikut ke file: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> picamera.array <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PiRGBArray <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> picamera <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PiCamera <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-comment"><span class="hljs-comment"># initialize the camera and reference the raw camera capture camera = PiCamera() rawCapture = PiRGBArray(camera) # allow camera to warmup time.sleep(0.1) # grab an image camera.capture(rawCapture, format="bgr") image = rawCapture.array cv2.imshow("Capture", image) cv2.waitKey(0)</span></span></code> </pre><br>  Jalankan skrip: <br><br><pre> <code class="bash hljs">python test_cam.py</code> </pre><br>  Jika berhasil, kami mendapatkan sesuatu seperti ini: <br><br><img src="https://habrastorage.org/webt/hl/kl/dg/hlkldgvxsd8jvyufl_joq6dkqpa.png" alt="gambar"><br><br>  Sekarang mari kita coba merekam video dari kamera. <br><br><pre> <code class="bash hljs">vim test_videom.py</code> </pre><br>  Tambahkan kode berikut ke file: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># import the necessary packages from picamera.array import PiRGBArray from picamera import PiCamera import time import cv2 # initialize the camera and grab a reference to the raw camera capture camera = PiCamera() camera.resolution = (640, 480) camera.framerate = 32 rawCapture = PiRGBArray(camera, size=(640, 480)) # allow the camera to warmup time.sleep(0.1) # capture frames from the camera for frame in camera.capture_continuous(rawCapture, format="bgr", use_video_port=True): # grab the raw NumPy array representing the image, then initialize the timestamp # and occupied/unoccupied text image = frame.array # show the frame cv2.imshow("Frame", image) key = cv2.waitKey(1) &amp; 0xFF # clear the stream in preparation for the next frame rawCapture.truncate(0) # if the `q` key was pressed, break from the loop if key == ord("q"): break</span></span></code> </pre><br>  Mari kita coba sesuatu yang lebih menarik, misalnya, tambahkan deteksi tepi.  Saya menggunakan detektor Kenny di sini (kode diambil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari sini</a> ): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> picamera.array <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PiRGBArray <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> picamera <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PiCamera <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-comment"><span class="hljs-comment"># initialize the camera and grab a reference to the raw camera capture camera = PiCamera() camera.resolution = (640, 480) camera.framerate = 32 rawCapture = PiRGBArray(camera, size=(640, 480)) # allow the camera to warmup time.sleep(0.1) # capture frames from the camera for frame in camera.capture_continuous(rawCapture, format="bgr", use_video_port=True): # grab the raw NumPy array representing the image, then initialize the timestamp # and occupied/unoccupied text image = frame.array hsv = cv2.cvtColor(image, cv2.COLOR_BGR2HSV) lower_red = np.array([30,150,50]) upper_red = np.array([255,255,180]) mask = cv2.inRange(hsv, lower_red, upper_red) res = cv2.bitwise_and(image,image, mask= mask) edges = cv2.Canny(res,100,200) # show the frame cv2.imshow("Frame", image) cv2.imshow("Edges", edges) key = cv2.waitKey(1) &amp; 0xFF # clear the stream in preparation for the next frame rawCapture.truncate(0) # if the `q` key was pressed, break from the loop if key == ord("q"): break</span></span></code> </pre><br>  Ini adalah hasil dari menjalankan program: <br><br><img src="https://habrastorage.org/webt/kr/tc/ld/krtcldbsjfjrrlg8oz9b0lhlf0i.png" alt="gambar"><br><br><h2>  Menambahkan dukungan Raspberry Pi Camera ke ROS </h2><br>  Sekarang mari kita tambahkan kemampuan untuk bekerja dengan kamera mata ikan untuk Raspberry Pi dari ROS.  Pertama, instal driver V4L2 yang diperlukan untuk kamera Raspberry Pi (Anda dapat membaca lebih lanjut di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> ).  Jalankan perintah: <br><br><pre> <code class="bash hljs">sudo rpi-update</code> </pre><br>  dan reboot sistem.  Sekarang tambahkan driver: <br><br><pre> <code class="bash hljs">sudo modprobe bcm2835-v4l2</code> </pre><br>  Pastikan perangkat / dev / video0 tersedia: <br><br><pre> <code class="bash hljs">ll /dev/video0</code> </pre><br>  Outputnya akan seperti ini: <br><br><pre> <code class="bash hljs">crw-rw----+ 1 root video 81, 0 Mar 17 15:47 /dev/video0</code> </pre><br>  Unduh paket usb_cam: <br><br><pre> <code class="bash hljs">sudo apt-get install ros-kinetic-usb-cam <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> /opt/ros/kinetic/setup.bash</code> </pre><br>  Jalankan master ROS dan rqt_image_view: <br><br><pre> <code class="bash hljs">roscore roslaunch usb_cam usb_cam-test.launch rosrun rqt_image_view rqt_image_view</code> </pre><br>  Pilih topik / usb_cam / image_raw.  Kami mendapatkan gambar berikut: <br><br><img src="https://habrastorage.org/webt/j1/yo/ab/j1yoabxr0g8o5xxy5zeswfrr1oi.png" alt="gambar"><br><br>  Sekarang kamera mata ikan dapat digunakan dengan paket visi komputer di ROS.  Lain kali kita akan mencoba deteksi objek.  Semoga sukses untuk semua orang dalam percobaan dan sampai jumpa lagi! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id417251/">https://habr.com/ru/post/id417251/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id417241/index.html">S3 metadata di PostgreSQL. Kuliah Yandex</a></li>
<li><a href="../id417243/index.html">Instal 3CX SBC Session Edge Controller di Windows, Raspberry Pi, atau Debian 9</a></li>
<li><a href="../id417245/index.html">Erlang untuk IoT</a></li>
<li><a href="../id417247/index.html">VSCE # 1: Podcast Pengusaha Media</a></li>
<li><a href="../id417249/index.html">Kamar Audit AS memperingatkan: SpaceX dan Boeing sedang menunggu penundaan baru, gangguan AS dalam penerbangan ke ISS dimungkinkan</a></li>
<li><a href="../id417255/index.html">Jam Cuckoo Berdasarkan Lego Mindstorms</a></li>
<li><a href="../id417257/index.html">C menunjuk sebagai paradoks linguistik</a></li>
<li><a href="../id417259/index.html">Acara digital di Moskow dari 16 Juli hingga 22 Juli</a></li>
<li><a href="../id417263/index.html">JavaScript sebagai perwujudan kejahatan</a></li>
<li><a href="../id417265/index.html">10 besar: laporan terbaik dari DotNext 2017 Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>