<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé∞ üç¶ üöú Geheimnisse der API von Android-Ger√§ten. Yandex-Bericht üòæ üòØ üì¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine der gr√∂√üten Herausforderungen bei der Android-Entwicklung ist die Fragmentierung. Fast jeder Hersteller √§ndert Android an seine Bed√ºrfnisse. Entw...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Geheimnisse der API von Android-Ger√§ten. Yandex-Bericht</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/448126/">  Eine der gr√∂√üten Herausforderungen bei der Android-Entwicklung ist die Fragmentierung.  Fast jeder Hersteller √§ndert Android an seine Bed√ºrfnisse.  Entwickler Andrey Makeev listete die Unterschiede zwischen Herstellerimplementierungen und dem urspr√ºnglichen Android Open Source-Projekt auf.  Aus dem Bericht erfahren Sie, wie Sie von den einzelnen Funktionen der Firmware auf verschiedenen Ger√§ten profitieren k√∂nnen. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/N0KQBUZE78E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - Ich programmiere seit der Schule und entwickle es seit drei Jahren f√ºr Android.  Davon verbrachte ich ein Jahr in Yandex und nahm an Projekten wie Launcher und Phone teil. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/x-/ol/c_/x-olc_qfelylf6-mm3a6vdoxt-y.jpeg"><br><br>  Ich m√∂chte dar√ºber sprechen, wie die Fragmentierung der API von Android-Ger√§ten aussieht - von au√üen, von Seiten der Anwendungsentwickler und von innen, aus Sicht der Entwickler der Plattform und der Telefone. <br><br>  Mein Bericht besteht aus zwei Teilen.  Lassen Sie uns zun√§chst dar√ºber sprechen, wie die API extern fragmentiert ist.  Dann werden wir den Code durchgehen - wir werden herausfinden, wie das einzigartige Merkmal des abstrakten Telefons realisiert wird, wie die Entwicklung aufgebaut ist. <br><br>  Die API-Fragmentierung ist einer der Parameter, mit denen Sie ein Ger√§t fragmentieren k√∂nnen.  Das offensichtlichste und einfachste ist die Fragmentierung gem√§√ü dem Android SDK. Wir begegnen ihr jeden Tag, buchst√§blich von den ersten Tagen der Entwicklung f√ºr Android an.  Wir wissen, welche und in welcher Version der API es erschien, dass es entfernt wurde, dass es gesichert wurde, aber es ist noch verf√ºgbar und welche bereits verschwunden ist.  In der Regel verwenden wir verschiedene Support-Bibliotheken von Google, um unser Leben zu vereinfachen.  Es wurde bereits viel f√ºr uns getan. <br><br><img src="https://habrastorage.org/webt/qf/tq/vh/qftqvhka64nqp6qssqqqa2er6te.jpeg"><br><br><img src="https://habrastorage.org/webt/d0/ig/sx/d0igsx1hnplro-2u-tx9_iln0qo.jpeg"><br><br>  In unserem Code sieht es ungef√§hr so ‚Äã‚Äãaus: Wir aktivieren einige Funktionen, einige deaktivieren - je nachdem, in welcher Version des SDK wir uns gerade befinden.  Wenn Sie welche verwenden, tun sie normalerweise dasselbe, aber im Inneren. <br><br>  Wir werden uns nicht auf diese Art der Fragmentierung konzentrieren.  Die Nachteile sind allen bekannt - wir sind gezwungen, eine ganze Flotte von Ger√§ten mit unterschiedlichen Versionen zu behalten, um zumindest unsere Anwendung zu testen.  Au√üerdem m√ºssen wir zus√§tzlichen Code schreiben.  Dies ist besonders unpraktisch, als Sie gerade mit der Entwicklung f√ºr Android begonnen haben, und es stellt sich pl√∂tzlich heraus: Sie m√ºssen lernen, was vor zwei oder drei Jahren dort war, um einige alte Ger√§te zu unterst√ºtzen.  Positive Aspekte: API entwickelt sich, Technologie entwickelt sich weiter, Android gewinnt neue Benutzer, es wird sowohl f√ºr Entwickler als auch f√ºr Benutzer bequemer. <br><br>  Wie arbeiten wir damit?  Wir verwenden auch Bibliotheken und freuen uns sehr, wenn wir √§ltere Versionen nicht unterst√ºtzen.  Ich denke, im Leben aller, die dies seit mehr als einem Jahr tun, gab es einen solchen Moment.  Das ist nur Gl√ºck.  Dies ist eine offensichtliche und einfache Fragmentierungsoption.  Als n√§chstes folgt die Fragmentierung vom Typ Android.  Es gibt mehrere von ihnen.  Android TV spricht f√ºr sich selbst, Android Auto ist haupts√§chlich f√ºr Autoradios, Android Things - f√ºr IoT und √§hnliche eingebettete Ger√§te gedacht.  W is Wear OS, die fr√ºhere Android Watch, achten Sie auf Android.  Wir werden versuchen zu √ºberlegen, wie dies von Seiten des Entwicklers aussieht.  Und am interessantesten ist, dass wir versuchen zu √ºberlegen, wie es von innen aussieht. <br><br><img src="https://habrastorage.org/webt/vk/e-/51/vke-51qsyadiojfl-jdhcystsqk.jpeg"><br><br>  Nehmen Sie zwei Beispiele von developer.android.com.  Das erste ist Wear OS.  Was brauchen wir, um einen Antrag zu stellen?  Wir f√ºgen eine compileOnly-Abh√§ngigkeit zu build.gradle hinzu und schreiben zwei zus√§tzliche Zeilen in das Manifest: Verwendungsfunktion android.hardware.type.watch und Verwendungsbibliothek, die demselben Paketnamen entspricht wie die Bibliothek, die wir verbunden haben. <br><br><img src="https://habrastorage.org/webt/ny/az/lb/nyazlbzf4abkspkjvz2nrdy0ek8.jpeg"><br><br>  Wie setzen wir etwas um?  Wir erstellen eine Aktivit√§t, nur in diesem Fall geben wir keine Standardaktivit√§t aus, mit der wir gewohnt sind, und nicht einmal eine zusammengesetzte, sondern WearableActivity, und rufen daf√ºr spezifische Methoden auf, in diesem Fall setAmbientEnabled ().  Wir haben also eine compileOnly-Abh√§ngigkeit, das hei√üt, sie gelangt nicht in den Verlauf unserer Anwendung.  Uses-Bibliothek, die das Betriebssystem anscheinend dazu zwingt, diese Klassen und diesen Code zur Laufzeit auf dem Ger√§t und den neuen Klassen, die wir verwenden, mit uns zu verbinden. <br><br><img src="https://habrastorage.org/webt/o4/2d/gn/o42dgn9euh986enbms6qkzbf6za.jpeg"><br><br>  Android Things API ist praktisch nicht anders.  Wir schreiben keine Verwendungsfunktion vor, sondern nur Verwendungsbibliothek, compileOnly-Abh√§ngigkeit. <br><br><img src="https://habrastorage.org/webt/b4/_l/ad/b4_ladqetwuszdbbmov1fgrlaxy.jpeg"><br><br>  Wir erstellen Aktivit√§ten. In diesem Fall gilt dies nur f√ºr die Android Things-API, die PeripheralManager-Klasse.  Wir befragen den GPIO und versuchen zu versprechen. <br><br><img src="https://habrastorage.org/webt/ea/i8/yc/eai8yckgovuw0wa7mbz_oc7nxy4.jpeg"><br><br>  Wie verh√§lt sich eine solche App auf Ihrem Handy?  Es gibt zwei M√∂glichkeiten. <br><br><img src="https://habrastorage.org/webt/yr/tz/ei/yrtzeip9jrmya-notrdp4ftvque.jpeg"><br><br>  Wenn wir angegeben haben, dass die Verwendungsbibliothek android: required = "true" ist, haben wir die obligatorischen Anforderungen des PackageManager f√ºr die Installation der Anwendung nicht erf√ºllt und sie wird grunds√§tzlich nicht installiert.  Wenn wir android: required = ‚Äùfalse‚Äù angegeben haben, wird die Anwendung installiert. Wenn wir jedoch versuchen, auf die PeripheralManager-Klasse zuzugreifen, erhalten wir NoClassDefFoundError, da es in Standard-Android keine solche Klasse gibt. <br><br>  Was sind die Schlussfolgerungen?  Wir verbinden die compileOnly-Abh√§ngigkeit nur, um w√§hrend der Assembly mit ihr in Kontakt zu treten, und die von uns verwendeten Klassen warten auf dem Ger√§t auf uns. Sie werden √ºber bestimmte Zeilen im Manifest verbunden.  Manchmal schreiben wir eine Funktion vor, die h√§ufiger ben√∂tigt wird, um bei Google Play ein Ger√§t zu unterscheiden, auf das diese Anwendung verteilt werden kann oder nicht. <br><br>  Ich konnte die negativen Seiten dieser Art der Fragmentierung nicht herausgreifen.  Nur diejenigen, die sich entwickelt haben, werden viele Geschichten dar√ºber erz√§hlen, wie sie auf v√∂llig unverst√§ndliche, unbekannte Fehler gesto√üen sind, denen sie am Telefon nicht begegnet sind.  Die positive Seite ist, dass dies zus√§tzliche M√§rkte, zus√§tzliche Benutzer, zus√§tzliche Erfahrung sind, es ist immer gut. <br><br>  Wie arbeite ich damit?  Schreiben Sie weitere Bewerbungen.  Die allgemeine Empfehlung lautet, mehr als eine Version der Anwendung f√ºr alle Arten von Android zu schreiben, aber immer noch andere.  Es sollte weniger f√ºr eine Uhr geben, f√ºr Android-Dinge ist praktisch nichts von dem, was auf dem Telefon geschrieben ist, geeignet und so weiter.  Und nutzen Sie die Bibliotheken, die uns Android-Entwickler und manchmal auch Ger√§teentwickler zur Verf√ºgung stellen. <br><br>  Die am wenigsten untersuchte Art der Fragmentierung ist die Produzentenfragmentierung.  Jeder Hersteller, der den Quellcode erhalten hat - in seltenen F√§llen handelt es sich um AOSP, h√§ufiger wird er von den Hardwareentwicklern irgendwie ge√§ndert -, nimmt √Ñnderungen daran vor.  In der Regel erfahren wir √ºber die negativen Auswirkungen dieser Art der Fragmentierung von nicht den besten Kan√§len - von negativen Bewertungen bei Google Play, weil jemand etwas kaputt gemacht hat.  Oder wir lernen dies aus der Crash-Analyse, wenn pl√∂tzlich etwas auf unverst√§ndliche Weise abst√ºrzt, nur auf bestimmten Ger√§ten.  Im besten Fall lernen wir dies aus unserer Qualit√§tssicherung, wenn beim Testen auf einem bestimmten Ger√§t etwas kaputt gegangen ist. <br><br><img src="https://habrastorage.org/webt/hz/ag/7w/hzag7wj3ekniejprurricmjwvtq.jpeg"><br><br>  Zu diesem Thema habe ich eine wundervolle Geschichte aus unserem Entwicklungs-Launcher.  Wir haben einen Fehlerbericht erhalten, in dem sich die Aktivit√§t nicht auf den gesamten Bildschirm erstreckte und unser bevorzugtes Standard-Hintergrundbild √ºberhaupt nicht angezeigt wurde.  Es wurde nicht entschl√ºsselt, ein leeres Fenster zeigte sich.  Wir hatten nicht einmal Ger√§te, um es zu reproduzieren.  Durch das Strecken auf den Bildschirm konnten wir immer noch ein Low-End-Ger√§t finden, auf dem es nicht funktionierte, und alles mit Android ganz einfach reparieren: resizeableActivity = "true" im Manifest.  Mit der Tapete wurde alles viel komplizierter.  Ungef√§hr zwei Tage lang haben wir versucht, detailliertere Informationen zu erhalten.  Am Ende fanden sie heraus, dass auf einer Reihe von Ger√§ten entweder der Codec zum Decodieren von progressivem JPEG mit Fehlern implementiert wurde, wenn mehrere Komprimierungsalgorithmen f√ºr die Ergebnisse des jeweils anderen verwendet wurden.  In diesem Fall haben wir gerade einen Flusen-Check geschrieben, der beim Erstellen der Anwendung fehlschl√§gt, wenn wir das in der apk selbst progressiv codierte Hintergrundbild in die apk selbst einf√ºgen.  Alle Hintergrundbilder neu codiert, die Situation im Backend wiederholt, das den Rest der Hintergrundbilder verteilt, und alles funktioniert hervorragend.  Aber es hat uns ungef√§hr zwei Tage gekostet. <br><br><img src="https://habrastorage.org/webt/qk/bv/cl/qkbvclmcafam7jog_rh9quaybcw.jpeg"><br><br>  Im Code sieht es ungef√§hr so ‚Äã‚Äãaus.  Unangenehm, aber leider so.  Normalerweise erscheinen diese Zeilen nach einem langen Debugging. <br><br><img src="https://habrastorage.org/webt/fs/ph/km/fsphkm8tzz4jyjrdht9bn8yw3a8.jpeg"><br><br>  Welche Garantien gibt uns Google, um sicherzustellen, dass die API nicht so stark besch√§digt wird, dass Anwendungen im Prinzip nicht funktionieren?  Zun√§chst gibt es eine CDD, die beschreibt, was m√∂glich ist und was nicht ge√§ndert werden kann, was abw√§rtskompatibel ist und was nicht.  Dies ist ein Dokument von mehreren Dutzend Seiten mit allgemeinen Empfehlungen, die nat√ºrlich nicht alle F√§lle abdecken.  Um weitere F√§lle abzudecken, gibt es CTS, das ausgef√ºllt werden muss, damit das Telefon eine Zertifizierung von Google erh√§lt und Google-Dienste von Google verwendet werden k√∂nnen.  Dies ist ein Satz von ungef√§hr 350.000 automatisierten Tests.  Es gibt auch einen CTS-Verifizierer, eine regul√§re APK, die Sie auf Ihr Telefon setzen k√∂nnen, um eine Reihe von √úberpr√ºfungen durchzuf√ºhren.  √úbrigens, wenn Sie ein Telefon mit Ihren H√§nden kaufen, k√∂nnen Sie es so √ºberpr√ºfen. <br><br>  Mit dem Aufkommen von Treble erschien das VTS-Projekt, es ist wahrscheinlicher f√ºr Entwickler niedrigerer Ebenen.  Es √ºberpr√ºft die Treiber-APIs, die ab Project Treble versioniert sind und √§hnliche Tests durchlaufen.  Dar√ºber hinaus sind die Telefonentwickler selbst gesunde Menschen, die m√∂chten, dass Android-Anwendungen f√ºr sie gut funktionieren, aber das ist eine mittelm√§√üige Hoffnung.  Die negative Seite ist, dass wir auf unvorhergesehene Fehler sto√üen, die erst vorhergesagt werden k√∂nnen, wenn die Anwendung auf dem Ger√§t gestartet wurde.  Auch hier sind wir gezwungen zu kaufen, zus√§tzlich zu der Tatsache, dass verschiedene Versionen der API, gibt es auch zus√§tzliche Ger√§te von verschiedenen Herstellern, um nach ihnen zu suchen. <br><br>  Aber es gibt positive Aspekte.  Zumindest fallen die von Herstellern am h√§ufigsten implementierten Funktionen in Android selbst.  Jemand kann sich daran erinnern, dass die Standard-Fingerabdruck-API sp√§ter angezeigt wurde als Ger√§te, die den Bildschirm mit einem Fingerabdruck entsperren konnten.  Laut XDA-Entwicklern m√∂chte die Android-API nun auch mit der Kamera im Gesicht entsperren, dies ist jedoch noch nicht korrekt.  Wir werden dies wahrscheinlich mit Ihnen herausfinden. <br><br>  Dar√ºber hinaus k√∂nnen Ger√§teentwickler selbst, wenn sie nicht standardm√§√üige APIs erstellen, und viele Bibliotheken ver√∂ffentlichen, um mit ihrer API f√ºr normale Entwickler zu arbeiten.  Und wenn Sie dies noch nie zuvor getan haben, empfehle ich Ihnen, die Statistiken zur Verwendung Ihrer Anwendung durchzugehen, die beliebtesten Hersteller zu ermitteln und sich die Entwicklerportale ihrer Websites anzusehen.  Ich denke, Sie werden angenehm √ºberrascht sein, dass viele APIs mit interessanten Hardwarefunktionen, Sicherheitsfunktionen, Cloud-Diensten oder etwas anderem Interessantem haben.  Und auf den ersten Blick scheint es wild, separate Funktionen f√ºr einzelne Ger√§te zu schreiben, aber neben Ger√§ten gibt es auch Hersteller von noch kleineren Prozessoren, die auch ihre APIs implementieren.  Zum Beispiel hat Qualcomm eine wunderbare Hardwarebeschleunigung zum Erkennen von Bildern von der Kamera, die Sie durchaus verwenden k√∂nnen, sie haben sogar eine gute Beschreibung von ihnen. <br><br>  Somit kann jeder von Ihnen auch von dieser Art der Fragmentierung profitieren.  Was machen wir damit?  In keinem Fall k√∂nnen Sie Fehler melden und Fehlerberichte an Ger√§teentwickler und sogar an Android-Entwickler senden.  Denn wenn APIs, die es wert waren, den CTS-Test zu schreiben, besch√§digt wurden, wird er geschrieben - und es gab solche Pr√§zedenzf√§lle - und danach wurde die API zuverl√§ssiger. <br><br>  Lernen Sie Android, lernen Sie, was Hersteller anbieten, schw√∂ren Sie nicht mit ihnen - arbeiten Sie mit ihnen. <br><br>  Wie sieht es von innen aus?  Wie kann ich eine Funktion implementieren, die f√ºr unser Telefon einzigartig ist, und diese API aus einer regul√§ren Android-Anwendung verwenden? <br><br><img src="https://habrastorage.org/webt/-0/lw/np/-0lwnpd7n_agyjhtdbvtbo-_6gi.jpeg"><br><br>  Ein bisschen Theorie.  Wie beschreiben Android-Entwickler selbst das interne AOSP-Ger√§t?  Die oberste Ebene ist eine Anwendung, die entweder von Ihnen oder von den Entwicklern des Telefons selbst geschrieben wurde. Sie hat keine hohen Rechte und verwendet lediglich Standard-APIs.  Dies ist ein Framework. Hierbei handelt es sich um Klassen, die nicht Teil Ihrer Anwendung sind, z. B. Aktivit√§t, Paket, Bundle. Sie sind Teil des Systems und werden als Framework bezeichnet.  Die Klassen, die Ihnen auf dem Ger√§t zur Verf√ºgung stehen.  Als n√§chstes folgen die Systemdienste.  Dies verbindet Sie mit dem System: ActivityManagerService, WindowManagerService, PackageManagerService, die die interne Seite der Interaktion mit dem System implementieren. <br><br>  Als n√§chstes folgt die Hardware-Abstraktionsschicht. Dies ist die oberste Treiberschicht, die die gesamte Logik f√ºr die Anzeige auf dem Bildschirm, f√ºr die Interaktion mit Bluetooth und dergleichen enth√§lt.  Der Kernel ist die unterste Ebene der Treiber, die Systemverwaltung.  Diejenigen, die wissen, was der Kern ist und vor was sie stehen, m√ºssen es nicht sagen, aber Sie k√∂nnen lange sprechen. <br><br><img src="https://habrastorage.org/webt/fp/lt/l3/fpltl3z44nvcpr9cnhadvf32oik.jpeg"><br><br>  Wie sieht es auf dem Ger√§t aus?  Unsere Anwendung interagiert nicht nur mit dem Standard-Framework, sondern kann auch mit dem benutzerdefinierten Framework des Herstellers interagieren.  √úber dieses Framework kann es auch mit benutzerdefinierten Diensten kommunizieren.  Wenn es sich um festverdrahtete oder Low-Level-Funktionen handelt, wird HAL f√ºr sie und gegebenenfalls sogar f√ºr Treiber auf Kernel-Ebene geschrieben. <br><br><img src="https://habrastorage.org/webt/ug/rf/un/ugrfunvrkrwxekn0jvxjwiuwdfg.jpeg"><br><br>  Wie schreiben wir unser Feature?  Der Plan ist einfach: Sie m√ºssen ein Framework schreiben, das sich nicht sehr von den Bibliotheken unterscheidet, die die meisten Android-Entwickler geschrieben haben. Ich denke, Sie alle wissen das.  Sie m√ºssen einen Systemdienst schreiben, bei dem es sich um eine normale Anwendung handelt, und zwar nur mit nicht ganz normalen Rechten im System.  Und wenn n√∂tig, k√∂nnen Sie HAL schreiben, aber wir lassen dies weg.  Sie k√∂nnen Ihre eigenen Treiber auf Kernel-Ebene schreiben, aber wir werden dies jetzt auch nicht ber√ºcksichtigen.  Und schreiben Sie eine Client-Anwendung, die all dies nutzt. <br><br><img src="https://habrastorage.org/webt/ox/e9/a3/oxe9a3ty2mwzut11ygakkf3rb3e.jpeg"><br><br>  Damit wir mit dem System interagieren k√∂nnen, m√ºssen wir einen Vertrag abschlie√üen, und daf√ºr gibt es bereits einen guten Mechanismus f√ºr AIDL-Schnittstellen.  Es ist nur eine Art Schnittstelle, auf deren Grundlage das System eine zus√§tzliche Klasse generiert, die wir erweitern k√∂nnen, √ºber die die Interprozesskommunikation zwischen Ihrer Anwendung und den Systemdiensten ausgef√ºhrt wird. <br><br><img src="https://habrastorage.org/webt/gq/ya/ao/gqyaaombrkaywxj_naka1edc5fu.jpeg"><br><br>  Als n√§chstes schreiben wir ein Framework, unsere Bibliothek, die die Implementierung dieser Schnittstelle enth√§lt, und geben alle Aufrufe an diese weiter.  Wenn Sie interessiert sind, funktionieren ActivityManager, PackageManager und WindowManager √§hnlich.  Es gibt etwas mehr Logik als wir hier implementiert haben, aber das Wesentliche ist genau das. <br><br><img src="https://habrastorage.org/webt/9m/5h/jn/9m5hjny8quqv2hin-be4cftx_zk.jpeg"><br><br>  Wir haben das Framework implementiert. Wir m√ºssen einen Systemdienst schreiben, der unsere Daten von der Systemseite empf√§ngt. In diesem Fall senden und lesen wir Ganzzahlen.  Wir erstellen eine Klasse, die auch die Schnittstelle erweitert, die auf der vorherigen Folie aus AIDL generiert wurde.  Wir erstellen ein Feld, in das wir Werte schreiben, lesen, einen Setter schreiben, einen Getter.  Das einzige ist, dass es nicht genug Schl√∂sser gibt, aber sie passten nicht sehr gut auf den Schlitten, sie sollten gemacht werden. <br><br><img src="https://habrastorage.org/webt/co/wz/no/cowznogjbu9jlrsvhnxxurm6in8.jpeg"><br><br>  Damit dieser Systemdienst verf√ºgbar ist, m√ºssen wir ihn im Systemdienstmanager registrieren. In diesem Fall handelt es sich um dieselbe Klasse, die f√ºr normale Anwendungen nicht verf√ºgbar ist.  Es ist genau f√ºr diejenigen verf√ºgbar, die sich in der Plattform in den Systempartitionen befinden.  Wir registrieren den Dienst einfach in Application.onCreate () und stellen ihn unter dem Namen der von uns erstellten Klasse zur Verf√ºgung. <br><br>  Was ben√∂tigen wir, damit onCreate () grunds√§tzlich gestartet und unser Dienst in den Speicher geladen werden kann?  Wir schreiben in das Manifest in Anwendung Android: persistent = "true".  Dies bedeutet, dass dies ein dauerhafter Prozess ist, der st√§ndig im Speicher sein muss, da er Systemfunktionen ausf√ºhrt. <br><br><img src="https://habrastorage.org/webt/iq/sn/q5/iqsnq5bwcen_faerouvcj9n1qq8.jpeg"><br><br>  Auch im Manifest selbst k√∂nnen wir android: sharedUserId angeben, in diesem Fall System, aber es kann eine Vielzahl unterschiedlicher IDs sein. Sie erm√∂glichen es der Anwendung, umfassendere Rechte im System zu erhalten und mit verschiedenen APIs und Diensten zu interagieren, die f√ºr normale Anwendungen nicht verf√ºgbar sind. <br><br>  In diesem Fall haben wir zum Beispiel so etwas nicht verwendet. <br><br><img src="https://habrastorage.org/webt/qx/ds/s-/qxdss-ivnge6oagknlzx59wee9u.jpeg"><br><br>  Wir haben ein Framework geschrieben, einen Systemdienst.  Wir werden die Mechanismen im Inneren weglassen, dies ist ein etwas kompliziertes Thema, es verdient einen separaten Bericht. <br><br>  Wie kann das Framework f√ºr Anwendungsentwickler bereitgestellt werden?  Zwei Formate.  Wir k√∂nnen vollwertige Klassen ausgeben und eine vollwertige Bibliothek erstellen, die Sie in Ihre Anwendung kompilieren, und die gesamte Logik wird Teil Ihrer Dexes. <br><br>  Sie k√∂nnen das Framework auch in Form von Stub-Klassen verteilen, auf die Sie nur zur Kompilierungszeit verlinken k√∂nnen, und erwarten, dass diese Klassen √§hnlich wie in fr√ºheren Beispielen aus verschiedenen Android-Versionen auf dem Ger√§t selbst auf Sie warten.  Sie k√∂nnen es entweder √ºber ein regul√§res Maven-Repository, das jeder kennt, oder √ºber Android Studio sdkmanager verteilen, √§hnlich wie Sie neue Versionen des SDK installieren.  Es ist schwer zu sagen, welche Methode bequemer ist.  F√ºr mich pers√∂nlich ist es bequemer, Maven zu verbinden. <br><br><img src="https://habrastorage.org/webt/k_/a5/oo/k_a5ookzluycn3qz3uivbrdepwk.jpeg"><br><br>  Wir schreiben eine einfache Bewerbung.  Auf vertraute Weise verbinden wir die compileOnly-Abh√§ngigkeit, nur jetzt ist es unsere Bibliothek.  Wir schreiben eine Verwendungsbibliothek vor, die wir geschrieben und auf dem Ger√§t installiert haben.  Wir schreiben Aktivit√§t, erhalten Zugriff auf diese Klassen und interagieren mit dem System.  Es w√§re also m√∂glich, absolut alle Funktionen zu implementieren: Daten√ºbertragung auf einige zus√§tzliche Ger√§te, zus√§tzliche Hardwarefunktionen usw. <br><br>  Somit stellen alle Entwickler den Entwicklern einzigartige Funktionen des Ger√§ts zur Verf√ºgung.  Manchmal sind dies private APIs, die nur Partnern zur Verf√ºgung stehen.  Manchmal sind sie √∂ffentlich und solche, die Sie auf Entwicklerportalen finden k√∂nnen.  Es gibt andere M√∂glichkeiten, solche Dinge zu implementieren, aber ich habe eine Methode beschrieben, die in Google und unter Android-Entwicklern als die wichtigste angesehen wird. <br><br>  Sie sollten Ger√§teentwickler nicht als Personen behandeln, die Ihre Anwendungen besch√§digen.  Dies sind die gleichen Entwickler, sie schreiben den gleichen Code auf ungef√§hr der gleichen Ebene.  Schreibe Fehlerberichte, sie helfen wirklich, ich analysiere sie oft.  Schreiben Sie mehr Anwendungen und nutzen Sie die M√∂glichkeiten, die sowohl Android als auch das Ger√§t selbst bieten.  Ich habe alles </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de448126/">https://habr.com/ru/post/de448126/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de448116/index.html">Intel Optane Memory H10 Hybrid-Laufwerk - Funktionsspezifikationen</a></li>
<li><a href="../de448118/index.html">SEO und kontextbezogene Werbung - f√ºhrt f√ºr 175.000 Rubel pro Tag in Ischewsk</a></li>
<li><a href="../de448120/index.html">√úber die N√§he der Gipfel</a></li>
<li><a href="../de448122/index.html">Wie ReactJS funktioniert Reaktionspaket</a></li>
<li><a href="../de448124/index.html">Mikrotik. SMS-Steuerung √ºber WEB-Server</a></li>
<li><a href="../de448128/index.html">9 Tipps zur Verwendung der Katzenbibliothek in Scala</a></li>
<li><a href="../de448130/index.html">Deckbuilding-Design f√ºr Videospiele</a></li>
<li><a href="../de448136/index.html">Anleitung: Testen von Ansible-Rollen und Informieren √ºber Probleme vor der Produktion</a></li>
<li><a href="../de448140/index.html">SNA Hackathon 2019 - Ergebnisse</a></li>
<li><a href="../de448142/index.html">Wo Beweise, Fakten und Vorstellungskraft zusammenlaufen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>