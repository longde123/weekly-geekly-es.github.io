<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≠ üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üî¢ Quelles erreurs sont masqu√©es dans le code Infer.NET? üë®üèæ‚Äç‚öïÔ∏è üë©üèø‚Äçü§ù‚Äçüë©üèº üèÇüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La publication par Microsoft du code source de ses projets est une bonne raison de les v√©rifier. Cette fois n'a pas fait exception, et aujourd'hui, no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Quelles erreurs sont masqu√©es dans le code Infer.NET?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/429578/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3f/18a/6a6/d3f18a6a6127aceeae10d53591e0ce65.png"></div><br>  La publication par Microsoft du code source de ses projets est une bonne raison de les v√©rifier.  Cette fois n'a pas fait exception, et aujourd'hui, nous examinons les endroits suspects trouv√©s dans le code Infer.NET.  √Ä bas avec l'annotation - allez droit au but! <br><a name="habracut"></a><br><h2>  Un peu sur le projet et l'analyseur </h2><br>  Infer.NET est un syst√®me d'apprentissage automatique d√©velopp√© par des sp√©cialistes de Microsoft.  Le code source du projet est r√©cemment devenu disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> , ce qui a √©t√© la raison de sa v√©rification.  Vous trouverez plus de d√©tails sur le projet, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Le projet a √©t√© v√©rifi√© √† l'aide de l'analyseur statique PVS-Studio version 6.26.  Permettez-moi de vous rappeler que PVS-Studio recherche des erreurs de code en C \ C ++ \ C # (et bient√¥t en Java) sous Windows, Linux, macOS.  Jusqu'√† pr√©sent, nous analysons uniquement le code C # sous Windows.  L'analyseur peut √™tre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©charg√© et essay√©</a> sur votre projet. <br><br>  Le contr√¥le en lui-m√™me √©tait extr√™mement simple et sans probl√®me.  Auparavant, j'ai d√©charg√© le projet de GitHub, restaur√© les packages requis (d√©pendances) et v√©rifi√© que le projet a √©t√© correctement construit.  Ceci est n√©cessaire pour que l'analyseur ait acc√®s √† toutes les informations n√©cessaires pour une analyse compl√®te.  Apr√®s assemblage en quelques clics, j'ai lanc√© l'analyse de la solution via le plugin PVS-Studio pour Visual Studio. <br><br>  √Ä propos, ce n'est pas le premier projet de Microsoft test√© avec PVS-Studio - il y en avait d'autres: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Roslyn</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MSBuild</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PowerShell</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CoreFX</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">autres</a> . <br><br>  <b>Remarque</b>  Si vous ou vos connaissances √™tes int√©ress√©s par l'analyse du code Java, vous pouvez nous √©crire √† l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">appui</a> en s√©lectionnant ¬´Je veux un analyseur pour Java¬ª.  Il n'y a pas de version b√™ta publique de l'analyseur, mais il devrait √™tre disponible bient√¥t.  Quelque part dans un laboratoire secret (√† travers le mur), les gars y travaillent activement. <br><br>  Mais assez de discussions abstraites - regardons les probl√®mes dans le code. <br><br><h2>  Est-ce un bug ou une fonctionnalit√©? </h2><br>  Je sugg√®re d'essayer de trouver l'erreur vous-m√™me - une t√¢che compl√®tement r√©soluble.  Pas de blagues dans l'esprit de ce qui √©tait dans l'article " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Top 10 des erreurs dans les projets C ++ pour 2017</a> ", honn√™tement.  Ne vous pr√©cipitez donc pas pour lire l'avertissement de l'analyseur fourni apr√®s l'extrait de code. <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MergeParallelTransitions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( transition1.DestinationStateIndex == transition2.DestinationStateIndex &amp;&amp; transition1.Group == transition2.Group) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (transition1.IsEpsilon &amp;&amp; transition2.IsEpsilon) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!transition1.IsEpsilon &amp;&amp; !transition2.IsEpsilon) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.IsInfinity(transition1.Weight.Value) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.IsInfinity(transition1.Weight.Value)) { newElementDistribution.SetToSum( <span class="hljs-number"><span class="hljs-number">1.0</span></span>, transition1.ElementDistribution, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, transition2.ElementDistribution); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { newElementDistribution.SetToSum( transition1.Weight.Value, transition1.ElementDistribution, transition2.Weight.Value, transition2.ElementDistribution); } .... }</code> </pre> <br>  <b>Avertissement PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3001</a> Il existe des sous-expressions identiques ¬´double.IsInfinity (transition1.Weight.Value)¬ª √† gauche et √† droite de l'op√©rateur ¬´&amp;&amp;¬ª.  Runtime Automaton.Simplification.cs 479 <br><br>  Comme vous pouvez le voir dans l'extrait de code, la m√©thode fonctionne avec une paire de variables - <i>transition1</i> et <i>transition2</i> .  L'utilisation de noms similaires est parfois tout √† fait justifi√©e, mais il convient de rappeler que dans ce cas, la probabilit√© de faire accidentellement une erreur quelque part avec le nom augmente. <br><br>  C'est <i>ce qui</i> s'est produit lors de la v√©rification des nombres pour l'infini ( <i>double.IsInfinity</i> ).  En raison d'une erreur, nous avons v√©rifi√© la valeur de la m√™me variable 2 fois - <i>transition1.Weight.Value</i> .  La valeur v√©rifi√©e dans la deuxi√®me sous-expression devait √™tre la variable <i>transition2.Weight.Value</i> . <br><br>  Un autre code suspect similaire. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> MethodBase </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToMethodInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IMethodReference imr</span></span></span><span class="hljs-function">)</span></span> { .... bf |= BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance; .... }</code> </pre> <br>  <b>Avertissement PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3001</a> Il existe des sous-expressions identiques ¬´BindingFlags.Public¬ª √† gauche et √† droite de ¬´|¬ª  op√©rateur.  Compilateur CodeBuilder.cs 194 <br><br>  Lors de la formation de la valeur de la variable <i>bf</i> , l'√©l√©ment d'√©num√©ration <i>BindingFlags.Public</i> est utilis√© deux fois.  Soit ce code contient une op√©ration de signalisation suppl√©mentaire, soit au lieu de la deuxi√®me utilisation de <i>BindingFlags.Public, il</i> doit <i>y</i> avoir une valeur d'√©num√©ration diff√©rente. <br><br>  Par ailleurs, dans le code source, ce code est √©crit sur une seule ligne.  Il me semble que s'il est format√© dans un style de tableau (comme ici), le probl√®me est plus facile √† d√©tecter. <br><br>  Continuons.  J'apporte tout le corps de la m√©thode et je vous sugg√®re √† nouveau de trouver l'erreur (ou peut-√™tre l'erreur) vous-m√™me. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ForEachPrefix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IExpression expr, Action&lt;IExpression&gt; action</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// This method must be kept consistent with GetTargets. if (expr is IArrayIndexerExpression) ForEachPrefix(((IArrayIndexerExpression)expr).Target, action); else if (expr is IAddressOutExpression) ForEachPrefix(((IAddressOutExpression)expr).Expression, action); else if (expr is IPropertyReferenceExpression) ForEachPrefix(((IPropertyReferenceExpression)expr).Target, action); else if (expr is IFieldReferenceExpression) { IExpression target = ((IFieldReferenceExpression)expr).Target; if (!(target is IThisReferenceExpression)) ForEachPrefix(target, action); } else if (expr is ICastExpression) ForEachPrefix(((ICastExpression)expr).Expression, action); else if (expr is IPropertyIndexerExpression) ForEachPrefix(((IPropertyIndexerExpression)expr).Target, action); else if (expr is IEventReferenceExpression) ForEachPrefix(((IEventReferenceExpression)expr).Target, action); else if (expr is IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); else if (expr is IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); else if (expr is IMethodInvokeExpression) ForEachPrefix(((IMethodInvokeExpression)expr).Method, action); else if (expr is IMethodReferenceExpression) ForEachPrefix(((IMethodReferenceExpression)expr).Target, action); else if (expr is IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); else if (expr is IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); else if (expr is IDelegateInvokeExpression) ForEachPrefix(((IDelegateInvokeExpression)expr).Target, action); action(expr); }</span></span></code> </pre> <br>  L'avez-vous trouv√©?  Nous v√©rifions! <br><br>  <b>Avertissements de PVS-Studio</b> : <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3003</a> L'utilisation du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le</a> 'if (A) {...} else if (A) {...}' a √©t√© d√©tect√©e.  Il y a une probabilit√© de pr√©sence d'erreur logique.  V√©rifiez les lignes: 1719, 1727. Compiler CodeRecognizer.cs 1719 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3003</a> L'utilisation du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le</a> 'if (A) {...} else if (A) {...}' a √©t√© d√©tect√©e.  Il y a une probabilit√© de pr√©sence d'erreur logique.  V√©rifiez les lignes: 1721, 1729. Compiler CodeRecognizer.cs 1721 </li></ul><br>  Simplifiez un peu le code pour rendre les probl√®mes plus √©vidents. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ForEachPrefix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IExpression expr, Action&lt;IExpression&gt; action</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action) .... }</code> </pre> <br>  Les expressions conditionnelles, <i>puis les</i> branches de plusieurs <i>instructions if sont</i> dupliqu√©es.  Peut-√™tre que ce code a √©t√© √©crit √† l'aide de la m√©thode copier-coller, c'est pourquoi le probl√®me est survenu.  Maintenant, il s'av√®re que les branches des doublons ne seront jamais ex√©cut√©es, car: <br><br><ul><li>  si l'expression conditionnelle est vraie, le corps de la premi√®re <i>instruction if</i> de la paire correspondante est ex√©cut√©; </li><li>  si l'expression conditionnelle est fausse dans le premier cas, elle sera fausse dans le second. </li></ul><br>  Depuis, les branches contiennent les m√™mes actions, maintenant cela ressemble √† du code redondant qui pr√™te √† confusion.  Il est possible qu'il s'agisse d'un type de probl√®me diff√©rent - au lieu de doublons, d'autres v√©rifications auraient d√ª √™tre effectu√©es. <br><br>  Nous continuons. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Compare</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Pair&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; x, Pair&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x.First &lt; y.First) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x.Second &gt;= y.Second) { <span class="hljs-comment"><span class="hljs-comment">// y strictly contains x return 1; } else { // No containment - order by left bound return 1; } } else if (x.First &gt; y.First) { if (x.Second &lt;= y.Second) { // x strictly contains y return -1; } else { // No containment - order by left bound return -1; } } .... }</span></span></code> </pre> <br>  <b>Avertissements de PVS-Studio</b> : <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3004</a> L' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instruction</a> 'then' est √©quivalente √† l'instruction 'else'.  Dur√©e d'ex√©cution RegexpTreeBuilder.cs 1080 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3004</a> L' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instruction</a> 'then' est √©quivalente √† l'instruction 'else'.  Runtime RegexpTreeBuilder.cs 1093 </li></ul><br>  Le code semble extr√™mement suspect, car il contient deux instructions conditionnelles avec des corps identiques de branches <i>then</i> et <i>else</i> .  Dans les deux cas, il vaut probablement la peine de renvoyer des valeurs diff√©rentes.  Ou, s'il s'agit d'un comportement con√ßu, il sera utile de supprimer les instructions conditionnelles redondantes. <br><br>  Il y a eu des cycles int√©ressants.  Exemple ci-dessous: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Set&lt;StochasticityPattern&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IntersectPatterns</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;StochasticityPattern&gt; patterns</span></span></span><span class="hljs-function">)</span></span> { Set&lt;StochasticityPattern&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Set&lt;StochasticityPattern&gt;(); result.AddRange(patterns); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> changed; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = result.Count; AddIntersections(result); changed = (result.Count != count); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (changed); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3020</a> Une ¬´pause¬ª inconditionnelle dans une boucle.  Compilateur DefaultFactorManager.cs 474 <br><br>  En raison de l'instruction <i>break</i> inconditionnelle, une seule it√©ration de la boucle est effectu√©e et la variable de contr√¥le <i>modifi√©e</i> n'est m√™me pas utilis√©e.  En g√©n√©ral, le code semble √©trange et suspect. <br><br>  La m√™me m√©thode (copie exacte) a √©t√© trouv√©e dans une autre classe.  Avertissement correspondant de l'analyseur: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3020</a> Une ¬´pause¬ª inconditionnelle dans une boucle.  Visualizers.Windows FactorManagerView.cs 350 <br><br>  √Ä propos, une m√©thode a rencontr√© une instruction <i>continue</i> inconditionnelle dans une boucle (elle a √©t√© trouv√©e par l'analyseur avec les m√™mes diagnostics), mais il y avait un commentaire au-dessus confirmant qu'il s'agissait d'une solution temporaire sp√©ciale: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// TEMPORARY continue;</span></span></code> </pre> <br>  Je me souviens qu'il n'y avait pas de tels commentaires pr√®s de la d√©claration de <i>pause</i> inconditionnelle. <br><br>  Continuons. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> DependencyInformation </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDependencyInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... IExpression resultIndex = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultIndex != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameter.IsDefined( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(SkipIfMatchingIndexIsUniformAttribute), <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultIndex == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InferCompilerException( parameter.Name + <span class="hljs-string"><span class="hljs-string">" has SkipIfMatchingIndexIsUniformAttribute but "</span></span> + StringUtil.MethodNameToString(method) + <span class="hljs-string"><span class="hljs-string">" has no resultIndex parameter"</span></span>); .... } .... } .... }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Avertissement</a> <b>PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3022 L'</a> expression 'resultIndex == null' est toujours fausse.  Compiler FactorManager.cs 382 <br><br>  Imm√©diatement, je note qu'entre la d√©claration et la v√©rification ci-dessus, la valeur de la variable <i>resultIndex</i> peut changer.  Cependant, entre les v√©rifications <i>resultIndex! = Null</i> et <i>resultIndex == null, la</i> valeur ne peut pas d√©j√† √™tre modifi√©e.  Par cons√©quent, le r√©sultat de l'expression <i>resultIndex == null</i> sera toujours <i>faux</i> , ce qui signifie qu'une exception ne sera jamais lev√©e. <br><br>  J'esp√®re que vous avez int√©r√™t √† trouver vous-m√™me des erreurs, sans mes suggestions, pour trouver un probl√®me, mais juste au cas o√π, je vous proposerais de le refaire.  Le code de la m√©thode est petit, je vais le donner dans son int√©gralit√©. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Tuple&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeMovieGenre</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> feature</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] genres = feature.Split(<span class="hljs-string"><span class="hljs-string">'|'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (genres.Length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; genres.Length &gt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"Movies should have between 1 and 3 genres; given {0}."</span></span>, genres.Length)); } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / genres.Length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder( <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"{0}:{1}"</span></span>, offset + MovieGenreBuckets[genres[<span class="hljs-number"><span class="hljs-number">0</span></span>]], <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; genres.Length; ++i) { result.Append( <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"|{0}:{1}"</span></span>, offset + MovieGenreBuckets[genres[i].Trim()], <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tuple&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(MovieGenreBucketCount, result.ToString()); }</code> </pre> <br>  Voyons ce qui se passe ici.  La cha√Æne d'entr√©e est analys√©e par le caract√®re ¬´|¬ª.  Si la longueur du tableau n'est pas celle attendue, une exception doit √™tre lev√©e.  <i>Attendez une seconde</i> ... <i>genres.Length &lt;1 &amp;&amp; genres.Length&gt; 3</i> ?  Puisqu'il n'y a pas de nombre qui tombe imm√©diatement dans la plage de valeurs requise par l'expression ( <i>[int.MinValue..1)</i> et <i>(3..int.MaxValue]</i> ), le r√©sultat de l'expression sera toujours <i>faux</i> .  Par cons√©quent, cette v√©rification ne prot√®ge contre rien et l'exception attendue ne sera pas lev√©e. <br><br>  C'est exactement ce que l'analyseur pr√©vient: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3022</a> Expression 'genres.Length &lt;1 &amp;&amp; genres.Length&gt; 3' est toujours faux.  Probablement le '||'  L'op√©rateur doit √™tre utilis√© ici.  Fonctions de l'√©valuateur.cs 242 <br><br>  Op√©ration de fission suspecte rencontr√©e. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateTrueThetaAndPhi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> expectedRepeatOfTopicInDoc = averageDocLength / numUniqueTopicsPerDoc; .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cnt = Poisson.Sample(expectedRepeatOfTopicInDoc); .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3041</a> L'expression a √©t√© implicitement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">convertie</a> du type 'int' en type 'double'.  Pensez √† utiliser un transtypage de type explicite pour √©viter la perte d'une partie fractionnaire.  Un exemple: double A = (double) (X) / Y;.  LDA Utilities.cs 74 <br><br>  Ceci est suspect ici: une division enti√®re est effectu√©e (les variables <i>averageDocLength</i> et <i>numUniqueTopicsPerDoc</i> sont de type <i>int</i> ), et le r√©sultat est √©crit dans une variable de type <i>double</i> .  La question se pose: est-ce sp√©cialement fait, ou la division des nombres r√©els √©tait-elle toujours implicite?  Si la variable attenduRepeatOfTopicInDoc √©tait de type <i>int</i> , cela clarifierait les questions possibles. <br><br>  Dans d'autres endroits, la m√©thode <i>Poisson.Sample</i> , dont l'argument est la variable suspecte <i>attenduRepeatOfTopicInDoc</i> , est utilis√©e, par exemple, comme d√©crit ci-dessous. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numUniqueWordsPerTopic = Poisson.Sample((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)averageWordsPerTopic);</code> </pre> <br>  <i>averageWordsPerTopic</i> est de type <i>int</i> , qui est d√©j√† converti en <i>double</i> au lieu d'utilisation. <br><br>  Et voici un autre lieu d'utilisation: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> expectedRepeatOfWordInTopic = ((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)numDocs) * averageDocLength / numUniqueWordsPerTopic; .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cnt = Poisson.Sample(expectedRepeatOfWordInTopic);</code> </pre> <br>  Veuillez noter que les variables ont les m√™mes noms que dans l'exemple d'origine, seule la division des nombres r√©els est utilis√©e pour initialiser le <i>attenduRepeatOfWordInTopic</i> (en raison de la conversion explicite de <i>numDocs</i> en <i>double</i> ). <br><br>  En g√©n√©ral, il vaut la peine de regarder le point de d√©part o√π l'analyseur a √©mis un avertissement. <br><br>  Mais des r√©flexions sur la question de savoir s'il vaut la peine d'√™tre √©dit√© et comment, laissons les auteurs du code (ils le savent mieux), mais allons plus loin.  √Ä la prochaine division suspecte. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NonconjugateGaussian </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BAverageLogarithm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> v_opt = <span class="hljs-number"><span class="hljs-number">2</span></span> / <span class="hljs-number"><span class="hljs-number">3</span></span> * (Math.Log(mx * mz / Ex2 / <span class="hljs-number"><span class="hljs-number">2</span></span>) - m); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v_opt != v) { .... } .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3041</a> L'expression a √©t√© implicitement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">convertie</a> du type 'int' en type 'double'.  Pensez √† utiliser un transtypage de type explicite pour √©viter la perte d'une partie fractionnaire.  Un exemple: double A = (double) (X) / Y;.  Runtime ProductExp.cs 137 <br><br>  L'analyseur a de nouveau d√©tect√© l'op√©ration suspecte de division enti√®re, comme  <i>2</i> et <i>3</i> sont des litt√©raux num√©riques entiers et le r√©sultat de l'expression 2/3 sera <i>0</i> .  En cons√©quence, l'expression enti√®re prend la forme: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> v_opt = <span class="hljs-number"><span class="hljs-number">0</span></span> * expr;</code> </pre> <br>  D'accord, un peu √©trange.  Plusieurs fois, je suis revenu sur cet avertissement, essayant de trouver une sorte de capture, et ne cherchant pas √† l'ajouter √† l'article.  La m√©thode est remplie de math√©matiques et de diverses formules (que, franchement, je ne voulais pas vraiment d√©monter), on ne sait jamais √† quoi s‚Äôattendre.  De plus, j'essaie d'√™tre aussi sceptique que possible sur les avertissements que j'√©cris dans l'article, et je ne les d√©cris qu'apr√®s les avoir mieux √©tudi√©s. <br><br>  Mais cela m'est venu √† l'esprit - pourquoi ai-je besoin d'un facteur de <i>0</i> , √©crit <i>2/3</i> ?  Donc, cet endroit vaut le d√©tour de toute fa√ßon. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAttribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextWriter writer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> defaultValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Func&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; converter = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( defaultValue == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Equals(defaultValue)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> stringValue = converter == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.ToString() : converter(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); writer.Write(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string">=\"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{stringValue}</span></span></span><span class="hljs-string">\" "</span></span>); }</code> </pre> <br>  <b>Avertissement PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3080 D√©r√©f√©rence</a> nulle possible.  Pensez √† inspecter la ¬´valeur¬ª.  Compilateur WriteHelpers.cs 78 <br><br>  Affirmation assez juste de l'analyseur en fonction de la condition.  Le d√©r√©f√©rencement d'une r√©f√©rence null peut se produire dans l'expression <i>value.Equals (defaultValue)</i> si <i>value == null</i> .  Puisque cette expression est l'op√©rande droit de l'op√©rateur ||, pour le calculer, l'op√©rande gauche doit √™tre <i>faux</i> , et pour cela il suffit qu'au moins une des variables <i>defaultValue</i> \ <i>value</i> ne soit pas <i>nulle</i> .  Par cons√©quent, si <i>defaultValue! = Null</i> et <i>value == null</i> : <br><br><ul><li>  <i>defaultValue == null</i> -&gt; <i>false</i> ; </li><li>  <i>defaultValue == null &amp;&amp; value == null</i> -&gt; <i>false</i> ;  (la v√©rification de la <i>valeur</i> n'a pas eu lieu) </li><li>  <i>value.Equals (defaultValue)</i> -&gt; <i>NullReferenceException</i> , car la <i>valeur</i> est <i>nulle</i> . </li></ul><br>  Regardons un cas similaire: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FeatureParameterDistribution</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> GaussianMatrix traitFeatureWeightDistribution, GaussianArray biasFeatureWeightDistribution</span></span></span><span class="hljs-function">)</span></span> { Debug.Assert( (traitFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; biasFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || traitFeatureWeightDistribution.All( w =&gt; w != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; w.Count == biasFeatureWeightDistribution.Count), <span class="hljs-string"><span class="hljs-string">"The provided distributions should be valid and consistent in the number of features."</span></span>); .... }</code> </pre> <br>  <b>Avertissement PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3080 D√©r√©f√©rence</a> nulle possible.  Pensez √† inspecter ¬´traitFeatureWeightDistribution¬ª.  Recommender FeatureParameterDistribution.cs 65 <br><br>  Nous jetons l'exc√©dent, ne laissant que la logique de calcul de la valeur bool√©enne, afin qu'il soit plus facile de comprendre: <br><br><pre> <code class="cs hljs">(traitFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; biasFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || traitFeatureWeightDistribution.All( w =&gt; w != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; w.Count == biasFeatureWeightDistribution.Count)</code> </pre> <br>  Encore une fois, l'op√©rande droit de la ||  Il est calcul√© uniquement si le r√©sultat du calcul de gauche est <i>faux</i> .  L'op√©rande gauche peut √™tre <i>faux</i> , y compris lorsque <i>traitFeatureWeightDistribution == null</i> et <i>biaisFeatureWeightDistribution! = Null</i> .  Ensuite, l'op√©rande droit de l'op√©rateur || sera calcul√©, et un appel √† <i>traitFeatureWeightDistribution.All l√®vera</i> une <i>ArgumentNullException</i> . <br><br>  Un autre morceau de code int√©ressant: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetQuantile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> probability, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] quantiles</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = quantiles.Length; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (quantiles == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(quantiles)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"quantiles array is empty"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(quantiles)); .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3095</a> L'objet 'quantiles' a √©t√© utilis√© avant d'√™tre v√©rifi√© par rapport √† null.  V√©rifiez les lignes: 91, 92. Runtime OuterQuantiles.cs 91 <br><br>  Notez que la propri√©t√© <i>quantiles.Length</i> est d' <i>abord accessible</i> , puis les <i>quantiles sont</i> v√©rifi√©s pour <i>null</i> .  Par cons√©quent, si <i>quantiles == null</i> , la m√©thode l√®vera une exception, juste un peu fausse, et un peu pas l√† o√π elle √©tait n√©cessaire.  Apparemment, ils ont foir√© les lignes par endroits. <br><br>  Si vous avez r√©ussi √† g√©rer vous-m√™me la d√©tection des erreurs pr√©c√©dentes, je vous sugg√®re de pr√©parer une tasse de caf√© et d'essayer de r√©p√©ter l'exploit, en trouvant l'erreur dans la m√©thode ci-dessous.  Pour le rendre un peu plus int√©ressant, je cite tout le code de la m√©thode. <br><br>  ( <a href="">Lien vers la taille r√©elle</a> ) <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c2c/5ff/2d9/c2c5ff2d99aca64bbda4136acfa4b1d4.png" alt="Image 2"></p><br><br>  D'accord, d'accord, c'√©tait une blague (ou avez-vous r√©ussi?!).  Simplifions un peu la t√¢che: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sample.Precision &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { precisionIsBetween = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; lowerBound = <span class="hljs-number"><span class="hljs-number">-1.0</span></span> / v; upperBound = -mean.Precision; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sample.Precision &lt; -mean.Precision) { precisionIsBetween = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; lowerBound = <span class="hljs-number"><span class="hljs-number">0</span></span>; upperBound = -mean.Precision; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// in this case, the precision should NOT be in this interval. precisionIsBetween = false; lowerBound = -mean.Precision; lowerBound = -1.0 / v; }</span></span></code> </pre> <br>  Cela s'est-il am√©lior√©?  L'analyseur a √©mis l'avertissement suivant pour ce code: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3008</a> La variable 'lowerBound' se voit attribuer des valeurs deux fois de suite.  C'est peut-√™tre une erreur.  V√©rifiez les lignes: 324, 323. Runtime GaussianOp.cs 324 <br><br>  En effet, dans la derni√®re branche <i>else</i> , la valeur de la variable <i>lowerBound</i> est affect√©e deux fois de suite.  Apparemment (et √† en juger par le code ci-dessus), la variable <i>upperBound</i> doit √™tre impliqu√©e dans l'une des affectations. <br><br>  Nous suivons plus loin. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAucMatrix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span>; c &lt; classLabelCount; c++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> labelWidth = labels[c].Length; columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>] = labelWidth &gt; MaxLabelWidth ? MaxLabelWidth : labelWidth; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>; r &lt; classLabelCount; r++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> countWidth = MaxValueWidth; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (countWidth &gt; columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>] = countWidth; } } .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3081</a> Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">compteur</a> 'r' n'est pas utilis√© dans une boucle imbriqu√©e.  Envisagez d'inspecter l'utilisation du compteur ¬´c¬ª.  CommandLine ClassifierEvaluationModule.cs 459 <br><br>  Veuillez noter que le compteur de la boucle int√©rieure - <i>r</i> - n'est pas utilis√© dans le corps de cette boucle.  Pour cette raison, il s'av√®re que pendant toutes les it√©rations de la boucle int√©rieure, les m√™mes op√©rations sont effectu√©es sur les m√™mes √©l√©ments - apr√®s tout, les indices utilisent √©galement le compteur de la boucle ext√©rieure ( <i>c</i> ), et non pas la boucle int√©rieure ( <i>r</i> ). <br><br>  Voyons ce qui a √©t√© trouv√© d'autre int√©ressant. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegexpFormattingSettings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> putOptionalInSquareBrackets, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> showAnyElementAsQuestionMark, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreElementDistributionDetails, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> truncationLength, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> escapeCharacters, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useLazyQuantifier</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PutOptionalInSquareBrackets = putOptionalInSquareBrackets; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ShowAnyElementAsQuestionMark = showAnyElementAsQuestionMark; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IgnoreElementDistributionDetails = ignoreElementDistributionDetails; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.TruncationLength = truncationLength; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.EscapeCharacters = escapeCharacters; }</code> </pre> <br>  <b>Avertissement PVS-Studio</b> : le param√®tre constructeur V3117 'useLazyQuantifier' n'est pas utilis√©.  Dur√©e d'ex√©cution RegexpFormattingSettings.cs 38 <br><br>  Le constructeur n'utilise pas un param√®tre - <i>useLazyQuantifier</i> .  Cela semble particuli√®rement suspect dans le contexte du fait qu'une propri√©t√© avec le nom et le type correspondants est d√©finie dans la classe - <i>UseLazyQuantifier</i> .  Apparemment, ils ont oubli√© de l'initialiser via le param√®tre correspondant. <br><br>  Rencontr√© plusieurs gestionnaires d'√©v√©nements potentiellement dangereux.  Un exemple de l'un d'eux est donn√© ci-dessous: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RecommenderRun</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventHandler Started; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Report that the run has been started if (this.Started != null) { this.Started(this, EventArgs.Empty); } .... } .... }</span></span></code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3083 Invocation</a> non <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s√ªre</a> de l'√©v√©nement 'Started', NullReferenceException est possible.  Pensez √† affecter un √©v√©nement √† une variable locale avant de l'invoquer.  √âvaluateur RecommenderRun.cs 115 <br><br>  Le fait est qu'entre la v√©rification de <i>l'</i> in√©galit√© <i>nulle</i> et l'appel du gestionnaire, un √©v√©nement peut √™tre d√©sabonn√©, et si √† l'heure actuelle entre la v√©rification de <i>null</i> et l'appel des gestionnaires l'√©v√©nement n'a pas d'abonn√©s, une <i>exception NullReferenceException</i> sera <i>lev√©e</i> .  Pour √©viter de tels probl√®mes, par exemple, vous pouvez enregistrer le lien vers la cha√Æne d√©l√©gu√©e dans une variable locale ou utiliser l'op√©rateur ¬´?¬ª.  pour appeler des gestionnaires. <br><br>  En plus de l'extrait de code ci-dessus, il y avait 35 de ces endroits. <br><br>  Soit dit en passant, <b>785</b> avertissements du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3024</a> ont √©galement √©t√© respect√©s.  L'avertissement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V3024</a> est √©mis lors de la comparaison de nombres r√©els √† l'aide des op√©rateurs '! =' Ou '=='.  Je ne m'attarderai pas ici sur les raisons pour lesquelles ces comparaisons ne sont pas toujours correctes - plus √† ce sujet est √©crit dans la documentation, il y a aussi un lien vers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">StackOverflow</a> (c'est √ßa). <br><br>  √âtant donn√© que les formules et les calculs ont souvent √©t√© respect√©s, ces avertissements peuvent √©galement √™tre importants, bien qu'ils soient port√©s au niveau 3 (car ils sont loin d'√™tre pertinents dans tous les projets). <br><br>  Si vous √™tes s√ªr que ces avertissements ne sont pas pertinents, vous pouvez les supprimer en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un seul clic</a> , ce qui r√©duit le nombre total d'op√©rations de l'analyseur. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47e/77b/72d/47e77b72dbb716dadbd1623513150819.png"></div><br><br><h2>  Conclusion </h2><br>  D'une certaine mani√®re, il s'est av√©r√© que pendant longtemps je n'avais pas √©crit d'articles sur la v√©rification des projets, et toucher √† nouveau ce processus √©tait assez agr√©able.  J'esp√®re que vous avez √©galement appris quelque chose de nouveau / utile de cet article, ou du moins que vous l'avez lu avec int√©r√™t. <br><br>  Je souhaite aux d√©veloppeurs une correction pr√©coce des zones probl√©matiques et je vous rappelle que faire des erreurs est normal, mais nous sommes des gens.  Pour cela, des outils suppl√©mentaires comme des analyseurs statiques sont n√©cessaires pour trouver ce qu'une personne a manqu√©, non?  Quoi qu'il en soit - bonne chance avec le projet et merci pour le travail! <br><br>  Et rappelez-vous que l'avantage maximal d'un analyseur statique est obtenu gr√¢ce √† son <i>utilisation r√©guli√®re</i> . <br><br>  Meilleurs v≈ìux! <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: Sergey Vasiliev.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quelles erreurs se cachent dans le code Infer.NET?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429578/">https://habr.com/ru/post/fr429578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429564/index.html">¬´Je suis juste un passionn√© de projets et un utilisateur de la langue Dart¬ª - entretien avec Ari Lerner, auteur du c√©l√®bre livre ng</a></li>
<li><a href="../fr429568/index.html">R√©duisez les temps d'arr√™t de Zimbra lors des pannes de serveur avec Zextras Backup</a></li>
<li><a href="../fr429570/index.html">Apprendre √† un agent √† jouer √† Mario Kart avec des filtres</a></li>
<li><a href="../fr429572/index.html">Interception de conversations priv√©es dans Skype √† l'aide de Devicelock DLP</a></li>
<li><a href="../fr429574/index.html">Cours gratuit Check Point pour d√©butants √† CheckMates</a></li>
<li><a href="../fr429580/index.html">Microinteractions dans iOS. Conf√©rence Yandex</a></li>
<li><a href="../fr429582/index.html">Indicateur analogique de la charge de l'ordinateur</a></li>
<li><a href="../fr429586/index.html">Comment d√©terminer le meilleur moment pour trader sur la bourse</a></li>
<li><a href="../fr429588/index.html">Toute la v√©rit√© sur RTOS. Article # 20. S√©maphores: services auxiliaires et structures de donn√©es</a></li>
<li><a href="../fr429590/index.html">Analyse vocale pour les centres d'appels bas√©s sur SOLR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>