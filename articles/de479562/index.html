<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö≤ üç∑ üë®üèø‚Äç‚öïÔ∏è Erstellen Sie die Struktur eines einfachen Multi-Plattform-Bot üêæ üàµ üòñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Benutzer f√ºr Veranstaltungen registrieren, automatisch nach Antworten in der Datenbank suchen, mit dem technischen Support kommunizieren, Kontakte aus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen Sie die Struktur eines einfachen Multi-Plattform-Bot</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/leader-id/blog/479562/">  Benutzer f√ºr Veranstaltungen registrieren, automatisch nach Antworten in der Datenbank suchen, mit dem technischen Support kommunizieren, Kontakte austauschen - all dies geh√∂rt zu den Funktionen unseres Leader-ID-Bots.  Er "lebt" auf drei Plattformen: VK, Facebook Messenger und Telegramm, w√§hrend die Logik seiner Arbeit ein f√ºr alle Mal mit plattformunabh√§ngigen Abstraktionen geschrieben wird.  Mit diesem Ansatz k√∂nnen Sie schnell neue Funktionen hinzuf√ºgen und alte Funktionen erweitern. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/48b/4ff/63a/48b4ff63ae9992c0672a2626b3b9ee18.jpg"><br><br>  Die Struktur des Systems vereinheitlicht die Entwicklung von Funktionen f√ºr verschiedene Plattformen und vereinfacht die Prozesse um eine Gr√∂√üenordnung im Vergleich zu der M√∂glichkeit, sie in jeder plattformabh√§ngigen API manuell neu zu schreiben.  Gleichzeitig m√ºssen Sie nur den entsprechenden Adapter ( <i>Connector</i> ) schreiben, um einen Bot auf einer neuen Plattform zu starten. <br><br>  Ich wollte kurz auf diese Struktur eingehen.  Vielleicht ist dies n√ºtzlich f√ºr diejenigen, die ihren plattform√ºbergreifenden Bot schreiben m√∂chten, aber noch nicht tief in das Thema eingetaucht sind und die Erfahrung eines anderen studiert haben. <br><a name="habracut"></a><br>  Machen wir uns mit unserem Bot bekannt.  Er ist in <a href="http://t.me/leaderid_bot">Telegram</a> , <a href="https://vk.me/tboil_people">VK</a> , <a href="https://m.me/youngprofs">FB zu finden</a> , wo er (wie bei Gro√üveranstaltungen) mehrere tausend Personen gleichzeitig bedient.  √úbrigens k√∂nnen wir in unserem <a href="https://habr.com/ru/company/leader-id/blog/477976/">ersten Artikel</a> erfahren, wer wir sind und was wir tun.  Kurz gesagt, wir betreiben ein riesiges Netzwerk an freien Coworking- und Pr√§sentationsfl√§chen in ganz Russland und unterst√ºtzen gleichzeitig die <a href="https://leader-id.ru/">Leader-ID-</a> Kommunikationsplattform, die den Kern des gesamten Systems bildet.  Und der Bot spielt eine wichtige Rolle in der ganzen Geschichte. <br><br><h2>  Doppelpistole - doppelter Spa√ü </h2><br>  Tats√§chlich haben wir zwei Bots.  Der erste ist der Hauptverantwortliche f√ºr die Interaktion mit den Benutzern.  Es ist ein praktisches Mittel zur Registrierung mobiler Benutzer f√ºr Veranstaltungen, zur Interaktion mit Support und zum Abrufen zus√§tzlicher Informationen aus Vortr√§gen und Seminaren sowie zum Austausch von Kontakten innerhalb desselben √ñkosystems. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/df6/fd7/c32/df6fd7c32092961662c000c68a406f34.png"><br><br>  Der zweite Bot ist im Wesentlichen eine Schnittstelle f√ºr Support-Mitarbeiter.  Bots arbeiten zusammen, aber ihre Basen und Schnittstellen sind getrennt. <br><br>  Anhand ihres Beispiels werden wir zeigen, wie die Struktur eines solchen Systems aussehen k√∂nnte.  In einfachen F√§llen beginnen wir jedoch, diesen Ball allm√§hlich aufzudrehen. <br><br><h2>  Die Struktur des einfachsten Bots </h2><br>  In der Basisversion besteht der Bot nur aus einem Dienst, der Nachrichten √ºber die API des von uns ben√∂tigten Messenger (Plattform) sendet und empf√§ngt, zum Beispiel Telegramm. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b9/32d/feb/6b932dfeb2de5dcf4ad8ab9eff1e8ed7.jpg"><br><br>  Wenn wir √ºber mehrere Messenger verf√ºgen, √ºber die wir mit Benutzern kommunizieren m√∂chten, ist es sinnvoll, die Logik plattformunabh√§ngig zu schreiben und der Struktur Konnektoren hinzuzuf√ºgen, die Befehle und Daten aus dem internen Format in das Format der entsprechenden Plattform (Messenger) √ºbersetzen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0fb/b42/a94/0fbb42a94bdb79a9a6340a233da4d182.jpg"><br><br>  Auf diese Weise k√∂nnen neue Funktionen an einem Ort hinzugef√ºgt und nicht f√ºr jede Plattform einzeln dupliziert werden. <br><br>  Connectors sind Dienste, die Nachrichten von der Plattform zur Weiterleitung an den Kernel und umgekehrt empfangen.  Im Allgemeinen handelt es sich dabei um relativ unabh√§ngige Komponenten des Systems, die sich bei Bedarf auf einem separaten Server befinden k√∂nnen, √ºber mehrere Replikate verf√ºgen usw. <br><br><h2>  Wir organisieren die Kommunikation der Konnektoren und des Kernels (Abfragen der Datenbank oder wie man es nicht macht) </h2><br>  Wir stehen also vor der Aufgabe, den Datenaustausch zwischen den Anschl√ºssen und dem Kern zu organisieren.  Die erste Option ist das Senden neuer Nachrichten √ºber die Datenbank.  Wir haben damit angefangen.  Dementsprechend erscheint die Datenbank selbst in unserem Schema und die Struktur sieht folgenderma√üen aus: ein in Python geschriebener Kernel plus eine Basis auf MongoDB (die Gr√ºnde f√ºr diese Wahl sind ausschlie√ülich historisch) plus Konnektoren. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff8/f88/26b/ff8f8826bf59caba92e72833dc5f906d.jpg"><br><br>  Dieses Schema hat bei uns relativ lange nicht funktioniert.  Wenn die Anzahl der Nachrichten 700.000 √ºberschritt und die H√§ufigkeit von Spitzen 120 Treffer pro Sekunde erreichte, wurden die Indizes schwerer, und das Abfragen der Datenbank wurde erheblich teurer.  Ich musste den RabbitMQ-Broker hier verbinden.  Seine Hauptaufgabe besteht darin, Benachrichtigungen zu generieren, dass eine Komponente (Core / Connector) eine Nachricht mit einer bestimmten Kennung verarbeiten soll.  Diese IDs werden dadurch √ºbertragen.  RabbitMQ hat uns die Basis und die Komponenten entladen, die nun nicht mehr st√§ndig die Datenbank auf neue Informationen zur Verarbeitung √ºberpr√ºfen m√ºssen. <br><br>  Als Ergebnis begann unsere Grundstruktur so auszusehen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a7/695/62a/7a769562a0b89f50d99616632e1c8ccd.jpg"><br><br>  Die Arbeit der Konnektoren durch die Datenbank hat ein Minus - dies verringert ihre Unabh√§ngigkeit und erh√∂ht die Konnektivit√§t des Systems.  Wenn die Daten jedoch direkt mit dem Warteschlangenmanager √ºbertragen werden, liegt die Verantwortung f√ºr deren Sicherheit und Verf√ºgbarkeit bei diesem Broker.  Wie dies den Anforderungen an Zuverl√§ssigkeit und Transparenz gerecht wird, ist eine offene Frage.  Wir haben uns entschieden, damit im Zuge der Weiterentwicklung des Systems zu experimentieren. <br><br><h2>  Admins hinzuf√ºgen </h2><br>  Um die gesamte K√ºche zu verwalten, ben√∂tigen Sie eine Administratoroberfl√§che.  Mit ihrer Hilfe finden wir die notwendigen Informationen in Korrespondenz, bearbeiten Daten, f√ºhren Umfragen und Newsletter durch.  Daher erscheint die Webkomponente in unserem Diagramm.  Dar√ºber hinaus bietet es eine Weboberfl√§che zur Authentifizierung von Benutzern und Bot-APIs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c21/ca8/4c7/c21ca84c7e703b4706eb2c666723f2be.jpg"><br><br>  Das Web kommuniziert mit der Datenbank und dem Kernel √ºber spezielle Systemnachrichten.  Sie werden als Text weitergeleitet und enthalten nur Informationen, nicht √ºber eine neue Nachricht des Benutzers, sondern √ºber ein anderes Ereignis im Gesamtsystem, auf das der Kernel reagieren soll.  Zum Beispiel, um Autorisierungscodes zu erhalten. <br><br>  Die Oberfl√§che selbst f√ºr Administratoren sieht folgenderma√üen aus: <br><br><img src="https://habrastorage.org/webt/ab/dg/eu/abdgeuefuhcdx08qei5etip13tg.png"><br><br><h2>  Wir verbinden die Betreiber √ºber den zweiten Bot </h2><br>  Um die vollst√§ndige Benutzerunterst√ºtzung zu implementieren, haben wir Bediener an das System angeschlossen.  Um die Kommunikationsgeschwindigkeit mit ihnen aufrechtzuerhalten, wurde Telegramm als Hauptdialogschnittstelle gew√§hlt, da keine geeigneten Alternativen vorhanden waren.  Bediener erhalten Benutzerfragen und senden sofort Antworten. <br><br>  So sieht der Benutzerdialog mit dem Haupt-Bot aus, wenn eine Support-Frage gesendet wird: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/437/c76/319/437c76319b11f78d408a6a520dc79e50.png"><br>  <i>Der Ausdruck ‚ÄûTestfrage‚Äú im Screenshot ist der Text der Frage f√ºr den technischen Support</i> <br><br>  Infolgedessen erscheint ein zweiter Bot (Support Bot) auf unserer Schaltung mit seinem Kern und dem Telegrammanschluss.  Er kommuniziert mit dem Hauptkern und organisiert den Transfer von Fragen und Antworten zwischen Chats mit Benutzern und Chats, in denen Support-Mitarbeiter sitzen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/600/b06/067/600b06067aa9621e2db73e6e67f18c8f.jpg"><br><br>  Es hat auch eine eigene Datenbank.  Die Kommunikation mit dem Endbenutzer erfolgt jedoch √ºber den Kern des Hauptbots, der den gesamten Nachrichtenfluss steuert. <br><br>  So sieht der Dialog des Bedieners mit einem Support-Bot aus, der Anwendernachrichten umleitet: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ee2/e02/7c8/ee2e027c85f298b85bbd8dd7db7ce03e.png"><br><br>  In unserem Fall werden die Bediener in zwei Kategorien unterteilt: diejenigen, die sich mit der allgemeinen Benutzerunterst√ºtzung befassen, und diejenigen, die f√ºr die Unterst√ºtzung einzelner Siedepunkte oder Ereignisse verantwortlich sind.  Dies hat jedoch keinen Einfluss auf die Struktur. <br><br><h2>  Was kann unser Bot noch? </h2><br>  Diese Informationen beziehen sich nur auf unsere Praxis, sind jedoch m√∂glicherweise als Auswahl einfacher Ideen interessant, die Sie zur Kenntnis nehmen k√∂nnen. <br><br>  <b>Kontakt austauschen</b> <br><br>  Dies erfolgt durch Scannen und Erkennen pers√∂nlicher QR-Codes vom Bot.  Dazu wird der Standard-Image-Prozessor zum Kernel hinzugef√ºgt.  Bilder werden von Konnektoren gesendet, die sie zusammen mit der Nachricht in der Datenbank speichern. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/81e/216/215/81e2162150acfbf9105dca2214892908.png"><br><br>  Die QR-Code-Erkennung wird auch verwendet, um dem Benutzer zus√§tzliche Informationen oder Dateien aus Seminaren bereitzustellen.  Es sieht so aus: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/447/d17/335/447d1733523bfc028f8430e6ae49fa7b.png"><br><br>  <b>Benachrichtigungsmailing</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dee/418/73f/dee41873fcf54e36d836c152338993f3.png"><br><br>  √úber das Kontrollfeld im Webmodul k√∂nnen wir Benachrichtigungen an Teilnehmer verschiedener Veranstaltungen senden. <br><br>  <b>Umfragen durchf√ºhren</b> <br><br>  Ebenso werden Umfragen in Vorlesungen durchgef√ºhrt.  F√ºr sie erstellen wir jedoch immer noch manuell eine JSON-Datei mit Logik, die wir in das Web hochladen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/076/e03/b29/076e03b29bfffd964150bf3d3aba1ee4.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3e9/028/1b0/3e90281b079611826bb6e658cfb2e920.png"><br><br>  Fragen k√∂nnen sowohl mit Antworten als auch offen sein.  Und die Struktur der Umfrage kann je nach den Antworten variieren. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/460/da4/2b9/460da42b9a8e1ac8d49e375fb79617d2.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d2/391/a08/9d2391a088ce4ca184b37afdbec2e2e7.png"><br><br>  <b>Automatische Antworten</b> <br><br>  Der Bot kann selbstst√§ndig Antworten auf h√§ufig gestellte Fragen ausw√§hlen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f4e/4fd/23e/f4e4fd23ec3da8829fbe15c3445588c6.png"><br><br>  Zu diesem Zweck verf√ºgen wir √ºber eine spezielle Basis, die manuell nachgef√ºllt wird.  Wenn dort nichts Passendes gefunden wurde oder der Benutzer mit der gew√§hlten Antwort nicht zufrieden war, wird sein Aufruf √ºber den Support-Bot an die Betreiber weitergeleitet. <br><br>  Im Allgemeinen ist dies zwar unsere gesamte Geschichte.  Im Moment arbeiten wir an der Erweiterung der Netzwerkfunktionen und erwarten, dass unser Bot in naher Zukunft ein wenig ‚Äûfetter‚Äú wird, w√§hrend seine Struktur gleich bleibt. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de479562/">https://habr.com/ru/post/de479562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de479542/index.html">Wie schreibe ich meinen eigenen √úbersetzer?</a></li>
<li><a href="../de479548/index.html">Der Weg vom Praktikum zum Auftritt bei HighLoad 2019</a></li>
<li><a href="../de479550/index.html">MVC in Einheit mit skriptf√§higen Objekten. Teil 3</a></li>
<li><a href="../de479552/index.html">DevOps-Ingenieure gibt es nicht. Wer existiert dann und was ist dagegen zu tun?</a></li>
<li><a href="../de479554/index.html">Gegen alle: In-App-Sprachassistenten</a></li>
<li><a href="../de479564/index.html">ClickHouse + Graphite: So reduzieren Sie den Speicherplatzbedarf erheblich</a></li>
<li><a href="../de479566/index.html">Unterdr√ºckungssystem oder Reverse Engineering der Matrix + Nachweis der Simultanzeit</a></li>
<li><a href="../de479568/index.html">Ich arbeite als Programmierer in einer Firma, aber ich m√∂chte meine 50 Jahre anders kennenlernen</a></li>
<li><a href="../de479570/index.html">Python-Einstiegspunkte</a></li>
<li><a href="../de479572/index.html">Wie Netflix Microservices mit Pub-Sub-Daten umgehen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>