<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí™üèø üò∏ üö¥üèº "Classe-campos-proposta" ou "O que deu errado no commit do tc39" ‚ô¶Ô∏è ü§õüèæ üì¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Todos n√≥s, h√° muito tempo, queremos um encapsulamento normal em JS, que pode ser usado sem gestos desnecess√°rios. Tamb√©m queremos constru√ß√µes convenie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Classe-campos-proposta" ou "O que deu errado no commit do tc39"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428119/"><p>  Todos n√≥s, h√° muito tempo, queremos um encapsulamento normal em JS, que pode ser usado sem gestos desnecess√°rios.  Tamb√©m queremos constru√ß√µes convenientes para declarar propriedades de classe.  E, finalmente, queremos que todos esses recursos no idioma apare√ßam de forma a n√£o quebrar os aplicativos existentes. </p><br><p> Parece que aqui est√° a felicidade: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">proposta de campos de classe</a> que, ap√≥s muitos anos de tormento do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">comit√™ tc39,</a> ainda chegou ao <code>stage 3</code> e chegou a ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">implementada no chrome</a> . </p><br><p>  Honestamente, eu realmente gostaria de escrever um artigo sobre por que voc√™ deve usar o novo recurso de idioma e como faz√™-lo, mas, infelizmente, o artigo n√£o ser√° sobre isso. </p><a name="habracut"></a><br><h1 id="opisanie-tekuschego-propozala">  Descri√ß√£o da falta atual </h1><br><p>  N√£o repetirei a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descri√ß√£o original</a> , as <a href="">perguntas frequentes</a> e as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">altera√ß√µes nas especifica√ß√µes aqui</a> , mas apenas descreverei brevemente os pontos principais. </p><br><h2 id="polya-klassa">  Campos de classe </h2><br><p>  Declarando campos e usando-os dentro de uma classe: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ x = <span class="hljs-number"><span class="hljs-number">1</span></span>; method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  Acesso a campos fora da classe: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> A(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(ax);</code> </pre> <br><p>  Tudo parecia √≥bvio e, por muitos anos, usamos essa sintaxe usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Babel</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">TypeScript</a> . </p><br><p>  S√≥ h√° uma nuance.  Essa nova sintaxe usa <code>[[Define]]</code> , e n√£o <code>[[Set]]</code> sem√¢ntica com a qual vivemos todo esse tempo. </p><br><p>  Na pr√°tica, isso significa que o c√≥digo acima <strong>n√£o</strong> √© <strong>igual a</strong> isso: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = <span class="hljs-number"><span class="hljs-number">1</span></span>; } method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  Mas, na verdade, √© <strong>equivalente</strong> a isso: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"x"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">writable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }); } method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  E, embora, para o exemplo acima, ambas as abordagens fa√ßam essencialmente a mesma coisa, essa √© uma diferen√ßa <strong>MUITO S√âRIA</strong> e aqui est√° o porqu√™: </p><br><p>  Digamos que temos uma classe pai como esta: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ x = <span class="hljs-number"><span class="hljs-number">1</span></span>; method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  Com base nisso, criamos outro: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ x = <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><p>  E eles usaram: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> B(); b.method(); <span class="hljs-comment"><span class="hljs-comment">//   2  </span></span></code> </pre> <br><p>  Ent√£o, por algum motivo, a classe <code>A</code> foi alterada de uma maneira aparentemente compat√≠vel com vers√µes anteriores: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ _x = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,   ,        get x() { return this._x; }; set x(val) { return this._x = val; }; method() { console.log(this._x); } }</span></span></code> </pre> <br><p>  E para a sem√¢ntica <code>[[Set]]</code> , essa √© realmente uma altera√ß√£o compat√≠vel com vers√µes anteriores, mas n√£o para <code>[[Define]]</code> .  Agora a chamada para <code>b.method()</code> ser√° <code>b.method()</code> no console <code>1</code> vez de <code>2</code> .  E isso acontecer√° porque <code>Object.defineProperty</code> redefine o descritor de propriedades e, consequentemente, getter / setter da classe <code>A</code> n√£o ser√° chamado.  De fato, na classe filho, <em>ocultamos a</em> propriedade <code>x</code> do pai, semelhante √† maneira como podemos fazer isso no escopo lexical: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = <span class="hljs-number"><span class="hljs-number">1</span></span>; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><p>  √â verdade que, neste caso, o ponteiro com suas regras <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>no-shadow</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>no-shadowed-variable</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>no-shadow</code></a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>no-shadow</code></a> nos salvar√°, mas a probabilidade de algu√©m criar um <code>no-shadowed-class-field</code> tende a zero. </p><br><blockquote>  A prop√≥sito, serei grato pelo termo russo mais bem-sucedido de <code>shadowed</code> . </blockquote><p>  Apesar de tudo isso, n√£o sou um oponente inaceit√°vel da nova sem√¢ntica (embora prefira outra), porque ela tem seus pr√≥prios aspectos positivos.  Infelizmente, essas vantagens n√£o superam as menos importantes - usamos a sem√¢ntica <code>[[Set]]</code> h√° muitos anos, porque √© usada no <code>babel6</code> e no <code>TypeScript</code> por padr√£o. </p><br><blockquote>  √â verdade que vale a pena notar que no <code>babel7</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">valor padr√£o foi alterado</a> . </blockquote><p>  Discuss√µes mais originais sobre esse t√≥pico podem ser lidas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><h2 id="privatnye-polya">  Campos privados </h2><br><p>  E agora vamos passar para a parte mais controversa deste.  T√£o controverso que: </p><br><ol><li>  apesar de j√° estar implementado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Chrome Canary</a> e de os campos p√∫blicos j√° estarem ativados por padr√£o, os campos privados ainda est√£o atr√°s da bandeira; </li><li>  apesar do processo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">inicial de campos particulares ter</a> sido mesclado com o atual, ainda est√£o sendo criados pedidos para a separa√ß√£o desses dois recursos (por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dois</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tr√™s</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">quatro</a> ); </li><li>  at√© alguns membros do comit√™ (como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Allen Wirfs-Brock</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kevin Smith</a> ) se manifestam e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">oferecem alternativas</a> , apesar do <strong>est√°gio3</strong> ; </li><li>  isso perdeu um recorde de n√∫mero de edi√ß√µes - <strong>129</strong> no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio atual</a> + <strong>96</strong> no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">original</a> , contra <strong>126</strong> no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BigInt</a> , e o detentor do registro tem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">coment√°rios negativos</a> ; </li><li>  Eu tive que criar um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">segmento separado</a> com uma tentativa de resumir de alguma forma todas as reivindica√ß√µes contra ele; </li><li>  Eu tive que escrever uma <a href="">FAQ separada</a> que cubra esta parte <br><blockquote>  no entanto, devido a uma argumenta√ß√£o bastante fraca, essas discuss√µes apareceram ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dois</a> ) <br></blockquote></li><li>  Pessoalmente, passei todo o meu tempo livre (e √†s vezes trabalhando) por um longo per√≠odo de tempo para descobrir tudo e at√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">encontrar uma explica√ß√£o de</a> por que ele era assim ou oferecer uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">alternativa adequada</a> ; </li><li>  no final, decidi escrever este artigo de revis√£o. </li></ol><br><p>  Os campos particulares s√£o declarados da seguinte maneira: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ #priv; }</code> </pre> <br><p>  E o acesso a eles √© o seguinte: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ #priv = <span class="hljs-number"><span class="hljs-number">1</span></span>; method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.#priv); } }</code> </pre> <br><p>  Nem vou levantar o t√≥pico de que o modelo mental por tr√°s disso n√£o √© muito intuitivo ( <code>this.#priv !== this['#priv']</code> ), n√£o usa as palavras <code>private</code> / <code>protected</code> j√° reservadas (o que necessariamente causar√° dor adicional para desenvolvedores de TypeScript), n√£o est√° claro como estend√™-lo para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">outros modificadores de acesso</a> , e a sintaxe em si n√£o √© muito bonita.  Embora tudo isso tenha sido a raz√£o original que me levou a um estudo mais profundo e √† participa√ß√£o nas discuss√µes. </p><br><p>  Tudo isso se refere √† sintaxe, onde as prefer√™ncias est√©ticas subjetivas s√£o muito fortes.  E algu√©m poderia viver com isso e se acostumar com o tempo.  Se n√£o fosse por uma coisa: h√° um problema muito significativo de sem√¢ntica ... </p><br><h3 id="cemantika-weakmap">  Sem√¢ntica <code>WeakMap</code> </h3><br><p>  Vamos dar uma olhada no que est√° por tr√°s da proposta existente.  Podemos reescrever o exemplo acima com encapsulamento e sem usar a nova sintaxe, mas preservando a sem√¢ntica da atual: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> privatesForA = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>(); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { privatesForA.set(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, {}); privatesForA.get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).priv = <span class="hljs-number"><span class="hljs-number">1</span></span>; } method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(privatesForA.get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).priv); } }</code> </pre> <br><blockquote>  A prop√≥sito, com base nessa sem√¢ntica, um dos membros do comit√™ construiu uma pequena <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">biblioteca de utilit√°rios</a> que permite o uso do estado privado agora, para mostrar que essa funcionalidade √© superestimada pelo comit√™.  O c√≥digo formatado leva apenas 27 linhas. </blockquote><p>  Em geral, tudo √© muito bom, temos <code>hard-private</code> , que n√£o podem ser obtidos / interceptados / rastreados de c√≥digo externo de nenhuma maneira e, ao mesmo tempo, podemos acessar os campos privados de outra inst√¢ncia da mesma classe, por exemplo: </p><br><pre> <code class="javascript hljs">isEquals(obj) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> privatesForA.get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).id === privatesForA.get(obj).id; }</code> </pre> <br><p>  Bem, isso √© muito conveniente, exceto pelo fato de que essa sem√¢ntica, al√©m do pr√≥prio encapsulamento, tamb√©m inclui <code>brand-checking</code> (voc√™ n√£o pode pesquisar no Google o que √© - √© improv√°vel que encontre informa√ß√µes relevantes). <br>  <code>brand-checking</code> √© o oposto de <code>duck-typing</code> de <code>duck-typing</code> , no sentido de que n√£o verifica a interface p√∫blica do objeto, mas o fato de o objeto ter sido constru√≠do usando c√≥digo confi√°vel. <br>  Essa verifica√ß√£o, de fato, tem um certo escopo - est√° principalmente associada √† seguran√ßa de chamar c√≥digo n√£o confi√°vel em um √∫nico espa√ßo de endere√ßo com um confi√°vel e a capacidade de trocar objetos diretamente sem serializa√ß√£o. </p><br><blockquote>  Embora alguns engenheiros considerem isso uma parte necess√°ria do encapsulamento adequado. </blockquote><p>  Apesar de ser uma oportunidade bastante curiosa, que est√° intimamente relacionada ao padr√£o <code></code> (descri√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">curta</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mais longa</a> ), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>Realms</code> propaganda</a> e trabalho cient√≠fico no campo da Ci√™ncia da Computa√ß√£o, no qual <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mark Samuel Miller est√°</a> envolvido (ele tamb√©m √© membro do comit√™), na minha experi√™ncia , na pr√°tica da maioria dos desenvolvedores, isso quase nunca ocorre. </p><br><blockquote>  Ali√°s, ainda me deparei com uma membrana (embora n√£o soubesse o que era na √©poca) quando reescrevi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vm2 para</a> atender √†s minhas necessidades. </blockquote><br><h3 id="problema-brand-checking">  Problema de <code>brand-checking</code> </h3><br><p>  Como mencionado anteriormente, <code>brand-checking</code> √© o oposto da <code>duck-typing</code> de <code>duck-typing</code> .  Na pr√°tica, isso significa que ter este c√≥digo: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> brands = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>(); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { brands.set(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, {}); } method() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } brandCheckedMethod() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!brands.has(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">'Brand-check failed'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.method()); } }</code> </pre> <br><p>  <code>brandCheckedMethod</code> s√≥ pode ser chamado com uma inst√¢ncia da classe <code>A</code> e <code>A</code> mesmo que o destino seja um objeto que preserve os invariantes dessa classe, esse m√©todo lan√ßar√° uma exce√ß√£o: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> duckTypedObj = { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: A.prototype.method.bind(duckTypedObj), <span class="hljs-attr"><span class="hljs-attr">brandCheckedMethod</span></span>: A.prototype.brandCheckedMethod.bind(duckTypedObj), }; duckTypedObj.method(); <span class="hljs-comment"><span class="hljs-comment">//        1 duckTypedObj.brandCheckedMethod(); //     </span></span></code> </pre> <br><p>  Obviamente, este exemplo √© bastante sint√©tico e o uso de <code>duckTypedObj</code> como esse <code>duckTypedObj</code> duvidoso, at√© pensarmos em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>Proxy</code></a> . <br>  Um dos cen√°rios de uso de proxy muito importantes √© a metaprograma√ß√£o.  Para que o proxy fa√ßa todo o trabalho √∫til necess√°rio, os m√©todos dos objetos quebrados usando um proxy devem ser executados no contexto do proxy, e n√£o no contexto do destino, ou seja: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> A(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> proxy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>(a, { get(target, p, receiver) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> property = <span class="hljs-built_in"><span class="hljs-built_in">Reflect</span></span>.get(target, p, receiver); doSomethingUseful(<span class="hljs-string"><span class="hljs-string">'get'</span></span>, retval, target, p, receiver); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> property === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) ? property.bind(proxy) : property; } });</code> </pre> <br><p>  Chame <code>proxy.method();</code>  far√° um trabalho √∫til declarado no proxy e retornar√° <code>1</code> , enquanto chama <code>proxy.brandCheckedMethod();</code>  em vez de fazer um trabalho √∫til duas vezes a partir do proxy, lan√ßar√° uma exce√ß√£o, porque <code>a !== proxy</code> , que significa que <code>brand-check</code> n√£o passou. </p><br><p>  Sim, podemos executar m√©todos / fun√ß√µes no contexto de um destino real, n√£o um proxy, e para alguns cen√°rios isso √© suficiente (por exemplo, para implementar o padr√£o <code></code> ), mas n√£o √© suficiente para todos os casos (por exemplo, para implementar propriedades reativas: o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MobX 5</a> j√° usa um proxy para isso, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vue.js</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aurelia est√£o</a> testando essa abordagem em vers√µes futuras). </p><br><p>  Em geral, desde que <code>brand-check</code> precise ser feita explicitamente, isso n√£o √© um problema - o desenvolvedor precisa conscientemente decidir qual trade-off ele faz e se precisa, al√©m disso, no caso de uma verifica√ß√£o expl√≠cita da <code>brand-check</code> voc√™ pode implement√°-la de tal maneira que o erro n√£o seria gerado em proxies confi√°veis. </p><br><p>  Infelizmente, o atual nos privou dessa flexibilidade: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ #priv; method() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.#priv; <span class="hljs-comment"><span class="hljs-comment">//    brand-check   } }</span></span></code> </pre> <br><p>  Esse <code>method</code> sempre lan√ßar√° uma exce√ß√£o se n√£o for chamado no contexto de um objeto constru√≠do usando o construtor <code>A</code>  E a pior parte √© que <code>brand-check</code> est√° impl√≠cita aqui e √© misturada com outra funcionalidade - encapsulamento. </p><br><p>  Embora o <code></code> quase necess√°rio para qualquer c√≥digo, <code>brand-check</code> tem um escopo bastante restrito.  E combin√°-los em uma sintaxe levar√° ao fato de que muitas <code>brand-check</code> n√£o intencionais da <code>brand-check</code> aparecem no c√≥digo do usu√°rio, quando o desenvolvedor pretendia apenas ocultar os detalhes da implementa√ß√£o. <br>  E o slogan usado para promover isso foi <code># is the new _</code> apenas exacerbando a situa√ß√£o. </p><br><blockquote>  Voc√™ tamb√©m pode ler uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">discuss√£o detalhada de como um prozal existente quebra um proxy</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um dos desenvolvedores</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">autores</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do Aurelia,</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vue.js, falou na discuss√£o</a> . <br><br>  Al√©m disso, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">meu coment√°rio</a> , que descreve com mais detalhes a diferen√ßa entre diferentes cen√°rios de proxy, pode parecer interessante para algu√©m.  Como um todo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">toda a discuss√£o sobre a conex√£o de campos e membranas particulares</a> . </blockquote><br><h1 id="alternativy">  Alternativas </h1><br><p>  Todas essas discuss√µes fariam pouco sentido se n√£o houvesse alternativas.  Infelizmente, nem uma √∫nica alternativa chegou ao <strong>est√°gio1</strong> e, como resultado, nem sequer teve a chance de ser elaborada o suficiente.  No entanto, listarei aqui alternativas que de alguma forma resolvem os problemas descritos acima. </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>Symbol.private</strong></a> - um prozazil alternativo, um dos membros do comit√™. <br><ol><li>  Resolve todos os problemas acima (embora possa ter seus pr√≥prios, mas, devido √† falta de trabalho ativo, √© dif√≠cil encontr√°-los) </li><li>  foi novamente revertida na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√∫ltima reuni√£o do comit√™</a> devido √† falta de uma <code>brand-check</code> integrada, problemas com o padr√£o de membrana (embora <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">isso</a> + <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">isso</a> ofere√ßa uma solu√ß√£o adequada) e a falta de sintaxe conveniente </li><li>  sintaxe conveniente pode ser constru√≠da sobre a real, como mostrei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> </li></ol></li><li>  <a href=""><strong>Classes 1.1</strong></a> - posozal anterior do mesmo autor </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>Usando <em>private</em> como um objeto</strong></a> </li></ol><br><h1 id="vmesto-zaklyucheniya">  Em vez de uma conclus√£o </h1><br><p>  Pelo tom do artigo, pode parecer que eu condeno o comit√™ - n√£o √© assim.  Parece-me apenas que, ao longo dos anos (dependendo de qual √© o ponto de partida, pode at√© levar d√©cadas) que o comit√™ trabalhou no encapsulamento em JS, muitas coisas na ind√∫stria mudaram e a apar√™ncia pode ficar emba√ßada, o que levou a um falso ranking de prioridades . </p><br><p>  Al√©m disso, n√≥s, como comunidade, <strong>pressionamos o tc39</strong> for√ßando-o a liberar recursos mais rapidamente, enquanto damos muito pouco feedback nos est√°gios iniciais do prozos, diminuindo nossa indigna√ß√£o apenas no momento em que pouco pode ser alterado. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Acredita-se</a> que, neste caso, o processo simplesmente falhou. </p><br><p>  Depois de mergulhar na minha cabe√ßa e conversar com alguns representantes, decidi que faria o poss√≠vel para evitar a recorr√™ncia de uma situa√ß√£o semelhante - mas posso fazer um pouco (escreva um artigo de revis√£o, fa√ßa a implementa√ß√£o do <code>stage1</code> faltando em <code>babel</code> e isso √© tudo). </p><br><p>  Mas o mais importante √© o feedback - por isso, pe√ßo que voc√™ participe dessa pequena pesquisa.  E eu, por sua vez, tentarei transmiti-lo ao comit√™. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt428119/">https://habr.com/ru/post/pt428119/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt428109/index.html">Parede corporativa</a></li>
<li><a href="../pt428111/index.html">Aritm√©tica da precis√£o arbitr√°ria em Erlang</a></li>
<li><a href="../pt428113/index.html">Para a quest√£o das curvas de Bezier, velocidade do Arduino e um site interessante, ou como passei o fim de semana</a></li>
<li><a href="../pt428115/index.html">Desenvolvimento web para com√©rcio eletr√¥nico: 5 tend√™ncias tecnol√≥gicas para 2019</a></li>
<li><a href="../pt428117/index.html">Processadores tensores gratuitos do Google na Nuvem Colaborativa</a></li>
<li><a href="../pt428121/index.html">Stan Drapkin. Armadilhas de criptografia de alto n√≠vel no .NET</a></li>
<li><a href="../pt428123/index.html">Semana 41 da Seguran√ßa: Boas Novas</a></li>
<li><a href="../pt428125/index.html">Quem s√£o as an√°lises de produtos e por que elas s√£o necess√°rias em uma equipe?</a></li>
<li><a href="../pt428127/index.html">Nginx cache: tudo novo - bem esquecido</a></li>
<li><a href="../pt428129/index.html">L√≥gica fuzzy simples colada ‚Äúdo que era‚Äù para um motor de turbina a g√°s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>