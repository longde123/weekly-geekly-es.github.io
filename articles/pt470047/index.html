<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õëÔ∏è üòÑ ü§üüèæ Olhei para tr√°s para ver se ela olhou para tr√°s - 2 ou para o meu pr√≥prio data center via AWS ‚úåüèº üôèüèæ ‚úåüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Publicamos quaisquer servi√ßos localizados no hypervisor dom√©stico por meio do servi√ßo EC2 Amazon Web Services por meio de uma inst√¢ncia gratuita do Am...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Olhei para tr√°s para ver se ela olhou para tr√°s - 2 ou para o meu pr√≥prio data center via AWS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470047/"><img src="https://habrastorage.org/webt/hb/3k/nj/hb3knjstg1kmyhx0g_bzk-r5jiu.jpeg" alt="imagem"><br><br>  Publicamos quaisquer servi√ßos localizados no hypervisor dom√©stico por meio do servi√ßo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">EC2 Amazon Web Services por</a> meio de uma inst√¢ncia gratuita do Amazon Linux AMI 2018 usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">libreswan</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">xl2tpd</a> e com um pouco de distor√ß√£o ... <br><a name="habracut"></a><br>  Os administradores de sistema de uma empresa tradicional (que n√£o √© de TI) com experi√™ncia, geralmente depois de um tempo, t√™m seu pr√≥prio farm de virtualiza√ß√£o de servidores em casa para testar o monte de solu√ß√µes no local.  Isso pode ser uma imita√ß√£o banal de uma rede distribu√≠da de filial de escrit√≥rio, testando uma infraestrutura integrada de alta disponibilidade, implanta√ß√£o de novas vers√µes de algumas solu√ß√µes, etc. <br><br>  Externamente, ele pode olhar de um PC dom√©stico simples com bomba de mem√≥ria com um hipervisor integrado e um NAS de n√≠vel consumidor como armazenamento iSCSI (ou na forma de uma m√°quina virtual simples no mesmo PC) a servidores de montagem em rack de unidade pequena de pleno direito adquiridos por unidades de controle baixadas de forma mais barata com uma linhagem dos datacenters ocidentais, com o mesmo BU tsiska para conectividade de rede e preso no Fibre Channel da mesma forma, comprado no NAS do mercado secund√°rio, mas j√° em classe executiva. <br><br>  Obviamente, em nossa era da mania de nuvens, toda a infraestrutura pode ser facilmente implantada em data centers em nuvem, mas isso nem sempre √© poss√≠vel, principalmente por causa do custo.  N√£o importa se os testes exigem v√°rias m√°quinas virtuais leves a partir dos planos dispon√≠veis, mas e se voc√™ estiver de servi√ßo, voc√™ precisar√° alterar v√°rias d√∫zias ou at√© centenas de "m√°quinas virtuais" separadas com uma ampla variedade de servi√ßos e tamb√©m desejar ter um arquivo para que voc√™ possa obt√™-lo a qualquer momento houve uma amostra que girou nas configura√ß√µes / defini√ß√µes de um ano atr√°s.  Ou √© necess√°rio transferir todas as armadilhas com a mesma sincroniza√ß√£o entre o ADDS e o ADFS antes de transferir alguns dos servi√ßos comerciais existentes para o mesmo MS Azure. <br><br>  O principal problema nesse caso √© a publica√ß√£o (encaminhamento) de toda essa infraestrutura para o exterior, para que voc√™ possa praticar a conex√£o de usu√°rios externos ao "site do servidor" dom√©stico ou aos seus pr√≥prios servi√ßos "em nuvem" ou integra√ß√£o com servi√ßos de terceiros etc. <br><br>  √â bom que a conex√£o dom√©stica seja projetada para uma tarifa comercial; nesse caso, n√£o h√° problemas com as solicita√ß√µes recebidas e o endere√ßo IP √© quase sempre "branco", est√°tico. <br><br>  Mas o que fazer quando o provedor "dom√©stico" usual estiver presente no local de resid√™ncia, que al√©m disso s√≥ pode fornecer um endere√ßo da rede Privada.  Ou fornecer√° um endere√ßo branco, mas tradicionalmente cortar√° todas as entradas do intervalo de portas privilegiadas (&lt;1024)?  Ou voc√™ √© um estudante pobre e brega e simplesmente n√£o pode pagar uma taxa mensal criada para pessoas jur√≠dicas.  Ou voc√™ geralmente precisa mudar de local de resid√™ncia, arrastando os "pertences" do servidor virtual para a corcunda?  Um caso especial tamb√©m √© relevante para aqueles que vivem fora do CIS, quando o provedor for√ßosamente fornece seu pr√≥prio equipamento para conectar-se √† Internet e simplesmente n√£o √© poss√≠vel configurar fisicamente o encaminhamento das portas necess√°rias para o farm virtual dom√©stico externo. <br><br>  Uma solu√ß√£o √© usar qualquer um dos servi√ßos VPN de terceiros.  Infelizmente, poucos deles permitem a permiss√£o de conex√µes de entrada em rela√ß√£o ao t√∫nel, na maioria das vezes √© um servi√ßo pago separado.  Al√©m disso, nesse caso, a escolha de endere√ßos IP externos ser√° muito limitada se voc√™ quiser testar a situa√ß√£o com a presen√ßa de um endere√ßo IP externo em um pa√≠s espec√≠fico. Al√©m disso, como regra geral, n√£o h√° garantia de que ao mesmo tempo v√°rios outros clientes de servi√ßos VPN n√£o estejam presos nesse endere√ßo. , ou permanecer√° est√°tico por um longo tempo, o que √© importante para configurar registros de subdom√≠nio de servi√ßo no DNS. <br><br>  Tamb√©m digno de nota (IMHO), apesar de alguns m√©todos pervertidos, √© implantar seu pr√≥prio roteador "virtual" em alguma plataforma de nuvem externa com a capacidade de configurar um t√∫nel VPN do farm do hipervisor dom√©stico para esta m√°quina virtual na nuvem, com as conex√µes de entrada necess√°rias encaminhadas a partir da interface de rede externa nuvens para servi√ßos de hypervisor dom√©stico.  E, idealmente, pagar quase nada pela coisa toda. <br><br>  Tendo perdido recentemente meu emprego e, com ele, acesso a um farm de testes corporativo acolhedor e confort√°vel, mas em troca recebi muito tempo livre para atualizar minhas habilidades, decidi dar aos servi√ßos do hipervisor dom√©stico a oportunidade de ver as conex√µes dos clientes que chegavam. <br><br>  O autor dessas linhas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚Äúama todos os tipos de pervers√µes de infraestrutura‚Äù</a> , portanto, como roteador virtual, usaremos a inst√¢ncia gratuita do Amazon Web Services (AWS) EC2 t2.micro para Linux, que em vez de AWS: VPC (em teoria) dar√° um pouco mais de flexibilidade na depura√ß√£o e recursos , e a topologia dessa pervers√£o da VPN √© mostrada abaixo: <br><br><img src="https://habrastorage.org/webt/xs/o5/_k/xso5_kg5gwlm9ozy9pj7udiqxuc.png" alt="imagem"><br><br>  O que vemos aqui? <br><br>  H√° uma m√°quina virtual (inst√¢ncia) gratuita (750 horas de trabalho por m√™s durante o ano), no Linux, implantada no AWS: EC2.  As chamadas recebidas de alguns usu√°rios de seus servi√ßos dom√©sticos caem no endere√ßo IPv4 branco externo do Elastic IP; em seguida, pelas regras de entrada (Entrada) nos "Grupos de Seguran√ßa", as portas que precisamos mapear para a interface de rede da inst√¢ncia; os pacotes dessas solicita√ß√µes atrav√©s de iptables passam pelo t√∫nel IPSec para uma m√°quina virtual para Windows 2016, onde, usando o roteamento, o RRAS obt√©m o servi√ßo desejado dentro do farm virtual dom√©stico.  Prestamos aten√ß√£o especial √† presen√ßa de tr√™s NATs de uma s√≥ vez: um no AWS Linux, um no roteador de ‚Äúrede do escrit√≥rio‚Äù e mais um, impl√≠cito, no roteador dom√©stico. <br><br>  Nesse (meu) caso, uma m√°quina virtual no Windows Server 2016 desempenha o papel de um roteador para simular uma rede do escrit√≥rio e sua plataforma de servidor, o MS WAP √© implantado em conjunto com uma m√°quina separada com o MS ADFS e outros, portanto, n√£o h√° problema em substitu√≠-lo por qualquer outro SO at√© uma pe√ßa caseira a gosto.  A prop√≥sito, com o Windows RRAS, as coisas ficam complicadas, ao longo do caminho, tive que lidar com v√°rios momentos desagrad√°veis ‚Äã‚Äã(sobre os quais abaixo); portanto, se voc√™ optar por n√£o gostar do MS Windows Server como roteador, ent√£o com outro sistema operacional provavelmente ser√° mais f√°cil. <br><br>  Primeiro, criaremos uma conta da AWS se voc√™ ainda n√£o tiver uma.  N√£o h√° problemas com a cria√ß√£o da pr√≥pria conta, voc√™ s√≥ precisa indicar os detalhes do seu cart√£o de pl√°stico, dos quais 1 d√≥lar ser√° debitado (e depois devolvido) como um cheque. <br><br>  Apenas dois pontos precisam ser mencionados aqui: <br><br><ol><li>  Certifique-se de acessar AWS: IAM (Gerenciamento de identidade e acesso) e habilitar o MFA (autentica√ß√£o multifator) para sua nova conta, ou melhor ainda, como recomenda a AWS - crie uma conta separada com o MFA e continue a trabalhar com a restri√ß√£o dos direitos correspondentes. ela.  Caso contr√°rio, voc√™ pode acabar em uma situa√ß√£o desagrad√°vel quando um Trojan rouba credenciais da AWS do seu PC e, por exemplo, algu√©m mina do seu cora√ß√£o √†s suas custas em planos caros de inst√¢ncia de alto desempenho ... </li><li>  Por motivos pr√°ticos, √© recomend√°vel que voc√™ configure um alerta de or√ßamento.  Isso √© feito nas configura√ß√µes da conta, o item de menu correspondente √© chamado de "Painel de gerenciamento de faturamento e custo".  No painel que √© aberto, selecione o item "Or√ßamentos" √† esquerda e configure o or√ßamento mensal planejado a seu gosto usando o assistente interno.  N√£o se esque√ßa de configurar um alerta l√°: em caso de exceder a quantidade especificada, voc√™ receber√° uma mensagem imediatamente.  Isso √© √∫til se voc√™ n√£o trabalhou com a AWS antes e tem medo de "obter" acidentalmente uma soma redonda no decorrer de suas experi√™ncias. </li></ol><br>  Em seguida, precisamos da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AWS: EC2</a> . <br><br>  Uma das etapas mais importantes √© selecionar a regi√£o da AWS (essencialmente um data center) na qual queremos implantar nossa m√°quina virtual.  O posicionamento afetar√° diretamente a localiza√ß√£o geogr√°fica do seu ‚Äúroteador virtual‚Äù e, portanto, o atraso da rede ao trabalhar com ele.  Isso √© importante porque  A AWS n√£o fornece migra√ß√£o ao vivo entre regi√µes (o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Servi√ßo de Migra√ß√£o de Servidor da AWS interno</a> pode migrar apenas algo para a pr√≥pria nuvem da AWS) e, no caso de um erro de posicionamento, √© mais f√°cil recriar uma nova inst√¢ncia novamente no local desejado.  Como alternativa, voc√™ precisar√° remover a imagem da inst√¢ncia (Imagem, EC2 embutido) no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AWS: S3</a> (servi√ßo de armazenamento) e da√≠ puxar essa imagem para a inst√¢ncia do EC2 na nova regi√£o.  No meu caso, a regi√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Frankfurt</a> foi originalmente selecionada: <br><br><img src="https://habrastorage.org/webt/8c/2s/yh/8c2syhsrly1luamcwjsvbmlnbtg.png" alt="imagem"><br><br>  Criamos uma nova inst√¢ncia, selecione a op√ß√£o <b>"Somente n√≠vel gratuito"</b> √† esquerda, o que limitar√° a lista de imagens proposta a apenas imagens gratuitas.  Eu escolhi <b>"Amazon Linux AMI 2018"</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mais</a> sobre distribui√ß√µes Linux na AWS), porque  no "Amazon Linux 2 AMI", o xl2tpd n√£o funciona corretamente devido √† natureza do kernel montado pela Amazon. <br><br>  Voc√™ pode escolher qualquer outra imagem do Linux que lhe seja familiar na lista fornecida.  Voc√™ tamb√©m pode ir mais fundo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AWS Marketplace</a> e procurar imagens alternativas no local, apenas leia atentamente os coment√°rios sobre o custo: a pr√≥pria imagem e os recursos de computa√ß√£o podem ser gratuitos, mas voc√™ ter√° que pagar mais por espa√ßo em disco etc. <br><br>  Selecionamos o tipo proposto <b>"t2.micro"</b> , ele fornece 1 vCPU, 1 GB de mem√≥ria, 8-30 GB (SSD / Magnetic) de espa√ßo em disco e 750 horas de trabalho gratuitamente todos os meses, durante um ano.  O suficiente para o nosso "roteador virtual".  Vale a pena notar que o espa√ßo livre em disco e o tempo de trabalho s√£o gastos em todas as inst√¢ncias; portanto, em caso de dificuldades financeiras, voc√™ n√£o precisa criar / execut√°-las mais do que pode, exceto de gra√ßa. <br><br>  Clique no assistente "Next ...", na terceira etapa, deixamos todos os valores padr√£o, na quarta concordamos com os 8 gigabytes de disco padr√£o SSD propostos e a inst√¢ncia come√ßa com o bot√£o Review and Launch: <br><br><img src="https://habrastorage.org/webt/ta/dv/of/tadvofw_fyn1iozzpgvxiwaswla.png"><br><br>  Depois disso, obteremos uma janela com uma mensagem sobre a cria√ß√£o de um novo par de chaves para conectar-se ao nosso via SSH e uma proposta para nomear esse par e fazer o download da chave privada no formato * .pem.  N√≥s realmente precisaremos disso no futuro, por isso √© aconselh√°vel salv√°-lo imediatamente em um local seguro.  Se esse arquivo for perdido, voc√™ perder√° a capacidade de se conectar remotamente √†s inst√¢ncias que o utilizam.  No EC2, n√£o h√° como regener√°-lo novamente para uma inst√¢ncia existente, a √∫nica maneira √© conectar o disco da inst√¢ncia a outra inst√¢ncia que tenha acesso e edi√ß√£o subsequente da chave. <br><br>  Depois de um tempo, a inst√¢ncia ser√° iniciada, ela ter√° um endere√ßo IPv4 interno (privado) e externo (p√∫blico), al√©m de dois nomes DNS correspondentes. <br>  Configure imediatamente grupos de seguran√ßa para garantir o fluxo de tr√°fego dos servi√ßos necess√°rios: <br><br><img src="https://habrastorage.org/webt/ex/rh/7y/exrh7yxlnlqsb36u5pdqifxrdb8.png"><br><br>  Necessitaremos das portas de entrada abertas 500, 1701, 4500 UDP e 4500 TCP para organizar o t√∫nel IPSec L2TP VPN, HTTP e HTTPS para publicar servi√ßos de farm dom√©stico, o acesso externo √† inst√¢ncia via SSH foi criado automaticamente ao criar a inst√¢ncia, porque  O EC2 essencialmente n√£o cont√©m nenhum acesso interno ao console da m√°quina virtual por meio de sua interface da web.  Existe apenas a capacidade de visualizar a tela: <br><br><img src="https://habrastorage.org/webt/zr/g4/uw/zrg4uw5t3_nihfjq8qaipfwxfkw.png"><br><br>  √â aconselh√°vel configurar o acesso via VPN e SSH apenas a partir do seu endere√ßo IP residencial.  A ordem das regras nos Grupos de Seguran√ßa n√£o importa. <br><br>  Como usaremos v√°rias documenta√ß√µes NAT, a AWS recomenda desativar a <b>‚ÄúVerifica√ß√£o de origem / destino da rede‚Äù</b> neste caso: <br><br><img src="https://habrastorage.org/webt/oa/6m/mg/oa6mmgeh6dyzg6sjxzdj0lkzbne.png"><br><br>  Como usaremos o encapsulamento IPSec, e n√£o o transporte, essa configura√ß√£o n√£o faz muito sentido para n√≥s, mas, por precau√ß√£o, √© melhor desativ√°-la. <br><br>  Conecte-se atrav√©s do SSH √† nossa inst√¢ncia.  Se voc√™ usar um cliente SSH gr√°fico, por exemplo, PuTTY, para se conectar, a ajuda interna na conex√£o, chamada pelo RMB na inst√¢ncia -&gt; Conectar, ajudar√° voc√™ a: <br><br><img src="https://habrastorage.org/webt/dc/tm/s1/dctms1dbkmpble2n5vojwkdq3py.png"><br><br>  O Amazon Linux mant√©m um pedigree do RHEL e do CentOS, portanto, o gerenciador de pacotes yum √© usado. <br><br>  Todas as opera√ß√µes descritas abaixo devem ser executadas com escalonamento de privil√©gios; portanto, as precedemos com sudo ou apenas trabalhamos como root. <br><br>  Primeira atualiza√ß√£o: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum update</span></span></code> </pre> <br>  Como software para organizar um servidor VPN, usaremos uma combina√ß√£o de libreswan e xl2tpd. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O LibreSwan</a> (fork do Openswan e um an√°logo do strongSwan) √© uma implementa√ß√£o popular do VPN IPSec e do IKE (Internet Key Exchange).  Ele pode ignorar corretamente v√°rios tipos de NAT e suas combina√ß√µes, o que √© especialmente importante ao organizar o encapsulamento IPSec. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O xl2tpd</a> tamb√©m <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√©</a> amplamente utilizado, sua principal vantagem √© a capacidade <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">interna</a> de autenticar e transmitir par√¢metros de conex√£o do cliente via ppp ao conectar (por exemplo, endere√ßos IP, configura√ß√µes de rota padr√£o, servidores DNS etc.), o que elimina a necessidade de implanta√ß√£o adicional de DHCP e Radius para o nosso tarefas simples. <br><br>  Como o xl2tpd n√£o est√° nos reposit√≥rios padr√£o do Amazon Linux, precisamos habilitar o EPEL (Pacotes Extra para Enterprise Linux): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum-config-manager --enable epel</span></span></code> </pre> <br><h3>  Instale os pacotes necess√°rios: </h3><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum install libreswan xl2tpd -y</span></span></code> </pre> <br><h3>  Habilite o roteamento no n√≠vel do kernel: </h3><br>  no arquivo <b>/etc/sysctl.conf,</b> escrevemos: <br><br><pre> <code class="bash hljs">net.ipv4.ip_forward = 1 net.ipv4.conf.all.accept_redirects = 0 net.ipv4.conf.all.secure_redirects = 1 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.default.accept_redirects = 0 net.ipv4.conf.default.secure_redirects = 0 net.ipv4.conf.default.send_redirects = 0 net.ipv4.conf.lo.accept_redirects = 0 net.ipv4.conf.lo.secure_redirects = 0 net.ipv4.conf.lo.send_redirects = 0 net.ipv4.conf.eth0.accept_redirects = 0 net.ipv4.conf.eth0.secure_redirects = 0 net.ipv4.conf.eth0.send_redirects = 0 net.ipv4.conf.all.rp_filter = 0 net.ipv4.conf.default.rp_filter = 0 net.ipv4.conf.eth0.rp_filter = 0</code> </pre><br>  Desative <b>rp_filter</b> na sess√£o atual para n√£o reiniciar: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># for f in /proc/sys/net/ipv4/conf/*/rp_filter ; do # echo 0 &gt; $f # done</span></span></code> </pre><br>  Aplicamos as configura√ß√µes e verificamos a disponibilidade do roteamento: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sysctl -p /etc/sysctl.conf # cat /proc/sys/net/ipv4/ip_forward</span></span></code> </pre><br>  Precisamos garantir o encaminhamento de pacotes de entrada (com rela√ß√£o √† interface p√∫blica da inst√¢ncia) das portas dos servi√ßos necess√°rios para o nosso futuro t√∫nel IPSec.  Para isso, √© necess√°rio n√£o apenas remover o NAT desses pacotes, mas tamb√©m fazer o mascaramento na interface <b>ppp0</b> . <br>  Usaremos os recursos <b>internos</b> do <b>iptables</b> para isso, que no caso do Amazon Linux s√£o configurados inicialmente para permitir completamente qualquer tr√°fego em qualquer dire√ß√£o: <br><br>  fa√ßa DNAT das portas necess√°rias: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 80 -j DNAT --to-destination 10.100.0.2:80 # iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 443 -j DNAT --to-destination 10.100.0.2:443</span></span></code> </pre> <br>  encaminhe todos os pacotes que vieram para essas portas para o endere√ßo do gate do Windows: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -A FORWARD -p tcp -d 10.100.0.2 --dport 80 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT # iptables -A FORWARD -p tcp -d 10.100.0.2 --dport 443 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT</span></span></code> </pre> <br>  mascarar para estes pacotes: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE</span></span></code> </pre><br>  √â aconselh√°vel manter as regras do iptables para que elas sejam automaticamente apertadas quando a inst√¢ncia for reiniciada: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># service iptables save</span></span></code> </pre> <br>  Nesse caso, usamos o DNAT (NAT de destino) da porta TCP necess√°ria a partir da interface de rede eth0 da inst√¢ncia na dire√ß√£o do endere√ßo IPv4 10.100.0.2, que √© o endere√ßo na interface ppp do servi√ßo RRAS do nosso portal RRAS do nosso port√£o do Windows no hypervisor dom√©stico. <br><br>  A seguir, vem um ponto muito importante: como os servi√ßos dentro do hypervisor precisam responder √†s solicita√ß√µes recebidas da inst√¢ncia da AWS, √© necess√°rio fornecer mascaramento (substituindo o endere√ßo do remetente) na interface <b>ppp0</b> da inst√¢ncia antes de enviar o pacote, caso contr√°rio, a resposta seguir√° uma dire√ß√£o completamente diferente: o port√£o do Windows no hipervisor ap√≥s o t√∫nel IPSec direto para o roteador padr√£o (roteador dom√©stico), como resultado, √© claro, ser√° descartado no lado do cliente do servi√ßo, como se fosse de um recurso n√£o solicitado.  Se o mascaramento for usado no cabe√ßalho do pacote na entrada do t√∫nel VPN, o endere√ßo do remetente mudar√° do endere√ßo em algum lugar da Internet para o endere√ßo <b>ppp0 da</b> interface da inst√¢ncia da AWS: EC2, ou seja,  no meu caso em 10.100.0.1 <br><br>  Como alternativa ao uso do iptables para outras distribui√ß√µes Linux ou sistemas * NIX, voc√™ pode recomendar o bom e velho rinetd, onde tudo isso √© feito geralmente em uma linha na sua configura√ß√£o <b>rinetd.conf</b> : <br><br><pre> <code class="bash hljs">&lt;ip <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>&gt; &lt;port <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>&gt; &lt;ip destination&gt; &lt;port destination&gt;</code> </pre> <br>  A √∫nica coisa que precisar√° ser ativada neste caso no kernel √© a possibilidade de roteamento / tr√°fego NAT. <br><br><h3>  √â hora de cozinhar libreswan. </h3><br>  O arquivo <b>/etc/ipsec.conf</b> cont√©m instru√ß√µes para baixar todos os arquivos .conf de /etc/ipsec.d/, portanto, criamos um novo arquivo de configura√ß√£o no diret√≥rio /etc/ipsec.d/aws_vpn.conf e o adicionamos a ele: <br><br><pre> <code class="bash hljs">config setup <span class="hljs-comment"><span class="hljs-comment">#       # plutostderrlog=/var/log/pluto.log # logfile=/var/log/pluto.log # plutodebug = all #  NAT-T -   NAT- nat_traversal=yes oe=off protostack=netkey nhelpers=0 interfaces=%defaultroute conn aws_vpn type=tunnel auto=start forceencaps=yes pfs=no fragmentation=yes authby=secret left=%defaultroute #   &lt;‚Ä¶&gt;      Elastic IP leftid=&lt;‚Ä¶&gt; #   &lt;‚Ä¶&gt;     (172...) leftsubnet=&lt;‚Ä¶&gt;/32 leftnexthop=%defaultroute leftprotoport=17/1701 rightprotoport=17/%any right=%any rightsubnetwithin=0.0.0.0/0 rightsubnet=vhost:%priv</span></span></code> </pre><br>  Por uma quest√£o de simplicidade, usaremos a autentica√ß√£o IPSec com base em uma chave compartilhada (PSK), n√£o em certificados, portanto devemos especific√°-la explicitamente.  O arquivo <b>/etc/ipsec.secrets</b> cont√©m instru√ß√µes para o download de todos os arquivos .secrets de <b>/etc/ipsec.d/</b> , onde criamos um novo arquivo <b>/etc/ipsec.d/aws_vpn.secrets</b> e especificamos o PSK no formato: <br><br><pre> <code class="bash hljs">&lt;     172...&gt; %any : PSK <span class="hljs-string"><span class="hljs-string">"&lt; PSK&gt;"</span></span></code> </pre> <br>  Como exemplo: <br><br><pre> <code class="bash hljs">172.31.20.120 %any : PSK <span class="hljs-string"><span class="hljs-string">"Pa$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$w0rd</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  Como a conex√£o ppp ser√° usada dentro do t√∫nel IPSec e h√° sua pr√≥pria autentica√ß√£o, n√≥s a configuramos tamb√©m: <br>  N√≥s inserimos o nome de usu√°rio e senha no arquivo <b>/ etc / ppp / chap-secrets</b> no formato: <br><br><pre> <code class="bash hljs">&lt;user&gt; * &lt;password&gt; *</code> </pre> <br>  Como exemplo: <br><br><pre> <code class="bash hljs">aws_user * Pa$<span class="hljs-variable"><span class="hljs-variable">$w0rd</span></span> *</code> </pre> <br>  Ao conectar-se ao cliente ppp, √© poss√≠vel passar v√°rias op√ß√µes para configurar a interface de rede e a tabela de roteamento de sua parte. <br><br>  No arquivo <b>/etc/ppp/options.xl2tpd</b> , defina estas op√ß√µes: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  xl2tpd  ip   ipcp-accept-local ipcp-accept-remote #    defaultroute   Windows-    nodefaultroute noccp auth #   RRAS  Windows-  mschap-v2   require-mschap-v2 #   MTU  MRU mtu 1410 mru 1410 lock</span></span></code> </pre><br>  Porque  n√£o precisamos passar endere√ßos de DNS, vit√≥rias etc. para o cliente.  coisas - todas as outras op√ß√µes precisam ser comentadas. <br><br>  Aqui voc√™ precisa de uma explica√ß√£o da configura√ß√£o. <br><br>  O comportamento padr√£o para conex√µes VPN √© instalar uma nova rota padr√£o na tabela do cliente, o que for√ßa todo o tr√°fego a partir da Internet para "passar" pelo servidor vpn.  No nosso caso, isso est√° errado, porque  o objetivo do port√£o do Windows √© fornecer acesso simulado √† Internet da rede de escrit√≥rio virtual por tr√°s dele no hipervisor e publicar os recursos de servi√ßos internos atrav√©s da AWS: EC2, por isso √© irracional direcionar todo o tr√°fego da inst√¢ncia para a AWS: EC2.  √â por isso que voc√™ precisa impedir que uma conex√£o VPN no RRAS altere a rota padr√£o (para um roteador dom√©stico). <br><br>  Tamb√©m √© importante escolher os valores corretos de MTU e MRU: usamos o encapsulamento IPSec e um tamanho de carga √∫til muito grande pode n√£o se encaixar no limite de encapsulamento, o que levar√° √† fragmenta√ß√£o e provavelmente a um erro.  Se aparecer, tente primeiro reduzir esses valores, por exemplo, para 1280. Os valores indicados na configura√ß√£o fornecida s√£o compat√≠veis com o cliente VPN do Windows. <br><br><h3>  Resta configurar o xl2tpd </h3><br>  Configuramos tudo o que √© necess√°rio no arquivo de configura√ß√£o xl2tpd <b>/etc/xl2tpd/xl2tpd.conf</b> : <br><br><pre> <code class="bash hljs">[global] port=1701 ipsec saref = yes ; ,      ;debug tunnel = yes ;debug avp = yes ;debug network = yes ;debug state = yes ;debug tunnel = yes [lns default] name = AWSvpnServer ;       ppp ip range = 10.100.0.2-10.100.0.2 ;    ppp0 AWS:EC2  <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> ip = 10.100.0.1 require authentication = yes require chap = yes refuse pap = yes pppoptfile = /etc/ppp/options.xl2tpd length bit = yes</code> </pre><br><h3>  Verificamos tudo o que fizemos </h3><br>  Tentamos executar os dois servi√ßos e verificamos as configura√ß√µes: <br><br><pre> <code class="bash hljs">service ipsec start service xl2tpd start ipsec verify</code> </pre><br>  Os servi√ßos j√° podem estar em execu√ß√£o; nesse caso, eles s√£o simplesmente reiniciados. <br><br>  Se tudo estiver bem, a sa√≠da do ipsec Verifique deve ser semelhante √† captura de tela: <br><br><img src="https://habrastorage.org/webt/o1/rv/br/o1rvbrchcizb6jn9qewgrj_hrn4.png"><br><br>  Voc√™ pode depurar o xl2tpd interativamente, executando-o com a op√ß√£o -D e pendurando-o em uma ‚Äújanela‚Äù separada do terminal SSH usando o utilit√°rio de <b>tela</b> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># xl2tpd -D</span></span></code> </pre> <br>  Nesse caso, o processo xl2tpd n√£o entrar√° em segundo plano, mas exibir√° todas as suas atividades na tela do terminal. <br><br>  Em caso de problemas, √© necess√°rio descomentar as op√ß√µes de depura√ß√£o nas configura√ß√µes (consulte os coment√°rios) e examinar o conte√∫do dos logs do sistema e o arquivo <b>/var/log/pluto.log</b> .  Tamb√©m vale a pena prestar aten√ß√£o ao conte√∫do da op√ß√£o <b>virtual_private / virtual-private</b> no arquivo <b>/etc/ipsec.conf</b> , que lista todas as redes privadas dispon√≠veis para troca de dados por meio do IPSec.  Se, por algum motivo, voc√™ tiver seu pr√≥prio endere√ßamento, por exemplo, usar seu pr√≥prio conjunto de endere√ßos IPv4 brancos, fa√ßa altera√ß√µes nesse par√¢metro. <br><br><h3>  Vamos para a √∫ltima etapa - configurar o servi√ßo RRAS no port√£o do Windows e verificar a publica√ß√£o de servi√ßos da Internet </h3><br>  Sup√µe-se que o seu hipervisor dom√©stico tenha uma m√°quina virtual executando o Windows 2012R2 ou mais recente, implantada no modo gr√°fico (√Årea de Trabalho), e h√° dois adaptadores de rede nessa m√°quina virtual: uma analisa a rede dom√©stica e possui um roteador dom√©stico como a rota padr√£o e o outro em uma rede virtual de ‚Äúescrit√≥rio‚Äù local, na qual existem servi√ßos publicados fora.  Um dom√≠nio do Windows √© opcional, a menos que os pr√≥prios servi√ßos o exijam. <br><br>  Instalamos todas as fun√ß√µes necess√°rias usando o Gerenciador do Servidor ou o cmdlet PowerShell <b>Install-WindowsFeature</b> : <br><br><img src="https://habrastorage.org/webt/lv/vw/ul/lvvwull1qus2dpgplvaxfvjv_gq.png"><img src="https://habrastorage.org/webt/pc/ag/80/pcag80h9dc8jq6gtim8jbdoeseq.png"><br><br>  Aqui, demonstro a instala√ß√£o de fun√ß√µes por meio de gr√°ficos, porque ainda ser√° muito mais conveniente chamar o assistente de instala√ß√£o do Server Manager e configurar o servi√ßo RRAS no cronograma, o que nos agradar√° com a boa e antiga interface desde o Windows Server 2003: <br><br><img src="https://habrastorage.org/webt/ai/rx/hz/airxhzrmjcbvyopop4rt_rcu4ga.png"><br><br>  Clique em RMB no seu servidor, selecione <b>"Configurar e ativar roteamento e acesso remoto"</b> e, em seguida, configure manualmente: <br><br><img src="https://habrastorage.org/webt/na/gj/bc/nagjbch0d6jxmyjzgywhnqqe17s.png"><br><br>  Sinta-se livre para selecionar todas as gralhas, concluir o assistente e iniciar o servi√ßo: <br><br><img src="https://habrastorage.org/webt/ku/ir/sq/kuirsqjvnmskwfjrikybcl2kacu.png"><br><br>  Primeiro, vamos lan√ßar nossa rede local virtual fora.  Vamos para IPv4-&gt; NAT e criamos uma nova interface, como a interface existente na qual o NAT ser√° implementado, selecione a interface externa (que fica na Internet ou melhor na sua rede dom√©stica), marque-a como p√∫blica e ative a NAT: <br><br><img src="https://habrastorage.org/webt/gk/zh/lx/gkzhlxjyvjsgkhdnfvaqyhcn3xo.png"><img src="https://habrastorage.org/webt/kw/wx/xw/kwwxxw5u1gtezu2moo-3beokuli.png"><br><br>  Verificamos como o tr√°fego da LAN virtual sai pelo nosso port√£o.  Ainda n√£o precisamos configurar o Firewall do Windows. <br><br>  Se estiver tudo bem, finalmente criaremos o que est√°vamos lutando, uma conex√£o VPN √† nossa inst√¢ncia da AWS e verificaremos a publica√ß√£o de nossos servi√ßos.  Vamos no snap-in do RRAS para <b>"Interfaces de rede"</b> e criamos uma nova interface de discagem por demanda com um nome arbitr√°rio: <br><br><img src="https://habrastorage.org/webt/-v/04/yx/-v04yxa-najhry2evwovvtydsby.png"><br><br>  Selecione imediatamente a conex√£o L2TP, para que nossa nova interface n√£o tente determinar automaticamente o tipo de VPN e, como resultado, ela se conectar√° mais rapidamente: <br><br><img src="https://habrastorage.org/webt/jg/mw/xb/jgmwxbg1nzbih2grilgopxrlfv8.png"><br><br>  Mais adiante, no assistente, indicamos o endere√ßo p√∫blico da nossa nuvem (no meu caso, o Elastic IP).  Nas pr√≥ximas etapas, deixe tudo como est√°, porque  n√£o precisamos de uma conex√£o site a site: <br><br><img src="https://habrastorage.org/webt/fa/fn/p7/fafnp7fmggqxnbmosjcpdkx1wck.png"><img src="https://habrastorage.org/webt/d1/zc/wm/d1zcwmsgomejupu7if4ynp2rqjk.png"><br><br>  Especifique a conta do usu√°rio sob a qual configuramos a conex√£o ppp (no arquivo <b>/ etc / ppp / chap-secrets</b> ).  Nenhum nome de dom√≠nio √© necess√°rio: <br><br><img src="https://habrastorage.org/webt/zc/to/ei/zctoei91of_eyji6fncqhgvcii4.png"><br><br>  O assistente cria uma nova conex√£o.  Agora resta configur√°-lo.  Ajustamos o tempo limite ocioso (tempo ocioso), removemos o CHAP desatualizado em favor de apenas o MS-CHAPv2, especificamos a chave PSK em "Propriedades avan√ßadas" (a que foi definida para xl2tpd no arquivo /etc/ipsec.d/aws_vpn. segredos) e remova o IPv6: <br><br><img src="https://habrastorage.org/webt/a0/qf/tf/a0qftfatglil4qkjv-hyn5hzvlc.png"><img src="https://habrastorage.org/webt/ax/hy/hu/axhyhuwgchr9z2vhmel17jjbx1s.png"><img src="https://habrastorage.org/webt/vq/xl/qz/vqxlqzejzpi3rs0i9x0r5ol9fkg.png"><img src="https://habrastorage.org/webt/km/ro/um/kmroumh0brc2_yq3przzb-a7jm8.png"><br><br>  Depois de criar uma nova interface, voc√™ tamb√©m deve acessar as propriedades do servi√ßo RRAS, habilitar sua diretiva IPSec para L2TP e especificar seu PSK.  Eles s√£o solicitados a reiniciar o servi√ßo RRAS. <br><br><img src="https://habrastorage.org/webt/h8/0w/zk/h80wzkz1pfymizhrqruvwrgj9di.png"><br><br>  Parece que tudo pode ser criado com seguran√ßa em uma nova interface e aproveitar o trabalho.  Mas n√£o.  Devido ao fato de termos utilizado o NAT no lado da inst√¢ncia do AWS: EC2, o cliente VPN do Windows n√£o poder√° se conectar a um n√≥ Nat-Traversal.  Isso vale tanto para as vers√µes do cliente (at√© a √∫ltima vers√£o deste artigo da compila√ß√£o do Windows 10) quanto para as do servidor. <br><br>  Felizmente, existe uma solu√ß√£o oficial para esse problema na forma de edi√ß√µes no registro das configura√ß√µes do servi√ßo de diretiva IPSec, seguidas por uma reinicializa√ß√£o: <br><br>  At <br>  <b>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ PolicyAgent</b> <br>  crie uma chave DWORD (32 bits) <br>  <b>AssumeUDPEncapsulationContextOnSendRule = 2</b> <br>  e reinicie o nosso Windows Gate. <br><br>  Infelizmente, o servi√ßo RRAS √© famoso por seu capricho na configura√ß√£o e opera√ß√£o e, mesmo ap√≥s uma reinicializa√ß√£o, executa um in√≠cio atrasado.  Assim, voc√™ pode apress√°-lo ap√≥s uma reinicializa√ß√£o. <br>  Se tudo for feito corretamente, a conex√£o funcionar√° dentro de 5 a 10 segundos. <br><br>  Resta fazer a publica√ß√£o dos recursos necess√°rios no pr√≥prio port√£o do Windows. <br><br>  Para o teste, elaboraremos a publica√ß√£o do servidor web.  Primeiro, verifique nosso t√∫nel IPSec e as regras do iptables. <br><br>  Com m√£os tr√™mulas, verificamos a partir de um PC arbitr√°rio conectado √† Internet: <br><br><img src="https://habrastorage.org/webt/ho/yg/c-/hoygc-blrya-dt30hytsmdruezg.png"><img src="https://habrastorage.org/webt/8v/yc/q7/8vycq7c2bsc6dqjcc3t7qzcacje.png"><br><br>  Uau, funciona ... <br><br>  Durante a instala√ß√£o das fun√ß√µes necess√°rias, o MS IIS ‚Äúnativo‚Äù foi instalado √† for√ßa, mas queremos ainda mais f√°cil.  Para isso, em uma plataforma Windows, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>HFS</b></a> (HTTP File Server) √© adequado - √© gratuito, n√£o requer instala√ß√£o, fornece uma p√°gina espec√≠fica e um cabe√ßalho HTTP, pode funcionar em uma porta arbitr√°ria (por padr√£o √© 8080, portanto, no nosso caso, ser√° necess√°rio reconfigurar para 80), e tamb√©m grava imediatamente em seu console de onde a conex√£o veio, o que √© muito conveniente para depurar a publica√ß√£o de muitos recursos da Web na plataforma Windows.  Para us√°-lo, voc√™ deve primeiro parar o site do MS IIS para desatar o servidor incorporado da porta necess√°ria.  Como n√£o queremos instalar o console de gerenciamento do MS IIS (na verdade, o console do MS IIS 6 estar√° presente para compatibilidade, mas o IIS 7+ n√£o pode ser controlado por ele), faremos isso pelo PowerShell: <br><br><pre> <code class="bash hljs">Stop-WebSite -Name <span class="hljs-string"><span class="hljs-string">"Default Web Site"</span></span></code> </pre> <br>  ou simplesmente atrav√©s do utilit√°rio de gerenciamento iisreset: <br><br><pre> <code class="bash hljs">iisreset /stop</code> </pre> <br>  Depois disso, voc√™ precisa permitir o tr√°fego de entrada para a porta 80 no Firewall do Windows interno. <br>  Iniciamos o HFS e verificamos: <br><br><img src="https://habrastorage.org/webt/ti/u2/bc/tiu2bcpm3ynhzteryfe9njxvfq4.png"><br><br>  Tudo est√° √≥timo.  Conseguimos que, de qualquer lugar da Internet, voc√™ possa ver o servidor Web que mora em nossa casa como uma m√°quina virtual em um hipervisor arbitr√°rio. <br><br>  O toque final: ensinamos o RRAS a encaminhar todos esses pedidos de fora para a rede do escrit√≥rio virtual, onde, segundo a lenda, temos outro servidor da web. <br><br>  Para fazer isso, vamos novamente ao snap-in de gerenciamento do RRAS em IPv4-&gt; NAT e RMB em nossa interface VPN, onde selecionamos a guia <b>"Servi√ßos e portas"</b> , marcamos o servidor Web na lista e especificamos o servidor Web na rede virtual interna cujos recursos queremos publicar internet: <br><br><img src="https://habrastorage.org/webt/d7/bq/jv/d7bqjv0ir3a2l8w4vzxpdax8nra.png"><br><br>  Clique em OK e ... tudo est√° pronto.  Verificamos - tudo deve funcionar bem. <br><br>  De uma maneira t√£o simples, voc√™ pode publicar rapidamente quase todos os servi√ßos e recursos, de sites, servidores de correio a algumas integra√ß√µes complexas.  Naturalmente, para a maioria deles, voc√™ precisar√° ter seu pr√≥prio dom√≠nio DNS com a capacidade de criar subdom√≠nios nele e editar os registros necess√°rios.  Tamb√©m √© aconselh√°vel usar certificados SSL para publicar recursos da Web, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gra√ßas ao LetsEncrypt</a> e servi√ßos similares compat√≠veis com ACME, tudo isso pode ser feito de forma totalmente gratuita e com atualiza√ß√£o autom√°tica. <br><br>  Quando voc√™ reinicia a inst√¢ncia, o endere√ßo IPv4 p√∫blico n√£o √© alterado - apenas quando √© parado, mas ainda √© recomend√°vel usar um endere√ßo IPv4 est√°tico na AWS: EC2.  Est√°tico no sentido de que, quando voc√™ desliga sua inst√¢ncia, ela permanece atribu√≠da a ela e n√£o se enquadra no conjunto gratuito geral.  Obviamente, isso √© necess√°rio para n√£o se preocupar sempre com a reconfigura√ß√£o dos registros DNS nos dom√≠nios, e ningu√©m cancelou o TTL com o cache.  Custa muito dinheiro e √© chamado, como j√° mencionado acima, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IP Elastic</a> . <br><br><h3>  Automa√ß√£o primitiva de processos </h3><br>  Por fim, quero mencionar outro √≥timo recurso da AWS: EC2 - configura√ß√£o r√°pida de inst√¢ncia implement√°vel.  Existem muitas op√ß√µes de implanta√ß√£o r√°pida na AWS: EC2, at√© servi√ßos especiais (e bastante complexos, mas muito poderosos), mas h√° a mais simples: na etapa 3 do assistente para criar uma nova inst√¢ncia na parte inferior, √© o campo <b>"Dados do usu√°rio"</b> .  Voc√™ pode colocar um script no bash ou mesmo no PowerShell (no caso de uma inst√¢ncia para Windows), e esse script ser√° executado automaticamente imediatamente ap√≥s a cria√ß√£o da inst√¢ncia. <br>  I.e.  voc√™ pode modificar levemente todos os comandos e configura√ß√µes acima para criar seu pr√≥prio script bash e us√°-lo para criar rapidamente um roteador virtual AWS: EC2.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Saiba mais sobre esse recurso</a> . <br><br>  Obrigado por ler este artigo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt470047/">https://habr.com/ru/post/pt470047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt470033/index.html">F # 2: ambiente FSI</a></li>
<li><a href="../pt470035/index.html">Gerador delirante: crie textos em qualquer idioma usando uma rede neural</a></li>
<li><a href="../pt470037/index.html">F # 3: Formata√ß√£o de texto</a></li>
<li><a href="../pt470043/index.html">A ci√™ncia por tr√°s de como nossos c√©rebros funcionam melhor e como a tecnologia e nosso ambiente podem ajudar</a></li>
<li><a href="../pt470045/index.html">Visual Studio para Mac: Principais recursos do novo editor</a></li>
<li><a href="../pt470049/index.html">Introdu√ß√£o ao gerenciamento de pacotes NuGet em n√≠vel de solu√ß√£o no Visual Studio para Mac</a></li>
<li><a href="../pt470051/index.html">Neuroci√™ncia: quando nosso c√©rebro funciona melhor e como a tecnologia pode ajud√°-lo</a></li>
<li><a href="../pt470055/index.html">Introdu√ß√£o ao gerenciamento de pacotes NuGet em n√≠vel de solu√ß√£o no Visual Studio para Mac</a></li>
<li><a href="../pt470057/index.html">Visual Studio para Mac: 5 novos recursos interessantes</a></li>
<li><a href="../pt470061/index.html">Como escrever menos c√≥digo e ter mais sentido</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>