<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🎨 🛌🏾 💂 Ce que vous devez savoir (pas) pour créer des jeux sur Unity 👩‍🌾 🌆 🍝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unity est un moteur de jeu avec un seuil d'entrée loin de zéro (en comparaison avec le même Game Maker Studio), et dans cet article, je vais vous dire...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ce que vous devez savoir (pas) pour créer des jeux sur Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458914/"><img width="100%" src="https://habrastorage.org/webt/tf/uv/8n/tfuv8nnybrkzyxholyzuoaasafo.png"><br><br>  Unity est un moteur de jeu avec un seuil d'entrée loin de zéro (en comparaison avec le même Game Maker Studio), et dans cet article, je vais vous dire quels problèmes j'ai rencontrés en commençant à l'étudier et quelles solutions j'ai trouvées.  Je décrirai ces moments avec l'exemple de mon jeu de puzzle 2d pour Android (qui j'espère sera bientôt publié sur le Play Market). <a name="habracut"></a><br><br>  Je ne prétends pas être vrai, et je ne vous exhorte pas à répéter après vous-même, si vous connaissez la meilleure façon, je vais juste vous montrer comment le faire vous-même, et peut-être que quelqu'un qui commence tout juste à se familiariser avec Unity créera son propre chef-d'œuvre indépendant avec moins de travail. <br><br>  Je suis ingénieur en conception de centrales électriques, mais j'ai toujours été intéressé par le codage et je connais certains langages de programmation.  Par conséquent, nous convenons que pour créer des jeux sur Unity: <br><ul><li>  Vous devez connaître un peu C # ou JavaScript (au moins la syntaxe en forme de C). <br></li></ul><br>  Tout ce qui sera écrit ci-dessous n'est pas un tutoriel Unity, dont suffisamment ont été créés sur le réseau sans moi.  Vous trouverez ci-dessous les moments difficiles qui peuvent survenir lors de la création de votre premier projet sur Unity. <br><br>  Il convient de signaler que les scripts fournis omettent la majeure partie de la logique du jeu (représentant des "secrets commerciaux"), mais leurs performances en tant qu'exemples ont été vérifiées. <br><br><h3>  Problème 1 - Orientation </h3><br><img align="left" width="40%" src="https://habrastorage.org/webt/-f/za/hw/-fzahwdptbht2vwe1qm4xswgqkm.png"><br>  <b>Verrou d'orientation</b> <br>  La première difficulté qui est apparue en moi est que je n'ai pas accordé l'attention voulue à l'optimisation de l'interface visuelle pour l'orientation de l'écran.  La solution est la plus simple - si vous n'avez pas besoin de changer l'orientation de l'écran pour le gameplay, il est préférable de le bloquer.  Pas besoin d'une flexibilité excessive, vous écrivez un jeu indépendant, pas un projet de l'autre côté d'un million de dollars.  Pourquoi des tonnes de transitions conditionnelles et des changements d'ancrage si le jeu est plus beau dans Portrait (par exemple).  Vous pouvez verrouiller l'orientation de l'écran ici: <br>  <b>Édition&gt; Paramètres du projet&gt; Lecteur</b> <br clear="all"><br clear="all"><img align="right" width="40%" src="https://habrastorage.org/webt/jb/3u/ot/jb3uotkehyw_t2pa2e__yw0n2ng.png"><br>  <b>Différentes autorisations</b> <br>  Il est également important de tester l'interface visuelle à différentes résolutions dans l'orientation sélectionnée, et lors du test, n'oubliez pas l'existence d'appareils avec des proportions de 4: 3 (enfin, ou 3: 4), afin que nous puissions ajouter en toute sécurité 768x1024 (ou 1024x768). <br><br>  <b>Un meilleur positionnement</b> <br>  Il est préférable d'utiliser Rect Transform pour ajuster le positionnement et l'échelle des objets du jeu. <img align="left" width="40%" src="https://habrastorage.org/webt/rm/gk/ao/rmgkao3ttyvdkj3dbs8zmtxrm2o.png"><br><br clear="all"><br clear="all"><h3>  Deuxième problème - COMMUNICATION </h3><br>  J'ai eu un problème similaire en raison du fait que j'ai fait la première connaissance avec le développeur de jeu en utilisant Game Maker Studio, où le script est une partie à part entière de l'objet de jeu, et il a immédiatement un accès complet à tous les composants de l'objet.  Unity a des scripts communs et seules leurs instances sont ajoutées à l'objet.  Parlant de manière simpliste et figurée, le script ne sait pas directement sur quel objet il s'exécute actuellement.  Par conséquent, lors de l'écriture de scripts, vous devez prendre en compte l'initialisation des interfaces pour travailler avec les composants d'un objet ou avec les composants d'autres objets. <br><br>  <b>Nous nous entraînons sur les chats</b> <br>  Dans mon jeu, il y a un objet GameField, sur la scène, il n'y en a qu'une seule instance, il y a aussi un script du même nom.  L'objet est chargé d'afficher la partition du jeu et de reproduire l'intégralité du son du jeu, donc à mon avis, il est plus économique pour la mémoire (en général, le jeu n'a que trois sources audio - une musique de fond, deux autres effets sonores).  Le script résout les problèmes de stockage d'un compte de jeu, de choix d'AudioClip pour la lecture du son et d'une certaine logique de jeu. <br><br>  Arrêtons-nous plus en détail sur le son, car cet exemple montre facilement l'interaction du script avec les composants de l'objet. <br><br><img width="40%" align="left" src="https://habrastorage.org/webt/2y/ll/ab/2yllabokihsyqwabiwnod3tiqyc.png">  Naturellement, l'objet doit avoir le script GameField.cs lui-même et le composant AudioSource, dans mon cas deux entiers (plus tard, il sera clair pourquoi). <br clear="all"><br clear="all">  Comme mentionné précédemment, le script n'est «pas au courant» que l'objet a un composant AudioSource, donc nous déclarons et initialisons l'interface (pour l'instant, nous considérons qu'il n'y a qu'une seule AudioSource): <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource Sound; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ Sound = GetComponent&lt;AudioSource&gt; (); }</code> </pre> <br>  La méthode GetComponent &lt;component_type&gt; () renvoie le premier composant du type spécifié à partir de l'objet. <br><br>  En plus d'AudioSource, vous aurez besoin de plusieurs AudioClip: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Header (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Audio clips"</span></span></span><span class="hljs-meta">)</span></span>] [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnStart; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnEfScore; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnHighScore; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnMainTimer; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnBubbMarker; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnScoreUp;</code> </pre><br>  Ci-après, les commandes entre crochets sont nécessaires pour Inspector`a, plus de détails <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><img width="40%" align="left" src="https://habrastorage.org/webt/wk/t-/k7/wkt-k7spezw5hanfme5xchxexzk.png"><br><br>  Maintenant, le script dans Inspector a de nouveaux champs dans lesquels nous glissons les sons nécessaires. <br><br clear="all"><br clear="all">  Ensuite, créez une méthode SoundPlay dans le script qui prend en AudioClip: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySound</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AudioClip Clip = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>{ Sound.clip = Clip; Sound.Play (); }</code> </pre><br>  Pour jouer du son dans le jeu, nous appelons au bon moment cette méthode avec le clip. <br><br>  Il y a un inconvénient majeur à cette approche, un seul son peut être joué à la fois, mais pendant le jeu, il peut être nécessaire de jouer deux sons ou plus, à l'exception de la musique de fond jouée en permanence. <br><br>  Pour éviter la cacophonie, je recommande d'éviter la possibilité de lecture simultanée de plus de 4-5 sons (de préférence un maximum de 2-3), je veux dire des sons courts de premier ordre (saut, pièce, coup de joueur ...), pour le bruit de fond, il est préférable de créer votre propre source son sur l'objet qui fait ce bruit (si vous avez besoin d'un son 2d-3d) ou un objet responsable de tout le bruit de fond (si le "volume" n'est pas nécessaire). <br><br>  Dans mon jeu, il n'est pas nécessaire de jouer simultanément plus de deux AudioClips.  Pour une lecture garantie des deux sons hypothétiques, j'ai ajouté deux AudioSource à l'objet GameField.  Pour déterminer les composants du script, nous utilisons la méthode <br><pre> <code class="cs hljs">GetComponents&lt;_&gt;()</code> </pre><br>  qui renvoie un tableau de tous les composants du type spécifié à partir de l'objet. <br><br>  Le code ressemblera à ceci: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource[] Sound; <span class="hljs-comment"><span class="hljs-comment">//    void Start(){ Sound = GetComponents&lt;AudioSource&gt; (); //  GetComponents }</span></span></code> </pre><br>  La plupart des modifications affecteront la méthode PlaySound.  Je vois deux versions de cette méthode: «universelle» (pour n'importe quel nombre d'AudioSource dans un objet) et «maladroite» (pour 2-3 AudioSource, pas la plus élégante mais moins gourmande en ressources). <br><br>  L'option "maladroite" pour deux AudioSource (je l'ai utilisé) <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySound</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AudioClip Clip = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Sound [<span class="hljs-number"><span class="hljs-number">0</span></span>].isPlaying) { Sound [<span class="hljs-number"><span class="hljs-number">0</span></span>].clip = Clip; Sound [<span class="hljs-number"><span class="hljs-number">0</span></span>].Play (); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Sound [<span class="hljs-number"><span class="hljs-number">1</span></span>].clip = Clip; Sound [<span class="hljs-number"><span class="hljs-number">1</span></span>].Play (); } }</code> </pre><br>  Vous pouvez étirer jusqu'à trois AudioSource ou plus, mais le nombre de conditions dévorera toutes les économies de performances. <br><br>  Option "universelle" <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySound</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AudioClip Clip = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (AudioSource _Sound <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Sound) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_Sound.isPlaying) { _Sound.clip = Clip; _Sound.Play (); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } }</code> </pre><br><br>  <b>Accès à une composante étrangère</b> <br>  Sur le terrain de jeu, il existe plusieurs exemples du préfabriqué Fishka, comme une puce de jeu.  Il est construit comme ceci: <br><ul><li>  Objet parent avec son SpriteRenderer; <ul><li>  Objets enfants avec leur SpriteRenderer. </li></ul></li></ul><br>  Les objets enfants sont chargés de dessiner le corps de la puce, sa couleur, les éléments mutables supplémentaires.  Le parent trace une bordure de marqueur autour de la puce (la puce active doit être mise en surbrillance dans le jeu).  Le script se trouve uniquement sur l'objet parent.  Ainsi, pour gérer les sprites enfants, le script parent doit spécifier ces sprites.  Je l'ai organisé comme ceci - dans le script, j'ai créé des interfaces pour accéder aux enfants SpriteRenderer: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Header (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Graphic objects"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SpriteRenderer Marker; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteRenderer Base; [Space] [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteRenderer Center_Red; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteRenderer Center_Green; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteRenderer Center_Blue;</code> </pre><br>  Maintenant, le script dans Inspector a des champs supplémentaires: <br><img src="https://habrastorage.org/webt/mq/w9/kp/mqw9kpst-fen-bkdtgp_8jycpck.png"><br><br clear="all">  Faire glisser et déposer des enfants dans les champs correspondants nous donne accès à eux dans le script. <br><br clear="all">  Exemple d'utilisation: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnMouseDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//        Marker.enabled = !Marker.enabled; }</span></span></code> </pre><br><br clear="all">  <b>Appel du script de quelqu'un d'autre</b> <br>  En plus de manipuler des composants étrangers, vous pouvez également accéder au script d'un objet tiers, travailler avec ses variables, méthodes et sous-classes publiques. <br><br>  Je vais donner un exemple sur l'objet GameField déjà bien connu. <br><br>  Le script GameField a une méthode publique FishkiMarkerDisabled (), qui est nécessaire pour "supprimer" un marqueur de toutes les puces sur le terrain et est utilisé dans le processus de définition d'un marqueur lorsque vous cliquez sur une puce, car il ne peut y avoir qu'un seul actif. <br><br>  Dans le script Fishka.cs, ​​SpriteRenderer Marker est public, c'est-à-dire qu'il est accessible à partir d'un autre script.  Pour ce faire, ajoutez la déclaration et l'initialisation des interfaces pour toutes les instances de la classe Fishka dans le script GameField.cs (lors de la création d'un script, la classe du même nom y est créée) de la même manière que pour plusieurs AudioSource: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Fishka[] Fishki; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ Fishki = GameObject.FindObjectsOfType (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Fishka)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Fishka[]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FishkiMarkerDisabled</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Fishka _Fishka <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Fishki) { _Fishka .Marker.enabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre><br>  Dans le script Fishka.cs, ​​ajoutez la déclaration et l'initialisation de l'interface de l'instance de classe GameField, et lorsque nous cliquons sur l'objet, nous appelons la méthode FishkiMarkerDisabled () de cette classe: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GameField gf; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ gf = GameObject.FindObjectOfType (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(GameField)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> GameField; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnMouseDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ gf.FishkiMarkerDisabled(); Marker.enabled = !Marker.enabled; }</code> </pre><br>  Ainsi, vous pouvez interagir entre des scripts (ou plutôt des classes) de différents objets. <br><br clear="all"><br clear="all"><h3>  Troisième problème - GARDEURS </h3><br>  <b>Tenue de compte</b> <br>  Dès que quelque chose comme un compte apparaît dans le jeu, le problème immédiat est son stockage, à la fois pendant le jeu et en dehors de celui-ci, je veux aussi garder un record afin d'encourager le joueur à le dépasser. <br><br>  Je ne considérerai pas les options lorsque tout le jeu (menu, jeu, retrait de compte) est construit en une seule scène, car, premièrement, ce n'est pas la meilleure façon de construire le premier projet, et deuxièmement, à mon avis, la scène de chargement initiale devrait être .  Par conséquent, nous convenons qu'il y a quatre scènes dans le projet: <br><ol><li>  chargeur - une scène dans laquelle l'objet de musique de fond est initialisé (plus sera plus tard), et chargement des paramètres à partir de la sauvegarde; <br></li><li>  menu - une scène avec un menu; <br></li><li>  jeu - scène de jeu; <br></li><li>  score - la scène du score, du record, du classement. <br></li></ol><br><img width="40%" align="right" src="https://habrastorage.org/webt/dy/yl/4t/dyyl4tkmtx6a0ijbnjiy1jgkr9q.png"><br>  <i>Remarque: L'ordre de chargement des scènes est défini dans Fichier&gt; Paramètres de construction.</i> <br clear="all"><br clear="all">  Les points accumulés pendant le jeu sont stockés dans la variable Score de la classe GameField.  Pour avoir accès aux données lors de l'accès à la scène des scores, nous allons créer une classe statique publique ScoreHolder, dans laquelle nous déclarons une variable pour stocker la valeur et une propriété pour obtenir et définir la valeur de cette variable (la méthode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">espionne</a> les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">apocatastas</a> ): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ScoreHolder</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _Score = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Score { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _Score; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>{ _Score = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } }</code> </pre><br>  Une classe statique publique n'a besoin d'être ajoutée à aucun objet, elle est immédiatement disponible dans n'importe quelle scène à partir de n'importe quel script. <br><br>  Exemple d'utilisation dans la classe GameField dans les scores de la méthode de transition de scène: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.SceneManagement; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GameField</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Score = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     ,         Scores void GotoScores(){ ScoreHolder.Score = Score; //   ScoreHolder.Score   SceneManager.LoadScene (“scores”); } }</span></span></code> </pre><br>  De la même manière, vous pouvez ajouter un compte d'enregistrement au ScoreHolder pendant le jeu, mais il ne sera pas enregistré à la sortie. <br><br clear="all">  <b>Gardien des paramètres</b> <br>  Prenons l'exemple de l'enregistrement de la valeur de la variable booléenne SoundEffectsMute, selon l'état dans lequel le jeu a ou non des effets sonores. <br><br>  La variable elle-même est stockée dans la classe statique publique SettingsHolder: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SettingsHolder</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _SoundEffectsMute = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> SoundEffectsMute{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _SoundEffectsMute; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>{ _SoundEffectsMute = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } }</code> </pre><br>  La classe est similaire à ScoreHolder, vous pouvez même les combiner en un seul, mais à mon avis, ce sont de mauvaises manières. <br><br>  Comme vous pouvez le voir dans le script, par défaut _SoundEffectsMute est déclaré faux, donc chaque fois que le jeu démarre, SettingsHolder.SoundEffectsMute retournera faux, que l'utilisateur l'ait modifié ou non auparavant (il est modifié à l'aide du bouton sur la scène du menu). <br><br clear="all">  <b>Enregistrement de variables</b> <br>  Le plus optimal pour une application Android sera d'utiliser la méthode PlayerPrefs.SetInt pour la sauvegarde (pour plus de détails voir la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation officielle</a> ).  Il existe deux options pour conserver la valeur de SettingsHolder.SoundEffectsMute dans PlayerPrefs, appelons-les «simples» et «élégantes». <br><br clear="all">  La façon «simple» (pour moi comme ça) est dans la méthode OnMouseDown () de la classe du bouton susmentionné.  La valeur stockée est chargée dans la même classe mais dans la méthode Start (): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ButtonSoundMute</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    ,  PlayerPrefs    bool switch (PlayerPrefs.GetInt ("SoundEffectsMute")) { case 0: SettingsHolder.SoundEffectsMute = false; break; case 1: SettingsHolder.SoundEffectsMute = true; break; default: //    default SettingsHolder.SoundEffectsMute = true; break; } } void OnMouseDown(){ SettingsHolder.SoundEffectsMute = !SettingsHolder.SoundEffectsMute; //    ,  PlayerPrefs    bool if (SettingsHolder.SoundEffectsMute) PlayerPrefs.SetInt ("SoundEffectsMute", 1); else PlayerPrefs.SetInt ("SoundEffectsMute", 0); } }</span></span></code> </pre><br><br clear="all">  La méthode "élégante", à mon avis, n'est pas la plus correcte, car  compliquer la maintenance du code, mais il y a quelque chose dedans, et je ne peux pas m'empêcher de le partager.  Une caractéristique de cette méthode est que le setter de la propriété SettingsHolder.SoundEffectsMute est appelé à un moment qui ne nécessite pas de hautes performances, et il peut être chargé (oh, horreur) à l'aide de PlayerPrefs (lecture - écriture dans un fichier).  Modifiez la classe statique publique SettingsHolder: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SettingsHolder</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _SoundEffectsMute = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> SoundEffectsMute{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _SoundEffectsMute; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>{ _SoundEffectsMute = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_SoundEffectsMute) PlayerPrefs.SetInt (<span class="hljs-string"><span class="hljs-string">"SoundEffectsMute"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> PlayerPrefs.SetInt (<span class="hljs-string"><span class="hljs-string">"SoundEffectsMute"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } }</code> </pre><br>  La méthode OnMouseDown de la classe ButtonSoundMute se simplifiera pour: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnMouseDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ SettingsHolder.SoundEffectsMute = !SettingsHolder.SoundEffectsMute; }</code> </pre><br><br clear="all">  Cela ne vaut pas la peine de charger le getter avec la lecture d'un fichier, car il est impliqué dans un processus critique pour les performances - dans la méthode PlaySound () de la classe GameField: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySound</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AudioClip Clip = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!SettingsHolder.SoundEffectsMute) { <span class="hljs-comment"><span class="hljs-comment">//      “”  (. ) if (!Sound [0].isPlaying) { Sound [0].clip = Clip; Sound [0].Play (); } else { Sound [1].clip = Clip; Sound [1].Play (); } } }</span></span></code> </pre><br><br clear="all">  De la manière ci-dessus, vous pouvez organiser le stockage dans le jeu de toutes les variables. <br><br clear="all"><br clear="all"><h3>  Cinquième problème - UN POUR TOUS </h3><br>  <b>Cette musique sera éternelle</b> <br>  Tôt ou tard, tout le monde fait face à un tel problème, et je n'ai pas fait exception.  Comme prévu, la musique de fond commence à jouer même dans la scène du menu, et si elle n'est pas désactivée, elle joue le menu, le jeu et les partitions sur les scènes sans interruption.  Mais si l'objet "jouant" de la musique de fond est installé sur la scène de menu, lorsque vous accédez à la scène de jeu, il est détruit et le son disparaît, et si vous placez le même objet sur la scène de jeu, puis après la transition, la musique joue en premier.  La solution s'est avérée être l'utilisation de la méthode DontDestroyOnLoad (Object target) placée dans la méthode Start () de la classe dont l'instance de script a l'objet «music».  Pour ce faire, créez le script DontDestroyThis.cs: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DontDestroyThis</span></span>: <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ DontDestroyOnLoad(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gameObject); } }</code> </pre><br><img width="40%" align="left" src="https://habrastorage.org/webt/ee/cj/hn/eecjhn5uyzoclq7ywnqztl1untu.png">  Pour que tout fonctionne, l'objet «musical» doit être root (au même niveau de hiérarchie que la caméra principale). <br clear="all"><br clear="all">  <b>Pourquoi la musique de fond dans le chargeur</b> <br>  La capture d'écran montre que l'objet «musical» ne se trouve pas sur la scène du menu mais sur la scène du chargeur.  Il s'agit d'une mesure causée par le fait que la scène de menu peut être chargée plus d'une fois (après la scène de partitions, la transition vers la scène de menu), et chaque fois qu'elle est chargée, un autre objet «musical» sera créé et l'ancien ne sera pas supprimé.  Cela peut être fait comme dans l'exemple de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la documentation officielle</a> , mais j'ai décidé de profiter du fait que la scène du chargeur ne sera chargée qu'une seule fois. <br><br>  Sur ce point, les problèmes clés que j'ai rencontrés lors du développement de mon premier jeu sur Unity, avant de télécharger sur le Play Market (je n'ai pas encore enregistré de compte développeur), se sont terminés avec succès. <br><br>  <b>PS</b> <br>  <i>Si les informations vous ont été utiles, vous pouvez soutenir l'auteur, et il enregistrera enfin un compte de développeur Android.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr458914/">https://habr.com/ru/post/fr458914/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr458904/index.html">Visualisation du nombre de victoires pour les équipes NBA à l'aide de graphiques à barres animées en R</a></li>
<li><a href="../fr458906/index.html">[Iekaterinbourg, annonce] Flutteron - un atelier sur le développement de Flutter</a></li>
<li><a href="../fr458908/index.html">Numérisation de documents sur le réseau</a></li>
<li><a href="../fr458910/index.html">Benchmarking PostgreSQL avec de grandes pages Linux</a></li>
<li><a href="../fr458912/index.html">Migration vers Zimbra avec imapsync</a></li>
<li><a href="../fr458916/index.html">Sous le capot de React. Nous écrivons notre implémentation à partir de zéro</a></li>
<li><a href="../fr458918/index.html">Ce que vous pouvez apprendre de la conception de jeux hyper-occasionnels</a></li>
<li><a href="../fr458920/index.html">Conférence pour les fans de DevOps</a></li>
<li><a href="../fr458922/index.html">Comment passer d'ESXi à KVM / LXD et ne pas perdre la tête</a></li>
<li><a href="../fr458924/index.html">Les accidents vous aident à apprendre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>